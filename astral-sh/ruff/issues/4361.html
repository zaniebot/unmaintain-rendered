<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement a &quot;review mode&quot; for autofix application - astral-sh/ruff #4361</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement a &quot;review mode&quot; for autofix application</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4361">#4361</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-05-10 20:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>This has been discussed in a few other issues (#2395, #3642), but I want to create a parent issue to track the scope and implementation.</p>
<p>We&#x27;d like to implement a new CLI mode in which users are presented with autofix suggestions one-by-one and given the opportunity to accept or reject fixes iteratively.</p>
<p>This likely wouldn&#x27;t be the default, but rather would be put behind a <code>--interactive</code> or <code>--fix-interactive</code> flag.</p>
<p><code>elm-review</code> is a good example of the behavior we want to implement -- see <a href="https://github.com/charliermarsh/ruff/issues/3642#issuecomment-1480115355">here</a>:</p>
<p><img src="https://user-images.githubusercontent.com/3869412/227010991-a19a6003-2faf-4504-b819-6bad8c7c486e.png" alt="FaHfMbbX0AA_Sba"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">core</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-10 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-10 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-10 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-10 21:03</div>
            <div class="timeline-body"><p>Here&#x27;s the behavior I&#x27;m imaging:</p>
<ul>
<li>User runs <code>ruff --fix-interactive src/</code>.</li>
<li>Internally, check the files.</li>
<li>If there are any fixable violations, present them iteratively, accepting-and-applying or skipping as we go.</li>
<li>Once we&#x27;ve cycled through, if at least one fix was applied, re-check the file.</li>
<li>Repeat this process, since fixes can cause new fixable violations to appear (e.g., removing a usage could then cause an import to be unused). (We might end up showing duplicates here that need to be skipped again.)</li>
<li>Once the review process is a no-op (all skipped, or no fixable violations), finish the interactive session and print out the remaining violations.</li>
</ul>
<p>If a contributor is interested in taking this on, I&#x27;m happy to help with scoping and create separate issues for the various subtasks.</p>
<p>A few things that come to mind:</p>
<ul>
<li>We likely need is a variant on <code>autofix::apply_fixes</code> that prompts the user when applying each fix and prints out the diagnostic to the CLI.</li>
<li>Right now, we process each file independently in parallel, apply fixes + re-check each file iteratively on its own, and then aggregate the results (How many errors were fixed? Which errors remain?). In order to support this, we likely need to move the fix application + re-checking up a level, such that we lint all the files, collect all the diagnostics, then iterate through to apply fixes on a file-by-file basis, and re-run the linter phase if any fixes were applied.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sladyn98">@sladyn98</a> on 2023-05-16 21:24</div>
            <div class="timeline-body"><p>@charliermarsh I could give this a shot !, I might just need some extra guidance as I am still getting used to the codebase</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-05-16 21:34</div>
            <div class="timeline-body"><p>@sladyn98 I&#x27;ve also been eyeing this one as a fun project â€” happy to help out if you want to collaborate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2023-05-16 21:50</div>
            <div class="timeline-body"><p>Ha, so was I!  @sladyn98 I&#x27;m also happy to help out if you&#x27;d like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sladyn98">@sladyn98</a> on 2023-05-16 21:57</div>
            <div class="timeline-body"><p>Lets go  ! @madkinsz @evanrittenhouse we can all do this together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 22:46</div>
            <div class="timeline-body"><p>Since this is a pretty substantial project, I might suggest that someone start by scoping out the work involved in whatever form they see fit for comments / questions, perhaps via a GitHub Discussion? This should probably also involve a little bit of hacking on Ruff (e.g., prototyping) to see around any corners and inform decisions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sladyn98">@sladyn98</a> on 2023-05-31 08:57</div>
            <div class="timeline-body"><p>@charliermarsh Yeah I am happy to open a discussion thread, I have been going through the rust code and have some questions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jfmengels">@jfmengels</a> on 2023-05-31 08:59</div>
            <div class="timeline-body"><p>(Author of <code>elm-review</code> here) I&#x27;m happy to answer questions as well (not on the implementation though, I don&#x27;t know Rust not the Ruff codebase)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sladyn98">@sladyn98</a> on 2023-06-07 19:53</div>
            <div class="timeline-body"><p>https://github.com/charliermarsh/ruff/discussions/4937 I Started a discussion here. Feel free to comment. I have started hacking a bit hoping to learn and implement more as I go on : )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdulcet">@tdulcet</a> on 2023-12-23 16:44</div>
            <div class="timeline-body"><p>I was recently contributing to an open source project and trying to help them get started with the Ruff linter. The maintainer of the project requested that I only fix one type of issue per commit to make it easier for them to review. It is a small-medium sized project (8,443 lines of Python across 23 files), but they had never used a Python linter or formatter before, so there were over 900 errors from the subset of rules I decided to enable.</p>
<p>Anyway, because Ruff does not support this natively, I decided to write a simple wrapper script to allow interactively applying the autofixes per rule. The script also optionally supports committing the changes. In case it is helpful for anyone else, the script is available on GitHub: https://gist.github.com/tdulcet/c1f6415bcae66a4b0cfb6eb96b15444b. Feedback is welcome. For reference, the resulting PR is here: <a href="https://github.com/mail-in-a-box/mailinabox/pull/2343">mail-in-a-box/mailinabox#2343</a>.</p>
<p>The script first runs the <code>ruff check --output-format json</code> command to get the full list of errors in JSON format. It then groups those errors by rule. For each rule, it shows the output of the <code>ruff rule &lt;code&gt;</code> and <code>ruff check --select &lt;code&gt;</code> commands. Then it checks if there are any autofixes available from the JSON output. If so, it additionally shows the output from the <code>ruff check --diff --select &lt;code&gt;</code> command (#7352 could eliminate the need for this). It then asks the user if they want to apply the autofixes. If the user says yes, it runs the <code>ruff check --select &lt;code&gt; --fix</code> command. Lastly, it gives the user a chance to make any manual fixes. After the user presses Enter, it continues on to the next rule. It only checks each rule once, but users can of course run the script multiple times as needed until everything is fixed.</p>
<p>Any command line options provided to the script are forwarded to that first <code>ruff check</code> command. There is also a <code>ARGS</code> list near the top of the script that allow providing additional arguments to every <code>ruff check</code> command, such as <code>--preview</code> or <code>--unsafe-fixes</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eli-schwartz">@eli-schwartz</a> on 2023-12-23 23:43</div>
            <div class="timeline-body"><p>That is pretty neat! I just a few days ago did the same thing slowly by hand, repeatedly running <code>ruff check --select ...</code> while running over each error code in <code>UP</code> to see if there was anything to fix. Same rationale of wanting to commit each type of fix in its own commit. That script could have saved me some time...</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:36 UTC
    </footer>
</body>
</html>
