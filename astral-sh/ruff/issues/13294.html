<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLE2510, PLE2512, PLE2513, PLE2514, and PLE2515 fixes add escape sequences to raw strings - astral-sh/ruff #13294</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLE2510, PLE2512, PLE2513, PLE2514, and PLE2515 fixes add escape sequences to raw strings</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13294">#13294</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2024-09-09 19:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dscorbett">@dscorbett</a> on 2024-09-09 19:20</div>
            <div class="timeline-body"><p>The fixes for <a href="https://docs.astral.sh/ruff/rules/invalid-character-backspace/">PLE2510</a>, <a href="https://docs.astral.sh/ruff/rules/invalid-character-sub/">PLE2512</a>, <a href="https://docs.astral.sh/ruff/rules/invalid-character-esc/">PLE2513</a>, <a href="https://docs.astral.sh/ruff/rules/invalid-character-nul/">PLE2514</a>, and <a href="https://docs.astral.sh/ruff/rules/invalid-character-zero-width-space/">PLE2515</a> add escape sequences to raw strings, which is an invalid change because raw strings don’t support escape sequences. The fixes should convert the raw strings to normal strings first.</p>
<pre><code class="language-console">$ ruff --version
ruff 0.6.4
$ printf 'print(r&quot;&quot;&quot;\x08\x1a\x1b\x00\xe2\x80\x8b\n&quot;&quot;&quot;)\n' &gt;ple251.py
$ python3.10 ple251.py | xxd -p
081a1b0a
$ ruff check --isolated --select PLE251 ple251.py --fix
Found 5 errors (5 fixed, 0 remaining).
$ python3.10 ple251.py
\b\x1A\x1B\0\u200b


</code></pre>
<p>I’m using Python 3.10 for this example because literal null characters are syntax errors in later versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-10 18:02</div>
            <div class="timeline-body"><p>@dscorbett how do you find all these incorrect fixes. Very impressive and thanks for opening an issue!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-10 18:05</div>
            <div class="timeline-body"><p>Converting the raw string to a regular string might not be trivial. I think it would also be reasonable to remove the fix for raw strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-09-10 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @MichaReiser on 2024-09-10 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2024-09-10 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2024-09-10 20:29</div>
            <div class="timeline-body"><p>I don’t know how hard it is to implement in Ruff, but theoretically, converting raw strings to regular strings should be straightforward. Each <code>\</code> becomes <code>\\</code>. Additionally, if it was doubling as a line continuation character in a non-triple-quoted string, the following newline becomes <code>\n</code>; or if it was escaping a quotation mark, the <code>'</code> or <code>&quot;</code> becomes <code>\'</code> or <code>\&quot;</code>. The rationale for avoiding these 5 characters (viz. it is confusing) applies to raw strings just as much as regular strings, so I think it is better to fix the fix for raw strings rather than removing it.</p>
<p>I find all these incorrect fixes by reading the rule descriptions and/or implementations and thinking of edge cases that might have been missed. Basically, it’s glass-box fuzz-testing done manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-10 20:32</div>
            <div class="timeline-body"><blockquote>
<p>I find all these incorrect fixes by reading the rule descriptions and/or implementations and thinking of edge cases that might have been missed. Basically, it’s glass-box fuzz-testing done manually.</p>
</blockquote>
<p>Wow, that's a very impressive skill!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PedroTurik">@PedroTurik</a> on 2024-09-17 20:09</div>
            <div class="timeline-body"><p>I can work on this one. If I understand this correctly, I can start by adding the replacement logic <a href="https://github.com/astral-sh/ruff/blob/dcfebaa4a86bdfd48e26614feb63fc7d2ab5d468/crates/ruff_linter/src/rules/pylint/rules/invalid_string_characters.rs#L187">here</a>, right? I am a first time contributor</p>
<p>Also, I am probably missing something here, but where should I add replacement tests?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-18 06:59</div>
            <div class="timeline-body"><blockquote>
<p>I can work on this one. If I understand this correctly, I can start by adding the replacement logic <a href="https://github.com/astral-sh/ruff/blob/dcfebaa4a86bdfd48e26614feb63fc7d2ab5d468/crates/ruff_linter/src/rules/pylint/rules/invalid_string_characters.rs#L187">here</a>, right? I am a first time contributor</p>
</blockquote>
<p>Awesome and welcome. Yes, this looks about right</p>
<blockquote>
<p>Also, I am probably missing something here, but where should I add replacement tests?</p>
</blockquote>
<p>You can add them to this file</p>
<p>https://github.com/astral-sh/ruff/blob/f70e8a7524b255c20e3dc966141b6e80d9697958/crates/ruff_linter/resources/test/fixtures/pylint/invalid_characters.py#L1-L0</p>
<p>The tests are defined here</p>
<p>https://github.com/astral-sh/ruff/blob/52d27befe87d6572dbb268a24b26c8034032e39f/crates/ruff_linter/src/rules/pylint/mod.rs#L91-L102</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @PedroTurik by @MichaReiser on 2024-09-18 06:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @PedroTurik by @PedroTurik on 2024-10-02 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13882.html">astral-sh/ruff#13882</a> on 2024-10-23 04:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16132.html">astral-sh/ruff#16132</a> on 2025-02-13 06:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-13 08:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-13 08:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
