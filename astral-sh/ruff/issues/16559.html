<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FURB164 fix does not consistently simplify expressions containing non-finite float strings - astral-sh/ruff #16559</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FURB164 fix does not consistently simplify expressions containing non-finite float strings</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16559">#16559</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-03-07 20:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p><a href="https://docs.astral.sh/ruff/rules/unnecessary-from-float/">unnecessary-from-float (FURB164)</a> does not consistently simplify expressions containing non-finite float strings. This is similar to #14587. A non-finite float string can having leading or trailing white space. It can also have an otiose sign: <code>+inf</code>, <code>+nan</code>, or <code>-nan</code>. FURB164 only recognizes strings without these extras. It should treat them the same and fix all or none of them.</p>
<pre><code class="language-console">$ cat &gt;furb164.py &lt;&lt;'# EOF'
from decimal import Decimal
Decimal.from_float(float(&quot;\n+nan\n&quot;))
Decimal.from_float(float(&quot;\xa0-nan\u3000&quot;))
Decimal.from_float(float(&quot; +inf &quot;))
# cf.:
Decimal.from_float(float(&quot;nan&quot;))
Decimal.from_float(float(&quot;-inf&quot;))
# EOF

$ ruff --isolated check --preview --select FURB164 furb164.py --fix
Found 5 errors (5 fixed, 0 remaining).

$ cat furb164.py
from decimal import Decimal
Decimal(float(&quot;\n+nan\n&quot;))
Decimal(float(&quot;\xa0-nan\u3000&quot;))
Decimal(float(&quot; +inf &quot;))
# cf.:
Decimal(&quot;nan&quot;)
Decimal(&quot;-inf&quot;)
</code></pre>
<p>For those first three examples, the fix should produce:</p>
<pre><code class="language-python">Decimal(&quot;\n+nan\n&quot;)
Decimal(&quot;\xa0nan\u3000&quot;)
Decimal(&quot; +inf &quot;)
</code></pre>
<p>Note that the sign should be removed from <code>-nan</code>. Otherwise, the strings stay the same.</p>
<p>Alternatively, the removal of the <code>float</code> call could be considered out of scope for this rule because <a href="https://docs.astral.sh/ruff/rules/verbose-decimal-constructor/">verbose-decimal-constructor (FURB157)</a> already handles it. In that case, FURB164 should convert <code>Decimal.from_float(float(&quot;nan&quot;))</code> (for example) to <code>Decimal(float(&quot;nan&quot;))</code> instead of simplifying it to <code>Decimal(&quot;nan&quot;)</code>.</p>
<h3>Version</h3>
<p>ruff 0.9.10 (0dfa810e9 2025-03-07)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-03-07 21:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @MichaReiser on 2025-03-14 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-03-14 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2025-03-14 08:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:52:19 UTC
    </footer>
</body>
</html>
