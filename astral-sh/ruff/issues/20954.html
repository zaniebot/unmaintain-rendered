<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feat: Parse `[tool.uv.workspace].members`/`.exclude` for first-party code - astral-sh/ruff #20954</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feat: Parse <code>[tool.uv.workspace].members</code>/<code>.exclude</code> for first-party code</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20954">#20954</a>
        opened by <a href="https://github.com/thejcannon">@thejcannon</a>
        on 2025-10-18 11:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thejcannon">@thejcannon</a> on 2025-10-18 11:47</div>
            <div class="timeline-body"><h3>Question</h3>
<p>This idea isn't new, I know I asked about it just about as soon as workspaces was announced, <a href="https://github.com/astral-sh/ruff/issues/16712#issuecomment-2722345752">this comment from Micha</a> mentions thinking about monorepo support, and <a href="https://github.com/astral-sh/ruff/issues/16712#issuecomment-3322734137">this comment</a> suggests specifically this.</p>
<h1>The problem</h1>
<p>If you're a very wise individual who is going &quot;all in&quot; on the Astral ecosystem, you're likely using both <code>ruff</code> and <code>uv</code>. Let's say you're a monorepo-stan so <a href="https://docs.astral.sh/uv/concepts/projects/workspaces/"><code>uv</code>'s workspace</a> call to you. You have your project set up like (somewhat arbitrarily complex for demonstration)</p>
<pre><code class="language-toml">[tool.uv.workspace]
members = [
    # Most projects belong here
    &quot;src/python/*&quot;,

    # Legacy/Infra projects
    &quot;_infra/globbinator&quot;,
    &quot;_infra/turbo-cat-wrangler&quot;,

    # Somehow Bob managed to put his project
    # in the repo root, and we're too scared to tell him to
    # move it...
    &quot;bob&quot;
]

# Not a &quot;real&quot; package, ignore it
exclude = [&quot;src/python/sandbox&quot;]
</code></pre>
<p>and you're using <code>ruff</code> to sort imports (wisdom indeed), so unfortunately for you the <a href="https://docs.astral.sh/ruff/faq/#how-does-ruff-determine-which-of-my-imports-are-first-party-third-party-etc">default heuristic</a> doesn't apply here.</p>
<p>The current workarounds have two options:</p>
<ol>
<li>mirror the workspace member globs in <code>[tool.ruff].src</code> (if they are compatible, globs can be tricky like that)</li>
<li>splat-o all over <code>[tool.ruff.lint.isort].known_first_party</code> (not great, since it is verbose, brittle, and it isn't clear it plays with the rest of <code>ruff</code> features)</li>
</ol>
<h1>The solution</h1>
<p>Have <code>ruff</code> seed <code>[tool.ruff].src</code> with <code>[tool.uv.workspace].members</code> (if it exists).</p>
<ul>
<li><code>ruff</code> is already parsing <code>pyproject.toml</code></li>
<li>It's just some simple globs</li>
<li>It would make me rejoice</li>
</ul>
<p>Like all good software features, I'm sure there's some nasty complexities hanging out under the hood, but optimistically this <em>does</em> seem kinda like an easy no-brainer üòÑ</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @thejcannon on 2025-10-18 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thejcannon">@thejcannon</a> on 2025-10-18 11:51</div>
            <div class="timeline-body"><p>(I should see if <code>ty</code> already supports <code>uv</code> workspaces, and if not I'll open an issue there, link it here, and replace this comment with the URL)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Feat: Parse `[tool.uv.workspace].members` for first-party code" to "Feat: Parse `[tool.uv.workspace].members`/`.exclude` for first-party code" by @thejcannon on 2025-10-18 11:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-20 07:24</div>
            <div class="timeline-body"><p>A better integration story between our tools is very much on our minds and I outlined (internally) a few ideas on how it could be done. Unfortunately, I was kept busy with working on other parts of ty that prevented me to make much progress on it. I hope that I can come back to it soon, once we're further along with ty.</p>
<p>In short: We probably don't want to parse any uv metadata from pyproject.tomls because any change to the schema (or how uv discovers projects) would then have to be coordinated across all our tools. Instead, a more likely outcome is to have a <code>uv metadata --version &lt;X&gt;</code> command that allows other tools (not just Astral tools but any python tool) to query metadata about a workspace and use that to enrich its configuration.</p>
<p>The benefit of this is that uv can change its project discovery or settings, for as long as it doesn't break the output of the metadata command. The metadata command can also expose more information that would be hard for ruff to compute on its own, like:</p>
<ul>
<li>The python version</li>
<li>installed dependencies</li>
<li>package layouts (and which package depend on each other)</li>
<li>...</li>
</ul>
<blockquote>
<p>(I should see if ty already supports uv workspaces, and if not I'll open an issue there, link it here, and replace this comment with the URL)</p>
</blockquote>
<p>ty doesn't support uv workspaces yet. But it's on our mind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">uv</span> added by @MichaReiser on 2025-10-20 07:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thejcannon">@thejcannon</a> on 2025-10-20 11:02</div>
            <div class="timeline-body"><p>A better answer than I was hoping for! ‚ô•Ô∏è</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-11-06 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RmStorm">@RmStorm</a> on 2025-11-19 09:21</div>
            <div class="timeline-body"><p>Hello, I also think this would be a great feature for uv/Ruff (and other tools I guess, though I'm all in on Astral hahaha).. Can this issue be kept open until the metadata feature is implemented in uv <em>and</em> Ruff correctly consumes the metadata?</p>
<p>The issue is now closed as completed but none of this is currently implemented is it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-19 09:31</div>
            <div class="timeline-body"><p>I created https://github.com/astral-sh/ruff/issues/21520</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:38:36 UTC
    </footer>
</body>
</html>
