<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 raised when type is used in Generic - astral-sh/ruff #15860</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 raised when type is used in Generic</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15860">#15860</a>
        opened by <a href="https://github.com/vovchic17">@vovchic17</a>
        on 2025-01-31 20:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vovchic17">@vovchic17</a></div>
            <div class="timeline-body">Description
Ruff version
<pre><code>ruff 0.9.4 (854ab0307 2025-01-30)
</code></pre>
Code snippet
<pre><code>from typing import TYPE_CHECKING, Generic, TypeVar
if TYPE_CHECKING:
    from asyncio.queues import Queue  # &lt;- F401 raised here

T = TypeVar(&quot;T&quot;)

class Example(Generic[T]): ...

class Derived(Example[&quot;Queue&quot;]): ...
</code></pre>
<code>ruff.toml</code> config
<pre><code>lint.select = [&quot;F401&quot;, &quot;TC004&quot;]
</code></pre>
Command I invoked
<pre><code>$ ruff check
</code></pre>
Command output
<pre><code>main.py:3:32: F401 [*] `asyncio.queues.Queue` imported but unused
  |
1 | from typing import TYPE_CHECKING, Generic, TypeVar
2 | if TYPE_CHECKING:
3 |     from asyncio.queues import Queue  # &lt;- F401 raised here
  |                                ^^^^^ F401
4 |
5 | T = TypeVar(&quot;T&quot;)
  |
  = help: Remove unused import: `asyncio.queues.Queue`

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-01-31 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-01-31 22:16</div>
            <div class="timeline-body"><p>Thanks for the report! This looks closely related to #15812, so possibly it can be fixed in a similar way by visiting subscripts in base classes as type expressions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Daverball">@Daverball</a> on 2025-01-31 23:00</div>
            <div class="timeline-body"><p>Without type inference it&#x27;s going to be difficult to significantly improve the accuracy, since there&#x27;s no way to tell if a subscript is a generic subscript without knowing the type that&#x27;s being subscripted (and whether or not that type derives from <code>Generic</code> or <code>Protocol</code>). Ruff already employs some heuristics by at least recognizing all the standard library generic types, so the most common cases should be covered.</p>
<p>Special casing base class expressions seems relatively safe though, as far as additional heuristics beyond deeper type inference/analysis go. But I&#x27;m also not fully convinced that this comes up often enough to actually warrant a special case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-01 17:05</div>
            <div class="timeline-body"><p>Thanks for the report! Closing as a duplicate of <a href="https://github.com/astral-sh/ruff/issues/9298">astral-sh/ruff#9298</a>, however. See <a href="https://github.com/astral-sh/ruff/issues/9298">astral-sh/ruff#9298</a>#issuecomment-1871157183 for a suggested fix :-)</p>
<p>@ntBre is correct that visiting subscripts in base classes as type expressions rather than value expressions would &quot;fix&quot; this, but unfortunately it wouldn&#x27;t be correct to do so -- some examples are given in <a href="https://github.com/astral-sh/ruff/issues/9298">astral-sh/ruff#9298</a>#issuecomment-1871157183 for why.</p>
<p>See also <a href="https://github.com/astral-sh/ruff/issues/13181">astral-sh/ruff#13181</a>, <a href="https://github.com/astral-sh/ruff/issues/15560">astral-sh/ruff#15560</a>, <a href="https://github.com/astral-sh/ruff/issues/12780">astral-sh/ruff#12780</a> and <a href="https://github.com/astral-sh/ruff/issues/4654">astral-sh/ruff#4654</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-01 17:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:25 UTC
    </footer>
</body>
</html>
