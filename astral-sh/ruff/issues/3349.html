<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM102 inconsistency - astral-sh/ruff #3349</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>SIM102 inconsistency</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3349">#3349</a>
        opened by <a href="https://github.com/diceroll123">@diceroll123</a>
        on 2023-03-04 22:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/diceroll123">@diceroll123</a></div>
            <div class="timeline-body"><p><em>Ruff 0.0.254</em></p>
<p><code>SIM102</code> is what merges nested if-statements together.</p>
<p>I&#x27;ve annotated each test method with whether or not they get refactored, and marked changes from <code>test1</code>&#x27;s affected line using comments and carets.</p>
<p>Do note, all 4 lint issues are marked appropriately in CLI as well as in ruff-vscode.</p>
<p>Command used: <code>ruff check . --select=SIM102 --fix --isolated</code></p>
<pre><code>import mock

fakectx = mock.Mock()
Faker = mock.Mock()
def test1() -&gt;None:
    # this one gets refactored!
    if sum([1,2,3]) &gt; 0:
        if f := Faker(fakectx.nest[str(fakectx)]).fake():
            print(f)
            return
    
    return None

def test2() -&gt;None:
    # this one gets refactored!
    if sum([1,2,3]) &gt; 0:
        if f := Faker(fakectx.nest.another[str(fakectx)]).fake():
            ######################^^^^^^^^
            print(f)
            return
    
    return None

def test3() -&gt;None:
    # this one gets refactored!
    if sum([1,2,3]) &gt; 0:
        if f := Faker(fakectx.nest[str(fakectx.nest)]).fake():
            ##################################^^^^^
            print(f)
            return
    
    return None

def test4() -&gt;None:
    # this one does not get refactored!
    if sum([1,2,3]) &gt; 0:
        if f := Faker(fakectx.nest.another[str(fakectx.nest)]).fake():
            ######################^^^^^^^^############^^^^^
            print(f)
            return
    
    return None
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/diceroll123">@diceroll123</a> on 2023-03-04 23:18</div>
            <div class="timeline-body"><p>This doesn&#x27;t affect my code anymore, because I moved the heavily-nested value into a variable since it&#x27;s used multiple times (replaced here with the sum method), but thought I&#x27;d mention that this happens.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-04 23:53</div>
            <div class="timeline-body"><p>It might be the case that the fourth example leads to an overlong line? In which case we do avoid automatically refactoring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/diceroll123">@diceroll123</a> on 2023-03-05 00:00</div>
            <div class="timeline-body"><p>Ah, interesting.</p>
<p>Also, wow! My test4 case was <em>exactly</em> the length to make it not happen! ðŸ˜† Deleted one character and it went through.</p>
<p>Thanks for clarification!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/diceroll123">@diceroll123</a> on 2023-03-05 00:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:33 UTC
    </footer>
</body>
</html>
