<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule to enforce usage of `from __future__ import annotations` when imports could be moved to type-checking block ? - astral-sh/ruff #11103</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule to enforce usage of <code>from __future__ import annotations</code> when imports could be moved to type-checking block ?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11103">#11103</a>
        opened by <a href="https://github.com/Greesb">@Greesb</a>
        on 2024-04-23 10:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Greesb">@Greesb</a></div>
            <div class="timeline-body"><p>Hello wonderful developers !</p>
<p>I was wondering if it would be possible to implement a rule to raise an error when an import could be moved to a type-checking block if <code>from __future__ import annotations</code> was used ?</p>
<p>Here's a really sparse example:</p>
<pre><code class="language-python">import datetime

def printme(d: datetime.datetime) -&gt; None:
    print(d.isoformat())
</code></pre>
<p>Here, <code>TCH003</code> doesn't say anything because <code>datetime</code> is used for typing.
But if we add <code>from __future__ import annotations</code> then the <code>TCH003</code> rule triggers and says that <code>datetime</code> import should be moved to a type-checking block.</p>
<p>What do you think ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "New rule to enforce usage of `from __future__ import annotations` when imports could be moved to type-checking block ?" to "Rule to enforce usage of `from __future__ import annotations` when imports could be moved to type-checking block ?" by @Greesb on 2024-04-23 10:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-23 10:31</div>
            <div class="timeline-body"><p>Hi! I think you can do this by enabling our <a href="https://docs.astral.sh/ruff/rules/missing-required-import/">I002 rule</a>, and using this setting in your <code>pyproject.toml</code> file:</p>
<pre><code class="language-toml">[tool.ruff.lint.isort]
required-imports = [&quot;from __future__ import annotations&quot;]
</code></pre>
<p>You also might find our <a href="https://docs.astral.sh/ruff/rules/#flake8-future-annotations-fa"><code>flake8-future-annotations</code> rules</a> useful.</p>
<p>Do either/both of those work for you? :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Greesb">@Greesb</a> on 2024-04-23 10:38</div>
            <div class="timeline-body"><p>Might work as a hack yeah, but then we'll have those imports on file when it might not be needed. And it'll require a lot of ignores, because of imports inside custom types used only for pydantic or sqlalchemy validation for example, which still need to be imported at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-23 13:10</div>
            <div class="timeline-body"><blockquote>
<p>And it'll require a lot of ignores, because of imports inside custom types used only for pydantic or sqlalchemy validation for example, which still need to be imported at runtime.</p>
</blockquote>
<p>Adding the <code>from __future__ import annotations</code> on its own will not cause problems here -- you'd only experience issues if you then moved imports into the type-checking block that were needed in such cases. We do have automated rules for that (https://docs.astral.sh/ruff/rules/#flake8-type-checking-tch), and have settings to mark modules like Pydantic that need to be available at runtime:</p>
<ul>
<li>https://docs.astral.sh/ruff/settings/#lint_flake8-type-checking_runtime-evaluated-base-classes</li>
<li>https://docs.astral.sh/ruff/settings/#lint_flake8-type-checking_runtime-evaluated-decorators</li>
</ul>
<p>So I think <code>required-imports = [&quot;from __future__ import annotations&quot;]</code> and the flake8-type-checking rules do what you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-23 13:11</div>
            <div class="timeline-body"><p>You can also just use the flake8-type-checking rules with <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-type-checking_quote-annotations"><code>quote-annotations</code></a>, and the usages will be quoted to allow imports to be moved into type-checking blocks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Greesb">@Greesb</a> on 2024-04-23 16:04</div>
            <div class="timeline-body"><p>Managed to get something working with your recommendations, thank you !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Greesb on 2024-04-23 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-23 16:04</div>
            <div class="timeline-body"><p>Sweet, thanks for following up.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:09 UTC
    </footer>
</body>
</html>
