<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support `__builtins__.pyi` mechanism to provide additional builtins - astral-sh/ruff #8852</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support <code>__builtins__.pyi</code> mechanism to provide additional builtins</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8852">#8852</a>
        opened by <a href="https://github.com/hassec">@hassec</a>
        on 2023-11-27 14:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hassec">@hassec</a> on 2023-11-27 14:21</div>
            <div class="timeline-body"><p>Sometimes one has to work in a python environment that exposes additional builtins.
In pyright on can provide such information via a <code>__builtins__.pyi</code> file, <a href="https://github.com/microsoft/pyright/blob/main/docs/builtins.md">see their docs</a></p>
<p>I was wondering what you would think about enabling ruff be able to read such a file too and then e.g. not throw an undefined name error for these special builtins?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-27 15:30</div>
            <div class="timeline-body"><p>This seems reasonable but I'm unsure of the performance cost and feasibility with our current setup cc @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-27 16:57</div>
            <div class="timeline-body"><p>We do support defining addition builtins via the <a href="https://docs.astral.sh/ruff/settings/#builtins"><code>builtins</code></a> setting which is also consistent with Flake8. Does that help here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hassec">@hassec</a> on 2023-11-27 17:32</div>
            <div class="timeline-body"><p>Thanks @charliermarsh, I currently use that option, but it requires that I keep that list in sync with the <code>__builtins__.pyi</code> and if there is a long list of additional builtins, it clutters the <code>pyproject.toml</code> file quite a bit.</p>
<p>For the specific project I'm working on, the <code>__builtins__.pyi</code> is something that is generated, being able to not worry about having the two settings in sync would be nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-11-28 22:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cpbotha">@cpbotha</a> on 2024-10-04 07:42</div>
            <div class="timeline-body"><p>Just FYI, below is an example <code>__builtins__.pyi</code> supplied by the Databricks VSCode extension to facilitate local development of Databricks. Note that the built-in values are also typed (with types being imported) so that one gets autocomplete in the IDE.</p>
<p>I am able to re-add the globals to the ruff <code>builtins</code> and it seems reasonably happy. It would of course be much more convenient if ruff could somehow extract and apply the list of globals from the same file.</p>
<pre><code class="language-python"># Typings for Pylance in Visual Studio Code
# see https://github.com/microsoft/pyright/blob/main/docs/builtins.md
from databricks.sdk.runtime import *

from databricks.sdk.runtime import *
from pyspark.sql.session import SparkSession
from pyspark.sql.functions import udf as U
from pyspark.sql.context import SQLContext

udf = U
spark: SparkSession
sc = spark.sparkContext
sqlContext: SQLContext
sql = sqlContext.sql
table = sqlContext.table
getArgument = dbutils.widgets.getArgument

def displayHTML(html): ...

def display(input=None, *args, **kwargs): ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 08:11</div>
            <div class="timeline-body"><p>Our work on red-knot (type checker) builds the foundation to support this in the future.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:32:05 UTC
    </footer>
</body>
</html>
