<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`SIM101` lint and fix is sometimes incorrect - astral-sh/ruff #7964</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>SIM101</code> lint and fix is sometimes incorrect</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7964">#7964</a>
        opened by <a href="https://github.com/Zac-HD">@Zac-HD</a>
        on 2023-10-15 12:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Zac-HD">@Zac-HD</a></div>
            <div class="timeline-body"><p>The <code>SIM101</code> rule suggests replacing <code>isinstance(a. b) or isinstance(a, c)</code> with <code>isinstance(a, (b, c))</code> - but the lint and autofix also trigger when there is an intermediate term in the <code>or</code>-expression.  This is a problem because code can (and does) rely on short-circuiting evaluation in some such cases.  For example, <code>ruff --isolated --select=SIM101 --fix demo.py</code> will break:</p>
<pre><code>x = isinstance(&quot;&quot;, int) or True or isinstance(&quot;&quot;, undefined_name)
# x = isinstance(&quot;&quot;, (int, undefined_name)) or True  # incorrect fix!
</code></pre>
<p>I found this while experimenting with <code>ruff</code> in <code>shed</code>, which <a href="https://github.com/Zac-HD/shed/blob/6bc10985fc2e22f5bd95539e388ca75b3c3da363/src/shed/_codemods.py#L459-L474">has a similar fixer</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-15 15:58</div>
            <div class="timeline-body"><p>Hey, thanks for the issue! This fix as marked unsafe and will not be applied by default in the upcoming release. See #7901 and #7769 for details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-15 15:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Zac-HD">@Zac-HD</a> on 2023-10-17 13:43</div>
            <div class="timeline-body"><p>Actual fix was in <a href="https://github.com/astral-sh/ruff/pull/7798">astral-sh/ruff#7798</a> ðŸ™‚</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:43 UTC
    </footer>
</body>
</html>
