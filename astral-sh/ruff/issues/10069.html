<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF009 triggers for intentional constant computation - astral-sh/ruff #10069</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF009 triggers for intentional constant computation</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10069">#10069</a>
        opened by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a>
        on 2024-02-21 10:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a> on 2024-02-21 10:00</div>
            <div class="timeline-body"><p>https://play.ruff.rs/aa67fe33-c09c-4a7f-91fc-5fe9b5b98425</p>
<p>in pytest i replaced a magic constant with its more comprehensible computation</p>
<pre><code># minimized reducers
import datetime
import dataclasses

@dataclasses.dataclass
class MockTiming:
   
    _current_time: float = datetime(2020, 5, 22, 14, 20, 50).timestamp()
    _current_time_before: float = 1590150050.0
</code></pre>
<p>i recon that its possibly hard to sanely filter false positives
i do wonder if given type annotation awareness it could permit in case the value is a builtin immutable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-22 16:32</div>
            <div class="timeline-body"><p>Yeah, it might be possible but it isn't sufficient to only test if the result type is immutable, ruff would also need to know if the function is idempotent (does not depend on any global or system state) as well as all arguments passed to the call.</p>
<p>I understand that the result here is undesired but getting this right requires more analysis than ruff is capable today. I recommend manually suppressing the rule for this case and documenting why it is safe (documenting this might also help future readers).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-22 16:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
