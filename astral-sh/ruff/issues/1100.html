<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[bug] per-file-ignores don't always work - astral-sh/ruff #1100</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[bug] per-file-ignores don&#x27;t always work</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1100">#1100</a>
        opened by <a href="https://github.com/smackesey">@smackesey</a>
        on 2022-12-06 03:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/smackesey">@smackesey</a></div>
            <div class="timeline-body"><p>We have this in our config:</p>
<pre><code>### pyproject.toml

# ...

[tool.ruff.per-file-ignores]

&quot;examples/docs_snippets/*&quot; = [

  # (local variable assigned but never used): This happens a lot in the docs snippets for didactic
  # purposes.
  &quot;F841&quot;,
]
</code></pre>
<p>If I run from the root:</p>
<pre><code>$ ruff --config=pyproject.toml `git ls-files &#x27;examples/docs_snippets/*.py&#x27;`
</code></pre>
<p>ruff does not respect the <code>F841</code> ignore in <code>docs_snippets</code>.</p>
<p>But if I change it to:</p>
<pre><code>$ ruff --config=pyproject.toml `git ls-files &#x27;examples/*.py&#x27;`
</code></pre>
<p>Then ruff <em>does</em> respect the <code>F841</code> ignore for <code>docs_snippets</code>.</p>
<p>This may have something to do with the fact that there is another <code>pyproject.toml</code> at <code>examples/docs_snippets/pyproject.toml</code>, but I don&#x27;t think that should matter given that I explicitly set the config in the CLI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-06 03:26</div>
            <div class="timeline-body"><p>Taking a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-06 03:43</div>
            <div class="timeline-body"><p>The problem here is that we have two concepts: the <code>pyproject.toml</code>, and the project root. We use the presence of <code>pyproject.toml</code> files to infer the project root (along with <code>.git</code> and <code>.hg</code> directories -- I believe this logic came from Black).</p>
<p>So in the above case, we first find the project root at <code>examples/doc_snippets</code> (due to the presence of a <code>pyproject.toml</code>). Then we load the <code>--config=pyproject.toml</code>, and use <em>that</em> for configuration. But the paths (like <code>&quot;examples/docs_snippets/*&quot;</code>) are relative to the project root, so it&#x27;s really ignoring <code>&quot;examples/docs_snippets/examples/docs_snippets/*&quot;</code>.</p>
<p>We should probably set the project root to the directory containing the <code>pyproject.toml</code>, if a file is explicitly provided. This might lead to some confusing cases, it&#x27;s honestly hard to think through which is a testament to the complexity of the current model (which I&#x27;m hoping to repo based on some of the other discussions we&#x27;ve had).</p>
<p>Another option is to provide a <code>--root</code> command-line argument, similar to <code>--config</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-06 03:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-06 04:00</div>
            <div class="timeline-body"><p>https://github.com/charliermarsh/ruff/pull/1101 should fix this for you -- I just tested with the same setup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-06 04:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-06 04:42</div>
            <div class="timeline-body"><p>This is going out in <a href="https://github.com/charliermarsh/ruff/releases/tag/v0.0.164">v0.0.164</a> (building now).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:28 UTC
    </footer>
</body>
</html>
