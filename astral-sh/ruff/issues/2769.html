<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow `pyproject.toml` discovery to be disabled for subdirectories - astral-sh/ruff #2769</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow `pyproject.toml` discovery to be disabled for subdirectories</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2769">#2769</a>
        opened by <a href="https://github.com/isaacharrisholt">@isaacharrisholt</a>
        on 2023-02-11 16:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/isaacharrisholt">@isaacharrisholt</a> on 2023-02-11 16:28</div>
            <div class="timeline-body"><h2>Context</h2>
<p>I'm working on a project templating tool in Python, using Ruff for linting (love it, by the way!). It's using a <code>pyproject.toml</code> file for config, as I'm using Poetry for environment management.</p>
<p>I'm storing the templates in the same directory as the tool, and one of those templates is a generic Poetry project template with some pre-commit hooks and tooling set up. This, of course, uses Ruff and includes a <code>pyproject.toml</code> file with Ruff config.</p>
<h2>My dilemma</h2>
<p>Essentially, every time I run Ruff in the root of the project, two <code>.ruff_cache</code> directories are created - one in the root, and one in the directory where the Poetry project template lies. This isn't ideal, as this template then includes a <code>.ruff_cache</code> directory, which gets copied into new projects when the tool is run.</p>
<p>My current workaround is to exclude <code>.ruff_cache</code> directories from the Poetry build, but it would be nice to have a way to prevent the hierarchical behaviour in subdirectories so that this doesn't happen. I'm aware that there are other ways of solving my problem, but having 'default' <code>pyproject.toml</code> files is not an uncommon thing, so it would be nice to see a solution implemented in Ruff, if possible.</p>
<h2>The solution</h2>
<p>I'm not familiar with the Ruff source code, so I can't suggest a technical solution, but my suggestion would be something along the lines of adding the following config option to the <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.ruff]
disable_pyproject_discovery = true
</code></pre>
<p>This would disable <code>pyproject.toml</code> discovery only in subdirectories of this <code>pyproject.toml</code> which would allow people to disable the feature in specific parts of their application, if they so desire.</p>
<p>Let me know what you think!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-02-11 16:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-12 03:12</div>
            <div class="timeline-body"><p>Doesn't <code>extend-exclude = [&quot;templates/&quot;]</code> work? (assuming your directory is called <code>templates/</code>) ... if this doesn't work I think we should make it work rather than introducing yet another config option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/isaacharrisholt">@isaacharrisholt</a> on 2023-02-12 07:33</div>
            <div class="timeline-body"><p>Technically yes, but then I don't get linting in my templates! The package I'm writing allows arbitrary Python to be run upon rendering the template, and that Python is kept in the template directory. It would be great if that (and other Python in the directory) was linted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-12 07:38</div>
            <div class="timeline-body"><p>Ah ... in that case I think it would be better if you'd just rename those template files e.g. <code>pyproject.toml.template</code> or  <code>pyproject.toml.jinja2</code>. Or alternatively you could move these <code>pyproject.toml</code> files to a subdirectory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/isaacharrisholt">@isaacharrisholt</a> on 2023-02-12 07:42</div>
            <div class="timeline-body"><p>That makes sense, and I do understand that I have a very niche problem, but I can't imagine I'm the only person who would want to disable the default behaviour here?</p>
<p>Happy to close this issue if you disagree!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-12 07:54</div>
            <div class="timeline-body"><p>With this setting <code>ruff</code> would still use the <code>pyproject.toml</code> files when <code>ruff</code> was invoked in the subdirectory containing the file ... this might be a bit confusing.</p>
<p>If renaming the file works well for you, then I'd personally rather have us refrain from introducing yet another setting since every setting we add makes ruff more complex and also increases the mental load when deciding which settings to use.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/isaacharrisholt">@isaacharrisholt</a> on 2023-02-12 10:26</div>
            <div class="timeline-body"><p>No worries! I've got a workaround anyway, I just figured that not everyone will want automatic <code>pyproject.toml</code> discovery, and may prefer to have it disabled in part of their project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @isaacharrisholt on 2023-02-12 10:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-12 10:44</div>
            <div class="timeline-body"><p>If other people end up wanting the same feature, we can always reconsider this :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:05 UTC
    </footer>
</body>
</html>
