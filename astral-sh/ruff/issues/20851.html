<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`is_mutable_expr` causes false negatives in B039, RUF008, RUF012, and RUF024 - astral-sh/ruff #20851</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>is_mutable_expr</code> causes false negatives in B039, RUF008, RUF012, and RUF024</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20851">#20851</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-10-13 20:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The same issue as in #20004 affects <a href="https://docs.astral.sh/ruff/rules/mutable-contextvar-default/"><code>mutable-contextvar-default</code> (B039)</a>, <a href="https://docs.astral.sh/ruff/rules/mutable-dataclass-default/"><code>mutable-dataclass-default</code> (RUF008)</a>, <a href="https://docs.astral.sh/ruff/rules/mutable-class-default/"><code>mutable-class-default</code> (RUF012)</a>, and <a href="https://docs.astral.sh/ruff/rules/mutable-fromkeys-value/"><code>mutable-fromkeys-value</code> (RUF024)</a>. The extra cases in <code>is_guaranteed_mutable_expr</code> should be merged into <code>is_mutable_expr</code>. <a href="https://play.ruff.rs/711a14ce-bcbf-4d7d-8a98-49bafc373d99">Examples</a>:</p>
<pre><code class="language-python">from contextvars import ContextVar
ContextVar(&quot;cv&quot;, default=(x for x in &quot;cv&quot;))

from dataclasses import dataclass
@dataclass
class D:
    x: list[int] | object = ([],)

class C:
    x: list[object] = (x := [])
    y = (y := [])

dict.fromkeys([&quot;A&quot;, &quot;B&quot;], ([],))
</code></pre>
<h3>Version</h3>
<p>ruff 0.14.0 (beea8cdfe 2025-10-07)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-10-15 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @ntBre on 2025-10-15 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-10-15 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-15 14:26</div>
            <div class="timeline-body"><p>It looks like  these are all stable rules, so we'll need to make these preview changes like in https://github.com/astral-sh/ruff/pull/20024.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-10-15 14:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:27 UTC
    </footer>
</body>
</html>
