```yaml
number: 4090
title: B023 potential false positive (with shadowed variable names)
type: issue
state: closed
author: XN137
labels:
  - bug
assignees: []
created_at: 2023-04-25T08:33:13Z
updated_at: 2023-05-02T08:32:58Z
url: https://github.com/astral-sh/ruff/issues/4090
synced_at: 2026-01-10T01:56:47Z
```

# B023 potential false positive (with shadowed variable names)

---

_Issue opened by @XN137 on 2023-04-25 08:33_

python code:

```
lambdas = []
for val in range(3):
    lambdas.append(lambda val=val: print(val))

for lam in lambdas:
    lam()

funcs = []
for val in range(3):
    def make_func(val):
        def tmp():
            return print(val)

        return tmp


    funcs.append(make_func(val))

for func in funcs:
    func()

funcs = []
for val in range(3):
    def make_func(val=val):
        def tmp():
            return print(val)

        return tmp


    funcs.append(make_func())

for func in funcs:
    func()
```

outputs:
```
0
1
2
0
1
2
0
1
2
```

but ruff `0.0.263` reports B023 violations for the `make_func` variants (because the `val` variable is shadowed):
```
falsepositive.py:
  12:26 B023 Function definition does not bind loop variable `val`

  26:26 B023 Function definition does not bind loop variable `val`
```

note that the last `make_func` variant might be a common pattern in python codebases, see https://stackoverflow.com/a/3431699

---

_Label `bug` added by @charliermarsh on 2023-04-25 15:15_

---

_Comment by @charliermarsh on 2023-04-26 00:18_

Agree, does look like a bug. We probably don't have proper scope tracking there.

---

_Referenced in [astral-sh/ruff#4111](../../astral-sh/ruff/pulls/4111.md) on 2023-04-26 04:44_

---

_Closed by @MichaReiser on 2023-04-26 21:01_

---

_Comment by @XN137 on 2023-05-02 08:32_

just to confirm: after upgrading to `0.0.264` we could enable `B023` across our codebase without violations, thanks a lot for the quick fix!

---
