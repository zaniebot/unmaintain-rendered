```yaml
number: 12984
title: "Third-party namespace packages can be incorrectly considered first-party packages by `isort` rules"
type: issue
state: closed
author: tehkirill
labels:
  - isort
assignees: []
created_at: 2024-08-19T09:32:31Z
updated_at: 2025-05-05T16:40:02Z
url: https://github.com/astral-sh/ruff/issues/12984
synced_at: 2026-01-10T01:56:53Z
```

# Third-party namespace packages can be incorrectly considered first-party packages by `isort` rules

---

_Issue opened by @tehkirill on 2024-08-19 09:32_

Hi, team. Thanks for your hard work.

I noticed a change in how known-first-party imports get classified recently.
If I'm working on `my_namespace.a` project, I expect `my_namespace.b` to be classified as a Known(ThirdParty) (so does `isort`). This was the case with ruff as well, up until version 0.5.7 .

Working on `my_namespace.a` project, with the following stucture:
```
ruff-namespace-src-imports-test/
  ├─ main.py
  ├─ ruff.toml
  └─ src/
     └─ my_namespace/
        └─ a/
           └─ ...
```

``` toml
# ruff.toml
[lint.isort]
known-first-party = ["my_namespace.a"]
```

``` python
# main.py
import os

import my_namespace.b
import numpy

import my_namespace.a
```
^ I see it as a valid import order, so does v0.5.6:
```
$ python3.12 -m ruff check main.py --select I --diff -v
[2024-08-19][11:11:40][ruff::resolve][DEBUG] Using configuration file (via parent) at: C:\ruff-namespace-src-imports-test\ruff.toml
[2024-08-19][11:11:40][ruff_workspace::pyproject][DEBUG] `project.requires_python` in `pyproject.toml` will not be used to set `target_version` when using `ruff.toml`.
[2024-08-19][11:11:40][ruff::commands::check][DEBUG] Identified files to lint in: 4.5661ms
[2024-08-19][11:11:40][ruff::diagnostics][DEBUG] Checking: C:\ruff-namespace-src-imports-test\main.py
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.a' as Known(FirstParty) (KnownFirstParty)
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.b' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'numpy' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:11:40][ruff::commands::check][DEBUG] Checked 1 files in: 2.7995ms
```

But 0.5.7+ (including the latest 0.6.1) sees otherwise:
```
$ python3.12 -m ruff check main.py --select I --diff -v
[2024-08-19][11:12:44][ruff::resolve][DEBUG] Using configuration file (via parent) at: C:\ruff-namespace-src-imports-test\ruff.toml
[2024-08-19][11:12:44][ruff_workspace::pyproject][DEBUG] `project.requires_python` in `pyproject.toml` will not be used to set `target_version` when using `ruff.toml`.
[2024-08-19][11:12:44][ruff::commands::check][DEBUG] Identified files to lint in: 4.8756ms
[2024-08-19][11:12:44][ruff::diagnostics][DEBUG] Checking: C:\ruff-namespace-src-imports-test\main.py
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.a' as Known(FirstParty) (KnownFirstParty)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.b' as Known(FirstParty) (SourceMatch("C:\\ruff-namespace-src-imports-test\\src"))
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'numpy' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.b' as Known(FirstParty) (SourceMatch("C:\\ruff-namespace-src-imports-test\\src"))
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'numpy' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.a' as Known(FirstParty) (KnownFirstParty)
--- main.py
+++ main.py
@@ -1,6 +1,6 @@
 import os

-import my_namespace.b
 import numpy

 import my_namespace.a
+import my_namespace.b

[2024-08-19][11:12:44][ruff::commands::check][DEBUG] Checked 1 files in: 2.8168ms
Would fix 1 error.
```
Removing `src/my_namespace` correctly classifies `my_namespace.b` as known-third-party again.


---

_Label `question` added by @MichaReiser on 2024-08-19 10:07_

---

_Comment by @MichaReiser on 2024-08-19 10:09_

Hi @tehkirill 

This behavior changed with Ruff 0.6 where the directory `src` is now included in the [`src`](https://docs.astral.sh/ruff/settings/#src) setting. You can get back the old behavior by setting `src = ["."]` which was the default until Ruff 0.6.

You can read more about it in [our blog post](https://astral.sh/blog/ruff-v0.6.0#migrating-to-v06). 

---

_Comment by @tehkirill on 2024-08-19 10:48_

Thanks for the prompt response and linking to where it was documented, @MichaReiser 
In my case - I _am_ using `src/` layout - don't think I should exclude it to make this work.


The way it's implemented at the moment makes sense for projects without namespaces, eg `./src/requests` from [requests repo](https://github.com/psf/requests).

It does, however, incorrectly identifies a third-party import under the same namespace as first-party, e.g. using an example from [packaging.python.org](https://packaging.python.org/en/latest/guides/packaging-namespace-packages/):
```
mynamespace-subpackage-a/
    pyproject.toml
    src/
        mynamespace/
            subpackage_a/
                __init__.py

mynamespace-subpackage-b/
    pyproject.toml
    src/
        mynamespace/
            subpackage_b/
                __init__.py
            module_b.py
```
When working on `mynamespace-subpackage-a`, `mynamespace-subpackage-b` would be identified as first-party (in fact, anything starting with `mynamespace.` would), I don't think it's an expected behaviour.

---

_Label `isort` added by @AlexWaygood on 2024-08-19 11:05_

---

_Comment by @AlexWaygood on 2024-08-19 11:10_

> When working on `mynamespace-subpackage-a`, `mynamespace-subpackage-b` would be identified as first-party (in fact, anything starting with `mynamespace.` would), I don't think it's an expected behaviour.

That's an interesting edge case! This seems to me to be a general issue with the way our `isort` rules detect first-party packages when it comes to namespace packages, that has been exposed in your project by the recent change to `isort`'s configuration defaults, rather than an issue with the change in defaults itself.

---

_Label `question` removed by @AlexWaygood on 2024-08-19 11:10_

---

_Renamed from "Having src/my_namespace/a changes my_namespace.b from known-third-party to known-first-party" to "Third-party namespace packages can be incorrectly considered first-party packages by `isort` rules" by @AlexWaygood on 2024-08-19 11:11_

---

_Assigned to @AlexWaygood by @AlexWaygood on 2024-08-19 12:19_

---

_Referenced in [astral-sh/ruff#12987](../../astral-sh/ruff/pulls/12987.md) on 2024-08-19 12:20_

---

_Referenced in [pypa/pip#12937](../../pypa/pip/pulls/12937.md) on 2024-08-24 20:32_

---

_Comment by @smartYSC on 2024-11-06 10:14_

I ran into the same problem recently but thought I was just too stupid to find the right settings combination. I opened a discussion about it here: https://github.com/astral-sh/ruff/discussions/12038

We did not find a solution back then and I went on to other tasks. Now I revisted this and found this issue.

I built `ruff` from the linked PR https://github.com/astral-sh/ruff/pull/12987 and this indeed fixes the issue!

We now need to have this merged...


---

_Unassigned @AlexWaygood by @AlexWaygood on 2025-03-17 12:49_

---

_Referenced in [astral-sh/ruff#16565](../../astral-sh/ruff/pulls/16565.md) on 2025-03-27 21:46_

---

_Closed by @dylwil3 on 2025-05-05 16:40_

---

_Closed by @dylwil3 on 2025-05-05 16:40_

---

_Referenced in [astral-sh/ruff#20453](../../astral-sh/ruff/issues/20453.md) on 2025-09-17 21:14_

---
