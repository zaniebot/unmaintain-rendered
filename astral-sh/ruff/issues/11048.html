<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>raw pathlib.Path truthyness checking - astral-sh/ruff #11048</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>raw pathlib.Path truthyness checking</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11048">#11048</a>
        opened by <a href="https://github.com/hairmare">@hairmare</a>
        on 2024-04-19 20:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hairmare">@hairmare</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>As a strong proponent of <code>ALL</code> my colleague and I have recently stumbled over <a href="https://docs.astral.sh/ruff/rules/#flake8-use-pathlib-pth">PTH</a> (flake8-use-pathlib)</p>
<p>Specifically in an effort to replace <code>os.path</code> we ended up doing this by accident</p>
<pre><code class="language-python">from pathlib import Path
if Path(&quot;does-not-exists&quot;):
    ...
</code></pre>
<p>We forgot to <code>Path(...).exists()</code>, it should have been this:</p>
<pre><code class="language-python">from pathlib import Path
if Path(&quot;does-not-exists&quot;).exists():
    ...
</code></pre>
<p>Given this happened in the context of an <code>if</code> clause.  Is ensuring that noone tries to check a bare <code>Path</code> for truthiness a check that could/should be introduced?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-04-19 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-19 21:51</div>
            <div class="timeline-body"><p>That seems like a reasonable rule to me, though not sure how best to categorize it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-21 11:25</div>
            <div class="timeline-body"><p>I'm not sure if this rule is too specific. What about other types that are used to check for truthiness?</p>
<p>Should we make the rule more generic so that it warns about all types that don't implement <code>__bool__</code> and aren't well known types (e.g. list, primitives etc) and are used in a thruthiness check?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trim21">@trim21</a> on 2024-04-22 08:52</div>
            <div class="timeline-body"><blockquote>
<p>I'm not sure if this rule is too specific. What about other types that are used to check for truthiness?</p>
<p>Should we make the rule more generic so that it warns about all types that don't implement <code>__bool__</code> and aren't well known types (e.g. list, primitives etc) and are used in a thruthiness check?</p>
</blockquote>
<p>I have another case for this...</p>
<pre><code class="language-python">import xml.etree.ElementTree

et: xml.etree.ElementTree.Element = xml.etree.ElementTree.fromstring(
    &quot;&quot;&quot;
&lt;rss version=&quot;2.0&quot;&gt;
&lt;channel&gt;
&lt;title&gt;title&lt;/title&gt;
&lt;link&gt;
&lt;![CDATA[ https://example.com ]]&gt;
&lt;/link&gt;
&lt;pubDate&gt;Mon, 22 Apr 2024 16:50:40 +0800&lt;/pubDate&gt;
&lt;item&gt;
&lt;title&gt;
&lt;![CDATA[ a title ]]&gt;
&lt;/title&gt;
&lt;link&gt;https://exmaple.com/not-expected-url&lt;/link&gt;
&lt;enclosure url=&quot;https://example.com/expected-url&quot; length=&quot;16306828171&quot; type=&quot;application/x-bittorrent&quot;/&gt;
&lt;guid isPermaLink=&quot;false&quot;&gt;guid&lt;/guid&gt;
&lt;/item&gt;
&lt;/channel&gt;
&lt;/rss&gt;
&quot;&quot;&quot;
)

raw = []

for item in et.findall(&quot;channel/item&quot;):
    enclosure = item.find(&quot;./enclosure&quot;)
    # gotcha !
    # need to use `enclosure is not None`
    if enclosure:
        url = enclosure.attrib.get(&quot;url&quot;)
    else:
        # torrentleech
        url = item.findtext(&quot;./link&quot;)

    print(url)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hairmare">@hairmare</a> on 2024-04-23 19:48</div>
            <div class="timeline-body"><p>A general <code>__bool__</code>  check does sound like an interesting approach worth further exploring and would help uncovering the error we initially encountered.</p>
<p>The etree example wouldn't be covered by a rule generalized in this way given the <code>Element</code> returned from a <code>find</code> lookup does implement <code>__bool__</code>. In most XML use cases, i usually recommend ensuring the data can be trusted by doing previous validation using XML tooling like XML Schema Definitions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-10-29 14:25</div>
            <div class="timeline-body"><p>I could not find any real-world examples of the initial example (that does not require type information). I'd suggest adding the type-inference label to the issue for the generic case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @MichaReiser on 2024-10-29 15:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:07 UTC
    </footer>
</body>
</html>
