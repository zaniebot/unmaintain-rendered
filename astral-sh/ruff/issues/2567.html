<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F523 No longer works if *args is present - astral-sh/ruff #2567</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F523 No longer works if *args is present</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2567">#2567</a>
        opened by <a href="https://github.com/colin99d">@colin99d</a>
        on 2023-02-04 14:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/colin99d">@colin99d</a> on 2023-02-04 14:49</div>
            <div class="timeline-body"><p>The following code triggers F523:
<code>&quot;{0}&quot;.format(1, 2)</code></p>
<p>However, the code below does not:
<code>&quot;{0}&quot;.format(1, 2, *args)</code></p>
<p>This seems incorrect to me, because both function perform the same operation:</p>
<pre><code>&gt;&gt;&gt; args = [1, 2, 3]
&gt;&gt;&gt; &quot;{0}&quot;.format(1, 2)
'1'
&gt;&gt;&gt; &quot;{0}&quot;.format(1, 2, *args)
'1'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-02-05 23:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-04 10:39</div>
            <div class="timeline-body"><p>When a starred argument is present, it's difficult to determine whether the number of arguments is equal to the number of placeholders. The reason being that <code>*args</code> can expand into unknown number of elements at runtime and we cannot know it statically.</p>
<p>One solution could be to parallelly process both the placeholder and format argument one after the other and stop at starred argument or the last placeholder, whichever comes first. If we encounter the starred argument first, then we know that at least all the previous positional arguments are correct. On the other hand, if there are no placeholders remaining but we have <em>positional arguments</em>, those will be reported. Note that here the starred argument will also be reported.</p>
<p><em><strong>Example:</strong></em></p>
<pre><code class="language-python">&quot;{0} {1}&quot;.format(a, *args)  # All good here

&quot;{0} {1}&quot;.format(a, b, *args)
#                      ^^^^^

&quot;{0} {1}&quot;.format(a, b, c, *args)
#                      ^  ^^^^^
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-04 16:57</div>
            <div class="timeline-body"><p>Yeah, I <em>think</em> we can only flag when the number of non-starred position arguments is greater than the number of placeholders.</p>
<p>The debatable case is <code>&quot;{0} {1}&quot;.format(a, b, *args)</code>... Here, this <em>could</em> work if <code>*args</code> is an empty tuple, I think. But it's obviously a bit strange.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-04 18:03</div>
            <div class="timeline-body"><blockquote>
<p>The debatable case is <code>&quot;{0} {1}&quot;.format(a, b, *args)</code>... Here, this <em>could</em> work if <code>*args</code> is an empty tuple, I think. But it's obviously a bit strange.</p>
</blockquote>
<p>I'm not sure how is this debatable as we've got 2 placeholders where <code>a</code> and <code>b</code> will go and thus <code>*args</code> is unused.</p>
<p>There's a special case where we should ignore - when there's only a single starred argument - but I suppose this would satisfy the logic where <code>{0}</code> is mapped to <code>*args</code> and this rule is not about <em>unused placeholders</em>.</p>
<pre><code class="language-python">&quot;{0} {1}&quot;.format(*args)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-04 19:44</div>
            <div class="timeline-body"><p>Sorry, you're right. What I was trying to point out was that <code>args</code> <em>can</em> be an empty tuple, but it'd be strange not to flag in that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-07 18:03</div>
            <div class="timeline-body"><p>Yes, I do think that we should be flagging it. The variable is being unused which is what the rule is about. The contents of the variable doesn't matter as it's not used in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-07 18:14</div>
            <div class="timeline-body"><p>Agreed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-08 20:03</div>
            <div class="timeline-body"><p>Well, Python raises an error if the <code>*args</code> unpacks to nothing. So, then should we skip checking the <code>*args</code> argument and instead just check all the other positional arguments irrespective of whether <code>*args</code> is present or not.</p>
<pre><code class="language-python">args = []

&quot;{0}{1}&quot;.format(1, *args)
# ---------------------------------------------------------------------------
# IndexError                                Traceback (most recent call last)
# Cell In [2], line 1
# ----&gt; 1 &quot;{0}{1}&quot;.format(1, *args)
#
# IndexError: Replacement index 1 out of range for positional args tuple

args.append(2)

&quot;{0}{1}&quot;.format(1, *args)
# '12'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-09 06:10</div>
            <div class="timeline-body"><blockquote>
<p><em><strong>Example:</strong></em></p>
<pre><code class="language-python">&quot;{0} {1}&quot;.format(a, *args)  # All good here

&quot;{0} {1}&quot;.format(a, b, *args)
#                      ^^^^^

&quot;{0} {1}&quot;.format(a, b, c, *args)
#                      ^  ^^^^^
</code></pre>
</blockquote>
<p><code>mypy</code> only triggers for the third example, so I guess it skips checking the <code>*args</code> argument as well.</p>
<blockquote>
<p>mypy: Not all arguments converted during string formatting</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3923.html">astral-sh/ruff#3923</a> on 2023-04-09 06:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-04-09 22:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
