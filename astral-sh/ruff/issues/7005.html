<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isort custom sections in a monorepo - astral-sh/ruff #7005</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>isort custom sections in a monorepo</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/7005">#7005</a>
        opened by <a href="https://github.com/jaap3">@jaap3</a>
        on 2023-08-30 11:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jaap3">@jaap3</a> on 2023-08-30 11:43</div>
            <div class="timeline-body"><p>I'm running into the following using <code>ruff 0.0.286</code> in a monorepo.</p>
<p>In the &quot;root&quot; configuration I define a custom section for the monorepo packages:</p>
<pre><code class="language-toml">[tool.ruff.isort]
lines-between-types = 1
section-order = [
  &quot;future&quot;,
  &quot;standard-library&quot;,
  &quot;third-party&quot;,
  &quot;monorepo&quot;,
  &quot;first-party&quot;,
  &quot;local-folder&quot;,
]

[tool.ruff.isort.sections]
monorepo = [
  &quot;my_bar&quot;,
  &quot;my_baz&quot;,
  &quot;my_foo&quot;,
  &quot;my_qux&quot;,
]
</code></pre>
<p>This works. However, in a specific package's code I want that package to be sorted into the <code>first-party</code> section and not lumped into the <code>monorepo</code> section.</p>
<p>I tried the following in the config file for a specific package:</p>
<pre><code class="language-toml">[tool.ruff]
extend = &quot;../../pyproject.toml&quot;

[tool.ruff.isort]
known-first-party = [
  &quot;my_bar&quot;,
]
</code></pre>
<p>But that results in the following warning:</p>
<pre><code>warning: One or more modules are part of multiple import sections, including: `my_bar`
</code></pre>
<p>Is there some way to have this root definition of a custom section, and &quot;promote&quot; a package to first party in the overriding config?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-08-30 13:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-30 16:06</div>
            <div class="timeline-body"><p>Hmm -- thought on this a bit, and I don't think there's a way to achieve what you've described without repeating the <code>monorepo = [...]</code> definition in the extended configuration file. If you didn't care about having a separate section for the monorepo, and just wanted each package to be treated as first-party when importing from within itself, and third-party otherwise, you could rely on our <code>detect-same-package</code> heuristic which is enabled by default (https://github.com/astral-sh/ruff/blob/main/CONTRIBUTING.md#import-categorization-1).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaap3">@jaap3</a> on 2023-08-31 07:20</div>
            <div class="timeline-body"><blockquote>
<p>If you didn't care about having a separate section for the monorepo [...]</p>
</blockquote>
<p>I'm trying to replicate the current setup we have with isort (and flake8), while also leveraging the excellent monorepo support of ruff. Having a section for the monorepo packages themselves is a &quot;must&quot; to prevent a lot of import re-shuffling :).</p>
<blockquote>
<p>repeating the monorepo = [...] definition in the extended configuration file</p>
</blockquote>
<p>This is basically what we have been doing, with the lack of configuration inheritance in isort and flake8. I had hoped I could reduce the linting configuration to a simple extend line. For now I will be repeating the monorepo definition in each project. I'm hoping there will be a way to achieve this in a DRY way in the future.</p>
<hr />
<p>Is it possible to make the <code>known-first-party</code> setting take precedence over custom section configuration? It is already written that it should be &quot;seen as an escape hatch&quot;. Which is exactly how I'm trying to use it, to escape from my own higher level configuration ;).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaap3">@jaap3</a> on 2023-08-31 08:16</div>
            <div class="timeline-body"><blockquote>
<p>repeating the monorepo = [...] definition in the extended configuration file</p>
</blockquote>
<p>Turns out I have to redefine <strong>all</strong> the custom sections (the monorepo section is not the only custom section in our case), otherwise I get a <code>warning: </code>section-order<code> contains unknown section [...]</code> :(</p>
<p>EDIT: Would <code>isort.extend-sections</code> be possible?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SethMMorton">@SethMMorton</a> on 2025-01-18 05:12</div>
            <div class="timeline-body"><p>I have a similar (but not quite the same) use case. In my organization we have a common <code>ruff.toml</code> file that defines in a custom section called <code>internal-packages</code> all of the python libraries that our organization maintains so that each project gets correct sorting &quot;for free&quot; if they add <code>extend = &quot;/path/to/common/ruff.toml&quot;</code>.</p>
<p>The problem is when we are working on one of those libraries. Ideally, the packages in the library would be identified as first party and be sorted accordingly, but because of the upstream configuration it gets labeled as <code>internal-packages</code>. Attempting to override by labeling as <code>known-first-party</code> results in the <code>One or more modules are part of multiple import sections</code> warning and it does not get sorted correctly. We don't want to simply not include the upstream configuration because it contains other settings, and also lists all the <em>other</em> libraries that should be sorted properly.</p>
<p>This behavior makes sense. I am hoping for either:</p>
<ul>
<li>A suggested way to solve this problem with current functionality</li>
<li>An enhancement to tell <code>ruff</code> to give precedence to the &quot;most local&quot; section in the case of duplicates (or some other enhancement that results in a similar end result)</li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
