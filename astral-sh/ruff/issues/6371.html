<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support heading setting for isort - astral-sh/ruff #6371</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support heading setting for isort</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6371">#6371</a>
        opened by <a href="https://github.com/applied-mathematician">@applied-mathematician</a>
        on 2023-08-06 11:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/applied-mathematician">@applied-mathematician</a></div>
            <div class="timeline-body"><p>The <code>isort</code> settings <code>import_heading_{section_name}</code> lets you specify heading comments for the sections, each defaulting to None.</p>
<p>I use these headings with all of my team projects so not a second is wasted trying to figure out where a package comes from. This is especially helpful when you have only a couple imports, hence not all sections. Developers new to a team have to figure out whether a package name they don't recognize is internal or third-party. There are even standard libraries that experienced developers often don't know, e.g. <code>ast</code>. This time savings translates to tasks like skimming your modules to gather a precise list of third-party dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @charliermarsh on 2023-08-06 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kinoute">@kinoute</a> on 2023-09-11 16:43</div>
            <div class="timeline-body"><p>Interested by this as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Alex-ley-scrub">@Alex-ley-scrub</a> on 2024-09-14 23:38</div>
            <div class="timeline-body"><p>@charliermarsh I know you said this on the isort meta issue https://github.com/astral-sh/ruff/issues/6190#issuecomment-1664881638:</p>
<blockquote>
<p>I'm open to contributions for additional isort options, but we likely won't prioritize implementing them ourselves</p>
</blockquote>
<p>I'd personally love this isort heading setting to be implemented since it would allow me to migrate us over to ruff isort from our current isort configuration. We use it for the same reason as @applied-mathematician</p>
<p>I saw that this one was <strong>not</strong> labelled as a https://github.com/astral-sh/ruff/labels/good%20first%20issue - I was trying to gauge how difficult it would be to implement. I've been learning Rust off and on for the last 2 years and I've written some with pyO3 to speed up our python codebase but I'm definitely not (yet) as proficient as I am in other languages.</p>
<p>Knowing at present very little about the ruff codebase and the isort implementation makes it difficult to estimate the time/effort needed and wether this would be a good candidate for my first contribution or not.</p>
<p>I've had a read of <a href="https://github.com/astral-sh/ruff/blob/main/CONTRIBUTING.md">CONTRIBUTING.md</a> and I've had a look around the <a href="https://github.com/astral-sh/ruff/tree/main/crates/ruff_linter/src/rules/isort">isort implementation folder</a>. I am guessing that this a point at which the insertion of the import section header (comment) could naively occur <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/isort/mod.rs#L201-L208">ruff_linter/src/rules/isort/mod.rs#L201-L208</a>. i.e. we could just insert the import section header when we are adding a newline before the section (as per the code comment <code>// Add a blank line between every section</code>) but of course that doesn't handle a lot of edge cases like if the import section header was already present, how do we detect that and how does this import section header interact with other comment lines present and other potentially conflicting settings such as <code>no-lines-before</code> etc.</p>
<p>Would it be possible for you to outline how you think it could/should be implemented when you have time please? And if I think I can do it then I'll give it a go, if not perhaps someone else who reads your outline will feel confident to do so - or I can come back to it at a later date.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Alex-ley-scrub">@Alex-ley-scrub</a> on 2024-10-28 00:07</div>
            <div class="timeline-body"><p>Hey @charliermarsh / @MichaReiser - I've recently been committing to https://github.com/getgrit/gritql/commits?author=Alex-ley-scrub and getting familiar with another AST / parsing heavy rust repo. It is really nice to write rust in a more mature and structured project (as opposed to just writing hotpath python stuff in rust with pyO3).</p>
<p>I think I'm ready to give this isort header issue an attempt now. I'm going to start with this approach unless you guys have some better ideas:</p>
<ol>
<li>add a new field to the <code>Settings</code> struct - i.e. <code>import_heading: FxHashMap&lt;ImportSection, String&gt;</code> or <code>BTreeMap&lt;ImportSection, String&gt;</code> for the isort section here: https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/isort/settings.rs#L47-L76</li>
<li>inside of <code>annotate_imports()</code> and/or <code>normalize_imports()</code> remove any exact matches for header strings that were defined in <code>import_heading</code> (as we will add them back later in the correct places): https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/isort/mod.rs#L81-L90 or just filter them out of <code>ImportCommentSet.atop</code> and <code>ImportFromCommentSet.atop</code> inside of <code>categorize_imports()</code> etc. https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/isort/mod.rs#L172</li>
<li>try the naive insertion mentioned in my last message https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/isort/mod.rs#L201-L208 <code>// Add a blank line between every section</code> but handling correctly the <code>no_lines_before</code> setting etc. - I guess I could do 2 and 3 inside of <code>format::format_import()</code> / <code>format::format_import_from()</code> potentially: https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/isort/mod.rs#L229-L255</li>
<li>write a bunch of tests and try to think of all the edge case and adapt the code as necessary (i.e. add fixtures in <code>crates/ruff_linter/resources/test/fixtures/isort/</code> and add those to the test functions such as <code>no_sections()</code> and add new test functions as required to test new settings combinations)</li>
</ol>
<hr />
<ol>
<li></li>
</ol>
<pre><code class="language-rust">#[derive(Debug, Clone, CacheKey)]
#[allow(clippy::struct_excessive_bools)]
pub struct Settings {
    ...
    pub no_lines_before: FxHashSet&lt;ImportSection&gt;,
    pub import_heading: FxHashMap&lt;ImportSection, String&gt;,
    ...
}
</code></pre>
<p>usage:</p>
<pre><code class="language-toml">[tool.ruff.lint.isort]
force-sort-within-sections = false
required-imports = [&quot;from __future__ import annotations&quot;]
# https://github.com/astral-sh/ruff/issues/6371
import-heading.future = &quot;Future imports (must occur at the beginning of the file):&quot;
import-heading.standard-library = &quot;Standard library imports:&quot;
import-heading.third-party = &quot;Third party imports:&quot;
import-heading.first-party = &quot;Local imports:&quot;
extra-standard-library = [&quot;pathlib&quot;, &quot;packaging&quot;, &quot;glob&quot;, &quot;urllib&quot;]
known-first-party = [&quot;src&quot;]
known-third-party = [&quot;wandb&quot;, &quot;pandas&quot;, &quot;numpy&quot;]
no-lines-before = [&quot;local-folder&quot;]
section-order = [
    &quot;future&quot;,
    &quot;standard-library&quot;,
    &quot;third-party&quot;,
    &quot;first-party&quot;,
    &quot;local-folder&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-28 07:00</div>
            <div class="timeline-body"><p>Thanks @Alex-ley-scrub for your interest.</p>
<blockquote>
<blockquote>
<p>@charliermarsh I know you said this on the isort meta issue https://github.com/astral-sh/ruff/issues/6190#issuecomment-1664881638:</p>
</blockquote>
<p>I'm open to contributions for additional isort options, but we likely won't prioritize implementing them ourselves</p>
</blockquote>
<p>We've since changed our stand and are less likely to accept new isort settings. I'm not familiar with isort myself so I'm unlikely the right person to make this decision but I would wait until we hear from @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-10-28 07:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bmitc">@bmitc</a> on 2025-03-17 14:04</div>
            <div class="timeline-body"><blockquote>
<p>We've since changed our stand and are less likely to accept new isort settings. I'm not familiar with isort myself so I'm unlikely the right person to make this decision but I would wait until we hear from @charliermarsh.</p>
</blockquote>
<p>Why is that?</p>
<p>I'm not sure I follow the point of bundling isort behavior into Ruff if all the features aren't going to be supported, especially a nice one. It's strange to try and replace tooling but not support all the features of the existing tooling.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-24 16:31</div>
            <div class="timeline-body"><p>Gonna remove the <code>needs-decision</code> label -- this looks reasonable to support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @charliermarsh on 2025-12-24 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @charliermarsh on 2025-12-24 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-24 17:00</div>
            <div class="timeline-body"><p>Not saying we shouldn't do this, but this setting might feel weird if we decide to integrate isort into the formatter because it sets a new precedence that the formatter inserts content (other than <code>,</code> or whitespace).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:47:54 UTC
    </footer>
</body>
</html>
