<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect explanation for PYI019 - astral-sh/ruff #8765</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect explanation for PYI019</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8765">#8765</a>
        opened by <a href="https://github.com/henribru">@henribru</a>
        on 2023-11-19 11:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/henribru">@henribru</a></div>
            <div class="timeline-body"><p>The explanation for PYI019 at https://docs.astral.sh/ruff/rules/custom-type-var-return-type/ seems incorrect to me. The rationale there applies when you use a fixed class as the return type (like what PYI034 flags), but <em>not</em> when you use a <code>TypeVar</code>. You can see that Mypy and Pyright both correctly infer return types on a subclass based on that example:</p>
<p>https://mypy-play.net/?mypy=latest&amp;python=3.11&amp;gist=523f6373f5a85dd8f78e8b7038d9d74d</p>
<p>https://pyright-play.net/?code=GYJw9gtgBALgngBwJYDsDmUkQWEMoAqiApgGoCGIAsAFC0D6AylALyEkUgAUAREzwEpatAMYAbcgGdJUAGJgwALlpRVUACbFgUevRTEA7rq7jJi2CQDaTALoAaKACpKaM1EkwQDx44DWBlzdUGAEoAFoAPh1GZRo1eKgAOmThOLVNbWAFLkliMWBzJgcXcwAjOBhiSVDI6NiEtWTE1PiAAXEpSQhiGAALMHUVdK0oUsoTMTd4BGJrRnsoEswUEPCopnqGpJS0htEJaSgAIXH5MAFzJtSQYgA3YnIxemniLhPuASEaG-vH55I3uMBIksmAuKUeIIvj8Hk8XoCQIkxtwAMyfIA</p>
<p>The <a href="https://peps.python.org/pep-0673/#motivation">PEP</a> for <code>Self</code> also shows the <code>TypeVar</code> variant as being equivalent, but describes <code>Self</code> as &quot;more intuitive and succinct&quot;. flake8-pyi doesn't really explain the rationale for the rule in their <a href="https://github.com/PyCQA/flake8-pyi/blob/main/ERRORCODES.md?plain=1#L25">explanation</a>, but based on this I assume it's actually just meant to be stylistic. If so Ruff's explanation should reflect this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-19 11:24</div>
            <div class="timeline-body"><p>\cc @AlexWaygood - only if quick / easy for you, do you know if Y019 is about clearer style / intent, or correctness?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2023-11-19 11:32</div>
            <div class="timeline-body"><p>@henribru is correct — Y019 is purely concerned with style, not with correctness (though it is <em>slightly easier</em> to be correct if you use the more modern syntax — in a <code>.py</code> file, you don't have to worry about binding the TypeVar to a forward reference etc :)</p>
<p>The &quot;use instead&quot; snippet ruff gives in the docs also isn't <em>ideal</em> — currently it's this:</p>
<pre><code class="language-py">from typing import Self


class Foo:
    def __new__(cls: type[Self], *args: str, **kwargs: int) -&gt; Self:
        ...

    def foo(self: Self, arg: bytes) -&gt; Self:
        ...

    @classmethod
    def bar(cls: type[Self], arg: int) -&gt; Self:
        ...
</code></pre>
<p>But part of the <em>point</em> of <code>typing.Self</code> is that (unlike a normal TypeVar) you can skip the annotations on <code>cls</code> or <code>self</code> — so a better &quot;use instead&quot; snippet would be this:</p>
<pre><code class="language-py">from typing import Self


class Foo:
    def __new__(cls, *args: str, **kwargs: int) -&gt; Self:
        ...

    def foo(self, arg: bytes) -&gt; Self:
        ...

    @classmethod
    def bar(cls, arg: int) -&gt; Self:
        ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-19 12:40</div>
            <div class="timeline-body"><p>Awesome, thanks @AlexWaygood for the characteristically clear + through answer! Will fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2023-11-19 12:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-19 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2023-11-20 09:21</div>
            <div class="timeline-body"><p>I just overhauled our flake8-pyi docs in https://github.com/PyCQA/flake8-pyi/commit/504ef82a6b8e1e7da763e2e9fa3cbbdcb5f26cce, so hopefully it should be a bit clearer in the future to figure out what the motivation is for each of our rules :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:04 UTC
    </footer>
</body>
</html>
