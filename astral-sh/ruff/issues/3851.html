<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP006  is reported for python&lt;3.9 - astral-sh/ruff #3851</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP006  is reported for python&lt;3.9</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/3851">#3851</a>
        opened by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a>
        on 2023-04-01 23:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-04-01 23:34</div>
            <div class="timeline-body"><p>When I run ruff on pyi file with python3.7 as target UP006  <code>Use tuple instead of Tuple for type annotations</code> is reported.  This behavior is not reproduced with pyupgrade.</p>
<p>I expect the UP006 is not reported with python3.7.</p>
<p>https://docs.python.org/3/library/typing.html#typing.Tuple</p>
<blockquote>
<p>Deprecated since version 3.9: <a href="https://docs.python.org/3/library/stdtypes.html#tuple">builtins.tuple</a> now supports subscripting</p>
</blockquote>
<p>Sample code</p>
<pre><code class="language-python">from typing import Tuple


def foo() -&gt; Tuple[int, int]:
    pass
</code></pre>
<p>When I run the ruff on the <code>pyi</code> file, I got the expected behavior for 3.10, and unexpected for 3.7.</p>
<pre><code class="language-shell">ruff &quot;sample.pyi&quot; --select U --target-version &quot;py310&quot; 
sample.pyi:1:1: UP035 `typing.Tuple` is deprecated, use `tuple` instead
sample.pyi:4:14: UP006 [*] Use `tuple` instead of `Tuple` for type annotations
Found 2 errors.

&gt;ruff &quot;sample.pyi&quot; --select U --target-version &quot;py37&quot; 
sample.pyi:4:14: UP006 [*] Use `tuple` instead of `Tuple` for type annotations
Found 1 error.
</code></pre>
<p>The same checks with a python work as expected.</p>
<pre><code class="language-shell">&gt; ruff &quot;sample.py&quot; --select U --target-version &quot;py310&quot;   
sample.py:1:1: UP035 `typing.Tuple` is deprecated, use `tuple` instead
sample.py:4:14: UP006 [*] Use `tuple` instead of `Tuple` for type annotations
Found 2 errors.

&gt;ruff sample.py --select U --target-version &quot;py37&quot;  
# No errors
</code></pre>
<p>I also have checked the same <code>pyi</code> file with <code>pyupgrade</code>, it also works as expected.</p>
<pre><code class="language-shell">&gt;pyupgrade  &quot;sample.pyi&quot; --py37-plus 

&gt;pyupgrade  &quot;sample.pyi&quot; --py310-plus 
Rewriting sample.pyi
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-02 02:28</div>
            <div class="timeline-body"><p>I <em>think</em> this is correct. It's recommended that stub files use latest syntax and language features, even if the corresponding code has to run on older Python versions -- since stub files are never evaluated at runtime, only by tooling.</p>
<p>Stub files are treated (by Ruff, and in general) as if they always have <code>from __future__ import annotations</code> enabled, and so we support standard library generics even if your target version is below Python 3.9.</p>
<p>You can see this reflected in the official typing docs <a href="https://typing.readthedocs.io/en/latest/source/stubs.html#syntax">here</a>:</p>
<blockquote>
<p>Stubs are treated as if <code>from __future__ import</code> annotations is enabled. In particular, built-in generics, pipe union syntax (X | Y), and forward references can be used.</p>
</blockquote>
<p>Note that <code>pyupgrade</code> and <code>flake8</code> don't officially support <code>.pyi</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-04-02 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-04-02 16:17</div>
            <div class="timeline-body"><p>Thank you for the clarification, Now I'am see that the current ruff behavior is correct.</p>
<p>People usually use the latest tools for the language, so it should support the latest pyi syntax and never be a problem.</p>
<p>I think that most tools that work with code do not import the code, and won't fail on that file when they run with the old python, since tuple[int] is a runtime error in Python3.7.</p>
<blockquote>
<p>Stubs are treated as if from <strong>future</strong> import annotations are enabled. In particular, built-in generics, pipe union syntax (X | Y), and forward references can be used.</p>
</blockquote>
<p>That means that UP006 should always be correct, since it's valid for the first version of pyi.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-04-02 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7136.html">astral-sh/ruff#7136</a> on 2023-09-04 21:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
