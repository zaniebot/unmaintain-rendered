<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support formatting jupyter notebooks - astral-sh/ruff #1218</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support formatting jupyter notebooks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/1218">#1218</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2022-12-12 17:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2022-12-12 17:15</div>
            <div class="timeline-body"><p><a href="https://github.com/psf/black">black</a> supports formatting jupyter notebook with the jupyter extra <code>black[jupyter]</code>. If installed like this, it formats jupyter notebooks just like python files. It would be nice if ruff could similarly lint and fix jupyter notebooks.</p>
<p>Steps to implement this:</p>
<ul>
<li>[x] Read Jupyter notebooks, <a href="https://github.com/charliermarsh/ruff/blob/cab65b25da8aff6fb9cb539b55345aae64a835f0/crates/ruff/src/jupyter/notebook.rs#L136-L187">build a mapping between cells and concatenated code</a> and and print lint errors with cell ids. The code is in <a href="https://github.com/charliermarsh/ruff/blob/main/crates/ruff/src/jupyter/notebook.rs">jupyter/notebooks.rs</a>.</li>
<li>[x] Apply fixes to concatenated code and map back to cells</li>
<li>[x] Write back jupyter notebooks ensuring that if there are no changes the json is identical (roundtrip support). You might need to extend or replace the current <a href="https://github.com/charliermarsh/ruff/blob/595cd065f3a002a4301c41f005122a8806a3925f/crates/ruff/src/jupyter/schema.rs#L23">schema</a> or drop some of the schema for just <code>serde_json::Value</code>. See also the <a href="https://github.com/psf/black/blob/69ca0a4c7a365c5f5eea519a90980bab72cab764/src/black/__init__.py#L1017-L1046">black implementation</a>.</li>
<li>[x] Test roundtrip support with a bunch of different notebooks found in the wild, ideally from different generators (e.g. jupyter notebook and pycharm) and different schema versions.</li>
<li>[ ] Remove <code>jupyter_notebook</code> feature and include <code>.ipynb</code> files in ruff by default</li>
<li>[ ] Optional: Check if there a any lints that should be off for jupyter notebook, e.g. &quot;no print&quot; or isort rules might not make sense</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-12-12 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 04:02</div>
            <div class="timeline-body"><p>I assume Ruff would work with <a href="https://github.com/nbQA-dev/nbQA">nbQA</a>, but I too would like it to support Jupyter out-of-the-box. Looking into it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-28 02:18</div>
            <div class="timeline-body"><p>Ruff was actually integrated into <a href="https://github.com/nbQA-dev/nbQA/pull/773">nbQA</a> in the latest release, so you can now run (e.g.):</p>
<pre><code>‚ùØ nbqa ruff Untitled.ipynb
Untitled.ipynb:cell_1:2:5: F841 Local variable `x` is assigned to but never used
Untitled.ipynb:cell_2:1:1: E402 Module level import not at top of file
Untitled.ipynb:cell_2:1:8: F401 `os` imported but unused
Found 3 error(s).
1 potentially fixable with the --fix option.
</code></pre>
<p>(Would still like to have a first-party integration at some point.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1417.html">astral-sh/ruff#1417</a> on 2022-12-28 02:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @charliermarsh on 2022-12-31 18:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">core</span> added by @charliermarsh on 2022-12-31 18:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blakeNaccarato">@blakeNaccarato</a> on 2023-03-10 03:21</div>
            <div class="timeline-body"><p>See a parallel effort over in the Ruff VSCode extension, where LSP support for analyzing entire Jupyter notebooks seems blocked by <code>pygls</code> still being on LSP v3.16. It could be a shorter road for the Ruff LSP implementation to handle entire notebook formatting, if effort can be concentrated over at <code>pygls</code> to get LSP 3.17 out. See <a href="https://github.com/charliermarsh/ruff-vscode/issues/51#issuecomment-1463190089">my comment</a> in the other thread for more detail and other Issue links.</p>
<p>It would be nice to have native support in Ruff as well! But in the short run, it looks like LSP support may have less resistance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-05-11 11:58</div>
            <div class="timeline-body"><p>The current implementation can lint jupyter files, but it can't apply fixes yet or write them back to file. I've written instructions in the top comment and can mentor if someone wants to tackle this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @konstin on 2023-05-12 11:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sladyn98">@sladyn98</a> on 2023-05-16 21:25</div>
            <div class="timeline-body"><p>@konstin I could take this on</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-17 01:19</div>
            <div class="timeline-body"><p>@sladyn98 - Sorry for the churn, I already chatted with @dhruvmanila about taking this one on!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-05-17 03:01</div>
            <div class="timeline-body"><p>@charliermarsh you can assign this to me to avoid any future confusion :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @charliermarsh on 2023-05-17 03:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4665.html">astral-sh/ruff#4665</a> on 2023-05-26 08:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4727.html">astral-sh/ruff#4727</a> on 2023-05-30 15:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-06-12 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-12 15:43</div>
            <div class="timeline-body"><p>Sorry, not yet completed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @dhruvmanila on 2023-06-12 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-12 15:47</div>
            <div class="timeline-body"><p>What's the outstanding work here? Testing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5028.html">astral-sh/ruff#5028</a> on 2023-06-12 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-12 16:06</div>
            <div class="timeline-body"><ul>
<li>Roundtrip support</li>
<li>End-to-end testing support</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5076.html">astral-sh/ruff#5076</a> on 2023-06-14 05:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-20 05:43</div>
            <div class="timeline-body"><p>Meta issue: #5188</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-06-20 05:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5188.html">astral-sh/ruff#5188</a> on 2023-07-26 02:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../unit8co/darts/pulls/2340.html">unit8co/darts#2340</a> on 2024-04-18 07:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
