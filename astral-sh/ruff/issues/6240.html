<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignores `noqa` comment for PLR rule if not prefixed with `ruff: ` - astral-sh/ruff #6240</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignores <code>noqa</code> comment for PLR rule if not prefixed with <code>ruff: </code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6240">#6240</a>
        opened by <a href="https://github.com/chbndrhnns">@chbndrhnns</a>
        on 2023-08-01 12:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chbndrhnns">@chbndrhnns</a></div>
            <div class="timeline-body"><p>The <a href="https://beta.ruff.rs/docs/configuration/#error-suppression">docs</a> say:</p>
<blockquote>
<p>To ignore an individual violation, add # noqa: {code} to the end of the line</p>
</blockquote>
<p>This seems not work for this snippet. It only works when using <code>ruff: noqa: PLR0912</code>.
That&#x27;s surprising to me.</p>
<pre><code># noqa: PLR0912
def _find_parent_by_value(data, look_for, parent=None, include_spec=False):
    if data and not isinstance(data, (str, int, float)):
        for key, val in data.items():
            if val == look_for:
                if include_spec:
                    if isinstance(parent, list):
                        yield from [parent]
                    else:
                        yield parent
                elif isinstance(parent, list):
                    yield []
                else:
                    yield from parent
            elif isinstance(val, dict):
                if look_for in val.values():
                    if include_spec:
                        yield {key: val}
                    else:
                        yield key
                else:
                    yield from _find_parent_by_value(
                        val, look_for, data, include_spec=include_spec
                    )
            elif isinstance(val, list):
                for item in val:
                    yield from _find_parent_by_value(
                        item, look_for, val, include_spec=include_spec
                    )

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Ignores `noqa` comment for PLR if not prefixed with `ruff: `&quot; to &quot;Ignores `noqa` comment for PLR rule if not prefixed with `ruff: `&quot; by <a href="https://github.com/chbndrhnns">@chbndrhnns</a> on 2023-08-01 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chbndrhnns">@chbndrhnns</a> on 2023-08-01 13:08</div>
            <div class="timeline-body"><p>I am starting to thing the docs might be off and <code>ruff: </code> is required for ANY rule that should be disabled. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 13:09</div>
            <div class="timeline-body"><p>They do two different things:</p>
<ul>
<li><code># noqa: PLR0912</code> is an inline ignore. It will suppress a violation on a single line, and it needs to be placed at the end of the line on which the violation occurs. In your case, I think that&#x27;s just after the <code>def _find_parent_by_value(data, look_for, parent=None, include_spec=False):  # noqa: PLR0912</code>.</li>
<li><code># ruff: noqa: PLR0912</code> disables <code>PLR0912</code> for the entire file, and must be placed at the <em>start</em> of a line.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 13:10</div>
            <div class="timeline-body"><p>So concretely, you either want:</p>
<pre><code>def _find_parent_by_value(data, look_for, parent=None, include_spec=False):  # noqa: PLR0912
    if data and not isinstance(data, (str, int, float)):
        for key, val in data.items():
            if val == look_for:
                if include_spec:
                    if isinstance(parent, list):
                        yield from [parent]
                    else:
                        yield parent
                elif isinstance(parent, list):
                    yield []
                else:
                    yield from parent
            elif isinstance(val, dict):
                if look_for in val.values():
                    if include_spec:
                        yield {key: val}
                    else:
                        yield key
                else:
                    yield from _find_parent_by_value(
                        val, look_for, data, include_spec=include_spec
                    )
            elif isinstance(val, list):
                for item in val:
                    yield from _find_parent_by_value(
                        item, look_for, val, include_spec=include_spec
                    )
</code></pre>
<p>Or (less recommended, only if you need to turn off a violation for a single file):</p>
<pre><code># ruff: noqa: PLR0912
def _find_parent_by_value(data, look_for, parent=None, include_spec=False):
    if data and not isinstance(data, (str, int, float)):
        for key, val in data.items():
            if val == look_for:
                if include_spec:
                    if isinstance(parent, list):
                        yield from [parent]
                    else:
                        yield parent
                elif isinstance(parent, list):
                    yield []
                else:
                    yield from parent
            elif isinstance(val, dict):
                if look_for in val.values():
                    if include_spec:
                        yield {key: val}
                    else:
                        yield key
                else:
                    yield from _find_parent_by_value(
                        val, look_for, data, include_spec=include_spec
                    )
            elif isinstance(val, list):
                for item in val:
                    yield from _find_parent_by_value(
                        item, look_for, val, include_spec=include_spec
                    )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">noqa</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chbndrhnns">@chbndrhnns</a> on 2023-08-01 13:27</div>
            <div class="timeline-body"><p>Thanks for explanation!</p>
<p>I think this distinction between file-level and inline ignore could be a bit clearer in the docs. (I got it now.)
Also, I am wondering what this distinction (prefix vs no prefix) is required for: Wouldn&#x27;t it be enough to use <code># noqa: &lt;rule&gt;</code> at the beginning of the line to make it file-level?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-01 13:49</div>
            <div class="timeline-body"><p>We&#x27;re planning on redesigning these suppression comments in the future. The current design imitates existing tooling for compatibility.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:40 UTC
    </footer>
</body>
</html>
