<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`TRY400` False Positive - Flags other logger calls after log.exception - astral-sh/ruff #18070</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`TRY400` False Positive - Flags other logger calls after log.exception</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/18070">#18070</a>
        opened by <a href="https://github.com/Skylion007">@Skylion007</a>
        on 2025-05-13 14:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Skylion007">@Skylion007</a> on 2025-05-13 14:59</div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code class="language-python">import logging

logger = logging.getLogger(__name__)
try:
    raise RuntimeError(&quot;Throwing a big bad exception&quot;)
except:
    logger.exception(&quot;Record exception stack&quot;)
    logger.error(&quot;This error should never, ever happen, logging additional details...&quot;)
</code></pre>
<p>Expected behavior is that this fine.</p>
<p>TRY400 flags every single logger call after the first logger.exception. Not every single logger call needs to record the exception information / stack information and shouldn't as this pollutes the log. As such, if at least one unconditional logger call logs the exception info, all logger.error calls after it shouldn't need to be logger.exception.</p>
<p>The linter complains and you are left with some uncomfortable issues of fusing the logger calls (which might make it very difficult to parse for you and the machine if you are doing a lot of complex formatting). You also cannot seperate the calls with different levels of verbosity etc. Having to suppress all these additional call with NOQA TRY400 is rather annoying and undesirable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-13 21:50</div>
            <div class="timeline-body"><p>I think it makes some sense to consider this a false positive. The upstream linter does flag this though, so we'll need to decide if we want to diverge from that.</p>
<pre><code class="language-shell">$ uvx tryceratops example.py
[TRY400] Use logging '.exception' instead of '.error' - example.py:8:4
[TRY003] Avoid specifying long messages outside the exception class - example.py:5:4
[TRY301] Abstract raise to an inner function - example.py:5:4
</code></pre>
<p>It could also be a bit tricky to track the control flow in an <code>except</code> branch to determine if we've seen an <code>exception</code> call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-05-13 21:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-05-13 21:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2025-05-14 14:05</div>
            <div class="timeline-body"><p>@ntBre Surprisingly, setting <code>exc_info=False</code> does not suppress it either, does it at least suppress it upstream for TRY400? Is there any better way to indicate intent other than a NOQA comment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 14:11</div>
            <div class="timeline-body"><p>No, it looks like neither we nor tryceratops inspect the arguments to check for <code>exc_info</code>. I think a noqa comment, or disabling the rule more generally, is the only workaround currently.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
