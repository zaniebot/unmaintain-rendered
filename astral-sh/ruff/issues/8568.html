<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ARG002` false positive with `kwargs`-consuming decorators - astral-sh/ruff #8568</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ARG002</code> false positive with <code>kwargs</code>-consuming decorators</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8568">#8568</a>
        opened by <a href="https://github.com/rassie">@rassie</a>
        on 2023-11-08 17:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rassie">@rassie</a></div>
            <div class="timeline-body"><p>My code goes something like this:</p>
<pre><code>@wrapt.decorator
def my_request(wrapped, instance, args, kwargs):
    filtered_kwargs = {key: value for key, value in kwargs.items() if value is not None}
    url = wrapped(*args, **filtered_kwargs)
    response = requests.get(url, filtered_kwargs)
    return response.content

class MyClass:
    @my_request
    def some_data(self, additional_data=None):
        return &quot;https://myurl.example.com&quot;
</code></pre>
<p>The idea is to define available query parameters through non-<code>None</code> keyword arguments, so if I call <code>obj.some_data()</code> I expect the contents of &quot;https://myurl.example.com&quot; to be returned and on <code>obj.some_data(additional_data=&quot;data&quot;)</code>, &quot;https://myurl.example.com?additional_data=data&quot; should be called.</p>
<p>Now the problem is that <code>ARG002</code> is triggered on <code>additional_data</code>, which is of course used, but only indirectly via the decorator. I don&#x27;t know whether looking up what decorators are doing is in scope for <code>ruff</code> at all so I don&#x27;t have high expectations that this is worth fixing, but would still appreciate it deeply.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 02:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 02:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 02:09</div>
            <div class="timeline-body"><p>This will be pretty tough to fix, my honest suggestion would be to try and restructure the code to avoid this kind of interception-via-decorator, but I know you didn&#x27;t come here for those kinds of suggestions :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:45 UTC
    </footer>
</body>
</html>
