<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`cargo test` for 0.5.6 fails on s390x, riscv5 and ppc64le - astral-sh/ruff #12662</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>cargo test</code> for 0.5.6 fails on s390x, riscv5 and ppc64le</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12662">#12662</a>
        opened by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a>
        on 2024-08-04 14:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/WhyNotHugo">@WhyNotHugo</a></div>
            <div class="timeline-body"><pre><code>   Compiling codspeed v2.6.0
error[E0432]: unresolved import `self::arch`
  --&gt; /home/buildozer/.cargo/registry/src/index.crates.io-d11c229612889eed/codspeed-2.6.0/src/request/mod.rs:13:15
   |
13 | pub use self::arch::{send_client_request, Value};
   |               ^^^^ could not find `arch` in `self`
   |
note: found an item that was configured out
  --&gt; /home/buildozer/.cargo/registry/src/index.crates.io-d11c229612889eed/codspeed-2.6.0/src/request/mod.rs:17:5
   |
17 | mod arch;
   |     ^^^^
   = note: the item is gated behind the `x86_64` feature
note: found an item that was configured out
  --&gt; /home/buildozer/.cargo/registry/src/index.crates.io-d11c229612889eed/codspeed-2.6.0/src/request/mod.rs:21:5
   |
21 | mod arch;
   |     ^^^^
   = note: the item is gated behind the `x86` feature
note: found an item that was configured out
  --&gt; /home/buildozer/.cargo/registry/src/index.crates.io-d11c229612889eed/codspeed-2.6.0/src/request/mod.rs:25:5
   |
25 | mod arch;
   |     ^^^^
   = note: the item is gated behind the `arm` feature
note: found an item that was configured out
  --&gt; /home/buildozer/.cargo/registry/src/index.crates.io-d11c229612889eed/codspeed-2.6.0/src/request/mod.rs:29:5
   |
29 | mod arch;
   |     ^^^^
   = note: the item is gated behind the `aarch64` feature
For more information about this error, try `rustc --explain E0432`.
error: could not compile `codspeed` (lib) due to 1 previous error
warning: build failed, waiting for other jobs to finish...
</code></pre>
<p>Full build logs for <a href="https://gitlab.alpinelinux.org/WhyNotHugo/aports/-/jobs/1472530">s390x</a>, <a href="https://gitlab.alpinelinux.org/WhyNotHugo/aports/-/jobs/1472535">riscv5</a> and <a href="https://gitlab.alpinelinux.org/WhyNotHugo/aports/-/jobs/1472531">ppc64le</a>.</p>
<p>At a glance, I get the impression that codspeed has architecture-specific code, so requires explicit support for these architectures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-04 14:58</div>
            <div class="timeline-body"><p>Hmm interesting. The code is only used for benchmarking. You can build ruff by using <code>cargo build --bin ruff</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nekopsykose">@nekopsykose</a> on 2024-08-04 15:25</div>
            <div class="timeline-body"><p>since this fails in <code>cargo test</code>, you can skip the bench tests specifically with <code>cargo test --workspace --exclude ruff_benchmark</code>. that skips building this specific dep since it's no longer in the graph</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a> on 2024-08-04 16:53</div>
            <div class="timeline-body"><p>Yeah, we should honestly be skipping benchmarks when packaging anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a> on 2024-08-04 16:54</div>
            <div class="timeline-body"><p>Isn't <code>cargo test</code> supposed to run only tests and <code>cargo bench</code> runs benchmarks?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nekopsykose">@nekopsykose</a> on 2024-08-04 17:00</div>
            <div class="timeline-body"><p>afaict yes, but <code>cargo test</code> will still build the workspace to perhaps detect <code>#[test]</code> declarations- even if nothing in ruff_benchmark has any of those and only criterion <code>bench</code> thingies in it, the crate as a whole will be built (and before that, the deps of it)</p>
<p>i could be wrong but that's how it seems to function currently at the workspace level in any project</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "0.5.6 fails to build on s390x, riscv5 and ppc64le" to "`cargo test` for 0.5.6 fails on s390x, riscv5 and ppc64le" by @WhyNotHugo on 2024-08-04 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-04 19:30</div>
            <div class="timeline-body"><p>Excluding the crate from tests is probably a good idea either way</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a> on 2024-08-04 20:22</div>
            <div class="timeline-body"><p>Yeah, I've excluded it when packaging/testing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-08-05 07:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:47 UTC
    </footer>
</body>
</html>
