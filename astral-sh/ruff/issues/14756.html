<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bug: `target-version` not respected when formatting `with` statement - astral-sh/ruff #14756</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>bug: `target-version` not respected when formatting `with` statement</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14756">#14756</a>
        opened by <a href="https://github.com/ziadkh0">@ziadkh0</a>
        on 2024-12-03 12:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ziadkh0">@ziadkh0</a> on 2024-12-03 12:44</div>
            <div class="timeline-body"><p>Formatting the following code with <code>target-version</code> set to <code>&quot;py39&quot;</code> and <code>line-length</code> set to <code>10</code> (just for the example):</p>
<pre><code class="language-py3">with A() as a, B() as b:
    pass
</code></pre>
<p>Expected output similar to:</p>
<pre><code class="language-py3">with \
    A() as a, \
    B() as b \
:
    pass
</code></pre>
<p>Actual output:</p>
<pre><code class="language-py3">with (
    A() as a,
    B() as b,
):
    pass
</code></pre>
<p><a href="https://play.ruff.rs/0186c6bc-7e53-49a5-8cd7-f9a4dfe48109">Playground</a></p>
<p>Support for using grouping parentheses to break the <code>with</code> statement in multiple lines was added in version 3.10, see: https://docs.python.org/3/reference/compound_stmts.html#the-with-statement</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-03 12:56</div>
            <div class="timeline-body"><p>Thanks for opening the issue!</p>
<blockquote>
<p>Support for using grouping parentheses to break the <code>with</code> statement in multiple lines was added in version 3.10, see: https://docs.python.org/3/reference/compound_stmts.html#the-with-statement</p>
</blockquote>
<p>It was only formally added to the language spec in Python 3.10. However, it was (initially only accidentally) made valid syntax in Python 3.9. This definitely isn't going to be reverted in CPython, so it's entirely safe to assume that <code>with</code> items can be parenthesized on Python 3.9. Black also uses parenthesized <code>with</code> items on Python 3.9, and I think it's good for us to be consistent with Black here. (Actually this <em>was</em> recently discussed again at https://github.com/psf/black/pull/4488, but they decided to keep their current behaviour.)</p>
<p>Is this behaviour causing an issue for you somewhere? :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @AlexWaygood on 2024-12-03 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @AlexWaygood on 2024-12-03 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ziadkh0">@ziadkh0</a> on 2024-12-03 17:35</div>
            <div class="timeline-body"><p>Thank you for the quick reply!
I didn't that ðŸ˜®
I just check it, and I can confirm that it's not causing an issues ðŸ˜„
I guess this issue can be closed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-12-03 17:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:15 UTC
    </footer>
</body>
</html>
