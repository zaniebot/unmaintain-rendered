<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autofix S101 - astral-sh/ruff #7635</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Autofix S101</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7635">#7635</a>
        opened by <a href="https://github.com/kunaltyagi">@kunaltyagi</a>
        on 2023-09-25 06:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-09-25 06:12</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>code: <code>assert x != 0</code>
ruff: 0.0.291
command: <code>ruff check --fix --fixable S101 .</code>
error: <code>S101 Use of </code>assert<code> detected</code></p>
<p>This is an easy fix to substitute in the code specially when opted-in by the developer (if not automatically)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-09-26 15:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-26 15:22</div>
            <div class="timeline-body"><p>What would you suggest as the correct fix?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-09-26 15:57</div>
            <div class="timeline-body"><p>If the assert doesn't have a message, a generic message can be used alongside the assert condition. Eg: for <code>assert x != y</code></p>
<pre><code class="language-py">if x == y:
  msg = f&quot;Expected: 'x != y', found: x = {x}, y = {y}&quot;
  raise ValueError(msg)
</code></pre>
<p>If there's a message accompanying the assert, eg: <code>assert x != y, &quot;some message&quot;</code></p>
<pre><code class="language-py">if x == y:
  msg = &quot;some message&quot;
  raise ValueError(msg)
</code></pre>
<p>This is what I've observed people replace their code with when faced with this error. The most often item people might want to change is the error type but this default would more than suffice the 80-20 rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimbleby">@dimbleby</a> on 2023-09-30 10:26</div>
            <div class="timeline-body"><p><code>AssertionError</code> would seem the more natural substitution, as already done when auto-fixing <code>B011</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-10-01 04:14</div>
            <div class="timeline-body"><p>Sure, that does make more sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> removed by @dhruvmanila on 2023-10-04 04:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dhruvmanila on 2023-10-04 04:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @dhruvmanila on 2023-10-04 04:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cosmojg">@cosmojg</a> on 2023-10-04 19:48</div>
            <div class="timeline-body"><p>If this is implemented, might it wreak havoc on tests?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-10-05 01:46</div>
            <div class="timeline-body"><p>I don't think so. Asserts in tests are ignored in the projects I've used ruff with</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cosmojg">@cosmojg</a> on 2023-10-05 17:55</div>
            <div class="timeline-body"><p>Huh, weird! I had to go out of my way to explicitly declare the following in my <code>pyproject.toml</code></p>
<pre><code>[tool.ruff.per-file-ignores]
&quot;*test_*.py&quot; = [&quot;S101&quot;]
</code></pre>
<p>Without that, I get loads of errors about the use of &quot;assert&quot; in tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-05 17:56</div>
            <div class="timeline-body"><p>We don't disable any specific rules in tests by default, so something like what you have there @cosmojg is expected and correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cosmojg">@cosmojg</a> on 2023-10-05 18:47</div>
            <div class="timeline-body"><p>Ah, got it, thanks for the clarification! That makes sense.</p>
<p>It's an interesting philosophical question whether tests are part of the language itself or merely a product thereof. Regardless, it seems that <a href="https://bandit.readthedocs.io/en/latest/plugins/b101_assert_used.html"><code>bandit</code></a> maintains the same behavior upstream so the point is moot. I suppose some users might prefix scripts with &quot;test&quot; to mean that they are tests in some other sense. Also, the Python interpreter itself doesn't differentiate even though the standard library does (see: <a href="https://docs.python.org/3/library/unittest.html#test-discovery"><code>unittest</code></a>), and at the end of the day, explicit behavior generally causes fewer problems than implicit behavior.</p>
<p>All of that said, I agree that autofixing with an <code>AssertionError</code> exception is the way to go!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-10-06 00:24</div>
            <div class="timeline-body"><p>@cosmojg I found that I was wrong in my guess and all the projects (I work(ed) on) all had the following common items:</p>
<pre><code class="language-toml">[tool.ruff.per-file-ignores]
# Tests can use magic values, assertions, and relative imports
&quot;tests/**/*&quot; = [&quot;PLR2004&quot;, &quot;S101&quot;, &quot;TID252&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 04:41</div>
            <div class="timeline-body"><p>Has there been any progress on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/collinanderson">@collinanderson</a> on 2025-03-28 20:22</div>
            <div class="timeline-body"><p>I agree that this should be a pretty straightforward autofix:</p>
<pre><code>assert {condition}, {message}
</code></pre>
<p>should become:</p>
<pre><code>if not ({condition}):
  raise AssertionError({message})
</code></pre>
<p>If no <code>{message}</code> then just:</p>
<pre><code>if not ({condition}):
  raise AssertionError
</code></pre>
<p>(Other rules can then fix it further, like if <code>not x in y</code> -&gt; <code>x not in y</code>, or <code>{message}</code> getting assigned to a variable first, etc.)</p>
<p>I'd suggest starting out as an unsafe-fix in case <code>pyright</code> users are blindly fixing all possible issues, and not already using <code>per-file-ignores</code> to ignore <code>S101</code> on tests.</p>
<p>It could later be made a safe fix after some time for feedback of the unsafe fix.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:27 UTC
    </footer>
</body>
</html>
