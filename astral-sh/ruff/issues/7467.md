```yaml
number: 7467
title: "Formatter bug: Required parenthesis around awaited expression are removed"
type: issue
state: closed
author: Avasam
labels:
  - bug
  - formatter
assignees: []
created_at: 2023-09-17T17:34:24Z
updated_at: 2023-09-18T13:56:43Z
url: https://github.com/astral-sh/ruff/issues/7467
synced_at: 2026-01-10T01:56:49Z
```

# Formatter bug: Required parenthesis around awaited expression are removed

---

_Issue opened by @Avasam on 2023-09-17 17:34_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
Parenthesis wrapping multiple expressions should be kept following the `await` keyword. Take this snippet of code for example:
```py
import asyncio
from winsdk.windows.media.capture import MediaCapture
media_capture = MediaCapture()

async def init_mediacapture():
    await (media_capture.initialize_async() or asyncio.sleep(0))
```
Where `initialize_async` returns an awaitable OR `None`
Results in the following when running `ruff format`:
```py
import asyncio
from winsdk.windows.media.capture import MediaCapture
media_capture = MediaCapture()

async def init_mediacapture():
    await media_capture.initialize_async() or asyncio.sleep(0)
```

Which changes the runtime behaviour, as can be seen by calling `asyncio.run(init_mediacapture())` which would now result in either:
```
RuntimeWarning: coroutine 'sleep' was never awaited
  await media_capture.initialize_async() or asyncio.sleep(0)
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
```
or 
```
TypeError: object NoneType can't be used in 'await' expression
```

Ruff version: 0.0.290
Python version: 3.9.13

---

_Assigned to @charliermarsh by @charliermarsh on 2023-09-17 17:49_

---

_Label `bug` added by @charliermarsh on 2023-09-17 17:50_

---

_Label `formatter` added by @charliermarsh on 2023-09-17 17:50_

---

_Comment by @charliermarsh on 2023-09-17 17:50_

Thanks!

---

_Added to milestone `Formatter: Beta` by @MichaReiser on 2023-09-17 18:01_

---

_Referenced in [astral-sh/ruff#7468](../../astral-sh/ruff/pulls/7468.md) on 2023-09-17 18:41_

---

_Closed by @charliermarsh on 2023-09-18 13:56_

---
