<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A005 (builtin module shadowing) should ignore private modules - astral-sh/ruff #12949</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>A005 (builtin module shadowing) should ignore private modules</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12949">#12949</a>
        opened by <a href="https://github.com/jab">@jab</a>
        on 2024-08-17 13:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jab">@jab</a> on 2024-08-17 13:07</div>
            <div class="timeline-body"><p>I just updated from ruff 0.5.0 to 0.6.1, and had to add an ignore for A005 so that ruff check would continue to pass:</p>
<p>https://github.com/jab/bidict/commit/57a0d0b592c2db2d8114452bb6615dcb1d64876e</p>
<p>Without that ignore, it would fail as follows:</p>
<pre><code>❯ pre-commit run --all-files --verbose --show-diff-on-failure ruff
ruff.....................................................................Failed
- hook id: ruff
- duration: 0.01s
- exit code: 1

bidict/_abc.py:1:1: A005 Module `_abc` is shadowing a Python builtin module
Found 1 error.
</code></pre>
<p>This check is failing because it treats even private builtin modules as not-to-be-shadowed, and Python provides a private <code>_abc</code> builtin:</p>
<pre><code>❯ python -c 'import _abc'  # succeeds
</code></pre>
<p>I propose that private modules be excluded from this check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-08-18 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-08-18 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-08-18 22:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:29</div>
            <div class="timeline-body"><p>Note that you can suppress this via https://docs.astral.sh/ruff/settings/#lint_flake8-builtins_builtins-allowed-modules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:30</div>
            <div class="timeline-body"><p>I would say it's reasonable to flag these though. What do you think @AlexWaygood?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jab">@jab</a> on 2024-08-24 19:04</div>
            <div class="timeline-body"><p>While we're waiting for others' feedback, I realized I didn't yet provide rationale for why private modules should be excluded from this check, so here is some:</p>
<p>Quoting from ruff's own https://docs.astral.sh/ruff/rules/import-private-name/ rule:</p>
<blockquote>
<p><a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> states that names starting with an underscore are private. Thus, they are not intended to be used outside of the module in which they are defined. Further, as private imports are not considered part of the public API, they are prone to unexpected changes, especially outside of semantic versioning.</p>
</blockquote>
<p>I'm not sure how much ruff tries to harmonize conflicting rules that users have enabled, but this could be an opportunity to improve harmony.</p>
<p>Also, a lot of the builtin private modules are like <code>_abc</code> (which is where I hit this), in that:</p>
<ul>
<li>they are &quot;claiming&quot; a private name that is general and useful in outside contexts (in the case of <code>_abc</code>, for example, any library that provides its own ABCs might want to put implementation details in its own private <code>_abc.py</code>)</li>
<li>(I put &quot;claiming&quot; in quotes because) they do not intend to be taking these names away from use in outside contexts; the fact that the private names are exported is an accident of implementation (plus Python culture: assume we're all ~~&quot;consenting adults&quot;~~ responsible users)</li>
</ul>
<p>Another interesting observation is that, out of the dozens of private modules in the standard library, https://docs.python.org/3/py-modindex.html documents only two of them, <code>_thread</code> and <code>_tkinter</code>, further suggesting that the others are not intended to be directly imported, and outside contexts should also have those names available for internal use.</p>
<details><summary>Click for list of builtin private modules in Python 3.9, in case it's helpful</summary>

<pre><code>_abc
_aix_support
_ast
_asyncio
_bisect
_blake2
_bootlocale
_bootsubprocess
_bz2
_codecs
_codecs_cn
_codecs_hk
_codecs_iso2022
_codecs_jp
_codecs_kr
_codecs_tw
_collections
_collections_abc
_compat_pickle
_compression
_contextvars
_crypt
_csv
_ctypes
_ctypes_test
_curses
_curses_panel
_datetime
_dbm
_decimal
_elementtree
_functools
_hashlib
_heapq
_imp
_io
_json
_locale
_lsprof
_lzma
_markupbase
_md5
_multibytecodec
_multiprocessing
_opcode
_operator
_osx_support
_peg_parser
_pickle
_posixshmem
_posixsubprocess
_py_abc
_pydecimal
_pyio
_queue
_random
_scproxy
_sha1
_sha256
_sha3
_sha512
_signal
_sitebuiltins
_socket
_sqlite3
_sre
_ssl
_stat
_statistics
_string
_strptime
_struct
_symtable
_sysconfigdata__darwin_darwin
_testbuffer
_testcapi
_testimportmultiple
_testinternalcapi
_testmultiphase
_thread
_threading_local
_tkinter
_tracemalloc
_uuid
_virtualenv
_warnings
_weakref
_weakrefset
_xxsubinterpreters
_xxtestfuzz
_zoneinfo
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jab">@jab</a> on 2024-08-24 19:22</div>
            <div class="timeline-body"><p>All that said, I'm fine with just keeping my...</p>
<pre><code class="language-toml">[tool.ruff.lint.flake8-builtins]
builtins-allowed-modules = [&quot;_abc&quot;]
</code></pre>
<p>config if it's not worth making any changes here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-19 12:53</div>
            <div class="timeline-body"><p>Excluding private modules does make sense to me, considering that there are that many. @AlexWaygood what's your take on this? I would then suggest to make the change so that the rule can be stabilized in the next minor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-11-19 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14505.html">astral-sh/ruff#14505</a> on 2024-11-21 01:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-24 02:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-24 02:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:14 UTC
    </footer>
</body>
</html>
