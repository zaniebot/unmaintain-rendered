<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests using fixtures prefixed with underscore (_) are flagged as violating PT019 - astral-sh/ruff #18119</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Tests using fixtures prefixed with underscore (_) are flagged as violating PT019</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18119">#18119</a>
        opened by <a href="https://github.com/ckutlu">@ckutlu</a>
        on 2025-05-15 13:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ckutlu">@ckutlu</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I would expect</p>
<pre><code class="language-python">import pytest


@pytest.fixture
def _bar():
    return 42


def test_bar_by_foo(_bar):
    assert _bar / 7 == 6
</code></pre>
<p>to pass PT019 because it's using <code>_bar</code> inside <code>test_bar_by_foo</code>, but</p>
<pre><code class="language-sh">ruff --version &amp;&amp; ruff check foo.py
</code></pre>
<p>says</p>
<pre><code>ruff 0.11.8
foo.py:9:21: PT019 Fixture `_bar` without value is injected as parameter, use `@pytest.mark.usefixtures` instead
   |
 9 | def test_bar_by_foo(_bar):
   |                     ^^^^ PT019
10 |     assert _bar / 7 == 6
   |

Found 1 error.
</code></pre>
<h3>Version</h3>
<p>ruff 0.11.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-15 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @MichaReiser on 2025-05-15 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-15 18:50</div>
            <div class="timeline-body"><p>This does feel like a false positive since the rule docs say:</p>
<blockquote>
<p>If the test function depends on the fixture being activated, <strong>but does not use it in the test body</strong> or otherwise rely on its return value</p>
</blockquote>
<p>but it's also consistent with the upstream linter:</p>
<pre><code class="language-shell">&gt; uvx --with flake8-pytest-style flake8 try.py
try.py:5:1: PT005 fixture '_bar' returns a value, remove leading underscore
try.py:9:1: PT019 fixture _bar without value is injected as parameter, use @pytest.mark.usefixtures instead
</code></pre>
<p>We don't currently check if the argument is actually used in the function body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-05-15 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-05-15 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/manueljacob">@manueljacob</a> on 2026-01-13 11:38</div>
            <div class="timeline-body"><p>I was very confused by the error message because it was unclear to me what a “fixture without value” might be, especially in a case when the parameter gets passed a value and it’s actually used inside the test.</p>
<h2>Current implementation is based on obsoleted convention</h2>
<p>With the upstream linter, rules PT004 and PT005 check that a fixture’s name begins with an underscore if and only if it doesn’t return a value. These rules were implemented in ruff, but deprecated in 7defc0d136792ee52b24da0077f50cb25e809938 and removed in c4007257132a4be0ea09040acd1a8c86e7a09109 because it “isn't a practice recommended by the pytest community”. The decision was made in #8796.</p>
<p>If I understand #8796 correctly, the point was that the leading underscore should be used for showing whether the fixture is private or not rather than whether it returns a value or not (because these two aspects are orthogonal, it can only be used for either). When we dropped rules PT004 and PT005 for that reason, we should also have dropped rule PT019 as implemented currently.</p>
<h2>Rationale of rule and partial overlap with other rules</h2>
<p>The rationale stated in the <a href="https://github.com/m-burst/flake8-pytest-style/blob/v2.2.0/docs/rules/PT019.md#rationale">upstream rule documentation</a> is “to avoid unused parameters in test functions”. There are other ruff rules that check for unused parameters. In the context of these rules, the leading underscore has a different meaning to the two discussed above: it means that the parameter was intentionally defined <em>although</em> unused. That means that, if a fixture whose name has a leading underscore (whether or not that means it returns a value or is private) is used, these rules won’t trigger. Another issue is that, when these rules trigger, the user is not made aware of the option to use <code>@pytest.mark.usefixtures</code>; therefore, they’ll probably silence these rules for that line.</p>
<p>So it might be valuable to have a rule which is similar to PT019 but checks whether the fixture value is used inside the test function or not instead of whether its name begins with an underscore or not. I am unsure however whether it should be a modification of the existing rule PT019 or a new rule.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-13 12:26:29 UTC
    </footer>
</body>
</html>
