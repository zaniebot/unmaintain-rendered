<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests using fixtures prefixed with underscore (_) are flagged as violating PT019 - astral-sh/ruff #18119</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Tests using fixtures prefixed with underscore (_) are flagged as violating PT019</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18119">#18119</a>
        opened by <a href="https://github.com/ckutlu">@ckutlu</a>
        on 2025-05-15 13:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ckutlu">@ckutlu</a></div>
            <div class="timeline-body">Summary
<p>I would expect</p>
<pre><code>import pytest


@pytest.fixture
def _bar():
    return 42


def test_bar_by_foo(_bar):
    assert _bar / 7 == 6
</code></pre>
<p>to pass PT019 because it&#x27;s using <code>_bar</code> inside <code>test_bar_by_foo</code>, but</p>
<pre><code>ruff --version &amp;&amp; ruff check foo.py
</code></pre>
<p>says</p>
<pre><code>ruff 0.11.8
foo.py:9:21: PT019 Fixture `_bar` without value is injected as parameter, use `@pytest.mark.usefixtures` instead
   |
 9 | def test_bar_by_foo(_bar):
   |                     ^^^^ PT019
10 |     assert _bar / 7 == 6
   |

Found 1 error.
</code></pre>
Version
<p>ruff 0.11.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-15 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-15 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-15 18:50</div>
            <div class="timeline-body"><p>This does feel like a false positive since the rule docs say:</p>
<blockquote>
<p>If the test function depends on the fixture being activated, <strong>but does not use it in the test body</strong> or otherwise rely on its return value</p>
</blockquote>
<p>but it&#x27;s also consistent with the upstream linter:</p>
<pre><code>&gt; uvx --with flake8-pytest-style flake8 try.py
try.py:5:1: PT005 fixture &#x27;_bar&#x27; returns a value, remove leading underscore
try.py:9:1: PT019 fixture _bar without value is injected as parameter, use @pytest.mark.usefixtures instead
</code></pre>
<p>We don&#x27;t currently check if the argument is actually used in the function body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-15 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-15 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/manueljacob">@manueljacob</a> on 2026-01-13 11:38</div>
            <div class="timeline-body"><p>I was very confused by the error message because it was unclear to me what a “fixture without value” might be, especially in a case when the parameter gets passed a value and it’s actually used inside the test.</p>
Current implementation is based on obsoleted convention
<p>With the upstream linter, rules PT004 and PT005 check that a fixture’s name begins with an underscore if and only if it doesn’t return a value. These rules were implemented in ruff, but deprecated in 7defc0d136792ee52b24da0077f50cb25e809938 and removed in c4007257132a4be0ea09040acd1a8c86e7a09109 because it “isn&#x27;t a practice recommended by the pytest community”. The decision was made in #8796.</p>
<p>If I understand #8796 correctly, the point was that the leading underscore should be used for showing whether the fixture is private or not rather than whether it returns a value or not (because these two aspects are orthogonal, it can only be used for either). When we dropped rules PT004 and PT005 for that reason, we should also have dropped rule PT019 as implemented currently.</p>
Rationale of rule and partial overlap with other rules
<p>The rationale stated in the <a href="https://github.com/m-burst/flake8-pytest-style/blob/v2.2.0/docs/rules/PT019.md#rationale">upstream rule documentation</a> is “to avoid unused parameters in test functions”. There are other ruff rules that check for unused parameters. In the context of these rules, the leading underscore has a different meaning to the two discussed above: it means that the parameter was intentionally defined <em>although</em> unused. That means that, if a fixture whose name has a leading underscore (whether or not that means it returns a value or is private) is used, these rules won’t trigger. Another issue is that, when these rules trigger, the user is not made aware of the option to use <code>@pytest.mark.usefixtures</code>; therefore, they’ll probably silence these rules for that line.</p>
<p>So it might be valuable to have a rule which is similar to PT019 but checks whether the fixture value is used inside the test function or not instead of whether its name begins with an underscore or not. I am unsure however whether it should be a modification of the existing rule PT019 or a new rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-13 16:35</div>
            <div class="timeline-body"><p>Thanks for your analysis and comments! I think I agree with you overall that PT019 is outdated. A rule like ARG001 could catch this more reliably because it actually checks for usage of the parameter, but it will give a less specific recommendation, or even a misleading recommendation, if it suggests to prefix the parameter name with an underscore.</p>
<p>I see a couple of options here:</p>
<ul>
<li>retain the PT019 rule code but reuse the ARG001 implementation and choose which of the two rules to emit based on a heuristic (the PT variant in a module that starts with <code>test_</code>, in a function that starts with <code>test_</code>, etc)</li>
<li>deprecate PT019 and customize the ARG001 diagnostic (and docs) based on similar heuristics</li>
</ul>
<p>It seems that we have an existing implementation of this heuristic in <a href="https://github.com/astral-sh/ruff/blob/55a335165ab126d50edb89e775c0c5c340cb8ae3/crates/ruff_linter/src/rules/flake8_pytest_style/helpers.rs#L66"><code>is_likely_pytest_test</code></a>.</p>
<p>But I&#x27;m curious what others think!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:57 UTC
    </footer>
</body>
</html>
