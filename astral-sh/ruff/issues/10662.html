<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F811 Redefinition of unused `foo_fixture` and Pytest - astral-sh/ruff #10662</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>F811 Redefinition of unused `foo_fixture` and Pytest</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10662">#10662</a>
        opened by <a href="https://github.com/arrdem">@arrdem</a>
        on 2024-03-29 19:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/arrdem">@arrdem</a> on 2024-03-29 19:43</div>
            <div class="timeline-body"><ul>
<li><strong>Ruff version:</strong> 0.3.3</li>
<li><strong>Rule:</strong> redefined-while-unused / F811</li>
</ul>
<h3>Ex. foo_test.py</h3>
<pre><code>from .fixtures import foo_fixture

def test_bar_using_foo(foo_fixture):
   with foo_fixture() as foo:
      assert foo.bar() == &quot;baz&quot;
</code></pre>
<p>When pytest runs test code it inspects both the namespaces defined by sibling and parent <code>conftest.py</code> files for fixtures, as well as the namespace of the package containing a given test. This makes it possible (although admittedly not great style) for users to explicitly import fixtures they intend to use so as to make them available to pytest in the module.</p>
<p>Doing so produces spurious instances of F811.</p>
<p>While I wouldn't really expect ruff to do a dynamic analysis to see if the imported entity is marked as <code>@pytest.fixture</code> and while this is an idiom I intend to move the codebase away from, it would be nice if we could at a minimum selectively ignore this error generally within the scope of the tests tree without disabling it generally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-30 00:47</div>
            <div class="timeline-body"><p>This has come up a few times:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/3295</li>
<li>https://github.com/astral-sh/ruff/issues/4046</li>
</ul>
<p>I think the conclusion we came to was that we didn't have a reliable way to detect these without re-implementing a bunch of <code>pytest</code>-specific logic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-03-30 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-01 08:40</div>
            <div class="timeline-body"><blockquote>
<p>it would be nice if we could at a minimum selectively ignore this error generally within the scope of the tests tree without disabling it generally.</p>
</blockquote>
<p>I'm sorry but I'm unable to follow this. Do you want to ignore <code>F811</code> in test files? If so, you could use <a href="https://docs.astral.sh/ruff/settings/#lint_extend-per-file-ignores"><code>lint.extend-per-file-ignores</code></a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arrdem">@arrdem</a> on 2024-04-03 02:33</div>
            <div class="timeline-body"><p>I think this would do what I want --</p>
<pre><code>[tool.ruff.lint.extend-per-file-ignores]
&quot;src/pytests/**/test_*.py&quot; = [&quot;F811&quot;]
&quot;src/pytests/**/*_test.py&quot; = [&quot;F811&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @arrdem on 2024-04-10 19:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
