<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider marking `UP026`'s fix unsafe - astral-sh/ruff #22343</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider marking <code>UP026</code>&#x27;s fix unsafe</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22343">#22343</a>
        opened by <a href="https://github.com/robsdedude">@robsdedude</a>
        on 2026-01-02 18:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/robsdedude">@robsdedude</a></div>
            <div class="timeline-body">Summary
<p>I&#x27;ll quote the readme of the <a href="https://pypi.org/project/mock/"><code>mock</code> package</a>:</p>
<blockquote>
<p>mock is now part of the Python standard library, available as <a href="https://docs.python.org/dev/library/unittest.mock.html">unittest.mock</a> in Python 3.3 onwards.</p>
<p>This package contains a rolling backport of the standard library mock code compatible with Python 3.6 and up.</p>
</blockquote>
<p>So replacing <code>import mock</code> with <code>from unittest import mock</code> is not equivalent given a code-base that&#x27;s on an old-ish Python version but want to use new features of <code>mock</code> and therefore decides to use the stand-alone package. Arguably, such code-base should be disabling the lint, nonetheless does the fix cause a little mayhem first should the rule be enabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-02 23:53</div>
            <div class="timeline-body"><p>Thanks! This makes some sense to me. Out of curiosity, did you run into any specific APIs that didn&#x27;t work in <code>unittest.mock</code>? This is probably not too reliable, but I quickly grepped through the <code>unittest.mock</code> docs and most of the version-related changes were for 3.8 or earlier (<a href="https://docs.python.org/dev/library/unittest.mock.html#unittest.mock.ThreadingMock.DEFAULT_TIMEOUT"><code>DEFAULT_TIMEOUT</code></a> was the one exception I noticed). We could potentially make only fixes touching known-problematic APIs unsafe instead of the whole fix, if it&#x27;s easy to enumerate them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-02 23:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-02 23:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-05 09:55</div>
            <div class="timeline-body"><p>I&#x27;d prefer if we disable the rule for APIs that we know are unavailable on the target version rather than making the fix unsafe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-05 09:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-05 09:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-05 09:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robsdedude">@robsdedude</a> on 2026-01-05 21:19</div>
            <div class="timeline-body"><p>Iirc, ruff only computes lints on a per-file basis. If that&#x27;s the case, it&#x27;s not possible to know where a certain mock object is going to be used. Usually the mock specific methods are being called in the same test function where the mock is being created, but it&#x27;s entirely possible that a helper method in another file is being used to set up the mock or to perform common assertions. In such cases the suggested approach might still break.</p>
<p>Further, this approach easily ends up with a test suite using different mock versions. Besides differences in the API the versions might also differ in behaviour (think fixes). I personally think making ruff introduce a mix of dependency versions where there (hopefully) was none before is a trip hazard.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:43 UTC
    </footer>
</body>
</html>
