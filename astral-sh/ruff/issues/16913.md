```yaml
number: 16913
title: Daily property test run failed on Sat Mar 22 2025
type: issue
state: closed
author: github-actions
labels:
  - bug
  - testing
  - ty
assignees: []
created_at: 2025-03-22T12:12:32Z
updated_at: 2025-03-24T15:37:04Z
url: https://github.com/astral-sh/ruff/issues/16913
synced_at: 2026-01-10T01:56:56Z
```

# Daily property test run failed on Sat Mar 22 2025

---

_Issue opened by @github-actions on 2025-03-22 12:12_

Run listed here: https://github.com/astral-sh/ruff/actions/runs/14008386407

---

_Label `bug` added by @github-actions[bot] on 2025-03-22 12:12_

---

_Label `red-knot` added by @github-actions[bot] on 2025-03-22 12:12_

---

_Label `testing` added by @github-actions[bot] on 2025-03-22 12:12_

---

_Comment by @AlexWaygood on 2025-03-24 14:57_

The failure is:

```
---- types::property_tests::stable::negation_reverses_subtype_order stdout ----

thread 'types::property_tests::stable::negation_reverses_subtype_order' panicked at /home/runner/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (AlwaysFalsy, Union([Intersection { pos: [], neg: [LiteralString] }, AlwaysFalsy]))
```

And I can also reproduce a similar issue locally with:

```
---- types::property_tests::stable::negation_reverses_subtype_order stdout ----

thread 'types::property_tests::stable::negation_reverses_subtype_order' panicked at /Users/alexw/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (AlwaysFalsy, Union([AlwaysFalsy, Intersection { pos: [], neg: [LiteralString] }]))
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

We stabilised this property test in https://github.com/astral-sh/ruff/pull/16801, but it was obviously premature. I ran it for several million iterations locally before stabilising, but it's obviously still sometimes flaky.

I'm not sure we should add more regression tests for `AlwaysTruthy`/`AlwaysFalsy` intersections because we have lots of failing tests already here: https://github.com/astral-sh/ruff/blob/2711e08eb8eb38d1ce323aae0517fede371cba15/crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md?plain=1#L276-L315

But we should add a comment to the property test saying that we should not stabilise the test until those mdtests pass. The `AlwaysTruthy`/`AlwaysFalsy` flakes are obviously very rare on this property test, so we can't rely on local testing to be sure that this one can be stabilised.

---

_Referenced in [astral-sh/ruff#16951](../../astral-sh/ruff/pulls/16951.md) on 2025-03-24 15:09_

---

_Closed by @AlexWaygood on 2025-03-24 15:37_

---
