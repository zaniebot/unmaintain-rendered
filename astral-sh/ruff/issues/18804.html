<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter deindents block quotes if they are not followed by a second paragraph. - astral-sh/ruff #18804</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter deindents block quotes if they are not followed by a second paragraph.</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18804">#18804</a>
        opened by <a href="https://github.com/randolf-scholz">@randolf-scholz</a>
        on 2025-06-19 20:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/randolf-scholz">@randolf-scholz</a></div>
            <div class="timeline-body">Summary
<pre><code>def foo():
    &quot;&quot;&quot;This is an ordinary paragraph, introducing a block quote.

        &quot;It is my business to know things.  That is my trade.&quot;

        -- Sherlock Holmes
    &quot;&quot;&quot;

def bar():
    &quot;&quot;&quot;This is an ordinary paragraph, introducing a block quote.

        &quot;It is my business to know things.  That is my trade.&quot;

        -- Sherlock Holmes

    Another ordinary paragrph.
    &quot;&quot;&quot;
</code></pre>
<p>Gets formatted to</p>
<pre><code>def foo():
    &quot;&quot;&quot;This is an ordinary paragraph, introducing a block quote.

    &quot;It is my business to know things.  That is my trade.&quot;

    -- Sherlock Holmes
    &quot;&quot;&quot;


def bar():
    &quot;&quot;&quot;This is an ordinary paragraph, introducing a block quote.

        &quot;It is my business to know things.  That is my trade.&quot;

        -- Sherlock Holmes

    Another ordinary paragrph.
    &quot;&quot;&quot;
</code></pre>
<p>See: https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html#block-quotes</p>
Version
<p>https://play.ruff.rs/5b2fedac-691c-4adf-9683-68f33e0e90df</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[format] Formatter deindents block quotes if they are not followed by a second paragraph.&quot; to &quot;[BUG] Formatter deindents block quotes if they are not followed by a second paragraph.&quot; by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-06-19 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-19 20:51</div>
            <div class="timeline-body"><p>I think the request here is to support restructured text in docstrings. There are similar requests around preserving other whitespace in docstrings but they all require understanding the docstring semantics</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-19 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-19 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-06-19 20:57</div>
            <div class="timeline-body"><p>A start would be to at least have consistent formatting. The fact that it doesn&#x27;t deindent the block-quote inside <code>bar</code> but does inside <code>foo</code> seems like an internal inconsistency to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-19 21:15</div>
            <div class="timeline-body"><blockquote>
<p>A start would be to at least have consistent formatting. The fact that it doesn&#x27;t deindent the block-quote inside bar but does inside foo seems like an internal inconsistency to me.</p>
</blockquote>
<p>The formatter tries to normalize the indent. The way this is done is by detecting the minimal indent shared by all lines and using that as the base. This currently ignores the indent of the trailing quotes (or any line that&#x27;s all whitespace without content). Whether this should be changed is something we can consider but I&#x27;m sure there are other cases where it would be desired to keep the current behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[BUG] Formatter deindents block quotes if they are not followed by a second paragraph.&quot; to &quot;Formatter deindents block quotes if they are not followed by a second paragraph.&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-28 06:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:07 UTC
    </footer>
</body>
</html>
