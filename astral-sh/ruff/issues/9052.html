<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autofix EM101 - astral-sh/ruff #9052</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Autofix EM101</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9052">#9052</a>
        opened by <a href="https://github.com/kunaltyagi">@kunaltyagi</a>
        on 2023-12-08 04:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 04:49</div>
            <div class="timeline-body"><p>EM101: Exception must not use a string literal, assign to variable first</p>
<p>This seems a simple enough to auto-fix given <a href="https://docs.astral.sh/ruff/rules/raw-string-in-exception/">the example</a></p>
<p>current</p>
<pre><code class="language-py">    raise XYZ(&lt;some-kind-of-string&gt;)
</code></pre>
<p>autofix to:</p>
<pre><code class="language-py">    msg = &lt;some-kind-of-string&gt;
    raise XYZ(msg)
</code></pre>
<ol>
<li>if msg has been previously defined, we could still fail (with an unfixable message) (or try weird names for the variable like message, xyz_msg, xyz_message, error_msg, error_message, etc.)</li>
</ol>
<p>Verified no autofix for:</p>
<ul>
<li>ruff: ruff 0.1.7</li>
<li>python: 3.11</li>
<li>nothing relevant to em101 in pyproject.toml (except selecting &quot;EM&quot;)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 04:51</div>
            <div class="timeline-body"><p>I believe autofix is already supported for this rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 04:56</div>
            <div class="timeline-body"><p>You may need to run with <code>--unsafe-fixes</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-08 04:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-12-08 04:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 04:57</div>
            <div class="timeline-body"><p>I did use --unsafe-fixes but it still didn't fix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:00</div>
            <div class="timeline-body"><p><img src="https://github.com/astral-sh/ruff/assets/2657068/27641039-52c0-4bfc-8f70-f445e2a31721" alt="image" /></p>
<p>And I verified that I was using ruff 0.1.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:00</div>
            <div class="timeline-body"><p>Only F401 is marked as unfixable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 05:00</div>
            <div class="timeline-body"><p>Can you share a complete reproducible example? The rule is typically fixable, as you can see in the <a href="https://play.ruff.rs/408a1766-159f-4d16-ada0-dfaec37ca006">playground</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:03</div>
            <div class="timeline-body"><p>https://play.ruff.rs/9a03509b-9aab-4959-b2c7-beccdfb8b10a</p>
<p>Does this work for you?</p>
<p>(And it's fixing in the playground)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 05:04</div>
            <div class="timeline-body"><p>Yup!</p>
<img width="642" alt="Screen Shot 2023-12-08 at 12 04 00 AM" src="https://github.com/astral-sh/ruff/assets/1309177/5e4cd0dc-c90d-4b31-86d3-774a72ede0d3">

<img width="766" alt="Screen Shot 2023-12-08 at 12 04 04 AM" src="https://github.com/astral-sh/ruff/assets/1309177/a92f01be-2e33-4c7a-9ab7-1cd35d38eae0">

<img width="269" alt="Screen Shot 2023-12-08 at 12 04 11 AM" src="https://github.com/astral-sh/ruff/assets/1309177/7c4a588e-762f-4f32-ba56-e941f59b8f8c">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:06</div>
            <div class="timeline-body"><p>I copied my own code instead of trying to re-create</p>
<p><img src="https://github.com/astral-sh/ruff/assets/2657068/b18c0503-2cb8-4a74-94c3-3b7aeccc9eba" alt="image" /></p>
<p>https://play.ruff.rs/70dcf7e0-23f6-40f4-95cf-670b6b713307</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:10</div>
            <div class="timeline-body"><p>This is a valid repro, right? üòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-08 05:11</div>
            <div class="timeline-body"><p>This is happening because the <code>msg</code> variable is already defined in the current scope and Ruff would generate the fix only if the <code>msg</code> variable is available.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:12</div>
            <div class="timeline-body"><p>But that msg is used to raise an error earlier. It's not on any code-path that leads to this error</p>
<p>If I tried accessing msg, I'd get a big fat error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:14</div>
            <div class="timeline-body"><p>https://play.ruff.rs/1feffa3b-9314-481d-ace9-7a15c5c644e2</p>
<p>Thanks to you, I've created another smaller example where msg is not accessible in the code leading to the raise statement</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-08 05:19</div>
            <div class="timeline-body"><blockquote>
<p>If I tried accessing msg, I'd get a big fat error</p>
</blockquote>
<p>You would be getting a runtime error in that case. This is a limitation of every static analysis tools - it's not possible to determine the path the code will take, <em>statically</em>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2023-12-08 05:20</div>
            <div class="timeline-body"><p>Statically, it's possible to determine if:</p>
<ol>
<li>There's a raise, or return right after the variable</li>
<li>The variable is in the literally different part of <code>if-elif-else</code></li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 05:25</div>
            <div class="timeline-body"><p>Correct but updating the semantic model to support control-flow analysis isn't a current priority. I would say we should just always offer this fix now that it's marked as unsafe anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-08 05:26</div>
            <div class="timeline-body"><p>Yeah, seems reasonable to me üëç</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:32:11 UTC
    </footer>
</body>
</html>
