<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usage of extend-unsafe-fixes = [&quot;ALL&quot;] option - astral-sh/ruff #8404</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Usage of extend-unsafe-fixes = [&quot;ALL&quot;] option</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8404">#8404</a>
        opened by <a href="https://github.com/lukaspiatkowski">@lukaspiatkowski</a>
        on 2023-11-01 14:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/lukaspiatkowski">@lukaspiatkowski</a> on 2023-11-01 14:01</div>
            <div class="timeline-body"><p>This is more of a feature request than a bug. I would like to configure Ruff in a manner that I can apply different set of fixes depending on the context when it is invoked.
Some fixes that ruff has are considered to be &quot;safe&quot; since they don't change the semantic of the code, but they might indicate a typo or a mistake done by the author of code, e.g. the <code>B033 - Sets should not contain duplicate item {value}</code> might just mean that the author mistyped the value they wanted to the set. For those set of rules I would like them to require a manual call to <code>ruff</code>. Lets call them &quot;manual&quot; fixes for now.
Other are quite straightforward (like <code>I001 - Import block is un-sorted or un-formatted</code>), those I would like to be applied by a pre-commit hook automatically even without code authors knowledge. Lets call them &quot;automatic&quot; fixes for now.
An additional feature would be for the Ruff integration with IDE work as expected (at least the VSCode one) - when format-on-save action is invoked the &quot;automatic&quot; rules are applied, but not the &quot;manual&quot; ones. It would be nice though to be still able to fix the &quot;manual&quot; ones with a Quick Fix action.</p>
<p>There are two solutions I was thinking of how I could achieve this:</p>
<ul>
<li>Use <code>fixable/extend-fixable</code> configs to set it to include only the &quot;automatic&quot; fixes. In order to call the &quot;manual&quot; fixes <code>ruff</code> will have to be called with <code>--fixable ALL</code>. The disadvantage of this is that IDE doesn't pick up the Quick Fix action for &quot;manual&quot; fixes as they are unfixable.</li>
<li>Use <code>extend-safe-fixes/extend-unsafe-fixes</code> to mark all &quot;automatic&quot; fixes as safe and &quot;manual&quot; fixes as unsafe. In order to call the &quot;manual&quot; fixes <code>ruff</code> will have to be called with <code>--unsafe-fixes</code> and the IDE integration works as expected. The problem with this approach is that it isn't easy to maintain the config. It would be ideal to write:</li>
</ul>
<pre><code>extend-unsafe-fixes = [&quot;ALL&quot;]
extend-safe-fixes = [
  &quot;I001&quot;, # isort
  &quot;F401&quot;, # remove unused imports
  &quot;UP&quot;,   # pyupgrade
]
</code></pre>
<p>But this doesn't work on 0.1.3 - all fixes are marked as unsafe and the <code>extend-safe-fixes</code> is essentially ignored.</p>
<p>Could you please either reverse the precedence of those configs or make it smarter? E.g. more specialized &quot;UP&quot; overrides &quot;ALL&quot; and &quot;F401&quot; overrides &quot;F&quot;? It is unclear to me though how this would work with the <code>extend = &quot;&lt;other config&gt;&quot;</code> option that we are also a heavy user of.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspiatkowski">@lukaspiatkowski</a> on 2023-11-01 14:20</div>
            <div class="timeline-body"><p>Another suggestion would be to add a <code>safe-fixes</code> config that when unset would default to the current behavior, but if set to <code>safe-fixes = [&quot;ALL&quot;]</code> or <code>safe-fixes = [ ]</code> would change the base to be all fixes are safe or no fixes are safe respectively. Then apply the <code>extend-*</code> configs on top of that. This matches the <code>select</code> and <code>extend-select</code> behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-01 16:36</div>
            <div class="timeline-body"><p>Hm.. <code>extend-unsafe-fixes</code> takes precedence over <code>extend-safe-fixes</code> because we would rather err on the side of caution if someone uses both. We can update that to take into account the <em>specificity</em> of the selectors you've provided though, that's how other configuration options work.</p>
<p>Are you interested in contributing? Otherwise I can take a look at it.</p>
<p>re <code>safe-fixes</code> I'd prefer not to add another configuration option yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2023-11-01 16:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2023-11-01 16:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspiatkowski">@lukaspiatkowski</a> on 2023-11-02 10:31</div>
            <div class="timeline-body"><p>Sorry for not giving you an answer straight away @zanieb, I wasn't sure if I will have time to write the PR, but in the end I did.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-11-07 16:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:50 UTC
    </footer>
</body>
</html>
