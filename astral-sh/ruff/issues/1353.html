<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Option to enable the fixable errors only? - astral-sh/ruff #1353</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Option to enable the fixable errors only?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1353">#1353</a>
        opened by <a href="https://github.com/davegaeddert">@davegaeddert</a>
        on 2022-12-23 17:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-23 17:52</div>
            <div class="timeline-body"><p>Is there an option to easily enable all the error codes that are fixable (and disable the non-fixable ones)?</p>
<p>Something like:</p>
<pre><code class="language-sh">ruff --select-fixable
</code></pre>
<p>Basically I'm looking at pairing this with black in a <code>format</code> command, so <code>black --check</code> and <code>ruff --select-fixable</code> could run together as <code>format --check</code>, and then <code>black</code> and <code>ruff --fix --select-fixable</code> could run together as <code>format</code> without failing on all the other ruff errors that have to be manually fixed (those will be show to the user at a different time)... Just wondering if there's an easier way to select them all than <code>ruff --select A --select B</code> etc.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-12-23 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2022-12-23 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-23 17:56</div>
            <div class="timeline-body"><p>Another way to look at this could be to add a <code>ruff fix</code> command that fixes anything that's fixable, but doesn't report on remaining errors.</p>
<p>(One thing that could be useful here in the interim is the <code>--exit-zero</code> flag? That way, Ruff at least won't fail if it detects errors after fixing.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-23 18:22</div>
            <div class="timeline-body"><p>I like the <code>ruff fix</code> idea — when thinking about this, I did run <code>ruff --fix</code> wondering if it would show/exit the other unfixable errors or not (honestly wasn't sure which way it would go). If <code>ruff fix</code> were a command, personally I'd want to see <code>ruff fix --check</code> then to also get the &quot;error if there are potential fixes&quot; behavior. Having <code>ruff fix --check</code> would also align pretty well with how black, isort, etc. are used. Whatever you prefer is good by me! Kinda cool that it only has one command currently :)</p>
<p>At least personally, I'm ok without the <code>--exit-zero</code> flag I think. I can ignore the error code and just assume it wasn't a &quot;real&quot; error for now... either way it will still have same stdout which is almost the bigger issue for my particular use case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../dropseed/forge/pulls/57.html">dropseed/forge#57</a> on 2022-12-23 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-25 05:10</div>
            <div class="timeline-body"><p>Maybe it's a flag like <code>ruff --fix-only</code> instead of <code>ruff --fix</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1375.html">astral-sh/ruff#1375</a> on 2022-12-25 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-25 23:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-26 17:13</div>
            <div class="timeline-body"><p>Thanks for merging something! The <code>--fix-only</code> flag helps, but is there any combination of options that lets you report the fixable errors <em>without</em> fixing them? I think the other ideas allowed for that, but not sure with <code>--fix-only</code>. Examples on the others:</p>
<pre><code class="language-sh">ruff fix --check
ruff fix
</code></pre>
<pre><code class="language-sh">ruff --select-fixable
ruff --select-fixable --fix
</code></pre>
<pre><code class="language-sh">??
ruff --fix-only
</code></pre>
<p>Random other thing — I tested it real quick and looks like <code>--fix-only</code> has the potential to mask a major goof where the target files/dir doesn't exist:
<img src="https://user-images.githubusercontent.com/649496/209570501-b75270a8-08eb-4575-b277-dbb44c6683c4.png" alt="CleanShot 2022-12-26 at 11 02 26" /></p>
<p>Appreciate your work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 17:20</div>
            <div class="timeline-body"><p>Oh maybe I misunderstood. Can you provide a bit more context on when it'd be useful to report fixable errors without fixing them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-26 18:37</div>
            <div class="timeline-body"><p>Yep, sorry. I've got a <code>forge format</code> command that runs a combination of formatters (now just black and ruff):
https://github.com/forgepackages/forge/blob/90ff92c85180cf91969d07d76f9a42555a492b0d/forge/cli.py#L131-L137</p>
<p>It has a <code>--check</code> option which was passed through to black and isort (which ruff replaces). With ruff I just couldn't find an easy way to &quot;check&quot; the potential autofixes. The <code>--fix-only</code> situation is certainly related, but for me it actually stemmed from the &quot;check&quot; part first which isn't solved yet. Does that help?</p>
<p>If you want to stop here though, I think that's totally fine — <code>--fix-only</code> is helpful and I'm realizing now that since I use <em>all</em> of the ruff checks in <code>forge pre-commit</code> anyway (https://github.com/forgepackages/forge/blob/90ff92c85180cf91969d07d76f9a42555a492b0d/forge/cli.py#L108-L110), I can maybe just remove the <code>forge format --check</code> option (which is what <code>forge pre-commit</code> used to leverage, and I don't really need available to users).</p>
<p>Anyway, pulling you into my problems now but I think you can consider this closed if you want! I do think the missing file/dir bug is legit though, and I can open a separate issue for that if you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 18:47</div>
            <div class="timeline-body"><p>Ahh, I see, ok. I guess, separately from <code>--fix-only</code>, we could have <code>ruff --fix --check</code> that exits 1 if there's anything to change (but doesn't report anything)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 19:04</div>
            <div class="timeline-body"><p>I'm imagining:</p>
<ul>
<li><code>ruff --check</code> (don't print anything, just exit 1 if there are any errors)</li>
<li><code>ruff --fix --check</code> (don't print anything, just exit 1 if there's anything fixable)</li>
<li><code>ruff --fix-only</code> (fix errors and exit)</li>
<li><code>ruff --fix-only --check</code> (same as <code>ruff --fix --check</code>)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 19:36</div>
            <div class="timeline-body"><p>I guess I'm not sure how <code>ruff --fix --check</code> should behave (<code>ruff --check</code> and <code>ruff --fix-only --check</code> have clearer semantics).</p>
<p>Should it exit with a non-zero status code if anything is fixable, or if there are any errors?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 19:41</div>
            <div class="timeline-body"><p>@andersk - Without reading this entire thread, do you have any gut reaction to what you'd expect <code>ruff --check</code>, <code>ruff --fix --check</code>, and <code>ruff --fix-only --check</code> to do?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-26 19:41</div>
            <div class="timeline-body"><p>I'm realizing some of this may have to do with how ruff works, but personally I think it'd be more helpful to give some context on <code>--check</code> (and on <code>--fix/--fix-only</code>). As a user, when I use black I always appreciate it listing out the files it would/did change (easier to compare to <code>git status</code>, etc.):
<img src="https://user-images.githubusercontent.com/649496/209578820-b61eca5b-27be-4341-a018-fae04e92553a.png" alt="CleanShot 2022-12-26 at 13 35 39" /></p>
<p>But honestly, my problem is solved! Happy to give more feedback but don't feel like you have to force it on my behalf. In some ways I almost lean back towards one of the original suggestions of <code>--select-fixable</code>, or <a href="https://github.com/charliermarsh/ruff/issues/1357#issuecomment-1364773515">based on this issue about <code>ALL</code></a>, maybe <code>--select FIXABLE</code>? I feel like that would give you all combinations of uses?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-26 19:43</div>
            <div class="timeline-body"><p>Whoops, just saw your latest comments. FWIW, I agree that <code>--check</code> is sort of unclear... feels like it already has &quot;check&quot; behavior by default due to (mostly) being a linter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 19:45</div>
            <div class="timeline-body"><p>It could be useful, because right now, <code>--fix</code> will actually write the fixes to disk. <code>--check</code> could be useful to detect that there are fixes to commit, without actually writing to disk. That's how I view it. But I'm def worried that I'm introducing too many CLI arguments here and making things more confusing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-26 19:56</div>
            <div class="timeline-body"><p>Yeah, I'm just saying that <code>ruff --check</code> is potentially confusing to me because it wouldn't write fixes anyway (no <code>--fix</code>), so it seems like a strange combination of options (would make more sense to me as <code>ruff fix --check</code> and not an option on <code>ruff</code>, but don't know if a new command is desirable...). Why would you want use <code>ruff --check</code> over just <code>ruff</code> (same thing, less output)?</p>
<p>Does a special select make any sense, like you suggested in that other issue? Then you'd only be adding one option value (if you removed <code>--fix-only</code>) and have:</p>
<ul>
<li><code>ruff --select FIXABLE</code> (check for fixes)</li>
<li><code>ruff --select FIXABLE --fix</code> (run fixes, don't report anything else)</li>
<li><code>ruff --fix</code> (current behavior, fix and report other errors)</li>
</ul>
<p>So you could have select <code>ALL</code>, <code>FIXABLE</code>, <code>UNFIXABLE</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-26 20:10</div>
            <div class="timeline-body"><p>Yeah, the only issue with <code>FIXABLE</code> is that some codes are marked as <code>fixable</code>, but can't be fixed in all cases. For example, the check that converts <code>TypedDict</code> to use the class-based syntax (<code>class Foo(TypedDict): ...</code>) is fixable, but we can't fix cases in which you use property names that aren't valid class property identifiers. So there <em>is</em> a list of fixable codes, but it's not <em>always</em> true that errors tied to those codes can actually be fixed due to these edge cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2022-12-26 20:28</div>
            <div class="timeline-body"><p>Ah, good to know! If you ran <code>ruff --select FIXABLE --fix</code> and it couldn't fix something, I guess I wouldn't be too surprised then if it reported one of those edge case errors (&quot;fixed X errors, couldn't fix 1&quot;)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2022-12-26 20:41</div>
            <div class="timeline-body"><blockquote>
<p>@andersk - Without reading this entire thread, do you have any gut reaction to what you'd expect <code>ruff --check</code>, <code>ruff --fix --check</code>, and <code>ruff --fix-only --check</code> to do?</p>
</blockquote>
<p>My first reaction was that <code>ruff --check</code> sounds like what <code>ruff</code> already does, but since that’s clearly wrong, I was reminded of <code>black --check</code>, which sounds like what <code>ruff --silent</code> already does, but is different in the <code>--fix</code> case.</p>
<p>By analogy, <code>ruff --fix --check</code> would exit with failure if <code>ruff --fix</code> would change anything. There’s still a question as to whether it would exit with failure if <code>ruff --fix</code> would report errors. If so, it would be equivalent to <code>ruff --check</code> and <code>ruff --silent</code>, so that’s probably wrong; if not, it would be equivalent to <code>ruff --fix-only --check</code>.</p>
<p>From reading the thread now, it looks like I mostly got it right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2022-12-26 20:56</div>
            <div class="timeline-body"><p>If we’re analogizing <code>ALL</code>, <code>--select FIXABLE</code> sounds like it would select fixable rules from Ruff’s <em>entire list of rules</em>, regardless of whether they’re enabled in the current configuration. That doesn’t seem like desirable behavior (maybe it’s useful in the form of <code>--ignore UNFIXABLE</code>?). But if that isn’t the behavior and it instead magically depends on the current configuration, then some funny circular reasoning is needed to figure out what <code>--select FIXABLE,F401,F402</code> would mean.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davegaeddert">@davegaeddert</a> on 2023-01-04 18:26</div>
            <div class="timeline-body"><p>I think I saw somewhere that you were messing with a <code>--diff</code> flag? Would that be an alternative to <code>--check</code> that is a little less ambiguous (i.e. you can only diff fixes)?</p>
<ul>
<li><code>ruff --fix --diff</code> - run checks and show diffs for fixes w/o applying them</li>
<li><code>ruff --fix-only --diff</code> - show diffs for fixes w/o applying them (exit failure if there are available fixes)</li>
<li><code>ruff --diff</code> - doesn't change behavior at all</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-04 19:26</div>
            <div class="timeline-body"><p>Oh yeah, that does exist already. I have to look and see how the exit codes work but I believe it’s as-described above.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:03 UTC
    </footer>
</body>
</html>
