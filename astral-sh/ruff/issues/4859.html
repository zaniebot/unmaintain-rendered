<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF001-RUF003 reports words composed entirely of non-ascii characters - astral-sh/ruff #4859</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF001-RUF003 reports words composed entirely of non-ascii characters</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4859">#4859</a>
        opened by <a href="https://github.com/Fogapod">@Fogapod</a>
        on 2023-06-05 07:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Fogapod">@Fogapod</a></div>
            <div class="timeline-body"><p>It looks like <a href="https://github.com/charliermarsh/ruff/pull/4552">charliermarsh/ruff#4552</a> attempted to partially fix this but there are still a lot of false positives.</p>
<p>I&#x27;m not sure what attacks these rules are supposed to mitigate so this might work as intended but here are a few examples from our codebase with lots of cyrillic comments/examples:</p>
<pre><code># single char reported
# информация о пользователе     ■ Comment contains ambiguous `о` (CYRILLIC SMALL LETTER O). Did you mean `o` (LATIN SMALL LETTER O)?
# Если с момента     ■ Comment contains ambiguous `с` (CYRILLIC SMALL LETTER ES). Did you mean `c` (LATIN SMALL LETTER C)?
# даже если у него нет видео.     ■ Comment contains ambiguous `у` (CYRILLIC SMALL LETTER U). Did you mean `y` (LATIN SMALL LETTER Y)?

# not reported
# очень
# оно
# темно

# entire word is reported
# получение ВСЕХ     ■■■■ Comment contains ambiguous `Х` (CYRILLIC CAPITAL LETTER HA). Did you mean `X` (LATIN CAPITAL LETTER X)?
# ссылка на его ID     ■■■ Comment contains ambiguous `о` (CYRILLIC SMALL LETTER O). Did you mean `o` (LATIN SMALL LETTER O)?
</code></pre>
<p>Can ruff improve something here or our only option is to disable RUFF001-RUF003? vscode had some setting to whitelist languages, not sure if it could work with ruff well</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-05 13:10</div>
            <div class="timeline-body"><p>Hmm, I think these are consistent with VS Code (although VS Code only seems to flag strings, and not comments):</p>
<img alt="Screen Shot 2023-06-05 at 9 09 12 AM" src="https://github.com/charliermarsh/ruff/assets/1309177/058a32ef-04de-45e2-8462-fb659ad62a4d">

<p>We do have a setting to allow certain characters: <a href="https://beta.ruff.rs/docs/settings/#allowed-confusables"><code>allowed-confusables</code></a>. So maybe you can add those characters to that list?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-05 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Fogapod">@Fogapod</a> on 2023-06-05 13:22</div>
            <div class="timeline-body"><p>Didn&#x27;t notice that setting, this is what i used for now:
<code>allowed-confusables = [&quot;а&quot;, &quot;А&quot;, &quot;б&quot;, &quot;Б&quot;, &quot;в&quot;, &quot;В&quot;, &quot;г&quot;, &quot;Г&quot;, &quot;е&quot;, &quot;Е&quot;, &quot;з&quot;, &quot;З&quot;, &quot;и&quot;, &quot;И&quot;, &quot;к&quot;, &quot;К&quot;, &quot;м&quot;, &quot;М&quot;, &quot;н&quot;, &quot;Н&quot;, &quot;о&quot;, &quot;О&quot;, &quot;р&quot;, &quot;Р&quot;, &quot;с&quot;, &quot;С&quot;, &quot;у&quot;, &quot;У&quot;, &quot;ф&quot;, &quot;Ф&quot;, &quot;х&quot;, &quot;Х&quot;]</code>
Works perfectly. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Fogapod">@Fogapod</a> on 2023-06-05 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Fogapod">@Fogapod</a> on 2023-06-05 13:26</div>
            <div class="timeline-body"><p>Right after closing this I noticed that this is not perfect, this is an example of code with mixed language that I&#x27;d want to catch but allowed-confusables ignores it: <code>f&quot;Сache or database waiting error, total {self.MAX_WAITING_ATTEMPTS} attempts&quot;</code> (first С is cyrillic)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/Fogapod">@Fogapod</a> on 2023-06-05 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-05 15:47</div>
            <div class="timeline-body"><p>I&#x27;m just not sure that this is a solvable problem given the examples above. How would we avoid flagging this, from your initial comment:</p>
<pre><code># получение ВСЕХ     ■■■■ Comment contains ambiguous `Х` (CYRILLIC CAPITAL LETTER HA). Did you mean `X` (LATIN CAPITAL LETTER X)?
</code></pre>
<p>But continue to flag this:</p>
<pre><code># First X is the &quot;CYRILLIC CAPITAL LETTER HA&quot;.
# Хbox
</code></pre>
<p>It&#x27;s the same as the &quot;Cache&quot; example above.</p>
<p>Are the examples you provided in the first comment realistic, or were they included just to describe the behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Fogapod">@Fogapod</a> on 2023-06-05 15:58</div>
            <div class="timeline-body"><p>All of my examples are taken from existing code. There are so many that the only solutions are to disable rules 1-3 or to whitelist half of alphabet which almost defeats the purpose.</p>
<p>My expectations about the rules might be wrong because I initially thought they detect combinations of characters from different languages in a suspicious manner but it&#x27;s actually way simpler. This should probably be handled by text editor, maybe a spell checker, outside ruff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-06 00:55</div>
            <div class="timeline-body"><p>Yeah, I think I need to close this as &quot;working as intended&quot; for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-06 00:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:37 UTC
    </footer>
</body>
</html>
