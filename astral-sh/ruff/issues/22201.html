<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warn or autofix &quot;return &lt;Exception&gt;&quot; - astral-sh/ruff #22201</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Warn or autofix &quot;return &quot;</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22201">#22201</a>
        opened by <a href="https://github.com/andrewwillowen">@andrewwillowen</a>
        on 2025-12-26 06:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andrewwillowen">@andrewwillowen</a></div>
            <div class="timeline-body">Summary
<p>I spent an hour today debugging a test with pytest because I didn&#x27;t realize that I had used <code>return TypeError(&#x27;blah&#x27;)</code> when I should have used <code>raise TypeError(&#x27;blah&#x27;)</code>.</p>
<p>I&#x27;m not sure (but willing to be corrected) if there is a case where one would want to <code>return</code> the Exception instead of <code>raise</code> -ing the exception. If there is, then would be good to throw a warning.
If not, then would be better to autofix so that <code>return</code> becomes <code>raise</code> instead.</p>
<p>Closest existing issue I found was <a href="https://github.com/astral-sh/ruff/pull/21571">astral-sh/ruff#21571</a> .</p>
<p>Looks like I&#x27;m using ruff 0.14.10. Happy to provide more info if helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-26 16:11</div>
            <div class="timeline-body"><p>I could have sworn we had a rule for this, but I was probably thinking of <a href="https://docs.astral.sh/ruff/rules/useless-exception-statement/#useless-exception-statement-plw0133">useless-exception-statement (PLW0133)</a>. I&#x27;ll put <code>needs-decision</code> on this for now to give others a chance to weigh in (cc @amyreese), but this makes sense to me as a new rule!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-29 09:46</div>
            <div class="timeline-body"><p>One use case where one might want to return an error are error factories like:</p>
<pre><code>def error_for_status(code: int) -&gt; HTTPError:
    match code:
        case 404:
            return NotFoundError(&quot;Not found&quot;)
        case 403:
            return ForbiddenError(&quot;Forbidden&quot;)
        case _:
            return HTTPError(f&quot;HTTP {code}&quot;)
</code></pre>
<p>This is also something a type checker can easily detect, though it might still make sense to treat it as a separate rule for functions without a return type annotation, that don&#x27;t override any parent method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-29 13:44</div>
            <div class="timeline-body"><p>We could also limit the check to functions that return both an exception and a non-exception. That&#x27;s similar to what <a href="https://docs.astral.sh/ruff/rules/implicit-return-value/#implicit-return-value-ret502">implicit-return-value (RET502)</a> and <a href="https://docs.astral.sh/ruff/rules/implicit-return/#implicit-return-ret503">implicit-return (RET503)</a> do for <code>None</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pjonsson">@pjonsson</a> on 2025-12-30 11:43</div>
            <div class="timeline-body"><p>I know I have written code in the last couple of years that returns an exception for the failure cases, and something else for success (morally an <code>Either</code> type). That put the complicated &quot;decoding&quot; logic in one place, and callers could then raise the exception where it made sense.</p>
<p>I don&#x27;t see why the factory example or my example would be bad code, but if it&#x27;s enough to add a type signature to avoid warnings I guess it doesn&#x27;t really matter if Ruff warns on everything that looks even vaguely unintentional.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:43 UTC
    </footer>
</body>
</html>
