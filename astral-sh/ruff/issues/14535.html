<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>More rules out of stub author's control - astral-sh/ruff #14535</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>More rules out of stub author's control</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14535">#14535</a>
        opened by <a href="https://github.com/SamuelT-Beslogic">@SamuelT-Beslogic</a>
        on 2024-11-22 17:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/SamuelT-Beslogic">@SamuelT-Beslogic</a> on 2024-11-22 17:13</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Ruff 0.8.0 ignores <code>ambiguous-variable-name (E741)</code> automatically in pyi files. This prompted me to look at other rules I disable specifically for <code>.pyi</code> files and found the following which I think should apply in all cases:</p>
<ul>
<li><code>PLR0904</code> https://docs.astral.sh/ruff/rules/too-many-public-methods/</li>
<li><code>PLR0913</code> https://docs.astral.sh/ruff/rules/too-many-arguments/</li>
<li><code>PLR0917</code> https://docs.astral.sh/ruff/rules/too-many-positional-arguments/</li>
<li><code>PLW3201</code> https://docs.astral.sh/ruff/rules/bad-dunder-method-name/</li>
<li><code>SLOT</code> https://docs.astral.sh/ruff/rules/#flake8-slots-slot</li>
<li><code>FBT</code> https://docs.astral.sh/ruff/rules/#flake8-boolean-trap-fbt</li>
<li>Possibly some of <code>A</code> https://docs.astral.sh/ruff/rules/#flake8-builtins-a</li>
<li>Maybe <code>PLC2701</code> https://docs.astral.sh/ruff/rules/import-private-name/</li>
</ul>
<p>I haven't gone back and validated if these still trigger in stub files since I added them to <a href="https://github.com/BesLogic/shared-configs/blob/main/ruff.toml">our shared config</a>, sorry if I tagged a rule that's already ignored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-22 17:26</div>
            <div class="timeline-body"><p>Thanks! Your analysis all seems correct to me. I'd happily accept PRs disapplying these rules to stub files.</p>
<p>For E741 we were quite cautious, and made the change preview-only for several minor releases before stabilising the change. I don't think we need to be as cautious this time around. Our <a href="https://docs.astral.sh/ruff/versioning/">versioning policy</a> states that it's fine to apply changes in patch releases if they reduce scope (and these <em>would</em> be reductions in scope); we only need to wait for a minor release if a change increases the scope of a rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-11-22 17:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @AlexWaygood on 2024-11-22 17:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @AlexWaygood on 2024-11-22 17:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-22 21:09</div>
            <div class="timeline-body"><p>The linked PR is for all but the last two bullets since those were suggested with less oomph ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-11-24 08:14</div>
            <div class="timeline-body"><p>@dylwil3 Is this issue resolved or is there something left to be done?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-24 12:48</div>
            <div class="timeline-body"><p>I leave that to @Samuel-Therrien-Beslogic to decide - as I said, I did not do anything regarding the last two bullet points. So it depends on whether there is interest in continuing to discuss those items.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SamuelT-Beslogic">@SamuelT-Beslogic</a> on 2024-11-24 18:32</div>
            <div class="timeline-body"><p>Thanks @dylwil3 !</p>
<p>For <code>PLC2701</code>, I think that some users may still want a warning about using private names that are subject to change and suddenly break a stub, as per:</p>
<blockquote>
<p>Further, as private imports are not considered part of the public API, they are prone to unexpected changes, especially outside of semantic versioning.</p>
<p>Instead, consider using the public API of the module.</p>
</blockquote>
<p>But also</p>
<blockquote>
<p>This rule ignores private name imports that are exclusively used in type annotations. Ideally, types would be public; however, this is not always possible when using third-party libraries.</p>
</blockquote>
<p>(that last sentence is why I've been ignoring it, since more often then not there's no alternatives other than re-writing Aliases, TypeVars and Protocols)</p>
<p>So I'm not 100% convinced either way whether this should be disabled for everyone.</p>
<hr />
<p><code>flake8-builtins (A)</code></p>
<p>The following I'm pretty sure should be disabled in stubs:</p>
<ul>
<li><code>A002</code> https://docs.astral.sh/ruff/rules/builtin-argument-shadowing/</li>
<li><code>A003</code> https://docs.astral.sh/ruff/rules/builtin-attribute-shadowing/</li>
<li><code>A005</code> https://docs.astral.sh/ruff/rules/builtin-module-shadowing/</li>
</ul>
<p>As for the rest:</p>
<ul>
<li><code>A001</code> https://docs.astral.sh/ruff/rules/builtin-variable-shadowing/
This could happen with aliases and other top-level variables. Non-runtime type aliases should be private in the first place. Devs also shouldn't try to import builtins from a module that happens to import said builtin. And finally this rule mostly tries to protect against <em>using</em> the shadowed variable. In a typing-only context, you should mostly be guarded by type tests anyway.
I think this should be ignored in stubs.</li>
<li><code>A004</code> https://docs.astral.sh/ruff/rules/builtin-import-shadowing/
Very similar as <code>A001</code> but can actually be worked around with import aliases and re-export aliases. (which would trigger <code>A001</code> instead)</li>
<li><code>A006</code> https://docs.astral.sh/ruff/rules/builtin-lambda-argument-shadowing/
I don't think lambdas apply to type stubs anyway. Probably doesn't need to be ignored.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/harahu">@harahu</a> on 2024-12-04 10:54</div>
            <div class="timeline-body"><p>Just wanted to chime in and say that most if not all of the <a href="https://docs.astral.sh/ruff/rules/#pep8-naming-n">pep8-naming (N)</a> rules should probably not be applied to stub files either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-12-24 21:33</div>
            <div class="timeline-body"><p>I did an experiment where I enabled nearly all rules in typeshed, and here's what I found typeshed would disable in PYI files (that isn't just an opinionated matter): https://github.com/Avasam/typeshed/pull/39/files#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711</p>
<ul>
<li><code>pep8-naming (N)</code>: As @harahu just mentioned, most pep8-naming rules don't apply for third-party stubs<ul>
<li><strong>But</strong> relevant rules could be made to apply to names decorated with <code>@type_check_only</code>, since that's a clear signal the stub author is very likely in control of that name.</li>
<li><code>N811</code>, <code>N812</code>, <code>N813</code>, <code>N814</code>, <code>N817</code> are probably fine in stubs, as long as the name isn't re-exported (in <code>__all__</code>, or <code>var = var</code>)</li>
</ul>
</li>
<li><code>A001</code>, <code>A002</code>, <code>A004</code>: https://github.com/astral-sh/ruff/issues/15293</li>
<li><code>PLC2701</code> as previously mentioned in https://github.com/astral-sh/ruff/issues/14535#issuecomment-2496160152 (that's just my work account, same person here), https://github.com/astral-sh/ruff/issues/15294, https://github.com/astral-sh/ruff/issues/15295</li>
<li><code>PIE796 non-unique-enums</code>: I already raised https://github.com/astral-sh/ruff/issues/15132 for different reasons</li>
<li><code>FURB189 subclass-builtin</code>: https://github.com/astral-sh/ruff/issues/15291 (Stub author should follow runtime superclass when possible)</li>
<li><code>PLW1641 eq-without-hash</code>: https://github.com/astral-sh/ruff/issues/15292 (If runtime doesn't implement <code>__hash__</code>, stubs shouldn't show it as such)</li>
<li><code>flake8-bandit (S)</code><ul>
<li><code>S105</code>, <code>S106</code>, <code>S107</code>: https://github.com/astral-sh/ruff/issues/15206</li>
<li><code>S4</code>: https://github.com/astral-sh/ruff/issues/15207</li>
</ul>
</li>
</ul>
<p>As for opinionated rules: <code>RUF022</code>, <code>RUF023</code>, <code>F403</code>, <code>F405</code> (caught by type-checkers), <code>FURB180</code> (often breaks mypy/stubtest) are disabled for reasons specific to typeshed and can be kept out of this conversation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SamuelT-Beslogic">@SamuelT-Beslogic</a> on 2025-01-06 04:25</div>
            <div class="timeline-body"><p>Closing as all the mentioned rules and groups here now all have an associated PR or issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @SamuelT-Beslogic on 2025-01-06 04:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:35:49 UTC
    </footer>
</body>
</html>
