<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C413 fix is wrong when a newline appears between `sorted` and the opening parenthesis - astral-sh/ruff #15789</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>C413 fix is wrong when a newline appears between <code>sorted</code> and the opening parenthesis</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15789">#15789</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-01-28 16:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body">Description
<p>The fix for <a href="https://docs.astral.sh/ruff/rules/unnecessary-call-around-sorted/"><code>unnecessary-call-around-sorted</code> (C413)</a> in Ruff 0.9.3 can introduce a syntax error or change behavior when a newline appears between <code>sorted</code> and the opening parenthesis.</p>
<p>Syntax error:</p>
<pre><code>$ cat &gt;c413_1.py &lt;&lt;&#x27;# EOF&#x27;
reversed(sorted
(&quot;&quot;))
# EOF

$ ruff --isolated check  --select C413 c413_1.py --unsafe-fixes --fix

error: Fix introduced a syntax error. Reverting all changes.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BFix%20error%5D

...quoting the contents of `c413_1.py`, the rule codes C413, along with the `pyproject.toml` settings and executed command, we&#x27;d be very appreciative!

c413_1.py:1:1: C413 Unnecessary `reversed()` call around `sorted()`
  |
1 | / reversed(sorted
2 | | (&quot;&quot;))
  | |_____^ C413
  |
  = help: Remove unnecessary `reversed()` call

Found 1 error.
[*] 1 fixable with the --fix option.
</code></pre>
<p>Changed behavior:</p>
<pre><code>$ cat &gt;c413_2.py &lt;&lt;&#x27;# EOF&#x27;
x = list(sorted
(&quot;xy&quot;))
print(x)
# EOF

$ python c413_2.py
[&#x27;x&#x27;, &#x27;y&#x27;]

$ ruff --isolated check  --select C413 c413_2.py --unsafe-fixes --fix
Found 1 error (1 fixed, 0 remaining).

$ cat c413_2.py
x = sorted
(&quot;xy&quot;)
print(x)

$ python c413_2.py
&lt;built-in function sorted&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;C413 fix is wrong when a newline appears between `sorted` opening parenthesis&quot; to &quot;C413 fix is wrong when a newline appears between `sorted` and the opening parenthesis&quot; by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-01-28 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-28 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-28 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/dylwil3">@dylwil3</a> by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-29 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-29 17:29</div>
            <div class="timeline-body"><p>Thanks for this! This seems to keep cropping up... maybe worth adding a general edit for removing a function call so we don&#x27;t have to rediscover this logic each time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-30 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-30 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-30 13:11</div>
            <div class="timeline-body"><blockquote>
<p>This seems to keep cropping up... maybe worth adding a general edit for removing a function call so we don&#x27;t have to rediscover this logic each time.</p>
</blockquote>
<p>Didn&#x27;t end up doing this since the fix for this rule used codegen while the fix for the other rule I was thinking of used a text-based edit, so the logic was different.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:23 UTC
    </footer>
</body>
</html>
