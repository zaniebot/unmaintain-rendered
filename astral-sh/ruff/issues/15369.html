<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Add support for unpacking targets in comprehensions - astral-sh/ruff #15369</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Add support for unpacking targets in comprehensions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15369">#15369</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-01-09 08:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>This should be very similar to what was done in the <code>for</code> statement (https://github.com/astral-sh/ruff/pull/15058).</p>
<p><strong>Notes:</strong></p>
<p>One difference between the <code>for</code> statement and comprehension is that the type of value expression needs to be inferred from different scope for the first comprehension. This could be done by extending the <code>UnpackValue</code> enum to include a <code>Comprehension</code> variant with a <code>is_first</code> boolean field.</p>
<p>I'm worried that this logic (https://github.com/astral-sh/ruff/blob/97d95da3ed79a01d780279c4472edc5b9cd357eb/crates/red_knot_python_semantic/src/types/infer.rs#L2964-L2980) would need to be duplicated (1) in <code>infer_comprehension_definition</code> when the target is just a name expression and (2) in <code>Unpacker::unpack</code> to get the unpack value type from the correct scope.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @dhruvmanila on 2025-01-09 08:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-09 08:57</div>
            <div class="timeline-body"><p>I thought this might be &quot;help wanted&quot; issue but it might be a bit difficult without have the relevant context but if anyone's interested in tackling this I'm happy to help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Red Knot Beta" by @carljm on 2025-03-27 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-04-19 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-04-19 01:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:57 UTC
    </footer>
</body>
</html>
