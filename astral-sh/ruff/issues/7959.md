```yaml
number: 7959
title: Excluding a folder containing braces in its name fails
type: issue
state: closed
author: LKajan
labels:
  - question
  - needs-info
assignees: []
created_at: 2023-10-14T11:11:43Z
updated_at: 2024-01-19T19:44:44Z
url: https://github.com/astral-sh/ruff/issues/7959
synced_at: 2026-01-10T01:56:49Z
```

# Excluding a folder containing braces in its name fails

---

_Issue opened by @LKajan on 2023-10-14 11:11_

If folder containing braces in its name is configured to the `extend-exclude` ruff fails to run. `ruff .` produces an error:
```
ruff failed
  Cause: error parsing glob 'C:\Users\<>\cookiecutter-plugin\{{cookiecutter.plugin_package}}': nested alternate groups are not allowed
```

Ruff version: 0.0.292

**My project structure and configuration:**
```
./
├ {{cookiecutter.project_directory}}
├ hooks/
| ├ post_gen_project.py
├ pyproject.toml
```

```toml
# pyproject.toml
[tool.ruff]
extend-exclude = ["{{cookiecutter.plugin_package}}"]
```

---

_Comment by @charliermarsh on 2023-10-14 18:44_

These are globs, so you need to do some escaping:

```toml
[tool.ruff]
extend-exclude = [
  '\{\{cookiecutter.plugin_package\}\}'
]
```

TOML requires single quotes there, I think, but I tested this myself. Let me know if it works for you!

---

_Label `question` added by @charliermarsh on 2023-10-14 18:44_

---

_Label `waiting-on-author` added by @charliermarsh on 2023-10-14 18:44_

---

_Comment by @LKajan on 2023-10-15 10:17_

Unfortunately escaping didn't work.
With `extend-exclude = ['\{\{cookiecutter.plugin_package\}\}']` I'll get an error
```
ruff failed
  Cause: error parsing glob 'C:\{\{cookiecutter.plugin_package\}\}': nested alternate groups are not allowed
```
Please note also the path is now directly under C:\ and not in the workind directory.

---

_Comment by @LKajan on 2023-10-15 10:23_

I found an issue from VS Code with the same error message: https://github.com/microsoft/vscode/issues/194701
So this might be an issue of a upstream library.

---

_Comment by @charliermarsh on 2023-10-16 00:05_

I wonder why the escaping worked fine for me but not for you. I just want to confirm that you used single quotes in the TOML file?

---

_Comment by @LKajan on 2023-10-16 06:13_

> I wonder why the escaping worked fine for me but not for you. I just want to confirm that you used single quotes in the TOML file?

That's what I was wondering too. Could this be an OS dependent? And how come single quotes make the path absolute and not relative?
![image](https://github.com/astral-sh/ruff/assets/1225021/0ac299e6-ca2e-4155-b5b7-e07da7fa1a27)


---

_Comment by @charliermarsh on 2023-10-16 13:37_

I assume so -- I only tested on macOS. I believe the single- vs. double-quotes is part of the TOML spec. Single quotes cause the string to be interpreted as a literal with no escaping at all.

---

_Comment by @T-256 on 2023-10-16 15:33_

For meta-characters escaping in `glob` you must [wrap it in brackets](https://docs.python.org/3/library/glob.html#glob.escape): `[` and `]`
I used this and got expected result:
```toml
extend-exclude = ["[{][{]cookiecutter.plugin_package[}][}]"]
```

---

_Comment by @charliermarsh on 2023-10-16 16:38_

Oh interesting -- @LKajan, can you give that a try?

---

_Comment by @LKajan on 2023-10-17 10:52_

Thanks @T-256 that actually worked!

Should the value be escaped by user or by Ruff? If left to the user's responsibility, then at least this should be documented somehow. Either a clear instructions or at least a reference to a some rigrep/regexp documentation.

---

_Comment by @T-256 on 2023-10-17 11:29_

https://docs.astral.sh/ruff/settings/#extend-exclude :
> For more information on the glob syntax, refer to the [globset documentation](https://docs.rs/globset/latest/globset/#syntax).

In settings page, all of associated options already documented.

---

_Comment by @LKajan on 2023-10-17 11:37_

Thanks for pointing that! I missed that part.

---

_Closed by @LKajan on 2023-10-17 11:37_

---

_Referenced in [astral-sh/ruff#9381](../../astral-sh/ruff/issues/9381.md) on 2024-01-04 16:31_

---

_Comment by @reinout on 2024-01-19 19:44_

I had a hard time getting the `{{` to be accepted by the `[tool.ruff]` section in my `pyproject.toml`.

- I worked around the `{{` problem by using `exclude = ["*cookiecutter.project_name*"]`, as asterixes match the curly braces just fine.
- The errors I got, despite the exclude, were about `{{cookiecutter.project_name}}/pyproject.toml`, which is a special case for which I opened an issue: #9585 

---

_Referenced in [astral-sh/ruff#9585](../../astral-sh/ruff/issues/9585.md) on 2024-05-08 11:52_

---

_Referenced in [tox-dev/toml-fmt#22](../../tox-dev/toml-fmt/issues/22.md) on 2024-12-31 11:23_

---

_Referenced in [astral-sh/ruff#16407](../../astral-sh/ruff/pulls/16407.md) on 2025-02-26 22:17_

---
