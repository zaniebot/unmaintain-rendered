<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pep8-naming N rules fail to find misnamed variables in generator/list comprehensions - astral-sh/ruff #13325</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>pep8-naming N rules fail to find misnamed variables in generator/list comprehensions</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/13325">#13325</a>
        opened by <a href="https://github.com/ember91">@ember91</a>
        on 2024-09-11 11:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 11:12</div>
            <div class="timeline-body"><h2>List of keywords searched for</h2>
<ul>
<li>N816</li>
</ul>
<h2>Minimal code snippet</h2>
<pre><code class="language-python">(someVar1 == 8 for someVar1 in [])
[someVar2 == 8 for someVar2 in []]
someVar3 = 8
</code></pre>
<h2>Invoked command</h2>
<p>This assumes the file with the content above is named <code>test.py</code>.</p>
<pre><code class="language-bash">ruff check --isolated --select N816 test.py
</code></pre>
<h2>Current Ruff settings</h2>
<p>None</p>
<h2>Current Ruff version</h2>
<p><code>0.6.4</code></p>
<h2>Expectations</h2>
<p>I expected all of the lines 1-3 to report error N816, but only line 3 did.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-11 13:31</div>
            <div class="timeline-body"><p>Thanks for the report. The rule <code>N816</code> is only for the global variable names while in your example the <code>someVar1</code> and <code>someVar2</code> variables are in the comprehension. So, only the variables that are in the global scope are checked while a comprehension creates it's own scope.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 13:34</div>
            <div class="timeline-body"><p>Ok. That's my mistake. But still with <code>ruff check --isolated --select N test.py</code> there is no check for this case. Seems like something's missing here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 13:37</div>
            <div class="timeline-body"><p>I tried this with:</p>
<ul>
<li><code>flake8==7.1.1</code></li>
<li><code>pep8-naming==0.14.1</code></li>
</ul>
<p>and got:</p>
<pre><code>test.py:1:21: N816 variable 'someVar1' in global scope should not be mixedCase
test.py:2:21: N816 variable 'someVar2' in global scope should not be mixedCase
test.py:3:2: N816 variable 'someVar3' in global scope should not be mixedCase
</code></pre>
<p>Although I do understand that <code>someVar1</code> and <code>someVar2</code> most likely are not globals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-11 13:46</div>
            <div class="timeline-body"><blockquote>
<p>That's my mistake. But still with <code>ruff check --isolated --select N test.py</code> there is no check for this case. Seems like something's missing here.</p>
</blockquote>
<p>Yeah, I don't think a check like that exists which could mainly be a side effect of having a 1-1 implementation with the original plugin in terms of rules.</p>
<blockquote>
<p>and got:</p>
<pre><code>test.py:1:21: N816 variable 'someVar1' in global scope should not be mixedCase
test.py:2:21: N816 variable 'someVar2' in global scope should not be mixedCase
test.py:3:2: N816 variable 'someVar3' in global scope should not be mixedCase
</code></pre>
<p>Although I do understand that <code>someVar1</code> and <code>someVar2</code> most likely are not globals.</p>
</blockquote>
<p>Interesting, that seems like a bug because, as you mentioned, those variables are not in the global scope. I can't really find an issue in the issue tracker of <code>flake8-naming</code> so I'm not sure why is this the case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 14:29</div>
            <div class="timeline-body"><p>I think that either:</p>
<ul>
<li>Ruff is wrong and the check should be included in N816.</li>
<li>flake8 is wrong according to them and the check should be excluded from N816. They move to another rule or create a new one. Ruff updates for compatibility.</li>
<li>flake8 is right according to them but wrong according to Ruff. Ruff adds a new RUF rule for this.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-11 20:50</div>
            <div class="timeline-body"><p>I think I'd be interested to know why is <code>pep8-naming</code> raising a violation for this scenario when the variable is not in the global scope. There do exist rules for other scopes like <a href="https://docs.astral.sh/ruff/rules/non-lowercase-variable-in-function/">function</a> and <a href="https://docs.astral.sh/ruff/rules/mixed-case-variable-in-class-scope/">class</a>. Ruff's semantic model is aware of the fact that comprehensions create a new scope and it could be that <code>pep8-naming</code> isn't considering that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-12 04:59</div>
            <div class="timeline-body"><p>I created this one to discuss it a bit: https://github.com/PyCQA/pep8-naming/issues/233</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "N816 fails to find misnamed variables in generator/list comprehensions" to "pep8-naming N rules fails to find misnamed variables in generator/list comprehensions" by @ember91 on 2024-09-12 05:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "pep8-naming N rules fails to find misnamed variables in generator/list comprehensions" to "pep8-naming N rules fail to find misnamed variables in generator/list comprehensions" by @ember91 on 2024-09-12 05:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
