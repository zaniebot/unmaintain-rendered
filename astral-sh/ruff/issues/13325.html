<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pep8-naming N rules fail to find misnamed variables in generator/list comprehensions - astral-sh/ruff #13325</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pep8-naming N rules fail to find misnamed variables in generator/list comprehensions</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13325">#13325</a>
        opened by <a href="https://github.com/ember91">@ember91</a>
        on 2024-09-11 11:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ember91">@ember91</a></div>
            <div class="timeline-body">List of keywords searched for
<ul>
<li>N816</li>
</ul>
Minimal code snippet
<pre><code>(someVar1 == 8 for someVar1 in [])
[someVar2 == 8 for someVar2 in []]
someVar3 = 8
</code></pre>
Invoked command
<p>This assumes the file with the content above is named <code>test.py</code>.</p>
<pre><code>ruff check --isolated --select N816 test.py
</code></pre>
Current Ruff settings
<p>None</p>
Current Ruff version
<p><code>0.6.4</code></p>
Expectations
<p>I expected all of the lines 1-3 to report error N816, but only line 3 did.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-11 13:31</div>
            <div class="timeline-body"><p>Thanks for the report. The rule <code>N816</code> is only for the global variable names while in your example the <code>someVar1</code> and <code>someVar2</code> variables are in the comprehension. So, only the variables that are in the global scope are checked while a comprehension creates it&#x27;s own scope.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 13:34</div>
            <div class="timeline-body"><p>Ok. That&#x27;s my mistake. But still with <code>ruff check --isolated --select N test.py</code> there is no check for this case. Seems like something&#x27;s missing here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 13:37</div>
            <div class="timeline-body"><p>I tried this with:</p>
<ul>
<li><code>flake8==7.1.1</code></li>
<li><code>pep8-naming==0.14.1</code></li>
</ul>
<p>and got:</p>
<pre><code>test.py:1:21: N816 variable &#x27;someVar1&#x27; in global scope should not be mixedCase
test.py:2:21: N816 variable &#x27;someVar2&#x27; in global scope should not be mixedCase
test.py:3:2: N816 variable &#x27;someVar3&#x27; in global scope should not be mixedCase
</code></pre>
<p>Although I do understand that <code>someVar1</code> and <code>someVar2</code> most likely are not globals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-11 13:46</div>
            <div class="timeline-body"><blockquote>
<p>That&#x27;s my mistake. But still with <code>ruff check --isolated --select N test.py</code> there is no check for this case. Seems like something&#x27;s missing here.</p>
</blockquote>
<p>Yeah, I don&#x27;t think a check like that exists which could mainly be a side effect of having a 1-1 implementation with the original plugin in terms of rules.</p>
<blockquote>
<p>and got:</p>
<pre><code>test.py:1:21: N816 variable &#x27;someVar1&#x27; in global scope should not be mixedCase
test.py:2:21: N816 variable &#x27;someVar2&#x27; in global scope should not be mixedCase
test.py:3:2: N816 variable &#x27;someVar3&#x27; in global scope should not be mixedCase
</code></pre>
<p>Although I do understand that <code>someVar1</code> and <code>someVar2</code> most likely are not globals.</p>
</blockquote>
<p>Interesting, that seems like a bug because, as you mentioned, those variables are not in the global scope. I can&#x27;t really find an issue in the issue tracker of <code>flake8-naming</code> so I&#x27;m not sure why is this the case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-11 14:29</div>
            <div class="timeline-body"><p>I think that either:</p>
<ul>
<li>Ruff is wrong and the check should be included in N816.</li>
<li>flake8 is wrong according to them and the check should be excluded from N816. They move to another rule or create a new one. Ruff updates for compatibility.</li>
<li>flake8 is right according to them but wrong according to Ruff. Ruff adds a new RUF rule for this.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-11 20:50</div>
            <div class="timeline-body"><p>I think I&#x27;d be interested to know why is <code>pep8-naming</code> raising a violation for this scenario when the variable is not in the global scope. There do exist rules for other scopes like <a href="https://docs.astral.sh/ruff/rules/non-lowercase-variable-in-function/">function</a> and <a href="https://docs.astral.sh/ruff/rules/mixed-case-variable-in-class-scope/">class</a>. Ruff&#x27;s semantic model is aware of the fact that comprehensions create a new scope and it could be that <code>pep8-naming</code> isn&#x27;t considering that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ember91">@ember91</a> on 2024-09-12 04:59</div>
            <div class="timeline-body"><p>I created this one to discuss it a bit: <a href="https://github.com/PyCQA/pep8-naming/issues/233">PyCQA/pep8-naming#233</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;N816 fails to find misnamed variables in generator/list comprehensions&quot; to &quot;pep8-naming N rules fails to find misnamed variables in generator/list comprehensions&quot; by <a href="https://github.com/ember91">@ember91</a> on 2024-09-12 05:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;pep8-naming N rules fails to find misnamed variables in generator/list comprehensions&quot; to &quot;pep8-naming N rules fail to find misnamed variables in generator/list comprehensions&quot; by <a href="https://github.com/ember91">@ember91</a> on 2024-09-12 05:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:57 UTC
    </footer>
</body>
</html>
