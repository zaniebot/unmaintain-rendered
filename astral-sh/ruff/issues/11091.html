<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff rule to remove six - astral-sh/ruff #11091</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff rule to remove six</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11091">#11091</a>
        opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a>
        on 2024-04-22 14:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-04-22 14:49</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Proposal: creation of rules to remove usages of the six module, replacing with the Python 3 only equivalent. This would align with the UP rules, but I don't know if they would be allowed in there or simply into the RUF code. The idea is to have fixable rules for the most common features of six and help people migrate with more confidence. There should also exist a catch-all rule just checking if six was imported.</p>
<ul>
<li><strong>UP900</strong> Deprecate six (not fixable) .<ul>
<li>E.g. <code>import six</code> -&gt; &quot;Usage of six is discouraged on applications not supporting Python 2&quot;</li>
</ul>
</li>
<li><strong>UP901</strong> Replace types (e.g. <code>six.string_types</code>, <code>six.text_type</code>, <code>six.binary_type</code>, <code>six.integer_types</code>) with corresponding Python 3 types.<ul>
<li>E.g.: <code>isinstance(foo, six.string_types)</code> -&gt; <code>isintance(foo, (str,))</code></li>
<li>Note: arguably this is the most used feature of six</li>
</ul>
</li>
<li><strong>UP902</strong> Replace <code>six.iter*</code> with the corresponding method.<ul>
<li>E.g.: <code>for k, v in six.iteritems(foo):</code> -&gt; <code>for k, v in foo.items():</code></li>
</ul>
</li>
<li><strong>UP903</strong> Replace <code>six.print_</code> with <code>print</code>.<ul>
<li>E.g.: <code>six.print_(&quot;hello&quot;)</code> -&gt; <code>print(&quot;hello&quot;)</code></li>
</ul>
</li>
<li><strong>UP904</strong> Replace <code>six.PY2, PY3, ... with direct checks</code>.<ul>
<li>E.g.: <code>if six.PY3:</code> -&gt; <code>if sys.version_info[0] == 3:</code></li>
<li>Note: this is a quite important one because six.PY3 is a source of bugs -- see YTT202</li>
<li>Could also warn the user that the check is no longer be necessary since all code is running on Python 3</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-22 23:56</div>
            <div class="timeline-body"><p>There's some of this in the <code>UP</code> rules already (like <code>UP029</code> removes <code>six.callable</code> and others that are now builtins), but I think I intentionally cut scope on other <code>six</code> rules because I wanted to avoid adding and maintaining complex rules that would only be relevant for one-time 2-to-3 transitions (as opposed to rules that are useful for ongoing Python 3 development).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-22 23:57</div>
            <div class="timeline-body"><p>I'm open to adding some of these selectively under the <code>UP</code> category but it's a bit of a balance -- I don't want to add and maintain a bunch of complex <code>six</code> rules since the value is diminishing over time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-04-23 07:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-04-23 07:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-23 07:09</div>
            <div class="timeline-body"><p>I share the sentiment with @charliermarsh. If the primary target group is python 2 users, then we should not implement the rule according to our rule acceptance guidelines.</p>
<p><code>UP900</code> can be achieved by using <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-tidy-imports_banned-api"><code>banned-api</code></a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-04-23 11:53</div>
            <div class="timeline-body"><p>Hi @charliermarsh and @MichaReiser, thank you for the replies.</p>
<p>The point here is not serve people upgrading from python 2, it is to drop the old compatibility layer many projects kept for a long time even now supporting most modern python versions only.</p>
<p>Same thing with <a href="https://docs.astral.sh/ruff/rules/unicode-kind-prefix/">UP025</a> where you replace &quot;u&quot; prefix of strings which is leftover from years of legacy support.</p>
<p>I have a repo with over 1M LOC of python and it took a while to remove everything, but then I noticed many dependencies still imported six even if they no longer supported python 2.</p>
<p>This means having these rules could speed up projects from dropping this layer (again same purpose as many of the UP rules).</p>
<p>If you feel this doesn't bring enough benefit, you may close the issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eli-schwartz">@eli-schwartz</a> on 2024-05-07 20:03</div>
            <div class="timeline-body"><p>Related:</p>
<p>https://github.com/astral-sh/ruff/pull/2049#discussion_r1090077646
https://github.com/astral-sh/ruff/pull/2332</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eli-schwartz">@eli-schwartz</a> on 2024-05-07 20:05</div>
            <div class="timeline-body"><p>If it's possible to reimplement via more generic rewriting methods that didn't exist at the time, I think that would be quite convenient as IMO the UP rules are mostly a matter for oneshot actions, and six isn't particularly special. I think the only real reason in the past for not covering these rules effectively boiled down to implementation complexity and no one available to do the work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesliu4c">@jamesliu4c</a> on 2024-12-02 21:40</div>
            <div class="timeline-body"><p>What about just the first rule?</p>
<blockquote>
<p>UP900 Deprecate six (not fixable) .
E.g. import six -&gt; &quot;Usage of six is discouraged on applications not supporting Python 2&quot;</p>
</blockquote>
<p>The only things that have to be checked are <code>import six</code> and <code>from six import</code>.</p>
<p>This would be a minimal amount of work to implement and maintain.</p>
<p>It would also be high impact. I implemented this as a Pylint rule in my org. It was an enormous success. We were two years past a migration to Python 3 and had a bunch of <code>six</code> code lying around. We also had a rule that required lint to pass to merge, so within a few months, six was gone from our codebase.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-12-02 22:24</div>
            <div class="timeline-body"><p>@jamesliu4c</p>
<blockquote>
<p>The only things that have to be checked are <code>import six</code> and <code>from six import</code>.</p>
</blockquote>
<p>For that case alone, if you can use <a href="https://docs.astral.sh/ruff/rules/banned-api/#banned-api-tid251">TID251</a> and configure six on <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-tidy-imports_banned-api">banned-api</a> for pyproject.toml</p>
<p>Sometimes I use TID253 if the ban is only on top level imports</p>
<p>By the way, I now agree with the ruff team here as there are other ways to block six and there is low value in maintaining these rules.</p>
<p>IMO this Issue can be closed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesliu4c">@jamesliu4c</a> on 2024-12-02 22:52</div>
            <div class="timeline-body"><p>Oh, that's great. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-12-03 04:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:33:38 UTC
    </footer>
</body>
</html>
