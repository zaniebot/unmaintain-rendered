<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>new rule: variable is assigned and read only one time - astral-sh/ruff #10108</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>new rule: variable is assigned and read only one time</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10108">#10108</a>
        opened by <a href="https://github.com/Tatsh">@Tatsh</a>
        on 2024-02-24 05:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Tatsh">@Tatsh</a> on 2024-02-24 05:49</div>
            <div class="timeline-body"><p>Example:</p>
<pre><code class="language-python">a = heavy_func() # error: Variable is assigned and read only one time
x(a)
</code></pre>
<p>Fixer would replace <code>x(a)</code> with <code>x(heavy_func())</code></p>
<p>This would not trigger:</p>
<pre><code class="language-python">a = heavy_func()
x(a)
y(a)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-02-24 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-24 13:30</div>
            <div class="timeline-body"><p>Hy @Tatsh</p>
<p>Would you mind explaining the motivation for the new rule or why you think using a variable only once is &quot;bad&quot;?</p>
<p>I suspect you prefer inlining simple expressions over having many short-lived variables. This is reasonable to me. I worry that such a lint rule is too aggressive and motivates people to inline even complex expressions that lead to less readable code overall or that the lines become very long, exceeding the configured line width. To avoid this, the rule would need to be able to distinguish between simple and complex expressions, which is in itself a hard problem and it's very likely that each of us has a different understanding of what makes a complex expression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tatsh">@Tatsh</a> on 2024-02-24 17:17</div>
            <div class="timeline-body"><p>It's definitely a personal preference. This is more complex than I thought if we want to figure out the level of complexity.</p>
<p>One approach would be to limit this to assignment and then used on the very next line (not counting comments).</p>
<p>Another approach would be to limit the rule to numbers, strings and function calls with no arguments. Explanation: export the constant or rename the function to something more clear.</p>
<p>Also, I would not want this rule to flag f-strings because prior to 3.12 there are quoting rules that are kind of painful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-24 17:34</div>
            <div class="timeline-body"><p>Thanks for the additional explanation. That helps a lot.</p>
<p>At this point, I fear that the rule is very specific and probably difficult to explain (in which case, users will be confused about why or why not a certain usage is flagged). I'll leave the issue open to see if this is something that more people in the community need.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-02-24 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eli-schwartz">@eli-schwartz</a> on 2024-02-26 02:48</div>
            <div class="timeline-body"><blockquote>
<p>One approach would be to limit this to assignment and then used on the very next line (not counting comments).</p>
<p>Another approach would be to limit the rule to numbers, strings and function calls with no arguments. Explanation: export the constant or rename the function to something more clear.</p>
</blockquote>
<p>The use case of:</p>
<pre><code class="language-python">    msg = 'This is a text message describing the error that has just occurred'
    raise utils.AppnameParserException(msg, location=self.current_node) from exc
</code></pre>
<p>to avoid long lines like:</p>
<pre><code class="language-python">    raise utils.AppnameParserException('This is a text message describing the error that has just occurred', location=self.current_node) from exc
</code></pre>
<p>violates both your heuristics at the same time. I would consider it factually incorrect of a linter to suggest I shouldn't be using variables for single-use simple strings like this. Even without the location kwarg, or <code>from exc</code>.</p>
<p>On the other hand, I suppose I don't have to enable the rule. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tatsh">@Tatsh</a> on 2024-02-26 04:12</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>One approach would be to limit this to assignment and then used on the very next line (not counting comments).</p>
<p>Another approach would be to limit the rule to numbers, strings and function calls with no arguments. Explanation: export the constant or rename the function to something more clear.</p>
</blockquote>
<p>The use case of:</p>
<pre><code class="language-python">    msg = 'This is a text message describing the error that has just occurred'
    raise utils.AppnameParserException(msg, location=self.current_node) from exc
</code></pre>
<p>to avoid long lines like:</p>
<pre><code class="language-python">    raise utils.AppnameParserException('This is a text message describing the error that has just occurred', location=self.current_node) from exc
</code></pre>
<p>violates both your heuristics at the same time. I would consider it factually incorrect of a linter to suggest I shouldn't be using variables for single-use simple strings like this. Even without the location kwarg, or <code>from exc</code>.</p>
<p>On the other hand, I suppose I don't have to enable the rule. :)</p>
</blockquote>
<p>I would love if Ruff could auto break strings, with parentheses as necessary. And there should be an option if there is not one already to ignore long strings for the line too long rule (really to ignore <code>[&quot;'][,\)$</code>). Markdownlint has this rule for links that go over the limit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-01-29 18:15</div>
            <div class="timeline-body"><p>I would also like this check. Rationale is that assignment statements are dead weight, don't do anything, just clutter.</p>
<p>Say I am reading new function, want to know what it does in broad strokes. Function has twenty statements. Turns out five statements are single-use assignments. So, 25% of statements are junk. Hey function author, get to the point!</p>
<p>Of course, this is little bit opinionated. Would be good candidate for &quot;restriction&quot; class lints.</p>
<p>Also, should be restricted to functions with only single arg, or something like that. Because of possible order of side effects. Say we have:</p>
<pre><code class="language-python">a = f()

b = g()

h(a, b)
</code></pre>
<p>Call <code>f</code> before <code>g</code>. But if we inline:</p>
<pre><code class="language-python">h(f(), g())
</code></pre>
<p>Still call <code>f</code> before <code>g</code>? Depends on how Python order of argument evaluation, which is ???. So there are some subtleties to consider.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15477.html">astral-sh/ruff#15477</a> on 2025-01-29 18:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
