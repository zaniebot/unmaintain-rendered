<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAST003 fix introduces syntax errors - astral-sh/ruff #19831</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FAST003 fix introduces syntax errors</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19831">#19831</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-08-08 16:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-08-08 16:29</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The fix for <a href="https://docs.astral.sh/ruff/rules/fast-api-unused-path-parameter/"><code>fast-api-unused-path-parameter</code> (FAST003)</a> can introduce a syntax error.</p>
<p>When the functionâ€™s first parameter uses <code>*</code>, FAST003 doesnâ€™t add a comma before it. <a href="https://play.ruff.rs/41ea27f0-b193-4d35-b28b-b9f57e993960">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_1.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/things/{thing_id}&quot;)
async def read_thing(*query: str): ...
# EOF

$ ruff --isolated check fast003_1.py --select FAST003 --unsafe-fixes --diff 2&gt;&amp;1 | grep error:
error: Fix introduced a syntax error. Reverting all changes.
</code></pre>
<p>Ditto for <code>**</code>. <a href="https://play.ruff.rs/fea88b1d-638a-41f4-bed2-c272bb5cdbc3">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_2.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/things/{thing_id}&quot;)
async def read_thing(**query: str): ...
# EOF

$ ruff --isolated check fast003_2.py --select FAST003 --unsafe-fixes --diff 2&gt;&amp;1 | grep error:
error: Fix introduced a syntax error. Reverting all changes.
</code></pre>
<p>When the parameter list ends with <code>/</code>, FAST003 puts the new parameter before it, introducing a syntax error. <a href="https://play.ruff.rs/77413da4-f03c-4b6d-9da2-b19654642847">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_3.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/queries/{thing_id}&quot;)
async def read_query(query: str, /): ...
# EOF

$ ruff --isolated check fast003_3.py --select FAST003 --unsafe-fixes --diff 2&gt;&amp;1 | grep error:
error: Fix introduced a syntax error. Reverting all changes.
</code></pre>
<p>The fix introduces a syntax error when the path parameter name is <code>__debug__</code>. It detects the error but modifies the file anyway. The fix should be suppressed in this case, as it already is for path parameters that are Python keywords. <a href="https://play.ruff.rs/dd4f64ea-3a37-4483-806e-4feadf369eca">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_4.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/queries/{__debug__}&quot;)
async def read_query(query: str): ...
# EOF

$ ruff --isolated check fast003_4.py --select FAST003 --unsafe-fixes --fix --output-format concise -q
fast003_4.py:4:34: invalid-syntax: cannot assign to `__debug__`

$ cat fast003_4.py
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/queries/{__debug__}&quot;)
async def read_query(query: str, __debug__): ...

$ python fast003_4.py 2&gt;&amp;1 | tail -n 1
SyntaxError: cannot assign to __debug__
</code></pre>
<p>The fix fails to converge when the path parameter is equivalent under NFKC to a function parameter but not equal to it. <a href="https://github.com/encode/starlette/blob/0.47.2/starlette/routing.py#L121">FastAPI only supports ASCII in path parameter names anyway</a>, so the fix should ignore non-ASCII path parameters. <a href="https://play.ruff.rs/0ef76e8d-be98-430f-8a84-ae28ec1f3e1c">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_5.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/queries/{ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦}&quot;)
async def read_query(query: str): ...
# EOF

$ ruff --isolated check fast003_5.py --select FAST003 --unsafe-fixes --diff

error: Failed to converge after 100 iterations.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BInfinite%20loop%5D

...quoting the contents of `fast003_5.py`, the rule codes FAST003, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

--- fast003_5.py
+++ fast003_5.py
@@ -1,4 +1,4 @@
 from fastapi import FastAPI
 app = FastAPI()
 @app.get(&quot;/queries/{ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦}&quot;)
-async def read_query(query: str): ...
+async def read_query(query: str, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦, ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦): ...

Would fix 100 errors.
</code></pre>
<p>The fix can add a parameter without a default after a positional-only parameter with a default, which is a syntax error. <a href="https://play.ruff.rs/1854c0ba-e16b-4c58-badb-fc6f9c874bfd">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_6.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/things/{thing_id}&quot;)
async def read_thing(query: str = &quot;&quot;, /,): ...
# EOF

$ ruff --isolated check fast003_6.py --select FAST003 --unsafe-fixes --diff 2&gt;&amp;1 | grep error:
error: Fix introduced a syntax error. Reverting all changes.
</code></pre>
<p>The fix can create a positional-only parameter. That isnâ€™t a syntax error but it doesnâ€™t fix the problem, so it is not a useful change. As the FAST003 documentation says, â€œIf a path parameter is declared in the route path, but as a positional-only argument in the function signature, it will also not be accessible in the function body, as FastAPI will not inject the parameter.â€ <a href="https://play.ruff.rs/9e05f449-568b-46d1-9ec3-545657264cf9">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fast003_7.py &lt;&lt;'# EOF'
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/things/{thing_id}&quot;)
async def read_thing(query: str = &quot;&quot;, /, x=None): ...
# EOF

$ ruff --isolated check fast003_7.py --select FAST003 --unsafe-fixes --fix --output-format concise -q
fast003_7.py:3:19: FAST003 Parameter `thing_id` appears in route path, but only as a positional-only argument in `read_thing` signature

$ cat fast003_7.py 
from fastapi import FastAPI
app = FastAPI()
@app.get(&quot;/things/{thing_id}&quot;)
async def read_thing(thing_id, query: str = &quot;&quot;, /, x=None): ...
</code></pre>
<h3>Version</h3>
<p>ruff 0.12.8 (f51a228f0 2025-08-07)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-08-08 18:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-08-08 18:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:38:10 UTC
    </footer>
</body>
</html>
