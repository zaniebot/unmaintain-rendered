```yaml
number: 11360
title: "Unused `noqa` directive (unused: `BLE001`) wrongly detected"
type: issue
state: closed
author: revliscano
labels:
  - question
assignees: []
created_at: 2024-05-10T12:27:19Z
updated_at: 2024-05-22T02:50:10Z
url: https://github.com/astral-sh/ruff/issues/11360
synced_at: 2026-01-10T01:56:52Z
```

# Unused `noqa` directive (unused: `BLE001`) wrongly detected

---

_Issue opened by @revliscano on 2024-05-10 12:27_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

After upgrading to version `0.4.4`, Ruff analysis is failing for this code

```python
try:
    ...
except Exception as e:  # noqa: BLE001
    ...
```

When I run:

```console
$ pip install ruff==0.4.4
$ ruff check .
emails/backend.py:49:33: RUF100 [*] Unused `noqa` directive (unused: `BLE001`)
```

It says that  `BLE001` is unused, when it's clearly necessary there. In the previous ruff version (`0.4.3`) this was not happening.

### Edit

I'm including the rest of the `except` block, as requested by @charliermarsh 

```python
try:
   ...
except Exception as e:  # noqa: BLE001
    if not self.fail_silently:
        raise e
```

---

_Comment by @charliermarsh on 2024-05-10 13:22_

Can you include the rest of the `except` block? We don't flag `BLE` if the exception is re-raised or logged. We fixed a bug and removed some false positives, which might explain what you're seeing.

---

_Label `question` added by @charliermarsh on 2024-05-10 13:22_

---

_Comment by @autinerd on 2024-05-10 15:50_

Yeah, my PR was not perfect, it also accepts it when the re-raise only happens inside an if (see https://github.com/home-assistant/core/pull/117166#discussion_r1596329890 )
We will need to add a checker if all codepaths re-raise and/or log. 

---

_Comment by @revliscano on 2024-05-10 17:05_

> Can you include the rest of the `except` block? We don't flag `BLE` if the exception is re-raised or logged. We fixed a bug and removed some false positives, which might explain what you're seeing.

I edited the description of the issue to include the rest of the `except` block.

And yes, we were re-raising the exception indeed. 

---

_Comment by @charliermarsh on 2024-05-22 02:50_

I think this is working as intended personally. If you're re-raising the exception, the assumption is that you're catching this intentionally.

---

_Closed by @charliermarsh on 2024-05-22 02:50_

---
