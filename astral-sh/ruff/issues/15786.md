```yaml
number: 15786
title: "RUF058 fix does not check if `map` is shadowed"
type: issue
state: closed
author: dscorbett
labels:
  - bug
assignees: []
created_at: 2025-01-28T14:58:19Z
updated_at: 2025-01-28T19:15:38Z
url: https://github.com/astral-sh/ruff/issues/15786
synced_at: 2026-01-10T01:56:55Z
```

# RUF058 fix does not check if `map` is shadowed

---

_Issue opened by @dscorbett on 2025-01-28 14:58_

### Description

The fix for [`starmap-zip` (RUF058)](https://docs.astral.sh/ruff/rules/starmap-zip/) in Ruff 0.9.3 inserts `map` without checking that it is the built-in `map`. If `map` is shadowed, the fix changes the programâ€™s behavior.
```console
$ cat >ruf058.py <<'# EOF'
from itertools import starmap
map = {}
for _ in starmap(print, zip("A", "12")):
    pass
# EOF

$ python ruf058.py
A 1

$ ruff --isolated check --preview --select RUF058 ruf058.py --fix
Found 1 error (1 fixed, 0 remaining).

$ cat ruf058.py
from itertools import starmap
map = {}
for _ in map(print, "A", "12"):
    pass

$ python ruf058.py
Traceback (most recent call last):
  File "ruf058.py", line 3, in <module>
    for _ in map(print, "A", "12"):
             ^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable
```

---

_Label `bug` added by @ntBre on 2025-01-28 15:45_

---

_Comment by @ntBre on 2025-01-28 15:50_

Thanks for the report! I think this is a pretty small fix, just check `if !checker.semantic().has_builtin_binding("map")` [here](https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/ruff/rules/starmap_zip.rs#L86) and not offer a fix if `map` has been shadowed.

---

_Assigned to @ntBre by @ntBre on 2025-01-28 15:51_

---

_Referenced in [astral-sh/ruff#15790](../../astral-sh/ruff/pulls/15790.md) on 2025-01-28 17:07_

---

_Closed by @ntBre on 2025-01-28 19:15_

---
