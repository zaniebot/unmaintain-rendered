<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: `%` formatting in dictionary keys - astral-sh/ruff #6974</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: <code>%</code> formatting in dictionary keys</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6974">#6974</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-08-29 12:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Black breaks dictionary entries after the <code>%</code> even if the key otherwise would fit:</p>
<pre><code>
obj = (
    self.__class__._default_manager.filter(**filter_args)
    .filter(
        **{
            &quot;_order__%s&quot;
            % op: self.__class__._default_manager.values(&quot;_order&quot;).filter(
                **{self._meta.pk.name: self.pk}
            )
        }
    )
    .order_by(order)[:1]
    .get()
)


def test():
    if True:
        qs = GeoColumn.objects.filter(
            **{
                &quot;%s__in&quot;
                % GeoColumn.table_name_col(): [&quot;gis_neighborhood&quot;, &quot;gis_household&quot;]
            }
        )
</code></pre>
<p>IMO, this is very difficult to parse and probably just a fallout of their implementation that inserts line breaks after the highest priority operator, which happens to be the <code>%</code> in these cases.</p>
<p>Ruff tries to keep the key on its own line and instead breaks the value:</p>
<pre><code>obj = (
    self.__class__._default_manager.filter(**filter_args)
    .filter(
        **{
            &quot;_order__%s&quot; % op: self.__class__._default_manager.values(&quot;_order&quot;).filter(
                **{self._meta.pk.name: self.pk}
            )
        }
    )
    .order_by(order)[:1]
    .get()
)


def test():
    if True:
        qs = GeoColumn.objects.filter(
            **{
                &quot;%s__in&quot; % GeoColumn.table_name_col(): [
                    &quot;gis_neighborhood&quot;,
                    &quot;gis_household&quot;,
                ]
            }
        )

</code></pre>
<p>IMO, this is more readable.</p>
<p>#6069</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-29 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-29 12:24</div>
            <div class="timeline-body"><p>Closing because Ruff&#x27;s formatting is more readable and implementing Black&#x27;s behavior requires special casing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-29 12:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Formatter: Alpha&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-02 08:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:41 UTC
    </footer>
</body>
</html>
