<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pytest potential bug case - parameter not passed to a function - astral-sh/ruff #21532</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Pytest potential bug case - parameter not passed to a function</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/21532">#21532</a>
        opened by <a href="https://github.com/DeflateAwning">@DeflateAwning</a>
        on 2025-11-19 21:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/DeflateAwning">@DeflateAwning</a></div>
            <div class="timeline-body">Summary
<p>Consider the following test case. I started off without any parameters, then added the <code>keep_right_geometry</code> parameter.</p>
<p>When I added it, I added it to the <code>if keep_right_geometry</code> part, but forgot to add it to the function called.</p>
<p>Not certain if there&#x27;s a rule that can be made out of this (and it would almost certainly have to be ignored sometimes, as not ALL parameters are used as direct inputs to a function call).</p>
<pre><code>@pytest.mark.parametrize(&quot;keep_right_geometry&quot;, [True, False])
def test_spacial_join_WITH_different_col_names(keep_right_geometry: bool) -&gt; None:
    box1 = shapely.geometry.box(1, 1, 10, 10).wkt  # Intersects box2
    box2 = shapely.geometry.box(5, 5, 15, 15).wkt  # Intersects box1. contains box3
    box3 = shapely.geometry.box(-5, -5, 0, 0).wkt  # Does not intersect any other box.
    box4 = shapely.geometry.box(11, 11, 14, 14).wkt  # contained in box2.

    df1 = pl.DataFrame({&quot;name_1&quot;: [&quot;box1&quot;, &quot;box2&quot;, &quot;box4&quot;], &quot;geometry_1&quot;: [box1, box2, box4]})
    df2 = pl.DataFrame({&quot;name_2&quot;: [&quot;box2&quot;, &quot;box3&quot;, &quot;box4&quot;], &quot;geometry_2&quot;: [box2, box3, box4]})

    result_df = spacial_join(
        df1,
        df2,
        left_on=&quot;geometry_1&quot;,
        right_on=&quot;geometry_2&quot;,
        where=&quot;intersects&quot;,
        how=&quot;inner&quot;,
        keep_right_geometry=keep_right_geometry, # &lt;- I forgot to add this line for 25 minutes of debugging.
    )
    expected_df = pl.DataFrame(
        {
            &quot;name_1&quot;: [&quot;box1&quot;, &quot;box2&quot;, &quot;box2&quot;, &quot;box4&quot;, &quot;box4&quot;],
            &quot;geometry_1&quot;: [box1, box2, box2, box4, box4],
            &quot;name_2&quot;: [&quot;box2&quot;, &quot;box2&quot;, &quot;box4&quot;, &quot;box2&quot;, &quot;box4&quot;],
            &quot;geometry_2&quot;: [box2, box2, box4, box2, box4],
        }
    )

    if keep_right_geometry is False:
        expected_df = expected_df.drop(&quot;geometry_2&quot;)

    assert_frame_equal(result_df, expected_df)

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-11-19 21:54</div>
            <div class="timeline-body"><p>Hmm, yeah I think this would be pretty difficult to implement as a rule. If I understand correctly, it&#x27;s basically <a href="https://docs.astral.sh/ruff/rules/unused-function-argument/#unused-function-argument-arg001">unused-function-argument (ARG001)</a> but instead of totally unused it would be something like &quot;not meaningfully used,&quot; where the <code>keep_right_geometry</code> usage near the end of the function isn&#x27;t counted, but the argument to <code>spacial_join</code> is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-11-19 21:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DeflateAwning">@DeflateAwning</a> on 2025-11-20 03:54</div>
            <div class="timeline-body"><p>That&#x27;s an accurate account, yes! I&#x27;m totally aware of ARG001, and still wanted to suggest this as a separate thing, but I&#x27;m totally fine if the consensus is that this is a silly/pointless/impossible proposal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-10 17:26</div>
            <div class="timeline-body"><p>Thanks for this rule suggestion. I don&#x27;t see how Ruff could reliably dedect whether the variable is &quot;meaningfully used&quot;, which is a necessity for a new rule. Happy to reconsider this as a new rule with a proposal for a specific heuristic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-10 17:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:38 UTC
    </footer>
</body>
</html>
