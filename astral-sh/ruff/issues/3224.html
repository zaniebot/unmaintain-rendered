<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`autoflake`/`black`/`isort` do not resolve to the same file - astral-sh/ruff #3224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>autoflake</code>/<code>black</code>/<code>isort</code> do not resolve to the same file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3224">#3224</a>
        opened by <a href="https://github.com/dycw">@dycw</a>
        on 2023-02-25 13:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dycw">@dycw</a> on 2023-02-25 13:02</div>
            <div class="timeline-body"><p>Suppose a file is stable under <code>autoflake</code>, <code>black</code> and <code>isort</code>. If an import is added and then later unused and removed via <code>autoflake</code>, one might presume <code>black</code> and <code>isort</code> would resolve back to the same file. This certainly introduces potentially many diffs.</p>
<h3>Minimal example</h3>
<p>Start with an empty directory with <code>foo.py</code> and no config files of any sort:</p>
<pre><code class="language-python"># foo.py
from package import item1, item2, item3, item4, item5, item6, item7, item8, item9

a = item1, item2, item3, item4, item5, item6, item7, item8, item9
</code></pre>
<p>This is stable under <code>autoflake</code>, <code>black</code> and <code>isort</code>:</p>
<pre><code class="language-bash">‚ùØ black foo.py &amp;&amp; ruff foo.py --select=F401,I001 --fix
All done! ‚ú® üç∞ ‚ú®
1 file left unchanged.
</code></pre>
<p>Now add an additional import to breach <code>black</code>'s default line-length:</p>
<pre><code class="language-python"># foo.py
from package import item1, item2, item3, item4, item5, item6, item7, item8, item9
from package import item10

a = item1, item2, item3, item4, item5, item6, item7, item8, item9
a = item10
</code></pre>
<p>This is stable after two runs:</p>
<pre><code class="language-bash">‚ùØ black foo.py &amp;&amp; ruff foo.py --select=F401,I001 --fix
All done! ‚ú® üç∞ ‚ú®
1 file left unchanged.
Found 1 error (1 fixed, 0 remaining).

‚ùØ black foo.py &amp;&amp; ruff foo.py --select=F401,I001 --fix
All done! ‚ú® üç∞ ‚ú®
1 file left unchanged.
</code></pre>
<p>with the end result being:</p>
<pre><code class="language-python"># foo.py
from package import (
    item1,
    item2,
    item3,
    item4,
    item5,
    item6,
    item7,
    item8,
    item9,
    item10,
)

a = item1, item2, item3, item4, item5, item6, item7, item8, item9
a = item10
</code></pre>
<p>Now remove the usage of <code>item10</code>, i.e., the last line. <code>autoflake</code> will remove the import of <code>item10</code>, with the end result (again stable after two runs):</p>
<pre><code class="language-python"># foo.py
from package import (
    item1,
    item2,
    item3,
    item4,
    item5,
    item6,
    item7,
    item8,
    item9,
)

a = item1, item2, item3, item4, item5, item6, item7, item8, item9
</code></pre>
<p>However, this is unlikely the desired result. Removing successive imports can even leave you with:</p>
<pre><code class="language-python"># foo.py
from package import (
    item1,
)

a = item1
</code></pre>
<p>This is most certainly not the desired result.</p>
<p>P.S. Workarounds exist: e.g., run <code>isort</code> once with <code>force-single-line</code> and then you can disable it again to recover the very original stable state.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-25 16:46</div>
            <div class="timeline-body"><p>The thing is, I think this is consistent with the isort and black's behaviors: they always add the trailing comma when expanding, and they respect trailing comma when contracting, so it's not possible to revert back to a state like <code>from package import item1</code> once you've expanded an import. I don't see how we could support this without <em>not</em> respecting trailing commas.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-02-25 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dycw">@dycw</a> on 2023-02-26 01:10</div>
            <div class="timeline-body"><p>Hi @charliermarsh , I understand, however I feel there is a case here because I strongly subscribe to <code>black</code>'s own philosophy of minimizing diffs. To that end, this is the workaround I mentioned:</p>
<pre><code class="language-python"># foo.py
from package import (
    item1,
)

a = item1
</code></pre>
<p>If we add <code>force-single-line</code></p>
<pre><code class="language-bash">echo '[tool.ruff.isort]\nforce-single-line = true' &gt; pyproject.toml
</code></pre>
<p>and then re-run:</p>
<pre><code class="language-bash">‚ùØ black foo.py &amp;&amp; ruff foo.py --select=F401,I001 --fix
All done! ‚ú® üç∞ ‚ú®
1 file left unchanged.
Found 1 error (1 fixed, 0 remaining).
</code></pre>
<p>we get the required behavior:</p>
<pre><code class="language-python"># foo.py
from package import item1

a = item1
</code></pre>
<p>Of course, I'd then essentially remove</p>
<pre><code class="language-bash"> ‚ùØ rm pyproject.toml
</code></pre>
<p>to recover the original settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmke8">@tmke8</a> on 2023-02-28 11:22</div>
            <div class="timeline-body"><p>You can run black with <code>--skip-magic-trailing-comma</code> then it will always collapse the imports when possible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dycw">@dycw</a> on 2023-03-03 08:01</div>
            <div class="timeline-body"><p>Thank you @tmke8 , I think this works just about perfectly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dycw on 2023-03-03 08:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:30 UTC
    </footer>
</body>
</html>
