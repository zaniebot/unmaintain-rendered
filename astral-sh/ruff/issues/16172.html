<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] accessing an instance member can cause cross-module AST dependency - astral-sh/ruff #16172</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] accessing an instance member can cause cross-module AST dependency</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16172">#16172</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-02-14 22:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/carljm">@carljm</a> on 2025-02-14 22:56</div>
            <div class="timeline-body"><h3>Description</h3>
<p>Currently there is no cached Salsa query in the <code>Type::member</code> -&gt; <code>Class::instance_member</code> -&gt; <code>Class::own_instance_member</code> call chain. The former is public API on <code>Type</code> that could be called from any module, and the latter uses the AST from the module where the class is defined. This means that any use of an instance member can cause a direct dependency from one module to another module's AST, which we must avoid, as it will cause invalidation of anything using that instance member type, even if something totally unrelated changes in the source module.</p>
<p>We need to introduce a Salsa query somewhere in that chain to avoid this. And we should add an incremental test to verify the fix.</p>
<p>(Originally observed by @mishamsk in https://github.com/astral-sh/ruff/pull/16036)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @carljm on 2025-02-14 22:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Red Knot Q1 2025" by @carljm on 2025-02-14 22:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-20 17:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:36:39 UTC
    </footer>
</body>
</html>
