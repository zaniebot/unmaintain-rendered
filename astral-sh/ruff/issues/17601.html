<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consistent quoting when strings are implicitly concatenated - astral-sh/ruff #17601</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Consistent quoting when strings are implicitly concatenated</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/17601">#17601</a>
        opened by <a href="https://github.com/pekkaklarck">@pekkaklarck</a>
        on 2025-04-24 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pekkaklarck">@pekkaklarck</a> on 2025-04-24 09:24</div>
            <div class="timeline-body"><p>I believe Ruff should use consistent quoting when long strings are constructed using implicit concatenation. That obviously isn't possible if fragments use both single and double quotes as literal values, but that's not the common case.</p>
<p>For example, if I have code like</p>
<pre><code class="language-python">variable = 'value'
print(
    f&quot;I'm trying to create a somewhat reasonable example here. This is a '{variable}'.\n&quot;
    f&quot;Here we have the second line.&quot;
)
</code></pre>
<p>and format it with <code>quote-style = 'single'</code>, I get this result:</p>
<pre><code class="language-python">variable = 'value'
print(
    f&quot;I'm trying to create a somewhat reasonable example here. This is a '{variable}'.\n&quot;
    f'Here we have the second line.'
)
</code></pre>
<p>At least for me the formatted string with <code>f&quot;</code> and <code>f'</code> prefixes looks odd. I'd prefer <code>f&quot;</code> being used consistently even though I explicitly requested single quotes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-04-24 09:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2025-04-24 09:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-24 12:29</div>
            <div class="timeline-body"><p>This is occurring because the first f-string has multiple single quotes inside the literal part of the f-string (e.g., <code>I'm</code>) and the formatter will prefer to avoid using escapes. This means it won't convert it to <code>'I\'m'</code> and instead use <code>&quot;I'm&quot;</code>.</p>
<p>The formatter cannot change the quotes in the literal parts of the f-strings because that would be a semantic change as it would change the content of the f-strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pekkaklarck">@pekkaklarck</a> on 2025-04-26 11:56</div>
            <div class="timeline-body"><p>I understand why the first fragment with single quotes in the string itself is surrounded with double quotes even though I used <code>quote-style = 'single'</code>. I also prefer it that way. In my opinion it would be more logical to surround <em>also</em> latter fragments with double quotes regardless do they contain single quotes or no (unless they contain double quotes). The quoting style changing within the same implicitly concatenated string feels strange for me.</p>
<p>There's a similar situation when implicitly concatenating f-strings. At least I prefer all fragments to have the f-prefix regardless do they contain variables or not:</p>
<pre><code class="language-python">print(
    f'Hello, {name}! '
    f'Nice to see you! ',
    f'Hold my {beverage}.'
)
</code></pre>
<p>vs</p>
<pre><code class="language-python">print(
    f'Hello, {name}! '
    'Nice to see you! ',
    f'Hold my {beverage}.'
)
</code></pre>
<p>I was kind of shocked when I noticed that <a href="https://black.readthedocs.io/en/stable/the_black_code_style/future_style.html#improved-string-processing">Black is planning to change this</a>. If that happens, I hope Ruff either keeps the old behavior or makes it configurable, but that's a topic for a separate issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
