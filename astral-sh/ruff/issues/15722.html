<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] respect `TYPE_CHECKING` even if not imported from `typing` - astral-sh/ruff #15722</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] respect <code>TYPE_CHECKING</code> even if not imported from <code>typing</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15722">#15722</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-01-24 16:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/carljm">@carljm</a> on 2025-01-24 16:04</div>
            <div class="timeline-body"><h3>Description</h3>
<p>In order to avoid the runtime cost of importing <code>typing</code> module, some users use a pattern like this:</p>
<pre><code class="language-py">TYPE_CHECKING = False
if TYPE_CHECKING:
    from typing import ...
</code></pre>
<p>Where the type checker should recognize the name <code>TYPE_CHECKING</code> and treat it as <code>True</code> for type checking. Mypy and pyright both support this.</p>
<p>This is of course a bit ugly because we're recognizing an arbitrary name wherever it's used, but in practice the name is so distinctive that this doesn't seem to cause a lot of trouble.</p>
<p>It can be supported in a general way with a config option that allows specifying arbitrary names that should always be considered as builtin constants with some type, but this isn't usable for a library that can't control its users' type checker configuration.</p>
<p>Ideally we would specify a more principled way to do this (though that might also not be practically worth the community churn.)</p>
<p>But the use case is valid, and we should support it the same way pyright and mypy do, to avoid adding a migration barrier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @carljm on 2025-01-24 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Red Knot Q1 2025" by @carljm on 2025-01-24 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brandonsorensen">@brandonsorensen</a> on 2025-02-11 11:54</div>
            <div class="timeline-body"><p>Can this issue be closed now that #15719 is merged?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-11 12:38</div>
            <div class="timeline-body"><p>This issue is for red-knot, our new type checker. It's separate from Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-03-04 15:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-03-04 15:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:36:25 UTC
    </footer>
</body>
</html>
