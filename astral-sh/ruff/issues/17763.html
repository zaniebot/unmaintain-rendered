<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add an auto fix for adding FA100-related `from __future__ import annotations` imports - astral-sh/ruff #17763</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add an auto fix for adding FA100-related `from __future__ import annotations` imports</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17763">#17763</a>
        opened by <a href="https://github.com/pradyunsg">@pradyunsg</a>
        on 2025-05-01 12:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2025-05-01 12:17</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Currently, it is possible to use https://docs.astral.sh/ruff/rules/missing-required-import/ to add a <code>from __future__ import annotations</code> import.</p>
<p>However, this import gets injected into every Python file (which includes a setup.py file, or a plain &quot;contains no code in as a part of a test&quot; file). It's currently not possible to exclude such files from the isort required-import mechanism. It would also be nice to have a <code>FA200</code> or similar rule that adds the <code>__annotations__</code> import so that a <code>ruff check --fix --unsafe-fixes --select FA</code> would modernise the import annotations without needing additional finagling for adding the <code>__annotations__</code> import.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @dhruvmanila on 2025-05-01 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-01 17:07</div>
            <div class="timeline-body"><blockquote>
<p>However, this import gets injected into every Python file (which includes a setup.py file, or a plain &quot;contains no code in as a part of a test&quot; file).</p>
</blockquote>
<p>Isn't it possible to disable the rule for these files using <code>per-file-ignore</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2025-05-01 19:17</div>
            <div class="timeline-body"><blockquote>
<p>Isn't it possible to disable the rule for these files using <code>per-file-ignore</code>?</p>
</blockquote>
<p>It is. I would, however, need to filter the files manually based on whether ruff reports an FA100 on the files (since not every file in the repository contains type annotations that could benefit from the <code>from __future__ import annotations</code> import, or contain annotations at all).</p>
<hr />
<p>It's a significantly worse experience than doing something like:</p>
<pre><code class="language-toml">[lint]
extend-select = [&quot;FA&quot;]
</code></pre>
<p>and running <code>ruff check --fix --unsafe-fixes</code> which appropriately fixes this in the relevant files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2025-05-01 19:45</div>
            <div class="timeline-body"><p>As a concrete example, I'm trying to modernise pip's annotations and this is non-trivial with FA100 because I have 1752 FA100 errors which are reported -- fixing which would involve me either (a) adding <code>from __future__ import annotations</code> to ~250 files by hand-curating that list, or (b) exclude ~100 files from the isort required-imports check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/pip/pulls/13371.html">pypa/pip#13371</a> on 2025-05-01 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-02 07:25</div>
            <div class="timeline-body"><p>Thanks. That makes sense. What I understand is that it could make sense for this to be its own rule that is cleverer than the isort rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> removed by @MichaReiser on 2025-05-02 07:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-05-02 07:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eli-schwartz">@eli-schwartz</a> on 2025-05-04 19:33</div>
            <div class="timeline-body"><p>This was previously requested at https://github.com/astral-sh/ruff/issues/13273</p>
<p>Also, https://github.com/snok/flake8-type-checking/issues/190 (implemented but doesn't do autofixes)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-05 05:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2025-05-05 21:27</div>
            <div class="timeline-body"><p>Whoops, that didn't show up in my searches. Thanks @eli-schwartz!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:17 UTC
    </footer>
</body>
</html>
