<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF031: False positive when using with unpacking  - astral-sh/ruff #12776</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF031: False positive when using with unpacking </h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12776">#12776</a>
        opened by <a href="https://github.com/alexfikl">@alexfikl</a>
        on 2024-08-09 08:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alexfikl">@alexfikl</a> on 2024-08-09 08:12</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>The following run should not indicate any errors</p>
<pre><code>&gt;&gt; ruff check --isolated --preview --select RUF031 --target-version py38 subscript-tuple.py
subscript-tuple.py:1:3: RUF031 [*] Avoid parentheses for tuples in subscripts.
|
1 | d[(*indices, 5)]
|   ^^^^^^^^^^^^^ RUF031
|
= help: Remove the parentheses.

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>As far as I know, <code>d[*indices, 5]</code> is invalid syntax on Python 3.8, but should work for Python &gt;=3.9 (with the new PEG parser, I think? definitely works on 3.12).</p>
<p>Expected result:</p>
<ul>
<li>No errors / fixes reported when setting <code>--target-version py38</code>.</li>
<li>The recommended fix when setting <code>--target-version py39</code> and above.</li>
</ul>
<p>xref: CI failure resulting from the fix: https://github.com/inducer/pymbolic/actions/runs/10315281929/job/28555159989?pr=144</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-08-09 08:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-08-09 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-09 08:53</div>
            <div class="timeline-body"><p>Thanks for reporting this preview error!</p>
<p>@dylwil3  do you want to take this. Surprising how many edge cases there are to this rule :open_mouth:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-08-09 11:51</div>
            <div class="timeline-body"><p>Sure!</p>
<p>This has been a good learning experience in both Rust and the intricacies of Python, so I'm happy to keep taking on RUF031 bugs ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dylwil3 by @MichaReiser on 2024-08-09 12:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12784.html">astral-sh/ruff#12784</a> on 2024-08-09 13:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-08-09 13:27</div>
            <div class="timeline-body"><p>The CI link above seems to also show a syntax error in Python 3.9, unless I'm reading it wrong:</p>
<p>https://github.com/inducer/pymbolic/actions/runs/10315281929/job/28555160514?pr=144</p>
<p>I can confirm 3.11 is ok, but I gotta go check 3.10. Will update PR once I get a chance to do that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexfikl">@alexfikl</a> on 2024-08-09 13:31</div>
            <div class="timeline-body"><blockquote>
<p>The CI link above seems to also show a syntax error in Python 3.9, unless I'm reading it wrong:</p>
</blockquote>
<p>Ah, yes! I didn't check that because it got cancelled, but it seems like 3.9 also doesn't support unpacking in the subscript. Sorry for the confusion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-08-09 14:00</div>
            <div class="timeline-body"><p>Looks like this is a syntax error in 3.10 as well. It was allowed starting in 3.11, hidden in <a href="https://peps.python.org/pep-0646/#change-1-star-expressions-in-indexes">PEP-646</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-08-09 15:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:14 UTC
    </footer>
</body>
</html>
