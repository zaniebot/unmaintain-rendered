<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace `mdcat` with a smaller dependency - astral-sh/ruff #2938</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Replace `mdcat` with a smaller dependency</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2938">#2938</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-02-15 21:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 21:10</div>
            <div class="timeline-body"><p>I didn't realize it at the time, but <code>mdcat</code> is a huge dependency, because it pulls in a request library, an image-rendering library, etc.</p>
<p>Without <code>mdcat</code>:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/219164357-552a28a3-25d9-4b59-af6f-b7a555031da8.png" alt="Screen Shot 2023-02-15 at 4 01 37 PM" /></p>
<p>With <code>mdcat</code>:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/219164262-486a0097-daf2-4fe7-aa4a-c25348a80026.png" alt="Screen Shot 2023-02-15 at 3 59 04 PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 21:12</div>
            <div class="timeline-body"><p><code>termimad</code> is way, way smaller:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/219165209-85a12a49-6fac-4598-a9f5-58869cce6874.png" alt="Screen Shot 2023-02-15 at 4 02 45 PM" /></p>
<p>But it admittedly looks less nice, or at least requires a lot more configuration and tuning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2940.html">astral-sh/ruff#2940</a> on 2023-02-15 21:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 21:18</div>
            <div class="timeline-body"><p>The other alternative is to submit some changes to <code>mdcat</code> to make the bigger dependencies optional via features.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-15 21:21</div>
            <div class="timeline-body"><p>(off-topic nit but when sharing the output of commands on GitHub and the colors aren't important I prefer to use code blocks since text is more accessible and readable than screenshots)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 21:21</div>
            <div class="timeline-body"><p>(Yeah, sorry, that's lazy of me, will avoid.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-15 21:22</div>
            <div class="timeline-body"><p>(I agree about the issue ... we should try to avoid bloat / unnecessary dependencies.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 21:23</div>
            <div class="timeline-body"><p>Yeah I probably can't spend much time on this right now, so maybe the question is: do we leave this in, and fix it later? Or remove it, and re-add when it's been improved?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-15 21:31</div>
            <div class="timeline-body"><p>We could feature gate it and disable the feature by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 00:14</div>
            <div class="timeline-body"><p>Would we enable it for releases? So just gate to speed up dev? Or disable in &quot;prod&quot; for now too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../swsnr/mdcat/pulls/237.html">swsnr/mdcat#237</a> on 2023-02-16 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2023-02-16 03:01</div>
            <div class="timeline-body"><blockquote>
<p>The other alternative is to submit some changes to <code>mdcat</code> to make the bigger dependencies optional via features.</p>
</blockquote>
<p>Opened https://github.com/swsnr/mdcat/pull/237</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 03:14</div>
            <div class="timeline-body"><p>You're a hero! Thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2023-02-16 13:17</div>
            <div class="timeline-body"><p>There is a bit of push back from <code>mdcat</code> maintainer on that PR so it'll take some time to land.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 14:03</div>
            <div class="timeline-body"><p>My read from that response is that they only really intend <code>mdcat</code> to be used as a crate for tools in which Markdown rendering is a core feature -- or perhaps not at all? and instead intend it to be solely a command-line utility. If they're not interested in powering this kind of use-case, that's fine and totally their prerogative! If so, we'll just revert.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2023-02-16 14:13</div>
            <div class="timeline-body"><p>I think piping/paging to <code>mdcat</code> is a good point, this way we can also support <code>bat</code> like Homebrew did: https://github.com/Homebrew/brew/pull/6504</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-02-16 14:33</div>
            <div class="timeline-body"><p>I see two additional alternatives that could be worth exploring, assuming we want to keep the functionality as is (and e.g. not link to the website).</p>
<h2>Use <code>mdcat</code> at compile time</h2>
<p>We could use <code>mdcat</code> at compile time (or any markdown parser) and use it to embed the highlighted documentation into ruff. This has the added benefit that the markdown syntax can be validated at compile time and printing the documentation only requires serializing to the terminal. This would be similar to what Rome uses to document its rules (Rome didn't include the documentation as part of the CLI. Instead, we added a link to the diagnostic name that pointed to the website and generated the rules on it).  <a href="https://github.com/rome/tools/blob/b6e7a394697d74b40242b18bac836428290b33f3/xtask/codegen/src/generate_configuration.rs#L63-L105">Source</a></p>
<h2>Use a custom syntax</h2>
<p>Rome uses a custom markup syntax that is also used to format diagnostics consistently (<a href="https://github.com/rome/tools/blob/b6e7a394697d74b40242b18bac836428290b33f3/crates/rome_console/README.md#L28">source</a>). Using that syntax directly would be a bit cumbersome in the documentation. Still, it could be a good intermediate representation into which the markdown gets turned into.</p>
<h2>Drawbacks</h2>
<p>Both approaches would require us to implement the logic for rendering the documentation while respecting the CLI width.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 16:47</div>
            <div class="timeline-body"><blockquote>
<p>piping/paging to <code>mdcat</code> is a good point</p>
</blockquote>
<p>Just to make sure I understand the suggestion, this would require that users install <code>mdcat</code> on their own, right?</p>
<blockquote>
<p>Use mdcat at compile time</p>
</blockquote>
<p>This is interesting. What would it &quot;compile&quot; to exactly? Dumb question, but does mdcat not require knowledge of the target terminal when compiling Markdown for printing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 16:51</div>
            <div class="timeline-body"><p>I think I'm partial to removing this functionality for now, and revisiting later... It's a nice feature, but I don't think it's worth significant investment on our side, and it's not clear to me whether the <code>mdcat</code> changes will get merged (or if it's worth @messense's time to invest in them further).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2959.html">astral-sh/ruff#2959</a> on 2023-02-16 17:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 17:46</div>
            <div class="timeline-body"><p>Closing for now as I've removed this. But we can revisit in the future, or if mdcat merges that change :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-16 17:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/swsnr">@swsnr</a> on 2023-04-15 12:14</div>
            <div class="timeline-body"><p>@charliermarsh @messense Just wanted to make you aware that the upcoming 2.0.0 release moves the core rendering code into a new <code>pulldown-cmark-mdcat</code> crate, and moved out heavy dependencies or guarded them behind features.</p>
<p>You should be able to depend on <code>pulldown-cmark-mdcat</code> with <code>default-features = false, features = [&quot;regex-fancy&quot;]</code> for mdcat without the reqwest, resvg and image dependencies, at the cost of no SVG support, no HTTP support, and reduced inline image support on some terminals.</p>
<p>I'll release this as 2.0.0 soonish.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-16 22:59</div>
            <div class="timeline-body"><p>@swsnr - Thanks for the heads up, that's great to hear, and appreciate all your work on <code>mdcat</code> :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8118.html">astral-sh/ruff#8118</a> on 2023-10-22 14:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
