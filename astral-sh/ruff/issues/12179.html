<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(üêû) conflict between `I001` and `RUF100` - astral-sh/ruff #12179</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>(üêû) conflict between <code>I001</code> and <code>RUF100</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12179">#12179</a>
        opened by <a href="https://github.com/KotlinIsland">@KotlinIsland</a>
        on 2024-07-04 05:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/KotlinIsland">@KotlinIsland</a></div>
            <div class="timeline-body"><pre><code>from pydantic import BaseModel, ConfigDict, TypeAdapter as _TypeAdapter, ValidationError  # noqa: TID251
</code></pre>
<pre><code>[lint.flake8-tidy-imports.banned-api]
&quot;pydantic.BaseModel&quot;.msg = &quot;use `AmongusBaseModel` instead&quot;
</code></pre>
<p>When I run <code>ruff check --fix</code> it deletes the <code>noqa: TID251</code> and complains about <code>TID251</code> on that line
When I run <code>ruff check</code> it complains about <code>I001</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-04 06:31</div>
            <div class="timeline-body"><p>I tried to reproduce the error but failed. Can you share your isort configuration?</p>
<p>What I tried:</p>
<p>source file:</p>
<pre><code>from pydantic import BaseModel, ConfigDict, TypeAdapter as _TypeAdapter, ValidationError  # noqa: TID251


print(BaseModel, ConfigDict, _TypeAdapter, ValidationError)
</code></pre>
<p>Configuration</p>
<pre><code>[lint]
preview = true
select = [&quot;ALL&quot;, &quot;RUF100&quot;]
ignore = [&quot;T201&quot;, &quot;D100&quot;, &quot;CPY001&quot;]

[lint.flake8-tidy-imports]
banned-api = { &quot;pydantic.BaseModel&quot; = { &quot;msg&quot;  =  &quot;use `AmongusBaseModel` instead&quot; } }
</code></pre>
<p>Run <code>ruff check --fix</code></p>
<pre><code>uv tool run ruff check test2.py --config 12179.toml --fix
</code></pre>
<p>Source after:</p>
<pre><code>from pydantic import BaseModel, ConfigDict, ValidationError  # noqa: TID251
from pydantic import TypeAdapter as _TypeAdapter

print(BaseModel, ConfigDict, _TypeAdapter, ValidationError)
</code></pre>
<p>Run <code>ruff check</code> again</p>
<pre><code>uv tool run ruff check test2.py --config 12179.toml 
warning: `uv tool run` is experimental and may change without warning.
Resolved 1 package in 3ms
Installed 1 package in 3ms
 + ruff==0.5.0
warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible. Ignoring `one-blank-line-before-class`.
warning: `multi-line-summary-first-line` (D212) and `multi-line-summary-second-line` (D213) are incompatible. Ignoring `multi-line-summary-second-line`.
All checks passed!
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2024-07-04 06:44</div>
            <div class="timeline-body"><p>Sorry, I was in a rush. I think it&#x27;s likely: <code>lint.isort.combine-as-imports = true</code></p>
Full config
<p>

<pre><code>target-version = &quot;py312&quot;
preview = true
unsafe-fixes = true
extend-exclude = [&quot;pw&quot;]

[lint]
extend-select = [&quot;ALL&quot;]
extend-unfixable = [
  &quot;T201&quot;, # print
  &quot;F841&quot;, # unused-variable (annoying when it runs locally and removes the variables you just added)
  &quot;RUF027&quot;, #  missing-f-string-syntax, can be intentional
]
ignore = [
  # rules that are disabled due to a bug (make sure you include the issue link):
  &quot;E721&quot;, # unidiomatic typecheck (using pylint&#x27;s one for now due to <a href="https://github.com/astral-sh/ruff/issues/6465">astral-sh/ruff#6465</a>)
  &quot;N818&quot;, # error-suffix-on-exception-name (<a href="https://github.com/astral-sh/ruff/issues/5367">astral-sh/ruff#5367</a>)
  &quot;UP040&quot;, # non-pep695-type-alias (<a href="https://github.com/python/mypy/issues/15238">python/mypy#15238</a>)

  # rules that are disabled because it was too much work to fix existing instances in our codebase.
  # TODO: enable them once they&#x27;re fixed or when ruff gets baseline <a href="https://github.com/astral-sh/ruff/issues/1149">astral-sh/ruff#1149</a>:
  &quot;A003&quot;, # builtin-attribute-shadowing
  &quot;ERA001&quot;, # commented-out-code
  &quot;RUF012&quot;, # mutable-class-default
  &quot;FBT001&quot;, # boolean-type-hint-positional-argument
  &quot;FBT002&quot;, # boolean-default-value-positional-argument
  &quot;FBT003&quot;, # boolean-positional-value-in-call
  &quot;N815&quot;, # mixed-case-variable-in-class-scope
  &quot;N803&quot;, # invalid-argument-name
  &quot;TD003&quot;, # missing-todo-link
  &quot;DTZ001&quot;, # call-datetime-without-tzinfo
  &quot;DTZ002&quot;, # call-datetime-today
  &quot;DTZ005&quot;, # call-datetime-now-without-tzinfo
  &quot;DTZ006&quot;, # call-datetime-fromtimestamp
  &quot;DTZ007&quot;, # call-datetime-strptime-without-zone
  &quot;DTZ011&quot;, # call-date-today
  &quot;DTZ012&quot;, # call-date-fromtimestamp
  &quot;BLE001&quot;, # blind-except
  &quot;SLF001&quot;, # private-member-access
  &quot;TRY301&quot;, # raise-within-try
  &quot;PLR0917&quot;, # Too many potisional arguments

  # rules that are disabled because they&#x27;re covered by another tool
  &quot;F821&quot;, # undefined-name (basedmypy)
  &quot;PLE1507&quot;, # invalid-envvar-value (basedmypy)
  &quot;RET503&quot;, # implicit-return (basedmypy)
  &quot;ANN&quot;, # flake8-annotations (basedmypy)
  &quot;PLE0605&quot;, # Invalid format for `__all__`, must be `tuple` or `list` (basedmypy)
  &quot;PGH003&quot;, # blanket-type-ignore (basedmypy, basedpyright)
  &quot;B018&quot;, # useless-expression (basedpyright)
  &quot;E112&quot;, # no-indented-block (covered by pretty much every linter because it&#x27;s a syntax error)
  &quot;ISC001&quot;, # single-line-implicit-string-concatenation (ruff format)
  &quot;COM812&quot;, # missing-trailing-comma (ruff format)
  &quot;W291&quot;, # trailing-whitespace (ruff format)
  &quot;W293&quot;, # blank-line-with-whitespace (ruff format, also <a href="https://github.com/astral-sh/ruff/issues/10038">astral-sh/ruff#10038</a>)

  # rules that are disabled because we don&#x27;t like them or some other permanent reason:
  &quot;EM&quot;, # flake8-errmsg
  &quot;FIX&quot;, # flake8-fixme
  &quot;S&quot;, # lake8-bandit (security related rules, we have no external/untrusted users so these are mostly useless)
  &quot;E501&quot;, # Doc line too long
  &quot;PLR0913&quot;, # Too many arguments to function call
  &quot;PLR0912&quot;, # Too many branches
  &quot;PLR0915&quot;, # Too many statements
  &quot;PLR0916&quot;, # Too many Boolean expressions
  &quot;PLR2004&quot;, # Magic value used in comparison
  &quot;PLR1722&quot;, # Use `sys.exit()` instead of `exit`
  &quot;PLW2901&quot;, # `for` loop variable overwritten by assignment target
  &quot;PLR0911&quot;, # Too many return statements
  &quot;PLW0127&quot;, # Self-assignment of variable (used when redefining variables)
  &quot;PLW0603&quot;, # Using the global statement is discouraged
  &quot;PLW1514&quot;, # `open` in text mode without explicit `encoding` argument (we set this globally in REDACTED)
  &quot;PLC0105&quot;, # `TypeVar` name does not reflect its covariance
  &quot;PLC0414&quot;, # Import alias does not rename original package (used by mypy for explicit re-export)
  &quot;PLC1901&quot;, # compare-to-empty-string
  &quot;PLC2701&quot;, # import-private-name, the underscore is clear enough
  &quot;PLR0904&quot;, # too-many-public-methods
  &quot;PLR0914&quot;, # too-many-local-variables
  &quot;FURB171&quot;, # single-item-membership-test (used for checks where more values will be added in the future)
  &quot;D100&quot;, # Missing docstring in public module (ideally would be enabled, but would be too annoying for stuff like REDACTED)
  &quot;D105&quot;, # Missing docstring in magic method
  &quot;D107&quot;, # Missing docstring in __init__
  &quot;D200&quot;, # One-line docstring should fit on one line with quotes
  &quot;D202&quot;, # No blank lines allowed after function docstring
  &quot;D203&quot;, # 1 blank line required before class docstring
  &quot;D205&quot;, # 1 blank line required between summary line and description
  &quot;D209&quot;, # Multi-line docstring closing quotes should be on a separate line
  &quot;D212&quot;, # Multi-line docstring summary should start at the first line
  &quot;D213&quot;, # Multi-line docstring summary should start at the second line
  &quot;D400&quot;, # First line should end with a period
  &quot;D401&quot;, # First line should be in imperative mood
  &quot;D402&quot;, # First line should not be the function&#x27;s &quot;signature&quot;
  &quot;D403&quot;, # First word of the first line should be properly capitalized
  &quot;D404&quot;, # First word of the docstring should not be `This`
  &quot;D405&quot;, # Section name should be properly capitalized
  &quot;D406&quot;, # Section name should end with a newline
  &quot;D407&quot;, # Missing dashed underline after section
  &quot;D412&quot;, # No blank lines allowed between a section header and its content (required for pycharm to format example code correctly)
  &quot;D413&quot;, # Missing blank line after last section
  &quot;D415&quot;, # First line should end with a period, question mark, or exclamation point
  &quot;D418&quot;, # Function/ Method decorated with @overload shouldn&#x27;t contain a docstring (vscode supports it)
  &quot;RUF001&quot;, # ambiguous-unicode-character-string (plenty of intentional instances when checking error messages etc)
  &quot;SIM300&quot;, # yoda-conditions
  &quot;C901&quot;, # complex-structure
  &quot;CPY001&quot;, # missing-copyright-notice
  &quot;TRY003&quot;, # raise-vanilla-args
  &quot;S101&quot;, # assert (pytest uses assert statements)
  &quot;TD002&quot;, # missing-todo-author
  &quot;PT013&quot;, # pytest-incorrect-pytest-import
  &quot;TRY002&quot;, # raise-vanilla-class
  &quot;PERF401&quot;, # manual-list-comprehension (it suggests nested comprehensions which are unreadable)
  &quot;SLOT000&quot;, # no-slots-in-str-subclass
  &quot;PTH207&quot;, # glob (seems to require part path and part glob)
  &quot;RET505&quot;, # superfluous-else-return (can make code harder to read)
  &quot;TRY300&quot;, # try-consider-else (just a suggestion, sometimes makes sense, other times makes code harder to understand)
  &quot;PLR1702&quot;, # too-many-nested-blocks
  &quot;SIM118&quot;, # in-dict-keys (purely heuristic, <a href="https://github.com/astral-sh/ruff/issues/3961">astral-sh/ruff#3961</a>)
  &quot;RUF018&quot;, # Avoid assignment expressions in `assert` statements (we never run python with asserts disabled)
]

[lint.per-file-ignores]
&quot;*.pyi&quot; = [
  &quot;PLW1641&quot;, # Object does not implement `__hash__` method
  &quot;TID252&quot;, # relative-imports
  &quot;FURB180&quot;, # meta-class-abc-meta (conflicts with how mypy handles abstract classes in stubs)
  # we don&#x27;t control names in 3rd party modules:
  &quot;N&quot;, # pep8-naming
  &quot;F811&quot;, # redefined-while-unused
  &quot;PLW3201&quot;, # bad-dunder-method-name
  &quot;A001&quot;, # builtin-variable-shadowing
  &quot;A002&quot;, # builtin-argument-shadowing
  &quot;N804&quot;, # invalid-first-argument-name-for-class-method
  &quot;PYI042&quot;, # snake-case-type-alias
  &quot;UP042&quot;, # replace-str-enum (we don&#x27;t control what type of enums are used in stubs)
]
&quot;scripts/**/*.py&quot; = [
  &quot;T201&quot;, # print (allowed in scripts but not in REDACTED)
  &quot;T203&quot;, # pprint (allowed in scripts but not in REDACTED)
  &quot;PT&quot;, # flake8-pytest-style (scripts are not executed by pytest)
]
&quot;REDACTED/**/*.py&quot; = [
  &quot;T201&quot;, # print (allowed in sandpit files)
  &quot;T203&quot;, # pprint (allowed in sandpit files)
]
&quot;REDACTED/**/*.py&quot; = [
  &quot;PT&quot;, # flake8-pytest-style (utilities aren&#x27;t always executed by pytest)
]
&quot;REDACTED/**/*.py&quot; = [
  &quot;N999&quot;, # invalid-module-name (robot listener modules should have the same name as the class)
]
&quot;REDACTED/**/*.py&quot; = [
  &quot;D101&quot;, # Missing docstring in public class
  &quot;D102&quot;, # Missing docstring in public method
  &quot;D103&quot;, # Missing docstring in public function
  &quot;D104&quot;, # Missing docstring in public package
  &quot;D106&quot;, # Missing docstring in nested class
]
&quot;conftest.py&quot; = [
  &quot;D101&quot;, # Missing docstring in public class
  &quot;D102&quot;, # Missing docstring in public method
  &quot;D103&quot;, # Missing docstring in public function
  &quot;D106&quot;, # Missing docstring in nested class
]
[lint.isort]
# ruff detects unrelated folder names as first party source code
known-third-party = [&quot;coverage&quot;, &quot;robot&quot;]
combine-as-imports = true
split-on-trailing-comma = false

[lint.flake8-bugbear]
extend-immutable-calls = [
  &quot;datetime.date.today&quot;, # very unlikely for tests to run across midnight
]

[lint.flake8-tidy-imports.banned-api]
&quot;typing.NoReturn&quot;.msg = &quot;use `typing.Never` instead&quot; # <a href="https://github.com/astral-sh/ruff/issues/5241">astral-sh/ruff#5241</a>
&quot;typing_extensions.deprecated&quot;.msg = &quot;REDACTED&quot; # https://youtrack.jetbrains.com/issue/PY-61651
&quot;pytest_robotframework.as_keyword&quot;.msg = &quot;REDACTED&quot;
&quot;unittest.TestCase&quot;.msg = &quot;use pytest instead&quot;
&quot;pydantic.BaseModel&quot;.msg = &quot;REDACTED&quot;
&quot;pydantic.validate_call&quot;.msg = &quot;REDACTED&quot;
&quot;basedtyping.Function&quot;.msg = &quot;REDACTED&quot;
&quot;basedtyping.Fn&quot;.msg = &quot;REDACTED&quot;
&quot;types.FunctionType&quot;.msg = &quot;REDACTED&quot;
&quot;pytest.mark&quot;.msg = &quot;REDACTED&quot;

[lint.pylint]
allow-dunder-method-names = [&quot;__get_pydantic_core_schema__&quot;]

[lint.flake8-type-checking]
runtime-evaluated-base-classes = [
  &quot;pydantic.BaseModel&quot;,
  &quot;REDACTED&quot;,
  &quot;REDACTED&quot;,
]
runtime-evaluated-decorators = [
  &quot;pydantic.validate_call&quot;,
  &quot;pydantic.validate_call_decorator.validate_call&quot;,
  &quot;pydantic.dataclasses.dataclass&quot;,
  &quot;REDACTED&quot;,
  &quot;REDACTED&quot;,
  &quot;REDACTED&quot;,
  &quot;REDACTED&quot;,
  &quot;REDACTED&quot;,
]

[lint.flake8-pytest-style]
# This is unfortunate, but `pytest.fixture` contains `Any`, while `pytest.fixture()` doesn&#x27;t
fixture-parentheses = true

[lint.pydocstyle]
ignore-decorators = [&quot;functools.wraps&quot;]

[format]
skip-magic-trailing-comma = true
</code></pre>
</p>
 

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-04 08:46</div>
            <div class="timeline-body"><p>Thanks. Yes, I can reproduce with</p>
<pre><code>
[lint]
preview = true
select = [&quot;ALL&quot;, &quot;RUF100&quot;]
ignore = [&quot;T201&quot;, &quot;D100&quot;, &quot;CPY001&quot;]

[lint.flake8-tidy-imports]
banned-api = { &quot;pydantic.BaseModel&quot; = { &quot;msg&quot;  =  &quot;use `AmongusBaseModel` instead&quot; } }

[lint.isort]
# ruff detects unrelated folder names as first party source code
known-third-party = [&quot;coverage&quot;, &quot;robot&quot;]
combine-as-imports = true
split-on-trailing-comma = false
</code></pre>
<p>If I run <code>--fix</code> without <code>RUF100</code>, then the result is</p>
<pre><code>from pydantic import (  # noqa: TID251
    BaseModel,
    ConfigDict,
    TypeAdapter as _TypeAdapter,
    ValidationError,
)

print(BaseModel, ConfigDict, _TypeAdapter, ValidationError)
</code></pre>
<p>The problem here is that the suppression comment gets moved after the opening <code>(</code>, which now no longer suppresses any violation.</p>
<p>I don&#x27;t think there&#x27;s a good way to avoid this kind of problem except if Ruff would track to which node a suppression comment belongs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-05 02:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2024-07-05 07:22</div>
            <div class="timeline-body"><p>come to think of it, why is the presence of this pragma (<code>noqa</code>) causing a reformat? the line length is still 88</p>
<blockquote>
<p>I don&#x27;t think there&#x27;s a good way to avoid this kind of problem except if Ruff would track to which node a suppression comment belongs.</p>
</blockquote>
<p>If that is too difficult, could this contradiction be detected, such that, after all the transformations are completed, the addition of a new error is detected, and no changes are made. instead an error is reported like &quot;conflicting situation blah blah blah&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-05 08:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-05 08:07</div>
            <div class="timeline-body"><blockquote>
<p>come to think of it, why is the presence of this pragma (noqa) causing a reformat? the line length is still 88</p>
</blockquote>
<p><code>from pydantic import BaseModel, ConfigDict, TypeAdapter as _TypeAdapter, ValidationError  # noqa: TID251</code> has a length of 105 or 91 excluding the comment, both exceeding the max line length of 88.</p>
<p>So I think this really isn&#x27;t about it being  conflict but just that a suppression comment might get moved to a place where it no longer suppresses anything.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2024-07-07 23:20</div>
            <div class="timeline-body"><p><code>from pydantic import BaseModel, ConfigDict, TypeAdapter as _TypeAdapter, ValidationError</code> is 88 chars, so it doesn&#x27;t trigger <code>I001</code>, but with the prgama included it is 105</p>
<p>should <code>noqa</code> count towards the line length? if it didn&#x27;t it would fix this specific issue</p>
<p>I think a solid solution would be:</p>
<pre><code>from pydantic import BaseModel, ConfigDict, TypeAdapter as _TypeAdapter, ValidationError  # noqa: TID251
</code></pre>
<pre><code>&gt; ruff check --fix
test.py:1: applying fix for `I001` would result in new errors `RUF100` + `TID251` and fixing those would result in the fix for `I0001` needing to be reverted. So what we are going to do is fix `I001`, but leave the `RUF100` and the `TID251`, and you can sort it out from there.
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:55 UTC
    </footer>
</body>
</html>
