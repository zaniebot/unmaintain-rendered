<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Please add rdjson output support - astral-sh/ruff #8655</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Please add rdjson output support</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8655">#8655</a>
        opened by <a href="https://github.com/keramblock">@keramblock</a>
        on 2023-11-13 16:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/keramblock">@keramblock</a></div>
            <div class="timeline-body"><p>Hi, it would be nice, if ruff could support rdjson: https://github.com/reviewdog/reviewdog/tree/master/proto/rdf#rdjson both for linter and format mode(if possible)</p>
<p>Why? because it allows to provide problem description to PR and suggest fix at the same time using reviewdog: https://github.com/reviewdog/reviewdog</p>
<p>Here is an example of results of such pipeline(rdjson output by eslint):
<img width="648" alt="eslint rdjson parsed" src="https://github.com/astral-sh/ruff/assets/3233532/4cb7497d-096e-4811-bf41-650a1c1a2197"></p>
<p>Useful links by @eremeevfd:
jsonschema: https://github.com/reviewdog/reviewdog/blob/master/proto/rdf/jsonschema/DiagnosticResult.jsonschema
actual jq parser for Hado-Lint: https://github.com/reviewdog/action-hadolint/blob/master/to-rdjson.jq</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-11-13 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2023-11-13 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 18:11</div>
            <div class="timeline-body"><p>No objection to including this, PR welcome if anyone is up for it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eremeevfd">@eremeevfd</a> on 2023-11-14 12:20</div>
            <div class="timeline-body"><p>Some info regarding RDJson:</p>
<p>Here is description from reviewdog: https://github.com/reviewdog/reviewdog/tree/master/proto/rdf#rdjson</p>
<p>And it's jsonschema: https://github.com/reviewdog/reviewdog/blob/master/proto/rdf/jsonschema/DiagnosticResult.jsonschema</p>
<p>Also I've found actual jq parser for Hado-Lint: https://github.com/reviewdog/action-hadolint/blob/master/to-rdjson.jq</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eremeevfd">@eremeevfd</a> on 2023-11-14 13:15</div>
            <div class="timeline-body"><pre><code class="language-jq"># Convert hadolint JSON output to Reviewdog Diagnostic Format (rdjson)
# https://github.com/reviewdog/reviewdog/blob/f577bd4b56e5973796eb375b4205e89bce214bd9/proto/rdf/reviewdog.proto
{
  source: {
    name: &quot;ruff&quot;,
    url: &quot;https://github.com/astral-sh/ruff&quot;
  },
  diagnostics: . | map({
    message: .message,
    code: {
      value: .code,
      url: .url,
    },
    location: {
      path: .filename,
      range: {
        start: {
          line: .location.row,
          column: .location.column
        },
        end: {
            line: .end_location.row,
            column: .end_location.column
        }
      }
    },
    suggestions: (.fix.edits // {}) | map(
        {
            range: {
                start: {
                    line: .location.row,
                    column: .location.column
                },
                end: {
                    line: .end_location.row,
                    column: .end_location.column
                }
            },
            text: .content
        }
    ),
    severity: &quot;WARNING&quot;
  })
}
</code></pre>
<p>I've managed to apply this JQ to ruff check output:</p>
<pre><code class="language-bash">ruff check ./ --output-format=json | jq -f &quot;./to-rdjson.jq
</code></pre>
<p>And get this:</p>
<pre><code class="language-json">{
  &quot;source&quot;: {
    &quot;name&quot;: &quot;ruff&quot;,
    &quot;url&quot;: &quot;https://github.com/astral-sh/ruff&quot;
  },
  &quot;diagnostics&quot;: [
    {
      &quot;message&quot;: &quot;Import block is un-sorted or un-formatted&quot;,
      &quot;code&quot;: {
        &quot;value&quot;: &quot;I001&quot;,
        &quot;url&quot;: &quot;https://docs.astral.sh/ruff/rules/unsorted-imports&quot;
      },
      &quot;location&quot;: {
        &quot;path&quot;: &quot;/Users/f.eremeev/hautaiou/saas-backend-core/source/assessor/views/b2b/assessments.py&quot;,
        &quot;range&quot;: {
          &quot;start&quot;: {
            &quot;line&quot;: 1,
            &quot;column&quot;: 1
          },
          &quot;end&quot;: {
            &quot;line&quot;: 38,
            &quot;column&quot;: 1
          }
        }
      },
      &quot;suggestions&quot;: [
        {
          &quot;range&quot;: {
            &quot;start&quot;: {
              &quot;line&quot;: 1,
              &quot;column&quot;: 1
            },
            &quot;end&quot;: {
              &quot;line&quot;: 38,
              &quot;column&quot;: 1
            }
          },
          &quot;text&quot;: &quot;import uuid\n\nfrom django.db.models.manager import BaseManager\nfrom django.http import StreamingHttpResponse\nfrom drf_spectacular.utils import (\n    OpenApiExample,\n    OpenApiResponse,\n    OpenApiTypes,\n    extend_schema,\n    extend_schema_view,\n)\nfrom rest_framework import exceptions, parsers, serializers, viewsets\nfrom rest_framework.decorators import action\nfrom rest_framework.request import Request\nfrom rest_framework.response import Response\nfrom rest_framework.settings import api_settings\nfrom rest_framework_csv.renderers import CSVRenderer\n\nfrom assessor.models import Assessment\nfrom assessor.serializers.assessments import (\n    AssessmentCreate,\n    AssessmentRead,\n    AssessmentUpdate,\n    UploadImageComparisonPairs,\n)\nfrom assessor.services.assessments import (\n    ExportCsv,\n    ImageComparisonPairs,\n    ImageComparisonPairsExample,\n    SetImageComparisonPairsFromCSV,\n)\nfrom core_v2.models import Company, Image\nfrom drf_rw_serializers import generics\n\n&quot;
        }
      ],
      &quot;severity&quot;: &quot;WARNING&quot;
    },
    {
      &quot;message&quot;: &quot;Missing return type annotation for public function `get_queryset`&quot;,
      &quot;code&quot;: {
        &quot;value&quot;: &quot;ANN201&quot;,
        &quot;url&quot;: &quot;https://docs.astral.sh/ruff/rules/missing-return-type-undocumented-public-function&quot;
      },
      &quot;location&quot;: {
        &quot;path&quot;: &quot;/Users/f.eremeev/hautaiou/saas-backend-core/source/assessor/views/b2b/assessments.py&quot;,
        &quot;range&quot;: {
          &quot;start&quot;: {
            &quot;line&quot;: 73,
            &quot;column&quot;: 9
          },
          &quot;end&quot;: {
            &quot;line&quot;: 73,
            &quot;column&quot;: 21
          }
        }
      },
      &quot;suggestions&quot;: [],
      &quot;severity&quot;: &quot;WARNING&quot;
    }
  ]
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keramblock">@keramblock</a> on 2023-11-14 13:31</div>
            <div class="timeline-body"><p>But this will not work with format, AFAIK</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eremeevfd">@eremeevfd</a> on 2023-11-14 22:13</div>
            <div class="timeline-body"><p>Yep, format doesn't have any output formats except main diff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tobb10001">@tobb10001</a> on 2024-06-03 20:01</div>
            <div class="timeline-body"><p>In #11682 I implemented RDJson formatting for <code>ruff check</code>. I didn't address anything regarding formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-03 20:03</div>
            <div class="timeline-body"><p>üëç For me this is enough to close -- we don't support alternate output formats for <code>format</code> at all right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-06-03 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keramblock">@keramblock</a> on 2024-06-04 10:01</div>
            <div class="timeline-body"><p>@tobb10001 thanks a lot!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:00 UTC
    </footer>
</body>
</html>
