<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON output on `ruff check --fix` does not show any thing related to fixes - astral-sh/ruff #11329</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>JSON output on <code>ruff check --fix</code> does not show any thing related to fixes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11329">#11329</a>
        opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a>
        on 2024-05-08 01:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a></div>
            <div class="timeline-body">

<p>ruff 0.4.3 (1e91a0991 2024-05-03)</p>
<p>I am trying to parse the output of <code>ruff check --fix --fix-only --show-fixes</code> to validate what has been changed. When using output = <code>text</code> or <code>full</code>, I get:</p>
<pre><code>- my_file.py:
    1 Ã— E703 (useless-semicolon)
</code></pre>
<p>That is byproduct of the &quot;--show-fixes&quot;, but I think this format is not very stable as it has changed before and also it has a non ascii character that prints weird in some places.</p>
<p>I would expect to get something meaningful out of json output when using show-fixes, but <strong>the process output is always empty</strong> (not even the <code>[]</code> from checks since I use --fix-only)</p>
<p>I have tried all commands with <code>--isolated</code> and it behaves the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Json output on ruff check --fix does not show any thing related to fixes&quot; to &quot;JSON output on ruff check --fix does not show any thing related to fixes&quot; by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-08 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;JSON output on ruff check --fix does not show any thing related to fixes&quot; to &quot;JSON output on `ruff check --fix` does not show any thing related to fixes&quot; by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-08 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-08 08:07</div>
            <div class="timeline-body"><p>You can extract the <code>fix</code> from the JSON output directly without providing any other flags:</p>
<pre><code>$ ruff check --output-format=json src/lsp.py
[
  {
    &quot;cell&quot;: null,
    &quot;code&quot;: &quot;F401&quot;,
    &quot;end_location&quot;: {
      &quot;column&quot;: 25,
      &quot;row&quot;: 3
    },
    &quot;filename&quot;: &quot;/Users/dhruv/playground/ruff/src/lsp.py&quot;,
    &quot;fix&quot;: {
      &quot;applicability&quot;: &quot;safe&quot;,
      &quot;edits&quot;: [
        {
          &quot;content&quot;: &quot;&quot;,
          &quot;end_location&quot;: {
            &quot;column&quot;: 1,
            &quot;row&quot;: 4
          },
          &quot;location&quot;: {
            &quot;column&quot;: 1,
            &quot;row&quot;: 3
          }
        }
      ],
      &quot;message&quot;: &quot;Remove unused import: `pathlib.Path`&quot;
    },
    &quot;location&quot;: {
      &quot;column&quot;: 21,
      &quot;row&quot;: 3
    },
    &quot;message&quot;: &quot;`pathlib.Path` imported but unused&quot;,
    &quot;noqa_row&quot;: 3,
    &quot;url&quot;: &quot;https://docs.astral.sh/ruff/rules/unused-import&quot;
  },
  {
    &quot;cell&quot;: null,
    &quot;code&quot;: &quot;T201&quot;,
    &quot;end_location&quot;: {
      &quot;column&quot;: 6,
      &quot;row&quot;: 5
    },
    &quot;filename&quot;: &quot;/Users/dhruv/playground/ruff/src/lsp.py&quot;,
    &quot;fix&quot;: {
      &quot;applicability&quot;: &quot;unsafe&quot;,
      &quot;edits&quot;: [
        {
          &quot;content&quot;: &quot;&quot;,
          &quot;end_location&quot;: {
            &quot;column&quot;: 1,
            &quot;row&quot;: 12
          },
          &quot;location&quot;: {
            &quot;column&quot;: 1,
            &quot;row&quot;: 5
          }
        }
      ],
      &quot;message&quot;: &quot;Remove `print`&quot;
    },
    &quot;location&quot;: {
      &quot;column&quot;: 1,
      &quot;row&quot;: 5
    },
    &quot;message&quot;: &quot;`print` found&quot;,
    &quot;noqa_row&quot;: 5,
    &quot;url&quot;: &quot;https://docs.astral.sh/ruff/rules/print&quot;
  }
]
</code></pre>
<p>Does this help?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-08 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-08 15:05</div>
            <div class="timeline-body"><p>Hi @dhruvmanila, thank you for the reply.
Then I have to run the code twice, one to find all issues in files that are fixable and a second time to actually fix them.</p>
<p>I believe this feature should already work but some combination of <code>--fix</code>, <code>--show-fixes</code> and <code>--fix-only</code> prevents anything from being output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-09 11:21</div>
            <div class="timeline-body"><p>Do you mean that you want the JSON output <em>and</em> that Ruff applies the fix?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-09 11:29</div>
            <div class="timeline-body"><p>Yes, correct.</p>
<p>If the information is available in one output type I think it makes sense it is available in all of them.</p>
<p>Otherwise <code>--show-fixes</code> is useless with json output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-09 12:00</div>
            <div class="timeline-body"><p>Thanks for confirming!</p>
<p>I think this is an ideal behavior although it&#x27;s not enforced on the CLI. This is because <code>--output-format</code> flag shouldn&#x27;t affect the format of <code>--show-*</code> flags which themselves have their own output format (e.g., <code>--show-files</code>, <code>--show-settings</code>).</p>
<p>Can you provide the use-case for this behavior? What kind of information are you looking for with the applied fixes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-09 15:35</div>
            <div class="timeline-body"><blockquote>
<p>This is because <code>--output-format</code> flag shouldn&#x27;t affect the format of <code>--show-*</code> flags which themselves have their own output format</p>
</blockquote>
<p>Well, it does affect right now because JSON output prevents --show-fixes from displaying anything</p>
<blockquote>
<p>Can you provide the use-case for this behavior?</p>
</blockquote>
<p>Right now I am trying to display to users what have been changed on their code. This is part of a pre-commit script</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-10 12:05</div>
            <div class="timeline-body"><blockquote>
<p>Right now I am trying to display to users what have been changed on their code. This is part of a pre-commit script</p>
</blockquote>
<p>Thank you for providing your use-case!</p>
<blockquote>
<p>Well, it does affect right now because JSON output prevents --show-fixes from displaying anything</p>
</blockquote>
<p>I see. Looking at the following code:</p>
<p>https://github.com/astral-sh/ruff/blob/1f794077eca93207c9aad9c0eeca67d19722c8ac/crates/ruff/src/lib.rs#L295-L301</p>
<p>Ruff would always prefer to display violations unless either the <code>--diff</code> or <code>--fix-only</code> flag was supplied.</p>
<p>And as per the following code:</p>
<p>https://github.com/astral-sh/ruff/blob/1f794077eca93207c9aad9c0eeca67d19722c8ac/crates/ruff/src/printer.rs#L219-L235</p>
<p>Ruff wouldn&#x27;t display the fix summary if the output format isn&#x27;t either &quot;full&quot;, &quot;concise&quot;, or &quot;grouped&quot;.</p>
<p>So, I think this behavior is correct because if someone wants to output in JSON, it&#x27;s likely to be post-processed where it wouldn&#x27;t make sense to provide additional output including the fix summary.</p>
<blockquote>
<p>I would expect to get something meaningful out of json output when using show-fixes, but <strong>the process output is always empty</strong> (not even the <code>[]</code> from checks since I use --fix-only)</p>
</blockquote>
<p>I think this is an expected behavior. The JSON output should only include the violations that are leftover after the fixes has been applied. It wouldn&#x27;t include the violations which has been fixed.</p>
<p><strong>tl;dr</strong></p>
<ul>
<li>The <code>--output-format=json</code> is for changing the format of the detected violations. For fixes, these are the remaining violations after the fixes have been applied.</li>
<li>The <code>--show-fixes</code> is to append a summary of the fixed violations after the diagnostic output but if output format is JSON, it&#x27;s suppressed</li>
<li>The <code>--fix-only</code> is to only apply the fix which means no diagnostics will be displayed</li>
</ul>
<p>(Sorry for the long explanation, but it&#x27;s helpful to know the context.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-10 14:22</div>
            <div class="timeline-body"><blockquote>
<p>The JSON output should only include the violations that are leftover after the fixes has been applied.</p>
</blockquote>
<p>I understood why it is happening, but I don&#x27;t think I agree this is expected behavior. There is nowhere saying &quot;--show-fixes&quot; should only append information to the output and not be part of the normal output</p>
<p>It would make much more sense if it modified the output to contain <code>&quot;fixed&quot;: true</code> on the violations as opposed to not show anything when json or other formats meant for ingestion.</p>
<p>with <code>--fix</code> and <code>--show-fixes</code> it would be something like this (hopefully)</p>
<pre><code>[
   {&quot;code&quot;: &quot;F401&quot;, ... , &quot;fixed&quot;: false},
   {&quot;code&quot;: &quot;E703&quot;, ... , &quot;fixed&quot;: true},
]
</code></pre>
<p>with <code>--fix</code> and <code>--show-fixes</code> and <code>--fix-only</code>:</p>
<pre><code>[
   {&quot;code&quot;: &quot;E703&quot;, ... , &quot;fixed&quot;: true},
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-10 14:32</div>
            <div class="timeline-body"><p>I&#x27;m a bit torn. It could make sense to include the fixed violations but we&#x27;d of course be changing the meaning of the API (right now, the contract is: these are the violations that Ruff found that exist in your files). Including fixed violations is a bit strange because (e.g.) the locations no longer make sense, since the file has changed.</p>
<p>I&#x27;d probably be open to changing it (curious to hear @dhruvmanila take) but wouldn&#x27;t prioritize it unless someone wanted to take it on. I don&#x27;t think we even have the information we&#x27;d need to power this in reporter right now.</p>
<p>We could also consider using an entirely different JSON output for <code>--show-fixes</code> where we just write the existing output but structured as JSON.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:53 UTC
    </footer>
</body>
</html>
