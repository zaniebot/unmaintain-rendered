<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PD010: pivot table false positive - astral-sh/ruff #2143</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PD010: pivot table false positive</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2143">#2143</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2023-01-24 23:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a></div>
            <div class="timeline-body"><p>When a Spark DataFrame is used, PD010 will still generate an error (pandas and spark are often used within the same file):</p>
<pre><code>import pandas as pd
from pyspark.sql import DataFrame

dataframe.groupBy(&quot;my_column&quot;)
  .pivot(&quot;other_column&quot;)
</code></pre>
<blockquote>
<p>PD010 <code>.pivot_table</code> is preferred to <code>.pivot</code> or <code>.unstack</code>; provides same functionality</p>
</blockquote>
Suggested solution
<p>When type inference is too complicated, do not consider this rule when <code>pyspark</code> is in the imports.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 04:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-18 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leuchtum">@leuchtum</a> on 2023-11-05 10:44</div>
            <div class="timeline-body"><p>Another false positive, as <code>pd.Series</code> has no method <code>pivot_table</code>. The method only exist on <code>pd.DataFrames</code>.</p>
<p>Example:</p>
<pre><code>import pandas as pd

idx1 = [1, 2, 3, 4, 5]
idx2 = [10, 20, 30, 40, 50]
multi_idx = pd.MultiIndex.from_arrays([idx1, idx2])
s = pd.Series(data=[100, 200, 300, 400, 500], index=multi_idx)

unstacked = s.unstack()
</code></pre>
<p>Output:</p>
<pre><code>$ ruff demo_ruff_PD010.py --select=PD010
demo_ruff_PD010.py:8:13: PD010 `.pivot_table` is preferred to `.pivot` or `.unstack`; provides same functionality
Found 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/janosh">@janosh</a> on 2024-03-22 15:05</div>
            <div class="timeline-body"><p>here&#x27;s a slightly simpler repro for multiple false-positive PD010 on <code>pd.Series</code></p>
<pre><code>import pandas as pd

df = pd.DataFrame({&quot;A&quot;: [1, 2, 3]})
df[&quot;A&quot;].unstack()  # noqa: PD010
df.A.unstack()  # noqa: PD010

pd.Series([1,2,3]).unstack()  # noqa: PD010
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anor4k">@anor4k</a> on 2025-04-22 18:55</div>
            <div class="timeline-body"><p>Also get a false positive on polars DataFrames.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:30 UTC
    </footer>
</body>
</html>
