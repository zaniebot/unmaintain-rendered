<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duplicate match case - astral-sh/ruff #18013</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Duplicate match case</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18013">#18013</a>
        opened by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a>
        on 2025-05-11 03:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2025-05-11 03:03</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'd like Ruff to warn on code like this:</p>
<pre><code>def f(x: object):
    match x:
        case int():
            pass
        case int():
            pass
</code></pre>
<p>I was writing a match like this involving a lot of types, and I'm worried I'll duplicate a case, which would make the second case silently not execute.</p>
<p>A type checker could discover this problem somewhat naturally, but at the moment none of mypy, pyright, or ty detect this. (The algorithm is something like: start the type of the match subject as T. After every case matching to a type M, update it to <code>T &amp; ~M</code>, taking into account previous narrowings. Within each match block, narrow it down to <code>T &amp; M</code>, and warn if that intersection becomes Never.)</p>
<p>In a linter, the heuristic for this rule could be that the AST of a match case is identical to that of a previous case. You'd want to include any <code>if</code> guards in the match, but exclude <code>as</code> clauses, and distribute <code>|</code> patterns at the top level.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-11 07:07</div>
            <div class="timeline-body"><p>ty seems to be the type checker that gets closest here, FWIW! Unlike mypy, pyright and pyrefly, we correctly reveal <code>Never</code> for the second branch here:</p>
<pre><code class="language-py">def f(x: object):
    match x:
        case int():
            reveal_type(x)  # int
        case int():
            reveal_type(x)  # Never
</code></pre>
<p>https://play.ty.dev/590ff49f-44cf-4c55-8a3b-b732910222e6</p>
<p>the only bit we don't do is this second part:</p>
<blockquote>
<p>warn if that intersection becomes Never</p>
</blockquote>
<p>We'd probably want to do that as part of a general ty lint that warns about unintentionally unreachable blocks of code. But that requires some design work before we can implement it for ty, and it isn't an immediate priority for us. In the meantime, a lint rule like the one you suggest seems like a reasonable suggestion to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2025-05-11 07:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:26 UTC
    </footer>
</body>
</html>
