<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[feature request] FastAPI rule: prefer `Annotated` for `Query`, `Path`, `Body`, `Cookie` - astral-sh/ruff #12913</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[feature request] FastAPI rule: prefer `Annotated` for `Query`, `Path`, `Body`, `Cookie`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12913">#12913</a>
        opened by <a href="https://github.com/tiangolo">@tiangolo</a>
        on 2024-08-16 01:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tiangolo">@tiangolo</a> on 2024-08-16 01:44</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<h2>In short</h2>
<p>I would like to have a FastAPI rule to prefer <code>Annotated</code> for:</p>
<ul>
<li><code>Body</code></li>
<li><code>Cookie</code></li>
<li><code>File</code></li>
<li><code>Form</code></li>
<li><code>Header</code></li>
<li><code>Path</code></li>
<li><code>Query</code></li>
</ul>
<p>and hopefully autofix them.</p>
<p><code>Depends</code> and <code>Security</code> are already supported.</p>
<p>This would be related to/continuation of https://github.com/astral-sh/ruff/pull/11579</p>
<h2>Description</h2>
<p>I would like to have <code>Annotated</code> as the recommended style/syntax for FastAPI params that support it:</p>
<ul>
<li><code>Body</code></li>
<li><code>Cookie</code></li>
<li><code>File</code></li>
<li><code>Form</code></li>
<li><code>Header</code></li>
<li><code>Path</code></li>
<li><code>Query</code></li>
</ul>
<p>This is very similar to the rule for  <code>Depends</code> and <code>Security</code> implemented here: https://github.com/astral-sh/ruff/pull/11579</p>
<p>The only caveat is that if one of these parameters has a <code>default</code> argument (or the first argument), as in <code>Query(default=&quot;foo&quot;)</code> then that would become the new default value. For example:</p>
<pre><code class="language-Python">@app.post(&quot;/stuff/&quot;)
def do_stuff(
    some_query_param: str | None = Query(default=None),
    some_path_param: str = Path(),
    some_body_param: str = Body(&quot;foo&quot;),
    some_cookie_param: str = Cookie(),
    some_header_param: int = Header(default=5),
    some_file_param: UploadFile = File(),
    some_form_param: str = Form(),
):
    # do stuff
    pass
</code></pre>
<p>would ideally be transformed into:</p>
<pre><code class="language-Python">@app.post(&quot;/stuff/&quot;)
def do_stuff(
    some_path_param: Annotated[str, Path()],
    some_cookie_param: Annotated[str, Cookie()],
    some_file_param: Annotated[UploadFile, File()],
    some_form_param: Annotated[str, Form()],
    some_query_param: Annotated[str | None, Query()] = None,
    some_body_param: Annotated[str, Body()] = &quot;foo&quot;,
    some_header_param: Annotated[int, Header()] = 5,
):
    # do stuff
    pass
</code></pre>
<p>or:</p>
<pre><code class="language-Python">@app.post(&quot;/stuff/&quot;)
def do_stuff(
   *,
    some_query_param: Annotated[str | None, Query()] = None,
    some_path_param: Annotated[str, Path()],
    some_body_param: Annotated[str, Body()] = &quot;foo&quot;,
    some_cookie_param: Annotated[str, Cookie()],
    some_header_param: Annotated[int, Header()] = 5,
    some_file_param: Annotated[UploadFile, File()],
    some_form_param: Annotated[str, Form()],
):
    # do stuff
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-08-16 01:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-08-16 01:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amirsoroush">@amirsoroush</a> on 2024-08-16 03:44</div>
            <div class="timeline-body"><p>Have a question though:
The ideal form currently has invalid syntax as some non-default parameters follow the default parameters. Does that mean Ruff is <em>also</em> going to change the order of the parameters to fix it? In that case the dependencies are going to be resolved in different order.
I usually tend to put the (mostly custom one with <code>Depends</code> not Query and Body etc.) dependencies that would fail fast at the beginning.
What would be the behavior of Ruff? Is that something I should concern about at all?
Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiangolo">@tiangolo</a> on 2024-08-16 04:54</div>
            <div class="timeline-body"><p>Right! I just updated the expected result. :nerd_face:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kiran-4444">@kiran-4444</a> on 2024-08-16 04:59</div>
            <div class="timeline-body"><p>Iâ€™d love to take this up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RevKraft">@RevKraft</a> on 2024-08-16 05:16</div>
            <div class="timeline-body"><p>I can give some help on that and team up with other people</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-16 05:48</div>
            <div class="timeline-body"><p>Thanks for suggesting this rule. Is there some resource that explains why using <code>Annotated</code> is preferred? It's probably a silly question but for someone who never used fastapi (or Python) a lot, it primarily looks more verbose ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TomerBin">@TomerBin</a> on 2024-08-16 06:58</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for suggesting this rule. Is there some resource that explains why using <code>Annotated</code> is preferred? It's probably a silly question but for someone who never used fastapi (or Python) a lot, it primarily looks more verbose ;)</p>
</blockquote>
<p>Here it is https://fastapi.tiangolo.com/tutorial/dependencies/#share-annotated-dependencies</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-16 07:04</div>
            <div class="timeline-body"><p>Thanks, I think this is the important section (we should link it in the rule) https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#advantages-of-annotated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TomerBin">@TomerBin</a> on 2024-08-16 07:39</div>
            <div class="timeline-body"><p>We should already support all of the mentioned params (Query, File, etc..). Can you please attach your code sample where it doesn't work as expected? I put your example in the Ruff playground (with the needed imports) and it seems to work.</p>
<p>Regarding the default value handling - I really liked @tiangolo suggestion of adding <code>*</code> when needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiangolo">@tiangolo</a> on 2024-08-16 15:37</div>
            <div class="timeline-body"><blockquote>
<p>We should already support all of the mentioned params (Query, File, etc..). Can you please attach your code sample where it doesn't work as expected? I put your example in the Ruff playground (with the needed imports) and it seems to work.</p>
</blockquote>
<p>Indeed! :scream: That's amazing! I assumed it didn't work, but it actually does! :rocket:</p>
<p>From:</p>
<pre><code class="language-Python">@app.post(&quot;/stuff/&quot;)
def do_stuff(
    some_query_param: str | None = Query(default=None),
    some_path_param: str = Path(),
    some_body_param: str = Body(&quot;foo&quot;),
    some_cookie_param: str = Cookie(),
    some_header_param: int = Header(default=5),
    some_file_param: UploadFile = File(),
    some_form_param: str = Form(),
):
    # do stuff
    pass
</code></pre>
<p>to:</p>
<pre><code class="language-Python">@app.post(&quot;/stuff/&quot;)
def do_stuff(
    some_query_param: Annotated[str | None, Query(default=None)],
    some_path_param: Annotated[str, Path()],
    some_body_param: Annotated[str, Body(&quot;foo&quot;)],
    some_cookie_param: Annotated[str, Cookie()],
    some_header_param: Annotated[int, Header(default=5)],
    some_file_param: Annotated[UploadFile, File()],
    some_form_param: Annotated[str, Form()],
):
    # do stuff
    pass

</code></pre>
<p>The only piece missing would be to move the <code>default</code> outside of <code>Annotated</code>. Maybe with <code>*</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @MichaReiser on 2024-12-02 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15462.html">astral-sh/ruff#15462</a> on 2025-01-13 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-01-15 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-01-15 18:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:14 UTC
    </footer>
</body>
</html>
