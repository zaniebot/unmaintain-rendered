<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add a way to tell N805 that a class definition is a metaclass - astral-sh/ruff #20225</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add a way to tell N805 that a class definition is a metaclass</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20225">#20225</a>
        opened by <a href="https://github.com/flying-sheep">@flying-sheep</a>
        on 2025-09-04 09:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/flying-sheep">@flying-sheep</a></div>
            <div class="timeline-body">Summary
<p>consider the following:</p>
<pre><code>class BaseMeta(type): pass
class MyMeta(BaseMeta):
    def thing(cls):  # &lt;- N805
        assert isinstance(cls, type)


# runtime tests
import pytest
class MyCls(metaclass=MyMeta): pass

MyCls.thing()
with pytest.raises(AttributeError):
    MyCls().thing()
</code></pre>
<p>Ruff will flag <code>thing</code> as a <a href="https://docs.astral.sh/ruff/rules/invalid-first-argument-name-for-method/"><code>N805</code></a> violation, thinking that <code>MyMeta</code> is a regular class and should have <code>self</code> as first arg name.</p>
<p>The only way around it is adding <code>type</code> to <code>MyMeta</code>’s base classes, which is probably fine, but it is a code change just to make Ruff understand something.</p>
<p>Would be great if there could be way to make Ruff understand which doesn’t require code changes, like a <code>lint.pep8-naming.metaclasses</code> option (or something smarter / more general if you can come up with something)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Mark classes as metaclasses for N805&quot; to &quot;Add a way to tell N805 that a class definition is a metaclass&quot; by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2025-09-04 09:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-05 15:58</div>
            <div class="timeline-body"><p>I&#x27;m not seeing N805 on this example in the <a href="https://play.ruff.rs/1b521c60-98ec-4318-b367-8511c47bc205">playground</a> or in a local CLI test. I can reproduce this if <code>BaseMeta</code> is defined in a different file, though, in which case this would be a multi-file analysis limitation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-05 15:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2025-09-07 13:02</div>
            <div class="timeline-body"><p>You’re right! What’s the plan with multi-file analysis?</p>
<p>And what about morecomplex siutations, like if the meta base class is imported from a 3rd party package? <code>ty</code> has to do it like that, might Ruff in the future be able to be run in an environment-enabled mode where it leverages <code>ty</code>’s global analysis?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-08 13:50</div>
            <div class="timeline-body"><p>Yeah, we&#x27;ve grouped the multi-file analysis with type-inference in our GitHub labels since ty handles them both. The hope is that we can reuse some of that infrastructure in the future!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2025-09-08 17:09</div>
            <div class="timeline-body"><p>OK! Then I’ll just <code>noqa</code> it and close this, I assume it’ll come at some point automatically (no reason not to make things like this automatically multi-file once the infrastructure exists)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2025-09-08 17:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:23 UTC
    </footer>
</body>
</html>
