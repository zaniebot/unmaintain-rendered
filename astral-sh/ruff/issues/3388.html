<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP035 vs. flake8-pep585 - astral-sh/ruff #3388</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP035 vs. flake8-pep585</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3388">#3388</a>
        opened by <a href="https://github.com/ericbn">@ericbn</a>
        on 2023-03-07 16:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ericbn">@ericbn</a> on 2023-03-07 16:52</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hi! üëã</p>
<p>First thank you for such amazing project, caching up so fast with almost all that has been done for Python linting so far.</p>
<p>I use flake8 with <a href="https://github.com/decorator-factory/flake8-pep585">flake8-pep585</a> and noticed that Ruff's UP035 implementation yields incomplete results comparing to that. I'm using py39 as the target version in both flake8 and Ruff. I didn't compare it with pyupgrade, which I know is the reference implementation.</p>
<h4>test.py</h4>
<p>Minimal code snipped that reproduces the bug:</p>
<pre><code>from typing import (
    AbstractSet,
    AsyncContextManager,
    AsyncGenerator,
    AsyncIterable,
    AsyncIterator,
    Awaitable,
    ByteString,
    Callable,
    ChainMap,
    Collection,
    Container,
    ContextManager,
    Coroutine,
    Counter,
    DefaultDict,
    Deque,
    Dict,
    FrozenSet,
    Generator,
    ItemsView,
    Iterable,
    Iterator,
    KeysView,
    List,
    Mapping,
    MappingView,
    Match,
    MutableMapping,
    MutableSequence,
    MutableSet,
    OrderedDict,
    Pattern,
    Reversible,
    Sequence,
    Set,
    Tuple,
    Type,
    ValuesView,
)
</code></pre>
<h4>Ruff output</h4>
<p>The command I've invoked: <code>ruff --isolated --select UP --target-version py39 test.py</code></p>
<pre><code>test.py:1:1: UP035 [*] Import from `collections.abc` instead: `AsyncGenerator`, `AsyncIterable`, `AsyncIterator`, `Awaitable`, `ByteString`, `ChainMap`, `Collection`, `Container`, `Coroutine`, `Counter`, `Generator`, `ItemsView`, `Iterable`, `Iterator`, `KeysView`, `Mapping`, `MappingView`, `MutableMapping`, `MutableSequence`, `MutableSet`, `Reversible`, `Sequence`, `ValuesView`
test.py:1:1: UP035 [*] Import from `re` instead: `Match`, `Pattern`
Found 2 errors.
[*] 2 potentially fixable with the --fix option.
</code></pre>
<h4>ruff --version</h4>
<pre><code>ruff 0.0.254
</code></pre>
<h4>flake8-pep585 output</h4>
<p>Besides failing with the same as Ruff's UP035 above, flake8-pep585 also reports:</p>
<pre><code>test.py:1:1: PEA001 typing.AbstractSet is deprecated, use collections.abc.Set instead. See PEP 585 for details
test.py:1:1: PEA001 typing.AsyncContextManager is deprecated, use contextlib.AbstractAsyncContextManager instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Callable is deprecated, use collections.abc.Callable instead. See PEP 585 for details
test.py:1:1: PEA001 typing.ContextManager is deprecated, use contextlib.AbstractContextManager instead. See PEP 585 for details
test.py:1:1: PEA001 typing.DefaultDict is deprecated, use collections.defaultdict instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Deque is deprecated, use collections.deque instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Dict is deprecated, use dict instead. See PEP 585 for details
test.py:1:1: PEA001 typing.FrozenSet is deprecated, use frozenset instead. See PEP 585 for details
test.py:1:1: PEA001 typing.List is deprecated, use list instead. See PEP 585 for details
test.py:1:1: PEA001 typing.OrderedDict is deprecated, use collections.OrderedDict instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Set is deprecated, use set instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Tuple is deprecated, use tuple instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Type is deprecated, use type instead. See PEP 585 for details
</code></pre>
<p>These are all mentioned under https://peps.python.org/pep-0585/#implementation and here's the flake8-pep585 implementation: https://github.com/decorator-factory/flake8-pep585/blob/master/flake8_pep585/rules.py</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-07 19:04</div>
            <div class="timeline-body"><p>Yeah we seem to be missing some of these. Let me audit the list...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-03-07 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-07 23:42</div>
            <div class="timeline-body"><p>Okay so...</p>
<pre><code>test.py:1:1: PEA001 typing.OrderedDict is deprecated, use collections.OrderedDict instead. See PEP 585 for details
</code></pre>
<p>This we're missing, I'm adding them (same with <code>ChainMap</code> and <code>Counter</code> from <code>collections</code> in Python 3.9+).</p>
<pre><code># test.py:1:1: PEA001 typing.AbstractSet is deprecated, use collections.abc.Set instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.AsyncContextManager is deprecated, use contextlib.AbstractAsyncContextManager instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.ContextManager is deprecated, use contextlib.AbstractContextManager instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Deque is deprecated, use collections.deque instead. See PEP 585 for details
</code></pre>
<p>We're missing these, I think because they're not &quot;straight&quot; replacements (you have to change the usages too, e.g., from <code>AbstractSet</code> to <code>Set</code>). I'll add warnings for them, but won't be able to fix them right now just given limitations in the fix API. (It'd require <em>both</em> changing the import and all the callsites.)</p>
<pre><code># test.py:1:1: PEA001 typing.Callable is deprecated, use collections.abc.Callable instead. See PEP 585 for details
</code></pre>
<p>I think we actually <em>do</em> catch this one, at least in my testing.</p>
<pre><code># test.py:1:1: PEA001 typing.Dict is deprecated, use dict instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.FrozenSet is deprecated, use frozenset instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.List is deprecated, use list instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.OrderedDict is deprecated, use collections.OrderedDict instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.Set is deprecated, use set instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.Tuple is deprecated, use tuple instead. See PEP 585 for details
# test.py:1:1: PEA001 typing.Type is deprecated, use type instead. See PEP 585 for details
</code></pre>
<p>These are covered by a different rule (<code>UP006</code>), which handles rewrites at the <em>usage</em> site (e.g., it changes <code>List[int]</code> to <code>list[int]</code>). Typically, <code>UP006</code> fixes those usages, and then those are marked as &quot;unused imports&quot;. But we could consider flagging them here too...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2023-03-08 01:35</div>
            <div class="timeline-body"><p>Thanks for the quick heads up!</p>
<p>It makes sense that the ones with different names will be harder to fix. Also makes perfect sense that the <code>List</code> vs. <code>list</code> could be fixed the way it currently works. Having them also as &quot;UP&quot; warnings maybe would be a nice addition just for sake of completeness.</p>
<blockquote>
<pre><code># test.py:1:1: PEA001 typing.Callable is deprecated, use collections.abc.Callable instead. See PEP 585 for details
</code></pre>
<p>I think we actually <em>do</em> catch this one, at least in my testing.</p>
</blockquote>
<p>I saw it was listed in Ruff's code, but it does not seem to work if it's imported along others:</p>
<pre><code class="language-shell">$ echo 'from typing import Callable' &gt;| test.py
$ ruff --isolated --select UP --target-version py39 test.py
$ echo 'from typing import Callable, Container' &gt;| test.py
$ ruff --isolated --select UP --target-version py39 test.py
test.py:1:1: UP035 [*] Import from `collections.abc` instead: `Container`
Found 1 error.
[*] 1 potentially fixable with the --fix option.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-08 03:11</div>
            <div class="timeline-body"><p>Oh interesting, lemme look into that...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-08 03:12</div>
            <div class="timeline-body"><p>Ruff has that noted as a Python 3.10+ thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-08 03:15</div>
            <div class="timeline-body"><p>Ahh right, it's because that change was made in Python 3.9.2 (https://stackoverflow.com/questions/65858528/is-collections-abc-callable-bugged-in-python-3-9-1), so <code>collections.abc.Callable</code> actually isn't available on <em>all</em> Python 3.9 versions. This has come up before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-08 05:02</div>
            <div class="timeline-body"><p>(Will add those remaining deprecation rules tomorrow, I have a PR in progress.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-03-08 05:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-03-08 17:25</div>
            <div class="timeline-body"><blockquote>
<p>Ahh right, it's because that change was made in Python 3.9.2</p>
</blockquote>
<p>See #2690</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-10 03:46</div>
            <div class="timeline-body"><p>I'm a few days delayed on this (clearly) but still plan on adding these.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-11 06:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2023-03-14 23:43</div>
            <div class="timeline-body"><p>Hi. Thanks a lot for working on this.</p>
<blockquote>
<p>These are covered by a different rule (<code>UP006</code>), which handles rewrites at the <em>usage</em> site (e.g., it changes <code>List[int]</code> to <code>list[int]</code>). Typically, <code>UP006</code> fixes those usages, and then those are marked as &quot;unused imports&quot;. But we could consider flagging them here too...</p>
</blockquote>
<p>I see you even worked on these to be part of UP035! ‚òùÔ∏è üéâ</p>
<p>I double checked the test.py file with ruff 0.0.255 and I found a couple still not reported compared to flake8-pep585:</p>
<pre><code>test.py:1:1: PEA001 typing.ContextManager is deprecated, use contextlib.AbstractContextManager instead. See PEP 585 for details
test.py:1:1: PEA001 typing.Type is deprecated, use type instead. See PEP 585 for details
</code></pre>
<p>As far as I checked, these are present on Python 3.9.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-14 23:54</div>
            <div class="timeline-body"><p>Oof, let me take one more look, thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-15 00:03</div>
            <div class="timeline-body"><p>This time I actually looked through the list at https://peps.python.org/pep-0585/#implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2023-03-15 00:05</div>
            <div class="timeline-body"><p>Cool! Thank you for the patience over this.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:35 UTC
    </footer>
</body>
</html>
