<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff parenthesizing multiple context managers despite `requires-python = &quot;&gt;=3.8&quot;` - astral-sh/ruff #16105</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff parenthesizing multiple context managers despite `requires-python = &quot;&gt;=3.8&quot;`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/16105">#16105</a>
        opened by <a href="https://github.com/tamird">@tamird</a>
        on 2025-02-11 21:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tamird">@tamird</a> on 2025-02-11 21:20</div>
            <div class="timeline-body"><h3>Description</h3>
<p>ruff 0.9.6</p>
<p>Seen in https://github.com/mystor/git-revise/pull/141.</p>
<p>If I just have:</p>
<pre><code class="language-toml">[project]
name = &quot;git-revise&quot;
dynamic = [&quot;version&quot;]
requires-python = &quot;&gt;=3.8&quot;
authors = [{ name = &quot;Nika Layzell&quot;, email = &quot;nika@thelayzells.com&quot; }]
description = &quot;Efficiently update, split, and rearrange git commits&quot;
readme = &quot;README.md&quot;
license = { file = &quot;LICENSE&quot; }
keywords = [&quot;git&quot;, &quot;revise&quot;, &quot;rebase&quot;, &quot;amend&quot;, &quot;fixup&quot;]
classifiers = [
  &quot;Development Status :: 4 - Beta&quot;,
  &quot;Intended Audience :: Developers&quot;,
  &quot;Environment :: Console&quot;,
  &quot;Topic :: Software Development :: Version Control&quot;,
  &quot;Topic :: Software Development :: Version Control :: Git&quot;,
  &quot;License :: OSI Approved :: MIT License&quot;,
  &quot;Programming Language :: Python :: 3&quot;,
  &quot;Programming Language :: Python :: 3.8&quot;,
  &quot;Programming Language :: Python :: 3.9&quot;,
  &quot;Programming Language :: Python :: 3.10&quot;,
]
</code></pre>
<p>and I run <code>uv run ruff format</code> I get:</p>
<pre><code class="language-diff">diff --git a/tests/conftest.py b/tests/conftest.py
index 98350a2..47f70df 100644
--- a/tests/conftest.py
+++ b/tests/conftest.py
@@ -126,7 +126,11 @@ def editor_main(
     # pylint: disable=redefined-builtin
     input: Optional[bytes] = None,
 ) -&gt; &quot;Generator[Editor, None, subprocess.CompletedProcess[bytes]]&quot;:
-    with pytest.MonkeyPatch().context() as monkeypatch, Editor() as ed, ThreadPoolExecutor() as tpe:
+    with (
+        pytest.MonkeyPatch().context() as monkeypatch,
+        Editor() as ed,
+        ThreadPoolExecutor() as tpe,
+    ):
         host, port = ed.server_address
         host = host.decode() if isinstance(host, (bytes, bytearray)) else host
         editor_cmd = &quot; &quot;.join(

</code></pre>
<p>which is not valid in python 3.8.</p>
<p>However if I add</p>
<pre><code class="language-toml">
[tool.ruff]
target-version = &quot;py38&quot;
</code></pre>
<p>then ruff no longer suggests this edit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-11 21:32</div>
            <div class="timeline-body"><p>Thanks for the detailed writeup.</p>
<p>Can you try running ruff with:</p>
<pre><code>uvx ruff check --verbose other.py
[2025-02-11][22:31:05][ruff::resolve][DEBUG] Using Ruff default settings
[2025-02-11][22:31:05][ignore::gitignore][DEBUG] opened gitignore file: /Users/micha/.gitignore_global
[2025-02-11][22:31:05][ruff::commands::check][DEBUG] Identified files to lint in: 3.22325ms
[2025-02-11][22:31:05][ruff::commands::check][DEBUG] Checked 1 files in: 37.458µs
</code></pre>
<p>You can see from the log that ruff ignores the <code>pyproject.toml</code> (I'm using your configuration in this example). Now, adding a <code>[tool.ruff]</code> section to your configuration should make Ruff to pick up the <code>pyproject.toml</code></p>
<pre><code>uvx ruff check --verbose other.py
[2025-02-11][22:33:50][ruff::resolve][DEBUG] Using configuration file (via parent) at: /Users/micha/astral/test/pyproject.toml
[2025-02-11][22:33:50][ruff_linter::settings::types][DEBUG] Detected minimum supported `requires-python` version: 3.8
[2025-02-11][22:33:50][ignore::gitignore][DEBUG] opened gitignore file: /Users/micha/.gitignore_global
[2025-02-11][22:33:50][ruff::commands::check][DEBUG] Identified files to lint in: 3.301625ms
[2025-02-11][22:33:50][ruff::commands::check][DEBUG] Checked 1 files in: 53.875µs
</code></pre>
<p>I'm not quiet sure why Ruff ignores <code>pyproject.toml</code> files without a <code>tool.ruff</code> section by default, even if it doesn't find any other configuration in any parent directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-02-11 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tamird">@tamird</a> on 2025-02-11 21:39</div>
            <div class="timeline-body"><p>Without <code>[tool.ruff]</code>:</p>
<pre><code>uvx ruff check --verbose 2&gt;&amp;1 | grep ruff::resolve
[2025-02-11][16:38:28][ruff::resolve][DEBUG] Using Ruff default settings
</code></pre>
<p>With empty <code>[tool.ruff]</code>:</p>
<pre><code>tamird@Tamirs-MacBook-Pro git-revise % uvx ruff check --verbose 2&gt;&amp;1 | grep ruff::resolve
[2025-02-11][16:39:09][ruff::resolve][DEBUG] Using configuration file (via parent) at: /Users/tamird/src/git-revise/pyproject.toml
</code></pre>
<p>So I guess the solution to my problem is an empty <code>[tool.ruff]</code>, but this certainly seems like a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @MichaReiser on 2025-02-11 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-02-11 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2025-02-11 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-11 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16180.html">astral-sh/ruff#16180</a> on 2025-02-16 10:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
