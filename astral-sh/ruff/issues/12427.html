<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When raising `NotImplementedError `, ARG002 and EM101 are incompatible. - astral-sh/ruff #12427</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When raising <code>NotImplementedError </code>, ARG002 and EM101 are incompatible.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12427">#12427</a>
        opened by <a href="https://github.com/DaniBodor">@DaniBodor</a>
        on 2024-07-21 12:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/DaniBodor">@DaniBodor</a></div>
            <div class="timeline-body"><p><a href="https://docs.astral.sh/ruff/rules/unused-method-argument/">ARG002</a> is usually not raised in methods that immediately raise a <code>NotImplementedError</code>, but does if there is some other code in the method. However, <a href="https://docs.astral.sh/ruff/rules/raw-string-in-exception/">EM101</a> enforces adding the error message into a separate variable, which is then seen as &quot;code&quot;.</p>
<p>The result of this is that there is no way to write such a method without raising one or the other issue. See example below.</p>
<pre><code>class EM101_found:
    def test_method(self, **kwargs):
        raise NotImplementedError(&quot;error message.&quot;)


class ARG002_found:
    def test_method(self, **kwargs):
        msg = &quot;error message&quot;
        raise NotImplementedError(msg)
</code></pre>
<p>running <code>ruff check test_file.py --select ARG002 --select EM101</code> on the code snippet above results in</p>
<blockquote>
<p>test_file.py:3:35: EM101 Exception must not use a string literal, assign to variable first
test_file.py:7:29: ARG002 Unused method argument: <code>kwargs</code>
Found 2 errors.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-21 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ast0815">@ast0815</a> on 2024-09-02 11:55</div>
            <div class="timeline-body"><p>It&#x27;s a bit of potentially unnecessary faff, but you can write these methods like this:</p>
<pre><code>    def method(self, x):
        _ = x
        msg = &quot;Something&quot;
        raise NotImplementedError(msg)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2024-09-06 12:31</div>
            <div class="timeline-body"><blockquote>
<p>It&#x27;s a bit of potentially unnecessary faff, but you can write these methods like this:</p>
<pre><code>    def method(self, x):
        _ = x
        msg = &quot;Something&quot;
        raise NotImplementedError(msg)
</code></pre>
</blockquote>
<p>I think rather than this, I would prefer suppressing one or the other of the rules (which is what I am doing now).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ast0815">@ast0815</a> on 2024-09-09 11:33</div>
            <div class="timeline-body"><p>I switched to <code>abc.ABC</code> and the <code>@abstractmethod</code> decorator. Yet another way around this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Rupt">@Rupt</a> on 2024-09-20 05:18</div>
            <div class="timeline-body"><p><a href="https://google.github.io/styleguide/pyguide.html#214-decision">Google&#x27;s style guide</a> recommends <code>del</code>ing the unused argument.</p>
<pre><code>    def method(self, x):
        del x  # unused
        msg = &quot;Something&quot;
        raise NotImplementedError(msg)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2024-09-20 08:31</div>
            <div class="timeline-body"><p>Interesting. I guess this should be at least mentioned in the ruff documentation of these errors as well.
For the example I gave above, I think this would require looping through the kwargs to delete them all, which also feels clunky.</p>
<p>Also, these all feel like workarounds for an issue that I feel doesn&#x27;t really needs to be flagged in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-24 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-24 19:52</div>
            <div class="timeline-body"><p>It seems reasonable to avoid this false positive in ARG002. I&#x27;m not sure how hard it will be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Watercycle">@Watercycle</a> on 2024-09-30 05:48</div>
            <div class="timeline-body"><p>Here&#x27;s <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/flake8_unused_arguments/rules/unused_arguments.rs#L315">the rule</a>, here&#x27;s the original Python <a href="https://github.com/nhoad/flake8-unused-arguments/blob/master/flake8_unused_arguments.py#L238-L273">is_stub_function</a>, and here&#x27;s Ruff&#x27;s <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_python_semantic/src/analyze/function_type.rs#L127-L146">is_stub</a>.</p>
<p>It seems like a simple fix would be expanding the definition of <code>is_stub</code> to allow primitive string assignment with something along the lines of the below code.</p>
<p>But, going down that route, it&#x27;s likely worth documenting what the cut-off for a &quot;stub&quot; is. That if you need things like <code>str + str</code>, <code>f-string</code>, and/or other functional calls, you should really just use alternatives like ABC (added in 3.4) or <code># noqa</code> to disable one of the rules.</p>
<pre><code>Stmt::Assign(StmtAssign { value, .. }) =&gt; {
    matches!(value.as_ref(), Expr::StringLiteral(_))
}
</code></pre>
<p>Does that sound reasonable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-01 03:49</div>
            <div class="timeline-body"><blockquote>
<p>It seems like a simple fix would be expanding the definition of <code>is_stub</code> to allow primitive string assignment with something along the lines of the below code.</p>
</blockquote>
<p>I don&#x27;t think this will work completely because it&#x27;ll start giving false negatives. What we need to do is to add a new condition which will be checked if the first condition is false. This will check whether there are exactly two statements and they match the following pattern:</p>
<pre><code>variable = &lt;string | f-string&gt;
raise NotImplementedError(variable)
</code></pre>
<p>Note that this condition should only be checked locally to <code>ARG002</code> implementation and not be added to <code>is_stub</code> function as that&#x27;s being used in other places as well. So, a new function can be added in <code>unused_arguments.rs</code> and that can be used in <code>ARG002</code> implementation. Does this make sense?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Watercycle">@Watercycle</a> on 2024-10-01 21:56</div>
            <div class="timeline-body"><p>Yes, that&#x27;s fair! My inclination to modify <code>is_stub</code> is mostly because of naming.</p>
<p>But, to your point, it&#x27;s probably better not to pollute the definition of <code>is_stub</code> until enough rules have common logic to warrant abstracting that out.</p>
<p>How does having a very specific <code>is_implementation_stub</code> function in <code>unused_arguments.rs</code> for now sound?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-04 04:34</div>
            <div class="timeline-body"><blockquote>
<p>How does having a very specific <code>is_implementation_stub</code> function in <code>unused_arguments.rs</code> for now sound?</p>
</blockquote>
<p>We can discuss the naming in the PR but yeah that sounds about right</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-18 06:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-18 06:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:55 UTC
    </footer>
</body>
</html>
