<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>escape-sequence-in-docstring (D301) reports escaped docstrings within docstrings - astral-sh/ruff #12152</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>escape-sequence-in-docstring (D301) reports escaped docstrings within docstrings</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12152">#12152</a>
        opened by <a href="https://github.com/tjkuson">@tjkuson</a>
        on 2024-07-02 14:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tjkuson">@tjkuson</a> on 2024-07-02 14:54</div>
            <div class="timeline-body"><p>Running</p>
<pre><code class="language-sh">ruff check --isolated --select D301
</code></pre>
<p>on</p>
<pre><code class="language-python">def foo():
    &quot;&quot;&quot;
    This docstring contains another docstring.

        def bar():
            \&quot;\&quot;\&quot;Here it is!\&quot;\&quot;\&quot;
    &quot;&quot;&quot;
</code></pre>
<p>returns an <a href="https://docs.astral.sh/ruff/rules/escape-sequence-in-docstring/">escape-sequence-in-docstring (D301)</a> diagnostic, printing</p>
<pre><code>example.py:2:5: D301 Use `r&quot;&quot;&quot;` if any backslashes in a docstring
  |
1 |   def foo():
2 |       &quot;&quot;&quot;
  |  _____^
3 | |     This docstring contains another docstring.
4 | |
5 | |         def bar():
6 | |             \&quot;\&quot;\&quot;Here it is!\&quot;\&quot;\&quot;
7 | |     &quot;&quot;&quot;
  | |_______^ D301
  |
  = help: Add `r` prefix
</code></pre>
<p>However, adding the <code>r</code> prefix and removing the backslashes is a syntax error:</p>
<pre><code class="language-python">def foo():
    r&quot;&quot;&quot;
    This docstring contains another docstring.

        def bar():
            &quot;&quot;&quot;Here it is!&quot;&quot;&quot;
    &quot;&quot;&quot;
</code></pre>
<p>Docstrings in within docstrings can appear when a docstring contains a code snippet (which is how I discovered the issue). I would expect D301 not to be raised, as making the docstring raw doesn't work.</p>
<p>Ruff version 0.5.0</p>
<p>Search terms: D301, backslash, escape</p>
<p>Update: managed to reproduce with</p>
<pre><code class="language-python">def foo():
    &quot;&quot;&quot;
    This docstring contains another docstring.

        def bar():
            \&quot;&quot;&quot;Here it is!\&quot;&quot;&quot;
    &quot;&quot;&quot;
</code></pre>
<p>as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-07-02 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-07-02 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @AlexWaygood on 2024-07-02 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2024-07-03 06:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ukyen8">@ukyen8</a> on 2024-07-03 23:01</div>
            <div class="timeline-body"><p>Hi, I would like to work on this issue. Is anyone already working on it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-04 04:41</div>
            <div class="timeline-body"><p>@ukyen8 I don't think so, go for it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ukyen8 by @MichaReiser on 2024-07-04 05:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-18 22:36</div>
            <div class="timeline-body"><p>Closed by https://github.com/astral-sh/ruff/pull/12192#pullrequestreview-2187016174. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-18 22:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:17 UTC
    </footer>
</body>
</html>
