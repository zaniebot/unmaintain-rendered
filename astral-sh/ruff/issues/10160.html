<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request: Enforce space after colon (`:`) for special comments - astral-sh/ruff #10160</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Request: Enforce space after colon (`:`) for special comments</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10160">#10160</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2024-02-29 06:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Avasam">@Avasam</a> on 2024-02-29 06:12</div>
            <div class="timeline-body"><p>I've open the same request over at https://github.com/PyCQA/flake8-pyi/issues/465 , but I think that Ruff could generalize this, or at least expand on supported keywords.</p>
<p>Comments handled by Ruff
<code># noqa:Y011</code> --&gt; <code># noqa: Y011</code> (not handled by flake8-noqa https://github.com/astral-sh/ruff/issues/850 )
<code># fmt:off</code> --&gt; <code># fmt: off</code> (except if this is added to a formatter)
<code># ruff:noqa</code> --&gt; <code># ruff: noqa</code>
<code># ruff:noqa:F811</code> --&gt; <code># ruff: noqa: F811</code> (or at least <code># ruff: noqa:F811</code> if generalized)
<code># flake8:noqa:F811</code> --&gt; <code># flake8: noqa: F811</code> (or at least <code># flake8: noqa:F811</code> if generalized)
<code># ruff:isort:skip_file</code> --&gt; <code># ruff: isort: skip_file</code> (or at least <code># ruff: isort:skip_file</code> if generalized)
<code># isort:skip_file</code> --&gt; <code># isort: skip_file</code></p>
<p>Not handled by Ruff, but popular:
<code># type:ignore</code> --&gt; <code># type: ignore</code>
<code># pyright:ignore</code> --&gt; <code># pyright: ignore</code>
<code># nopycln:import</code> --&gt; <code># nopycln: import</code>
...</p>
<p>Basically the same as https://docs.astral.sh/ruff/rules/missing-space-after-todo-colon/ but with a lot more keywords</p>
<p>Formatters (black and Ruff) already take of adding a space after <code>#</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../PyCQA/flake8-pyi/issues/465.html">PyCQA/flake8-pyi#465</a> on 2024-02-29 06:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-02-29 07:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-29 07:37</div>
            <div class="timeline-body"><p>@JelleZijlstra what do you think of adding this to Black/Ruff's formatter in addition or instead of a lint rule?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2024-02-29 07:45</div>
            <div class="timeline-body"><p>Yes, I was thinking about that. I feel it goes against the spirit of Black's AST safety check if we modify comments (it doesn't actually violate the check, of course, because comments aren't part of the AST). That concern becomes bigger the bigger the set of comments is for which we apply the transformation.</p>
<p>I think I'd be OK with normalizing whitespace in <code># type:</code> comments in Black, because those are a standardized part of the language. I'd be hesitant to change <code># fmt:off</code> comments because the point of those is to make Black <em>not</em> change things. With other tool-specific comments, I'd be a bit hesitant because we'd need to encode specific knowledge of what each tool accepts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-29 07:56</div>
            <div class="timeline-body"><blockquote>
<p>With other tool-specific comments, I'd be a bit hesitant because we'd need to encode specific knowledge of what each tool accepts.</p>
</blockquote>
<p>We'd need to do that for a ruff lint rule as well though, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-29 07:58</div>
            <div class="timeline-body"><blockquote>
<p>Yes, I was thinking about that. I feel it goes against the spirit of Black's AST safety check if we modify comments (it doesn't actually violate the check, of course, because comments aren't part of the AST). That concern becomes bigger the bigger the set of comments is for which we apply the transformation.
I'm personally less concerned about that, but I know it is an important property of/for Black. What you mean by that is that it doesn't change the representation as Python understands the AST? I'm saying that because our AST has much more details than Python's, e.g. we represent implicit concatenated strings and Black's unstable string-processing changes our AST (but presumably not Python's). One exception that Ruff already does here today is that it formats code blocks in docstrings.</p>
</blockquote>
<blockquote>
<p>I'd be hesitant to change # fmt:off comments because the point of those is to make Black not change things.</p>
</blockquote>
<p>That makes sense. Although I could see us formatting it as well, considering that <a href="https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ACiAGNdAD2IimZxl1N_WlbvK5V_5PM4Nceez9J8N3C1qIg8e7k4xLRet8g5rDCr1ZTcLnwPqqNluQY86f5RteS3yDZKrumMMSNP1D3BaaIGngwC75nTfhipsVg_PwJW6isSDNnkYGp7AAAAIFUG6pwdLrEAAX-jAQAAAOrpGraxxGf7AgAAAAAEWVo=">they get correctly indented today</a>.</p>
<blockquote>
<p>I'd be a bit hesitant because we'd need to encode specific knowledge of what each tool accepts</p>
</blockquote>
<p>That's fair. I'm not too familiar with any of those tools so it's hard for me to judge how common it is that the suppression comment format changed in the past. One argument I see against it is that Black so far has avoided very specific formatting rules to keep its formatting predictable (which I consider a key difference to Prettier, which has tons of very specific rules). Adding these tool-specific formatting rules goes against this.</p>
<blockquote>
<p>We'd need to do that for a ruff lint rule as well though, right?</p>
</blockquote>
<p>The difference that I see here is that you can opt out of the linter in case your tool changes in an incompatible way but you can't really do this in the formatter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2024-02-29 08:01</div>
            <div class="timeline-body"><blockquote>
<p>We'd need to do that for a ruff lint rule as well though, right?</p>
</blockquote>
<p>As @MichaReiser said, a lint rule is more granular while a formatter is pretty much all-or-nothing. (At least, Black is; I believe your formatter is a little more configurable.) With a lint rule you could add a configuration option to allow people to control what set of comments get formatted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-02-29 16:01</div>
            <div class="timeline-body"><blockquote>
<p>you could add a configuration option to allow people to control what set of comments get formatted.</p>
</blockquote>
<p>Good point. Ruff could have defaults for all the special comments it supports (see my list above) and let users expand with their other tools (up to maintainers if they want to support other popular tool comments by default)</p>
<p>With regex (maybe glob?) support, this could technically superseed https://docs.astral.sh/ruff/rules/missing-space-after-todo-colon/ entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/egberts">@egberts</a> on 2024-07-08 22:01</div>
            <div class="timeline-body"><p>Latest PyCharm fights with RUFF over their preferred format of RUF100 with this single space between RUF100 and colon symbol.</p>
<p>PyCharm only recognizes this format but RUF complains:</p>
<pre><code class="language-Python">call_me()  # NOQA : RUF100
</code></pre>
<p>RUF reformats as :</p>
<pre><code class="language-Python">call_me()  # NOQA: RUF100
</code></pre>
<p>but PyCharm complains:</p>
<p>Nobody is happy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-09 04:13</div>
            <div class="timeline-body"><p>@egberts Can you say more about this? What do you mean by &quot;PyCharm only recognizes this format (<code>NOQA : RUF100</code>)&quot; ?</p>
<img width="678" alt="Screenshot 2024-07-09 at 09 42 50" src="https://github.com/astral-sh/ruff/assets/67177269/26470b48-dc93-45ca-a652-508743b1c378">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/egberts">@egberts</a> on 2024-07-14 18:56</div>
            <div class="timeline-body"><p>It's a battle between RUFF and PyCharm,  one wants a space between the NOQA and the semicolon, the other doesn't.</p>
<p>After letting RUFF making the fix, PyCharm complains again.  Comply with PyCharm and RUFF  fix it up right back.</p>
<p>Who is correct?  We don't care, we just want consistency and concurrent agreement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-14 19:55</div>
            <div class="timeline-body"><p>I think the confusion on my end is that I've never seen PyCharm enforce this and I use it daily. I would be extremely surprised if PyCharm required a space before a colon here. Are you sure you don't have some specific configuration that's causing this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12810.html">astral-sh/ruff#12810</a> on 2024-08-12 06:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14111.html">astral-sh/ruff#14111</a> on 2024-11-05 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11789.html">astral-sh/ruff#11789</a> on 2024-11-18 00:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
