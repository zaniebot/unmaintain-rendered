```yaml
number: 13689
title: "[red-knot] Infer subscript expression types"
type: issue
state: closed
author: MichaReiser
labels:
  - ty
assignees: []
created_at: 2024-10-09T09:08:13Z
updated_at: 2024-10-29T11:14:43Z
url: https://github.com/astral-sh/ruff/issues/13689
synced_at: 2026-01-10T01:56:54Z
```

# [red-knot] Infer subscript expression types

---

_Issue opened by @MichaReiser on 2024-10-09 09:08_

Limited support for inferring subscript expressions, e.g when the value is a tuple, or string.

```python
def test(a: str):
	c = a[0]
```

---

_Referenced in [astral-sh/ty#244](../../astral-sh/ty/issues/244.md) on 2024-10-09 09:08_

---

_Renamed from "subscript expression @MichaReiser" to "[red-knot[ Infer subscript expression types" by @MichaReiser on 2024-10-09 09:08_

---

_Renamed from "[red-knot[ Infer subscript expression types" to "[red-knot] Infer subscript expression types" by @MichaReiser on 2024-10-09 09:08_

---

_Label `red-knot` added by @MichaReiser on 2024-10-09 09:09_

---

_Assigned to @MichaReiser by @MichaReiser on 2024-10-09 09:09_

---

_Comment by @MichaReiser on 2024-10-09 09:34_

@carljm String and tuple support has already been implemented in https://github.com/astral-sh/ruff/pull/13562. Do you have something else in mind that goes beyond what's covered in that PR?

---

_Comment by @AlexWaygood on 2024-10-09 11:08_

Following #13562, #13579 and #13667, I think the only thing we don't support with regard to type inference of subscript expressions is where a class does not define `__class_getitem__` but its metaclass defines `__getitem__`. But we don't really support anything regarding metaclasses yet.

---

_Comment by @AlexWaygood on 2024-10-09 11:35_

Oh, it looks like we might not support slices for string-literal and tuple types yet? `x[1:3]` should be inferred as `tuple[str, str]` if x has type `tuple[int, str, str, int]`. `y[1:3]` should be inferred as `Literal["aa"]` if y has type `Literal["baab"]`.

---

_Comment by @AlexWaygood on 2024-10-10 07:32_

We could probably also add special handling for subscript expressions where BytesLiteral types are on the l.h.s. and IntLiteral or BooleanLiteral types are on the r.h.s.

---

_Referenced in [astral-sh/ruff#13853](../../astral-sh/ruff/issues/13853.md) on 2024-10-21 10:16_

---

_Unassigned @MichaReiser by @sharkdp on 2024-10-21 10:47_

---

_Assigned to @sharkdp by @sharkdp on 2024-10-21 10:47_

---

_Referenced in [astral-sh/ruff#13901](../../astral-sh/ruff/pulls/13901.md) on 2024-10-24 07:38_

---

_Comment by @sharkdp on 2024-10-29 09:21_

> Oh, it looks like we might not support slices for string-literal and tuple types yet? `x[1:3]` should be inferred as `tuple[str, str]` if x has type `tuple[int, str, str, int]`. `y[1:3]` should be inferred as `Literal["aa"]` if y has type `Literal["baab"]`.

This is now supported via #13917 

> We could probably also add special handling for subscript expressions where BytesLiteral types are on the l.h.s. and IntLiteral or BooleanLiteral types are on the r.h.s.

This is now supported via #13901

> the only thing we don't support with regard to type inference of subscript expressions is where a class does not define `__class_getitem__` but its metaclass defines `__getitem__`. But we don't really support anything regarding metaclasses yet.

This is not yet supported. Do we want to close the ticket and come back to this when we tackle metaclasses, or keep it open until then?

---

_Comment by @AlexWaygood on 2024-10-29 10:29_

No strong opinion. When we add support for metaclasses, we'll have to audit lots of our type inference to account for the fact that any class must be considered an instance of its metaclass. So perhaps this could be closed; but it also doesn't hurt to keep it open so that we remember to address this last point.

---

_Comment by @sharkdp on 2024-10-29 11:14_

> When we add support for metaclasses, we'll have to audit lots of our type inference to account for the fact that any class must be considered an instance of its metaclass

I think this is a good enough reason to close this.

---

_Closed by @sharkdp on 2024-10-29 11:14_

---
