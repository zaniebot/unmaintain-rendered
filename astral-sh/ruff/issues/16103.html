<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deny f-string - astral-sh/ruff #16103</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Deny f-string</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/16103">#16103</a>
        opened by <a href="https://github.com/danmur97">@danmur97</a>
        on 2025-02-11 20:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/danmur97">@danmur97</a> on 2025-02-11 20:06</div>
            <div class="timeline-body"><h3>Description</h3>
<p>Python f-strings are comfortable to use, but insecure. The implicit conversion to a <code>str</code> makes that changes in the type of the objects inside the expression gets unnoticed.
e.g.
say you have some URL built from an f-string <code>my_url = &quot;https://something/{obj.base}/{obj.id}&quot;</code> and assume <code>obj</code> is an instance of <code>MyObj</code> defined as:</p>
<pre><code>@dataclass(frozen=True)
class MyObj:
    base: str
    obj_id: str
</code></pre>
<p>If you adjust the definition by changing the type of <code>obj_id</code> from <code>str</code> to a custom type <code>ObjectId</code> you can result in a bad encoded URL since the implicit conversion from <code>ObjectId</code> to <code>str</code> will provably have an incorrect format.</p>
<p>e.g. <code>&quot;https://something/foo/ObjectId(obj_id='the_id')&quot;</code> insead of <code>&quot;https://something/foo/the_id&quot;</code></p>
<p>For logging and info messages this detail is worthless but for other strings that represents references (ids, urls, etc), this can cause bugs that the type checker cannot catch.</p>
<p>For these reasons, a rule that denies using f-strings can be useful. <code>&quot;&quot;.join([&quot;a&quot;, &quot;b&quot;])</code> or using <code>+</code> is the preferred alternative.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-12 08:32</div>
            <div class="timeline-body"><p>The concern seems valid to me, although I'm not sure if denying f-string is the way to go. To me, it seems like what you want is a rule that catches implicit <code>str</code> conversions in f-strings for type that don't have a <code>__str__</code> implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-02-12 08:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2025-02-12 08:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danmur97">@danmur97</a> on 2025-02-12 13:35</div>
            <div class="timeline-body"><p>I agree, my concern is also with the use of <code>str()</code> and been able to use f-string safely is desirable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @MichaReiser on 2025-02-12 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16246.html">astral-sh/ruff#16246</a> on 2025-02-19 10:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
