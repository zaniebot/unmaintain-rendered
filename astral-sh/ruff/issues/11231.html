<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistency in line breaks (ruff formatter) - astral-sh/ruff #11231</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Inconsistency in line breaks (ruff formatter)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11231">#11231</a>
        opened by <a href="https://github.com/Romsik788">@Romsik788</a>
        on 2024-05-01 14:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Romsik788">@Romsik788</a></div>
            <div class="timeline-body">

<p>Ruff version: 0.4.2
Python version: 3.11.6</p>
<p>Hi, team
I&#x27;ve found that the ruff formatter doesn&#x27;t break a long string into a new line if the variable name is short. Here&#x27;s a simple example:</p>
<p>main.py</p>
<pre><code>LOREM_IPSUM_DOLOR_SIT_AMET = &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Lorem ipsum&quot;
LOREM_IPSUM = &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum.&quot;
</code></pre>
<p>When you run <code>ruff format .</code>, you&#x27;ll get the following:</p>
<p>main.py</p>
<pre><code>LOREM_IPSUM_DOLOR_SIT_AMET = (
    &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Lorem ipsum&quot;
)
LOREM_IPSUM = &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum.&quot;
</code></pre>
<p>I expected to see the following result:</p>
<pre><code>LOREM_IPSUM_DOLOR_SIT_AMET = (
    &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Lorem ipsum&quot;
)
LOREM_IPSUM = (
    &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum.&quot;
)
</code></pre>
<p>I want to add that I didn&#x27;t configure ruff beforehand and didn&#x27;t use any configuration files.
Could you please confirm if this is expected behaviour or a bug?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-01 14:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-05-01 14:24</div>
            <div class="timeline-body"><p>This is indeed the expected behavior in that it matches black&#x27;s formatting (<a href="https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AGjAMRdAD2IimZxl1N_Wj5ZEv8xqI44fiQb7AsoFHl1Vp1Lav7QjxfCBH-_hTuVkU7aSGNSgBFimDt2G5iyPgNmw-DG1MQJe-zkcIExLHxtuD3zdrjWCmGJohxXpfMRhDoqWqQF-89668oJVZpyHR0QahLCvFDajTS6iNmrh-2NkJg5ea48nq-ulGE6_LoqIdQACvQVNazAYOMZ5cjbpB9jxrFxtTh9ksRiTORXY2-aMqm6w0iVBYzMBVxAsu3Ox7iFq1DxaP3tgcQA61V-OuYvmJMAAeABpAMAAOTWPiixxGf7AgAAAAAEWVo=">playground</a>)</p>
<p>Now, the logic isn&#x27;t limited to whether the variable name is short, but whether the string will fit into the configured line-length when adding parentheses.</p>
<p>Adding parentheses in your first example does make the string fit. The line with the string is only 75 characters wide</p>
<pre><code>LOREM_IPSUM_DOLOR_SIT_AMET = (
    &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Lorem ipsum&quot;
)
</code></pre>
<p>Now, parenthesizing the second example doesn&#x27;t have the desired effect that the string fits into the line. Even when parenthesized, the string still has a width of 194. So ruff (and black) remove the parentheses.</p>
<pre><code>LOREM_IPSUM = (
	&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec purus ut felis fermentum.&quot;
)
</code></pre>
<p>I&#x27;m personally all in favour of always adding the parentheses because parenthesizing at least reduces the amount by which the string exceeds the configured line length. However, we do favor black compatibility for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Romsik788">@Romsik788</a> on 2024-05-01 14:34</div>
            <div class="timeline-body"><p>Hi @MichaReiser
Thanks for the detailed feedback. In this case, I will close the task.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Romsik788">@Romsik788</a> on 2024-05-01 14:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:53 UTC
    </footer>
</body>
</html>
