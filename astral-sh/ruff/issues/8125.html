<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`if-with-same-arms` (`SIM114`) false negative on `if` statements that raise or return - astral-sh/ruff #8125</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>if-with-same-arms</code> (<code>SIM114</code>) false negative on <code>if</code> statements that raise or return</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8125">#8125</a>
        opened by <a href="https://github.com/DetachHead">@DetachHead</a>
        on 2023-10-23 06:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/DetachHead">@DetachHead</a> on 2023-10-23 06:47</div>
            <div class="timeline-body"><pre><code class="language-py"># no error
if bool():
    raise Exception(&quot;foo&quot;)
if bool():
    raise Exception(&quot;foo&quot;)


def foo():
    # no error
    if bool():
        return &quot;foo&quot;
    if bool():
        return &quot;foo&quot;
</code></pre>
<p>https://play.ruff.rs/7890091d-5879-4420-9cf8-72cf9b7728f1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-10-23 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-10-25 09:49</div>
            <div class="timeline-body"><p>I don't think the issue here is with <code>Raise</code> or <code>return</code> but the fact that its separate <code>if</code> statements and not <code>if/elif</code> branches. If I run it against:</p>
<pre><code class="language-python">if bool():
    raise Exception(&quot;foo&quot;)
elif bool():
    raise Exception(&quot;foo&quot;)


def foo():
    if bool():
        return &quot;foo&quot;
    elif bool():
        return &quot;foo&quot;

</code></pre>
<p>SIM114 raises an error:</p>
<pre><code>        163 │+SIM114.py:120:1: SIM114 Combine `if` branches using logical `or` operator
        164 │+    |
        165 │+119 |   # no error
        166 │+120 | / if bool():
        167 │+121 | |     raise Exception(&quot;foo&quot;)
        168 │+122 | | elif bool():
        169 │+123 | |     raise Exception(&quot;foo&quot;)
        170 │+    | |__________________________^ SIM114
        171 │+    |
        172 │+
        173 │+SIM114.py:128:5: SIM114 Combine `if` branches using logical `or` operator
        174 │+    |
        175 │+126 |   def foo():
        176 │+127 |       # no error
        177 │+128 |       if bool():
        178 │+    |  _____^
        179 │+129 | |         return &quot;foo&quot;
        180 │+130 | |     elif bool():
        181 │+131 | |         return &quot;foo&quot;
        182 │+    | |____________________^ SIM114
        183 │+    |
        184 │+
</code></pre>
<p>Looking at upstream implementation it doesn't look like that catches identical separate <code>if</code> statements either. So I don't think this is a bug. Is this something we want to check for in SIM114 or a separate rule?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-01 05:55</div>
            <div class="timeline-body"><p>Thanks @qdegraaf for taking the time to look into this issue!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-12 02:12</div>
            <div class="timeline-body"><p>I think the current behavior is reasonable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-12 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GideonBear">@GideonBear</a> on 2026-01-03 13:11</div>
            <div class="timeline-body"><p>I would like to ask for reconsideration, especially because of the existence of <a href="https://docs.astral.sh/ruff/rules/superfluous-else-return/#superfluous-else-return-ret505">superfluous-else-return (RET505)</a>. RET505 indicates that writing this in the <code>if-if</code> style is preferred to writing it in the <code>if-elif</code> style. Take the following example: <a href="https://play.ruff.rs/a1efcc7f-af3e-4d6b-a923-c958ea86bf1a">playground</a></p>
<p>The functions have exactly the same behavior, and in both, SIM114 is valid. But by writing it in the preferred style following RET505, SIM114 doesn't trigger anymore. This means that people that write in the RET505 style by themselves, or fix RET505 before SIM114, don't get the benefit of SIM114.</p>
<p>I propose making SIM114 check, similarly to what RET505 checks in the first block, if the blocks return in all paths. If that is the case, pretend like it is <code>if-elif</code>.</p>
<p>This will make the rule more complex, as it will need to run on all pairs/sets of if statements. This can be a new RUF rule as well, if you don't want to overload SIM114.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GideonBear">@GideonBear</a> on 2026-01-10 09:44</div>
            <div class="timeline-body"><p>Opened #22489</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:10:16 UTC
    </footer>
</body>
</html>
