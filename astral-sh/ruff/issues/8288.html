<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve CI build and test times - astral-sh/ruff #8288</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve CI build and test times</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/8288">#8288</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-10-27 20:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-27 20:50</div>
            <div class="timeline-body"><p><strong>Without cache hit</strong> <a href="https://github.com/astral-sh/ruff/actions/runs/6670980068">source</a></p>
<p>Compile time for Linux tests 7m 23s
Compile time for Windows tests 8m 56s
Runtime for docs check 2m 33s</p>
<p><strong>With cache hit</strong> <a href="https://github.com/astral-sh/ruff/actions/runs/6671183579">source</a></p>
<p>Compile time for Linux tests 3m 13s
Compile time for Windows tests 4m 48s
Runtime for docs check 35s</p>
<p>CI takes an additional 2 minutes to run the tests in both environments</p>
<p>We only check documentation on Linux.</p>
<p>It'd be great if these were faster. I'm not sure it's possible but I'd love to hear ideas.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-27 20:58</div>
            <div class="timeline-body"><p>Is that the documentation check, or doc tests?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-27 21:01</div>
            <div class="timeline-body"><p>It's the <code>cargo doc</code> command (and most of the time is spent compiling) so it should just be documentation checks.</p>
<p>Considering how slow doctests are generally though, an action item here may be to investigate the time of doctests :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2023-10-27 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-27 21:03</div>
            <div class="timeline-body"><p>Related exploration of nextest</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/3752</li>
<li>#6979</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-27 22:49</div>
            <div class="timeline-body"><p>We could consider paying for runners with more CPUs (https://docs.github.com/en/actions/using-github-hosted-runners/about-larger-runners/about-larger-runners) although I would like to chase free options first :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-30 21:02</div>
            <div class="timeline-body"><p>Related:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/1820</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8544.html">astral-sh/ruff#8544</a> on 2023-11-07 16:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-07 16:33</div>
            <div class="timeline-body"><p>I haven't looked at CI and the build in detail, but if any of it is building in release mode with fat LTO enabled, then that is likely taking some sizeable chunk of time. Fat LTO is notorious for being horrendously slow. #8544 switches over to thin LTO. The other thing potentially worth experimenting with is bumping up the <code>codegen-units</code> from <code>1</code> to something a little higher. It lets compilation use more parallelization at the expense of potentially giving up some code optimizations.</p>
<p>In addition to the other ideas mentioned, particularly in the non-cache case, a more involved approach might be to reduce the number of dependencies overall. Ruff has quite a lot of them. However, it's not clear to me how much the non-cache case truly matters. (I imagine most folks are installing Ruff as a wheel of some kind? Apologies for the deployment ignorance here on my part.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-07 16:39</div>
            <div class="timeline-body"><blockquote>
<p>(I imagine most folks are installing Ruff as a wheel of some kind? Apologies for the deployment ignorance here on my part.)</p>
</blockquote>
<p>No worries at all. That's right, the vast majority of downloads are pre-compiled wheels that we upload to PyPI. (These are basically compiled binaries that get wrapped up with some other metadata in a zip archive.) I would say slow release builds are mostly a problem for <em>development</em> (especially profiling). And slow debug builds are <em>definitely</em> a problem for development.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-08 10:57</div>
            <div class="timeline-body"><p>I believe the most impactful - but also most effort - change would be splitting up the <code>ruff_linter</code> crate (#1820), the crate is very slow to compile compared to other crates i've used, even in debug mode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by @MichaReiser on 2023-11-27 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> removed by @MichaReiser on 2023-11-27 23:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
