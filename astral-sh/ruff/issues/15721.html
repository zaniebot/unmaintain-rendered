<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N806 - function scoped constans in upper case - astral-sh/ruff #15721</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>N806 - function scoped constans in upper case</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/15721">#15721</a>
        opened by <a href="https://github.com/Pijukatel">@Pijukatel</a>
        on 2025-01-24 15:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Pijukatel">@Pijukatel</a> on 2025-01-24 15:19</div>
            <div class="timeline-body"><h3>Description</h3>
<p>Hello, I have a question about rule <a href="https://docs.astral.sh/ruff/rules/non-lowercase-variable-in-function/">N806.</a></p>
<p>This is the simplified use that triggers the rule:</p>
<pre><code>def foo(x):
    VERY_DESCRIPTIVE_NAME = 1.23456 # Used only in this function
    # Some complex calculations
    return x * VERY_DESCRIPTIVE_NAME 
</code></pre>
<p>I have checked <a href="https://peps.python.org/pep-0008/#constants">PEP8 - constants</a>, but I didn't find a hard restriction on defining constant in a function.
To my interpretation very relaxed formulation &quot;Constants are <strong>usually</strong> defined...&quot; doesn't prohibit defining function scoped constants.</p>
<p>I am not sure in which way is the ruff trying to steer me, but none of the alternatives seems good to me.
Alternatives:
1 - Have the function scoped constant lower case.
2 - Define this constant outside of the function despite the fact that it is relevant and used only in this single function.
3 - Using unnamed inline constant with a comment explaining it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dylwil3 on 2025-01-24 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dylwil3 on 2025-01-24 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dylwil3 on 2025-01-24 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-24 18:43</div>
            <div class="timeline-body"><p>This sounds related to https://github.com/astral-sh/ruff/issues/13550 with the exception that it's a &quot;constant&quot; literal to the right.</p>
<p>I could see an argument for assignments annotated with <code>typing.Final</code>, although @AlexWaygood seemed to be against this in the linked issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-24 18:43</div>
            <div class="timeline-body"><p>You raise an interesting point. It has come up in the <code>pep8-naming</code> linter (e.g. https://github.com/PyCQA/pep8-naming/issues/87) and it looks like they settled on keeping the rule as is.</p>
<p>I could see an argument for any of the following:</p>
<ol>
<li>Keeping the rule as is, and relying on suppression comments or ignoring the rule if the lint is undesired. (This outcome probably wouldn't feel very nice on your end.)</li>
<li>Skipping the lint if the constant is annotated with <code>Final</code> (Seems pretty safe to me)</li>
<li>Skipping the lint if the assignment is to a literal.</li>
<li>Skipping the lint if the assignment is to a literal and no further bindings are present in the function scope.</li>
</ol>
<p>Edit: I didn't see that related issue before. Alex makes good points, I'm sort of inclined to agree.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../apify/crawlee-python/pulls/930.html">apify/crawlee-python#930</a> on 2025-01-27 07:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
