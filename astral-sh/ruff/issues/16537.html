<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F841 treats `except` bindings differently from all other bindings - astral-sh/ruff #16537</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F841 treats <code>except</code> bindings differently from all other bindings</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16537">#16537</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-03-06 15:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body">Summary
<p>The implementation of <a href="https://docs.astral.sh/ruff/rules/unused-variable/">unused-variable (F841)</a> is split: <code>except</code> bindings <a href="https://github.com/astral-sh/ruff/blob/0.9.9/crates/ruff_linter/src/checkers/ast/analyze/bindings.rs#L33">are handled separately in bindings.rs</a>, causing false positives. They should be processed consistently with other bindings.</p>
<p>One false positive occurs when the bound variable is not used within the <code>except</code> block but is used outside it. The fix can change program behavior by suppressing a runtime error. The fix could be beneficial, but it should be marked unsafe like other unused bindingsâ€™ fixes.</p>
<pre><code>$ cat &gt;f841_1.py &lt;&lt;&#x27;# EOF&#x27;
def f():
    e = None
    try:
        1 / 0
    except ZeroDivisionError as e:
        pass
    print(e)
f()
# EOF

$ python f841_1.py 2&gt;&amp;1 | tail -n 1
UnboundLocalError: cannot access local variable &#x27;e&#x27; where it is not associated with a value

$ ruff --isolated check --select F841 f841_1.py --fix
Found 1 error (1 fixed, 0 remaining).

$ cat f841_1.py
def f():
    e = None
    try:
        1 / 0
    except ZeroDivisionError:
        pass
    print(e)
f()

$ python f841_1.py
None
</code></pre>
<p>Another false positive occurs when the binding is not within a function.</p>
<pre><code>$ cat &gt;f841_2.py &lt;&lt;&#x27;# EOF&#x27;
e = None
try:
    1 / 0
except ZeroDivisionError as e:
    pass
print(e)
# EOF

$ python f841_2.py 2&gt;&amp;1 | tail -n 1
NameError: name &#x27;e&#x27; is not defined

$ ruff --isolated check --select F841 f841_2.py --fix
Found 1 error (1 fixed, 0 remaining).

$ cat f841_2.py
e = None
try:
    1 / 0
except ZeroDivisionError:
    pass
print(e)

$ python f841_2.py
None
</code></pre>
<p>There are other false positives, but they are all variations on the same theme. They can probably all be fixed by merging the two F841 implementations.</p>
Version
<p>ruff 0.9.9 (091d0af2a 2025-02-28)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-06 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-06 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/teddylear">@teddylear</a> on 2025-05-20 23:47</div>
            <div class="timeline-body"><p>@dscorbett I can try to give this a shot, but at little confused at the ask. I can make the edit unsafe that you listed, but not sure what you mean by <code>except bindings [are handled separately in bindings.rs</code>. I&#x27;m new to repo so trying to get clarification of ask before implementing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-05-21 19:05</div>
            <div class="timeline-body"><p>F841 is triggered in two files, <a href="https://github.com/astral-sh/ruff/blob/0.11.10/crates/ruff_linter/src/checkers/ast/analyze/deferred_scopes.rs#L423">deferred_scopes.rs</a> and <a href="https://github.com/astral-sh/ruff/blob/0.11.10/crates/ruff_linter/src/checkers/ast/analyze/bindings.rs#L33">bindings.rs</a>. The latter implementation has various false positives. My suggestion is to merge it into the former implementation. However, as long as they are consistent with each other and the false positives are resolved, merging them is not strictly necessary.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:37 UTC
    </footer>
</body>
</html>
