<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official docker image - astral-sh/ruff #5072</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Official docker image</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5072">#5072</a>
        opened by <a href="https://github.com/daveisfera">@daveisfera</a>
        on 2023-06-14 03:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-06-14 03:06</div>
            <div class="timeline-body"><p>Could an official docker image be created for <code>ruff</code>, so it's easier to run in CI environments?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">release</span> added by @charliermarsh on 2023-06-14 03:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Werni2A">@Werni2A</a> on 2023-06-14 17:31</div>
            <div class="timeline-body"><p>Not official but you could use <a href="https://hub.docker.com/r/pipelinecomponents/ruff">GitLab's implementation of the container</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-06-15 00:59</div>
            <div class="timeline-body"><p>That looks like a decent option to start with, but it is using it's own versioning system and the advantage of an official <code>ruff</code> image would be that it would track with the version numbers of this project</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-22 05:57</div>
            <div class="timeline-body"><p>I know it's not really what you've been asking for, but would</p>
<pre><code class="language-shell">docker run --rm --entrypoint bash -v $(pwd):/io python:3.11 -c &quot;python -m pip install ruff==0.0.274 &amp;&amp; ruff /io&quot;
</code></pre>
<p>work for you? It has the version number and takes about 3.5s on my machine. I've been looking for an image with pipx which would be nicer but couldn't find a well maintained one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-10-24 22:28</div>
            <div class="timeline-body"><blockquote>
<p>I know it's not really what you've been asking for, but would</p>
<pre><code class="language-shell">docker run --rm --entrypoint bash -v $(pwd):/io python:3.11 -c &quot;python -m pip install ruff==0.0.274 &amp;&amp; ruff /io&quot;
</code></pre>
<p>work for you? It has the version number and takes about 3.5s on my machine. I've been looking for an image with pipx which would be nicer but couldn't find a well maintained one.</p>
</blockquote>
<p>That's definitely possible, but then that has to be downloaded and installed each time. Hoping for something simpler for CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2023-10-25 02:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-10-25 08:59</div>
            <div class="timeline-body"><p>What CI system are you using and how does a docker image (vs., let's say <code>pipx run ruff=0.1</code>) integrate into you use case there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-10-25 13:02</div>
            <div class="timeline-body"><p>We're using GitHub Actions, so I could use the available action for that, but I prefer using a container to run the process because then we can be sure that what's run on the developers machine is the exact same process. Maybe that's overly paranoid on my part, but my quick poking around didn't show an easy way to run <code>ruff</code> as a File Watcher with a guaranteed version on every developers machine, but with the container approach, when the commit is made to update the version in GitHub Actions it rolls out to ever developer machine at the same time and that's really the solution I'm looking for</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-11-07 19:55</div>
            <div class="timeline-body"><p>Here's <code>Dockerfile</code>s for building a minimal image with multi-arch support:</p>
<p>Alpine:</p>
<pre><code>FROM alpine:3.18

WORKDIR /usr/local/bin

ENV RUFF_VERSION 0.1.4

RUN export RUFF_ARCH=$(uname -m) &amp;&amp; \
  wget -qO- &quot;https://github.com/astral-sh/ruff/releases/download/v${RUFF_VERSION}/ruff-${RUFF_ARCH}-unknown-linux-musl.tar.gz&quot; | tar xz

CMD [&quot;/usr/local/bin/ruff&quot;]
</code></pre>
<p>Debian:</p>
<pre><code>FROM debian:bookworm-slim

WORKDIR /usr/local/bin

ENV RUFF_VERSION 0.1.4

RUN export RUFF_ARCH=$(uname -m); \
    savedAptMark=&quot;$(apt-mark showmanual)&quot;; \
    apt-get update; \
    apt-get install -y --no-install-recommends \
        ca-certificates \
        wget \
    ; \
    \
    wget -qO- &quot;https://github.com/astral-sh/ruff/releases/download/v${RUFF_VERSION}/ruff-${RUFF_ARCH}-unknown-linux-gnu.tar.gz&quot; | tar xz; \
    \
    apt-mark auto '.*' &gt; /dev/null; \
    apt-mark manual $savedAptMark; \
    apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \
    rm -rf /var/lib/apt/lists/*; \
    \
    /usr/local/bin/ruff --version

CMD [&quot;/usr/local/bin/ruff&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 20:24</div>
            <div class="timeline-body"><p>Are there clear trade-offs to pulling the builds from GitHub vs including a build image step? I think using a <code>build</code> image would be nice for:</p>
<ul>
<li>Building non-release images e.g. a nightly image</li>
<li>Building images locally</li>
</ul>
<p>There's, of course, some complexity added there.</p>
<p>It'd also be nice to use <a href="https://github.com/GoogleContainerTools/distroless">distroless</a>? Multi-arch support added in https://github.com/GoogleContainerTools/distroless/pull/591</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-11-07 20:51</div>
            <div class="timeline-body"><blockquote>
<p>Are there clear trade-offs to pulling the builds from GitHub vs including a build image step? I think using a <code>build</code> image would be nice for:</p>
<ul>
<li>Building non-release images e.g. a nightly image</li>
<li>Building images locally</li>
</ul>
<p>There's, of course, some complexity added there.</p>
</blockquote>
<p>I think that would be great! I just couldn't find any info on how to build <code>ruff</code> and since <a href="https://github.com/docker-library/faq#multi-stage-builds">multi-stage builds are basically unsupported in official images</a>, it's hard to make a small image while building without jumping through a lot of hoops.</p>
<blockquote>
<p>It'd also be nice to use <a href="https://github.com/GoogleContainerTools/distroless">distroless</a>? Multi-arch support added in <a href="https://github.com/GoogleContainerTools/distroless/pull/591">GoogleContainerTools/distroless#591</a></p>
</blockquote>
<p>In my experience, <code>distroless</code> isn't worth the trouble in cases like this (especially since there's already support for <code>musl</code>). The smallest base image they provide is 15 MB and the Alpine image is half that size, so if you want really small, Alpine is the smaller option and has other benefits when it comes to debugging and other fun stuff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 21:04</div>
            <div class="timeline-body"><p>Huh interesting, they say otherwise?</p>
<blockquote>
<p>The smallest distroless image, gcr.io/distroless/static-debian11, is around 2 MiB. That's about 50% of the size of alpine (~5 MiB).</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 21:07</div>
            <div class="timeline-body"><blockquote>
<p>since <a href="https://github.com/docker-library/faq#multi-stage-builds">multi-stage builds are basically unsupported in official images</a>, it's hard to make a small image while building without jumping through a lot of hoops.</p>
</blockquote>
<p>Oh interesting, I presumed this issue was requesting an <code>astral-sh/ruff</code> image on DockerHub but you're looking for a <code>ruff</code> image in the Docker official images program?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-11-07 23:12</div>
            <div class="timeline-body"><blockquote>
<p>Huh interesting, they say otherwise?</p>
<blockquote>
<p>The smallest distroless image, gcr.io/distroless/static-debian11, is around 2 MiB. That's about 50% of the size of alpine (~5 MiB).</p>
</blockquote>
</blockquote>
<p>I was looking at the <code>base</code> image, so it does seem like you could make it smaller than Alpine. Sorry for the misinformation there.</p>
<p>I tried running the currently built images with <code>distroless</code> and they don't work because the required libraries aren't there. It would have to be built from source with static linking. Are there instructions on how to build <code>ruff</code> so I could give that a whirl?</p>
<blockquote>
<blockquote>
<p>since <a href="https://github.com/docker-library/faq#multi-stage-builds">multi-stage builds are basically unsupported in official images</a>, it's hard to make a small image while building without jumping through a lot of hoops.</p>
</blockquote>
<p>Oh interesting, I presumed this issue was requesting an <code>astral-sh/ruff</code> image on DockerHub but you're looking for a <code>ruff</code> image in the Docker official images program?</p>
</blockquote>
<p>I'm fine with it being wherever, but if it's not an official image, then <a href="https://docs.docker.com/docker-hub/download-rate-limit/">rate limits will apply</a> and for a tool like this, I think that would be a problem</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 23:42</div>
            <div class="timeline-body"><p>Ah that's complicated since we build Python wheels using Maturin:</p>
<ul>
<li>https://github.com/astral-sh/ruff/blob/main/.github/workflows/release.yaml#L208-L213</li>
<li>https://github.com/PyO3/maturin-action</li>
<li>https://github.com/PyO3/maturin</li>
</ul>
<p>@konstin definitely knows more about this than me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daveisfera">@daveisfera</a> on 2023-11-08 05:23</div>
            <div class="timeline-body"><blockquote>
<p>Ah that's complicated since we build Python wheels using Maturin:</p>
<ul>
<li>https://github.com/astral-sh/ruff/blob/main/.github/workflows/release.yaml#L208-L213</li>
<li>https://github.com/PyO3/maturin-action</li>
<li>https://github.com/PyO3/maturin</li>
</ul>
</blockquote>
<p>Ideally, <code>pip</code>/<code>python</code> wouldn't be involved in this at all. I'm assuming that <code>ruff</code> can be built directly from source and that's what would be put in this image</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-08 10:48</div>
            <div class="timeline-body"><p>We can put the statically linked binary in a scratch image: https://github.com/astral-sh/ruff/pull/8554</p>
<pre><code class="language-Dockerfile">FROM rust:1.73 as build

RUN apt update &amp;&amp; apt install musl musl-dev musl-tools
RUN rustup target add x86_64-unknown-linux-musl
COPY crates crates
COPY Cargo.toml Cargo.toml
COPY Cargo.lock Cargo.lock
RUN cargo build --bin ruff --release --target x86_64-unknown-linux-musl
# Optimize binary size
RUN strip --strip-all target/x86_64-unknown-linux-musl/release/ruff

FROM scratch
COPY --from=build target/x86_64-unknown-linux-musl/release/ruff /ruff
WORKDIR /io
ENTRYPOINT [&quot;/ruff&quot;]
</code></pre>
<pre><code class="language-console">$ docker run -v .:/io --rm ruff check --select G004 .
scripts/check_ecosystem.py:51:26: G004 Logging statement uses f-string
scripts/check_ecosystem.py:55:22: G004 Logging statement uses f-string
scripts/check_ecosystem.py:84:13: G004 Logging statement uses f-string
scripts/check_ecosystem.py:177:18: G004 Logging statement uses f-string
scripts/check_ecosystem.py:200:18: G004 Logging statement uses f-string
scripts/check_ecosystem.py:354:18: G004 Logging statement uses f-string
scripts/check_ecosystem.py:477:18: G004 Logging statement uses f-string
Found 7 errors.
</code></pre>
<pre><code class="language-console">$ docker image ls ruff
 REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
 ruff         latest    505876b0f817   2 minutes ago   16.2MB
</code></pre>
<p>I've never worked with docker multi arch, so i'd be happy if someone wants to port the dockerfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-12-07 14:56</div>
            <div class="timeline-body"><p>The docker image is available at https://ghcr.io/astral-sh/ruff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-12-07 14:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:25 UTC
    </footer>
</body>
</html>
