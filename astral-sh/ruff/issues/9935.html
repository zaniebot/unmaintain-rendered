<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRIO115 false positive with with `sleep(var)` where `var` starts as `0` - astral-sh/ruff #9935</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>TRIO115 false positive with with <code>sleep(var)</code> where <code>var</code> starts as <code>0</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9935">#9935</a>
        opened by <a href="https://github.com/mikenerone">@mikenerone</a>
        on 2024-02-11 19:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mikenerone">@mikenerone</a></div>
            <div class="timeline-body"><p>Ruff 0.2.1</p>
<p>The following snippet illustrates a TRIO115 false positive when <code>sleep()</code> is passed a variable whose initial value was <code>0</code>, but changes later in a loop construct. Similar to #9934, this is already fixed in <code>flake8-trio</code>. This seems to be strongly indicating that recent fixes to <code>flake8-trio</code> need to be ported in general.</p>
<pre><code>import trio

async def main() -&gt; None:
    sleep = 0
    for _ in range(2):
        # ↓↓↓↓↓ TRIO115 [*] Use `trio.lowlevel.checkpoint()` instead of `trio.sleep(0)`
        await trio.sleep(sleep)
        sleep = 10

trio.run(main)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 20:50</div>
            <div class="timeline-body"><p>Thanks. I don&#x27;t think this has been &quot;fixed&quot; in <code>flake8-trio</code> -- rather, <code>flake8-trio</code> <em>never</em> flags with a non-constant, it only flags if you pass exactly <code>0</code>. You can see the source here: https://github.com/Zac-HD/flake8-trio/blob/a652441fb3a9a92f14da3542bb2a0a1ba8f03f87/flake8_trio/visitors/visitors.py#L219.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 20:51</div>
            <div class="timeline-body"><p>We could consider doing the same, or just check if the variable is ever re-bound to something else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;TRIO115 false positive with with `sleep(var)` where `var` starts as `0` (already fixed in `flake8-trio` - ruff is out of date)&quot; to &quot;TRIO115 false positive with with `sleep(var)` where `var` starts as `0`&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikenerone">@mikenerone</a> on 2024-02-11 22:10</div>
            <div class="timeline-body"><blockquote>
<p>Thanks. I don&#x27;t think this has been &quot;fixed&quot; in <code>flake8-trio</code> -- rather, <code>flake8-trio</code> <em>never</em> flags with a non-constant, it only flags if you pass exactly <code>0</code>.</p>
</blockquote>
<blockquote>
<p>We could consider doing the same, or just check if the variable is ever re-bound to something else.</p>
</blockquote>
<p>@charliermarsh Oh, I see - you&#x27;re correct. Not flagging on a non-constant sounds reasonable to me. With a variable, even <em>if</em> not re-bound, it seems like the developer is signaling that it&#x27;s considered changeable in at least some sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 23:04</div>
            <div class="timeline-body"><p>Agreed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-12 00:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakkdl">@jakkdl</a> on 2024-02-12 10:10</div>
            <div class="timeline-body"><p>flake8-trio dev here:
the &quot;constant&quot; in the source code is just how the AST labels literals, flake8-trio doesn&#x27;t track the values of any variables (and has no straightforward way of doing so)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robincaloudis">@robincaloudis</a> on 2024-03-27 22:27</div>
            <div class="timeline-body"><p>As <a href="https://github.com/astral-sh/ruff/pull/10376">astral-sh/ruff#10376</a> is merged, it looks like this issue could be closed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 23:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:50 UTC
    </footer>
</body>
</html>
