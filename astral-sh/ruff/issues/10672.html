<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: rule that prohibits any use of type:ignore, and other type-checking-suppression mechanisms - astral-sh/ruff #10672</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: rule that prohibits any use of type:ignore, and other type-checking-suppression mechanisms</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10672">#10672</a>
        opened by <a href="https://github.com/wyattscarpenter">@wyattscarpenter</a>
        on 2024-03-30 17:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/wyattscarpenter">@wyattscarpenter</a> on 2024-03-30 17:05</div>
            <div class="timeline-body"><p>PEP 484 lists several ways to ignore type checking https://peps.python.org/pep-0484/#compatibility-with-other-uses-of-function-annotations:</p>
<ul>
<li><code># type: ignore</code> comment</li>
<li>a <code>@no_type_check</code> decorator on a class or function</li>
<li>a custom class or function decorator marked with <code>@no_type_check_decorator</code></li>
</ul>
<p>While useful, these get around static type safety without ensuring dynamic type correctness, which can often be sign that something else is wrong in the code. Sometimes you have to use them—you know how it is—but it's not ideal. That means, in my opinion, it would be great to have a linter rule disallowing their use, to ensure code quality in codebases where they are not in fact needed.</p>
<p>This would be similar to https://docs.astral.sh/ruff/rules/blanket-type-ignore/ , but disallow <em>all</em> uses of type: ignore comments, no_type_check decorators, and no_type_check_decorators</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-30 17:31</div>
            <div class="timeline-body"><p>Thanks for the idea! I'm not <em>sure</em> I see the benefit of prohibiting all <code>type: ignore</code> comments, though, since presumably you'd easily be able to switch the &quot;never use a <code>type: ignore</code> comment&quot; lint off with a <code># noqa</code> comment. So I feel like if someone really wants to switch the type checker off for a line, they'll just do</p>
<pre><code class="language-py">1 + &quot;1&quot;  # type: ignore  # noqa
</code></pre>
<p>rather than</p>
<pre><code class="language-py">1 + &quot;1&quot;  # type: ignore
</code></pre>
<p>and you're maybe not any better off than before?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-03-30 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @AlexWaygood on 2024-03-30 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wyattscarpenter">@wyattscarpenter</a> on 2024-03-30 17:55</div>
            <div class="timeline-body"><p>I didn't think of that interaction! It is faintly ridiculous that you can re-enable the comment immediately by using another comment, but on reflection I don't think it's that different than any other situation where you might use <code>#noqa</code>. The linter rule is designed to prevent you from footgunning yourself, so to speak, and it's up to your judgement if you want to override that; if you're really really sure :)</p>
<p>You could also do something like a rule that forbids noqa on such lines, somewhat similar in concept to https://docs.astral.sh/ruff/rules/blanket-noqa/ in that it lints the noqas themselves, but that seems a little counter to the spirit of a linter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-30 17:59</div>
            <div class="timeline-body"><blockquote>
<p>The linter rule is designed to prevent you from footgunning yourself, so to speak, and it's up to your judgement if you want to override that; if you're really really sure :)</p>
</blockquote>
<p>Sure -- but you could also say that all type checker rules are designed to prevent you from footgunning yourself. By using a <code>type: ignore</code> on the line, you're already explicitly &quot;opting into lack of footgun protection&quot; ;)</p>
<p>So the only way I could see that Ruff could add value here would be by providing a rule that, unlike the type checker complaints, you <em>can't</em> switch off with a suppression comment. And that, as you say, feels slightly counter to the spirit of how Ruff usually does things.</p>
<p>(Your <code>@no_type_check</code> and <code>no_type_check_decorator</code> ideas are slightly different; my critique of your proposal doesn't apply to those :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python/mypy/issues/17078.html">python/mypy#17078</a> on 2024-03-30 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wyattscarpenter">@wyattscarpenter</a> on 2024-03-30 19:22</div>
            <div class="timeline-body"><p>I still think it would be useful, but it's possible I'm ignorant about how most other people tend to use linters and typecheckers. Or perhaps it depends somewhat on whether you think of the typechecker as an orthogonal type of constraint system, or something the linter should lint as well. (Although the decorators seem to me like they would stand and fall on the same merits, so maybe I'm thinking about that wrong.—Maybe it's about whether you think comments should be linted?) And, further, I suppose it depends on how often you suppose someone will use a type ignore comment wrongly, and whether that reaches the (in)tolerance level a linter rule should hypothetically have.</p>
<p>I'm primarily imagining two example situations in which I think the lint rule would be useful, but they are perhaps idiosyncratic to myself:</p>
<ol>
<li><p>I have a codebase that I expect to be entirely (verifiably) well-typed. Someone else adds a new line that includes a type ignore comment. The linter rule then tells them that this isn't expected, and they should reconsider. They can override this like any noqa situation, of course, but at least they know this is vaguely expected to be wrong, and might reconsider it, or we might reconsider the idea that the codebase is entirely well-typed, or reconsider what we were trying to do with the new code.</p>
</li>
<li><p>I inherit a codebase that I would like to make entirely (verifiably) well-typed. In this case, the linter tells me what parts are not, by detecting these comments, and I can address them through refactoring; or at least refactoring until I find some are impossible to resolve, in which case I remove this rule from my linter set, or perhaps noqa the exceptions.</p>
</li>
</ol>
<p>It's worth noting that a typechecker could implement this feature, but so could a linter, and then using <em>either</em> the given typechecker or the given linter would give me the desired behavior, and I would have flexibility to choose between multiple linters and typecheckers, respectively. Although, while I'm at it, it's worth noting that <code>grep</code> can also basically implement this feature.</p>
<p>All that now said, I defer to the judgement of others wrt this proposal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-04-08 23:27</div>
            <div class="timeline-body"><p>It feels to me like this idea assumes no false-positives from type checkers. Which of course isn't the case.</p>
<p>Ensuring no blanket suppression makes sense, but that's already supported by the tools offering said suppression comments.</p>
<p>I understand wanting to promote other devs to understand <em>why</em> an issue is raised by a tool, rather than blindly ignoring. That's why at work I enforce that suppression comments should <em>always</em> come with an explanation. This way the developer <em>signals</em> a clear intent, which can better be caught in review, or whilst reading back older code. (done through https://eslint-community.github.io/eslint-plugin-eslint-comments/rules/require-description.html for JS/TS code, I don't think there's an equivalent for Python, that's a proposal I'd be interested in as well)
Edit: Looks like there's an open request for that: https://github.com/astral-sh/ruff/issues/8454</p>
<hr />
<blockquote>
<p>(Your @no_type_check and no_type_check_decorator ideas are slightly different; my critique of your proposal doesn't apply to those :-)</p>
</blockquote>
<p>Same</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/worldmind">@worldmind</a> on 2024-05-21 17:49</div>
            <div class="timeline-body"><p>As for me it should be checked on code-review - you already has enabled rule for check typing and if somebody disabling them it's topic for discussion (as sign of possible disagreement in team), but it should be possible to disable anything, because final decision is on humans.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
