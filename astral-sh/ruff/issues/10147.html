<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File pattern syntax differs between exclude and per-file-ignores - astral-sh/ruff #10147</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>File pattern syntax differs between exclude and per-file-ignores</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10147">#10147</a>
        opened by <a href="https://github.com/neelmraman">@neelmraman</a>
        on 2024-02-27 19:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/neelmraman">@neelmraman</a></div>
            <div class="timeline-body"><p>Hi, thanks for the work on this great project! One thing I found kind of surprising (and that doesn&#x27;t seem to be explicitly mentioned in the docs anywhere) is that <code>exclude</code>/<code>extend-exclude</code> and <code>per-file-ignores</code>/<code>extend-per-file-ignores</code> seem to use a different syntax for specifying file patterns.</p>
<p>Here is a fairly minimal way to reproduce on ruff v0.2.2:</p>
<ol>
<li>create a new repo with this structure</li>
</ol>
<pre><code>.
├── bar_dir
│   └── a.py
├── foo_dir
│   └── a.py
└── pyproject.toml
</code></pre>
<p>where <code>pyproject.toml</code> is</p>
<pre><code>[tool.ruff]
exclude = [&quot;foo_dir&quot;]

[tool.ruff.lint]
select = [&quot;F&quot;]

[tool.ruff.lint.per-file-ignores]
&quot;bar_dir&quot; = [&quot;F401&quot;]
</code></pre>
<p>and both directories have an <code>a.py</code> that looks like</p>
<pre><code>import os

print(&quot;hello&quot;)
</code></pre>
<ol>
<li>run <code>ruff check</code>, and you should see an error reported for the bar_dir file but not the foo_dir file, implying the directory name alone worked as a pattern in <code>exclude</code> but not in <code>per-file-ignores</code></li>
<li>update <code>pyproject.toml</code> so that the <code>per-file-ignores</code> is now something like <code>&quot;bar_dir/**/*.py&quot; = [&quot;F401&quot;]</code>, and run <code>ruff check</code> again, which should produce no errors.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-27 21:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-04 12:45</div>
            <div class="timeline-body"><p>Agree that this is confusing and something I ran into myself with <a href="https://github.com/astral-sh/ruff/issues/8267"><code>lint.exclude</code> and <code>format.exclude</code></a>. We should revisit the glob patterns in our configuration</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-11 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-11 17:36</div>
            <div class="timeline-body"><p>If anyone has the time, a comparison of the different formats with some notes would be helpful for designing a path forward here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Boon-in-Oz">@Boon-in-Oz</a> on 2024-06-05 02:47</div>
            <div class="timeline-body"><p>I&#x27;ve run into this problem too. I cannot come up with a pattern to match a directory in per-file-ignores. I can ignore a file by name, but I can&#x27;t ignore all files in a directory. Does anyone have a workaround? That is, a way to exclude a directory?</p>
<p>I&#x27;ve tried all of these without success:</p>
<pre><code>&quot;**/dir_name/*.py&quot;
&quot;dir_name/**.py&quot;
&quot;/dir_name/**.py&quot;
&quot;dir_name&quot;
&quot;dir_name/*&quot;
&quot;dir_name/**&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-05 16:42</div>
            <div class="timeline-body"><p>@Boon-in-Oz -- Can you share a full reproducible example? <code>&quot;**/dir_name/*.py&quot;</code> works for me as expected.</p>
<p>Specifically, I created <code>bar/baz/bop.py</code> with an unused import, and the following <code>pyproject.toml</code> in the current working directory:</p>
<pre><code>[tool.ruff.lint.per-file-ignores]
&quot;**/baz/*.py&quot; = [&quot;F401&quot;]
</code></pre>
<p><code>ruff check .</code> shows no error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Boon-in-Oz">@Boon-in-Oz</a> on 2024-06-06 08:26</div>
            <div class="timeline-body"><p>Hey thanks for the quick response. You&#x27;re correct, that does work.</p>
<p>I think it&#x27;s due to my using the &quot;extend&quot; command in ruff.toml. I can reproduce it like this:</p>
<p>I&#x27;m working in a multi-root workspace in VS Code, using Ruff for linting, rather than running Ruff from the command line.
I have two ruff.toml files. One is in the same dir as foo_dir and bar_dir in the example. The other is in a different root entirely, which seems to be important.</p>
<p>So in my case my code-workspace file is</p>
<pre><code>{
	&quot;folders&quot;: [
        {
            &quot;name&quot;: &quot;base&quot;,
            &quot;path&quot;: &quot;.&quot;
        },
        {
            &quot;name&quot;: &quot;more&quot;,
            &quot;path&quot;: &quot;../../parts&quot;
        },
    ],
}
</code></pre>
<p>With foo_dir and bar_dir both in the &quot;base&quot; directory. In bar_dir there is an a.py that looks like</p>
<pre><code>fooBar = 1
</code></pre>
<p>ruff.toml in the &quot;base&quot; directory looks like</p>
<pre><code>extend = &quot;../../../parts/ruff.toml&quot;
</code></pre>
<p>and parts/ruff.toml looks like</p>
<pre><code>[lint]
select = [&quot;N&quot;]

[lint.per-file-ignores]
&quot;**/bar_dir/*.py&quot; = [&quot;N816&quot;]
#&quot;a.py&quot; = [&quot;N816&quot;]
</code></pre>
<p>bar_dir/a.py shows error N816.
If I comment that last line in the second ruff.toml, the error goes away. If I move the [lint.per-file-ignores] section to the first ruff.toml, the error goes away.</p>
<p>(Sorry I hope that makes sense. I&#x27;m new to reporting Git issues and out of time for today but I can try to upload this all tomorrow. Also, I think I have my workaround: I can move the ignores to the other ruff.toml easily enough.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-07 03:11</div>
            <div class="timeline-body"><p>That actually still works for me, emulating the <code>extend</code>.</p>
<p>You can try running <code>ruff check --show-settings</code> in the directory to see what the resolved <code>per-file-ignore</code> patterns look like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Boon-in-Oz">@Boon-in-Oz</a> on 2024-06-07 03:42</div>
            <div class="timeline-body"><p>Thanks. So running this in my &quot;base&quot; dir (C:\test\test\ruff_test)</p>
<pre><code>&quot;path\to\ruff.exe&quot; check --show-settings bar_dir\a.py
</code></pre>
<p>Gives this for the <code>linter.per_file_ignores</code> section:</p>
<pre><code>linter.per_file_ignores = {
        absolute_matcher = &quot;C:\test\parts\**\bar_dir\*.py&quot;
basename_matcher = &quot;**/bar_dir/*.py&quot;
negated = false
rules = [
        mixed-case-variable-in-global-scope (N816),
]

}
</code></pre>
<p>which matches the result I see. The path <code>&quot;**/bar_dir/*.py&quot;</code> is resolved under the local directory of <code>C:\test\parts\ruff.toml</code>, resulting in <code>&quot;C:\test\parts\**\bar_dir\*.py&quot;</code>, so it doesn&#x27;t match <code>&quot;C:\test\test\ruff_test\bar_dir\a.py&quot;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-07 03:48</div>
            <div class="timeline-body"><p>What is the <code>extends</code> exactly in this case? And what is the <code>trees\cod\trunk</code> path?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Boon-in-Oz">@Boon-in-Oz</a> on 2024-06-07 04:01</div>
            <div class="timeline-body"><p>bar_dir/ruff.toml contains only
<code>extend = &quot;../../../parts/ruff.toml&quot;</code>
And whoops I didn&#x27;t consistently modify all my paths when I typed them. That should be <code>C:\test</code>. Fixed now.</p>
<p>Here are the files you need for my repro:
<a href="https://github.com/user-attachments/files/15704557/test.zip">test.zip</a></p>
<p>I unzipped into C:, navigated (in a Windows cmd prompt) to C:\test, then ran
<code>ruff.exe check --no-fix test\ruff_test\bar_dir\a.py</code>
and got the N816 error.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:50 UTC
    </footer>
</body>
</html>
