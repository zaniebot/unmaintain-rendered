<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add new rule to prevent nested list footgun - astral-sh/ruff #10505</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Add new rule to prevent nested list footgun</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10505">#10505</a>
        opened by <a href="https://github.com/qexat">@qexat</a>
        on 2024-03-21 09:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/qexat">@qexat</a> on 2024-03-21 09:03</div>
            <div class="timeline-body"><p>Hello.</p>
<p>I don't really work with nested lists but I know that it's quite common among the sci community (in fact I'm opening this issue after seeing <a href="https://twitter.com/francoisfleuret/status/1770528106513600636">this tweet</a>).</p>
<p>I dug into the tracker to see if it was suggested before, but I could not find anything. I forgot to record what I tried, though.</p>
<p>Anyway, here is an excerpt of the issue:</p>
<pre><code class="language-py"># It might not be intuitive that the lists inside are actually the same
# It is very likely not to be intended, and a footgun all the time
foo: list[list[int]] = [[]] * 4

foo[0].append(42)

print(foo)  # [[42], [42], [42], [42]]
</code></pre>
<p>It's quite silly and experienced Python programmers <em>usually</em> don't fall for it, but people for whom coding is not their main activity and/or beginners can and do.</p>
<p>This rule could also be extended to passing a list literal as the second argument of <code>dict.fromkeys</code>, although this might be considered out of this issue's scope.
(+ I don't know by heart all the places where this &quot;lists that actually share the same memory&quot; footgun appears, but feel free to list some more.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-03-21 09:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hikaru-kajita">@hikaru-kajita</a> on 2024-03-21 10:50</div>
            <div class="timeline-body"><p>Happens for all kinds of mutable, so we could add rules for those included:</p>
<pre><code class="language-python">foo = [set()] * 4
foo[0].add(42)
print(foo)  # [{42}, {42}, {42}, {42}]

bar = [{}] * 4
bar[0][&quot;a&quot;] = 42
print(bar)  # [{'a': 42}, {'a': 42}, {'a': 42}, {'a': 42}]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10507.html">astral-sh/ruff#10507</a> on 2024-03-21 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qexat">@qexat</a> on 2024-03-21 16:38</div>
            <div class="timeline-body"><p>Dang it, I missed this discussion. I really am terrible at searching up.
But yeah, of course, any mutable non-scalar object should be included.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pankdm">@pankdm</a> on 2024-11-10 23:23</div>
            <div class="timeline-body"><p>I think it might be pretty hard to detect really dangerous examples of that with high precision. Looking at https://grep.app/search?q=%5B%5B%5D%5D%20%2A&amp;case=true&amp;filter[lang][0]=Python there are plenty of usages, but they all look fine.
Someone needs to do</p>
<pre><code>foo[0].append(bar)
</code></pre>
<p>to make it a real footgun.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12115.html">astral-sh/ruff#12115</a> on 2024-11-15 10:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
