<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> `flake8-type-checking` TCH00{1,2,3}: False negative  - astral-sh/ruff #2761</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>flake8-type-checking</code> TCH00{1,2,3}: False negative</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2761">#2761</a>
        opened by <a href="https://github.com/MaksimZayats">@MaksimZayats</a>
        on 2023-02-11 10:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MaksimZayats">@MaksimZayats</a></div>
            <div class="timeline-body"><p>Hi! First of all, thank you so much for the amazing project!</p>
<p>I think I found a bug with <code>flake8-type-checking (TCH)</code>:
If you try to create any variables with uninitialized objects at right-hand-side, TCH will raise an error.
But if you move these imports into <code>if TYPE_CHECKING</code> block, you will get a <code>NameErorr</code>: <code>NameError: name 'MyClass' is not defined</code>, because <code>from __future__ import annotations</code> doesn't cover this use case.</p>
<pre><code>├── main
│   ├── __init__.py
│   ├── aliases.py
│   └── somefile.py
└── pyproject.toml
</code></pre>
<pre><code class="language-python"># aliases.py
from __future__ import annotations

from collections.abc import Callable
from typing import Any, TypeAlias

from main.somefile import MyClass

AnyCallable: TypeAlias = Callable[..., Any]
MyClassAlias: TypeAlias = MyClass
</code></pre>
<pre><code class="language-python"># somefile.py
from __future__ import annotations


class MyClass:
    pass
</code></pre>
<pre><code class="language-toml">[tool.ruff]
select = [&quot;ALL&quot;]
ignore = [&quot;D10&quot;]

[tool.ruff.isort]
required-imports = [&quot;from __future__ import annotations&quot;]

</code></pre>
<p>Ruff output:</p>
<pre><code class="language-bash">main\aliases.py:3:29: TCH003 Move standard library import `collections.abc.Callable` into a type-checking block
main\aliases.py:6:27: TCH001 Move application import `main.somefile.MyClass` into a type-checking block
</code></pre>
<p>Version: <code>ruff 0.0.245</code></p>
<p>UPD: one more example:</p>
<pre><code class="language-python">from __future__ import annotations

from typing import TYPE_CHECKING, Any, TypeVar

if TYPE_CHECKING:
    from collections.abc import Callable

F = TypeVar(&quot;F&quot;, bound=Callable[..., Any])

&quot;&quot;&quot;
    F = TypeVar(&quot;F&quot;, bound=Callable[..., Any])
                           ^^^^^^^^
NameError: name 'Callable' is not defined. Did you mean: 'callable'?  
&quot;&quot;&quot;

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-02-11 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-11 17:02</div>
            <div class="timeline-body"><p>Definitely a bug, thank you for the clear issue!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-11 17:43</div>
            <div class="timeline-body"><p>Fixed in the next release (probably tomorrow?).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-11 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MaksimZayats">@MaksimZayats</a> on 2023-02-11 19:25</div>
            <div class="timeline-body"><p>@charliermarsh, thanks for the quick fix!</p>
<p>But there is one more specific use case:</p>
<pre><code class="language-python">if TYPE_CHECKING:
    from blahblah import MyClass1, MyClass2

MyDefaultDict: TypeAlias = DefaultDict[&quot;MyClass1&quot;, &quot;list[MyClass2]&quot;]
</code></pre>
<p>Ruff output:</p>
<pre><code>Move import `...` out of type-checking block. Import is used for more than type hinting.Ruff(TCH004)
</code></pre>
<p>I think in cases where annotations are used in quotes, <code>TCH004</code> should not be raised.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-11 19:53</div>
            <div class="timeline-body"><p>Right right, my bad.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:46:28 UTC
    </footer>
</body>
</html>
