```yaml
number: 9994
title: bandit check seems to link arguments not function call
type: issue
state: closed
author: Borda
labels:
  - bug
assignees: []
created_at: 2024-02-15T10:13:25Z
updated_at: 2024-06-26T09:02:47Z
url: https://github.com/astral-sh/ruff/issues/9994
synced_at: 2026-01-10T01:56:51Z
```

# bandit check seems to link arguments not function call

---

_Issue opened by @Borda on 2024-02-15 10:13_

It seems that Ruff reports wrong lines for this bandit issue
```py
out = subprocess.check_output(  # <-- yesqa expected
    ["git", "rev-parse", "HEAD"],  # <-- ruff reported
    stderr=DEVNULL,
)
```
in fact, it creates deadlock as `yesqa` removes `noqa`s from line 2 as it expects them with line 1, but then ruff reports line 2
```
2: S603 `subprocess` call: check for execution of untrusted input
2: S607 Starting a process with a partial executable path
```
adding a dummy line to the argument, and it seems to be baked with the first argument as this 
```py
out = subprocess.check_output(  # <-- yesqa expected
	print(), # <-- ruff reported
    ["git", "rev-parse", "HEAD"],
    stderr=DEVNULL,
)
```
still reports line 2 but the next one
```py
out = subprocess.check_output(  # <-- yesqa expected
	# any line
    ["git", "rev-parse", "HEAD"],  # <-- ruff reported
    stderr=DEVNULL,
)
```
reports line 3

--

using pre-commit with 
```yaml
  - repo: https://github.com/asottile/yesqa
    rev: v1.5.0
    hooks:
      - id: yesqa
        additional_dependencies:
          - flake8-bandit

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.2.1
    hooks:
      - id: ruff
        args: ["--fix"]
```

---

_Referenced in [python-cachier/cachier#186](../../python-cachier/cachier/pulls/186.md) on 2024-02-15 10:14_

---

_Referenced in [python-cachier/cachier#192](../../python-cachier/cachier/pulls/192.md) on 2024-02-15 21:54_

---

_Label `bug` added by @charliermarsh on 2024-02-16 03:32_

---

_Comment by @charliermarsh on 2024-02-16 03:32_

Interesting, will take a look.

---

_Comment by @dhruvmanila on 2024-02-16 06:38_

It seems like `bandit` highlights the `subprocess.check_output` call in the diagnostic and we highlight the argument. And, `yesqa` uses the location bandit provides to check if NoQA comment is valid or not.

```console
$ bat src/S603.py 
         File: src/S603.py
     1   import subprocess
     2   
     3   out = subprocess.check_output(
     4       ["git", "rev-parse", "HEAD"],
     5   )

$ flake8 src/S603.py
src/S603.py:1:1: S404 Consider possible security implications associated with the subprocess module.
src/S603.py:3:1: S607 Starting a process with a partial executable path
src/S603.py:3:1: S603 subprocess call - check for execution of untrusted input.
```

A simple fix would be to use the same location.

---

_Comment by @charliermarsh on 2024-02-16 06:41_

Note that in general, using `yesqa` alongside Ruff isn't necessarily a supported workflow (for this reason: we don't guarantee that our rules trigger on the exact same locations, since we sometimes refine the ranges).

---

_Comment by @dhruvmanila on 2024-02-16 06:49_

You can use our own implementation of [`unused-noqa`](https://docs.astral.sh/ruff/rules/unused-noqa/) if `yesqa` isn't strictly required in your workflow.

---

_Comment by @charliermarsh on 2024-02-16 06:59_

@dhruvmanila - I'm not totally sure which (if any) of these rules should have their ranges adjusted -- would need to look...

---

_Referenced in [astral-sh/ruff#10667](../../astral-sh/ruff/pulls/10667.md) on 2024-03-30 00:37_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-03-30 00:37_

---

_Referenced in [astral-sh/ruff#12005](../../astral-sh/ruff/pulls/12005.md) on 2024-06-26 08:52_

---

_Added to milestone `v0.5.0` by @MichaReiser on 2024-06-26 09:02_

---

_Closed by @MichaReiser on 2024-06-26 09:02_

---
