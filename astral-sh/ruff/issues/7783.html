<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ideas for new lints around iteration - astral-sh/ruff #7783</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ideas for new lints around iteration</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7783">#7783</a>
        opened by <a href="https://github.com/alexprengere">@alexprengere</a>
        on 2023-10-03 15:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alexprengere">@alexprengere</a> on 2023-10-03 15:48</div>
            <div class="timeline-body"><p>I apologize if you not looking for new lints to implement in Ruff.</p>
<p>I do a fair share of code reviews, and I quite often stumble on these issues which are not caught by any linter AFAICT (flake8, pylint, refurb, ruff). I am not sure how hard those would be to implement, as for the first one you would need some type inference.</p>
<pre><code class="language-python">a = [1, 2]
b = [3, 4]

# Not good
for x in a + b:
    print(x)

# Better but not really good either
for x in *a, *b:
    print(x)

# Best
for x in itertools.chain(a, b):
    print(x)
</code></pre>
<p>This happens really often when people want to iterate on multiple lists, tuples, etc.
Another one in a similar spirit:</p>
<pre><code class="language-python">a = [1, 2]
b = [3, 4]
c = [a, b]

# Not good
for x in itertools.chain(*c):
    print(x)

# Better
for x in itertools.chain.from_iterable(c):
    print(x)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-03 15:52</div>
            <div class="timeline-body"><p>Thanks! One question -- given:</p>
<pre><code class="language-python"># Not good
for x in a + b:
    print(x)
</code></pre>
<p>When would it be <em>invalid</em> to rewrite as <code>itertools.chain(a, b)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-10-03 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexprengere">@alexprengere</a> on 2023-10-03 16:24</div>
            <div class="timeline-body"><p>If you are sure <code>a</code> and <code>b</code> are lists or tuples, I think it is never invalid to rewrite.
It can be invalid on classes that would be iterable but also implement some type of addition that is not concatenation, like a numpy matrix:</p>
<pre><code class="language-python">import numpy as np

a = b = np.matrix([[1,2], [3,4]])

for x in a + b:
    print(x)
# [[2 4]]
# [[6 8]]

for x in itertools.chain(a, b):
    print(x)
# [[1 2]]
# [[3 4]]
# [[1 2]]
# [[3 4]]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-03 16:26</div>
            <div class="timeline-body"><p>Thanks, that makes sense. We do have the ability to do limited within-file inference for lists, tuples, sets, and dictionaries, with the downside that the inference can lead to false-negatives (but is a reasonable fit for rules like this).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> removed by @charliermarsh on 2023-10-03 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-10-03 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @charliermarsh on 2023-10-03 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2023-10-08 19:47</div>
            <div class="timeline-body"><p>flake8-simplify or flake8-comprehensions may be interested in this rule as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-10-12 19:39</div>
            <div class="timeline-body"><p>Idk how complete it is, but refurb added <code>itertool.chain</code> related checks lately: https://github.com/dosisod/refurb/pull/293</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:31 UTC
    </footer>
</body>
</html>
