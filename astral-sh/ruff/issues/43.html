<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable installation via cargo - astral-sh/ruff #43</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable installation via cargo</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/43">#43</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-08-29 17:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-08-29 17:35</div>
            <div class="timeline-body"><p>We can't upload to crates.io because we're using an unreleased version of RustPython.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-08-29 21:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-24 14:44</div>
            <div class="timeline-body"><p>I've asked about publishing Ruff's RustPython fork here: https://github.com/RustPython/RustPython/issues/4179</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youknowone">@youknowone</a> on 2022-10-15 05:08</div>
            <div class="timeline-body"><p>Regardless we are ready or not, I want to distribute rustpython-parser before ruff 0.1. Please poke me when you are ready for 0.1. I seriously don't want to block ruff's schedule by our fault.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-15 14:42</div>
            <div class="timeline-body"><p>@youknowone - Thank you, that's really helpful and appreciated.</p>
<p>There are a few PRs I'd need to merge to move off of my <code>RustPython</code> fork (which is largely ahead of <code>main</code>) -- I know you know about some of these, but I'll just enumerate them here for completeness:</p>
<ul>
<li>https://github.com/RustPython/RustPython/pull/4192</li>
<li>https://github.com/RustPython/RustPython/pull/4143</li>
<li>(Not totally essential) https://github.com/charliermarsh/RustPython/pull/3</li>
<li>https://github.com/RustPython/RustPython/pull/4218</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @charliermarsh on 2022-12-31 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">core</span> added by @charliermarsh on 2022-12-31 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-11 16:27</div>
            <div class="timeline-body"><p>RustPython just cut a new release on <a href="https://crates.io/crates/rustpython-parser">crates.io</a>. So the only blocker here is (1) confirming that we want to use the Crate, which might mean we're a little slower to pick up changes from Git; and (2) LibCST is still using my unpublished fork (which just removes pyo3 stuff).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-06-03 18:02</div>
            <div class="timeline-body"><p>Hey! I was looking at adding documentation for installation from crates.io then realized it wasn't supported :D</p>
<ol>
<li><p>Is it feasible to use RustPython from Git for other releases and only publish to <code>crates.io</code> if the published RustPython version has the sufficient changes? Is that worth the trouble?</p>
</li>
<li><p>Is this resolved now?</p>
</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-03 19:00</div>
            <div class="timeline-body"><p>I think there are three blockers here that we'd need to resolve, since, in order to publish to <code>crates.io</code>, we can't have any Git dependencies in the dependency tree:</p>
<ol>
<li>Publish our parser fork as their own crates (https://github.com/astral-sh/RustPython-Parser), e.g., <code>ruff_rustpython_parser</code> or similar.</li>
<li>In RustPython (and our fork), remove the Git dependency on <a href="https://github.com/astral-sh/RustPython-Parser/blob/7a3eedbf6fb4ea7068a1bf7fe0e97e963ea95ffd/Cargo.toml#LL41C1-L41C15">unicode_names2</a>.</li>
<li>Publish our LibCST fork as its own crate (https://github.com/charliermarsh/LibCST/tree/charlie/ruff).</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-06-03 21:30</div>
            <div class="timeline-body"><p>Related https://github.com/RustPython/Parser/issues/67</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youknowone">@youknowone</a> on 2023-06-04 08:17</div>
            <div class="timeline-body"><p>I'd like to grant publish permission of parser to anyone from Ruff who need it.
I didn't finish unicode_names2 patch to merge it yet. I need to port the implementation to its own phf.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mtshiba/pylyzer/issues/44.html">mtshiba/pylyzer#44</a> on 2023-06-11 11:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7179.html">astral-sh/ruff#7179</a> on 2023-09-06 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2023-10-17 15:20</div>
            <div class="timeline-body"><p>I think all mentioned blockers are gone, Are there any new?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-17 15:41</div>
            <div class="timeline-body"><p>Yes now that we've resolved the blockers we are considering publishing to crates.io but have not come to a decision yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KGrewal1">@KGrewal1</a> on 2024-02-18 10:21</div>
            <div class="timeline-body"><p>Has there been any update on this (or would <code>cargo install --git  https://github.com/astral-sh/ruff ruff </code>work: seems to install but I'm not sure if there's tests I can run to confirm: does seem to be working on code I have)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-18 14:22</div>
            <div class="timeline-body"><p>@KGrewal1 -- <code>cargo install --git  https://github.com/astral-sh/ruff ruff</code> should work just fine! I tested it myself too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10417.html">astral-sh/ruff#10417</a> on 2024-03-15 03:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14051.html">astral-sh/ruff#14051</a> on 2024-11-01 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/philwo">@philwo</a> on 2025-01-28 02:25</div>
            <div class="timeline-body"><p>We're currently looking into options for a new Python code formatter for Chromium, and while we haven't made any decision yet, Ruff is definitely a favorite. ðŸ˜Š</p>
<p>This issue is a blocker for us, though, as we have a policy that all third-party software has to be mirrored into our internal repository, and tools then have to be built from there using internal infrastructure for security reasons. This would be very easy to setup for me if Ruff and all of its dependencies were published to crates.io, as we have existing automation and processes for importing packages hosted there.</p>
<p>Would you be open to revisit this issue and see if Ruff could be published to crates.io?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-28 02:44</div>
            <div class="timeline-body"><p>Thanks @philwo -- that's cool to hear! We can definitely consider it -- will need to discuss as a team. I assume it's not sufficient to, like, mirror the source distribution that we publish to PyPI, and build wheels from that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/philwo">@philwo</a> on 2025-01-31 08:41</div>
            <div class="timeline-body"><p>Thank you @charliermarsh! I had a look - building Ruff locally on my developer machine from these sources works perfectly. But unfortunately the production environment, where I'd have to build and deploy the Ruff binary in the end, is very much optimized for the case where everything can be imported automatically from crates.io, and straying from that path quickly turns into a total headache. :/</p>
<p>In case that you would be fine in general with publishing Ruff's code to crates.io and making it buildable from there, and that there are only technical blockers and &quot;someone has to do the work&quot; remaining, would that be something we could help with by contributing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-31 20:39</div>
            <div class="timeline-body"><p>We sometimes release from forks of dependencies to get bug fixes to our users faster. I'm a little hesitant to lose the ability to do so. Of course, that idea is generally in conflict with downstream re-distributors.</p>
<p>I think the other concern is that people may consider our Rust libraries as part of our public API when, in reality, most (if not all) of our Rust APIs are unstable.</p>
<p>I'll make sure we talk about this as a team next week. It'd be great to see Ruff used for Chromium.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-01-31 21:31</div>
            <div class="timeline-body"><p>One of the other issues here is that publishing <code>ruff</code> on crates.io, AFAIK, requires that <em>all</em> of its dependencies are on crates.io too. <code>ruff</code> is split into a ton of different crates. So all of those would need to be published.</p>
<p>Today, when we make changes across crates (which is I think very common), we just make the changes. There's really nothing else to be done.</p>
<p>But if all of these crates are published to crates.io, then I think there is a fair bit of overhead here:</p>
<ul>
<li>The versions on crates that have been changed need to be bumped.</li>
<li>The versions on crates depending on those crates need to have the dependency specification changed to reflect the new minimum version.</li>
<li>The above two steps need to be repeated recursively up to <code>ruff</code> itself.</li>
</ul>
<p>There is also the question of semver, but I think we could essentially bypass this entirely by using <code>0.0.x</code> versioning exclusively.</p>
<p>So I think that while the initial work to get everything published to crates.io is somewhat straight-forward, I think the ongoing burden of dealing with a bunch of independently published crates is pretty annoying.</p>
<p>My suspicion is that it's possible to automate the steps above. If that can be done in a way where our core development workflow can remain blissfully unaware of the fact that every internal crate is actually versioned, then I think that would mitigate my primary concern.</p>
<p>Is there tooling that you're aware of that helps with this problem?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KGrewal1">@KGrewal1</a> on 2025-02-01 09:25</div>
            <div class="timeline-body"><p>I believe it is possible to have <code>{workspace=true}</code> for crates within the workspace in which case the all the crates which are for internal use, could use that and only the version number in the workspace cargo.toml needs to be changed from 0.0.x to 0.0.x+1 (or however versioning internal crates is decided): think cargo smart release or cargo release also help with publishing the workspaces https://crates.io/crates/cargo-smart-release</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-01 20:15</div>
            <div class="timeline-body"><p>@philwo just for my understanding. Are you limited to rust tooling (because they can only be installed from crates.io) or can you use other packages hosted on pypi (e.g. in case of black or any other Python tool)?</p>
<p>Also for my curiosity. For which Chromium project are you evaluating ruff?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/philwo">@philwo</a> on 2025-02-05 09:27</div>
            <div class="timeline-body"><p>@BurntSushi @KGrewal1 I don't have much experience with Rust yet, but this reminds me very much of the tradeoff of working in a monorepo vs. having to coordinate changes across multiple repos that depend on each other. The ability to make atomic changes easily across all crates is worth a lot, for sure! If <code>{workspace=true}</code> and <code>cargo smart-release</code> would allow you to continue doing that in your &quot;monorepo&quot; here, while also making it possible to easily publish stable release versions of Ruff to crates.io as a collection of individual, versioned crates that depend on each other, that seems like a super nice solution to me :)</p>
<p>@MichaReiser No, we're not limited to Rust tooling. We can import third-party open-source code written in most of the major languages into our monorepo and build it there. The problem is more that this import process tends to only support the canonical way how stuff is distributed in the respective language ecosystem, and doesn't handle special cases well.</p>
<p>For example, if I wanted to import a Go library that didn't use <code>go.mod</code> to manage its dependencies, but pulled them in via Git submodules or relied on a <code>vendor</code> folder managed via some custom script, it would likely not work.</p>
<p>Re: Black - we have an internal fork of Black called <a href="https://github.com/google/pyink">Pyink</a> that stays in close sync with upstream and for all that matters to Chromium can be assumed to behave identically to upstream Black. Pyink's code is bi-di synced from and to GitHub on each change using automated tooling. Using Pyink / Black is the other option currently part of the proposal.</p>
<blockquote>
<p>Also for my curiosity. For which Chromium project are you evaluating ruff?</p>
</blockquote>
<p>I'm part of a group of Chromium developers currently writing a proposal to change <a href="https://chromium.googlesource.com/chromium/src/+/main/styleguide/python/python.md">Chromium's Python style guide</a> from YAPF to a more modern alternative. A few developers mentioned Ruff and that it has a couple of great benefits over Black, which is why I'm trying to find a way how to make it work, so that we can put it into the proposal as well. The change, if accepted by the Chromium Python developers committee, would then cover all of the Python code in Chromium's ecosystem, except ChromiumOS, which has <a href="https://www.chromium.org/chromium-os/developer-library/reference/style-guides/python/">its own style guide</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-05 10:25</div>
            <div class="timeline-body"><p>Thanks for the explanation. I assume something like <code>uv pip install ruff --no-binary :all:</code> that forces ruff to be built from the wheel's source wouldn't work for you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/philwo">@philwo</a> on 2025-02-05 14:27</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the explanation. I assume something like <code>uv pip install ruff --no-binary :all:</code> that forces ruff to be built from the wheel's source wouldn't work for you.</p>
</blockquote>
<p>Unfortunately not :( As we'd need to run the resulting <code>ruff</code> binary also on production servers, so that we could e.g. execute it to check formatting and possibly lint from Chromium's Gerrit or a web-based code editor, the security and auditing requirements for the builds and everything that goes into the resulting artifacts are really tough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../conda/rattler/issues/1044.html">conda/rattler#1044</a> on 2025-02-11 15:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16227.html">astral-sh/ruff#16227</a> on 2025-02-18 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreatedBySeb">@CreatedBySeb</a> on 2025-04-09 17:55</div>
            <div class="timeline-body"><p>Chiming in with a related need, at the company I work for we are able to build Rust-based packages from source and consume them in our software without them being published on crates.io, however those packages cannot have git dependencies, only local and crates.io dependencies, which I understand to also be a blocker for publishing on crates.io. I thought I would bring this up here, since it gives a different use case for the first portion of the work, which is removing any git dependencies from Ruff.</p>
<p>To provide context on the why, my company does third party library auditing when importing libraries. There is automated support for doing this from sources like crates.io and PyPI, and you can manually pull in the git source and do it yourself, however having direct git dependencies in <code>Cargo.toml</code> doesn't really fit in either box and is explicitly disallowed. Working around this would probably require build-time patching to redirect the dependencies to manually imported ones, which would get messy fast and slow adoption of new versions. It would be easiest for us to adopt new versions if all of Ruff's dependencies were available on crates.io, even if Ruff itself wasn't.</p>
<p>Currently the latest version of Ruff we have available internally is <code>v0.4.4</code>, since it doesn't have any git dependencies (<code>v0.4.5</code> introduced the <code>lsp-types</code> fork, and <code>v0.4.9</code> introduced salsa via git). There is significant appetite for using Ruff in my company (some teams are continuing to use the old version rather than go back to Flake8, black &amp; isort), but we are missing out on lots of valuable improvements as a result of this issue which hampers widespread adoption. My team was recently re-evaluating Ruff and was interested in adopting it across our codebases, but the inability to adopt new versions is a blocker for us.</p>
<p>What are the possible paths forward for this? My understanding would be the following:</p>
<ol>
<li>For <code>lsp-types</code>, either:
a. Publish the fork, e.g. as <code>ruff-lsp-types</code>
b. Upstream the changes to <code>lsp-types</code>, and swap the dependency to their published crate once they are released</li>
<li>For <code>salsa</code>, have them publish the changes in their master which are not yet released, and swap the dependency to the published crate</li>
</ol>
<p>Publishing a fork for <code>salsa</code> also is technically an option, but since the issue isn't the changes being merged just them being released, it doesn't seem worthwhile.</p>
<p>Happy to provide support if I can on unblocking this, since it will be significantly beneficial to my team and company more broadly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-04-09 18:26</div>
            <div class="timeline-body"><p>@CreatedBySeb Can you say more about why git dependencies are explicitly disallowed? I'm not quite grok'ing why they complicate things for you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreatedBySeb">@CreatedBySeb</a> on 2025-04-09 19:00</div>
            <div class="timeline-body"><p>@BurntSushi Sure thing, essentially how the process normally works (taking Rust as an example) is that packages are imported from crates.io by a system that does supply chain checks for license, security, etc. They are then made available in an internal registry which cargo is directed to use, so when I build a package with cargo it can only access the vetted packages and anything else will not be found. Git dependencies bypass the registry entirely and so they are blocked by our build fleet since the packages are not vetted, which means that we cannot publish/consume packages with git dependencies. Similar processes are used for other languages with implementation differences based on that language's tooling, some of which facilitate patching these types of cases more easily than others. This isn't a policy we are likely to be able to change, but it does also make reasonable sense since it would be hard to replicate this type of supply chain validation for Git dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cjames23">@cjames23</a> on 2025-04-10 13:27</div>
            <div class="timeline-body"><p>I just want to add one other wrinkle that we have, I work at the same company as Seb, locally our users this can work because they have network access to build but on our build system we are network jailed and in the case of packages like ruff we compile from source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisjsewell">@chrisjsewell</a> on 2025-04-15 04:38</div>
            <div class="timeline-body"><p>I would note rustpython now uses the ruff parser: https://github.com/RustPython/RustPython/pull/5494
It currently has to source from GitHub, which seems really not great at all ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../salsa-rs/salsa/pulls/753.html">salsa-rs/salsa#753</a> on 2025-04-15 07:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreatedBySeb">@CreatedBySeb</a> on 2025-04-22 19:20</div>
            <div class="timeline-body"><p>Since salsa has just done a release to <code>0.20.0</code> (https://github.com/salsa-rs/salsa/pull/753), could this be a good time to swap to a crates dependency on it rather than the git dependency? This release has the commit currently depended upon within it, so this shouldn't result in a regression for Ruff, but would remove one of the two git dependencies that are a blocker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17566.html">astral-sh/ruff#17566</a> on 2025-04-22 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreatedBySeb">@CreatedBySeb</a> on 2025-04-22 20:54</div>
            <div class="timeline-body"><p>In order to help minimise the effort required by the maintainers, I have made the minimal PR to change the versions having run the test suites on two devices to ensure it still works as expected: https://github.com/astral-sh/ruff/pull/17566</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17970.html">astral-sh/ruff#17970</a> on 2025-05-09 06:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/283.html">astral-sh/ruff#283</a> on 2025-05-13 04:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:48 UTC
    </footer>
</body>
</html>
