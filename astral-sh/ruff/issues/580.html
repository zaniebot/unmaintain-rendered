<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 false positive when assigning to a dict - astral-sh/ruff #580</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F821 false positive when assigning to a dict</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/580">#580</a>
        opened by <a href="https://github.com/jiwidi">@jiwidi</a>
        on 2022-11-04 11:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jiwidi">@jiwidi</a> on 2022-11-04 11:55</div>
            <div class="timeline-body"><p>Hi! Love what you are building with ruff.</p>
<p>I'm trying it out now and found a weird behavior that i dont know if its a bug or something im missing.</p>
<pre><code class="language-python">def api_event_json(api_key, model_name, user_id=None, item_id=None):
    dict = {
        &quot;headers&quot;: {
            &quot;x-api-key&quot;: api_key,
        },
        &quot;queryStringParameters&quot;: {&quot;limit&quot;: &quot;5&quot;},
        &quot;pathParameters&quot;: {&quot;model&quot;: model_name},
    }

    if user_id is not None:
        dict[&quot;queryStringParameters&quot;][&quot;user_id&quot;] = user_id
    if item_id is not None:
        dict[&quot;queryStringParameters&quot;][&quot;item_id&quot;] = item_id

    return dict
</code></pre>
<p>Why would this code throw F821?</p>
<pre><code>F821 Undefined name `queryStringParameters`
F821 Undefined name `queryStringParameters`
</code></pre>
<p>For the lines where we access the dict.</p>
<p>I can walk around this error by rearranging the code a bit:</p>
<pre><code class="language-python">def api_event_json(api_key, model_name, user_id=None, item_id=None):

    query_params = {&quot;limit&quot;: 5}
    if user_id is not None:
        query_params[&quot;user_id&quot;] = user_id
    if item_id is not None:
        query_params[&quot;item_id&quot;] = item_id

    dict = {
        &quot;headers&quot;: {
            &quot;x-api-key&quot;: api_key,
        },
        &quot;queryStringParameters&quot;: query_params,
        &quot;pathParameters&quot;: {&quot;model&quot;: model_name},
    }

    return dict
</code></pre>
<p>And is alright. Wondering if its a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-04 13:35</div>
            <div class="timeline-body"><p>Definitely a bug! It’s treating it like a type annotation with a forward reference (eg, x: dict[“foo”] = {}, which would be referencing a variable named “foo”). But it should only be enforcing that behavior for annotations. Will fix today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-11-04 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "F821 Weird failure" to "F821 false positives when assigning to a dict" by @charliermarsh on 2022-11-04 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "F821 false positives when assigning to a dict" to "F821 false positive when assigning to a dict" by @charliermarsh on 2022-11-04 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-11-04 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-04 14:23</div>
            <div class="timeline-body"><p>Another way to fix this is to use a name other than <code>dict</code>. Part of the problem is that the code is shadowing the built-in <code>dict</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-04 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-04 14:52</div>
            <div class="timeline-body"><p>This'll go out in the next release, later today!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:56:29 UTC
    </footer>
</body>
</html>
