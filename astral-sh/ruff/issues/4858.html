<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP007: opt out of Optional - astral-sh/ruff #4858</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>UP007: opt out of Optional</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4858">#4858</a>
        opened by <a href="https://github.com/Fogapod">@Fogapod</a>
        on 2023-06-05 07:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Fogapod">@Fogapod</a> on 2023-06-05 07:18</div>
            <div class="timeline-body"><p>Hello, currently UP007 covers both <code>Union[a, b, c]</code> -&gt; <code>a | b | c</code> and <code>Optional[a]</code> -&gt; <code>a | None</code>.
Personally i find Optional to be more readable and PEP 604 does not deprecate this syntax either.</p>
<p>I'm not sure how it could be changed without breaking changes. I see 2 ways:</p>
<ul>
<li><code>UP007</code> stops reporting Optional, keeps reporting Union and later added rules</li>
<li><code>UP039</code> is added which only reports Optional</li>
</ul>
<p>The downside of this is that it forces people to update config to get previous behavior if they didn't have entire <code>UP</code> category enabled. Alternative is:</p>
<ul>
<li><code>UP007</code> remains unchanged</li>
<li><code>UP039</code> is added which reports Union and later added rules</li>
</ul>
<p>This might be even worse because</p>
<ol>
<li>for people with <code>UP</code> in config it does double work</li>
<li>if someone had <code>UP</code> enabled and <code>UP007</code> ignored, the Union lint would reappear (although I'd assume most people who do this because of Optional)</li>
</ol>
<p>pyupgrade author made it clear in multiple issues that they are not going to change this https://github.com/asottile/pyupgrade/issues/390#issuecomment-1046896890. don't know how much you are willing to deviate from &quot;upstream&quot; for cases like this but it would be a nice addition</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-08 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-09 15:36</div>
            <div class="timeline-body"><p>A third option would be to add a setting to retain <code>Optional</code>, but keep all behavior under <code>UP007</code>. I'm somewhat undecided on this overall though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lengau">@lengau</a> on 2023-06-27 22:15</div>
            <div class="timeline-body"><p>Just adding my voice to agree with this.</p>
<p>It appears that most people are either in favour of or indifferent to <code>X | Y</code> replacing <code>Union[X, Y]</code>, but a big chunk (roughly half) of those prefer to disable <code>UP007</code> to keep <code>Optional[Z]</code> over <code>Z | None</code>. Personally I'm indifferent to the latter and have a moderate preference for <code>X | Y</code>, so I'd prefer to be able to enforce the replacement of <code>Union</code> without enforcing the replacement of <code>Optional</code>, allowing the use of <code>Optional</code>.</p>
<p>Breaking it up into two rules (or perhaps even three, leaving <code>UP007</code> as the union of the two rules with an eventual deprecation, much like with #1980) is probably more intuitive than having it be a configuration on the rule. Despite <code>Optional[X]</code> <a href="https://github.com/python/cpython/blob/3.11/Lib/typing.py#L706">literally being</a> the same as <code>Union[X, None]</code> from a logical standpoint, from a readability and utility standpoint they are quite different (<code>Optional</code> having a special enough meaning to have been distinguished from <code>Union</code> in the first place). If there were a need to match upstream rules like in Pycodestyle I'd probably have the opposite opinion, but as pyupgrade bundles its rules by Python version a direct mapping is already out of the window (e.g. UP031 and UP032 being separate already).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-29 00:18</div>
            <div class="timeline-body"><p>I personally don't have a preference for <code>Optional[a]</code> over <code>a | None</code> but I'm not opposed to splitting these into separate rules. (I'd prefer separate rules over a setting.) My hesitation is that I'm not sure how to do that migration in a way that's minimally disruptive.</p>
<blockquote>
<p>...but a big chunk (roughly half)...</p>
</blockquote>
<p>Not challenging this, but is this based on data? Like a survey or something? Or your own experiences and interactions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lengau">@lengau</a> on 2023-06-30 20:22</div>
            <div class="timeline-body"><p>Not based on a formal survey, just based on asking other developers what they think</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lengau">@lengau</a> on 2023-06-30 20:33</div>
            <div class="timeline-body"><p>What if UP007 became a way to just enable both of the split out rules + write a deprecation warning?</p>
<p>I'm not too worried about the edge case where someone has <code>UP</code> enabled but ignores <code>UP007</code> specifically, as updates right now are well known to introduce new rules that will introduce failures, so nobody should be surprised by it (and the command output and documentation are both good enough to make it easy for people to understand and update as needed). If you are concerned about that edge case, you could treat having the ignore group include UP007 disable the other rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-07-10 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-07-10 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../spear-ai/citizen/issues/336.html">spear-ai/citizen#336</a> on 2023-12-19 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ktbarrett">@ktbarrett</a> on 2024-03-12 03:37</div>
            <div class="timeline-body"><p>Whose decision is this waiting on? I think the first solution is the least disruptive and I would also like to see this rule split between <code>Union</code> and <code>Optional</code> as I <em>much</em> prefer <code>Optional</code>: it's clearer documentation that the argument is optional to those not in the know. I'd also would <em><strong>not</strong></em> like to see recommendations in the other direction (to prefer <code>Optional</code> over <code>X | None</code>).</p>
<p>In my opinion <code>Optional[X] = None</code> and <code>X | None</code> (no default) encode two different idioms and are the best ways to spell those idioms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-12 05:58</div>
            <div class="timeline-body"><p>Sure. Someone can do this if they want:</p>
<ol>
<li>Drop <code>Optional</code> support from <code>UP007</code> in preview mode</li>
<li>Add new rule in preview for use of <code>Optional</code></li>
<li>Add documentation about the transition to both rules</li>
</ol>
<p>I'm not too concerned about people ignoring <code>UP007</code> right now encountering the new rule, if anything that will be a signal that they can enable <code>UP007</code> again. It'll happen in a breaking release and we'll be able to gauge how much effect it will have when 2. is implemented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @zanieb on 2024-03-12 05:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2024-03-12 05:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11379.html">astral-sh/ruff#11379</a> on 2024-05-12 11:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2024-05-14 14:11</div>
            <div class="timeline-body"><blockquote>
<p>it's clearer documentation that the argument is optional to those not in the know</p>
</blockquote>
<p>But it isn't: Optional means the parameter may be None, not that it is optional. A parameter can be optional (i.e., have a default) without having an Optional type, and vice versa. This is actually one of the main reasons from my perspective why Optional <em>should</em> be avoided: its name is misleading.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ktbarrett">@ktbarrett</a> on 2024-05-14 19:56</div>
            <div class="timeline-body"><p>Perhaps <code>Optional</code> <em>shouldn't</em> mean the same thing as <code>X | None</code>, but instead pass X, or don't give an argument, giving a warning otherwise. Not that I expect this to ever change... but explicitly passing None to optional arguments (which apparently has no spelling at all) is a code smell.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../edwardzjl/chatbot/pulls/527.html">edwardzjl/chatbot#527</a> on 2024-07-11 09:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../oerc0122/castep_outputs/pulls/163.html">oerc0122/castep_outputs#163</a> on 2024-09-06 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15313.html">astral-sh/ruff#15313</a> on 2025-01-07 06:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-01-07 10:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-02-19 11:28</div>
            <div class="timeline-body"><blockquote>
<p>But it isn't: Optional means the parameter may be None, not that it is optional. A parameter can be optional (i.e., have a default) without having an Optional type, and vice versa.</p>
</blockquote>
<p>Clearly this is the opportunity for a new linting rule, enforcing a consistent style:</p>
<ol>
<li>When <code>Optional[T]</code> is used as an annotation for a function parameter or class attribute, it must have a default value</li>
<li>For parameters/variables without a default value, use <code>T | None</code> instead.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../microsoft/pyright/issues/9793.html">microsoft/pyright#9793</a> on 2025-03-18 19:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
