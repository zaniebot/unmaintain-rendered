<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using `ruff check --select` with `import-outside-top-level (PLC0415)` does not respect `flake8-tidy-imports.banned-module-level-imports` - astral-sh/ruff #19423</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using <code>ruff check --select</code> with <code>import-outside-top-level (PLC0415)</code> does not respect <code>flake8-tidy-imports.banned-module-level-imports</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19423">#19423</a>
        opened by <a href="https://github.com/olivierdelree">@olivierdelree</a>
        on 2025-07-18 14:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/olivierdelree">@olivierdelree</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I am currently in the process of linting a codebase and have selected <a href="https://docs.astral.sh/ruff/rules/import-outside-top-level/"><code>PLC0415</code></a> and <a href="https://docs.astral.sh/ruff/rules/banned-module-level-imports/"><code>TID253</code></a> as rules (among many others).
Since there are usually a lot of different rule violations when I enable a certain set of rules, I tend to work on a single rule at a time. To do that, I run <code>ruff check --statistics</code> and select the code of a rule I want to fix. Once I have the code, I run <code>ruff check --select CODE</code> and work from there.</p>
<p>As I understand it, this tells <code>ruff</code> to select only that rule to check. However, in the case of <code>PLC0415</code>, it gives me unexpected results as it does not respect the banned module level imports described in the <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-tidy-imports_banned-module-level-imports"><code>flake8-tidy-imports.banned-module-level-imports</code></a> list.
Strictly speaking, <code>ruff</code> is doing exactly what I am asking it to, checking only for <code>PLC0415</code> violations. However, since that specific rule interacts with another one, <code>TID253</code>, it flags more violations than when running <code>ruff check</code> and can cause some confusion.</p>
<p>My expectation for <code>ruff check --select CODE</code> still considering interactions with related rules might very well be wrong and if so I'd happily accept a <code>wont-fix</code> but it would be more intuitive in my opinion to consider related rules, requiring a <code>--ignore</code> to, well, ignore them if necessary.</p>
<h3>Example</h3>
<h4>Code</h4>
<pre><code class="language-python"># issue.py
def foo() -&gt; int:
    import random

    return random.randint(0, 10)
</code></pre>
<h4>Config</h4>
<pre><code class="language-toml"># pyproject.toml
[ruff.lint]
select = [
    &quot;TID253&quot;,   # banned-module-level-imports
    &quot;PLC0415&quot;,  # import-outside-top-level
]

[ruff.lint.flake8-tidy-imports]
banned-module-level-imports = [
    &quot;random&quot;,
]
</code></pre>
<h4>Commands</h4>
<pre><code class="language-shell">$ ruff check 
All checks passed!

$ ruff check --select PLC0415
issue.py:2:5: PLC0415 `import` should be at the top-level of a file
  |
1 | def foo() -&gt; int:
2 |     import random
  |     ^^^^^^^^^^^^^ PLC0415
3 |
4 |     return random.randint(0, 10)
  |

$ ruff check --select PLC0415,TID253
All checks passed!
</code></pre>
<h3>Version</h3>
<p>0.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-18 19:29</div>
            <div class="timeline-body"><p>I think this is surprising too. It came up a couple of weeks ago when documenting the link between the two rules: https://github.com/astral-sh/ruff/pull/18733#discussion_r2153012256. I think it would make sense always to respect the config option even if TID253 isn't enabled,  but I'm curious if anyone disagrees. We'd probably need to make that change in preview, although it will only lead to fewer diagnostics rather than any new ones.</p>
<p>https://github.com/astral-sh/ruff/blob/1ea5d8f7552ebb92da33c020e3e47b2a48fd72a2/crates/ruff_linter/src/rules/pylint/rules/import_outside_top_level.rs#L72-L75</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-07-18 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-21 07:21</div>
            <div class="timeline-body"><p>I think always honoring the option does make sense to me. It seems as explicit as enabling the rule.</p>
<blockquote>
<p>, although it will only lead to fewer diagnostics rather than any new ones.</p>
</blockquote>
<p>This can still be breaking because it means that some <code>noqa</code> comments are now unused.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:05 UTC
    </footer>
</body>
</html>
