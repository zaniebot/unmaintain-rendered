<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local variable is assigned but never used (F841) cannot be ignored with dummy-variable-rgx in except block - astral-sh/ruff #6391</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Local variable is assigned but never used (F841) cannot be ignored with dummy-variable-rgx in except block</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6391">#6391</a>
        opened by <a href="https://github.com/phillipuniverse">@phillipuniverse</a>
        on 2023-08-07 14:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2023-08-07 14:48</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Example:</p>
<pre><code class="language-python">try:
    1 + 1
except Exception as _err:
    print(&quot;Problem&quot;)
</code></pre>
<p>Ruff always triggers <code>F841</code> on the <code>except Exception as _err</code> line:</p>
<pre><code>F841 [*] Local variable `_` is assigned to but never used
</code></pre>
<p>Ruff version 0.0.282</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-07 18:56</div>
            <div class="timeline-body"><p>Interestingly, Flake8 doesn't respect the dummy-variable-rgx here either. What's the use-case? Did this occur in a real example, where you want to assign the exception but not use it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-08-07 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2023-08-07 19:08</div>
            <div class="timeline-body"><blockquote>
<p>Flake8 doesn't respect the dummy-variable-rgx here either.</p>
</blockquote>
<p>Hm, that is interesting.</p>
<p>Originally I had written this in a project:</p>
<pre><code class="language-python">try:
    1 + 1
except:
    logger.exception(&quot;Cannot add numbers :(&quot;)
</code></pre>
<p>And then I got feedback that it would be nice to be able to capture the caught exception in a variable for easy access in pdb and other debuggers. So I thought it would be simple to rewrite as:</p>
<pre><code class="language-python">try:
    1 + 1
except Exception as _err:
    logger.exception(&quot;Cannot add numbers :(&quot;)
</code></pre>
<p>and was surprised when <code>as _err</code> got rewritten by the autofixer. What I ended up shipping was this:</p>
<pre><code class="language-python">try:
    1 + 1
except Exception as err:
    logger.exception(&quot;Cannot add numbers :(&quot;, exc_info=err)
</code></pre>
<p>Maybe there is a slight benefit in this final solution, as <code>logger.exception(msg)</code> is equivalent to <code>logger.error(msg, exc_info=True)</code> which under the covers gets the original exception with <code>sys.exc_info()</code>.</p>
<p>So it's an easy workaround and maybe worthwhile to keep the exact same behavior as flake8 in this scenario.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-08-07 19:39</div>
            <div class="timeline-body"><blockquote>
<p>it would be nice to be able to capture the caught exception in a variable for easy access in pdb and other debuggers</p>
</blockquote>
<p>This is the tail wagging the dog, IMHO. My team complained about <code>RET504</code> removing the variable they introduced for the sole purpose of debugging. I held firm, as I don't believe we should allow the code to become messier for the sake of debugging practices.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-07 19:46</div>
            <div class="timeline-body"><p>Yeah, hmm... IMO it's strange to use that <code>as _err</code> pattern, but it's also surprising not to respect the dummy-variable-rgx here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2023-08-07 20:02</div>
            <div class="timeline-body"><blockquote>
<p>removing the variable they introduced for the sole purpose of debugging</p>
</blockquote>
<p>@tylerlaprade if it makes you feel any better for holding firm, there are other ways to expose that return value.</p>
<p>In Pycharm you can check the 'Show Return Values' option</p>
<img width="703" alt="image" src="https://github.com/astral-sh/ruff/assets/684275/d01cfc0e-7ad9-4192-a096-5adce1a385e3">

<p>In pdb, you can use <code>__return__</code>, <a href="https://stackoverflow.com/questions/5073911/what-is-return/18674516#18674516">detailed tip from SO</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6492.html">astral-sh/ruff#6492</a> on 2023-08-11 03:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-11 04:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ghost">@ghost</a> on 2024-05-15 18:45</div>
            <div class="timeline-body"><p>I have a similar use case by for walrus assignment:</p>
<pre><code class="language-python">    while _has_not_timed_out := (last_try_epoch_sec - start_epoch_sec) &lt; timeout_sec:
        if _reached_retry_interval := (time() - last_try_epoch_sec) &gt;= retry_interval_sec:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xames3">@xames3</a> on 2024-12-04 23:20</div>
            <div class="timeline-body"><p>is this resolved or has been any possible workaround this issue? couldn't get it working with walrus operator either. below is my code sample</p>
<pre><code class="language-python">def _strides_as_shape(
    shape: t.Sequence[int],
    itemsize: int,
) -&gt; tuple[int, ...]:
    &quot;&quot;&quot;Computes the memory strides for an array based on its shape and
    element size.
    &quot;&quot;&quot;
    stride = itemsize
    return tuple((stride := stride * dim) // dim for dim in reversed(shape))[  # F841 local variable 'stride' is assigned to but never used
        ::-1
    ]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
