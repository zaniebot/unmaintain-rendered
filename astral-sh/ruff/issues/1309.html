<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive for PLE0118 when mixing globals and f-strings - astral-sh/ruff #1309</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive for PLE0118 when mixing globals and f-strings</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1309">#1309</a>
        opened by <a href="https://github.com/PhilReinhold">@PhilReinhold</a>
        on 2022-12-21 16:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/PhilReinhold">@PhilReinhold</a></div>
            <div class="timeline-body"><p>It seems like we get a false positive from using globals inside of f-strings</p>
<pre><code class="language-python"># test.py
x = 1

def f():
    global x
    x = x + 1
    print(f&quot;{x=}&quot;)
</code></pre>
<p>Then</p>
<pre><code>$ ruff --version
ruff 0.0.189

$ ruff --select PLE test.py --show-source
Found 1 error(s).
test.py:7:11: PLE0118 Name `x` is used prior to global declaration on line 5
  |
7 |     print(f&quot;{x=}&quot;)
  |           ^^^^^^^ PLE0118
  |
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-21 17:04</div>
            <div class="timeline-body"><p>Ah yeah, this makes sense. Will fix.</p>
<p>(We have to treat f-strings in a special way everywhere, because RustPython doesn't properly adjust the locations of the nested expressions.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-12-21 17:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-12-21 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-21 19:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:48 UTC
    </footer>
</body>
</html>
