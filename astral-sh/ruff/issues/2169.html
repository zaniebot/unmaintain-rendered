<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T201 autofix can break code that actually should print things - astral-sh/ruff #2169</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>T201 autofix can break code that actually should print things</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2169">#2169</a>
        opened by <a href="https://github.com/akx">@akx</a>
        on 2023-01-25 20:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/akx">@akx</a> on 2023-01-25 20:04</div>
            <div class="timeline-body"><p>I'm applying (more!) Ruff to https://github.com/python-babel/babel/ and figured I'd try <code>--select=ALL --fix</code> and look through the diff, and found a surprising combination of breaking autofixes â€“ maybe the autofix for T201 (&quot;<code>print</code> found&quot;) should also be made a suggestion (as there's been discussion for some other rules in other issues here), not a default?</p>
<pre><code class="language-python">def _help(self):
    longest = max(len(command) for command in self.commands)
    format = &quot;  %%-%ds %%s&quot; % max(8, longest + 1)
    commands = sorted(self.commands.items())
    for name, description in commands:
        print(format % (name, description))
</code></pre>
<p><code>cargo run -- --diff --select=ALL --no-cache</code>:</p>
<pre><code class="language-diff">--- tests/bab.py
+++ tests/bab.py
@@ -1,6 +1,6 @@
 def _help(self):
     longest = max(len(command) for command in self.commands)
-    format = &quot;  %%-%ds %%s&quot; % max(8, longest + 1)
+    &quot;  %%-%ds %%s&quot; % max(8, longest + 1)
     commands = sorted(self.commands.items())
-    for name, description in commands:
-        print(format % (name, description))
+    for _name, _description in commands:
+        pass
</code></pre>
<p>(and then the interpolation operation becomes a no-op and when <code>longest</code> is no longer used, that gets removed too...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 20:08</div>
            <div class="timeline-body"><p>Is the generated code actually <em>invalid</em>? Or it just doesn't do what was intended? Like does it run? (Just confirming.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-25 20:16</div>
            <div class="timeline-body"><p>Oh, yeah, sorry, should've been more clear there!</p>
<p>It does run but it no longer does anything of value since all it was meant to do was print things and the autofix got rid of that. This is really of course only an issue if <code>T201</code> is enabled and not marked <code>unfixable</code> :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 20:18</div>
            <div class="timeline-body"><p>No totally! Just making sure we weren't producing invalid syntax.</p>
<p>I'm more and more feeling like we should disable a bunch of autofixes by default and require users to opt-in to them. This is a useful rule but it's probably surprising that it autofixes itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-01-26 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-26 18:31</div>
            <div class="timeline-body"><p>I also wondered what <code>T201</code> is about. I don't understand its purpose. This maybe makes sense for a library.
I aksed that upstream in https://github.com/JBKahn/flake8-print/issues/59.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-26 18:32</div>
            <div class="timeline-body"><p>@spaceone It makes a lot of sense for libraries or e.g. webapps where you don't want your views or models or whatnot to randomly print things out (e.g. where the policy would be to use <code>logging</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-08 02:44</div>
            <div class="timeline-body"><p>This was removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-08 02:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:07 UTC
    </footer>
</body>
</html>
