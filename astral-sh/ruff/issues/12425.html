<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistent removal of whitespace around operators - astral-sh/ruff #12425</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Inconsistent removal of whitespace around operators</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12425">#12425</a>
        opened by <a href="https://github.com/robin-weiland">@robin-weiland</a>
        on 2024-07-20 21:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/robin-weiland">@robin-weiland</a> on 2024-07-20 21:33</div>
            <div class="timeline-body"><p>In the snippet below, there are two occurrences of the <code>**</code>-operator.
Following pep8, I added spaces around them.</p>
<p>Now I can either run pre-commit or <code>ruff format</code> directly and the only issue it finds and corrects are the spaces around the first power operator, which it removes. Notably, the ones in the Exception are left as they are.</p>
<p>Is there any reason I am unaware of for this inconsistency?
Also, if the removal of spaces is indeed the intended behavior here, is there a way to ignore this?
I could only find rules to explicitly ignore missing whitespace (e.g., E225) not vice versa.</p>
<h2>snippet</h2>
<pre><code class="language-python">if not (0 &lt;= value &lt; (2 ** self.size)):
    raise ValueError(
        f'Value &quot;{value}&quot; must be between 0 and {(2 ** self.size) - 1} with size {size}!'
    )
</code></pre>
<h2>ruff settings</h2>
<pre><code class="language-toml">[tool.ruff]
exclude = [
    &quot;.git&quot;,
    &quot;.pytest_cache&quot;,
    &quot;.ruff_cache&quot;,
    &quot;.venv&quot;,
    &quot;dist&quot;,
]
line-length = 88
indent-width = 4
target-version = &quot;py311&quot;

[tool.ruff.format]
quote-style = &quot;single&quot;
indent-style = &quot;space&quot;
skip-magic-trailing-comma = false
line-ending = &quot;auto&quot;
</code></pre>
<h3>pre-commit-config.yaml</h3>
<pre><code class="language-yaml"># ...

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.4.9
    hooks:
      - id: ruff
      - id: ruff-format

# ...
</code></pre>
<h2>ruff version</h2>
<p>ruff 0.4.10</p>
<h2>environment</h2>
<p>win11 23H2
Python 3.11.5 (tags/v3.11.5:cce6ba9) 64 bit
Poetry (version 1.8.3)
pre-commit 3.7.1</p>
<hr />
<p>keywords: whitespace-around-operator, E225</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-20 21:39</div>
            <div class="timeline-body"><p>I believe it's because we don't format content within f-strings, unless you pass `--preview. You can see that they're formatted identically <a href="https://play.ruff.rs/?secondary=Format">here</a>, with preview enabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robin-weiland">@robin-weiland</a> on 2024-07-21 11:17</div>
            <div class="timeline-body"><p>Thank you for the reply. I was not aware about the behavior with f-strings (rtfm I guess).
I'm a still wondering about the removal of whitespace around <code>**</code>, though. I rarely use them, admittedly. But I couldn't find any reference to it anywhere in terms of style conventions. Naively, I would assume it is treated like any other binary operator.
(I know this is not the place to discuss style conventions. I don't intend to argue over anything, I am just curious about this behavior)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-21 11:53</div>
            <div class="timeline-body"><p>üëç We tend to follow Black's style guide unless we have a reason to deviate, and the formatting for power operators is described here: https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#line-breaks-binary-operators. It depends on whether the expressions on either side of the operator are considered &quot;simple&quot;, IIRC to make basic math more dense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robin-weiland">@robin-weiland</a> on 2024-07-21 12:17</div>
            <div class="timeline-body"><p>Thanks. Makes sense, to reflect the closeness of both sides regarding order of precedence.
Regardless, since I only use base 2, I will probably avoid that rule by using left-shifts insteadüòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @robin-weiland on 2024-07-21 12:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
