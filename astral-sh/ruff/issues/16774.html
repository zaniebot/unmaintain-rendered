<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organize Imports code action silently does nothing when `# noqa` is present - astral-sh/ruff #16774</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Organize Imports code action silently does nothing when <code># noqa</code> is present</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16774">#16774</a>
        opened by <a href="https://github.com/xhrnca00">@xhrnca00</a>
        on 2025-03-16 12:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/xhrnca00">@xhrnca00</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>As mentioned in other issues, (such as <a href="https://github.com/astral-sh/ruff/issues/9554">#9554</a>), adding <code># noqa: I001</code> to the <em>first</em> line disables import sorting for <em>all</em> imports.</p>
<p>I personally think that is very unintuitive on its own, but I understand why it's done this way.</p>
<p>What I find even weirder is that the &quot;Organize Imports&quot; code action, present in Ruff LSP integrations in VSCode, Neovim and others, also does not format the imports when executed.</p>
<p>When I manually execute something, shouldn't that override any &quot;static&quot; rules? Since organizing imports is more of a formatting action, the user should <em>at least</em> get a warning that nothing actually happened, or the action should not be present at all if that would be the case.</p>
<p>I would prefer it to ignore all restrictions/disablements, but I assume it just executes the <code>ruff check --select I &lt;file&gt; --fix</code> command, so that might be difficult to achieve.</p>
<h2>To &quot;reproduce&quot;:</h2>
<ol>
<li>copy the following to a file:</li>
</ol>
<pre><code class="language-python"># example.py
import os  # noqa: I001
from json import loads, dumps

if __name__ == &quot;__main__&quot;:
    print(dumps(loads(&quot;file.json&quot;)))
</code></pre>
<ol start="2">
<li>Open in any editor with Ruff LSP integration.</li>
<li>Invoke &quot;Organize imports&quot; code action.</li>
<li>Nothing happens.</li>
</ol>
<h3>Version</h3>
<p>ruff 0.11.0 (2cd25ef64 2025-03-14) (and prior)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @dylwil3 on 2025-03-17 10:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-18 07:13</div>
            <div class="timeline-body"><blockquote>
<p>As mentioned in other issues, (such as https://github.com/astral-sh/ruff/issues/9554), adding # noqa: I001 to the first line disables import sorting for all imports.</p>
</blockquote>
<p>I see how this is confusing. We should revisit how <code>noqa</code> suppressions work for isort but that's a breaking change. Until then, I recommend you to use the <a href="https://docs.astral.sh/ruff/linter/#action-comments"><code>isort</code> specific suppression comments</a> to disable sorting of a specific import.</p>
<blockquote>
<p>When I manually execute something, shouldn't that override any &quot;static&quot; rules? Since organizing imports is more of a formatting action, the user should at least get a warning that nothing actually happened, or the action should not be present at all if that would be the case.</p>
</blockquote>
<p>I can see the reasoning for this but the CLI and editor must behave exactly the same:</p>
<ul>
<li>Many users enable <em>organize imports</em> on save and Ruff shouldn't make any changes to a file that passed all Ruff tests on the CLI if it remained unchanged. However, this wouldn't be the case when implementing this change because the editor would organize the imports that were <em>fine</em> when using the CLI because the CLI respects the noqa comment but the editor doesn't</li>
<li>I would find it very confusing if the editor ignored the noqa comment. I'm explicitly telling Ruff to <em>leave that line alone</em> and, IMO, that has higher priority than me running the <em>organize imports</em> command manually</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-03-18 07:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:52:23 UTC
    </footer>
</body>
</html>
