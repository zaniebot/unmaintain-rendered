<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suboptimal autofix when combining PLC0415,I001,RUF100 with a long line - astral-sh/ruff #20042</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Suboptimal autofix when combining PLC0415,I001,RUF100 with a long line</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20042">#20042</a>
        opened by <a href="https://github.com/tpgillam">@tpgillam</a>
        on 2025-08-22 14:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tpgillam">@tpgillam</a></div>
            <div class="timeline-body">Summary
<p>Using ruff 0.12.10.</p>
<p>Start with the following code in <code>moo.py</code>:</p>
<pre><code>def moo():
    from very.long.nonsense.indeed.need.line.to.be.full.to.cause.breakage import foo

    return foo()
</code></pre>
<p>Running ruff with (at least) these three rules enabled, currently PLC0415 triggers:</p>
<pre><code>$ uvx ruff==0.12.10 check --select PLC0415,I001,RUF100 moo.py
moo.py:2:5: PLC0415 `import` should be at the top-level of a file
</code></pre>
<p>Because there are good reasons that the import is local, we disable (in practice, this disable is done in an editor via the ruff language server&#x27;s suggested code action):</p>
<pre><code>def moo():
    from very.long.nonsense.indeed.need.line.to.be.full.to.cause.breakage import foo  # noqa: PLC0415

    return foo()
</code></pre>
<p>but now the line being too long causes <code>I001</code> to trigger:</p>
<pre><code>$ uvx ruff==0.12.10 check --select PLC0415,I001,RUF100 moo.py
moo.py:2:5: I001 [*] Import block is un-sorted or un-formatted
</code></pre>
<p>but if we trigger the autofix <em>with RUF100 enabled</em>, then what the user sees is that the noqa they added disappears, and we get back to:</p>
<pre><code>def moo():
    from very.long.nonsense.indeed.need.line.to.be.full.to.cause.breakage import foo

    return foo()
</code></pre>
<p>Fixing <em>without</em> RUF100, we can see that we get this intermediate state:</p>
<pre><code>def moo():
    from very.long.nonsense.indeed.need.line.to.be.full.to.cause.breakage import (
        foo,  # noqa: PLC0415
    )

    return foo()
</code></pre>
<p>... but the <code># noqa: PLC0415</code> is now the line below where it needs to be, so RUF100&#x27;s autofix will remove it.</p>
Version
<p>0.12.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-22 14:11</div>
            <div class="timeline-body"><p>Thanks for the report and the neat reproduction! I think this might be a duplicate of <a href="https://github.com/astral-sh/ruff/issues/12179">astral-sh/ruff#12179</a>, where the root I001-RUF100 conflict is the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-22 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-22 14:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:22 UTC
    </footer>
</body>
</html>
