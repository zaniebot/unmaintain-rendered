<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any` - astral-sh/ruff #19152</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ANN401: Split rule to resolve conflation between <code>arg: Any</code> and <code>**kwargs: Any</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19152">#19152</a>
        opened by <a href="https://github.com/aaronsteers">@aaronsteers</a>
        on 2025-07-05 01:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/aaronsteers">@aaronsteers</a> on 2025-07-05 01:41</div>
            <div class="timeline-body"><p>There's been some discussion about how <code>Any</code> and <code>ANN401</code> should behave with <code>*args</code> and <code>**kwargs</code>. Some of that is discussed here:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/677</li>
</ul>
<p>I also understand there's an override config:</p>
<pre><code>[tool.ruff.flake8-annotations]
allow-star-arg-any = true
</code></pre>
<p>What I'd like to propose is that we have separate rules for &quot;Any&quot; when typing <em>singular-inputs</em> versus in an inherently <em>multi-input</em> setting.</p>
<p>I am perfectly happy to strongly-type my input args or to add a lint exception for very-rare exceptions. However, the <code>**kwargs: Any</code> input specifically seems like a completely different animal. This is most often used in cases of programming for (1) backwards compatibility, (2) forwards compatibility, or (3) hand-off to an API we don't control. In all of these cases, there's no feasible manner of typing for things we don't know yet or don't ourselves control.</p>
<p>Example of the third use case (hand-off to 3rd-party):</p>
<pre><code>def get_openai_client_from_api_key(
    **kwargs: Any,  # noqa: ANN401 (let the called library verify these)
) -&gt; Client | None:
    &quot;&quot;&quot;Get the OpenAI API key, or None if not set.

    Anything sent as keyword argument will be passed to the OpenAI client constructor.
    &quot;&quot;&quot;
    if api_key := get_secret(&quot;OPENAI_API_KEY&quot;):
        return Client(api_key=api_key, **kwargs)

    return None
</code></pre>
<p>This implementation seems about as clean as I can make it. I don't want to take any assumptions on the library I'm calling out to. Any changes beyond what I have here seems like it would only make the code more brittle.</p>
<p>I'd like to avoid noqa-ing ANN401 while still accepting this type of kwargs-passthrough as the best-available method.</p>
<p>Is there something I'm missing? Any appetite to splitting the rule so that kwargs isn't triggering it?</p>
<p>FWIW, I'm sure a case for <code>*args</code> could be made also, but I don't see positional args (<code>*args</code>) being a real issue. (1) a sequence of positional args are more likely to share type, and (2) there's a lot more risk of positional args vs keyword args. While positional args can easily be passed out of order, it is much less likely to receive a kwarg that doesn't match (or at least be duck-type-compatible) with its downstream caller.</p>
<p>If anything, this could be a rule against <em>any</em> usage of <code>kwargs</code>, since practically speaking, a passthrough of <code>kwargs: Any</code> and a passthrough of <code>kwargs: str</code> are <em>equally</em> likely to fail, solely on the grounds that the called function or method might not support the named arg.</p>
<p>Maybe there's a thread here: kwargs as passthrough, or when guarded by <code>isinstance</code> type checks, would not trigger the error. But kwargs with unchecked (first-party) assumptions would not? Again, seems like a good grounds for a new and separate rule to sort it all out.</p>
<p>Thanks for listening and for your support of this awesome tool. Apologies in advance if there's a better solution that I'm missing. Also, I totally understand if the answer is &quot;in general, yes, but not a high enough priority as of now&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ANN401: Resolve conflation between `arg: Any` and `**kwargs: Any`" to "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`?" by @aaronsteers on 2025-07-05 01:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`?" to "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`" by @aaronsteers on 2025-07-05 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-07-07 21:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-07-07 21:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-07 21:41</div>
            <div class="timeline-body"><p>Thanks for the thoughtful write-up and the kind words! ðŸ˜„</p>
<p>I don't have a strong sense for the best path here with the rule, but we can certainly leave the issue open to collect ideas/discussion.</p>
<p>Just to make sure I'm following, what's the difference between the current config option and splitting the rule? It seems like you'd end up using noqa with the new rule here instead of <code>ANN401</code>. Would it help if the config option were more granular so that you could apply the rule to <code>*args</code> but not <code>**kwargs</code>?</p>
<p>And here's the example in the <a href="https://play.ruff.rs/9067b58b-6a1b-4115-8472-1448c73f8e9a">playground</a> in case anyone else wants to try it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/travis-leith">@travis-leith</a> on 2025-11-07 08:58</div>
            <div class="timeline-body"><p>The override config is useful <em>if</em> you know about.
As far as I can see, it is not documented on the page for rule ANN401: https://docs.astral.sh/ruff/rules/any-type/</p>
<p>At the very least, this config should be easily discoverable to anyone looking at the rule page.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:55 UTC
    </footer>
</body>
</html>
