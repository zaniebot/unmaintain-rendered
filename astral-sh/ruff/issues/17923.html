<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot checkout ruff repository on windows due to long file paths - astral-sh/ruff #17923</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Cannot checkout ruff repository on windows due to long file paths</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/17923">#17923</a>
        opened by <a href="https://github.com/jvllmr">@jvllmr</a>
        on 2025-04-28 18:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jvllmr">@jvllmr</a> on 2025-04-28 18:55</div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code>PS C:\Users\zunde\Documents\DEV&gt; git clone https://github.com/astral-sh/ruff.git
Cloning into 'ruff'...
remote: Enumerating objects: 205831, done.
remote: Counting objects: 100% (1736/1736), done.
remote: Compressing objects: 100% (751/751), done.
remote: Total 205831 (delta 1417), reused 1022 (delta 985), pack-reused 204095 (from 2)
Receiving objects: 100% (205831/205831), 67.28 MiB | 43.41 MiB/s, done.
Resolving deltas: 100% (151291/151291), done.
error: unable to create file crates/red_knot_python_semantic/resources/mdtest/snapshots/unsupported_bool_conversion.md_-_Different_ways_that_`unsupported-bool-conversion`_can_occur_-_Part_of_a_union_where_at_least_one_member_has_incorrect_`__bool__`_method.snap: Filename too long
Updating files: 100% (8829/8829), done.
fatal: unable to checkout working tree
warning: Clone succeeded, but checkout failed.
You can inspect what was checked out with 'git status'
and retry with 'git restore --source=HEAD :/'
</code></pre>
<p>I don't know if developing ruff on windows is even possible, but I first faced the issue in my GitHub Actions:
https://github.com/jvllmr/flay/actions/runs/14660665969/job/41144210179?pr=78</p>
<pre><code>Run cargo vendor
  cargo vendor
  shell: C:\Program Files\PowerShell\7\pwsh.EXE -command &quot;. '{0}'&quot;
  env:
    CARGO_HOME: D:\a\flay\flay/.c
    pythonLocation: C:\hostedtoolcache\windows\Python\3.10.11\x64
    PKG_CONFIG_PATH: C:\hostedtoolcache\windows\Python\3.10.11\x64/lib/pkgconfig
    Python_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.10.11\x64
    Python[2](https://github.com/jvllmr/flay/actions/runs/14660665969/job/41144210179?pr=78#step:5:2)_ROOT_DIR: C:\hostedtoolcache\windows\Python\[3](https://github.com/jvllmr/flay/actions/runs/14660665969/job/41144210179?pr=78#step:5:3).10.11\x64
    Python3_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.10.11\x6[4](https://github.com/jvllmr/flay/actions/runs/14660665969/job/41144210179?pr=78#step:5:4)
    Updating crates.io index
    Updating git repository `https://github.com/astral-sh/ruff.git`
error: failed to sync

Caused by:
  failed to load pkg lockfile

Caused by:
  failed to get `ruff_python_ast` as a dependency of package `flay_rs v0.1.0 (D:\a\flay\flay\rust)`

Caused by:
  failed to load source for dependency `ruff_python_ast`

Caused by:
  Unable to update https://github.com/astral-sh/ruff.git?tag=0.11.7#f7b48[5](https://github.com/jvllmr/flay/actions/runs/14660665969/job/41144210179?pr=78#step:5:5)10

Caused by:
  path too long: 'D:/a/flay/flay/.c/git/checkouts/ruff-b18f[6](https://github.com/jvllmr/flay/actions/runs/14660665969/job/41144210179?pr=78#step:5:6)9e2b025fac7/f7b4851/crates/red_knot_python_semantic/resources/mdtest/snapshots/unsupported_bool_conversion.md_-_Different_ways_that_`unsupported-bool-conversion`_can_occur_-_Has_a_`__bool__`_attribute,_but_it's_not_callable.snap'; class=Filesystem (30)
Error: Process completed with exit code 1.
</code></pre>
<p>I could work around that issue by allowing longer file paths on my local windows installation, but this is not possible for GitHub Action Runners,</p>
<h3>Version</h3>
<p>tag 0.11.5 or later</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @ntBre on 2025-04-28 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-28 19:10</div>
            <div class="timeline-body"><p>Interesting, thanks for the report! As a quick fix we could just shorten the name of that <code>mdtest</code> snapshot, but maybe we should also add a check for this or update our snapshot naming scheme more generally.</p>
<p>Quoted snapshot path in question:</p>
<pre><code>'crates/red_knot_python_semantic/resources/mdtest/snapshots/unsupported_bool_conversion.md_-_Different_ways_that_`unsupported-bool-conversion`_can_occur_-_Has_a_`__bool__`_attribute,_but_it'\''s_not_callable.snap'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jvllmr">@jvllmr</a> on 2025-04-28 19:44</div>
            <div class="timeline-body"><p>Sounds great! Please note that I faced this issue 3 weeks ago with another file, but I was able to work around it by chaning <code>CARGO_HOME</code> to <code>.c</code> and missed out on reporting it here then. Therefore, I think creating a new naming scheme would be the best approach in the long run. The idea might create some overhead in the management of the files, but what about using numeric / very short file names for machines and creating a <code>README</code> in the directory which contains an index of the files for humans?</p>
<p>Here comes the other example where my GitHub Actions failed:
File path: <code>'crates/red_knot_python_semantic/resources/mdtest/snapshots/invalid_argument_type.md_-_Invalid_argument_type_diagnostics_-_Test_calling_a_function_whose_type_is_vendored_from_</code>typeshed<code>.snap'</code>
GitHub Actions link: https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68</p>
<pre><code>Run pdm install --frozen-lock
  pdm install --frozen-lock
  shell: C:\Program Files\PowerShell\7\pwsh.EXE -command &quot;. '{0}'&quot;
  env:
    pythonLocation: C:\hostedtoolcache\windows\Python\3.1[2](https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68#step:4:2).9\x64
    PKG_CONFIG_PATH: C:\hostedtoolcache\windows\Python\[3](https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68#step:4:3).12.9\x64/lib/pkgconfig
    Python_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.12.9\x6[4](https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68#step:4:4)
    Python2_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.12.9\x64
    Python3_ROOT_DIR: C:\hostedtoolcache\windows\Python\3.12.9\x64
INFO: Virtualenv D:\a\flay\flay\.venv is reused.
STATUS: Resolving packages from lockfile...
All packages are synced to date, nothing to do.
  x Update flay 0.1.0 -&gt; None failed

  0:00:00 Installing the project as an editable package... 0/0
See C:\Users\runneradmin\AppData\Local\pdm\pdm\Logs\pdm-install-ok84uz34.log for detailed debug log.
[BuildError]: Build backend raised error: Showing the last 10 lines of the build output:

Caused by:
  Unable to update https://github.com/astral-sh/ruff.git?tag=0.11.[5](https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68#step:4:5)#7186d5e9

Caused by:
  path too long: 'C:/Users/runneradmin/.cargo/git/checkouts/ruff-b18f[6](https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68#step:4:6)9e2b025fac7/7186d5e/crates/red_knot_python_semantic/resources/mdtest/snapshots/invalid_argument_type.md_-_Invalid_argument_type_diagnostics_-_Test_calling_a_function_whose_type_is_vendored_from_`typeshed`.snap'; class=Filesystem (30)
\U0001f4a5 maturin failed
  Caused by: Cargo metadata failed. Does your crate compile with `cargo build`?
  Caused by: `cargo metadata` exited with an error: 
Error: command ['maturin', 'pep51[7](https://github.com/jvllmr/flay/actions/runs/14388456142/job/40349557876?pr=68#step:4:7)', 'build-wheel', '-i', 'D:\\a\\flay\\flay\\.venv\\Scripts\\python.exe', '--compatibility', 'off', '--editable'] returned non-zero exit status 1
WARNING: Add '-v' to see the detailed traceback
Error: Process completed with exit code 1.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-29 06:24</div>
            <div class="timeline-body"><p>Have you tried git's longpath feature (<a href="https://stackoverflow.com/questions/22575662/filename-too-long-in-git-for-windows">link</a>)</p>
<p>We do run windows builds in GitHub actions and we haven't run into the same longpath issues.</p>
<p>https://github.com/astral-sh/ruff/blob/53a9448fb52a4339d4e0d80113b174cf44ec57b5/.github/workflows/ci.yaml#L309-L334</p>
<p>Any chance you use a different (older runner)?</p>
<p>I haven't used my windows machine in a while but can try out if it reproduces for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jvllmr">@jvllmr</a> on 2025-04-29 07:04</div>
            <div class="timeline-body"><p>Thanks for the hint. Did not occur to me that windows-latest could point to an older version. As of right now <code>windows-latest</code> actually points to <code>windows-2022</code> (https://github.com/actions/runner-images/blob/0e37973a015a27a4a410a4ae37c0aa99bdd63ea8/README.md?plain=1#L36). I will try the <code>windows-2025</code> runner for now and tell you if that changed anything. If not I will try the runner you are using in your pipeline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jvllmr">@jvllmr</a> on 2025-04-29 08:44</div>
            <div class="timeline-body"><p>Using <code>windows-2025</code> did not bring the desired outcome, but running <code>git config --global core.longpaths true</code> before running cargo related commands fixed this problem for me. I assume the <code>github-windows-2025-x86_64-16</code> runner has this enabled by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @MichaReiser on 2025-05-07 15:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 13:59</div>
            <div class="timeline-body"><p>I think this should also be helped by https://github.com/astral-sh/ruff/pull/18039.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 14:09</div>
            <div class="timeline-body"><p>I'll close this. @jvllmr let us know if you're still runing into this and we can reopen the issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-07-17 14:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
