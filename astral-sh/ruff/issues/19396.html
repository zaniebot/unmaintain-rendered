<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`PLR6301` false positive for `attrs` field validators passed as arguments - astral-sh/ruff #19396</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`PLR6301` false positive for `attrs` field validators passed as arguments</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19396">#19396</a>
        opened by <a href="https://github.com/my1e5">@my1e5</a>
        on 2025-07-17 10:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/my1e5">@my1e5</a> on 2025-07-17 10:56</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This is a follow-up to a previous issue I made about <code>attrs</code> validation decorators and PLR6301:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/12568</li>
</ul>
<h2>Background</h2>
<p>The <code>attrs</code> library allows you to define validators for class attributes in two ways:</p>
<ol>
<li>Decorator-based (already solved in previous issue):</li>
</ol>
<pre><code class="language-py">from attrs import define, field

@define
class Foo:
    x: int = field()

    @x.validator
    def validate_x(self, attribute, value):
        if value &lt;= 0:
            raise ValueError(&quot;x must be a positive integer&quot;)
</code></pre>
<ol start="2">
<li>Field argument-based (the focus of this issue):</li>
</ol>
<pre><code class="language-py">from attrs import define, field

@define
class Foo:
    def validate_x(self, attribute, value):
        if value &lt;= 0:
            raise ValueError(&quot;x must be a positive integer&quot;)

    x: int = field(validator=validate_x)
</code></pre>
<h2>Problem</h2>
<p>Currently, PLR6301 (no-self-use) triggers on methods like <code>validate_x</code> in the second example above, suggesting:</p>
<blockquote>
<p>Method <code>validate_x</code> could be a function, class method, or static method</p>
</blockquote>
<p>However, in this context, <code>validate_x</code> must be an instance method (it needs self). See https://www.attrs.org/en/stable/api.html#attrs.field:</p>
<blockquote>
<p>validator (Callable | list[Callable]) â€“</p>
<p>Callable that is called by attrs-generated <strong>init</strong> methods after the instance has been initialized. They receive the initialized instance, the Attribute(), and the passed value.</p>
</blockquote>
<h2>Expected behavior</h2>
<p>PLR6301 should not trigger for methods that are referenced as validators in <code>field(validator=...)</code> calls, just as it should not trigger for methods decorated with <code>@&lt;field&gt;.validator</code>.</p>
<h2>MRE</h2>
<p>Playground example - https://play.ruff.rs/9fc9950a-e4a9-4a0d-836e-8b55b8e86ba6</p>
<h2>Additional context</h2>
<p>This came to my attention because currently <code>ty</code> cannot type check decorator-style validators. See</p>
<ul>
<li>https://github.com/astral-sh/ty/issues/267</li>
</ul>
<p>And it was suggested that using <code>field(validator=...)</code> is a valid way to workaround this. (https://github.com/astral-sh/ty/issues/267#issuecomment-2959814598)</p>
<blockquote>
<p>If you change your code to the following, then no special magic is required to type check it, and it will work with all conformant type checkers.</p>
<pre><code>def check_age(self, _: Any, value: int) -&gt; None:
    ...
age: int = field(default=0, validator=check_age)</code></pre>
<p>Even with mypy, this approach is probably preferable because the signature of <code>check_age</code> is type checked.</p>
</blockquote>
<h3>Version</h3>
<p>ruff 0.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 14:28</div>
            <div class="timeline-body"><p>Thanks for the reports here and in ty! This looks like a much more invasive change than for #12568 because we'll need to inspect the whole class definition, not just one function at a time. But it makes sense to me to handle this case, especially if it's needed to help type checkers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-07-17 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-07-17 14:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:18 UTC
    </footer>
</body>
</html>
