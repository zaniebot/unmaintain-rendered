```yaml
number: 6823
title: Comments around attribute dot are moved around incorrectly
type: issue
state: closed
author: charliermarsh
labels:
  - formatter
assignees: []
created_at: 2023-08-23T18:57:34Z
updated_at: 2023-09-02T08:22:52Z
url: https://github.com/astral-sh/ruff/issues/6823
synced_at: 2026-01-10T01:56:49Z
```

# Comments around attribute dot are moved around incorrectly

---

_Issue opened by @charliermarsh on 2023-08-23 18:57_

Given:

```python
aaa = (
    aaa
    # foo
    .  # bar
    # baz
    bbb
)
```

We format like:

```python
aaa = (
    aaa.  # bar
    # foo
    # baz
    bbb
)
```

Whereas Black retains the original formatting.

I believe `# bar` is being marked as a trailing end-of-line comment on `aaa`.

---

_Label `formatter` added by @charliermarsh on 2023-08-23 18:57_

---

_Comment by @charliermarsh on 2023-08-23 19:00_

That treatment of `# bar` seems intentional (see: `handle_attribute_comment`), but it seems incorrect that it's reordered vis-a-vis `# foo` (which is marked as a leading comment of `bbb`).

---

_Comment by @MichaReiser on 2023-08-23 20:01_

Prettier's handling seems [reasonable](https://prettier.io/playground/#N4Igxg9gdgLgprEAuEBDdACAvBgFAHSg2I3VUJIwHoqMAzCCCkgOmJowCNUAnZ92twBe-Lp07VaMVCKgBKEABoQEAA4wAltADOyULx4QA7gAVeCXSlQAbI6gCeu5Zx6owAazgwAyqgC2cAAyGlBwyHQ22nDOrh5e3qpuIQDmyDA8AK7RIFF+GmmZ2dop1nAAihkQ8OGR2QBW2gAe3iXlldVIEdZRygCO7XAmhqqWaNoAtKFwACYzSiDpqBrWKQDCEH5+qMho1tbzxVDJpQCCMOkanBnwJnA8waE13dkAFjB+1gDqLxrw2olgODeCy-DQAN1+9h2YG0ThAYKyAEkoLNYN4wDwNOoTijvDB7KUnj0QKpDFFPq5VDtSXAojwwWFlCE6TAhqhklsidlEjw6TtuJw4PtlKSQjBPhppjAXsgABwABmUPDg-Q0yrZHO2nVqymknAlUplSAATMoMlEACqoTiWLrEuB+QXTWbTQKoI4ZdlwABiEB4W3OKR2qGuEBAAF9w0A). Although I'm not too much of a fan of converting the own line comment to an end of line comment.

---

_Comment by @charliermarsh on 2023-08-23 20:31_

Prettier's handling also reorders the comments though, that strikes me as odd.

---

_Comment by @charliermarsh on 2023-08-23 20:32_

You might be mistaking `bar` and `baz` in that example -- I don't think they convert between own-line and end-of-line, unless I'm misreading.

---

_Referenced in [astral-sh/ruff#6825](../../astral-sh/ruff/pulls/6825.md) on 2023-08-23 20:57_

---

_Assigned to @charliermarsh by @charliermarsh on 2023-08-23 21:03_

---

_Comment by @MichaReiser on 2023-08-23 21:16_

> You might be mistaking `bar` and `baz` in that example -- I don't think they convert between own-line and end-of-line, unless I'm misreading.

Ahh you're right. 

---

_Comment by @charliermarsh on 2023-08-23 21:18_

We're too deep on comments. It's not healthy.

---

_Closed by @charliermarsh on 2023-08-25 03:50_

---

_Added to milestone `Formatter: Alpha` by @MichaReiser on 2023-09-02 08:22_

---
