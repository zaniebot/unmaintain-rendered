<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatically add `pragma: no cover` for `TYPE_CHECKING` blocks - astral-sh/ruff #13610</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Automatically add `pragma: no cover` for `TYPE_CHECKING` blocks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13610">#13610</a>
        opened by <a href="https://github.com/MartinJepsen">@MartinJepsen</a>
        on 2024-10-03 08:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MartinJepsen">@MartinJepsen</a> on 2024-10-03 08:44</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<h1>Searches tried:</h1>
<ul>
<li>pragma</li>
<li>pragma no cover</li>
</ul>
<p>Possibly related to #11941</p>
<h1>Feature request</h1>
<p>When ruff automatically puts type-checking only imports into an <code>if TYPE_CHECKING:</code> block (<code>TCH001</code>, <code>TCH002</code>, <code>TCH003</code>), it would be great to allow the option of appending a <code>  # pragma: no cover</code> after the condition, so</p>
<pre><code class="language-python"># current
if TYPE_CHECKING:
    ...

# with this feature
if TYPE_CHECKING:  # pragma: no cover
    ...
</code></pre>
<h2>Reasoning</h2>
<p><code>TYPE_CHECKING</code> is never <code>True</code> at runtime, and thus, code will never enter this block at runtime. Therefore, it makes sense to exclude the block from coverage measurement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MartinJepsen">@MartinJepsen</a> on 2024-10-03 08:45</div>
            <div class="timeline-body"><p>I would like to give this issue a shot, as I feel like it's quite simple. I have never worked in this repo (or any open source for that matter) before, so some guidance would be welcome, assuming this feature becomes approved for implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-03 10:10</div>
            <div class="timeline-body"><p>Hmm, I wonder if this is the best way of solving this issue, though? I generally use the <code>tool.coverage.report.exclude_lines</code> setting in my <code>pyproject.toml</code> file to globally exclude all <code>if TYPE_CHECKING</code> blocks from coverage reports, so that I don't need to add <code>pragma: no cover</code> comments to all of them. E.g. see <a href="https://github.com/AlexWaygood/typeshed-stats/blob/07949a0b06083d21b5f4a60cf1beb2a9dbe538cf/pyproject.toml#L198-L200">https://github.com/AlexWaygood/typeshed-stats/blob/07949a0b06083d21b5f4a60cf1beb2a9dbe538cf/pyproject.toml#L198-L200</a> for an example :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-10-03 10:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MartinJepsen">@MartinJepsen</a> on 2024-10-03 11:09</div>
            <div class="timeline-body"><p>@AlexWaygood I wasn't aware of that solution! I will start using that instead. I don't know if that would render the issue solved then? Curious what others think :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-03 11:13</div>
            <div class="timeline-body"><p>I think using <code>coverage.py</code> configuration options is probably the cleaner solution here, and is reasonably commonly used. I'll close this for now on that basis, but I'm happy to reopen if there's an upswell of support for this issue from other users :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-10-03 11:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MartinJepsen">@MartinJepsen</a> on 2024-10-03 11:14</div>
            <div class="timeline-body"><p>Sounds good, thanks for the help</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KSmanis">@KSmanis</a> on 2025-07-18 07:09</div>
            <div class="timeline-body"><p>Correct me if I'm wrong, but ruff does proper AST parsing, while coverage.py relies on regexes, which can obviously lead to various false positives/negatives. I think it would be really neat if ruff could identify various common scenarios (<code>TYPE_CHECKING</code> blocks, abstract methods, protocols, typing overloads, etc., as outlined at https://coverage.readthedocs.io/en/latest/excluding.html#advanced-exclusion) and auto-apply the relevant <code>pragma</code> directives</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
