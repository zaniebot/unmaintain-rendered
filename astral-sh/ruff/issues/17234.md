```yaml
number: 17234
title: "[red-knot] `...` should be an acceptable default value for any parameter in protocol methods, abstract methods and overloaded methods"
type: issue
state: closed
author: AlexWaygood
labels:
  - bug
  - help wanted
  - ty
assignees: []
created_at: 2025-04-06T15:37:37Z
updated_at: 2025-04-07T17:35:01Z
url: https://github.com/astral-sh/ruff/issues/17234
synced_at: 2026-01-10T01:56:56Z
```

# [red-knot] `...` should be an acceptable default value for any parameter in protocol methods, abstract methods and overloaded methods

---

_Issue opened by @AlexWaygood on 2025-04-06 15:37_

### Summary

[Mypy](https://mypy-play.net/?mypy=latest&python=3.12&gist=9a8521c5eac17c9de3af8f9a982eb858), [pyright](https://pyright-play.net/?code=GYJw9gtgBALgngBwJYDsDmUkQWEMoAK4MYAxmADYA0UYAbgKYgVgCGAJgFCiRSsBGpTNlz4BAZxghWpGBAYwAFmC6dSFVuPFQAYmDAAKImBLkKASgBcnKLajsGwKAA8D4hhWA04lqP30UUAC8UAB04VZh4ZxqGlpQAEKsINZ2UAACElIycgrKXGkOTq7unt6%2B-pTBUaGR4aEx6fRMLBycRS4GPlAAcmAoDNX15lAAtAB8vf0MvvWcTYzMbFwdrt2oMCMTUJIpNe2Oneso%2BAA%2BUwPVfQNbk7tQ59cz%2B0A) and [pyrefly](https://pyrefly.org/try/?code=GYJw9gtgBALgngBwJYDsDmUkQWEMoAK4MYAxmADYA0UYAbgKYgVgCGAJgFCiRSsBGpTNlz4BAZxghWpGBAYwAFmC6dSFVuPFQAYmDAAKImBLkKASgBcnKLajsGwKAA8D4hhWA04lqP30UUAC8UAB04VZh4ZxqGlpQAEKsINZ2UAACElIycgrKXGkOTq7unt6+-pTBUaGR4aEx6fRMLBycRS4GPlAAcmAoDNX15lAAtAB8vf0MvvWcTYzMbFwdrt2oMCMTUJIpNe2Oneso+AA+UwPVfQNbk7tQ59cz+0A) all emit 0 diagnostics on this snippet:

```py
from typing import Protocol, overload
from abc import abstractmethod

class Foo(Protocol):
    def x(self, y: bool = ...): ...

class Bar:
    @abstractmethod
    def x(self, y: bool = ...): ...

@overload
def x(y: None = ...) -> None: ...
@overload
def x(y: int) -> str: ...
def x(y: int | None = None) -> str | None: ...
```

But red-knot [emits three diagnostics](https://playknot.ruff.rs/d1038da7-7198-4650-8288-548a94b74c77):

```
    Default value of type `EllipsisType` is not assignable to annotated parameter type `bool` (lint:invalid-parameter-default) [Ln 5, Col 17]
    Default value of type `EllipsisType` is not assignable to annotated parameter type `bool` (lint:invalid-parameter-default) [Ln 9, Col 17]
    Default value of type `EllipsisType` is not assignable to annotated parameter type `None` (lint:invalid-parameter-default) [Ln 12, Col 7]
```

We already exempt all functions in stub files from this check. We also need to exempt:
- Functions decorated with `@typing.overload`
- Methods decorated with `@abc.abstractmethod`
- Methods in classes that have `typing.Protocol` in their bases tuple.

This bug causes 7 spurious `invalid-parameter-default` diagnostics when type-checking my [typeshed-stats project](https://github.com/AlexWaygood/typeshed-stats), for example.

---

_Label `bug` added by @AlexWaygood on 2025-04-06 15:37_

---

_Label `help wanted` added by @AlexWaygood on 2025-04-06 15:37_

---

_Label `red-knot` added by @AlexWaygood on 2025-04-06 15:37_

---

_Added to milestone `Red Knot Alpha` by @AlexWaygood on 2025-04-06 15:37_

---

_Comment by @MatthewMckee4 on 2025-04-06 19:57_

I'd like to give this a shot, since overloads arent supported now, i guess we can leave them out for this?

---

_Comment by @AlexWaygood on 2025-04-06 20:01_

We don't understand the full semantics of `@overload` yet, but we are able to answer the question "is this is the `overload` decorator?", and we already apply special-casing for functions decorated with `@overload` in some other situations:

https://github.com/astral-sh/ruff/blob/51bdb87fd8ec547b9f47db10b7c11bc271d435f5/crates/red_knot_python_semantic/src/types/infer.rs#L1213-L1223

so I don't think that part of this issue needs to wait for full `@overload` support!

---

_Assigned to @MatthewMckee4 by @AlexWaygood on 2025-04-06 20:01_

---

_Referenced in [astral-sh/ruff#17243](../../astral-sh/ruff/pulls/17243.md) on 2025-04-06 21:19_

---

_Closed by @carljm on 2025-04-07 17:35_

---
