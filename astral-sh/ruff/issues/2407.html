<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 unused-import for star-imports: false negative? - astral-sh/ruff #2407</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 unused-import for star-imports: false negative?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2407">#2407</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-01-31 18:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/spaceone">@spaceone</a></div>
            <div class="timeline-body"><p><code>flake8</code> and <code>ruff</code> differ for <code>*</code> imports:</p>
<pre><code>$ flake8 - &lt;&lt;&lt;&quot;from foo import *&quot;
stdin:1:1: F403 &#x27;from foo import *&#x27; used; unable to detect undefined names
stdin:1:1: F401 &#x27;foo.*&#x27; imported but unused
$ ruff - &lt;&lt;&lt;&quot;from foo import *&quot;
-:1:1: F403 `from foo import *` used; unable to detect undefined names
Found 1 error.
</code></pre>
<p>I detected this as prior it had a <code># noqa: F401</code> comment which was removed by <code>RUF100</code> when I compared any leftovers with <code>flake8</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-31 18:44</div>
            <div class="timeline-body"><p>I filed an upstream bug: <a href="https://github.com/PyCQA/pyflakes/issues/766">PyCQA/pyflakes#766</a>
I would vote for fixing it in <code>pyflakes</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-31 19:00</div>
            <div class="timeline-body"><p>So they think that if <code>F405</code> doesn&#x27;t occur they mark the star import as <code>F401</code>.</p>
<p><code>F405</code> can be triggered by:</p>
<pre><code>$ python3 -m pyflakes &lt;&lt;&lt; $&#x27;from foo import *; __all__ = (&quot;a&quot;,)&#x27;
&lt;stdin&gt;:1:1: &#x27;from foo import *&#x27; used; unable to detect undefined names
&lt;stdin&gt;:1:20: &#x27;a&#x27; may be undefined, or defined from star imports: foo
$ python3 -m pyflakes &lt;&lt;&lt; $&#x27;from foo import *; a&#x27;
&lt;stdin&gt;:1:1: &#x27;from foo import *&#x27; used; unable to detect undefined names
&lt;stdin&gt;:1:20: &#x27;a&#x27; may be undefined, or defined from star imports: foo
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-31 19:12</div>
            <div class="timeline-body"><p>I think I&#x27;m okay with Ruff&#x27;s behavior here but open to being convinced otherwise. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-31 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-31 19:15</div>
            <div class="timeline-body"><p>I am unsure. I like ruffs behavior more. Will think what I can do for the time I need to support both flake8 and ruff (aka: until #2402 is fixed).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-01-31 20:10</div>
            <div class="timeline-body"><p>For a file containing just the following (which is often seen in <code>__init__.py</code>):</p>
<pre><code>from math import *
</code></pre>
<pre><code>❯ flake8 bug.py
bug.py:1:1: F403 &#x27;from math import *&#x27; used; unable to detect undefined names
bug.py:1:1: F401 &#x27;math.*&#x27; imported but unused
❯ ruff bug.py 
bug.py:1:1: F403 `from math import *` used; unable to detect undefined names
Found 1 error.
</code></pre>
<p>Using something from the <code>math</code> module:</p>
<pre><code>from math import *
pi
</code></pre>
<pre><code>❯ flake8 bug.py
bug.py:1:1: F403 &#x27;from math import *&#x27; used; unable to detect undefined names
bug.py:2:1: F405 &#x27;pi&#x27; may be undefined, or defined from star imports: math
❯ ruff bug.py 
bug.py:1:1: F403 `from math import *` used; unable to detect undefined names
bug.py:2:1: F405 `pi` may be undefined, or defined from star imports: `math`
Found 2 errors.
</code></pre>
<p>Using something that is not in the <code>math</code> module:</p>
<pre><code>from math import *
invalid_name
</code></pre>
<pre><code>❯ flake8 bug.py
bug.py:1:1: F403 &#x27;from math import *&#x27; used; unable to detect undefined names
bug.py:2:1: F405 &#x27;invalid_name&#x27; may be undefined, or defined from star imports: math
❯ ruff bug.py 
bug.py:1:1: F403 `from math import *` used; unable to detect undefined names
bug.py:2:1: F405 `invalid_name` may be undefined, or defined from star imports: `math`
Found 2 errors.
</code></pre>
<p>It has always bugged me getting <code>F401</code> and <code>F403</code> when the latter feels like it gives the expectation of the former, so I do quite like the way <code>ruff</code> does this... But I wouldn&#x27;t be upset if it was implemented like the original.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-02 03:23</div>
            <div class="timeline-body"><p>Going to close for now because I&#x27;m comfortable with our current behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-02 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-02 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-02 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/enriquebos">@enriquebos</a> on 2023-12-07 20:02</div>
            <div class="timeline-body"><p>I think if <strong>all</strong> is defined it should recognize the star import, only throw if <strong>all</strong> is also undefined.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/niniack">@niniack</a> on 2024-03-02 12:25</div>
            <div class="timeline-body"><blockquote>
<p>I think if <strong>all</strong> is defined it should recognize the star import, only throw if <strong>all</strong> is also undefined.</p>
</blockquote>
<p>I think I agree with this, but it would be good to hear if someone thinks there is a reason why this is bad practice for <code>__init__.py</code> files. Anyways, it was really bothering me so I used the following in my pyproject.toml, adapted from <a href="https://stackoverflow.com/questions/77680073/ignore-specific-rules-in-specific-directory-with-ruff">here</a></p>
<pre><code>[tool.ruff.lint.per-file-ignores]
&quot;__init__.py&quot; = [&quot;F401&quot;, &quot;F403&quot;]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:31 UTC
    </footer>
</body>
</html>
