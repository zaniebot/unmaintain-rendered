<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create an official VS Code extension - astral-sh/ruff #463</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Create an official VS Code extension</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/463">#463</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-10-24 21:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-24 21:39</div>
            <div class="timeline-body"><p>Related: #271.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-10-24 21:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-10-24 21:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-24 21:39</div>
            <div class="timeline-body"><p>\cc @Seamooo (I'm going to build this on top of <code>ruffd</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-10-25 13:16</div>
            <div class="timeline-body"><p>feel free to spam me with issues to get this working</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @charliermarsh on 2022-10-26 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Editor integrations" by @charliermarsh on 2022-10-26 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-26 15:45</div>
            <div class="timeline-body"><p>@Seamooo - Will do!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-28 13:08</div>
            <div class="timeline-body"><p>@Seamooo - Is there any risk in modifying <code>ruffd</code> to run on-edit, in addition to on-save? In my testing, it seems fast and responsive enough even on very large Python files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-28 13:09</div>
            <div class="timeline-body"><p>(I've made these changes locally and will upstream them.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-10-29 09:04</div>
            <div class="timeline-body"><p>If it's fast enough, that's exciting. I didn't want to add it initially as there was a decent amount of effort put into making partial edits very fast. Adding diagnostic generation on-edit requires the whole file, losing this speed up. I had thought of adding a debounced call on-edit but if it's fast enough that even that isn't necessary I'm happy to see it upstreamed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-10-29 09:41</div>
            <div class="timeline-body"><p>At a later date ideally operating on lines changed and the ast/cst diff would be preferrable such that the whole file isn't required</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-07 18:14</div>
            <div class="timeline-body"><p>@Seamooo - I've been working on this on and off. The main thing I'm running into is that I think if we want the extension to be self-contained (i.e., install the extension from the VS Code Marketplace and have it &quot;just work&quot;), then we have to write it in Python (see the <a href="https://code.visualstudio.com/api/advanced-topics/python-extension-template">extension template</a>). Those templates use <code>pygls</code> as the language server.</p>
<p>If, instead, we want to use <code>ruffd</code>, then we'll need users to install <code>ruffd</code> separately. (I might be wrong about this.)</p>
<p>Another option: we publish <code>ruffd</code> to PyPI, similar to <code>ruff</code>? Then we might be able to publish a Python extension that uses <code>ruffd</code> as the language server. At the very least, users could <code>pip install ruffd</code> instead of <code>cargo install ruffd</code>. Perhaps we should even consider bundling <code>ruffd</code> into <code>ruff</code>?</p>
<p><a href="https://www.osohq.com/post/building-vs-code-extension-with-rust-wasm-typescript">This post</a> on the Polar extension gets at some of these issues.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-07 18:19</div>
            <div class="timeline-body"><p>So I think the options are as follows:</p>
<ul>
<li>Use their extension template, implement a Ruff extension that doesn't use <code>ruffd</code>.</li>
<li>Write a VS Code extension that <em>does</em> use <code>ruffd</code>, but require users to install <code>ruffd</code> separately (via <code>pip</code>).</li>
<li>Write a VS Code extension that <em>does</em> use <code>ruffd</code>, and find some way to distribute it as a Python extension that bundles both <code>ruff</code> and <code>ruffd</code>.</li>
</ul>
<p>Those are roughly in order by how much work they would require (and, I think, how powerful they would be). Perhaps I'll start with (1), then we can do (2) or (3)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiangolo">@tiangolo</a> on 2022-11-07 21:49</div>
            <div class="timeline-body"><p>I understand the Pylance (VS Code Python) are currently splitting their support for linters in independent but connected extensions. I understand that's the case for the Flake8 and Isort support. I suspect for black as well.</p>
<p>I don't know if they are bundling a version of those packages in the new extensions. But up to now, that the support has been just part of Pylance, it asks to install Flake8 and mypy in the current environment on the first automatic run of the linter, it shows a button prompting to install, that when clicked runs the <code>pip install</code> command on the terminal.</p>
<p>And when running the thing to &quot;format code&quot;, as I have it configured with Black, it shows the prompt asking to install Black.</p>
<p>Just my two cents of the behavior I've seen.</p>
<p>But also, that's probably changing in some way with the new separated extensions, not sure.</p>
<p>But anyway, maybe worth checking how they are doing that to copy the behavior, maybe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-07 21:55</div>
            <div class="timeline-body"><p>Oh interesting, that's really helpful to hear. (I almost exclusively use PyCharm so I'm not that familiar with extension norms.) Will look into this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fannheyward">@fannheyward</a> on 2022-11-08 02:05</div>
            <div class="timeline-body"><p>@charliermarsh you can bundle <code>ruffd</code> in your extensions, many VSCode extensions did as this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 02:07</div>
            <div class="timeline-body"><p>@fannheyward - Oh cool. Can I include the Rust directly? Or does it need to be compiled into a binary? Or installable as Python? (Also, if there are any examples that come to mind, would be much appreciated.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fannheyward">@fannheyward</a> on 2022-11-08 02:11</div>
            <div class="timeline-body"><p>@charliermarsh only <code>ruffd</code> binary. <code>rust-analyzer</code> does in this way.</p>
<p>This's rust-analyzer, download the extension and change it to <code>zip</code> type to unzip, you'll see <code>rust-analyzer</code> bin in server.</p>
<p>https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer</p>
<p>Here's how rust-analyzer build and publish extension with GitHub Actions https://github.com/rust-lang/rust-analyzer/blob/master/.github/workflows/release.yaml</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 02:16</div>
            <div class="timeline-body"><p>Thanks tons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 02:18</div>
            <div class="timeline-body"><p>This makes a lot of sense, it just requires that we build for each platform (which is fine).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 04:53</div>
            <div class="timeline-body"><p>For now, I did the easier thing and published a VS Code extension based on Microsoft's Python template: https://marketplace.visualstudio.com/items?itemName=charliermarsh.ruff. I'd like to move that codebase over to <code>ruffd</code> internally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 04:55</div>
            <div class="timeline-body"><p>The extension is implemented in https://github.com/charliermarsh/vscode-ruff.</p>
<p>\ht to @harupy for some of the scaffolding.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 04:57</div>
            <div class="timeline-body"><p>I'll enable autofix and code actions within that extension shortly. For now, it's just diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-08 04:57</div>
            <div class="timeline-body"><p>If you can, please give it a whirl! Would also appreciate reviews for the extension and stars on the repo if you're so inclined üôè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiangolo">@tiangolo</a> on 2022-11-09 13:17</div>
            <div class="timeline-body"><p>Awesome! üöÄ</p>
<p>Right now it expects <code>ruff</code> to be in the environment. And if it is not, it logs an error in the Ruff-specific output, but there's no UI telling the user there was an error with Ruff, or asking the user to install Ruff in the current environment.</p>
<p>Not sure how Pylance does that, that shows a dialog asking the user to install, e.g. <code>mypy</code> and when clicking &quot;OK&quot; it runs the pip command to install it in the current environment, I think that would help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-09 14:50</div>
            <div class="timeline-body"><p>Oh interesting! My expectation from the template had been that if Ruff wasn't in your environment, it'd fall back to a bundled version. Let me play around with.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-09 22:20</div>
            <div class="timeline-body"><p>(Having trouble with this because VS Code seems to omit the Ruff binary from the VSIX package, so the &quot;bundled&quot; version isn't working as expected.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-09 22:24</div>
            <div class="timeline-body"><p>(Looking at the rust-analyzer workflow file for guidance.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-09 22:37</div>
            <div class="timeline-body"><p>There's a <code>bundled/libs/bin/**</code> in the <code>.vscodeignore</code> from the extension template ü§¶</p>
<p>But I may still need to create separate builds for each platform? Since it's bundling a binary?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-10 04:10</div>
            <div class="timeline-body"><p>The Ruff VS Code extension now comes bundled with the native <code>ruff</code> binary: https://github.com/charliermarsh/vscode-ruff/pull/10. So it should work out-of-the-box with no additional installation step.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-10 04:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:56:29 UTC
    </footer>
</body>
</html>
