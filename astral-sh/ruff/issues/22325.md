```yaml
number: 22325
title: SIM107 documentation example may be misleading
type: issue
state: open
author: ftnext
labels:
  - documentation
assignees: []
created_at: 2026-01-01T10:28:23Z
updated_at: 2026-01-03T22:35:42Z
url: https://github.com/astral-sh/ruff/issues/22325
synced_at: 2026-01-10T01:56:57Z
```

# SIM107 documentation example may be misleading

---

_Issue opened by @ftnext on 2026-01-01 10:28_

### Question

I have a question about the example shown in the [SIM107 (return-in-try-except-finally)](https://docs.astral.sh/ruff/rules/return-in-try-except-finally/) documentation.
**Could you clarify the intended purpose of this documentation example?**

The current documentation includes this as good example:

```python
def squared(n):
    try:
        return_value = n**2
    except Exception:
        return_value = "An exception occurred"
    finally:
        return_value = -1
    return return_value
```

**Issue:**

This code always returns `-1` because the `finally` block overwrites the `return_value` variable.

```python
print(squared(3))  # -1 not 9
print(squared("3"))  # -1 not "An exception occurred"
```

ref: https://docs.python.org/3/tutorial/errors.html#defining-clean-up-actions

>If a finally clause is present, the finally clause will execute as the last task before the try statement completes. 

Concern: **Unclear purpose of the example**

- It's not clear whether this is meant to be a "recommended approach" (because both implemetation are broken)
- This issue may have originated from flake8-simplify https://github.com/MartinThoma/flake8-simplify/issues/9


### Version

ruff 0.14.10 (45bbb4cbf 2025-12-18)

---

_Label `question` added by @ftnext on 2026-01-01 10:28_

---

_Comment by @ntBre on 2026-01-01 14:18_

Thanks for the report! I agree that this is confusing. I think the minimal change to get something that actually works is to remove only the return in the `finally` arm for the "Use instead" example:

```py
def squared(n):
    try:
        sqr = n**2
        return sqr
    except Exception:
        return "An exception occurred"
    finally:
        return_value = -1
	return return_value
```

but even that is a bit confusing. Maybe a better initial example would be helpful.

---

_Label `question` removed by @ntBre on 2026-01-01 14:19_

---

_Label `documentation` added by @ntBre on 2026-01-01 14:19_

---

_Comment by @LoicRiegel on 2026-01-03 22:35_

I thought for a while and searched online, and I could not find a good example. The best one to me is the one from the issue @ftnext linked (https://github.com/MartinThoma/flake8-simplify/issues/9).
I'm so surprised that this rule is in the flake8-**simplify** linter. This is not about simplifing code, returning in a ``finally`` block is never what we want!! 

---
