<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>type-comparison (E721) only works on some builtin classes and nothing else - astral-sh/ruff #6465</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>type-comparison (E721) only works on some builtin classes and nothing else</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6465">#6465</a>
        opened by <a href="https://github.com/DetachHead">@DetachHead</a>
        on 2023-08-10 01:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/DetachHead">@DetachHead</a></div>
            <div class="timeline-body"><pre><code>def asdf(value: object):
    type(value) is str  # error
    type(value) is int  # error
    type(value) is list  # no error
    type(value) is dict  # no error

    class Foo:
        ...

    type(value) is Foo  # no error
</code></pre>
<p>pylint&#x27;s <code>unidiomatic-typecheck</code> detects all of these cases</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-10 02:18</div>
            <div class="timeline-body"><p>I&#x27;m honestly tempted to revert the changes to this rule and just go back to pycodestyle parity, because I don&#x27;t really understand the contexts in which pycodestyle is meant to be enforcing it, and it doesn&#x27;t seem worth it to me to keep spending time refining it. (This rule in pycodestyle is <em>not</em> the same as <code>unidiomatic-typecheck</code>, and we&#x27;re now deviating from both subtly.)</p>
<p>For example, pycodestyle allows <code>type(a1) is type(b1)</code>, <code>type(a1) is int</code>, etc., but disallows <code>type(a) is type(1)</code>. I don&#x27;t really understand it.</p>
<p>Separately, comparing <code>type(value) is int</code> is actually reasonable to me in some cases if you want to do a direct comparison, <em>not</em> a subclass comparison. I assume that&#x27;s why pycodestyle is more limited in its rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-10 02:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-10 02:25</div>
            <div class="timeline-body"><p>(I added the missing builtin types at least.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdowning">@bdowning</a> on 2024-01-08 22:42</div>
            <div class="timeline-body"><p>IMHO ruff needs to allow stuff like <code>type(foo) is int</code>.  flake8 allowed this, it just disallowed <code>type(foo) == int</code> and recommended replacing <code>==</code> with <code>is</code> and <em>not</em> replacing with <code>isinstance</code>, which obviously has completely different behavior.  I just had code break from &quot;fixing&quot; lint violations with <code>isinstance</code> due to a behavior change (because <code>bool</code> is a subclass of <code>int</code> for some insane reason).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-08 22:51</div>
            <div class="timeline-body"><p>@bdowning -- I believe we already allowed that if you run with <code>--preview</code>: https://play.ruff.rs/90c3ddba-0c1f-450d-96bc-df09ee8e6adb. (This will become stable behavior when we ship v0.2.0.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdowning">@bdowning</a> on 2024-01-09 00:13</div>
            <div class="timeline-body"><p>Thanks.  BTW, the playground seems more than a little busted on Firefox right now:
<img src="https://github.com/astral-sh/ruff/assets/366426/b4af14b3-ca1d-42ac-b532-b0d699ae8f59" alt="image"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdowning">@bdowning</a> on 2024-02-02 01:13</div>
            <div class="timeline-body"><p>@charliermarsh So I updated to 0.2.0 and I&#x27;m still only seeing stuff like <code>type(foo) is int</code> being allowed with <code>--preview</code>.  Did this not make the cut?</p>
<pre><code>$ poetry run ruff --version
ruff 0.2.0
$ poetry run ruff xxx/
warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - &#x27;ignore&#x27; -&gt; &#x27;lint.ignore&#x27;
  - &#x27;select&#x27; -&gt; &#x27;lint.select&#x27;
  - &#x27;isort&#x27; -&gt; &#x27;lint.isort&#x27;
xxx/yyy.py:193:8: E721 Do not compare types, use `isinstance()`
xxx/yyy.py:195:10: E721 Do not compare types, use `isinstance()`
xxx/yyy.py:199:10: E721 Do not compare types, use `isinstance()`
Found 3 errors.
$ poetry run ruff --preview xxx/
warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - &#x27;ignore&#x27; -&gt; &#x27;lint.ignore&#x27;
  - &#x27;select&#x27; -&gt; &#x27;lint.select&#x27;
  - &#x27;isort&#x27; -&gt; &#x27;lint.isort&#x27;
$
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-02 01:18</div>
            <div class="timeline-body"><p>It&#x27;s possible we missed this in the <code>0.2.0</code> stabilizations. For what it&#x27;s worth, I think this is a bug and we should fix it immediately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-02 01:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdowning">@bdowning</a> on 2024-04-06 00:03</div>
            <div class="timeline-body"><p>@zanieb Any word on this?  Just checked with 0.3.5 and it looks like this is still behind the preview barrier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joaoe">@joaoe</a> on 2024-06-07 12:45</div>
            <div class="timeline-body"><p>Hi.
I&#x27;m hitting this warning.</p>
<p>Now and then I want to do <code>type(a) is B</code> or <code>type(a) is type(c)</code> to do strict type checking, not subclassing, namely in unit tests.</p>
<p>The <code>type(...) is ...</code> check with the <code>is</code> operator should be allowed and not trigger a warning, or in an alternative case, produce a separate warning from E721 which we can choose to ignore.
Cheers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-12 16:39</div>
            <div class="timeline-body"><p>@joaoe Can you try your example with <code>--preview</code> mode? This is resolved in preview mode, we just need to move it into stable in the next minor release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-12 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-12 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v0.5.0&quot; by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-12 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-12 16:40</div>
            <div class="timeline-body"><p>Ok, there&#x27;s a PR up which will resolve this: <a href="https://github.com/astral-sh/ruff/pull/11220">astral-sh/ruff#11220</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-25 16:22</div>
            <div class="timeline-body"><p>The preview logic has been moved to stable and will be released as part of v0.5.</p>
<p>Resolved by #11220</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-25 16:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:40 UTC
    </footer>
</body>
</html>
