<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E306: unexpected behavior - astral-sh/ruff #18264</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>E306: unexpected behavior</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/18264">#18264</a>
        opened by <a href="https://github.com/mikelei8291">@mikelei8291</a>
        on 2025-05-22 19:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mikelei8291">@mikelei8291</a> on 2025-05-22 19:56</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In the <a href="https://docs.astral.sh/ruff/rules/blank-lines-before-nested-definition/#example">example</a> of E306, there's no blank line required before the first nested function, but only between two nested functions. However, if there were lines of code before the first nested function, it will be reported as a style error.</p>
<p><img src="https://github.com/user-attachments/assets/0c4144d3-aa35-439f-b7b0-aaf399ff4544" alt="Image" /></p>
<h3>Version</h3>
<p>ruff 0.11.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxmynter">@maxmynter</a> on 2025-05-23 10:57</div>
            <div class="timeline-body"><p><a href="https://www.flake8rules.com/rules/E306.html">Flake8</a> recommends inner methods to be surrounded by one blank line.</p>
<p><a href="https://peps.python.org/pep-0008/#blank-lines">PEP8</a> only mentions the inner methods of a class, not nested functions, but states &quot;surrounded by a single blank line&quot;.</p>
<p>E306 is modeled after Pycodestyle which tests against PEP8.</p>
<p>So I guess the unexpected behaviour is rather that the error is not reported in the second example and we should update the  E306. We should also clear up the wording in the docs to include nested functions.</p>
<p>While we're at it, we should update the broken link on E306 to the typing styleguide. I believe <a href="https://typing.python.org/en/latest/guides/writing_stubs.html#blank-lines">this</a> is the correct one.</p>
<p>Happy to provide a fix if someone from Astral agrees with this outline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-23 13:12</div>
            <div class="timeline-body"><p>PEP8 says</p>
<blockquote>
<p>Extra blank lines may be used (sparingly) to separate groups of related functions. Blank lines may be omitted between a bunch of related one-liners (e.g. a set of dummy implementations).</p>
</blockquote>
<p>So E306 is correct here to not report an error. This is also consistent with Ruff's formatter (and changing it would make the rule incompatible with the formatter).</p>
<p>The reason it requires a blank line after a non-function statement is because it's otherwise very easy to &quot;miss&quot; that there are any statements before the function.</p>
<p>Because of that, I don't think there's anything we should change here (other than the maybe broken docs)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-05-23 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikelei8291">@mikelei8291</a> on 2025-05-23 18:37</div>
            <div class="timeline-body"><blockquote>
<p>The reason it requires a blank line after a non-function statement is because it's otherwise very easy to &quot;miss&quot; that there are any statements before the function.</p>
</blockquote>
<p>Good point, thanks for the explanation.</p>
<p>However, does it mean that the &quot;best practice&quot; shown on the <a href="https://www.flake8rules.com/rules/E306.html">flake8 rules page of E306</a> is not correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-23 19:08</div>
            <div class="timeline-body"><blockquote>
<p>However, does it mean that the &quot;best practice&quot; shown on the <a href="https://www.flake8rules.com/rules/E306.html">flake8 rules page of E306</a> is not correct?</p>
</blockquote>
<p>It probably depends on who you ask :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikelei8291">@mikelei8291</a> on 2025-05-24 01:55</div>
            <div class="timeline-body"><p>I'm closing this due to the fact that there is nothing to fix for Ruff. Thanks again for the responses. I think it's a good idea to open a new issue/pr for the broken doc link.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mikelei8291 on 2025-05-24 01:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
