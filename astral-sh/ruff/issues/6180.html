<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`F823` false positive - astral-sh/ruff #6180</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`F823` false positive</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6180">#6180</a>
        opened by <a href="https://github.com/bastimeyer">@bastimeyer</a>
        on 2023-07-30 14:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bastimeyer">@bastimeyer</a> on 2023-07-30 14:00</div>
            <div class="timeline-body"><pre><code>$ ruff -V
ruff 0.0.280
</code></pre>
<p>Consider the following code snippet which overrides the <a href="https://github.com/jamielennox/requests-mock/blob/1.11.0/requests_mock/contrib/_pytest_plugin.py#L70-L86">default <code>requests_mock</code> pytest fixture</a> with <code>InvalidRequest</code> being raised on unknown requests, so it needs to import the <code>requests_mock</code> package with the same name first in order to access certain exports like <a href="https://github.com/jamielennox/requests-mock/blob/1.11.0/requests_mock/__init__.py#L15"><code>Mocker</code></a>, <a href="https://github.com/jamielennox/requests-mock/blob/1.11.0/requests_mock/__init__.py#L13"><code>ANY</code></a>, or the <a href="https://github.com/jamielennox/requests-mock/blob/1.11.0/requests_mock/exceptions.py#L29-L30"><code>exceptions</code> submodule</a>:</p>
<pre><code class="language-py">import pytest
import requests_mock as rm

@pytest.fixture()
def requests_mock(requests_mock: rm.Mocker) -&gt; rm.Mocker:
    requests_mock.register_uri(rm.ANY, rm.ANY, exc=rm.exceptions.InvalidRequest)
    return requests_mock
</code></pre>
<pre><code>$ ruff check --select F823 ./F823.py
F823.py:
  6:32 F823 Local variable `requests_mock` referenced before assignment
    |
  4 | @pytest.fixture()
  5 | def requests_mock(requests_mock: rm.Mocker) -&gt; rm.Mocker:
  6 |     requests_mock.register_uri(rm.ANY, rm.ANY, exc=rm.exceptions.InvalidRequest)
    |                                ^^ F823
  7 |     return requests_mock
    |
  
Found 1 error.
</code></pre>
<p>Apparently, ruff doesn't handle the renamed import correctly. When renaming the pytest fixture function or the fixture argument, which both can't be done because it's a global fixture override in our test code, then ruff doesn't raise an error.</p>
<p><code>F823</code> wasn't an issue in <code>0.0.272</code> but it now is after upgrading to <code>0.0.280</code>. The last modification of that rule was in #6036.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-07-30 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-30 16:19</div>
            <div class="timeline-body"><p>I think this is my bad, I will fix this in time for Mondayâ€™s release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-07-30 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6182.html">astral-sh/ruff#6182</a> on 2023-07-30 22:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-30 22:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 15:05</div>
            <div class="timeline-body"><p>This should be fixed in v0.0.282, which is out now.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
