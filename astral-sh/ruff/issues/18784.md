```yaml
number: 18784
title: "[Perflint] PERF101 fix can delete comments"
type: issue
state: closed
author: MeGaGiGaGon
labels:
  - bug
  - help wanted
assignees: []
created_at: 2025-06-19T07:06:20Z
updated_at: 2025-06-26T20:58:49Z
url: https://github.com/astral-sh/ruff/issues/18784
synced_at: 2026-01-10T01:56:56Z
```

# [Perflint] PERF101 fix can delete comments

---

_Issue opened by @MeGaGiGaGon on 2025-06-19 07:06_

### Summary

`PERF101` can delete comments in the change. This should either cause the fix to be marked unsafe, make the fix not apply, or move the comments. [playground](https://play.ruff.rs/f083d605-c1bb-4d3c-9025-020b62ac4b44)
```
PS D:\python_projects> Get-Content issue.py
```
```py
items = (1, 2, 3)
for i in (  # 1
    list  # 2
    # 3
)(  # 4
    items  # 5
    # 6
):
    print(i)
```
```
PS D:\python_projects> uvx ruff check issue.py --select PERF
```
```snap
issue.py:2:10: PERF101 [*] Do not cast an iterable to `list` before iterating over it
  |
1 |   items = (1, 2, 3)
2 |   for i in (  # 1
  |  __________^
3 | |     list  # 2
4 | |     # 3
5 | | )(  # 4
6 | |     items  # 5
7 | |     # 6
8 | | ):
  | |_^ PERF101
9 |       print(i)
  |
  = help: Remove `list()` cast

Found 1 error.
[*] 1 fixable with the `--fix` option.
```
```
PS D:\python_projects> uvx ruff check issue.py --select PERF --fix --diff
```
```diff
--- issue.py
+++ issue.py
@@ -1,9 +1,3 @@
 items = (1, 2, 3)
-for i in (  # 1
-    list  # 2
-    # 3
-)(  # 4
-    items  # 5
-    # 6
-):
+for i in items:
     print(i)

Would fix 1 error.
```

### Version

ruff 0.12.0 (87f0feb 2025-06-17) + playground

---

_Comment by @MichaReiser on 2025-06-19 09:02_

We should mark it as unsafe if the range overlaps with comments.

---

_Label `bug` added by @MichaReiser on 2025-06-19 09:02_

---

_Label `help wanted` added by @MichaReiser on 2025-06-19 09:02_

---

_Comment by @LaBatata101 on 2025-06-19 14:45_

I'm working on this

---

_Referenced in [astral-sh/ruff#18803](../../astral-sh/ruff/pulls/18803.md) on 2025-06-19 20:00_

---

_Assigned to @LaBatata101 by @ntBre on 2025-06-20 13:13_

---

_Comment by @LaBatata101 on 2025-06-26 20:57_

This can be closed now

---

_Closed by @ntBre on 2025-06-26 20:58_

---
