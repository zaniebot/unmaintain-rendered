<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 unused import false negative - astral-sh/ruff #4656</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 unused import false negative</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4656">#4656</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2023-05-25 13:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-05-25 13:25</div>
            <div class="timeline-body"><p>False negative</p>
<pre><code>import importlib # this package is unused, but not detected
import importlib.util 

package = &quot;ruff&quot;
is_present = importlib.util.find_spec(package)
</code></pre>
<p>When <code>from importlib import util</code> is used, correct behaviour is observed</p>
<pre><code>import importlib # this package is unused, and detected
from importlib import util 

package = &quot;ruff&quot;
is_present = util.find_spec(package)
</code></pre>
<p>Ruff 'v0.0.270'</p>
<p>(hope I'm overlooking some submodule complexity in the general case, but it seems that in this specific case <code>import importlib</code> can be safely removed)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "F401 unused import false positive" to "F401 unused import false negative" by @sbrugman on 2023-05-25 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-25 14:08</div>
            <div class="timeline-body"><p>This is consistent with Pyflakes and I think it's intentional, but submodule imports are really complex, I'm not certain whether it's safe in the general case to mark <code>import a</code> as unused in:</p>
<pre><code class="language-py">import a
import a.b

a.b.c()
</code></pre>
<p>It might be safe? I believe we had a PR long ago that addressed this: #58.</p>
<p>(Here's a good example of why / how submodules can be difficult, though it's not exactly the same as above: https://github.com/asottile/scratch/wiki/Why-doesn't-flake8-mark-this-as-an-unused-import%3F.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-05-25 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-05-25 14:26</div>
            <div class="timeline-body"><p>Thanks for sharing the resource.</p>
<p>For what it's worth PyCharm does flag <code>import a</code> as unused import in the example above.</p>
<p>Can we think of examples where we would like to treat that example differently from this:</p>
<pre><code class="language-python">import b
import a.b

a.b.c()
</code></pre>
<p>(The case in the linked resource above is the inverse)</p>
<p>Thinking out loud, but wouldn't <code>import a.b</code> also import <code>a</code>, so importing <code>a</code> is redundant?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-05-25 14:57</div>
            <div class="timeline-body"><p>I'm struggling to find a case where <code>import a.b</code> is semantically different from <code>import a; import a.b</code> given that <code>import a.b</code> also runs <code>a/__init__.py</code> (https://docs.python.org/3/reference/import.html#the-meta-path, fourth paragraph)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-25 15:33</div>
            <div class="timeline-body"><p>Yeah, it might be the case that if we have <code>import a; import a.b</code> and then <code>a.b</code> is used but not <em>just</em> <code>a</code>, then we can mark <code>import a</code> as unused.</p>
<p>On the other hand, per Anthony's linked note, if we have <code>import a; import a.b</code>, and then <code>a.z.x</code> is used, it seems like we can't actually treat <code>import a.b</code> as unused, since it <em>could</em> modify <code>a</code>.</p>
<p>Similarly, if you have <code>import a; import a.b</code>, and then you do <code>print(a); print(a.b.c)</code>, I don't think we can treat either import as unused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-07-10 01:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-07-10 01:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ZeitOnline/vivi/pulls/626.html">ZeitOnline/vivi#626</a> on 2024-02-21 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10674.html">astral-sh/ruff#10674</a> on 2024-03-30 23:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11448.html">astral-sh/ruff#11448</a> on 2024-05-17 14:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13000.html">astral-sh/ruff#13000</a> on 2024-08-20 03:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15057.html">astral-sh/ruff#15057</a> on 2024-12-19 12:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17295.html">astral-sh/ruff#17295</a> on 2025-04-08 13:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pkulev">@pkulev</a> on 2025-04-09 08:57</div>
            <div class="timeline-body"><blockquote>
<p>On the other hand, per Anthony's linked note, if we have import a; import a.b, and then a.z.x is used, it seems like we can't actually treat import a.b as unused, since it could modify a.</p>
</blockquote>
<p>Oh, indeed. I think that if something happens on import time, like filling some global variables from other modules (handlers registration or some <code>__init_subclass__</code> registration magic) it must be visible, and <code># noqa: import for side-effects</code> is a good indicator of such things. I would prefer throwing a bunch of noqa's for such rare cases, than considering it normal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20115.html">astral-sh/ruff#20115</a> on 2025-08-27 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20120.html">astral-sh/ruff#20120</a> on 2025-08-28 01:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20200.html">astral-sh/ruff#20200</a> on 2025-09-12 19:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:07 UTC
    </footer>
</body>
</html>
