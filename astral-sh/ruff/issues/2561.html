<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>noqa: F821 does not work reliably - astral-sh/ruff #2561</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>noqa: F821 does not work reliably</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2561">#2561</a>
        opened by <a href="https://github.com/FranzForstmayr">@FranzForstmayr</a>
        on 2023-02-04 00:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/FranzForstmayr">@FranzForstmayr</a> on 2023-02-04 00:39</div>
            <div class="timeline-body"><p>Hi,</p>
<p>I have following issue linting a sphinx configuration file, which has a special variable <code>tags</code> without importing available. Don't ask me why, see point 6. https://www.sphinx-doc.org/en/master/usage/configuration.html</p>
<p>I wanted to ignore this specific line for ruff but <code>noqa: F821</code> does not work when the undefined variable is not the first entry.
See this reproducer:</p>
<pre><code class="language-python"># Following is not marked as error
tags1  # noqa: F821

# Following line is marked as error
if 'versionwarning' in tags2:  #noqa: F821
    pass
</code></pre>
<p>gives</p>
<pre><code>test.py:5:24: F821 Undefined name `tags2`
Found 1 error.
</code></pre>
<pre><code>ruff --version
ruff 0.0.240
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../scipy/scipy/pulls/15929.html">scipy/scipy#15929</a> on 2023-02-04 00:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-04 01:10</div>
            <div class="timeline-body"><p>Will take a look at this tonight!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-02-04 01:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-04 01:10</div>
            <div class="timeline-body"><p>(On my phone but is it possible you need a space between the hash and the noqa in the second example? Just a guess before I debug properly in a bit.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-04 01:28</div>
            <div class="timeline-body"><p>Yeah I think that solves the problem. Flake8 has the same behavior, so I think this is correct!</p>
<p>Specifically, you want this:</p>
<pre><code class="language-py"># Following is not marked as error
tags1  # noqa: F821

# Following line is marked as error
if 'versionwarning' in tags2:  # noqa: F821
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-04 01:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-04 01:28</div>
            <div class="timeline-body"><p>(Let me know if you're still seeing this behavior after that change and I'll be happy to reopen.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../scipy/scipy/pulls/17878.html">scipy/scipy#17878</a> on 2023-02-04 02:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FranzForstmayr">@FranzForstmayr</a> on 2023-02-04 07:58</div>
            <div class="timeline-body"><p>Thank's for your time and quick help :)
I usually don't dig around with whitespace variations in python, probably that's why I don't found the issue :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
