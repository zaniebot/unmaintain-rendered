<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF009 hints for float('-inf') - astral-sh/ruff #4657</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>RUF009 hints for float('-inf')</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4657">#4657</a>
        opened by <a href="https://github.com/alkatar21">@alkatar21</a>
        on 2023-05-25 13:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alkatar21">@alkatar21</a> on 2023-05-25 13:48</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p><code>RUF009</code> is hinting in a dataclass where floats are initialized with <code>float('-inf')</code>.
As suggested in <a href="https://discord.com/channels/1039017663004942429/1039017663512449056/1111040962039386122">Discord</a> <code>float</code> should probably be added to the list of allowed functions.</p>
<pre><code class="language-py">from dataclasses import dataclass

@dataclass
class Test:
    example: float = float('-inf') # Do not perform function call `float` in dataclass defaultsRuff(RUF009)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-25 14:10</div>
            <div class="timeline-body"><p>Thanks :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-05-25 14:43</div>
            <div class="timeline-body"><p>@alkatar21, Would you like to make a PR for it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alkatar21">@alkatar21</a> on 2023-05-25 14:52</div>
            <div class="timeline-body"><p>If you could give me a hint of where to look, I would try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-25 15:07</div>
            <div class="timeline-body"><p>@alkatar21 Quick scan of the rule suggests this is approximately where the check is done: https://github.com/charliermarsh/ruff/blob/741e180e2d30078c59e03a8761d90757964c5cf7/crates/ruff/src/rules/ruff/rules/mutable_defaults_in_dataclass_fields.rs#L202</p>
<p>I can also open a PR if you prefer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-25 15:20</div>
            <div class="timeline-body"><p>Should the check for float be added to the <code>IMMUTABLE_FUNCS</code> const and therefore <code>is_immutable_func</code>, which is also used in flake8-bugbear rule <code>FunctionCallInDefaultArgument</code>? Or should it be a separate check for <code>RUF009</code> only?</p>
<p><a href="https://github.com/PyCQA/flake8-bugbear/blob/a309029eed5070938a376af88b0d046e8acda5c9/bugbear.py#LL1575C25-L1575C25">This line</a> in <code>flake8-bugbear</code> seems to suggest it should just be a <code>RUF009</code> thing but just wanna make sure before I (or someone else equally unfamiliar) opens a PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-25 15:44</div>
            <div class="timeline-body"><p>Yeah, I think float and int and perhaps some other builtins (<code>complex</code>?) should be added there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-25 16:26</div>
            <div class="timeline-body"><p>I'll open a PR with those in as well. Looking at:</p>
<pre><code class="language-rust">const IMMUTABLE_FUNCS: &amp;[&amp;[&amp;str]] = &amp;[
    &amp;[&quot;&quot;, &quot;tuple&quot;],
    &amp;[&quot;&quot;, &quot;frozenset&quot;],
    &amp;[&quot;datetime&quot;, &quot;date&quot;],
    &amp;[&quot;datetime&quot;, &quot;datetime&quot;],
    &amp;[&quot;datetime&quot;, &quot;timedelta&quot;],
    &amp;[&quot;decimal&quot;, &quot;Decimal&quot;],
    &amp;[&quot;operator&quot;, &quot;attrgetter&quot;],
    &amp;[&quot;operator&quot;, &quot;itemgetter&quot;],
    &amp;[&quot;operator&quot;, &quot;methodcaller&quot;],
    &amp;[&quot;pathlib&quot;, &quot;Path&quot;],
    &amp;[&quot;types&quot;, &quot;MappingProxyType&quot;],
    &amp;[&quot;re&quot;, &quot;compile&quot;],
];
</code></pre>
<p>I'll add <code>int</code>, <code>float</code>, <code>complex</code>.</p>
<p>If it should be: &quot;all functions that return an immutable object&quot; should <code>str</code> and <code>bool</code> also be added?</p>
<p>There's also the <code>fractions.Fraction</code> which states it in its <a href="https://docs.python.org/3/library/fractions.html">docs</a></p>
<blockquote>
<p>The <a href="https://docs.python.org/3/library/fractions.html#fractions.Fraction">Fraction</a> class inherits from the abstract base class <a href="https://docs.python.org/3/library/numbers.html#numbers.Rational">numbers.Rational</a>, and implements all of the methods and operations from that class. <a href="https://docs.python.org/3/library/fractions.html#fractions.Fraction">Fraction</a> instances are <a href="https://docs.python.org/3/glossary.html#term-hashable">hashable</a>, and should be treated as immutable.</p>
</blockquote>
<p>Unsure if that counts for this purpose as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4660.html">astral-sh/ruff#4660</a> on 2023-05-25 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-05-25 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-26 19:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
