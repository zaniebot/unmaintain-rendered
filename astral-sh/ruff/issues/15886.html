<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missing exception for `module-import-not-at-top-of-file-e402` - astral-sh/ruff #15886</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Missing exception for `module-import-not-at-top-of-file-e402`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/15886">#15886</a>
        opened by <a href="https://github.com/janosh">@janosh</a>
        on 2025-02-02 21:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/janosh">@janosh</a> on 2025-02-02 21:57</div>
            <div class="timeline-body"><h3>Description</h3>
<p>the following two codes are practically equivalent but the 2nd one gets a <code>E402</code> error in <code>ruff</code> v0.9.4</p>
<pre><code class="language-py">import os
import sys

sys.path.append(os.path.dirname(__file__))  # sys.path.append gets special exception when appearing above imports

from package import module
</code></pre>
<pre><code class="language-py">import os
import sys

sys.path += [os.path.dirname(__file__)] # get E402 here

from package import module
</code></pre>
<p>i think the bottom code should be treated same as the top, i.e. not raise an error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-02-03 06:59</div>
            <div class="timeline-body"><p>This seems to be an excellent good first issue candidate. The changes necessary would be to modify <a href="https://github.com/InSyncWithFoo/ruff/blob/fa46ba2306c62a2d6bb3c1abcd7ba0afb26d9421/crates/ruff_python_semantic/src/analyze/imports.rs#L12"><code>is_sys_path_modification()</code></a> and <a href="https://github.com/InSyncWithFoo/ruff/blob/fa46ba2306c62a2d6bb3c1abcd7ba0afb26d9421/crates/ruff_linter/src/checkers/ast/mod.rs#L455"><code>Checker::visit_stmt()</code></a>, or, in other words, mostly what #14474 did.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-02-03 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-02-03 11:57</div>
            <div class="timeline-body"><p>Can I give a try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-03 14:14</div>
            <div class="timeline-body"><p>Sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @VascoSch92 by @MichaReiser on 2025-02-03 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15980.html">astral-sh/ruff#15980</a> on 2025-02-05 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-02-06 16:57</div>
            <div class="timeline-body"><p>I think this issue is closed ;-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-06 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-06 17:29</div>
            <div class="timeline-body"><p>thanks for the ping!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
