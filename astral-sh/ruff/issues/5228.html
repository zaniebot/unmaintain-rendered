<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Panic] new cache code causing panic in 0.0.273 - astral-sh/ruff #5228</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Panic] new cache code causing panic in 0.0.273</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5228">#5228</a>
        opened by <a href="https://github.com/Edward-Knight">@Edward-Knight</a>
        on 2023-06-20 22:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Edward-Knight">@Edward-Knight</a></div>
            <div class="timeline-body"><p>Running <code>RUST_BACKTRACE=full ruff &lt;file&gt;</code> on 0.0.273 resulted in this output:</p>
<pre><code>
error: `ruff` crashed. This indicates a bug in `ruff`. If you could open an issue at:

https://github.com/astral-sh/ruff/issues/new?title=%5BPanic%5D

quoting the executed command, along with the relevant file contents and `pyproject.toml` settings, we&#x27;d be very appreciative!

thread &#x27;main&#x27; panicked at &#x27;called `Option::unwrap()` on a `None` value&#x27;, crates/ruff_cli/src/commands/run.rs:112:65
stack backtrace:
   0:        0x102bd4718 - _rust_eh_personality
   1:        0x10260fc84 - _main
   2:        0x102baf69c - _rust_eh_personality
   3:        0x102bd6108 - _rust_eh_personality
   4:        0x102bd5d48 - _rust_eh_personality
   5:        0x102bd5a8c - _rust_eh_personality
   6:        0x102a7d280 - _main
   7:        0x102bd6a30 - _rust_eh_personality
   8:        0x102bd67f0 - _rust_eh_personality
   9:        0x102bd6784 - _rust_eh_personality
  10:        0x102bd6778 - _rust_eh_personality
  11:        0x102c5093c - __rjem_je_witnesses_cleanup
  12:        0x102c509dc - __rjem_je_witnesses_cleanup
  13:        0x102a66e84 - _main
  14:        0x102a50cf0 - _main
  15:        0x102a2e424 - _main
  16:        0x102a26708 - _main
  17:        0x102591038 - __mh_execute_header
  18:        0x10258d788 - __mh_execute_header
  19:        0x102592328 - _main
</code></pre>
<p>My <code>.ruff_cache</code> looks like this:</p>
<pre><code>$ tree .ruff_cache
.ruff_cache
├── CACHEDIR.TAG
└── content

2 directories, 1 file
$ cat .ruff_cache/CACHEDIR.TAG 
Signature: 8a477f597d28d172789f06886806bc55
</code></pre>
<p>Unfortunately I cannot provide the file that triggered this. This was run in a project without ruff configured, although it does have a <code>pyproject.toml</code>. This happens using the <code>--isolated</code> flag as well. Running on AArch64 macOS.</p>
<p>Here is the code snippet:
https://github.com/astral-sh/ruff/blob/fde5dbc9aa967b086347f87fc61511c8dfe7ad0e/crates/ruff_cli/src/commands/run.rs#L109-L112</p>
<p>Last modified in 17f1ecd56e376a75d66e01be47029f1b1b29c0aa.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Edward-Knight">@Edward-Knight</a> on 2023-06-20 22:47</div>
            <div class="timeline-body"><p>Looks like #5225 was created while I wrote this, seems to be the same issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-20 22:48</div>
            <div class="timeline-body"><p>Sorry, yeah, I&#x27;ll cut a fix for this tonight. I&#x27;m just trying to reproduce first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-20 23:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:38 UTC
    </footer>
</body>
</html>
