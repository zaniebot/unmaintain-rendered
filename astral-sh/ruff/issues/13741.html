<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restrict use of walrus operator - astral-sh/ruff #13741</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Restrict use of walrus operator</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13741">#13741</a>
        opened by <a href="https://github.com/KotlinIsland">@KotlinIsland</a>
        on 2024-10-14 01:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/KotlinIsland">@KotlinIsland</a></div>
            <div class="timeline-body"><p>i see code written like this:</p>
<pre><code class="language-py">a = (b := c)
</code></pre>
<p>who asked? (noone) it should be <code>a = b = c</code></p>
<p>i see code written like this:</p>
<pre><code class="language-py">foo(bar := baz()).bat()
bar.qux()
</code></pre>
<p>again, nobody has asked for this and it should just simply be an assignment on the line before. perhaps this could be argued to be stylistic, but that would only be true if you were arguing that bad style should be preferred</p>
<p>i'm not asking for walruses to be hunted to extinction, just the blatantly abusive cases be taken to account. occasionally, i see this:</p>
<pre><code class="language-py">if match1 := pattern1.match(data):
    result = match1.group(1)
elif match2 := pattern2.match(data):
    result = match2.group(2)
else:
    result = None
</code></pre>
<p>(i saw it in <a href="https://peps.python.org/pep-0572/">the pep</a>)</p>
<p>this is okay, i don't have any issue with this and it can stay</p>
<h1>tl;dr</h1>
<p>i'm not 100 certain what stays and what goes, but i think it would be roughly:</p>
<ul>
<li><p>if the walrus could be a normal assignment on the previous line, then it shouldn't be a walrus:</p>
<pre><code class="language-py">(a := 1)  # not ok

if bool(): ...
elif a := bool():  # ok
    print(a)
</code></pre>
</li>
<li><p>except, for <code>if</code> conditions:</p>
<pre><code class="language-py">if foo := bar():
    print(foo)
</code></pre>
<p>but even then, that looks pretty stupid to me, but on the border of being acceptable</p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2024-10-14 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dhruvmanila on 2024-10-14 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "(üéÅ) crack down on walrus abuse" to "(üéÅ) Restrict use of walrus operator" by @MichaReiser on 2024-10-14 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "(üéÅ) Restrict use of walrus operator" to "Restrict use of walrus operator" by @MichaReiser on 2024-10-14 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-14 12:34</div>
            <div class="timeline-body"><p>I'll merge this into https://github.com/astral-sh/ruff/issues/3464 and mention that an alternative is to restricting walrus usage only in specific places.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-10-14 12:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:16 UTC
    </footer>
</body>
</html>
