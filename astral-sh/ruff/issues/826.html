<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U007 Autofix on string type format - astral-sh/ruff #826</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>U007 Autofix on string type format</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/826">#826</a>
        opened by <a href="https://github.com/martinlehoux">@martinlehoux</a>
        on 2022-11-20 10:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/martinlehoux">@martinlehoux</a> on 2022-11-20 10:06</div>
            <div class="timeline-body"><p>I have an issue with U007 autofix, but I can't really say if it's a bug or not.</p>
<p>I have this piece of code (the <code>if TYPE_CHECKING:</code> is required for cyclic imports issue)</p>
<pre><code class="language-py">if TYPE_CHECKING:
    from app.models.model_a import ModelA
    from app.models.model_b import ModelB

ModelAOrB = Union[&quot;ModelA&quot;, &quot;ModelB&quot;]
</code></pre>
<p>and it gets fixed into</p>
<pre><code class="language-py">if TYPE_CHECKING:
    from app.models.model_a import ModelA
    from app.models.model_b import ModelB

ModelAOrB = &quot;ModelA&quot; | &quot;ModelB&quot;
</code></pre>
<p>which is not the same type as before</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/martinlehoux">@martinlehoux</a> on 2022-11-20 10:07</div>
            <div class="timeline-body"><p>That being said, maybe it's not the way to do types, and if it's just a workaround I need, I can simply ignore this check on this specific line</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-11-20 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-20 15:10</div>
            <div class="timeline-body"><p>Ohh interesting, yeah that's a bug. According to <a href="https://bugs.python.org/issue45857">this issue</a>, you're expected to instead do <code>ModelAOrB = &quot;ModelA | ModelB&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-20 20:57</div>
            <div class="timeline-body"><p>It looks like pyupgrade <a href="https://github.com/asottile/pyupgrade/blob/5b527acec11568ee095181a333adaaa1fec9fe27/pyupgrade/_plugins/typing_pep604.py#L147">skips those altogether</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-11-20 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2022-11-21 01:10</div>
            <div class="timeline-body"><p>If you want the whole string then whether it’s a string or a type alias becomes more ambiguous and behavior may vary by type checker. The recommendation there is to do,</p>
<p>ModelAorB: TypeAlias = “ModelA | ModelB”</p>
<p>This may require adding an import to TypeAlias with additional caveat the TypeAlias is only a thing since 3.10 or if you use typing extensions. It’s probably safest to just skip this case like pyupgrade unless you plan to add the correct import depending on python version/environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-21 02:10</div>
            <div class="timeline-body"><p>@hmc-cs-mdrissi - Yeah totally agree -- I think we need to just skip the upgrade in that case. (<code>&quot;ModelA | ModelB&quot;</code> is also much more confusing IMO than the same type expressed as a <code>Union</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/845.html">astral-sh/ruff#845</a> on 2022-11-21 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-21 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3508.html">astral-sh/ruff#3508</a> on 2023-03-14 20:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:07 UTC
    </footer>
</body>
</html>
