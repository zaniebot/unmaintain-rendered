<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLE0241 fix should be unsafe - astral-sh/ruff #18712</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLE0241 fix should be unsafe</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18712">#18712</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-06-16 14:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The fix for <a href="https://docs.astral.sh/ruff/rules/duplicate-bases/"><code>duplicate-bases</code> (PLE0241)</a> should be marked as unsafe because it changes behavior.</p>
<pre><code class="language-console">$ cat &gt;ple0241.py &lt;&lt;'# EOF'
class C(int, int): ...
# EOF

$ python ple0241.py 2&gt;&amp;1 | tail -n 1
TypeError: duplicate base class int

$ ruff --isolated check ple0241.py --select PLE0241 --fix
Found 1 error (1 fixed, 0 remaining).

$ python ple0241.py; echo $?
0
</code></pre>
<h3>Version</h3>
<p>ruff 0.11.13 (5faf72a4d 2025-06-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2025-06-16 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-06-16 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-06-16 17:09</div>
            <div class="timeline-body"><p>It's a little unfortunate in this case because I think a lot of the PLE rules relate to runtime errors - so presumably the whole point of turning them on and running <code>--fix</code> would be to fix them, no?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-16 17:14</div>
            <div class="timeline-body"><p>Yeah, I think this works as intended.  I don't think this behavior change is surprising to users. We may want to update our fix safety documentation to make it clear that semantic changes are allowed if they fix a hard error and the user intentions are clear from the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-06-16 18:06</div>
            <div class="timeline-body"><p>Clarifying the documentation for what counts as a safe fix would be a fine outcome for this issue. There are many other issues like this which I havenâ€™t been sure whether to report. For completeness, here is an example where the PLE0241 fix changes behavior in a non-erroring case.</p>
<pre><code class="language-console">$ cat &gt;ple0241_2.py &lt;&lt;'# EOF'
def SolitaryInt(bases):
    if SolitaryInt in bases[bases.index(SolitaryInt) + 1:]:
        return ()
    return (int,)
SolitaryInt.__mro_entries__ = SolitaryInt

class C1(SolitaryInt): ...
print(C1.__bases__)

class C2(SolitaryInt, SolitaryInt): ...
print(C2.__bases__)
# EOF

$ python ple0241_2.py
(&lt;class 'int'&gt;,)
(&lt;class 'object'&gt;,)

$ ruff --isolated check ple0241_2.py --select PLE0241 --fix
Found 1 error (1 fixed, 0 remaining).

$ python ple0241_2.py
(&lt;class 'int'&gt;,)
(&lt;class 'int'&gt;,)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-06-16 18:18</div>
            <div class="timeline-body"><p>On the other hand, is it safe to assume that <code>class C(X, X)</code> was meant to be <code>class C(X)</code>? Maybe it was meant to be <code>class C(X, X2)</code>. The original code crashes helpfully but the fixed code conceals the bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-17 05:46</div>
            <div class="timeline-body"><blockquote>
<p>On the other hand, is it safe to assume that class C(X, X) was meant to be class C(X)? Maybe it was meant to be class C(X, X2). The original code crashes helpfully but the fixed code conceals the bug.</p>
</blockquote>
<p>There's a very small chance that this was the case. My thinking here is that they either see the squiggle line in their IDE and can apply the fix or they run the code and it immediately crashes. If it was intended to be <code>X, X2</code>, then I suspect the code will still crash, just somewhere else because certain attributes and methods are now missing or your type checker will even tell you. Either way, I don't think we should optimize for the unlikely case that this was what the user intended.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:52:52 UTC
    </footer>
</body>
</html>
