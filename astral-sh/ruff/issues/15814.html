<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM401 triggers on dict like objects that aren't proper dictionaries - astral-sh/ruff #15814</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>SIM401 triggers on dict like objects that aren't proper dictionaries</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/15814">#15814</a>
        opened by <a href="https://github.com/jogo-openai">@jogo-openai</a>
        on 2025-01-29 18:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jogo-openai">@jogo-openai</a> on 2025-01-29 18:45</div>
            <div class="timeline-body"><h3>Description</h3>
<pre><code>$ ruff --version
ruff 0.9.3
</code></pre>
<pre><code class="language-python">class Foo:
    def __init__(self):
        self._dict = {}

    def __getitem__(self, key):
        return self._dict[key]

    def __setitem__(self, key, value):
        self._dict[key] = value

    def __iter__(self):
        return self._dict.__iter__()



foo = Foo()
foo['key'] = 'value'


if &quot;key&quot; in foo:
    value = foo[&quot;key&quot;]
else:
    value = None

print(value)


# print(foo.get('key', None))
# Triggers `AttributeError: 'Foo' object has no attribute 'get'`
</code></pre>
<p><code>ruff check --fix  --unsafe-fixes --diff --select=SIM401  foo.py</code></p>
<pre><code>--- foo.py
+++ foo.py
@@ -17,10 +17,7 @@
 foo['key'] = 'value'


-if &quot;key&quot; in foo:
-    value = foo[&quot;key&quot;]
-else:
-    value = None
+value = foo.get('key', None)

 print(value)


Would fix 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @dylwil3 on 2025-01-29 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-29 19:12</div>
            <div class="timeline-body"><p>I'm slightly in favor of just updating the documentation (which is part of #15584) for this unsafe fix. An alternative is to restrict to instances where our limited type inference can tell that we have an honest <code>dict</code> object, but that would be a significant restriction in applicability. That said, false positives are more annoying than false negatives for this sort of rule, so I could be convinced of the second route.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dylwil3 on 2025-01-29 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jogo-openai">@jogo-openai</a> on 2025-01-30 17:17</div>
            <div class="timeline-body"><p>I have a slight preference for removing false positives and making sure things are actually dicts. That being said,  just updating the documentation for this unsafe fix also seems good to me (I suspect this means llarge code bases would opt to not use this rule).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-03 08:41</div>
            <div class="timeline-body"><p>SIM401 was added in 2023 when we didn't had any type inference in Ruff, which is why we didn't restrict it to <em>known dicts</em>. We've since then started to restrict new rules to known dicts only (e.g. RUF051) and I think it makes sense to do the same here.</p>
<p>This is technically a breaking change for users that suppressed <code>SIM401</code> in cases where the value isn't a true dict but removing the false positives seems like a clear improvement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> removed by @MichaReiser on 2025-02-03 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2025-02-03 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @MichaReiser on 2025-02-03 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-02-03 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-02-03 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15995.html">astral-sh/ruff#15995</a> on 2025-02-06 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/junhsonjb">@junhsonjb</a> on 2025-02-06 15:05</div>
            <div class="timeline-body"><p>Hi! I'm super excited to be able to participate in this awesome project! I'm looking forward to working with you all towards a fix on this! Let me know if there's anything I need to change/fix/add/etc.</p>
<p>I really like ruff so thanks for all y'all do on this project and for the community! Cheers!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-07 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-07 08:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
