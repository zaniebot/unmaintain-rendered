<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigate how documentation tooling treats indents in docstrings - astral-sh/ruff #8445</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Investigate how documentation tooling treats indents in docstrings</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8445">#8445</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-11-02 10:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2023-11-02 10:37</div>
            <div class="timeline-body"><p>In the formatter, we currently normalize docstring indentation in the same way as black and cpython do. For example this is what cpython does, using <code>str.expandtabs</code> with a fixed width of 8 on python 3.13:</p>
<pre><code>&gt;&gt;&gt; exec('def f():\n\t&quot;&quot;&quot;Computes the value.\n\tx = 1\n\t\ty = x + 1\n\t&quot;&quot;&quot;')
&gt;&gt;&gt; f.__doc__
'Computes the value.\nx = 1\n        y = x + 1\n'
</code></pre>
<p>This becomes a problem when using the formatter with tab indentation, esp. with a tab width that is not 8, because we're either inconsistent with tab indentation or mismatch what cpython does. We should investigate how the various docs tools handle docstring indents. If the indent size or kind doesn't matter to them, we have more freedom in e.g. converting to tabs inside docstrings, otherwise we need to know which properties we need to preserve.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @charliermarsh on 2023-11-02 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8430.html">astral-sh/ruff#8430</a> on 2023-11-03 01:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mutantpenguin">@Mutantpenguin</a> on 2023-11-23 13:02</div>
            <div class="timeline-body"><p>Is there any way to suppress formatting of docstrings for now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-23 13:16</div>
            <div class="timeline-body"><p>You can add <code># fmt: skip</code> to the end:</p>
<pre><code class="language-python">def func():
    &quot;&quot;&quot;abc
def
    ghi
    &quot;&quot;&quot;  # fmt: skip
</code></pre>
<p>But there is no dedicated setting to enforce this globally (and, candidly, I think we're unlikely to add one).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mutantpenguin">@Mutantpenguin</a> on 2023-11-23 13:36</div>
            <div class="timeline-body"><p>Thanks, but frankly that's just not feasible for any bigger codebase.</p>
<p>I added some examples to #8430 to show what the current behaviour does to our codebase. That just looks wrong, regardless if E101 is activated or not.</p>
<p>If E101 would ignore multiline strings and the formatter would use the value of <code>indent-width</code> then this might be a valid compromise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-23 13:55</div>
            <div class="timeline-body"><p>Makes sense! I'm sure we'll make some improvements to the tab-in-docstring behavior (hence this issue). It just hasn't been prioritized yet. But I'd rather spend time fixing the root cause than investing in other workarounds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-11-27 03:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sciyoshi">@sciyoshi</a> on 2023-12-11 19:33</div>
            <div class="timeline-body"><p>@konstin I don't see the same behavior as you:</p>
<pre><code>Python 3.11.6 (main, Oct 23 2023, 22:48:54) [GCC 11.4.0] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; exec('def f():\n\t&quot;&quot;&quot;Computes the value.\n\tx = 1\n\t\ty = x + 1\n\t&quot;&quot;&quot;')
&gt;&gt;&gt; f.__doc__
'Computes the value.\n\tx = 1\n\t\ty = x + 1\n\t'
</code></pre>
<p>Sphinx seems to be configurable using the <code>tab-width</code> option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sciyoshi">@sciyoshi</a> on 2023-12-11 20:35</div>
            <div class="timeline-body"><p>(As pointed out on Discord, this behavior will be changing in Python 3.13.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-06 14:32</div>
            <div class="timeline-body"><ul>
<li><code>pydoc</code> uses cleandoc, which expands tabs to 8 spaces (<a href="https://github.com/python/cpython/blob/7974f714786c5d82ba8aeb4c262ad610ce1f0dcd/Lib/pydoc.py#L170-L184">source</a>)</li>
<li><code>pydoc</code> uses <code>getdoc</code> which uses <code>cleandoc</code> (<a href="https://github.com/pdoc3/pdoc/blob/f358893e4fcfd7f29857a7ff5491b606ff146d39/pdoc/__init__.py#L517">source</a>)</li>
<li><code>doxygen</code> has a <a href="https://www.doxygen.nl/manual/config.html#cfg_tab_size">tab size</a> option. But what I understand is that it is only used for code snippets (it uses a DSL for the documentation)</li>
<li><code>sphinx</code> has a <a href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html">tab width option</a></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-08 14:14</div>
            <div class="timeline-body"><p>I'm closing this issue. Most documentation tools use a version of <code>inspect.cleandoc</code>. I leave a more in depth reply in</p>
<p>https://github.com/astral-sh/ruff/issues/8430</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-08 14:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
