```yaml
number: 13294
title: PLE2510, PLE2512, PLE2513, PLE2514, and PLE2515 fixes add escape sequences to raw strings
type: issue
state: closed
author: dscorbett
labels:
  - bug
  - fixes
  - help wanted
assignees: []
created_at: 2024-09-09T19:20:59Z
updated_at: 2025-02-13T08:36:13Z
url: https://github.com/astral-sh/ruff/issues/13294
synced_at: 2026-01-12T15:54:52Z
```

# PLE2510, PLE2512, PLE2513, PLE2514, and PLE2515 fixes add escape sequences to raw strings

---

_@dscorbett_

The fixes for [PLE2510](https://docs.astral.sh/ruff/rules/invalid-character-backspace/), [PLE2512](https://docs.astral.sh/ruff/rules/invalid-character-sub/), [PLE2513](https://docs.astral.sh/ruff/rules/invalid-character-esc/), [PLE2514](https://docs.astral.sh/ruff/rules/invalid-character-nul/), and [PLE2515](https://docs.astral.sh/ruff/rules/invalid-character-zero-width-space/) add escape sequences to raw strings, which is an invalid change because raw strings don’t support escape sequences. The fixes should convert the raw strings to normal strings first.

```console
$ ruff --version
ruff 0.6.4
$ printf 'print(r"""\x08\x1a\x1b\x00\xe2\x80\x8b\n""")\n' >ple251.py
$ python3.10 ple251.py | xxd -p
081a1b0a
$ ruff check --isolated --select PLE251 ple251.py --fix
Found 5 errors (5 fixed, 0 remaining).
$ python3.10 ple251.py
\b\x1A\x1B\0\u200b


```

I’m using Python 3.10 for this example because literal null characters are syntax errors in later versions.

---

_Comment by @MichaReiser on 2024-09-10 18:02_

@dscorbett how do you find all these incorrect fixes. Very impressive and thanks for opening an issue!

---

_Comment by @MichaReiser on 2024-09-10 18:05_

Converting the raw string to a regular string might not be trivial. I think it would also be reasonable to remove the fix for raw strings.

---

_Label `bug` added by @MichaReiser on 2024-09-10 18:05_

---

_Label `fixes` added by @MichaReiser on 2024-09-10 18:05_

---

_Label `help wanted` added by @MichaReiser on 2024-09-10 18:05_

---

_Comment by @dscorbett on 2024-09-10 20:29_

I don’t know how hard it is to implement in Ruff, but theoretically, converting raw strings to regular strings should be straightforward. Each `\` becomes `\\`. Additionally, if it was doubling as a line continuation character in a non-triple-quoted string, the following newline becomes `\n`; or if it was escaping a quotation mark, the `'` or `"` becomes `\'` or `\"`. The rationale for avoiding these 5 characters (viz. it is confusing) applies to raw strings just as much as regular strings, so I think it is better to fix the fix for raw strings rather than removing it.

I find all these incorrect fixes by reading the rule descriptions and/or implementations and thinking of edge cases that might have been missed. Basically, it’s glass-box fuzz-testing done manually.

---

_Comment by @MichaReiser on 2024-09-10 20:32_

> I find all these incorrect fixes by reading the rule descriptions and/or implementations and thinking of edge cases that might have been missed. Basically, it’s glass-box fuzz-testing done manually.

Wow, that's a very impressive skill! 

---

_Comment by @PedroTurik on 2024-09-17 20:09_

I can work on this one. If I understand this correctly, I can start by adding the replacement logic [here](https://github.com/astral-sh/ruff/blob/dcfebaa4a86bdfd48e26614feb63fc7d2ab5d468/crates/ruff_linter/src/rules/pylint/rules/invalid_string_characters.rs#L187), right? I am a first time contributor

Also, I am probably missing something here, but where should I add replacement tests?

---

_Comment by @MichaReiser on 2024-09-18 06:59_

> I can work on this one. If I understand this correctly, I can start by adding the replacement logic [here](https://github.com/astral-sh/ruff/blob/dcfebaa4a86bdfd48e26614feb63fc7d2ab5d468/crates/ruff_linter/src/rules/pylint/rules/invalid_string_characters.rs#L187), right? I am a first time contributor

Awesome and welcome. Yes, this looks about right

> Also, I am probably missing something here, but where should I add replacement tests?

You can add them to this file

https://github.com/astral-sh/ruff/blob/f70e8a7524b255c20e3dc966141b6e80d9697958/crates/ruff_linter/resources/test/fixtures/pylint/invalid_characters.py#L1-L0

The tests are defined here

https://github.com/astral-sh/ruff/blob/52d27befe87d6572dbb268a24b26c8034032e39f/crates/ruff_linter/src/rules/pylint/mod.rs#L91-L102

---

_Assigned to @PedroTurik by @MichaReiser on 2024-09-18 06:59_

---

_Unassigned @PedroTurik by @PedroTurik on 2024-10-02 12:36_

---

_Closed by @MichaReiser on 2025-02-13 08:36_

---

_Closed by @MichaReiser on 2025-02-13 08:36_

---
