<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule SIM401 should only trigger for immutable literals and variables - astral-sh/ruff #8761</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule SIM401 should only trigger for immutable literals and variables</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8761">#8761</a>
        opened by <a href="https://github.com/ofek">@ofek</a>
        on 2023-11-18 23:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ofek">@ofek</a></div>
            <div class="timeline-body"><p>If I were to make this change then the dictionary would be created regardless of key membership. This would be particularly costly if the default was the result of a function call.</p>
<pre><code>src\hatch\template\files_default.py:117:13: SIM401 Use `plugin_config.get('project_urls', {'Documentation': 'https://github.com/unknown/{project_name_normalized}#readme', 'Issues': 'https://github.com/unknown/{project_name_normalized}/issues', 'Source': 'https://github.com/unknown/{project_name_normalized}'})` instead of an `if` block
</code></pre>
<pre><code class="language-python">project_urls = (
    plugin_config['project_urls']
    if 'project_urls' in plugin_config
    else {
        'Documentation': 'https://github.com/unknown/{project_name_normalized}#readme',
        'Issues': 'https://github.com/unknown/{project_name_normalized}/issues',
        'Source': 'https://github.com/unknown/{project_name_normalized}',
    }
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-18 23:43</div>
            <div class="timeline-body"><p>We don't trigger SIM401 if the default value contains an effectful expression (like a function call) -- you can verify it in the playground: https://play.ruff.rs/79791de1-e3ff-452e-b0a0-fab819b58e1c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2023-11-18 23:47</div>
            <div class="timeline-body"><p>Nice, I didn't test that one! Do you think creation of data structures should be avoided here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-11-20 20:48</div>
            <div class="timeline-body"><p>I don’t think so, creating a hierarchy of dicts, lists, etc. is cheap. I bet other parts of the code absolutely dominate benchmarks if you make some. That being said, performance issues should be measured, not assumed. So if you need things to be faster, you should measure first.</p>
<p>Regarding this rule, you don’t even need an <code>if</code> branch <em>if</em> you do things lazily if your values aren’t falsy:</p>
<pre><code class="language-py">foo = bar.get('key') or default_expression()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-20 21:18</div>
            <div class="timeline-body"><p>I think we already have a suitable heuristic here. If you have a real-world example with costly object creation we should avoid suggesting, please let us know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-11-20 21:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:04 UTC
    </footer>
</body>
</html>
