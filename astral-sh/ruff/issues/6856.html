<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add information to fuzzer README how correctly report problems found by this tool - astral-sh/ruff #6856</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add information to fuzzer README how correctly report problems found by this tool</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6856">#6856</a>
        opened by <a href="https://github.com/qarmin">@qarmin</a>
        on 2023-08-24 17:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qarmin">@qarmin</a></div>
            <div class="timeline-body"><p>After downloading fuzz corpus, I run command <code>cargo fuzz run -s none ruff_fix_validity -- -timeout=200</code> and file with invalid content was created:</p>
<pre><code>from twr import (_fter,
  noqa_l)
</code></pre>
<p>which panics with message(I see this in fuzzer output)</p>
<pre><code>thread '&lt;unnamed&gt;' panicked at 'attempt to subtract with overflow', /home/rafal/test/ruff/crates/ruff/src/noqa.rs:67:13
stack backtrace:
   0: rust_begin_unwind
             at /rustc/8ede3aae28fe6e4d52b38157d7bfe0d3bceef225/library/std/src/panicking.rs:593:5
   1: core::panicking::panic_fmt
             at /rustc/8ede3aae28fe6e4d52b38157d7bfe0d3bceef225/library/core/src/panicking.rs:67:14
   2: core::panicking::panic
             at /rustc/8ede3aae28fe6e4d52b38157d7bfe0d3bceef225/library/core/src/panicking.rs:117:5
   3: ruff::noqa::Directive::try_extract
             at /home/rafal/test/ruff/crates/ruff/src/noqa.rs:67:13
   4: ruff::noqa::rule_is_ignored
             at /home/rafal/test/ruff/crates/ruff/src/noqa.rs:217:11
   5: ruff::checkers::ast::Checker::rule_is_ignored
             at /home/rafal/test/ruff/crates/ruff/src/checkers/ast/mod.rs:163:9
   6: ruff::rules::pyflakes::rules::unused_import::unused_import
             at /home/rafal/test/ruff/crates/ruff/src/rules/pyflakes/rules/unused_import.rs:131:12
   7: ruff::checkers::ast::analyze::deferred_scopes::deferred_scopes
             at /home/rafal/test/ruff/crates/ruff/src/checkers/ast/analyze/deferred_scopes.rs:303:17
   8: ruff::checkers::ast::check_ast
             at /home/rafal/test/ruff/crates/ruff/src/checkers/ast/mod.rs:1999:5
   9: ruff::linter::check_path
             at /home/rafal/test/ruff/crates/ruff/src/linter.rs:154:40
  10: ruff::test::test_contents
             at /home/rafal/test/ruff/crates/ruff/src/test.rs:135:9
  11: ruff::test::test_snippet
             at /home/rafal/test/ruff/crates/ruff/src/test.rs:98:5
  12: ruff_fix_validity::do_fuzz
             at ./fuzz_targets/ruff_fix_validity.rs:22:13
  13: rust_fuzzer_test_input
             at /home/rafal/.cargo/git/checkouts/libfuzzer-14de4ab4c067ed36/c9c43f3/src/lib.rs:297:60
  14: libfuzzer_sys::test_input_wrap::{{closure}}
             at /home/rafal/.cargo/git/checkouts/libfuzzer-14de4ab4c067ed36/c9c43f3/src/lib.rs:61:9
  15: std::panicking::try::do_call
             at /rustc/8ede3aae28fe6e4d52b38157d7bfe0d3bceef225/library/std/src/panicking.rs:500:40
  16: std::panicking::try
             at /rustc/8ede3aae28fe6e4d52b38157d7bfe0d3bceef225/library/std/src/panicking.rs:464:19
  17: std::panic::catch_unwind
             at /rustc/8ede3aae28fe6e4d52b38157d7bfe0d3bceef225/library/std/src/panic.rs:142:14

</code></pre>
<p>I tried to reproduce crash by typing</p>
<pre><code>ruff fuzz/artifacts/ruff_fix_validity/crash-e85787f399673a --fix --select ALL,NURSERY
</code></pre>
<p>but I got completely normal messages without any crash</p>
<pre><code>artifacts/ruff_fix_validity/crash-e85787f399673a898d8551c308c065945de1c21c:1:1: D100 Missing docstring in public module
artifacts/ruff_fix_validity/crash-e85787f399673a898d8551c308c065945de1c21c:1:1: CPY001 Missing copyright notice at top of file
Found 4 errors (2 fixed, 2 remaining).
</code></pre>
<p>So instruction probably should contains info what to do to properly reproduce problem without fuzzer</p>
<p>https://github.com/astral-sh/ruff/blob/main/fuzz/README.md</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-24 19:46</div>
            <div class="timeline-body"><p>cc @addisoncrump</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2023-08-24 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fuzzer</span> added by @zanieb on 2023-08-24 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2023-08-25 04:48</div>
            <div class="timeline-body"><p>You can just specify the file after: <code>cargo fuzz run -s none ruff_fix_validity &lt;path/to/artifact&gt;</code></p>
<p>Currently we use the same test pass/fail as <code>ruff::test::test_snippet</code>, which noticeably has some things missing (e.g. we could not reproduce some of the recently opened fuzzer-found issues with <code>test_snippet</code>, only with the ruff frontend) and has some things that are not caught by the ruff frontend. We should probably try to unify the test pass/fail conditions with the frontend's. I'll put that in the same PR as the README addition.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2024-01-03 01:30</div>
            <div class="timeline-body"><p>Was this suitably addressed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-01-08 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 08:27</div>
            <div class="timeline-body"><p>Let's assume it is. We can re-open it if the question pops up again or create a new issue for it.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:07 UTC
    </footer>
</body>
</html>
