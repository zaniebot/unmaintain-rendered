<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F841 is triggered by unused variables in tuple unpacking (unlike flake8) - astral-sh/ruff #161</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F841 is triggered by unused variables in tuple unpacking (unlike flake8)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/161">#161</a>
        opened by <a href="https://github.com/Jackenmen">@Jackenmen</a>
        on 2022-09-12 00:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Jackenmen">@Jackenmen</a></div>
            <div class="timeline-body"><p>Unlike flake8, ruff adds F841 error when an unused variable is in tuple unpacking. Due to this being an incredibly common pattern, it would be good if it didn't work like this. In the code base I tested this on, it has caused over 50 errors and I don't think that replacing meaningful names with <code>_</code> improves the readability of the code.</p>
<p>There can be rare cases where this could indicate spots where code could be simplified, for example <code>dict.items()</code> usage when using only key or only value, <em>or</em> <code>enumerate()</code> usage when not actually using the index <em>but</em> that's at the cost of detecting a lot more of non-issues.
Maybe if #134 gets implemented to allow usage of something like <code>_var_name</code> to indicate an unused variable, it could still be helpful while not requiring the developer to lower the readability of the code (though still annoying them a bit by requiring them to rename their variable :smile:) <em>but</em> if so, I think it would be better suited for a separate check, rather than a check named after a rule in flake8 that doesn't act like this (I'm aware that ruff doesn't need to produce strictly equivalent output but this is a quite significant difference in behavior).</p>
<p>Here's a bunch of examples based on flake8's unit tests (comments say how flake8 behaves):</p>
<pre><code class="language-py">def f(tup):
    x, y = tup  # this does NOT trigger F841


def f():
    x, y = 1, 2  # this triggers F841 as it's just a simple assignment where unpacking isn't needed


def f():
    (x, y) = coords = 1, 2  # this does NOT trigger F841
    if x &gt; 1:
        print(coords)


def f():
    (x, y) = coords = 1, 2  # this triggers F841 on coords


def f():
    coords = (x, y) = 1, 2  # this triggers F841 on coords
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-12 00:30</div>
            <div class="timeline-body"><p>Not entirely the same but similar story for <code>for</code> loops:</p>
<pre><code class="language-py">def f():
    for i in range(10):  # this does NOT trigger F841 with flake8
        pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-12 00:30</div>
            <div class="timeline-body"><p>Interesting, thank you, I'll have to look at how they do this ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-12 00:38</div>
            <div class="timeline-body"><p>Hopefully my somewhat mass-creating of issues isn't discouraging. It's just that this project looks cool and I liked the idea of running flake8 in CI and ruff in pre-commit from #120 to see differences while this project is maturing. So I'm just putting ruff through the entire codebase and seeing what fails :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-12 00:43</div>
            <div class="timeline-body"><p>Not at all! I know ruff isn't ready for production yet so I appreciate anyone that's willing to try it out and file actionable issues (just like you've been doing).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-12 00:46</div>
            <div class="timeline-body"><p>Ah, ok, I see how they handle it. It shouldn't be too difficult to match their behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-09-12 00:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-12 01:50</div>
            <div class="timeline-body"><p>#163 fixes the for-loop and common unpacking cases. It doesn't handle repeated assignments like <code>(x, y) = coords = 1, 2</code> but I think that's rarer?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-12 01:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-12 02:56</div>
            <div class="timeline-body"><p>Works great! Now I'm down to 8 errors all caused by #150 so I might need to start trying ruff out on other code bases :smile:</p>
<blockquote>
<p>It doesn't handle repeated assignments like <code>(x, y) = coords = 1, 2</code> but I think that's rarer?</p>
</blockquote>
<p>Probably, yeah. I didn't see that in the code base I ran it on, I took that particular example from pyflakes's unit test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2022-09-17 01:46</div>
            <div class="timeline-body"><blockquote>
<p>It doesn't handle repeated assignments like <code>(x, y) = coords = 1, 2</code> but I think that's rarer?</p>
</blockquote>
<p>I hit this in the wild: https://github.com/zulip/zulip/blob/7efd59b6d7d7f8b98c69086fa7cda7a2e0179091/zerver/lib/markdown/<strong>init</strong>.py#L614</p>
<p>I agree itâ€™s probably rare, but hereâ€™s a fix: #217.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:17 UTC
    </footer>
</body>
</html>
