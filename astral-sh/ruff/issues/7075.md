```yaml
number: 7075
title: Rule RET503 cause autofix error
type: issue
state: closed
author: qarmin
labels:
  - bug
  - fuzzer
assignees: []
created_at: 2023-09-03T09:34:12Z
updated_at: 2023-10-01T08:31:53Z
url: https://github.com/astral-sh/ruff/issues/7075
synced_at: 2026-01-10T01:56:49Z
```

# Rule RET503 cause autofix error

---

_Issue opened by @qarmin on 2023-09-03 09:34_

Ruff 0.0.287 (latest changes from main branch)

```
ruff --fix *.py  --no-cache --select RET503
```

file content:
```
def generate_route(points, type):
        return {
        }
        for i, waypoint in enumerate(json['route_instructions']):
                (instruction, length, position, time, length_caption,
                 earth_direction, azimuth, turn_type, turn_angle) = waypoint
            waypoints.append({
                'additional': ugettext('%(direction)s for %(distance)s (taking approximately %(time)s)') % {
                    },
                'path': LineString(map(lambda ps: Point(*ps),
                        ))
            })
```

error:
```
error: Autofix introduced a syntax error. Reverting all changes.

This indicates a bug in `ruff`. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BAutofix%20error%5D

...quoting the contents of `9716902.py`, the rule codes RET503, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

9716902.py:7:13: RET503 Missing explicit `return` at the end of function able to return non-`None` value
Found 1 error.

```


[9716902.py.zip](https://github.com/astral-sh/ruff/files/12505630/9716902.py.zip)


---

_Label `bug` added by @charliermarsh on 2023-09-03 12:01_

---

_Label `fuzzer` added by @charliermarsh on 2023-09-03 12:01_

---

_Comment by @charliermarsh on 2023-09-03 22:31_

This is invalid source code. Need to decide how to handle.

---

_Comment by @qarmin on 2023-09-04 05:40_

How can I check if python file is invalid?
I'm using now such script
```
import ast
import sys

def parse_python_file(file_path):
    with open(file_path, 'r') as file:
        source_code = file.read()

    try:
        ast.parse(source_code)
        print(f"Syntax is correct in {file_path}")
    except SyntaxError as e:
        print(f"Syntax error in {file_path}: {e}")
        sys.exit(12)
        # raise Exception()

if len(sys.argv) != 2:
    print("Usage: python script.py <file_path>")
else:
    file_path = sys.argv[1]
    parse_python_file(file_path)
```

---

_Comment by @MichaReiser on 2023-09-04 06:31_

Your script should correctly detect that the code is invalid because either the tuple or `waypoints.append` is incorrectly indented. 

```
‚ùØ python -m ast /home/micha/.cache/.fr-52CTA2/9716902.py
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/usr/lib/python3.11/ast.py", line 1736, in <module>
    main()
  File "/usr/lib/python3.11/ast.py", line 1732, in main
    tree = parse(source, args.infile.name, args.mode, type_comments=args.no_type_comments)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/ast.py", line 50, in parse
    return compile(source, filename, mode, flags,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/micha/.cache/.fr-52CTA2/9716902.py", line 7
    waypoints.append({
                      ^
IndentationError: unindent does not match any outer indentation level
```


---

_Comment by @qarmin on 2023-10-01 08:31_

Only UP032 reports problem here(reported in other issue)

---

_Closed by @qarmin on 2023-10-01 08:31_

---
