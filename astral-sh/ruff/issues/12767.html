<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff `DOC502` preview false positive with `requests.Response.raise_for_status()` - astral-sh/ruff #12767</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff <code>DOC502</code> preview false positive with <code>requests.Response.raise_for_status()</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12767">#12767</a>
        opened by <a href="https://github.com/jamesbraza">@jamesbraza</a>
        on 2024-08-08 22:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2024-08-08 22:10</div>
            <div class="timeline-body"><p>With <code>ruff==0.5.7</code> and turning on the preview rule <a href="https://docs.astral.sh/ruff/rules/docstring-extraneous-exception/"><code>DOC502</code>/<code>docstring-extraneous-exception</code></a> (made as part of https://github.com/astral-sh/ruff/issues/12434), I think perhaps <code>requests.Response.raise_for_status()</code> is a special case where we should not alert DOC502 for <code>HTTPError</code>:</p>
<pre><code class="language-python">import requests

def run_get(url: str) -&gt; None:
    &quot;&quot;&quot;
    Run a GET request to the given URL.

    Raises:
        requests.exceptions.HTTPError: if the GET request fails.
    &quot;&quot;&quot;
    response: requests.Response = requests.get(url, timeout=30.0)
    response.raise_for_status()  # This can raise HTTPError

run_get(&quot;https://httpbin.org/status/500&quot;)
</code></pre>
<p>Ruff will print what is imo a false positive:</p>
<pre><code class="language-none">DOC502 Raised exception is not explicitly raised: `requests.exceptions.HTTPError`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-09 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @charliermarsh on 2024-08-09 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-08-09 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-09 01:39</div>
            <div class="timeline-body"><p>It's a slippery slope to start inferring exception types from arbitrary library code. Perhaps we can cover some of the common cases though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2024-08-09 15:51</div>
            <div class="timeline-body"><p>I completely agree it's a slippery slope haha. It may also be that functions/methods like <code>raise_for_status</code> go against the core of <code>DOC502</code>, so feel free to close this out</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-09 16:20</div>
            <div class="timeline-body"><blockquote>
<p>Perhaps we can cover some of the common cases though.</p>
</blockquote>
<p>We could also... make it configurable... e.g. you could have a setting where you could configure &quot;Oh, a call to this function always raises X exception&quot;, etc.</p>
<details>
<summary>(Obligatory meme)</summary>

<p><img src="https://github.com/user-attachments/assets/19605b15-7a8b-4b88-87ca-6ce4c882d053" alt="image" /></p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-09 16:22</div>
            <div class="timeline-body"><p>Adding configuration solves a different need. It allows you to make Ruff behave correctly for your user code or a library that isn't commonly used. I think it would be somewhat annoying if every requests users has to write the same configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-09 16:24</div>
            <div class="timeline-body"><blockquote>
<p>I think it would be somewhat annoying if every requests users has to write the same configuration.</p>
</blockquote>
<p>Maybe. We have to draw the line somewhere, though, and &quot;we will attempt to handle stdlib functions but not arbitrary third-party functions that raise exceptions&quot; feels like the logical line for us to draw for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RubenVanEldik">@RubenVanEldik</a> on 2024-09-02 16:09</div>
            <div class="timeline-body"><p>I also just ran into this error!</p>
<p>To play devil's advocate. I think this slope is not super slippery, since there aren't that many methods in popular libraries that have the sole purpose of raising an error (afaik).</p>
<p>I think expanding this scope to include the <code>raise_for_status</code> methods of the more popular request libraries (<code>requests</code>, <code>httpx</code>, <code>aiohttp</code>, and <code>urlllib3</code>) would solve this issue for &gt;90%, without putting the scope of this rule on an ever increasing path.</p>
<p>I would to be proven wrong. If there are many more methods in popular libraries that have the sole purpose of raising an exception, please let me know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2024-09-02 16:48</div>
            <div class="timeline-body"><blockquote>
<p>We could also... make it configurable... e.g. you could have a setting where you could configure &quot;Oh, a call to this function always raises X exception&quot;, etc.</p>
</blockquote>
<p>Would users necessarily need to encode the exception types as well? That seems a bit overkill. It could be a list of APIs that are known to return <code>typing.Never</code> (with no consideration for what the function does) that's eventually phased out by red-knot. If the function body were to contain a call to a <code>typing.Never</code> object, skip this rule. It could be a higher level configuration too with other checks using it (off the top of my head, dead code analysis).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RubenVanEldik">@RubenVanEldik</a> on 2024-09-02 17:02</div>
            <div class="timeline-body"><p>I think it would be useful, as <code>response.raise_for_status()</code> is basically shorthand for:</p>
<pre><code class="language-py">if not response.ok:
    raise requests.exceptions.HTTPError(...)
</code></pre>
<p>It's just a lazy way to raise an error, so I think it makes sense to include that exception in the docstring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2024-09-02 17:16</div>
            <div class="timeline-body"><p>Oh, so the return type for <code>requests.Response.raise_for_status</code> is <code>None</code>? That complicates things. My intuition is that it doesn't seem to be in the spirit of the diagnostic to permit thatâ€¦</p>
<p>Edit: I should have spotted that in original post, sorry.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:38 UTC
    </footer>
</body>
</html>
