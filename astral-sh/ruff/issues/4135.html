<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CI fails to create PR comment when output is too long - astral-sh/ruff #4135</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>CI fails to create PR comment when output is too long</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4135">#4135</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-04-27 17:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>Example: https://github.com/charliermarsh/ruff/actions/runs/4820701572/jobs/8585562172</p>
<p>As per <a href="https://docs.github.com/en/actions/using-jobs/defining-outputs-for-jobs">GitHub documentation</a>, this might be occurring because:</p>
<blockquote>
<p>Outputs are Unicode strings, and can be a maximum of 1 MB. The total of all outputs in a workflow run can be a maximum of 50 MB.</p>
</blockquote>
<p>If so, the solution would be to <a href="https://github.com/thollander/actions-comment-pull-request#comment-a-file-content">comment using a <code>filePath</code></a> instead of passing it to the <code>message</code> key.</p>
<p>But then comes the limitation of the comment itself which is 65536 characters (tested it out on my own repo):</p>
<pre><code>Error: Validation Failed: {&quot;resource&quot;:&quot;IssueComment&quot;,&quot;code&quot;:&quot;custom&quot;,&quot;field&quot;:&quot;body&quot;,&quot;message&quot;:&quot;body is too long (maximum is 65536 characters)&quot;}
</code></pre>
<p>Now, the solution would be:</p>
<ol>
<li>Move the output to a file (could use <code>GITHUB_WORKSPACE</code>)</li>
<li>Use the <code>filePath</code> to post the content of PR checks</li>
<li>Truncate the content to limit it to &lt; 65536 characters and add a link to the summary page</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-04-27 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-14 19:47</div>
            <div class="timeline-body"><p>This now gets truncated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-14 19:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:47:04 UTC
    </footer>
</body>
</html>
