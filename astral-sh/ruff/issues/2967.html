<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Panic] &quot;`__future__` imports should be marked as used&quot; - astral-sh/ruff #2967</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Panic] &quot;`__future__` imports should be marked as used&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2967">#2967</a>
        opened by <a href="https://github.com/manueljacob">@manueljacob</a>
        on 2023-02-16 19:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/manueljacob">@manueljacob</a> on 2023-02-16 19:22</div>
            <div class="timeline-body"><p>The following code was reduced from some output of pytype:</p>
<pre><code class="language-python">import __future__
annotations: __future__._Feature
</code></pre>
<p>It crashes:</p>
<pre><code>thread 'main' panicked at 'internal error: entered unreachable code: `__future__` imports should be marked as used', crates/ruff/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs:189:35
</code></pre>
<p>I tested it with ruff 0.0.247.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 19:36</div>
            <div class="timeline-body"><p>Oh interesting! Will fix. What is this code doing? Trying to parse it myself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-02-16 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 19:37</div>
            <div class="timeline-body"><p>Oh, or is this not <em>Python</em> code, but code <em>generated</em> by Pytype per #2967?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/manueljacob">@manueljacob</a> on 2023-02-16 20:22</div>
            <div class="timeline-body"><p>Yes, the code is generated by pytype and put in the <code>.pytype</code> directory. With #2966, this is not a problem for me anymore, but I think it should still not panic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 20:23</div>
            <div class="timeline-body"><p>Hah, that's true :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 20:23</div>
            <div class="timeline-body"><p>I can fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 20:28</div>
            <div class="timeline-body"><p>Do you mind posting the complete file, command, and pyproject.toml? Somehow not reproducing with <code>ruff --isolated --select ALL</code> on that snippet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/manueljacob">@manueljacob</a> on 2023-02-16 20:36</div>
            <div class="timeline-body"><p>File:</p>
<pre><code class="language-python">import __future__
annotations: __future__._Feature
</code></pre>
<p>Ruff command: <code>ruff utils.pyi --isolated --select TCH001</code>
But <code>ruff --isolated --select ALL utils.pyi</code> panics as well.</p>
<p>No <code>pyproject.toml</code>.</p>
<p>I build ruff from the <code>main</code> branch in the meantime, to check if I can reproduce it with that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/manueljacob">@manueljacob</a> on 2023-02-16 21:04</div>
            <div class="timeline-body"><p>It fails for me on the main branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 22:44</div>
            <div class="timeline-body"><p>Ah it depends on the <code>.pyi</code> suffix (since that enables deferred annotation handling).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2974.html">astral-sh/ruff#2974</a> on 2023-02-16 22:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-16 22:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:05 UTC
    </footer>
</body>
</html>
