<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D1XX rules don't work when functions are imported into a public file - astral-sh/ruff #7154</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>D1XX rules don't work when functions are imported into a public file</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7154">#7154</a>
        opened by <a href="https://github.com/AKuederle">@AKuederle</a>
        on 2023-09-05 13:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AKuederle">@AKuederle</a> on 2023-09-05 13:15</div>
            <div class="timeline-body"><p>The D1XX rules check if docstrings for public functions/classes exist. However, I think they are missing a common pattern of defining &quot;public objects&quot;. Namely, defining them in &quot;private&quot; (aka leading underscore) files and then importing them into a top-level <code>__init__</code>.</p>
<pre><code class="language-python"># mypackage/__init__.py
from mypackage._methods implement my_function

__all__ = [&quot;my_function&quot;]
</code></pre>
<pre><code class="language-python"># mypackage/_methods.py

def my_function():
   pass
</code></pre>
<p>In this case, I would expect ruff to identify <code>my_function</code> as a public function, as it is imported in a public module (and even added to <code>__all__</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-05 20:45</div>
            <div class="timeline-body"><p>Thanks for reporting this common pattern that ruff doesn't support today (to my knowledge)</p>
<p>I'm unfamiliar with the implementation but I assume that this isn't working as expected because Ruff only supports single-file analysis today and your example requires aggregating knowing about the import and <code>__all__</code> export of <code>my_function</code> in the <code>__init__.py</code> file while lining the <code>_methods.py</code> file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> added by @MichaReiser on 2023-09-05 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AKuederle">@AKuederle</a> on 2023-09-06 06:07</div>
            <div class="timeline-body"><p>Thus makes sense! And I understand that this would be a considerable effort
then to fix this...</p>
<p>I think a potential workaround would be to make it configurable, if files
with a leading underscore should lead to all objects inside to be
considered non-public. For a project structure like I outlined above,
having ruff treat the <code>_methods</code> file &quot;just&quot; like a normal file would make
these rules at least usable for these types of setups</p>
<p>On Tue, 5 Sept 2023, 22:45 Micha Reiser, <em><strong>@</strong></em>.***&gt; wrote:</p>
<blockquote>
<p>I'm unfamiliar with the implementation but I assume that this isn't
working as expected because Ruff only supports single-file analysis today
and your example requires aggregating knowing about the import and <strong>all</strong>
export of my_function in the <strong>init</strong>.py file while lining the _methods.py
file.</p>
<p>â€”
Reply to this email directly, view it on GitHub
<a href="https://github.com/astral-sh/ruff/issues/7154#issuecomment-1707287776">https://github.com/astral-sh/ruff/issues/7154#issuecomment-1707287776</a>,
or unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/ACSHBOZGJWSFW2MGJXW4EYTXY6FOBANCNFSM6AAAAAA4LY3NGQ">https://github.com/notifications/unsubscribe-auth/ACSHBOZGJWSFW2MGJXW4EYTXY6FOBANCNFSM6AAAAAA4LY3NGQ</a>
.
You are receiving this because you authored the thread.Message ID:
<em><strong>@</strong></em>.***&gt;</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9561.html">astral-sh/ruff#9561</a> on 2024-03-21 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KRunchPL">@KRunchPL</a> on 2024-05-12 16:22</div>
            <div class="timeline-body"><p>I fully agree with the previous comment. I follow this pattern in many projects.</p>
<p>Moreover, the configuration to disable treating <code>_files</code> as private (and disabling D1XX rules in them) would be not only a workaround. It is not uncommon in bigger projects, requiring docstring for &quot;internally public&quot; entities (not starting with <code>_</code>, but being in <code>_</code> module or package).</p>
<p>With this flag it would be still pretty easy to disable those rules for specific file(s), while without the support there is currently no way to enable it when needed. Thus it would make the tool much more flexible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @MichaReiser on 2024-10-24 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> removed by @MichaReiser on 2024-10-24 14:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:09 UTC
    </footer>
</body>
</html>
