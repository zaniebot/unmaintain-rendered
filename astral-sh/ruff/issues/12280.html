<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odd formatting choice for long conditions with comments in list/dict comprehensions - astral-sh/ruff #12280</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Odd formatting choice for long conditions with comments in list/dict comprehensions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12280">#12280</a>
        opened by <a href="https://github.com/goodspark">@goodspark</a>
        on 2024-07-10 17:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/goodspark">@goodspark</a> on 2024-07-10 17:56</div>
            <div class="timeline-body"><p>Previously used search terms: format for loop if comment</p>
<p>Code:</p>
<pre><code class="language-py">x = [1, 2, 3]
y = [
    a
    for a in x 
    if (
        # asdasd
        &quot;askldaklsdnmklasmdlkasmdlkasmdlkasmdasd&quot; != &quot;as,mdnaskldmlkasdmlaksdmlkasdlkasdm&quot;
        and &quot;zxcm,.nzxclm,zxnckmnzxckmnzxczxc&quot; != &quot;zxcasdasdlmnasdlknaslkdnmlaskdm&quot;
    )
]
</code></pre>
<p>Comparison of Black (previous) vs Ruff (new) outputs:</p>
<pre><code class="language-diff"> y = [
     a
     for a in x
-    if (
+    if
+    (
         # asdasd
         &quot;askldaklsdnmklasmdlkasmdlkasmdlkasmdasd&quot;
         != &quot;as,mdnaskldmlkasdmlaksdmlkasdlkasdm&quot;
</code></pre>
<details>
<summary>Ruff's output</summary>

<pre><code class="language-py">x = [1, 2, 3]
y = [
    a
    for a in x
    if
    (
        # asdasd
        &quot;askldaklsdnmklasmdlkasmdlkasmdlkasmdasd&quot;
        != &quot;as,mdnaskldmlkasdmlaksdmlkasdlkasdm&quot;
        and &quot;zxcm,.nzxclm,zxnckmnzxckmnzxczxc&quot; != &quot;zxcasdasdlmnasdlknaslkdnmlaskdm&quot;
    )
]
</code></pre>
</details>

<details>
<summary>Black's output</summary>

<pre><code class="language-py">x = [1, 2, 3]
y = [
    a
    for a in x
    if (
        # asdasd
        &quot;askldaklsdnmklasmdlkasmdlkasmdlkasmdasd&quot;
        != &quot;as,mdnaskldmlkasdmlaksdmlkasdlkasdm&quot;
        and &quot;zxcm,.nzxclm,zxnckmnzxckmnzxczxc&quot; != &quot;zxcasdasdlmnasdlknaslkdnmlaskdm&quot;
    )
]
</code></pre>
</details>

<p>If I move the comment out of the inner parentheses of the loop condition, the outputs match:</p>
<pre><code class="language-py">    for a in x 
    # asdasd
    if (
</code></pre>
<p>Command: <code>ruff format</code></p>
<p>Ruff settings: None for formatting, but <code>target-python</code> is given at the project level, if that matters.</p>
<pre><code class="language-toml">[project]
target-python = &quot;==3.10&quot;
</code></pre>
<p>Python version: 3.10
Ruff version: 0.5.0
Black version: 24.3.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2024-07-10 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12282.html">astral-sh/ruff#12282</a> on 2024-07-10 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-07-11 06:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-07-11 20:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
