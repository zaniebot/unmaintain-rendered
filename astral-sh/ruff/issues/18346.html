<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C4 docs incorrectly label known issue - astral-sh/ruff #18346</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>C4 docs incorrectly label known issue</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18346">#18346</a>
        opened by <a href="https://github.com/AntiSol">@AntiSol</a>
        on 2025-05-28 02:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AntiSol">@AntiSol</a> on 2025-05-28 02:37</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hello,</p>
<p>After some discussion with colleagues, we've come to the conclusion that the &quot;known problems&quot; section on ruff's docs for <a href="https://docs.astral.sh/ruff/rules/unnecessary-comprehension/">unnecessary comprehension</a> are incorrect.</p>
<p>The &quot;known problems&quot; section describes a &quot;false positive&quot;, but the issue described isn't actually a false positive - the <em>warning</em> about the unnecessary comprehension in the provided example (and also in every case we could come up with) is correct - the comprehension <em>is</em> unnecessary. The issue is that ruff's suggested fix is incorrect, not that ruff will give incorrect warnings (as implied by &quot;false positives&quot;).  A casual reader will see &quot;false positive&quot; and will tend to get the wrong impression.</p>
<p>The suggestion here would be to remove the term &quot;false positive&quot; from the docs, replacing it with something along the lines of &quot;incorrect fix&quot;.</p>
<p>Unless there's a better example where it actually does give a false positive?</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-28 07:50</div>
            <div class="timeline-body"><p>Thanks for raising this. We made this change due to https://github.com/astral-sh/ruff/issues/13625 and @zanieb explicitly stated that this isn't a fix safety issue. I'm interested hearing their reasoning for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2025-05-28 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2025-05-28 08:55</div>
            <div class="timeline-body"><p>Thanks for getting back to me and for linking to the other issue. I see <a href="https://github.com/astral-sh/ruff/issues/13625#issuecomment-2393959531">@zanieb's response</a></p>
<p>I am also curious as to the reasoning behind the &quot;not a fix safety problem&quot; statement.</p>
<p>As far as I can tell, if you've got unsafe fixes turned off, the output from ruff will be correct in all cases. The problem is with the suggested fix.</p>
<p>I agree that you'd need to know the type of <code>d1</code> in the example to be able to know what the correct fix looks like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-02 16:53</div>
            <div class="timeline-body"><p>How would you write this transformation without the comprehension?</p>
<pre><code class="language-python">d1 = {(1, 2): 3, (3, 4): 5}
d2 = {x: y for x, y in d1}
</code></pre>
<p>Perhaps as:</p>
<pre><code class="language-python">d2 = dict(d1.keys())
</code></pre>
<p>You could argue that the comprehension is unnecessary because there's a simpler invocation, but I think it's actually clearer written as a comprehension unlike the <code>dict(d1)</code> case where you're just creating a copy and it's misleading to use a comprehension.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2025-06-03 09:23</div>
            <div class="timeline-body"><p>Yeah, but the fact that you personally prefer no list comprehension in these circumstances doesn't make it a false positive - the list comprehension <em>is</em> unnecessary. The warning is correct. Whether it should be replaced with <code>dict()</code> or not is a matter of opinion, but that discussion has no bearing on this being incorrectly labelled as a false positive. The warning is not incorrect - you just don't like what it wants you to do instead - welcome to every day of my life! ðŸ˜‰</p>
<p>If you prefer the list comprehension, then cool (I think you're probably right, it is clearer). But to handle that you'd probably want to have either an option to this rule (<code>allow_comprehensions_zanieb_likes</code> or <code>allow_comprehensions_that_are_easier_to_grok</code>, maybe), or a separate rule to encompass your preferences. However making that work would require knowing the type of d1, which you can't always know.</p>
<p>And, again, none of this has any bearing on whether it's a false positive to say that the list comprehension is unnecessary. it <em>is</em> unnecessary, and therefore not a false positive.</p>
<p>The wording should be changed. &quot;you might disagree with this rule's suggestions&quot; is more correct than &quot;false positive&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-03 13:35</div>
            <div class="timeline-body"><p>I'm sorry, but I disagree.</p>
<p>Lint rules are <em>often</em> subjective, and it's our role as a maintenance team to consolidate community feedback and expert opinions to determine what best practices to enforce.</p>
<p>The key here is that if the comprehension increases clarity, it is necessary. If it decreases clarity, as it does in the normal case, it is unnecessary. There are all sorts of cases where you could rewrite a comprehension using different syntax, that doesn't make all comprehensions &quot;unnecessary&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2025-06-03 15:53</div>
            <div class="timeline-body"><p>It's not a matter of opinion whether the comprehension is unnecessary. The rule is not called &quot;zanieb thinks this would be clearer without a list comprehension&quot;.</p>
<p>You people dogmatically insist on enforcing pep8 rules in other cases, refusing to provide an option to disable them, where they destroy information and make code less clear.</p>
<p>But, fine, whatever, I get the message: don't bother filing ruff issues and trying to improve astral's toys.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AntiSol on 2025-06-03 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2025-06-03 15:54</div>
            <div class="timeline-body"><p>(not &quot;completed&quot;, btw, &quot;astral aren't interested in being consistent&quot;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-03 16:17</div>
            <div class="timeline-body"><blockquote>
<p>You people dogmatically insist on enforcing pep8 rules in other cases, refusing to provide an option to disable them, where they destroy information and make code less clear.</p>
</blockquote>
<p>I don't know what you mean by this. We don't enable all the PEP 8 rules by default, but you can always disable rules you disagree with.</p>
<blockquote>
<p>But, fine, whatever, I get the message: don't bother filing ruff issues and trying to improve astral's tools.</p>
</blockquote>
<p>Candidly, this seems like a really unfair reaction to raising an issue and getting multiple considered responses from people on the team. Open source is a huge effort, and it's draining and demoralizing for maintainers to invest time in good-faith discussions only to be repaid by snarky comments. I hope you'll reconsider your attitude in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2025-06-03 16:21</div>
            <div class="timeline-body"><blockquote>
<p>you can always disable rules you disagree with.</p>
</blockquote>
<p>Oh good, so I guess you'll be able to tell me how to stop ruff format enforcing W293 then?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:17 UTC
    </footer>
</body>
</html>
