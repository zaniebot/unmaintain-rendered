<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support for `flake8-annotations-coverage` - astral-sh/ruff #3210</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support for `flake8-annotations-coverage`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/3210">#3210</a>
        opened by <a href="https://github.com/szymonmaszke">@szymonmaszke</a>
        on 2023-02-24 18:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/szymonmaszke">@szymonmaszke</a> on 2023-02-24 18:14</div>
            <div class="timeline-body"><p>Hey, we are currently using <a href="https://github.com/best-doctor/flake8-annotations-coverage"><code>flake8-annotations-coverage</code></a> in our FOSS <a href="https://github.com/inovintell/py-template"><code>py-template</code></a> project, but we would like to move to <code>ruff</code> exclusively from <code>flake8</code> + <code>flakeheaven</code>.</p>
<p>This plugin basically allows you to set minimum percentage coverage for annotations and raise if it is not fulfilled.</p>
<h3>Error Codes</h3>
<ul>
<li>TAE001 - Too few type annotations in file</li>
</ul>
<p>Is support for <a href="https://github.com/best-doctor/flake8-annotations-coverage"><code>flake8-annotations-coverage</code></a> planned/would be considered? Unfortunately we cannot pick up this issue ourselves at the current time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../inovintell/py-template/issues/142.html">inovintell/py-template#142</a> on 2023-02-24 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by @charliermarsh on 2023-02-24 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matthewlloyd">@matthewlloyd</a> on 2023-02-24 21:47</div>
            <div class="timeline-body"><p>I am a new contributor and considering this since it's something I would use in my own repos. However after some thought, I realized I would just set the % to 100%. What's the argument for setting a lower minimum %, rather than just enforcing 100% and adding noqa (or annotations) where needed?</p>
<p>Since Ruff already has all the flake8-annotations rules prefixed with ANN, would it be better for your FOSS project to enable them all and just add more type annotations or noqa to fix any warnings?</p>
<p>I guess what I'm asking is, in what circumstances is it OK for a module to have 80% coverage, and why would that be OK when 70% coverage is not? Just trying to understand the motivation behind the original flake8 plugin here. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szymonmaszke">@szymonmaszke</a> on 2023-02-25 00:41</div>
            <div class="timeline-body"><p>Thank you for quick reply!</p>
<blockquote>
<p>However after some thought, I realized I would just set the % to 100%. What's the argument for setting a lower minimum %, rather than just enforcing 100% and adding noqa (or annotations) where needed?</p>
</blockquote>
<p>We are indeed using it like that, although for migrating existing codebases such a threshold to reach might be beneficial (leaving aside reasoning for such a decision).</p>
<blockquote>
<p>Since Ruff already has all the flake8-annotations rules prefixed with ANN, would it be better for your FOSS project to enable them all and just add more type annotations or noqa to fix any warnings?</p>
</blockquote>
<p>Yes, indeed, seems more reasonable to place it under <code>ANN</code></p>
<p>Regarding the last question, I think I have already answered, I see no sensible reason for new repos. Another reason might be to leave aside <code>typing.Any</code> as I don't find it too beneficial tbh, but it's mere speculation on my end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-02-25 06:34</div>
            <div class="timeline-body"><p>If I had to type an old codebase, I would use <code>--add-noqa</code> with <code>--select=ANN</code> to add <code>noqa</code> for <code>ANN</code> errors.
Then you can search for files with the most <code>noqa</code>to have an indicator of the files that need it the most.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szymonmaszke">@szymonmaszke</a> on 2023-02-26 22:56</div>
            <div class="timeline-body"><blockquote>
<p>If I had to type an old codebase, I would use <code>--add-noqa</code> with <code>--select=ANN</code> to add <code>noqa</code> for <code>ANN</code> errors.</p>
<p>Then you can search for files with the most <code>noqa</code>to have an indicator of the files that need it the most.</p>
</blockquote>
<p>Also an option, we would honestly be fine with anything showing us missing annotations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stefanitsky">@stefanitsky</a> on 2023-04-05 05:00</div>
            <div class="timeline-body"><p>I'm not sure if this rule can be optimally implemented in ruff, due to the fact, that the rule checks the entire file for annotations, but i don't see in the code, where this could be added.</p>
<p>@MichaReiser @charliermarsh please, could any of you help us understand, where it is possible to implement it?</p>
<p>If done in a simple way, i think, we just can check for annotations for each function separately and implement such a rule within <code>ANN</code> rules, as @matthewlloyd suggested. I can implement that, doesn't look difficult.</p>
<p>What do you all think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szymonmaszke">@szymonmaszke</a> on 2023-04-05 14:12</div>
            <div class="timeline-body"><p>@stefanitsky agreed, it would be best as a per function/method check and telling more.</p>
<p>Something to keep in mind - possibility to exclude <code>self</code> and <code>cls</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
