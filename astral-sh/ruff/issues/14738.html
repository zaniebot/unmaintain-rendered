<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extend `RUF055` with more patterns - astral-sh/ruff #14738</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Extend `RUF055` with more patterns</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/14738">#14738</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-12-02 17:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-02 17:28</div>
            <div class="timeline-body"><blockquote>
<p>Here are some slightly more complex examples not supported by the initial implementation in #14659:</p>
<pre><code class="language-py">re.search(r&quot;abc&quot;, s) is None       # ⇒ &quot;abc&quot; not in s
re.search(r&quot;abc&quot;, s) is not None   # ⇒ &quot;abc&quot; in s
re.sub(r&quot;abc&quot;, &quot;&quot;, s, count=1)     # ⇒ s.replace(&quot;abc&quot;, &quot;&quot;, count=1)
re.split(r&quot;abc&quot;, s, maxsplit=1)    # ⇒ s.split(&quot;abc&quot;, maxsplit=1)
re.search(r&quot;^abc&quot;, s)              # ⇒ s.startswith(&quot;abc&quot;)
re.search(r&quot;abc$&quot;, s)              # ⇒ s.endswith(&quot;abc&quot;)
re.search(r&quot;^abc$&quot;, s)             # ⇒ s == &quot;abc&quot;
re.match(r&quot;abc|xyz|123&quot;, s)        # ⇒ s.startswith((&quot;abc&quot;, &quot;xyz&quot;, &quot;123&quot;))
re.search(r&quot;^abc|^xyz|^123&quot;, s)
re.search(r&quot;^(?:abc|xyz|123)&quot;, s)
re.search(r&quot;abc$|xyz$|123$&quot;, s)    # ⇒ s.endswith((&quot;abc&quot;, &quot;xyz&quot;, &quot;123&quot;))
re.search(r&quot;(?:abc|xyz|123)$&quot;, s)
re.fullmatch(r&quot;abc|xyz|123&quot;, s)    # ⇒ s in {&quot;abc&quot;, &quot;xyz&quot;, &quot;123&quot;}
re.search(r&quot;^(?:abc|xyz|123)$&quot;, s)
re.match(r&quot;[abc]&quot;, s)              # ⇒ s.startswith((&quot;a&quot;, &quot;b&quot;, &quot;c&quot;))
re.search(r&quot;[abc]$&quot;, s)            # ⇒ s.endswith((&quot;a&quot;, &quot;b&quot;, &quot;c&quot;))
re.fullmatch(r&quot;[abc]&quot;, s)          # ⇒ s in {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}
# Handle the ignore case flag
re.match(r&quot;AbC&quot;, s, re.I)          # ⇒ s.casefold().startswith(&quot;abc&quot;)
re.search(r&quot;AbC&quot;, s, re.I)         # ⇒ &quot;abc&quot; in s.casefold()
re.fullmatch(r&quot;AbC&quot;, s, re.I)      # ⇒ &quot;abc&quot; == s.casefold()
# Handle any escaped special characters
re.fullmatch(r&quot;&quot;&quot;!&quot;\#\$%\&amp;'\(\)\*\+,\-\./:;&lt;=&gt;\?@\[\\\]\^_`\{\|\}\~&quot;&quot;&quot;, s) # ⇒ s == &quot;&quot;&quot;!&quot;#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~&quot;&quot;&quot;
</code></pre>
<p>Edit: The <code>.endswith()</code> examples would be unsafe, per https://github.com/astral-sh/ruff/issues/12283#issuecomment-2509831070.</p>
</blockquote>
<p><em>Originally posted by @tdulcet in <a href="https://github.com/astral-sh/ruff/issues/12283#issuecomment-2509753927">#12283</a></em></p>
<blockquote>
<p>Great to see that the rule was implemented!</p>
<blockquote>
<p><code>re.search(r&quot;abc$&quot;, s)              # ⇒ s.endswith(&quot;abc&quot;)</code></p>
</blockquote>
<p>This is not equivalent:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; s = &quot;abc\n&quot;
&gt;&gt;&gt; re.search(r&quot;abc$&quot;, s)
&lt;re.Match object; span=(0, 3), match='abc'&gt;
&gt;&gt;&gt; s.endswith(&quot;abc&quot;)
False
</code></pre>
<p>I'm also not sure about the <code>re.I</code> ones; are those transformations correct in the presence of exotic casing conventions like in Turkish?</p>
<p>And I'm not sure the replacement is worth it in cases where the replacement is a little more complex (e.g., passing a tuple to startswith). The goal of the rule should be to make code simpler; with those transformations, that may not be the case any more.</p>
</blockquote>
<p><em>Originally posted by @JelleZijlstra in <a href="https://github.com/astral-sh/ruff/issues/12283#issuecomment-2509831070">#12283</a></em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-12-02 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdulcet">@tdulcet</a> on 2024-12-16 21:14</div>
            <div class="timeline-body"><p>Per #15017, here are some additional examples:</p>
<pre><code class="language-py">re.search(r&quot;\Aabc&quot;, s)              # ⇒ s.startswith(&quot;abc&quot;)
re.search(r&quot;abc\Z&quot;, s)              # ⇒ s.endswith(&quot;abc&quot;)
re.search(r&quot;\Aabc\Z&quot;, s)            # ⇒ s == &quot;abc&quot;
re.search(r&quot;\Aabc|\Axyz|\A123&quot;, s)  # ⇒ s.startswith((&quot;abc&quot;, &quot;xyz&quot;, &quot;123&quot;))
re.search(r&quot;\A(?:abc|xyz|123)&quot;, s)
re.search(r&quot;abc\Z|xyz\Z|123\Z&quot;, s)  # ⇒ s.endswith((&quot;abc&quot;, &quot;xyz&quot;, &quot;123&quot;))
re.search(r&quot;(?:abc|xyz|123)\Z&quot;, s)
re.search(r&quot;\A(?:abc|xyz|123)\Z&quot;, s)# ⇒ s in {&quot;abc&quot;, &quot;xyz&quot;, &quot;123&quot;}
</code></pre>
<p>Unlike those previous examples using <code>$</code>, these should all be safe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Garrett-R">@Garrett-R</a> on 2025-01-26 08:08</div>
            <div class="timeline-body"><p>Just a heads-up, I'm working on the 2 cases involving the parent expression:</p>
<pre><code class="language-python">re.search(r&quot;abc&quot;, s) is None       # ⇒ &quot;abc&quot; not in s
re.search(r&quot;abc&quot;, s) is not None   # ⇒ &quot;abc&quot; in s
</code></pre>
<p>as well as these 2 related case, not yet reported:</p>
<pre><code class="language-python">re.match(r&quot;abc&quot;, s) is None       # ⇒ not s.startswith(&quot;abc&quot;)  
re.match(r&quot;abc&quot;, s) is not None   # ⇒ s.startswith(&quot;abc&quot;)
</code></pre>
<p>(I'll look at <code>re.fullmatch</code> too)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15764.html">astral-sh/ruff#15764</a> on 2025-01-27 05:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
