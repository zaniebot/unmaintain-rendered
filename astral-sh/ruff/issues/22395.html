<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>no-explicit-stacklevel (B028) should allow no stacklevel when skip_file_prefixes is provided - astral-sh/ruff #22395</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>no-explicit-stacklevel (B028) should allow no stacklevel when skip_file_prefixes is provided</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22395">#22395</a>
        opened by <a href="https://github.com/abrahammurciano">@abrahammurciano</a>
        on 2026-01-05 09:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/abrahammurciano">@abrahammurciano</a> on 2026-01-05 09:17</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>According to the <a href="https://docs.python.org/3/library/warnings.html#warnings.warn">python documentation</a></p>
<blockquote>
<p>The <code>skip_file_prefixes</code> keyword argument can be used to indicate which stack frames are ignored when counting stack levels. [...] When prefixes are supplied, <code>stacklevel</code> is implicitly overridden to be <code>max(2, stacklevel)</code>.
[...]
Changed in version 3.12: Added skip_file_prefixes.</p>
</blockquote>
<p>If <code>skip_file_prefixes</code> is provided, then the stacklevel is already set to at least 2, and the user has already explicitly skipped certain stack frames by prefix. The resulting warning will already give the caller more context about the warning since it will output a stack frame higher up than the one the warning was issued from, most likely outside of the issuing package (i.e. the caller's actual call).</p>
<p>Therefore I believe <a href="https://docs.astral.sh/ruff/rules/no-explicit-stacklevel/">the B028 rule</a> should be updated to allow either of the two parameters instead of only <code>stacklevel</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 11:25</div>
            <div class="timeline-body"><p>Makes sense, thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @MichaReiser on 2026-01-09 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2026-01-09 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/caiquejjx">@caiquejjx</a> on 2026-01-10 14:18</div>
            <div class="timeline-body"><p>Hi, I believe that this is already achieved here:
https://github.com/astral-sh/ruff/blob/046c5a46d88c930e4e5e4638ec6b3515ba919982/crates/ruff_linter/src/rules/flake8_bugbear/rules/no_explicit_stacklevel.rs#L79
I also tested locally and I don't get the warning if I set the <code>skip_file_prefixes</code> param, so maybe only update the message to also inform about the possibility of setting <code>skip_file_prefixes</code>?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:56:31 UTC
    </footer>
</body>
</html>
