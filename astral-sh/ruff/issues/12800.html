<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[feature] Add ability to specify `--range` option multiple times - astral-sh/ruff #12800</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[feature] Add ability to specify <code>--range</code> option multiple times</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12800">#12800</a>
        opened by <a href="https://github.com/afontenot">@afontenot</a>
        on 2024-08-11 06:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/afontenot">@afontenot</a> on 2024-08-11 06:45</div>
            <div class="timeline-body"><p>This feature would increase feature parity with <code>black</code>, which supports multiply specifying the equivalent <code>--line-ranges</code> option.</p>
<p>Accepting multiple ranges is extremely useful for programmatically checking / modifying the format of the <em>changed</em> portions of a file when changes occur. For example, on some code bases a style guide has not been correctly adhered to historically, but project maintainers want to ensure that all <em>new</em> work adheres to <code>ruff format</code> checks.</p>
<p>Some discussion of this happened in the original <code>--range</code> pull request https://github.com/astral-sh/ruff/pull/9733, which I'll copy here:</p>
<blockquote>
<p>The CLI only supports a single range. We can explore supporting multiple ranges in the future. The main challenge is that overlapping ranges invalidate the offset of whichever range gets formatted last (starting from the back helps but doesn't prevent it). This is especially a problem if the formatter has to extend the formatted range.</p>
</blockquote>
<p>While I do agree that this adds some complexity, I think it's a valuable feature and I didn't see an open issue for it, so I decided to file one to hopefully push this forward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @AlexWaygood on 2024-08-11 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @AlexWaygood on 2024-08-11 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-11 15:12</div>
            <div class="timeline-body"><p>Thanks for opening this issue and doing the extra work of finding the PR where it was added.</p>
<p>Could you tell us a bit more about your workflow? It seems you're already calling ruff in an automated way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/afontenot">@afontenot</a> on 2024-08-11 21:43</div>
            <div class="timeline-body"><blockquote>
<p>Could you tell us a bit more about your workflow?</p>
</blockquote>
<p>Sure! I don't have this in use on any large projects (yet), but I work on some Python projects that don't have an established code style currently. I've written a small program that calls <code>git</code> to extract the precise line numbers that have been changed, and turns these into ranges that can be passed into either <code>black</code> or <code>ruff format</code>.</p>
<p>To make sure my contributions to these projects follow a consistent style (I use the black style on all my personal stuff), I set up a pre-commit hook that runs this tool in a <code>--check</code> form. I can also pass <code>--diff</code> to it to see code style changes suggested by <code>black</code> or <code>ruff</code> or just accept the suggested changes. This can't be done without iteratively changing one section of code at a time in <code>ruff</code>. I think project maintainers who want to make sure PRs pass a style check without reformatting their whole code base might be interested in adding a tool like this to their test suite.</p>
<p>Some editors allow you to pass selections to the formatter, so that's a partial workaround for this issue. However, this doesn't allow a pre-commit check, and the editor I'm currently using the most (Zed) does not support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-12 05:08</div>
            <div class="timeline-body"><p>This will also be useful in implementing the upcoming (3.18) LSP feature <code>textDocument/rangesFormatting</code> which allow providing multiple ranges for a formatting request (https://microsoft.github.io/language-server-protocol/specifications/lsp/3.18/specification/#textDocument_rangeFormatting).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> removed by @MichaReiser on 2024-08-12 06:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2024-08-12 06:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @MichaReiser on 2024-08-17 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okuuva">@okuuva</a> on 2024-09-19 12:11</div>
            <div class="timeline-body"><p>Just to add a related note: the use case @afontenot described is the reason <a href="https://github.com/akaihola/darker"><code>darker</code></a> exists. Support for <code>ruff format</code> is <a href="https://github.com/akaihola/darker/issues/521">incoming</a>.</p>
<p>Full disclosure: I'm a <code>darker</code> contributor. Always feels like an icky humble brag but better to be open about it I guess.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:41 UTC
    </footer>
</body>
</html>
