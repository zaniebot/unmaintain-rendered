<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê¢ `.ruff_cache` directory has a huge size and it slows down PyCharm load - astral-sh/ruff #5132</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>üê¢ <code>.ruff_cache</code> directory has a huge size and it slows down PyCharm load</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5132">#5132</a>
        opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a>
        on 2023-06-15 21:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-06-15 21:19</div>
            <div class="timeline-body"><p>After checking with all linters of a large project - the directory <code>.ruff_cache</code> has a large size and a huge number of files inside. The first load of PyCharm slows down at the stage of indexing all the files.</p>
<p>The volume of lines in all files:</p>
<pre><code>$ ( find src apps -name '*.py' -print0 | xargs -0 cat ) | wc -l
  979136
</code></pre>
<p>Cache directory size:</p>
<pre><code>$ du -h .ruff_cache
1,5G	.ruff_cache/content
1,5G	.ruff_cache
</code></pre>
<p>Number of files in the cache directory:</p>
<pre><code>ls -1 .ruff_cache/content | wc -l
  319586
</code></pre>
<p>As a quick fix, I excluded directory <code>.ruff_cache</code> using the context menu: ¬´Mark Directory as -&gt; Excluded¬ª.</p>
<p>But it doesn't seem to be ok if the cache doesn't clear itself.</p>
<p>PS: MacBook Pro Intel¬†Core¬†i9 with SSD</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-15 21:28</div>
            <div class="timeline-body"><p>Thanks for this. Coincidentally, we're actually working on the cache a bit now (\cc @Thomasdezeeuw). It has a couple significant problems. (You can always run <code>ruff clean</code> to remove all caches recursively, though it's not self-cleaning.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-15 22:04</div>
            <div class="timeline-body"><p>I believe #5117 would help with this significantly, as it would bound the size of the cache to the size of the project (rather than letting it grow in perpetuity).</p>
<p>#5122 would also help a lot, since we'll move the cache out of the project directory and into the global cache directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2023-06-16 00:20</div>
            <div class="timeline-body"><blockquote>
<p>As a quick fix, I excluded directory .ruff_cache using the context menu: ¬´Mark Directory as -&gt; Excluded¬ª.</p>
<p>But it doesn't seem to be ok if the cache doesn't clear itself.</p>
</blockquote>
<p>As far as I know, this is the recommended solution. Can you elaborate on what you mean by &quot;But it doesn't seem to be ok if the cache doesn't clear itself.&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Thomasdezeeuw by @Thomasdezeeuw on 2023-06-16 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-06-16 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-06-17 18:46</div>
            <div class="timeline-body"><p>I meant that it would be good if ruff itself would periodically check the directory with the cache at the time of the check and automatically delete old files (for example, those that were created earlier than 7 days ago).</p>
<p>Maybe we should rework the caching system itself, because it is not normal to have so many files, don't forget that a disk has inodes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-17 18:47</div>
            <div class="timeline-body"><p>#5117 will fix that -- it changes to a single cache file per package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-06-17 18:49</div>
            <div class="timeline-body"><p>By the way, in principle, if in the directory is formed such a large number of files - it is not normal. The directory listing will be slow.</p>
<p>Usually, if the cache is stored on disk - try to spread it over N directories inside, so that each directory has a limited number of files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Thomasdezeeuw">@Thomasdezeeuw</a> on 2023-06-27 13:17</div>
            <div class="timeline-body"><p>Should fixed by https://github.com/astral-sh/ruff/pull/5120.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Thomasdezeeuw on 2023-06-27 13:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:26 UTC
    </footer>
</body>
</html>
