<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule request: prefer async for FastAPI dependencies - astral-sh/ruff #15279</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Rule request: prefer async for FastAPI dependencies</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/15279">#15279</a>
        opened by <a href="https://github.com/spladug">@spladug</a>
        on 2025-01-05 22:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/spladug">@spladug</a> on 2025-01-05 22:02</div>
            <div class="timeline-body"><p>When a synchronous function is used as a dependency factory for FastAPI, the framework runs the function on a threadpool. This is done even if the factory never does IO, which can be quite wasteful. Since it's super tempting to not async-color the function when it's doing something super simple, it seems like it'd be useful to lint for this to avoid potential performance pitfalls.</p>
<p>See https://github.com/zhanymkanov/fastapi-best-practices?tab=readme-ov-file#prefer-async-dependencies for more info.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-06 08:40</div>
            <div class="timeline-body"><p>Thanks.</p>
<p>I think the challenge with a rule such as this is how Ruff should quantify &quot;a small non-IO operation&quot;</p>
<blockquote>
<p>And threads here also come with a price and limitations, that are redundant, if you just make a small non-I/O operation.</p>
</blockquote>
<p>I worry that suggest a rule would have a high false positive rate. It might be a better fit for Ruff once we have a &quot;suggestion&quot; severity that only applies to the IDE context.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-01-06 08:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2025-01-06 08:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spladug">@spladug</a> on 2025-01-06 20:25</div>
            <div class="timeline-body"><p>Yeah, that's totally fair.  Difficult to tell without some way of identifying a function as pure.</p>
<p>I could maybe see it being an opt-in rule as in an asyncio-primary codebase it's definitely the exception to want the synchronous style for IO anyway.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
