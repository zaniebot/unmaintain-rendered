<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug - F401 Unused imports in Jupyter Notebook breaks shell commands - astral-sh/ruff #11833</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug - F401 Unused imports in Jupyter Notebook breaks shell commands</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11833">#11833</a>
        opened by <a href="https://github.com/jeertmans">@jeertmans</a>
        on 2024-06-11 07:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jeertmans">@jeertmans</a> on 2024-06-11 07:32</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hello!</p>
<p>First of all, thanks for the great tool!</p>
<p>Inside notebooks (e.g., Google Colab), it is very common, and <a href="https://jakevdp.github.io/blog/2017/12/05/installing-python-packages-from-jupyter/">recommended</a>, to run <code>pip install</code> Python packages by linking to the appropriate Python executable, which hence needs <code>sys.executable</code>, see code snippet below.</p>
<p>However, Ruff will not detect that <code>sys</code> is needed in the shell command (with <code>!</code>) and will remove the <code>import sys</code> line, which will ultimately break the notebook.</p>
<p>Without <code>--fix</code>, the output is:</p>
<pre><code class="language-bash">notebook.ipynb:cell 2:7:12: F401 [*] `sys` imported but unused
</code></pre>
<p><strong>Keywords:</strong> &quot;Ruff&quot;, &quot;F401&quot;, &quot;Jupyter&quot;, &quot;Notebook&quot;, &quot;unused import&quot;, &quot;shell command&quot;.</p>
<p>Minimal code snippet:</p>
<pre><code class="language-python">try:
    import package  # noqa: F401
except ImportError:
    import sys
    !{sys.executable} -m pip install package
</code></pre>
<p>A temporary fix is to add disable this check on <code>import sys</code>:</p>
<pre><code class="language-python">try:
    import package  # noqa: F401
except ImportError:
    import sys  # noqa: F401
    !{sys.executable} -m pip install package
</code></pre>
<p>While this fix is fine, I had to learn it the hard way, as the <code>unused-import</code> fix is considered stable and will not warn you about this if you directly run with <code>--fix</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdulcet">@tdulcet</a> on 2024-06-11 11:52</div>
            <div class="timeline-body"><p>Same type of issue as #8094.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeertmans">@jeertmans</a> on 2024-06-11 12:22</div>
            <div class="timeline-body"><p>Indeed @tdulcet, couldn't find it :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-11 12:23</div>
            <div class="timeline-body"><p>üëç I'm going to combine with #8094. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-06-11 12:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-06-11 12:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">notebook</span> added by @charliermarsh on 2024-06-11 12:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:09 UTC
    </footer>
</body>
</html>
