<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`# noqa: E702 # fmt: skip` still formats the line of code - astral-sh/ruff #11430</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code># noqa: E702 # fmt: skip</code> still formats the line of code</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11430">#11430</a>
        opened by <a href="https://github.com/ngoctnq">@ngoctnq</a>
        on 2024-05-15 07:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ngoctnq">@ngoctnq</a></div>
            <div class="timeline-body">

<p>Input code:</p>
<pre><code>print(); print() # noqa # fmt: skip
</code></pre>
<p>After formatting:</p>
<pre><code>print()
print()  # noqa # fmt: skip
</code></pre>
<p><code># fmt: on/off</code> works fine though, but I want to have just one line of short boilerplate code.</p>
<p>I&#x27;m using the Ruff VS Code extension, which is said to ship with <code>ruff==0.4.1</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-15 08:20</div>
            <div class="timeline-body"><p>I think it&#x27;s because there are two statements on the same line and <code>fmt: skip</code> is being applied only for the last statement. This can be seen by adding a single-quoted string (https://play.ruff.rs/edf37109-eb34-4b5c-9867-dd5587bef085), notice that the formatter only changes the quote for the first print call and not the second one. I don&#x27;t think <code>RUF028</code> will indicate here because the suppression comment is actually being used by the formatter.</p>
<p>I&#x27;m not exactly sure if this is the intended behavior, @konstin any thoughts here? @MichaReiser  will be able to provide more context here but he&#x27;s currently on PTO until the end of next week. I can possibly look into it to confirm whether this is the intended behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-15 08:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-15 08:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-15 11:40</div>
            <div class="timeline-body"><p>Iirc the end-of-line format off comment applies to the statement preceding it, and the two prints are two separate statements, but micha will know better</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-05-27 08:41</div>
            <div class="timeline-body"><p>Oh, that&#x27;s interesting and not something I have thought of when implementing suppression comments.</p>
<blockquote>
<p><code># fmt: skip</code> comments suppress formatting for a preceding statement, case header, decorator, function definition, or class definition:</p>
</blockquote>
<p>Today&#x27;s behavior matches our documentation. However, Black doesn&#x27;t format simple statements that end with a <code>fmt: skip</code> comment. So it is at least a Black incompatibility (and possibly not flagged by the ruff lint rule).</p>
<p>I&#x27;m open to changing our implementation to support this use case if it doesn&#x27;t add too much complexity. I otherwise recommend documenting the deviation because it&#x27;s possible to suppress the example using <code>fmt: off</code> (although it is slightly more verbose).</p>
<pre><code># fmt: off
print(); print() # noqa 
# fmt: on

print( )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gatsby-Lee">@Gatsby-Lee</a> on 2024-06-18 07:18</div>
            <div class="timeline-body"><blockquote>
<p>Oh, that&#x27;s interesting and not something I have thought of when implementing suppression comments.</p>
<blockquote>
<p><code># fmt: skip</code> comments suppress formatting for a preceding statement, case header, decorator, function definition, or class definition:</p>
</blockquote>
<p>Today&#x27;s behavior matches our documentation. However, Black doesn&#x27;t format simple statements that end with a <code>fmt: skip</code> comment. So it is at least a Black incompatibility (and possibly not flagged by the ruff lint rule).</p>
<p>I&#x27;m open to changing our implementation to support this use case if it doesn&#x27;t add too much complexity. I otherwise recommend documenting the deviation because it&#x27;s possible to suppress the example using <code>fmt: off</code> (although it is slightly more verbose).</p>
<pre><code># fmt: off
print(); print() # noqa 
# fmt: on

print( )
</code></pre>
</blockquote>
<p>yep. basically, I banged my head a few hours to figure this out.
And, I finally just changed to Black formatter again.</p>
<p>Black doesn&#x27;t format the line which has more than one statement and tagged with &quot;# fmt: skip&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gatsby-Lee">@Gatsby-Lee</a> on 2024-06-18 07:18</div>
            <div class="timeline-body"><p>@ngoctnq</p>
<p>thank you for writing this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Peiffap">@Peiffap</a> on 2024-06-21 23:39</div>
            <div class="timeline-body"><p>Related: #11216.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2026-01-10 15:00</div>
            <div class="timeline-body"><p>Resolved by <a href="https://github.com/astral-sh/ruff/pull/22119">astral-sh/ruff#22119</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2026-01-10 15:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:53 UTC
    </footer>
</body>
</html>
