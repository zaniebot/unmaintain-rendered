<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conflicting behavior of ruff isort rule for same file in different environments - astral-sh/ruff #15920</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Conflicting behavior of ruff isort rule for same file in different environments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/15920">#15920</a>
        opened by <a href="https://github.com/rashishhume">@rashishhume</a>
        on 2025-02-04 01:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rashishhume">@rashishhume</a> on 2025-02-04 01:43</div>
            <div class="timeline-body"><h3>Description</h3>
<p>I've noticed that ruff linter with isort enabled is behaving differently for me when running locally (in a Linux machine with Ubuntu) vs in a Github action runner (running ubuntu-latest).</p>
<p>Locally, its not happy about the <strong>lack of line</strong> between <code>yaml</code> and <code>RcloneHelper</code>.</p>
<pre><code>$ ruff check --config ./pyproject.toml ./backup.py
backup2.py:5:1: I001 [*] Import block is un-sorted or un-formatted
   |
 3 |   &quot;&quot;&quot;
 4 |
 5 | / import logging
 6 | | import os
 7 | | from typing import Annotated, List
 8 | |
 9 | | import typer
10 | | import yaml
11 | | from data_backup.rclone_helper import RcloneHelper
   | |__________________________________________________^ I001
12 |
13 |   logging.basicConfig(
   |
   = help: Organize imports

Found 1 error.
</code></pre>
<p>In a Github action runner its not happy <strong>with a line</strong> (ran below via tmate ssh session in the runner)</p>
<pre><code>$ ruff check --config ./tools/data-backup/pyproject.toml ./tools/data-backup/backup.py
tools/data-backup/backup.py:5:1: I001 [*] Import block is un-sorted or un-formatted
   |
 3 |   &quot;&quot;&quot;
 4 |
 5 | / import logging
 6 | | import os
 7 | | from typing import Annotated, List
 8 | |
 9 | | import typer
10 | | import yaml
11 | |
12 | | from data_backup.rclone_helper import RcloneHelper
   | |__________________________________________________^ I001
13 |
14 |   logging.basicConfig(
   |
   = help: Organize imports

Found 1 error.
</code></pre>
<p>My pyproject.toml is:</p>
<pre><code>[tool.ruff]
line-length = 120
indent-width = 4

[tool.ruff.lint]
ignore = [&quot;E203&quot;, &quot;E501&quot;]
extend-select = [&quot;I&quot;]
</code></pre>
<p>Any thoughts on what might be the issue here ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-04 08:41</div>
            <div class="timeline-body"><p>The reason for the difference seems to be that Ruff once categorizes <code>data_backup</code> as first party (locally) and as third-party (GitHub) dependencies and it then tries to group it with the other first/third-party imports. You can run ruff with <code>ruff check --verbose</code> and it should log how imports are categorizes.</p>
<p>Now, the reason why I think Ruff once detects <code>data_backup</code> as first-party locally but not on GitHub is because you run ruff from different directories. Ruff defaults to treat <code>./</code> and <code>./src</code> as first-party and everything else as third-party (see <a href="https://docs.astral.sh/ruff/settings/#src"><code>src</code></a>.</p>
<p>Can you try running ruff in the <code>tools/data-backup</code> directory on GitHub, the same as you do locally and let me know if that helped?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-02-04 08:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @MichaReiser on 2025-02-04 08:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rashishhume">@rashishhume</a> on 2025-02-04 18:56</div>
            <div class="timeline-body"><p>Thanks @MichaReiser. That might be right. I tried changing the dir locally, and I see the same error as Github</p>
<pre><code>$ ruff check --config ./research/tools/data-backup/pyproject.toml ./research/tools/data-backup/backup2.py
research/tools/data-backup/backup2.py:5:1: I001 [*] Import block is un-sorted or un-formatted
   |
 3 |   &quot;&quot;&quot;
 4 |
 5 | / import logging
 6 | | import os
 7 | | from typing import Annotated, List
 8 | |
 9 | | import typer
10 | | import yaml
11 | |
12 | | from data_backup.rclone_helper import RcloneHelper
   | |__________________________________________________^ I001
13 |
14 |   logging.basicConfig(
   |
   = help: Organize imports

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rashishhume">@rashishhume</a> on 2025-02-04 19:19</div>
            <div class="timeline-body"><p>I was able to fix it by simply omitting the <code>--config</code> argument when invoking it in Github</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-05 08:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ruff-pre-commit/issues/103.html">astral-sh/ruff-pre-commit#103</a> on 2025-03-03 06:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
