```yaml
number: 7095
title: Rules FURB113 cause autofix error
type: issue
state: closed
author: qarmin
labels:
  - bug
  - fuzzer
assignees: []
created_at: 2023-09-03T18:32:21Z
updated_at: 2025-06-05T20:54:11Z
url: https://github.com/astral-sh/ruff/issues/7095
synced_at: 2026-01-10T01:56:49Z
```

# Rules FURB113 cause autofix error

---

_Issue opened by @qarmin on 2023-09-03 18:32_


Ruff 0.0.287 (latest changes from main branch)
```
ruff  *.py --select FURB113 --no-cache --fix
```

file content(at least simple cpython script shows that this is valid python file):
```
def prettify(
) -> str:
    r = []
    fmtlink = lambda uri: encryptor.handle_cipher(
    )[1]
    folders, videos, audios, photos, programs, documents, etc = (
    )
    r.append(
    )
    r.append(
    )
    r.append(
        '<meta content="width=width-device, initial-scale=1.0" name="viewport"></meta>'
    )
    if args.preload:
        if os.path.isdir(fullname):
            linkname = name + "/"
        if os.path.islink(fullname):
                r.append(
                    '<p><a class="dir" href="%s">%s</a></p>'
                    % (
                    )
                )
                r.append(
                    '<p><a class="file" href="%s">%s</a></p>'
                    % (
                    )
                )
                folders.append(
                    '<button><a class="dir" href="%s">%s</a></button>'
                    % (
                    )
                )
                if len(linknm) > 30:
                    linknm = linknm[0:30] + "..."
                    rp = f"""<div id='info' class='vida'><p class='doc'>{linknm}</p>
            			<source src="{link}" type="video/mp4"></video>{'<br>'*2}</div>"""
                elif displayname.endswith(
                ):
                    rp = f"""<div id='info' class='aud'><p class='doc'>{linknm}</p><audio controls>
            			</audio></div>"""
                    (
                    )
                elif displayname.endswith(
                ):
                    documents.append(
                    )
                    etc.append(
                    )
                hd = [
                ]
                for x in range(len(dt)):
                            r.append(
                            )
    r.append(
        f"""
        </form>"""
        if args.upload
        else ""
    )
    r.append(
        f"""<hr><div class="container"><footer>
        { '<a class="admin_login" href="/admin/fileadmin">Manage Files</a><br><br>' if args.admin else ''} 
       """
    )
```

error
```
/home/rafal/test/tmp_folder/8304481.py:19:17: FURB113 Use `r.extend(...)` instead of repeatedly calling `r.append()`
/home/rafal/test/tmp_folder/8304481.py:55:5: FURB113 Use `r.extend(...)` instead of repeatedly calling `r.append()`
Found 2 errors.

error: Autofix introduced a syntax error. Reverting all changes.

This indicates a bug in `ruff`. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BAutofix%20error%5D

...quoting the contents of `/home/rafal/test/tmp_folder/8304481.py`, the rule codes FURB113, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!


```
        
[python_compressed.zip](https://github.com/astral-sh/ruff/files/12506821/python_compressed.zip)


---

_Label `fuzzer` added by @zanieb on 2023-09-03 19:02_

---

_Label `bug` added by @charliermarsh on 2023-09-03 22:31_

---

_Comment by @konstin on 2023-09-05 20:29_

The underlying problem is that the generator doesn't know which string quotes there are and picks the wrong ones for f-strings with nested strings:
```python
def f():
    r = []
    r.append('')
    r.append(f"""{'"'}""")
```
gets turned into
```python
def f():
    r = []
    r.extend(('', f'{\'"\'}'))
```
The solutions could be adding quote kinds to the AST (i remember this being suggested before) or reimplementing/refactoring the entire machinery for picking the right quote type in python up to 3.12 from the formatter.

---

_Comment by @ntBre on 2025-06-05 20:54_

I wasn't able to bisect this to the exact commit, but I can't reproduce this after 0.9.4, probably as a result of these quoting changes from the changelog:

> Preserve quote style in generated code (https://github.com/astral-sh/ruff/pull/15726, https://github.com/astral-sh/ruff/pull/15778, https://github.com/astral-sh/ruff/pull/15794)

Feel free to reopen if it's still an issue!

---

_Closed by @ntBre on 2025-06-05 20:54_

---
