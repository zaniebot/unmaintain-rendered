<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format cause panic 'slice index starts at 4 but ends at 3' - astral-sh/ruff #7245</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format cause panic 'slice index starts at 4 but ends at 3'</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7245">#7245</a>
        opened by <a href="https://github.com/qarmin">@qarmin</a>
        on 2023-09-08 16:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qarmin">@qarmin</a></div>
            <div class="timeline-body"><p>Ruff 0.0.287 (latest changes from main branch)</p>
<pre><code>ruff format *.py
</code></pre>
<p>file content(at least simple cpython script shows that this is valid python file):</p>
<pre><code>class EC2REPATH:
        f.write (&quot;Pathway name&quot; + &quot;\t&quot; &quot;Database Identifier&quot; + &quot;\t&quot; &quot;Source database&quot; + &quot;\n&quot;)
</code></pre>
<p>error</p>
<pre><code>
warning: `ruff format` is a work-in-progress, subject to change at any time, and intended only for experimentation.

error: `ruff` crashed. This indicates a bug in `ruff`. If you could open an issue at:

https://github.com/astral-sh/ruff/issues/new?title=%5BPanic%5D

quoting the executed command, along with the relevant file contents and `pyproject.toml` settings, we'd be very appreciative!

thread 'main' panicked at 'slice index starts at 4 but ends at 3', crates/ruff_python_formatter/src/expression/binary_like.rs:472:27
stack backtrace:
   0: rust_begin_unwind
             at /rustc/5680fa18feaa87f3ff04063800aec256c3d4b4be/library/std/src/panicking.rs:593:5
   1: core::panicking::panic_fmt
             at /rustc/5680fa18feaa87f3ff04063800aec256c3d4b4be/library/core/src/panicking.rs:67:14
   2: core::slice::index::slice_index_order_fail_rt
             at /rustc/5680fa18feaa87f3ff04063800aec256c3d4b4be/library/core/src/slice/index.rs:98:5
   3: core::slice::index::slice_index_order_fail
             at /rustc/5680fa18feaa87f3ff04063800aec256c3d4b4be/library/core/src/slice/index.rs:91:14
   4: &lt;ruff_python_formatter::expression::binary_like::BinaryLike as ruff_formatter::Format&lt;ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
   5: &lt;ruff_python_formatter::expression::FormatExpr as ruff_formatter::FormatRule&lt;ruff_python_ast::nodes::Expr,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt::{{closure}}
   6: &lt;ruff_python_formatter::expression::FormatExpr as ruff_formatter::FormatRule&lt;ruff_python_ast::nodes::Expr,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
   7: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
   8: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
   9: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
  10: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
  11: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
  12: &lt;ruff_python_formatter::expression::parentheses::FormatParenthesized as ruff_formatter::Format&lt;ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  13: ruff_python_formatter::FormatNodeRule::fmt
  14: ruff_python_formatter::FormatNodeRule::fmt
  15: &lt;ruff_python_formatter::expression::FormatExpr as ruff_formatter::FormatRule&lt;ruff_python_ast::nodes::Expr,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  16: &lt;ruff_python_formatter::statement::FormatStmt as ruff_formatter::FormatRule&lt;ruff_python_ast::nodes::Stmt,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  17: &lt;ruff_python_formatter::statement::suite::FormatSuite as ruff_formatter::FormatRule&lt;alloc::vec::Vec&lt;ruff_python_ast::nodes::Stmt&gt;,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  18: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
  19: ruff_formatter::arguments::Argument&lt;Context&gt;::new::formatter
  20: &lt;ruff_python_formatter::statement::clause::FormatClauseBody as ruff_formatter::Format&lt;ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  21: &lt;ruff_python_formatter::statement::stmt_class_def::FormatStmtClassDef as ruff_python_formatter::FormatNodeRule&lt;ruff_python_ast::nodes::StmtClassDef&gt;&gt;::fmt_fields
  22: &lt;ruff_python_formatter::statement::FormatStmt as ruff_formatter::FormatRule&lt;ruff_python_ast::nodes::Stmt,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  23: &lt;ruff_python_formatter::statement::suite::FormatSuite as ruff_formatter::FormatRule&lt;alloc::vec::Vec&lt;ruff_python_ast::nodes::Stmt&gt;,ruff_python_formatter::context::PyFormatContext&gt;&gt;::fmt
  24: ruff_python_formatter::format_module
  25: rayon::iter::plumbing::bridge_producer_consumer::helper
  26: ruff_cli::run
  27: ruff::main
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre>
<p><a href="https://github.com/astral-sh/ruff/files/12561912/python_compressed.zip">python_compressed.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-09-08 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2023-09-08 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-09-08 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2023-09-08 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-12 01:54</div>
            <div class="timeline-body"><p>I looked into this a bit but haven't solved it yet. The <code>BinaryLike</code> format doesn't account for cases in which we have consecutive runs of implicit concatenations -- a minimal repo is <code>&quot;a&quot; &quot;b&quot; + &quot;c&quot; &quot;d&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-12 05:12</div>
            <div class="timeline-body"><p>I can take a look at it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2023-09-12 05:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @MichaReiser on 2023-09-12 05:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-09-12 07:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:17 UTC
    </footer>
</body>
</html>
