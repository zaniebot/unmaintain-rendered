<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positives for `quoted-type-alias` (`TC008`) - astral-sh/ruff #16688</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positives for <code>quoted-type-alias</code> (<code>TC008</code>)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16688">#16688</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-03-12 18:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-12 18:33</div>
            <div class="timeline-body"><p>Recursive type definition from ibis:</p>
<pre><code class="language-python">if sys.version_info &gt;= (3, 10):
    from types import UnionType
    from typing import TypeAlias

    # Keep this alias in sync with unittest.case._ClassInfo
    _ClassInfo: TypeAlias = type | UnionType | tuple[&quot;_ClassInfo&quot;, ...]
else:
    from typing_extensions import TypeAlias

    UnionType = object()
    _ClassInfo: TypeAlias = Union[type, tuple[&quot;_ClassInfo&quot;, ...]]  # TC008
</code></pre>
<p>Conditional import from zulip:</p>
<pre><code class="language-python">if settings.ZILENCER_ENABLED:
    from zilencer.models import RemoteInstallationCount, RemoteRealmCount, RemoteZulipServer

...

TableType: TypeAlias = (
        type[&quot;RemoteInstallationCount&quot;]  # TC008
        | type[InstallationCount]
        | type[&quot;RemoteRealmCount&quot;]
        | type[RealmCount]
</code></pre>
<p>These all look like false positives except the latchbio cases.</p>
<p>The Zulip cases require an import that is conditional on some <code>settings</code> type other than <code>TYPE_CHECKING</code>, so I think unconditionally unquoting those could be a problem.</p>
<p>And the ibis case is a recursive type alias, which I think must be quoted? Possibly the rule doesn't descend into the <code>Union</code> because it handles the <code>... | ...</code> version fine.</p>
<p><em>Originally posted by @ntBre in https://github.com/astral-sh/ruff/issues/16639#issuecomment-2715217849</em></p>
<p>See this <a href="https://github.com/astral-sh/ruff/pull/16639#issuecomment-2715178621">ecosystem check</a> for what &quot;these&quot; refers to and <a href="https://github.com/astral-sh/ruff/pull/16639#issuecomment-2716941870">this comment</a> for additional context and possible solutions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-03-12 18:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:36:54 UTC
    </footer>
</body>
</html>
