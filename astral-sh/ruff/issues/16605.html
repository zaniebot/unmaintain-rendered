<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autofix non-contextmanager use of `pytest.raises` &amp; friends - astral-sh/ruff #16605</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Autofix non-contextmanager use of <code>pytest.raises</code> &amp; friends</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16605">#16605</a>
        opened by <a href="https://github.com/jakkdl">@jakkdl</a>
        on 2025-03-10 15:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jakkdl">@jakkdl</a></div>
            <div class="timeline-body">Summary
Rule request
<p>https://github.com/pytest-dev/pytest/pull/13241 wants to deprecate the use of the callable form of <code>raises</code>, <code>warns</code> and <code>deprecated_call</code> - i.e.</p>
<pre><code>excinfo = pytest.raises(ValueError, int, &quot;hello&quot;)
# should be
with pytest.raises(ValueError) as excinfo:
  int(&quot;hello&quot;)
</code></pre>
<p>but in the rare codebase where it&#x27;s widely used it will be a massive pain to rewrite it manually, so we don&#x27;t want to deprecate it until there&#x27;s a good option for autofixing it. I thought ruff would be a good option for supplying this.</p>
<p>It can optionally also handle <code>match</code>, which requires a separate assert when using the callable form:</p>
<pre><code>excinfo = pytest.raises(ValueError, int, &quot;hello&quot;)
assert excinfo.match(&quot;^invalid literal&quot;)
# to
with pytest.raises(ValueError, match=&quot;^invalid literal&quot;):
    int(&quot;hello&quot;)
</code></pre>
Rationale
<p>The context-manager form is more readable, easier to extend, and supports additional kwargs. And is not on the verge of being deprecated</p>
<p>Requested uptream in flake8-pytest: <a href="https://github.com/m-burst/flake8-pytest-style/issues/331">m-burst/flake8-pytest-style#331</a>, but it&#x27;s mostly the autofix we&#x27;re interested in</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-10 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-10 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-10 18:24</div>
            <div class="timeline-body"><p>I don&#x27;t see a reason not to add this rule if it is accepted upstream if someone&#x27;s interested in implementing the rule + fix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-10 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-10 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakkdl">@jakkdl</a> on 2025-03-11 09:18</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t see a reason not to add this rule if it is accepted upstream if someone&#x27;s interested in implementing the rule + fix</p>
</blockquote>
<p>With upstream, do you mean <code>pytest</code> or <code>flake8-pytest-style</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-11 09:39</div>
            <div class="timeline-body"><p><code>flake8-pytest-style</code>. The alternative is to make it a Ruff rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-16 17:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:38 UTC
    </footer>
</body>
</html>
