<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule for copying mutable objects between two persistent variables - astral-sh/ruff #21688</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule for copying mutable objects between two persistent variables</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/21688">#21688</a>
        opened by <a href="https://github.com/EternityForest">@EternityForest</a>
        on 2025-11-29 08:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EternityForest">@EternityForest</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>One bug pattern that I've encountered several times is
something like <code>a.x = b.x</code>, or even <code>a.x = a.y = {}</code></p>
<p>The times I've done it are often when doing change detection, you do <code>x.old = x.new</code>, then mutate <code>x.old</code>, when you meant to do <code>x.old = deepcopy(x.new)</code></p>
<p>Then, something mutates one of the two variables, and they both change, because they're the same object, and it can be very hard to track down why keys are suddenly appearing for seemingly no reason in your data structures.</p>
<p>Maybe there could be a rule that prevents assigning one mutable property of an object directly or indirectly(like by passing it as a an argument) to another.</p>
<p>It could also warn on assigning one mutable item to multiple objects, or assigning between globals and objects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @amyreese on 2025-12-01 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @amyreese on 2025-12-01 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2025-12-01 18:47</div>
            <div class="timeline-body"><p>I think this would be a very pedantic rule, as there are plenty of use cases where passing/sharing/reusing mutable collections is the correct/intended thing to do, or copying would be expensive and unnecessary. It would also require type information in order to know whether an attribute is mutable or not.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:39 UTC
    </footer>
</body>
</html>
