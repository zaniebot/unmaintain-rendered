<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B007 does not detect unused variables when they are shadowed or appear in inner scope - astral-sh/ruff #14113</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>B007 does not detect unused variables when they are shadowed or appear in inner scope</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/14113">#14113</a>
        opened by <a href="https://github.com/LordAro">@LordAro</a>
        on 2024-11-05 17:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/LordAro">@LordAro</a> on 2024-11-05 17:23</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>B007 (unused-loop-control-variable) does not trigger when variables are shadowed.</p>
<p>See this extremely contrived example:</p>
<pre><code class="language-python3">my_dict = my_other_dict = {}
my_list = []
for k, (v1, v2) in my_dict.items():
    for v1 in my_other_dict.values():
        print(v1)
    v2 = &quot;flibble&quot;
    print([k for k in my_list if k &gt; 0])
</code></pre>
<p>https://play.ruff.rs/92ded63b-80d4-4d7d-989a-3460865af51b</p>
<p>(Example is somewhat nested loop focused as that's what I thought the problem was initially)</p>
<p>Interestingly, PERF102 <em>does</em> trigger with this example, but I think only because it doesn't process comprehensions at all? If it's expanded out the warning goes away.</p>
<p>The only thing of note from ALL is PLW2901, which detects the variable shadowing.</p>
<p>Related issues: #8786 #9454 #10723</p>
<p>ruff 0.7.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "B007 does not detect shadowed variables" to "B007 does not detect unused variables when they are shadowed" by @LordAro on 2024-11-05 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-05 19:39</div>
            <div class="timeline-body"><p>Excellent, thanks for this! It looks like the same problem occurs even in this smaller example <a href="https://play.ruff.rs/44a26685-7932-4a77-85c9-6c7978ee0260">Playground link</a>:</p>
<pre><code class="language-python">for k in ls:
    print([k for k in otherls])
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dylwil3 on 2024-11-05 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "B007 does not detect unused variables when they are shadowed" to "B007 does not detect unused variables when they are shadowed or appear in inner scope" by @dylwil3 on 2024-11-05 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-05 22:12</div>
            <div class="timeline-body"><p>I guess technically my previous example wasn't &quot;shadowing&quot;, but an issue of scope. But shadowing <em>also</em> doesn't work (as you showed well in your original example):</p>
<pre><code class="language-python">for k in ls:
    k = 2
</code></pre>
<p>But, as you also point out, this is caught by <a href="https://docs.astral.sh/ruff/rules/redefined-loop-name/">PLW2901</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dylwil3 by @dylwil3 on 2024-11-05 22:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14122.html">astral-sh/ruff#14122</a> on 2024-11-06 04:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
