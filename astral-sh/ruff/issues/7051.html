<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter collapses last call in call chaining - astral-sh/ruff #7051</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter collapses last call in call chaining</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7051">#7051</a>
        opened by <a href="https://github.com/cnpryer">@cnpryer</a>
        on 2023-09-01 20:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a></div>
            <div class="timeline-body"><p>I prefer the change, but reporting since it's a diff in a from-<code>black</code> migration.</p>
<p>Line-length: 88</p>
<p>Related: #5343</p>
<p>Black (23.7.0):</p>
<pre><code class="language-py">df.drop(
    columns=[&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;]
).drop_duplicates().rename(
    columns={
        &quot;a&quot;: &quot;a&quot;,
    }
).to_csv(
    path / &quot;aaaaaa.csv&quot;, index=False
)
</code></pre>
<p>Ruff (0.0.287):</p>
<pre><code class="language-py">df.drop(
    columns=[&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;]
).drop_duplicates().rename(
    columns={
        &quot;a&quot;: &quot;a&quot;,
    }
).to_csv(path / &quot;aaaaaa.csv&quot;, index=False)
</code></pre>
<p>Counter example</p>
<pre><code class="language-python">df.drop(
    columns=[&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;]
).drop_duplicates(a).rename(
    columns={
        &quot;a&quot;: &quot;a&quot;,
    }
).to_csv(
    path / &quot;aaaaaa.csv&quot;, index=False
).other(a)
</code></pre>
<p>Playground: https://play.ruff.rs/02424913-15b0-4703-8eb8-6bc5896b00b6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter removes last expanded call in call chaining" to "Formatter un-expands last call in call chaining" by @cnpryer on 2023-09-01 20:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @charliermarsh on 2023-09-01 22:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-02 08:18</div>
            <div class="timeline-body"><p>Black uses Ruff's formatting in preview style if the left is a multiline string but it seems they keep the old formatting otherwise <a href="https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AFYAL9dAD2IimZxl1N_WlbvtxhHIP4MzK-CKGFKTx4PoxaHmn8Dmof37FGcjOIX-bz5K3YuD1k254NkYXInS24C_6UBPyDJgSGApL6casEi4Z7wrUCGFKEo7Q-MBvAQ33945CQCKbk7SRrMV9n-OwmV81tNymNFU19Ggiw41EygIA_Q7eokwPqJZmNitGQH3G3zY9DlJaPCkTZZX-atlL7psySvTc8uJ_eolTpD9JOn6d__xVQJ6kixksOyuwNvmmnL6BGBAACOtjZboj1_AAAB2wHZAgAA_DMU3rHEZ_sCAAAAAARZWg==">playground</a></p>
<p>To me it's unclear if expanding the last call is intentional to improve readability. I'm inclined to keep Ruff's formatting because it achieves the goal of avoiding unnecessary horizontal lines but it depends on how frequent we run into this difference (although could be hard to fix)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2023-09-02 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-09-02 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-09-02 12:49</div>
            <div class="timeline-body"><p>This was not frequent for me, but tbh I'm curious why. The pattern looks like it could be in some exploratory scripts we have.</p>
<p>I'll dig more next week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Beta" by @MichaReiser on 2023-09-27 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Stable" by @MichaReiser on 2023-09-27 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 14:52</div>
            <div class="timeline-body"><p>We're going to mark this as a known deviation for now. We'll revisit based on user feedback, but it's not blocking for the beta. (We can close the issue itself for now once this is documented.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @charliermarsh on 2023-09-27 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2023-09-27 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-09-27 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter un-expands last call in call chaining" to "Formatter collapses last call in call chaining" by @cnpryer on 2023-11-02 17:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:12 UTC
    </footer>
</body>
</html>
