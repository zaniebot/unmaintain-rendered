<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In-place formatting by default considered harmful - astral-sh/ruff #13626</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>In-place formatting by default considered harmful</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13626">#13626</a>
        opened by <a href="https://github.com/mainini">@mainini</a>
        on 2024-10-04 14:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mainini">@mainini</a> on 2024-10-04 14:37</div>
            <div class="timeline-body"><p>Hi!</p>
<p>I've searched the issues for various keywords like &quot;ruff format&quot;, &quot;in-place&quot;, &quot;write by default&quot; etc.</p>
<p>I do consider the default behavior of &quot;ruff format&quot; to be harmful: without further notice, it proceeds to recursively format files (*.py, *.pyi, *.ipynb and some toml files, as I could observe). I do have the standard configuration without any modifications.</p>
<p>As a new user of ruff, I wanted to display the help for the format command by just typing &quot;ruff format&quot;, which accidentally formatted several thousand files. To me, this was completely  unexpected behavior and opposed to that what &quot;traditional&quot; tools do: either nothing or write the conducted changes to stdout instead of modifying in-place (think e.g. &quot;sed -i&quot; if you really want to change things...).</p>
<p>I did briefly check &quot;ruff analyze&quot; and &quot;ruff check&quot;, however was unable to reproduce / draw conclusions. I would also consider this behavior harmful for other subcommands.</p>
<p>I would reconsider this choice and have all ruff commands not perform modifications by default (or at least ask before). That could also be made configurable.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-04 15:16</div>
            <div class="timeline-body"><p>Sorry this surprised you, but it's pretty standard for formatting commands (e.g., <code>cargo fmt</code>, <code>black</code>, etc.) to write in-place. I don't think we will change this behavior.</p>
<p>You can use <code>ruff format --diff</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-10-04 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainini">@mainini</a> on 2024-10-04 16:35</div>
            <div class="timeline-body"><p>Thanks a lot for your fast response!</p>
<p>Yes, I get the point with <code>cargo fmt</code> etc. However, in particular, <code>cargo fmt</code> IMHO only works in Rust project dirs with <code>cargo.toml</code>.</p>
<p>Maybe, similar behavior would make sense also for <code>ruff</code>? I.e. write in-place/modify if it looks like a &quot;python project&quot;, and don't do it if not? I basically find the &quot;just do it recursively, everywhere&quot; approach dangerous. Just my 2 cts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-04 17:29</div>
            <div class="timeline-body"><p>Fair point. I think the main goal here was to match <code>black</code>'s behavior though. And, you can't really develop a Rust project without a <code>cargo.toml</code> but it's very common for people to develop a Python project without a <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 08:22</div>
            <div class="timeline-body"><p>I don't think there's a standard across formatters. <code>prettier</code> doesn't write the changes by default but <code>rustfmt</code> (the command that <code>cargo fmt</code> runs under the hood), and black do. I see good reasons for either approach:</p>
<ul>
<li>Require explicit <code>--write</code> argument: Formatting is a destructive operation that should require explicit opt in</li>
<li>Implicit <code>--write</code>: The default use case is to write the changes back. Requiring an extra argument is extra verbose and surprising in the opposite way. I'm always surprised when I find prettier hitting me with a wall of text when I forgot the <code>--write</code> option</li>
</ul>
<p>I find either default valid (and both are harmful in their own way), so I don't think it's justified to disrupt all existing users by changing the default (where it's unclear which default is better).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-10-07 08:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
