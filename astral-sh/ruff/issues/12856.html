<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nested expression formatting - astral-sh/ruff #12856</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Nested expression formatting</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12856">#12856</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-08-13 10:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-13 10:56</div>
            <div class="timeline-body"><p>I was surprised that there's no existing issue for this.</p>
<p>We decided not to implement the following Black 24 style changes:</p>
<ul>
<li><code>parenthesize_long_type_hints,</code></li>
<li><code>wrap_long_dict_values_in_parens</code></li>
<li><code>parenthesize_conditional_expressions</code></li>
</ul>
<p>Because a) implementing this in Ruff is kind of hard (or slow) and b) it goes against the overall goal to avoid unnecessary parentheses.</p>
<p><a href="https://github.com/psf/black/issues/4123">This Black issue</a> goes into more detail about our concerns. We should explore different designs that yields better sub-expression formatting without requiring optional parentheses to improve readability.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2024-08-13 10:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12854.html">astral-sh/ruff#12854</a> on 2024-08-13 10:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12870.html">astral-sh/ruff#12870</a> on 2024-08-16 02:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13371.html">astral-sh/ruff#13371</a> on 2024-09-16 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../psf/black/issues/4501.html">psf/black#4501</a> on 2024-10-23 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17155.html">astral-sh/ruff#17155</a> on 2025-04-02 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vasily-v-ryabov">@vasily-v-ryabov</a> on 2025-04-03 08:21</div>
            <div class="timeline-body"><p>Thanks for improving the Formatter! <code>ruff check</code> is awesome, though <code>ruff format</code> still could be a little bit more mature, but we are very positive about its future too!</p>
<p>Let me add some input examples here which may be useful test cases in the future. This one came from old PyLint 2.x rule W9500.</p>
<pre><code class="language-python">some_dict = {
    'This is the first line which well fits into one line of code',
    'This is the second very long and very annoying line for the '
        'demonstration of Ruff Formatter issue with hanging indent '
        'wrapped twice in total',
    'This is the third line which well fits into one line of code',
}
</code></pre>
<p>For the next example (lower priority to us, not a deal breaker) <code>ruff format</code> removes empty line before <code>return</code> statement only at the beginning of method / function while it keeps empty line before any other <code>return</code> statement.
This one came from old PyLint 2.x rule <code>W9302, unnecessary-transfer-func-returns, Function returns should be transferred up. XX characters remain</code> (it is triggered by PyLint 2.x when empty line is removed).</p>
<pre><code class="language-python">class Klass:
    def method1(
        self,
        other: str,
        another: str,
        one_more_argument: str,
    ) -&gt; Optional[str]:

        return f'{other} is not {another} while {one_more_argument} happens'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/18193.html">astral-sh/ruff#18193</a> on 2025-05-19 13:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20482.html">astral-sh/ruff#20482</a> on 2025-09-20 11:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/21005.html">astral-sh/ruff#21005</a> on 2025-10-21 06:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../psf/black/issues/4875.html">psf/black#4875</a> on 2025-11-29 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/21369.html">astral-sh/ruff#21369</a> on 2025-12-05 07:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:14 UTC
    </footer>
</body>
</html>
