<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importing a function called `cast` leads to confusing F722 and F821 errors - astral-sh/ruff #490</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Importing a function called <code>cast</code> leads to confusing F722 and F821 errors</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/490">#490</a>
        opened by <a href="https://github.com/tgross35">@tgross35</a>
        on 2022-10-27 17:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tgross35">@tgross35</a></div>
            <div class="timeline-body"><p>Using a function named <code>cast</code> (shadows a newish builtin) leads to somewhat confusing errors. For the test file:</p>
<pre><code class="language-python">from something import cast
# same with `def cast(s): pass`

abc = &quot;123&quot;
cast(f&quot;tuv {abc} xyz&quot;)
</code></pre>
<p>We get the following unexpected results:</p>
<pre><code>$ ruff tmp.py 
Found 2 error(s).
tmp.py:5:6: F722 Syntax error in forward annotation: ` xyz`
tmp.py:5:6: F821 Undefined name `tuv`
</code></pre>
<p>I'm not quite sure what the best resolution is, maybe a warning on imports/defs that shadow <code>cast</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-27 17:27</div>
            <div class="timeline-body"><p>Ah yeah, it's assuming that <code>cast</code> is <code>typing.cast</code>. There's a TODO to ensure that we only treat those functions as <code>typing</code> features if they're <em>actually</em> imported from typing. (It's hard to do this 100% reliably without actually executing code, but even a basic check would be helpful here.)</p>
<p>I could try to work on that soon. In the interim, maybe you could alias your function? Like <code>from something import cast as scast</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-27 17:28</div>
            <div class="timeline-body"><p>(You'll run into this same problem for things like <code>NewType</code>, etc.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tgross35">@tgross35</a> on 2022-10-27 17:46</div>
            <div class="timeline-body"><p>No need to work on it any time soon, there are more important things! Aliasing is very workable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-10-29 22:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cpcloud">@cpcloud</a> on 2022-11-01 16:07</div>
            <div class="timeline-body"><p>This would be a blocker for using <code>ruff</code> with <a href="https://github.com/ibis-project/ibis"><code>ibis</code></a>.</p>
<p>We have <a href="https://github.com/ibis-project/ibis/search?q=%22.cast%22">many calls to our <code>cast</code> method</a> in the codebase.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-01 16:09</div>
            <div class="timeline-body"><p>Ok cool, that's really helpful to hear, will fix this soon!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-11-01 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-01 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-01 20:39</div>
            <div class="timeline-body"><p>This is going out in https://github.com/charliermarsh/ruff/releases/tag/v0.0.94 (building now). I tested it on <code>ibis</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tgross35">@tgross35</a> on 2022-11-01 20:47</div>
            <div class="timeline-body"><p>Charlie, you are too amazing. I don’t know how you manage such a fast turnaround on this project’s issues</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:25 UTC
    </footer>
</body>
</html>
