<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implicit concatenated f-string: Trailing end-of-line comment is moved - astral-sh/ruff #15375</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implicit concatenated f-string: Trailing end-of-line comment is moved</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15375">#15375</a>
        opened by <a href="https://github.com/joostlek">@joostlek</a>
        on 2025-01-09 14:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/joostlek">@joostlek</a></div>
            <div class="timeline-body"><p>Hey!</p>
<p>So I just started bumping ruff in Home Assistant core to 0.9.0 to match the 2025 python guidelines and I encountered a bug.</p>
<p>https://github.com/home-assistant/core/blob/a10d5c435a4b48c9c2549db28f966f2c08ba3a96/homeassistant/components/knx/climate.py#L212-L217</p>
<p><code>ruff</code> moved the <code>noqa: SLF001</code> to the next line, but the next run it starts to complain about that we access a private member.</p>
<p>2024:</p>
<pre><code class="language-py">        self._attr_unique_id = (
            f&quot;{self._device.temperature.group_address_state}_&quot;
            f&quot;{self._device.target_temperature.group_address_state}_&quot;
            f&quot;{self._device.target_temperature.group_address}_&quot;
            f&quot;{self._device._setpoint_shift.group_address}&quot;  # noqa: SLF001
        )
</code></pre>
<p>2025:</p>
<pre><code class="language-py">        self._attr_unique_id = (
            f&quot;{self._device.temperature.group_address_state}_&quot;
            f&quot;{self._device.target_temperature.group_address_state}_&quot;
            f&quot;{self._device.target_temperature.group_address}_&quot;
            f&quot;{self._device._setpoint_shift.group_address}&quot;
        )  # noqa: SLF001
</code></pre>
<pre><code>homeassistant/components/knx/climate.py:216:16: SLF001 Private member accessed: `_setpoint_shift`
    |
214 |             f&quot;{self._device.target_temperature.group_address_state}_&quot;
215 |             f&quot;{self._device.target_temperature.group_address}_&quot;
216 |             f&quot;{self._device._setpoint_shift.group_address}&quot;
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ SLF001
217 |         )  # noqa: SLF001
218 |         self.default_hvac_mode: HVACMode = config[
    |

Found 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joostlek">@joostlek</a> on 2025-01-09 14:44</div>
            <div class="timeline-body"><p>Found another one</p>
<p>2024</p>
<pre><code class="language-py">        return (
            f&quot;Exception in {call_back_name} when handling msg on &quot;
            f&quot;'{msg.topic}': '{msg.payload}'&quot;  # type: ignore[str-bytes-safe]
        )
</code></pre>
<p>2025</p>
<pre><code class="language-py">        return (
            f&quot;Exception in {call_back_name} when handling msg on &quot;
            f&quot;'{msg.topic}': '{msg.payload}'&quot;
        )  # type: ignore[str-bytes-safe]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2025-01-09 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-01-09 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-09 14:48</div>
            <div class="timeline-body"><p>Wow, you're quick with upgrading. I haven't been able to finish the release just yet :) Yes, this looks like a bug</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joostlek">@joostlek</a> on 2025-01-09 14:49</div>
            <div class="timeline-body"><p>It looked breaking and exciting so I couldn't hold myself ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2025-01-09 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-09 15:07</div>
            <div class="timeline-body"><p>Okay, I think I know how to fix this one. Thanks for reporting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "noqa gets moved to the new line" to "Implicit concatenated f-string: Trailing end-of-line comment is moved" by @MichaReiser on 2025-01-09 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-01-10 18:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:57 UTC
    </footer>
</body>
</html>
