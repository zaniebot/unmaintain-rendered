<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow (formatter?) config to never introduce implicitly concatenated strings or just accept that a check run will complain about it - astral-sh/ruff #14638</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow (formatter?) config to never introduce implicitly concatenated strings or just accept that a check run will complain about it</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14638">#14638</a>
        opened by <a href="https://github.com/jankatins">@jankatins</a>
        on 2024-11-27 16:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jankatins">@jankatins</a> on 2024-11-27 16:59</div>
            <div class="timeline-body"><p>I think implicitly concat'ed strings are pure evil since a time where I had to debug an accidentally added comma in a place where <code>+</code> would have been proper, which made a single string a tuple of two strings. I would like ruff to allow one to configure that &quot;no explicit string concat, and not fix it such a way, ever&quot; and not complain about such a config, but currently it does complain and IMO it complains for the wrong reasons and with the wrong solution:</p>
<p>I don't want it to stop complaining about implicitly concat'ed strings, but stop the formatter from introducing them by using a '+' between multiline strings. Or if the formatter needs to introduce implicitly concat'ed strings (because + would be a black violation), just let <code>ruff check</code> complain (when it happens), so I'm forced to fix it by hand (which I would be fine with). But having the scary warning in all runs makes me and especially unwary users scared into disabling that rule. :-(</p>
<p>Inspired by https://github.com/astral-sh/ruff/issues/13031#issuecomment-2302402183, I would have expected that</p>
<pre><code class="language-toml">[tool.ruff.lint]
extend-select = [&quot;ISC&quot;]
ignore=[&quot;ISC003&quot;] # Don't complain about explicitly concat'ed strings
unfixable = [&quot;ISC001&quot;] # don't fix one line implicitly concat'ed strings, but just complain and make the user fix it

[tool.ruff.lint.flake8-implicit-str-concat]
allow-multiline = false
</code></pre>
<p>would work, but ruff still complains, that this is incompatible with the formatter:</p>
<pre><code> The following rule may cause conflicts when used with the formatter: `ISC001`. To avoid unexpected behavior, we recommend disabling this rule, either by removing it from the `select` or `extend-select` configuration, or adding it to the `ignore` configuration.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-27 17:32</div>
            <div class="timeline-body"><p>I think what you're asking for will be addressed with the upcoming Ruff 2025 style guide (#13371). The relevant changes are:</p>
<ul>
<li>The formatter will merge implicitly concatenated strings that fit on a single line into a single string literal (there are a few edge cases where that's not possible but they are very rare)</li>
<li>The formatter will never collapse an implicit concatenated string https://github.com/astral-sh/ruff/pull/13928</li>
</ul>
<p>These two changes will make the formatter compatible with ISC001 (also see https://github.com/astral-sh/ruff/issues/8272).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2024-11-27 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-27 17:38</div>
            <div class="timeline-body"><blockquote>
<p>would work, but ruff still complains, that this is incompatible with the formatter:</p>
</blockquote>
<p>This might be a bug but I'm not sure if it's still worth fixing considering that the new style guide will be released shortly. But feel free to submit a PR that suppresses the warning if that setting is set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow (formatter?) config to never introduce implicit concatted strings or just accept that a check run will complain about it" to "Allow (formatter?) config to never introduce implicitly concatenated strings or just accept that a check run will complain about it" by @AlexWaygood on 2024-11-27 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jankatins">@jankatins</a> on 2024-11-28 00:36</div>
            <div class="timeline-body"><blockquote>
<p>The formatter will merge implicitly concatenated strings that fit on a single line into a single string literal (there are a few edge cases where that's not possible but they are very rare)</p>
</blockquote>
<p>This is actually something I don't want: up to now, all such cases of mine were bad coding from my side and in a lot of cases I had to pick a comma instead of a  plus. Just merging the strings will mean that <code>[&quot;A&quot;, &quot;B&quot; &quot;C&quot;]</code> will silently end up as <code>[&quot;A&quot;, &quot;BC&quot;]</code> which usually is a bug in my case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-28 06:50</div>
            <div class="timeline-body"><p>I see. So the problem here is that you introduce implicit concatenated strings and you want the formatter to leave them unchanged?</p>
<p>I don't think we should introduce an option for this because it is in direct conflict with consistent formatting. However, I do see how the formatter joining the strings can be &quot;annoying&quot; in an editor context. IMO, the benefit of the formatter joining the strings is that it becomes very apparent that you forgot a <code>,</code> and hitting Ctrl + Z in the editor should undo the formatter change.</p>
<blockquote>
<p>but stop the formatter from introducing them by using a '+' between multiline strings. Or if the formatter needs to introduce implicitly concat'ed strings (because + would be a black violation),</p>
</blockquote>
<p>The formatter never introduces implicit concatenated strings. It only formats implicit concatenated strings that were already present in the source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-02-17 08:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @MichaReiser on 2025-02-17 08:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-02-17 08:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2025-02-17 08:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:15 UTC
    </footer>
</body>
</html>
