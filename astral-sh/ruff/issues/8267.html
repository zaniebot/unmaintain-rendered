<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`format|lint.exclude` does not exclude directories - astral-sh/ruff #8267</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>format|lint.exclude</code> does not exclude directories</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8267">#8267</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-10-27 00:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Given:</p>
<pre><code>[tool.ruff.lint]
exclude = [&quot;directory&quot;]
</code></pre>
<p>with <code>foo.py</code> in <code>directory</code></p>
<pre><code>import os
</code></pre>
<pre><code>cargo run -p ruff_cli -- check .
    Finished dev [unoptimized + debuginfo] target(s) in 0.10s
     Running `/Users/crmarsh/workspace/ruff/target/debug/ruff check .`
warning: Detected debug build without --no-cache.
directory/foo.py:1:8: F401 [*] `os` imported but unused
Found 1 error.
</code></pre>
<p>The file is excluded when changing the configuration to</p>
<pre><code>[tool.ruff.lint]
exclude = [&quot;directory/*&quot;]
</code></pre>
<p>or</p>
<pre><code>[tool.ruff]
exclude = [&quot;directory&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-27 00:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-27 00:04</div>
            <div class="timeline-body"><p>I&#x27;m undecided if this is a bug or matches the documented behavior. It certainly is unexpected that the path works in one but not the other. But reading our documentation and globset, excluding the entire directory would require using <code>directory/**</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Formatter: Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-27 00:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-27 08:32</div>
            <div class="timeline-body"><p>(I&#x27;ve updated the second configuration to use <code>exclude = [&quot;directory/*&quot;]</code> which is what I think you meant?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-27 08:34</div>
            <div class="timeline-body"><blockquote>
<p>(I&#x27;ve updated the second configuration to use <code>exclude = [&quot;directory/*&quot;]</code> which is what I think you meant?)</p>
</blockquote>
<p>What was it before xD I think it works if <code>exclude</code> is either <code>&quot;directory/**</code>, <code>&quot;directory/*</code> or if using the global exclude.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-27 09:43</div>
            <div class="timeline-body"><p>This PR adds a test demonstrating the behavior.</p>
<p>https://github.com/astral-sh/ruff/pull/8276</p>
<p>I&#x27;m not sure how to fix this yet without trying to match all parent sub-paths of a file. The alternative is to change the semantics of <code>tool.exclude</code> to be explicit that it only matches on files. We may want to rename the option in that case (<code>exclude-files</code> or <code>file-ignores</code>). @charliermarsh any ideas/thoguhts on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-29 23:36</div>
            <div class="timeline-body"><p>I think I have an idea on how to approach this. It&#x27;s not elegant, but could work.</p>
<p>The idea is to add two patterns for each entry in <code>tool.exclude</code>:</p>
<ol>
<li>The pattern as specified in the configuration</li>
<li>The pattern with a <code>/**/*</code> suffix to ensure it matches all files if the pattern excludes a directory</li>
</ol>
<p>It may not always be necessary to add the extra pattern.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-30 00:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-30 03:18</div>
            <div class="timeline-body"><p>This could work. We should probably only check if it&#x27;s not already suffixed with a glob pattern (<code>*</code>, <code>**</code>, <code>**/*</code>, <code>*.{ext}</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-30 03:23</div>
            <div class="timeline-body"><p>Yeah, this could be an optimisation. But I&#x27;m not sure about: <code> *.{ext}</code> because you can have a <code>test/a.py</code> directory (not that I would recommend it but you can ;))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-30 03:27</div>
            <div class="timeline-body"><p>Haha yeah, although what I meant was the literal value if I&#x27;m not mis-interpreting what you said. So, ignoring <code>test/*.py</code> as that explicitly mentions the glob pattern.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-30 06:23</div>
            <div class="timeline-body"><p>I have to spend some more time on this to fully understand the semantics of <code>exclude</code>. I assumed it matches the <code>gitignore</code> syntax but aren&#x27;t so sure about it anymore.</p>
<p>For example, <code>logs</code> matches  <code>logs</code>, <code>logs/debug.log</code>, <code>logs/latest/foo.bar</code>,  <code>build/logs</code>, and <code>build/logs/debug.log</code> according to <a href="https://www.atlassian.com/git/tutorials/saving-changes/gitignore#git-ignore-patterns">atlassian</a>. I believe our system correctly handles directories called <code>logs</code> or files called logs, but not <code>build/logs/debug.log</code>.</p>
<p>The idea is to create a new integration test file that tests various exclusion patterns, and then try to come up with a fix. I wonder if we could rely more on the <code>ignore</code> crate, to model our own exclusions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-02 09:01</div>
            <div class="timeline-body"><p>Something similar to https://github.com/BurntSushi/ripgrep/blob/master/crates/ignore/src/gitignore.rs#L32-L43 could be useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Formatter: Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JP-Ellis">@JP-Ellis</a> on 2024-06-25 11:08</div>
            <div class="timeline-body"><p>I might just add that it might be worth aligning the behaviour with the <a href="https://git-scm.com/docs/gitignore#_pattern_format">gitignore specification</a>. Of relevance to directories:</p>
<blockquote>
<ul>
<li>The slash <code>/</code> is used as the directory separator. Separators may occur at the beginning, middle or end of the <code>.gitignore</code> search pattern.</li>
<li>If there is a separator at the end of the pattern then the pattern will only match directories, otherwise the pattern can match both files and directories.</li>
</ul>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-15 14:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theo-brown">@theo-brown</a> on 2025-10-07 14:49</div>
            <div class="timeline-body"><p>What&#x27;s the status of this?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:44 UTC
    </footer>
</body>
</html>
