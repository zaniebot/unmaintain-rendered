<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rewrite `os.environ.get` as `os.getenv` - astral-sh/ruff #3608</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rewrite `os.environ.get` as `os.getenv`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/3608">#3608</a>
        opened by <a href="https://github.com/janosh">@janosh</a>
        on 2023-03-19 15:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/janosh">@janosh</a> on 2023-03-19 15:36</div>
            <div class="timeline-body"><p><strong>Bad</strong></p>
<pre><code class="language-py">os.environ.get(secret)
os.environ.get(secret, &quot;fallback&quot;)
</code></pre>
<p><strong>Good</strong></p>
<pre><code class="language-py">os.getenv(secret)
os.getenv(secret, &quot;fallback&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-03-19 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-03-20 08:47</div>
            <div class="timeline-body"><p>I'm a bit hesitant of this change as in the CPython implementation (https://github.com/python/cpython/blob/5e6661bce968173fa45b74fa2111098645ff609c/Lib/os.py#L779-L783), they both are equivalent and there's no set recommendation to use one or the other.</p>
<p>However, there is a difference between <code>os.environ[key]</code> and <code>os.getenv(key)</code> where the former will raise a <code>KeyError</code> if the key doesn't exist in the environment.</p>
<p>Another thing to note is that in the documentation, there's this note regarding <strong>updating an environment variable:</strong></p>
<blockquote>
<p>Note Calling <a href="https://docs.python.org/3/library/os.html#os.putenv">putenv()</a> directly does not change <a href="https://docs.python.org/3/library/os.html#os.environ">os.environ</a>, so it’s better to modify <a href="https://docs.python.org/3/library/os.html#os.environ">os.environ</a>.</p>
<p><em>Ref</em>: https://docs.python.org/3/library/os.html#os.environ</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/janosh">@janosh</a> on 2023-03-20 14:49</div>
            <div class="timeline-body"><p>Just a suggestion. Feel free to close or put this in one of the opinionated rule sets.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tatsh">@Tatsh</a> on 2023-12-17 09:16</div>
            <div class="timeline-body"><p>I would actually recommend the opposite. putenv does not update os.environ. getenv caches os.environ at import time which can happen at the very first import in any given module.</p>
<blockquote>
<p>Note Calling putenv() directly does not change os.environ, so it’s better to modify os.environ.</p>
</blockquote>
<blockquote>
<p>Note that since getenv() uses os.environ, the mapping of getenv() is similarly also captured on import, and the function may not reflect future environment changes.</p>
</blockquote>
<p>I was searching if there was a rule to error when getenv/putenv are encountered to replace with os.environ. That would be a welcome addition and sadly I don't know enough Rust.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vir2S">@Vir2S</a> on 2024-11-22 08:46</div>
            <div class="timeline-body"><blockquote>
<p>I'm a bit hesitant of this change as in the CPython implementation (https://github.com/python/cpython/blob/5e6661bce968173fa45b74fa2111098645ff609c/Lib/os.py#L779-L783), they both are equivalent and there's no set recommendation to use one or the other.</p>
<p>However, there is a difference between <code>os.environ[key]</code> and <code>os.getenv(key)</code> where the former will raise a <code>KeyError</code> if the key doesn't exist in the environment.</p>
<p>Another thing to note is that in the documentation, there's this note regarding <strong>updating an environment variable:</strong></p>
<blockquote>
<p>Note Calling <a href="https://docs.python.org/3/library/os.html#os.putenv">putenv()</a> directly does not change <a href="https://docs.python.org/3/library/os.html#os.environ">os.environ</a>, so it’s better to modify <a href="https://docs.python.org/3/library/os.html#os.environ">os.environ</a>.
<em>Ref</em>: https://docs.python.org/3/library/os.html#os.environ</p>
</blockquote>
</blockquote>
<p>They are not totally equivalent)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TrevinAvery">@TrevinAvery</a> on 2025-03-22 01:37</div>
            <div class="timeline-body"><blockquote>
<p>I would actually recommend the opposite. putenv does not update os.environ. getenv caches os.environ at import time which can happen at the very first import in any given module.</p>
<blockquote>
<p>Note Calling putenv() directly does not change os.environ, so it’s better to modify os.environ.</p>
</blockquote>
<blockquote>
<p>Note that since getenv() uses os.environ, the mapping of getenv() is similarly also captured on import, and the function may not reflect future environment changes.</p>
</blockquote>
<p>I was searching if there was a rule to error when getenv/putenv are encountered to replace with os.environ. That would be a welcome addition and sadly I don't know enough Rust.</p>
</blockquote>
<p>I fully agree with this idea. I want my team's code base is using a single path to modify the environment. My current use case: I was just trying to find where an environment variable was being loaded and searched for <code>os.environ</code>. To my surprise, I didn't find it. In this situation, I didn't know the name of the environment variable, so this was my only option. I like knowing that I can see all entries with a simple search.</p>
<p>I would recommend that <code>os.getenv</code> be replaced by <code>os.environ.get</code>, as suggested above, because it would be more &quot;pythonic&quot;, and likely have less confusion. Why not just directly access a dictionary that is mutable, allowing the expected behavior when an update is made? This seems much easier to understand.</p>
<p>Ultimately, I am in favor of enabling people to have their preferences, and thus I suggest we have a rule that allows a preference for either one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jhbuhrman">@jhbuhrman</a> on 2025-07-04 15:49</div>
            <div class="timeline-body"><blockquote>
<p>[...]
Ultimately, I am in favor of enabling people to have their preferences, and thus I suggest we have a rule that allows a preference for either one.</p>
</blockquote>
<p>Although in general this is a humble line of thinking, I guess the argument in https://github.com/astral-sh/ruff/issues/3608#issuecomment-1859082473 counts much heavier, so I'm quite in favor to ban the use of <code>os.{put,get}env()</code> completely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sergiitk">@sergiitk</a> on 2025-08-07 21:25</div>
            <div class="timeline-body"><p>While Python documentation doesn't have a recommendation for the prefered way to get environment variables, it's pretty clear about modifying them:</p>
<blockquote>
<p>Assignments to items in <a href="https://docs.python.org/3.13/library/os.html#os.environ"><code>os.environ</code></a> are automatically translated into corresponding calls to <a href="https://docs.python.org/3.13/library/os.html#os.putenv"><code>putenv()</code></a>; however, calls to <a href="https://docs.python.org/3.13/library/os.html#os.putenv"><code>putenv()</code></a> don’t update <a href="https://docs.python.org/3.13/library/os.html#os.environ"><code>os.environ</code></a>, <strong>so it is actually preferable to assign to items of <a href="https://docs.python.org/3.13/library/os.html#os.environ"><code>os.environ</code></a></strong>.
— https://docs.python.org/3.13/library/os.html#os.putenv</p>
</blockquote>
<p>And <a href="https://docs.python.org/3.13/library/os.html#os.unsetenv"><code>os.unsetenv()</code></a> has the same note on preferring <code>os.environ</code> for deleting env vars.
Note that updates to <code>os.environ</code> are automatically forwarded to <a href="https://docs.python.org/3.13/library/os.html#os.environb"><code>os.environb</code></a>.</p>
<p>IMO it makes sense to prefer <code>os.environ.get()</code> over <code>os.getenv()</code> to be consistent with the recommended way to modify the env vars. For example, one might incorrectly chose to use suboptimal <code>os.putenv()</code> just because they saw <code>os.getenv()</code> elsewhere in the same file, while if we used <code>os.environ.get()</code> they're more likely to default to the prefered <code>os.environ.put()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../grpc/proposal/pulls/505.html">grpc/proposal#505</a> on 2025-08-12 19:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
