```yaml
number: 16232
title: F841 false positive in match case with constant
type: issue
state: closed
author: ember91
labels:
  - question
assignees: []
created_at: 2025-02-18T15:28:25Z
updated_at: 2025-02-18T22:19:44Z
url: https://github.com/astral-sh/ruff/issues/16232
synced_at: 2026-01-10T01:56:55Z
```

# F841 false positive in match case with constant

---

_Issue opened by @ember91 on 2025-02-18 15:28_

### Description

List of keywords searched before creating this issue:

  - `F841`
 
Minimal code snippet that reproduces the bug:

```python
# test.py
C = 13

def f():
    match 13:
        case C:
            pass
```

Invoked command:

```bash
ruff check --isolated --select F841 test.py
```

Current Ruff settings: -

Current Ruff version: `ruff 0.9.6`

I expected it to not mark line 6 with `F841`.

---

_Comment by @ntBre on 2025-02-18 15:39_

I think this is a true positive because Python doesn't treat the `C` in the `case` as a constant:

```console
>>> C = 13
>>> match 2:
...     case C:
...         print(C)
...
2
```

It should actually probably mark both `C = 13` *and* `case C` as unused.

I believe you have to use an [enum](https://peps.python.org/pep-0636/#matching-against-constants-and-enums) (or other dotted name) to match against a constant like this.

---

_Label `question` added by @ntBre on 2025-02-18 15:42_

---

_Comment by @ember91 on 2025-02-18 16:01_

Wait, is it pattern matching my constant?

If so I guess the behavior's correct. It's defining a variable and it's unused. Just a bit confusing.

I think you can close this one.

---

_Comment by @ntBre on 2025-02-18 16:34_

Yeah I find this behavior very tricky and have run into it myself before :)

I'll keep the issue open for now to see if we could possibly emit two warnings here. That's what Rust does, for example:

```rust
fn main() {
    let c = 1;  // unused variable
    match 2 {
        c => {} // unused variable
    }
}
``` 

I think that would also help to clarify the `case` issue, at least a little bit.

---

_Closed by @ntBre on 2025-02-18 21:59_

---

_Reopened by @ntBre on 2025-02-18 22:06_

---

_Comment by @ntBre on 2025-02-18 22:18_

I took a closer look at this, and this *is* a bug that we'd like to fix with the Rust-style behavior, but it's being tracked in https://github.com/astral-sh/ruff/issues/6704, so I *will* close this for now. Thanks for opening the issue!

---

_Closed by @ntBre on 2025-02-18 22:18_

---

_Closed by @ntBre on 2025-02-18 22:19_

---
