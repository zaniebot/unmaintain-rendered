<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--exclude glob patterns don't match on Windows - astral-sh/ruff #22612</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--exclude glob patterns don't match on Windows</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22612">#22612</a>
        opened by <a href="https://github.com/ahochheiden">@ahochheiden</a>
        on 2026-01-15 23:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ahochheiden">@ahochheiden</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Glob patterns passed to <code>--exclude</code> work correctly on <code>macOS</code> but fail to match on <code>Windows</code>.</p>
<p><strong>Context:</strong>
I discovered this while migrating Firefox from <code>black</code> to <code>ruff format</code>. The <a href="https://searchfox.org/firefox-main/source/pyproject.toml#82">pyproject.toml</a> exclusions use glob patterns that work correctly on <code>macOS</code> but not on <code>Windows</code>.</p>
<p><strong>Steps to reproduce:</strong></p>
<p>Given a file that has formatting issues at  <code>build/moz.configure/bindgen.configure</code> :</p>
<ul>
<li>Run <code>ruff format --check --force-exclude --exclude &quot;build/moz.configure/*.configure&quot; build/moz.configure/bindgen.configure</code></li>
</ul>
<p>Result:</p>
<pre><code>/d/mozilla-source/firefox
$ ruff format --check --force-exclude --exclude &quot;build/moz.configure/*.configure&quot; build/moz.configure/bindgen.configure
unformatted: File would be reformatted
   --&gt; build\moz.configure\bindgen.configure:1:1
30  |     Please update using 'cargo install cbindgen --force' or running
31  |     './mach bootstrap', after removing the existing executable located at
32  |     {}.
    -     &quot;&quot;&quot;.format(
    -                 version, cbindgen_min_version, cbindgen
    -             )
33  +     &quot;&quot;&quot;.format(version, cbindgen_min_version, cbindgen)
34  |         )
35  |     )
36  |
</code></pre>
<p>Expected result:</p>
<pre><code>warning: No Python files found under the given path(s)
</code></pre>
<p>Note: Explicit path works fine:</p>
<pre><code>/d/mozilla-source/firefox
$ ruff format --check --force-exclude --exclude &quot;build/moz.configure&quot; build/moz.configure/bindgen.configure
warning: No Python files found under the given path(s)
</code></pre>
<h3>Version</h3>
<p>ruff 0.14.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @amyreese on 2026-01-16 02:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-16 02:01</div>
            <div class="timeline-body"><p>Is this a directory separator issue? What happens if you use backslashes in your exclude glob instead of forward slashes?  Eg,</p>
<pre><code>$ ruff format --check --force-exclude --exclude &quot;build\moz.configure\*.configure&quot; build\moz.configure\bindgen.configure
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ahochheiden">@ahochheiden</a> on 2026-01-16 02:26</div>
            <div class="timeline-body"><p>That yields the usual output, and this at the end:</p>
<pre><code>io: D:\mozilla-source\firefox-fresh\buildmoz.configurebindgen.configure: The system cannot find the file specified. (os error 2)
--&gt; buildmoz.configurebindgen.configure:1:1
</code></pre>
<p>Which is from MSYS eating the backslashes as escape sequences.</p>
<p>But we can get around that with <code>ruff format --check --force-exclude --exclude &quot;build\\moz.configure\\*.configure&quot; &quot;build\\moz.configure\\bindgen.configure&quot;</code></p>
<p>But that also doesn't work:</p>
<pre><code>/d/mozilla-source/firefox-fresh
$ ruff format --check --force-exclude --exclude &quot;build\\moz.configure\\*.configure&quot; 'build\moz.configure\bindgen.configure'
unformatted: File would be reformatted
   --&gt; build\moz.configure\bindgen.configure:1:1
30  |     Please update using 'cargo install cbindgen --force' or running
31  |     './mach bootstrap', after removing the existing executable located at
32  |     {}.
    -     &quot;&quot;&quot;.format(
    -                 version, cbindgen_min_version, cbindgen
    -             )
33  +     &quot;&quot;&quot;.format(version, cbindgen_min_version, cbindgen)
34  |         )
35  |     )
36  |
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @amyreese on 2026-01-16 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @amyreese on 2026-01-16 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @amyreese on 2026-01-16 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ahochheiden">@ahochheiden</a> on 2026-01-16 05:27</div>
            <div class="timeline-body"><pre><code>/d/mozilla-source/firefox-fresh
$ ruff format --check --force-exclude --exclude=&quot;build/moz.configure/*.configure&quot; build/moz.configure/bindgen.configure
warning: No Python files found under the given path(s)
</code></pre>
<p>That works. So it seems the issue is with how glob patterns are expanded when using <code>--exclude &quot;pattern&quot;</code> vs <code>--exclude=&quot;pattern&quot;</code> on Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ahochheiden">@ahochheiden</a> on 2026-01-16 05:53</div>
            <div class="timeline-body"><p>I think this is the culprit: https://github.com/astral-sh/ruff/blob/0ce5ce4de11c7e3dc3aa131287c671618e61c014/crates/ruff/src/main.rs#L42</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-16 05:56:35 UTC
    </footer>
</body>
</html>
