<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff` disregards per file ignore on `E402` - astral-sh/ruff #9246</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`ruff` disregards per file ignore on `E402`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9246">#9246</a>
        opened by <a href="https://github.com/niccolomineo">@niccolomineo</a>
        on 2023-12-22 15:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/niccolomineo">@niccolomineo</a> on 2023-12-22 15:02</div>
            <div class="timeline-body"><p>For some reason the following directive is ignored:</p>
<pre><code>&quot;myproject/*sgi.py&quot; = [
    &quot;E402&quot;,
]
</code></pre>
<p>Issue:</p>
<pre><code>$ ruff . --fix
myproject/wsgi.py:15:1: E402 Module level import not at top of file
Found 1 error.
$ ruff --version
ruff 0.1.9
</code></pre>
<p>Relevant settings:</p>
<pre><code>[tool.ruff]
ignore = [
    &quot;D203&quot;,
    &quot;D212&quot;,
]
select = [
    &quot;A&quot;,      # flake8-builtins
    &quot;B&quot;,      # flake8-bugbear
    &quot;C4&quot;,     # flake8-comprehensions
    &quot;C90&quot;,    # McCabe cyclomatic complexity
    &quot;D&quot;,      # pydocstyle
    &quot;DJ&quot;,     # flake8-django
    &quot;E&quot;,      # pycodestyle errors
    &quot;F&quot;,      # Pyflakes
    &quot;I&quot;,      # isort
    &quot;Q&quot;,      # flake8-quotes
    &quot;UP&quot;,     # pyupgrade
    &quot;W&quot;,      # pycodestyle warnings
]
target-version = &quot;py312&quot;

[tool.ruff.per-file-ignores]
&quot;myproject/*sgi.py&quot; = [
    &quot;E402&quot;,
]
&quot;*/migrations/*.py&quot; = [
    &quot;D100&quot;,
    &quot;D101&quot;,
    &quot;D102&quot;,
    &quot;D104&quot;,
]

[tool.ruff.isort]
known-first-party = [
    &quot;myproject&quot;,
]
known-third-party = [
    &quot;django&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`ruff` ignores directive" to "`ruff` disregards per file ignore on `E402`" by @niccolomineo on 2023-12-22 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-22 15:06</div>
            <div class="timeline-body"><p>@niccolomineo - It looks like you're using <code>myproject</code> in the configuration file, but the directory on disk is called <code>project</code> (&quot;project/wsgi.py:15:1: E402 Module level import not at top of file&quot;). Could that be the culprit?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-12-22 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/niccolomineo">@niccolomineo</a> on 2023-12-22 15:07</div>
            <div class="timeline-body"><blockquote>
<p>@niccolomineo - It looks like you're using <code>myproject</code> in the configuration file, but the directory on disk is called <code>project</code> (&quot;project/wsgi.py:15:1: E402 Module level import not at top of file&quot;). Could that be the culprit?</p>
</blockquote>
<p>Sorry, double checked and it's my bad (I just failed at manually obfuscating the real dir name).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/niccolomineo">@niccolomineo</a> on 2023-12-22 15:17</div>
            <div class="timeline-body"><p>The issue unfortunately still stands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/niccolomineo">@niccolomineo</a> on 2023-12-22 15:35</div>
            <div class="timeline-body"><p>@charliermarsh I see what the problem is. Those rules I reported in the opening post are in my <code>pyproject.toml</code>, but I also added a <code>ruff.toml</code> with the sole following rule:</p>
<pre><code>[format]
docstring-code-format = true
</code></pre>
<p>I guess <code>ruff.toml</code> is overriding <code>pyproject.toml</code>. Do I need to move all <code>ruff</code> related rules currently in <code>pyproject.toml</code> to <code>ruff.toml</code>? I'd prefer to move the <code>docstring-code-format = true</code> rule only. If this is possible, what's the right syntax?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/niccolomineo">@niccolomineo</a> on 2023-12-22 15:40</div>
            <div class="timeline-body"><p>It looks like <code>tool.ruff.format</code> is correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @niccolomineo on 2023-12-22 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-22 15:51</div>
            <div class="timeline-body"><p>üëç That's right!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:11 UTC
    </footer>
</body>
</html>
