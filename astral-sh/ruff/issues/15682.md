```yaml
number: 15682
title: "`unused-noqa` (`RUF100`) - false negatives and strange behavior with multiple codes"
type: issue
state: closed
author: DetachHead
labels:
  - bug
  - help wanted
assignees: []
created_at: 2025-01-23T07:29:57Z
updated_at: 2025-03-19T11:12:54Z
url: https://github.com/astral-sh/ruff/issues/15682
synced_at: 2026-01-10T01:56:55Z
```

# `unused-noqa` (`RUF100`) - false negatives and strange behavior with multiple codes

---

_Issue opened by @DetachHead on 2025-01-23 07:29_

### Description

i assume this is an unintentional bug in the logic that allows you to add additional information to noqa comments:

```py
# noqa: D103 this function is self-documenting
```

but ruff should enforce a space between the code and any additional comments. currently it doesn't seem to do so. it also seems to allow certain completely invalid codes:

```py
# no error even though these aren't valid codes:
def foo(): ... # noqa: D103a
# noqa: Z
```

interestingly, these are treated as two separate codes:
```py
def foo(): ... # noqa: D103F811
```
i think it should instead be an error and force the user to separate them with a comma like this:

```py
def foo(): ... # noqa: D103,F811
```

https://play.ruff.rs/2b3608e9-f97a-459a-960b-f702827ef4e4

---

_Comment by @MichaReiser on 2025-01-23 07:41_

Thanks, I think we miss a check for `leading_space` to be `!= 0` here

https://github.com/astral-sh/ruff/blob/c39ca8fe6d3fb77684d2919a58b77cca95671ab7/crates/ruff_linter/src/noqa.rs#L105-L128

---

_Label `bug` added by @MichaReiser on 2025-01-23 07:41_

---

_Label `help wanted` added by @MichaReiser on 2025-01-23 07:41_

---

_Comment by @InSyncWithFoo on 2025-01-23 13:22_

See also #12809 and #14229. I posted [a comment](https://github.com/astral-sh/ruff/pull/14229#discussion_r1835481018) at the latter, but perhaps Charlie never saw it.

@MichaReiser Considering what happened in the two aforementioned PRs, this will require a design decision. What do you say?

---

_Comment by @MichaReiser on 2025-01-23 13:36_

Can you tell me more about the design decisions you see? 

These could also be multiple fixes:

* `D103F811`: Should not be treated as two rules
* `D103a`: Handle content after a rule code

---

_Comment by @InSyncWithFoo on 2025-01-23 13:49_

@MichaReiser #12809 made it so that `D103F811` is treated as one code for both file-level and line-level `# noqa`s. #14229 reverted it for line-level, but not for file-level. The result is now inconsistent:

```python
# This hides the two diagnostics
print(list(sorted()))  # noqa: T201C413
```

```python
# This doesn't, and the joint code is not reported as invalid.
# ruff: noqa: T201C413
print(list(sorted()))
```

My question never got an answer, so I assume that it is desired to keep this inconsistency. If you say otherwise, I can work on a fix. The PR will have concrete examples as well as how to deal with those and we can go from there.

---

_Comment by @MichaReiser on 2025-01-23 13:59_

Oh, so the problem linked in #14229 is that we incorrectly parsed text coming after a code as a noqa code. 

That means we have to define a heuristic of what we treat as codes and what as non-code. 

I also just found https://github.com/astral-sh/ruff/pull/12811

---

_Referenced in [astral-sh/ruff#12811](../../astral-sh/ruff/pulls/12811.md) on 2025-01-23 13:59_

---

_Referenced in [astral-sh/ruff#15940](../../astral-sh/ruff/issues/15940.md) on 2025-02-04 15:08_

---

_Referenced in [astral-sh/ruff#8157](../../astral-sh/ruff/issues/8157.md) on 2025-02-06 02:15_

---

_Referenced in [astral-sh/ruff#16483](../../astral-sh/ruff/pulls/16483.md) on 2025-03-03 21:31_

---

_Closed by @MichaReiser on 2025-03-13 14:37_

---

_Comment by @DetachHead on 2025-03-19 10:50_

thes issues seem to still be present in 0.11.0 ([same playground link](https://play.ruff.rs/2b3608e9-f97a-459a-960b-f702827ef4e4))

---

_Comment by @dylwil3 on 2025-03-19 11:12_

This matches the [specification](https://docs.astral.sh/ruff/linter/#full-suppression-comment-specification) we settled on. In particular:

1. The directives `D103a` and `Z` are not interpreted as codes, not enforced, and log warnings to the user.
2. The directive `D103F811` is interpreted and enforced but logs a warning to the user for a missing delimiter.

With your example:

```python
# no error even though these aren't valid codes: #(added by me: actually, this _does_ log an error!)
def foo(): ... # noqa: D103a
# noqa: Z

# these are treated as two separate codes:
def bar(): ... # noqa: D103F811
```

we get:

```console
‚ùØ ruff check --isolated --no-cache --select D103,F811 noqa.py
warning: Invalid `# noqa` directive on noqa.py:2: expected code to consist of uppercase letters followed by digits only (e.g. `F401`)
warning: Invalid `# noqa` directive on noqa.py:3: expected a comma-separated list of codes (e.g., `# noqa: F401, F841`).
warning: Missing or joined rule code(s) at noqa.py:6: expected comma or space delimiter between codes
noqa.py:2:5: D103 Missing docstring in public function
  |
1 | # no error even though these aren't valid codes:
2 | def foo(): ... # noqa: D103a
  |     ^^^ D103
3 | # noqa: Z
  |

Found 1 error.
```

---
