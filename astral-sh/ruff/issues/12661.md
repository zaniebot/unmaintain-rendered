```yaml
number: 12661
title: 0.5.6 fails to build on 32bit architectures
type: issue
state: closed
author: WhyNotHugo
labels: []
assignees: []
created_at: 2024-08-04T14:24:02Z
updated_at: 2024-08-05T06:50:33Z
url: https://github.com/astral-sh/ruff/issues/12661
synced_at: 2026-01-10T01:56:53Z
```

# 0.5.6 fails to build on 32bit architectures

---

_Issue opened by @WhyNotHugo on 2024-08-04 14:24_

Builds fail on anything that's not 64bit due to an overflow:

```
   Compiling ruff_python_stdlib v0.0.0 (/builds/WhyNotHugo/aports/community/ruff/src/ruff-0.5.6/crates/ruff_python_stdlib)
error[E0080]: evaluation of constant value failed
  --> /rustc/051478957371ee0084a7c0913941d2a8c4757bb9/library/core/src/num/mod.rs:1245:5
  ::: /rustc/051478957371ee0084a7c0913941d2a8c4757bb9/library/core/src/num/mod.rs:1263:5
   |
   = note: attempt to compute `65536_usize * 65536_usize`, which would overflow
   |
note: inside `core::num::<impl usize>::pow`
  --> /rustc/051478957371ee0084a7c0913941d2a8c4757bb9/library/core/src/num/mod.rs:1245:5
note: inside `cumulative_capacity`
  --> /home/buildozer/.cargo/registry/src/index.crates.io-1cd66030c949c28d/orx-split-vec-3.2.0/src/growth/doubling/constants.rs:8:5
   |
8  |     usize::pow(2, (fragment_idx + FIRST_FRAGMENT_CAPACITY_POW + 1) as u32) - FIRST_FRAGMENT_CAPACITY
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
note: inside `doubling::constants::CUMULATIVE_CAPACITIES`
  --> /home/buildozer/.cargo/registry/src/index.crates.io-1cd66030c949c28d/orx-split-vec-3.2.0/src/growth/doubling/constants.rs:42:5
   |
42 |     cumulative_capacity(29),
   |     ^^^^^^^^^^^^^^^^^^^^^^^
   = note: this error originates in the macro `uint_impl` (in Nightly builds, run with -Z macro-backtrace for more info)
   Compiling webpki-roots v0.26.1
   Compiling env_logger v0.11.5
   Compiling hashbrown v0.14.5
   Compiling parking_lot v0.12.3
note: erroneous constant encountered
   --> /home/buildozer/.cargo/registry/src/index.crates.io-1cd66030c949c28d/orx-split-vec-3.2.0/src/growth/doubling/doubling_growth.rs:123:9
    |
123 |         CUMULATIVE_CAPACITIES[fragments_capacity]
    |         ^^^^^^^^^^^^^^^^^^^^^
note: erroneous constant encountered
   --> /home/buildozer/.cargo/registry/src/index.crates.io-1cd66030c949c28d/orx-split-vec-3.2.0/src/growth/doubling/doubling_growth.rs:146:13
    |
146 |             CUMULATIVE_CAPACITIES[CUMULATIVE_CAPACITIES.len() - 1]
    |             ^^^^^^^^^^^^^^^^^^^^^
note: erroneous constant encountered
   --> /home/buildozer/.cargo/registry/src/index.crates.io-1cd66030c949c28d/orx-split-vec-3.2.0/src/growth/doubling/doubling_growth.rs:157:29
    |
157 |         (f, element_index - CUMULATIVE_CAPACITIES[f])
    |                             ^^^^^^^^^^^^^^^^^^^^^
note: erroneous constant encountered
  --> /home/buildozer/.cargo/registry/src/index.crates.io-1cd66030c949c28d/orx-split-vec-3.2.0/src/growth/doubling/from.rs:35:29
   |
35 |             let capacity = &CUMULATIVE_CAPACITIES[curr_f];
   |                             ^^^^^^^^^^^^^^^^^^^^^
For more information about this error, try `rustc --explain E0080`.
error: could not compile `orx-split-vec` (lib) due to 1 previous error
warning: build failed, waiting for other jobs to finish...
```

Tested on [armv7](https://gitlab.alpinelinux.org/WhyNotHugo/aports/-/jobs/1472533), [armhf](https://gitlab.alpinelinux.org/WhyNotHugo/aports/-/jobs/1472534) and [x86](https://gitlab.alpinelinux.org/WhyNotHugo/aports/-/jobs/1472529).

---

_Renamed from "0.5.6 fails to build on anything that's not 64bit" to "0.5.6 fails to build on 32bit architectures" by @WhyNotHugo on 2024-08-04 14:34_

---

_Comment by @nekopsykose on 2024-08-04 15:27_

should be fixed by https://github.com/orxfun/orx-split-vec/pull/45 (once merged, etc)

---

_Comment by @MichaReiser on 2024-08-04 19:29_

I can fix this tomorrow by replacing the dependency. 

---

_Assigned to @MichaReiser by @MichaReiser on 2024-08-04 19:29_

---

_Referenced in [astral-sh/ruff#12679](../../astral-sh/ruff/pulls/12679.md) on 2024-08-05 06:42_

---

_Closed by @MichaReiser on 2024-08-05 06:50_

---

_Referenced in [astral-sh/ruff#13009](../../astral-sh/ruff/issues/13009.md) on 2024-08-20 17:37_

---
