<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: long walrus operator expression introduces parentheses  - astral-sh/ruff #8546</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: long walrus operator expression introduces parentheses</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8546">#8546</a>
        opened by <a href="https://github.com/tjkuson">@tjkuson</a>
        on 2023-11-07 18:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-11-07 18:37</div>
            <div class="timeline-body"><p>This seems similar to #7246 which was closed as completed, but reproducible in the latest <code>0.1.4</code> release.</p>
<p>Input:</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if foo := some.very.very.very.very.very.very.very.very.very.long.function(
                    search.study_id
                ):
                    pass
</code></pre>
<p>Ruff formatter output:</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if (
                    foo
                    := some.very.very.very.very.very.very.very.very.very.long.function(
                        search.study_id
                    )
                ):
                    pass
</code></pre>
<p>Black doesn't make any changes to the input file.</p>
<p><a href="https://play.ruff.rs/c29224dd-283a-4c24-b96a-68f1da225743">Ruff playground</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-11-07 18:43</div>
            <div class="timeline-body"><p>Behaviour is the same for long method chains.</p>
<p>Input:</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if foo == some.very.very.very.very.very.very.very.very.long_function_name(
                    bar
                ):
                    pass
</code></pre>
<p>Output:</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if (
                    foo
                    == some.very.very.very.very.very.very.very.very.long_function_name(
                        bar
                    )
                ):
                    pass
</code></pre>
<p>EDIT: I marked this as outdated as the revised reproduction in the original post now details this behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @charliermarsh on 2023-11-07 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-07 22:39</div>
            <div class="timeline-body"><p>I see the same behavior in Black, or am I misunderstanding?</p>
<p>https://black.vercel.app/?version=main&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AFGAIRdAD2IimZxl1N_Wlws4TBexXdmg613D2cRmmkK6QFkhhlNwTAUx4cz8BUeWx-cuwgYYrUzOEI2SVBXlwXRQgtbOqCvafh3iEcmeVpQMwvjow_MFJgqFPO0sgLW_4N7UAXeDoEHF1scyvxK89Ro-KbTojpHo8ZMycPjVc16iGNlSFE4PBe88ADJBimajoVexAABoAHHAgAAUu43D7HEZ_sCAAAAAARZWg==</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-11-07 22:54</div>
            <div class="timeline-body"><p>Sorry, I made an error in the reproduction!</p>
<p>Input:</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if foo := some.very.very.very.very.very.very.very.very.very.long.function(
                    search.study_id
                ):
                    pass
</code></pre>
<p>Ruff</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if (
                    foo
                    := some.very.very.very.very.very.very.very.very.very.long.function(
                        search.study_id
                    )
                ):
                    pass
</code></pre>
<p>Black</p>
<pre><code class="language-python">if True:
    if True:
        if True:
            if True:
                if foo := some.very.very.very.very.very.very.very.very.very.long.function(
                    search.study_id
                ):
                    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-11-07 22:56</div>
            <div class="timeline-body"><p>(I've updated the original post to include the proper reproduction.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: long comparison introduces parentheses " to "Formatter: long assignment expression introduces parentheses " by @tjkuson on 2023-11-07 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-11-08 00:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: long assignment expression introduces parentheses " to "Formatter: long walrus operator expression introduces parentheses " by @MichaReiser on 2023-11-27 11:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 11:35</div>
            <div class="timeline-body"><p>It seems that black formats the walrus operator more closely to assignments where it only breaks the right but never the left (or before/after the operator), even if doing so would help fitting the content on the line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Stable" by @MichaReiser on 2023-11-27 11:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2023-11-28 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Stable" by @MichaReiser on 2024-02-13 11:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2024-02-15 09:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:54 UTC
    </footer>
</body>
</html>
