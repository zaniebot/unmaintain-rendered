<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question: Motivation for using nightly Rust - astral-sh/ruff #2245</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Question: Motivation for using nightly Rust</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2245">#2245</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-01-27 10:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>I've started contributing to ruff and was surprised why the clippy and rustfmt jobs failed on my PR, but they both passed locally. I then studied the CI logs and noticed that the CI uses the Rust nightly channels for clippy and formatting. I should have known to use the nightly channel because the CONTRIBUTING.md that states clearly the use of the nightly channel for linting and formatting. Nevertheless, having to use the nightly channels made it harder for me to contribute because I had to figure out how to update my outdated nightly channel installation, and I also didn't know which version to install (nightly is a moving target).</p>
<p>That's why I wanted to raise the question of the motivation behind using the nightly channel. Is there a plan to move off nightly after certain features lands in stable? Are these features so important to us (e.g. missing some rustfmt options) to justify the added burden for contributors?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-27 12:57</div>
            <div class="timeline-body"><p>Great question and something I'd love to get more input on.</p>
<p>The use of nightly, to me, is entirely about the availability of the various <code>rustfmt</code> options:</p>
<ul>
<li><code>condense_wildcard_suffixes</code></li>
<li><code>format_strings</code></li>
<li><code>group_imports</code></li>
<li><code>hex_literal_case</code></li>
<li><code>imports_granularity</code></li>
<li><code>normalize_comments</code></li>
<li><code>normalize_doc_attributes</code></li>
<li><code>reorder_impl_items</code></li>
<li><code>wrap_comments</code></li>
</ul>
<p>(Off the top of my head, I don't know if we rely on any <code>clippy</code> checks that aren't in stable (do any such checks exist?). The decision to use nightly was entirely motivated by <code>rustfmt</code>.)</p>
<p>Some of these are nice-to-haves, some I find very useful and would, admittedly, be sad to lose -- most of all, I think, is the comment wrapping and normalization. But, I'm willing to be convinced that these aren't worth the added burden. (The good thing here is that removing these options wouldn't trigger any formatting changes to the existing code; they'd just prevent them from being applied going forward.)</p>
<p>To make them explicit, here are a few things to consider as we make this decision:</p>
<ol>
<li>How much do we care about these extra <code>rustfmt</code> options?</li>
<li>Is there any sense for when we'd expect these to arrive in stable? (Not your responsibility to answer -- if anything, it's mine as the person that introducer the changes.)</li>
<li>Would we ever use nightly Rust &quot;everywhere&quot;, to avoid the distinction between build and dev targets? (This likely introduces a lot of the same problems, but it's worth asking.)</li>
</ol>
<p>For now, I'm leaning on reverting given that this isn't the first time it's come up, and we can always reintroduce them later when they stabilize.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-01-27 12:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-27 13:14</div>
            <div class="timeline-body"><p>I have actually found the comment wrapping to be annoying.^^ Since when refactoring I sometimes comment out a bunch of code temporarily only for the reformatting to break the code on save (since I have my editor configured to run <code>rustfmt</code> on save).</p>
<p>Anyway I agree that switching to stable <code>rustfmt</code> probably makes sense to make contributing easier.</p>
<blockquote>
<p>I had to figure out how to update my outdated nightly channel installation</p>
</blockquote>
<p>Usually just <code>rustup update</code> does the job.</p>
<blockquote>
<p>Would we ever use nightly Rust &quot;everywhere&quot;, to avoid the distinction between build and dev targets?</p>
</blockquote>
<p>I am confused by what you mean with &quot;build and dev targets&quot; ... our release builds use stable ... the test builds in the CI use stable ... all the targets work on stable. Maybe you meant toolchain rather than targets?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-27 13:17</div>
            <div class="timeline-body"><blockquote>
<p>Maybe you meant toolchain rather than targets?</p>
</blockquote>
<p>Yup, that's what I meant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-27 14:27</div>
            <div class="timeline-body"><p>I can vouch that the nightly formatters have broken my code before. It split a string in between the '' and 'n', turning a newline character into an 'n'. Not the end of the world of course, but it was annoying.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-27 17:21</div>
            <div class="timeline-body"><p>Alright, let's nix it! I can remove later today, but anyone is welcome to beat me to it.</p>
<p>(I assume @MichaReiser has no objections but would be great to have his thumbs-up as the original author of the issue.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-01-27 18:06</div>
            <div class="timeline-body"><p>Sounds good to me. Not having <code>group_imports</code> and <code>imports_granularity</code> will certainly result in messier use statements but can be easily solved once the options become stable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-01-27 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-27 23:35</div>
            <div class="timeline-body"><p>Closed by #2278.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-27 23:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:46:13 UTC
    </footer>
</body>
</html>
