<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Though about formatting mathematical code - astral-sh/ruff #21925</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Though about formatting mathematical code</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/21925">#21925</a>
        opened by <a href="https://github.com/maxtremblay">@maxtremblay</a>
        on 2025-12-11 17:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/maxtremblay">@maxtremblay</a> on 2025-12-11 17:51</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I want to implement the following trigonometric expression as part of a larger calculation.</p>
<pre><code class="language-math">f(\vec{x}) = cos(x_1) \cdot sin(x_2) - cos(x_0) \cdot sin(x_1) \cdot cos(x_2)
</code></pre>
<p>However, I find that the formatting with ruff of such expression can be weird.</p>
<pre><code class="language-python">computation_outcome = jnp.cos(x[1]) * jnp.sin(x[2]) - jnp.cos(x[0]) * jnp.sin(
    x[1]
) * jnp.cos(x[2])
</code></pre>
<p>This is an example amongst many others. In general, I find that formatting code with multiple calls to simple functions with some of the functions split on three lines yields weird looking results.</p>
<p>In opposition, compare the following code formatted with ruff.</p>
<pre><code class="language-python">class Something:
    def __init__(self):
        self.x = 0

    def function(self, x):
        self.x = x
        return self


a = (
    Something()
    .function(1)
    .function(2)
    .function(3)
    .function(4)
    .function(5)
    .function(6)
    .function(7)
)
</code></pre>
<p>This looks much nicer than</p>
<pre><code class="language-python">a = Something().function(1).function(2).function(3).function(4).function(5).function(
    6
).function(7)
</code></pre>
<p>If ruff used the same strategy for the above snippet, it would look like</p>
<pre><code class="language-python">computation_outcome = (
    jnp.cos(x[1]) 
    * jnp.sin(x[2]) 
    - jnp.cos(x[0]) 
    * jnp.sin(x[1]) 
    * jnp.cos(x[2])
)
</code></pre>
<p>which is already nicer (at least, I find it nicer).</p>
<p>Also, it would be great if in this case, it can be displayed as</p>
<pre><code class="language-python">computation_outcome = (
    jnp.cos(x[1]) * jnp.sin(x[2]) - jnp.cos(x[0]) * jnp.sin(x[1]) * jnp.cos(x[2])
)
</code></pre>
<p>Possibly, if the expression is too long for a single line, it can be splitted at the minus sign keeping the products together.</p>
<pre><code class="language-python">computation_outcome = (
    jnp.cos(x[1]) * jnp.sin(x[2])
    - jnp.cos(x[0]) * jnp.sin(x[1]) * jnp.cos(x[2])
)
</code></pre>
<p>However, this would required more heuristics for how to parse and format mathematical expressions.</p>
<h3>Version</h3>
<p>ruff 0.14.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @maxtremblay on 2025-12-11 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @MichaReiser on 2025-12-11 17:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-12-11 17:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2025-12-11 17:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
