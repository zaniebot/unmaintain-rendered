<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`F821` on use of `Literal` with strings, e.g. `Literal['foo']` - astral-sh/ruff #128</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`F821` on use of `Literal` with strings, e.g. `Literal['foo']`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/128">#128</a>
        opened by <a href="https://github.com/samuelcolvin">@samuelcolvin</a>
        on 2022-09-08 09:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2022-09-08 09:06</div>
            <div class="timeline-body"><p>Since #119 was fixed via #125, I tried ruff again (build from <code>main</code>) with pydantic.</p>
<p>I get a few remaining <code>F821</code> errors due to use of strings in <code>Literal</code>, the line numbers are also incorrect - seems to always be <code>1</code>.</p>
<p>From <a href="https://github.com/pydantic/pydantic/blob/f341049b9e5538a125751d75b4e44c1609b53df6/pydantic/config.py#L65-L66">this</a> code (and some other places in that file), I get:</p>
<pre><code>pydantic/config.py:1:1: F821 Undefined name `deep`
pydantic/config.py:1:1: F821 Undefined name `none`
pydantic/config.py:1:1: F821 Undefined name `deep`
pydantic/config.py:1:1: F821 Undefined name `shallow`
pydantic/config.py:1:1: F821 Undefined name `before_validation`
pydantic/config.py:1:1: F821 Undefined name `after_validation`
pydantic/config.py:1:1: F821 Undefined name `none`
pydantic/config.py:1:1: F821 Undefined name `shallow`
pydantic/config.py:1:1: F821 Undefined name `before_validation`
pydantic/config.py:1:1: F821 Undefined name `after_validation`
</code></pre>
<p>Example code:</p>
<pre><code class="language-py">    copy_on_model_validation: Literal['none', 'deep', 'shallow']
    post_init_call: Literal['before_validation', 'after_validation']
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/129.html">astral-sh/ruff#129</a> on 2022-09-08 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2022-09-08 09:18</div>
            <div class="timeline-body"><p>I have no idea how you differentiate in a general way between the following:</p>
<hr />
<pre><code class="language-py">from typing import Literal

def foo(x: Literal['int']):
    pass
</code></pre>
<hr />
<pre><code class="language-py">from typing import List

def foo(x: List['int']):
    pass
</code></pre>
<hr />
<pre><code class="language-py">from .local_types import CustomThing

def foo(x: CustomThing['int']):
    pass
</code></pre>
<hr />
<p>Obviously you can whitelist <code>Literal</code>, but I have no idea how you would work out whether <code>CustomThing</code> is parameterised with strings or types which might be strings.</p>
<p>I guess you have to assume it's parameterised with types, can maybe one day allow a magic comment or magic property which tells ruff that <code>CustomThing</code> is parameterised with literals - maybe there's a pep for this, but I don't know of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-08 13:26</div>
            <div class="timeline-body"><p>Yeah it looks like PyFlakes special-cases <code>Literal</code>: https://github.com/PyCQA/pyflakes/blob/master/pyflakes/checker.py#L1464. Will fix.</p>
<p>PyFlakes actually has a lot of custom logic for caching forward-reference annotation in <code>cast</code> and <code>TypeVar</code> calls which we're yet to handle, so this may pop up there too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/131.html">astral-sh/ruff#131</a> on 2022-09-08 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-08 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-08 15:08</div>
            <div class="timeline-body"><p>(The <code>1:1</code> issue will be handled separately, tracking in #132. Thank you!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vianmixtkz">@vianmixtkz</a> on 2023-04-04 11:25</div>
            <div class="timeline-body"><p>I still have the same issue
<img src="https://user-images.githubusercontent.com/122097976/229777092-644cc36b-5509-4e38-bb73-5fba4bc4c5a9.png" alt="image" /></p>
<p>What version of ruff fixes it ?</p>
<p>I am using ruff==0.0.254</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-04 14:48</div>
            <div class="timeline-body"><p>@vianmixtkz - This was fixed long long ago. How are you importing <code>Literal</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vianmixtkz">@vianmixtkz</a> on 2023-04-04 15:08</div>
            <div class="timeline-body"><p>Gotcha,</p>
<p>I was importing it from another module. I tried to import it directly from typing and it fixed the issue.
Thanks.</p>
<p>What caused that though ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-04 16:44</div>
            <div class="timeline-body"><p>If you add that module to <a href="https://beta.ruff.rs/docs/settings/#typing-modules"><code>typing-modules</code></a>, that should fix the issue for you without having to import from <code>typing</code> directly. We don't trace imports across files, so if you import <code>Literal</code> in one file, export it, and then import that export elsewhere, we don't know that it's equivalent to <code>typing.Literal</code>. By adding your first-party module to <code>typing-modules</code>, you can tell Ruff that anything imported from that module should be considered equivalent to a <code>typing</code> import.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../baidubce/bce-qianfan-sdk/pulls/54.html">baidubce/bce-qianfan-sdk#54</a> on 2023-11-09 05:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../gitpython-developers/GitPython/pulls/1862.html">gitpython-developers/GitPython#1862</a> on 2024-03-11 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../fastapi/typer/pulls/1048.html">fastapi/typer#1048</a> on 2024-12-26 09:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:06 UTC
    </footer>
</body>
</html>
