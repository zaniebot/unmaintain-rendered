<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow to ignore B008 (function calls in default arguments) in cases where the function is a method of a local variable - astral-sh/ruff #15062</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Allow to ignore B008 (function calls in default arguments) in cases where the function is a method of a local variable</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/15062">#15062</a>
        opened by <a href="https://github.com/beneyal">@beneyal</a>
        on 2024-12-19 12:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/beneyal">@beneyal</a> on 2024-12-19 12:43</div>
            <div class="timeline-body"><p>Hey all,</p>
<p>First, I want to thank the maintainers of this tool for doing a spectacular job, Ruff is a joy to use! üöÄ</p>
<p>I'll begin the issue with a small reproduction:</p>
<pre><code class="language-python">class A:
    pass


class B:
    def f(self) -&gt; A:
        return A()


def foo(b: B) -&gt; None:
    def bar(x: A = b.f()) -&gt; None:  # Do not perform function call `b.f` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable [B008]
        print(x)

    bar(A())
</code></pre>
<p>When using flake8-bugbear's <code>extend-immutable-calls</code> section, I could ignore <code>b.f</code>. In Ruff, I can't, because I don't have a fully qualified path to it. I tried adding <code>B.f</code> to <code>extend-immutable-calls</code>, but it didn't work.</p>
<p>Is there a way to ignore such a thing using <code>extend-immutable-calls</code>? Thanks! üôè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-20 09:11</div>
            <div class="timeline-body"><p>Thanks for the kind words.</p>
<p>Hmm, no, I don't think there's a way to do it today. Ruff's code that is used to resolve a name (e.g. <code>B.b</code>) doesn't understand following arguments but it would be required to understand that <code>b</code> is typed as <code>B</code>.</p>
<p>Relevant code</p>
<p>https://github.com/astral-sh/ruff/blob/c0b7c36d435441788b5a1f2330a66613656a3e47/crates/ruff_python_semantic/src/model.rs#L938</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @MichaReiser on 2024-12-20 09:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beneyal">@beneyal</a> on 2024-12-21 13:01</div>
            <div class="timeline-body"><p>Oh, okay, thanks! Should I keep the issue open as a &quot;feature request&quot;, or just close it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-21 13:49</div>
            <div class="timeline-body"><p>I'd leave it open for now. It might be possible to add (limited) support for it with Ruff's current model.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
