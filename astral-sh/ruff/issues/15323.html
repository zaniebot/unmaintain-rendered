<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>needless bool for needless-bool - astral-sh/ruff #15323</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>needless bool for needless-bool</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/15323">#15323</a>
        opened by <a href="https://github.com/nickdrozd">@nickdrozd</a>
        on 2025-01-07 18:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-01-07 18:16</div>
            <div class="timeline-body"><p>Function to check random numbers:</p>
<pre><code class="language-python">from random import randint

def check_zero(end: int) -&gt; bool:
    &quot;&quot;&quot;Check if two random numbers from 0 to END are both 0.&quot;&quot;&quot;
    if randint(0, end) == 0 and randint(0, end) == 0:
        return True
    else:
        return False
</code></pre>
<p>Raises warning <code>SIM103 Return the condition directly</code>. Good. Fix with <code>--unsafe-fixes --fix</code>:</p>
<pre><code class="language-python">from random import randint

def check_zero(end: int) -&gt; bool:
    &quot;&quot;&quot;Check if two random numbers from 0 to END are both 0.&quot;&quot;&quot;
    return bool(randint(0, end) == 0 and randint(0, end) == 0)
</code></pre>
<p>Multi-return <code>if</code>/<code>else</code> expression replaced with boolean expression. Good. But also wrapped with <code>bool</code> cast. Bad! <code>bool</code> cast of a boolean expression is unnecessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dylwil3 on 2025-01-07 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @dylwil3 on 2025-01-07 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dylwil3 by @dylwil3 on 2025-01-07 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-07 18:37</div>
            <div class="timeline-body"><blockquote>
<p>Multi-return <code>if</code>/<code>else</code> expression replaced with boolean expression. Good. But also wrapped with <code>bool</code> cast. Bad! <code>bool</code> cast of a boolean expression is unnecessary.</p>
</blockquote>
<p>We need to be careful here! If we can say for sure that both the left-hand side and the right-hand side is of type <code>bool</code>, then yes, we can safely remove the <code>bool()</code> call wrapping the expression. Otherwise we cannot, or a type checker might complain that the function's annotation has <code>bool</code> for the return type when actually it returns something else:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; 5 and 42
42
</code></pre>
<p>Perhaps you might say that we can say for sure that equality comparisons will always evaluate to a <code>bool</code>, but... sadly that's also not true!</p>
<pre><code class="language-pycon">&gt;&gt;&gt; class Foo:
...     def __eq__(self, other):
...         return 42
...         
&gt;&gt;&gt; Foo() == Foo() and Foo() == Foo()
42
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-07 18:44</div>
            <div class="timeline-body"><p>Excellent point! We can at least add in the cases where ruff's semantic model can infer the type as bool (which will be fairly limited, and I think will not include the example in this issue due to the function call).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @dylwil3 on 2025-01-07 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-07 18:56</div>
            <div class="timeline-body"><p>In fact, <a href="https://play.ruff.rs/0ec08839-1400-443d-b7ac-0eadfe041df4">here is a case</a> where the autofix is wrong because it <em>doesn't</em> cast to bool:</p>
<pre><code class="language-python">import numpy as np 

def f(x:np.ndarray,y:np.ndarray):
    if x&lt;y:
        return True
    else:
        return False
</code></pre>
<p>gets fixed to</p>
<pre><code class="language-python">import numpy as np 

def f(x:np.ndarray,y:np.ndarray):
    return x &lt; y
</code></pre>
<p>Arguably comparison operators are <em>more</em> likely to produce false positives than boolean operators like <code>and</code>/<code>or</code> (since numpy does not override the latter - it only overrides the bitwise versions).</p>
<p>In any event the fix is marked as unsafe... so there's a question of whether we should be restricting the fix behavior further, extending it (as in the OP), or some mixture (eg avoiding comparison operators but allowing boolean operators).</p>
<p>I'm gonna push a few different versions and see what the ecosystem check reveals and then maybe we can discuss further. (Assuming the ecosystem check will tell me anything... I remember we made a change recently around what it does with fix behavior...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-07 18:59</div>
            <div class="timeline-body"><p>Right. We could also take whether or not the function is explicitly annotated into consideration, possibly? In untyped code, there's maybe not much of a difference between returning something truthy and something that is the literal <code>True</code> constant; the <code>bool()</code> cast maybe just adds overhead there. But if the function is annotated as returning <code>bool</code>, they're probably using a type checker, so we might break their CI by removing the <code>bool()</code> cast... anyway, looking forward to seeing the results of your experiments :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-01-07 19:03</div>
            <div class="timeline-body"><p>Python's boolean handling never ceases to surprise! I see what you mean about being careful. Feel free to close this.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
