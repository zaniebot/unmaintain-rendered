<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F403 false positive with native module - astral-sh/ruff #3767</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F403 false positive with native module</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/3767">#3767</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-03-28 12:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2023-03-28 12:34</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p><code>F403</code> is falsely shown even if there is a native module that can be imported from, in the case of the <a href="https://github.com/konstin/F403-false-positive-with-native-module">reproducer</a> on <code>from .reproducer import *</code> where <code>reproducer.abi3.so</code> exists:</p>
<pre><code class="language-shell">git clone 
pip install ruff==0.0.259 &quot;maturin&gt;=0.14,&lt;0.15&quot;
maturin develop
</code></pre>
<pre><code>$ tree python
tree python
python
└── reproducer
    ├── __init__.py
    └── reproducer.abi3.so

1 directory, 2 files
</code></pre>
<p>The <code>python/reproducer/__init__.py</code>:</p>
<pre><code>from .reproducer import *
</code></pre>
<p>Running ruff with default settings on this:</p>
<pre><code>$ ruff .
python/reproducer/__init__.py:1:1: F403 `from .reproducer import *` used; unable to detect undefined names
Found 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-03-28 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-28 15:08</div>
            <div class="timeline-body"><p>I think this is &quot;correct&quot; since <code>F403</code> just flags <em>all</em> <code>*</code> imports -- that is, it effectively enforces that users don't use <code>*</code> imports at all. Maybe it's the message that's unclear?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-03-28 15:43</div>
            <div class="timeline-body"><p>Yes that definitely the message that is unclear. To a lesser extend it's also that this file is just a reexport (there are no usages in this file) and an on-by-default lint shouldn't flag those, but i'm not sure how to separate them from actual F403 cases</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-18 15:27</div>
            <div class="timeline-body"><p>Pyright's resolver is able to detect that an import is a native, I think. So, should we add a proper resolver, we should be able to avoid these.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-07-10 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-07-10 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 13:31</div>
            <div class="timeline-body"><p>Why is it common to use wildcard imports with native modules?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-27 15:10</div>
            <div class="timeline-body"><p>One part is that we want to have the native module in a module itself, both because it's cleaner than a top level native module when installed and because we want to add stub files and/or <code>py.typed</code> in that directory (type hints from within pyo3 or raw C bindings is an unsolved problem), the other part is that we want to have the functions and classes on the top level of the module (i.e. we need to reexport all symbols). Listing all symbols explicitly is hard since we would need to load the library.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nerdoc">@nerdoc</a> on 2023-08-28 08:10</div>
            <div class="timeline-body"><p>It is possible to add a <code># noqa: F403</code> to each line, but this seems to be ridiculous, as it adds much clutter.
What could help maybe is to add a &quot;file scoped&quot; F403 exception - would that be possible - for those <strong>init</strong> files which only purpose is to reexport symbols, this could be a solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-28 14:33</div>
            <div class="timeline-body"><p>You can automatically ignore <code>F403</code> in all <code>__init__.py</code> files like:</p>
<pre><code class="language-toml">[tool.ruff.per-file-ignores]
&quot;__init__.py&quot; = [&quot;F403&quot;]
</code></pre>
<p>Or, you can add this to the top of your <code>__init__.py</code> file:</p>
<pre><code class="language-python"># ruff: noqa: F403
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
