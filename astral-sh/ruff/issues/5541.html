<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autofix docstrings with typing changes? - astral-sh/ruff #5541</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Autofix docstrings with typing changes?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5541">#5541</a>
        opened by <a href="https://github.com/petermattia">@petermattia</a>
        on 2023-07-05 20:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/petermattia">@petermattia</a> on 2023-07-05 20:02</div>
            <div class="timeline-body"><p>First off, thanks for <code>ruff</code>, really an amazing utility for the python ecosystem!</p>
<p>We're slowly enabling more rules with <code>ruff</code>. We just enabled the <code>UP</code> rule set, which mostly caught outdated typing conventions. Wondering if it would be possible to (ideally) auto-fix the docstrings or perhaps somehow warn the user that the docstrings may require updating as well?</p>
<p>Example:
<img src="https://github.com/astral-sh/ruff/assets/29551858/e47099bd-8d3f-452e-8328-7d48034206b8" alt="image" /></p>
<ul>
<li>A minimal code snippet that reproduces the bug.</li>
</ul>
<p><code>ruff .</code></p>
<ul>
<li>The command you invoked (e.g., <code>ruff /path/to/file.py --fix</code>), ideally including the <code>--isolated</code> flag.</li>
</ul>
<p><code>ruff .</code></p>
<ul>
<li>The current Ruff settings (any relevant sections from your <code>pyproject.toml</code>).</li>
</ul>
<p>We're using <code>numpy</code>-style docstrings. Also, the <code>UP</code> set of rules is added.</p>
<pre><code>[tool.ruff]
select = [&quot;UP&quot;, ...]

[tool.ruff.pydocstyle]
convention = &quot;numpy&quot;
</code></pre>
<ul>
<li>The current Ruff version (<code>ruff --version</code>).</li>
</ul>
<p><code>0.0.275</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-05 20:18</div>
            <div class="timeline-body"><p>This is a really nice idea... It's probably a ways off, I think we need a proper docstring parser to support it (rather than the pydocstyle-inspired regular expressions we use now), but it would be really cool.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @charliermarsh on 2023-07-05 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/petermattia">@petermattia</a> on 2023-07-05 22:11</div>
            <div class="timeline-body"><p>No worries, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/smackesey">@smackesey</a> on 2023-07-06 11:27</div>
            <div class="timeline-body"><p>I would love this feature-- huge value-add in terms of ensuring our API docs are accurate.</p>
<p>FWIW robust docstring parsing/formatting/linting would be a huge feather in ruff's cap, the existing tooling ecosystem for this is terrible given what a universal problem it is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2023-07-10 01:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jorgegomezcq">@jorgegomezcq</a> on 2023-07-28 16:24</div>
            <div class="timeline-body"><blockquote>
<p>FWIW robust docstring parsing/formatting/linting would be a huge feather in ruff's cap, the existing tooling ecosystem for this is terrible given what a universal problem it is.</p>
</blockquote>
<p>darglint is a related tool but it looks like it was deprecated last December:</p>
<p>https://github.com/terrencepreilly/darglint</p>
<p>There's also pyment but it has its rough edges that I've run into:</p>
<p>https://github.com/dadadel/pyment</p>
<p>These might be good projects to consult when implementing #5541</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2023-10-13 02:02</div>
            <div class="timeline-body"><p>FWIW(?) I interested in <a href="https://peps.python.org/pep-0727/">PEP 727</a> that may deprecate type definitions in docstrings in future.</p>
<pre><code class="language-py">from typing import Annotated, Doc

def create_user(
    name: Annotated[str, Doc(&quot;The user's name&quot;)],
    age: Annotated[int, Doc(&quot;The user's age&quot;)],
    cursor: DatabaseConnection | None = None,
) -&gt; Annotated[User, Doc(&quot;The created user after saving in the database&quot;)]:
    &quot;&quot;&quot;Create a new user in the system.

    It needs the database connection to be already initialized.
    &quot;&quot;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ShivMunagala">@ShivMunagala</a> on 2023-12-20 00:28</div>
            <div class="timeline-body"><p>pydoclint (https://github.com/jsh9/pydoclint) partly does this, it doesn't autofix afaik but it can warn a user if there is a mismatch between docstring and typehints.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/petermattia">@petermattia</a> on 2023-12-21 21:59</div>
            <div class="timeline-body"><p>Yea, we currently use pydoclint as a precommit hook. Generally good enough for our purposes, but would be nice to drop it and consolidate with ruff.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:36 UTC
    </footer>
</body>
</html>
