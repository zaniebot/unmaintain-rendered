<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't configure quote style for `ruff_python_codegen::Generator` - astral-sh/ruff #20432</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Can&#x27;t configure quote style for <code>ruff_python_codegen::Generator</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20432">#20432</a>
        opened by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a>
        on 2025-09-16 07:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ShaharNaveh">@ShaharNaveh</a></div>
            <div class="timeline-body"><p>There&#x27;s support for creating a <code>Generator</code> from a <code>Stylist</code> instance:</p>
<p>https://github.com/astral-sh/ruff/blob/2a6dde4acb6cb6a8ef4426ca3d792bdb1c477f21/crates/ruff_python_codegen/src/stylist.rs#L11-L17</p>
<p>https://github.com/astral-sh/ruff/blob/2a6dde4acb6cb6a8ef4426ca3d792bdb1c477f21/crates/ruff_python_codegen/src/generator.rs#L76-L87</p>
<p>And while <code>indentation</code> and <code>line_ending</code> are being respected, <code>quote</code> is ignored:/</p>
<hr>
<p>Motivation for issue: <a href="https://github.com/RustPython/RustPython/pull/6124">RustPython/RustPython#6124</a>#discussion_r2320979701</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-16 08:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-16 08:25</div>
            <div class="timeline-body"><p>This is intentional in that we try to preserve the quote styles whenever possible rather than enforcing a fixed quote style. This ensures that fixes don&#x27;t introduce unnecessary changes.</p>
<p>I&#x27;m not sure what it would require to have a global preferred quote style that overrides the AST node quote style.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> on 2025-09-16 08:37</div>
            <div class="timeline-body"><blockquote>
<p>This is intentional in that we try to preserve the quote styles whenever possible rather than enforcing a fixed quote style. This ensures that fixes don&#x27;t introduce unnecessary changes.</p>
</blockquote>
<p>I see, would it make sense to keep the signature of <code>Generator::new</code> the same, and add a method that can change the quote style. something like:</p>
<pre><code>impl Generator {
 pub const fn new(indent: &amp;&#x27;a Indentation, line_ending: LineEnding) -&gt; Self {
        Self {
            // Style preferences.
            indent,
            line_ending,
            quote: Quote::default(), // Added this
            // Internal state.
            buffer: String::new(),
            indent_depth: 0,
            num_newlines: 0,
            initial: true,
        }
    }

  pub fn with_quote(mut self, quote: Quote) -&gt; Self {
    self.quote = quote;
    self
  }

}
</code></pre>
<p>This makes it so it&#x27;s backwards compatible, while giving the user the ability to configure the quote style if so desired.</p>
<blockquote>
<p>I&#x27;m not sure what it would require to have a global preferred quote style that overrides the AST node quote style.</p>
</blockquote>
<p>Me neither, the purpose of this question is to see if this is something that the ruff team are willing to merge once there&#x27;s a PR for it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-16 08:39</div>
            <div class="timeline-body"><blockquote>
<p>Me neither, the purpose of this question is to see if this is something that the ruff team are willing to merge once there&#x27;s a PR for it</p>
</blockquote>
<p>I&#x27;m not oposed to it, but it depends on the level of complexity it introduces and requires that someone finds the time to review</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> on 2025-09-16 08:43</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Me neither, the purpose of this question is to see if this is something that the ruff team are willing to merge once there&#x27;s a PR for it</p>
</blockquote>
<p>I&#x27;m not oposed to it, but it depends on the level of complexity it introduces and requires that someone finds the time to review</p>
</blockquote>
<p>Fair enough. ty for the swift response:)
Will poke the code a bit and see what&#x27;s the effort</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-18 10:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:25 UTC
    </footer>
</body>
</html>
