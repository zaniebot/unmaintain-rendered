<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line after line break in type signature is not indented as Ruff-example in known deviations page - astral-sh/ruff #12138</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Line after line break in type signature is not indented as Ruff-example in known deviations page</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12138">#12138</a>
        opened by <a href="https://github.com/pjonsson">@pjonsson</a>
        on 2024-07-01 13:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pjonsson">@pjonsson</a> on 2024-07-01 13:06</div>
            <div class="timeline-body"><p>This resembles #11791, but that talks about assignments, the example below does not have any assignments in the relevant lines. It's also possible Ruff behaves as it should, and the formatted example on the known deviations page is outdated.</p>
<p>This example:</p>
<pre><code class="language-python">from collections.abc import Callable
from multiprocessing.pool import Pool as PoolClass
from pathlib import Path


class AbstractStorage:
    value: int = 3


class Processor:
    def __init__(
        self,
        process: Callable[[PoolClass, AbstractStorage, str, str, Path, Path, Path], str] | None,
    ) -&gt; None:
        self.process = process
</code></pre>
<p>gets reformatted to:</p>
<pre><code class="language-python">from collections.abc import Callable
from multiprocessing.pool import Pool as PoolClass
from pathlib import Path


class AbstractStorage:
    value: int = 3


class Processor:
    def __init__(
        self,
        process: Callable[[PoolClass, AbstractStorage, str, str, Path, Path, Path], str]
        | None,
    ) -&gt; None:
        self.process = process
</code></pre>
<p>where the <code>|</code> is aligned with the start of the parameter name in the previous line. I'm using Ruff 0.5.0, but Ruff 0.4.10 behaved the same way.</p>
<p>The formatting of the type signature above is inconsistent with the Ruff-formatted example in https://docs.astral.sh/ruff/formatter/black/#parenthesizing-long-nested-expressions:</p>
<pre><code class="language-python">def foo(
  i: int,
  x: Loooooooooooooooooooooooong
     | Looooooooooooooooong
     | Looooooooooooooooooooong
     | Looooooong,
  *,
  s: str,
) -&gt; None:
  pass
</code></pre>
<p>where the <code>|</code> is aligned with the start of the type annotation of the previous line, not the start of the parameter name.</p>
<p>From a readability standpoint, I prefer the indentation example from the known deviations page, where a line broken type signature for a parameter is indented more than the parameter name itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @dhruvmanila on 2024-07-02 03:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> removed by @MichaReiser on 2024-07-02 05:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2024-07-02 05:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2024-07-02 05:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-02 05:58</div>
            <div class="timeline-body"><p>Thanks for reporting. Yes, the documentation here is incorrect. What it shows in the ruff section is <em>how I want it to be formatted</em> but isn't how ruff formats it today, unfortunately :( Let me update the documentation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12153.html">astral-sh/ruff#12153</a> on 2024-07-02 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-07-03 08:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
