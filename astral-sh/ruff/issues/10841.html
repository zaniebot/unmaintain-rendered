<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider handling of non-printable characters when showing code/diffs - astral-sh/ruff #10841</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider handling of non-printable characters when showing code/diffs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10841">#10841</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2024-04-08 23:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>Search keyword used: &quot;non-printable&quot;</p>
<p>Python source code containing non-printable chars (e.g. <code>^H</code> or backspace, <code>^Z</code> or substitution, <code>^[</code> or escape; see https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/resources/test/fixtures/pylint/invalid_characters.py for examples) can cause unpredictable and confusing results if we output it as-is.</p>
<p>Here&#x27;s a minimal example of the current behavior:</p>
<pre><code>➜ python3 -c &quot;print(&#x27;b = \&#x27;\x08\&#x27;&#x27;)&quot; &gt; bad.py

➜ cat bad.py
b = &#x27;

➜ cat -v bad.py
b = &#x27;^H&#x27;

➜ xxd bad.py
00000000: 6220 3d20 2708 270a                      b = &#x27;.&#x27;.

➜ cargo run -- check --diff --no-cache --preview --select PLE2510 bad.py
    Finished dev [unoptimized + debuginfo] target(s) in 0.09s
     Running `target/debug/ruff check --diff --no-cache --preview --select PLE2510 bad.py`
--- bad.py
+++ bad.py
@@ -1 +1 @@
-b = &#x27;
+b = &#x27;\b&#x27;

Would fix 1 error.
</code></pre>
<p>Here the diff is confusing because it looks like the original string doesn&#x27;t even have matching quotes, just a single quote char. In fact it has two quotes, but the intervening backspace character deleted one of them. (Note this is the same behavior shown by <code>cat</code> without <code>-v</code>; it just allows control characters to take effect.)</p>
<p>Interestingly, this is also the same as the default behavior of both <code>diff</code> and <code>git diff</code>, which means we may want to be cautious about diverging from it. But we could consider doing some kind of escaping of non-printable characters before outputting code frames or diffs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-09 00:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-08 06:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:52 UTC
    </footer>
</body>
</html>
