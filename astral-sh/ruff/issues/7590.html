<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format instability in 38 python files  - astral-sh/ruff #7590</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format instability in 38 python files </h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7590">#7590</a>
        opened by <a href="https://github.com/qarmin">@qarmin</a>
        on 2023-09-22 07:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/qarmin">@qarmin</a> on 2023-09-22 07:10</div>
            <div class="timeline-body"><p>0.0.290 latest master branch</p>
<p>Zip contains 3 folders:</p>
<ul>
<li>BD - original files</li>
<li>BD2 - files after running first time ruff</li>
<li>BD3 - files after running second time ruff on original files</li>
</ul>
<p>and diff13986975832760036465.txt that shows diffs between files after second and first ruff run</p>
<p><a href="https://github.com/astral-sh/ruff/files/12697754/broken_files.zip">broken_files.zip</a></p>
<p>Example instability</p>
<pre><code>//////////////////////////////////////////////////////
--- /home/rafal/test/DOWNLOADED/broken_files//BD2/A_16119982587513585207.py	2023-09-22 09:04:47.281983181 +0200
+++ /home/rafal/test/DOWNLOADED/broken_files//BD3/A_16119982587513585207.py	2023-09-22 09:04:47.357981173 +0200
@@ -210,8 +210,7 @@
     input_shapes = [get_shape(v) for v in inputs]
     assert len(input_shapes) == 2, input_shapes
     assert (
-        input_shapes[0][-1]
-        == input_shapes[1][-2]  # type: ignore
+        input_shapes[0][-1] == input_shapes[1][-2]  # type: ignore
     ), input_shapes  # type: ignore
     flop = prod(input_shapes[0]) * input_shapes[-1][-1]  # type: ignore
     return flop
</code></pre>
<pre><code>--- /home/rafal/test/DOWNLOADED/broken_files//BD2/A_7173176388825988664.py	2023-09-22 09:04:47.285983076 +0200
+++ /home/rafal/test/DOWNLOADED/broken_files//BD3/A_7173176388825988664.py	2023-09-22 09:04:47.357981173 +0200
@@ -78,7 +78,7 @@
         *_DISK_META_MAGIC,
         *memoryview(
             (image_name.encode(&quot;utf-8&quot;) + b&quot;\x00&quot; * _DISK_META_IMAGE_NAME_SIZE)[
-                  # type: ignore
+                # type: ignore
                 :_DISK_META_IMAGE_NAME_SIZE
             ]
         ).cast(&quot;c&quot;),
</code></pre>
<pre><code>//////////////////////////////////////////////////////
--- /home/rafal/test/DOWNLOADED/broken_files//BD2/A_14230110707883433080.py	2023-09-22 09:04:47.289982970 +0200
+++ /home/rafal/test/DOWNLOADED/broken_files//BD3/A_14230110707883433080.py	2023-09-22 09:04:47.349981385 +0200
@@ -412,7 +412,6 @@
 
             # else:
             # print(xsrfRequest.headers[&quot;x-csrf-token&quot;],xsrfRequest.headers)
-
     except Exception as e:
         raise GetTokenException(
             f&quot;'Get x-csrf-token' process returned an Exception: {e}'&quot;
</code></pre>
<pre><code>--- /home/rafal/test/DOWNLOADED/broken_files//BD2/A_1798643049678049848.py	2023-09-22 09:04:47.277983287 +0200
+++ /home/rafal/test/DOWNLOADED/broken_files//BD3/A_1798643049678049848.py	2023-09-22 09:04:47.349981385 +0200
@@ -212,8 +212,7 @@
     + list(itertools.product([0], ONE_TO_NINE + TEN_TO_LOTS))  # integer value of 0
     + list(itertools.product(ONE_TO_LOTS, [0]))  # decimal value of 0
     + list(itertools.product(NEGATIVE_NUMBERS, ONE_TO_NINE))  # negative integer
-    +
-    list(itertools.product(ONE_TO_LOTS, NEGATIVE_NUMBERS))  # negative decimal
+    + list(itertools.product(ONE_TO_LOTS, NEGATIVE_NUMBERS))  # negative decimal
 ] + [
     str(components[0]) + &quot;.&quot; + str(components[1])
     for components in itertools.product(
</code></pre>
<pre><code>--- /home/rafal/test/DOWNLOADED/broken_files//BD2/A_870428921595896654.py	2023-09-22 09:04:47.281983181 +0200
+++ /home/rafal/test/DOWNLOADED/broken_files//BD3/A_870428921595896654.py	2023-09-22 09:04:47.349981385 +0200
@@ -3,15 +3,13 @@
 
 
 def f2(
-    x: e2 = #
-    &quot;foo&quot;,
+    x: e2 = &quot;foo&quot;,  #
 ) -&gt; r2:
     pass
 
 
 def f3(  #
-    x: e3 = #  # =  #
-    123,  #
+    x: e3 = 123,  #  # =  #  #
     #
 ) -&gt; r3:
     pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-09-22 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @charliermarsh on 2023-09-22 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7602.html">astral-sh/ruff#7602</a> on 2023-09-22 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7603.html">astral-sh/ruff#7603</a> on 2023-09-22 16:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7604.html">astral-sh/ruff#7604</a> on 2023-09-22 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7605.html">astral-sh/ruff#7605</a> on 2023-09-22 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 16:37</div>
            <div class="timeline-body"><p>Okay, I tried a bunch of these into their own issues -- let's close for now and then rerun at some point once those are resolved. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-22 16:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
