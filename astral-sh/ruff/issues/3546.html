<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature: rewrite dict.get(key, None) as dict.get(key) - astral-sh/ruff #3546</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature: rewrite dict.get(key, None) as dict.get(key)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3546">#3546</a>
        opened by <a href="https://github.com/janosh">@janosh</a>
        on 2023-03-15 18:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/janosh">@janosh</a> on 2023-03-15 18:26</div>
            <div class="timeline-body"><p>This is not in <a href="https://github.com/MartinThoma/flake8-simplify"><code>flake8-simplify</code></a> AFAIK but would prob best fit in that rule class.</p>
<p>From the flake8-simplify readme:</p>
<blockquote>
<p>Simplifying usage of dictionaries:</p>
<p>https://github.com/MartinThoma/flake8-simplify/issues/72: Use 'a_dict.get(key, &quot;default_value&quot;)' instead of an if-block (<a href="https://github.com/MartinThoma/flake8-simplify#SIM401">example</a>)
https://github.com/MartinThoma/flake8-simplify/issues/40: Use 'key in dict' instead of 'key in dict.keys()' (<a href="https://github.com/MartinThoma/flake8-simplify#SIM118">example</a>)</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-03-15 23:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-15 23:23</div>
            <div class="timeline-body"><p>Yeah just not sure what code this would fall under...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/janosh">@janosh</a> on 2023-03-28 22:52</div>
            <div class="timeline-body"><p>Rule name in <code>flake8-simplify</code> <a href="https://github.com/MartinThoma/flake8-simplify/issues/171#issuecomment-1487693798">will be SIM910</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-28 23:00</div>
            <div class="timeline-body"><p>Oh nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kyoto7250">@kyoto7250</a> on 2023-03-29 01:44</div>
            <div class="timeline-body"><p>I am currently working for making this rule in <code>flake8-simplify</code>, and I would also like to implement the rule in <code>ruff</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-04-04 03:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Borda">@Borda</a> on 2023-04-20 10:09</div>
            <div class="timeline-body"><blockquote>
<p>I would also like to implement the rule in <code>ruff</code></p>
</blockquote>
<p>cool, was this already added? I see in the docs that it shall be implemented, but with 0.0.262 these cases are not flagged or repaired... could be some typing limitation that is not properly recognized? But <code>flake8-simplify</code> detects them...</p>
<p>https://github.com/Lightning-AI/lightning/blob/8dac2512733bae034f437334a71e4c114d458a7c/src/lightning/pytorch/profilers/pytorch.py#L322</p>
<pre><code>src/lightning/pytorch/profilers/pytorch.py:322:20: SIM910 Use 'profiler_kwargs.get(&quot;schedule&quot;)' instead of 'profiler_kwargs.get('schedule', None)'
</code></pre>
<p>https://github.com/Lightning-AI/lightning/blob/8dac2512733bae034f437334a71e4c114d458a7c/src/lightning/pytorch/utilities/parsing.py#L102</p>
<pre><code>src/lightning/pytorch/utilities/parsing.py:102:16: SIM910 Use 'local_vars.get(self_var)' instead of 'local_vars.get(self_var, None)'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-20 11:11</div>
            <div class="timeline-body"><p>This is implemented and released. In <code>ruff</code>, this will only work on dict literals (<code>{}</code>) while in <code>flake8-simplify</code> this works with any call which resembles the expression (<code>&lt;name&gt;.get(&quot;...&quot;, None)</code>). I'm assuming this was done as otherwise it would be difficult to determine if the variable is actually a dictionary and not any other object. This would be solved in the future when type-inference is implemented.</p>
<p>\cc @charliermarsh I think we should make it explicit in the documentation about this difference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/janosh">@janosh</a> on 2023-04-20 13:27</div>
            <div class="timeline-body"><blockquote>
<p>This is implemented and released. In ruff, this will only work on dict literals ({}) while in flake8-simplify this works with any call which resembles the expression (<name>.get(&quot;...&quot;, None))</p>
</blockquote>
<p>Ah, I was wondering if that was the case. I think mentioning in the docs would be great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kyoto7250">@kyoto7250</a> on 2023-04-20 13:53</div>
            <div class="timeline-body"><p>I implemented this rule, but this difference in behavior was not intended.</p>
<p>@charliermarsh</p>
<p>I want to fix this behavior if possible.
Is there any way to find out the type of a variable when checking ruff?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:39 UTC
    </footer>
</body>
</html>
