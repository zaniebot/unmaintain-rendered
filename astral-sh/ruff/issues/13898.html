<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM108 for return statements - astral-sh/ruff #13898</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>SIM108 for return statements</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13898">#13898</a>
        opened by <a href="https://github.com/joppi588">@joppi588</a>
        on 2024-10-23 19:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/joppi588">@joppi588</a></div>
            <div class="timeline-body"><p>For the following code snippet ruff detects a violation of SIM505:</p>
<pre><code>def foo_sim108(bar):
    if bar is not None:
        xyz = bar
    else:
        xyz = &quot;bar&quot;
    return xyz
</code></pre>
<p>and proposes</p>
<pre><code>def foo_sim108(bar):
    xyz=bar if bar is not None else &quot;bar&quot;
    return xyz
</code></pre>
<p>Usually I would omit xyz and write</p>
<pre><code>def foo_ret505(bar):
    if bar is not None:
        return bar
    else:
        return &quot;bar&quot;
</code></pre>
<p>which is simplified by RET505 to</p>
<pre><code>def foo(bar):
    if bar is not None:
        return bar
    return &quot;bar&quot;
</code></pre>
<p>However the shortest version would be</p>
<pre><code>def simplified_foo(bar):
    return bar if bar is not None else &quot;bar&quot;
</code></pre>
<p>For me it is a special case for SIM108 (return means that a value is assigned to the function output), but ruff does not propose this solution.
Is this intended?
If yes, I would be happy to have this behavior described in the SIM108 documentation.
If no, I would love to have it implemented.</p>
<p>Keywords: SIM108, RET505
Ruff version: 0.7.0</p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "SIM108" to "SIM108 for return statements" by @joppi588 on 2024-10-23 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-24 06:14</div>
            <div class="timeline-body"><p>Hi @joppi588</p>
<p>That makes sense to me.</p>
<p>Yes, this is intentional because there's <code>RET504</code> that detects the unnecessary assignment to <code>xyz</code> before returning (<a href="https://play.ruff.rs/7a1dee08-f03e-4882-95ff-7b64eb4d7c1f">playground</a>).  Keeping the rules separate is that users are in control on whether they prefer the assignment before the return or not.</p>
<p>Running <code>ruff check --fix</code> should directly fix</p>
<pre><code class="language-python">def foo_sim108(bar):
    if bar is not None:
        xyz = bar
    else:
        xyz = &quot;bar&quot;
    return xyz
</code></pre>
<p>to</p>
<pre><code class="language-python">def simplified_foo(bar):
    return bar if bar is not None else &quot;bar&quot;
</code></pre>
<p>if you have both rules enabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2024-10-24 06:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joppi588">@joppi588</a> on 2024-10-24 19:52</div>
            <div class="timeline-body"><p>Thanks @MichaReiser , I see.</p>
<p>However simplifying</p>
<pre><code>def foo(bar):
    if bar is not None:
        return bar
    return &quot;bar&quot;
</code></pre>
<p>to</p>
<pre><code>def simplified_foo(bar):
    return bar if bar is not None else &quot;bar&quot;
</code></pre>
<p>would require a new rule, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 06:18</div>
            <div class="timeline-body"><blockquote>
<p>would require a new rule, right?</p>
</blockquote>
<p>Yes, but it would be a very opinionated rule because it could result in very long expressions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joppi588">@joppi588</a> on 2024-10-28 20:46</div>
            <div class="timeline-body"><p>I agree, the result would probably not look &quot;better&quot; in many cases.
Even in the simple example I provided it is a matter of taste.</p>
<p>Thanks for the discussion! I will close the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @joppi588 on 2024-10-28 20:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:21 UTC
    </footer>
</body>
</html>
