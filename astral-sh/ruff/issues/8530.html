<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difference in multi-line str.format between ruff and black - astral-sh/ruff #8530</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Difference in multi-line str.format between ruff and black</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8530">#8530</a>
        opened by <a href="https://github.com/dwyatte">@dwyatte</a>
        on 2023-11-06 22:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dwyatte">@dwyatte</a> on 2023-11-06 22:07</div>
            <div class="timeline-body"><p>Settings: Default ruff <code>0.1.3</code></p>
<p><code>black</code> formats multi-line strings by adding args to <code>str.format</code> on a newline</p>
<p>https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ACkAG9dAD2IimZxl1N_Wj9gaSn83r_MDRh3Sohxk5tq0YJ9PWyG6Cyohdz_PJoc7zUs17RxhRdCnJ7Npmq7PfdCxS68vrTxtZKdTAoQUsbG77GpIhJyuHq4tEKRNQcU7LDmXIq_Rno-hiLpkYbL4dUTP5aaAAAA1H7xhdfRFL8AAYsBpQEAAHaaNfGxxGf7AgAAAAAEWVo=</p>
<p><code>ruff</code> keeps args to a multi-line <code>str.format</code> on a single line, presumably until it hits <code>line-length</code></p>
<p>ruff</p>
<pre><code>MULTI_LINE_STRING = &quot;&quot;&quot;
a
b
c
{}
&quot;&quot;&quot;.format(&quot;d&quot;)
</code></pre>
<p>black</p>
<pre><code>MULTI_LINE_STRING = &quot;&quot;&quot;
a
b
c
{}
&quot;&quot;&quot;.format(
    &quot;d&quot;
)
</code></pre>
<p>This causes a cost in migrating to ruff in codebases that contain a large number of multi-line strings that get formatted</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-06 22:31</div>
            <div class="timeline-body"><p>Thanks for the report.</p>
<p>I'm not sure I understand the logic in Black's formatting here.</p>
<p>Separately from Black compatibility, do you prefer that formatting?</p>
<p>Note that Black's preview style formats the same as Ruff so we are unlikely to change this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @zanieb on 2023-11-06 22:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dwyatte">@dwyatte</a> on 2023-11-07 00:02</div>
            <div class="timeline-body"><blockquote>
<p>Note that Black's preview style formats the same as Ruff so we are unlikely to change this</p>
</blockquote>
<p>Ah, so if I'm understanding correctly, this <em>might</em> get collected into Black's 2024 release anyway (<a href="https://black.readthedocs.io/en/stable/the_black_code_style/future_style.html#improved-multiline-string-handling">link for others</a>). If it ends up not making the cut, would <code>ruff</code> continue to use the current one-line style for the call to <code>.format</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 15:19</div>
            <div class="timeline-body"><p>That's a good question, I'm not sure. Often we would only implement the preview style over the stable style if it was a hard technical challenge. The inconsistency here is pretty weird, I can't think of other cases where a function call would be forced to break over multiple lines like that. It'd likely make it difficult for us to implement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-07 15:51</div>
            <div class="timeline-body"><p>(Thanks for filing!) We tend not to fix deviations from Black if they are (1) a result of greater internal consistency in Ruff's formatter, and/or (2) already part of Black's preview style. This one feels like it meets both of those descriptions, so I think I'd categorize it as acceptable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dwyatte">@dwyatte</a> on 2023-11-07 16:12</div>
            <div class="timeline-body"><blockquote>
<p>(2) already part of Black's preview style</p>
</blockquote>
<p>Yep, was unaware of this. I think we can close this as I don't have a strong preference independent of compatibility</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dwyatte on 2023-11-07 16:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-07 16:14</div>
            <div class="timeline-body"><p>Thanks @dwyatte, appreciate you taking the time to file these.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 04:02</div>
            <div class="timeline-body"><p>The reason for the difference is that Ruff already implements Black's <a href="https://black.readthedocs.io/en/stable/the_black_code_style/future_style.html#improved-multiline-string-handling">multiline-string preview style</a> because it was more difficult to support the stable style.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
