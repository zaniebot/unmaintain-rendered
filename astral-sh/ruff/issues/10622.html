<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bug: child configs that use 'select' or 'extend-select' invalidate the parent config's 'ignore' list. - astral-sh/ruff #10622</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>bug: child configs that use 'select' or 'extend-select' invalidate the parent config's 'ignore' list.</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10622">#10622</a>
        opened by <a href="https://github.com/Hnasar">@Hnasar</a>
        on 2024-03-26 21:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Hnasar">@Hnasar</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<h2>Bug/Use-case</h2>
<p>As someone who helps maintain a monorepo with many subprojects and child configs, I want to be able to maintain a centralized configuration of ignored rules (which projects may override with <code>tool.ruff.extend</code>). There appears to be a bug where the top-level <code>tool.ruff.lint.ignore</code> configuration <em>isn't honored</em> whenever a child config modifies either <code>tool.ruff.lint.select</code> or <code>tool.ruff.lint.extend-select</code>. This occurs all the time, even if the child config HAS NOT overridden <code>tool.ruff.lint.ignore</code> in any way.</p>
<p>I (think I) understand the semantics of <code>ruff.extend</code>  alongside <code>lint.extend-select</code> and <code>lint.select</code> but the semantics of the now-combined <code>lint.ignore</code> create some really confusing behaviors. As a result, I don't have a good way to fulfill my use-case mentioned above.</p>
<h2>Repro</h2>
<p>Using ruff 0.3.4</p>
<pre><code class="language-console">$ tree
.
└── parent
    ├── child
    │   ├── foo.py
    │   └── pyproject.toml
    └── pyproject.toml
</code></pre>
<pre><code class="language-py"># child/foo.py
import os, re

&quot;{}&quot;.format(1)
</code></pre>
<h2>Confusing behavior:</h2>
<h3>0. Parent ignores with child select</h3>
<pre><code class="language-toml"># parent/pyproject.toml
[tool.ruff]
lint.select = [&quot;E&quot;, &quot;UP&quot;]
lint.ignore = [&quot;E401&quot;, &quot;UP032&quot;]
</code></pre>
<pre><code class="language-toml"># child/pyproject.toml
[tool.ruff]
extend = &quot;../pyproject.toml&quot;
lint.extend-select = [&quot;UP&quot;]  # also same behavior if we use lint.select [&quot;UP&quot;]
</code></pre>
<p><strong>Observed</strong>:</p>
<pre><code class="language-console">$ ruff check .
parent/child/foo.py:3:1: UP032 [*] Use f-string instead of `format` call
</code></pre>
<p><strong>Expected</strong>:</p>
<p><em><strong>I expect that the parent <code>ignore</code> list is used in all cases except when the child has its own <code>ignore</code> list.</strong></em></p>
<pre><code class="language-console">$ ruff check .
All checks passed!
</code></pre>
<hr />
<h3>1. Parent ignores with child select and child ignore</h3>
<pre><code class="language-toml"># parent/pyproject.toml
[tool.ruff]
lint.select = [&quot;E&quot;, &quot;UP&quot;]
lint.ignore = [&quot;E401&quot;, &quot;UP032&quot;]
</code></pre>
<pre><code class="language-toml"># child/pyproject.toml
[tool.ruff]
extend = &quot;../pyproject.toml&quot;
lint.extend-select = [&quot;UP&quot;]  # also same behavior if we use lint.select [&quot;UP&quot;]
lint.ignore = [&quot;UP032&quot;]
</code></pre>
<p><strong>Observed</strong>:</p>
<pre><code class="language-console">$ ruff check .
All checks passed!
</code></pre>
<p><strong>Expected</strong>:</p>
<p><em>**I expect that if I provide a child <code>ignore</code> list then it _fully</em> invalidates the parent <code>ignore</code> list.**_</p>
<pre><code class="language-console">$ ruff check .
parent/child/foo.py:1:1: E401 [*] Multiple imports on one line
</code></pre>
<h2>Workarounds</h2>
<p>Neither of these are ideal, but are some things I tried:</p>
<ol>
<li>Copy and paste the parent's <code>lint.ignore</code> and keep it in sync in all the child configs. This is cumbersome to keep in sync and easy to miss things.</li>
<li>Instead of using <code>select</code> or <code>extend-select</code> in child configs, I can invert this and <code>ignore</code> all the top-level <code>selects</code> that a project wants to opt-out of. This is confusing, and also is cumbersome and easy to miss.</li>
</ol>
<h2>Examples of fine behavior that makes sense</h2>
<details>
  <summary>Click to expand examples</summary>

<h3>2. No ignores</h3>
<pre><code class="language-toml"># parent/pyproject.toml
[tool.ruff]
lint.select = [&quot;E&quot;, &quot;UP&quot;]
</code></pre>
<pre><code class="language-toml"># child/pyproject.toml
[tool.ruff]
extend = &quot;../pyproject.toml&quot;
</code></pre>
<pre><code class="language-console">$ ruff  check .
parent/child/foo.py:1:1: E401 [*] Multiple imports on one line
parent/child/foo.py:3:1: UP032 [*] Use f-string instead of `format` call
</code></pre>
<h3>3. Child select</h3>
<pre><code class="language-toml"># parent/pyproject.toml
[tool.ruff]
lint.select = [&quot;E&quot;, &quot;UP&quot;]
</code></pre>
<pre><code class="language-toml"># child/pyproject.toml
[tool.ruff]
extend = &quot;../pyproject.toml&quot;
lint.select = [&quot;UP&quot;]
</code></pre>
<pre><code class="language-console">$ ruff  check .
parent/child/foo.py:3:1: UP032 [*] Use f-string instead of `format` call
</code></pre>
<h3>4. Child extend-select</h3>
<pre><code class="language-toml"># parent/pyproject.toml
[tool.ruff]
lint.select = [&quot;E&quot;, &quot;UP&quot;]
</code></pre>
<pre><code class="language-toml"># child/pyproject.toml
[tool.ruff]
extend = &quot;../pyproject.toml&quot;
lint.extend-select = [&quot;UP&quot;]
</code></pre>
<pre><code class="language-console">$ ruff  check .
parent/child/foo.py:1:1: E401 [*] Multiple imports on one line
parent/child/foo.py:3:1: UP032 [*] Use f-string instead of `format` call
</code></pre>
<h3>5. Parent ignores without any child select</h3>
<pre><code class="language-toml"># parent/pyproject.toml
[tool.ruff]
lint.select = [&quot;E&quot;, &quot;UP&quot;]
lint.ignore = [&quot;E401&quot;, &quot;UP032&quot;]
</code></pre>
<pre><code class="language-toml"># child/pyproject.toml
[tool.ruff]
extend = &quot;../pyproject.toml&quot;
</code></pre>
<pre><code class="language-console">ruff  check .
All checks passed!
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-26 22:38</div>
            <div class="timeline-body"><p>So for &quot;0. Parent ignores with child select&quot;, to the best of my recollection, I thought a child <code>select</code> was intended to &quot;reset&quot; the rule selection (which tends to create more intuitive behavior), but an <code>extend-select</code> was <em>not</em> supposed to reset. So your example there <em>should</em> work as you expected. I'll have to test it out myself and see what's up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-27 08:32</div>
            <div class="timeline-body"><p>Here's a ZIP with the described repo.
<a href="https://github.com/astral-sh/ruff/files/14770373/I10622.zip">I10622.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 16:20</div>
            <div class="timeline-body"><p>I can take a look at this tonight.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-30 17:20</div>
            <div class="timeline-body"><p>On further review this is working as expected but my previous explanation was missing one piece...</p>
<p>When you use <code>extends</code>, we resolve the list of resolves one configuration file at a time. So, we first resolve all of the selectors in <code>parent/pyproject.toml</code>, and come up with a list of rules. Then, we apply the selectors in <code>child/pyproject.toml</code> on top of that list. So if you have <code>lint.extend-select = [&quot;UP&quot;]</code> in your <code>child/pyproject.toml</code>, it will indeed then add all the <code>UP</code> rules and ignore the <code>UP032</code> ignore from <code>parent/pyproject.toml</code>. However, note that <code>E401</code> is <em>still</em> disabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-03-30 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Hnasar">@Hnasar</a> on 2024-04-01 15:24</div>
            <div class="timeline-body"><p>Thanks for the explanation of how it works with the file-by-file resolution, because I was really confused because I thought the 'most specific option wins' was the standard semantics.</p>
<p>So then for my initial user story, is there any supported way to globally ignore some rules when there's a tree of configs? If we had a <code>tool.ruff.lint.ignore</code> that overrode any inherited ignores, and a <code>tool.ruff.lint.extend-ignore</code> which <em>added</em> to any inherited ignores, that would give me the tools I need to fix things, but otherwise I'm not sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-02 09:10</div>
            <div class="timeline-body"><p>I think it would be good for us to document this behavior because it wasn't clear to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2024-04-02 09:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-08-19 05:58</div>
            <div class="timeline-body"><p>This would be quite problematic with shared configs: https://github.com/astral-sh/ruff/issues/12352</p>
<p>Edit: now ignore and extend-ignore are the same.
I would expect &quot;select&quot; to &quot;reset&quot; the parent's selection. And &quot;extend-select&quot; to expand upon it. Which I believe is currently the case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cscanlin">@cscanlin</a> on 2025-10-24 18:52</div>
            <div class="timeline-body"><p>I want to bump this one up because this did not work at all how I expect, and I'm wondering if what I want to do is even possible. I have a more detailed set of rules that I want to use (for e.g. my text editor) on all projects that is more restrictive than what each project itself enforces.</p>
<p>What I originally tried (simplified):</p>
<pre><code># project/pyproject.toml
[tool.ruff]
extend = &quot;~/pyproject.toml&quot;
lint.select = [&quot;E101&quot;]
</code></pre>
<pre><code># ~/pyproject.toml
[tool.ruff]
lint.extend-select = [&quot;F701&quot;]
</code></pre>
<p>When I run <code>ruff check . --show-settings</code>, I get the following rules:</p>
<pre><code>linter.rules.enabled = [
	mixed-spaces-and-tabs (E101),
]
</code></pre>
<p>I would also expect F701 to show up there.</p>
<p>Overriding the extend-select does work as expected:
<code>ruff check . --show-settings --extend-select E401</code></p>
<pre><code>linter.rules.enabled = [
	mixed-spaces-and-tabs (E101),
	multiple-imports-on-one-line (E401),
]
</code></pre>
<p>Interestingly, if I flip this around so the select is in the parent it kind of works</p>
<pre><code># project/pyproject.toml
[tool.ruff]
extend = &quot;~/pyproject.toml&quot;
lint.extend-select = [&quot;E101&quot;]
</code></pre>
<pre><code># ~/pyproject.toml
[tool.ruff]
lint.select = [&quot;F701&quot;]
</code></pre>
<pre><code>linter.rules.enabled = [
	mixed-spaces-and-tabs (E101),
	break-outside-loop (F701),
]
</code></pre>
<p>But this will affect all instances of when ruff is run in my environment, so I'd like to be able to override the parent config select in certain cases, e.g.:
<code>ruff check . --show-settings --select E401</code></p>
<p>And I get the following:</p>
<pre><code>linter.rules.enabled = [
	multiple-imports-on-one-line (E401),
]
</code></pre>
<p>I would have expected to E101 to be included here, since the extend-select is never overridden.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-10-25 02:21</div>
            <div class="timeline-body"><blockquote>
<p>I would also expect F701 to show up there.</p>
</blockquote>
<p>@cscanlin I wouldn't, your examples seem to be working as I would expect.</p>
<p><code>select</code> will make it so <em>only</em> those listed rules are selected. You want to use <code>extend-select</code> in all cases here.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:57 UTC
    </footer>
</body>
</html>
