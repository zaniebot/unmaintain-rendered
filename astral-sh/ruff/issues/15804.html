<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve docs for RUF012 - astral-sh/ruff #15804</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Improve docs for RUF012</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/15804">#15804</a>
        opened by <a href="https://github.com/RayBB">@RayBB</a>
        on 2025-01-29 06:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/RayBB">@RayBB</a> on 2025-01-29 06:36</div>
            <div class="timeline-body"><h3>Description</h3>
<p>Hi there! I've been working on enabling RUF012 (Mutable class variables should not have default values) for OpenLibrary, and I believe the documentation for this rule could be enhanced to make it more actionable and clear. Specifically, I'd like to propose the following improvements:</p>
<h2>1. Provide a Suggestion/Example for Immutable Types That Work for dict:</h2>
<p>The current documentation for RUF012 highlights the issue of mutable default values in class variables but doesn't provide a concrete example of how to handle dict types immutably. A common solution is to use types.MappingProxyType, which creates an immutable wrapper around a dictionary. Adding an example of this would make the rule more practical and easier to implement.</p>
<p>Example:</p>
<pre><code class="language-python">from types import MappingProxyType

class MyClass:
    # Instead of a mutable dict
    MY_DICT: dict[str, str] = {}

    # Use an immutable MappingProxyType
    MY_DICT: MappingProxyType[str, str] = MappingProxyType({&quot;key&quot;: &quot;value&quot;})
</code></pre>
<h2>2. Provide an Example of Moving a Variable to Be an Instance Variable:</h2>
<p>Another way to address mutable class variables is to move them to instance variables initialized in <code>__init__</code>.</p>
<p>Example:</p>
<pre><code class="language-python">class MyClass:
    # Instead of a mutable class variable
    MY_LIST: list[int] = []

    # Move it to an instance variable
    def __init__(self):
        self.my_list: list[int] = []
</code></pre>
<p>These additions would make the documentation more comprehensive and actionable, especially for developers who are new to the rule or Python's best practices for immutability.</p>
<p>I hope this is helpful. Unfortunately, I don't have time now to update the docs myself but wanted to at least create an issue for it. Thanks for your time and consideration!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @dylwil3 on 2025-01-29 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-02 16:14</div>
            <div class="timeline-body"><p>Thanks for the detailed write up. Would you be interested in creating a PR to improve the documentation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RayBB">@RayBB</a> on 2025-02-02 16:16</div>
            <div class="timeline-body"><p>Sure I can make a PR. Do you wanna give any feedback on the examples now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-03 09:52</div>
            <div class="timeline-body"><p>it looks good to me. I'd probably simplify 2 to have the annotation on the instance attribute</p>
<pre><code class="language-python">class A:
    mutable_default: list[int]
    immutable_default: list[int]

    def __init__(self):
        self.mutable_default = []
        self.immutable_default = []
</code></pre>
<p>@AlexWaygood do you have any inputs to the documentation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-03 11:20</div>
            <div class="timeline-body"><p>Improving the examples makes sense to me! These seem like great suggestions overall.</p>
<p>I'm undecided on whether it makes sense to mention <code>MappingProxyType</code> specifically. It's true that this is one way to fix the issue:</p>
<pre><code class="language-diff">+ from types import MappingProxyType
+ from collections.abc import Mapping
+
  class A:
-     instance_dict: dict[str, str] = {&quot;key&quot;: &quot;value&quot;}
+     instance_dict: Mapping[str, str] = MappingProxyType({&quot;key&quot;: &quot;value&quot;})
</code></pre>
<p>But I think the more common way to fix the issue (assuming you want to keep it as an instance variable rather than a class variable) would be to do this:</p>
<pre><code class="language-diff">  class A:
-     instance_dict: dict[str, str] = {&quot;key&quot;: &quot;value&quot;}
+
+     def __init__(self) -&gt; None:
+         self.instance_dict: dict[str, str] = {&quot;key&quot;: &quot;value&quot;}
</code></pre>
<p>or this:</p>
<pre><code class="language-diff">  class A:
-     instance_dict: dict[str, str] = {&quot;key&quot;: &quot;value&quot;}
+     instance_dict: dict[str, str] | None = None
</code></pre>
<p>We could maybe mention <code>MappingProxyType</code> towards the bottom of the docs, but there can be costs to making the docs for a rule too long (it becomes overwhelming for users)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15982.html">astral-sh/ruff#15982</a> on 2025-02-05 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RayBB">@RayBB</a> on 2025-02-05 21:52</div>
            <div class="timeline-body"><p>Hey folks, thanks for the input here.
I opened a PR based on your comments.
I'm not particularly attached to it so feel free to edit it directly and merge as you see fit.</p>
<p>https://github.com/astral-sh/ruff/pull/15982</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-06 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-06 14:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
