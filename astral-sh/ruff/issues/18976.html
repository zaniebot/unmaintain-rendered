<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Possible to automatically ignore UP046 in cases of manual variance setting - astral-sh/ruff #18976</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Possible to automatically ignore UP046 in cases of manual variance setting</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18976">#18976</a>
        opened by <a href="https://github.com/max-muoto">@max-muoto</a>
        on 2025-06-27 05:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/max-muoto">@max-muoto</a> on 2025-06-27 05:52</div>
            <div class="timeline-body"><h3>Question</h3>
<p>While UP046 is an extremely helpful rule, in cases where I'm manually setting a <code>TypeVar</code> to covariant or contravariant (which is not something supported through the inline syntax) it would be convenient to avoid enforcement of the rule. Curious if this is something that's been considered, or that a setting could be added to allow for. The same thing goes for using type var defaults pre 3.13 (with <code>typing_extensions.TypeVar</code>).</p>
<p>Happy to see about contributing this if we're open to it.</p>
<h3>Version</h3>
<p>0.12.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @max-muoto on 2025-06-27 05:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Daverball">@Daverball</a> on 2025-06-27 12:38</div>
            <div class="timeline-body"><p>Manual variance is a hard sell for me, because <code>infer_variance</code> is only available in <code>typing_extensions.TypeVar</code> in older versions, so it's unlikely many people will use it. So it would make this rule much less useful for its intended purpose (upgrading from older versions to Python 3.12+).</p>
<p>I think it can make sense to add a configuration option for that though.</p>
<p>I do however agree that the rule should not trigger if the <code>TypeVar</code> has a <code>default</code> argument and the target version is &lt; 3.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-27 13:44</div>
            <div class="timeline-body"><p>I think UP046 and UP047 should already ignore <code>TypeVar</code>s with <code>default</code> arguments: <a href="https://play.ruff.rs/0ac6271c-1042-4fac-be69-b4e188c6e73f">playground</a>. That's actually true even on 3.13, since we haven't added support for <code>default</code> at all yet.</p>
<p>I'd be open to adding a configuration option for variance. It's already mentioned in the rule docs as a reason for the fix being unsafe, so it seems like a reasonable concern. I think we should leave the default as-is (the fix is already unsafe) but allow opting out of the rules when you've manually specified the variance.</p>
<p>Does that make sense to you, @AlexWaygood?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @ntBre on 2025-06-27 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-06-27 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @ntBre on 2025-06-27 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-27 13:49</div>
            <div class="timeline-body"><blockquote>
<p>in cases where I'm manually setting a <code>TypeVar</code> to covariant or contravariant (which is not something supported through the inline syntax) it would be convenient to avoid enforcement of the rule.</p>
</blockquote>
<p>In most cases, type checkers <em>should</em> be able to correctly infer the variance of a TypeVar (that's why it's not possible to manually specify them with the new syntax, after all!). So it <em>should</em> be pretty rare that you <em>need</em> to manually override the type checker's inference and specify a different variance to the one that the type checker infers. I'd argue it's rare enough that you should just be able to deal with this by adding <code># noqa</code> comments to the specific problematic classes?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:51 UTC
    </footer>
</body>
</html>
