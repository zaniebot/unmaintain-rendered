<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOC403 behaviour with yielding none - astral-sh/ruff #13001</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>DOC403 behaviour with yielding none</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13001">#13001</a>
        opened by <a href="https://github.com/jonyscathe">@jonyscathe</a>
        on 2024-08-20 01:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jonyscathe">@jonyscathe</a> on 2024-08-20 01:59</div>
            <div class="timeline-body"><ul>
<li>List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
&quot;DOC403 &quot;, &quot;numpydoc&quot;, &quot;yields&quot;</li>
<li>A minimal code snippet that reproduces the bug.</li>
</ul>
<pre><code>@pytest.fixture
def db_setup() -&gt; Generator[None, None, None]:
    &quot;&quot;&quot;
    Add test user.

    Yields
    ------
        And then cleans up test user.
    &quot;&quot;&quot;
    database = Database('my_database_url')
    with database.create_session() as session:
        session.execute(insert(database.Users, [{'id': 1, 'name': 'Bob'}

    yield

    with database.create_session() as session:
        session.execute(delete(database.Users).where(database.Users.id == 1234)
</code></pre>
<ul>
<li>The command you invoked (e.g., <code>ruff /path/to/file.py --fix</code>), ideally including the <code>--isolated</code> flag.
<code>ruff /path/to/file.py --fix</code></li>
<li>The current Ruff settings (any relevant sections from your <code>pyproject.toml</code>).</li>
</ul>
<pre><code>[tool.ruff]
line-length = 120
preview = true
target-version = 'py312'

[tool.ruff.format]
line-ending = 'lf'
quote-style = 'single'

[tool.ruff.lint]
extend-select = ['D213']
ignore = ['ANN401', 'CPY001', 'D107', 'D203', 'D212', 'E203', 'ISC003', 'PLC1901', 'PLR6104']
select = ['ALL']

[tool.ruff.lint.flake8-implicit-str-concat]
allow-multiline = false

[tool.ruff.lint.flake8-quotes]
inline-quotes = 'single'

[tool.ruff.lint.flake8-type-checking]
strict = true

[tool.ruff.lint.pydocstyle]
convention = 'numpy'

[tool.ruff.lint.pylint]
max-args = 14
max-statements = 75

</code></pre>
<ul>
<li>The current Ruff version (<code>ruff --version</code>).
ruff 0.6.1</li>
</ul>
<p>The above code snippet results in a DOC403 Docstring has a &quot;Yields&quot; section but the function doesn't yield anything.</p>
<p>If the yields section is removed from the docstring then <a href="https://numpydoc.readthedocs.io/en/latest/validation.html">numpydoc-validation</a> reports:</p>
<pre><code>+---------------------+-------------------+---------+-------------------------+
| file                | item              | check   | description             |
+=====================+===================+=========+=========================+
| src/conftest.py:135 | conftest.db_setup | YD01    | No Yields section found |
+---------------------+-------------------+---------+-------------------------+
</code></pre>
<p>I understand that it is debatable about what the docstring should be a for a yield statement that yields None, but I think ruff should probably match the numpydoc-validator tool in this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-20 02:49</div>
            <div class="timeline-body"><p>This seems like a bug. An empty <code>yield</code> isn't considered to be present in the body:</p>
<p>https://github.com/astral-sh/ruff/blob/4d0d3b00cb99e0abb934877dddec1ffcbc488818/crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs#L638-L644</p>
<p>@augustelalande just checking in to see if there's a specific reason behind this otherwise we can remove the <code>Some(_)</code> condition from above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2024-08-20 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2024-08-20 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-08-20 03:48</div>
            <div class="timeline-body"><p>I did this on purpose because IMO the yields section should document the yielded value not, the function behaviour associated with the yield. Similar to return None, not needing documentation.</p>
<p>The yield &quot;behaviour&quot; could be documented in the docstring summary.</p>
<p>But if people feel strongly the other way, feel free to change the behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonyscathe">@jonyscathe</a> on 2024-08-20 04:19</div>
            <div class="timeline-body"><p>@augustelalande to be fair I do agree with your logic. I only raised this due to conflicting behaviour with numpydoc's validation tool.
Maybe I will raise an issue with numpydoc and see what they say about it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-20 04:21</div>
            <div class="timeline-body"><blockquote>
<p>I did this on purpose because IMO the yields section should document the yielded value not, the function behaviour associated with the yield. Similar to return None, not needing documentation.</p>
</blockquote>
<p>Yeah, that makes sense.</p>
<blockquote>
<p>Maybe I will raise an issue with numpydoc and see what they say about it.</p>
</blockquote>
<p>@jonyscathe That might be useful, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dhruvmanila on 2024-08-20 04:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../numpy/numpydoc/issues/580.html">numpy/numpydoc#580</a> on 2024-08-21 00:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonyscathe">@jonyscathe</a> on 2024-08-21 00:53</div>
            <div class="timeline-body"><p>The numpydoc people do believe that the yield should be documented even if it is none, as it is not really the same thing as returning none (the yield is still doing something).
https://github.com/numpy/numpydoc/issues/580</p>
<p>They also have the example that something like:</p>
<pre><code>def yielder():
    for _ in range(10):
        yield
</code></pre>
<p>is inherently different to:</p>
<pre><code>def yielder():
    yield
</code></pre>
<p>And should be documented as such in the Yields section (10 implicit None's via a generator vs 1).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/larsoner">@larsoner</a> on 2024-08-21 01:02</div>
            <div class="timeline-body"><p>... and just to bring the discussion over here to save some a click, I suggested:</p>
<blockquote>
<p>It seems reasonable that [these two examples] would both need some Yields section of some sort to tell people about the nature of the returned generator.</p>
</blockquote>
<p>It seems natural to put this in a <code>Yields</code> section. But I am not 100% convinced either way. cc @stefanv who was also discussing over in numpydoc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-21 04:18</div>
            <div class="timeline-body"><p>@jonyscathe @larsoner Thanks for confirming! I think it makes sense to update the behavior. All we need is to remove the <code>Some(_)</code> match as mentioned in https://github.com/astral-sh/ruff/issues/13001#issuecomment-2297862398.</p>
<p>It seems that <code>pydoclint</code> doesn't raise an issue for the source code mentioned in the PR description.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @dhruvmanila on 2024-08-21 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @dhruvmanila on 2024-08-21 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2024-08-23 18:31</div>
            <div class="timeline-body"><p>Is the suggestion to report <a href="https://docs.astral.sh/ruff/rules/docstring-missing-yields/">docstring-missing-yields (DOC402)</a> on</p>
<pre><code class="language-python">@pytest.fixture
def db_setup() -&gt; Generator[None, None, None]:
    &quot;&quot;&quot;
    Add test user.

    &quot;&quot;&quot;
    database = Database('my_database_url')
    with database.create_session() as session:
        session.execute(insert(database.Users, [{'id': 1, 'name': 'Bob'}

    yield

    with database.create_session() as session:
        session.execute(delete(database.Users).where(database.Users.id == 1234)
</code></pre>
<p>as well?</p>
<p>If it is unclear whether implicit yield <code>None</code> requires a yields section in the docstring, it makes sense to not report a DOC403 upon its absence. However, it might also make sense to not report DOC402 if an implicit yield <code>None</code> is present without an accompanying docstring section â€” i.e., to permit the above code example. In many situations, an implicit yield <code>None</code> is trivial and only occurs once, and thus a yields section would only exist to document that the object is a generator (already achieved via a <code>typing.Generator</code> annotation).</p>
<p>If we want both DOC403 and DOC402 make exceptions for implicit yields (that is to say, count them in one and ignore in them in the other), then it is more than a one-line code change.</p>
<p>Possibly related to #13062</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13148.html">astral-sh/ruff#13148</a> on 2024-08-29 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @AlexWaygood on 2024-08-29 08:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @tjkuson by @charliermarsh on 2024-08-30 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-09-01 01:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
