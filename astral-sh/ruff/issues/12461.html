<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP031 does not support %d formatting - astral-sh/ruff #12461</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP031 does not support %d formatting</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12461">#12461</a>
        opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a>
        on 2024-07-22 19:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a></div>
            <div class="timeline-body"><p>Ruff version 0.5.4</p>
<p>The following conversion codes are currently being ignored by UP031 instead of showing as errors:</p>
<pre><code>print(&quot;%d&quot; % 1)
print(&quot;%i&quot; % 1)
print(&quot;%u&quot; % 1)
print(&quot;%c&quot; % 1) 
</code></pre>
<p>E.g.:</p>
<pre><code>$ ruff check --select UP --fixable UP --unsafe-fixes --isolated foo.py
All checks passed!
</code></pre>
<p>The presence of any of these items such as <code>%d</code> in a string will make it ignored by UP031 even if it has another supported one, such as <code>%s</code>:</p>
<pre><code>print(&quot;%d - %s&quot; % (1, 2))
</code></pre>
<p>Please support all of the valid conversion codes from this table: https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting</p>
<p>Also, if an invalid code is present (either by you not supporting or being invalid), still it should show the error for valid ones. The only difference is that you don't want to supply a fix in this case</p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-07-22 19:42</div>
            <div class="timeline-body"><p>Giving a quick look at the implementation, all this sounds like it is by design.
There is nothing in the docs that says it, but <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/resources/test/fixtures/pyupgrade/UP031_1.py">I see a test file</a> that have several formatting lines are being ignored.</p>
<p>It does sound that these options are being accepted only because there is no automated fix instead of because they are fine. There is zero reason for someone to write this in 2024 (or even 10 years ago), as the test file suggests:</p>
<pre><code>&quot;%(1)s&quot; % {&quot;1&quot;: &quot;bar&quot;}
</code></pre>
<p>All the old style string formatting options, except for bytestrings, should be deemed errors under UP031. Having a fix available for those cases or not is what should be considered instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-07-25 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-17 18:23</div>
            <div class="timeline-body"><p>This appears to have been fixed by #11229, in preview mode at the time of this writing- at least, I can no longer reproduce the &quot;All checks pass!&quot;</p>
<p><a href="https://play.ruff.rs/9b318e0c-ecbc-4f09-8c1a-f24ed7e08edc">Playground link</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-11-17 18:59</div>
            <div class="timeline-body"><p>I still get the same behavior with latest ruff</p>
<pre><code class="language-python">$ cat foo.py
print(&quot;%d&quot; % 1)
print(&quot;%i&quot; % 1)
print(&quot;%u&quot; % 1)
print(&quot;%c&quot; % 1)

$ ruff check --select UP --fixable UP --unsafe-fixes --isolated foo.py
All checks passed!

$ ruff version
ruff 0.7.4 (ed7b98cf9 2024-11-15)
</code></pre>
<p>To validate the check is actually running, if I add a 5th line with &quot;%s&quot;, that line <strong>only</strong> gets an error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-11-17 19:03</div>
            <div class="timeline-body"><p>Ohh sorry!! I forgot to add the &quot;--preview&quot;.
Yes, seem like this issue can be closed then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @inoa-jboliveira on 2024-11-17 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-17 19:03</div>
            <div class="timeline-body"><p>Hmm - would you mind trying one more time but with the preview flag <code>--preview</code>? Apologies if I'm getting something backwards here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-11-17 19:04</div>
            <div class="timeline-body"><p>Yes, thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:41 UTC
    </footer>
</body>
</html>
