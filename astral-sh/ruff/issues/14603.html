<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lint for closure that do not capture anything ?  - astral-sh/ruff #14603</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Lint for closure that do not capture anything ?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14603">#14603</a>
        opened by <a href="https://github.com/Carreau">@Carreau</a>
        on 2024-11-26 09:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Carreau">@Carreau</a> on 2024-11-26 09:20</div>
            <div class="timeline-body"><p>Hi,</p>
<p>Thanks for ruff â€“ sorry if I missed it in ruff docs and already existing opened and closed issues;
but is there any hints for function closure that do not capture any variables ?</p>
<p>I've came across a few project recently where the variable the function was closed over was removed; and the closure could have been moved outside of it's defining function as a util function; and was wondering if this is something ruff could detect.</p>
<p>Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-11-26 09:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-26 09:25</div>
            <div class="timeline-body"><p>Hi @Carreau</p>
<p>This is something that Ruff could detect well in most cases. My concern with such a rule is that there are other reasons for nested functions. For example, nesting a function might be a deliberate choice to reduce the function's visibility (make it inaccessible from outside). I haven't written enough Python code myself to judge how common this is in Python but it's a very common pattern in JavaScript.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Carreau">@Carreau</a> on 2024-11-26 09:47</div>
            <div class="timeline-body"><p>Thanks for the quick answer;</p>
<p>I do understand and I was hopping there could be a <code># noqa: number</code> in these case; it's also â€“ sometime â€“ I think a matter of taste.</p>
<p>IMHO; reduce visibility can be achieve by making the functions private (start name with underscore; ; don't list is on <code>__all__</code>, static method on class); which is always better for unit-testing and readability anyway.</p>
<p>I think non-capturing closures, that are returned from function should likely also be exempt from this.</p>
<p>I agree that for the little JS I write; there are more often locally defined functions; but Js is also better suited at functional an have an easier way of defining multiline functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-11-26 09:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-27 14:55</div>
            <div class="timeline-body"><p>Could you give a small code snippet illustrating the situation you're talking about? It's just helpful to have something to look at ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Carreau">@Carreau</a> on 2024-11-27 16:24</div>
            <div class="timeline-body"><p>Say</p>
<pre><code>def check_compatible(filename: str) -&gt; None:
    ...
    def platform_to_version(platform: str) -&gt; str:
        return (
            platform.replace(&quot;-&quot;, &quot;_&quot;)
            .removeprefix(&quot;emscripten_&quot;)
            .removesuffix(&quot;_wasm32&quot;)
            .replace(&quot;_&quot;, &quot;.&quot;)
        )

    pyodide_emscripten_version = platform_to_version(get_platform())
    ...
    return ...

</code></pre>
<p><code>platform_to_version</code> does not capture anything, and does not need to be (re)-defined at every call of <code>check_compatible</code>.</p>
<p>This often (IMHO) is an artefact of removing a closed over variable; made up example for the above for simplicity.</p>
<pre><code class="language-diff">--- a/micropip/_utils.py
+++ b/micropip/_utils.py
@@ -157,7 +157,7 @@ 
 def check_compatible(filename: str) -&gt; None:
    ...

-   suffix = '_wasm32'
     
    def platform_to_version(platform: str) -&gt; str:
         return (
             platform.replace(&quot;-&quot;, &quot;_&quot;)
             .removeprefix(&quot;emscripten_&quot;)
-             .removesuffix(suffix)
+             .removesuffix('_wasm32')
             .replace(&quot;_&quot;, &quot;.&quot;)
         )

 pyodide_emscripten_version = platform_to_version(get_platform())
 ...
 return ...

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-27 16:46</div>
            <div class="timeline-body"><p>Thank you, that helps me understand better!</p>
<p>I think this is a fairly opinionated lint, since I have often seen one-off helper functions defined in the body of another function (even if they are not using a binding from the outer function's scope). So I would be tempted to wait until we have rule categories in order to communicate to users that this would be an opinionated rule whose fit may depend on the codebase, rather than adding it as a new <code>RUF</code> rule.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:35:51 UTC
    </footer>
</body>
</html>
