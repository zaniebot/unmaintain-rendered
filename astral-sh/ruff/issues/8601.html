<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suppress RUF100 (unused noa) if we see a PGH004 (blanket noqa) error? - astral-sh/ruff #8601</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Suppress RUF100 (unused noa) if we see a PGH004 (blanket noqa) error?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8601">#8601</a>
        opened by <a href="https://github.com/alanhdu">@alanhdu</a>
        on 2023-11-10 14:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alanhdu">@alanhdu</a></div>
            <div class="timeline-body"><p>This is potentially a very niche request, but I was wondering if there was a way to suppress RUF100 errors for blanket noqa when PGH004 is enabled (and <code>external</code> lints are on)?</p>
<p>Right now, we live in a monorepo with flake8 configured along with our particular sub-codebase's <code>ruff</code> linting. The monorepo wide linting also comes with some company-specific error codes that we use the <a href="https://docs.astral.sh/ruff/settings/#external"><code>external</code></a> setting for. Unfortunately, we're hitting a problem with blanket noqas -- things like:</p>
<pre><code>some_code_that_triggers_internal_lint # noqa
</code></pre>
<p>which triggers RUF100 when the <em>real</em> problem is that it should be annotated with <code># noqa: &lt;internal&gt;</code>. I was hoping to use <code>PGH004</code> instead to flag these blanket noqa, but am running into two problems:</p>
<ul>
<li>Such errors will trigger two lints (unnecessary noqa and needs a specific error code). This is a little confusing, b/c the error code is actually the one users should pay attention to.</li>
<li>The RUF100 autofix will delete the <code># noqa</code>, even when it's necessary to silence the monorepo wide flake8.</li>
</ul>
<p>I think the two things that'd help us with the ruff roll out are to:</p>
<ul>
<li>Change the RUF100 to be an unsafe-fix for blanket noqa if <code>external</code> is specified</li>
<li>If PGH004 <em>and</em> RUF100 both trigger on the same noqa, only emit the PGH004 lint error (maybe hidden behind some flag)?</li>
</ul>
<p>Would that make sense? Not sure if this is a reasonable thing to support our if our setup is too idiosyncratic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-11 15:25</div>
            <div class="timeline-body"><p>Yeah I totally see the issue here. I think the second suggestion is going to be challenging, since we really prefer to keep rule behavior independent of the set of enabled rules (that is, we really want rules to operate independently, such that enabling or disabling one rule shouldn't affect the behavior of another). Breaking that principle can lead to confusing interactions, e.g., if you run <code>ruff check</code> with <code>RULE</code> in your <code>pyproject.toml</code> vs. <code>ruff check --select RULE</code>, you could then see different diagnostics for <code>RULE</code> if it relies on enabled codes. (I should admit that <code>RUF100</code> is the one rule that actually <em>does</em> suffer from this problem, since it can only detect whether a <code># noqa</code> is used for the <em>enabled</em> rules, but it at least tells you which rules are known-but-disabled codes.)</p>
<p>A few options, which may all be bad, I'm not sure:</p>
<ol>
<li>Change the RUF100 to be an unsafe-fix for blanket noqa if <code>external</code> is specified (as proposed above -- this seems reasonable).</li>
<li>Don't flag <code>RUF100</code> on blank <code># noqa</code> <em>at all</em> if <code>external</code> is enabled.</li>
<li>If <code>external</code> is enabled, consider making the <code>RUF100</code> fix such that we add the external codes to a blanket <code># noqa</code>? I don't know how long <code>external</code> gets in practice.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">noqa</span> added by @charliermarsh on 2023-11-11 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-11-11 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:58 UTC
    </footer>
</body>
</html>
