<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter instability: lines after comment at module level - astral-sh/ruff #7604</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter instability: lines after comment at module level</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7604">#7604</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-09-22 16:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>Given:</p>
<pre><code>import random;

# Defaults for arguments are defined here
# args.threshold = None;


logger = logging.getLogger(&quot;FastProject&quot;);

</code></pre>
<p>We&#x27;re reformatting as:</p>
<pre><code># -*- coding: utf-8 -*-
import random

# Defaults for arguments are defined here
# args.threshold = None;


logger = logging.getLogger(&quot;FastProject&quot;)
</code></pre>
<p>Formatted twice:</p>
<pre><code>import random

# Defaults for arguments are defined here
# args.threshold = None;

logger = logging.getLogger(&quot;FastProject&quot;)
</code></pre>
<pre><code>--- Formatted once
+++ Formatted twice
@@ -3,5 +3,4 @@
 # Defaults for arguments are defined here
 # args.threshold = None;
 
-
 logger = logging.getLogger(&quot;FastProject&quot;)
</code></pre>
<p>(That is: removing a newline before <code>logger =</code>.)</p>
<p>This leads to an instability.</p>
<p>Sourced from <a href="https://github.com/astral-sh/ruff/issues/7590">astral-sh/ruff#7590</a> (<code>A_3703355012074323529.py</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Formatter: Beta&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 16:20</div>
            <div class="timeline-body"><p>For posterity, the original source code here (which doesn&#x27;t strip the newline) is:</p>
<pre><code># -*- coding: utf-8 -*-
&quot;&quot;&quot;Contains information that is useful to share
across all modules.

Right now, mainly command-line arguments, logging
and resource locations.
&quot;&quot;&quot;
from __future__ import absolute_import, print_function, division;
import logging;
import sys
import os
import random;

# Defaults for arguments are defined here
# These are all overwritten if called from the command line
# However, by putting defaults here, it makes it easier to
#    call FastProject from within other scripts
# These should be kept in sync with arguments in __main__.py
# args = namedtuple(&quot;defalt_args&quot;,  [&quot;data_file&quot;,  &quot;housekeeping&quot;,
#                                    &quot;signatures&quot;,  &quot;precomputed&quot;,  &quot;output&quot;,
#                                    &quot;nofilter&quot;,  &quot;nomodel&quot;,  &quot;pca_filter&quot;,
#                                    &quot;qc&quot;,  &quot;subsample_size&quot;,
#                                    &quot;min_signature_genes&quot;,  &quot;projections&quot;,
#                                    &quot;weights&quot;,  &quot;threshold&quot;]);
# 
# args.data_file = &quot;&quot;;
# args.housekeeping = &quot;&quot;;
# args.signatures = [];
# args.precomputed = [];
# args.output = &quot;&quot;;
# args.nofilter = False;
# args.nomodel = False;
# args.pca_filter = False;
# args.qc = False;
# args.subsample_size = None;
# args.min_signature_genes = 5;
# args.projections = [];
# args.weights = &quot;&quot;;
# args.threshold = None;


logger = logging.getLogger(&quot;FastProject&quot;);
</code></pre>
<p>So everything is suffixed with a semicolon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-22 16:53</div>
            <div class="timeline-body"><p>This seems to be fixed on main (creating a snapshot test and running our test suite passes without an instability error)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-22 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-22 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-22 16:59</div>
            <div class="timeline-body"><p>Okay, the case with semicolons isn&#x27;t fixed ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-22 17:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:42 UTC
    </footer>
</body>
</html>
