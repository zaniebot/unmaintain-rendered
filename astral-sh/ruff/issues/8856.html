<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>docstring code formatter: emit warning messages when code snippets fail to format - astral-sh/ruff #8856</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>docstring code formatter: emit warning messages when code snippets fail to format</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8856">#8856</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2023-11-27 16:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>#8811 added initial support for formatting doctest code snippets in docstrings, but it does have some silent behavior that should probably be louder. For example, if it detects a code snippet that is invalid Python, then it will silently skip the code snippet. Another example is a bit more pathological, but it is possible for the code snippet formatter to generate invalid Python in some case (as a result of nested triple quoted strings in some cases). In this case, we detect it and bail out of reformatting the code snippet. Ideally, we would emit a warning about this too, although this is arguably more of a bug in the current implementation.</p>
<p>This was <a href="https://github.com/astral-sh/ruff/pull/8811#discussion_r1401252822">brought up in review</a>, and it was suggested that perhaps we split the warning/logging infrastructure out from the linter and use it in the formatter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @BurntSushi on 2023-11-27 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @BurntSushi on 2023-11-27 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 23:28</div>
            <div class="timeline-body"><blockquote>
<p>This was https://github.com/astral-sh/ruff/pull/8811#discussion_r1401252822, and it was suggested that perhaps we split the warning/logging infrastructure out from the linter and use it in the formatter.</p>
</blockquote>
<p>I'm a bit hesitant of adopting the linter's <code>warn</code> macros because they assume a CLI client and either mess with <code>stderr</code> if you would call ruff through a python or rust API or are silently ignored in the LSP.</p>
<p>Ideally we would return diagnostics as part of the formatted result and it's the caller's responsibility to present them somehow to the user.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-28 06:15</div>
            <div class="timeline-body"><p>If we don't think we're going to add diagnostics to the formatter API in the near future, though, warning is not unreasonable IMO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Stable" by @BurntSushi on 2023-11-29 13:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-12-22 06:08</div>
            <div class="timeline-body"><p>@BurntSushi are you planning to work on this for the stable release? If not, then I recommend removing it from Stable and mark it as wish (I agree we should do it, but I think we could ship the stable without it)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Stable" by @BurntSushi on 2023-12-23 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @BurntSushi on 2023-12-23 12:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:07 UTC
    </footer>
</body>
</html>
