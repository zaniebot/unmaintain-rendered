<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--config` as a global flag/env var - astral-sh/ruff #9892</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>--config</code> as a global flag/env var</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9892">#9892</a>
        opened by <a href="https://github.com/abbec">@abbec</a>
        on 2024-02-08 09:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/abbec">@abbec</a></div>
            <div class="timeline-body"><p>Hi,</p>
<p>Thanks for a great tool! However, it would be super great if the <code>--config</code> flag could be passed globally. I.e. that all commands accepted it but did not use it. We are generating the ruff config and wrapping the tool execution in a script and currently we have to parse the subcommand to know when to add <code>--config</code> or not. An environment variable to control the config file would also work fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abbec">@abbec</a> on 2024-02-08 09:53</div>
            <div class="timeline-body"><p>Also noticed that some global flags (like <code>-v</code>) does not work with some subcommands:</p>
<pre><code>$ ruff -v rule
[2024-02-08][10:52:40][ruff_cli::resolve][DEBUG] Using Ruff default settings
[2024-02-08][10:52:40][ruff_cli::commands::check][DEBUG] Identified files to lint in: 450.238µs
[2024-02-08][10:52:40][ruff_cli::commands::check][DEBUG] Checked 1 files in: 35.4µs
rule:1:1: E902 No such file or directory (os error 2)
Found 1 error.
</code></pre>
<p>so it looks like it is trying to run <code>check</code> on a file called <code>rule</code> because I added the <code>-v</code> flag (<code>-q</code> behaves the same).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-10 23:56</div>
            <div class="timeline-body"><p>I think this might be solved in the next release via <a href="https://github.com/astral-sh/ruff/pull/9599">astral-sh/ruff#9599</a>, which lets you pass any argument via the <code>--config</code> flag. E.g., you can pass <code>--config &quot;lint.isort.combine-as-imports=false&quot;</code>. Does that work for you?</p>
<p>Separately... the <code>ruff -v rule</code> thing is a really specific failure, which is that when we added subcommands (like <code>ruff check</code>), we kept <code>ruff /path/to/file.py</code> working for backwards-compatibility. So if you pass some non-subcommand, then Ruff thinks you&#x27;re trying to check a file named <code>-v</code>. (We&#x27;ll fix this in the future when we deprecate calling <code>ruff</code> without a subcommand.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-10 23:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abbec">@abbec</a> on 2024-02-12 16:28</div>
            <div class="timeline-body"><p>Unless I have missed something, I do not think so. We need a way to wrap the ruff binary such that we can always pass the <code>--config</code> flag without implementing our own subcommand parsing. Think of our wrapper as a &quot;ruff but with this config instead of the default&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-12 17:06</div>
            <div class="timeline-body"><p>Can I ask what subcommands you&#x27;re running?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abbec">@abbec</a> on 2024-02-12 22:10</div>
            <div class="timeline-body"><p>All of them. I.e. we expose a wrapped ruff executable so that users can use like it was the original ruff, only with our default config. Alas, they might run <code>ruff version</code>, <code>ruff check</code> or <code>ruff linter</code>. We just want to make sure that all users get a default config.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-13 08:54</div>
            <div class="timeline-body"><p>I quite like pytest&#x27;s solution to this problem — they allow arbitrary CLI options to be set using the <code>PYTEST_ADDOPTS</code> environment variable: https://docs.pytest.org/en/7.1.x/example/simple.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 09:35</div>
            <div class="timeline-body"><p>My main concern with fancy environment option inheritance is that it can feel rather magic and is hard to debug. I&#x27;ve run into this more than once myself where I forgot that I set some env variable and couldn&#x27;t figure out why a tool isn&#x27;t behaving the way I expect it.</p>
<p>This can be mitigated by providing better debugging tools explaining from where ruff takes which options but this is something I haven&#x27;t seen in any tool today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abbec">@abbec</a> on 2024-02-13 10:14</div>
            <div class="timeline-body"><p>In our case it does not have to be environment either. But the other tools we use (<code>pytest</code>, <code>mypy</code>, <code>black</code> <code>pylint</code>, <code>flake8</code>) can be passed their equivalent <code>--config</code> parameter regardless of which subcommand/flags are used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 10:46</div>
            <div class="timeline-body"><p>Making --config a global option makes sense to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-27 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alan-isaac">@alan-isaac</a> on 2024-02-28 23:33</div>
            <div class="timeline-body"><blockquote>
<p>Separately... the <code>ruff -v rule</code> thing is a really specific failure, which is that when we added subcommands (like <code>ruff check</code>), we kept <code>ruff /path/to/file.py</code> working for backwards-compatibility. So if you pass some non-subcommand, then Ruff thinks you&#x27;re trying to check a file named <code>-v</code>. (We&#x27;ll fix this in the future when we deprecate calling <code>ruff</code> without a subcommand.)</p>
</blockquote>
<p>This was really confusing until I found this issue. Simply reporting the name of the file not found as part of the error message would have helped pin things down.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-04 11:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:49 UTC
    </footer>
</body>
</html>
