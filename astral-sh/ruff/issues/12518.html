<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F632 suggestion leads to false positive when comparing False == 0 - astral-sh/ruff #12518</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F632 suggestion leads to false positive when comparing False == 0</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12518">#12518</a>
        opened by <a href="https://github.com/GalexyN">@GalexyN</a>
        on 2024-07-25 23:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/GalexyN">@GalexyN</a> on 2024-07-25 23:50</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
A minimal code snippet that reproduces the bug.
The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
The current Ruff settings (any relevant sections from your `pyproject.toml`).
The current Ruff version (`ruff --version`).
-->

<blockquote>
<p>List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.</p>
</blockquote>
<ul>
<li>F632</li>
<li>False positive F632</li>
<li><code>False is 0</code></li>
<li><code>False == 0</code></li>
</ul>
<blockquote>
<p>A minimal code snippet that reproduces the bug.</p>
</blockquote>
<p>https://replit.com/@GalexyN/JuvenilePiercingSeahorse?v=1</p>
<p>The repl might be overkill but essentially i have use case where im using JMESPath to search for values in a dictionary. The end result is that I will need to do something if there isnt a match. A match is determined by if the JMESPath query returns a truthy value or the value is int 0. In my code I wanted to do <code>value is 0</code>. <code>False is 0</code> would return False, which is what I want, however the ruff rule F632 suggests that I change it to <code>value == 0</code>. This would return True. My CI will not pass the lint check because of this, so I opted for doing <code>type(value) is int and value == 0</code>. This would equate to False. I also can't use <code>isinstance(value, int) and value == 0</code> because bool is a subclass of int so that would also result in True.</p>
<blockquote>
<p>The command you invoked</p>
</blockquote>
<p>I just ran the repl</p>
<blockquote>
<p>The current Ruff settings (any relevant sections from your <code>pyproject.toml</code>)</p>
</blockquote>
<pre><code class="language-toml">[tool.poetry]
name = &quot;python-template&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Your Name &lt;you@example.com&gt;&quot;]

[tool.poetry.dependencies]
python = &quot;&gt;=3.10.0,&lt;3.12&quot;
ruff = &quot;^0.5.5&quot;
jmespath = &quot;^1.0.1&quot;

[tool.pyright]
# https://github.com/microsoft/pyright/blob/main/docs/configuration.md
useLibraryCodeForTypes = true
exclude = [&quot;.cache&quot;]

[tool.ruff]
# https://beta.ruff.rs/docs/configuration/
select = ['E', 'W', 'F', 'I', 'B', 'C4', 'ARG', 'SIM']
ignore = ['W291', 'W292', 'W293']

[build-system]
requires = [&quot;poetry-core&gt;=1.0.0&quot;]
build-backend = &quot;poetry.core.masonry.api&quot;
</code></pre>
<blockquote>
<p>The current Ruff version (<code>ruff --version</code>).</p>
</blockquote>
<p>ruff@0.5.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-29 13:36</div>
            <div class="timeline-body"><p>Hey @GalexyN! The Ruff lint F632 is to help you avoid using identity checks with numeric literals like <code>0</code>. Using an identity check like <code>x is 0</code> might give you the right answer sometimes, but it isn't guaranteed to do so. That's because the <code>is</code> operator checks for an exact identity match -- it doesn't just check for equality, it checks that exactly the same object at the same memory address is on both sides of the <code>is</code> operator. For example:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; x = 2_000
&gt;&gt;&gt; y = 2_000
&gt;&gt;&gt; x == y
True
&gt;&gt;&gt; x is y
False
</code></pre>
<p>For some small numbers, like 0, you can sometimes get the right result using an identity check, because Python interns small numbers (it reuses the same object from the same address in memory, as an optimisation). However, you shouldn't count on it: this is just an optimisation rather than a guarantee that Python makes, so your code could break at any time. It's for this reason that Python will actually emit a warning if you try to do an identity check with a numeric literal:</p>
<pre><code class="language-pycon">Python 3.12.4 (main, Jun 12 2024, 09:54:41) [Clang 15.0.0 (clang-1500.3.9.4)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; False is 0
&lt;stdin&gt;-0:1: SyntaxWarning: &quot;is&quot; with 'int' literal. Did you mean &quot;==&quot;?
False
</code></pre>
<p>So I would say that this is not a false positive here. If you want to ensure that something is exactly <code>0</code> (and not <code>False</code>, or any other object that could have a falsey boolean value), I think this would be the most secure way of doing it -- which is one of the options you suggested above:</p>
<pre><code class="language-py">if type(x) is int and x == 0:
    ...
</code></pre>
<p>I can see that the autofix is not doing what you'd like in this case, since the autofix would make this change to your code:</p>
<pre><code class="language-diff">- if x is 0:
+ if x == 0:
      ...
</code></pre>
<p>When you'd prefer it to make this change:</p>
<pre><code class="language-diff">- if x is 0:
+ if type(x) is int and x == 0:
      ...
</code></pre>
<p>However, I think the majority of users who are falling into this trap would prefer the existing autofix: I think that that's more likely to be what they &quot;meant&quot;. In general, most code doesn't care if a <code>bool</code> is passed when an <code>int</code> is expected, and some code in fact relies on <code>bool</code> being a subclass of <code>int</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @AlexWaygood on 2024-07-29 13:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GalexyN">@GalexyN</a> on 2024-07-29 16:46</div>
            <div class="timeline-body"><p>Okay great thanks for the explanation @AlexWaygood! I'll continue with you explicit check for zero that i'm doing ðŸ™Œ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @GalexyN on 2024-07-29 16:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
