<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruff check --fix ignores ruff.toml when --stdin-filename is present on the command line - astral-sh/ruff #21264</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>ruff check --fix ignores ruff.toml when --stdin-filename is present on the command line</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/21264">#21264</a>
        opened by <a href="https://github.com/mgedmin">@mgedmin</a>
        on 2025-11-03 21:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mgedmin">@mgedmin</a> on 2025-11-03 21:05</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I would like to use Vim to edit my code.  I use a Vim plugin called ALE to show me lint messages, and also to fix certain things.  ALE can use various tools, including Ruff.</p>
<p>I've noticed that when I use vim's <code>:ALEFix</code> command with ruff configured as the fixer, ruff will ignore custom configuration in a <code>ruff.toml</code>.  Specifically, I want ruff to sort my imports, so I created a <code>ruff.toml</code> in the parent directory with</p>
<pre><code class="language-toml">[lint]
extend-select = [&quot;I&quot;]

[lint.isort]
lines-after-imports = 2
</code></pre>
<p>I can test this in shell and it works fine: <code>ruff check --fix - &lt; myfile.py</code>.</p>
<p>I used vim's <code>:ALEDetails</code> to see what exactly ALE is executing, and saw that it was also passing <code>--stdin-filename myfile.py</code>.</p>
<p>I've tested in shell and <code>ruff check --stdin-filename myfile.py --fix - &lt; myfile.py</code> ignores my ruff.toml and doesn't sort my imports.</p>
<p>I don't understand why the presence of <code>--stdin-filename</code> would affect the configuration file lookup logic, and I didn't see anything like this mentioned in the documentation next to <code>--stdin-filename</code> or in the section about configuration file lookup logic, so I assume it must be a bug.  Hence this report.</p>
<h3>Version</h3>
<p>ruff 0.14.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-11-03 21:23</div>
            <div class="timeline-body"><p>I can reproduce this. It looks like a relative <code>--stdin-filename</code>, which is used here:</p>
<p>https://github.com/astral-sh/ruff/blob/f64bbb45b9d7249138d65cc9b9ac6b87f74eef1b/crates/ruff/src/resolve.rs#L65</p>
<p>has no ancestors and so doesn't enter the code here:</p>
<p>https://github.com/astral-sh/ruff/blob/f64bbb45b9d7249138d65cc9b9ac6b87f74eef1b/crates/ruff_workspace/src/pyproject.rs#L92-L94</p>
<p>One workaround then is to use an absolute <code>--stdin-filename</code> argument:</p>
<pre><code class="language-shell">$ ruff check --no-cache --stdin-filename $(realpath try.py) - &lt;&lt;EOF
type X[T] = list[T]
EOF
try.py:1:1: SyntaxError: Cannot use `type` alias statement on Python 3.10 (syntax was added in Python 3.12)
  |
1 | type X[T] = list[T]
  | ^^^^
  |

Found 1 error.
$ ruff check --no-cache --stdin-filename try.py - &lt;&lt;EOF
type X[T] = list[T]
EOF
All checks passed!
$ ruff check --no-cache - &lt;&lt;EOF
type X[T] = list[T]
EOF
-:1:1: SyntaxError: Cannot use `type` alias statement on Python 3.10 (syntax was added in Python 3.12)
  |
1 | type X[T] = list[T]
  | ^^^^
  |

Found 1 error.
</code></pre>
<p>with a <code>ruff.toml</code> file in a parent directory setting the Python version to 3.10, so the diagnostic is correct.</p>
<p>But hopefully we can fix something here too because this does seem surprising.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @ntBre on 2025-11-03 21:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
