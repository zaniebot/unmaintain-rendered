<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should unions including `Any` trigger `ANN401` (or some other rule)? - astral-sh/ruff #5458</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should unions including `Any` trigger `ANN401` (or some other rule)?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/5458">#5458</a>
        opened by <a href="https://github.com/bersbersbers">@bersbersbers</a>
        on 2023-07-01 20:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bersbersbers">@bersbersbers</a> on 2023-07-01 20:10</div>
            <div class="timeline-body"><pre><code class="language-python">from typing import Any

def fun_ann401(abc: Any) -&gt; None:
    print(abc)

def fun_no_error(abc: Any | None = None) -&gt; None:
    print(abc)
</code></pre>
<p>gives</p>
<blockquote>
<p>bug.py:4:21: ANN401 Dynamically typed expressions (typing.Any) are disallowed in <code>abc</code></p>
</blockquote>
<p>I wonder why that error is not also emitted for <code>fun_no_error</code>. <code>Any | None</code> is at least as undefined as <code>Any</code> is.</p>
<p>Another option would be to add a new rule that says</p>
<blockquote>
<p><code>Any | Foo</code> is redundant and should be replaced by <code>Any</code>.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5459.html">astral-sh/ruff#5459</a> on 2023-07-01 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5460.html">astral-sh/ruff#5460</a> on 2023-07-01 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-02 20:06</div>
            <div class="timeline-body"><p>I think it should be included, yeah.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-07-02 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-02 20:06</div>
            <div class="timeline-body"><p>Maybe we can reuse the logic that @dhruvmanila added for implicit optionals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-04 13:27</div>
            <div class="timeline-body"><blockquote>
<p>Maybe we can reuse the logic that @dhruvmanila added for implicit optionals.</p>
</blockquote>
<p>If I understand correctly, do you mean to check if there's <code>typing.Any</code> instead of <code>None</code> in the <code>TypingTarget</code>? Or, do you just mean to use the <code>|</code> union iterator to check if there's <code>Any</code> in it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-04 13:28</div>
            <div class="timeline-body"><p>The latter! Does that make sense?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-04 13:36</div>
            <div class="timeline-body"><p>It does but then <code>Union[Any, None]</code> (which is same as <code>Any | None</code>) won't be triggered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-04 13:39</div>
            <div class="timeline-body"><p>Actually, this then brings up the question if we should look for <code>Any</code> in other places as well (<code>Optional[Any]</code>).</p>
<p>I believe the main question would be &quot;does this type resolve to <code>Any</code>&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-04 14:02</div>
            <div class="timeline-body"><p>Err, sorry, I may have misunderstood your question. We're just looking to understand whether the type resolves to <code>Any</code>, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-04 14:23</div>
            <div class="timeline-body"><p>Right, then I believe the following cases should also be considered although the original <a href="https://github.com/sco1/flake8-annotations#dynamic-typing-caveats">plugin doesn't support them</a>.</p>
<ul>
<li><code>Any | ...</code></li>
<li><code>Union[Any, ...]</code></li>
<li><code>Optional[Any]</code></li>
<li><code>Annotated[&lt;any of the above variants&gt;, ...]</code></li>
<li>Forward references?</li>
</ul>
<p>Does this make sense?</p>
<p>I don't think <code>Any</code> in container types (e.g., <code>list[Any]</code>) should be considered, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-04 22:03</div>
            <div class="timeline-body"><p>Yes, agreed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2023-07-05 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-05 03:19</div>
            <div class="timeline-body"><p>It should be simple enough to extract out the logic from <code>implicit-optional</code> check and add another method to check for <code>Any</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5601.html">astral-sh/ruff#5601</a> on 2023-07-07 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @charliermarsh on 2023-07-10 01:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-07-13 12:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
