<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`TRY004` auto-fix is too aggressive - astral-sh/ruff #2158</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`TRY004` auto-fix is too aggressive</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2158">#2158</a>
        opened by <a href="https://github.com/WilliamJamieson">@WilliamJamieson</a>
        on 2023-01-25 16:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/WilliamJamieson">@WilliamJamieson</a> on 2023-01-25 16:40</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

- A minimal code snippet that reproduces the bug.
- The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
- The current Ruff settings (any relevant sections from your `pyproject.toml`).
- The current Ruff version (`ruff --version`).
-->

<p>The <code>TRY004</code> (<a href="https://github.com/guilatrova/tryceratops/blob/main/docs/violations/TC004.md"><code>TC004</code></a> in try.ceratops) is a bit too aggressive for me.</p>
<p>It is indicating an error in:</p>
<pre><code class="language-python">if isinstance(this, some_type):
    # look for a something in `this` and return it, if it is found
   ....

    raise ValueError(f&quot;{this} does not have what your looking for&quot;)
</code></pre>
<p>This is not a <code>TypeError</code> as what <code>TRY004</code> is saying it should be, and I don't like the auto-fix trying to correct this. I think this is a <code>ValueError</code> as <code>this</code> does not contain the value I am looking for.</p>
<p>Note that the above also does not follow the example presented in the try.ceratops docs, namely:</p>
<pre><code class="language-python">if isinstance(my_var, int):
    pass
else:
    raise ValueError(f'{my_var} must be an int')
</code></pre>
<p>Should raise a <code>TypeError</code> instead (as it is not the correct type).</p>
<p>It seems like <code>ruff</code> is doing more with <code>TRY004</code> than checking for errors raised if the type is not what is expected. It seems to be also applying this to cases where a type check is performed and then an error is raised within that check, not if the check fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 16:45</div>
            <div class="timeline-body"><p>Thanks for filing! Looks like we're not handling the <code>else</code> case faithfully.</p>
<p>What would you suggest as a better methodology for TRY004? Only flag if there are no other statements in the <code>if</code> block, to be more conservative? I <em>think</em> the originating plugin also flags on the case you've described, but definitely correct me if I'm mistaken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-01-25 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WilliamJamieson">@WilliamJamieson</a> on 2023-01-25 16:50</div>
            <div class="timeline-body"><p>I would prefer if it didn't flag if there is a return (method to escape) between the start of the block and the error being raised. That would imply (to me) that the error is not being raised due to the type of something but for some other reason.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 16:53</div>
            <div class="timeline-body"><p>That seems reasonable to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-01-25 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-01-25 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WilliamJamieson">@WilliamJamieson</a> on 2023-01-25 17:04</div>
            <div class="timeline-body"><p>In any case, I don't think this should be autofixed by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 17:16</div>
            <div class="timeline-body"><p>Let me think on it! We're already working on a more granular API for enabling safe and unsafe fixes of varying degrees. You also have full control to disable fixes for any rule or class of rules like so:</p>
<pre><code class="language-toml">[tool.ruff]
unfixable = [&quot;TRY004&quot;, &quot;B&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2162.html">astral-sh/ruff#2162</a> on 2023-01-25 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-25 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../asdf-format/asdf/pulls/1329.html">asdf-format/asdf#1329</a> on 2023-01-26 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../asdf-format/asdf/pulls/1339.html">asdf-format/asdf#1339</a> on 2023-01-30 16:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:07 UTC
    </footer>
</body>
</html>
