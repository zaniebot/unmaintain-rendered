<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COM812: correct? - astral-sh/ruff #3303</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>COM812: correct?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/3303">#3303</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-03-02 12:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/spaceone">@spaceone</a> on 2023-03-02 12:26</div>
            <div class="timeline-body"><pre><code class="language-python">foo = tuple
print(
    list(foo(1, 2, 3, 4))
    + list(foo(6, 7, 8, 9))
    + list(foo(6, 7, 8, 9))
    + list(foo(6, 7, 8, 9))
    + list(foo(6, 7, 8, 9))
)
</code></pre>
<p>tells me: <code>foo.py|7 col 28 error| COM812 [*] Trailing comma missing</code> which looks strange.</p>
<p>Also <code>black</code> wouldn't change the code:</p>
<pre><code class="language-console">$ black --diff foo.py
All done! ‚ú® üç∞ ‚ú®
1 file would be left unchanged
</code></pre>
<p>is that trailing comma correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluetech">@bluetech</a> on 2023-03-02 14:56</div>
            <div class="timeline-body"><p>It is technically correct. I noticed myself many cases where a trailing comma is technically correct but undesirable, like this one, but I can't quite phrase the correct heuristic. It definitely involves single-argument function calls, but sometimes I do want a trailing comma for these...</p>
<blockquote>
<p>Also black wouldn't change the code</p>
</blockquote>
<p>Does black add trailing commas at all?</p>
<p>If a trailing comma is present in this example, does black <em>remove</em> it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-03-02 14:57</div>
            <div class="timeline-body"><p>no, <code>black</code> doesn't remove it.
The trailing commata is sometimes a marker in black to split things into multiline.
but that is also probably not related to this rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluetech">@bluetech</a> on 2023-03-02 15:05</div>
            <div class="timeline-body"><p>So black can't guide us on the desired heuristic here.</p>
<p>I myself turned off COM812 due to these two cases in Django code:</p>
<pre><code class="language-py">results = list(
    # ... Long queryset ...
    xxx   # &lt;-- Don't want comma here
)
</code></pre>
<pre><code class="language-py">class MyModel(models.Model):
    my_field = models.CharField(
        ...,
        help_text=_(
             &quot;Long help text &quot;
             &quot;Here&quot;   # &lt;-- Don't want comma here
        ),
    )
</code></pre>
<p>One heuristic is to not add trailing comma on single-argument function calls, but this is not 100%.</p>
<p>Another option is to add a setting for function names to which trailing comma shouldn't be added (<code>list</code> and <code>_</code> in my case), but would be better if it's not needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluetech">@bluetech</a> on 2023-03-02 15:08</div>
            <div class="timeline-body"><p>Some discussion in flake8-commas issue: https://github.com/PyCQA/flake8-commas/issues/59</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-03-02 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-02 20:33</div>
            <div class="timeline-body"><blockquote>
<p>One heuristic is to not add trailing comma on single-argument function calls, but this is not 100%.</p>
</blockquote>
<p>In which condition would having a comma for single argument in function be desirable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluetech">@bluetech</a> on 2023-03-02 21:06</div>
            <div class="timeline-body"><p>Any function that can have more arguments. If we stay in DJango just for the example</p>
<pre><code class="language-py">my_field = models.CharField(
    _(&quot;My field&quot;)
)
</code></pre>
<p>I'd want a trailing comma in this case. But not having one is better than disabling COM802 entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-02 21:10</div>
            <div class="timeline-body"><p>Yeah it's very reasonable to have a trailing comma for a single-argument function IMO.</p>
<p>Black does add a trailing comma if you have more than one argument -- so it doesn't add one after <code>list(...)</code> here:</p>
<pre><code class="language-py">x(
    list(
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        812093129032910381290321903219031,
        812093129032910381290321903219031,
    )
)
</code></pre>
<p>But it does add one after <code>y</code> here:</p>
<pre><code class="language-py">x(
    list(
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        812093129032910381290321903219031,
        812093129032910381290321903219031,
    ),
    y
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-02 21:11</div>
            <div class="timeline-body"><p>We could avoid adding a trailing comma for single-argument functions that match certain expressions... like binary expressions, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-03-14 21:18</div>
            <div class="timeline-body"><p>Whilst I don't use black, I do use <a href="https://github.com/asottile/add-trailing-comma#multi-line-method-invocation-style----why"><code>add-trailing-comma</code>'s multiline method invocation style</a>, which is worth taking a look at.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-14 22:10</div>
            <div class="timeline-body"><p>Looks like <code>add-trailing-comma</code> <em>does</em> add a comma in this case, like Ruff (but avoids trailing commas for functions with trailing <code>*args</code> or <code>**kwargs</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-03-14 23:26</div>
            <div class="timeline-body"><blockquote>
<p>[...] (but avoids trailing commas for functions with trailing <code>*args</code> or <code>**kwargs</code>).</p>
</blockquote>
<p>To be exact, <a href="https://github.com/asottile/add-trailing-comma#trailing-commas-for-function-definitions-with-unpacking-arguments">it only does so for python 3.5</a>, <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#trailing-commas">so does Black</a>, and because that'd be a syntax error. On recent python versions everything multiline gets a trailing comma. I don't think Ruff is even concerned about EOL python versions.</p>
<p>The reasoning <code>add-trailing-comma</code> uses on reducing lines in a diff is sound to me. And the reason why I want trailing commas in the first place.
I can see the argument for aesthetics on single-parameters. Even Black didn't take a hard stance here (which I find surprising).</p>
<p>Since this is more or less all gonna end up being the same rule in Ruff, maybe this should be left to the user's choice in whatever config system Ruff is going towards (insert trailing commas for single multiline items, remove trailing commas for single multiline items, or leave as-is with a &quot;<a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#the-magic-trailing-comma">magic trailing comma</a>&quot; like black does)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-14 23:56</div>
            <div class="timeline-body"><p>Yeah right now the Ruff formatter uses similar trailing comma rules to Black. I think I'm fine with us inserting a trailing comma even for single-argument calls in COM812 right now -- it can look odd in some cases, but I think it's &quot;correct&quot; and matches the intent of the rule, so I'll close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-14 23:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4507.html">astral-sh/ruff#4507</a> on 2023-05-18 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/benjamin-kirkbride">@benjamin-kirkbride</a> on 2023-07-08 20:43</div>
            <div class="timeline-body"><p><img src="https://github.com/astral-sh/ruff/assets/3373830/52daca39-0e45-4b96-b40a-75148f23f3ac" alt="image" /></p>
<p>is this related?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6525.html">astral-sh/ruff#6525</a> on 2023-08-12 18:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
