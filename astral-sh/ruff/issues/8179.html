<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter undocumented deviation: Formatting of long lambda as keyword argument  - astral-sh/ruff #8179</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter undocumented deviation: Formatting of long lambda as keyword argument</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8179">#8179</a>
        opened by <a href="https://github.com/henribru">@henribru</a>
        on 2023-10-24 19:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/henribru">@henribru</a></div>
            <div class="timeline-body"><p><a href="https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AEtAIddAD2IimZxl1N_WlbvK5V8G17R4xukEnqOHRjoYorGA3_x5d79TklUYR_XtF6MM4d5srbPV3-N4pXQ1SwF_YZZxkksYNb5k5P7chlg8SSpdJuccpW53I3EE2uXGr5zBl09V3WMIRMwonXPxdgmzF3oapEcKjKrbacGLJ8ijg5fK84E8SAp_bjGAAAA8DH6Gx1SCp8AAaMBrgIAAHUkjc-xxGf7AgAAAAAEWVo=">Black formatting</a>:</p>
<pre><code>def a():
    return b(
        c,
        d,
        e,
        f=lambda self, *args, **kwargs: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(
            *args, **kwargs
        ),
    )
</code></pre>
<p><a href="https://play.ruff.rs/7f9b066a-9a46-4976-86d3-c872850310d3?secondary=Format">Ruff formatting</a>:</p>
<pre><code>def a():
    return b(
        c,
        d,
        e,
        f=lambda self,
        *args,
        **kwargs: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(*args, **kwargs),
    )
</code></pre>
<p>In addition to being incompatible, this formatting seems very strange and not very readable, as the <code>*args</code> and <code>**kwargs</code> suddenly look like they are arguments to <code>b</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Formatter undocumented deviation: &quot; to &quot;Formatter undocumented deviation: Formatting of long lambda as keyword argument &quot; by <a href="https://github.com/henribru">@henribru</a> on 2023-10-24 19:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-24 19:59</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-24 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Formatter: Stable&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-24 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-24 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henribru">@henribru</a> on 2023-10-24 20:51</div>
            <div class="timeline-body"><p>This seems possibly related</p>
<p>https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ADqAHRdAD2IimZxl1N_WlXnON2nzNX9HFvHx6cBUQ15-GcjjCXTWY4lAb3LPNtN0kban15sEExCiEMHC1fqLMN_I2mNYrKs6DX7rL7K_IqhZ4f1qfF_pwoKJfLbTWpcKTtsPNouVDJpGY10D5nlGuf_NfXkJrKjOtjHACUnbTAaUKR-AAGQAesBAAAgR-_jscRn-wIAAAAABFla</p>
<p>https://play.ruff.rs/c9b4e3fa-4401-4248-a98d-d9ae6b984697?secondary=Format</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-24 20:58</div>
            <div class="timeline-body"><p>Yeah, looks like we have some refinements to make in the lambda formatting. On it! (Thanks for sharing playground links, it helps a lot.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DarthMuzammil">@DarthMuzammil</a> on 2023-10-24 21:03</div>
            <div class="timeline-body"><p>@charliermarsh Can i take this issue up?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-24 23:41</div>
            <div class="timeline-body"><p>@DarthMuzammil sure. Let me know if you need any help</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/DarthMuzammil">@DarthMuzammil</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-24 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-29 16:24</div>
            <div class="timeline-body"><p>@DarthMuzammil -- have you had a chance to look into this? If not, do you still plan to? (No pressure, I just want to make sure we find an owner soon if it&#x27;s not being addressed.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-02 07:14</div>
            <div class="timeline-body"><p>It seems black never inserts soft line breaks between parameters. This would be an easy fix... except for comments</p>
<p>Although Black&#x27;s formatting also has its shortcomings when you have default values:</p>
<pre><code>def a():
    return b(
        c,
        d,
        e,
        f=lambda self, araa, kkkwargs=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(
            *args, **kwargs
        ), e=1, f=2, g=2: d,
    )

</code></pre>
<p>It could be nice to simply parenthesize the lambda expression and indent it by 1 level (and otherwise keep our formatting). However, that would also mean that the formatter must remove the parentheses again when the lambda fits on a single line—something we haven&#x27;t really done before in sub-expression positions. And there&#x27;s also no real good place to add it, because this should be done when formatting lambas in any position.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DarthMuzammil">@DarthMuzammil</a> on 2023-11-02 13:07</div>
            <div class="timeline-body"><p>@charliermarsh  Hey, sorry for the delay i just saw this message, yes i will start working on this today</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DarthMuzammil">@DarthMuzammil</a> on 2023-11-02 18:50</div>
            <div class="timeline-body"><blockquote>
<p>It seems black never inserts soft line breaks between parameters. This would be an easy fix... except for comments</p>
<p>Although Black&#x27;s formatting also has its shortcomings when you have default values:</p>
<pre><code>def a():
    return b(
        c,
        d,
        e,
        f=lambda self, araa, kkkwargs=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(
            *args, **kwargs
        ), e=1, f=2, g=2: d,
    )
</code></pre>
<p>It could be nice to simply parenthesize the lambda expression and indent it by 1 level (and otherwise keep our formatting). However, that would also mean that the formatter must remove the parentheses again when the lambda fits on a single line—something we haven&#x27;t really done before in sub-expression positions. And there&#x27;s also no real good place to add it, because this should be done when formatting lambas in any position.</p>
</blockquote>
<p>@MichaReiser How should i go about solving this issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-03 02:16</div>
            <div class="timeline-body"><p>@DarthMuzammil not sure. I think coming up with a style that works with the presence of comments (which black does not always) is the main work of this issue. My preferred solution would be to just parenthesize the lambda parameters if it breaks, but Python3 removed support for parenthesized lambda parameters for some reason :(</p>
<pre><code># Using parentheses is a syntax error
def a():
    return b(
        c,
        d,
        e,
        f=lambda (
            self, 
            araa, 
            kkkwargs=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(
                *args, **kwargs
            ), 
            e=1, 
            f=2, 
            g=2
        ): d,
    )
</code></pre>
<p>Related black issue: <a href="https://github.com/psf/black/issues/809">psf/black#809</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/DarthMuzammil">@DarthMuzammil</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-28 06:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Formatter: Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-12 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-12 17:03</div>
            <div class="timeline-body"><p>@ntBre just realized. We shouldl update our black deviation documentation and explain our new lambda formatting (or update the existing section).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:44 UTC
    </footer>
</body>
</html>
