<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous access to ruff image on ghcr - astral-sh/ruff #14119</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Anonymous access to ruff image on ghcr</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14119">#14119</a>
        opened by <a href="https://github.com/mjbear">@mjbear</a>
        on 2024-11-06 00:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mjbear">@mjbear</a> on 2024-11-06 00:56</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hello!</p>
<p>Thank you for the <a href="https://github.com/astral-sh/ruff/issues/5072#issuecomment-1845495405">official <code>ruff</code> Docker image</a> on ghcr.io!</p>
<p>As it stands currently even though the image is public, one has to authenticate to ghcr.io first before being able to pull the image. None of this authentication appears to be necessary for the official Docker registry.</p>
<pre><code class="language-bash"># login required, otherwise access is denied
docker login ghcr.io

docker run --rm -v ${PWD}:/workdir ghcr.io/astral-sh/ruff:0.7.2 check /workdir
</code></pre>
<p>I tried to monkey with a repo of mine to see if I could get <code>docker run</code> to pull a package without getting access denied. The items I tried did not appear to make a difference.</p>
<ul>
<li>https://docs.github.com/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility#about-setting-visibility-and-access-permissions-for-packages</li>
<li>https://docs.github.com/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility#disabling-automatic-inheritance-of-access-permissions-in-an-organization</li>
</ul>
<p>Does it make sense to publish that same image to the Docker registry?</p>
<p>That or run an <a href="https://hub.docker.com/r/pipelinecomponents/ruff">image</a> that isn't built and published by astral.</p>
<p>If nothing else I might learn something about GitHub permissions from this thread. :neutral_face:</p>
<p>Thank you! :crab: :sparkles:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Anonymous access to ruff container on ghcr" to "Anonymous access to ruff image on ghcr" by @mjbear on 2024-11-06 03:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-06 03:18</div>
            <div class="timeline-body"><p>Interesting, I don't think login should be required. I'm able to run the same command as you've provided without login in to Docker on a M3 Pro. Can you say more about the error that you're getting?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mjbear">@mjbear</a> on 2024-11-06 04:15</div>
            <div class="timeline-body"><blockquote>
<p>Interesting, I don't think login should be required. I'm able to run the same command as you've provided without login in to Docker on a M3 Pro. Can you say more about the error that you're getting?</p>
</blockquote>
<p>Hello @dhruvmanila</p>
<p>Certainly. In response to a docker pull:
<code>docker: Error response from daemon: Head &quot;https://ghcr.io/v2/astral-sh/ruff/manifests/0.7.2&quot;: denied: denied.</code></p>
<p>So fun thing is, I had that output in my scroll-back buffer from earlier.
I ran <code>docker logout</code> to hopefully throw out the login secrets and get a clean slate ... no error with the <code>docker pull</code>.
New shell session ... no error for docker pull.
I was ready to break from dev for the night so I chose to reboot ('cause why not for troubleshooting) ... no error for docker pull.</p>
<p>I know for a fact I tried several times and got a denied error.
I got the same sort of error with my own repo I was testing against.</p>
<p>:shrug: I'll come back to this tomorrow or the next day to see if I can replicate the behavior. :neutral_face:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-06 04:43</div>
            <div class="timeline-body"><blockquote>
<p>ü§∑ I'll come back to this tomorrow or the next day to see if I can replicate the behavior. üòê</p>
</blockquote>
<p>For sure, I'll leave this open for now. Feel free to come back and close this if it's resolved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2024-11-06 04:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mjbear">@mjbear</a> on 2024-11-07 12:56</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>ü§∑ I'll come back to this tomorrow or the next day to see if I can replicate the behavior. üòê</p>
</blockquote>
<p>For sure, I'll leave this open for now. Feel free to come back and close this if it's resolved.</p>
</blockquote>
<p>@dhruvmanila
Thank you for taking a peek at this.
It bothers me that it magically resolved ... though someday I'll probably encounter it again. If and when that happens I'll have to dig in and take even more detailed notes.</p>
<p>It's possible that there was some issue on my local workstation.
It's also possible there was something going on with the GH container registry or general GH authentication.</p>
<p>What I can say for certain is that I've been able to pull the astral ruff image from ghcr.io as well as an image from a repo of mine. I doubt there's docker credential caching on my local workstation ... the file has no substantial content. :laughing:</p>
<pre><code class="language-json">{
	&quot;auths&quot;: {}
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mjbear on 2024-11-07 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-07 13:23</div>
            <div class="timeline-body"><p>Perfect! Thanks for following up.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
