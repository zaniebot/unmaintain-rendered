<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: Handling of `# region` &amp; `# endregion` comments - astral-sh/ruff #9805</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: Handling of <code># region</code> &amp; <code># endregion</code> comments</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9805">#9805</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2024-02-03 00:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Avasam">@Avasam</a></div>
            <div class="timeline-body">

Region block comments
<p>Is it possible to keep the alignement of <code># region</code> / <code># endregion</code> code-folding comments? Or at least keep them consistent between open and close?
<img src="https://github.com/astral-sh/ruff/assets/1350584/88bfdabe-0390-4efd-8b27-e3e2c01c47cc" alt="image"></p>
<hr>
<p>copied from https://github.com/astral-sh/ruff/discussions/7310#discussioncomment-7341829</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">noqa</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-03 23:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-03 23:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-04 11:21</div>
            <div class="timeline-body"><p>I&#x27;m afraid. This isn&#x27;t supported today. The formatter doesn&#x27;t support the concept of region comments and always indents the comments to the same level as the statements.</p>
<p>I hoped that you could make it work by suppressing the comment but Ruff normalizes the indentation even in that case:</p>
<pre><code>def test(test: name):
    a_long_body

# fmt: off
# region test
# more
# fmt: on    
    some_region

# fmt: off
# endregion
# fmt: on
    after_region
</code></pre>
<p>Gets formatted to</p>
<pre><code>def test(test: name):
    a_long_body

    # fmt: off
    # region test
    # more
    # fmt: on
    some_region

    # fmt: off
    # endregion
    # fmt: on
    after_region
</code></pre>
<p>And having to use <code>fmt:off</code> around each region is rather verbose.</p>
<p>The challenge with supporting a feature like this is that I&#x27;ve seen different preferences and styles when it comes to formatting region comments AND the notation starting and ending a region (beyond that, it further complicates the comment formatting logic to know of region concepts).</p>
<p>The first step to move this forward would be to come up with a style proposal that has wide support in the community. We could then explore how a feature like this gets implemented, considering that there&#x27;s sufficient demand for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbd">@kbd</a> on 2024-07-07 12:18</div>
            <div class="timeline-body"><p>It would be nice if the position, both line and indentation, of region/endregion comments were generally untouched and ignored by the formatter.</p>
<p>I&#x27;m currently writing some FastAPI routes and their tests inline. So I want regions for each API method + test(s) combo.</p>
<p>Instead of getting to do:</p>
<pre><code># region create
@app.post...
def create(&quot;/users&quot;...):
    ...

def test_create():
    ...
# endregion create

# region update
@app.post...
def update(&quot;/users/{user_id}&quot;...
    ...

def test_update():
    ...
# endregion update
</code></pre>
<p>Ruff formats as:</p>
<pre><code># region create
@app.post...
def create(&quot;/users&quot;...):
    ...

def test_create():
    ...


# endregion create


# region update
@app.post...
def update(&quot;/users/{user_id}&quot;...
    ...

def test_update():
    ...


# endregion update
</code></pre>
<p>It works but it&#x27;s a lot of extra whitespace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-08-18 19:18</div>
            <div class="timeline-body"><p>I don&#x27;t remember if I was able to do so in previous Ruff versions, but in 0.6.1 I am able to move the #endregion comment up and indented into the end of the method. So I get consistent code folding comments and it&#x27;s still working in VSCode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfcodes">@pfcodes</a> on 2025-11-13 20:19</div>
            <div class="timeline-body"><blockquote>
<p>The challenge with supporting a feature like this is that I&#x27;ve seen different preferences and styles when it comes to formatting region comments AND the notation starting and ending a region (beyond that, it further complicates the comment formatting logic to know of region concepts).</p>
</blockquote>
<p>Since #region/#endregion is recognized out of the box by the major IDEs (JetBrains, VSCode, etc.) I think it could be considered a standardized way of doing it rather than a preference.</p>
<p>But for anyone who needs a workaround, adding an additional <code>#</code> will work:</p>
<pre><code>##region Region name
...
##endregion
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:49 UTC
    </footer>
</body>
</html>
