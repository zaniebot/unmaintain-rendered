<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixes requiring LibCST unavailable for nodes containing t-strings - astral-sh/ruff #20043</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fixes requiring LibCST unavailable for nodes containing t-strings</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20043">#20043</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-08-22 14:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-08-22 14:12</div>
            <div class="timeline-body"><p>Until https://github.com/Instagram/LibCST/issues/1343 is resolved, all fixes that use <code>libcst</code> to generate a fix will not work on any expression or statement containing a t-string.</p>
<p>Examples of affected rules (not exhaustive):</p>
<ul>
<li><a href="https://docs.astral.sh/ruff/rules/explicit-f-string-type-conversion/#explicit-f-string-type-conversion-ruf010">explicit-f-string-type-conversion (RUF010)</a></li>
<li><a href="https://docs.astral.sh/ruff/rules/multiple-with-statements/#multiple-with-statements-sim117">multiple-with-statements (SIM117)</a></li>
<li><a href="https://docs.astral.sh/ruff/rules/collapsible-if/#collapsible-if-sim102">collapsible-if (SIM102)</a></li>
<li><a href="https://docs.astral.sh/ruff/rules/unnecessary-collection-call/#unnecessary-collection-call-c408">unnecessary-collection-call (C408)</a></li>
<li><a href="https://docs.astral.sh/ruff/rules/percent-format-extra-named-arguments/#percent-format-extra-named-arguments-f504">percent-format-extra-named-arguments (F504)</a></li>
</ul>
<p>Unfortunately it is not obvious to users which rules use <code>libcst</code> in the backend. To see if this may be responsible for the absence of your fix, run <code>ruff check</code> with the flag <code>-v</code>/<code>--verbose</code> and look for debug logs containing the phrase &quot;Failed to extract&quot;. For example:</p>
<pre><code class="language-console">‚ùØ echo 'f&quot;{ascii(t&quot;&quot;)}&quot;' \
  | ruff check --no-cache --isolated --select RUF010 --target-version py314 --preview \
  -v --output-format concise - \
  2&gt;&amp;1 1&gt;/dev/null | grep &quot;Failed to extract&quot;
[2025-08-22][09:26:17][ruff_linter::checkers::ast][DEBUG] Failed to create fix for explicit-f-string-type-conversion: Failed to extract expression from source
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/19895.html">astral-sh/ruff#19895</a> on 2025-08-22 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2025-08-22 14:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-22 15:18</div>
            <div class="timeline-body"><p>Hmm, would it be &quot;hard&quot; to handle libCST parsing errors differently and display a custom error message at least (maybe with a link to an issue?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-09-11 19:49</div>
            <div class="timeline-body"><p>This has been resolved by https://github.com/astral-sh/ruff/pull/20321</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-09-11 19:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:18 UTC
    </footer>
</body>
</html>
