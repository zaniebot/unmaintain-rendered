<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Some docs not rendering properly - astral-sh/ruff #10427</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Some docs not rendering properly</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10427">#10427</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2024-03-15 22:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-15 22:03</div>
            <div class="timeline-body"><p>https://docs.astral.sh/ruff/rules/too-many-blank-lines/ (among others) is not rendering properly, even though the markdown seems fine.</p>
<p>The list is not rendered as a bullet list.
<img src="https://github.com/astral-sh/ruff/assets/5696119/e853f9f8-a1dc-4335-909d-968a9385bfb9" alt="image" /></p>
<p>The links to settings do not link.
<img src="https://github.com/astral-sh/ruff/assets/5696119/ac798c72-bc5f-45c6-b5ea-760ea7d525f9" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Some docs not rendering properlu" to "Some docs not rendering properly" by @augustelalande on 2024-03-15 22:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-03-15 22:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2024-03-15 22:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-15 22:38</div>
            <div class="timeline-body"><p>Thanks for flagging this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Python-Markdown/markdown/issues/1452.html">Python-Markdown/markdown#1452</a> on 2024-03-17 04:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-17 04:59</div>
            <div class="timeline-body"><p>Ok so there are two issues at play here.</p>
<ol>
<li>Sentences followed by lists</li>
</ol>
<pre><code>list:
- item1
- item2
</code></pre>
<p>will not be rendered as lists by python-mardown (https://github.com/Python-Markdown/markdown/issues/1442), which is what mkdocs uses to transcompile the mardown to html. Instead a newline needs to be added between the sentence and items.</p>
<pre><code>list:

- item1
- item2
</code></pre>
<p>Annoyingly, this is different from the behavior of many other markdown processors (including the one used on github) so most people will not be expecting this.</p>
<ol start="2">
<li>The current documentation preprocessor is very strict about linking settings, only lines under the <code>options</code> header, using a <code>-</code> list indicator will be processed and linked correctly, so what was attempted in the misbehaving doc will not work.
https://github.com/astral-sh/ruff/blob/608df9a1bc0e6025049add877d1d833f1739e966/crates/ruff_dev/src/generate_docs.rs#L116-L133</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-17 05:01</div>
            <div class="timeline-body"><p>Regarding issue 1, it is a fairly easy fix to change the comments in the code docs, but might be difficult to ensure all of them are fixed.</p>
<p>Secondly, because the behavior is so different to what people are used to I feel something should be done to prevent this in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-17 05:03</div>
            <div class="timeline-body"><p>Regarding issue 2, the doc prepossor could be expanded to accept more patterns, but it depends how frequent this type of links will appear outside the <code>options</code> headings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-17 14:25</div>
            <div class="timeline-body"><p>Yeah this is a little annoying, maybe we can run our markdown formatter on the generated documentation? I wonder if it adds spacing.</p>
<p>In the meantime, it seems like adding the missing spaces makes sense.</p>
<p>I'm not sure about the automatic linking, @charliermarsh do you have context on the original intent of limiting the scope?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-17 15:17</div>
            <div class="timeline-body"><p>I think it’s just because the original intent was for that to support the Options section which always has that format. We can expand the scope a bit though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-17 20:37</div>
            <div class="timeline-body"><blockquote>
<p>Yeah this is a little annoying, maybe we can run our markdown formatter on the generated documentation? I wonder if it adds spacing.</p>
<p>In the meantime, it seems like adding the missing spaces makes sense.</p>
<p>I'm not sure about the automatic linking, @charliermarsh do you have context on the original intent of limiting the scope?</p>
</blockquote>
<p>Are you already running a markdown formatter in the project?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-17 20:45</div>
            <div class="timeline-body"><p>If not we could try running https://github.com/executablebooks/mdformat which seems to do the trick.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-17 20:51</div>
            <div class="timeline-body"><p>For the option processing we could match this regex <code>\[`(.*?)\`\]\[\1\]</code> to generate the option reference?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-17 23:36</div>
            <div class="timeline-body"><p>We use a couple</p>
<p>https://github.com/astral-sh/ruff/blob/main/.pre-commit-config.yaml#L20-L41</p>
<p>It might require a tweak to run them on the generated documentation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-18 04:55</div>
            <div class="timeline-body"><p>@zanieb I started implementing a check using mdformat, but as it is right now pretty much every doc has multiple violations (mostly missing or extra newlines). For example:</p>
<pre><code>Rule `zip-without-explicit-strict` docs are not formatted. Either format the rule or add to `KNOWN_FORMATTING_VIOLATIONS`. The section should be rewritten to:
---

+++

@@ -1,12 +1,15 @@

 # zip-without-explicit-strict (B905)
+
 Derived from the **flake8-bugbear** linter.

 Fix is always available.

 ## What it does
+
 Checks for `zip` calls without an explicit `strict` parameter.

 ## Why is this bad?
+
 By default, if the iterables passed to `zip` are of different lengths, the
 resulting iterator will be silently truncated to the length of the shortest
 iterable. This can lead to subtle bugs.
@@ -15,19 +18,23 @@

 non-uniform length.

 ## Example
+
 \```python
 zip(a, b)
 \```

 Use instead:
+
 \```python
 zip(a, b, strict=True)
 \```

 ## Fix safety
+
 This rule's fix is marked as unsafe for `zip` calls that contain
 `**kwargs`, as adding a `check` keyword argument to such a call may lead
 to a duplicate keyword argument error.

 ## References
+
 - [Python documentation: `zip`](https://docs.python.org/3/library/functions.html#zip)
</code></pre>
<p>So if we go the route of enforcing markdown style on rule docs it will require a lot of edits. Alternatively, if we only care about enforcing a line break around lists, this could be done with a simple python check. Something like:
<code>if line followed by '-' or '*' then raise error</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-19 00:17</div>
            <div class="timeline-body"><p>Another option would be to format the docs as part of the generation process</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-19 13:33</div>
            <div class="timeline-body"><p>@zanieb what do you think between these three options? Remember the goal is just to ensure that lists get rendered properly.</p>
<ol>
<li>Enforce a strict markdown format with <code>mdformat</code> across the board. Requiring contributors to modify their docs before merging.</li>
<li>Enforce a reduced markdown format with some custom python (namely line breaks around lists). Still requiring contributors to modify their docs before contributing.</li>
<li>Automatically format docs with <code>mdformat</code> when rendering the website.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-19 14:29</div>
            <div class="timeline-body"><p>I honestly was imagining (3) but we'd probably want to run that check on pull requests too in case someone breaks the formatter in which case it would require manual intervention.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-19 14:36</div>
            <div class="timeline-body"><p>What do you mean &quot;breaks the formatter&quot;, like raise an unexpected error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-19 14:37</div>
            <div class="timeline-body"><p>Yeah, idk if something goes wrong like it formats and can't render or the formatter errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-19 14:39</div>
            <div class="timeline-body"><p>So adding it as part of generate_mkdocs.py would make sense, since that gets run for every PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10484.html">astral-sh/ruff#10484</a> on 2024-03-20 01:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:31</div>
            <div class="timeline-body"><p>So some of this is resolved, but I'm still seeing invalid references like this (possibly new ones?):</p>
<p><img src="https://github.com/astral-sh/ruff/assets/1309177/bbf46d17-c238-4884-a535-e846223df8bc" alt="Screenshot 2024-03-20 at 8 30 42 PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-21 00:34</div>
            <div class="timeline-body"><p>Ya I was gonna work on that next.</p>
<p>The problem is that when someone attempts a reference to a setting, but doesn't make an options section with that setting, the reference doesn't get linked. My approach is gonna be to check any reference which matches the pattern [<code>word</code>][word], check if it's a valid setting, and if it is link it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10498.html">astral-sh/ruff#10498</a> on 2024-03-21 00:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:41</div>
            <div class="timeline-body"><p>Thanks, I fixed those specific docs here: https://github.com/astral-sh/ruff/pull/10498</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-21 00:43</div>
            <div class="timeline-body"><p>What are your thoughts on my comment though. Should we allow linking settings without an options section? If not should we flag attempts to do so?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:47</div>
            <div class="timeline-body"><p>Honestly, I'm fine with either. We should <em>at least</em> flag references that are missing from the <code>Options</code> section.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-21 00:48</div>
            <div class="timeline-body"><p>Ok I will work on that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10499.html">astral-sh/ruff#10499</a> on 2024-03-21 02:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-21 16:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
