<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule request: enforce best practices when mocking - astral-sh/ruff #12850</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule request: enforce best practices when mocking</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12850">#12850</a>
        opened by <a href="https://github.com/mgaitan">@mgaitan</a>
        on 2024-08-12 19:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mgaitan">@mgaitan</a></div>
            <div class="timeline-body"><p>I&#x27;d like to propose the integration of <code>flake8-patch</code> like rule/s  into <code>ruff</code> to help enforce best practices when mocking in Python tests.</p>
<p>In a legacy codebase, we&#x27;ve encountered issues where direct monkeypatching  leads to tests that do not properly clean up after themselves. This can result in flaky tests that pass or fail depending on the order of execution. For example, we had the following pattern:</p>
<pre><code>Shipment.get_label_info = mocker.Mock()
Shipment.get_label_info.return_value = (None, tracking_url, None)
</code></pre>
<p>This approach led to issues in teardown, as the mock was not automatically undone. We switched to using <code>mocker.patch.object()</code>:</p>
<pre><code>mocker.patch.object(Shipment, &quot;get_label_info&quot;, return_value=(None, tracking_url, None))
</code></pre>
<p>This approach ensures that the patch is properly removed after the test.</p>
<p>The <a href="https://pypi.org/project/flake8-patch/">flake8-patch</a> plugin helps identify improper mocking practices, such as direct assignment to imported objects, which can cause tests to be unreliable. Integrating similar functionality into <code>ruff</code> would allow us to catch these issues early in the development process.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-13 08:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-13 08:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:56 UTC
    </footer>
</body>
</html>
