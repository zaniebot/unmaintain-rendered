<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Panic] index out of bounds in locator.rs - astral-sh/ruff #3446</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Panic] index out of bounds in locator.rs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3446">#3446</a>
        opened by <a href="https://github.com/krpatter-intc">@krpatter-intc</a>
        on 2023-03-10 23:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/krpatter-intc">@krpatter-intc</a> on 2023-03-10 23:31</div>
            <div class="timeline-body"><p>I've got a particular buggy repo where I end up getting a crash here:</p>
<p>thread '<unnamed>' panicked at 'index out of bounds: the len is 1 but the index is 184', crates\ruff\src\source_code\locator.rs:71:9</p>
<p>The exact file it fails on changes from run to run.</p>
<p>I suspect <em>maybe</em> I'm just getting too many errors (specifically: too many failing to parse files).  If I run each individual directory one at a time, then it works.</p>
<p>I tried setting the backtrace, but the output is too intermixed with the other warnings....Last thing I see that seems readable is:</p>
<p>0xerror7fffdd5655a0 - BaseThreadInitThunk:</p>
<p><code>ruff --version</code> == 0.0.254</p>
<p>The TOML is setup with:</p>
<pre><code>select = [&quot;F&quot;,&quot;T&quot;]
ignore = [
    &quot;F401&quot;,
    &quot;F841&quot;,
    &quot;F403&quot;,
]
</code></pre>
<p>If this is too little info to help (without the actual files)...That I totally understand and feel free to reject/close this. Thanks for your time.</p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-10 23:59</div>
            <div class="timeline-body"><p>Hmm, very interesting that you're having success when running over individual directories. These kinds of index out-of-bounds errors are <em>most</em> common when run on files that use CR line endings (as opposed to LF and CRLF which are much more common). If you have a file that uses CR line endings, that <em>could</em> be the culprit, and that's a known issue, but without a link to the repo it's a little hard to say.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qarmin">@qarmin</a> on 2023-03-11 06:13</div>
            <div class="timeline-body"><p>Looks like duplicate of https://github.com/charliermarsh/ruff/issues/3425 and this may be fixed by https://github.com/charliermarsh/ruff/pull/3439/files (not tested yet)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krpatter-intc">@krpatter-intc</a> on 2023-03-11 16:12</div>
            <div class="timeline-body"><p>Mmm...yep, found the file and its definitely some sort of hidden character thing. It does seem to be related to line endings. Just saving the file in VScode is enough and when I do a beyond compare diff the only delta is the line ending style.</p>
<p>I have plenty of other files with CR/LF that it is fine with, so its a tad odd, but also seems like it is a known issue. Thanks for the quick responses. I'm fine with closing if this is a known issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krpatter-intc">@krpatter-intc</a> on 2023-03-11 16:14</div>
            <div class="timeline-body"><p>so for clarity sake most of the lines have something like:</p>
<p><img src="https://user-images.githubusercontent.com/62627988/224495218-a94c704a-5c39-4ffa-847b-e6fbf72f1e59.png" alt="image" /></p>
<p>And the <code>0D 0A</code> file is the one failing...If I save in VS code Beyond Compare shows just the 0D or 0A and those work...It could be the bad file has a mix that is throwing things off</p>
<p>but I admit, I didn't check <em>every</em> line, maybe there is <em>one</em> with just CR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-11 16:19</div>
            <div class="timeline-body"><blockquote>
<p>I have plenty of other files with CR/LF that it is fine with.</p>
</blockquote>
<p>üëç Just to be clear, CR/LF is totally fine. It's CR alone that isn't properly handled right now. (My understanding is that CR alone is very rare these days, as it was last used in early versions of Mac OS. I still want to support it properly, of course.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-03-11 20:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @krpatter-intc on 2023-03-11 21:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:36 UTC
    </footer>
</body>
</html>
