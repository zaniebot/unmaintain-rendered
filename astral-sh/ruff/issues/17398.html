<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parser fails to raise an error for line continuation at EOF - astral-sh/ruff #17398</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Parser fails to raise an error for line continuation at EOF</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17398">#17398</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-04-14 20:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body">Summary
<p>While going through the remaining errors we don&#x27;t detect in #7633, I noticed a surprising <code>unexpected EOF while parsing</code> error caused by a case like this:</p>
<pre><code>class C:
    def f():
        return 1, \
</code></pre>
<p>I can&#x27;t reproduce this in the playground, but this is the output locally with this saved as <code>try.py</code>:</p>
<pre><code>$ python -m ast try.py
Traceback (most recent call last):
  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/usr/lib/python3.13/ast.py&quot;, line 1871, in &lt;module&gt;
    main()
    ~~~~^^
  File &quot;/usr/lib/python3.13/ast.py&quot;, line 1867, in main
    tree = parse(source, name, args.mode, type_comments=args.no_type_comments)
  File &quot;/usr/lib/python3.13/ast.py&quot;, line 54, in parse
    return compile(source, filename, mode, flags,
                   _feature_version=feature_version, optimize=optimize)
  File &quot;try.py&quot;, line 3
    return 1, \
               ^
SyntaxError: unexpected EOF while parsing
$ ruff check try.py
All checks passed!
</code></pre>
<p>And I see the same thing for a single <code>\</code> as input:</p>
<pre><code>$ python -m ast &lt;&lt;&lt;&#x27;\&#x27;
Traceback (most recent call last):
  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/usr/lib/python3.13/ast.py&quot;, line 1871, in &lt;module&gt;
    main()
    ~~~~^^
  File &quot;/usr/lib/python3.13/ast.py&quot;, line 1867, in main
    tree = parse(source, name, args.mode, type_comments=args.no_type_comments)
  File &quot;/usr/lib/python3.13/ast.py&quot;, line 54, in parse
    return compile(source, filename, mode, flags,
                   _feature_version=feature_version, optimize=optimize)
  File &quot;&lt;stdin&gt;&quot;, line 1
    \
     ^
SyntaxError: unexpected EOF while parsing
$ ruff check - &lt;&lt;&lt;&#x27;\&#x27;
All checks passed!
</code></pre>
<p>I&#x27;m not sure what&#x27;s different in the playground, but it detects both of these cases, and it reports a single <code>Unknown</code> token in the case of the single <code>\</code>.</p>
Version
<p>ruff 0.11.5 (7186d5e9a 2025-04-10)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-14 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-14 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-14 21:58</div>
            <div class="timeline-body"><p>It might be worth checking whether this discrepancy exists when running the playground locally. Otherwise, we could just check what the <code>contents</code> parameter here is which might be different:</p>
<p>https://github.com/astral-sh/ruff/blob/72a3bc810c7f497a2fd3e730b402beadc4080dbd/crates/ruff_wasm/src/lib.rs#L276-L280</p>
<p>Or,</p>
<p>https://github.com/astral-sh/ruff/blob/72a3bc810c7f497a2fd3e730b402beadc4080dbd/crates/ruff_wasm/src/lib.rs#L159-L159</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-15 13:14</div>
            <div class="timeline-body"><p>I can reproduce the same thing in the local playground. I&#x27;m not sure if there&#x27;s a better way to debug print in WASM, but I just returned errors containing <code>contents</code> when I typed a single backslash, and they both showed <code>\</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-15 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-15 14:56</div>
            <div class="timeline-body"><p>Thanks for confirming. I think I know where the issue is. I&#x27;ve raised a draft PR, will write a couple of test cases and make it ready for review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-15 15:56</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m not sure what&#x27;s different in the playground, but it detects both of these cases, and it reports a single <code>Unknown</code> token in the case of the single <code>\</code>.</p>
</blockquote>
<p>For context, the reason for this is because the playground requires us to explicitly add the final newline character in the source: https://play.ruff.rs/e6418bb3-ddf0-4143-9e82-b1c117472348</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-15 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-15 15:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:49 UTC
    </footer>
</body>
</html>
