<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Could ruff also check files according to file's shebang? - astral-sh/ruff #13122</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Could ruff also check files according to file's shebang?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13122">#13122</a>
        opened by <a href="https://github.com/praiskup">@praiskup</a>
        on 2024-08-27 13:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/praiskup">@praiskup</a></div>
            <div class="timeline-body"><pre><code>$ ruff  check .
warning: No Python files found under the given path(s)
All checks passed!
$ head -1 vcs-diff-lint
#! /usr/bin/python3
$ ruff check vcs-diff-lint
All checks passed!
</code></pre>
<p>Even though the file is not <code>*.py</code>, it still is a Python file and it is worth checking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-28 05:59</div>
            <div class="timeline-body"><p>Related https://github.com/astral-sh/ruff/issues/2192</p>
<p><strong>tl;dr</strong> It's recommended to use the <code>include</code> / <code>extend-include</code> config options to explicitly list down the files that you want Ruff to check for. Adding support for it <em>might</em> come with a performance cost although not sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @dhruvmanila on 2024-08-28 05:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @dhruvmanila on 2024-08-28 05:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-28 06:00</div>
            <div class="timeline-body"><p>Does using <a href="https://docs.astral.sh/ruff/settings/#include"><code>include</code></a> / <a href="https://docs.astral.sh/ruff/settings/#extend-include"><code>extend-include</code></a> solve your use case? If so, we can close this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/praiskup">@praiskup</a> on 2024-08-28 06:54</div>
            <div class="timeline-body"><p>The differential analysis tool we develop uses Ruff as one of the backends, and while we appreciate Ruff's overall performance - analyzing the shebang is worth it in our case.</p>
<p>The goal is to make future project enablements (= &quot;start using vcs-diff-lint + ruff&quot; in more projects) as trivial as possible.  Explicitly asking for <code>include/extend-include</code> per/project raises the initial enablement barrier, and incomplete analysis is also not nice...</p>
<p>That said, having something like <code>analyze-shebangs = true</code> opt-in would be completely fine for our use case; we can afford to spend some time on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/praiskup">@praiskup</a> on 2024-08-28 07:22</div>
            <div class="timeline-body"><p>https://github.com/fedora-copr/vcs-diff-lint/pull/25 seems to help a bit here;  vcs-diff-lint knows the set of <strong>changed</strong> Python, including those that do not end with <code>*.py</code>.  So we can indeed use <code>extend-include</code> to at least cover those changed files, but we are still not checking unchanged non-<code>*.py</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> removed by @MichaReiser on 2024-09-02 06:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-09-02 06:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2024-09-02 06:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @MichaReiser on 2024-09-02 06:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-02 06:19</div>
            <div class="timeline-body"><p>Detecting all Python files based on shebang has the downside that Ruff needs to read at least the first 80 or so bytes to determine whether the file should be included in the analysis. This is significantly more costly than just looking at a file extension, so I would not want this behavior to be the default. I'm open to adding such a feature if we can come up with an interface that doesn't penalty the default use case where this isn't needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/praiskup">@praiskup</a> on 2024-09-02 07:55</div>
            <div class="timeline-body"><blockquote>
<p>Detecting all Python files based on shebang has the downside that Ruff needs to read at least the first 80 or so</p>
</blockquote>
<p>Could we, e.g., only include files with no &quot;suffixes&quot;?  That would be the most common case, I assume.</p>
<p>Otherwise, opt-in is completely fine!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pmp-p">@pmp-p</a> on 2024-10-12 05:05</div>
            <div class="timeline-body"><p>Also some html files - though valid python - have a non standard shebang (like it used to be on MS-DOS) that Ruff cannot yet support/handle ( unlike black -x / python -x , fails with <code>SyntaxError: Expected a statement</code> )</p>
<p>eg source : https://github.com/pygame-web/showroom/blob/main/pygame-scripts/org.pygame.touchpong.html</p>
<p>for run with python-wasm or <code>python3 -x</code> : https://pygame-web.github.io/showroom/pygame-scripts/org.pygame.touchpong.html</p>
<p>ref: https://github.com/psf/black/issues/3214</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/praiskup">@praiskup</a> on 2024-12-06 13:40</div>
            <div class="timeline-body"><blockquote>
<p>Also some html files - though valid python - have a non standard shebang</p>
</blockquote>
<p>Indeed, this should be only an additional/optional analysis, and I don't think we need to have 100% success rate (nb. the basic <code>.py</code> suffix rule isn't 100% correct either).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daethnir">@daethnir</a> on 2025-09-21 04:48</div>
            <div class="timeline-body"><p>Adding another +1 to supporting shebang lines.</p>
<p>Our executable scripts do not end in <code>.py</code> and have <code>chmod +</code>. In most cases they are <code>#!/usr/bin/env python3</code>.</p>
<p>However in some cases we have wrappers ala <code>#!/usr/bin/env -S uvwrapper ...</code> that automatically run the tool through <code>uv</code> - so supporting user-specifiable shebang lines would be even better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-22 08:27</div>
            <div class="timeline-body"><p>@daethnir I don't know how many executable scripts you have but if there are only a few, does the solution outlined by @dhruvmanila might work for you in the meantime:</p>
<blockquote>
<p>tl;dr It's recommended to use the include / extend-include config options to explicitly list down the files that you want Ruff to check for. Adding support for it might come with a performance cost although not sure.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-20 15:15</div>
            <div class="timeline-body"><p>Doing the shebang check only for files without extension might not be that expensive, as they shouldn't be very common.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 15:46:00 UTC
    </footer>
</body>
</html>
