<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server` hangs when performing &quot;code actions&quot; in Helix - astral-sh/ruff #12915</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`ruff server` hangs when performing &quot;code actions&quot; in Helix</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12915">#12915</a>
        opened by <a href="https://github.com/schlich">@schlich</a>
        on 2024-08-16 03:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/schlich">@schlich</a> on 2024-08-16 03:56</div>
            <div class="timeline-body"><p>Might be related to <a href="https://github.com/astral-sh/ruff-lsp/issues/416">Issue #416</a> in <code>ruff-lsp</code>, particularly @ssmsossah's comment <a href="https://github.com/astral-sh/ruff-lsp/issues/416#issuecomment-2143850769">here</a> that the same thing is happening in NeoVim.</p>
<p>Running <code>ruff server</code> in Helix. Health checks with <code>hx --health python</code> all pass.</p>
<p>Helix 24.7
ruff 0.6.0
<code>protocol error: InternalError: failed to deserialize diagnostic data: missing field 'range'</code></p>
<pre><code class="language-toml">[[language]]
name = &quot;python&quot;
formatter = { command = &quot;ruff&quot;, args = [&quot;format&quot;, &quot;-&quot;]}
language-servers = [&quot;ruff&quot;, &quot;pyright&quot;, &quot;pylsp&quot;]

[language-server.pyright.config.python.analysis]
typeCheckingMode = &quot;basic&quot;

[language-server.ruff]
command = &quot;ruff&quot;
args = [&quot;server&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlich">@schlich</a> on 2024-08-16 04:02</div>
            <div class="timeline-body"><p>Welp, looks like I just rubber-ducked my way out of this one.  dunno how that misconfig slipped in but changing <code>args = [&quot;server&quot;]</code> to <code>config = { settings = { args = [&quot;server&quot;] } }</code> as suggested in the helix docs fixed the issue... closing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @schlich on 2024-08-16 04:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-16 04:08</div>
            <div class="timeline-body"><p>I'm a bit confused here. What was the exact change? The <code>args = [&quot;server&quot;]</code> should be correct unless Helix changed something. Can you provide the docs reference for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlich">@schlich</a> on 2024-08-16 06:05</div>
            <div class="timeline-body"><p>@dhruvmanila  it's <a href="https://github.com/helix-editor/helix/wiki/Language-Server-Configurations#python---ruff">here</a></p>
<pre><code>[language-server.ruff]
command = &quot;ruff&quot;
config = { settings = { args = [&quot;server&quot;] } }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-16 09:06</div>
            <div class="timeline-body"><p>That's weird because their <a href="https://docs.helix-editor.com/languages.html#language-server-configuration">documentation</a> mentions the use of <code>args</code>:</p>
<blockquote>
<p><code>args</code> | A list of arguments to pass to the language server binary</p>
</blockquote>
<p>while, the <code>config</code> key is actually the initialization options which is different.</p>
<p>I'll need to try this out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-16 09:10</div>
            <div class="timeline-body"><p>I'm getting code actions:</p>
<img width="1727" alt="Screenshot 2024-08-16 at 14 39 26" src="https://github.com/user-attachments/assets/d3680df5-9fb4-44a3-9492-d369e5e61094">

<p>Using the following config:</p>
<pre><code class="language-toml">[[language]]
name = &quot;python&quot;
language-servers = [&quot;ruff&quot;, &quot;pyright&quot;]

[language-server.pyright]
command = &quot;pyright-langserver&quot;
args = [&quot;--stdio&quot;]

[language-server.ruff]
command = &quot;ruff&quot;
args = [&quot;server&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlich">@schlich</a> on 2024-08-16 15:17</div>
            <div class="timeline-body"><p>that is weird.  if you think it's worth further reproducing the issue on my end, just let me know @dhruvmanila.  Maybe there are logs I can pull? The related issues make me skeptical it's a Helix-specific problem</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-16 15:38</div>
            <div class="timeline-body"><p>Is the config that you provided in the PR description complete? If not, could you provide the remaining parts? I'm curious whether you're using <code>python-lsp-ruff</code> (plugin to <code>pylsp</code>).</p>
<p>It might also be worth discussing this with the Helix team. Is it <code>args</code> or <code>config</code>? Because, we're using <code>args</code> in our setup guide :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlich">@schlich</a> on 2024-08-16 15:54</div>
            <div class="timeline-body"><p>Yes, that was the complete config for the python language.  I tried it with various combinations of pylsp, pyright, and pylyzer.  definitely was not including python-lsp-ruff even though i have used it in the past, I was assuming hopefully correctly that <code>ruff server</code> was a full replacement.</p>
<p>I just confirmed the error is persisting when i revert the change, right now i'm just running ruff and pylyzer</p>
<blockquote>
<p>we're using args in our setup guide</p>
</blockquote>
<p>ah, so that's how i ended up there!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
