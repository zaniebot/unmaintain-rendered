<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conflict `ASYNC110`-noqa and false-positive `RUF100`  - astral-sh/ruff #12591</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Conflict <code>ASYNC110</code>-noqa and false-positive <code>RUF100</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12591">#12591</a>
        opened by <a href="https://github.com/Olegt0rr">@Olegt0rr</a>
        on 2024-07-31 08:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Olegt0rr">@Olegt0rr</a> on 2024-07-31 08:47</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<h2>Code example</h2>
<pre><code class="language-python"># async_draft.py

import asyncio


class Worker:
    def __init__(self):
        self.tasks = []


async def test_worker():
    worker = Worker()

    while worker.tasks:  # noqa: ASYNC110
        await asyncio.sleep(1)

</code></pre>
<h2>Screencast</h2>
<h3>Got <code>ASYNC110</code> highlighted issue</h3>
<img width="939" alt="Screenshot 2024-07-31 at 11 41 33" src="https://github.com/user-attachments/assets/5dcd36d4-1fd0-45a0-9154-a3a1bb7f545d">

<p>Code highlighted with ruff plugin
BUT command false positive passes (it should be failed since ASYNC rule group is active)</p>
<pre><code>ruff check async_draft.py
All checks passed!
</code></pre>
<h3>Locally muted <code>ASYNC110</code> issue with <code>noqa</code></h3>
<p>It's don't relevant for test (for me)</p>
<img width="930" alt="Screenshot 2024-07-31 at 11 41 52" src="https://github.com/user-attachments/assets/b81105e9-cf87-40e8-8fdb-3c3e805e00b0">

<h3>Got <code>RUF100</code>  issue</h3>
<img width="673" alt="Screenshot 2024-07-31 at 11 42 22" src="https://github.com/user-attachments/assets/0731a554-f2a8-45dc-9b1f-37de7d36e09c">

<h2>Additional info</h2>
<p>ruff 0.5.5</p>
<h3>Config</h3>
<pre><code class="language-toml">
[tool.ruff.lint]
select = [&quot;ASYNC&quot;]
ignore = []
fixable = [&quot;ALL&quot;]
unfixable = []
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-01 01:59</div>
            <div class="timeline-body"><p>I don't see <code>ASYNC110</code> triggering on that example, so gonna close.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-01 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Olegt0rr">@Olegt0rr</a> on 2024-08-01 05:33</div>
            <div class="timeline-body"><p>@charliermarsh, but why it's don't triggering in the console?
Looks like it must be triggered, since <a href="https://docs.astral.sh/ruff/rules/async-busy-wait/">rule</a> was violated and <code>ruff check</code> should fail.</p>
<p>Also in this situation <a href="https://plugins.jetbrains.com/plugin/20574-ruff">ruff plugin</a> works fine:</p>
<img width="913" alt="Screenshot 2024-08-01 at 08 35 27" src="https://github.com/user-attachments/assets/4760090d-06ef-4e7f-81ef-3bb174117e9d">

<p>Am I set something wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-01 15:31</div>
            <div class="timeline-body"><p>Oh sorry, I misunderstood. You need to add <code>--preview</code> for that to trigger:</p>
<pre><code>‚ùØ cargo run check foo.py --select ASYNC -n --preview
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
     Running `target/debug/ruff check foo.py --select ASYNC -n --preview`
foo.py:12:5: ASYNC110 Use `anyio.Event` instead of awaiting `anyio.sleep` in a `while` loop
   |
10 |       worker = Worker()
11 |
12 |       while worker.tasks:
   |  _____^
13 | |         await asyncio.sleep(1)
   | |______________________________^ ASYNC110
   |

Found 1 error.
</code></pre>
<p>The <code>ASYNC</code> rules only apply to <code>trio</code> on stable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Olegt0rr">@Olegt0rr</a> on 2024-08-02 09:14</div>
            <div class="timeline-body"><p>Oh, looks like ruff plugin uses <code>--preview</code> mode, I'll create an issue for that case
Thanks</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:30 UTC
    </footer>
</body>
</html>
