```yaml
number: 11928
title: "Respect `PYTHONSAFEPATH` if set"
type: issue
state: open
author: thejcannon
labels:
  - linter
  - needs-design
assignees: []
created_at: 2024-06-18T16:00:11Z
updated_at: 2024-06-23T21:17:24Z
url: https://github.com/astral-sh/ruff/issues/11928
synced_at: 2026-01-10T01:56:52Z
```

# Respect `PYTHONSAFEPATH` if set

---

_Issue opened by @thejcannon on 2024-06-18 16:00_

Docs links:
- https://docs.python.org/3/using/cmdline.html#envvar-PYTHONSAFEPATH
- https://docs.python.org/3/using/cmdline.html#cmdoption-P

> Don‚Äôt prepend a potentially unsafe path to [sys.path](https://docs.python.org/3/library/sys.html#sys.path):
> `python -m module` command line: Don‚Äôt prepend the current working directory.
> `python script.py` command line: Don‚Äôt prepend the script‚Äôs directory. If it‚Äôs a symbolic link, resolve symbolic links.
> `python -c code` and `python` (REPL) command lines: Don‚Äôt prepend an empty string, which means the current working directory.

Reproducer with `ruff` (note `foo` is an implicit namespace package in vanilla Python-speak, but totally not something we expected to import)

```console
$ mkdir foo
$ cat <<EOF > example.py
import pathlib

import pytest

import anthem  # other 1p
import foo

[pathlib, pytest, foo,, anthem]

EOF
$ export PYTHONSAFEPATH=1
$ ruff check --fix-only example.py
```

keeps `foo` with 1p.

but:

```console
$ python -c 'import foo'
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ModuleNotFoundError: No module named 'foo'
```


---

_Comment by @zanieb on 2024-06-18 16:09_

Hm. Is this always going to be set for all users of Ruff with your code? Otherwise it seems like we could flip-flop behaviors here depending on the local environment which seems less than ideal.

---

_Comment by @thejcannon on 2024-06-18 16:31_

Yeah, we would set it as part of machine bringup

---

_Label `help wanted` added by @zanieb on 2024-06-18 16:35_

---

_Label `linter` added by @zanieb on 2024-06-18 16:35_

---

_Label `help wanted` removed by @zanieb on 2024-06-18 16:44_

---

_Label `needs-design` added by @zanieb on 2024-06-18 16:44_

---

_Comment by @zanieb on 2024-06-18 16:44_

After some internal discussion, we need to decide how best to support this use-case. We might want to use a dedicated setting instead of reading runtime Python variables.

---

_Comment by @thejcannon on 2024-06-18 19:58_

(Not that you needed me to be, but) I'm cool with that as well üëç 

---

_Comment by @zanieb on 2024-06-18 20:59_

I think that's the most reasonable option and addresses my concern. Not entirely sure this is doable with our current module resolution handling, I'd need to look at it to refresh my understanding. If someone is interested in doing a proof of concept pull request, I'd review.

---

_Comment by @thejcannon on 2024-06-19 12:35_

The issue I'm trying to solve is that sometimes folks have empty directories lying around and they get confused why their editor is reformatting in a way that CI then complains about and they don't know how to fix it (admittedly implicit namespace packages are not intuitive)

---

_Comment by @charliermarsh on 2024-06-23 15:10_

Sort of hacky but we could check if `foo` is non-empty for this purpose, perhaps?

---

_Comment by @thejcannon on 2024-06-23 21:17_

I honestly wonder if this might be made more general with a "never assume I use implicit namespace packages" config?

That's really what we want (but Python doesn't expose that, hence the env var about "safe"ty)

---
