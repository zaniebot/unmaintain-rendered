<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruff format --check Fails on Ubuntu - astral-sh/ruff #15391</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ruff format --check Fails on Ubuntu</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/15391">#15391</a>
        opened by <a href="https://github.com/MelbourneDeveloper">@MelbourneDeveloper</a>
        on 2025-01-09 22:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MelbourneDeveloper">@MelbourneDeveloper</a> on 2025-01-09 22:29</div>
            <div class="timeline-body"><p>I am working on macOS, and I use GitHub Actions. I run this in the pipeline:</p>
<pre><code class="language-bash">ruff format --check .
</code></pre>
<p>It passes on Mac, but fails in Ubuntu. This is what I get:</p>
<blockquote>
<p>ruff format --check .
Would reformat: ai_coding_agent/tests/test_api_e2e.py
Would reformat: ai_coding_agent/tests/test_devagent.py
Would reformat: ai_coding_agent/tests/test_devagent_e2e.py
3 files would be reformatted, 34 files already formatted</p>
</blockquote>
<p>Three files in particular are not formatted the same way. The rest are fine,. I would guess that this a line ending issue, but I've tried changing git attributes etc. and nothing seemed to make any difference. I've tried hard refreshing these files and also I tried running this on Ubuntu before running the formatting check:</p>
<pre><code class="language-bash">find . -name &quot;*.py&quot; -type f -exec perl -pi -e 's/\r\n|\r/\n/g' {} +
</code></pre>
<p>Nothing seems to make any difference.</p>
<p>I couldn't see any specific config for line endings in the documentation <a href="https://docs.astral.sh/ruff/formatter/#ruff-format">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 22:40</div>
            <div class="timeline-body"><p>Can you share a reproducible example? i.e. host the file somewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @MichaReiser on 2025-01-10 06:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-01-10 07:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MelbourneDeveloper">@MelbourneDeveloper</a> on 2025-01-16 23:32</div>
            <div class="timeline-body"><p>@zanieb unfortunately, I can't. However, I have been able to reproduce the problem locally on my Mac, and it's totally bizarre.</p>
<p>When I run this script:</p>
<pre><code class="language-bash">#!/bin/bash

set -e

source venv/bin/activate

ruff format --check .
</code></pre>
<p>I get this:</p>
<blockquote>
<p>Would reformat: ai_coding_agent/tests/test_api_e2e.py
Would reformat: ai_coding_agent/tests/test_devagent.py
Would reformat: ai_coding_agent/tests/test_devagent_e2e.py
Would reformat: ai_coding_agent/tests/test_devagent_mocks.py
Would reformat: ai_coding_agent/tests/test_devagent_unit.py
5 files would be reformatted, 34 files already formatted</p>
</blockquote>
<p>If I remove or delete the activation beforehand, the format check passes</p>
<pre><code class="language-bash">#!/bin/bash

set -e

ruff format --check .
</code></pre>
<blockquote>
<p>39 files already formatted</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 00:27</div>
            <div class="timeline-body"><p>When you activate the environment are you getting a different version of Ruff? e.g., <code>which ruff</code> / <code>ruff version</code> in both examples? Are you using the same Python version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MelbourneDeveloper">@MelbourneDeveloper</a> on 2025-01-26 20:52</div>
            <div class="timeline-body"><p>Hmmmm...</p>
<p>Now that you mention it, I've ended up with two ways to get the ruff dependency and they could be interfering with each other.</p>
<p>This is the dev dependencies file in my test folder.</p>
<pre><code>ruff==0.8.4
black==24.10.0
isort==5.13.2 
</code></pre>
<p>This is the section in the pyproject.toml:</p>
<pre><code>[project.optional-dependencies]
dev = [
    &quot;ruff&gt;=0.1.9&quot;,
    &quot;black&gt;=23.12.1&quot;,
    &quot;pytest&gt;=7.4.3&quot;,
    &quot;pytest-cov&gt;=4.1.0&quot;,
    &quot;pytest-asyncio&gt;=0.23.2&quot;,
    &quot;python-lsp-server[all]&gt;=1.9.0&quot;,
    &quot;python-lsp-ruff&gt;=1.5.1&quot;,
    &quot;pylsp-mypy&gt;=0.6.7&quot;,
    &quot;pyright&gt;=1.1.335&quot;,
]
</code></pre>
<p>I need to work out which one I should be using and delete the other</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-28 17:48</div>
            <div class="timeline-body"><p>That makes sense. I'm going to close since I think there's nothing actionable for us here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-28 17:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
