<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistent implementation of F811 with respect to submodule imports - astral-sh/ruff #13490</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Inconsistent implementation of F811 with respect to submodule imports</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13490">#13490</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-09-23 22:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-09-23 22:44</div>
            <div class="timeline-body"><p>Ruff <a href="https://play.ruff.rs/e2f74be7-eeff-4e61-ab90-867610850d2c">emits no F811 diagnostics for this snippet</a>:</p>
<pre><code class="language-py">import ctypes
import ctypes.wintypes
</code></pre>
<p>However, it <a href="https://play.ruff.rs/31b4dec1-3302-4348-9ef9-de747700062b">emits an F811 diagnostic for this snippet</a>:</p>
<pre><code class="language-py">import importlib

ctypes = importlib.import_module(&quot;ctypes&quot;)
import ctypes.wintypes
</code></pre>
<p>I think Ruff should either emit a diagnostic for both of these, or neither of these, since they're equivalent in terms of what happens with respect to symbol definitions:</p>
<ol>
<li>A <code>ctypes</code> symbol is defined. For the first snippet this is defined via an <code>import</code> statement, and for the second it is defined via a function call, but this difference shouldn't really be relevant.</li>
<li>The <code>import ctypes.wintypes</code> statement causes:<ol>
<li>The <code>ctypes</code> variable to be reassigned in the global namespace (but to the same object, which is just looked up in the <code>sys.modules</code> cache)</li>
<li>The <code>ctypes.wintypes</code> submodule to be loaded and stored as a <code>wintypes</code> attribute on the <code>ctypes</code> module object</li>
</ol>
</li>
</ol>
<p>I would lean towards <em>not</em> emitting a diagnostic on either of these, because although the submodule import of <code>ctypes.wintypes</code> is strictly-speaking a redefinition of the <code>ctypes</code> variable in both cases, many people consider it unidiomatic to access top-level members from <code>ctypes</code> in a module that only has <code>import ctypes.wintypes</code> in it. (It's sort-of an &quot;implicit import&quot; of the top-level <code>ctypes</code> module.)</p>
<p>To be clear: I'm not suggesting special-casing the <code>importlib.import_module</code>. I'm suggesting that a submodule <code>foo.bar</code> import should be considered a redefinition of a prior <code>foo.bar</code> import, and should never be considered a redefinition of a previously defined <code>foo</code> symbol.</p>
<p>This came up in https://github.com/python/cpython/pull/124384.</p>
<p>Terms I searched for before filing the issue:</p>
<ul>
<li>F811</li>
<li>redefined-while-unused</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-09-23 22:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-23 22:48</div>
            <div class="timeline-body"><p>I agree we should probably not emit in the second case.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:14 UTC
    </footer>
</body>
</html>
