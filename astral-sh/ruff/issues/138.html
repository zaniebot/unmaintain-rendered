<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`F821 Undefined name` false negatives - astral-sh/ruff #138</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`F821 Undefined name` false negatives</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/138">#138</a>
        opened by <a href="https://github.com/nikolaik">@nikolaik</a>
        on 2022-09-10 11:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nikolaik">@nikolaik</a> on 2022-09-10 11:49</div>
            <div class="timeline-body"><p>Love your work on Ruff, congrats!  ❤️</p>
<p>Really want to start using it soon! When initially evaluating I found a few cases where rule <code>F821</code> was not happy with me:</p>
<p><strong>Using star imports</strong></p>
<p>a.py</p>
<pre><code class="language-python">YO = 'lo' 
</code></pre>
<p>b.py</p>
<pre><code class="language-python">from .a import *

if YO == 'lo':  #  F821 Undefined name `YO`
    YO = 'swag'
</code></pre>
<p><strong>Using unpacked list values</strong></p>
<pre><code class="language-python">[first] = ['yup'] #  F821 Undefined name `first`
</code></pre>
<p><strong>Inline functional declaration of typed dicts</strong></p>
<pre><code class="language-python">from typing import TypedDict

class Item(TypedDict):
    nodes = list[TypedDict('Node', {'id': str})]  #  F821 Undefined name `Node`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-10 14:10</div>
            <div class="timeline-body"><p>Thank you! These are great. The first and third issue were known to me but not documented anywhere (and the second is definitely a bug). Will fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-09-10 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-10 15:15</div>
            <div class="timeline-body"><p>On star imports: right now, the best we could do for now (which is equivalent to Flake8 / PyFlakes IIUC) is provide a separate error code and message, like: <code>%r may be undefined, or defined from star imports: %s</code>. (Doing anything more advanced would break the single-file-at-a-time design of the linter, since we'd have to look at the import tree to understand what was brought in from the star import.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-10 16:53</div>
            <div class="timeline-body"><p><code>Using unpacked list values</code> has been fixed in d7f95ac6b6e7775306c465a7b59e57da4e7c62d9.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-10 17:05</div>
            <div class="timeline-body"><p><code>Inline functional declaration of typed dicts</code> has been fixed in <code>6a24351202c009c14997dbb545cfb50e5393c210</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-10 17:06</div>
            <div class="timeline-body"><p>v0.0.31 is building now with those fixes. Going to close and create a separate issue to track starred imports. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-10 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/140.html">astral-sh/ruff#140</a> on 2022-09-10 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nikolaik">@nikolaik</a> on 2022-09-10 19:04</div>
            <div class="timeline-body"><p>Thanks for all the fixes, much improved!</p>
<p>Testing with v0.0.31 with the fix for <em>Inline functional declaration of typed dicts</em> in 6a24351202c009c14997dbb545cfb50e5393c210 I still see errors with:</p>
<pre><code class="language-python"># yolo.py
from typing import TypedDict

class Item(TypedDict):
    nodes: list[TypedDict('Node', {'name': str})]
</code></pre>
<pre><code class="language-console">$ ruff yolo.py
yolo.py:5:37: F821 Undefined name `name`

Found 1 error(s).
</code></pre>
<p>The reason why the test is passing <a href="https://github.com/charliermarsh/ruff/commit/6a24351202c009c14997dbb545cfb50e5393c210#diff-354badb80ef8370f6ea60e37eaf0074684656616254f547bedc1253fb3c81818R67">this line</a>, I'm guessing, is that <code>id</code> happens to be a keyword in python</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-10 19:19</div>
            <div class="timeline-body"><p>Gah, good call -- should be fixed in <code>c247730bf5d6394cfd4715c35ebb7d08e0da4fd0</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:06 UTC
    </footer>
</body>
</html>
