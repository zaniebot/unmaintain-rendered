<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use pytest file discovery logic to apply `PT` rules - astral-sh/ruff #8794</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use pytest file discovery logic to apply <code>PT</code> rules</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8794">#8794</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-11-20 19:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>For additional context, refer to <a href="https://github.com/astral-sh/ruff/issues/8145">astral-sh/ruff#8145</a>#issuecomment-1817657808 and the following comments.</p>
<blockquote>
<p>For me that would not help as I do not have a <code>tests/</code> directory. Instead, I have test files next to the files to be tested. e.g. <code>mypkg/util/string.py</code> has its test in <code>mypkg/util/string_test.py</code> and so on. I think for larger applications this is not uncommon.</p>
<p>I think ideally it would apply the <a href="https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#conventions-for-python-test-discovery">pytest rules for test discovery</a>, ideally with override settings or parsing of the <a href="https://docs.pytest.org/en/7.1.x/example/pythoncollection.html#changing-naming-conventions">respective pytest.ini options</a>.</p>
</blockquote>
<blockquote>
<p>I think mirroring the pytest rules for discovery would be sensible. It would also solve #8703, and arguably solve #6474.</p>
</blockquote>
<blockquote>
<p>However, I definitely want to avoid parsing <code>pytest.ini</code> and interpreting pytest configuration -- it&#x27;s just a huge pain to implement and maintain (and also requires that we know the pytest version and keep our settings in-sync with pytest&#x27;s settings). So if we <em>did</em> do this, we&#x27;d need to stick to the defaults, <em>or</em> add our own limited configuration.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">linter</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-20 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2024-08-02 07:08</div>
            <div class="timeline-body"><p>And the other way around, some rules never make sense for pytest,
and should always be disabled:</p>
<pre><code>[tool.ruff.lint.per-file-ignores]
&#x27;tests/**/*.py&#x27; = [
    &#x27;INP001&#x27;, # Test directories are not namespace packages
    &#x27;S101&#x27;,   # Pytest tests should use `assert`
    &#x27;RUF018&#x27;, # Assignment expressions in assert are fine here
]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:46 UTC
    </footer>
</body>
</html>
