<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleset suggestion: wemake-python-styleguide WPS2xx (complexity) - astral-sh/ruff #8022</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruleset suggestion: wemake-python-styleguide WPS2xx (complexity)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8022">#8022</a>
        opened by <a href="https://github.com/strmwalker">@strmwalker</a>
        on 2023-10-17 18:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/strmwalker">@strmwalker</a></div>
            <div class="timeline-body">

<p><code>wemake-python-styleguide</code> (<a href="https://wemake-python-styleguide.readthedocs.io/en/latest/index.html">link</a>) is a collection of plugins as well as a number of custom rules (WPSxxx). Implementing all rules outlined in #3845 seems to be an impossible task, so I suggest to tackle this step by step. The most useful section of WPS is a WPS2xx rules, focused on reducing overall unit complexity.
I implemented WPS201, WPS202, WPS203, and plan to submit a PR in nearest time. I would appreciate help on other rules. Here is a list of WPS2xx rules:</p>
<p>Unlike mccabe (C90), WPS also relies on other metrics, like Jones complexity and cognitive complexity (as proposed by G. Ann Campbell). Some violations are covered by Pylint (PLR).</p>
<ul>
<li>[ ] WPS200 ‚Äî Forbid modules with complex lines. (median <a href="https://github.com/Miserlou/JonesComplexity">Jones Complexity</a> of module &gt; 12)</li>
<li>[x] WPS201 ‚Äî Forbid modules with too many (12+) imports.</li>
<li>[x] WPS202 ‚Äî Forbid too many (7+) classes and functions in a single module.</li>
<li>[x] WPS203 ‚Äî Forbid modules with too many (50+) imported names.</li>
<li>[ ] WPS204 ‚Äî Forbid overused expressions in a module, function or method. (expression referenced over 4 times in function / over 7 times in module)</li>
<li>[ ] WPS210 ‚Äî Forbid too many (5+) local variables in the unit of code.</li>
<li>[x] WPS211 ‚Äî ~~Forbid too many arguments for a function or method.~~ covered by PLR0913</li>
<li>[x] WPS212 ‚Äî ~~Forbid placing too many return statements in a function.~~ covered by PLR0911</li>
<li>[x] WPS213 ‚Äî ~~Forbid putting too many expressions in a single function.~~ covered by PLR0915</li>
<li>[ ] WPS214 ‚Äî Forbid too many methods (7) in a single class.</li>
<li>[ ] WPS215 ‚Äî Restrict the maximum number of base classes (3).</li>
<li>[ ] WPS216 ‚Äî Restrict the maximum number of decorators (5).</li>
<li>[ ] WPS217 ‚Äî Forbid placing too many (5+) await expressions in a function.</li>
<li>[ ] WPS218 ‚Äî Forbid placing too many (5+) assert statements into a function.</li>
<li>[ ] WPS219 ‚Äî Forbid consecutive expressions with too deep (4+) access level. (e.g. self.attr.inner.wrapper.method.call() ‚Äî 5 levels deep)</li>
<li>[x] [WPS220] ‚Äî Forbid nesting blocks too deep.
kinda covered by C901?</li>
<li>[ ] WPS221 ‚Äî Forbid complex (Jones Complexity &gt; 14) lines.</li>
<li>[ ] WPS222 ‚Äî Forbid conditions with too many (4+) logical operators.</li>
<li>[ ] WPS223 ‚Äî Forbid too many (3+) elif branches.</li>
<li>[ ] WPS224 ‚Äî Forbid too many for statements within a comprehension.</li>
<li>[ ] WPS225 ‚Äî Forbid too many (3+) except cases in a single try clause.</li>
<li>[ ] WPS226 ‚Äî Forbid the overuse (3+ usages) of string literals.</li>
<li>[ ] WPS227 ‚Äî Forbid returning or yielding tuples that are too long.</li>
<li>[ ] WPS228 ‚Äî Forbid compare expressions that are too long (4+ items).</li>
<li>[ ] WPS229 ‚Äî Forbid try blocks with bodies that are too long (over 1 line).</li>
<li>[ ] WPS230 ‚Äî Forbid instances with too many (6+) public attributes.</li>
<li>[ ] WPS231 ‚Äî Forbid functions with too much (12+) cognitive complexity.</li>
<li>[ ] WPS232 ‚Äî Forbid modules with average cognitive complexity that is too high (8+).</li>
<li>[ ] WPS233 ‚Äî Forbid call chains that are too long (3+).</li>
<li>[ ] WPS234 ‚Äî Forbid overly complex annotations (3+ levels) see also: https://github.com/best-doctor/flake8-annotations-complexity</li>
<li>[ ] WPS235 ‚Äî Forbid from ... import ... with too many (8+) imported names.</li>
<li>[ ] WPS236 ‚Äî Forbid using too many (4+) variables to unpack a tuple.</li>
<li>[ ] WPS237 ‚Äî Forbids f-strings that are too complex.
A complex format string is defined as use of any formatted value that is not:<ul>
<li>the value of a variable</li>
<li>the value of a collection through lookup with a variable, number, or string as the key</li>
<li>the return value of a procedure call without arguments</li>
</ul>
</li>
<li>[ ]  WPS238 ‚Äî Forbids too many (3+) raise statements in a function.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-05 04:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/apatrushev">@apatrushev</a> on 2024-03-19 23:10</div>
            <div class="timeline-body"><p>WIP: <a href="https://github.com/strmwalker/ruff/tree/preview/wps">repo/branch</a>, <a href="https://github.com/strmwalker/ruff/issues">issues</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sobolevn">@sobolevn</a> on 2024-03-27 09:57</div>
            <div class="timeline-body"><p>@charliermarsh What&#x27;s the best way to approach this? We now have a working group of people who are interested in implementing this.</p>
<p>The most important question: do you even plan to include this?
Because WPS is massive. The amount of code to maintain is significant.
Plus, I don&#x27;t plan to stop supporting the upstream project, so it is very possible that people will continue to send new PRs and fixes even after the initial version.
(It would be so nice to have this as a plugin üôè)</p>
<p>The amount of code, docs, and config is very significant maintaince burden.</p>
<p>One more question about the workflow (if you plan to support this):</p>
<ol>
<li>Should we create multiple PRs with each rule?</li>
<li>Should we create one big PR with everything at once?</li>
</ol>
<p>I think that <code>1.</code> should be much better, because this way you and the team won&#x27;t be overwhelmed by the amount of code to review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-27 10:22</div>
            <div class="timeline-body"><blockquote>
<p>@charliermarsh What&#x27;s the best way to approach this? We now have a working group of people who are interested in implementing this.</p>
</blockquote>
<p>That&#x27;s great news!</p>
<p>We&#x27;re reworking our rule categorize (see #1774) and the rule acceptance guidelines. That&#x27;s why I think it&#x27;s important that someone on the team first goes through the rules and identifies the rules that we consider not a good fit for Ruff or where there&#x27;s overlap with other rules that need figuring out to avoid unnecessary work.</p>
<p>From looking at the list (without reading the rules in detail):</p>
<ul>
<li>Many of the rules are very opinionated. We want to hold off on adding such rules until #1774 is done because they would be enabled by default for everyone using <code>--select ALL</code> (which many believe is Ruff&#x27;s recommended rule set). We hope to roll out a better default set as part of #1774 that allows us to add opinionated rules (in this case the rules are more about intentionally limiting what you&#x27;re allowed to use in Python).</li>
<li>Some of the rules above are centered around complexity. For example, WPS200. It&#x27;s not a direct overlap, but both measure local complexity and can, e.g., conflict with a rule restricting complexity by the maximum number of lines in a module (not supported by Ruff). We need to figure out how we deal with this overlap. Should complexity be a single, configurable rule where you specify the desired &quot;metric,&quot; or is it okay to have multiple rules (if so, how do we avoid fixing cycles)</li>
</ul>
<blockquote>
<p>One more question about the workflow (if you plan to support this):</p>
</blockquote>
<p>I strongly prefer 1. because it makes it easier to triage, review, and allows us to merge rules faster</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sobolevn">@sobolevn</a> on 2024-03-27 10:34</div>
            <div class="timeline-body"><blockquote>
<p>Many of the rules are very opinionated.</p>
</blockquote>
<p>That&#x27;s the whole point :)</p>
<p>I think that adding individual rules does not make much sense, because they work as a complex.
https://sobolevn.me/2019/10/complexity-waterfall</p>
<p>This is why I am asking about a plugin or a wrapper :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ashrub-holvi">@ashrub-holvi</a> on 2024-11-29 18:03</div>
            <div class="timeline-body"><p>To be honest I don&#x27;t see any issues with disabling not needed rules, it&#x27;s easy to do (<code>ruff check --statistics</code> can be transformed to a piece of config), but now I can&#x27;t use those rules (as I understand there is some draft) because they are blocked by categorisation and not sure there is any clarity when it will be implemented.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:43 UTC
    </footer>
</body>
</html>
