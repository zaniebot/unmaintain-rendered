<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF027 false positive with reserved keywords, how to handle? - astral-sh/ruff #9908</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>RUF027 false positive with reserved keywords, how to handle?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/9908">#9908</a>
        opened by <a href="https://github.com/sshishov">@sshishov</a>
        on 2024-02-09 10:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sshishov">@sshishov</a> on 2024-02-09 10:51</div>
            <div class="timeline-body"><p>Hi,</p>
<p>I would like to ask how to handle the cases where the &quot;variable&quot; for interpolation is used in the constant or other variable beforehand, example below</p>
<pre><code class="language-python">CONSTANT_CACHE_KEY = 'my:{id}:here'  # &lt;-- RUF027 is triggered here (Possible f-string without an `f` prefix)

def some_function(value: str) -&gt; None:
    cache_key = CONSTANT_CACHE_KEY.format(id=value)
    ...  # later on we use this cache key and `value` here is like a variable for cache key
</code></pre>
<p>I have tried to &quot;hack&quot; slightly by using:</p>
<pre><code class="language-python">CONSTANT_CACHE_KEY = f'my:{{id}}:here'  # &lt;-- F541 is triggered here (f-string without any placeholders)
</code></pre>
<p><strong>UPDATE:</strong> this is happening only with reserved keywords like <code>id</code> or <code>filter</code>. If variable does not exist, then this error is not raised.</p>
<p>Should it be somehow treated or handled? Or for this cases should we add <code># noqa: RUF027</code>? Or maybe the good suggestion would be to rename the variable inside the string from <code>id</code> to <code>object_id</code>?</p>
<p>ruff version: 0.2.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "RUF027 false positive with constants, how to handle?" to "RUF027 false positive with reserved keywords, how to handle?" by @sshishov on 2024-02-09 10:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sshishov">@sshishov</a> on 2024-02-09 11:09</div>
            <div class="timeline-body"><p>Just a side note, we have updated all usages of <code>prefix:{id}:suffix</code> constants to <code>prefix:{object_id}:suffix</code> and now we do not have any issues with amazing <strong>ruff</strong> üéâ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-02-09 15:49</div>
            <div class="timeline-body"><p>As a precision, <code>id</code>, <code>filter</code>, etc., are not reserved keywords, they are builtins (global names from the stdlib).</p>
<p>RUF027's heuristic detects when you try to use an existing symbols in brackets.</p>
<pre><code class="language-python">my_value = 5
message = &quot;I have {my_value} things&quot;
print(message)
</code></pre>
<p>But since <code>id</code> is always defined, it'll always trigger in your case.
It's just like https://docs.astral.sh/ruff/rules/builtin-variable-shadowing/</p>
<p>Maybe RUF027 could respect https://docs.astral.sh/ruff/settings/#lint_flake8-builtins_builtins-ignorelist ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-09 16:00</div>
            <div class="timeline-body"><p>I think this is already fixed on <code>main</code>, due to:</p>
<ul>
<li>#9849</li>
</ul>
<p>It should be included in the  next release!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-10 23:53</div>
            <div class="timeline-body"><p>üëç I believe this will be fixed in the next release -- sorry about that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-10 23:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
