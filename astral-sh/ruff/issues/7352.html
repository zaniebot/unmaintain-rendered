<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLI: Show fixes by default in `ruff check` - astral-sh/ruff #7352</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>CLI: Show fixes by default in <code>ruff check</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7352">#7352</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-09-13 16:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Requires #7350 for opt-out of display.</p>
<p><code>ruff check</code> should display fixes that Ruff can apply. Currently this is only possible for the whole file with <code>--diff</code>.</p>
<p>Some fixes may modify content across a file, e.g. when renaming a binding. We should limit the display of fixes to roughly match the range of source context displayed (#7349). If we do not display the entire fix, we should include a notice of the number of additional lines that will be modified if the fix is applied. Naively, we may be able to implement this by only selecting a portion of the fix. In a more comprehensive implementation, we may need to add a new diagnostic range attribute for this display and address it in each problem case.</p>
<blockquote>
<p>Clippy has a nice example user experience of showing fixes:</p>
<pre><code>error[E0308]: mismatched types
--&gt; crates/ruff_python_semantic/src/model.rs:224:21
    |
224 |             source: &amp;self.stmt_id,
    |                     ^^^^^^^^^^^^^ expected `Option&lt;NodeId&gt;`, found `&amp;Option&lt;NodeId&gt;`
    |
    = note:   expected enum `std::option::Option&lt;node::NodeId&gt;`
            found reference `&amp;std::option::Option&lt;node::NodeId&gt;`
help: consider removing the borrow
    |
224 -             source: &amp;self.stmt_id,
224 +             source: self.stmt_id,
    |

For more information about this error, try `rustc --explain E0308`.
</code></pre>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @zanieb on 2023-09-13 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pjonsson">@pjonsson</a> on 2024-03-28 12:08</div>
            <div class="timeline-body"><p>I came here from #8677 because I wanted a non-zero exit code when there are things to be fixed in my source code (even if Ruff can't fix them).</p>
<p>Based on the description of this issue, I don't understand the details but I get the impression it will somehow eliminate the need for <code>--diff</code>, will <code>ruff check &lt;without --diff?&gt; --output-format junit -o ruff-check-report.xml</code> exit with a non-zero exit code and produce junit reports after this is fixed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-29 20:39</div>
            <div class="timeline-body"><p>I'm honestly not sure... this is different than <code>--diff</code> in that we just show fixes for the relevant source context. I don't think this would have any affect on the exit code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-29 20:39</div>
            <div class="timeline-body"><p>A note regarding the implementation.. we probably need to gate this with preview to match #7349</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pjonsson">@pjonsson</a> on 2024-03-30 10:18</div>
            <div class="timeline-body"><p>If this has no effect on exit code, I feel that the comments in the tickets concerning exit codes that are linking here (https://github.com/astral-sh/ruff/issues/4093#issuecomment-1920622666, https://github.com/astral-sh/ruff/issues/8677#issuecomment-1810700437, https://github.com/astral-sh/ruff/issues/8584#issuecomment-1803968274) are confusing. I'm not a native speaker, but to me, all those tickets were filed because the user was expecting a non-zero exit code when Ruff is unhappy. I think part of the reason people are surprised is because it's so easy to get the non-zero exit code with <code>ruff format --diff</code>.</p>
<p>Since this ticket does not help with exit codes, should the non-zero exit code part of this issue be dealt with by #8677?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-30 14:23</div>
            <div class="timeline-body"><p>Ah I see what you're saying:</p>
<ol>
<li>You want to run Ruff and see all the fixes it has to offer</li>
<li>The only way to do this now is with <code>--diff</code></li>
<li>But when you use <code>--diff</code> the exit code is zero</li>
</ol>
<p>Yes this should address your use-case, in that:</p>
<ol>
<li>We will show fixes by default so <code>--diff</code> is not necessary</li>
<li>The exit code semantics should be the same as Ruff without <code>--diff</code></li>
<li>If any violations are remaining, Ruff will exit with a non-zero code</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-08-29 13:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:21 UTC
    </footer>
</body>
</html>
