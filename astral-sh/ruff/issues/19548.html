<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Rule Proposal: Consolidate imports from the same module unnecessarily split by `TYPE_CHECKING` - astral-sh/ruff #19548</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>New Rule Proposal: Consolidate imports from the same module unnecessarily split by <code>TYPE_CHECKING</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19548">#19548</a>
        opened by <a href="https://github.com/vivodi">@vivodi</a>
        on 2025-07-25 02:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vivodi">@vivodi</a> on 2025-07-25 02:52</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This issue proposes a new linting rule to discourage placing imports within a <code>typing.TYPE_CHECKING</code> block when another import from the same module already exists at the top level. This pattern offers no performance benefits and harms code readability.</p>
<p><strong>Motivation</strong></p>
<p>The primary purpose of a <code>TYPE_CHECKING</code> block is to prevent circular imports or to import types solely for static analysis, avoiding runtime overhead. However, it is often misused for imports that could be safely imported at runtime without issue, especially when the module is already being imported from.</p>
<p>When one object is already imported from a module at the top level, placing another import from that same module inside a <code>TYPE_CHECKING</code> block provides no tangible benefit:</p>
<ol>
<li><strong>No Performance Gain:</strong> The overhead of importing the <code>my_library</code> module has already been incurred to import object <code>A</code>. Importing an additional object (<code>B</code>) from the already-loaded module is negligible.</li>
<li><strong>Reduced Readability:</strong> It unnecessarily splits imports from the same library into two separate locations, making it harder for developers to get a quick overview of the module's dependencies.</li>
<li><strong>Increased Verbosity:</strong> The code is longer and more complex than it needs to be.</li>
<li><strong>Misleading Signal:</strong> It incorrectly signals that <code>B</code> is a problematic or heavy import when it is not. The use of <code>TYPE_CHECKING</code> should be reserved for cases where it is truly necessary.</li>
</ol>
<p>A better, more readable, and more direct approach is to consolidate the imports into a single statement.</p>
<p><strong>Proposed Rule and Autofix</strong></p>
<p>The rule would trigger when an import inside a <code>TYPE_CHECKING</code> block can be merged with an existing import from the same module outside the block. The rule should have an automatic fix that consolidates the imports.</p>
<p><strong>Non-compliant code:</strong></p>
<pre><code class="language-python">from my_library import A
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from my_library import B

def func(param: &quot;B&quot;) -&gt; A:
    return A()
</code></pre>
<p><strong>Compliant code (after autofix):</strong></p>
<pre><code class="language-python">from my_library import A, B

def func(param: &quot;B&quot;) -&gt; A:
    return A()
</code></pre>
<p>This proposal would fit well within the <code>flake8-type-checking</code> (<code>TC</code>) rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-25 13:38</div>
            <div class="timeline-body"><p>This makes some sense to me. It's similar to <a href="https://docs.astral.sh/ruff/rules/runtime-import-in-type-checking-block/#runtime-import-in-type-checking-block-tc004">runtime-import-in-type-checking-block (TC004)</a> but extending to members of the same module.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-07-25 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-07-25 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-07-28 15:58</div>
            <div class="timeline-body"><p>This is an opinionated rule. Maybe it could be a configurable option?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maltevesper">@maltevesper</a> on 2025-10-17 08:01</div>
            <div class="timeline-body"><p>I dont think this is to opinionated to warrant a configuration option. Apart from not changing existing code, what benefits are there for keeping the import inside the type checking block? I see only the downside of less readable code.
Personally this is a high priority issue to me, since the switch towards Python 3.14 started Ruff asking us to move the imports into typechecking blocks in the first place. So in my personal case some of the code has become a bit cluttered by the TC003 autofix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-10-29 12:01</div>
            <div class="timeline-body"><blockquote>
<p>Apart from not changing existing code, what benefits are there for keeping the import inside the type checking block?</p>
</blockquote>
<p>I like to know what imports are actually used for runtime behavior and what imports are only used for typechecking. Helpful for figuring out proper module structure.</p>
<p>Maybe you don't find that information interesting. That's okay, we have different opinions. Hence opinionated üêà</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GideonBear">@GideonBear</a> on 2025-12-11 18:00</div>
            <div class="timeline-body"><p>To add what I said in #21921: This is the enforcement of the opposite of <code>strict</code>.</p>
<blockquote>
<p>Looks like a duplicate to me as well. Overall I don't dislike the idea, but it definitely can't be a boolean setting at this point. We don't want to cause arguably unnecessary churn in either direction, unless people specifically opt into it for aesthetics/consistency. So it would have to be a three-stage setting, either you prefer imports staying together, you prefer all the typing only imports staying in type checking blocks, even if it means splitting up imports or you have no preference and ruff will only nag you when there's a tangible benefit to moving the import beyond aesthetics/consistency.</p>
</blockquote>
<p>I would personally like this to be the default when using <code>strict = false</code>, because <em>I don't like allowing inconsistency</em>. But I can see why this should be a three-stage setting instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GideonBear">@GideonBear</a> on 2025-12-11 18:27</div>
            <div class="timeline-body"><p>In any case this might need reconsideration of the name of the <code>strict</code> setting, both extremes are &quot;strict&quot; in their own way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-12-15 18:01</div>
            <div class="timeline-body"><p>There's a danger here when it comes to type-checking-only symbols (often found in stubs for protocols or to expose an internal return type).
Maybe that warrant configuration, or maybe it's rare enough one should just <code>noqa</code> it. But overall an autofix wouldn't be safe here (unless specifically detecting imports used at runtime, but then <a href="https://docs.astral.sh/ruff/rules/runtime-import-in-type-checking-block/#runtime-import-in-type-checking-block-tc004">TC004</a> already covers that)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:38:02 UTC
    </footer>
</body>
</html>
