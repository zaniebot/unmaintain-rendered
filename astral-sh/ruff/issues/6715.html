<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Failed to create fix for `UnnecessaryMap: Currently not supporting default values` - astral-sh/ruff #6715</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to create fix for <code>UnnecessaryMap: Currently not supporting default values</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6715">#6715</a>
        opened by <a href="https://github.com/qarmin">@qarmin</a>
        on 2023-08-21 08:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qarmin">@qarmin</a></div>
            <div class="timeline-body"><p>Ruff 0.0.285</p>
<pre><code>ruff  *.py --select ALL
</code></pre>
<p>file content:</p>
<pre><code>_ = f&quot;{dict(map(lambda v: (v, v**2), nums))}&quot;
# For simple expressions, this could be: `(x if x else 1 for x in nums)`.
map(lambda x=1: x, nums)
</code></pre>
<p>error:</p>
<pre><code>error: Failed to create fix for UnnecessaryMap: Currently not supporting default values
</code></pre>
<p>For me, this error should not be visible for user, because this message is useless for it</p>
<p><a href="https://github.com/astral-sh/ruff/files/12394161/PY_FILE_TEST_178904787.py.zip">PY_FILE_TEST_178904787.py.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-21 10:35</div>
            <div class="timeline-body"><p>The fix might not work if there are any falsy values in the iterable. For example, if one of the values of <code>nums</code> is 0 then it would use 1 but it explicitly passed the argument.</p>
<p>I do agree that the message isn't useful from user perspective and instead we should avoid auto-generating the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2023-08-21 10:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @dhruvmanila on 2023-08-21 10:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fuzzer</span> added by @charliermarsh on 2023-08-21 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-21 12:56</div>
            <div class="timeline-body"><p>Yeah it's fine that this is unsupported, but we should attempting to fix it and thus raising the message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-21 23:25</div>
            <div class="timeline-body"><blockquote>
<p>The fix might not work if there are any falsy values in the iterable. For example, if one of the values of nums is 0 then it would use 1 but it explicitly passed the argument.</p>
</blockquote>
<p>Can you expand on this with an example?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-22 02:33</div>
            <div class="timeline-body"><p>Here, you can see the output is different. Default values in this context will never be used as <code>map</code> will always pass a value to the function.</p>
<pre><code class="language-python">In [1]: nums = [0, 1, 2]

In [2]: list(map(lambda x=1: x, nums))
Out[2]: [0, 1, 2]

In [3]: list(x if x else 1 for x in nums)
Out[3]: [1, 1, 2]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-22 02:57</div>
            <div class="timeline-body"><p>But, isn't this suggesting that the user change <code>list(map(lambda x=1: x, nums))</code> to <code>[x for x in nums]</code>? Why the inclusion of <code>if x else 1</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-22 03:55</div>
            <div class="timeline-body"><p>Oh, it's mentioned in the PR description:</p>
<blockquote>
<p>For simple expressions, this could be: <code>(x if x else 1 for x in nums)</code>.</p>
</blockquote>
<p>But yeah, your suggestion would work correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-22 03:57</div>
            <div class="timeline-body"><p>We should probably just skip attempting the fix if there are default values. It's an unusual pattern and I can think of a few cases where it would cause problems.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-22 04:01</div>
            <div class="timeline-body"><p>Yeah, I'm thinking of the same solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2023-08-22 04:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-08-22 19:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:03 UTC
    </footer>
</body>
</html>
