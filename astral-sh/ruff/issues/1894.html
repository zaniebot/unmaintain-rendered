<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOML parse error: Invalid table header: Duplicate key `version` - astral-sh/ruff #1894</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>TOML parse error: Invalid table header: Duplicate key <code>version</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1894">#1894</a>
        opened by <a href="https://github.com/hugovk">@hugovk</a>
        on 2023-01-15 12:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hugovk">@hugovk</a></div>
            <div class="timeline-body">

<p>Run <code>ruff .</code> with this <code>pyproject.toml</code> in an empty directory:</p>
<pre><code># pyproject.toml

[tool.hatch]
version.source = &quot;vcs&quot;

[tool.hatch.version.raw-options]
local_scheme = &quot;no-local-version&quot;
</code></pre>
<p>Outputs error only without <code>--isolated</code> in newest 0.0.222:</p>
<pre><code>$ ruff --version
ruff 0.0.222
$  ruff .
error TOML parse error at line 6, column 1
  |
6 | [tool.hatch.version.raw-options]
  | ^
Invalid table header
Duplicate key `version`

$ ruff . --isolated
warning: No Python files found under the given path(s)
</code></pre>
<p>This file is parsed fine by other tools, such as Hatchling, python-build, Black, isort etc. Fuller version at https://github.com/hugovk/norwegianblue/</p>
<p>Error both with and without <code>--isolated</code> in 0.0.219:</p>
<pre><code>$ ruff --version
ruff 0.0.219
$ ruff .
error TOML parse error at line 6, column 1
  |
6 | [tool.hatch.version.raw-options]
  | ^
Invalid table header
Duplicate key `version`

$ ruff . --isolated
error TOML parse error at line 6, column 1
  |
6 | [tool.hatch.version.raw-options]
  | ^
Invalid table header
Duplicate key `version`
</code></pre>
<p>Error only without <code>--isolated</code> in 0.0.220:</p>
<pre><code>$ ruff --version
ruff 0.0.220
$ ruff .
error TOML parse error at line 6, column 1
  |
6 | [tool.hatch.version.raw-options]
  | ^
Invalid table header
Duplicate key `version`

$ ruff . --isolated
warning: No Python files found under the given path(s)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2023-01-15 13:25</div>
            <div class="timeline-body"><p>Looks like both <a href="https://github.com/toml-rs/toml/tree/main/crates/toml"><code>toml</code></a> and <a href="https://github.com/toml-rs/toml/tree/main/crates/toml_edit"><code>toml_edit</code></a> fail to parse the toml content, see https://www.rustexplorer.com/b/vthrz3</p>
<pre><code>$ ./playground
Err(
    Error {
        inner: ErrorInner {
            kind: Custom,
            line: Some(
                5,
            ),
            col: 0,
            at: Some(
                55,
            ),
            message: &quot;duplicate key: `version`&quot;,
            key: [
                &quot;tool&quot;,
                &quot;hatch&quot;,
            ],
        },
    },
)
Err(
    TomlError {
        message: &quot;TOML parse error at line 6, column 1\n  |\n6 | [tool.hatch.version.raw-options]\n  | ^\nInvalid table header\nDuplicate key `version`\n&quot;,
        line_col: Some(
            (
                5,
                0,
            ),
        ),
    },
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-01-20 20:48</div>
            <div class="timeline-body"><p>I&#x27;m not familiar with the Rust release process, will this be closed when <a href="https://github.com/toml-rs/toml/issues/439">toml-rs/toml#439</a> is available in Ruff, so I can just watch this issue? :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 21:16</div>
            <div class="timeline-body"><p>Yeah it should be! I&#x27;ll try upgrading. It looks like they just cut a release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 21:26</div>
            <div class="timeline-body"><p>Looks like #2040 should close this out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 22:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-21 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-21 12:50</div>
            <div class="timeline-body"><p>Sorry, a little confusion with respect to the <code>toml</code> crate -- the upgrade I performed <em>did</em> solve this problem, but it had the potential to introduce some other incompatibilities with TOML 1. So I want to revert for now, just to minimize churn. I expect this to be closed out soon-ish, but we do need a new release. (See: #2058.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-21 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-21 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-24 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2023-01-24 16:34</div>
            <div class="timeline-body"><p>Thank you for the fix, I can confirm this is fixed in 0.0.231.</p>
<p>I&#x27;m impressed it only took 9 days for: report to Ruff, report upstream to Rust TOML library, report upstream to the language-agnostic TOML test suite, then the test suite updated and released, then the TOML library updated and released, and then Ruff updated and released!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:30 UTC
    </footer>
</body>
</html>
