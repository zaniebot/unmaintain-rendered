<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUFF012: False positive when using inheritance  - astral-sh/ruff #5429</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUFF012: False positive when using inheritance </h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/5429">#5429</a>
        opened by <a href="https://github.com/frenck">@frenck</a>
        on 2023-06-28 21:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/frenck">@frenck</a> on 2023-06-28 21:02</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>ruff version: 0.0.275</p>
<p>I'm running into a false positive, as it ignores inheritance.</p>
<p>Example:</p>
<pre><code class="language-py">class MyBaseClass:

    example: ClassVar[set[str]]

class NotMyBaseClass(MyBaseClass):

    example = {&quot;O&quot;, &quot;M&quot;, &quot;G&quot;, &quot;Puppies!&quot;}
</code></pre>
<p>RUF012 will now trigger on the <code>NotMyBaseClass.example</code>: <code>RUF012 Mutable class attributes should be annotated with `typing.ClassVar` </code></p>
<p>However, this is already the case...</p>
<p>../Frenck</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-06-28 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @charliermarsh on 2023-06-28 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-28 21:22</div>
            <div class="timeline-body"><p>Yeah we can't get this right at present. It's a bug. The workaround would just be to re-annotate:</p>
<pre><code class="language-python">class NotMyBaseClass(MyBaseClass):
    example: ClassVar[set[str]] = {&quot;O&quot;, &quot;M&quot;, &quot;G&quot;, &quot;Puppies!&quot;}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/frenck">@frenck</a> on 2023-06-28 21:24</div>
            <div class="timeline-body"><blockquote>
<p>The workaround would just be to re-annotate:</p>
</blockquote>
<p>Right... I understood that (and noticed), but that is kind of counterproductive / not a solution IMHO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-28 21:26</div>
            <div class="timeline-body"><p>Totally, I agree that it's not a good solution, but it's probably the best I can suggest immediately apart from &quot;turn off the rule&quot; :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/frenck">@frenck</a> on 2023-06-28 21:27</div>
            <div class="timeline-body"><p>Re-annotation also overwrites the base. So, if the typing of the base class is changed, the children won't be updated (and might end up being incompatible, nothing warns for that at this time as it seems).</p>
<p>So, this can actually cause bugs instead of preventing them. From that perspective, I would even argue the rule currently encourages something really bad.</p>
<p>../Frenck</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-28 21:31</div>
            <div class="timeline-body"><p>FWIW Mypy does warn on this, oddly Pyright does not:</p>
<pre><code class="language-py">from typing import ClassVar

class MyBaseClass:
    example: ClassVar[set[str]]

class NotMyBaseClass(MyBaseClass):
    example: ClassVar[list[str]] = [&quot;O&quot;, &quot;M&quot;, &quot;G&quot;, &quot;Puppies!&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/frenck">@frenck</a> on 2023-06-28 21:32</div>
            <div class="timeline-body"><p>üëç relied on Pyright in my previous answer, ok, that makes it a little less worse üòÑ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-28 21:33</div>
            <div class="timeline-body"><p>Haha yeah. I'm not sure. I guess I need to think on it. Like, we could probably support this when both classes are defined in the same file, and soon (TM), when both classes are defined locally (as opposed to in third-party modules). But I'm wondering if the rule is too unreliable right now to be worth including in Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-05 19:20</div>
            <div class="timeline-body"><p>In your case, do the base classes tend to be defined in the same file? In the same package (i.e., defined locally)? In third-party packages?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/frenck">@frenck</a> on 2023-07-06 06:57</div>
            <div class="timeline-body"><blockquote>
<p>In your case, do the base classes tend to be defined in the same file</p>
</blockquote>
<p>Nope, they are not.</p>
<p>In the same package (i.e., defined locally)? In third-party packages?</p>
<p>Yes, they are defined locally, as in, not originating from a third-party package.</p>
<p>../Frenck</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nikkwong">@nikkwong</a> on 2024-01-10 06:01</div>
            <div class="timeline-body"><p>There's also a false negative, as no type error is raised when members that don't follow the types defined in a parent class:</p>
<pre><code class="language-python">class MyBaseClass:
    @abstractmethod
    def my_method(self, arg: str) -&gt; Dict:
        pass

# no type errors raised:
class NotMyBaseClass(MyBaseClass):
    def my_method(self):
        return &quot;not a dict&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16174.html">astral-sh/ruff#16174</a> on 2025-02-15 03:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KerberosMorphy">@KerberosMorphy</a> on 2025-11-28 15:42</div>
            <div class="timeline-body"><p>I was looking to report something similar so I'll join it here:</p>
<p><img width="454" height="249" alt="Image" src="https://github.com/user-attachments/assets/4f71e571-5202-40ec-ac82-cb5cc36e4111" /></p>
<p>No error is detected in the <code>Test2</code> class for the <code>field</code> attribute.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
