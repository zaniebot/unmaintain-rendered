<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLW3301: incorrect autofix when using generator expression - astral-sh/ruff #4410</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLW3301: incorrect autofix when using generator expression</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4410">#4410</a>
        opened by <a href="https://github.com/oefe">@oefe</a>
        on 2023-05-13 12:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oefe">@oefe</a></div>
            <div class="timeline-body"><p>The autofix for <code>PLW3301</code> generates incorrect code if the nested call is using a generator expression.</p>
Example
<p>PLW3301.py:</p>
<pre><code>x = max(1, max(i for i in range(10)))
</code></pre>
Observed
<pre><code>ruff --isolated --diff --select PLW3301  PLW3301.py
--- PLW3301.py
+++ PLW3301.py
@@ -1 +1 @@
-x = max(1, max(i for i in range(10)))
+x = max(1, (i for i in range(10)))

Would fix 1 error.
</code></pre>
Issue
<p>This is incorrect. <code>max</code> <a href="https://docs.python.org/3/library/functions.html#max">takes either an iterable, or a variable number of arguments, but not both</a>:</p>
<pre><code>python -c &quot;max(1, (i for i in range(10)))&quot;
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
TypeError: &#x27;&gt;&#x27; not supported between instances of &#x27;generator&#x27; and &#x27;int&#x27;
</code></pre>
Expected
<p>The correct fix would be:</p>
<pre><code>max(1, *(i for i in range(10)))
</code></pre>
Ruff Version
<pre><code>ruff --version
ruff 0.0.267
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-13 12:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-05-13 12:44</div>
            <div class="timeline-body"><p>I can work on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-05-13 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-13 12:52</div>
            <div class="timeline-body"><p>We may just want to avoid including <code>max</code> calls with a single argument altogether, since max seems to assume that the single argument is iterable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-13 15:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:36 UTC
    </footer>
</body>
</html>
