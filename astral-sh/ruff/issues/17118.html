<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add rule to only allow specific top-level imports - astral-sh/ruff #17118</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add rule to only allow specific top-level imports</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/17118">#17118</a>
        opened by <a href="https://github.com/ofek">@ofek</a>
        on 2025-04-01 12:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ofek">@ofek</a> on 2025-04-01 12:36</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We would like a rule similar to <a href="https://docs.astral.sh/ruff/rules/banned-module-level-imports/">TID253</a> but that has an option where you supply a list of packages (e.g. <code>[&quot;foo&quot;, &quot;bar.baz&quot;]</code> that are allowed to be imported at the top level and everything else would produce an error. Inclusion should not allow subpackages e.g. configuring <code>foo</code> would not grant privilege to <code>foo.bar</code> and dotted paths should grant privilege to parents e.g. <code>bar</code> is okay if <code>bar.baz</code> is configured.</p>
<p>This would benefit applications (CLIs and serverless) that enforce the near-ubiquitous use of lazy module loading but wish to allow known fast imports such as <code>os</code> or imports that are known to always occur anyway.</p>
<p>I would recommend always allowing <code>__future__</code> and <code>typing</code> no matter what the user defines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-04-01 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeshardmind">@mikeshardmind</a> on 2025-04-01 14:09</div>
            <div class="timeline-body"><p>allowing <code>typing</code> as a top level here in spite of what a user configures would cause this to be an unusable rule for me. Typing is a slow import and is one of the ones I take <a href="https://github.com/mikeshardmind/async-utils/blob/main/src/async_utils/_typings.py">extra steps to avoid eagerly importing</a> that are significantly faster.</p>
<p>I think I agree about <code>__future__</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2025-04-01 14:56</div>
            <div class="timeline-body"><p>The trade-off here is that every user of this rule who happens to use type hints (likely the vast majority) will be always forced to add <code>typing</code> to their list of allowed packages/modules because that is always a top-level import since <code>if TYPE_CHECKING:</code> couldn't go anywhere else. However, given we now have <a href="https://peps.python.org/pep-0781/">PEP 781</a> which will probably be accepted then perhaps what you're saying is more future proof.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeshardmind">@mikeshardmind</a> on 2025-04-01 15:16</div>
            <div class="timeline-body"><p>Maybe this rule could have a configuration that defaults to true if 781 is accepted that implicitly allows <code>typing</code> within the true branch of <code>if TYPE_CHECKING:</code> (or whatever the symbol ends up being) and can be extended with other typing-only allowed imports?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2025-04-01 15:54</div>
            <div class="timeline-body"><p>I like that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 16:14</div>
            <div class="timeline-body"><p>I'm not sure I fully follow but I'm hesitant to requiring another option only to avoid adding <code>typing</code> to another setting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2025-04-01 16:21</div>
            <div class="timeline-body"><p>What Mike is saying, the part that I'm also in favor of, would be that if PEP 781 is accepted that <code>typing</code> would be allowed within <code>if TYPE_CHECKING:</code> blocks no matter what the user configures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2025-04-02 15:51</div>
            <div class="timeline-body"><p>@MichaReiser What do you think about adding the <code>help wanted</code> label to encourage contributions since the logic is mostly already implemented via that other rule?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2025-04-02 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2025-04-15 17:06</div>
            <div class="timeline-body"><p>Until this is implemented I added a note in our documentation: https://datadoghq.dev/datadog-agent-dev/guidelines/cli/#lazy-imports</p>
<p>Hopefully our CLI's overall responsiveness doesn't regress by then ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2025-07-24 15:36</div>
            <div class="timeline-body"><p>Has there been any progress on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-24 15:51</div>
            <div class="timeline-body"><p>No. We'll post here if there is</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
