<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>json.schemastore.org is not up to date - astral-sh/ruff #1765</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>json.schemastore.org is not up to date</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/1765">#1765</a>
        opened by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a>
        on 2023-01-10 09:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-01-10 09:10</div>
            <div class="timeline-body"><p>Hi,
There is <code>flake8-pytest-style</code> missing in the schema from <a href="https://json.schemastore.org/ruff.json">json.schemastore.org</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-01-10 09:19</div>
            <div class="timeline-body"><p>In <a href="https://github.com/SchemaStore/schemastore/blob/master/CONTRIBUTING.md">schemastore/CONTRIBUTING.md</a> it is said:</p>
<blockquote>
<p>Keep single source of truth. Do not copy an external schema here, but point the catalog to the external schema.</p>
</blockquote>
<p>Maybe we should open a pull request to link to <a href="https://raw.githubusercontent.com/charliermarsh/ruff/main/ruff.schema.json">ruff.schema.json</a> instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-01-10 11:20</div>
            <div class="timeline-body"><p>I went ahead and made a <a href="https://github.com/SchemaStore/schemastore/pull/2724">pull request</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-10 12:20</div>
            <div class="timeline-body"><p>Unfortunately, the Schema Store doesn't support URLs for embedded schemas. So we can't point it to a URL if we want the schema to appear for <code>pyproject.toml</code> files. I initially implemented it as a URL (https://github.com/SchemaStore/schemastore/pull/2673), then intentionally changed it to bundle in the repo to support <code>pyproject.toml</code> files (https://github.com/SchemaStore/schemastore/pull/2683). It's an unfortunate limitation, but for now we have to update it periodically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../SchemaStore/schemastore/pulls/2724.html">SchemaStore/schemastore#2724</a> on 2023-01-10 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-10 22:09</div>
            <div class="timeline-body"><p>We should just be sure to update the schema in the store periodically. It looks like it was updated three days ago to include <code>flake8-pytest-style</code>: https://github.com/SchemaStore/schemastore/pull/2718/files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-10 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/layday">@layday</a> on 2023-01-14 11:27</div>
            <div class="timeline-body"><p>The linked commit added the <code>flake8-pytest-style</code> codes but not the config section.  There's other codes and sections missing, e.g. <code>PIE</code>.  I wonder if updates could be automated somehow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-14 12:10</div>
            <div class="timeline-body"><p>I’ll update it today. We could definitely automate it, but I’m worried about spamming the Schema Store repo. I’ll ask in the PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sasanjac">@sasanjac</a> on 2023-03-15 11:19</div>
            <div class="timeline-body"><blockquote>
<p>Unfortunately, the Schema Store doesn't support URLs for embedded schemas. So we can't point it to a URL if we want the schema to appear for <code>pyproject.toml</code> files</p>
</blockquote>
<p>What exactly does not support embedded schemas? Can we not just add something like this to <code>catalog.json</code>:</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;Ruff&quot;,
  &quot;description&quot;: &quot;JSON schema for Ruff, a fast Python linter&quot;,
  &quot;url&quot;: &quot;https://github.com/charliermarsh/ruff/blob/v0.0.256/ruff.schema.json&quot;,
  &quot;fileMatch&quot;: [&quot;ruff.toml&quot;],
  &quot;versions&quot;: {
    &quot;0.0.253&quot;: &quot;https://github.com/charliermarsh/ruff/blob/v0.0.253/ruff.schema.json&quot;,
    &quot;0.0.254&quot;: &quot;https://github.com/charliermarsh/ruff/blob/v0.0.254/ruff.schema.json&quot;,
    &quot;0.0.255&quot;: &quot;https://github.com/charliermarsh/ruff/blob/v0.0.255/ruff.schema.json&quot;,
    &quot;0.0.256&quot;: &quot;https://github.com/charliermarsh/ruff/blob/v0.0.256/ruff.schema.json&quot;
  }
}
</code></pre>
<p>And then update only new versions after their release? That would keep a single source of truth and reduce the amount of work necessary to update the schema as well as reduce the possibility of errors when copying manually.</p>
<p>This approach works in <code>VSCode</code>:</p>
<ul>
<li><code>yaml</code>: <code>YAML</code> extension</li>
<li><code>toml</code>: <code>Even Better TOML</code> extension</li>
<li><code>json</code>: <code>JSON Schema Store Catalog</code> extension</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-15 21:31</div>
            <div class="timeline-body"><p>The issue is that we want autocompletion to work in <code>pyproject.toml</code>, which requires that we reference the <code>ruff.toml</code> schema in the <code>pyproject.toml</code> schema, which in turn requires that both <a href="https://github.com/SchemaStore/schemastore/blob/master/CONTRIBUTING.md#how-to-ref-from-schema_xjson-to-schema_yjson">schemas exist locally in the SchemaStore</a>. We <em>used</em> to link via a URL like that, but then autocompletion would only work in <code>ruff.toml</code> files IIRC. Perhaps I'm misunderstanding though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sasanjac">@sasanjac</a> on 2023-03-16 09:10</div>
            <div class="timeline-body"><p>What tool provides the autocompletion? I have working autocompletion in <code>pyproject.toml</code> with <code>Even Better TOML</code>. You can test it for example with <code>starship.toml</code>. Its schema is also hosted externally, but the it is working fine with autocompletion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-16 15:36</div>
            <div class="timeline-body"><p>There are two pieces to this: first, Ruff's own schema in <a href="https://github.com/SchemaStore/schemastore/blob/c90ae52f68c01de30025adddfe2d46e281a1096a/src/schemas/json/ruff.json#L2">SchemaStore</a>; second, the <code>pyproject.toml</code> schema in <a href="https://github.com/SchemaStore/schemastore/blob/c90ae52f68c01de30025adddfe2d46e281a1096a/src/schemas/json/pyproject.json#L503">SchemaStore</a>.</p>
<p>Ruff's own schema only applies directly to <code>ruff.toml</code> files. The <code>pyproject.toml</code> schema applies to <code>pyproject.toml</code> files. The <code>pyproject.toml</code> file &quot;references&quot; the <code>ruff.toml</code> schema via <code>&quot;$ref&quot;: &quot;https://json.schemastore.org/ruff.json&quot;</code>.</p>
<p>The issue, as I understand it, is that if you want to do this kind of internal linking of schemas, <em>both</em> schema files <em>have</em> to be present in the repo, and <em>cannot</em> be referenced via URL. This works today, because we copy over the schema file to SchemaStore manually. If we try to replace the version in SchemaStore with a URL, tests and checks will fail in SchemaStore, it won't be able to resolve <code>[tool.ruff]</code> within <code>pyproject.toml</code>.</p>
<p>I'd love to be proven wrong, this is based on my understanding and testing, but it was a while ago. I believe that if we try to replace the <code>catalog.json</code> as you've described, CI will fail on SchemaStore (and presumedly it won't work in practice), but I could be mistaken.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
