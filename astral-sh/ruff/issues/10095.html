<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F822 Undefined name in `__all__` does not work in `__init__.py` - astral-sh/ruff #10095</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>F822 Undefined name in `__all__` does not work in `__init__.py`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10095">#10095</a>
        opened by <a href="https://github.com/ilius">@ilius</a>
        on 2024-02-23 12:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ilius">@ilius</a> on 2024-02-23 12:55</div>
            <div class="timeline-body"><p>If you have <code>__all__</code> in a module, and it contains one or more names that are undefined in that module, <code>ruff</code> will tell you about it:</p>
<pre><code>F822 Undefined name `abcd` in `__all__`</code></pre>
<p><strong>Unless that module file is named <code>__init__.py</code>.</strong></p>
<p>To reproduce, simply create a file  <code>__init__.py</code> in a directory / sub-directory, and add:</p>
<pre><code>__all__ = [&quot;abcd&quot;]
</code></pre>
<p>and nothing else.
Run <code>ruff</code> and it gives no error!</p>
<p>Copy that file to another file like <code>test.py</code> and it will give error.</p>
<p>I have tried this in an empty project with no <code>pyproject.toml</code> file, so that doesn't seem to be related.</p>
<pre><code>ruff --version
ruff 0.2.2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "F822 Undefined name in `__all__` does not work in __init__.py" to "F822 Undefined name in `__all__` does not work in `__init__.py`" by @ilius on 2024-02-23 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilius">@ilius</a> on 2024-02-23 13:02</div>
            <div class="timeline-body"><p>Although an unknown name might be the name a module inside that directory!
So maybe ruff also has to check if <code>abcd.py</code> file or <code>abcd</code> directory exists in that directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 14:15</div>
            <div class="timeline-body"><p>Hmm, I'm not sure why this is the case. I see a few checks where we exclude <code>__init__.py</code> files but @charliermarsh has rewritten the logic a couple times which makes it rather challenging to find the origin PR. @charliermarsh do you remember why and when we exclude <code>__init__.py</code> files. We do have <a href="https://docs.astral.sh/ruff/settings/#lint_ignore-init-module-imports">a setting related to init modules</a> but I don't think that one is relevant here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-23 16:15</div>
            <div class="timeline-body"><p>As @ilius mentioned, you can have <code>__init__.py</code> files that look like this: https://github.com/python/cpython/blob/main/Lib/xml/<strong>init</strong>.py. None of the names in <code>__all__</code> there are defined in that file; <code>__all__</code> is being used there to declare submodules of the <code>xml</code> package as public.</p>
<p>If you think this is an antipattern, so do I! At runtime, it has this (bizarre) effect, where <code>*</code> imports work differently (for some reason) to regular imports. I'm not sure why you'd ever actually want this:</p>
<pre><code class="language-pycon">% python                                                                                                                                       ~/dev
Python 3.12.2 (v3.12.2:6abddd9f6a, Feb  6 2024, 17:02:06) [Clang 13.0.0 (clang-1300.0.29.30)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import xml
&gt;&gt;&gt; xml.dom
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module 'xml' has no attribute 'dom'
&gt;&gt;&gt; xml.parsers
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module 'xml' has no attribute 'parsers'
&gt;&gt;&gt; xml.etree
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module 'xml' has no attribute 'etree'
&gt;&gt;&gt; xml.sax
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module 'xml' has no attribute 'sax'
&gt;&gt;&gt; from xml import *
&gt;&gt;&gt; xml.dom
&lt;module 'xml.dom' from '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/xml/dom/__init__.py'&gt;
&gt;&gt;&gt; xml.parsers
&lt;module 'xml.parsers' from '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/xml/parsers/__init__.py'&gt;
&gt;&gt;&gt; xml.etree
&lt;module 'xml.etree' from '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/xml/etree/__init__.py'&gt;
&gt;&gt;&gt; xml.sax
&lt;module 'xml.sax' from '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/xml/sax/__init__.py'&gt;
</code></pre>
<p>It is (sadly) valid Python, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hassec">@hassec</a> on 2024-02-28 01:06</div>
            <div class="timeline-body"><p>I'd argue that the more consistent behaviour would be to have ruff raise a F822 warning for all files, and then one can add an ignore comment for <code>__init__.py</code> files like the one linked @AlexWaygood</p>
<p>That IMHO is the better default as it would create less surprises.</p>
<p>Note that e.g. Pyright follows that approach.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pydata/xarray/pulls/8791.html">pydata/xarray#8791</a> on 2024-02-28 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-12 02:03</div>
            <div class="timeline-body"><p>I kind of agree with @hassec. I'm curious how disruptive this would be to change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11370.html">astral-sh/ruff#11370</a> on 2024-05-11 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-30 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/19740.html">astral-sh/ruff#19740</a> on 2025-08-04 10:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
