<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>providing settings for rules which are not generated should produce a warning - astral-sh/ruff #4266</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>providing settings for rules which are not generated should produce a warning</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4266">#4266</a>
        opened by <a href="https://github.com/joaompinto">@joaompinto</a>
        on 2023-05-07 08:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/joaompinto">@joaompinto</a> on 2023-05-07 08:13</div>
            <div class="timeline-body"><pre><code class="language-toml"># pyproject.toml
[tool.ruff.mccabe]
max-complexity = 1

[tool.flake8]
max-complexity = 1
</code></pre>
<pre><code class="language-python"># test.py
def some_function():
    if 0 &gt; 1:
        print(&quot;1&quot;)
    else:
        print(&quot;2&quot;)
</code></pre>
<pre><code class="language-sh">pip install flake8 Flake8-pyproject ruff

$ ruff test.py
`` 
$ flake8 test.py
test.py:5:1: C901 'some_function' is too complex (2)

$ ruff test.py # No output produced

$ ruff --version
ruff 0.0.265
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-07 13:29</div>
            <div class="timeline-body"><p>Did you enable the C rule set, or C901 specifically? Unlike Flake8 we donâ€™t turn that rule on by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joaompinto">@joaompinto</a> on 2023-05-07 13:49</div>
            <div class="timeline-body"><p>I do not have any experience with rule sets.
How do I &quot;enable the C rule set&quot; ?
In any case if the option itself does not have any effect, should the user not get a warning ? linting the config :) ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-07 13:53</div>
            <div class="timeline-body"><p>There are a couple ways to do it, but they all require specifying some configuration for Ruff. You could run <code>ruff --select C901 test.py</code>, or add a <code>ruff.toml</code> file to your directory with:</p>
<pre><code class="language-toml">select = [&quot;E&quot;, &quot;F&quot;, &quot;C901&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "max-complexity not being checked" to "providing settings for rules which are not generated should produce a warning" by @joaompinto on 2023-05-07 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joaompinto">@joaompinto</a> on 2023-05-07 14:04</div>
            <div class="timeline-body"><p>Thanks, adding the select got me the expected behaivor.
Renamed the bug for covering the case of inneffective settings not being reported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-05-08 01:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-08 01:29</div>
            <div class="timeline-body"><p>I'm uncertain on this, since it's reasonable to configure these settings, but only turn on rules conditionally. E.g., it'd be <em>reasonable</em> to set a <code>max-complexity</code> in your configuration file, but not include <code>C901</code> in that file, and only run that check periodically from the CLI via <code>--select</code>. In which case, the warning would be a false positive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Spectre5">@Spectre5</a> on 2023-05-08 14:55</div>
            <div class="timeline-body"><p>Agreed - if this is added it should be under an optional setting or CLI flag and certainly not the default behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joaompinto">@joaompinto</a> on 2023-05-08 17:19</div>
            <div class="timeline-body"><p>I guess the divergence here is what is the <em>reasonable</em> use case that you want to prioritize.</p>
<p>I see two different reasonable cases:</p>
<ol>
<li>A user like me, that from reading https://beta.ruff.rs/docs/settings/#max-complexity, and not being aware of the &quot;select&quot; filtering expects the corresponding rule to be effectively used - maybe it is just a matter of documentation, and making it clear that that such rule is not set by default ?</li>
<li>A user which is fully aware of selection filters and want's to provide some settings to be activated only under certin selections</li>
</ol>
<p>Anyway, my problem is solved, was just trying to improve for other users that might follow my analisys patttern, feel free to close the issue if found to be unreasonable.</p>
<p>Thanks for developing Ruff and the quick support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-05-09 06:39</div>
            <div class="timeline-body"><p>I think, in the long-term, it would help to move rule-specific settings next to the rule configuration</p>
<p>Instead of having a <code>select</code> configuration and the <code>max-complexity</code> configuration in two entirely different places, move the configuration of the rule next to where we enable the rule:</p>
<pre><code>[tools.ruff.lints]

max-complexity = { level = &quot;error&quot;, limit = 1 }
</code></pre>
<p>I believe that this should help because reading <code> max-complexity = { level = &quot;allow&quot;, limit = 1 }</code> would make it more apparent that you need to enable the rule.</p>
<blockquote>
<p>I'm uncertain on this, since it's reasonable to configure these settings, but only turn on rules conditionally. E.g., it'd be reasonable to set a max-complexity in your configuration file, but not include C901 in that file, and only run that check periodically from the CLI via --select. In which case, the warning would be a false positive.</p>
</blockquote>
<p>Ideally, we should warn about unused configuration (or even disallow it by the schema). That's why I wonder if we could support those use cases by either:</p>
<ul>
<li>Adding a <code>--config</code> CLI option allowing to set any configuration option. This has the downside that the <code>complexity</code> limit is not checked in but it would enable the described workflow</li>
<li>Ask users to commit two configurations, one where the complexity rule is enabled and one where it is not. Then allow them to specify the configuration with <code>--config-path</code>. This may not work well with extended configurations.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-10 21:25</div>
            <div class="timeline-body"><p>I'm going to close this out for now since it's hard to act on given our current model for rules and settings. It may feed into changes we choose to make to our settings representation in the future though, as Micha mentioned above. Thank you :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-01-10 21:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
