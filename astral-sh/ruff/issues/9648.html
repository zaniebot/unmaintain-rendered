<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 false positive in notebook when using magic command as variables - astral-sh/ruff #9648</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>F821 false positive in notebook when using magic command as variables</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/9648">#9648</a>
        opened by <a href="https://github.com/mathause">@mathause</a>
        on 2024-01-26 14:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mathause">@mathause</a> on 2024-01-26 14:14</div>
            <div class="timeline-body"><p>ruff gives false positives for F821 (Undefined name) in notebooks when using magic command as variables. Ok, this is <em>very</em> specific and potentially related to #9644.</p>
<p>In a jupyter notebook when defining a variable which has the same name as a ipython magic command and using this variable in a following cell and not as the first command triggers F821 (wrongly).</p>
<p>Only classify magic commands as magic if they are preceded with a <code>%</code>?</p>
<p><strong>command</strong></p>
<pre><code class="language-bash">ruff check --no-cache --select F821 test.ipynb
</code></pre>
<p><strong>version</strong></p>
<pre><code>ruff --version
ruff 0.1.14
</code></pre>
<p><strong>MVCE</strong></p>
<p>(I am not sure how to create a MVCE for a jupyter notebook, but I guess it's easy enough...)</p>
<p><img src="https://github.com/astral-sh/ruff/assets/10194086/b81030dd-fd97-4369-912b-b336b699923b" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-26 14:21</div>
            <div class="timeline-body"><p>Yeah we can probably improve our heuristics here to specifically detect assignments. The automagics are actually really complicated because it means that (in general) cells may or may not be unsafe depending on the order of their execution (which we can't know). For example: https://github.com/astral-sh/ruff/pull/8398#issuecomment-1790345709.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-26 14:23</div>
            <div class="timeline-body"><p>I'll try to fix this specific case today :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-01-26 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-26 14:24</div>
            <div class="timeline-body"><p>But I need to audit the list of automagics which I dread :joy:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-01-26 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9653.html">astral-sh/ruff#9653</a> on 2024-01-26 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-26 16:39</div>
            <div class="timeline-body"><p>Fixed in https://github.com/astral-sh/ruff/pull/9653.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-01-29 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mathause">@mathause</a> on 2024-01-29 13:00</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-29 13:44</div>
            <div class="timeline-body"><p>Of course! If you see more of these, let us know, since we have to rely on some heuristics for this given the flexibility of notebooks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9644.html">astral-sh/ruff#9644</a> on 2024-01-30 07:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
