<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[verbose-decimal-constructor (FURB157)] doesn't trigger on `Decimal(&quot;1_000&quot;)` - astral-sh/ruff #13807</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[verbose-decimal-constructor (FURB157)] doesn&#x27;t trigger on <code>Decimal(&quot;1_000&quot;)</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13807">#13807</a>
        opened by <a href="https://github.com/monosans">@monosans</a>
        on 2024-10-18 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/monosans">@monosans</a></div>
            <div class="timeline-body">

<pre><code>Decimal(1000)  # OK
Decimal(1_000)  # OK
Decimal(&quot;1000&quot;)  # Triggers FURB157
Decimal(&quot;1_000&quot;)  # Should trigger FURB157 and become Decimal(1_000), but it doesn&#x27;t
</code></pre>
<p>ruff v0.7.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:32</div>
            <div class="timeline-body"><p>It seems like the parsing we do here is too naive: https://github.com/astral-sh/ruff/blob/4ecfe95295eb203ba771f344f52c8e61527a4c05/crates/ruff_linter/src/rules/refurb/rules/verbose_decimal_constructor.rs#L77-L98</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:42</div>
            <div class="timeline-body"><p>If there are more edge cases that we don&#x27;t handle, it might be worth just using <code>ruff_python_parser::parse_expression</code> to determine if the contents of the string can be parsed as an <code>int</code> literal, rather than reimplementing all the edge cases in the linter. If this is the only edge case we don&#x27;t currently handle, however, it may be best to avoid doing that and just reimplement the logic in the linter -- using the <code>ruff_python_parser</code> function might be comparatively quite expensive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2024-10-18 15:02</div>
            <div class="timeline-body"><p><code>Decimal</code> accepts more integer-valued strings than are valid as <code>int</code> literals. For example, <code>Decimal(&quot;1__2&quot;)</code> and <code>Decimal(&quot;_1_&quot;)</code> and <code>Decimal(&quot;١٢٣&quot;)</code> are valid. Should FURB157 trigger on those? If so, <code>ruff_python_parser::parse_expression</code> would not be enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-10-19 03:48</div>
            <div class="timeline-body"><p>Looks like this is the official regex:</p>
<p>https://github.com/python/cpython/blob/322f14eeff9e3b5853eaac3233f7580ca0214cf8/Lib/_pydecimal.py#L6059-L6077</p>
<p>I can try to take this sometime this weekend (but if I don&#x27;t, others should feel free to go for it!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/dylwil3">@dylwil3</a> by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-03 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-05 19:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/m-aciek">@m-aciek</a> on 2025-09-25 08:26</div>
            <div class="timeline-body"><p>The fix in latest ruff (v0.13.1) converts <code>Decimal(&quot;1_000&quot;)</code> to <code>Decimal(1000)</code> instead of to <code>Decimal(1_000)</code>.</p>
<p>It becomes more problematic for bigger values, where thousand formatting really helps to read a number, like <code>Decimal(15_000_000)</code>.</p>
<p>Can the issue be reopened?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:59 UTC
    </footer>
</body>
</html>
