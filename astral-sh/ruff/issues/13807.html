<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[verbose-decimal-constructor (FURB157)] doesn't trigger on `Decimal(&quot;1_000&quot;)` - astral-sh/ruff #13807</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[verbose-decimal-constructor (FURB157)] doesn't trigger on `Decimal(&quot;1_000&quot;)`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13807">#13807</a>
        opened by <a href="https://github.com/monosans">@monosans</a>
        on 2024-10-18 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/monosans">@monosans</a> on 2024-10-18 09:24</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<pre><code class="language-python">Decimal(1000)  # OK
Decimal(1_000)  # OK
Decimal(&quot;1000&quot;)  # Triggers FURB157
Decimal(&quot;1_000&quot;)  # Should trigger FURB157 and become Decimal(1_000), but it doesn't
</code></pre>
<p>ruff v0.7.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:32</div>
            <div class="timeline-body"><p>It seems like the parsing we do here is too naive: https://github.com/astral-sh/ruff/blob/4ecfe95295eb203ba771f344f52c8e61527a4c05/crates/ruff_linter/src/rules/refurb/rules/verbose_decimal_constructor.rs#L77-L98</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-10-18 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @AlexWaygood on 2024-10-18 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @AlexWaygood on 2024-10-18 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:42</div>
            <div class="timeline-body"><p>If there are more edge cases that we don't handle, it might be worth just using <code>ruff_python_parser::parse_expression</code> to determine if the contents of the string can be parsed as an <code>int</code> literal, rather than reimplementing all the edge cases in the linter. If this is the only edge case we don't currently handle, however, it may be best to avoid doing that and just reimplement the logic in the linter -- using the <code>ruff_python_parser</code> function might be comparatively quite expensive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2024-10-18 15:02</div>
            <div class="timeline-body"><p><code>Decimal</code> accepts more integer-valued strings than are valid as <code>int</code> literals. For example, <code>Decimal(&quot;1__2&quot;)</code> and <code>Decimal(&quot;_1_&quot;)</code> and <code>Decimal(&quot;١٢٣&quot;)</code> are valid. Should FURB157 trigger on those? If so, <code>ruff_python_parser::parse_expression</code> would not be enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-10-19 03:48</div>
            <div class="timeline-body"><p>Looks like this is the official regex:</p>
<p>https://github.com/python/cpython/blob/322f14eeff9e3b5853eaac3233f7580ca0214cf8/Lib/_pydecimal.py#L6059-L6077</p>
<p>I can try to take this sometime this weekend (but if I don't, others should feel free to go for it!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dylwil3 by @dylwil3 on 2024-11-03 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14098.html">astral-sh/ruff#14098</a> on 2024-11-04 23:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2024-11-05 19:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/m-aciek">@m-aciek</a> on 2025-09-25 08:26</div>
            <div class="timeline-body"><p>The fix in latest ruff (v0.13.1) converts <code>Decimal(&quot;1_000&quot;)</code> to <code>Decimal(1000)</code> instead of to <code>Decimal(1_000)</code>.</p>
<p>It becomes more problematic for bigger values, where thousand formatting really helps to read a number, like <code>Decimal(15_000_000)</code>.</p>
<p>Can the issue be reopened?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20572.html">astral-sh/ruff#20572</a> on 2025-09-25 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20588.html">astral-sh/ruff#20588</a> on 2025-09-30 20:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
