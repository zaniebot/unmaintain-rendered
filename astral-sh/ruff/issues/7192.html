<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W505 not reported AND stripped - astral-sh/ruff #7192</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>W505 not reported AND stripped</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7192">#7192</a>
        opened by <a href="https://github.com/RivenSkaye">@RivenSkaye</a>
        on 2023-09-06 14:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/RivenSkaye">@RivenSkaye</a> on 2023-09-06 14:04</div>
            <div class="timeline-body"><p>W505 does not trigger for a multiline docstring that is too long, the relevant <code>noqa</code> added for <code>flake8</code> gets stripped off and it seems impossible to apply any <code>noqa</code> on multiline docstrings as a whole. <a href="https://github.com/RivenSkaye/rvsfunc/blob/34028dcdf33fc1f19f77ae033588e85d6b936def/rvsfunc/utils.py#L215-L237">This is the code I noticed it on</a> after adding Ruff to the project. Either my <code>ruff.toml</code> is causing it to be skipped through some other matching rule, or I've hit a bug.</p>
<p>Minimal <code>ruff.toml</code>:</p>
<pre><code class="language-toml">select = [&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;RUF&quot;, &quot;W&quot;]
line-length = 85
[pycodestyle]
max-doc-length = 85
</code></pre>
<p>Code example:</p>
<pre><code class="language-py">from typing import Union

def somefunc(
    a: int, b: float, c: str,
    d: Union[list, dict], e: bool
) -&gt; int:
    &quot;&quot;&quot;
    This docstring will go out of bounds

    a:                  sxedc5rfvtgbyhnujmi8k,ol.p;/123456789/*-+.
                        `vsutil.Range &lt;http://vsutil.encode.moe/en/latest/api.html#vsutil.Range&gt;`_
    b:                  x
    c:                  x
    d:                  x
    e:                  x
    &quot;&quot;&quot;
</code></pre>
<p>This happens both with and without <code>--isolated</code>, running only <code>ruff . --fix</code>
‚ùØ ruff --version
ruff 0.0.287</p>
<p>In case I missed something, the full ruff config used is attached with a suffix to make GH accept the upload.
<a href="https://github.com/astral-sh/ruff/files/12538226/ruff.toml.txt">ruff.toml.txt</a></p>
<p>Temporary solution for me is to mark <code>RUF100</code> as unfixable so it doesn't break flake8 runs upon re-adding the <code>noqa</code> directives, as I use flake8 plugins not (yet) implemented in Ruff, like rst-docstrings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-06 14:10</div>
            <div class="timeline-body"><p>Hi!</p>
<p>The reason a violation for W505 is not raised there is covered in the documentation</p>
<p>https://github.com/astral-sh/ruff/blob/005e21a139ac2518887548a529688daaded15a54/crates/ruff/src/rules/pycodestyle/rules/doc_line_too_long.rs#L21-L25</p>
<p>The proper way to use noqa for a multiline docstring is discussed in <a href="https://github.com/astral-sh/ruff/discussions/7011#discussioncomment-6869239">#7011 </a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2023-09-06 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RivenSkaye">@RivenSkaye</a> on 2023-09-06 14:14</div>
            <div class="timeline-body"><p>The old code <em>had</em> the <code>noqa: W505</code> behind the closing quotes on the docstring, which was stripped. And unless there is some special handling for the rST <code>`link directive &lt;https://example.com&gt;`_</code>, it should definitely be seeing whitespace in the line. I'll edit the example to include said directive, as I can see this being somewhat faulty for an example.</p>
<p>Unless this, for some reason, treats <code>&gt;`_</code> as valid URL components. They're not valid characters and should be percent encoded, but I'd understand that being out of scope for a Python parser</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-06 16:07</div>
            <div class="timeline-body"><p>Yeah if W505 is not raised then the noqa comment will be removed.</p>
<p>It is not being raised because of the URL. If you replace the URL with &quot;x&quot;s then the violation is raised as you'd expect. We do not use comprehensive validation for a URL</p>
<p>https://github.com/astral-sh/ruff/blob/e6158706590fd31ac6388ddc17495480c7fd0265/crates/ruff/src/rules/pycodestyle/helpers.rs#L97</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-26 01:58</div>
            <div class="timeline-body"><p>I think this is working as intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-26 01:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:10 UTC
    </footer>
</body>
</html>
