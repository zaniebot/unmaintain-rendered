<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter panic with empty attribute inner comment - astral-sh/ruff #6181</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter panic with empty attribute inner comment</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6181">#6181</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-07-30 14:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2023-07-30 14:27</div>
            <div class="timeline-body"><p>The following snippet causes the formatter to panic:</p>
<pre><code class="language-python">(#
()).a
</code></pre>
<p>There is not preceding node nor is the comment after the value range, since the comment is ahead of the value range, while the code was writing in the assumption that comments are either leading comments of the entire attribute expression or are after the value, not considering this odd parentheses case.</p>
<pre><code>thread 'main' panicked at 'The enclosing node an attribute expression, expected to be at least after the name', crates/ruff_python_formatter/src/comments/placement.rs:934:5
stack backtrace:
   0: rust_begin_unwind
             at /rustc/90c541806f23a127002de5b4038be731ba1458ca/library/std/src/panicking.rs:578:5
   1: core::panicking::panic_fmt
             at /rustc/90c541806f23a127002de5b4038be731ba1458ca/library/core/src/panicking.rs:67:14
   2: ruff_python_formatter::comments::placement::handle_attribute_comment
             at ./crates/ruff_python_formatter/src/comments/placement.rs:934:5
   3: ruff_python_formatter::comments::placement::place_comment
             at ./crates/ruff_python_formatter/src/comments/placement.rs:53:49
   4: ruff_python_formatter::comments::visitor::CommentsVisitor::start_node_impl
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:80:38
   5: ruff_python_formatter::comments::visitor::CommentsVisitor::start_node
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:54:9
   6: &lt;ruff_python_formatter::comments::visitor::CommentsVisitor as ruff_python_ast::visitor::preorder::PreorderVisitor&gt;::visit_expr
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:205:12
   7: ruff_python_ast::visitor::preorder::walk_expr
             at ./crates/ruff_python_ast/src/visitor/preorder.rs:665:13
   8: &lt;ruff_python_formatter::comments::visitor::CommentsVisitor as ruff_python_ast::visitor::preorder::PreorderVisitor&gt;::visit_expr
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:206:13
   9: ruff_python_ast::visitor::preorder::walk_stmt
             at ./crates/ruff_python_ast/src/visitor/preorder.rs:156:15
  10: &lt;ruff_python_formatter::comments::visitor::CommentsVisitor as ruff_python_ast::visitor::preorder::PreorderVisitor&gt;::visit_stmt
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:185:13
  11: &lt;ruff_python_formatter::comments::visitor::CommentsVisitor as ruff_python_ast::visitor::preorder::PreorderVisitor&gt;::visit_body
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:168:23
  12: ruff_python_ast::visitor::preorder::walk_module
             at ./crates/ruff_python_ast/src/visitor/preorder.rs:118:13
  13: &lt;ruff_python_formatter::comments::visitor::CommentsVisitor as ruff_python_ast::visitor::preorder::PreorderVisitor&gt;::visit_mod
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:158:13
  14: ruff_python_formatter::comments::visitor::CommentsVisitor::visit
             at ./crates/ruff_python_formatter/src/comments/visitor.rs:45:9
  15: ruff_python_formatter::comments::Comments::from_ast
             at ./crates/ruff_python_formatter/src/comments/mod.rs:265:13
  16: ruff_python_formatter::format_node
             at ./crates/ruff_python_formatter/src/lib.rs:148:20
  17: ruff_python_formatter::cli::format_and_debug_print
             at ./crates/ruff_python_formatter/src/cli.rs:60:21
  18: ruff_python_formatter::main
             at ./crates/ruff_python_formatter/src/main.rs:40:29
  19: core::ops::function::FnOnce::call_once
             at /rustc/90c541806f23a127002de5b4038be731ba1458ca/library/core/src/ops/function.rs:250:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2023-07-30 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-07-30 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2023-07-31 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-07-31 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-08-04 09:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:51 UTC
    </footer>
</body>
</html>
