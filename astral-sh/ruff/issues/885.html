<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to build wheel on FreeBSD - astral-sh/ruff #885</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to build wheel on FreeBSD</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/885">#885</a>
        opened by <a href="https://github.com/hhartzer">@hhartzer</a>
        on 2022-11-23 03:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hhartzer">@hhartzer</a> on 2022-11-23 03:29</div>
            <div class="timeline-body"><p>This looks awesome and I am really excited to try it out. However, I'm using FreeBSD so I have to build my own wheels.</p>
<p>I got this error when building the wheel with <code>pip install</code>:</p>
<pre><code>         Compiling update-informer v0.5.0
         Compiling rustpython-parser v0.1.2 (https://github.com/RustPython/RustPython.git?rev=f885db8c61514f069979861f6b3bd83292086231#f885db8c)
      error: could not compile `rustpython-parser` due to 3 previous errors
      warning: build failed, waiting for other jobs to finish...
      üí• maturin failed
        Caused by: Failed to build a native library through cargo
        Caused by: Cargo build finished with &quot;exit status: 101&quot;: `&quot;cargo&quot; &quot;rustc&quot; &quot;--release&quot; &quot;--manifest-path&quot; &quot;/tmp/pip-install-tg6ervfc/ruff_3df4680c1987441aa387abf9fda1d11d/Cargo.toml&quot; &quot;--message-format&quot; &quot;json&quot; &quot;--bin&quot; &quot;ruff&quot; &quot;--&quot; &quot;-C&quot; &quot;link-arg=-s&quot;`
      üì¶ Including license file &quot;/tmp/pip-install-tg6ervfc/ruff_3df4680c1987441aa387abf9fda1d11d/LICENSE&quot;
      üçπ Building a mixed python/rust project
      üîó Found bin bindings
      error[E0658]: `let...else` statements are unstable
        --&gt; /root/.cargo/git/checkouts/rustpython-f8ef4d934ac33cd8/f885db8/compiler/parser/build.rs:20:5
         |
      20 | /     let Ok(target) = File::open(target) else {
      21 | |         return Some(&quot;python.rs doesn't exist. regenerate.&quot;.to_owned());
      22 | |     };
         | |______^
         |
         = note: see issue #87335 &lt;https://github.com/rust-lang/rust/issues/87335&gt; for more information


      error[E0658]: `let...else` statements are unstable
        --&gt; /root/.cargo/git/checkouts/rustpython-f8ef4d934ac33cd8/f885db8/compiler/parser/build.rs:72:5
         |
      72 | /     let Some(_message) = requires_lalrpop(source, target) else {
      73 | |         return Ok(());
      74 | |     };
         | |______^
         |
         = note: see issue #87335 &lt;https://github.com/rust-lang/rust/issues/87335&gt; for more information


      error: aborting due to 2 previous errors


      For more information about this error, try `rustc --explain E0658`.

      Error: command ['maturin', 'pep517', 'build-wheel', '-i', '/root/tmp/venv3.9/bin/python3.9', '--compatibility', 'off'] returned non-zero exit status 1
      [end of output]

  note: This error originates from a subprocess, and is likely not a problem with pip.
  ERROR: Failed building wheel for ruff
Failed to build ruff
ERROR: Could not build wheels for ruff, which is required to install pyproject.toml-based projects
</code></pre>
<p>Seems like it could be a bug in rustpython-parser. It mentions https://github.com/rust-lang/rust/issues/87335</p>
<p>Is there anything I should try with this? Should I open an upstream bug? Not well versed in Rust, unfortunately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-23 03:33</div>
            <div class="timeline-body"><p>Thanks! Sorry for the trouble. Can you check what version of Rust you have? (It should be <code>rustup show</code>.)</p>
<p>Separately, do you know what's required to build wheels for FreeBSD? I'm really not familiar but I'm happy to support it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hhartzer">@hhartzer</a> on 2022-11-23 03:53</div>
            <div class="timeline-body"><p>I appreciate your fast response!</p>
<p>I actually don't have <code>rustup</code>, but my rust version appears to be 1.64.0 from the package's version and rustc's <code>--version</code> output. I don't know if that's a bit out of date or not.</p>
<p>As for FreeBSD wheels, I haven't done that before. I don't see any mention of FreeBSD with cross compiling for Maturin, nor issues on the topic. It may be possible though to use <a href="https://cirrus-ci.org/">Cirrus CI</a> as it can launch macOS and FreeBSD VMs. I know with go, cross-compilation is really simple, but I imagine with rust that may not be the case. If I find out more on this, I'll let you know! I don't think FreeBSD wheels are terribly common, unfortunately.</p>
<p>Even cryptography doesn't have FreeBSD wheels: https://pypi.org/project/cryptography/#files</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hhartzer">@hhartzer</a> on 2022-11-23 03:59</div>
            <div class="timeline-body"><p>I'm starting to think that I need 1.65. 1.65 is incoming for FreeBSD (already in ports), but will probably take a couple more days to build.</p>
<p>https://blog.rust-lang.org/2022/11/03/Rust-1.65.0.html#let-else-statements</p>
<p>This is good to know, although surprising to me that such a newly released language feature would be used already, a couple weeks later. In the Python world there's usually a fairly lengthy EOL lifetime (maybe too long!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-23 04:07</div>
            <div class="timeline-body"><p>Ah ok! Yeah, it looks like RustPython is now using some 1.65 language features. (1.65 recently reached the &quot;stable&quot; channel so it's fair game.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-23 04:08</div>
            <div class="timeline-body"><p>You could try <code>pip install ruff==0.0.132</code> (I upgraded RustPython in 0.0.133, and it's possible that the older version was compilable under 1.64, I'm not 100% sure!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2022-11-23 04:13</div>
            <div class="timeline-body"><blockquote>
<p>Even cryptography doesn't have FreeBSD wheels</p>
</blockquote>
<p>pypi doesn't allow uploading wheels besides Linux, macOS and Windows at the moment.</p>
<p>https://github.com/pypi/warehouse/blob/683e578c55af527e79d7941670eb61b69cb37865/warehouse/forklift/legacy.py#L79-L147</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2022-11-23 04:15</div>
            <div class="timeline-body"><p>@charliermarsh Consider set <code>rust-version</code> in Cargo.toml to produce a better error message in this case.</p>
<p>https://doc.rust-lang.org/cargo/reference/manifest.html#the-rust-version-field</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/886.html">astral-sh/ruff#886</a> on 2022-11-23 04:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hhartzer">@hhartzer</a> on 2022-11-23 04:19</div>
            <div class="timeline-body"><p>Thank you! I'm actually going to give rust 165.0 a try via <code>rustup</code>. Will report back.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2022-11-23 04:23</div>
            <div class="timeline-body"><p>BTW, Cirrus CI is good choice for testing FreeBSD, and it even supports arm64 macOS and Linux, we use it in maturin: https://github.com/PyO3/maturin/blob/main/.cirrus.yml</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-23 04:24</div>
            <div class="timeline-body"><p>Every time @messense chimes in I learn a bunch of good stuff, thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hhartzer">@hhartzer</a> on 2022-11-23 05:46</div>
            <div class="timeline-body"><p><code>ruff</code> builds and seems to run! Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @hhartzer on 2022-11-23 05:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chriswells0">@chriswells0</a> on 2023-11-29 18:54</div>
            <div class="timeline-body"><p>@hhartzer Would you mind sharing the steps you used to build it? I don't see <code>rustup</code> in ports, and I'm not familiar with it at all. I mostly don't want to dig into it if that wasn't the final solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hhartzer">@hhartzer</a> on 2023-12-01 03:11</div>
            <div class="timeline-body"><blockquote>
<p>@hhartzer Would you mind sharing the steps you used to build it? I don't see <code>rustup</code> in ports, and I'm not familiar with it at all. I mostly don't want to dig into it if that wasn't the final solution.</p>
</blockquote>
<p>I think because the rust version was too old, I fetched rustup in this manner: https://forge.rust-lang.org/infra/other-installation-methods.html#rustup</p>
<p>But the rust version in ports may be current enough now to install just via <code>pip</code> if you also have rust installed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../apache/arrow/issues/40776.html">apache/arrow#40776</a> on 2024-03-26 11:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:03 UTC
    </footer>
</body>
</html>
