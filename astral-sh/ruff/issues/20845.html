<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reduce size of WASM builds - astral-sh/ruff #20845</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reduce size of WASM builds</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/20845">#20845</a>
        opened by <a href="https://github.com/AbdealiLoKo">@AbdealiLoKo</a>
        on 2025-10-13 14:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AbdealiLoKo">@AbdealiLoKo</a> on 2025-10-13 14:21</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hi, I've been actively following and using the experimental version of ruff-wasm-web
https://www.npmjs.com/package/@astral-sh/ruff-wasm-web</p>
<p>I noticed a large change in the wasm bundle size recently:
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.9.0">0.9.0</a> -&gt; 8.84 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.9.10">0.9.10</a> -&gt; 9.06 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.10.0">0.10.0</a> -&gt; 9.07 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.11.0">0.11.0</a> -&gt; 9.06 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.11.13">0.11.13</a> -&gt; 9.17 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.12.0">0.12.0</a> -&gt; 9.23 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.12.4">0.12.4</a> -&gt; 9.30 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.12.5">0.12.5</a> -&gt; <strong>12.8 MB</strong>
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.12.12">0.12.12</a> -&gt; 13.3 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.13.0">0.13.0</a> -&gt; 13.4 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.13.4">0.13.4</a> -&gt; 13.9 MB
<a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-web/v/0.14.0">0.14.0</a> -&gt; 13.9 MB</p>
<p>8.84 MB -&gt; 13.9 MB is nearly a 57% increase in bundle size</p>
<p>Just checking to see if this is expected ? For a browser, 8 MB is already considered large, and 14MB seemed to be surprising</p>
<p>Are there some suggestions or so to reduce the file size for the browser based wasm ?</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @AbdealiLoKo on 2025-10-13 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-13 14:39</div>
            <div class="timeline-body"><p>I only checked a few of these, but this roughly seems to match the trend in our release  binary size. We may need to take a look at this. Thanks for the report!</p>
<p>| Release | Size (MiB) |
|--------|--------|
| 0.9.0 | 37.4 |
| 0.12.0 | 43.3 |
| 0.14.0 | 51.3 |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-13 17:35</div>
            <div class="timeline-body"><p>I suspect that this might be largely due to depending on <code>ty_python_semantic</code> for <code>ruff analyze</code>. We could consider gating the <code>analyze</code> dependency option but this tends to be very annoying.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-13 17:38</div>
            <div class="timeline-body"><p>It seems that https://github.com/salsa-rs/salsa/pull/934 caused a significant size increase. Not necessarily what I would have expected, unless rustc is now able to do some more inlining. @ibraheemdev is this expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-14 12:37</div>
            <div class="timeline-body"><p>I asked claude to do some investigation and the finding is:</p>
<blockquote>
<p>The 3MB size increase (20MB vs 17MB) is entirely due to symbol table bloat in the __LINKEDIT ?&gt; segment:</p>
<p>Key Findings:</p>
<ol>
<li>Symbol count explosion:
- New binary: 46,133 symbols (3,079 exported)
- Old binary: 152 symbols (1 exported)</li>
<li>LINKEDIT segment growth:
- New binary: 3,965,680 bytes (~3.8 MB)
- Old binary: 404,816 bytes (~395 KB)
- Difference: ~3.56 MB (matches the total size increase)</li>
<li>The TEXT segment is actually smaller in the new binary (16.7MB vs 17MB), so the code itself hasn't grown.</li>
</ol>
</blockquote>
<p>These are all the newly exported symobls that don't get stripped even when using `stirp= &quot;symbols&quot;</p>
<p>https://gist.github.com/MichaReiser/2321249a9a4f71f185f84630fbe7d628</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-14 12:53</div>
            <div class="timeline-body"><p>Using LTO=&quot;fat&quot; reduces the binary by 3mb again</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20863.html">astral-sh/ruff#20863</a> on 2025-10-14 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-10-15 07:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-15 09:28</div>
            <div class="timeline-body"><p>Turns out, that https://github.com/astral-sh/ruff/pull/20863 didn't help the WASM build (because WASM uses wasm-opt?).</p>
<p>Optimizing the WASM binary size isn't a priority for us right now. But happy to accept any contribution that optimies our wasm build.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @MichaReiser on 2025-10-15 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @MichaReiser on 2025-10-15 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2025-10-15 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Size of ruff-wasm-web - increase by 57% over the past 9 months" to "Reduce size of WASM builds" by @MichaReiser on 2025-10-15 09:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
