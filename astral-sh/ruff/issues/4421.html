<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rules/Request:  Airflow DAGs checks - astral-sh/ruff #4421</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rules/Request:  Airflow DAGs checks</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4421">#4421</a>
        opened by <a href="https://github.com/brucearctor">@brucearctor</a>
        on 2023-05-13 20:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/brucearctor">@brucearctor</a></div>
            <div class="timeline-body"><p>There are numerous problems that could go wrong with an Airflow DAG, ex:</p>
<ul>
<li>Duplicate DAG name</li>
<li>Duplicate Task ID</li>
<li>Duplicate Task Dependency</li>
<li>Task without DAG</li>
<li>No Cycles [ DAG should be acyclic ]</li>
<li>etc ...</li>
</ul>
<p>Seems like we might want new rules that could be used to detect these things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-17 09:50</div>
            <div class="timeline-body"><p>The rules defined in https://github.com/BasPH/pylint-airflow seem to cover all those cases plus a bit more. Would a port of that Pylint plugin be a good start?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-17 15:06</div>
            <div class="timeline-body"><p>I&#x27;d had some discussion with @jlaneve on Twitter about this! I&#x27;d like to support Airflow-specific rules, but we need guidance on what those rules should contain.</p>
<p>@jlaneve -- any further thoughts here? Is the pylint-airflow plugin a good starting point?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-17 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jlaneve">@jlaneve</a> on 2023-05-17 15:25</div>
            <div class="timeline-body"><p>Bas&#x27; pylint-airflow is definitely a good start, but worth noting it was designed for Airflow 1.x and we should aim to get ruff supporting Airflow 2.x, so there are likely a few changes we&#x27;ll want to make. Maybe I can open a draft PR with a few of the easy rules (no duplicate DAG names, no empty DAGs, etc) to get <em>something</em> going, and then we can open issues for specific rules afterwards?</p>
<p>@charliermarsh - what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-17 15:29</div>
            <div class="timeline-body"><p>@jlaneve - Yeah, that&#x27;s perfect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brucearctor">@brucearctor</a> on 2023-05-17 15:34</div>
            <div class="timeline-body"><p>Exactly - I had seen <code>pylint-airflow</code>, that covers lots of the ideal rules.  V2 Airflow is the thing to target, and imagine even ignoring V1 [ for ruff ] is OK.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-10 01:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fritz-astronomer">@fritz-astronomer</a> on 2023-08-04 21:52</div>
            <div class="timeline-body"><p>https://docs.astronomer.io/learn/dag-best-practices
https://airflow.apache.org/docs/apache-airflow/stable/faq.html
https://airflow.apache.org/docs/apache-airflow/stable/best-practices.html</p>
<p>Some opinionated options (which could certainly be contentious):</p>
<ul>
<li>not mixing <code>with DAG</code> and <code>@dag</code> in the same repo</li>
<li>DAGs having <code>owners</code></li>
<li>remove <code>DAG as dag</code> if airflow&gt;X.Y</li>
<li>remove <code>globals()[dag_id] = dag</code> if airflow&gt;x.y</li>
<li>Some way to check for top level code? That&#x27;d probably be really tricky<ul>
<li>avoid top-level variable.get</li>
</ul>
</li>
<li><code>dag_id</code> is the same as the filename</li>
<li><code>start_date</code> is a static datetime</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fritz-astronomer">@fritz-astronomer</a> on 2023-08-04 21:53</div>
            <div class="timeline-body"><p>Some Astronomer folks might be able to help development :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daniel-bartley">@daniel-bartley</a> on 2024-01-19 06:06</div>
            <div class="timeline-body"><p>Is there a roadmap timeline for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/usethia">@usethia</a> on 2024-04-03 19:32</div>
            <div class="timeline-body"><p>what essentially makes the difference between ruff check vs ruff lint
lint gives out this error which doesn&#x27;t seem to get resolved.
lint:1:1: E902 No such file or directory (os error 2)
any reason?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-04 07:56</div>
            <div class="timeline-body"><p>@usethia your question seems unrelated to this issue. I&#x27;ll reply anyway but please open a new issue if you need more help to avoid sidetracking this issue.</p>
<p><code>ruff lint</code> isn&#x27;t a Ruff command. Today <code>ruff &lt;path&gt;</code> is an alias for <code>ruff check &lt;path&gt;</code>. So the command <code>ruff lint</code> is the same as <code>ruff check lint</code> but you don&#x27;t have a file or directory called <code>lint</code> in your project. We&#x27;re about to remove the alias in the next minor version of Ruff because it can be confusing (as in your case).</p>
<p>To lint your project, run <code>ruff check</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yehoshuadimarsky">@yehoshuadimarsky</a> on 2024-08-11 23:36</div>
            <div class="timeline-body"><p>Hi, I&#x27;m a longtime user (and contributor) of Airflow, and brand new to Rust, I&#x27;d love to get my feet wet in Rust. I thought a great place to start would be to implement some rules for Airflow for Ruff. I&#x27;d love to give at least one of these a shot. Did a quick search of &quot;airflow&quot; in the Issues and found this.</p>
<p>I&#x27;ll try to open my first PR soon-ish for a simple Airflow rule - I&#x27;m thinking of the following:</p>
<p>If using Taskflow <code>@dag</code> or <code>@task</code> decorators, then make sure to also actually invoke the function afterwards. Personally I&#x27;ve done this way too many times, where I&#x27;ve written a Dag/Task and wondered why it isn&#x27;t showing up in the UI, only to realized I never called it.</p>
<p>Bad:</p>
<pre><code># file.py
from airflow.decorators import dag, task

@dag
def my_dag():
    ....
</code></pre>
<p>Good:</p>
<pre><code># file.py
from airflow.decorators import dag, task

@dag
def my_dag():
    ....

my_dag()
</code></pre>
<p>Let me know if anyone objects, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brucearctor">@brucearctor</a> on 2024-08-12 01:24</div>
            <div class="timeline-body"><p>@yehoshuadimarsky -- sounds great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jlaneve">@jlaneve</a> on 2024-08-12 03:00</div>
            <div class="timeline-body"><p>We do have this that you can extend on - I started building it out but unfortunately don&#x27;t have much free time!</p>
<p>https://github.com/astral-sh/ruff/tree/main/crates/ruff_linter/src/rules/airflow</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dbrtly">@dbrtly</a> on 2024-08-13 12:16</div>
            <div class="timeline-body"><p>üëè üëè
Airflow has so many stylistic variations. Do you do mostly dynamic dags?  The teams I&#x27;ve been on do a different pattern so I wouldn&#x27;t benefit from that particular rule but any progress is good. An dag loader lint rule would be very cool.</p>
<p>`from airflow import DAG</p>
<p>with DAG(...):</p>
<pre><code>my_task = SomeOperator(...)</code></pre>
<p>`</p>
<p>The prior art links:</p>
<p>https://pypi.org/project/pylint-airflow/
https://github.com/feluelle/airflint
all the Marc Lamberti blog posts where he says &quot;migrate from pattern x to pattern y&quot;</p>
<p>Code | Symbol | Description
-- | -- | --
C8300 | different-operator-varname-taskid | For consistency assign the same variable name and task_id to operators.
C8301 | match-callable-taskid | For consistency name the callable function ‚Äò_[task_id]‚Äô, e.g. PythonOperator(task_id=‚Äômytask‚Äô, python_callable=_mytask).
C8302 | mixed-dependency-directions | For consistency don‚Äôt mix directions in a single statement, instead split over multiple statements.
C8303 | task-no-dependencies | Sometimes a task without any dependency is desired, however often it is the result of a forgotten dependency.
C8304 | task-context-argname | Indicate you expect Airflow task context variables in the **kwargs argument by renaming to **context.
C8305 | task-context-separate-arg | To avoid unpacking kwargs from the Airflow task context in a function, you can set the needed variables as arguments in the function.
C8306 | match-dagid-filename | For consistency match the DAG filename with the dag_id.
R8300 | unused-xcom | Return values from a python_callable function or execute() method are automatically pushed as XCom.
W8300 | basehook-top-level | Airflow executes DAG scripts periodically and anything at the top level of a script is executed. Therefore, move BaseHook calls into functions/hooks/operators.
E8300 | duplicate-dag-name | DAG name should be unique.
E8301 | duplicate-task-name | Task name within a DAG should be unique.
E8302 | duplicate-dependency | Task dependencies can be defined only once.
E8303 | dag-with-cycles | A DAG is acyclic and cannot contain cycles.
E8304 | task-no-dag | A task must know a DAG instance to run.</p>
<p>Use function-level imports instead of top-level imports<a href="https://github.com/feluelle/airflint#user-content-fn-1-4997c1131936f3fbe41f5cf4bbf268cd">1</a><a href="https://github.com/feluelle/airflint#user-content-fn-2-4997c1131936f3fbe41f5cf4bbf268cd">2</a> (see <a href="https://airflow.apache.org/docs/apache-airflow/stable/best-practices.html#top-level-python-code">Top level Python Code</a>)</p>
<p>Use jinja template syntax instead of Variable.get (see <a href="https://airflow.apache.org/docs/apache-airflow/stable/best-practices.html#airflow-variables">Airflow Variables</a>)</p>
<p>other ideas:</p>
<p>add <code>constants.py</code> to define DEFAULT_ARGS and other constants for reusability in the dags.</p>
<p>The jinja json variable syntax. I&#x27;ve seen numerous people give up and fetch multiple secrets with multiple calls instead. Not me oc.</p>
<p>Detect code that reimplements the &quot;connections&quot; feature and/or using custom secrets libraries in dags that could leverage the airflow secrets backend. &quot;This looks like it could be refactored to use the connections/secrets backend&quot; with a code snippet and links to the docs.</p>
<p>throw warnings about deprecated providers: https://airflow.apache.org/docs/apache-airflow-providers/core-extensions/deprecations.html</p>
<p>I usually see low-formality, custom libraries in the dags directory. Maybe we should be using <code>$ uv pip install &quot;git+https://github.com/my-org/my-library&quot;</code> to install libraries. ü§∑</p>
<p>All progress here is good. üëè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yehoshuadimarsky">@yehoshuadimarsky</a> on 2024-08-18 05:02</div>
            <div class="timeline-body"><p>Anyone know where in the Ruff codebase I would check for unused functions? Not sure exactly where in <code>crates/ruff_linter/src/checkers/ast/analyze/</code> I would hook into, I originally thought in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/checkers/ast/analyze/statement.rs">statement.rs</a>
but then it seems like all that actually happens in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/checkers/ast/analyze/deferred_scopes.rs">deferred_scopes.rs</a>.</p>
<p>Getting kind of lost in what exactly all the terms mean like Bindings, Scopes, etc, any pointers where to look? I think these are Python terms but not 100% sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-19 13:24</div>
            <div class="timeline-body"><blockquote>
<p>Anyone know where in the Ruff codebase I would check for unused functions? Not sure exactly where in <code>crates/ruff_linter/src/checkers/ast/analyze/</code> I would hook into, I originally thought in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/checkers/ast/analyze/statement.rs?rgh-link-date=2024-08-18T05%3A02%3A46Z">statement.rs</a> but then it seems like all that actually happens in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/checkers/ast/analyze/deferred_scopes.rs?rgh-link-date=2024-08-18T05%3A02%3A46Z">deferred_scopes.rs</a>.</p>
<p>Getting kind of lost in what exactly all the terms mean like Bindings, Scopes, etc, any pointers where to look? I think these are Python terms but not 100% sure</p>
</blockquote>
<p>I&#x27;m not sure what you&#x27;re trying to do and how it is relevant to this rule. Could you open a new issue/discussion with an explanation of what you&#x27;re trying to accomplish. I might then be able to help</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dbrtly">@dbrtly</a> on 2024-08-24 10:00</div>
            <div class="timeline-body"><p>Does the</p>
<blockquote>
<p>Anyone know where in the Ruff codebase I would check for unused functions? Not sure exactly where in <code>crates/ruff_linter/src/checkers/ast/analyze/</code> I would hook into, I originally thought in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/checkers/ast/analyze/statement.rs">statement.rs</a> but then it seems like all that actually happens in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/checkers/ast/analyze/deferred_scopes.rs">deferred_scopes.rs</a>.</p>
<p>Getting kind of lost in what exactly all the terms mean like Bindings, Scopes, etc, any pointers where to look? I think these are Python terms but not 100% sure</p>
</blockquote>
<p>Does your use case align with this issue?
<a href="https://github.com/astral-sh/ruff/issues/872">astral-sh/ruff#872</a></p>
<p>Looks like identifying classes and functions that exist but are not used and recommending deletion of them might not be in the ruff feature-set yet.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:36 UTC
    </footer>
</body>
</html>
