<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>collapsible-else-if (PLR5501) --fix removes comments - astral-sh/ruff #13545</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>collapsible-else-if (PLR5501) --fix removes comments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13545">#13545</a>
        opened by <a href="https://github.com/sylvestre">@sylvestre</a>
        on 2024-09-28 09:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sylvestre">@sylvestre</a> on 2024-09-28 09:59</div>
            <div class="timeline-body"><p>Trying to reformat firefox code with ruff https://phabricator.services.mozilla.com/D223851#inline-1243679
we noticed a bug with collapsible-else-if - https://docs.astral.sh/ruff/rules/collapsible-else-if/#collapsible-else-if-plr5501</p>
<p>take this case:</p>
<pre><code>def check_sign(value: int) -&gt; None:
    if value &gt; 0:
        print(&quot;Number is positive.&quot;)
    else:
	# my comment to explain this
	# but will be removed
        if value &lt; 0:
            print(&quot;Number is negative.&quot;)
        else:
            print(&quot;Number is zero.&quot;)
</code></pre>
<p>Then, with ruff main (ec72e675d9325d404864c0848e969f59a89090a7)</p>
<pre><code>cargo run -p ruff -- check --select PLR5501 foo.py --no-cache  --fix  
Found 1 error (1 fixed, 0 remaining).
</code></pre>
<p>will update the code to:</p>
<pre><code>def check_sign(value: int) -&gt; None:
    if value &gt; 0:
        print(&quot;Number is positive.&quot;)
    elif value &lt; 0:
        print(&quot;Number is negative.&quot;)
    else:
        print(&quot;Number is zero.&quot;)
</code></pre>
<p>which removed my comment</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sylvestre">@sylvestre</a> on 2024-09-28 10:01</div>
            <div class="timeline-body"><p>cc @diceroll123 as it seems that you are the original author</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-28 12:01</div>
            <div class="timeline-body"><p>Related to https://github.com/astral-sh/ruff/issues/9790</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-28 12:02</div>
            <div class="timeline-body"><p>@sylvestre where would you expect the comment to be placed after the fix?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @MichaReiser on 2024-09-28 12:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sylvestre">@sylvestre</a> on 2024-09-28 12:29</div>
            <div class="timeline-body"><p>Good point.
To keep it relevant, I would continue on the line #elif and move on the next line</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-30 15:50</div>
            <div class="timeline-body"><p>We have test coverage for this behavior already at https://github.com/astral-sh/ruff/blob/0f674d1d903d0fa0da08eed7c2ed7250c362b805/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLR5501_collapsible_else_if.py.snap#L73-L84</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13572.html">astral-sh/ruff#13572</a> on 2024-09-30 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13573.html">astral-sh/ruff#13573</a> on 2024-09-30 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-03 15:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sylvestre">@sylvestre</a> on 2024-10-03 15:30</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
