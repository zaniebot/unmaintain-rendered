<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix that causes `SyntaxError` is not reverted if the error is version dependent - astral-sh/ruff #18817</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix that causes `SyntaxError` is not reverted if the error is version dependent</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/18817">#18817</a>
        opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a>
        on 2025-06-20 06:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-06-20 06:54</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I noticed this while making #18816, but a version dependent <code>SyntaxError</code> caused by a fix will cause the fix be reverted.</p>
<p>No syntax error when the check command is run without <code>--fix</code>:</p>
<pre><code>PS D:\python_projects&gt; uvx ruff check issue.py --isolated --select PLE --target-version py39
</code></pre>
<pre><code class="language-snap">issue.py:1:5: PLE2510 [*] Invalid unescaped character backspace, use &quot;\b&quot; instead
  |
1 | f&quot;{'‚êà'}&quot;
  |     ^ PLE2510
  |
  = help: Replace with escape sequence

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>When <code>--fix</code> is subsequently run, the message includes both a new <code>SyntaxError</code> and the <code>1 fixed</code> message.</p>
<pre><code>PS D:\python_projects&gt; uvx ruff check issue.py --isolated --select PLE --target-version py39 --fix
</code></pre>
<pre><code class="language-snap">issue.py:1:5: SyntaxError: Cannot use an escape sequence (backslash) in f-strings on Python 3.9 (syntax was added in Python 3.12)
  |
1 | f&quot;{'\b'}&quot;
  |     ^
  |

Found 2 errors (1 fixed, 1 remaining).
</code></pre>
<p>Compare this to the fix causing a syntax error in #18813 - the fix is reverted because of the <code>SyntaxError</code>, and the &quot;please file a bug&quot; message is displayed</p>
<pre><code>PS D:\python_projects&gt; uvx ruff check issue.py --isolated --select PLC --unsafe-fixes --fix --preview
</code></pre>
<pre><code class="language-snap">
error: Fix introduced a syntax error. Reverting all changes.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BFix%20error%5D

...quoting the contents of `issue.py`, the rule codes PLC2801, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

issue.py:1:20: PLC2801 Unnecessary dunder call to `__str__`. Use `str()` builtin.
  |
1 | three = 1 if 1 else(3.0).__str__()
  |                    ^^^^^^^^^^^^^^^ PLC2801
  |
  = help: Use `str()` builtin

Found 1 error.
[*] 1 fixable with the --fix option.
</code></pre>
<p>So this looks to me like for whatever reason, if a fix causes a version dependent <code>SyntaxError</code> it will not be reverted.</p>
<h3>Version</h3>
<p>ruff 0.12.0 (87f0feb 2025-06-17)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-20 06:58</div>
            <div class="timeline-body"><p>version and semantic syntax errors are different from parse errors. Most lints don't run if there are parse errors and we also don't apply any fixes. This is not the case for version or semantic sytnax errors because we actually know what the user meant, they're just not allowed to use that syntax.</p>
<p>The challenge here is how to detect whether a version or semantic syntax error is new and if it is worth the complexity. I'm not sure it is</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2025-06-20 06:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
