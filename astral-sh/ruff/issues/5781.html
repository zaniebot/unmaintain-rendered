<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove unnecessary walrus operator parentheses - astral-sh/ruff #5781</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove unnecessary walrus operator parentheses</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5781">#5781</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-07-15 16:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Our formatter currently always adds parentheses around the walrus (<code>a := 5</code>) operator in for/if/... cases</p>
<p>https://github.com/astral-sh/ruff/blob/3cda89ecafc24722c17d77727cde71f8d9c7df68/crates/ruff_python_formatter/src/expression/expr_named_expr.rs#L32-L41</p>
<p>The goal of this issue is to implement black's parentheses behavior (inside <code>NeedsParentheses</code>) and only preserve parentheses that are necessary.</p>
<p>https://github.com/psf/black/blob/b4dca26c7d93f930bbd5a7b552807370b60d4298/src/black/linegen.py#L1387-L1401</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2023-07-15 16:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-07-15 17:00</div>
            <div class="timeline-body"><p>Related discussion suggesting we may not want to always remove them(?) https://github.com/astral-sh/ruff/discussions/4870</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-07-15 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-15 17:03</div>
            <div class="timeline-body"><blockquote>
<p>Related discussion suggesting we may not want to always remove them(?) #4870</p>
</blockquote>
<p>Oh thanks. Our formatter preserves parentheses for nested expression but removes them in if/for/... headers. I should have stated this more clearly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-29 14:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:47:41 UTC
    </footer>
</body>
</html>
