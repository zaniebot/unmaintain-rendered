<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confine PEP 695 type annotation rewrites (`UP040`) to non-runtime contexts - astral-sh/ruff #6434</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Confine PEP 695 type annotation rewrites (`UP040`) to non-runtime contexts</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6434">#6434</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-08-09 02:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-09 02:10</div>
            <div class="timeline-body"><p>See the comment here: https://github.com/astral-sh/ruff/pull/6289#issuecomment-1670239247. PEP 695 type aliases can't be used for runtime typing, so we need to limit the cases in which we flag and rewrite them. For starters, we could consider limiting to <code>.pyi</code> files, where it should ~always be safe. We could then extend to &quot;private&quot; type aliases that aren't used in runtime contexts within a file.</p>
<p>Alternatively, we could just turn off this rule when <a href="https://beta.ruff.rs/docs/settings/#pyupgrade-keep-runtime-typing"><code>keep-runtime-typing</code></a> is set, and leave it as-is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-09 02:10</div>
            <div class="timeline-body"><p>\cc @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-08-09 02:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6289.html">astral-sh/ruff#6289</a> on 2023-08-09 02:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-09 03:05</div>
            <div class="timeline-body"><p>Thank for raising Henry!</p>
<p>Here are some notes on validity after some experimentation:</p>
<pre><code class="language-python">import typing

# valid
x: typing.TypeAlias = int
print(isinstance(1, x))

# valid
x: typing.TypeAlias = int | str
print(isinstance(1, x))

# valid
x: typing.TypeAlias = typing.Union[int, str]
print(isinstance(1, x))

# not valid
x: typing.TypeAlias = list[int]
print(isinstance([1,2], x))

# not valid
x: typing.TypeAlias = typing.list[int]
print(isinstance([1,2], x))

# valid
from pydantic import BaseModel
type x = int
class Foo(BaseModel):
    y: x
f = Foo(y=1)
print(f.y)

# not valid
type x = int | str
print(isinstance(1, x))

# not valid
type x = typing.Union[int, str]
print(isinstance(1, x))
</code></pre>
<p>It may be enough to categorize this as a &quot;Suggested&quot; fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">python312</span> added by @zanieb on 2023-08-24 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7769.html">astral-sh/ruff#7769</a> on 2023-10-03 17:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7836.html">astral-sh/ruff#7836</a> on 2023-10-06 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-10-06 19:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:10 UTC
    </footer>
</body>
</html>
