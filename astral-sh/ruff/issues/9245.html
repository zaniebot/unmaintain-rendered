<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[msys2] fails to build on GCC-based environments - astral-sh/ruff #9245</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[msys2] fails to build on GCC-based environments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9245">#9245</a>
        opened by <a href="https://github.com/ognevny">@ognevny</a>
        on 2023-12-22 13:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ognevny">@ognevny</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p><a href="https://github.com/msys2/MINGW-packages/blob/72a78f9dce392292022aa6f5ad2f7d01e1560666/mingw-w64-ruff/PKGBUILD">build script</a> for version 0.1.9 (package ruff_cli) fails with</p>
<details>

<pre><code>  error: linking with `x86_64-w64-mingw32-gcc` failed: exit code: 1
    |
    = note: &quot;x86_64-w64-mingw32-gcc&quot; &quot;-fno-use-linker-plugin&quot; &quot;-Wl,--dynamicbase&quot; &quot;-Wl,--disable-auto-image-base&quot; &quot;-m64&quot; &quot;-Wl,--high-entropy-va&quot; &lt;a huge number of files invoked&gt;
    = note: D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.aho_corasick-bc7bfad95b99dc10.aho_corasick.b96c42f095208567-cgu.07.rcgu.o.rcgu.o:aho_corasick.b96c4:(.text+0x2043): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.aho_corasick-bc7bfad95b99dc10.aho_corasick.b96c42f095208567-cgu.07.rcgu.o.rcgu.o:aho_corasick.b96c4:(.text+0x2113): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.aho_corasick-bc7bfad95b99dc10.aho_corasick.b96c42f095208567-cgu.07.rcgu.o.rcgu.o:aho_corasick.b96c4:(.text+0x220b): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.aho_corasick-bc7bfad95b99dc10.aho_corasick.b96c42f095208567-cgu.07.rcgu.o.rcgu.o:aho_corasick.b96c4:(.text+0x22de): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.aho_corasick-bc7bfad95b99dc10.aho_corasick.b96c42f095208567-cgu.07.rcgu.o.rcgu.o:aho_corasick.b96c4:(.text+0x2372): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.aho_corasick-bc7bfad95b99dc10.aho_corasick.b96c42f095208567-cgu.07.rcgu.o.rcgu.o:aho_corasick.b96c4:(.text+0x2405): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.libcst_native-729622e976b52f45.libcst_native.4faaf57094d1fd9-cgu.12.rcgu.o.rcgu.o:libcst_native.4faa:(.text+0x10d7): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.libcst_native-729622e976b52f45.libcst_native.4faaf57094d1fd9-cgu.12.rcgu.o.rcgu.o:libcst_native.4faa:(.text+0x1c98): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex-4f57ff077656d547.regex.52d01696f5b97498-cgu.03.rcgu.o.rcgu.o:regex.52d01696f5b9:(.text+0x8d8): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x5d7e): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x5fb9): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x60a3): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x63de): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x64d9): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x66b3): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x6c56): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x6d28): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x6e01): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x6ed4): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x7495): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x75aa): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x76a2): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x78e8): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.02.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x7e17): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.10.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x636e): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.10.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x64a2): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr2_raw2FN17h7e29201c65c3cb9bE'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.10.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x65f5): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr11memchr3_raw2FN17ha0437855073b6886E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.14.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x1990): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.14.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x19c3): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.regex_automata-68811d2bf19a347d.regex_automata.cf7c7b0cc1719559-cgu.14.rcgu.o.rcgu.o:regex_automata.cf7:(.text+0x1cc6): undefined reference to `__imp__ZN6memchr4arch6x86_646memchr10memchr_raw2FN17h6e22d7878904c6e1E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.tracing-9c7748c7eeb2656e.tracing.c906aa592a079469-cgu.01.rcgu.o.rcgu.o:tracing.c906aa592a:(.text+0x85): undefined reference to `__imp__ZN12tracing_core10dispatcher15GLOBAL_DISPATCH17h25fad95899cc9180E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.tracing-9c7748c7eeb2656e.tracing.c906aa592a079469-cgu.01.rcgu.o.rcgu.o:tracing.c906aa592a:(.text+0xa1): undefined reference to `__imp__ZN12tracing_core10dispatcher15GLOBAL_DISPATCH17h25fad95899cc9180E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.tracing-9c7748c7eeb2656e.tracing.c906aa592a079469-cgu.01.rcgu.o.rcgu.o:tracing.c906aa592a:(.text+0x275): undefined reference to `__imp__ZN12tracing_core10dispatcher15GLOBAL_DISPATCH17h25fad95899cc9180E'
            D:/M/msys64/ucrt64/bin/../lib/gcc/x86_64-w64-mingw32/13.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\_\B\src\ruff-0.1.9\target\release\deps\ruff-7982543447b9eecc.tracing-9c7748c7eeb2656e.tracing.c906aa592a079469-cgu.01.rcgu.o.rcgu.o:tracing.c906aa592a:(.text+0x2a0): undefined reference to `__imp__ZN12tracing_core10dispatcher15GLOBAL_DISPATCH17h25fad95899cc9180E'
            collect2.exe: error: ld returned 1 exit status
            
    = note: some `extern` functions couldn't be found; some native libraries may need to be installed or have their path specified
    = note: use the `-l` flag to specify native libraries to link
    = note: use the `cargo:rustc-link-lib` directive to specify the native libraries to link with Cargo (see https://doc.rust-lang.org/cargo/reference/build-scripts.html#cargorustc-link-libkindname)
  
  error: could not compile `ruff_cli` (bin &quot;ruff&quot;) due to previous error
  ðŸ’¥ maturin failed
    Caused by: Failed to build a native library through cargo
    Caused by: Cargo build finished with &quot;exit code: 101&quot;: `&quot;cargo&quot; &quot;rustc&quot; &quot;--all-features&quot; &quot;--message-format&quot; &quot;json-render-diagnostics&quot; &quot;--locked&quot; &quot;--manifest-path&quot; &quot;C:\\_\\B\\src\\ruff-0.1.9\\crates\\ruff_cli\\Cargo.toml&quot; &quot;--release&quot; &quot;--bin&quot; &quot;ruff&quot; &quot;--&quot; &quot;-C&quot; &quot;link-arg=-s&quot;`
</code></pre>
<p>see PR actions for full log</p>
</details>

<p>on GCC-based environments (MINGW64 and UCRT64). clang-based environment (CLANG64) work fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[msys2] failed to build on GCC-based environments" to "[msys2] fails to build on GCC-based environments" by @ognevny on 2023-12-22 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-04 12:32</div>
            <div class="timeline-body"><p>This looks like something wrong in the environment, or more likely, something wrong in the toolchain. From what I can see, you're getting linker errors from Rust symbols. That generally shouldn't happen AIUI. But to be honest, I don't know much about the <code>x86_64-w64-mingw32-gcc</code> target.</p>
<p>For reference, one of the functions in the linker error is <a href="https://github.com/BurntSushi/memchr/blob/cedf318090876c6d557f234b158dd4fdc91c41ec/src/arch/x86_64/memchr.rs#L174-L178">this one</a>. And the only way that function isn't defined is <a href="https://github.com/BurntSushi/memchr/blob/cedf318090876c6d557f234b158dd4fdc91c41ec/src/arch/mod.rs#L15">if <code>target_os != &quot;x86_64&quot;</code></a>.</p>
<p>One thing that catches my eye is that the target seems to be 64-bit, but it also has a &quot;32&quot; in the name via <code>mingw32</code>. I wonder if there is some significance to that.</p>
<p>The <code>memchr</code> crate is widely use in the Rust ecosystem. Do you have any trouble building other Rust programs for the same target?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ognevny">@ognevny</a> on 2024-01-04 15:05</div>
            <div class="timeline-body"><p><code>mingw32</code> is just the name like <code>win32</code>. msys2 uses mingw-w64, which supports 64-bit of course. in msys2 we actively maintain rust toolchain and we already have dozens of packages compiled with rust. but there is no <code>x86_64-w64-mingw32</code> target, so we use some hacks while building rust. we didn't encounter any issues with <code>memchr</code> target</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-04 15:09</div>
            <div class="timeline-body"><p>Yeah I dunno. I'm also the maintainer of <code>memchr</code>, <code>regex-automata</code> and <code>aho-corasick</code>. The linker errors for Rust symbols definitely lead me to guess that the issue is not on our/my end. But I don't have any guesses beyond that unfortunately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mati865">@mati865</a> on 2024-01-04 22:02</div>
            <div class="timeline-body"><blockquote>
<p>I don't know much about the x86_64-w64-mingw32-gcc target.</p>
</blockquote>
<blockquote>
<p>here is no x86_64-w64-mingw32 target, so we use some hacks while building rust</p>
</blockquote>
<p>There are no hacks involved, x86_64-w64-mingw32 is GNU name for this target and x86_64-pc-windows-gnu is LLVM name (inherited by Rust) but they mean the same thing.</p>
<p>Looking at the logs it looks like the statics might incorrectly imported/exported or the link order is wrong but that shouldn't be caused by these crates. It's likely an issue with rustc but I won't have time to debug it soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ognevny">@ognevny</a> on 2024-01-04 22:15</div>
            <div class="timeline-body"><blockquote>
<p>Looking at the logs it looks like the statics might incorrectly imported/exported or the link order is wrong but that shouldn't be caused by these crates. It's likely an issue with rustc but I won't have time to debug it soon.</p>
</blockquote>
<p>I haven't tested ruff 0.1.11 yet and also didn't try to rebuild with rust 1.75.0. I can do this only on January 8th</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mati865">@mati865</a> on 2024-01-04 22:17</div>
            <div class="timeline-body"><p>I have tested current git repo with 1.74 and 1.75, they both have the same issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mati865">@mati865</a> on 2024-01-04 22:44</div>
            <div class="timeline-body"><p>It has &quot;regressed&quot; in https://github.com/astral-sh/ruff/commit/3ce145c47669645c9031ec42ef9b339835e548c9 and changing <code>lto = &quot;thin&quot;</code> to <code>lto = &quot;fat&quot;</code>  makes it build which sounds like https://github.com/rust-lang/rust/issues/109797</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ognevny">@ognevny</a> on 2024-01-05 00:31</div>
            <div class="timeline-body"><blockquote>
<p>It has &quot;regressed&quot; in https://github.com/astral-sh/ruff/commit/3ce145c47669645c9031ec42ef9b339835e548c9 and changing <code>lto = &quot;thin&quot;</code> to <code>lto = &quot;fat&quot;</code>  makes it build which sounds like https://github.com/rust-lang/rust/issues/109797</p>
</blockquote>
<p>thanks for investigation!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ognevny">@ognevny</a> on 2024-01-08 08:41</div>
            <div class="timeline-body"><p>we fixed the issue. can be closed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ognevny on 2024-01-08 08:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cr1901">@cr1901</a> on 2024-02-17 18:11</div>
            <div class="timeline-body"><p>I ran into this exact error while trying to add <code>ruff</code> as a dependency to a <code>pdm</code> project. This is a virtual/isolated environment, and I <em>have</em> to do a source build due to wheels not being provided for mingw by PyPI. I also wanted to avoid the need to fork the <code>ruff</code> repo just to tweak the <code>release</code> profile to remove thin LTO (and manually track new versions).</p>
<p>Since <a href="https://github.com/rust-lang/cargo/issues/4897">per-target profiles</a> aren't really a thing, I was able to get around this issue by setting the environment variable <code>CARGO_PROFILE_RELEASE_LTO</code> to <code>false</code>. This'll work for me for now until https://github.com/rust-lang/rust/issues/109797 is fixed.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:19 UTC
    </footer>
</body>
</html>
