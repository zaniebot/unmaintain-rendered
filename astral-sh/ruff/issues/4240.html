<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect docs for RET504 - astral-sh/ruff #4240</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect docs for RET504</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4240">#4240</a>
        opened by <a href="https://github.com/Apakottur">@Apakottur</a>
        on 2023-05-05 09:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Apakottur">@Apakottur</a> on 2023-05-05 09:58</div>
            <div class="timeline-body"><p>I am looking at the docs for <a href="https://beta.ruff.rs/docs/rules/unnecessary-assign/">RET504 (unnecessary-assign)</a>. The following code is given there as an example:</p>
<pre><code class="language-python"># test.py
def foo():
    bar = 1
    # some code that not using `bar`
    print('test')
    return bar
</code></pre>
<p>When I run <code>ruff check --select ALL test.py</code> on this code I get:</p>
<pre><code class="language-shell">warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible. Ignoring `one-blank-line-before-class`.
warning: `multi-line-summary-first-line` (D212) and `multi-line-summary-second-line` (D213) are incompatible. Ignoring `multi-line-summary-second-line`.
test.py:1:1: D100 Missing docstring in public module
test.py:1:5: ANN201 Missing return type annotation for public function `foo`
test.py:1:5: D103 Missing docstring in public function
test.py:4:5: T201 `print` found
Found 4 errors.
</code></pre>
<p>There is no RET504 error. Is the example incorrect or am I missing something?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2023-05-05 10:15</div>
            <div class="timeline-body"><p>@Apakottur, thanks for highlighting this. This is an example of where #4168 could be useful.</p>
<p>I personally think that this is a false negative and should be flagged as a RET504 error, but it appears that the presence of the print statement stops this error from appearing.</p>
<p>If the example was updated to:</p>
<pre><code class="language-python"># test.py
def foo():
    bar = 1
    # some code that not using `bar`
    return bar
</code></pre>
<p>Then the error does appear:</p>
<pre><code class="language-bash">&gt; ruff test.py --select=RET
test.py:5:12: RET504 Unnecessary variable assignment before `return` statement
Found 1 error.
</code></pre>
<p>I see that there are a couple of solutions:</p>
<ul>
<li>Fix the rule so that this returns a RET504 error as the print statement does not use <code>bar</code></li>
<li>Update the docs if it is deemed that this is not a false negative. I'm happy to do this if needs be but would err on the side of this being a false negative</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Apakottur">@Apakottur</a> on 2023-05-05 10:43</div>
            <div class="timeline-body"><p>What about the following code:</p>
<pre><code class="language-python">def func() -&gt; int:
    match True:
        case True:
            x = 5
            return x
        case _:
            raise ValueError(&quot;Error&quot;)
</code></pre>
<p>I don't get <code>RET504</code> here as well. Is that the expected behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2023-05-05 10:54</div>
            <div class="timeline-body"><p>I think it probably should return an error as it could be updated to:</p>
<pre><code class="language-python">def func() -&gt; int:
    match True:
        case True:
            return 5
        case _:
            raise ValueError(&quot;Error&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-05-05 10:55</div>
            <div class="timeline-body"><blockquote>
<p>I don't get <code>RET504</code> here as well. Is that the expected behavior?</p>
</blockquote>
<p>No. After giving a quick look, it's occurring as the <code>Visitor</code> is not going through the <code>match</code> statement. A new issue would help keep track of this bug :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4242.html">astral-sh/ruff#4242</a> on 2023-05-05 10:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2023-05-05 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @charliermarsh on 2023-05-05 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4260.html">astral-sh/ruff#4260</a> on 2023-05-06 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-06 20:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
