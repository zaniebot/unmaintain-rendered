<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`flake8-bandit`'s `S4` rules don't apply to stubs - astral-sh/ruff #15207</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>flake8-bandit</code>&#x27;s <code>S4</code> rules don&#x27;t apply to stubs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15207">#15207</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2024-12-30 22:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Avasam">@Avasam</a></div>
            <div class="timeline-body"><p>When enabling the <code>flake8-bandit (S)</code> category (with preview mode), <code>S4</code> rules will trigger on imports in stubs of a project. I believe these will <em>always</em> be false-positives and there&#x27;s no need no need to warn about importing insecure and vulnerable libraries in stubs. Since those are not runtime files. Nothing gets executed.</p>
<p>Ruff: 0.8.4 (rules are currently in preview)</p>
<p>(this report is extracted from <a href="https://github.com/astral-sh/ruff/issues/14535">astral-sh/ruff#14535</a>#issuecomment-2561461038 for ease of tracking and discussion)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-31 05:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-31 05:34</div>
            <div class="timeline-body"><p>Thank you for the report!</p>
<p>Thinking from a user perspective, I think this <em>might</em> still be useful when removing the import from both the Python and the respective stub files. Without this rule highlighting the fact that the import exists in the stub file as well, the user might forget to remove them. Your point is correct that this wouldn&#x27;t affect anyone as stub files aren&#x27;t executed but it might still be useful.</p>
<p>I&#x27;d prefer to get opinions from @AlexWaygood, he&#x27;s currently on vacation this week so not expecting any reply this week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-03 14:59</div>
            <div class="timeline-body"><p>Heh, interesting question! I think I&#x27;m inclined to side with @Avasam on this one, because of the fact that stubs are so often written by people who aren&#x27;t the authors of the corresponding runtime package. In that scenario, it&#x27;s out of the control of the stub author whether or not the runtime package uses the insecure API; the stub author&#x27;s responsibility is just to copy what happens at runtime.</p>
<blockquote>
<p>Without this rule highlighting the fact that the import exists in the stub file as well, the user might forget to remove them.</p>
</blockquote>
<p>If you remove the problematic import from the file at runtime, it&#x27;s true that you might forget to update the stub file at the same time. However, there are excellent tools such as <a href="https://mypy.readthedocs.io/en/stable/stubtest.html">stubtest</a> that will error if there are significant discrepancies between the runtime module and the stub. There are also tools such as Ruff that will emit errors if you have unused imports in a stub file! So in practice, I don&#x27;t think this is a major issue. Disabling this rule for stubs also feels like it follows the precedent we set when we disabled <a href="https://docs.astral.sh/ruff/rules/ambiguous-variable-name/"><code>E741</code></a> for stubs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-03 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-03 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-30 05:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-30 05:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:13 UTC
    </footer>
</body>
</html>
