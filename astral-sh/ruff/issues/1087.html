<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[bug] Misreported number of errors fixed for `D207`/`D208` - astral-sh/ruff #1087</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[bug] Misreported number of errors fixed for <code>D207</code>/<code>D208</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1087">#1087</a>
        opened by <a href="https://github.com/smackesey">@smackesey</a>
        on 2022-12-05 23:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/smackesey">@smackesey</a> on 2022-12-05 23:28</div>
            <div class="timeline-body"><p>From my shell (on <code>0.0.160</code>):</p>
<pre><code>$ruff --select=D207,D208 `git ls-files '*.py'`
Found 7 error(s).
python_modules/dagster/dagster/_loggers/__init__.py:112:1: D208 Docstring is over-indented
python_modules/dagster/dagster_tests/core_tests/test_pipeline_errors.py:103:1: D208 Docstring is over-indented
python_modules/dagster/dagster_tests/core_tests/test_pipeline_errors.py:104:1: D208 Docstring is over-indented
python_modules/dagster/dagster_tests/core_tests/test_pipeline_errors.py:106:1: D208 Docstring is over-indented
python_modules/dagster/dagster_tests/core_tests/test_pipeline_errors.py:107:1: D208 Docstring is over-indented
python_modules/libraries/dagster-aws/dagster_aws/utils/mrjob/log4j.py:54:1: D207 Docstring is under-indented
python_modules/libraries/dagster-aws/dagster_aws/utils/mrjob/log4j.py:90:1: D207 Docstring is under-indented
7 potentially fixable with the --fix option.


$ ruff --fix --select=D207,D208 `git ls-files '*.py'`
Found 2 error(s) (205 fixed).
python_modules/libraries/dagster-aws/dagster_aws/utils/mrjob/log4j.py:54:1: D207 Docstring is under-indented
python_modules/libraries/dagster-aws/dagster_aws/utils/mrjob/log4j.py:90:1: D207 Docstring is under-indented
2 potentially fixable with the --fix option.
</code></pre>
<p>Notice it says 205 errors were fixed after initially detecting 7! Also the errors being fixed are weird and maybe false positives? I'm not entirely sure what's happening. I'm guessing it has something to do with encoding. Here are the files that are changed when I run the above <code>--fix</code> on <code>dagster</code> <code>master</code>:</p>
<pre><code>On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)
	modified:   python_modules/dagster/dagster/_grpc/__generated__/__init__.py
	modified:   python_modules/dagster/dagster/_loggers/__init__.py
	modified:   python_modules/dagster/dagster_tests/core_tests/test_pipeline_errors.py
	modified:   python_modules/libraries/dagster-aws/dagster_aws/utils/mrjob/log4j.py

no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-05 23:33</div>
            <div class="timeline-body"><p>Lol. I'm guessing that there's an unstable fix here, whereby one fix is causing another error, and it's iteratively fixing and re-inserting an error and fixing until it hits the iteration limit. Will take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-05 23:43</div>
            <div class="timeline-body"><p>@smackesey - If it's helpful for now, I think the issue with those specific docstrings is that they contain unescaped newline characters (like <code>\n</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-05 23:45</div>
            <div class="timeline-body"><p>As in, I think that should be a raw string, like:</p>
<pre><code class="language-py">class Log4jRecord(
    namedtuple(
        &quot;_Log4jRecord&quot;, &quot;caller_location level logger message num_lines start_line thread timestamp&quot;
    )
):
    r&quot;&quot;&quot;Represents a Log4J log record.

    caller_location -- e.g. 'YarnClientImpl.java:submitApplication(251)'
    level -- e.g. 'INFO'
    logger -- e.g. 'amazon.emr.metrics.MetricsSaver'
    message -- the actual message. If this is a multi-line message (e.g.
        for counters), the lines will be joined by '\n'
    num_lines -- how many lines made up the message
    start_line -- which line the message started on (0-indexed)
    thread -- e.g. 'main'. Defaults to ''
    timestamp -- unparsed timestamp, e.g. '15/12/07 20:49:28'
    &quot;&quot;&quot;
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-05 23:53</div>
            <div class="timeline-body"><p>(But, we still shouldn't be inserting an errant fix, so there's still a bug here.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-12-06 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-09 21:45</div>
            <div class="timeline-body"><p>Ah, ok, the issue is that we're using the inner docstring contents, which are created during the parsing pass and treat <code>\n</code> as an actual newline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-12-09 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-09 22:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:10:15 UTC
    </footer>
</body>
</html>
