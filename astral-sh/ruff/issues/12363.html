<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`SIM102` false positive when using walrus operator - astral-sh/ruff #12363</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`SIM102` false positive when using walrus operator</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12363">#12363</a>
        opened by <a href="https://github.com/adam-sikora">@adam-sikora</a>
        on 2024-07-17 13:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adam-sikora">@adam-sikora</a> on 2024-07-17 13:01</div>
            <div class="timeline-body"><p>The following code snippet does not pass validation for rule <code>SIM102</code> (Use a single if statement instead of nested if statements)</p>
<pre><code>foo = {&quot;a&quot;: 1}
if bar := foo[&quot;a&quot;]:
    if bar == 1:
        print(bar)
</code></pre>
<p>Check command used: <code>ruff check --select=&quot;SIM102&quot; example.py --isolated</code> (ruff version: <code>0.5.2</code>)</p>
<p>However the if statements cannot be combined as the rule suggests as</p>
<pre><code>foo = {&quot;a&quot;: 1}
if bar := foo[&quot;a&quot;] and bar == 1:
    print(bar)
</code></pre>
<p>would lead to: <code>NameError: name 'bar' is not defined</code></p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 13:54</div>
            <div class="timeline-body"><p>I think it does work as:</p>
<pre><code class="language-python">foo = {&quot;a&quot;: 1}
if (bar := foo[&quot;a&quot;]) and bar == 1:
    print(bar)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 13:55</div>
            <div class="timeline-body"><p>And <code>ruff check --fix</code> does handle this case properly, so I think this is working as intended!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-17 13:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @charliermarsh on 2024-07-17 13:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adam-sikora">@adam-sikora</a> on 2024-07-17 14:07</div>
            <div class="timeline-body"><p>Yeah, my bad for forgetting the correct operator priority. Thanks for the clarification</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:13 UTC
    </footer>
</body>
</html>
