<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error - Bad CPU type in executable - astral-sh/ruff #14995</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error - Bad CPU type in executable</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14995">#14995</a>
        opened by <a href="https://github.com/sr-murthy">@sr-murthy</a>
        on 2024-12-15 23:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sr-murthy">@sr-murthy</a> on 2024-12-15 23:20</div>
            <div class="timeline-body"><p>I'm running a Ruff linting step (<code>ruff check</code>) in a CI test job matrix on GitHub Actions which fails currently on all MacOS 13 x86_64 runners, for the Python versions 3.11-3.13,  with the following error:</p>
<pre><code class="language-shell">/bin/bash: /Users/runner/work/&lt;project&gt;/&lt;project&gt;/.venv/bin/ruff: Bad CPU type in executable
</code></pre>
<p>The linting step is run inside a virtualenv located in the working directory, which contains the Ruff executable (<code>.venv/bin/ruff</code>), and as a test I printed out the file information on Ruff, before running the check, which shows the following:</p>
<pre><code class="language-shell">.venv/bin/ruff: Mach-O 64-bit executable arm64
</code></pre>
<p>So it seems the Ruff version that was installed in each of these test jobs on these MacOS 13 x64_64 runners is for Arm64. Do you have different versions for different platforms? The installation is via <a href="https://github.com/pdm-project/pdm">PDM</a>, but I don't think PDM is the cause.</p>
<p>Note that the jobs succeed for Mac OS 14-15 x86_64 runners regardless of Python version, and I see the same Ruff build info. as above, i.e. <code>Mach-O 64-bit executable arm64</code>.</p>
<p>Can you possibly explain or suggest a solution?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2024-12-16 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-16 07:38</div>
            <div class="timeline-body"><p>Hi @sr-murthy</p>
<p>Hmm interesting. We do build and publish different binaries for different platforms and architecture and that includes a <a href="https://pypi.org/project/ruff/#ruff-0.8.3-py3-none-macosx_10_12_x86_64.whl">darwin-x64</a> target.</p>
<p>Does PDM have a debug mode where it shows the wheel build output? If so, would you mind sharing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sr-murthy">@sr-murthy</a> on 2024-12-16 07:54</div>
            <div class="timeline-body"><p>@MichaReiser It works now.</p>
<p>I cleared the project pip cache on GH, and it has now detected and installed the correct Ruff wheel on the x86_64 runners. Here is some log output for the relevant steps prior to the lint:</p>
<pre><code class="language-shell">...
unearth.preparer: Downloading &lt;Link https://files.pythonhosted.org/packages/ef/c5/0aabdc9314b4b6f051168ac45227e2aa8e1c6d82718a547455e40c9c9faa/ruff-0.8.3-py3-none-macosx_10_12_x86_64.whl (from https://pypi.org/simple/ruff/)&gt; (10.3 MB)
  âœ” Install ruff 0.8.3 successful
...
.venv/bin/ruff: Mach-O 64-bit executable x86_64
...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sr-murthy on 2024-12-16 07:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
