<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve warnings when ignoring preview rules without preview flag - astral-sh/ruff #7491</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve warnings when ignoring preview rules without preview flag</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7491">#7491</a>
        opened by <a href="https://github.com/bersbersbers">@bersbersbers</a>
        on 2023-09-18 12:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bersbersbers">@bersbersbers</a></div>
            <div class="timeline-body"><pre><code>ruff check --isolated --ignore PLC1901,PLR0904  # version 0.0.290
</code></pre>
<p>outputs</p>
<pre><code>warning: Selection of nursery rule `PLC1901` without the `--preview` flag is deprecated.
warning: Selection `PLR0904` has no effect because the `--preview` flag was not included.
</code></pre>
<p>I think these warnings are rather irrelevant - they basically confirm what the users wants to do anyway, which is <em>not</em> select these rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-18 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-18 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-18 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-18 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-18 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/silverwind">@silverwind</a> on 2023-09-21 17:20</div>
            <div class="timeline-body"><p>Also noticed this strange warning. I had <code>PLC1901</code> in my <code>ignore</code> config for a long time (because it&#x27;s a unsafe rule), ruff v0.0.290 now suddenly started warning about it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmvp">@hmvp</a> on 2023-09-21 17:21</div>
            <div class="timeline-body"><blockquote>
<p>Also noticed this strange warning. I had <code>PLC1901</code> in my <code>ignore</code> config for a long time (because it&#x27;s a unsafe rule), ruff v0.0.290 now suddenly started warning about it.</p>
</blockquote>
<p>That rule moved to the nursery, probably because its unsafe... We had the same..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/silverwind">@silverwind</a> on 2023-09-21 17:25</div>
            <div class="timeline-body"><p>Does nursery mean it&#x27;s disabled by default now when I <code>select=[&quot;PL&quot;]</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-21 17:27</div>
            <div class="timeline-body"><p>@silverwind - Yeah, if you do <code>select=[&quot;PL&quot;]</code>, <code>PLC1901</code> will <em>not</em> be included.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/silverwind">@silverwind</a> on 2023-09-21 17:30</div>
            <div class="timeline-body"><p>Thanks, I&#x27;ll remove it then from <code>ignore</code> and I see the warning also makes sense. It should probably explain better what the &quot;nursery&quot; is, the online docs also have no info on this topic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-21 17:33</div>
            <div class="timeline-body"><p>&quot;Nursery&quot; was changed to <a href="https://docs.astral.sh/ruff/preview/">&quot;Preview&quot;</a> -- we should probably update the docs to reflect that it used to be called &quot;Nursery&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/silverwind">@silverwind</a> on 2023-09-21 17:37</div>
            <div class="timeline-body"><p>I see. Maybe just reword the warning to something like this?</p>
<pre><code>warning: Ignoring preview rule `&lt;id&gt;` has no effect unless `--preview` is specified.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-21 17:46</div>
            <div class="timeline-body"><p>\cc @zanieb - when you&#x27;re back :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Remove unnecessary warnings when ignoring preview rules without preview flag&quot; to &quot;Improve warnings when ignoring preview rules without preview flag&quot; by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-26 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-26 18:38</div>
            <div class="timeline-body"><p>&quot;select&quot; is kind of a broad term in this warning, we&#x27;re referring to the use of a <em>rule selector</em> which can be used with any of the command line options e.g. <code>--select</code> / <code>--ignore</code>. I figured this would be a little ambiguous and we could improve it with more careful messaging in a follow-up â€” thanks for your feedback!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-26 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/frenck">@frenck</a> on 2023-10-02 18:50</div>
            <div class="timeline-body"><p>Just ran into this on the Home Assistant project. Honestly, I don&#x27;t think this is a messaging problem.</p>
<p>A rule was ignored explicitly and still gives us this warning. Meaning if you run it with <code>--preview</code>, it still was ignored. But that is now something we should not do anymore?</p>
<p>It is a bit odd as we don&#x27;t want it in preview but also want to ignore it if it gets out of preview/nursery.</p>
<p>I&#x27;m not sure why an ignore flag has to trigger this warning. What is the goal for triggering the warning in that case? What is the risk if it would still be set to be ignored while only available in preview?</p>
<p>I&#x27;m just confused about what problem is solved here and why this warning is added for this specific case reported in this issue.</p>
<p>../Frenck</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-02 19:02</div>
            <div class="timeline-body"><p>Hey @frenck</p>
<p>The implementation is just naively collecting all of the selector options e.g. https://github.com/astral-sh/ruff/blob/316f75987d138028a282333f8cce780f064f4000/crates/ruff_workspace/src/configuration.rs#L703-L712</p>
<p>This warning is not explicitly targetting use of <code>--ignore &lt;RULE&gt;</code>, it applies to <em>any</em> option in which <code>&lt;RULE&gt;</code> is used. This was just the simplest way to implement the warning alongside our existing warnings, but we can update that iterator to be aware of the specific option used to remove or reword the message as needed.</p>
<p>I&#x27;ll be working on this soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-08 16:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:42 UTC
    </footer>
</body>
</html>
