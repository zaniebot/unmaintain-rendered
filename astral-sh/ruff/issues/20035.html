<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff format` can double count formatted files - astral-sh/ruff #20035</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff format</code> can double count formatted files</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20035">#20035</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-08-21 23:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code>❯ cd /tmp
❯ rm -rf example
❯ mkdir example

❯ echo &quot;x   = 1&quot; &gt; example/foo.py
❯ uvx ruff format example example/foo.py
2 files reformatted

❯ echo &quot;x   = 1&quot; &gt; example/foo.py
❯ uvx ruff format example
1 file reformatted
</code></pre>
<p><code>foo.py</code> appears to be counted twice when there are two ways it is selected.</p>
<p>Here are some logs</p>
<pre><code>[2025-08-21][18:02:39][ruff::resolve][DEBUG] Using Ruff default settings
[2025-08-21][18:02:39][ignore::gitignore][DEBUG] opened gitignore file: /Users/zb/.gitignore
[2025-08-21][18:02:39][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/private/tmp/example/foo.py&quot;
[2025-08-21][18:02:39][ruff::commands::format][DEBUG] format_path; path=/private/tmp/example/foo.py
[2025-08-21][18:02:39][ruff::commands::format][DEBUG] format_path; path=/private/tmp/example/foo.py
[2025-08-21][18:02:39][tracing::span][DEBUG] Printer::print;
[2025-08-21][18:02:39][tracing::span][DEBUG] Printer::print;
[2025-08-21][18:02:39][ruff::commands::format][DEBUG] Formatted 2 files in 2.87ms
</code></pre>
<h3>Version</h3>
<p>0.12.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-08-21 23:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @zanieb on 2025-08-21 23:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-21 23:04</div>
            <div class="timeline-body"><p>Probably some context on the root cause in https://github.com/astral-sh/ruff/issues/19395</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-21 23:05</div>
            <div class="timeline-body"><p>It's unclear if we should dedup the actual formatting or dedup the counts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-22 06:10</div>
            <div class="timeline-body"><p>We should deduplicate the files because that fixes #19395 too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-19 18:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:14 UTC
    </footer>
</body>
</html>
