<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Segmentation fault: 11 with ruff 0.2.0 - astral-sh/ruff #9823</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Segmentation fault: 11 with ruff 0.2.0</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/9823">#9823</a>
        opened by <a href="https://github.com/jetli">@jetli</a>
        on 2024-02-05 06:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jetli">@jetli</a> on 2024-02-05 06:55</div>
            <div class="timeline-body"><p>when run ruff 0.2.0, it always return an error msg: Segmentation fault: 11, but ruff 0.1.15 is ok.</p>
<pre><code class="language-bash">$ ruff --version
Segmentation fault: 11
</code></pre>
<p>OS: macOS 11.7.10
python: 3.8.9 in virtual env</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qarmin">@qarmin</a> on 2024-02-05 06:58</div>
            <div class="timeline-body"><p>Can you run it under gdb?</p>
<pre><code>gdb ruff
run --version
bt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-05 13:28</div>
            <div class="timeline-body"><p>@jetli, what shell are you using? Is it ZSH? https://github.com/astral-sh/ruff/discussions/9824</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 13:55</div>
            <div class="timeline-body"><p>How strange. Does running with <code>--no-cache</code> change anything? (I assume not, but worth a try.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jetli">@jetli</a> on 2024-02-05 14:07</div>
            <div class="timeline-body"><p>not zsh, just bash.  it crashes even with no options.</p>
<pre><code>$ ruff
Segmentation fault: 11
</code></pre>
<p>installation log:</p>
<pre><code>Collecting ruff
  Using cached ruff-0.2.0-py3-none-macosx_10_12_x86_64.whl (7.3 MB)
Installing collected packages: ruff
  Attempting uninstall: ruff
    Found existing installation: ruff 0.1.15
    Uninstalling ruff-0.1.15:
      Successfully uninstalled ruff-0.1.15
Successfully installed ruff-0.2.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 14:17</div>
            <div class="timeline-body"><p>Do you know what version of macOS you’re on? Perhaps this is related to our upgrade to use the Apple Silicon runners.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 14:17</div>
            <div class="timeline-body"><p>Oh sorry, you said macOS 11 above. I’m guessing there’s something incompatible there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-05 14:23</div>
            <div class="timeline-body"><p>Could you share the output of the <code>uname -a</code> command?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2024-02-05 14:52</div>
            <div class="timeline-body"><p>I can reproduce this on my old EOL x64 macbook (macos 11 has been eol for 4 months, but i think this issue can plausibly manifest on 12/13).</p>
<p>The crash stack includes lots of things like <code>ImageLoaderMachO::doModInitFunctions(ImageLoader::LinkContext const&amp;)</code> which is a pretty clear sign the crash is during the dynamic linking of the executable on load. This is <em>probably</em> a symptom of binaries compiled against the macos 14 sdk (the default for github's new apple silicon runners) being run on an older OS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 14:54</div>
            <div class="timeline-body"><p>@Gankra - Do you think this is an issue for ARM macbooks on macos 11, 12, 13? Or just x86? Or can't say at this point?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2024-02-05 14:58</div>
            <div class="timeline-body"><p>I would expect the issue to happen equally on both platforms, with OS version being the primary issue -- but that's purely a guess, and the only thing I can think to do is to find people with macbooks running those versions to try (I guess you could write some github CI jobs to spawn some of those OSes and try to run the binary?).</p>
<p>I can send you the full crash log but it doesn't obviously indicate what symbol was trying to be loaded (only skimmed it).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-02-05 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2024-02-05 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9834.html">astral-sh/ruff#9834</a> on 2024-02-05 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 16:12</div>
            <div class="timeline-body"><p>@Gankra - FYI, it looks like these binaries work okay on macOS 12 and macOS 13: https://github.com/astral-sh/ruff/pull/9835</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 16:13</div>
            <div class="timeline-body"><p>Now I'm more tempted <em>not</em> to change this given that macOS 11 is EOL :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-05 16:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
