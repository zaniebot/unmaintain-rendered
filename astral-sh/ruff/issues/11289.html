<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLE001: conditional handling of errors not detected - astral-sh/ruff #11289</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>BLE001: conditional handling of errors not detected</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/11289">#11289</a>
        opened by <a href="https://github.com/bentheiii">@bentheiii</a>
        on 2024-05-05 09:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bentheiii">@bentheiii</a> on 2024-05-05 09:38</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>keywords: BLE001, log, exception</p>
<p>The following code snippet does not trigger the BLE001 rule:</p>
<pre><code class="language-py">from logging import exception


try:
    pass
except Exception:
    exception(&quot;An error occurred&quot;)
</code></pre>
<p>but this one does:</p>
<pre><code class="language-py">from logging import exception

try:
    pass
except Exception:
    if True:
        exception(&quot;An error occurred&quot;)
    else:
        exception(&quot;An error occurred&quot;)
</code></pre>
<p>This is because ruff doesn't seem to consider the case the both branches of an <code>if</code> handle the error.</p>
<p>The reason we run into this is because sometimes we use code like the following:</p>
<pre><code class="language-py">from logging import exception

try:
    pass
except Exception as ex:
    error_data = gather_diagnostic_data(...)
    if isinstance(ex, SomespecificError):
        exception(&quot;A specific error occurred&quot;, extra=error_data)
    else:
        exception(&quot;A generic error occurred&quot;, extra=error_data)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2024-05-05 11:33</div>
            <div class="timeline-body"><ul>
<li>Something similar was discussed previously in https://github.com/astral-sh/ruff/issues/1119#issuecomment-1341147418.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-05-06 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-06 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11301.html">astral-sh/ruff#11301</a> on 2024-05-06 01:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-06 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rahulssheth">@rahulssheth</a> on 2024-05-10 20:30</div>
            <div class="timeline-body"><p>We were recently investigating the 0.4.4 upgrade and found that snippets like this:</p>
<pre><code>def method() -&gt; None:
    try:
           raise Exception()
    except Exception:
           if False:
               raise
           else:
                  return None
</code></pre>
<p>would no longer raise <code>BLE001</code> (Ruff playground for reference: https://play.ruff.rs/f65629f5-eda0-43f0-a85f-c05a0be1cb9c) because there's a conditional handling the exception. This seems a bit problematic, given that the original issue was about cases where both (or rather, all) branches of a conditional handle the exception, but that isn't the case here. Totally understandable if this is out of scope, just wanted to put it on the radar. Thanks (apologies if this should be filed in another issue)!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2024-05-10 20:53</div>
            <div class="timeline-body"><p>A more complex visitor would need to be implemented like in flake8-trio.
https://github.com/astral-sh/ruff/issues/1119#issuecomment-1341171085</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-10 20:54</div>
            <div class="timeline-body"><p>Thanks @rahulssheth. My overall feeling was that if you're re-raising even within a branch, then the use of the catch-all exception was probably intentional, and so likely to be a false positive. Are you seeing real cases where you <em>do</em> want it to be flagged, despite a re-raise?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rahulssheth">@rahulssheth</a> on 2024-05-12 02:05</div>
            <div class="timeline-body"><p>@charliermarsh good point! In most scenarios, if there's some sort of explicit handling with a re-raise, even if there isn't <em>always</em> a re-raise, it likely isn't an problem. I mostly flagged this issue because I think there's a case to be made that false positives with an ignore should be preferred to false negatives here, but I haven't seen any real cases that merit a change of approach. Appreciate the quick feedback!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
