<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow output to file with different format to output to console - astral-sh/ruff #2388</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow output to file with different format to output to console</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/2388">#2388</a>
        opened by <a href="https://github.com/ngnpope">@ngnpope</a>
        on 2023-01-31 11:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-01-31 11:42</div>
            <div class="timeline-body"><p>Currently, when running in CI I have to do the following, e.g. in a (simplified) <code>.gitlab-ci.yml</code>:</p>
<pre><code class="language-yaml">lint:
  script:
    - ...
    - ruff .
    - ruff --format=gitlab . &gt; quality.json
  artifacts:
    reports:
      codequality: quality.json
</code></pre>
<p>I'd like to keep the text output in the job output, but also make use of the capabilities GitLab provides to display violations.</p>
<p>Now, <code>ruff</code> is super fast ‚ö°, so running twice isn't a pain, but it seems suboptimal. Could we enable one of the following?</p>
<ul>
<li><code>ruff --format=text --output=gitlab:/path/to/quality.json .</code> ‚Üê dedicated <code>--output</code> option</li>
<li><code>ruff --format=text --format=gitlab:/path/to/quality.json .</code> ‚Üê allow multiple <code>--format</code> with filename</li>
<li><code>ruff --format=text,gitlab:/path/to/quality.json .</code> ‚Üê allow multiple values in <code>--format</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-31 12:16</div>
            <div class="timeline-body"><p>I'd rather avoid CLI options with such a complex syntax, since it complicates the CLI and also doesn't work with the shell autocompletion generation by <code>clap_complete</code>.</p>
<p>How about instead introducing a new <code>--stderr-format</code> option that accepts the same values as the current <code>--format</code> option and would additionally output the specified format on stderr? ... then you could replace your two commands with <code>ruff --stderr-format=gitlab . 2&gt; quality.json</code> (<code>2&gt;</code> is shell syntax for stderr redirection).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-01-31 12:31</div>
            <div class="timeline-body"><p>I guess we could do that, but that would only work as long as <code>ruff</code> never chose to output something else to stderr...</p>
<p>It seems a little irregular. Normally stdout is used for the normal output from a program and stderr is use to output errors or diagnostic information about the execution of that program.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-31 12:48</div>
            <div class="timeline-body"><p>Fair point ... and it also wouldn't support outputting to more than two formats. I think it's probably best to just implement a new <code>convert</code> subcommand that can consume the <code>json</code> output and convert it to any of the other supported output formats ... although for that to work nice with shell pipes we'd need a stream-friendly JSON format (where each message is on one line).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-01-31 13:09</div>
            <div class="timeline-body"><p>So <code>--format=jsonl</code> then? (See https://jsonlines.org/)</p>
<p>I guess that allows for using <code>tee</code> to redirect to multiple processors then?</p>
<p>It would work, but does just seem much more complex than a command line option... ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-31 13:27</div>
            <div class="timeline-body"><p>The advantages I see are that 1) it wouldn't complicate the <code>ruff check</code> CLI for users who don't need this feature, 2) shell completion would work fine and 3) it's not unthinkable that we end up introducing more format-specific options (for <code>--format text</code> we already have several), having one ruff command call always only produce one output avoids the ambiguity of which output option belongs to which output.</p>
<p>I agree that how to use this would be less obvious for users unfamiliar with shell piping/redirection, however I think that could be accommodated via an example in the documentation ... and I wouldn't consider this to be something users commonly use but rather something you set up once for a CI, so I think that should be alright.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ekbfh">@ekbfh</a> on 2023-03-20 16:44</div>
            <div class="timeline-body"><p>Also think about this situation
Is it possible to have:</p>
<ol>
<li>always have stdout with some default format, ex. <code>grouped/text</code></li>
<li>if <code>--outputfile=/tmp/file</code> than apply <code>--format</code> to file, not to stdout</li>
<li>disable stdout with <code>-q</code>, like it should be</li>
</ol>
<p>I prefer not to run ruff more than one time and not to have any <code>|jq</code> processors</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-03-20 17:15</div>
            <div class="timeline-body"><p>Having a dedicated <code>output</code> (or <code>output-file</code>) option has precedence in</p>
<ul>
<li>ESLint (<code>output-file</code> | <code>-o</code>)</li>
<li><code>dotnet format --report</code></li>
<li>Jest (<code>--outputFile</code>) in combination with <code>--json</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-20 19:09</div>
            <div class="timeline-body"><p>Ah good call. I'd want to look at what ESLint does in various cases. If you use <code>--fix</code>, does it write the fixed code to the output file? (Does it write the fixed code to stdout, if you write via stdin? I never checked that). What should go to stderr vs. stdout? Etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @charliermarsh on 2023-03-22 03:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wishlist</span> added by @charliermarsh on 2023-03-22 03:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4754.html">astral-sh/ruff#4754</a> on 2023-05-31 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-20 16:53</div>
            <div class="timeline-body"><p>We now support writing to a file (#4950), but not to both standard output <em>and</em> a file. I'm going to close this, and we can open a fresh issue if that additional behavior is desired.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-20 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-06-22 09:25</div>
            <div class="timeline-body"><p>@charliermarsh Could you re-open this? I'm not sure why it makes sense to create a new issue when it would be exactly the same description... This issue was clearly stated as allowing the usual text output to standard output <strong>while also</strong> allowing a separate output to file for a specific report format.</p>
<p>The use case in question is for runs in CI where we want the usual report to the job output but would also like to generate a report file, e.g. for GitLab, so that artifact can be used to integrate the results with their UI. <em>(This could/would also apply for services other than GitLab.)</em> Currently this is impossible to achieve without running <code>ruff</code> twice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2023-06-22 09:27</div>
            <div class="timeline-body"><p>I should follow up that, while the PR you linked to (#4950) does support writing to an output file with a flag, it doesn't do anything other than remove the need for shell redirection.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-22 09:34</div>
            <div class="timeline-body"><p>CC: @dhruvmanila</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @MichaReiser on 2023-06-22 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgorfer">@mgorfer</a> on 2023-08-10 01:37</div>
            <div class="timeline-body"><p>I would also be very glad to have this feature included in Ruff (https://github.com/astral-sh/ruff/discussions/6467).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2023-08-14 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @zanieb by @zanieb on 2023-10-26 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8251.html">astral-sh/ruff#8251</a> on 2023-10-26 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ekbfh">@ekbfh</a> on 2024-02-12 11:04</div>
            <div class="timeline-body"><p>@charliermarsh Good day! Is any new thoughts about CI usage of ruff? We stiil have to run it twice in a row</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12237.html">astral-sh/ruff#12237</a> on 2024-07-08 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gmetzker-4c">@gmetzker-4c</a> on 2024-08-19 18:25</div>
            <div class="timeline-body"><p>Agreed this would be a nice feature.<br />
Pylint now supports multiple output formats as follows:<br />
<code>pylint --output-format=colorized,parseable:pylint.log</code></p>
<p>That's not to say their syntax is the best but the ability target multiple outputs would be great for CI systems.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13997.html">astral-sh/ruff#13997</a> on 2024-10-30 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14878.html">astral-sh/ruff#14878</a> on 2024-12-09 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarcBresson">@MarcBresson</a> on 2025-02-05 14:22</div>
            <div class="timeline-body"><p>Hello, any news on that issue ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wkoot">@wkoot</a> on 2025-11-12 22:07</div>
            <div class="timeline-body"><p>I would like to use ruff to replace pylint in a pipeline, but having to run several times seems a bit of a shame.
The sonar-scanner provides the option to pass a pylint report via <code>sonar.python.pylint.reportPaths</code>, which ruff can produce.
However, this would mean I'd need to run 3 times; one for immediate readable output, one for gitlab annotation and one for pylint.</p>
<p>I think that the use case is rather specific so I don't think making the cli overly complicated is needed, toml config should suffice.
For instance, something like this:</p>
<pre><code class="language-toml">[tool.ruff]
output-format = &quot;concise&quot;

[tool.ruff.per-file-output]
ruff_gitlab.json = {output-format = &quot;gitlab&quot;}
ruff_junit.xml = {output-format = &quot;junit&quot;}
ruff_pylint.txt = {output-format = &quot;pylint&quot;}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/21633.html">astral-sh/ruff#21633</a> on 2025-11-25 23:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ty/issues/1691.html">astral-sh/ty#1691</a> on 2025-12-01 07:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
