<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatically remove __future__ imports - astral-sh/ruff #312</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Automatically remove <strong>future</strong> imports</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/312">#312</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-10-03 22:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>This may require adding target Python versions to the configuration settings.</p>
<p>Source: https://github.com/asottile/pyupgrade</p>
<p><img src="https://user-images.githubusercontent.com/1309177/193696375-8683f099-353d-4a92-9df4-d0e14aaa0847.png" alt="Screen Shot 2022-10-03 at 6 19 54 PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @charliermarsh on 2022-10-03 22:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2022-10-03 22:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jmg-duarte">@jmg-duarte</a> on 2022-10-16 16:47</div>
            <div class="timeline-body"><p>Hey Charlie! I'm interested in helping, can you provide me with some guidance on where to look before implementing this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-16 16:48</div>
            <div class="timeline-body"><p>Yes absolutely! Will write something up now...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-16 16:56</div>
            <div class="timeline-body"><p><strong>Step 1</strong>: Create a new lint rule to flag these lines, something like <code>UnnecessaryFutureImports</code>. There are some instructions on adding a new <code>CheckCode</code> and <code>CheckKind</code> in the <a href="https://github.com/charliermarsh/ruff/blob/main/CONTRIBUTING.md#example-adding-a-new-lint-rule"><code>CONTRIBUTING.md</code></a>.</p>
<p><strong>Step 2</strong>: Add the actual logic to detect these errors. This will start in <code>src/check_ast.rs</code> -- look for the <code>if let Some(&quot;__future__&quot;) = module.as_deref() { ... }</code> block, where we handle future imports, and add something like:</p>
<pre><code class="language-rust">if self.settings.enabled.contains(&amp;CheckCode::YOUR_NEW_CHECK_CODE) {
    plugins::unnecessary_future_import(self, name);
}
</code></pre>
<p>Then, add a file in <code>src/pyupgrade/plugins</code>. Take a look at some of the other examples therein. We'll need to base the exact detection on a check of <code>checker.settings.target_version</code>, since certain future imports are only unnecessary after certain Python versions.</p>
<p>(You might see some rules that go <code>ast/checks.rs</code> instead of the <code>plugins</code> system, but I prefer the <code>plugins</code> system for complex rules like these.)</p>
<p><strong>Step 3</strong>: Add a test fixture to <code>resources/test/fixtures</code>, and a line to the <code>#[test_case(CheckCode::C405, Path::new(&quot;C405.py&quot;); &quot;C405&quot;)]</code> group in <code>linter.rs</code>. We typically create one fixture file per rule.</p>
<p><strong>Step 4</strong>: Call <code>check.amend</code> to delete the statement. We actually might be able to use <code>src/pyflakes/fixes.rs#remove_unused_import_froms</code> for this? But this can be a separate PR, even Steps 1-3 would be awesome without the autofix.</p>
<p><strong>Step 5</strong>: Update the generated files by running <code>cargo dev generate-rules-table</code> and <code>cargo dev generate-check-code-prefix</code> from the repo root.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-16 16:58</div>
            <div class="timeline-body"><p>Any questions or confusion just ask here! I want to be helpful :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jmg-duarte">@jmg-duarte</a> on 2022-10-19 07:51</div>
            <div class="timeline-body"><p>Hey @charliermarsh! Sorry for the long time to reply, suddenly got very busy but should be slowing down now.</p>
<p>Your overview is amazing ðŸ™Œ thank you very much for the help!</p>
<p>For now, one question I got as soon as I started implementing was which code should I use. As <code>pyupgrade</code> only does in-place transformations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-19 12:52</div>
            <div class="timeline-body"><p>No worries! Thanks for looking into this and for your interest in the project :)</p>
<p>You can use U009 as the check code. Iâ€™m just auto-incrementing under the U prefix for  pyupgrade (since pyupgrade itself doesnâ€™t have any concept of error codes).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jmg-duarte">@jmg-duarte</a> on 2022-10-30 11:15</div>
            <div class="timeline-body"><p>Hey @charliermarsh (and others) I've been kept busy by other things and I haven't had time to handle this. Just wanted to let you and others know that if someone want to pick this up, it's okay since I can't guarantee I'll make a PR on time.</p>
<p>Sorry about this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-10-30 13:36</div>
            <div class="timeline-body"><p>No worries! No obligation on your part of course. Appreciate the interest, hope you're able to contribute at some point in the future :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chammika-become">@chammika-become</a> on 2022-11-07 03:47</div>
            <div class="timeline-body"><p>@charliermarsh ðŸ‘‹  I attempted at this. Thanks for the awesome explanation above. I managed to get 1-3 steps with the above PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-12 16:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:22 UTC
    </footer>
</body>
</html>
