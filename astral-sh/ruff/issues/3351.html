<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLE1205 and loguru &quot;false positive&quot; - astral-sh/ruff #3351</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLE1205 and loguru &quot;false positive&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3351">#3351</a>
        opened by <a href="https://github.com/OMEGARAZER">@OMEGARAZER</a>
        on 2023-03-05 20:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/OMEGARAZER">@OMEGARAZER</a></div>
            <div class="timeline-body"><p>Not sure if this is something that can actually be done, but I figured it might be worth mentioning, in case someone else runs into this as it took me a bit (longer than it should have anyway) to realize that the check seems specific to the base logging module.</p>
<p>It can obviously be set as an ignore but I think it would be great if Ruff could detect in the PLE1205 check that <a href="https://github.com/Delgan/loguru">Loguru</a> is being used and ignore the lines or check that they are properly formatted for the module that's being used.</p>
<pre><code class="language-python">from loguru import logger

filename = &quot;test_file.txt&quot;
directory = &quot;/tmp&quot;
logger.info(&quot;Downloaded {} to {} successfully&quot;, filename, directory)
</code></pre>
<pre><code class="language-bash">ruff --version
ruff 0.0.254

ruff test.py --select=PLE
test.py:5:1: PLE1205 Too many arguments for `logging` format string
  |
5 | logger.info(&quot;Downloaded {} to {} successfully&quot;, filename, directory)
  | ^^^^^^^^^^^ PLE1205
  |

Found 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-05 20:22</div>
            <div class="timeline-body"><p>Oh interesting. We could ignore <code>loguru</code> there. We generally match on variable names like <code>logger</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-03-05 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/OMEGARAZER">@OMEGARAZER</a> on 2023-03-05 20:27</div>
            <div class="timeline-body"><p>Yeah, that's what I figured was happening but not knowing rust well I didn't dig into the inner workings too far to verify.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @charliermarsh on 2023-03-06 23:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/actionless">@actionless</a> on 2023-03-11 07:08</div>
            <div class="timeline-body"><p>i have same problem, not related to <code>loguru</code>, just seems <code>ruff</code> not support new-style (<code>{}</code>) formatting inside logging func</p>
<p>in pylint itself that could be configured as:</p>
<pre><code>[LOGGING]
logging-modules=logging
logging-format-style=new
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-12 05:27</div>
            <div class="timeline-body"><p>Mmm yeah, we're likely not supporting that properly. Is that part of the standard library <code>logging</code> module, or something else? Feel like I'm being dumb:</p>
<pre><code class="language-py">&gt;&gt;&gt; logging.info(&quot;foo: {}&quot;, &quot;foo&quot;)
--- Logging error ---
Traceback (most recent call last):
  File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.10.10/lib/python3.10/logging/__init__.py&quot;, line 1100, in emit
    msg = self.format(record)
  File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.10.10/lib/python3.10/logging/__init__.py&quot;, line 943, in format
    return fmt.format(record)
  File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.10.10/lib/python3.10/logging/__init__.py&quot;, line 678, in format
    record.message = record.getMessage()
  File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.10.10/lib/python3.10/logging/__init__.py&quot;, line 368, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
Message: 'foo: {}'
Arguments: ('foo',)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/actionless">@actionless</a> on 2023-03-12 11:04</div>
            <div class="timeline-body"><p>my bad - i've just realized that <code>logging</code> is a local module in the project with the same name ü§¶
just because i saw it in my pylint config i thought it's part of the default</p>
<p>and handling smth like this (https://stackoverflow.com/a/26003573) would indeed require type inference, i suppose</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/axd1x8a">@axd1x8a</a> on 2023-03-13 15:27</div>
            <div class="timeline-body"><p>It is possible in the standard logging, even if it is <a href="https://docs.python.org/3/howto/logging-cookbook.html#use-of-alternative-formatting-styles">not so easy</a>, for example, I <a href="https://github.com/vkbottle/vkbottle/blob/ef9f5ead0c804a1cfcfae7202779f67dd41204e7/vkbottle/modules.py#L54-L83">use this</a> to give users a choice between logguru/logging</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/actionless">@actionless</a> on 2023-03-13 22:29</div>
            <div class="timeline-body"><p>actually even after renaming the module i still can reproduce it:</p>
<pre><code class="language-python">import sys
from typing import Any


class PikaurLogger:
    def __init__(
            self, module_name: str, color: int,
    ) -&gt; None:
        self.module_name = module_name
        self.color = color

    def debug(
        self, msg: &quot;Any&quot;, *args: &quot;Any&quot;, **kwargs: &quot;Any&quot;,
    ) -&gt; None:
        str_message = msg.format(*args, **kwargs) if isinstance(msg, str) else str(msg)
        msg = f&quot;{self.module_name}: {str_message}\n&quot;
        sys.stderr.write(msg)


logger = PikaurLogger(module_name=&quot;build&quot;, color=1)
logger.debug(&quot;Build dir: {}&quot;, &quot;foo&quot;)
</code></pre>
<pre><code class="language-console">$ ./env/bin/ruff test_PLE1205.py
test_PLE1205.py:21:1: PLE1205 Too many arguments for `logging` format string
Found 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-13 22:35</div>
            <div class="timeline-body"><p>Ah yeah, we match on the name of the logging object (in this case, <code>logger</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 18:10</div>
            <div class="timeline-body"><p>I think the <em>original</em> issue here is resolved, Ruff no longer flags imports from modules apart from <code>logging</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-24 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/actionless">@actionless</a> on 2023-07-24 18:17</div>
            <div class="timeline-body"><p>can confirm üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2023-09-01 00:02</div>
            <div class="timeline-body"><p>Hello,</p>
<p>It seems this is back,
<img src="https://github.com/astral-sh/ruff/assets/1145623/66299f7e-126d-4f21-8491-890c3cb46e41" alt="image" /></p>
<p>Version 0.0.286</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-01 00:04</div>
            <div class="timeline-body"><p>Can you share a complete reproduction? Note that Ruff will only avoid flagging these objects if they‚Äôre defined in another file and imported (rather than defined and used in the same file).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2023-09-01 00:06</div>
            <div class="timeline-body"><pre><code class="language-python">
import loguru

logger = loguru.logger
var = &quot;Hello, World!&quot;
logger.debug(&quot;{}&quot;, var)
</code></pre>
<p><img src="https://github.com/astral-sh/ruff/assets/1145623/bb1f682e-b91a-4a52-a310-63f78423782a" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-01 00:08</div>
            <div class="timeline-body"><p>Thanks! This is a known limitation of the rule ‚Äî we can‚Äôt trace arbitrary local references. I‚Äôd recommend disabling these rules entirely if you‚Äôre using a separate logging library like loguru, or importing a logger from a common file, or using loguru.debug directly rather than aliasing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2023-09-01 00:09</div>
            <div class="timeline-body"><p>Thank you for the info! I might disable it for now.</p>
<p>Cheers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-01 00:16</div>
            <div class="timeline-body"><p>Out of curiosity: is that roughly the pattern you‚Äôre using in your real code? (Assigning loguru.logger to logger.) Or is it more complex in practice?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2023-09-01 00:36</div>
            <div class="timeline-body"><p>I have a logger manager object that returns a logger, for some older apps returns a logging logger for new versions a loguru logger, the manager does a lot of the setup depending of the host.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:46:43 UTC
    </footer>
</body>
</html>
