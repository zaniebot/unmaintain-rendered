<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server setting to run subset of rules for &quot;Fix All&quot; code action - astral-sh/ruff #12709</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Server setting to run subset of rules for &quot;Fix All&quot; code action</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12709">#12709</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-08-06 06:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>Discussion: <a href="https://github.com/astral-sh/ruff/pull/12674">astral-sh/ruff#12674</a></p>
<p>It would be useful to provide a server (and VS Code extension) setting to allow including / excluding only a subset of rules to be fixed when running the <code>source.fixAll.ruff</code> code actions on save.</p>
Notes
<ul>
<li>It&#x27;s important that this is only considered when running the code action on save and not when running it manually. This is present in the request payload under the <code>context</code> field as <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#codeActionTriggerKind"><code>CodeActionTriggerKind</code></a>.</li>
<li>This is a filter which is applied on top of the rule selection as done via a config file / server setting.</li>
</ul>
<p>For prior art, refer to <code>eslint.codeActionsOnSave.rules</code>. This allows for patterns and allows negation as well. Search for &quot;eslint.codeActionsOnSave.rules&quot; in https://github.com/microsoft/vscode-eslint#settings-options for examples.</p>
<p>We could introduce a similar option <code>ruff.codeActionsOnSave.rules</code> but I don&#x27;t think we should allow for patterns in it. Our rule selection allows for shorter codes that negates the need for <code>*</code> pattern. But, we do need to consider about a config to exclude rules instead of including them.</p>
<p>One option would be to provide both <code>include</code> and <code>exclude</code> field like so:</p>
<pre><code>{
	&quot;ruff.codeActionsOnSave.rules&quot;: {
		&quot;include&quot;: [],
		&quot;exclude&quot;: [],
	}
}
</code></pre>
<p>Or, allow a negation pattern using <code>!</code>:</p>
<pre><code>{
	&quot;ruff.codeActionsOnSave.rules&quot;: [
		&quot;!F401&quot;,
	]
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-06 06:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-06 06:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-06 06:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-11 08:52</div>
            <div class="timeline-body"><p>Cross linking from the discussion thread: https://github.com/astral-sh/ruff/discussions/15991#discussioncomment-12127123</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-03 06:51</div>
            <div class="timeline-body"><p>The latest version of Ruff (<code>0.9.8</code>) expanded <code>ruff.configuration</code> to accept a JSON object representing the Ruff config. Read more about it in the docs: https://docs.astral.sh/ruff/editors/settings/#configuration.</p>
<hr>
<p>Cross posting from <a href="https://github.com/astral-sh/ruff-vscode/issues/260">astral-sh/ruff-vscode#260</a>#issuecomment-2689725523</p>
<p>I think <code>ruff.configuration</code> can partially resolve this issue i.e., a user can configure Ruff in an editor context to mark certain rules as <code>unfixable</code> which will then be considered when applying code actions on save. But, it&#x27;ll also mean that those won&#x27;t show up in the lightbulb menu nor as a &quot;Quick fix&quot; in the diagnostic popup.</p>
<p>Consider this example config:</p>
<pre><code>{
  &quot;ruff.configuration&quot;: {
    &quot;lint&quot;: {
      &quot;unfixable&quot;: [&quot;F541&quot;]
    }
  }
}
</code></pre>
<p>But, this might still be useful to provide so that the user still have the option to fix it if they want to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-03-03 10:45</div>
            <div class="timeline-body"><p>A simpler proposal from <a href="https://github.com/astral-sh/ruff-vscode/issues/260">astral-sh/ruff-vscode#260</a>#issuecomment-2692187606 which then will apply configuration for specific code actions.
For example, <code>source.fixAll</code>:</p>
<pre><code>&quot;editor.codeActionsOnSave&quot;: {
    &quot;source.fixAll&quot;: &quot;explicit&quot;
},

                 // also: organizeImports/format
&quot;ruff.configuration.fixAll&quot;: {
    &quot;lint&quot;: {
      &quot;unfixable&quot;: [&quot;F541&quot;]
    }
}
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:56 UTC
    </footer>
</body>
</html>
