<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCH rules triggered even if class is declared in `runtime-evaluated-base-classes` - astral-sh/ruff #10749</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>TCH rules triggered even if class is declared in <code>runtime-evaluated-base-classes</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10749">#10749</a>
        opened by <a href="https://github.com/mtvx">@mtvx</a>
        on 2024-04-03 08:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mtvx">@mtvx</a></div>
            <div class="timeline-body"><p>Despite declaring <code>datetime.date</code> as needed for runtime evaluation in <code>runtime-evaluated-base-classes</code>, Ruff nags about it and wants to move it to <code>if TYPE_CHECKING</code> block.</p>
<p><code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.ruff.lint]
select = [
    &quot;TCH&quot;,  # flake8-type-checking
]

[tool.ruff.lint.flake8-type-checking]
runtime-evaluated-base-classes = [
    &quot;datetime.date&quot;,
    &quot;date&quot;,
]
</code></pre>
<p>With <code>example.py</code>:</p>
<pre><code class="language-py">from __future__ import annotations

from datetime import date

from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column


class Birthday(DeclarativeBase):
    id: Mapped[int] = mapped_column(primary_key=True)
    day: Mapped[date]
</code></pre>
<pre><code class="language-console">&gt; ruff check example.py
example.py:3:22: TCH003 Move standard library import `datetime.date` into a type-checking block
Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
<p>Isn't the idea that classes declared in <code>runtime-evaluated-base-classes</code> would be ignored from this check?</p>
<p>Ruff <code>0.3.5</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-04-03 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-04 09:32</div>
            <div class="timeline-body"><p>@charliermarsh do you know if that's intentional or considered a bug?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-04 15:34</div>
            <div class="timeline-body"><p>I think this is intentional, since the <code>runtime-evaluated-base-classes</code> should be base classes rather than those used in the annotations. So, e.g., in this case, you'd want:</p>
<pre><code class="language-toml">[tool.ruff.lint.flake8-type-checking]
runtime-evaluated-base-classes = [
    &quot;sqlalchemy.orm.DeclarativeBase&quot;
]
</code></pre>
<p>Can you give that a try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> removed by @charliermarsh on 2024-04-04 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-04 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mtvx">@mtvx</a> on 2024-04-04 17:45</div>
            <div class="timeline-body"><p>Jeez. Yes, that works. Thanks.</p>
<p>Obviously the reader (me) misunderstood. The docs state:</p>
<blockquote>
<p><em>Exempt classes</em> that list any of the enumerated classes as a base class <em>from needing to be moved into type-checking blocks</em>.</p>
</blockquote>
<p>I don't know, but maybe that's a bit difficult to understand, at least for me, a non-native English speaker. Gives the impression that it's about excluding the classes that would be otherwise moved to the type-checking block.</p>
<p>The rest of the docs there is totally understandable, and it even gives correct examples. I guess my mind just had already made its mind based on the first sentence.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mtvx on 2024-04-04 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pySilver">@pySilver</a> on 2024-10-25 10:07</div>
            <div class="timeline-body"><p>@mtvx same thing - I've had an impression that this setting is about imported classes, not our own.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:00 UTC
    </footer>
</body>
</html>
