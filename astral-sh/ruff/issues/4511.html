<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0.0.269 seems to have broken ruff's pyupgrade configuration - astral-sh/ruff #4511</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>0.0.269 seems to have broken ruff's pyupgrade configuration</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4511">#4511</a>
        opened by <a href="https://github.com/Julian">@Julian</a>
        on 2023-05-18 21:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Julian">@Julian</a> on 2023-05-18 21:15</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Sections called <code>tool.ruff.pyupgrade</code> (in a pyproject.toml) seem to cause ruff to crash in 0.0.269.</p>
<p>Specifically, given a trivial project:</p>
<pre><code>~/Desktop/bar 
⊙  tree                                                                                                                                                                                                                                               julian@Airm
.
├── foo.py
└── pyproject.toml

1 directory, 2 files

~/Desktop/bar 
⊙  cat foo.py                                                                                                                                                                                                                                         julian@Airm

~/Desktop/bar 
⊙  cat pyproject.toml                                                                                                                                                                                                                                 julian@Airm
[build-system]
requires = [&quot;hatchling&quot;, &quot;hatch-vcs&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;bar&quot;
description = &quot;bar&quot;
requires-python = &quot;&gt;=3.8&quot;
version = &quot;0.1.0&quot;

[tool.ruff]
line-length = 79
target-version = &quot;py38&quot;
select = [&quot;ANN&quot;, &quot;B&quot;, &quot;D&quot;, &quot;D204&quot;, &quot;E&quot;, &quot;F&quot;, &quot;Q&quot;, &quot;SIM&quot;, &quot;UP&quot;, &quot;W&quot;]

[tool.ruff.pyupgrade]
# We support 3.8 + 3.9
keep-runtime-typing = true
</code></pre>
<p>ruff 0.0.269 crashes with:</p>
<pre><code>⊙  python3.11 -m venv venv; venv/bin/python -m pip install ruff==0.0.269 &amp;&amp; venv/bin/ruff check .                                                                                                                                                     julian@Airm
Collecting ruff==0.0.269
  Using cached ruff-0.0.269-py3-none-macosx_10_9_x86_64.macosx_11_0_arm64.macosx_10_9_universal2.whl (10.1 MB)
Installing collected packages: ruff
Successfully installed ruff-0.0.269

[notice] A new release of pip is available: 23.0.1 -&gt; 23.1.2
[notice] To update, run: /Users/julian/Desktop/bar/venv/bin/python -m pip install --upgrade pip
error: TOML parse error at line 16, column 12
   |
16 | [tool.ruff.pyupgrade]
   |            ^^^^^^^^^
unknown field `pyupgrade`, expected one of `allowed-confusables`, `builtins`, `cache-dir`, `dummy-variable-rgx`, `exclude`, `extend`, `extend-exclude`, `extend-include`, `extend-ignore`, `extend-select`, `external`, `fix`, `fix-only`, `fixable`, `format`, `force-exclude`, `ignore`, `ignore-init-module-imports`, `include`, `line-length`, `required-version`, `respect-gitignore`, `select`, `show-source`, `show-fixes`, `src`, `namespace-packages`, `target-version`, `task-tags`, `typing-modules`, `unfixable`, `flake8-annotations`, `flake8-bandit`, `flake8-bugbear`, `flake8-builtins`, `flake8-comprehensions`, `flake8-errmsg`, `flake8-quotes`, `flake8-self`, `flake8-tidy-imports`, `flake8-type-checking`, `flake8-gettext`, `flake8-implicit-str-concat`, `flake8-import-conventions`, `flake8-pytest-style`, `flake8-unused-arguments`, `isort`, `mccabe`, `pep8-naming`, `pycodestyle`, `pydocstyle`, `pylint`, `per-file-ignores`
</code></pre>
<p>ruff 0.0.267 runs fine:</p>
<pre><code>⊙  python3.11 -m venv venv; venv/bin/python -m pip install ruff==0.0.267 &amp;&amp; venv/bin/ruff check .                                                                                                                                                     julian@Airm
Collecting ruff==0.0.267
  Using cached ruff-0.0.267-py3-none-macosx_10_9_x86_64.macosx_11_0_arm64.macosx_10_9_universal2.whl (10.1 MB)
Installing collected packages: ruff
Successfully installed ruff-0.0.267

[notice] A new release of pip is available: 23.0.1 -&gt; 23.1.2
[notice] To update, run: /Users/julian/Desktop/bar/venv/bin/python -m pip install --upgrade pip
warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible. Ignoring `one-blank-line-before-class`.
warning: `multi-line-summary-first-line` (D212) and `multi-line-summary-second-line` (D213) are incompatible. Ignoring `multi-line-summary-second-line`.
foo.py:1:1: D100 Missing docstring in public module
Found 1 error.
</code></pre>
<p>Is there some intended change there or perhaps just an allowlist missing an entry? I also can't tell what possibly could be causing the change from a 2 second look at the last 2 commits, but I'm sure it might make sense to you fine folks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Julian">@Julian</a> on 2023-05-18 21:17</div>
            <div class="timeline-body"><p>Ah I see, this is https://github.com/charliermarsh/ruff/blob/d4c0a41b00b0093dac3bcf79ee329e351a5583b4/BREAKING_CHANGES.md?plain=1#L5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Julian on 2023-05-18 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-18 21:30</div>
            <div class="timeline-body"><p>Yeah sorry about this -- let me know if you have any questions. It turns out that setting is exactly equivalent to turning off those rules, so we opted to remove it to avoid special-casing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Julian">@Julian</a> on 2023-05-18 21:34</div>
            <div class="timeline-body"><p>I'm going to have a lot of repos to update :D -- but yeah I understand not having multiple mechanisms.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
