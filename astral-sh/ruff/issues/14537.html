<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request: More autofixes for `redundant-none-literal`/`PYI061` - astral-sh/ruff #14537</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Request: More autofixes for `redundant-none-literal`/`PYI061`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14537">#14537</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2024-11-22 19:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Avasam">@Avasam</a> on 2024-11-22 19:04</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<ul>
<li>A minimal code snippet that reproduces the bug.
https://docs.astral.sh/ruff/rules/redundant-none-literal mentions that the rule is sometimes autofixable, but I landed on the following cases which are not autofixed and I believe should:</li>
</ul>
<pre><code class="language-py">def get_rotation(rotation: float | Literal[None, &quot;horizontal&quot;, &quot;vertical&quot;]) -&gt; float: ...

def spy(
    Z,
    precision: float | Literal[&quot;present&quot;] = ...,
    marker=...,
    markersize=...,
    aspect: Literal[&quot;equal&quot;, &quot;auto&quot;, None] | float = ...,
    origin: Literal[&quot;upper&quot;, &quot;lower&quot;] = ...,
    **kwargs,
) -&gt; tuple[AxesImage, Line2D]: ...

class Axes(_AxesBase):
    def spy(
        self,
        Z,
        precision: float | Literal[&quot;present&quot;] = 0,
        marker=...,
        markersize=...,
        aspect: Literal[&quot;equal&quot;, &quot;auto&quot;, None] | float = &quot;equal&quot;,
        origin: Literal[&quot;upper&quot;, &quot;lower&quot;] = ...,
        **kwargs,
    ) -&gt; AxesImage | Line2D: ...
</code></pre>
<ul>
<li><p>The command you invoked
<code>ruff check --fix --preview --select=PYI061 --isolated</code></p>
</li>
<li><p>The current Ruff version (<code>ruff --version</code>).
ruff 0.8.0</p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../microsoft/python-type-stubs/pulls/340.html">microsoft/python-type-stubs#340</a> on 2024-11-22 19:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2024-11-22 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @AlexWaygood on 2024-11-22 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @AlexWaygood on 2024-11-22 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kiran-4444">@kiran-4444</a> on 2024-11-27 17:51</div>
            <div class="timeline-body"><p>Iâ€™d like to take this up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @kiran-4444 by @MichaReiser on 2024-11-27 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kiran-4444">@kiran-4444</a> on 2024-12-06 05:53</div>
            <div class="timeline-body"><p>So, if I understand this correctly the rule <code>PYI061</code> is working for snippets like this:</p>
<pre><code class="language-python">from typing import Literal

a: Literal[None]
b: Literal[1, 2, 3, &quot;foo&quot;, 5, None]
</code></pre>
<p>which gets auto-fixed to:</p>
<pre><code class="language-python">from typing import Literal

a: None
b: Literal[1, 2, 3, &quot;foo&quot;, 5, None]
</code></pre>
<p>Here, I can see that the second statement isn't getting fixed. Is this the issue about? To fix things like this adhering to PYI061?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-12-06 16:58</div>
            <div class="timeline-body"><p>@kiran-4444 Exactly. Even the error message alludes to this being possible to autofix, just not implemented:</p>
<pre><code class="language-py">PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
  |
3 | a: None
4 | b: Literal[1, 2, 3, &quot;foo&quot;, 5, None]
  |                               ^^^^ PYI061
  |
  = help: Replace with `Literal[...] | None`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14872.html">astral-sh/ruff#14872</a> on 2024-12-09 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-15 02:09</div>
            <div class="timeline-body"><p>This seems to have been resolved by #14872.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-12-15 03:30</div>
            <div class="timeline-body"><p>Yep, Looks like this is closed by https://github.com/astral-sh/ruff/pull/14872 !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Avasam on 2024-12-15 03:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-01-28 20:53</div>
            <div class="timeline-body"><p>Hmmm, I'm on <code>0.9.3</code> and all three of my example cases don't yet autofix:
<code>ruff check --fix --unsafe-fixes --preview</code></p>
<pre><code>stubs\matplotlib\axes\_axes.pyi:577:42: PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
    |
575 |         marker=...,
576 |         markersize=...,
577 |         aspect: Literal[&quot;equal&quot;, &quot;auto&quot;, None] | float = &quot;equal&quot;,
    |                                          ^^^^ PYI061
578 |         origin: Literal[&quot;upper&quot;, &quot;lower&quot;] = ...,
579 |         **kwargs,
    |
    = help: Replace with `Literal[...] | None`

stubs\matplotlib\pyplot.pyi:715:38: PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
    |
713 |     marker=...,
714 |     markersize=...,
715 |     aspect: Literal[&quot;equal&quot;, &quot;auto&quot;, None] | float = ...,
    |                                      ^^^^ PYI061
716 |     origin: Literal[&quot;upper&quot;, &quot;lower&quot;] = ...,
717 |     **kwargs,
    |
    = help: Replace with `Literal[...] | None`

stubs\matplotlib\text.pyi:16:44: PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
   |
14 | from .transforms import Bbox, Transform
15 |
16 | def get_rotation(rotation: float | Literal[None, &quot;horizontal&quot;, &quot;vertical&quot;]) -&gt; float: ...
   |                                            ^^^^ PYI061
17 |
18 | class Text(Artist):
   |
   = help: Replace with `Literal[...] | None`

Found 3 errors.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-28 20:54</div>
            <div class="timeline-body"><p>Fixes just fine for me in the playground: https://play.ruff.rs/fd2b0091-14e2-44e2-9208-983d8e9c1862</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-01-28 21:06</div>
            <div class="timeline-body"><p>I get it: on Python 3.9 the fix isn't offered at all rather than being &quot;unsafe&quot; (or using <code>Union</code>). I must've tested on 3.10 when I marked the issue as closed.
https://github.com/astral-sh/ruff/pull/14872#pullrequestreview-2500627900</p>
<blockquote>
<p>We can't safely offer the fix with the <code>|</code> syntax on Python &lt;=3.9, as the <code>|</code> syntax for unions was added in Python 3.10. Possibly we could in the future use <code>typing.Union</code> for the fix and offer it even on older versions of Python, but I think we can leave that to another PR :-)</p>
</blockquote>
<p>So I guess the fix being marked as unsafe but available was also left aside in that PR. I'll open a different issue for that specific use-case !</p>
<p>Done here: https://github.com/astral-sh/ruff/issues/15795</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
