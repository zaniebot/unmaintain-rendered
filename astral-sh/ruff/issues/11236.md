```yaml
number: 11236
title: "`ruff server` fails to work in Neovim or Helix when outside of a workspace"
type: issue
state: closed
author: snowsignal
labels:
  - bug
  - server
assignees: []
created_at: 2024-05-02T03:35:20Z
updated_at: 2024-05-22T20:50:59Z
url: https://github.com/astral-sh/ruff/issues/11236
synced_at: 2026-01-10T01:56:52Z
```

# `ruff server` fails to work in Neovim or Helix when outside of a workspace

---

_Issue opened by @snowsignal on 2024-05-02 03:35_

By 'workspace', I mean a working directory that has a `pyproject.toml`/`ruff.toml` configuration file. When `hx` is used outside of a workspace, the server simply does not work with any opened files. None of the functions the server provides work as expected.

These are the associated error logs:
```
2024-05-01T20:30:48.048 helix_lsp::transport [ERROR] ruff err <- "‚îú‚îÄ   0.003277s   0ms WARN ruff_server::session::workspace Workspace not found for file:///<filepath>. Global settings will be used for this document\n"
2024-05-01T20:30:48.048 helix_lsp::transport [ERROR] ruff err <- "   0.003399s ERROR ruff_server::server::api An error occurred while running textDocument/didOpen: Unable to take snapshot for document with URL file:///<filepath>
```

My assumption is that we don't register a workspace on the server that can 'capture' the opened file, which means that the document is never registered as open (thus, we are unable to take a snapshot of it). We need a better way to handle documents outside of an existing workspace (the best solution may just be to instantiate a new workspace in the session when this happens).

## Workaround

To work around this issue, create an empty configuration file from the directory where you launch the editor, using `touch ruff.toml`.

---

_Label `bug` added by @snowsignal on 2024-05-02 03:35_

---

_Label `server` added by @snowsignal on 2024-05-02 03:35_

---

_Assigned to @snowsignal by @snowsignal on 2024-05-02 03:35_

---

_Comment by @dhruvmanila on 2024-05-02 06:20_

Is this problem similar to the one solved in https://github.com/astral-sh/ruff/pull/10398 ?

---

_Comment by @snowsignal on 2024-05-02 17:19_

Yep, it's a related issue üëç 

---

_Renamed from "`ruff server` fails to work in Helix when outside of a workspace" to "`ruff server` fails to work in Neovim or Helix when outside of a workspace" by @snowsignal on 2024-05-08 21:03_

---

_Comment by @snowsignal on 2024-05-08 21:03_

Update: This is also happening on Neovim.

---

_Referenced in [astral-sh/ruff#11497](../../astral-sh/ruff/pulls/11497.md) on 2024-05-22 20:08_

---

_Closed by @snowsignal on 2024-05-22 20:50_

---
