<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM300 (yoda-conditions) false positive: `assert X &lt; datetime.timedelta(...)` - astral-sh/ruff #13754</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>SIM300 (yoda-conditions) false positive: `assert X &lt; datetime.timedelta(...)`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13754">#13754</a>
        opened by <a href="https://github.com/rdaysky">@rdaysky</a>
        on 2024-10-15 02:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rdaysky">@rdaysky</a> on 2024-10-15 02:36</div>
            <div class="timeline-body"><p>I implemented an algorithm that can only handle certain values of a parameter. To make sure future updates to the code don’t bring it outside the allowed range, I added an assertion. This triggered SIM300:</p>
<pre><code>DURATION = datetime.timedelta(hours=1)

assert DURATION &lt; datetime.timedelta(days=1), &quot;algorithm breaks on large durations&quot;
</code></pre>
<p>Ruff apparently thinks that a call to a class constructor is the thing being tested and the constant is the reference value, while actually it’s the other way round. Not sure how the definition of the rule could be updated so it would see things like this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-10-22 06:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2024-10-22 06:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-09 19:39</div>
            <div class="timeline-body"><p>I think the rule is &quot;correct&quot; in that the all-capitalized <code>DURATION</code> is typically used as the convention to indicate a constant. Why stylize it that way?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2024-11-09 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @charliermarsh on 2024-11-09 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-09 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rdaysky">@rdaysky</a> on 2024-11-09 19:47</div>
            <div class="timeline-body"><p>It follows the convention to indicate a constant because it is a constant. And the subsequent assertion compares it against another constant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-09 19:59</div>
            <div class="timeline-body"><p>I think I understand what you're doing but it's a fairly unusual test. You're validating that a statically-defined constant is less than some threshold value? I don't know that it makes sense to adjust the rule in favor of this, it seems pretty rare.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-26 03:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
