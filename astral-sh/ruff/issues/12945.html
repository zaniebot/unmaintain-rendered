<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyUpgrade rule UP007 does not work on forward reference string types - astral-sh/ruff #12945</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PyUpgrade rule UP007 does not work on forward reference string types</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/12945">#12945</a>
        opened by <a href="https://github.com/goodspark">@goodspark</a>
        on 2024-08-17 00:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/goodspark">@goodspark</a> on 2024-08-17 00:28</div>
            <div class="timeline-body"><p>Keywords: forward reference, pyupgrade, UP007</p>
<p>Python 3.12, also 3.10
Ruff 0.6.1, also 0.5.7
Command: <code>ruff check .</code></p>
<p>Code:</p>
<p>Python file</p>
<pre><code class="language-py">x: Optional['Something']  # expect UP007 to trigger here -&gt; x: 'Something | None'
y: Union[int, 'Something']  # expect UP007 to trigger here -&gt; y: 'Something | int'
x2: Optional[Something]  # correctly caught by UP007
y2: Union[int, Something]  # correctly caught by UP007
class Something:
  pass
</code></pre>
<p>pyproject.toml</p>
<pre><code class="language-toml">[project]
# As long as this is &gt;=3.10 or any subset, like ==3.10, this bug will occur.
requires-python = &quot;&gt;=3.12&quot;

[tool.ruff.lint]
extend-select = [&quot;UP&quot;]
extend-safe-fixes = [&quot;UP007&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "PyUpgrade rule UP007 do not work on forward reference string types" to "PyUpgrade rule UP007 does not work on forward reference string types" by @goodspark on 2024-08-17 00:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:25</div>
            <div class="timeline-body"><p>I believe that's because <code>'Something' | None</code> is not a valid type annotation -- it will error at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:26</div>
            <div class="timeline-body"><p>If you add <code>from __future__ import annotations</code>, we do correctly flag all four, since the type annotations are then deferred.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-08-18 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:26</div>
            <div class="timeline-body"><p>So I think this is working as intended, AFAICT.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/goodspark">@goodspark</a> on 2024-08-19 17:21</div>
            <div class="timeline-body"><p>I guess another fix I was envisioning was <code>&quot;Something | None&quot;</code> (note both Something and None are in strings).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
