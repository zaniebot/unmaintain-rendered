<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive for unused import when bringing things forward in __init__.py - astral-sh/ruff #10253</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive for unused import when bringing things forward in <strong>init</strong>.py</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10253">#10253</a>
        opened by <a href="https://github.com/robvdl">@robvdl</a>
        on 2024-03-06 19:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/robvdl">@robvdl</a></div>
            <div class="timeline-body"><p>In <code>myapp/forms/__init__.py</code>:</p>
<pre><code class="language-python">from .login import LoginForm
</code></pre>
<p>In <code>myapp/views/auth.py</code>:</p>
<pre><code class="language-python">from myapp.forms import LoginForm`
</code></pre>
<p>ruff says that LoginForm in <code>forms/__init__.py</code> is unused, it's totally wrong because views/auth.py imports and uses it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 19:14</div>
            <div class="timeline-body"><p>Example code here I was trying to add ruff to which triggered this bug https://github.com/wainuiomata/sambal</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-03-06 19:16</div>
            <div class="timeline-body"><p>It's correct that it's unused in <code>myapp/forms/__init__.py</code>.
The fix would be to define a <code>__all__</code> list/tuple in there too (as Ruff treats that as usage):</p>
<pre><code class="language-py">from .login import LoginForm

__all__ = (&quot;LoginForm&quot;,)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 19:20</div>
            <div class="timeline-body"><p>I'm not sure I agree with this, other linters will notice it unusued.</p>
<p>You appear to be defending a bug, I'm OK with doing the <code>__all__</code> thing but don't defend a bug, ruff should also should realise it's actually used if it really is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-03-06 19:22</div>
            <div class="timeline-body"><p>I simply don't think it's a bug, I always define an <code>__all__</code> in my <code>__init__.py</code> files and it's helpful to know I missed an object somewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 19:25</div>
            <div class="timeline-body"><p>It is a bug, it's ruff not able to track this import in views/auth.py properly.</p>
<p>Both pyflakes and PyCharms's linter can do this, so please don't defend this as NOT being a bug.</p>
<p>It's not that I mind doing the <code>__all__</code> thing but it is still a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-03-06 19:30</div>
            <div class="timeline-body"><p>That's your opinion :thumbsup:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2024-03-06 19:36</div>
            <div class="timeline-body"><p>For what it's worth, I think mypy and Pyright on their respective strict modes will also complain about not explicitly exporting via the <code>__all__</code> attribute.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 19:46</div>
            <div class="timeline-body"><p>I've never heard of Pyright, but so far I have found 3 linters that can track an import being forwarded in <code>__init__.py</code>.</p>
<ul>
<li>pyflakes</li>
<li>pylint</li>
<li>PyCharm</li>
</ul>
<p>So it doesn't look good if both pyflakes and pylint can track this import, but not ruf. You are trying to get users right, because this &quot;I'm right, you're wrong&quot; behaviour is annoying.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2024-03-06 19:53</div>
            <div class="timeline-body"><p>To be clear, @trag1c and I are not members of Astral, we're just fellow users trying to contribute! Sorry to hear you find my opinion annoying, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 19:56</div>
            <div class="timeline-body"><p>Sorry I'm trying to legitimately report a bug here and I felt I was getting fight back, I didn't realise you weren't official devs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 19:57</div>
            <div class="timeline-body"><p>In the mean time I have put the <code>__all__</code> thing in it, I just want Astral to look at this rather than sweep it under the carpet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-06 19:59</div>
            <div class="timeline-body"><p>Hey @robvdl thanks for the report. Unfortunately we don't track imports across files, so the assumption is that you either disable <code>F401</code> in <code>__init__.py</code> files, or use some other mechanism to make it explicit that this is a re-export -- for example, adding to <code>__all__</code>, or using the re-export convention of <code>from .login import LoginForm as LoginForm</code>. (I know you already heard some of this above, but perhaps the re-export convention will be interesting to you.)</p>
<p>Ideally we would be able to track these across files, so it's fine to call it a bug (and we're planning to explore multi-file analysis over the next few months). The only caveat is that... even then it's not <em>totally</em> clear that it'd be safe to remove <code>from .login import Login</code>, since you're defining a public interface, and you could have users of your package that rely on <code>Login</code> being exported there.</p>
<p>As an aside, PyFlakes would also flag this. I'm not sure how you tested it, but PyFlakes doesn't look across files either:</p>
<pre><code>❯ flake8 foo/
foo/__init__.py:1:1: F401 '.login.LoginForm' imported but unused
</code></pre>
<p>Regardless, thanks for the report! That we don't detect these across files is a limitation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2024-03-06 20:07</div>
            <div class="timeline-body"><p>Thank you, yeah in the mean time I have gone with the <code>__all__</code> method which I am a little more comfortable with than doing something like this:</p>
<pre><code class="language-toml"># 4. Ignore `E402` (import violations) in all `__init__.py` files.
[tool.ruff.lint.per-file-ignores]
&quot;__init__.py&quot; = [&quot;E402&quot;]
</code></pre>
<p>I'll leave it at that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-06 20:11</div>
            <div class="timeline-body"><p>We've also considered <em>not</em> enforcing unused imports in <code>__init__.py</code> files by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-03-07 08:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> added by @MichaReiser on 2024-03-07 08:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @MichaReiser on 2024-10-24 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> removed by @MichaReiser on 2024-10-24 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/umarbutler">@umarbutler</a> on 2025-02-18 05:33</div>
            <div class="timeline-body"><p>@charliermarsh Any movement on this? I agree with @robvdl that this is a bug. Having to do <code>__all__</code> goes against DRY, is unintuitive, and is cumbersome.</p>
<p>@robvdl's fix unfortunately doesn't work for me, however, this fix does (in case someone else wants it):</p>
<pre><code class="language-toml">[tool.ruff.lint.per-file-ignores]
&quot;__init__.py&quot; = [&quot;F401&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-18 08:25</div>
            <div class="timeline-body"><p>Ruff doesn't support multifile analysis yet but we're working towards bringing this capability to Ruff. But it will take a while and we then also have to change this specific rule implementation. TLDR: We're moving toward a fix but it is a rather large undertaking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/umarbutler">@umarbutler</a> on 2025-02-19 01:32</div>
            <div class="timeline-body"><blockquote>
<p>Ruff doesn't support multifile analysis yet but we're working towards bringing this capability to Ruff. But it will take a while and we then also have to change this specific rule implementation. TLDR: We're moving toward a fix but it is a rather large undertaking.</p>
</blockquote>
<p>Couldn’t this just be made the default?</p>
<pre><code>[tool.ruff.lint.per-file-ignores]
&quot;__init__.py&quot; = [&quot;F401&quot;]
</code></pre>
<p>If you’re writing a Python package, you may not have any files in the package that reference imports from init so multifile analysis may not help there anyways right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-19 10:06</div>
            <div class="timeline-body"><p>yeah, we could consider adding an option or splitting the <code>__init__.py</code> behavior into its own rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-02-22 17:10</div>
            <div class="timeline-body"><p>I'm surprised to not see anyone mention of</p>
<pre><code class="language-py">from .login import LoginForm as LoginForm
</code></pre>
<p>Which is a canonical way to mark intended re-exports that type-checkers understand, and especially popular in stubs
Edit: I missed Charlie did mention it in https://github.com/astral-sh/ruff/issues/10253#issuecomment-1981682998</p>
<p>That way you don't have to explicitly list and maintain all names in <code>__all__</code></p>
<p>Of course if you use <a href="https://docs.astral.sh/ruff/rules/useless-import-alias/#useless-import-alias-plc0414">useless-import-alias (PLC0414)</a> now that will trigger, so you have to do:</p>
<pre><code class="language-toml">[tool.ruff.lint.per-file-ignores]
&quot;__init__.py&quot; = [&quot;PLC0414&quot;]
</code></pre>
<p>So yeah, feel free to choose how you want to handle your package re-exports, and ignore the relevant code for <code>__init__.py</code> files.</p>
<hr />
<blockquote>
<p>We've also considered <em>not</em> enforcing unused imports in <code>__init__.py</code> files by default.</p>
</blockquote>
<p>As long as it's an option, I'd still prefer being explicit about my intended re-exports.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/robvdl">@robvdl</a> on 2025-02-23 01:49</div>
            <div class="timeline-body"><p>I've never seen this method &quot;from .login import LoginForm as LoginForm&quot; but I can already say I hate it. It's like renaming an import to the same name it already is, it looks awkward and some other developer is going to come along and see it and go &quot;what the heck is this&quot; and remove them all, so you'd then have to place a comment to say why your'e doing that.</p>
<p>I'd rather use the <code>__all__</code> method, but I stand firm by my statement that we shouldn't have to bring imports forward in order for them to be included for linting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/umarbutler">@umarbutler</a> on 2025-02-23 08:08</div>
            <div class="timeline-body"><p>Personally, now that I have my workaround have started adding to all of my project's ruff configs, I'm not as annoyed by this, however, for a new user, there is a real potential for this to be confusing when you literally have 60+ error show up for <strong>init</strong>.py imports (yes, I had quite a lot of <strong>init</strong>.pys in my project) but your Pylance has never complained about that as an error.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:47 UTC
    </footer>
</body>
</html>
