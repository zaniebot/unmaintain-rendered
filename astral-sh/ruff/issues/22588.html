<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lint rule to detect TOML 1.1 specific syntax for `pyproject.toml`, `pylock.toml`, or any other Python packaging TOML file - astral-sh/ruff #22588</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Lint rule to detect TOML 1.1 specific syntax for <code>pyproject.toml</code>, <code>pylock.toml</code>, or any other Python packaging TOML file</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22588">#22588</a>
        opened by <a href="https://github.com/notatallshaw">@notatallshaw</a>
        on 2026-01-14 23:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/notatallshaw">@notatallshaw</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>There is an extensive discussion on DPO packaging about tools adopting TOML 1.1: https://discuss.python.org/t/adopting-toml-1-1/105624</p>
<p>A concern by some is that as some tools become permissive about TOML 1.1 specific syntax that users will write TOML 1.1 specific syntax intentionally, or otherwise, and older tools or tools that choose not to be permissive about TOML 1.1 specific syntax will throw an error.</p>
<p>If enacted I also propose this rule would essentially be deprecated once Python 3.15 has reached end of life (around October 2031).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @amyreese on 2026-01-15 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @amyreese on 2026-01-15 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-15 00:55</div>
            <div class="timeline-body"><p>I like the idea, and this could be a good complement to RUF200.  I think the main concern is the list of files to check, because I think ruff only looks at <code>pyproject.toml</code> right now, and whether there's a good set of libraries and or mechanisms for detecting new toml features like this that won't require owning a toml implementation in ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 07:59</div>
            <div class="timeline-body"><p>Is the concernthat the pyproject.toml isn't backwards compatible when publishing to pypi or that local tools might start failing or is it something else?</p>
<p>If it's the latter, this won't be a rule we can enable by default, because it's overly pedantic if you don't use any such tool (and then it is unnecessarily restrictive).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2026-01-15 13:19</div>
            <div class="timeline-body"><p>Reading a <code>pyproject.toml</code> is needed for installing sdists (e.g. from pypi), archived source files, local building, local running of tools that store their configuration there, and by remote static analysis tools such as GitHub's dependency services (e.g. dependabot and security alerts).</p>
<p>So the answer is for a  <code>pyproject.toml</code> that uses TOML 1.1 specific syntax affect all 3 situations, PyPI installation, local building, and other situations.</p>
<p>That said, I didn't imagine the rule would be on by default unless there was real world reports of users having issues with TOML 1.1 specific syntax. I assumed it would be advocated by proponents as good practice, and users would opt in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-15 20:44</div>
            <div class="timeline-body"><p>Yeah, the changes in TOML 1.1 allow multi-line table syntax that will fail to parse in TOML 1.0, eg:</p>
<pre><code class="language-toml">[table]
value = {
  key = &quot;value&quot;,
  key2 = &quot;value&quot;,
}
</code></pre>
<p>which in TOML 1.0 would have to be written as:</p>
<pre><code class="language-toml">[table]
value = {key = &quot;value&quot;, key2 = &quot;value&quot;}

# OR

[table.value]
key = &quot;value&quot;
key2 = &quot;value&quot;
</code></pre>
<p>The problem is that if users start using the new syntax before all of their tools (including any that rely on tomllib from stdlib) support TOML 1.1 syntax, then that will break any incompatible tools. Since cpython is highly unlikely to backport TOML 1.1 support to existing releases, then use of 1.1 syntax would most likely need to wait until Python 3.14 is EOL.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2026-01-16 15:22</div>
            <div class="timeline-body"><p>I personally don't think this makes sense as a Ruff rule - it seems like we should let the error come from whichever tools do not support the new TOML syntax, rather than pre-empting them. That way users know which tools don't yet support the new syntax and can respond accordingly. Maybe they switch to a tool that does, or they adjust their syntax and file/upvote an issue asking for the tool to update, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-16 15:24</div>
            <div class="timeline-body"><blockquote>
<p>I personally don't think this makes sense as a Ruff rule - it seems like we should let the error come from whichever tools do not support the new TOML syntax, rather than pre-empting them.</p>
</blockquote>
<p>I agree with this sentiment if it comes to dev tools. I do think there's value in warning about TOML 1.1 syntax for packages published to pypi but only if there are cases where the installation would fail because of the TOML 1.1 syntax</p>
<p>On the other hand. It could be a useful opt-in rule for projects that know that they still are on 1.0 tools and can't upgrade.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2026-01-16 15:31</div>
            <div class="timeline-body"><blockquote>
<p>I personally don't think this makes sense as a Ruff rule - it seems like we should let the error come from whichever tools do not support the new TOML syntax, rather than pre-empting them.</p>
</blockquote>
<p>The problem is it may work for the author of a package as they are using newer tools, and error for users of the package who are using other tools. E.g. author tests on Python 3.15+ only, and user tries to install on Python 3.14 and it throws an error. Or the author tests it using only uv but the user is installing with pip.</p>
<blockquote>
<p>That way users know which tools don't yet support the new syntax and can respond accordingly. Maybe they switch to a tool that does</p>
</blockquote>
<p>Such users may not be able to update their tools due to their own support policies,</p>
<blockquote>
<p>they adjust their syntax and file/upvote an issue asking for the tool to update, etc.</p>
</blockquote>
<p>In which case it would be helpful for the authors of the package to have a lint rule to prevent usage from happening in the first place...</p>
<blockquote>
<p>On the other hand. It could be a useful opt-in rule for projects that know that they still are on 1.0 tools and can't upgrade.</p>
</blockquote>
<p>I am all for this rule being opt-in, I should have been clear in my original post, I am not suggesting this be made a default rule.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-16 16:00:05 UTC
    </footer>
</body>
</html>
