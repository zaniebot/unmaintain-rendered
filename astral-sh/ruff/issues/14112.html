<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>auto-fixing `UP006` yield in errors for python 3.9 and 3.10 - astral-sh/ruff #14112</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>auto-fixing `UP006` yield in errors for python 3.9 and 3.10</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14112">#14112</a>
        opened by <a href="https://github.com/Borda">@Borda</a>
        on 2024-11-05 16:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Borda">@Borda</a> on 2024-11-05 16:57</div>
            <div class="timeline-body"><p>not sure how much it is a bug or just bad user expectations.
We are performing a bump of min Python version from Python 3.8 to 3.9 so we have updated the Ruff configuration <code>target-version = &quot;py39&quot;</code> and running auto fixing which does not fix almost any <code>List</code> or <code>Dict</code> annotation and suggests enabling <code>--unsafe-fixes</code>... which I did but that covers annotation which is not runnable for example <code>List[torch.Tensor]</code> converts to <code>list[torch.Tensor]</code> which crashes in runtime with</p>
<pre><code>ann = list[torch.Tensor], loc = 

    def ann_to_type(ann, loc):
        the_type = try_ann_to_type(ann, loc)
        if the_type is not None:
            return the_type
&gt;       raise ValueError(f&quot;Unknown type annotation: '{ann}' at {loc.highlight()}&quot;)
E       ValueError: Unknown type annotation: 'list[torch.Tensor]' at
</code></pre>
<p>see the full CI log in https://github.com/Lightning-AI/torchmetrics/actions/runs/11685262564/job/32538417524?pr=2827
I understand that &quot;unsafe fixes&quot; could be unstable but on either hand I guess that some trivial fixes shall be made with the default config like converting <code>List[Dict]</code> to <code>list[dict]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Lightning-AI/torchmetrics/pulls/2827.html">Lightning-AI/torchmetrics#2827</a> on 2024-11-05 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 17:00</div>
            <div class="timeline-body"><p>Do you know why that crashes at runtime? It looks like it has to do with your own application code. <code>list[torch.Tensor]</code> is totally fine in Python 3.9.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-06 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Borda">@Borda</a> on 2024-11-07 16:46</div>
            <div class="timeline-body"><p>strange, can't reproduce it again, so closing for now and eventually will reopen later...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Borda on 2024-11-07 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Borda">@Borda</a> on 2024-11-07 17:46</div>
            <div class="timeline-body"><p>Ok, so it is probably <code>torch</code> issue,the run is: https://github.com/Lightning-AI/torchmetrics/actions/runs/11727000215/job/32667138807?pr=2827</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
