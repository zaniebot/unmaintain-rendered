<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F841 - False positive when using with isinstance() - astral-sh/ruff #9424</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F841 - False positive when using with isinstance()</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9424">#9424</a>
        opened by <a href="https://github.com/MamadouSDiallo">@MamadouSDiallo</a>
        on 2024-01-07 17:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MamadouSDiallo">@MamadouSDiallo</a></div>
            <div class="timeline-body"><p>In Python, it is common to use <code>isinstance()</code> to check for type or class. If we do not do anything with the class or type name then it is flagged as F841 (unused variable) which is a false positive.</p>
<pre><code class="language-python">def fit(y: DirectEst | Array, x: IndepVars, method: FitMethod):
    match y:
        case isinstance(y, DirectEst):
            return _fit(y=y.est, x=x, method=method)
        case isinstance(y, Array):
            return _fit(y=y, x=x, method=method)
        case _:
            raise TypeError(&quot;The type of `y` is not supported!&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-07 18:25</div>
            <div class="timeline-body"><p>Thanks for the report! This looks like an issue with <code>case</code> statements specifically.</p>
<pre><code>‚ùØ ruff check example.py --select F841
example.py:3:28: F841 Local variable `DirectEst` is assigned to but never used
example.py:5:28: F841 Local variable `Array` is assigned to but never used
</code></pre>
<p>but there are no violations in</p>
<pre><code class="language-python">def fit(y: DirectEst | Array, x: IndepVars, method: FitMethod):
    if isinstance(y, DirectEst):
        return _fit(y=y.est, x=x, method=method)
    elif isinstance(y, Array):
        return _fit(y=y, x=x, method=method)
    else:
        raise TypeError(&quot;The type of `y` is not supported!&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-07 18:56</div>
            <div class="timeline-body"><p>I think Ruff is correct here? That code doesn't behave the way it might appear. You can't put arbitrary Python expressions in a <code>case</code> statement. Python interprets <code>case isinstance(y, DirectEst)</code> as &quot;match against a class named <code>instance</code>&quot;, not &quot;match against the result of checking <code>isinstance(y, DirectEst)</code>.</p>
<p>For example, given:</p>
<pre><code class="language-python">class DirectEst:
    pass

class Array:
    pass

def fit(y: DirectEst | Array):
    match y:
        case isinstance(y, DirectEst):
            print(&quot;DirectEst&quot;)
        case isinstance(y, Array):
            print(&quot;Array&quot;)
        case _:
            raise TypeError(&quot;The type of `y` is not supported!&quot;)

fit(DirectEst())
</code></pre>
<p>I get:</p>
<pre><code>Traceback (most recent call last):
  File &quot;/Users/crmarsh/workspace/ruff/foo.py&quot;, line 16, in &lt;module&gt;
    fit(DirectEst())
  File &quot;/Users/crmarsh/workspace/ruff/foo.py&quot;, line 9, in fit
    case isinstance(y, DirectEst):
         ^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: called match pattern must be a class
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-07 18:58</div>
            <div class="timeline-body"><p>You might be thinking of something like:</p>
<pre><code class="language-python">def fit(y: DirectEst | Array, x: IndepVars, method: FitMethod):
    match y:
        case DirectEst():
            return _fit(y=y.est, x=x, method=method)
        case Array():
            return _fit(y=y, x=x, method=method)
        case _:
            raise TypeError(&quot;The type of `y` is not supported!&quot;)
</code></pre>
<p>Which Ruff correctly does <em>not</em> flag for <code>F841</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-01-07 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MamadouSDiallo">@MamadouSDiallo</a> on 2024-01-07 21:48</div>
            <div class="timeline-body"><p>Indeed, if I replace the match by and if/else then it works fine and Ruff does not complain. The issue is the weird Python type system not Ruff.
Best.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MamadouSDiallo on 2024-01-07 21:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:23 UTC
    </footer>
</body>
</html>
