```yaml
number: 18036
title: PIE804 autofix is destructive
type: issue
state: closed
author: tpgillam
labels:
  - bug
  - fixes
  - help wanted
assignees: []
created_at: 2025-05-12T10:13:03Z
updated_at: 2025-05-12T15:17:00Z
url: https://github.com/astral-sh/ruff/issues/18036
synced_at: 2026-01-10T01:56:56Z
```

# PIE804 autofix is destructive

---

_Issue opened by @tpgillam on 2025-05-12 10:13_

Tested with ruff 0.11.8

Consider this (contrived) case of comments appearing in a dictionary definition:
```python
from dataclasses import dataclass

@dataclass
class Moo:
    x: float
    y: float

Moo(**{
    # Interesting observation about x
    "x": 1.0,
    # Interesting observation about y
    "y": 2.0
    })
```

applying autofix for [PIE804](https://docs.astral.sh/ruff/rules/unnecessary-dict-kwargs/) (which is not marked unsafe) gives the following:

```python
from dataclasses import dataclass


@dataclass
class Moo:
    x: float
    y: float


Moo(x=1.0, y=2.0)
```

which has dropped the comment.

Ideally I think the comments should be preserved, but otherwise perhaps this autofix should be marked as unsafe?

---

I came across this in the wild where previously some code constructed a big dictionary, and I was then porting it into a dataclass.. so was using the PIE804 autofix as above to save some typing. But then discovered that the comments got thrown away.

---

_Renamed from "PIE804 is destructive" to "PIE804 autofix is destructive" by @tpgillam on 2025-05-12 10:14_

---

_Comment by @MichaReiser on 2025-05-12 10:33_

Thanks. Yes, the fix here should be marked as unsafe **if** the fix range contains any comments

---

_Label `bug` added by @MichaReiser on 2025-05-12 10:33_

---

_Label `fixes` added by @MichaReiser on 2025-05-12 10:33_

---

_Label `help wanted` added by @MichaReiser on 2025-05-12 10:33_

---

_Referenced in [astral-sh/ruff#18046](../../astral-sh/ruff/pulls/18046.md) on 2025-05-12 14:34_

---

_Closed by @dylwil3 on 2025-05-12 15:17_

---
