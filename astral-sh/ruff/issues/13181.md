```yaml
number: 13181
title: F401 rule has a bug
type: issue
state: closed
author: seriaati
labels:
  - bug
  - type-inference
assignees: []
created_at: 2024-08-31T08:08:59Z
updated_at: 2024-09-01T18:24:38Z
url: https://github.com/astral-sh/ruff/issues/13181
synced_at: 2026-01-10T01:56:53Z
```

# F401 rule has a bug

---

_Issue opened by @seriaati on 2024-08-31 08:08_

I'm not exactly sure if this is a bug.
Consider the following file structure:
```
my_view_items/
├─ my_button.py
components.py
my_view.py
```
With the following code:
```py
# components.py

from typing import Generic, TypeVar

V_co = TypeVar("V_co", bound="View")


class View:
    pass


class Button(Generic[V_co]):
    pass
```
```py
# my_view.py

from .components import View


class MyView(View):
    pass
```
```py
# my_view_items/button.py

from typing import TYPE_CHECKING

from ..components import Button

if TYPE_CHECKING:
    from ..my_view import MyView # F401 is raised here.


class MyButton(Button["MyView"]):
    pass
```

The example can probably be more simplified to reproduce this issue, but this is something that I encountered in one of my projects, so I decided to just simplify the code (from my project).
Basically, typing using quotes for generics would cause F401 (unused import) to be triggered. But the import is actually needed.
In addition, the presence of `from __future__ import annotations` doesn't affect whether F401 is raised.

---

_Comment by @charliermarsh on 2024-09-01 18:24_

This is similar to https://github.com/astral-sh/ruff/issues/9298. We can't detect arbitrary user-defined generics right now. You can tell Ruff that a class should be considered generic via https://docs.astral.sh/ruff/settings/#lint_pyflakes_extend-generics for now, and we plan to improve it in the future.

---

_Closed by @charliermarsh on 2024-09-01 18:24_

---

_Label `bug` added by @charliermarsh on 2024-09-01 18:24_

---

_Label `type-inference` added by @charliermarsh on 2024-09-01 18:24_

---

_Referenced in [astral-sh/ruff#15860](../../astral-sh/ruff/issues/15860.md) on 2025-02-01 17:05_

---
