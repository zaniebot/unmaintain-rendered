<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANN201, ANN202, ANN205 automatically sets the return type to NoReturn to raise NotImplementedError - astral-sh/ruff #18886</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ANN201, ANN202, ANN205 automatically sets the return type to NoReturn to raise NotImplementedError</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18886">#18886</a>
        opened by <a href="https://github.com/spaceby">@spaceby</a>
        on 2025-06-23 10:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/spaceby">@spaceby</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>ANN205 automatically sets the return type to NoReturn to raise NotImplementedError</p>
<p>before</p>
<pre><code class="language-python">class Class:
    @staticmethod
    def func(self):
        raise NotImplementedError

</code></pre>
<p>after</p>
<pre><code class="language-python">from typing import NoReturn


class Class:
    @staticmethod
    def func(self) -&gt; NoReturn:
        raise NotImplementedError

</code></pre>
<p>In my opinion, this shouldn't be the case for NotImplementedError</p>
<p>https://play.ruff.rs/d3f2d182-94c6-4543-ad12-8d59e1b27777</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ANN205 automatically sets the return type to NoReturn to raise NotImplementedError" to "ANN201, ANN205 automatically sets the return type to NoReturn to raise NotImplementedError" by @spaceby on 2025-06-23 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ANN201, ANN205 automatically sets the return type to NoReturn to raise NotImplementedError" to "ANN201, ANN202, ANN205 automatically sets the return type to NoReturn to raise NotImplementedError" by @spaceby on 2025-06-23 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-23 11:04</div>
            <div class="timeline-body"><p>Can you explain why you think this shouldn't be the case for <code>NotImplementedError</code>?</p>
<p>Changing the return type does seem correct to me because <code>func</code> never returns, it only ever raises.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2025-06-23 11:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceby">@spaceby</a> on 2025-06-23 11:28</div>
            <div class="timeline-body"><p>https://docs.python.org/3/library/exceptions.html#NotImplementedError</p>
<p><code>NotImplementedError</code> is just a way to indicate that the method is abstract.
It's a bit odd to say that abstract methods must have a <code>NoReturn</code> return type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceby">@spaceby</a> on 2025-06-23 11:33</div>
            <div class="timeline-body"><p>Instead of <code>NoReturn</code>, you can specify any type that you intend to use in the implementation of this abstract method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @MichaReiser on 2025-06-23 11:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @MichaReiser on 2025-06-23 11:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-06-23 11:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-23 11:40</div>
            <div class="timeline-body"><p>Oh I see. Thank you. Yes, I think it makes sense to not suggest a fix in this case but still flag the missing type annotation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 10:35</div>
            <div class="timeline-body"><p>@spaceby would using <code>@abstractmethod</code> be an alternative (and inheriting from <code>ABC</code>) over using <code>raise NotImplementedError</code> or is there a reason why this doesn't work for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-06-25 12:31</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/spaceby">@spaceby</a> would using <code>@abstractmethod</code> be an alternative (and inheriting from <code>ABC</code>) over using <code>raise NotImplementedError</code> or is there a reason why this doesn't work for you?</p>
</blockquote>
<p>I think that more often than not, using abstract methods would be the preferable option for largely the same behavior (not quite identical). That being said, as long as the linter &quot;allows&quot; using <code>NotImplementedError</code> formulations, they should be dealt with in a way that makes sense, including not expecting these return types or the issue mentioned in #18935.</p>
<p>(The alternative in my mind would be to raise a linting error against using <code>NotImplementedError</code>, but that is probably not the preferred option).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 12:34</div>
            <div class="timeline-body"><blockquote>
<p>formulations, which are still the preferred option is some cases,</p>
</blockquote>
<p>Can you give examples in which cases they're still preferred?</p>
<p>I'm asking because the solution here has the disadvantage that it will not suggest <code>NoReturn</code> for methods that are not implemented (because someone decided they don't have to) but not because the class is abstract.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-06-25 12:45</div>
            <div class="timeline-body"><blockquote>
<p>Can you give examples in which cases they're still preferred?</p>
</blockquote>
<p>An abstract method forces a subclass to implement the method, whereas raising the <code>NotImplementedError</code> just means that the subclass cannot use this method.</p>
<p>So if there is a parent method where some of the children have the method and others don't, then creating the abstract method would mean that even the children that don't use this method need to implement it (probably raising an error anyway).</p>
<p>There is an argument to be made that methods that are not shared by <em>all</em> subclasses should not be part of the parent. But there is also a reasonable argument to be made for using the <code>NotImplementedError</code>.</p>
<blockquote>
<p>I'm asking because the solution here has the disadvantage that it will not suggest <code>NoReturn</code> for methods that are not implemented (because someone decided they don't have to) but not because the class is abstract.</p>
</blockquote>
<p>This argument I don't understand. I think that any method that raises a <code>NotImplementedError</code> should not be expected to have a <code>NoReturn</code> return type. In fact, I think it should be treated by the linter equivalently to an abstract method in most if not all respects (I don't know if there are some edge cases where it would be problematic).</p>
<p>Note also that I had previously raised an issue (which was solved) about other inconsistent behavior of NotImplementedError methods #12427. I think <a href="https://github.com/astral-sh/ruff/issues/12427#issuecomment-2382165866">this</a> was a pivotal comment for resolving that issue. Maybe something similar can be applied more broadly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-06-25 12:59</div>
            <div class="timeline-body"><p>Maybe a more concrete example (it's not the perfect example, but best I could come up with on the spot).</p>
<p><code>number_of_legs</code> is an abstract method, because even if it's 0 (snake), that is still a number that I maybe want to get back.
<code>speak</code> raises NotImplementedError because you can't force the turtle to say anything. (Of course, you argue to print an empty string or to raise an error in the child class, but it's not completely unreasonable to raise the NotImplementedError).</p>
<pre><code class="language-py">from abc import ABC, abstractmethod


class Animal(ABC):
    @abstractmethod
    def number_of_legs(self):
        pass

    def speak(self):
        raise NotImplementedError(&quot;Animal doesn't make a sound.&quot;)


class Dog(Animal):
    def number_of_legs(self):
        return 4

    def speak(self):
        print(&quot;Woof!&quot;)


class Snake(Animal):
    def number_of_legs(self):
        return 0

    def speak(self):
        print(&quot;Hiss!&quot;)


class Turtle(Animal):
    def number_of_legs(self):
        return 4
</code></pre>
<p>In addition, <code>NotImplementedError</code> is a little more lax than an abstract method. That is, if a new class is created, you don't need to implement every single abstract method from the getgo, but can allow for phased development.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 13:00</div>
            <div class="timeline-body"><p>In the case you outline, I think that changing the return type to <code>Never</code> is somewhat more accurate and it helps static analysis tools like ty (our upcoming type checker) or pyright to understand that this method can never complete.</p>
<p><a href="https://pyright-play.net/?pythonVersion=3.13&amp;strict=true&amp;enableExperimentalFeatures=true&amp;reportImplicitOverride=true&amp;reportShadowedImports=true&amp;reportUnusedCallResult=true&amp;reportUninitializedInstanceVariable=true&amp;code=FAMwTg9gtgBAhgIwMYwJZQA4TAFxgQQCEBhAGngQGccw4kcoBTHACwgBNRJYcBPDVADsA5mkzY8AOUYA3RmHIQ5YMKnaNgwJABs4lSjEJ7GACiLEAlAC5gMOzAACiarXpNWHW-fUgYORtQmlIzaIBYwALQAfDAIEBDaVjAAdKmaOnoGAAqQGPIAygCuyLr6JkbB1l52DkryqurVMD5%2BAThBIWGRMXEJNvYDMGDMhWCCMAAqYIUa6aXZcLiocNpFJZnlxlUDtcoNGgMt-oHBoeHRMNLKMP2DdrSowZcQOACSmNqMTIL%2B7ACiKmwJgsmmAQmocEESEYMAAvDAchA8mA1hkyiCwb5wThIdDksd2tt7BhVD8TAAiKYzckY7G4xgAJjhCMWOGWq2KaMowM0qCxgghUMZ%2BLawNudgAxJMWI80AYANaCCAAd3GOAgsRh6jg7BgSA4jAAhNK4HhlahtNoYFA4PKDvYpXA9StPmAYBBfLwIKMCFlXjBKIVKAIkKhvQZIbrWIxeM7xkgWIwkPL3YUzSxeE0pQADAnZmCCWTyAOFJDQxjsShNIQyFZqZkADyAA">Here's an example</a>. Pyright can see that calling <code>PartialSubclass.test</code> will never return and can flag this to the user.</p>
<p>That's why I think that the distinction between: This class is abstract and the method is abstract (in which case we shouldn't recomment <code>Never</code>) and we decided that this sub class doesn't implement this method (in which case recommending <code>Never</code> isn't wrong) can be valuable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceby">@spaceby</a> on 2025-06-26 09:04</div>
            <div class="timeline-body"><p>I don't really understand what you're talking about, but here are some examples.</p>
<p><a href="https://pyright-play.net/?pythonVersion=3.13&amp;strict=true&amp;enableExperimentalFeatures=true&amp;reportImplicitOverride=true&amp;reportShadowedImports=true&amp;reportUnusedCallResult=true&amp;reportUninitializedInstanceVariable=true&amp;code=FAMwTg9gtgBALgTwA4EsB2BzGKpImOGCANwFMwwUATU4OgYwBsBDAZ1ZgCE3SAuYGIJg0Q8UqzgAKVqUYgAlDAC0APhgAjCBEb8hemGGYoZMAHIQ4ASVyNSUUmjikqAUQr4GLdjAAKkJOQAygCu6kxsrJLcMvK6QgACJOSUNAJCImIS0rIKymqa2nH6BqRwwWBoMAAqYMG0wOgSzGj0pDAAvL7%2BQaHh7JLydCiijXDNrQB0TlmxaYJIlI6SAEQ1dcuDQA">example with correct types</a></p>
<p><a href="https://pyright-play.net/?pythonVersion=3.13&amp;strict=true&amp;enableExperimentalFeatures=true&amp;reportImplicitOverride=true&amp;reportShadowedImports=true&amp;reportUnusedCallResult=true&amp;reportUninitializedInstanceVariable=true&amp;code=FAMwTg9gtgBALgTwA4EsB2BzGKpImOGAOQFMA3EsAGhggrDBQBMTg2BjAGwEMBnXmACE%2BJAFzAYkmCxDwSvOAApeJTiACUMALQA%2BYuUripxmGG4oVxCHACSuTiSgk0cEkwCiDfBx78YABUgkSgBlAFcAIy4%2BXkVhFXUjKQABOkpGFgkpGTkFZVUNbT0IiAhOJJNTEjgwsDQYABUwMNZgdAVuNHYSGABeAKDQyOj%2BRXU2FFl2uE7ugDpXPMSsySRGF0UAIiaWzfGgA">example with type error</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceby">@spaceby</a> on 2025-06-26 09:11</div>
            <div class="timeline-body"><p>I work with django and there are a lot of things like this</p>
<pre><code class="language-python">class BaseSerializer:
    def to_internal_value(self, data):
        raise NotImplementedError('`to_internal_value()` must be implemented.')

    def to_representation(self, instance):
        raise NotImplementedError('`to_representation()` must be implemented.')


class ImplementedSerializer(BaseSerializer):
    # to_internal_value is not implemented because it is not needed

    def to_representation(self, instance):
        return instance.id
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceby">@spaceby</a> on 2025-11-05 10:28</div>
            <div class="timeline-body"><p>Any news?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:52:57 UTC
    </footer>
</body>
</html>
