<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&quot;ruff check --select I --fix&quot; ignores &quot;known-first-party&quot; configuration - astral-sh/ruff #20493</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>&quot;ruff check --select I --fix&quot; ignores &quot;known-first-party&quot; configuration</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20493">#20493</a>
        opened by <a href="https://github.com/MorganStair">@MorganStair</a>
        on 2025-09-21 14:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MorganStair">@MorganStair</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p><code>ruff check --select I --fix</code> ignores <code>known-first-party</code> configuration</p>
<h2>Summary</h2>
<p><code>ruff check</code> with import sorting enabled does not respect the <code>known-first-party</code> setting in pyproject.toml.</p>
<h2>Expected Behavior</h2>
<p><code>ruff check --select I --fix</code> should respect the <code>known-first-party</code> configuration and place known first-party imports before other local imports.</p>
<h2>Actual Behavior</h2>
<p><code>ruff check --select I --fix</code> ignores <code>known-first-party</code> config and sorts imports alphabetically instead.</p>
<h2>Test Script</h2>
<p><a href="https://github.com/user-attachments/files/22452314/test_ruff_sort.py">test_ruff_sort.py</a></p>
<h2>Reproduction Steps</h2>
<ol>
<li>Create a project structure:</li>
</ol>
<pre><code>project/
├── pyproject.toml
└── python/
    ├── knownfirstparty/
    │   └── __init__.py
    ├── undeclaredfirstparty/
    │   └── __init__.py
    └── misc/
        └── test.py
</code></pre>
<ol start="2">
<li>Add to <code>pyproject.toml</code>:</li>
</ol>
<pre><code class="language-toml">[tool.ruff.lint]
select = [&quot;I&quot;]

[tool.ruff.lint.isort]
known-first-party = [&quot;knownfirstparty&quot;]
</code></pre>
<ol start="3">
<li>Add to <code>python/knownfirstparty/__init__.py</code>:</li>
</ol>
<pre><code class="language-python">KNOWN_SYMBOL = 'known'
</code></pre>
<ol start="4">
<li>Add to <code>python/undeclaredfirstparty/__init__.py</code>:</li>
</ol>
<pre><code class="language-python">UNDECLARED_SYMBOL = 'undeclared'
</code></pre>
<ol start="5">
<li>Add to <code>python/misc/test.py</code>:</li>
</ol>
<pre><code class="language-python">import os
from knownfirstparty import KNOWN_SYMBOL
from undeclaredfirstparty import UNDECLARED_SYMBOL
</code></pre>
<ol start="6">
<li>Run the command:</li>
</ol>
<pre><code class="language-bash">ruff check --select I --fix python/misc/test.py
</code></pre>
<ol start="7">
<li>Observe that <code>undeclaredfirstparty</code> import appears before <code>knownfirstparty</code> import, despite the configuration specifying <code>knownfirstparty</code> should be prioritized.</li>
</ol>
<p>Note: <code>ruff format</code> correctly respects this configuration for comparison.</p>
<h2>Environment</h2>
<ul>
<li>Ruff version: ruff 0.13.0</li>
<li>Python version: 3.13.7</li>
<li>OS: Windows 11</li>
</ul>
<h3>Version</h3>
<p>ruff 0.13.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MorganStair">@MorganStair</a> on 2025-09-21 14:46</div>
            <div class="timeline-body"><h2>Problem Clarification</h2>
<p><strong>Issue</strong>: <code>ruff check --select I --fix</code> ignores <code>known-first-party</code> configuration</p>
<p><strong>Details</strong>:</p>
<ul>
<li>The command consistently sorts imports alphabetically instead of respecting the <code>known-first-party = [&quot;knownfirstparty&quot;]</code> setting</li>
<li>This occurs regardless of working directory or input method (file vs stdin)</li>
<li>Expected behavior: known-first-party imports should appear before other local imports</li>
<li>Actual behavior: imports are sorted purely alphabetically</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-22 08:08</div>
            <div class="timeline-body"><p>Thanks for the detailed write up. This helped me reproduce this easily.</p>
<p>I ran <code>ruff check</code> with <code>-v</code> to understand Ruff's categorization choices and this is the output:</p>
<pre><code>ruff check --select I --fix python/misc/test.py -v
[2025-09-22][10:04:55][ruff::resolve][DEBUG] Using configuration file (via parent) at: /Users/micha/astral/test/project/pyproject.toml
[2025-09-22][10:04:55][ignore::gitignore][DEBUG] opened gitignore file: /Users/micha/.gitignore_global
[2025-09-22][10:04:55][ruff::commands::check][DEBUG] Identified files to lint in: 3.373333ms
[2025-09-22][10:04:55][ruff::diagnostics][DEBUG] Checking: /Users/micha/astral/test/project/python/misc/test.py
[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'undeclaredfirstparty' as Known(ThirdParty) (NoMatch)
[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'knownfirstparty' as Known(FirstParty) (KnownFirstParty)
[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'undeclaredfirstparty' as Known(ThirdParty) (NoMatch)
[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'knownfirstparty' as Known(FirstParty) (KnownFirstParty)
[2025-09-22][10:04:55][ruff::commands::check][DEBUG] Checked 1 files in: 576.459µs
Found 1 error (1 fixed, 0 remaining).
</code></pre>
<p>The interesting line here is:</p>
<pre><code>[2025-09-22][10:04:55][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'undeclaredfirstparty' as Known(ThirdParty) (NoMatch)
</code></pre>
<p>The issue is that Ruff can't resolve <code>knownthirdparty</code> because it only checks if such folder exists in the root (in <code>project</code>)`.</p>
<p>You can fix this by either:</p>
<ul>
<li>Moving your <code>pyproject.toml</code> to the <code>python</code> directory</li>
<li>Adding <code>tool.ruff.src = [&quot;python&quot;]</code> to your <code>pyproject.toml</code> (see https://docs.astral.sh/ruff/settings/#src).</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-09-22 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MorganStair">@MorganStair</a> on 2025-09-22 10:17</div>
            <div class="timeline-body"><p>Thanks. I'll test it further, today if I have time. There may be more to this, but I can submit a separate issue if there is.</p>
<p>It sounds like --config &quot;src=python&quot; should be a workaround.</p>
<p>Since src discovery based on the target file might be out of scope, you can probably close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-09-22 10:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:21 UTC
    </footer>
</body>
</html>
