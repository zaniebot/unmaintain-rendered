<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Highlighting for unhandled exceptions from docstrings - astral-sh/ruff #12628</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Highlighting for unhandled exceptions from docstrings</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12628">#12628</a>
        opened by <a href="https://github.com/divaltor">@divaltor</a>
        on 2024-08-02 13:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/divaltor">@divaltor</a></div>
            <div class="timeline-body">

<p><strong>Thanks for your work and the awesome tool</strong> ❤️</p>
Problem
<p>Some docstring formats support raise blocks for describing potential exceptions a function may throw. However, neither LSP (pyright) nor IDEs (PyCharm) can suggest handling these exceptions when a function is called. This limitation often leads to two bad practices:</p>
<ul>
<li>Handling all types of errors using a broad <code>except Exception</code> block, which can mask specific issues and make debugging more difficult.</li>
<li>Completely overlooking potential exceptions, resulting in unhandled errors that can cause unexpected runtime bugs.</li>
</ul>
<p>Is it possible to create a rule for highlighting unhandled exceptions? Most related feature in PHP Storm - https://blog.jetbrains.com/phpstorm/2017/11/bring-exceptions-under-control/#unhandled-exception</p>
<pre><code>def positive_sum(a: int, b: int) -&gt; int:
	&quot;&quot;&quot;
	Summarize two positive integers

	Raises:
		ValueError: when value is not positive
	&quot;&quot;&quot;
	if a &lt; 0 or b &lt; 0:
		raise ValueError(&#x27;value must be positive integer&#x27;)

	return a + b

positive_sum(15, 15)   &lt;-- RUF999: Unhandled ValueError exception

try:
	positive_sum(15, 15)  &lt;-- OK
except ValueError:
	...

try:
	positive_sum(15, 15)  &lt;-- OK, but may be should consider case when user use common `Exception` for handle it
except Exception:
	...
</code></pre>
<p>But there can be problem (may be, I didn&#x27;t read a whole ruff code to understand how parser and semantic work):</p>
<pre><code>def validate_number(num: int) -&gt; int:
	&quot;&quot;&quot;
	Validate number and return error if it&#x27;s not positive

	Raises:
		ValueError: when value is not positive
	&quot;&quot;&quot;
	if num &lt; 0:
		raise ValueError(&#x27;value must be positive integer&#x27;)
	
	return num

# There is no docstring
def positive_sum(a: int, b: int) -&gt; int:
	validate_number(a)  &lt;-- RUF999: Unhandled ValueError exception
	validate_number(b)  &lt;-- RUF999: Unhandled ValueError exception

	return a + b

positive_sum(15, 15)  &lt;-- RUF999: Unhandled ValueError exception
</code></pre>
<p>Also there could be cases when we use <code>assert</code> statements without docstring, like</p>
<pre><code>def positive_sum(a: int, b: int) -&gt; int:
	assert a &gt; 0
	assert b &gt; 0

	return a + b

# Strongly not sure if should cover such case, because assertion is supposed to find bugs by `fuzzing`
positive_sum(15, 15)  &lt;-- RUF999: Unhandled AssertionError exception
</code></pre>
<p><strong>Is it possible to implement such a rule at all? Because my concern is that is job for LSP, not for linter.</strong></p>
Possible limitations
<ol>
<li>Ruff can&#x27;t analyze external libraries or their docstrings. This means it&#x27;s not possible to highlight code that calls external libraries, like <code>requests</code>.</li>
<li>Developers may forget to update docstrings after modifying code, leading to outdated or inaccurate exception information.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-02 13:14</div>
            <div class="timeline-body"><p>Thanks for the kind words.</p>
<p>If I&#x27;m not mistaken than this rule shipped as part of ruff 0.5.5 but under preview mode only. See <a href="https://github.com/astral-sh/ruff/pull/11471">astral-sh/ruff#11471</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/divaltor">@divaltor</a> on 2024-08-02 13:19</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the kind words.</p>
<p>If I&#x27;m not mistaken than this rule shipped as part of ruff 0.5.5 but under preview mode only. See #11471</p>
</blockquote>
<p>I guess this rule just prevent cases when user forgets to update its docstring, but do nothing when user <em>actually executes</em> function with <code>Raises</code> block, see my example again (or look at PHPStorm blog which I&#x27;ve attached to at the top)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-02 13:23</div>
            <div class="timeline-body"><p>Oh yeah sorry. That&#x27;s something else. I don&#x27;t think we have the necessary infrastructure in place today because ruff can&#x27;t do any cross-file analysis.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-02 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-02 14:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-24 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-24 14:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:56 UTC
    </footer>
</body>
</html>
