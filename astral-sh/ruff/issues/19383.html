<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff format` ignores `line-length` setting in assignment expression - astral-sh/ruff #19383</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff format</code> ignores <code>line-length</code> setting in assignment expression</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19383">#19383</a>
        opened by <a href="https://github.com/ALPA-Industry-and-Technology">@ALPA-Industry-and-Technology</a>
        on 2025-07-16 10:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ALPA-Industry-and-Technology">@ALPA-Industry-and-Technology</a> on 2025-07-16 10:26</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I’m encountering a formatting issue where <code>ruff format</code> seems to ignore the configured <code>line-length = 88</code> when formatting a multiline <strong>assignment</strong>.</p>
<p>Here’s a simplified example from my codebase:</p>
<pre><code>def update_sensor_threshold(self, threshold: str) -&gt; None:
    &quot;&quot;&quot;
    Update the threshold value of a sensor configuration.

    :param threshold: Threshold value as a string.
    &quot;&quot;&quot;
    threshold = threshold.replace(&quot;,&quot;, &quot;.&quot;)
    (
        self._config
        .hardware
        .sensors
        .sensor_motor_left
        .temperature
        .calibration
        .threshold
        .value
    ) = threshold
</code></pre>
<p>My pyproject.toml includes:</p>
<pre><code>[tool.black]
line-length = 88

[tool.ruff]
line-length = 88
</code></pre>
<p>However, when I run <code>ruff format .</code>, it reformats the function to:</p>
<pre><code>def update_sensor_threshold(self, threshold: str) -&gt; None:
    &quot;&quot;&quot;
    Update the threshold value of a sensor configuration.

    :param threshold: Threshold value as a string.
    &quot;&quot;&quot;
    threshold = threshold.replace(&quot;,&quot;, &quot;.&quot;)
    (
        self._config.hardware.sensors.sensor_motor_left.temperature.calibration.threshold.value
    ) = threshold
</code></pre>
<p>This resulting line is clearly longer than 88 characters, which I was trying to avoid by splitting the chain manually.</p>
<p>My questions:</p>
<ol>
<li>Is this expected behavior or a bug?</li>
<li>Besides using # fmt: skip, is there a clean way to prevent ruff format from collapsing such attribute chains in assignments?</li>
<li>Is this something that could or should be improved?</li>
</ol>
<p>Thanks in advance - and thanks for all the great work on ruff!</p>
<h3>Version</h3>
<p>ruff 0.11.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ALPA-Industry-and-Technology on 2025-07-16 10:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-16 11:12</div>
            <div class="timeline-body"><p>Thanks for the detailed report and the kind words.</p>
<p>This is in sofar expected as we try to match black's formatting and black formats this exactly the same. But that doesn't mean it's great.</p>
<p>The assignment formatting is fairly complicated and I don't know what the impact on the ecosystem is if Ruff starts parenthesizing and formatting attribute access in assignment targets over multiple lines but it might be worth exploring</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-07-16 11:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2025-07-16 11:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ALPA-Industry-and-Technology">@ALPA-Industry-and-Technology</a> on 2025-07-16 11:55</div>
            <div class="timeline-body"><p>Thanks for the clarification!</p>
<p>Still, I find this behavior quite strange and unintuitive. As a user, when I explicitly set <code>line-length = 88</code> in my <code>pyproject.toml</code>, I expect the formatter - whether it’s Black or something else - to respect that limit consistently across all cases, including multi-attribute assignments.</p>
<p>When the formatter collapses attribute chains into a single line that clearly exceeds the configured limit, it feels like it's silently bypassing an explicit user setting. This creates confusion and makes the configuration feel unreliable or ignored.</p>
<p>Even if it's technically consistent with Black, I would personally consider this behavior a bug - or at the very least, a surprising and undocumented edge case. If this is indeed by design, perhaps a flag or more granular formatting option could help control this behavior in a cleaner and more predictable way than falling back to <code># fmt: skip</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-16 12:01</div>
            <div class="timeline-body"><blockquote>
<p>Still, I find this behavior quite strange and unintuitive. As a user, when I explicitly set line-length = 88 in my pyproject.toml, I expect the formatter - whether it’s Black or something else - to respect that limit consistently across all cases, including multi-attribute assignments.</p>
</blockquote>
<p>The line length in the formatter isn't a hard upper bound. It's more a guidance: Try to keep the code below that length. There are many other cases where the formatter won't split a line. Either because Python's syntax doesn't allow it (or it would require using line continuations), or because the formatter simply doesn't support it yet (e.g. splitting strings or comments). What you're seeing here is another case like this where it's something where the formatter doesn't support and it requires some design work to define how the formatter should format this specific code (without regressing any other existing code).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:59 UTC
    </footer>
</body>
</html>
