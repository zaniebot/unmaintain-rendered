<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>new rule - detect when decorators are in the wrong order - astral-sh/ruff #6697</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>new rule - detect when decorators are in the wrong order</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/6697">#6697</a>
        opened by <a href="https://github.com/DetachHead">@DetachHead</a>
        on 2023-08-20 03:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/DetachHead">@DetachHead</a> on 2023-08-20 03:36</div>
            <div class="timeline-body"><p>some examples:</p>
<pre><code class="language-py">from collections.abc import Iterator
from contextlib import contextmanager


class Foo:
    @contextmanager
    @staticmethod
    def foo() -&gt; Iterator[None]:
        yield None

    def bar(self):
        with self.foo():
            ...


Foo().bar() # TypeError: Foo.foo() takes 0 positional arguments but 1 was given
</code></pre>
<pre><code class="language-py">from abc import abstractmethod

class Foo:
    @abstractmethod # AttributeError: attribute '__isabstractmethod__' of 'property' objects is not writable
    @property
    def foo(self) -&gt; int:
        ...
</code></pre>
<p>both of these errors are fixed by swapping the order of the decorators</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-20 14:16</div>
            <div class="timeline-body"><p>Would probably require that we maintain a set of known, proper orderings for the standard library decorators (like <code>@property</code>, etc.), but that's not too hard...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-08-21 04:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-08-21 04:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/namurphy">@namurphy</a> on 2023-08-22 20:00</div>
            <div class="timeline-body"><p>Thank you for raising this issue!</p>
<p>I'm wondering if this rule could have a configuration option so that users could add their own decorator ordering rules.  Even if not needed for correctness, this could help improve consistency and readability.</p>
<p>There's also a chance that users might want to specify the order of â‰¥3 decorators...though this would quickly add complexity to the rule.  For â‰¥3 stacked decorators, a possible edge case would be when two decorators have to be in a certain order, but there might be a middle intervening decorator:</p>
<pre><code class="language-python">from abc import abstractmethod

class Foo:
    @abstractmethod
    @here_be_dragons
    @property
    def foo(self) -&gt; int:
        ...
</code></pre>
<p>I don't know if this happens often in the pythoniverse (hopefully not!), but I'm not sure what would be best to do in this case.  Perhaps it would be best for the rule to not be applied to cases with an intervening decorator.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-22 20:18</div>
            <div class="timeline-body"><p>I think adding configuration should generally be carefully considered only once we have a reasonable first implementation. I often get confused about the correct order of property / method decorators as well, I think this would be pretty useful even in a limited scope.</p>
<p>I'm not sure we should handle cases with interleaved decorators.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-22 20:39</div>
            <div class="timeline-body"><p>I like the idea of handling the known, common, invalid permutations from the standard library.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @zanieb on 2023-08-22 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @zanieb on 2023-08-22 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/namurphy">@namurphy</a> on 2023-08-22 21:28</div>
            <div class="timeline-body"><p>Agreed on all of the above!  Perhaps my suggestion for a configuration option for this rule would be best brought up in a follow-up issue after this rule gets implemented for decorators in the standard library.</p>
<p>For anyone curious about the use case motivating my suggestions, we use two decorators in PlasmaPy to process and validate arguments to functions and methods.  The order of the decorators matters when they are applied to instance or class methods.  When applied to class methods (which is admittedly rare), the <code>@classmethod</code> decorator would also be present. Right now, we handle the situation by noting this in admonitions in the docstring of <a href="https://docs.plasmapy.org/en/stable/api/plasmapy.particles.decorators.particle_input.html#particle-input"><code>@particle_input</code></a>.  This use case motivates a configuration option, but I have no idea if it's a common enough use case to warrant adding the capability.</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2023-08-25 21:07</div>
            <div class="timeline-body"><p>Feel free to assign this to me, I can take a look. Only major hurdle I see is the ordering of stdlib decorators. How would I even go about determining that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @evanrittenhouse by @zanieb on 2023-08-26 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-26 00:44</div>
            <div class="timeline-body"><p>@evanrittenhouse basically by using them and seeing if they behave correctly at runtime.</p>
<p>The potentially relevant ones I can think of are:</p>
<ul>
<li><code>abc.abstractmethod</code></li>
<li><code>classmethod</code></li>
<li><code>staticmethod</code></li>
<li><code>property</code></li>
<li><code>contextlib.contextmanager</code></li>
<li><code>contextlib.asyncontextmanager</code></li>
<li><code>functools.wraps</code></li>
<li><code>functools.cache</code></li>
<li><code>functools.cached_property</code> (<a href="https://docs.python.org/3/faq/programming.html#faq-cache-method-calls">maybe helpful context</a>)</li>
<li><code>functools.lru_cache</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DetachHead">@DetachHead</a> on 2023-08-26 00:48</div>
            <div class="timeline-body"><p>also <code>property.setter</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2023-08-26 04:53</div>
            <div class="timeline-body"><p>@zanieb Thanks for the list - was hoping there were some docs somewhere, but off to REPL I go... ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6965.html">astral-sh/ruff#6965</a> on 2023-08-29 03:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DetachHead">@DetachHead</a> on 2023-08-31 13:04</div>
            <div class="timeline-body"><p>also <code>@final</code> and <code>@deprecated</code></p>
<p>for some reason it's apparently intended behavior for <code>@deprecated</code> to only work if there are no other decorators under it, even though there's no runtime error (https://github.com/microsoft/pylance-release/issues/4600#issuecomment-1632023633)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @evanrittenhouse by @evanrittenhouse on 2023-12-09 03:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/irdkwmnsb">@irdkwmnsb</a> on 2025-01-27 14:24</div>
            <div class="timeline-body"><p>I'm using ruff for a project of mine and wanted to add custom lint rules for my own decorators.<br />
If this feature gets implemented I would also really love the ability to specify my own order for the decorators.
For example when using with https://python-dependency-injector.ets-labs.org/wiring.html#decorator-inject</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:10 UTC
    </footer>
</body>
</html>
