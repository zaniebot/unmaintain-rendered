<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server log messages should use `window/logMessage` - astral-sh/ruff #10968</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Server log messages should use <code>window/logMessage</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10968">#10968</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-04-16 06:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>Currently, the server uses the <code>tracing</code> module for log messages which sends everything to stderr. This gets picked up by the client and is added to the log messages at different level regardless of the level used in the server. This level is set by the client.</p>
<p>Here's what VS Code shows:</p>
<pre><code>2024-04-16 12:00:50.229 [info] ┐ruff_server::server::api::notifications::did_change::run{file=file:///Users/dhruv/playground/python/animation.py}
┘
2024-04-16 11:59:47.905 [info]    0.101369s ERROR ruff_server::session The following error occurred when trying to find a configuration file at `/Users/dhruv/playground/python`:
No pyproject.toml/ruff.toml/.ruff.toml file was found
   0.101425s ERROR ruff_server::session Falling back to default configuration for `/Users/dhruv/playground/python`
</code></pre>
<p>Here's what Neovim shows:</p>
<pre><code>[START][2024-04-16 12:06:02] LSP logging initiated
[ERROR][2024-04-16 12:06:02] .../vim/lsp/rpc.lua:789	&quot;rpc&quot;	&quot;/Users/dhruv/work/astral/ruff-test/target/debug/ruff&quot;	&quot;stderr&quot;	&quot;   0.001027s DEBUG ruff_server::server No workspace(s) were provided during initialization. Using the current working directory as a default workspace...\n&quot;
[ERROR][2024-04-16 12:06:02] .../vim/lsp/rpc.lua:789	&quot;rpc&quot;	&quot;/Users/dhruv/work/astral/ruff-test/target/debug/ruff&quot;	&quot;stderr&quot;	&quot;   0.041356s ERROR ruff_server::session The following error occurred when trying to find a configuration file at `/Users/dhruv/playground/python`:\nNo pyproject.toml/ruff.toml/.ruff.toml file was found\n   0.041386s ERROR ruff_server::session Falling back to default configuration for `/Users/dhruv/playground/python`\n&quot;
[ERROR][2024-04-16 12:06:02] .../vim/lsp/rpc.lua:789	&quot;rpc&quot;	&quot;/Users/dhruv/work/astral/ruff-test/target/debug/ruff&quot;	&quot;stderr&quot;	&quot;   0.044606s WARN ruff_server::server LSP client does not support dynamic capability registration - automatic configuration reloading will not be available.\n┐ruff_server::server::api::notifications::did_open::run{file=file:///Users/dhruv/playground/python/errors.py}\n┘\n&quot;
</code></pre>
<p>This is not a high priority. We would need to look at all the messages using <code>tracing</code> and convert most of them to use the notification request instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @dhruvmanila on 2024-04-16 06:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-16 06:38</div>
            <div class="timeline-body"><p>cc @snowsignal</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @snowsignal by @snowsignal on 2024-04-16 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-04-16 21:04</div>
            <div class="timeline-body"><p>Thanks for opening an issue for this @dhruvmanila</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Ruff Server: Beta" by @snowsignal on 2024-04-16 21:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Ruff Server: Beta" by @snowsignal on 2024-05-22 09:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-09 22:37</div>
            <div class="timeline-body"><p>We decided to continue using <code>stderr</code> for now. I'll keep this issue open to track the tracing rewrite.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @snowsignal on 2024-06-11 18:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:05 UTC
    </footer>
</body>
</html>
