<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unclear error if line-length goes beyond u16 boundaries - astral-sh/ruff #20823</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Unclear error if line-length goes beyond u16 boundaries</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/20823">#20823</a>
        opened by <a href="https://github.com/chirizxc">@chirizxc</a>
        on 2025-10-12 20:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-10-12 20:56</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><img width="1507" height="329" alt="Image" src="https://github.com/user-attachments/assets/deab4342-14c5-4e66-9930-8cc44349d786" /></p>
<h3>Version</h3>
<p>ruff 0.14.0 (beea8cdfe 2025-10-07)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-10-12 21:16</div>
            <div class="timeline-body"><p>I would expect something like:</p>
<p><img width="1527" height="266" alt="Image" src="https://github.com/user-attachments/assets/e37cb150-ae94-41ed-98fd-c43ca419b8f0" /></p>
<pre><code class="language-diff">‚ùØ git diff
diff --git a/crates/ruff_linter/src/line_width.rs b/crates/ruff_linter/src/line_width.rs
index 7525a68cd..b9d721e71 100644
--- a/crates/ruff_linter/src/line_width.rs
+++ b/crates/ruff_linter/src/line_width.rs
@@ -14,7 +14,7 @@ use ruff_text_size::TextSize;
 /// The length of a line of text that is considered too long.
 ///
 /// The allowed range of values is 1..=320
-#[derive(Clone, Copy, Debug, Eq, PartialEq, serde::Serialize, serde::Deserialize)]
+#[derive(Clone, Copy, Debug, Eq, PartialEq, serde::Serialize)]
 #[cfg_attr(feature = &quot;schemars&quot;, derive(schemars::JsonSchema))]
 pub struct LineLength(
     #[cfg_attr(feature = &quot;schemars&quot;, schemars(range(min = 1, max = 320)))] NonZeroU16,
@@ -112,6 +112,21 @@ impl std::fmt::Display for LineLengthFromIntError {
     }
 }
 
+impl&lt;'de&gt; serde::Deserialize&lt;'de&gt; for LineLength {
+    fn deserialize&lt;D&gt;(deserializer: D) -&gt; Result&lt;Self, D::Error&gt;
+    where
+        D: serde::Deserializer&lt;'de&gt;,
+    {
+        let value = u64::deserialize(deserializer)?;
+        let value = u16::try_from(value)
+            .map_err(|_| serde::de::Error::custom(
+                format!(&quot;line-length must be between 1 and {} (got {})&quot;, Self::MAX, value)
+            ))?;
+
+        Self::try_from(value).map_err(serde::de::Error::custom)
+    }
+}
+
 impl From&lt;LineLength&gt; for u16 {
     fn from(value: LineLength) -&gt; Self {
         value.0.get()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-10-12 21:22</div>
            <div class="timeline-body"><p>I don't really know where numbers larger than <code>65535</code> can occur on real projects</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-10-13 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @MichaReiser on 2025-10-13 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/21072.html">astral-sh/ruff#21072</a> on 2025-10-25 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-10-27 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/21328.html">astral-sh/ruff#21328</a> on 2025-11-07 22:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
