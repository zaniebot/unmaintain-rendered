<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] support narrowing on `if x` and `if not x` - astral-sh/ruff #14550</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] support narrowing on `if x` and `if not x`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14550">#14550</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2024-11-22 23:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/carljm">@carljm</a> on 2024-11-22 23:45</div>
            <div class="timeline-body"><p>This is trickier than it might appear; the complexities are discussed in https://github.com/astral-sh/ruff/issues/13694#issuecomment-2438438759</p>
<p>It will likely require adding a new method <code>Type::exclude_always_truthy</code> which returns a new <code>Type</code> that excludes all inhabitants of the previous type that are known to always be truthy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @carljm on 2024-11-22 23:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @carljm by @carljm on 2024-11-22 23:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13694.html">astral-sh/ruff#13694</a> on 2024-11-23 00:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-11-23 02:19</div>
            <div class="timeline-body"><p>May I work on this?</p>
<p>I noticed the comment about using an enum for narrowing (e.g., EliminateNonTruthy). Did you perhaps mean EliminateNonFalsy or EliminateTruthy instead?( <code>if not x</code>)</p>
<p>Would it be simpler to just define it as Falsy? I feel that the enum name doesn't necessarily need to include the notion of negation. What do you think about this approach?</p>
<p>If your intention is to emphasize that intersections with literals must always be negative, I can proceed as you suggested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-23 08:51</div>
            <div class="timeline-body"><p>@cake-monotone  We have someone new starting next week and I think Carl created this task deliberately for them.  That's why he assigned it to himself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-11-23 09:15</div>
            <div class="timeline-body"><p>Ah! I see! Thanks for your comment! I haven’t started working on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-23 09:17</div>
            <div class="timeline-body"><p>I haven't done much typing work myself so I don't have a good sense for how &quot;hard&quot; some of these tasks are but if you're interested in contributing, you could consider tackling one of the <a href="https://github.com/astral-sh/ruff/issues/14172">special form</a> tasks or take a look at any other <a href="https://github.com/astral-sh/ruff/issues?q=sort%3Aupdated-desc+is%3Aissue+is%3Aopen+label%3Ared-knot+label%3A%22help+wanted%22">task labeled with help-wanted</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-11-23 17:13</div>
            <div class="timeline-body"><p>@cake-monotone Micha is right about why I created this issue and assigned it to myself, but that said: if you are interested in working on this, please go ahead, that would be great! Given your past work I have no doubt you'll do a good job with it. We have plenty of things to work on, I won't have any trouble finding a replacement task for our new hire. (And this isn't one of the initial starter tasks, so they wouldn't have gotten to it for a few weeks anyway.)</p>
<p>Please do confirm if you start working on it, and I will assign it to you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-11-23 17:17</div>
            <div class="timeline-body"><p>Regarding the naming, I think you are right, it will be clearer to use a name like I suggested in the description of this issue (<code>exclude_always_truthy</code>). It is important to reflect that this is a negative intersection (that is, we are excluding all types known to always be truthy, which is different from intersecting with Falsy.)</p>
<p>But the word &quot;exclude&quot; already serves that purpose, it's just confusing to use another negative beyond that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-11-24 04:51</div>
            <div class="timeline-body"><p>I got it. Thanks for clarifying and for your encouragement! I’ll start working on this—feel free to assign it to me.</p>
<p>Also, thanks to MichaReiser for pointing out other potential tasks. I really appreciate it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @cake-monotone by @AlexWaygood on 2024-11-24 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @carljm by @AlexWaygood on 2024-11-24 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14588.html">astral-sh/ruff#14588</a> on 2024-11-25 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2024-12-17 16:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
