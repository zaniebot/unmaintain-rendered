<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCH002 false positive for certain target_version or no `__future__.annotations` import - astral-sh/ruff #3299</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>TCH002 false positive for certain target_version or no `__future__.annotations` import</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/3299">#3299</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-03-02 09:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/spaceone">@spaceone</a> on 2023-03-02 09:46</div>
            <div class="timeline-body"><p>I fixed my code according to <code>TCH002</code> and got a <code>NameError</code> exception when executing it and the code doesn't have the <code>from __future__ import annotations</code> import.</p>
<pre><code class="language-python">#!/usr/bin/python3

#from __future__ import annotations

from typing import Iterator, TYPE_CHECKING

from apt_pkg import Version

if TYPE_CHECKING:
    from apt_pkg import Version2

class Foo:

    def bar(self) -&gt; Iterator[Version]:
        pkg = self.apt['foo']
        cand = pkg.candidate
        yield cand

    def baz(self) -&gt; Iterator[Version2]:
        pkg = self.apt['foo']
        cand = pkg.candidate
        yield cand

Foo().bar()
Foo().baz()

</code></pre>
<p>‚Üí</p>
<pre><code class="language-console">$ python3.9 foo.py
Traceback (most recent call last):
  File &quot;foo.py&quot;, line 12, in &lt;module&gt;
    class Foo:
  File &quot;foo.py&quot;, line 19, in Foo
    def baz(self) -&gt; Iterator[Version2]:
NameError: name 'Version2' is not defined
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-03-02 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-03-02 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-02 18:20</div>
            <div class="timeline-body"><p>üëç Those should be treated as runtime annotations, since they're defined within a class scope. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3312.html">astral-sh/ruff#3312</a> on 2023-03-02 21:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-02 21:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
