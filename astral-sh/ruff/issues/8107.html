<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`UP031` (printf-string-formatting) difference between Ruff and pyupgrade - astral-sh/ruff #8107</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>UP031</code> (printf-string-formatting) difference between Ruff and pyupgrade</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8107">#8107</a>
        opened by <a href="https://github.com/tdulcet">@tdulcet</a>
        on 2023-10-21 14:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tdulcet">@tdulcet</a> on 2023-10-21 14:53</div>
            <div class="timeline-body"><p>I ran Ruff on medium sized project and then pyupgrade. Ruff missed one <code>UP031</code> autofix that pyupgrade fixed. Both Ruff and pyupgrade missed 96 <code>UP031</code> (a <a href="https://docs.astral.sh/ruff/rules/printf-string-formatting/#known-problems">known problem</a>) and 23 <code>UP032</code> (a few of these may be caused by #8106).</p>
<p>Ruff command:</p>
<pre><code>ruff --target-version py310 --select UP --line-length 320 --unsafe-fixes --fix .
</code></pre>
<p>pyupgrade command:</p>
<pre><code>pyupgrade --py310-plus **/*.py
</code></pre>
<p>Diff:</p>
<pre><code class="language-diff">-       path = &quot;%s-%s-%s.pem&quot; % (
+       path = &quot;{}-{}-{}.pem&quot;.format(
		safe_domain_name(cn), # common name, which should be filename safe because it is IDNA-encoded, but in case of a malformed cert make sure it's ok to use as a filename
		cert.not_valid_after.date().isoformat().replace(&quot;-&quot;, &quot;&quot;), # expiration date
		hexlify(cert.fingerprint(hashes.SHA256())).decode(&quot;ascii&quot;)[0:8], # fingerprint prefix
		)
</code></pre>
<p>(There were some additional differences due to Ruff not supporting the <a href="https://github.com/asottile/pyupgrade/commits/main/README.md">newer pyupgrade rules</a>.)</p>
<p>Ruff version:</p>
<pre><code>ruff 0.1.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-30 02:54</div>
            <div class="timeline-body"><p>Thanks for reporting! It's because of the comments which is a known limitation:</p>
<p>https://github.com/astral-sh/ruff/blob/87772c28847a7c9ed0843a32eb25dbec7a60b5f5/crates/ruff_linter/src/rules/pyupgrade/rules/printf_string_formatting.rs#L493-L498</p>
<p>Relevant issue: https://github.com/astral-sh/ruff/issues/6336</p>
<p>\cc @zanieb Do we want to downgrade the applicability level as suggested (https://github.com/astral-sh/ruff/pull/6342#discussion_r1284475389) now that we support them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @dhruvmanila on 2023-10-30 02:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dhruvmanila on 2023-10-30 02:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-30 03:59</div>
            <div class="timeline-body"><p>Yeah, I'd suggest flagging the diagnostic, and using an unsafe fix personally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @dhruvmanila on 2023-11-20 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-12-07 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-07 03:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:39 UTC
    </footer>
</body>
</html>
