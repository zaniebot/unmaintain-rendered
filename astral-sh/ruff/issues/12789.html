<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule Request: useless function - astral-sh/ruff #12789</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule Request: useless function</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12789">#12789</a>
        opened by <a href="https://github.com/KangOl">@KangOl</a>
        on 2024-08-09 17:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/KangOl">@KangOl</a> on 2024-08-09 17:08</div>
            <div class="timeline-body"><p>Today, I (mostly) wrote the following code:</p>
<pre><code class="language-python">class BaseConverter:
    def to_html(self):
        return HTMLConverter()

    def _loads(self, string):
        raise NotImplementedError

    def __call__(self):
        ...

def HTMLConverter(BaseConverter):
    def to_html(self):
        return self
    
    def _loads(self, string):
        return lxml.html.fromstring(string)
</code></pre>
<p>Did you spot the error? Obviously, the title of this issue is a big hint, but for the other ones, here is how to fix the code:</p>
<pre><code class="language-diff">- def HTMLConverter(BaseConverter):
+ class HTMLConverter(BaseConverter):
</code></pre>
<p>I think this kind of error can be detected by ruff, as the body of the <code>HTMLConverter</code> <em>function</em> only contains other functions and its sole argument is the name of a defined class.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-08-10 04:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-08-10 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-10 04:05</div>
            <div class="timeline-body"><p>That's funny. We could probably support functions that only contain definitions. What do you think, @AlexWaygood?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-10 10:37</div>
            <div class="timeline-body"><p>Yeah, I think this is a reasonable request. I agree that a function that only contains other functions is almost certainly not what was intended, so I think it's safe to flag it ðŸ˜„</p>
<blockquote>
<p>We could probably support functions that only contain definitions.</p>
</blockquote>
<p>Hmm, functions that only contain class definitions aren't quite so clear cut, since they can still have side effects when they're executed:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; def foo():
...   class Bar:
...     print('yo')
...     
&gt;&gt;&gt; foo()
yo
</code></pre>
<p>Though I suppose even for a function that only contains function definitions (and doesn't return any of them), it's hard to say <em>for sure</em> that it didn't have any side effects, because of decorators:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; REGISTRY = []
&gt;&gt;&gt; def foo():
...   @REGISTRY.append
...   def bar(): pass
...     
&gt;&gt;&gt; foo()
&gt;&gt;&gt; REGISTRY
[&lt;function foo.&lt;locals&gt;.bar at 0x11b6a3370&gt;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-12 05:45</div>
            <div class="timeline-body"><p>@AlexWaygood feel free to update the labels accordingly :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-12 10:57</div>
            <div class="timeline-body"><p>I think exactly what the decision should be here depends on how many false positives we'd be willing to tolerate from this rule:</p>
<ul>
<li>If we want it to have a &quot;pyflakes level of accuracy&quot;, where the rule has close to zero false positives, then we should <em>only</em> emit a diagnostic if we see a function where the only items in the function body are function definitions, and none of the inner functions have any decorators</li>
<li>If we're prepared to accept more false positives from the rule -- because we want it to catch more errors -- then we could also emit the diagnostic even if some of the inner functions are decorated, or if some of the inner definitions are class definitions.</li>
</ul>
<p>So while I'm supportive of adding a rule like this, I'm not 100% sure what exactly the rule should look like. @charliermarsh / @dhruvmanila -- any thoughts from you on that?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:40 UTC
    </footer>
</body>
</html>
