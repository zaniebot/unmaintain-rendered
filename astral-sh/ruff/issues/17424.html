<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF009 - Frozen Dataclass default should be valid - astral-sh/ruff #17424</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF009 - Frozen Dataclass default should be valid</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17424">#17424</a>
        opened by <a href="https://github.com/CarliJoy">@CarliJoy</a>
        on 2025-04-16 10:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/CarliJoy">@CarliJoy</a> on 2025-04-16 10:53</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Frozen dataclasses and attrs objects should be considered immutable.</p>
<p><a href="https://play.ruff.rs/b092eb6e-c17e-47dc-b45c-fdba55e00852">Playground</a></p>
<pre><code class="language-python">@attrs.frozen
class A:
    foo: int = 1

@attrs.frozen
class B:
    a: A = A()  # should be valid, but gives RUF009

@dataclasses.dataclass(frozen=True)
class C:
    foo: int = 1

@dataclasses.dataclass(frozen=True)
class D:
    d: C = C()  # should be valid , but gives RUF009
</code></pre>
<h3>Version</h3>
<p>v0.11.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "RUF009 - Frozen Dataclass default are valid" to "RUF009 - Frozen Dataclass default should be valid" by @CarliJoy on 2025-04-16 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @dylwil3 on 2025-04-16 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-21 19:15</div>
            <div class="timeline-body"><p>I don't think that's what the rule is intended to catch. When you specify <code>frozen = True</code>, it's only the dataclass fields that are frozen i.e., you cannot re-assign the fields, and not the objects contained within the dataclass. Consider the following example:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; from dataclasses import dataclass
&gt;&gt;&gt; class Foo:
...     def __init__(self, x: int) -&gt; None:
...         self.x = x
...         
&gt;&gt;&gt; @dataclass(frozen=True)
... class Bar:
...     f: Foo = Foo(1)
...     
&gt;&gt;&gt; b1 = Bar()
&gt;&gt;&gt; b2 = Bar()
&gt;&gt;&gt; b3 = Bar()
&gt;&gt;&gt; b1.f.x
1
&gt;&gt;&gt; b2.f.x
1
&gt;&gt;&gt; b3.f.x
1
&gt;&gt;&gt; b1.f.x = 2
&gt;&gt;&gt; b1.f.x
2
&gt;&gt;&gt; b2.f.x
2
&gt;&gt;&gt; b3.f.x
2
&gt;&gt;&gt; b1.f = Foo(2)
Traceback (most recent call last):
  File &quot;&lt;python-input-13&gt;&quot;, line 1, in &lt;module&gt;
    b1.f = Foo(2)
    ^^^^
  File &quot;&lt;string&gt;&quot;, line 15, in __setattr__
dataclasses.FrozenInstanceError: cannot assign to field 'f'
</code></pre>
<p>You can see that updating the <code>Foo</code> object's <code>x</code> attribute on one instance of <code>Bar</code> (which is a dataclass) is visible to all instances of the same dataclass.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-21 19:17</div>
            <div class="timeline-body"><p>And, the way to fix that would be to use <code>field(default_factory=...)</code>:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; from dataclasses import field
&gt;&gt;&gt; @dataclass(frozen=True)
... class FixedBar:
...     f: Foo = field(default_factory=lambda: Foo(1))
...     
&gt;&gt;&gt; fb1 = FixedBar()
&gt;&gt;&gt; fb2 = FixedBar()
&gt;&gt;&gt; fb1.f.x
1
&gt;&gt;&gt; fb2.f.x
1
&gt;&gt;&gt; fb1.f.x = 2
&gt;&gt;&gt; fb1.f.x
2
&gt;&gt;&gt; fb2.f.x
1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> removed by @dhruvmanila on 2025-04-21 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2025-04-21 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-21 19:18</div>
            <div class="timeline-body"><p>Oh shoot, I think I misunderstood the issue ü§¶‚Äç‚ôÇ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @dhruvmanila on 2025-04-21 19:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-04-21 19:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @dhruvmanila on 2025-04-21 19:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lubaskinc0de">@lubaskinc0de</a> on 2025-06-15 07:48</div>
            <div class="timeline-body"><p>I would like to start working on this from Monday.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-06-23 19:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:15 UTC
    </footer>
</body>
</html>
