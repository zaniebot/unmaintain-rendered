```yaml
number: 4798
title: "ðŸ“‹ Formatter: Syntax Formatting"
type: issue
state: closed
author: MichaReiser
labels:
  - formatter
  - help wanted
assignees: []
created_at: 2023-06-02T06:28:46Z
updated_at: 2023-09-08T07:25:40Z
url: https://github.com/astral-sh/ruff/issues/4798
synced_at: 2026-01-10T01:56:47Z
```

# ðŸ“‹ Formatter: Syntax Formatting

---

_Issue opened by @MichaReiser on 2023-06-02 06:28_

This task coordinates the work on implementing formatting for the Python syntax. 

Please create an issue and comment that you intend to work on before starting a new syntax. This allows us to better coordinate the work.

## Module

* [x] #4800
* [ ] Formatter: `Interactive`
* [x] Formatter: `Expression` https://github.com/astral-sh/ruff/pull/5689
* [ ] Formatter: `FunctionType`

> *Note*: Our infrastructure only supports testing `Module`. We should, therefore, wait to implement the other variants. 

## Statements

* [x] #4799
* [x] #4955
* [x] Formatter: `Return` (#4960)
* [x] #5287
* [x] Formatter: `Assign` (basic implementation done, missing is wrapping the left hand side like black which is hard)
* [x] Formatter: `AugAssign` https://github.com/astral-sh/ruff/pull/5655
* [x] #5662
* [x] #5288
* [x] #4806
* [x] #4956
* [x] #5368
* [x] #5834
* [x] #5595
* [x] #5245
* [x] Formatter: `Assert` (https://github.com/astral-sh/ruff/pull/5168)
* [x] Formatter: `Import ` https://github.com/astral-sh/ruff/pull/5493
* [x] Formatter: `ImportFrom` (includes `Alias`) https://github.com/astral-sh/ruff/pull/5493
* [x] Formatter: `Global` https://github.com/astral-sh/ruff/pull/6170 (deviation from black: break over multiple lines if it exceeds the line-width https://github.com/psf/black/issues/1357)
* [x] Formatter: `Nonlocal` https://github.com/astral-sh/ruff/pull/6170 (deviation from black: break over multiple lines if it exceeds the line-width https://github.com/psf/black/issues/1357)
* [x] Formatter: `Expr` #4788
* [x] Formatter: `Pass` (#4959)
* [x] Formatter: `Break`
* [x] Formatter: `Continue`
* [ ] #5929 (https://github.com/astral-sh/ruff/pull/6161, https://github.com/astral-sh/ruff/pull/6162)

## Expressions

* [x] #4962
* [x] Formatter: `NamedExpr` https://github.com/astral-sh/ruff/issues/5613
* [x] #4896
* [x] #5216
* [x] #5826
* [x] Formatter: `IfExp` https://github.com/astral-sh/ruff/pull/5597
* [x] #5206
* [x] Formatter: `Set`
* [x] #5600
* [x] #5674
* [x] #5778
* [x] #5676
* [x] Formatter: `Await`
* [x] #5916
* [x] #5242
* [ ] Formatter: `Call` (https://github.com/astral-sh/ruff/pull/5341, https://github.com/astral-sh/ruff/issues/5343)
* [x] #5913
* [ ] Formatter: `Constant` (#4954)
	* [x] #5294
	* [ ] #6064 (https://github.com/astral-sh/ruff/pull/6166)
	* [x] Tuple constant formatting
	* [x] Float constant formatting  #5972
	* [x] Int constant formatting  #5972
	* [x] Complex constant formatting  #5972
	* [x] Bool constant (good first issue)
	* [x] Ellipsis constant (good first issue)
	* [x] None constant (good first issue)
* [x] #5257 (https://github.com/astral-sh/ruff/issues/5343)
* [x] #5286
* [x] #5650
* [x] #4802
* [x] Formatter: `List` (https://github.com/astral-sh/ruff/pull/4862)
* [x] Formatter: `Tuple` (#4963)
* [x] Formatter: `Slice` (https://github.com/astral-sh/ruff/pull/5047)

## Improvements

* [x] #5779
* [x] #5780
* [x] #5781


## Cross-cutting

* [x] #5671
* [x] #4801
* [x] #6196
* [x] #5336
* [x] #6197
* [x] #5326
* [ ] Decide on trailing comments formatting https://github.com/astral-sh/ruff/pull/5353

## Bugs

See [open issues](https://github.com/astral-sh/ruff/issues?q=is%3Aopen+is%3Aissue+label%3Abug+label%3Aformatter)

## Notes

https://github.com/charliermarsh/ruff/pull/4730 removed the prototype from @charliermarsh. It's worth taking a look at it when implementing new formatting because it already formatted a lot of syntaxes correctly.

---

_Label `autoformatter` added by @MichaReiser on 2023-06-02 06:28_

---

_Assigned to @MichaReiser by @MichaReiser on 2023-06-02 06:28_

---

_Assigned to @konstin by @MichaReiser on 2023-06-02 06:28_

---

_Comment by @JonathanPlasse on 2023-06-02 06:31_

`Alilas`?

---

_Comment by @MichaReiser on 2023-06-02 06:35_

> `Alilas`?

It seems to be used in `ImportFrom`. I moved it to `ImportFrom`.

---

_Referenced in [astral-sh/ruff#4822](../../astral-sh/ruff/pulls/4822.md) on 2023-06-03 05:19_

---

_Comment by @MichaReiser on 2023-06-05 17:27_

If someone's interested in familiarizing themselves with the formatter API, then the following are probably good starters:

* `Pass`, `Break`, and `Continue`: I don't expect this to change the formatter output (also because we only support formatting `while` statements) but you can see how the IR and `write` macro work
* `Constant::None` and `Bool`: Same as for `Pass`... 
* `Constant::Ellipsis`: this should be easy, but I believe black removes ellipsis sometimes. It would be good to understand when this is the case. We don't necessarily have to implement it in the first PR
* nolocal and global
* These may be good starts, but could also be difficult. 
  * `UnaryOp`
  * `Await`
  * `YieldFrom`
  * `Return`
  * `Raise`
  * `Assert`
  * `Delete`

Let me know if you're interested. 

For testing. We have tests that automatically compare our output with black's output. You can run them with `cargo test` and review the changes with `cargo insta review`. You can also add your own tests by adding a file to `crates/ruff_python_formatter/resources/test/fixtures/ruff` (it may sometimes be necessary to run a `cargo clean` in case your test doesn't get picked up)

What's worth testing:
* Comments in all possible positions :D 


---

_Label `help wanted` added by @MichaReiser on 2023-06-05 17:27_

---

_Comment by @addisoncrump on 2023-06-06 07:53_

Is the goal here to reach parity with black?

---

_Comment by @MichaReiser on 2023-06-06 07:58_

> Is the goal here to reach parity with black?

The goal is to be black-compatible except for pathological cases.

---

_Comment by @addisoncrump on 2023-06-06 08:01_

Okay. Depending on how strictly you want to be having the exact same output as black, this could potentially be tested with [differential fuzzing](https://en.wikipedia.org/wiki/Differential_testing). If that's desirable, please let me know and I can write a harness for this :slightly_smiling_face: 

Otherwise, I will likely swing back around once this reaches a steady state and add an idempotency fuzzer.

---

_Comment by @warsaw on 2023-06-06 16:16_

> The goal is to be black-compatible except for pathological cases

I would dearly love at least the option to choose a different default quote character.  At least on US keyboards, double quotes are ergonomically inferior.  It's the number one reason why [blue](https://blue.readthedocs.io/en/latest/) exists.

---

_Comment by @charliermarsh on 2023-06-06 16:39_

We still plan to make the quote style and indentation style configurable, though the exact settings scheme etc. havenâ€™t been designed yet.

---

_Comment by @MichaReiser on 2023-06-06 16:51_

See  #1904 for an in-depth discussion around the goal. The purpose of this task is to track the implementation work

---

_Referenced in [astral-sh/ruff#4987](../../astral-sh/ruff/issues/4987.md) on 2023-06-09 17:22_

---

_Referenced in [astral-sh/ruff#4988](../../astral-sh/ruff/issues/4988.md) on 2023-06-09 17:23_

---

_Comment by @MichaReiser on 2023-06-22 06:50_

Some other good first issues could be

* Star expression
* Yield and Yield from

---

_Referenced in [grantjenks/blue#2](../../grantjenks/blue/issues/2.md) on 2023-06-23 02:43_

---

_Comment by @LouisDISPA on 2023-07-07 13:04_

Hello, I'm interested in the formatter and while having a look at the code I did the raise formatter code. I'm not sure it's good but I can open a PR if you want. I took inspiration from the return formatter.

---

_Comment by @MichaReiser on 2023-07-07 13:54_

> Hello, I'm interested in the formatter and while having a look at the code I did the formatter code. I'm not sure it's good but I can open a PR if you want. I took inspiration from the return formatter.

Feel free to open a PR. On which node where you working?

---

_Comment by @LouisDISPA on 2023-07-07 13:58_

> Feel free to open a PR. On which node where you working?

Sorry I edited my comment, it was the StmtRaise node.  
Ok I'll open the PR!


---

_Referenced in [astral-sh/ruff#5600](../../astral-sh/ruff/pulls/5600.md) on 2023-07-10 07:27_

---

_Referenced in [astral-sh/ruff#5655](../../astral-sh/ruff/pulls/5655.md) on 2023-07-11 06:19_

---

_Comment by @cnpryer on 2023-07-15 22:03_

Any chance we can open an issue for `lambda`? I have a [lambda branch](https://github.com/cnpryer/ruff/tree/expr-lambda) but I'm not sure I'm ready to claim it. If I have any questions it'd be nice to ask there.

---

_Comment by @MichaReiser on 2023-07-17 08:42_

> Any chance we can open an issue for `lambda`? I have a [lambda branch](https://github.com/cnpryer/ruff/tree/expr-lambda?rgh-link-date=2023-07-15T22%3A03%3A35Z) but I'm not sure I'm ready to claim it. If I have any questions it'd be nice to ask there.

Sure: https://github.com/astral-sh/ruff/issues/5826 

---

_Referenced in [astral-sh/ruff#6170](../../astral-sh/ruff/pulls/6170.md) on 2023-07-29 12:19_

---

_Added to milestone `Formatter: Alpha` by @MichaReiser on 2023-07-31 15:48_

---

_Comment by @MichaReiser on 2023-07-31 17:02_

I'm closing this one. There's still some work left to be done but we'll track this as part of #6203

---

_Closed by @MichaReiser on 2023-07-31 17:02_

---
