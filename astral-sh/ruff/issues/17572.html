<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursor jumps to end of file when formatting files with large tuples - astral-sh/ruff #17572</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Cursor jumps to end of file when formatting files with large tuples</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/17572">#17572</a>
        opened by <a href="https://github.com/rintrint">@rintrint</a>
        on 2025-04-23 06:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rintrint">@rintrint</a> on 2025-04-23 06:19</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When formatting Python files with large tuples (&gt;20K chars), the cursor jumps to the end of file. This only happens when:</p>
<ol>
<li>The tuple is very large (&gt;20K characters)</li>
<li>The formatter makes significant changes, causing a delay</li>
<li>The cursor is positioned <strong>INSIDE</strong> the large tuple when formatting is triggered</li>
</ol>
<p>I've tested that:</p>
<ul>
<li>Reducing tuple size to &lt;20K chars fixes the issue</li>
<li>Files with 30K+ char tuples but minimal formatting changes don't have this issue</li>
</ul>
<p>The problem seems related to both tuple size AND amount of reformatting needed.</p>
<p>Reproducible with this file:
https://github.com/MMD-Blender/blender_mmd_tools/blob/6ae13d6039763b6813832622c13da464983e93b3/mmd_tools/m17n.py</p>
<h3>Version</h3>
<p>VS Code: 1.99.3
Ruff extension: 2025.22.0
OS: Windows_NT x64 10.0.19045</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Cursor jumps to end of file when formatting files with large tuple" to "Cursor jumps to end of file when formatting files with large tuples" by @rintrint on 2025-04-23 06:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-04-23 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-23 06:25</div>
            <div class="timeline-body"><p>Thanks for the report. The cursor positioning is currently handled by VS code. We may need to implement https://github.com/astral-sh/ruff/issues/10179 to improve the positioning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rintrint">@rintrint</a> on 2025-04-23 06:38</div>
            <div class="timeline-body"><p>Thanks for the info about #10179.
I tested with Black Formatter for comparison and found that while it also moves the cursor, it only shifts it slightly rather than jumping to the end of file. This is much more usable behavior.
However, Black Formatter is significantly slower when formatting this file with a large tuple.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-23 06:46</div>
            <div class="timeline-body"><p>Interesting, nice find. Another possibility here is that using a different diff algorithm when computing the text edits between the formatted and unformatted string might produce better results.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ty/issues/71.html">astral-sh/ty#71</a> on 2025-05-05 13:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
