<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weird behaviour of Rule C400 and C416 - astral-sh/ruff #10778</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Weird behaviour of Rule C400 and C416</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10778">#10778</a>
        opened by <a href="https://github.com/VascoSch92">@VascoSch92</a>
        on 2024-04-04 19:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/VascoSch92">@VascoSch92</a></div>
            <div class="timeline-body"><p><strong>Ruff version: 0.3.5</strong></p>
<p><em>I&#x27;m sorry for the long post</em></p>
<p>Hey,
I would like to document the following behaviours about rules C400 and C416</p>
C400 error message
<p>I have the following script <code>scratch.py</code></p>
<pre><code>from typing import Dict, List, Tuple

def generate_samples(test_cases: Dict) -&gt; List[Tuple]:
    return list(
        (input, expected)
        for input, expected in zip(test_cases[&quot;input_value&quot;], test_cases[&quot;expected_value&quot;])
    )
</code></pre>
<p>I run the following command</p>
<pre><code>&gt;&gt; ruff check scratch.py --select C400              
&gt;&gt; scratch.py:5:12: C400 Unnecessary generator (rewrite using `list()`)
</code></pre>
<p>You can see that the error message is misleading. After looking into the <a href="https://docs.astral.sh/ruff/rules/unnecessary-generator-list/">C400 rule documentation</a> I propose to change the error message with one of the following:</p>
<ol>
<li><em>C400 Unnecessary generator (rewrite using <code>[a for a in iterable]</code>)</em> or</li>
<li><em>C400 Unnecessary generator (rewrite using <code>list(iterable)</code>)</em> or</li>
<li><em>C400 Unnecessary generator (rewrite using <code>[a for a in iterable]</code> or <code>list(iterable)</code>)</em>.</li>
</ol>
<p>I can open a PR to fix that if you are interested. Let me know which error message you like the most.</p>
Conflict between C400 and C416
<p>Consider <code>scratch.py</code> equal to</p>
<pre><code>from typing import Dict, List, Tuple

def generate_samples_v_1(test_cases: Dict) -&gt; List[Tuple]:
    return list(
        (input, expected)
        for input, expected in zip(test_cases[&quot;input_value&quot;], test_cases[&quot;expected_value&quot;])
    )

def generate_samples_v_2(test_cases: Dict) -&gt; List[Tuple]:
    return [
        (input, expected)
        for input, expected in zip(test_cases[&quot;input_value&quot;], test_cases[&quot;expected_value&quot;])
    ]
</code></pre>
<p>I run the following command</p>
<pre><code>&gt;&gt; ruff check scratch.py --select C400 --select C416
&gt;&gt; scratch.py:4:12: C400 Unnecessary generator (rewrite using `list()`)  # this is for generate_samples_v_1 
&gt;&gt; scratch.py:10:12: C416 Unnecessary `list` comprehension (rewrite using `list()`)  # this if for generate_samples_v_2 
</code></pre>
<p>Clearly, <code>C400</code> and <code>C416</code> are in conflict (as we can understand from the documentation and from this example). Moreover, we have the following problem: <code>C400</code> doesn&#x27;t accept the output of <code>generate_samples_v_1</code>, but C416 does.</p>
<p>My questions:</p>
<ol>
<li>is it correct that C400 doesn&#x27;t accept the output of <code>generate_samples_v_1</code>, but C416 does ?</li>
<li>is it correct that C416 accepts the output of <code>generate_samples_v_2</code>?</li>
<li>from the documentation of <code>C400</code> and <code>C416</code>, we are inclined to understand that <code>C416</code> should contain <code>C400</code>. Therefore, they should not have conflicts, correct?</li>
</ol>
<p>Without changing the rules <code>C400</code> and <code>C416</code>, we could:</p>
<ol>
<li>rewrite the error message of <code>C416</code> as: <em>C416 Unnecessary generator (rewrite using <code>list(iterable)</code>)</em></li>
<li>using the error message number 3 proposed in the section <code>C400 error message</code>
This should clarify the situation for future users.
(Perhaps also adding a line in the documentation shortly explaining the situation could be cool)</li>
</ol>
<p>Let me know if you are interested in the above changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/autinerd">@autinerd</a> on 2024-04-06 17:32</div>
            <div class="timeline-body"><p>Hi!</p>
<p>I don&#x27;t quite understand what you mean with conflict.</p>
<ol>
<li><p>I understand from you that you would like that the error message is rewritten as <em>C400 Unnecessary generator (rewrite using <code>list(zip(test_cases[&quot;input_value&quot;], test_cases[&quot;expected_value&quot;]))</code></em> or similar in your example. (Ruff has a fix available, so you could also say that it is not really needed)</p>
</li>
<li><p>The both rules are not in conflict. C400 is for generator expressions, while C416 is for list/dict/set comprehensions. Your function <code>generate_samples_v_1</code> contains a generator expression, your function <code>generate_samples_v_2</code> contains a list comprehension. These look similar, but are not exactly the same.</p>
</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2024-04-06 21:07</div>
            <div class="timeline-body"><blockquote>
<p>The both rules are not in conflict. C400 is for generator expressions, while C416 is for list/dict/set comprehensions. Your function generate_samples_v_1 contains a generator expression, your function generate_samples_v_2 contains a list comprehension. These look similar, but are not exactly the same.</p>
</blockquote>
<p>Thanks for your answer. Now I understand better the situation, and I think that probably there are no problem at all. I was just confused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-07 07:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:52 UTC
    </footer>
</body>
</html>
