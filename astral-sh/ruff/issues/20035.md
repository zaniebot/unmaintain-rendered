```yaml
number: 20035
title: "`ruff format` can double count formatted files"
type: issue
state: closed
author: zanieb
labels:
  - bug
  - cli
assignees: []
created_at: 2025-08-21T23:01:52Z
updated_at: 2025-09-19T18:40:24Z
url: https://github.com/astral-sh/ruff/issues/20035
synced_at: 2026-01-10T01:56:57Z
```

# `ruff format` can double count formatted files

---

_Issue opened by @zanieb on 2025-08-21 23:01_

### Summary

```
❯ cd /tmp
❯ rm -rf example
❯ mkdir example

❯ echo "x   = 1" > example/foo.py
❯ uvx ruff format example example/foo.py
2 files reformatted

❯ echo "x   = 1" > example/foo.py
❯ uvx ruff format example
1 file reformatted
```

`foo.py` appears to be counted twice when there are two ways it is selected.

Here are some logs

```
[2025-08-21][18:02:39][ruff::resolve][DEBUG] Using Ruff default settings
[2025-08-21][18:02:39][ignore::gitignore][DEBUG] opened gitignore file: /Users/zb/.gitignore
[2025-08-21][18:02:39][ruff_workspace::resolver][DEBUG] Included path via `include`: "/private/tmp/example/foo.py"
[2025-08-21][18:02:39][ruff::commands::format][DEBUG] format_path; path=/private/tmp/example/foo.py
[2025-08-21][18:02:39][ruff::commands::format][DEBUG] format_path; path=/private/tmp/example/foo.py
[2025-08-21][18:02:39][tracing::span][DEBUG] Printer::print;
[2025-08-21][18:02:39][tracing::span][DEBUG] Printer::print;
[2025-08-21][18:02:39][ruff::commands::format][DEBUG] Formatted 2 files in 2.87ms
```

### Version

0.12.10

---

_Label `bug` added by @zanieb on 2025-08-21 23:02_

---

_Label `cli` added by @zanieb on 2025-08-21 23:02_

---

_Comment by @zanieb on 2025-08-21 23:04_

Probably some context on the root cause in https://github.com/astral-sh/ruff/issues/19395

---

_Comment by @zanieb on 2025-08-21 23:05_

It's unclear if we should dedup the actual formatting or dedup the counts.

---

_Referenced in [astral-sh/uv#15438](../../astral-sh/uv/pulls/15438.md) on 2025-08-21 23:05_

---

_Comment by @MichaReiser on 2025-08-22 06:10_

We should deduplicate the files because that fixes #19395 too. 

---

_Referenced in [astral-sh/ruff#20105](../../astral-sh/ruff/pulls/20105.md) on 2025-08-26 19:42_

---

_Closed by @ntBre on 2025-09-19 18:40_

---
