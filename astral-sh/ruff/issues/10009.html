<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Request: Custom allowlist for Magic Numbers (PLR2004) - astral-sh/ruff #10009</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature Request: Custom allowlist for Magic Numbers (PLR2004)</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10009">#10009</a>
        opened by <a href="https://github.com/Spectre5">@Spectre5</a>
        on 2024-02-16 16:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Spectre5">@Spectre5</a> on 2024-02-16 16:30</div>
            <div class="timeline-body"><p>PLR2004 has a few allowed numbers including '', 0, and 1.  #9964 has fixed a bug so that 0.0 and 1.0 are also allowed.  There is <a href="https://docs.astral.sh/ruff/settings/#lint_pylint_allow-magic-value-types">already</a> an option to ignore certain types of variables from the check.  I'd like to request an option to extend the allowlist.  For example, I have a library where 2 (and 2.0) are really common and I don't want to use a global variable for it.  So I ether need many noqa comments or to disable the check entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @AlexWaygood on 2024-02-18 11:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/branidal">@branidal</a> on 2024-07-21 11:33</div>
            <div class="timeline-body"><p>This would indeed be a very nice improvement. I think there are quite a few common magic variables that are commonly ok but inconvenient to define globally (in my case 0.5) and I can imagine users wanting to be able to add any number of additional options.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-21 12:19</div>
            <div class="timeline-body"><p>I think it's also worth asking whether we should just add 2 and 2.0 to the allowed list?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2024-07-21 12:25</div>
            <div class="timeline-body"><p>I hope this can be made configurable. I use the magic numbers 90, 180, 270, and 360 all over my code, but it wouldnâ€™t make sense to add those to the allowed list for everyone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2024-08-05 22:44</div>
            <div class="timeline-body"><p>To me it would make sense to both make it configurable, but also add 2/2.0 to the default list of allowed values.
I wonder whether there is a quick way to scrape github in a way to get the statistics of which values are most commonly used with <code>noqa: PLR2004</code>. I would guess that at least 2 and 2.0 are very common. Maybe some others as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-08-06 06:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RubenVanEldik">@RubenVanEldik</a> on 2024-10-07 10:10</div>
            <div class="timeline-body"><p>I agree with the idea that a whitelist for magic numbers should be customizable. The idea of not using magic numbers is because it's harder to infer the meaning of a line of code if random values are sprinkled throughout it. However, depending on the codebase some numbers might make total sense.</p>
<p>For example, I work on an energy related application. The number 3600 is commonly used to convert between Joule and kWh. Everyone in our team understands the meaning and context of these numbers and there is no value in making a variable for it first. As @dscorbett described, if you're working with angles (degrees) than 90, 180, 270, and 360 are completely self explanatory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python/typeshed/pulls/13307.html">python/typeshed#13307</a> on 2024-12-26 20:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/real-or-random">@real-or-random</a> on 2025-02-06 09:13</div>
            <div class="timeline-body"><blockquote>
<p>To me it would make sense to both make it configurable, but also add 2/2.0 to the default list of allowed values.</p>
</blockquote>
<p>I agree. 2 (and perhaps also 3) is common enough that it should be allowed by default. But making it configurable will make sense for values that make sense in a certain code base, e.g., 90, 180, 270, and 360.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-05-12 13:23</div>
            <div class="timeline-body"><p>For reference, pylint has an option to set this:</p>
<p>https://pylint.pycqa.org/en/latest/user_guide/configuration/all-options.html#magic-value-options</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Feature Request: Custom Whitelist for Magic Numbers (PLR2004)" to "Feature Request: Custom allowlist for Magic Numbers (PLR2004)" by @MichaReiser on 2025-05-12 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-06-25 17:07</div>
            <div class="timeline-body"><p>I'm happy to give this a shot, if that's ok.
Not sure I'll manage, but would like to try</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-25 17:47</div>
            <div class="timeline-body"><p>The issue is still labeled <code>needs-decision</code>, so I'm not sure we'd want to merge anything until that decision is made. @MichaReiser do you remember what needed to be decided here? Whether we want this to be configurable at all?</p>
<p>One complication I can see is how we would handle the various types supported by the rule. It looks like pylint supports both numbers and strings for their related option. Special-casing floats could be one solution to that, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 20:29</div>
            <div class="timeline-body"><p>Yes, it's mainly if we want the option in the first place. A good start would be a proposal for how the option would work (what is it named, what are the defaults, etc)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-06-26 00:10</div>
            <div class="timeline-body"><p>If the rule's named <code>magic-value-comparison (PLR2004)</code> then an option <code>lint.pylint.allow-magic-values</code> seems appropriate.
There's already <code>lint.pylint.allow-magic-value-types</code>, so &quot;allow&quot; rather than &quot;allowed&quot; and &quot;values&quot; rather than &quot;value&quot; would keep a similar pattern.</p>
<p>Although that does bring into question whether  <code>lint.pylint.allow-magic-value-types</code> and <code>lint.pylint.allow-dunder-method-names</code> should have been called <code>allowed-*</code> because it's a list of options, not a boolean. As the pattern other rule options seem to follow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-06-26 01:33</div>
            <div class="timeline-body"><blockquote>
<p>A good start would be a proposal for how the option would work (what is it named, what are the defaults, etc)</p>
</blockquote>
<p>I can see an argument for 2 names. First, as mentioned by @Avasam, is <code>lint.allow-magic-values</code> as it is clearly related to <code>pylint.allow-magic-value-types</code>. The other would be <code>pylint.valid-magic-values</code>, which is what it is called in the original <a href="https://pylint.pycqa.org/en/latest/user_guide/configuration/all-options.html#magic-value-checker">pylint setting</a>.
Note that pylint itself does not have an <code>allow-magic-value-types</code> setting. I think it makes sense to still include the types option here, both for backwards compatibility, and because it's actually useful.</p>
<p>The setting will allow input of (a mix of) strings, ints, floats, and bytes, which is equivalent to the types that can be listed as safe by <code>pylint.allow-magic-value-types</code>.</p>
<p>As per the defaults, I think definitely include to what is now implicitly allowed: <code>[1, 1.0, 0, 0.0, &quot;&quot;, &quot;__main&quot;]</code>. Pytest also includes <code>-1</code> as a valid magic value, so i think for consistency it makes sense to include <code>-1</code> and <code>-1.0</code> for ruff as well. Then <code>2</code> and <code>2.0</code> seem to be requested by multiple people in this thread, so those could be included as well; this one is a bit more up in the air as far as I am concerned.
Note that pylint doesn't include any of the floats as valid magic values, but similarly to above, I like having them in ruff.</p>
<p>As per the interaction between <code>pylint.allow-magic-value-types</code> and <code>pylint.valid-magic-values</code>, I think that both settings can be used at the same time, and if a value is allowed by either rule it is safe.
I can see an argument to collapse it into a single setting (which should then probably be renamed to <code>pylint.valid-magic-values</code>) that also allows inputting types to mark all inputs of this type safe. The downsides are that it will not be backward compatible and will be more complicated to implement. The upside is that it is slightly more parsimonious and user-friendly (after the initial compatibility issue wears off). I am not in favor of this option, but could see the point.</p>
<blockquote>
<p>Yes, it's mainly if we want the option in the first place.</p>
</blockquote>
<p>What is the argument against having this as a configurable option? It seems a logical setting to have and pylint does in fact have it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-06-26 14:29</div>
            <div class="timeline-body"><blockquote>
<p>The issue is still labeled <code>needs-decision</code>, so I'm not sure we'd want to merge anything until that decision is made.</p>
</blockquote>
<p>So.... I was looking for a pet project to sink my teeth in for a day so decided to start working on it already, even though I understand that you may not be interested in adopting it. I think I've largely worked it out, so will open a PR showcasing what I have.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/18961.html">astral-sh/ruff#18961</a> on 2025-06-26 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20468.html">astral-sh/ruff#20468</a> on 2025-09-18 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/julianstirling">@julianstirling</a> on 2025-09-18 20:08</div>
            <div class="timeline-body"><p>I missed this when I created #20468.</p>
<p>My non-magic &quot;magic&quot; numbers are 255 and 65535. Reading this I can see how 45,60,90,135,180,270 are not magic, in applications doing a lot of rotations in degrees. I'll quote what I said for our numbers below</p>
<blockquote>
<p>We have a project that does a lot of image handing. Generally images are unit8, sometimes unit16 if getting raw data with higher bit depth. Often certain calculations that could overflow are done as a different datatype. Before conversion you often find yourself checking for overflows.</p>
<p>255 really is not magic in a codebase that does a lot of uint8 maths. But it may be considered so in other codebases. I would like (and 65535) to not be magic, but I can see reasonable arguments for them counting as magic in other codebases.</p>
</blockquote>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
