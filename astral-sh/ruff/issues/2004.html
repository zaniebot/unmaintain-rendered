<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff's first party import detection treats any folder in root as a package - astral-sh/ruff #2004</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff's first party import detection treats any folder in root as a package</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/2004">#2004</a>
        opened by <a href="https://github.com/Jackenmen">@Jackenmen</a>
        on 2023-01-19 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2023-01-19 19:05</div>
            <div class="timeline-body"><p>Repro:</p>
<pre><code>mkdir ruff_isort_repro
cd ruff_isort_repro
python -m venv .venv
. .venv/bin/activate
pip install ruff

mkdir schema
echo '{}' &gt; schema/example-json-schema.json

mkdir example_package
touch example_package/sub.py
echo $'import schema\n\nfrom example_package import sub' &gt; example_package/__init__.py
</code></pre>
<pre><code>$ ruff . --select I001 --fix --diff 
--- example_package/__init__.py
+++ example_package/__init__.py
@@ -1,3 +1,2 @@
 import schema
-
 from example_package import sub

Would fix 1 error(s).
</code></pre>
<p>I've run into this because I use a <code>schema</code> package from PyPI <em>and</em> I have a <code>schema</code> folder with JSON schemas within the root of the repository which causes ruff to think that <code>schema</code> is a package. I think that one way of solving this would be to alter the current heuristic to check for <code>{base}/__init__.py</code> file and <code>{base}.py</code> file rather than <code>{base}</code> directory and <code>{base.py}</code> file. This may potentially affect namespace packages and I'm not sure there's a good solution for this that doesn't involve explicitly specifying namespace packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 22:31</div>
            <div class="timeline-body"><p>What you're describing could work... I believe we already require namespace packages to be defined explicitly (<a href="https://github.com/charliermarsh/ruff#namespace-packages"><code>namespace-packages</code></a>) so that might be fine.</p>
<p>(You could also mark <code>schema</code> as <code>known-third-party</code> to unblock you though.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">core</span> added by @charliermarsh on 2023-01-19 22:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-03-24 20:21</div>
            <div class="timeline-body"><p>The same behavior is in isort  https://github.com/PyCQA/isort/issues/2101</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8372.html">astral-sh/ruff#8372</a> on 2023-10-31 10:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
