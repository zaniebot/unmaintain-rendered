<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relative paths in `per-file-ignores` not respected when running `ruff` outside working directory using `--config` with `pyproject.toml` - astral-sh/ruff #12058</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Relative paths in `per-file-ignores` not respected when running `ruff` outside working directory using `--config` with `pyproject.toml`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/12058">#12058</a>
        opened by <a href="https://github.com/mihirsamdarshi">@mihirsamdarshi</a>
        on 2024-06-27 00:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mihirsamdarshi">@mihirsamdarshi</a> on 2024-06-27 00:19</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<h2>Description</h2>
<p><a href="https://github.com/koxudaxi/ruff-pycharm-plugin/issues/359#issuecomment-2192785432">I noticed this (potential) issue</a> while debugging koxudaxi/ruff-pycharm-plugin#359 for PyCharm. It's may be expected behavior, so please close this issue if so.</p>
<p>When running <code>ruff</code> from a directory that is not the same as the one containing the <code>pyproject.toml</code> file and specifying the <code>--config</code> option, the relative paths specified in the <code>pyproject.toml</code>'s <code>per-file-ignores</code> configuration are not respected.</p>
<p>This normally isn't a problem, since the <code>pyproject.toml</code> lives in the root of project files, but I have a full-stack application where the python source code does not live in the source code <a href="https://github.com/koxudaxi/ruff-pycharm-plugin/issues/359#issuecomment-2192785432">(see the issue above)</a>. I open this root folder in PyCharm. Unfortunately, the <code>ruff-pycharm-plugin</code> runs <code>ruff</code> from the project's root directory, and therefore needs to pass the <code>--config</code> parameter.</p>
<h2>Steps to Reproduce</h2>
<ol>
<li><p>Create a new project, and install <code>ruff</code></p>
<pre><code class="language-shell">❯ rye init example-project
❯ cd example-project
❯ uv venv &amp;&amp; source .venv/bin/activate # or `rye sync`
❯ uv pip install ruff
❯ example-project/.venv/bin/ruff --version
ruff 0.4.10
</code></pre>
</li>
<li><p>In <code>example-project/pyproject.toml</code>, configure <code>per-file-ignores</code> with relative paths:</p>
<pre><code class="language-toml">[tool.ruff.lint]
# The default `rye` project will error on `D103` and `D104` when select = [&quot;ALL&quot;] is used
select = [&quot;ALL&quot;]

[tool.ruff.lint.per-file-ignores]
&quot;./src/example_project/__init__.py&quot; = [&quot;D104&quot;]
</code></pre>
</li>
<li><p>Deactivate the <code>venv</code>, verify that the <code>ruff check</code> command's output is correct from the project's working directory.</p>
<pre><code>❯ deactivate
❯ .venv/bin/ruff check --config pyproject.toml src/
warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible. Ignoring `one-blank-line-before-class`.
warning: `multi-line-summary-first-line` (D212) and `multi-line-summary-second-line` (D213) are incompatible. Ignoring `multi-line-summary-second-line`.
example-project/src/example_project/__init__.py:1:5: D103 Missing docstring in public function
Found 1 error.
</code></pre>
</li>
<li><p>Navigate up a directory, then run <code>ruff check</code> again</p>
<pre><code class="language-shell">❯ cd ..
❯ example-project/.venv/bin/ruff check example-project/src/ --config example-project/pyproject.toml
warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible. Ignoring `one-blank-line-before-class`.
warning: `multi-line-summary-first-line` (D212) and `multi-line-summary-second-line` (D213) are incompatible. Ignoring `multi-line-summary-second-line`.
example-project/src/example_project/__init__.py:1:1: D104 Missing docstring in public package
example-project/src/example_project/__init__.py:1:5: D103 Missing docstring in public function
Found 2 errors.
</code></pre>
</li>
</ol>
<h2>Environment</h2>
<ul>
<li>Ruff version: 0.4.10</li>
<li>OS: macOS 14.5</li>
<li>Shell: fish</li>
</ul>
<h2>Possible Solution</h2>
<p>Consider adjusting how <code>ruff</code> resolves relative paths in the <code>per-file-ignores</code> configuration. It may need to use the directory of the <code>pyproject.toml</code> file as the base for resolving these paths, rather than the current working directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-27 05:58</div>
            <div class="timeline-body"><p>Thanks for the very detailed issue!</p>
<p>I had a quick look at the code and I can confirm that paths are always relative to the root directory.</p>
<p>https://github.com/astral-sh/ruff/blob/72257328591825b7068f4f31a88f8f975ddc538b/crates/ruff_workspace/src/configuration.rs#L486-L519</p>
<p>I'm not entirely sure why the paths are relative to the root and not the configuration. @charliermarsh do you know more about the design decision?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2024-06-27 05:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mihirsamdarshi">@mihirsamdarshi</a> on 2024-07-13 03:55</div>
            <div class="timeline-body"><p>@MichaReiser If I submitted a patch would that be helpful/accepted? Should I wait for @charliermarsh's input?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-13 07:12</div>
            <div class="timeline-body"><p>@mihirsamdarshi, I would prefer to hear @charliermarsh's opinion first. I'm not very familiar with that part of Ruff and the configuration schema is kind of complicated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14640.html">astral-sh/ruff#14640</a> on 2024-11-27 17:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
