<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make the mccabe checker ignore the case of a single top-level elif chain or match statement - astral-sh/ruff #3597</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make the mccabe checker ignore the case of a single top-level elif chain or match statement</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/3597">#3597</a>
        opened by <a href="https://github.com/saolof">@saolof</a>
        on 2023-03-18 11:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/saolof">@saolof</a> on 2023-03-18 11:04</div>
            <div class="timeline-body"><p>This is a somewhat common edge case where there shouldn't be a need to use noqa comments. Non-looping functions with a nesting depth of 1 should be excluded from the mccabe checker, or there should be a separate error code for this particular kind of pattern if you want to lint or ignore it separately, such as &quot;elif chain exceeds mccabe complexity&quot;.</p>
<p>Incidentally, while discussing code complexity KPIs, being able to set a maximum allowed nesting depth would be nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonagestam">@antonagestam</a> on 2023-03-18 16:30</div>
            <div class="timeline-body"><p>I'd like to work on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-19 03:26</div>
            <div class="timeline-body"><p>Confirming my understanding: are you describing something akin to a top-level switch statement? Like:</p>
<pre><code class="language-py">if foo == &quot;bar&quot;:
  return 1
elif foo == &quot;baz:
  return 2:
else ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-03-19 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/saolof">@saolof</a> on 2023-03-19 09:56</div>
            <div class="timeline-body"><p>Yes, exactly. There is a clear difference in complexity between a match statement with 10 cases, and a piece of code that has 3 nested for loops with if-clauses randomly distributed inside.</p>
<p>In the case where you are doing the switch based on type you can of course split it up with the functools.dispatch decorator or methods, and in the case where you just return a value you can use a dictionary, but apart from those cases, one big match with any nested behaviour split off into a separate function is usually simpler than any replacement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonagestam">@antonagestam</a> on 2023-03-19 10:24</div>
            <div class="timeline-body"><p>@saolof I agree, and I think it can sometimes be detrimental to try and break apart code like this. The result isn't likely to be easier for a human to reason about, and is likely to lower cohesion. Single-level structures are the exception to the rule, because they are already easy to reason about and follow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @antonagestam by @MichaReiser on 2023-03-19 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonagestam">@antonagestam</a> on 2023-04-04 09:02</div>
            <div class="timeline-body"><p>Sorry, I haven't had much time to spend on this. I might get to it at some point, but if someone else is keen to work on this, please go ahead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @antonagestam by @charliermarsh on 2023-04-04 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pymodbus-dev/pymodbus/issues/1477.html">pymodbus-dev/pymodbus#1477</a> on 2023-04-24 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-07-10 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-07-10 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
