<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do not autofix F541 `f-string without any placeholders` / mark as risky - astral-sh/ruff #22620</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Do not autofix F541 <code>f-string without any placeholders</code> / mark as risky</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22620">#22620</a>
        opened by <a href="https://github.com/k0pernikus">@k0pernikus</a>
        on 2026-01-16 12:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/k0pernikus">@k0pernikus</a></div>
            <div class="timeline-body">Summary
<p>Given this code:</p>
<pre><code>class Greeter:
    def hello(self, name: str) -&gt; str:
        return f&quot;Hello name!&quot;
</code></pre>
<p>ruff will correctly report:</p>
<pre><code>F541 [*] f-string without any placeholders
 --&gt; utils\src\utils\greeting.py:3:16
  |
1 | class Greeter:
2 |     def hello(self, name: str) -&gt; str:
3 |         return f&quot;Hello name!&quot;
  |                ^^^^^^^^^^^^^^
  |
</code></pre>
<p>Yet its autofix hides the bug the developer made:</p>
<pre><code>help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>It doesn&#x27;t really help that it does not produce an output:</p>
<pre><code>ruff check --fix
Found 1 error (1 fixed, 0 remaining).
</code></pre>
<p>File will now contain:</p>
<pre><code>class Greeter:
    def hello(self, name: str) -&gt; str:
        return &quot;Hello name!&quot;
</code></pre>
<hr>
<p>This is my <code>ruff.toml</code>:</p>
<pre><code>target-version = &quot;py314&quot;
line-length = 88
indent-width = 4

[lint]
select = [
    &quot;E&quot;,
    &quot;F&quot;,
    &quot;UP&quot;,
    &quot;B&quot;,
    &quot;SIM&quot;,
    &quot;I&quot;,
    &quot;W&quot;,
]
ignore = []

[lint.isort]
combine-as-imports = true
lines-after-imports = 2

[format]
quote-style = &quot;double&quot;
indent-style = &quot;space&quot;
skip-magic-trailing-comma = false
</code></pre>
<hr>
<p>Small unit test for the Greeter:</p>
<pre><code>def test_hello_world():
    greeter = Greeter()
    msg = greeter.hello(&quot;User&quot;)

    assert msg == &quot;Hello User!&quot;
</code></pre>
<p>The code as was intended by the devloper:</p>
<pre><code>class Greeter:
    def hello(self, name: str) -&gt; str:
        return f&quot;Hello {name}!&quot;
</code></pre>
<hr>
<p>This might also relate to how <a href="https://docs.astral.sh/ruff/rules/unused-function-argument/">ARG001</a>, <a href="https://docs.astral.sh/ruff/rules/unused-method-argument/">ARG002</a> are not part of the recommended rule set, but <code>F</code> is:</p>
<blockquote>
<p>For example, a configuration that enables some of the most popular rules (without being too pedantic) might look like the following:</p>
<pre><code>[lint]
select = [
    # pycodestyle
    &quot;E&quot;,
    # Pyflakes
    &quot;F&quot;,
    # pyupgrade
    &quot;UP&quot;,
    # flake8-bugbear
    &quot;B&quot;,
    # flake8-simplify
    &quot;SIM&quot;,
    # isort
    &quot;I&quot;,
]
</code></pre>
</blockquote>
<p>-- <a href="https://docs.astral.sh/ruff/linter/#rule-selection">ruff on rule selection</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/k0pernikus">@k0pernikus</a> on 2026-01-16 12:43</div>
            <div class="timeline-body"><p>I added <a href="https://docs.astral.sh/ruff/settings/#lint_extend-unsafe-fixes"><code>extend-unsafe-fixes</code></a> for that rule in my project&#x27;s <code>ruff.toml</code>:</p>
<pre><code>[lint]
select = [
    &quot;E&quot;,
    &quot;F&quot;,
    &quot;UP&quot;,
    &quot;B&quot;,
    &quot;SIM&quot;,
    &quot;I&quot;,
    &quot;W&quot;,
]

ignore = []

extend-unsafe-fixes = [&quot;F541&quot;]
</code></pre>
<p>That works for me:</p>
<pre><code>ruff check --fix 
F541 f-string without any placeholders
 --&gt; utils\src\utils\greeting.py:3:16
  |
1 | class Greeter:
2 |     def hello(self, name: str) -&gt; str:
3 |         return f&quot;Hello name!&quot;
  |                ^^^^^^^^^^^^^^
  |
help: Remove extraneous `f` prefix

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
<p>It is also really great that you have also included the <code>--unsafe-fixes</code>-flag!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-16 14:02</div>
            <div class="timeline-body"><p>Thanks for the report! Yeah, I think this should probably be an unsafe fix by default since the intention of the original code isn&#x27;t clear.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-16 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-19 09:29</div>
            <div class="timeline-body"><p>I&#x27;m not sure we should make this change. <code>F541</code> is a stylistic rule. It&#x27;s not a correctness rule.</p>
<p>Given that the rule doesn&#x27;t judge the code&#x27;s correctness and is only enforcing a specific style, applying that stylistic change doesn&#x27;t make the code any more or less correct. But it does make the code more consistent with the style that the project wants to enforce. In that sense, it&#x27;s very clear what the users&#x27; intentions are; strings without placeholders should not use f-strings. Making the fix unsafe also makes it less useful overall, since it now requires explicit opt-in, which many users are unlikely to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-19 11:29</div>
            <div class="timeline-body"><p>Hmm @MichaReiser I don&#x27;t agree that F541 is a stylistic rule. The original pyflakes linter had very strict criteria for adding rules: rules could only be added if they were almost certain to indicate a likely bug in the code. Sometimes it might be the case that you really did just mean to write a regular string and you didn&#x27;t need the <code>f</code> prefix, but I agree with OP that it seems just as likely that you <em>meant</em> to put placeholders somewhere in the f-string and forgot to do so. In that way, the rule is effective at finding subtle bugs in your code where you&#x27;re not creating the strings that you meant to at all.</p>
<p>I&#x27;m sympathetic to OP&#x27;s argument here that this autofix can be counterproductive -- it can just hide the underlying bug, if there is one, which often isn&#x27;t what you&#x27;d want -- and that therefore it should be explicitly opt-in. Though this doesn&#x27;t really correspond to our usual understanding of &quot;fix safety&quot; -- the fix is certainly <em>safe</em>, as it doesn&#x27;t change runtime behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-19 11:45</div>
            <div class="timeline-body"><blockquote>
<p>to indicate a likely bug in the code</p>
</blockquote>
<p>This very much depends on how you intend to use f-strings. I could totally see myself using f-strings everywhere, and there&#x27;s nothing wrong with that. That&#x27;s why I&#x27;d consider <code>F541</code> either a stylistic or a restriction lint. It may occasionally catch bugs, but I still think it&#x27;s more about consistency, e.g., forgetting to remove a <code>f</code> prefix after I removed some placeholders.</p>
<p>I agree that there will be instances where the fix is undesired. But I don&#x27;t think always making the fix as unsafe is the right approach here. Instead, we could consider to be clever about when the fix is likely unsafe. E.g, can we split the string by whitespace and are there any symbols in scope that match a word in the string? If so, mark the fix as unsafe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-19 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-19 11:50</div>
            <div class="timeline-body"><blockquote>
<p>I could totally see myself using f-strings everywhere, and there&#x27;s nothing wrong with that.</p>
</blockquote>
<p>Hmm, maybe. I don&#x27;t think that&#x27;s how most Python users conventionally use f-strings, however</p>
<blockquote>
<p>I don&#x27;t think always making the fix as unsafe is the right approach here. Instead, we could consider to be clever about when the fix is likely unsafe. E.g, can we split the string by whitespace and are there any symbols in scope that match a word in the string? If so, mark the fix as unsafe.</p>
</blockquote>
<p>Yeah, that would indeed be very cool, and probably a better solution to just marking the fix as unsafe -- agreed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-19 12:52</div>
            <div class="timeline-body"><blockquote>
<p>Hmm, maybe. I don&#x27;t think that&#x27;s how most Python users conventionally use f-strings, however</p>
</blockquote>
<p>The diff in <a href="https://github.com/astral-sh/ruff/pull/22650">#22650</a> suggests to me that it&#x27;s more common than one might think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/k0pernikus">@k0pernikus</a> on 2026-01-19 13:42</div>
            <div class="timeline-body"><blockquote>
<p>I agree that there will be instances where the fix is undesired. But I don&#x27;t think always making the fix as unsafe is the right approach here. Instead, we could consider to be clever about when the fix is likely unsafe. E.g, can we split the string by whitespace and are there any symbols in scope that match a word in the string? If so, mark the fix as unsafe.</p>
</blockquote>
<p>I understand this argument as well.</p>
<p>Your proposed solution would also be better than using ARG001 / ARG002 as those generate way too many false positives during inherited methods. In the aftermath of this issue, I enabled them and realized quickly where they aren&#x27;t recommended. So your proposed is the ideal version, even if it would not catch:</p>
<pre><code>class Greeter:
    def hello(self, name: str) -&gt; str:
        return f&quot;Hello naem!&quot;
</code></pre>
<p>Yet of course, one can have only so much tooling help.</p>
<p>Basically, there is a strong disagreement what risky should mean:</p>
<ul>
<li>does not change the code as is =&gt; this fix is save</li>
<li>does not apply fixes that may be potential bugs =&gt; this fix really isn&#x27;t save at all</li>
</ul>
<p>I use this tooling esp. for catching bugs. I don&#x27;t really care about a developer using f-strings where they aren&#x27;t needed. Though it is nice side-effect for me that this tool ensures that code is written in way that reduces as much diffing noise as possible. Yet that is a nice to have for me, though for other that is the entire point.</p>
<p>Maybe one could have two rules for this so the developer can pick and chose? (Basically, either treating this as a potential bug or as a plain formatting issue and if the bug-rule is choosen, it should take precedence if --fix is applied)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-19 14:19</div>
            <div class="timeline-body"><p>Sorry, I didn&#x27;t expect this to be so controversial! The reasoning above makes sense to me, but I was also thinking of this as a correctness rule. The <code>f</code> prefix is unused at best, and my impression was that it&#x27;s very uncommon to use it intentionally without placeholders, so I assumed this was almost always a likely mistake. I also thought the problem here was analogous to #22318 and its linked issues. For what it&#x27;s worth, clippy&#x27;s <a href="https://rust-lang.github.io/rust-clippy/master/index.html?search=format#useless_format"><code>useless_format</code></a> is a complexity lint.</p>
<p>Anyway, I don&#x27;t feel strongly that the fix should be unsafe, and it sounds good to try being more clever.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/k0pernikus">@k0pernikus</a> on 2026-01-19 14:36</div>
            <div class="timeline-body"><blockquote>
<p>Anyway, I don&#x27;t feel strongly that the fix should be unsafe, and it sounds good to try being more clever.</p>
</blockquote>
<p>I propose for this to remain unsafe until the more clever check arrives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-19 14:45</div>
            <div class="timeline-body"><p>Complexity does make sense to me</p>
<blockquote>
<p>I propose for this to remain unsafe until the more clever check arrives.</p>
</blockquote>
<p>I&#x27;d rather make a single change or users will add the rule to allow unsafe fixes because they care about the fix, but that fix later becomes indeed more unsafe, but they are unlikely to remove it from unsafe fixes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/k0pernikus">@k0pernikus</a> on 2026-01-19 15:33</div>
            <div class="timeline-body"><blockquote>
<p>Complexity does make sense to me</p>
<blockquote>
<p>I propose for this to remain unsafe until the more clever check arrives.</p>
</blockquote>
<p>I&#x27;d rather make a single change or users will add the rule to allow unsafe fixes because they care about the fix, but that fix later becomes indeed more unsafe, but they are unlikely to remove it from unsafe fixes</p>
</blockquote>
<p>I don&#x27;t agree, they could use <a href="https://docs.astral.sh/ruff/settings/#lint_extend-safe-fixes">extend-safe-fixes</a> to cerry-pick <code>&quot;F541&quot;</code> just as I use <a href="https://docs.astral.sh/ruff/settings/#lint_extend-unsafe-fixes">extend-unsafe-fixes</a> now.</p>
<p>If a developer defaults to <code>--unsafe-fixes</code> for all, that is on them.</p>
<p>Though again, this relates if one wants to prioritize finding potential bugs or allowing formats to be forced to remain consistent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkusz">@mkusz</a> on 2026-01-20 11:26</div>
            <div class="timeline-body"><p>I&#x27;m on the side, that any tool that validates code, should report more potential errors and not fix them automatically when there is unclear intention. In this specific case, as a linter, you are not sure if user forgot to remove <code>f</code> or forgot to add <code>{}</code> inside of the string. It&#x27;s why I&#x27;m also think that this should be a considered unsafe fix. I understand that for some of the devs.
Also there is some Zen of Python behind this way of thinking:</p>
<pre><code>Errors should never pass silently.
Unless explicitly silenced.
In the face of ambiguity, refuse the temptation to guess.
</code></pre>
<p>I know that with this we are not fully sure if this is an error or an intention, but we are entering a <code>guess</code> territory, so we should follow the path of <code>explicitly silenced</code> and allow user to <code>extend-safe-fixes</code> or do <code>--unsafe-fixes</code> globally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/k0pernikus">@k0pernikus</a> on 2026-01-21 16:18</div>
            <div class="timeline-body"><p>If this were &quot;purely cosmetic&quot;, shouldn&#x27;t this be autoformatted via <code>ruff format</code> while remaining silent on <code>ruff check</code>?</p>
<p>I noticed that there is a difference in ruff&#x27;s treatment of certain kind of issues, e.g.:</p>
<pre><code>@pytest.mark.user(&quot;admin&quot;)
@pytest.mark.unauthenticated
def test_user_can_login(page: Page, user: User):
    foo                   =                        &quot;bad code for ruff to complain about         &quot;

    expect(page.get_by_role(&quot;link&quot;, name=f&quot;Objects {foo}&quot;)).to_be_visible()
</code></pre>
<p>This code will happily pass the <code>ruff check</code>:</p>
<pre><code>uvx ruff check  
All checks passed!
</code></pre>
<p>And it will be formatted on <code>ruff format</code> to:</p>
<pre><code>@pytest.mark.user(&quot;admin&quot;)
@pytest.mark.unauthenticated
def test_user_can_login(page: Page, user: User):
    foo = &quot;bad code for ruff to complain about         &quot;

    expect(page.get_by_role(&quot;link&quot;, name=f&quot;Objects {foo}&quot;)).to_be_visible()
</code></pre>
<pre><code>uvx ruff format 
1 file reformatted, 18 files left unchanged
</code></pre>
<hr>
<p>Just for clarity: Playing devil&#x27;s advocate here, I still have the opinion that this should be an unsafe fix and something that  <code>uvx ruff check</code> shall complain about.</p>
<p>And: I was surprised by the difference level of report during <code>ruff check</code> and <code>ruff format --check</code>; yet it makes complete sense as somethings can just be autoformatted without adding any noise to code quality tools.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 17:05:20 UTC
    </footer>
</body>
</html>
