<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive in RET503 since ruff 0.0.248 - astral-sh/ruff #3071</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>False positive in RET503 since ruff 0.0.248</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/3071">#3071</a>
        opened by <a href="https://github.com/link2xt">@link2xt</a>
        on 2023-02-20 21:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/link2xt">@link2xt</a> on 2023-02-20 21:44</div>
            <div class="timeline-body"><p>Since version 0.0.248 ruff flags this code as having an error:</p>
<pre><code class="language-python">def foo():
    while True:
        return True
</code></pre>
<p>I have <code>git bisect</code>ed this down to commit 059601d9685098a071bac6149ef5f321b3d845b8, PR #2962.</p>
<p>Running <code>$ cargo run -p ruff_cli -- check ./x.py --no-cache --select RET503</code> produces this error:</p>
<pre><code>x.py:2:5: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
</code></pre>
<p>This <code>while True</code> is a common pattern in Python to make infinite loops, and it clearly never returns unless there is a <code>break</code> inside.
I do not want to <code>return None</code> in the end, because I annotate my functions with types, and having a <code>return None</code> at the end of a function that is supposed to return an object (in this case I can add <code>return False</code> in the end, but not all objects are as easily constructable) would be flagged by mypy/pyright.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "False positive in PEP503 since ruff 0.0.248" to "False positive in RET503 since ruff 0.0.248" by @link2xt on 2023-02-20 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2962.html">astral-sh/ruff#2962</a> on 2023-02-20 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-20 21:59</div>
            <div class="timeline-body"><p>I guess we could treat <code>while True:</code> differently than other <code>while</code> loops. The issue is that, in general, we can't be certain that the loop will actually execute, so even if it ends in a <code>return</code>, we treat it as if it's non-returning. (The previous version just omitted <code>while</code> loops entirely, which is also a valid option and probably easier.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-02-20 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/link2xt">@link2xt</a> on 2023-02-20 22:05</div>
            <div class="timeline-body"><p>The loop also should not contain <code>break</code>, and it may be possible to break out to the function body with an exception.</p>
<p>If nothing else, I think it is ok to treat <code>while True</code> as a special case even if it introduces false negatives. This is what pyright does as far as I understand, it does not recognize <code>while 1</code> but recognizes <code>while True</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-20 22:33</div>
            <div class="timeline-body"><p>I'll make sure it's fixed for the next release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-02-20 22:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-02-20 22:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3076.html">astral-sh/ruff#3076</a> on 2023-02-20 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-20 23:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/link2xt">@link2xt</a> on 2023-02-20 23:47</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-21 00:00</div>
            <div class="timeline-body"><p>For now I just omitted <code>while True</code> entirely. We can do better of course but hopefully this avoids these false positives for you. (Previously, I think we ignored <em>all</em> <code>while</code> loops.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/link2xt">@link2xt</a> on 2023-02-21 00:35</div>
            <div class="timeline-body"><p>I only have one false positive currently at
https://github.com/deltachat/deltachat-core-rust/blob/f07206bd6cb6e4e783a197eeb88b6367f0de9afd/deltachat-rpc-client/src/deltachat_rpc_client/client.py#L105</p>
<p>As long as ruff does not report it, it's good enough for me to update.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
