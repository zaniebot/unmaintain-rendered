<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `--diff` support for Jupyter notebooks - astral-sh/ruff #4727</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>--diff</code> support for Jupyter notebooks</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4727">#4727</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-05-30 15:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>Depends on #1218</p>
<p>Similar to the diff produced for Python files, except here it&#x27;ll be at cell level. If a cell contains an auto-fix add it to the output, otherwise ignore it.</p>
<code>black --diff .</code> output:
<p>

<pre><code>--- site/en/guide/advanced_autodiff.ipynb	2023-05-30 07:24:16.776513 +0000:cell_1
+++ site/en/guide/advanced_autodiff.ipynb	2023-05-30 15:23:51.498900 +0000:cell_1
@@ -1,6 +1,6 @@
-#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+# @title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # https://www.apache.org/licenses/LICENSE-2.0
 #
--- site/en/guide/advanced_autodiff.ipynb	2023-05-30 07:24:16.776513 +0000:cell_6
+++ site/en/guide/advanced_autodiff.ipynb	2023-05-30 15:23:51.498900 +0000:cell_6
@@ -1,6 +1,6 @@
 import tensorflow as tf
 
 import matplotlib as mpl
 import matplotlib.pyplot as plt
 
-mpl.rcParams[&#x27;figure.figsize&#x27;] = (8, 6)
+mpl.rcParams[&quot;figure.figsize&quot;] = (8, 6)
--- site/en/guide/advanced_autodiff.ipynb	2023-05-30 07:24:16.776513 +0000:cell_9
+++ site/en/guide/advanced_autodiff.ipynb	2023-05-30 15:23:51.498900 +0000:cell_9
@@ -1,13 +1,13 @@
 x = tf.Variable(2.0)
 y = tf.Variable(3.0)
 
 with tf.GradientTape() as t:
-  x_sq = x * x
-  with t.stop_recording():
-    y_sq = y * y
-  z = x_sq + y_sq
+    x_sq = x * x
+    with t.stop_recording():
+        y_sq = y * y
+    z = x_sq + y_sq
 
-grad = t.gradient(z, {&#x27;x&#x27;: x, &#x27;y&#x27;: y})
+grad = t.gradient(z, {&quot;x&quot;: x, &quot;y&quot;: y})
 
-print(&#x27;dz/dx:&#x27;, grad[&#x27;x&#x27;])  # 2*x =&gt; 4
-print(&#x27;dz/dy:&#x27;, grad[&#x27;y&#x27;])
+print(&quot;dz/dx:&quot;, grad[&quot;x&quot;])  # 2*x =&gt; 4
+print(&quot;dz/dy:&quot;, grad[&quot;y&quot;])
would reformat site/en/guide/advanced_autodiff.ipynb

All done! ‚ú® üç∞ ‚ú®
1 file would be reformatted.
</code></pre>
</p>
 

<code>ruff check --fix --diff .</code> output:
<p>

<pre><code>--- src/EM101.py
+++ src/EM101.py
@@ -1,5 +1,4 @@
+msg = &quot;This is an example exception. This message is very long and spans multiple lines.&quot;
 raise Exception(
-    &quot;This is an example exception. &quot;
-    &quot;This message is very long &quot;
-    &quot;and spans multiple lines.&quot;
+    msg,
 )

--- src/RET504.py
+++ src/RET504.py
@@ -4,4 +4,5 @@
             x = 5
             return x
         case _:
-            raise ValueError(&quot;Error&quot;)
+            msg = &quot;Error&quot;
+            raise ValueError(msg)

--- src/RUF100.py
+++ src/RUF100.py
@@ -1,2 +1,2 @@
-import api.checks  # noqa: F401
+import api.checks
 import api.signals  # noqa: F401

--- src/PYI015.pyi
+++ src/PYI015.pyi
@@ -1,2 +1,2 @@
 unicode = str
-some = str()
+some = &quot;&quot;

--- src/D.py
+++ src/D.py
@@ -2,12 +2,12 @@
 
 
 class MyPublicClass:
-    def __init__(self):
+    def __init__(self) -&gt; None:
         # This one should have a D107
         pass
 
 
 class MyPrivateClass:
-    def __init__(self):
+    def __init__(self) -&gt; None:
         # This one should NOT have a D107
         pass

Would fix 77 errors.
</code></pre>
</p>
 

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wishlist</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-30 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wishlist</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-30 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">core</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-30 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-29 04:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:36 UTC
    </footer>
</body>
</html>
