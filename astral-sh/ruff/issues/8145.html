<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add option to mark test file paths for `flake8-pytest-style` - astral-sh/ruff #8145</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add option to mark test file paths for <code>flake8-pytest-style</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8145">#8145</a>
        opened by <a href="https://github.com/a-recknagel">@a-recknagel</a>
        on 2023-10-23 12:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/a-recknagel">@a-recknagel</a> on 2023-10-23 12:42</div>
            <div class="timeline-body"><p>I don't want to run any linters for my test code, except for <code>flake8-pytest-style</code>. It would be nice if I could give it the path(s) to the test files somehow, so that I don't need to have two distinct configurations for running <code>ruff</code>.</p>
<p>workaround:</p>
<pre><code class="language-shell">$ ruff src  # uses my config, checks my source code
$ ruff --isolated --select PT tests  # only uses PT, checks my test code
</code></pre>
<p>And the second line would also need to include any other <code>flake8-pytest-style</code> or top-level options that it needs. Being able to set something like</p>
<pre><code class="language-toml">[tool.ruff.flake8-pytest-style]
test-linting-only-path = [&quot;tests&quot;]
</code></pre>
<p>which would exclude these files/folders from any other linters given a call <code>ruff src tests</code> would help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add option to set path for `flake8-pytest-style`" to "Add option to mark test file paths for `flake8-pytest-style`" by @a-recknagel on 2023-10-23 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-30 02:58</div>
            <div class="timeline-body"><p>Do you think using <a href="https://docs.astral.sh/ruff/settings/#extend"><code>extend</code></a> would help in your scenario? So, you would add a <code>pyproject.toml</code> in the <code>tests/</code> directory which would <code>extend</code> from the root <code>pyproject.toml</code> file and add a <a href="https://docs.astral.sh/ruff/settings/#extend-select"><code>extend-select = [&quot;PT&quot;]</code></a> to it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2023-10-30 02:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-11-18 21:48</div>
            <div class="timeline-body"><p>For me that would not help as I do not have a <code>tests/</code> directory. Instead, I have test files next to the files to be tested. e.g. <code>mypkg/util/string.py</code> has its test in <code>mypkg/util/string_test.py</code> and so on. I think for larger applications this is not uncommon.</p>
<p>I think ideally it would apply the <a href="https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#conventions-for-python-test-discovery">pytest rules for test discovery</a>, ideally with override settings or parsing of the <a href="https://docs.pytest.org/en/7.1.x/example/pythoncollection.html#changing-naming-conventions">respective pytest.ini options</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-18 23:10</div>
            <div class="timeline-body"><p>I think mirroring the pytest rules for discovery would be sensible. It would also solve https://github.com/astral-sh/ruff/issues/8703, and arguably solve https://github.com/astral-sh/ruff/issues/6474.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-18 23:12</div>
            <div class="timeline-body"><p>However, I definitely want to avoid parsing <code>pytest.ini</code> and interpreting pytest configuration -- it's just a huge pain to implement and maintain (and also requires that we know the pytest version and keep our settings in-sync with pytest's settings). So if we <em>did</em> do this, we'd need to stick to the defaults, <em>or</em> add our own limited configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-20 19:27</div>
            <div class="timeline-body"><p>Thanks! I think we can close this one out as the suggested solution should work for @a-recknagel case but happy to re-open if it doesn't.</p>
<p>As for the @ThiefMaster case, I'll open a new issue to track the change (#8794).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-11-20 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/a-recknagel">@a-recknagel</a> on 2023-11-21 09:29</div>
            <div class="timeline-body"><p>No need to re-open, <code>extend</code> works for me. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/a-recknagel">@a-recknagel</a> on 2023-11-21 09:46</div>
            <div class="timeline-body"><p>just to spell it out once in case someone has the same issue, this is what I ended up doing which I'm happy enough with:</p>
<p><strong>project structure</strong></p>
<pre><code>.
├── src
│   └── my_package
│       ├── __init__.py
│       └── foo.py
├── tests
│   ├── ruff.toml
│   └── my_package
│       └── test_foo.py
└── pyproject.toml
</code></pre>
<p><strong>pyproject.toml</strong></p>
<pre><code class="language-toml">[&quot;...&quot;]  # other settings that don't matter here
[tool.ruff]
# settings I want to share between both src and test linting
src = [&quot;src&quot;]
isort = { combine-as-imports = true, force-wrap-aliases = true }
# src-specific rule set
select = [&quot;E&quot;, &quot;F&quot;, &quot;W&quot;, &quot;N&quot;, &quot;I&quot;, &quot;UP&quot;, &quot;...&quot; , &quot;D&quot;, &quot;RUF&quot;]
</code></pre>
<p><strong>tests/ruff.toml</strong></p>
<pre><code class="language-toml"># the magic word I was missing
extend = &quot;../pyproject.toml&quot;
# test-specific rule set
select = [&quot;F&quot;, &quot;N&quot;, &quot;I&quot;, &quot;PT&quot;, &quot;RUF&quot;]
</code></pre>
<p><strong>what I run</strong></p>
<pre><code class="language-shell">$ ruff src
$ ruff tests --config tests/ruff.toml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2024-12-27 20:54</div>
            <div class="timeline-body"><p>For what it's worth, I found the following to be an easier option for keeping these rules specific to test files in my <code>tests/</code> directory, which is to use <code>per-file-ignores</code> in my single top-level ruff <code>pyproject.toml</code> config file:</p>
<pre><code class="language-toml">[tool.ruff.lint.per-file-ignores]
# Ignore pytest rules outside tests directory
&quot;!tests/**/*&quot; = [&quot;PT&quot;]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:40 UTC
    </footer>
</body>
</html>
