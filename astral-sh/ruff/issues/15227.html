<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[RUF027] missing-f-string-syntax has false negatives if calling a function inside brackets or accessing attribute of interpolated variable - astral-sh/ruff #15227</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[RUF027] missing-f-string-syntax has false negatives if calling a function inside brackets or accessing attribute of interpolated variable</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15227">#15227</a>
        opened by <a href="https://github.com/sjdemartini">@sjdemartini</a>
        on 2025-01-02 20:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2025-01-02 20:24</div>
            <div class="timeline-body"><p>With RUF027 enabled, I would expect it to flag both of these, which it currently does not:</p>
<ol>
<li>function calls within the bracketed expression, like <code>print(&quot;Hello {foo()}&quot;)</code></li>
<li>bracketed expressions that access an attribute of an in-scope variable, like <code>print(&quot;Hello {foo.bar}&quot;)</code></li>
</ol>
<p>Neither of these situations seems to be explicitly part of the <a href="https://docs.astral.sh/ruff/rules/missing-f-string-syntax/#details">listed exceptions</a> to the rule, and don't seem like they should be.</p>
<p>Example:</p>
<pre><code class="language-python">def fibonacci(n):
    &quot;&quot;&quot;Compute the nth number in the Fibonacci sequence.&quot;&quot;&quot;
    if n == 0:
        return 0
    elif n == 1:
        return 1
    else:
        return fibonacci(n - 1) + fibonacci(n - 2)

class Foo:
    BAR = 5

name = &quot;Sarah&quot;
day_of_week = &quot;Tuesday&quot;

print(&quot;Hello {name}! It is {day_of_week} today!&quot;)  # Correctly flagged by RUF027
print(&quot;Hello {fibonacci}&quot;) # Correctly flagged by RUF027

print(&quot;Hello {fibonacci(1)}&quot;) # Should be flagged by RUF027 but is not
print(&quot;Hello {Foo.BAR}&quot;) # Should be flagged by RUF027 but is not
</code></pre>
<p>Playground: https://play.ruff.rs/ff81d90f-a1d6-4842-8b1b-b31ede9edbaf</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-03 02:47</div>
            <div class="timeline-body"><p>Yeah, this seems like something that we should catch. It could be that we're deliberately ignoring expressions that are not pure variables although I'll have to check the source code to confirm. Thanks for the report.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-01-03 02:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-01-03 02:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-03 07:52</div>
            <div class="timeline-body"><p>The rule only flags f-strings referencing a local variable to reduce false positives. This can be found here:</p>
<p>https://github.com/astral-sh/ruff/blob/c0b7c36d435441788b5a1f2330a66613656a3e47/crates/ruff_linter/src/rules/ruff/rules/missing_fstring_syntax.rs#L207-L225</p>
<p>We could extend the rule to support more expressions, e.g. attribute access or call expressions. The ideal solution is probably to extract the left-most name and try to lookup that name</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bittner">@bittner</a> on 2025-04-11 08:42</div>
            <div class="timeline-body"><p>Same here:</p>
<pre><code class="language-python">from django.db import models

class BehaveTestModel(models.Model):
    name = models.CharField(max_length=255)
    number = models.IntegerField()

    def get_absolute_url(self):
        return '/behave/test/{self.number}/{self.name}'  # Should be flagged by RUF027 but is not
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:36:09 UTC
    </footer>
</body>
</html>
