<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`module-import-not-at-top-of-file` ignore after `sys.path.insert` - astral-sh/ruff #5557</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`module-import-not-at-top-of-file` ignore after `sys.path.insert`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/5557">#5557</a>
        opened by <a href="https://github.com/tgross35">@tgross35</a>
        on 2023-07-06 09:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tgross35">@tgross35</a> on 2023-07-06 09:20</div>
            <div class="timeline-body"><p>Sometimes you need to insert a path to be able to import something that's out of scope from your current file - in which case, the imports must come after the <code>insert</code> statement. For example, from Rust's repo:</p>
<pre><code class="language-py">from __future__ import absolute_import, division, print_function
import os
import unittest
# ...

bootstrap_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, bootstrap_dir)
import bootstrap # noqa: E402
import configure # noqa: E402
</code></pre>
<p>My suggestion is to ignore E402 <code>module-import-not-at-top-of-file</code> if it comes after a <code>sys.path.insert</code> statement.</p>
<p>There are legitimate uses of <code>sys.path.insert</code>, but it could be considered a hack or pitfall for new users - so I could understand potentially not wanting this behavior as the default. If this is the case, I would propose one of the following:</p>
<ul>
<li>Create a configuration option such as <code>ignore-after-sys-path-insert</code></li>
<li>Do this change as suggested, but create a separate lint that checks for <code>sys.path.insert</code> usage. The lint could theoretically be kind of smart and suggest possible alternatives for common misuses (adding <code>__init__.py</code>, importing directly, etc) but that kind of gets into evaluating the context</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-07-09 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-07-10 01:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-07-10 01:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9047.html">astral-sh/ruff#9047</a> on 2023-12-07 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-07 18:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
