```yaml
number: 7433
title: Ruff needs to formats files 2 times until there is nothing to format
type: issue
state: closed
author: qarmin
labels:
  - bug
  - formatter
assignees: []
created_at: 2023-09-16T09:40:22Z
updated_at: 2023-09-16T14:22:25Z
url: https://github.com/astral-sh/ruff/issues/7433
synced_at: 2026-01-10T01:56:49Z
```

# Ruff needs to formats files 2 times until there is nothing to format

---

_Issue opened by @qarmin on 2023-09-16 09:40_

Ruff 0.0.289

Ruff after formating this files once, needs to format them again, because looks that not everything is applied after first run


[Example1](https://github.com/astral-sh/ruff/files/12640339/DOWNLOADED.zip)

Here are 3 files - A2.py is original, A1.py after first run of ruff format and A0.py after second run
```
--- A2.py	2023-09-16 11:33:41.426063461 +0200
+++ A1.py	2023-09-16 11:34:05.873498261 +0200
@@ -32,8 +32,8 @@
 
 def get_rocm_smi_stats() -> Dict[str, Any]:
     command = [str(ROCM_SMI_CMD), "-a", "--json"]
-    output = (
-        subprocess.check_output(command, universal_newlines=True).strip().split("\n")
+    output = subprocess.check_output(command, universal_newlines=True).strip().split(
+        "\n"
     )[0]
     return json.loads(output)  # type: ignore

```
```
--- A1.py	2023-09-16 11:34:05.873498261 +0200
+++ A0.py	2023-09-16 11:34:15.089285492 +0200
@@ -32,9 +32,9 @@
 
 def get_rocm_smi_stats() -> Dict[str, Any]:
     command = [str(ROCM_SMI_CMD), "-a", "--json"]
-    output = subprocess.check_output(command, universal_newlines=True).strip().split(
-        "\n"
-    )[0]
+    output = (
+        subprocess.check_output(command, universal_newlines=True).strip().split("\n")[0]
+    )
     return json.loads(output)  # type: ignore
```

more files with same problems(28)

[broken_files.zip](https://github.com/astral-sh/ruff/files/12640340/broken_files.zip)


---

_Comment by @charliermarsh on 2023-09-16 13:16_

Thanks! Internally we refer to this as an "instability". Instabilities are always bugs. (We have tests for this over a few projects.)

---

_Label `bug` added by @charliermarsh on 2023-09-16 13:16_

---

_Label `formatter` added by @charliermarsh on 2023-09-16 13:16_

---

_Added to milestone `Formatter: Beta` by @charliermarsh on 2023-09-16 13:16_

---

_Comment by @MichaReiser on 2023-09-16 14:22_

Thanks. Identifying instabilities is extremely useful (and maybe something a fuzzer can do well). This seems to be fixed as of https://github.com/astral-sh/ruff/pull/7409

---

_Closed by @MichaReiser on 2023-09-16 14:22_

---

_Referenced in [astral-sh/ruff#9169](../../astral-sh/ruff/issues/9169.md) on 2023-12-18 03:18_

---
