<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff does not recognise the fictitious `builtins.ellipsis` type from typeshed - astral-sh/ruff #11943</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff does not recognise the fictitious <code>builtins.ellipsis</code> type from typeshed</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11943">#11943</a>
        opened by <a href="https://github.com/RandallPittmanOrSt">@RandallPittmanOrSt</a>
        on 2024-06-19 20:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RandallPittmanOrSt">@RandallPittmanOrSt</a></div>
            <div class="timeline-body"><p><code>ellipsis</code> is a valid name in type signatures, but Ruff doesn't seem to have it its grammar.</p>
<ul>
<li><p>Keywords searched for before creating this issue:  &quot;ellipsis&quot;, &quot;Undefined name&quot;</p>
</li>
<li><p>Ruff version: 0.4.9</p>
</li>
<li><p>Example:</p>
<pre><code class="language-python">from typing import Union
class MyCollection:
    def __getitem__(self, slc : Union[int, slice, ellipsis]):
        ...
</code></pre>
<pre><code class="language-console">me@localhost$ ruff check my_collection.py
my_collection.py:3:51: F821 Undefined name `ellipsis`
Found 1 error.
</code></pre>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-06-19 20:31</div>
            <div class="timeline-body"><p>ruff is right, there's no <code>ellipsis</code>; you probably meant <code>Ellipsis</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RandallPittmanOrSt">@RandallPittmanOrSt</a> on 2024-06-19 20:37</div>
            <div class="timeline-body"><blockquote>
<p>ruff is right, there's no <code>ellipsis</code>; you probably meant <code>Ellipsis</code>?</p>
</blockquote>
<p>No, you can't use <code>Ellipsis</code> in an annotation as it is a variable (according to both mypy and Pyright).</p>
<p>I'm basing my annotations on those of <code>numpy.ndarray.__getitem__</code>: <a href="https://github.com/numpy/numpy/blob/64ee06a641f8bd087bd74712ef4b1cbd1241f08c/numpy/__init__.pyi#L1514">https://github.com/numpy/numpy/blob/64ee06a641f8bd087bd74712ef4b1cbd1241f08c/numpy/__init__.pyi#L1514</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-06-19 20:43</div>
            <div class="timeline-body"><p>This is due to a historical hack in typeshed, where a fictitious type &quot;builtins.ellipsis&quot; is invented for static type checkers so that they are able to understand what the type of the <code>Ellipsis</code> singleton is: https://github.com/python/typeshed/blob/fdce887b9479a4c8a69ea040145f276caa28ce0e/stdlib/builtins.pyi#L1834-L1850. It would be nice to remove this hack over at typeshed, but it might be difficult: some people (such as numpy, apparently) are using the hack in their annotations, so there are backwards compatibility implications; the &quot;real&quot; type of <code>Ellipsis</code> is only exposed at runtime as <code>types.EllipsisType</code> on Python 3.10+, while typeshed still supports Python 3.8; and some type checkers might also rely on <code>builtins.ellipsis</code> being in the stub.</p>
<p>Ruff does not use typeshed's stubs for resolving builtin symbols at the moment, although we will do at some point. At that point, we might start understanding the fictious <code>builtins.ellipsis</code> type in the same way that mypy and pyright do. Whether we do or don't, however, I'd encourage you to use <code>types.EllipsisType</code> instead of <code>builtins.ellipsis</code> if at all possible since, unlike <code>builtins.ellipsis</code>, <code>types.EllipsisType</code> actually exists at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`ellipsis` is missing from ruff's grammar" to "Ruff does not recognise the fictitious `builtins.ellipsis` type from typeshed" by @AlexWaygood on 2024-06-19 20:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RandallPittmanOrSt">@RandallPittmanOrSt</a> on 2024-06-19 20:45</div>
            <div class="timeline-body"><p>@AlexWaygood You're totally right, I just discovered that. My mistake, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-06-19 20:47</div>
            <div class="timeline-body"><p>No need to apologise @RandallPittmanOrSt, this is a pretty obscure corner case! Happy to help :-)</p>
<p>I think I'll close this for now, though, since there's not much actionable for us here -- we're already working on using typeshed stubs for resolving builtin symbols üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-06-19 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RandallPittmanOrSt">@RandallPittmanOrSt</a> on 2024-06-19 20:53</div>
            <div class="timeline-body"><p>Thanks again, @AlexWaygood. FFR, here's ~my workaround~ a modified version of typeshed's hack as a workaround:</p>
<p>mypy doesn't like overriding typeshed's <code>ellipsis</code> hack, hence the <code>if not TYPE_CHECKING</code></p>
<pre><code class="language-python">from typing import TYPE_CHECKING
import sys
if sys.version_info &gt;= (3, 10):
    from types import EllipsisType
    ellipsis = EllipsisType
elif not TYPE_CHECKING:
    class ellipsis: ...
</code></pre>
<p>In a type stub, the <code>@type_check_only</code> decorator can be added to the <code>ellipsis</code> class.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:30 UTC
    </footer>
</body>
</html>
