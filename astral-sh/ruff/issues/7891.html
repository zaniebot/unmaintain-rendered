<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruff fix on UP032 breaks applied code when f-string is too long - astral-sh/ruff #7891</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>ruff fix on UP032 breaks applied code when f-string is too long</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7891">#7891</a>
        opened by <a href="https://github.com/Grosskopf">@Grosskopf</a>
        on 2023-10-10 12:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Grosskopf">@Grosskopf</a> on 2023-10-10 12:34</div>
            <div class="timeline-body"><p>Hi, I'm not sure where I should post this error but I have a weird chain reaction of errors that result in ruff breaking my code.</p>
<p>The following code results in a UP032 Error:</p>
<pre><code class="language-python">from django.utils.translation import gettext

long = 'long'
split_to = 'split_to'
gettext(
    'some super {} and complicated string so that the error code '
    'E501 Triggers when this is not {} multi-line'.format(
        long, split_to)
)

</code></pre>
<p>when I then run <code>ruff --fix</code> on it I get</p>
<pre><code class="language-python">from django.utils.translation import gettext

long = 'long'
split_to = 'split_to'
gettext(
    f'some super {long} and complicated string so that the error code '
    f'E501 Triggers when this is not {split_to} multi-line'
)

</code></pre>
<p>This would be perfect, I love the style of code, but there is a problem, this code does not work.
When I then go ahead and run makemessages as usual, the text generated from this is
<code>some super {long} and complicated string so that the error code </code> and the second line is lost</p>
<p>Should I report this upstream at Django or at python? I would prefer if this would work but sadly this is a rare edge case where ruff --fix breaks code.</p>
<p>this happens on ruff 0.0.290</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-10 16:05</div>
            <div class="timeline-body"><p>It looks like <code>gettext</code> does not yet support f-strings, per the <a href="https://docs.djangoproject.com/en/4.2/topics/i18n/translation/#troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs">Django docs</a>:</p>
<img width="620" alt="Screen Shot 2023-10-10 at 12 05 33 PM" src="https://github.com/astral-sh/ruff/assets/1309177/8bb35be1-f657-4da8-ab3a-7f5c33a54f78">

<p>We can avoid suggesting this in Ruff, for <code>gettext</code> calls...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-10-10 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-10-10 16:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7898.html">astral-sh/ruff#7898</a> on 2023-10-10 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-10 16:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:10 UTC
    </footer>
</body>
</html>
