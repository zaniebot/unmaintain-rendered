<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD003 detection improvement - astral-sh/ruff #18657</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>TD003 detection improvement</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/18657">#18657</a>
        opened by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a>
        on 2025-06-13 07:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-13 07:08</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>On Github i use: https://github.com/alstr/todo-to-issue-action
Now the issue is, that it does enter the URL like that: # Issue URL: https://
Unfortunately this does not pass TD003 as the link is not directly after the #
It seems like no too big change to do for ruff, so i request changement here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-13 07:09</div>
            <div class="timeline-body"><p>Here the issue in the Action:
https://github.com/alstr/todo-to-issue-action/issues/272#issuecomment-2969314606</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-13 07:16</div>
            <div class="timeline-body"><p>Can you share a code example? It would me help understand what you're looking for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-13 07:21</div>
            <div class="timeline-body"><pre><code>self.assertEqual(context[&quot;invoice_items&quot;][1][&quot;quantity&quot;], &quot;2.00&quot;)  # TODO: Adjust to dynamic quantity
                                                                   # Issue URL: https://github.com/Buffet-IT-Services/CycleInvoice/issues/35
</code></pre>
<p>https://github.com/Buffet-IT-Services/CycleInvoice/pull/25/commits/57421d51b154e395cbd7d3a34f2252f398a15ebd</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-06-13 07:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-06-13 07:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-13 13:32</div>
            <div class="timeline-body"><p>if i'd take a look myself at this and open a PR, what would be the chance to get it to merge?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-16 06:28</div>
            <div class="timeline-body"><p>I think the challenge here is to come up with a good regex that avoids too many false negatives but also avoids hardcoding your specific pattern. What pattern would you suggest adding here:</p>
<p>https://github.com/astral-sh/ruff/blob/c713e76e4db7f5001c5954e8e25abeb6a308a2a4/crates/ruff_linter/src/rules/flake8_todos/rules/todos.rs#L234-L241</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-16 08:34</div>
            <div class="timeline-body"><p>I would suggest something like this:
<code>^#.{0,20}(http|https)://.*</code>
It just allows any 20 chars before the url, this then already includes some spaces or tabs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-16 09:04</div>
            <div class="timeline-body"><blockquote>
<p>It just allows any 20 chars before the url, this then already includes some spaces or tabs.</p>
</blockquote>
<p>I see how this solves this specific issue. What's unclear is if this is too permitting for false positives:</p>
<pre><code class="language-py"># TODO: Some comment
# For more information see: https://link-to-specification
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-16 09:15</div>
            <div class="timeline-body"><p>AFAIK, the current regex would also allow other links, just without the text before.
We could also do 15 signs to limit the text before even more (your example already is over the 20 chars i suggested).</p>
<p>As an alternative we could make a fourth entry:
<code>^#(?=(.{0,20}?[iI]ssue)).{0,20}(http|https)://.*</code>
This allows the 20 chars only if it contains Issue or issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlorinBuffet">@FlorinBuffet</a> on 2025-06-20 08:11</div>
            <div class="timeline-body"><p>@MichaReiser what do you think about it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mike386">@mike386</a> on 2025-10-02 15:14</div>
            <div class="timeline-body"><p>Currently, the regexes don’t cover the popular <a href="https://google.github.io/styleguide/pyguide.html#312-todo-comments">Google Python Style Guide</a>. In particular, they don’t allow links without a scheme (http/https), and <code>ISSUE_LINK_TODO_LINE_REGEX_SET</code> only supports issue references in the form <code>#\d+</code>, but not <code>[A-Z]+-?\d+</code>.</p>
<p>It would be great if both <code>ISSUE_LINK_OWN_LINE_REGEX_SET</code> and <code>ISSUE_LINK_TODO_LINE_REGEX_SET</code> could be extended with additional regex patterns from the config.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
