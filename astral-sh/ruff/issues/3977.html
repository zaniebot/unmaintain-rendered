<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF002 offers unrelated substitution for unicode quotation mark - astral-sh/ruff #3977</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF002 offers unrelated substitution for unicode quotation mark</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3977">#3977</a>
        opened by <a href="https://github.com/syntaxaire">@syntaxaire</a>
        on 2023-04-14 19:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/syntaxaire">@syntaxaire</a></div>
            <div class="timeline-body">

<p>With ruff 0.0.261, using the &quot;RUF&quot; rule, the following docstring:</p>
<pre><code>&quot;&quot;&quot;All the account’s items&quot;&quot;&quot;
</code></pre>
<p>produces the following error:</p>
<pre><code>RUF002 [*] Docstring contains ambiguous unicode character `’` (did you mean ```?)
</code></pre>
<p>The Unicode character in the comment is U+2019 RIGHT SINGLE QUOTATION MARK which is drawn from upper right to lower left. The suggested substitution is the backtick character which is drawn from upper left to lower right - this character is not semantically related to the Unicode character.</p>
<p>This suggestion is automatically applied when <code>--fix</code> is specified, producing:</p>
<pre><code>&quot;&quot;&quot;All the account`s items&quot;&quot;&quot;
</code></pre>
<p>Is this to avoid messing with docstring quotes by not substituting the single quote character <code>&#x27;</code>? In that case I would suggest not making this Unicode character autofixable at all, rather than substituting an unrelated character.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-14 19:25</div>
            <div class="timeline-body"><p>Hm, yeah, that&#x27;s an interesting substitution. We actually didn&#x27;t create the substitution table -- it&#x27;s taken from the same source as VS Code, and is intended to match VS Code&#x27;s own list of confusing characters + their replacements. It looks like VS Code offers the same suggestion:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/232137713-75fc65b9-5152-4fd5-a024-7396b74921d6.png" alt="Screen Shot 2023-04-14 at 3 24 50 PM"></p>
<p>That&#x27;s not to say that the table can&#x27;t be improved, only to clarify that we didn&#x27;t apply any of our own discretion in generating the list. We could consider changing that replacement to instead suggest <code>&#x27;</code> though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-14 19:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/syntaxaire">@syntaxaire</a> on 2023-04-14 19:35</div>
            <div class="timeline-body"><p><code>&#x27;</code> has syntactic meaning, so it would not be able to be a naive fix.</p>
<pre><code>&#x27;All the account’s items.&#x27;
</code></pre>
<p>works as a docstring, although a dodgy one... Substituting <code>&#x27;</code> would make semantic sense but would cause a syntax error if autofixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/syntaxaire">@syntaxaire</a> on 2023-04-16 17:33</div>
            <div class="timeline-body"><p>I would make 2 suggestions for this issue:</p>
<ol>
<li>Leave the existing behaviour but remove autofix for this.</li>
</ol>
<p>or,</p>
<ol>
<li>Substitute <code>&#x27;</code> for <code>’</code>, automatically adding an escape character if in a single quoted string.</li>
</ol>
<p>For # 2, would it be possible to construct an anti-example where this suggestion could still change the meaning of code? For example, constructing a string and passing it to eval?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbdchd">@sbdchd</a> on 2023-04-17 00:03</div>
            <div class="timeline-body"><p>I think auto fix should probably be disabled for this sort of thing since the underlying ambiguous characters might be in a i18n related string or some documentation (even if it&#x27;s not a doc comment, e.g., Django column help text) that is intentional</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-10 01:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-10 01:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-07-14 08:17</div>
            <div class="timeline-body"><p>Does anyone here see <code>&#x27;</code> and <code>’</code> on their screen without being able to visually distinguish them?</p>
<p>If not: why is <code>’</code> included in the table at all?</p>
<p>On a different note, it hurts my typographic sensibilities to see that specific substitution being made lol. I always see when people using grave accents instead of typographically correct quotes, and I always wince.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bodograumann">@bodograumann</a> on 2023-11-12 13:18</div>
            <div class="timeline-body"><p>What is being replaced originally comes from <a href="https://www.unicode.org/Public/security/14.0.0/confusables.txt">Unicode directly</a>, with only some minor overrides from vscode.
I think the main intention of this feature is to prevent malicious code.</p>
<p>That a grave accent is recommended here is an upstream bug imho. My PR contains some background information as well: <a href="https://github.com/hediet/vscode-unicode-data/pull/1">hediet/vscode-unicode-data#1</a></p>
<p>The discussion whether replacing with <code>&#x27;</code> is a good idea, because it might break code in context of a single-quoted string should probably be had, but I am also with you @flying-sheep , that <code>&#x27;</code> and <code>’</code> are distinct enough to be allowed.
In the mean time you can allow it explicitely in your project:</p>
<pre><code>[tool.ruff]
allowed-confusables = [
    &quot;’&quot;,  # Cf. <a href="https://github.com/astral-sh/ruff/issues/3977">astral-sh/ruff#3977</a>
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kureta">@kureta</a> on 2024-01-28 16:48</div>
            <div class="timeline-body"><p>I have a similar problem. I get <code>RUF002 Docstring contains ambiguous </code>ı<code>(LATIN SMALL LETTER DOTLESS I). Did you mean</code>i<code> (LATIN SMALL LETTER I)?</code> but &quot;ı&quot; and &quot;i&quot; are separate letters in the Turkish alphabet.</p>
<p>Couldn&#x27;t be sure if I should open a new issue. Please let me know if so.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-28 19:28</div>
            <div class="timeline-body"><p>@kureta - I think that&#x27;s following the intent of the rule, since the goal is to identify confusable Unicode characters in otherwise-ASCII words. I&#x27;d suggest adding it to the <code>allowed-confusables</code> list if it makes sense in your project! https://docs.astral.sh/ruff/settings/#allowed-confusables</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kureta">@kureta</a> on 2024-01-29 15:05</div>
            <div class="timeline-body"><p>@charliermarsh thanks, i didn&#x27;t know that option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rirze">@rirze</a> on 2025-06-11 21:25</div>
            <div class="timeline-body"><p>Just ran into this while copy-pasting some documentation into docstrings.</p>
<p>Is there any way we could specify a translation table for our projects?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:35 UTC
    </footer>
</body>
</html>
