<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive: `UP024` Replace aliased errors with `OSError` - astral-sh/ruff #1568</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive: `UP024` Replace aliased errors with `OSError`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1568">#1568</a>
        opened by <a href="https://github.com/woodruffw">@woodruffw</a>
        on 2023-01-02 22:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/woodruffw">@woodruffw</a> on 2023-01-02 22:25</div>
            <div class="timeline-body"><p>First of all, thanks for <code>ruff</code>! I've been trying it on a few of my projects, and it's been a pleasure to use.</p>
<p>This is a report for what looks (to me) like a false positive in <code>ruff</code>'s <code>pyupgrade</code>-style rules.</p>
<p>The code in question:</p>
<pre><code class="language-python">        # Make sure the directory exists
        try:
            os.makedirs(os.path.dirname(name), self.dirmode)
        except (IOError, OSError):  # pragma: no cover
            pass
</code></pre>
<p><code>ruff</code> flags <code>UP024</code> on this:</p>
<pre><code>pip_audit/_cache.py:116:16: UP024 Replace aliased errors with `OSError`
Found 1 error(s).
1 potentially fixable with the --fix option.
</code></pre>
<p>...and wants to auto-fix it as this:</p>
<pre><code class="language-python">
        # Make sure the directory exists
        try:
            os.makedirs(os.path.dirname(name), self.dirmode)
        except OSError:  # pragma: no cover
            pass
</code></pre>
<p>However, as far as I can tell, <a href="https://docs.python.org/3/library/exceptions.html#IOError"><code>IOError</code> is not a subclass of <code>OSError</code></a>. As such, this fix probably causes an unintended behavioral change: <code>IOError</code>s are no longer caught.</p>
<p>Running context:</p>
<pre><code class="language-console">$ ruff --version
ruff 0.0.207

$ python -V
Python 3.11.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-02 22:27</div>
            <div class="timeline-body"><p>Let me take a look!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2023-01-02 22:28</div>
            <div class="timeline-body"><p>Hmm, maybe this is a documentation error in Python: <code>IOError</code> is indeed a subclass of <code>OSError</code>, according to the MRO:</p>
<pre><code class="language-python">&gt;&gt;&gt; IOError.__mro__
(&lt;class 'OSError'&gt;, &lt;class 'Exception'&gt;, &lt;class 'BaseException'&gt;, &lt;class 'object'&gt;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-02 22:28</div>
            <div class="timeline-body"><p>Yeah, I'm seeing <code>IOError = OSError</code> in the <code>builtins.py</code> source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2023-01-02 22:29</div>
            <div class="timeline-body"><p>Yep! Sorry, this looks like an overeager report on my part :sweat_smile:. I'll follow up with CPython to get the docs fixed.</p>
<p>Thanks again for <code>ruff</code>!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @woodruffw on 2023-01-02 22:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-02 22:30</div>
            <div class="timeline-body"><p>No prob at all, thanks for taking the time to file such a thorough Issue in the first place! Don't hesitate if you run into other problems etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/pip-audit/pulls/461.html">pypa/pip-audit#461</a> on 2023-01-02 22:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python/cpython/issues/100696.html">python/cpython#100696</a> on 2023-01-02 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/deliro">@deliro</a> on 2023-03-09 18:05</div>
            <div class="timeline-body"><p>Hi guys! First of all, many thanks for this awesome tool!</p>
<p>Found a false positive one:</p>
<p>My code:</p>
<pre><code class="language-python">import socket
...
from kombu import Connection, exceptions

...

try:
    conn = Connection(settings.CELERY_BROKER_URL)
    conn.ensure_connection(max_retries=2)
    conn._close()
except (socket.error, exceptions.OperationalError):
    return HttpResponseServerError(&quot;cache: cannot connect to broker.&quot;)
</code></pre>
<p>their MROs:</p>
<pre><code class="language-python">exceptions.OperationalError.__mro__
(&lt;class 'kombu.exceptions.OperationalError'&gt;, &lt;class 'kombu.exceptions.KombuError'&gt;, &lt;class 'Exception'&gt;, &lt;class 'BaseException'&gt;, &lt;class 'object'&gt;)

socket.error.__mro__
(&lt;class 'OSError'&gt;, &lt;class 'Exception'&gt;, &lt;class 'BaseException'&gt;, &lt;class 'object'&gt;)
</code></pre>
<p>ruff suggests:</p>
<pre><code class="language-python">try:
    conn = Connection(settings.CELERY_BROKER_URL)
    conn.ensure_connection(max_retries=2)
    conn._close()
except OSError:
    return HttpResponseServerError(&quot;cache: cannot connect to broker.&quot;)
</code></pre>
<p>Seems like ruff ignores the second one's MRO. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-09 19:12</div>
            <div class="timeline-body"><p>Oh wow, yeah, looks like a bug!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3422.html">astral-sh/ruff#3422</a> on 2023-03-09 19:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:04 UTC
    </footer>
</body>
</html>
