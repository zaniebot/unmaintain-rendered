<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM107 documentation example may be misleading - astral-sh/ruff #22325</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>SIM107 documentation example may be misleading</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/22325">#22325</a>
        opened by <a href="https://github.com/ftnext">@ftnext</a>
        on 2026-01-01 10:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ftnext">@ftnext</a> on 2026-01-01 10:28</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I have a question about the example shown in the <a href="https://docs.astral.sh/ruff/rules/return-in-try-except-finally/">SIM107 (return-in-try-except-finally)</a> documentation.
<strong>Could you clarify the intended purpose of this documentation example?</strong></p>
<p>The current documentation includes this as good example:</p>
<pre><code class="language-python">def squared(n):
    try:
        return_value = n**2
    except Exception:
        return_value = &quot;An exception occurred&quot;
    finally:
        return_value = -1
    return return_value
</code></pre>
<p><strong>Issue:</strong></p>
<p>This code always returns <code>-1</code> because the <code>finally</code> block overwrites the <code>return_value</code> variable.</p>
<pre><code class="language-python">print(squared(3))  # -1 not 9
print(squared(&quot;3&quot;))  # -1 not &quot;An exception occurred&quot;
</code></pre>
<p>ref: https://docs.python.org/3/tutorial/errors.html#defining-clean-up-actions</p>
<blockquote>
<p>If a finally clause is present, the finally clause will execute as the last task before the try statement completes.</p>
</blockquote>
<p>Concern: <strong>Unclear purpose of the example</strong></p>
<ul>
<li>It's not clear whether this is meant to be a &quot;recommended approach&quot; (because both implemetation are broken)</li>
<li>This issue may have originated from flake8-simplify https://github.com/MartinThoma/flake8-simplify/issues/9</li>
</ul>
<h3>Version</h3>
<p>ruff 0.14.10 (45bbb4cbf 2025-12-18)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ftnext on 2026-01-01 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-01 14:18</div>
            <div class="timeline-body"><p>Thanks for the report! I agree that this is confusing. I think the minimal change to get something that actually works is to remove only the return in the <code>finally</code> arm for the &quot;Use instead&quot; example:</p>
<pre><code class="language-py">def squared(n):
    try:
        sqr = n**2
        return sqr
    except Exception:
        return &quot;An exception occurred&quot;
    finally:
        return_value = -1
	return return_value
</code></pre>
<p>but even that is a bit confusing. Maybe a better initial example would be helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @ntBre on 2026-01-01 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @ntBre on 2026-01-01 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on 2026-01-03 22:35</div>
            <div class="timeline-body"><p>I thought for a while and searched online, and I could not find a good example. The best one to me is the one from the issue @ftnext linked (https://github.com/MartinThoma/flake8-simplify/issues/9).
I'm so surprised that this rule is in the flake8-<strong>simplify</strong> linter. This is not about simplifing code, returning in a <code>finally</code> block is never what we want!!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
