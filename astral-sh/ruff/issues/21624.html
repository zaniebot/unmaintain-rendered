<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unexpected sorting of import - astral-sh/ruff #21624</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unexpected sorting of import</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/21624">#21624</a>
        opened by <a href="https://github.com/spacemanspiff2007">@spacemanspiff2007</a>
        on 2025-11-25 06:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/spacemanspiff2007">@spacemanspiff2007</a></div>
            <div class="timeline-body">Summary
<p>~Somewhere after 0.11.12 there was an unexpected change.~
My imports change from this</p>
<pre><code>from .events import (
    ItemNoChangeEvent as ItemNoChangeEvent,
    ItemNoUpdateEvent as ItemNoUpdateEvent,
    ValueChangeEvent as ValueChangeEvent,
    ValueCommandEvent as ValueCommandEvent,
    ValueUpdateEvent as ValueUpdateEvent,
)
</code></pre>
<p>to this</p>
<pre><code>from .events import (
    ItemNoChangeEvent as ItemNoChangeEvent,
)
from .events import (
    ItemNoUpdateEvent as ItemNoUpdateEvent,
)
from .events import (
    ValueChangeEvent as ValueChangeEvent,
)
from .events import (
    ValueCommandEvent as ValueCommandEvent,
)
from .events import (
    ValueUpdateEvent as ValueUpdateEvent,
)
</code></pre>
<p>I can&#x27;t seem to find a setting to disable this behavior and this only affects two files in my project so I suspect this is a bug.
Corresponding <a href="https://github.com/spacemanspiff2007/HABApp/actions/runs/19660055930/job/56304485075">pre-commit run</a></p>
Version
<p>0.14.6</p>
<p>Edit:
I reverted to ruff 0.11.12 but still can&#x27;t make pre-commit pass which run successfully at the end of September - very strange!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-25 07:57</div>
            <div class="timeline-body"><p>You can use <a href="https://docs.astral.sh/ruff/settings/#lint_isort_combine-as-imports"><code>combine-as-imports</code></a> if you always want to combine as imports from the same module into a single import statement: <a href="https://play.ruff.rs/9a4e5576-9341-4b6b-b74d-8b2ce927f449">playground</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-25 07:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spacemanspiff2007">@spacemanspiff2007</a> on 2025-11-25 08:24</div>
            <div class="timeline-body"><p>Thank you for your reply! Somehow the playground does not work for me so I tried it locally.</p>
<p>Unfortunately now these imports</p>
<pre><code>from datetime import datetime as dt_datetime
from datetime import timedelta as dt_timedelta
</code></pre>
<p>become this</p>
<pre><code>from datetime import datetime as dt_datetime, timedelta as dt_timedelta
</code></pre>
<p>which I find very hard to read.
So the <code>combine-as-imports</code> is not the setting I am looking for.
Is there any other setting or option I could use?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-25 17:44</div>
            <div class="timeline-body"><p>I don&#x27;t think there is. Ruff forces splits <code>from .. import</code>s into multiple imports if they exceed the line length. However, what seems very unfortunate is that it preserves the trailing-comma when doing so.</p>
<p>You could consider setting <a href="https://docs.astral.sh/ruff/settings/#lint_isort_split-on-trailing-comma"><code>split-on-trailing-comma</code></a> to <code>false</code></p>
<p>Your example then gets reformatted to the following, which I find more reasonable:</p>
<pre><code>from .events import ItemNoChangeEvent as ItemNoChangeEvent
from .events import ItemNoUpdateEvent as ItemNoUpdateEvent
from .events import ValueChangeEvent as ValueChangeEvent
from .events import ValueCommandEvent as ValueCommandEvent
from .events import ValueUpdateEvent as ValueUpdateEvent
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spacemanspiff2007">@spacemanspiff2007</a> on 2025-12-02 07:06</div>
            <div class="timeline-body"><p>Thank you for your hint with the trailing comma.
If I remove the trailing comma one import is indeed in one line as you showed.
However since I often have lots of imports it becomes this wall of text which is extremely hard to read.
E.g. a small excerpt from one file:</p>
<pre><code>from .base_event import OpenhabEvent as OpenhabEvent
from .channel_events import ChannelDescriptionChangedEvent as ChannelDescriptionChangedEvent
from .channel_events import ChannelTriggeredEvent as ChannelTriggeredEvent
from .item_events import GroupStateChangedEvent as GroupStateChangedEvent
from .item_events import GroupStateUpdatedEvent as GroupStateUpdatedEvent
from .item_events import ItemAddedEvent as ItemAddedEvent
from .item_events import ItemCommandEvent as ItemCommandEvent
from .item_events import ItemRemovedEvent as ItemRemovedEvent
from .item_events import ItemStateChangedEvent as ItemStateChangedEvent
from .item_events import ItemStateEvent as ItemStateEvent
from .item_events import ItemStatePredictedEvent as ItemStatePredictedEvent
from .item_events import ItemStateUpdatedEvent as ItemStateUpdatedEvent
from .item_events import ItemUpdatedEvent as ItemUpdatedEvent
from .thing_events import ThingAddedEvent as ThingAddedEvent
from .thing_events import ThingConfigStatusInfoEvent as ThingConfigStatusInfoEvent
from .thing_events import ThingFirmwareStatusInfoEvent as ThingFirmwareStatusInfoEvent
from .thing_events import ThingRemovedEvent as ThingRemovedEvent
from .thing_events import ThingStatusInfoChangedEvent as ThingStatusInfoChangedEvent
from .thing_events import ThingStatusInfoEvent as ThingStatusInfoEvent
from .thing_events import ThingUpdatedEvent as ThingUpdatedEvent
</code></pre>
<p>I played around a little bit more and if I remove the reexport everything works as expected.</p>
<pre><code># without reexport
from .events import (
    ItemNoChangeEvent,
    ItemNoUpdateEvent,
    ValueChangeEvent,
    ValueCommandEvent,
    ValueUpdateEvent,
)

# reexports are all like this
from .filter import (
    AndFilterGroup as AndFilterGroup,
)
# or like this without a trailing comma
from .filter import EventFilter as EventFilter

</code></pre>
<p>I really like <code>F401</code> because it keeps my module imports clean and the imports sorted.
However in <code>__init__.py</code> files it&#x27;s more of a burden and even results in less (!!!) readable code.
~But if I want automatic sorting of imports I have to enable it.~ Edit: Thats <code>I001</code>
So I&#x27;m stuck in this strange state where ruff is very helpful and very annoying.
Do you have any idea or tips how I can make it work?</p>
<p>I&#x27;m currently thinking of automatically generating an <code>__all__</code> symbol in the <code>__init__.py</code> files.
That way I can still have a nice an clean interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2025-12-02 20:03</div>
            <div class="timeline-body"><blockquote>
<p>I really like <code>F401</code> because it keeps my module imports clean and the imports sorted.
However in <code>__init__.py</code> files it&#x27;s more of a burden and even results in less (!!!) readable code.</p>
</blockquote>
<p>You can configure ruff to ignore F401 only in <code>__init__.py</code> files: https://docs.astral.sh/ruff/settings/#lint_extend-per-file-ignores</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spacemanspiff2007">@spacemanspiff2007</a> on 2025-12-10 03:56</div>
            <div class="timeline-body"><p>Thank you all for your replies! I think there was a mixup on my side:
I&#x27;m already ignoring <code>F401</code> in <code>__init__.py</code> but since it&#x27;s a tool/library that is used by other users I had to add the reexport because Pylance was complaining on the users computer.
The reexport was then the reason for the strange sorting.</p>
<p>I&#x27;m now programmatically generating <code>__all__</code> in the <code>__init__.py</code> files so I can remove the reexport and sorting works again as expected.
Thank you for your help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/spacemanspiff2007">@spacemanspiff2007</a> on 2025-12-10 03:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:39 UTC
    </footer>
</body>
</html>
