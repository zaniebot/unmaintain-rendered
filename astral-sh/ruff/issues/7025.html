<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP037: autofix removes quotes from Literal[&quot;value&quot;] typing when not imported - astral-sh/ruff #7025</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP037: autofix removes quotes from Literal[&quot;value&quot;] typing when not imported</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7025">#7025</a>
        opened by <a href="https://github.com/Prometheos2">@Prometheos2</a>
        on 2023-08-31 15:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Prometheos2">@Prometheos2</a> on 2023-08-31 15:36</div>
            <div class="timeline-body"><p>UP037's autofix removes quotes from typing.Literal[&quot;value&quot;] when Literal is not imported, but it's supposed to have str values.</p>
<pre><code class="language-python">_DTYPE_BACKEND: Literal[&quot;pyarrow&quot;, &quot;numpy_nullable&quot;]
</code></pre>
<p>turns into</p>
<pre><code class="language-python">_DTYPE_BACKEND: Literal[pyarrow, numpy_nullable]
</code></pre>
<h2>Details</h2>
<ul>
<li><strong>Version:</strong> 0.0.286</li>
<li><strong>Relevant settings:</strong> <code>select = [&quot;UP&quot;]</code></li>
<li><strong>Commands producing the bug:</strong><ul>
<li>the VSC extension's autofix</li>
<li><code>ruff . --fix</code></li>
<li><code>ruff . --fix --isolated --select UP</code></li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-31 15:39</div>
            <div class="timeline-body"><p>Is it a mistake or intentional that <code>Literal</code> is not imported?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-08-31 15:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Prometheos2">@Prometheos2</a> on 2023-08-31 16:24</div>
            <div class="timeline-body"><p>It was a mistake.</p>
<p>(Admittedly, it was a bit of both. I was trying out Ruff's autofix on save on VSC.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-31 18:43</div>
            <div class="timeline-body"><p>The problem here is that we cannot identify <code>Literal</code> as <code>typing.Literal</code> if it's not imported. We could add an exception for this to avoid false positives but it could introduce false negatives. Perhaps we can just avoid applying this fix (or reduce the applicability) if there's not a binding for the name of the subscript?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-31 20:38</div>
            <div class="timeline-body"><p>Yeah this is largely &quot;working as intended&quot; in that if we can't resolve a symbol to <code>typing.Literal</code>, then we treat values within subscripts in type annotations as type annotations themselves (<code>typing.Literal</code> is an exception).</p>
<p>I suppose we could change the logic to avoid treating values within subscripts as annotations if the subscript itself is unbound, although it would do the wrong thing if the user has any wildcard imports.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> removed by @charliermarsh on 2023-08-31 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-08-31 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-01 02:05</div>
            <div class="timeline-body"><p>Perhaps we can downgrade from automatic to suggested fix if it's unbound. The wildcard imports are a good example, but hopefully not too common in this case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-06 15:38</div>
            <div class="timeline-body"><p>I'm not sure how to implement this with the way that we visit type definitions â€” do you have a suggestion @charliermarsh ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-03 03:15</div>
            <div class="timeline-body"><p>@zanieb - What if we just treat &quot;Literal&quot; as <code>typing.Literal</code> if the symbol is unresolved...?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:11 UTC
    </footer>
</body>
</html>
