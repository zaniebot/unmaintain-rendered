<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`W292` missing detection - astral-sh/ruff #10379</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>W292</code> missing detection</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10379">#10379</a>
        opened by <a href="https://github.com/hikaru-kajita">@hikaru-kajita</a>
        on 2024-03-13 09:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hikaru-kajita">@hikaru-kajita</a></div>
            <div class="timeline-body">

Summary:
<p>If I create <code>test.py</code> with the content:</p>
<pre><code>print(2)
</code></pre>
<p>This should throw error of <code>W292 no newline at end of file</code>, but it doesn&#x27;t.</p>
What I investigated:
<p>Although there is <code>missing_newline_at_end_of_file.rs</code> in <code>crates/ruff_linter/src/rules/pycodestyle/rules</code>, it seems that the function <code>check_physical_lines</code> in <code>crates/ruff_linter/src/checkers/physical_lines.rs</code> is not called in <code>crates/ruff_linter/src/linter.rs</code>.
From line 210 to line 213, there is this <code>settings.rules.iter_enabled().any(|rule_code| rule_code.lint_source.is_physical_lines())</code>, but all of those returned false.
FYI if I inserted <code>settings.rules.iter_enabled().for_each(|rule_code| {println!(&quot;{:?}&quot;, rule_code)});</code>, I got this:</p>
<pre><code>MultipleImportsOnOneLine
ModuleImportNotAtTopOfFile
MultipleStatementsOnOneLineColon
MultipleStatementsOnOneLineSemicolon
UselessSemicolon
NoneComparison
TrueFalseComparison
NotInTest
NotIsTest
TypeComparison
BareExcept
LambdaAssignment
AmbiguousVariableName
AmbiguousClassName
AmbiguousFunctionName
IOError
SyntaxError
UnusedImport
ImportShadowedByLoopVar
UndefinedLocalWithImportStar
LateFutureImport
UndefinedLocalWithImportStarUsage
UndefinedLocalWithNestedImportStarUsage
FutureFeatureNotDefined
PercentFormatInvalidFormat
PercentFormatExpectedMapping
PercentFormatExpectedSequence
PercentFormatExtraNamedArguments
PercentFormatMissingArgument
PercentFormatMixedPositionalAndNamed
PercentFormatPositionalCountMismatch
PercentFormatStarRequiresSequence
PercentFormatUnsupportedFormatCharacter
StringDotFormatInvalidFormat
StringDotFormatExtraNamedArguments
StringDotFormatExtraPositionalArguments
StringDotFormatMissingArguments
StringDotFormatMixingAutomatic
FStringMissingPlaceholders
MultiValueRepeatedKeyLiteral
MultiValueRepeatedKeyVariable
ExpressionsInStarAssignment
MultipleStarredExpressions
AssertTuple
IsLiteral
InvalidPrintSyntax
IfTuple
BreakOutsideLoop
ContinueOutsideLoop
YieldOutsideFunction
ReturnOutsideFunction
DefaultExceptNotLast
ForwardAnnotationSyntaxError
RedefinedWhileUnused
UndefinedName
UndefinedExport
UndefinedLocal
UnusedVariable
UnusedAnnotation
RaiseNotImplemented
</code></pre>
<p>which doesn&#x27;t include <code>MissingNewlineAtEndOfFile</code>.
Sorry I wasn&#x27;t very sure about the internal system of where all of these rules are defined, so I couldn&#x27;t investigate more, but hope this information helps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-13 10:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-13 10:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 11:45</div>
            <div class="timeline-body"><p>Thanks for investigating into it and providing all the details!</p>
<p>Can you provide some additional details which I can use to try reproducing the possible bug as it&#x27;s giving me the diagnostic with <code>v0.3.2</code>:</p>
<pre><code>$ ruff check --select=W292 --isolated --no-cache --output-format=full src/W292.py
src/W292.py:1:9: W292 [*] No newline at end of file
  |
1 | print(2)
  |          W292
  |
  = help: Add trailing newline

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>The following would help:</p>
<ul>
<li>Ruff version (<code>ruff --version</code>)</li>
<li>How are you running Ruff? Editor / CLI?</li>
<li>If from CLI, which command are you using to run?</li>
<li>Ruff configuration which is being used here if any</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hikaru-kajita">@hikaru-kajita</a> on 2024-03-13 11:58</div>
            <div class="timeline-body"><p>I haven&#x27;t changed the Ruff configurations.
I&#x27;ve directly cloned this Ruff repository, so if I put <code>cargo run -p ruff -- --version</code>, it outputs <code>ruff 0.3.2</code>.
I run Ruff with <code>cargo run -p ruff check src/W292.py --no-cache</code> and didn&#x27;t get the warning.</p>
<p>Actually, I&#x27;ve tried the command and found that when I put the option of <code>--select=W292</code> it worked (gave me error), so it&#x27;s probably a bug.
Sorry if this was just me confusing, but I&#x27;m not sure what&#x27;s the exact rule which is enabled when I don&#x27;t put anything in select option...?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 12:06</div>
            <div class="timeline-body"><blockquote>
<p>Actually, I&#x27;ve tried the command and found that when I put the option of <code>--select=W292</code> it worked (gave me error), so it&#x27;s probably a bug.
Sorry if this was just me confusing, but I&#x27;m not sure what&#x27;s the exact rule which is enabled when I don&#x27;t put anything in select option...?</p>
</blockquote>
<p>No need to apologize. You can find the default rule set here: https://github.com/astral-sh/ruff#configuration</p>
<blockquote>
<pre><code>[tool.ruff.lint]
# Enable Pyflakes (`F`) and a subset of the pycodestyle (`E`)  codes by default.
select = [&quot;E4&quot;, &quot;E7&quot;, &quot;E9&quot;, &quot;F&quot;]
</code></pre>
</blockquote>
<p>Closing this to keep the issue tracker actionable but feel free to ask any other questions that you might have.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 12:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 12:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> removed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 12:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 12:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 12:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hikaru-kajita">@hikaru-kajita</a> on 2024-03-13 12:59</div>
            <div class="timeline-body"><p>Alright. Thank you so much :D</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:51 UTC
    </footer>
</body>
</html>
