<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F823 (undefined local) triggered by a double import - astral-sh/ruff #6029</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F823 (undefined local) triggered by a double import</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6029">#6029</a>
        opened by <a href="https://github.com/ajkerrigan">@ajkerrigan</a>
        on 2023-07-24 13:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ajkerrigan">@ajkerrigan</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>First, thanks for ruff! It rocks and I love it :heart_eyes: .</p>
<p>I ran across a minor issue recently and wanted to document it here in case other folks do too. I'm not sure if it's an intentional change or not...</p>
<p>Moving from version <code>0.0.278</code> to <code>0.0.279</code> I noticed <code>F823 Local variable 'sys' referenced before assignment</code> occurring in a new situation. If you import a module twice, this rule flags references in between the two imports. For example:</p>
<blockquote>
<p>double_import.py</p>
</blockquote>
<pre><code class="language-python">import sys


def main():
    print(sys.argv)

    try:
        3 / 0
    except ZeroDivisionError:
        import sys

        sys.exit(1)
</code></pre>
<pre><code class="language-console">‚ùØ ruff double_import.py
double_import.py:5:11: F823 Local variable `sys` referenced before assignment
Found 1 error.
</code></pre>
<p>It does feel right to call out the double <code>import sys</code> as unnecessary here, but F823 seems misleading. Is this change intentional?</p>
<p><em>I didn't see an obvious answer in the <code>0.0.279</code> changelog though there are a couple changes that seem possibly relevant. Will update here if I find anything useful. The change that seems _most</em> relevant at a glance (to my untrained eye anyway) is bcec2f0c4ce626c22c0727d02195ec077572ea98._</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-07-24 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 13:48</div>
            <div class="timeline-body"><p>Thanks! Looks like a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "F823 triggered by a double import" to "F823 (undefined local) triggered by a double import" by @ajkerrigan on 2023-07-24 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 14:20</div>
            <div class="timeline-body"><p>Or, this may actually be correct? I'm not 100% sure. Python does error with an early unbound access:</p>
<pre><code>Traceback (most recent call last):
  File &quot;/Users/crmarsh/workspace/ruff/foo.py&quot;, line 22, in &lt;module&gt;
    main()
  File &quot;/Users/crmarsh/workspace/ruff/foo.py&quot;, line 5, in main
    print(sys.argv)
          ^^^
UnboundLocalError: cannot access local variable 'sys' where it is not associated with a value
</code></pre>
<p>So in that case, F823 feels correct to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ajkerrigan">@ajkerrigan</a> on 2023-07-24 14:35</div>
            <div class="timeline-body"><p>Ha, you're right :sweat_smile: !  I could have seen it either way since it does feel wrong and worth yelling about one way or the other.</p>
<p>My first thought was looking at <code>flake8</code> which runs clean on this file. But <code>pylint</code> yells all around the issue :grin:</p>
<pre><code class="language-console">double_import.py:11:8: W0621: Redefining name 'sys' from outer scope (line 1) (redefined-outer-name)
double_import.py:6:10: E0601: Using variable 'sys' before assignment (used-before-assignment)
double_import.py:11:8: W0404: Reimport 'sys' (imported line 1) (reimported)
double_import.py:11:8: C0415: Import outside toplevel (sys) (import-outside-toplevel)
double_import.py:1:0: W0611: Unused import sys (unused-import)
</code></pre>
<p>This is also a good reminder to not just lint your minimal example but also try, you know... <em>running</em> it :laughing: .</p>
<p>Thanks for the follow-up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ajkerrigan on 2023-07-24 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 14:42</div>
            <div class="timeline-body"><p>I had the same reaction as you, I actually thought that code was fine! I'm gonna add some test cases so that we're at least explicit about this.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:47:46 UTC
    </footer>
</body>
</html>
