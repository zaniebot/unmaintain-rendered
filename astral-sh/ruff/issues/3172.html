<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Per file selection - astral-sh/ruff #3172</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Per file selection</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3172">#3172</a>
        opened by <a href="https://github.com/henryiii">@henryiii</a>
        on 2023-02-23 15:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-23 15:42</div>
            <div class="timeline-body"><p>I'd like a way to activate a rule for a subset of files; basically the inverse of per-file-ignores. In my case, I'd like to activate pydocstyle on the main module, but not tests, examples, docs, benchmarks, support files, setup.py, etc.</p>
<p>Current and possible options:</p>
<ul>
<li>Use a second ruff.toml/pyproject.toml inside the package. This is not ideal, as I don't want to add extra files (especially pyproject.toml's, as those should only be at the root of packages). This is the only one in the list that would work today (that I know of). <code>.ruff.toml</code> (#2988) would help a little, but still not my preferred solution for this case - I'd like all configuration in a single file.</li>
<li>Add <code>tool.ruff.per-file-extend-select</code> (technically, <code>per-file-ignores</code> is also extend, so maybe for symmetry it could be <code>tool.ruff.per-file-extend-select</code>). This would then be <code>&quot;src/**.py&quot; = [&quot;D&quot;]</code>.</li>
<li>Support negation in <code>tool.ruff.per-file-ignores</code> like a gitignore. So <code>&quot;!src/**.py&quot; = [&quot;D&quot;]</code> would ignore D on anything except <code>src/**.py</code> files.</li>
</ul>
<p>Thoughts?</p>
<p>Here's what I would have to put without this:</p>
<pre><code class="language-toml">[tool.ruff.per-file-ignores]
&quot;doc/**.py&quot; = [&quot;D&quot;]
&quot;tests/**.py&quot; = [&quot;D&quot;]
&quot;bench/**.py&quot; = [&quot;D&quot;]
&quot;.ci/**.py&quot; = [&quot;D&quot;]
&quot;cmake_ext.py&quot; = [&quot;D&quot;]
&quot;version.py&quot; = [&quot;D&quot;]
&quot;setup.py&quot; = [&quot;D&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-23 18:02</div>
            <div class="timeline-body"><p>I suspect that the last option would be much easier to support than <code>per-file-extend-select</code>. I'm open to it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-02-23 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">core</span> added by @charliermarsh on 2023-02-23 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-23 18:04</div>
            <div class="timeline-body"><p>(The way <code>per-file-ignores</code> work right now is that we still run the ignored rules over those files, we just suppress the violations. We couldn't use the same strategy for <code>per-file-extend-select</code> -- we'd have to enable curating a rule set for every file, which would be a more significant refactor.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/justinchuby">@justinchuby</a> on 2023-04-25 14:28</div>
            <div class="timeline-body"><p>This feature will be useful for big repositories (eg. PyTorch) to incrementally adopt stricter rules in different components.</p>
<p>Potentially run checks on all rules from the per-file-select as well for everyone, then suppress for files not in this group?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kludex">@Kludex</a> on 2023-04-25 14:35</div>
            <div class="timeline-body"><p>It's useful for small repositories as well. ðŸ‘€</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-12 02:56</div>
            <div class="timeline-body"><p>If someone wants to work on this, I'd be happy to review a proposal. I expect there to be some prototype / design work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2023-11-12 02:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ryangalamb">@ryangalamb</a> on 2024-03-13 17:45</div>
            <div class="timeline-body"><p>Leaving my notes here in case another contributor wants to pick this up.</p>
<p>The glob mechanism in Ruff is based on <a href="https://docs.rs/globset/latest/globset/">globset</a>, and it looks like the options supported there are supported in Ruff.</p>
<p>The only negation option that's supported is single character negation (e.g., <code>[!abc]</code> being the inverse of <code>[abc]</code>). I thought I could be clever and abuse this, but it doesn't seem very reliable. (It also looks awful.)</p>
<p>Extended globbing has negation, which could work, but extended globs are not likely to be supported by globset: https://github.com/BurntSushi/ripgrep/issues/2608</p>
<p>globset is part of the ripgrep project. Ripgrep allows negation by using a <code>!</code> prefix. <strong>Putting a <code>!</code> in front of your glob will match everything except for the glob.</strong> (<a href="https://github.com/BurntSushi/ripgrep/blob/master/GUIDE.md#manual-filtering-globs">Link to ripgrep's globbing docs'</a>)</p>
<p>The <code>!</code> prefix approach seems reasonable and easy to explain/document. <code>&quot;!foo/*&quot;</code> would match everything except for <code>&quot;foo/*&quot;</code>. Only a <code>!</code> prefix would be treated specially. Any other <code>!</code>s would be treated as part of the glob.</p>
<p>(And yes, I do realize that this was a lot of work to reach exactly what @henryiii suggested in his third bullet point :joy: Hopefully this helps other curious folks save themselves some time/effort.)</p>
<p>@zanieb Does the <code>!</code> prefix approach seem reasonable to you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 17:05</div>
            <div class="timeline-body"><p>I'm supportive of adding negations via <code>!</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-05 17:23</div>
            <div class="timeline-body"><p>I'm supportive as well. Is someone interested in putting up a prototype?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 17:29</div>
            <div class="timeline-body"><p>I think @carljm may be interested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2024-04-10 03:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-04-10 19:20</div>
            <div class="timeline-body"><p>See some discussion at https://github.com/astral-sh/ruff/pull/10863#discussion_r1559906597 on how negative patterns should behave when the pattern does match the file (i.e. the negative pattern doesn't hit). Should this &quot;un-ignore&quot; the listed patterns, or do nothing (patterns are always only additive to what's ignored)?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:29 UTC
    </footer>
</body>
</html>
