<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configured auto-fixes for undefined-name errors - astral-sh/ruff #14857</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Configured auto-fixes for undefined-name errors</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14857">#14857</a>
        opened by <a href="https://github.com/leep-frog">@leep-frog</a>
        on 2024-12-09 02:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leep-frog">@leep-frog</a></div>
            <div class="timeline-body"><p>It would be tremendously useful if we could add the following configuration to automatically fix <a href="https://docs.astral.sh/ruff/rules/undefined-name/">undefined-name</a> errors:</p>
<pre><code>[format]

auto-import-names = [
  &quot;pd:import pandas as pd&quot;,
  &quot;Dict:from typing import Dict&quot;,
]
</code></pre>
<p>which would fix the following code:</p>
<pre><code>def some_func() -&gt; Dict[str, pd.array]:
  return {
    &quot;key&quot;: pd.array([]),
  }
</code></pre>
<p>to become the following automatically</p>
<pre><code>import pandas as pd
from typing import Dict

def some_func() -&gt; Dict[str, pd.array]:
  return {
    &quot;key&quot;: pd.array([]),
  }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-09 05:28</div>
            <div class="timeline-body"><p>Thanks for the proposal.</p>
<p>I definitely agree that this is a really useful feature although I&#x27;d argue that a language server is more capable of providing such features (as they already do) via auto-completion. If you type <code>pand...</code>, the auto-completion menu could include a completion for <code>pandas</code> with an edit which will add the import. For example, this is what Pyright gives me:</p>
<p><img src="https://github.com/user-attachments/assets/0edf163c-0295-472c-a06a-c6b5b33eb473" alt="Image"></p>
<p>The reason I&#x27;m saying that language servers are more capable is because they understand your project at a much deeper level. They would understand all the packages that are available in the current virtual environment which is where this suggestion would come from. If this configuration is implemented in Ruff, it would assume all <code>pd</code> symbols to be coming from <code>pandas</code> module and add an <code>import pandas as pd</code> on all files that contain that symbol even if that might not be true.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-09 09:04</div>
            <div class="timeline-body"><p>We could consider adding it as a manual fix to the existing rules and respect the import-convention configuration to suggest common imports.</p>
<p>The main challenge with arbitrary imports is that Ruff doesn&#x27;t understand the project dependencies yet. It limits what kind of suggestions we can provide.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-09 12:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leep-frog">@leep-frog</a> on 2024-12-10 00:21</div>
            <div class="timeline-body"><p>Thanks for the prompt response.  Your point about language server definitely makes sense and is how I currently go about it.  The main reasons I&#x27;d really like to see this in ruff is the following:</p>
<ol>
<li>No user interaction would be required for ruff auto-importing.  If I type (<code>def func(d: Dict[str, Any]</code>), for example, (assuming I have an auto-formatter setup in my IDE to trigger on certain typed characters), then these imports (<code>Dict, Any</code>) would be automatically added without any selection having to be made and my flow is not interrupted at all.  Just simply type away and assume ruff will take care of these things.</li>
<li>Occasionally, my language server (Pylance) takes a really long time to generate recommendations.  I&#x27;ll sometimes type <code>pd</code> and end up waiting longer than it would have taken to just do it myself (albeit this may be more of a complaint with Pylance than a requirement to add this feature in ruff)</li>
</ol>
<p>Ultimately, I think this would be really great for simple, common imports (<code>Dict</code>, <code>Optional</code>, common typing annotations etc., <code>pd</code>, <code>np</code>), but agree that this should not be recommended for more nuanced auto-imports.</p>
<p>That being said, certainly neither of my arguments make this a definitive requirement for ruff, and only a nice-to-have, so will leave it to you to decide whether to pick this up or not.  But thought it is something that thought others might find useful!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leep-frog">@leep-frog</a> on 2024-12-10 00:22</div>
            <div class="timeline-body"><p>I&#x27;m also working on a VS Code extension to do this btw.  Should be done within a week I&#x27;d say.  Not sure if that affects how you prioritize this, but figured I&#x27;d mention it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-10 04:22</div>
            <div class="timeline-body"><blockquote>
<p>We could consider adding it as a manual fix to the existing rules</p>
</blockquote>
<p>I believe we already do, at least the part where we auto-import certain symbols if required for an auto-fix.</p>
<blockquote>
<p>... and respect the import-convention configuration to suggest common imports.</p>
</blockquote>
<p>Can you expand on this? Do you mean that if an auto-fix were to import the <code>pandas</code> module then it should check if the convention is to use <code>import pandas as pd</code> or not?</p>
<blockquote>
<p>That being said, certainly neither of my arguments make this a definitive requirement for ruff, and only a nice-to-have, so will leave it to you to decide whether to pick this up or not. But thought it is something that thought others might find useful!</p>
</blockquote>
<p>I agree and thank you for providing your thoughts on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leep-frog">@leep-frog</a> on 2024-12-16 03:26</div>
            <div class="timeline-body"><blockquote>
<p>I agree and thank you for providing your thoughts on this.</p>
</blockquote>
<p>No problem!</p>
<p>And I just published <a href="https://marketplace.visualstudio.com/items?itemName=groogle.very-import-ant">this VS Code extension</a> that does what this issue requested, so now it might be even less of a priority to add this functionality inside of ruff itself.</p>
<p>Given that, I&#x27;m fine if you close this, but will defer to you if you&#x27;re still pondering adding it to ruff even with the new extension.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-16 07:39</div>
            <div class="timeline-body"><p>Thanks for the update and nice extension!</p>
<p>I&#x27;ll close this issue for now because there&#x27;s no immediate action on our side. This does not mean that we don&#x27;t plan on adding this functionality to Ruff&#x27;s LSP long-term</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-16 07:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:08 UTC
    </footer>
</body>
</html>
