<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: Pragma comments - astral-sh/ruff #6197</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: Pragma comments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6197">#6197</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-07-31 13:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-31 13:20</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/ruff/discussions/6670 for the proposal for the details:</p>
<ul>
<li>[x] https://github.com/astral-sh/ruff/issues/5630</li>
<li>[x] #6771</li>
<li>[x] #6772</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4798.html">astral-sh/ruff#4798</a> on 2023-07-31 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-07-31 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-07-31 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2023-07-31 16:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6203.html">astral-sh/ruff#6203</a> on 2023-07-31 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-08-04 08:24</div>
            <div class="timeline-body"><p>do you have any examples of this happening? (how did you find them)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-04 08:36</div>
            <div class="timeline-body"><blockquote>
<p>do you have any examples of this happening? (how did you find them)</p>
</blockquote>
<p>I haven't looked closely into it but there's some related Black logic:</p>
<p>https://github.com/psf/black/blob/2fd9d8b339e1e2e1b93956c6d68b2b358b3fc29d/src/black/lines.py#L227-L294</p>
<p>and</p>
<p>https://github.com/psf/black/blob/268dcb677ce80331e0ef104d8335c2ada32872fb/src/black/comments.py#L324-L335</p>
<p>I don't know if this is a valid noqa placement, but splitting by the arguments could change what it annotates</p>
<pre><code class="language-python">def test(a, b, # noqa: RUFXXX
	c, d): pass

# Formatted
def test(
	a, 
	b, # noqa: RUFXXX
	c, 
	d
): pass
</code></pre>
<p>This could cause <code>RUFXXX</code> to trigger now if it suppressed <code>a</code> or <code>test</code> and not <code>b</code>. <a href="https://play.ruff.rs/?secondary=Format#N4KABGBECGA2sHsDuBTAJgWgMYIHYDMBXAZ2gCNYVjIAuMAbQF0AacKMwgS1gBdPdqdJqwiQ0hALYSAnhgBu0AE6dylDIoDmAD1pQAegAoA+gGoAPsZP1oGAF4BBDAC0ADBgCcRxgCprdx64ejCYA-ACUYQAkkCJQKFo8KLiYnBq4CIoousJskPGJyRjEKJRYPNksuflJmPicWqpZQpWi1YWEBPWNFbF5CSiKuHA9uanpmSOisPwoGJS4GjwAFroAHKu9PORFnLZNYAAsvcWl5UJsovYASgDiMRdQAGKQbC1QW5ooPPIDxJx4ukgAAdpABmACMLnuonwsGgAGsUKsMNBcOktnw8IIwKAIKIZCCMPxON9MjxCINdPg4MVYqJiIQgUDMsRiBhxFJZEoNNjqbBaQ9IAymSy2elcLMyRTcPwNFSaSg6VA4IgkEUPijNCjcNJ5fzFYKxhlZkR4LIOjxpED0HrimwAL69WEIpEYMiotAk3S4vGQJZKNA4NDoDA8CRA9mcTJlDK685430AejDQOhCagiYUimT4bTCcgieDckTxCWEheCbeoiwSxQWHhoatIfiWBQQMxuFtKAdTrhiORHA0ZBQSm9graKSkhC2FFmWBV2KYPdyzv7bq4vH42J9og43D4AiJaWN02IZwYjGXML7rpw4cytYE-wEY-zKuQkbK2AXGCQJKWGCItISAZJg3KSEkPC8gqV5QKut4ICCygaEs547lA6KcK26jaICBghJwYQAMKIdIyGoQAOhRxAmAYVEGERVFhFRNFhCEVFoMABz2gYGAcVx9phN4eZQBI-AYHUah-HsuguLBkDwciAyKBIxBynQ6GQBI0BaOqygLHMSSLCsdByRAjorjeyIAI6EAgiTboauDTBKGC2fZVCAmgCCELOIlaYQm4ubM7kOV5Pl+UqYgIFgZ76Robl2WFdDRb5lD+dAcgIJwmBUPO1q6DwiiEN25m9i6yInPgr6+kamQYEMEiefG6aQEY2mIiJohGNAxCemUXVQEYmRAnCraDW1dQlGg1BKt1U2wGgRjBtSgVQRNRiNSgRgbQosAlTtDyXmVlkVaGOWyJw4YZOtGmCu6uDqCU0B8HIsxXUCN3YsCSiQbN92ohKYFApw3r2vJimNta2C1vWso1fSRVYeefICvm8QoOG3wSAg4iUIuDyiJaIMLBWeJVlAxW4HwTUYCge2EC9IbusU2BwqyzUXlFVM07M9NwIziSYMGOCKC9GSLsdYAWdeZ0aF8iQJAjcEdGUz4NdATUE+mQ0TfLPCK+Uc0YfrhtkxAFN9AUtSqx2GtaxUENWUS4bTFgJJ6dgeDzmhgrvmqEhrdwMyFcVpXS+Va4fTdXu4G91PPo5b7TL1nPoaIQIer1gJAmgE0gkoijIDn0D54gPCwNIAB08TMlQ31AjoxtCiOZAZJ2KXEC+zcFMQGSwsXKU8NVze4JIIKArgqbN9pPCjfZ0xkICrsTbP88V5wZBVyC6857wE08PC-CJIogKH-nCBwooDewPnqIlDnnbN3AWxRoCL8TUsl8IHInAoEg30lhyHNtLJ2Z0QQOW+GeaQ6U7r5jqAkCksxM6ZGprWYo2IiolSiigzWXxlB7HtlQKG+xIDklGlkHBSg8FI0IQzYhxNSGniNoKXBTVaGzHoWyIuapGFn0ZOlbm0BOAYKerZKMsxZ41gkhkbIhMoAACFU4AFEtCtnbM+Caqj1EdgmgANQFigZRigi6n2bgAeQAMrGNMRNAAkuYmxsjm7KLjlGPATVqZOLMfIoUMVEQ8BriY2RR0hEiOIROMRXB6pSIAvgWRzQoraUUA2FBkF0GcyweHGWcFnYdBICGcCnjbo4kNMeeqWYVD9SIdBfU8kRE3WVgpDI2EkBiwjHAFQGCuxRXiYobCfwFhqGCj0wUgyNDDJmHTNR+0-hYkmL6O8ZApm9Rdp9RQJTUYGnzMQUaHs8ChjFsHAyd5tKh2wYKUCAw3SyD4XQLJvSWmzD7hs38-5xLFDVvMugWyorzlZsUJ8r19i-MFH07CPAEChkQgs0Q8J0hIEenUa+3wUGWlhVAeFyBHrLCjJgNFcYuaCixYiuYMU4AyMWgMDFVsxbqizooTAi8xaKEJTkfMmQ4TArWV9DAVzT4pSIBs9B3xIVswQBglhHKUDiMyJOdZJT2WLPZt0xJgocACC2NTSWUVKmNB1YKdIcwZhsmHH0-YSqpgmpRPgE+PKNnYgwOCKKwVTVfFQEkEh2IXCPP6SGYouDEg0s+XbflcidYKWnEgiaZ4GVMs3iy3UPclh4owASiayKzxpqUOi5uiB5ywEpcGU+oSxl1g7NucGJ18RYHnMOJp2ldJ3goVoEkhLITyWtECZEjV4ZwNquU2YW1tatWKDwAAqtPXxiQlAABFsUxq+JOoiKqD4jkUPOxFK7er-QjWOydABZXGgVKHTvXZu3AR68anojb1aQuAsCWKXVO29xB71YAACrnoXc3fdQIv1nlnS9UuzdqTcCQdotsui814A0Ae+u0B5arx0rOzg+BqqlvzFgFV7Cv7CzrBkcW19g0Yiwrh3G7ICNi0hcR5onbpBBioJaWBpT8x1VmD-AYiADJbGIA2U5f0uz0e8rFZj+xNLsco6LIjBr8zMkQgMS0UnCM0clvR+CSdfSRPlhKZQsVHbVqgCCFyvtk6qgwNpDQWF5CGK9eG0dRUJpkGkGFTDvpG1ujFg+9BuhwQACYkk6SeuSQY2IABsgXdLcmxAAVki-SxIxTYtmQjrkEEjINBi2DE0xEbZ1AWiurMYmfawBbIdCAe0kQqsrTAJAgw0BmBgDII1gAxGAdI1loB0GuDcFwLhwRgBAAASCwI1tAYQ6CZ1ZEAA">Playground</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/roshanjrajan-zip">@roshanjrajan-zip</a> on 2023-08-06 23:18</div>
            <div class="timeline-body"><p>Hi! This is one of the problems we have in our repo. However, we use # pyright: ignore instead of # type: ignore. It would be great to have this as dynamic or something to support different use cases. Please lmk if there is anything I can do to provide more info or any help - https://github.com/psf/black/pull/3661</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-16 13:49</div>
            <div class="timeline-body"><p>Relevant lines in the Black formatter (I think)</p>
<p>https://github.com/psf/black/blob/2fd9d8b339e1e2e1b93956c6d68b2b358b3fc29d/src/black/lines.py#L227-L294</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-16 13:52</div>
            <div class="timeline-body"><p>My one-second reaction is that I think we probably do a reasonably good job of avoiding the uncollapsible comment case since we don't really collapse comments (comments always expand the parent), but I don't think we handle the unsplittable line case at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-16 14:09</div>
            <div class="timeline-body"><p>Some more relevant issues:</p>
<ul>
<li>https://github.com/psf/black/issues/195</li>
<li>https://github.com/psf/black/issues/1061</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-17 19:05</div>
            <div class="timeline-body"><p>@roshanjrajan-zip The example you brought up on the Black issue is</p>
<pre><code class="language-python">some_long_variable_name = some_long_dict_name[0] # pyright: ignore[reportGeneralTypeIssues]
</code></pre>
<p>How would you preferred formatting look like?</p>
<p>Would the following work for you?</p>
<pre><code class="language-python">some_long_variable_name = ( # pyright: ignore[reportGeneralTypeIssues]
	some_long_dict_name[0] 
)
# Or
some_long_variable_name = some_long_dict_name[  # pyright: ignore[reportGeneralTypeIssues]
	0
] 
</code></pre>
<p>It would still require manual intervention (you have to move the comment to the opening parentheses), but it would allow you to suppress the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-17 19:31</div>
            <div class="timeline-body"><p>Black issue and PR that added the special <code>type: ignore</code> handling</p>
<ul>
<li>https://github.com/psf/black/issues/997</li>
<li>https://github.com/psf/black/pull/1040</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-18 07:40</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/ruff/discussions/6670</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/roshanjrajan-zip">@roshanjrajan-zip</a> on 2023-08-19 04:40</div>
            <div class="timeline-body"><p>Hi @MichaReiser,</p>
<p>Definitely the first one is much better imo and my team agrees! Thanks so much for your work on the proposal. Taking a look at it!</p>
<pre><code class="language-python">some_long_variable_name = ( # pyright: ignore[reportGeneralTypeIssues]
	some_long_dict_name[0] 
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Alpha" by @MichaReiser on 2023-08-22 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-08-22 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Beta" by @MichaReiser on 2023-08-22 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-08-22 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Alpha" by @MichaReiser on 2023-08-22 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-08-22 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Formatter: Beta" by @MichaReiser on 2023-08-22 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-08-22 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-09-01 11:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
