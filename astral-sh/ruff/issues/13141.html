<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RET504 for yield - astral-sh/ruff #13141</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RET504 for yield</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/13141">#13141</a>
        opened by <a href="https://github.com/opk12">@opk12</a>
        on 2024-08-28 15:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/opk12">@opk12</a> on 2024-08-28 15:31</div>
            <div class="timeline-body"><p>Hi, Python newbie here. <code>test_return()</code> warns about unnecessary assignment before return, so I was wondering, what about the same, but for yield?</p>
<pre><code>$  cat a.py 
import math


def test_return() -&gt; int:
    &quot;&quot;&quot;Test `return`.&quot;&quot;&quot;
    for size in range(1, 10):
        content = math.sqrt(size)
        return content


def test_yield() -&gt; int:
    &quot;&quot;&quot;Test `yield`.&quot;&quot;&quot;
    for size in range(1, 10):
        content = math.sqrt(size)
        yield content
</code></pre>
<pre><code>$    ruff check .  --select ALL --isolated
warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible. Ignoring `one-blank-line-before-class`.
warning: `multi-line-summary-first-line` (D212) and `multi-line-summary-second-line` (D213) are incompatible. Ignoring `multi-line-summary-second-line`.
a.py:1:1: D100 Missing docstring in public module
a.py:6:5: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
a.py:8:16: RET504 [*] Unnecessary assignment to `content` before `return` statement
Found 3 errors.
[*] 2 potentially fixable with the --fix option.
</code></pre>
<pre><code>$  # Debian sid
$  ruff --version
ruff 0.0.291
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2024-08-28 18:08</div>
            <div class="timeline-body"><p>A return statement will exit the function, so the variable of the assignment will never be used.
A yield statement does not exit the function, so the variable of the assignment could be used elsewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/opk12">@opk12</a> on 2024-08-28 19:56</div>
            <div class="timeline-body"><p>Good point. For context, I have a custom helper function for non-sequential iteration over Pandas <code>pd.Series</code> entries. This helper has no other usage of the variable and has the same core structure as <code>test_yield()</code> (which was actually trimmed down from the helper). OTOH this is not a big deal, so I understand if it's not found to be worth the effort.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-29 09:41</div>
            <div class="timeline-body"><p>We track the number of references to each binding that's created in our semantic model. We could plausibly emit this lint only if the variable being yielded is a local variable that's only ever used in the <code>yield</code> expression. I think this could be a reasonable rule -- though since it doesn't exist in the original <code>flake8-return</code> linter, it should probably be a <code>RUF</code> rule rather than a <code>RET</code> rule.</p>
<p>@JonathanPlasse would you still object to that version of the rule?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-08-29 09:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2024-08-29 09:52</div>
            <div class="timeline-body"><p>I was not objecting to it. I am open to it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-29 09:57</div>
            <div class="timeline-body"><p>Okay, great! Was just checking I hadn't missed something that you'd maybe spotted :D</p>
<p>I'll mark this as &quot;accepted&quot; then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @AlexWaygood on 2024-08-29 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @AlexWaygood on 2024-08-29 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @MichaReiser on 2024-12-02 17:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
