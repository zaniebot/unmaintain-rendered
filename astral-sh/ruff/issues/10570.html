<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update `PatternMatchMapping` AST node - astral-sh/ruff #10570</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Update <code>PatternMatchMapping</code> AST node</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10570">#10570</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-03-25 13:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-25 13:11</div>
            <div class="timeline-body"><p>As discussed in this comment thread: https://github.com/astral-sh/ruff/pull/10477#discussion_r1533482057</p>
<p>Multiple double star pattern isn't allowed in a mapping pattern. The new parser throws an error but drops the earlier node because there's no way to store multiple double star pattern. This requires updating the AST to allow that.</p>
<p>Possible representation (similar to Pyright):</p>
<pre><code class="language-rs">pub struct PatternMatchMapping {
    pub range: TextRange,
	pub patterns: Vec&lt;MappingPattern&gt;
}

pub enum MappingPattern {
	KeyValue(MappingKeyValuePattern),
	DoubleStar(MappingDoubleStarPattern),
}

pub struct MappingKeyValuePattern {
	pub range: TextRange,
	pub key: Box&lt;Expr&gt;,
	pub pattern: Pattern,
}

pub struct MappingDoubleStarPattern {
	pub range: TextRange,
	pub value: Identifier,
}
</code></pre>
<p><strong>This isn't finalized yet.</strong></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @dhruvmanila on 2024-03-25 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by @dhruvmanila on 2024-03-25 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @dhruvmanila on 2024-03-25 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2024-03-25 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @dhruvmanila by @dhruvmanila on 2024-11-26 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 08:52</div>
            <div class="timeline-body"><p>Another downside of the current representation is that visiting the node in source order requires comparing text ranges to <em>guess</em> when to visit the <code>rest</code> pattern</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:33:17 UTC
    </footer>
</body>
</html>
