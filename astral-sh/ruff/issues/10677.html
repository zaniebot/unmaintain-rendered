<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W292 does not trigger even in preview mode - astral-sh/ruff #10677</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>W292 does not trigger even in preview mode</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10677">#10677</a>
        opened by <a href="https://github.com/yrahul3910">@yrahul3910</a>
        on 2024-03-30 23:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/yrahul3910">@yrahul3910</a> on 2024-03-30 23:25</div>
            <div class="timeline-body"><p>I want to configure Ruff so that it ensures one empty newline at the end of each file in Python. This should be <code>W292</code> (<code>missing-newline-at-end-of-file</code>), and is implemented in preview mode (so my understanding goes from #2402). My current <code>pyproject.toml</code> is below.</p>
<pre><code class="language-toml">[tool.ruff]
exclude = [
    &quot;.DS_Store&quot;,
    &quot;.git&quot;,
    &quot;__pycache__&quot;,
    &quot;.mypy_cache&quot;,
    &quot;.ruff_cache&quot;
]

line-length = 120
target-version = &quot;py312&quot;

[tool.ruff.lint]
preview = true
select = [&quot;E&quot;, &quot;W&quot;, &quot;F&quot;, &quot;I001&quot;, &quot;RUF002&quot;, &quot;RUF100&quot;, &quot;RUF013&quot;, &quot;RUF010&quot;, &quot;RUF200&quot;]
extend-select = [&quot;W292&quot;]

[tool.ruff.lint.isort]
lines-after-imports = 2
lines-between-types = 1
section-order = [&quot;future&quot;, &quot;standard-library&quot;, &quot;first-party&quot;, &quot;local-folder&quot;, &quot;third-party&quot;]

[tool.ruff.lint.flake8-quotes]
inline-quotes = &quot;single&quot;

[tool.ruff.lint.pycodestyle]
max-doc-length = 120
</code></pre>
<p>A MWE is fairly straightforward:</p>
<pre><code class="language-sh">echo &quot;print('Hello World!')&quot; &gt;&gt; main.py
</code></pre>
<p>And then running <code>ruff check .</code> (even with <code>--isolated</code>) yields, &quot;All checks passed!&quot;. I double-checked, and <code>wc -l</code> gives me 1 line in <code>main.py</code>. I am using Ruff 0.3.4, installed via pip, on macOS Sonoma 14.4.1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 02:40</div>
            <div class="timeline-body"><p>I believe <code>echo</code> does write a newline by default. With <code>echo -n</code>, the rule is working as intended in my testing:</p>
<pre><code>ruff on ÓÇ† main [$] is üì¶ v0.3.4 via üêç v3.11.8 via ü¶Ä v1.77.0
‚ùØ echo -n &quot;print('Hello World!')&quot; &gt;&gt; main.py
ruff on ÓÇ† main [$?] is üì¶ v0.3.4 via üêç v3.11.8 via ü¶Ä v1.77.0
‚ùØ wc -l main.py
       0 main.py
ruff on ÓÇ† main [$?] is üì¶ v0.3.4 via üêç v3.11.8 via ü¶Ä v1.77.0
‚ùØ cargo run check main.py --select W --preview -n
    Finished dev [unoptimized + debuginfo] target(s) in 0.11s
     Running `target/debug/ruff check main.py --select W --preview -n`
main.py:1:22: W292 [*] No newline at end of file
  |
1 | print('Hello World!')
  |                       W292
  |
  = help: Add trailing newline

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>Do you mind trying again?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-01 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yrahul3910">@yrahul3910</a> on 2024-04-01 02:45</div>
            <div class="timeline-body"><p>Oh god, apparently I'm just dumb. I didn't realize <code>wc -l</code> counted newline characters (and in your case, <code>wc -l</code> prints 0). In my actual project, it turns out neovim just didn't show line numbers for the empty newline at the end, so I was incredibly confused. Sorry about that, I'll close this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @yrahul3910 on 2024-04-01 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 03:44</div>
            <div class="timeline-body"><p>I didn't realize either, I learned it while looking into this :) All good!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
