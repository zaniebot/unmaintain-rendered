<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detect `asyncio-dangling-task` (`RUF006`) when discarding return value - astral-sh/ruff #8863</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Detect <code>asyncio-dangling-task</code> (<code>RUF006</code>) when discarding return value</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8863">#8863</a>
        opened by <a href="https://github.com/tjkuson">@tjkuson</a>
        on 2023-11-28 00:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tjkuson">@tjkuson</a></div>
            <div class="timeline-body"><pre><code>import asyncio

for i in range(10):
    asyncio.create_task(foo)
</code></pre>
<p>triggers <code>asyncio-dangling-task</code> but</p>
<pre><code>import asyncio

for i in range(10):
    _ = asyncio.create_task(foo)
</code></pre>
<p>does not.</p>
<p>I would expect Ruff to trigger <code>asyncio-dangling-task</code> when the return value of <code>asyncio.create_task</code> is discarded, following the <a href="https://docs.astral.sh/ruff/rules/asyncio-dangling-task/">rationale of the rule</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Detect `asyncio-dangling-task` when discarding return value&quot; to &quot;Detect `asyncio-dangling-task`(`RUF006`) when discarding return value&quot; by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-11-28 00:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Detect `asyncio-dangling-task`(`RUF006`) when discarding return value&quot; to &quot;Detect `asyncio-dangling-task` (`RUF006`) when discarding return value&quot; by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-11-28 00:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-28 18:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-28 18:32</div>
            <div class="timeline-body"><p>This seems reasonable to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-28 18:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/allaboutevemirolive">@allaboutevemirolive</a> on 2023-12-05 08:42</div>
            <div class="timeline-body"><p>Hye, @tjkuson</p>

  Minimizing

<p>I&#x27;m new to Ruff&#x27;s contributions. I try to duplicate your issue by compiling Ruff using <code>cargo build --release</code> and running the command on a Python file.</p>
<pre><code>./ruff check /home/nemesis/Documents/Github/test/python/game.py
</code></pre>
<p>game.py:</p>
<pre><code>import asyncio


async def some_coro(param):
    print(f&quot;Executing coroutine with param: {param}&quot;)
    await asyncio.sleep(1)
    print(f&quot;Coroutine with param {param} completed&quot;)


async def main():
    for i in range(10):
        asyncio.create_task(some_coro(param=i))


if __name__ == &quot;__main__&quot;:
    asyncio.run(main())
</code></pre>
<p>I expected it would produce an error: <code>asyncio-dangling-task</code>, like you mentioned above, but it didn&#x27;t.</p>
<p>The result is also the same for this snippet.</p>
<pre><code>_ = asyncio.create_task(some_coro(param=i))
</code></pre>
<p>Python Version:</p>
<pre><code>$ python3 --version
Python 3.12.0
</code></pre>
<p>Local Machine:</p>
<pre><code>Release 11 (bullseye) 64-bit
Kernel Linux 5.10.0-26-amd64 x86_64
Memory: 7.5 GiB
Processor: Intel® Core™ i5-8250U CPU @ 1.60GHz × 8 
Graphics: Mesa Intel® UHD Graphics 620 (KBL GT2)
</code></pre>


<p>Edit:</p>
<p>The rule is disabled by default. Use:</p>
<pre><code>./ruff check --select RUF006 [PATH]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-12-05 08:52</div>
            <div class="timeline-body"><p>I&#x27;m not sure if this behavior is intentional, similar to that ruff allows <code>_</code> variables to be unused. @charliermarsh was it an intentional decision to not raise the lint for variables starting with <code>_</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 14:44</div>
            <div class="timeline-body"><p>@MichaReiser - Not intentional -- this rule doesn&#x27;t look at <em>assignments</em>, it only looks at standalone expressions that include <code>asyncio.create_task(...)</code>, and then assumes that those are dangling by virtue of being a standalone expression statement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-12-05 16:51</div>
            <div class="timeline-body"><p>@allaboutevemirolive I think you need to select the rule (it isn&#x27;t enabled by default) using <code>--select RUF006</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asafamr-mm">@asafamr-mm</a> on 2023-12-08 21:11</div>
            <div class="timeline-body"><p>Hi,I gave it a try.
I&#x27;m new to rust (and the project codebase) and would love feedback. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 22:28</div>
            <div class="timeline-body"><p>Thanks @asafamr-mm!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/asafamr-mm">@asafamr-mm</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-09 21:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:47 UTC
    </footer>
</body>
</html>
