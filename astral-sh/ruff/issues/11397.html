<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FA102 should ignore quoted annotations - astral-sh/ruff #11397</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FA102 should ignore quoted annotations</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11397">#11397</a>
        opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a>
        on 2024-05-13 04:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a></div>
            <div class="timeline-body">

<p>ruff 0.4.4 (3e8878a1c 2024-05-09)</p>
<p>We have an application that targets Python 3.9+, but instead of <code>from __future__ import annotations</code> on all files that is kinda ugly and unnecessary most of the time, whenever people need PEP 604 syntax they put the annotation within quotes which is effectively the same as the future import does except when someones accesses said annotations in run time (we don&#x27;t).</p>
<p>See excerpt below:</p>
<pre><code>setup\split_code_files.py:96:34: FA102 Missing `from __future__ import annotations`, but uses PEP 604 union
   |
94 |         self.nodes = self.get_ast_nodes()
95 |
96 |     def get_yaml_nodes(self) -&gt; &#x27;dict[str, str] | None&#x27;:
   |                                  ^^^^^^^^^^^^^^^^^^^^^ FA102
97 |         try:
98 |             with open(self.yaml_file) as yaml_file:
   |
   = help: Add `from __future__ import annotations`
</code></pre>
<p>I believe FA102 should just ignore the annotation if it is within quotes. It should not mark this as violation because the code is indeed compatible with Python 3.9.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-13 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-13 17:02</div>
            <div class="timeline-body"><p>This sounds right to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-13 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 17:28</div>
            <div class="timeline-body"><p>I&#x27;m not sure, this feels like intentional behaviour to me (<a href="https://github.com/astral-sh/ruff/pull/11414">astral-sh/ruff#11414</a>#issuecomment-2108336700) -- one of the motivating reasons for FA102 is to enable UP037 to automatically remove quotes from your annotations for you. You say you find the <code>from __future__ import annotations</code> import ugly -- I suppose it&#x27;s a matter of opinion, but I find quoted annotations much more ugly personally :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 17:29</div>
            <div class="timeline-body"><p>@inoa-jboliveira, what&#x27;s your reason for enabling FA102 in the first place if you find the <code>from __future__ import annotations</code> import ugly? The purpose of this check isn&#x27;t to ensure that your code is compatible with Python 3.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-13 18:19</div>
            <div class="timeline-body"><p>Hi @AlexWaygood , thank you for the reply. I have some considerations</p>
<blockquote>
<p>what&#x27;s your reason for enabling FA102 in the first place if you find the <code>from __future__ import annotations</code> import ugly? The purpose of this check isn&#x27;t to ensure that your code is compatible with Python 3.9</p>
</blockquote>
<p>Of course the purpose is to check if the code is compatible  older verions, it says so in the docs:</p>
<blockquote>
<p>Checks for uses of PEP 585- and PEP 604-style type annotations in Python modules that lack the required from <strong>future</strong> import annotations import for compatibility with older Python versions.
https://docs.astral.sh/ruff/rules/future-required-type-annotation/</p>
</blockquote>
<p>I want the check, <strong>I just don&#x27;t want the proposed fix</strong>. For us is quite important if the code is invalid, but there are multiple ways to solve this problem.</p>
<p>I don&#x27;t like UP037 because it is an opinonated fix that is meant for when a class references itself before it is fully created. There is a lot more depth around the annotation issues and &quot;from <strong>future</strong> import annotations&quot; have been postponed multiple times because people cannot agree yet on it. I think it might some day become the right approach, but until so I might not want to use it.</p>
<p>From python docs:</p>
<blockquote>
<p>https://docs.python.org/3/library/<strong>future</strong>.html#id2
from <strong>future</strong> import annotations was previously scheduled to become mandatory in Python 3.10, but the Python Steering Council twice decided to delay the change (<a href="https://mail.python.org/archives/list/python-dev@python.org/message/CLVXXPQ2T2LQ5MP2Y53VVQFCXYWQJHKZ/">announcement for Python 3.10</a>; <a href="https://mail.python.org/archives/list/python-dev@python.org/message/VIZEBX5EYMSYIJNDBF6DMUMZOCWHARSO/">announcement for Python 3.11</a>). No final decision has been made yet. See also <a href="https://peps.python.org/pep-0563/">PEP 563</a> and <a href="https://peps.python.org/pep-0649/">PEP 649</a>.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 18:23</div>
            <div class="timeline-body"><blockquote>
<p>Of course the purpose is to check if the code is compatible older verions, it says so in the docs:</p>
</blockquote>
<p>yeah, sorry, I got quite mixed up here ðŸ™ƒ -- <a href="https://github.com/astral-sh/ruff/pull/11414">astral-sh/ruff#11414</a>#issuecomment-2108517695. I&#x27;ll go ahead and blame it on some significant jetlag :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-21 18:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:53 UTC
    </footer>
</body>
</html>
