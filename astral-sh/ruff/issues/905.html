<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementing % formatting checks - astral-sh/ruff #905</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implementing % formatting checks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/905">#905</a>
        opened by <a href="https://github.com/olliemath">@olliemath</a>
        on 2022-11-25 16:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/olliemath">@olliemath</a> on 2022-11-25 16:09</div>
            <div class="timeline-body"><p>Now that I've implemented the <code>.format</code> checks, I feel like I should grind out the <code>%</code> format checks too. Although I won't have time for the implementation until the back half of next week.</p>
<p>The strategy would be similar: if we detect a binary operation that looks right, build a summary of the format string and use that to perform subsequent checks.</p>
<p>Most of the logic is going to be in parsing the string literal. We could port pyflakes' own implementation https://github.com/PyCQA/pyflakes/blob/main/pyflakes/checker.py#L94, which is mostly regex. Or we could try and see how rustpython is doing this.</p>
<p>I'm unsure where exactly to look in the rustpython codebase for this, I'm guessing it's either hard-coded to be called when processing the binop within the interpreter, or in the definition of the string type itself. Need to do a bit of research to see if it's accessible, or tied up with python internals.</p>
<p>Does that seem like a good plan? Any ideas on tracking down the parsing logic in rustpython?</p>
<p>Like I say, I probably won't be able to get around to this for a week or so, so if anybody else would like to pick it up in the meantime, don't let me stop you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/olliemath">@olliemath</a> on 2022-11-25 16:46</div>
            <div class="timeline-body"><p>I think I've tracked down the place to start tugging at the RustPython codebase: https://github.com/RustPython/RustPython/blob/4331d652853a8618bc634b2f7f96878640f463a3/vm/src/anystr.rs#L438 it leads us to <code>CFormatString</code> in <code>vm/src/cformat.rs</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2022-11-25 22:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/919.html">astral-sh/ruff#919</a> on 2022-11-27 02:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-28 02:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:48 UTC
    </footer>
</body>
</html>
