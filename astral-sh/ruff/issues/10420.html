<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AST-based diff - astral-sh/ruff #10420</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>AST-based diff</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10420">#10420</a>
        opened by <a href="https://github.com/ashrub-holvi">@ashrub-holvi</a>
        on 2024-03-15 13:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ashrub-holvi">@ashrub-holvi</a> on 2024-03-15 13:19</div>
            <div class="timeline-body"><p>Just to collection of ideas. In many cases after big automatic style changes (from ruff or other tools), diff is so big that it's really hard to review. In a simple search&amp;replace cases it's possible to simplify review by <code>grep</code>ping (of course better to do <a href="https://github.com/BurntSushi/ripgrep">ripgrepp</a>ing) diff with <code>--word-diff=porcelain</code>, but in more complex cases would be good to have tool for diffing not just source code, but something like AST for see only real changes.
I googled a bit and from alive projects I see only <a href="https://github.com/Wilfred/difftastic">difftastic</a> (also in Rust!), but looks like it's not what I expected because even changing single quote to double <code>difftastic</code> shows as a change.
But it's not a real code change, ideally, even converting <code>.format</code> to f-string is not a change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-03-15 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-18 09:52</div>
            <div class="timeline-body"><p>Thanks for the suggestion.</p>
<p>To clarify my understanding. What you're asking for is a diff mode that only show changes that result in a different Python runtime AST. That means, it would hide changes in quotes, single string literals and implicit concatenated string literals (<code>&quot;ab&quot;</code> is the same as <code>&quot;a&quot; &quot;b&quot;</code>) etc.</p>
<p>This is different from difftastic that generates a syntax directed diff (it doesn't diff word boundaries but uses the boundaries of the syntax)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ashrub-holvi">@ashrub-holvi</a> on 2024-03-18 09:57</div>
            <div class="timeline-body"><blockquote>
<p>That means, it would hide changes in quotes, single string literals and implicit concatenated string literals (<code>&quot;ab&quot;</code> is the same as <code>&quot;a&quot; &quot;b&quot;</code>) etc.</p>
</blockquote>
<p>Yes, the goal is to see only changes which produces different behaviour, it's a shame, but I have never looked to Python AST, so, don't know how &quot;smart&quot; such diff can be, but even what you mentioned is already useful for some cases.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
