<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP007: autofix does not work for some examples - astral-sh/ruff #4843</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>UP007: autofix does not work for some examples</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/4843">#4843</a>
        opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a>
        on 2023-06-03 22:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-06-03 22:15</div>
            <div class="timeline-body"><p>Example:</p>
<pre><code class="language-python">from typing import Any, Dict, Optional, Type, Union


# 1
DataType = Optional[Dict[str, Any]]


# 2
class StatusedModel:
    ACTIVE: str = 'active'
    BLOCKED: str = 'blocked'
    DELETED: str = 'deleted'


StatusType = Union[StatusedModel.ACTIVE, StatusedModel.BLOCKED, StatusedModel.DELETED]


# 3
BALANCE_ZERO = 'zero'
BALANCE_LOW = 'low'
ModeType = Union[BALANCE_LOW, BALANCE_ZERO]


# 4
Numeric = Union[int, float, str]


# 5
IdType = Union[int, Type[int]]
</code></pre>
<p>Run output:</p>
<pre><code class="language-shell">$ ruff --fix --select UP007 ruff_errors/UP007.py
ruff_errors/UP007.py:5:12: UP007 Use `X | Y` for type annotations
ruff_errors/UP007.py:15:14: UP007 Use `X | Y` for type annotations
ruff_errors/UP007.py:21:12: UP007 Use `X | Y` for type annotations
ruff_errors/UP007.py:25:11: UP007 Use `X | Y` for type annotations
ruff_errors/UP007.py:29:10: UP007 Use `X | Y` for type annotations
Found 5 errors.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-03 23:07</div>
            <div class="timeline-body"><p>These are intentional, right now we don't autofix UP007 errors that are used outside of annotations (e.g., on the right-hand side of an assignment). (<code>pyupgrade</code> doesn't either.)</p>
<p>Its caused some subtle bugs in the past: https://github.com/charliermarsh/ruff/issues/3215, https://github.com/charliermarsh/ruff/issues/2981. It was also discussed here: https://github.com/charliermarsh/ruff/issues/4108.</p>
<p>It's possible that it's actually fine to fix these, with the exception that we can't rewrite <code>Union[new_types]</code> to <code>new_types</code>. I'm not certain.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-03 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-06-03 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4831.html">astral-sh/ruff#4831</a> on 2023-06-05 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-07-10 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-10 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TheAlgorithms/Python/pulls/8868.html">TheAlgorithms/Python#8868</a> on 2023-07-29 12:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8698.html">astral-sh/ruff#8698</a> on 2023-11-15 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tefra/xsdata/issues/894.html">tefra/xsdata#894</a> on 2023-12-26 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-02-26 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @AlexWaygood by @AlexWaygood on 2024-03-01 16:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Hnasar">@Hnasar</a> on 2024-04-12 12:12</div>
            <div class="timeline-body"><p>It would be very helpful to autofix the PEP604 <code>|</code> unions, but have it gated behind an unsafe fix.
I'm using <code>--add-noqa</code> as a workaround for now.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
