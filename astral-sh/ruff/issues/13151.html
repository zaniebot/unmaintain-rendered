<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff check --fix ` failed to fix the E402 error. - astral-sh/ruff #13151</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff check --fix </code> failed to fix the E402 error.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13151">#13151</a>
        opened by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a>
        on 2024-08-29 13:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hongyi-zhao">@hongyi-zhao</a></div>
            <div class="timeline-body">

<p>See below:</p>
<pre><code>$ ruff --version
ruff 0.6.2

$ jupyter nbconvert --to python Untitled2.ipynb  
$ ruff check --fix --isolated Untitled2.py
Untitled2.py:75:1: E402 Module level import not at top of file
   |
73 | # In[1]:
74 | 
75 | from mp_api.client import MPRester
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
76 | 
77 | with MPRester() as mpr:
   |

Untitled2.py:87:1: E402 Module level import not at top of file
   |
85 | # In[3]:
86 | 
87 | from mp_api.client import MPRester
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
88 | from pymatgen.io.cif import CifWriter
89 | from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
   |

Untitled2.py:88:1: E402 Module level import not at top of file
   |
87 | from mp_api.client import MPRester
88 | from pymatgen.io.cif import CifWriter
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
89 | from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
   |

Untitled2.py:89:1: E402 Module level import not at top of file
   |
87 | from mp_api.client import MPRester
88 | from pymatgen.io.cif import CifWriter
89 | from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
90 | 
91 | # 使用你的API密钥初始化MPRester
   |

Found 4 errors.
</code></pre>
<p>On the other hand, the following command will fix these problems:</p>
<pre><code>$ autopep8 --in-place --aggressive --aggressive Untitled2.py
</code></pre>
<p>Below are all the mentioned files here.</p>
<p><a href="https://github.com/user-attachments/files/16799555/Untitled2.zip">Untitled2.zip</a></p>
<p>Regards,
Zhao</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-08-30 02:22</div>
            <div class="timeline-body"><p>In general, import statements can have side effects, so a safe autofix is not possible.</p>
<p>Support for an unsafe fix is tracked here:
<a href="https://github.com/astral-sh/ruff/issues/6514">astral-sh/ruff#6514</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a> on 2024-08-30 02:37</div>
            <div class="timeline-body"><p>But even I use the <code>--unsafe-fixes</code>, it still doesn&#x27;t work:</p>
<pre><code>(datasci) werner@x13dai-t:~/Desktop/mp_workflow$ ruff check --fix --unsafe-fixes Untitled2.py 
Untitled2.py:75:1: E402 Module level import not at top of file
   |
73 | # In[1]:
74 | 
75 | from mp_api.client import MPRester
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
76 | 
77 | with MPRester() as mpr:
   |

Untitled2.py:87:1: E402 Module level import not at top of file
   |
85 | # In[3]:
86 | 
87 | from mp_api.client import MPRester
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
88 | from pymatgen.io.cif import CifWriter
89 | from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
   |

Untitled2.py:88:1: E402 Module level import not at top of file
   |
87 | from mp_api.client import MPRester
88 | from pymatgen.io.cif import CifWriter
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
89 | from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
   |

Untitled2.py:89:1: E402 Module level import not at top of file
   |
87 | from mp_api.client import MPRester
88 | from pymatgen.io.cif import CifWriter
89 | from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
90 | 
91 | # 使用你的API密钥初始化MPRester
   |

Found 4 errors.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-08-30 02:50</div>
            <div class="timeline-body"><p>ruff doesn&#x27;t currently have an unsafe fix implemented for this rule.</p>
<p>Discussion about adding one is here:
<a href="https://github.com/astral-sh/ruff/issues/6514">astral-sh/ruff#6514</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a> on 2024-08-30 03:27</div>
            <div class="timeline-body"><p>Thank you for your comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a> on 2024-08-30 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a> on 2024-08-30 03:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a> on 2024-08-30 03:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/hongyi-zhao">@hongyi-zhao</a> on 2024-08-30 03:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:57 UTC
    </footer>
</body>
</html>
