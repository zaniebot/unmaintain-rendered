<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff complains about a too long line which black does not format - astral-sh/ruff #5385</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Ruff complains about a too long line which black does not format</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/5385">#5385</a>
        opened by <a href="https://github.com/nbro10">@nbro10</a>
        on 2023-06-27 10:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nbro10">@nbro10</a> on 2023-06-27 10:26</div>
            <div class="timeline-body"><p>Ruff complains about this (in file <code>issue.py</code>), although black doesn't change this code</p>
<pre><code>
class A:
    def my_func(self, constants):
        headers = {
            constants.HEADERS.CONTENT_TYPE.value: constants.CONTENT_TYPE.URL_ENCODED.value
        }

</code></pre>
<p>The line is ofc <code>            constants.HEADERS.CONTENT_TYPE.value: constants.CONTENT_TYPE.URL_ENCODED.value</code>, which has 90 chars</p>
<p>Ruff version: 0.0.275
Invoked command: <code>ruff check issue.py</code>
No configuration added to pyproject.toml for either ruff or black (so both should assume a max line-length of 88)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-27 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-27 15:15</div>
            <div class="timeline-body"><p>Ah yeah, this is by-design and consistent with Flake8 and other linters. In general, the line-length check is just looking at the length of the physical line, and not whether a formatter has the ability to truncate it. If you want to rely on Black to enforce line length, you might consider disabling E501 altogether.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-27 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nbro10">@nbro10</a> on 2023-06-27 15:27</div>
            <div class="timeline-body"><p>Thanks. But disabling  E501 globally doesn't seem to be a good idea but locally may be an option. I was asking this question mostly because I've read somewhere that ruff is supposed to be compatible with black. That apparently doesn't mean that, if you run black and then ruff, you get no errors like this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-27 15:29</div>
            <div class="timeline-body"><p>It's compatible with Black in that it won't make any changes that conflict with Black, and there aren't any rules that will be triggered by way of running Black on your codebase. (This isn't true of Flake8 or Pycodestyle, which have rules that disagree with Black's formatting.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nbro10">@nbro10</a> on 2023-06-27 15:31</div>
            <div class="timeline-body"><p>Well, ruff has a rule that will be triggered after running black. This is exactly what I'm reporting in this issue. Some rule in ruff is incompatible with how black runs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-27 15:47</div>
            <div class="timeline-body"><p>I think we're using different definitions of compatibility. Let me provide you with a different example. If you use <code>isort</code> out of the box, it's incompatible with Black. If you run Black, then isort, then Black, then isort, they will continue to disagree infinitely, and change the code back and forth to fit their divergent rules.</p>
<p>On the other hand, running Black and Ruff is intended to be a stable operation: if you run Ruff, then Black, you shouldn't expect Ruff to flag any new rules after running Black. This doesn't mean that Ruff won't flag <em>any</em> violations after running Black. But running Black won't <em>introduce</em> any new violations.</p>
<p>As an aside, you can fix the line-length violation, like:</p>
<pre><code class="language-py">class A:
    def my_func(self, constants):
        headers = {
            constants.HEADERS.CONTENT_TYPE.value: (
                constants.CONTENT_TYPE.URL_ENCODED.value
            )
        }
</code></pre>
<p>And Ruff will respect it, and Black won't undo it.</p>
<p>But, we may just be on the same page, and you may just disagree in some sense, which is fine too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nbro10">@nbro10</a> on 2023-06-27 16:01</div>
            <div class="timeline-body"><p>If you're saying that Ruff will not report anything after running black, provided that we first fix all issues reported by ruff before running black itself, this may not be true, because our fix may be undone by black?</p>
<p>You're saying that running black won't introduce new violations, but it might introduce violations.</p>
<p>Anyway, this specific case is not a big problem for me personally, but I just don't get in which way we can really say that ruff is really compatible with black if it's not happy with something that black does or not</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-27 16:23</div>
            <div class="timeline-body"><p>Can I ask a slightly different question here: what is your ideal behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nbro10">@nbro10</a> on 2023-06-27 16:36</div>
            <div class="timeline-body"><p>Ideally, if one wants to follow the black conventions, he/she probably doesn't want ruff to report anything black does or doesn't do. In other words, <code>ruff</code> should not report issues because of black (after you run black) and I'd like to avoid to change the style, after I run black, in order to make <code>ruff</code> happy. But maybe I don't have the full picture and this may also not be ideal. Maybe this is more a black issue, because black should format that line, if the max length is supposed to be 88</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimaqq">@dimaqq</a> on 2023-06-29 12:31</div>
            <div class="timeline-body"><blockquote>
<p>Ah yeah, this is by-design and consistent with Flake8 and other linters. In general, the line-length check is just looking at the length of the physical line, and not whether a formatter has the ability to truncate it. If you want to rely on Black to enforce line length, you might consider disabling E501 altogether.</p>
</blockquote>
<p>Sorry to chime in, as a non-user of <code>ruff</code>, rather someone who is trying it out, it seems like the tool is taking on too much... I'd be very happy to leave formatting to <code>black</code> entirely and have this tool focus on all the other fluff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimaqq">@dimaqq</a> on 2023-06-29 12:36</div>
            <div class="timeline-body"><p>Here's another example:</p>
<pre><code class="language-py">async def frob(foo):                                                                                                                                    
    match foo.bar:                                                                        
        case 42:    
            try:            
                httpx.do.something()                                                    
            except httpx.HTTPStatusError as e:                                          
                logging.exception(                                                      
                    f&quot;Error response {e.response.status_code!r} while requesting {e.request.url!r}&quot;
                )                      
</code></pre>
<p>This kind of line could only be split using C-style string literal concatenation:</p>
<pre><code>                logging.exception(                                                      
                    &quot;Error response &quot;
                    f&quot;{e.response.status_code!r} while requesting {e.request.url!r}&quot;
                )  
</code></pre>
<p>This has been discussed at <code>black</code> a while back and ultimately a sensible decision was taken not to split user literals.</p>
<p>Which leaves long literals a valid exception to the line length rule.</p>
<p>I think long type annotations and complex inline dicts are the same.</p>
<p>Please consider re-opening this ticket.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-29 12:37</div>
            <div class="timeline-body"><p>We enable only a very few stylistic rules by default. You’re welcome to turn off the line-length rule if you find it unhelpful! Though note that Black alone does not solve line lengths — you can still have overlong comments, strings, lines that Black doesn’t know how to split, and so on. I think it’s very reasonable to have a linter that checks for overlong lines (<em>not</em> supporting a line length check would strike me as unusual, Flake8 has one too, etc.), but again, you’re welcome to turn it off.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-29 12:38</div>
            <div class="timeline-body"><p>What I don’t quite follow is: if you want Black to be the determiner of what’s a valid line length, why enable E501 at all?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-29 12:38</div>
            <div class="timeline-body"><p>(To be clear, we don’t attempt to autofix or modify line lengths at all.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nbro10">@nbro10</a> on 2023-06-29 12:41</div>
            <div class="timeline-body"><p>Like I said in the comment above, maybe this is a black problem, but also a ruff's documentation problem, in my view. It's a black problem because I expect black to format the code so that no line has more than the specified length. It's a ruff's docs problem because ruff is not really compatible with what black does (otherwise it wouldn't report something that black didn't do). But this is not a big issue because this is more an exception than the rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimaqq">@dimaqq</a> on 2023-06-29 12:45</div>
            <div class="timeline-body"><p>I'd like to have good tools work together out of the box.</p>
<p>In fact, I've removed <code>flake8</code> from a few repos merely because the tool required custom config to be compatible with <code>black</code>.</p>
<p>It is true, too, that another, more pedantic developer brought <code>flake8</code> with the correct set of disabled E's and W's, so not all is lost.</p>
<p>My humble 2c: a young, lesser known project must be compatible from get go to gain traction.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-06-29 16:27</div>
            <div class="timeline-body"><p>@nbro10 I think this is clearly documented at https://beta.ruff.rs/docs/faq/#is-ruff-compatible-with-black — is there somewhere else you think this information should be highlighted?</p>
<p>Black cannot safely automatically split some long lines. In these cases, it is valuable to many users to have a linter highlight the line length violation so it can be split manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5443.html">astral-sh/ruff#5443</a> on 2023-06-29 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eli-schwartz">@eli-schwartz</a> on 2023-06-30 00:15</div>
            <div class="timeline-body"><blockquote>
<p>If you're saying that Ruff will not report anything after running black, provided that we first fix all issues reported by ruff before running black itself, this may not be true, because our fix may be undone by black?</p>
</blockquote>
<p>Are you saying that running <code>black</code> caused two shorter lines to be merged into one longer (90 characters) line?</p>
<p>i.e.:</p>
<ul>
<li>run <code>ruff</code>: everything is good, lines are all short enough</li>
<li>run <code>black</code>: lines become longer</li>
<li>run <code>ruff</code>: errors now occur</li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
