<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`FURB140` (reimplemented-starmap) suggests `itertools.starmap` when one should actually use `map` - astral-sh/ruff #14835</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>FURB140</code> (reimplemented-starmap) suggests <code>itertools.starmap</code> when one should actually use <code>map</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14835">#14835</a>
        opened by <a href="https://github.com/tdulcet">@tdulcet</a>
        on 2024-12-08 13:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tdulcet">@tdulcet</a> on 2024-12-08 13:25</div>
            <div class="timeline-body"><p>The official <a href="https://docs.python.org/3/library/itertools.html#itertools.starmap">Python documentation</a> for <code>itertools.starmap</code> says:</p>
<blockquote>
<p>Used instead of <a href="https://docs.python.org/3/library/functions.html#map">map()</a> when argument parameters have already been “pre-zipped” into tuples.</p>
</blockquote>
<p>The example in the <a href="https://docs.astral.sh/ruff/rules/reimplemented-starmap/">Ruff documentation</a> for <code>FURB140</code> suggests this fix:</p>
<pre><code class="language-diff">-passed_all_tests = all(
-    passed_test(score, passing_score)
-    for score, passing_score in zip(scores, passing_scores)
-)
+passed_all_tests = all(starmap(passed_test, zip(scores, passing_scores)))
</code></pre>
<p>However, as you can see, the parameters were not “pre-zipped”, but instead were manually zipped by explicitly calling the <code>zip</code> function, so <code>starmap</code> should not have been used. One should actually use regular <code>map()</code> instead, which is simpler and more performant:</p>
<pre><code class="language-diff">-passed_all_tests = all(starmap(passed_test, zip(scores, passing_scores)))
+passed_all_tests = all(map(passed_test, scores, passing_scores))
</code></pre>
<p>I would suggest changing the rule to not trigger when <code>zip()</code> is used and then using one of the examples from #7771 in the documentation instead.</p>
<p>In #14636, among other rules, I proposed adding new lint rule(s) to catch unnecessary comprehensions. Here are some additional examples for <code>map()</code> specifically:</p>
<pre><code class="language-py">(func(a) for a in x)                       # ⇒ map(func, x)
(func(*a) for a in zip(x, y))              # ⇒ map(func, x, y)
(func(a, b) for a, b in zip(x, y))         # ⇒ map(func, x, y)
(func(a, b, c) for a, b, c in zip(x, y, z))# ⇒ map(func, x, y, z)
itertools.starmap(func, zip(*x))           # ⇒ map(func, *x)
itertools.starmap(func, zip(x, y))         # ⇒ map(func, x, y)
itertools.starmap(func, zip(x, y, z))      # ⇒ map(func, x, y, z)
</code></pre>
<p>CC: @dosisod (<a href="https://github.com/dosisod/refurb/blob/master/docs/checks.md#furb140-use-starmap">refurb documentation</a> uses the same example)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-16 08:16</div>
            <div class="timeline-body"><p>Thanks for reporting this. Here some notes for myself:</p>
<p>Suggesting <code>starmap</code> when the input is already <code>zip</code>ed with <code>zip</code> isn't incorrect, it's just unnecessary because one can pass multiple iterables to <code>map</code></p>
<pre><code>&gt;&gt;&gt; l1 = [1, 2, 3, 4]
&gt;&gt;&gt; def f(a, b): print(a, b)
...
&gt;&gt;&gt; import itertools
&gt;&gt;&gt; list(itertools.starmap(f, zip(l1, l1)))
1 1
2 2
3 3
4 4
[None, None, None, None]
&gt;&gt;&gt; list(map(f, zip(l1, l1)))
Traceback (most recent call last):
  File &quot;&lt;python-input-6&gt;&quot;, line 1, in &lt;module&gt;
    list(map(f, zip(l1, l1)))
    ~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: f() missing 1 required positional argument: 'b'
&gt;&gt;&gt; list(map(f, l1, l1))
1 1
2 2
3 3
4 4
[None, None, None, None]
</code></pre>
<p>The next steps are:</p>
<ol>
<li>Update the <code>FURB140</code> documentation to use a better example (without <code>zip</code>)</li>
<li>Exclude <code>map</code> calls where the iterable is a <code>zip</code></li>
<li>TBD: A new rule that recommends using <code>map</code> over <code>starmap(func, zip)</code></li>
<li>TBD: A new rule that detects other unnecessary usages of comprehensions where it's possible to use map instead</li>
</ol>
<p>I suggest we start with 1 and 2, and it's probably best to discuss 3 and 4 as separate issues.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2024-12-16 08:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2024-12-17 05:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2025-01-15 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-01-16 14:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:35:58 UTC
    </footer>
</body>
</html>
