<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule N806 and Django - astral-sh/ruff #7675</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule N806 and Django</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7675">#7675</a>
        opened by <a href="https://github.com/aqeelat">@aqeelat</a>
        on 2023-09-27 11:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/aqeelat">@aqeelat</a> on 2023-09-27 11:27</div>
            <div class="timeline-body"><p>In django, you can access a model by importing it or by getting it from the registry (i.e. calling apps.get_model). The convention is to name the variable in title case to match the model's name.
Example from the docs: https://docs.djangoproject.com/en/4.2/ref/applications/#django.apps.AppConfig.ready</p>
<p>However, this clashes with rule N806.</p>
<p>Is there a way to make this work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aqeelat">@aqeelat</a> on 2023-09-27 11:32</div>
            <div class="timeline-body"><p>I think this could a setting for N806 that allows<code>(\w*) = .*\.get_model\(.*,&quot;(\w*)&quot;\)</code> if $1 and $2 match.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-29 01:26</div>
            <div class="timeline-body"><p>I'm open to supporting this, although I think it should just be enabled and not behind a setting. I think we need to support both <code>apps.get_model(&quot;core&quot;, &quot;Activation&quot;)</code> and (e.g.) the <code>MyModel = self.get_model(&quot;MyModel&quot;)</code> form.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-09-29 01:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @charliermarsh on 2023-09-29 01:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/93578237">@93578237</a> on 2023-10-04 15:51</div>
            <div class="timeline-body"><p>Also <a href="https://docs.djangoproject.com/en/4.2/ref/utils/#django.utils.module_loading.import_string"><code>import_string</code></a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-11-30 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8917.html">astral-sh/ruff#8917</a> on 2023-11-30 01:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-30 01:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-12-09 03:12</div>
            <div class="timeline-body"><p>This fix is great! We had previously turned this rule off in our <code>migrations/</code> folder for exactly this reason. However, if we remove that override, we have a few cases where we need to dynamically set the model, so <code>$1</code> and <code>$2</code> don't match:</p>
<img width="633" alt="image" src="https://github.com/astral-sh/ruff/assets/5475199/6d44afbf-f86d-43a1-bb5c-de641654f131">

<img width="740" alt="image" src="https://github.com/astral-sh/ruff/assets/5475199/74c510f4-688a-4f1d-9dec-309637fe2750">

<img width="1019" alt="image" src="https://github.com/astral-sh/ruff/assets/5475199/fc056ecd-4dd1-42e0-a2ac-6dcad5863936">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-09 03:18</div>
            <div class="timeline-body"><p>I suppose we could extend this to allow any <code>apps.get_model</code>-like assignments, and not limit it to matches on the left- and right-hand side...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-12-09 03:35</div>
            <div class="timeline-body"><p>After going through and renaming our violations, I don't feel as strongly that the rule should change. Perhaps the restriction should only be relaxed when the right-hand side is a variable? I know this would still cause my third screenshot to be broken, but I think there's more value in ensuring you didn't typo your model name than there is in allowing this one-off rare case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9065.html">astral-sh/ruff#9065</a> on 2023-12-09 03:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-09 03:52</div>
            <div class="timeline-body"><p>That seems reasonable to me. I added it in: https://github.com/astral-sh/ruff/pull/9065.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
