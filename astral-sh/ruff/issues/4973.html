<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F632: assertion failure triggered by newline between &quot;is&quot; and &quot;not&quot; - astral-sh/ruff #4973</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F632: assertion failure triggered by newline between &quot;is&quot; and &quot;not&quot;</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4973">#4973</a>
        opened by <a href="https://github.com/addisoncrump">@addisoncrump</a>
        on 2023-06-09 00:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2023-06-09 00:17</div>
            <div class="timeline-body"><p>In rare situations, it is possible to have an &quot;is not&quot; statement separated by a newline. Below is a contrived example:</p>
<pre><code class="language-py">{2 is
not ''}
</code></pre>
<p>And a <a href="https://github.com/ministryofjustice/cla_public/blob/b3dd6019b694a8e2e254e4e1e6d94d3f9f3dab00/cla_public/libs/views.py#L51-L52">real example of this happening</a> (above is a minimised reproducer of this, which was an item in my corpus).</p>
<p>This causes a panic:</p>
<pre><code>$ ruff minimized-from-da9a9c1cab576dae90a1c646bef75039a4c9a80e
warning: Detected debug build without --no-cache.
warning: Linting panicked minimized-from-da9a9c1cab576dae90a1c646bef75039a4c9a80e: This indicates a bug in `ruff`. If you could open an issue at:

https://github.com/astral-sh/ruff/issues/new?title=%5BLinter%20panic%5D

with the relevant file contents, the `pyproject.toml` settings, and the following stack trace, we'd be very appreciative!

panicked at 'assertion failed: `(left == right)`
  left: `Is`,
 right: `IsNot`', crates/ruff/src/rules/pyflakes/rules/invalid_literal_comparisons.rs:107:21
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4972.html">astral-sh/ruff#4972</a> on 2023-06-09 00:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-06-09 04:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-06-09 04:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4977.html">astral-sh/ruff#4977</a> on 2023-06-09 04:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-09 05:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2023-06-10 03:19</div>
            <div class="timeline-body"><p>Fix is incomplete for:</p>
<pre><code class="language-py">{2 is
 not ''}
</code></pre>
<p>(Standalone newline is fine, but add a space and it panics again)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-10 03:21</div>
            <div class="timeline-body"><p>This makes sense, thx.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5000.html">astral-sh/ruff#5000</a> on 2023-06-10 03:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
