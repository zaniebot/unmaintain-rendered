<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The option lines-after-imports does not work after if block - astral-sh/ruff #10014</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>The option lines-after-imports does not work after if block</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10014">#10014</a>
        opened by <a href="https://github.com/BranislavBajuzik">@BranislavBajuzik</a>
        on 2024-02-17 00:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BranislavBajuzik">@BranislavBajuzik</a> on 2024-02-17 00:02</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hello. We have recently decided to move to Ruff and while going over the diff I noticed a small inconsistency:</p>
<pre><code>&gt; ruff --version
ruff 0.2.1
</code></pre>
<p>Full Config:</p>
<pre><code class="language-toml">[lint]
select = [&quot;I&quot;]
[lint.isort]
lines-after-imports = 2
</code></pre>
<p>Code snippet:</p>
<pre><code class="language-python">from random import random
from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from random import Random
print(random)
</code></pre>
<p>Command:</p>
<pre><code class="language-shell">ruff report.py --config report.toml --fix
</code></pre>
<p>Expected output:</p>
<pre><code class="language-python">from random import random
from typing import TYPE_CHECKING


if TYPE_CHECKING:
    from random import Random


print(random)
</code></pre>
<p>Actual output:</p>
<pre><code class="language-python">from random import random
from typing import TYPE_CHECKING


if TYPE_CHECKING:
    from random import Random
print(random)
</code></pre>
<p>What would be even better than the &quot;expected&quot;, is if Ruff could treat the <code>TYPE_CHECKING</code> block as just another section and thus ignore the <code>lines-after-imports</code> and use only one line to separate the <code>TYPE_CHECKING</code> block</p>
<p>Thank you for your time and this project</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @MichaReiser on 2024-02-17 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 21:15</div>
            <div class="timeline-body"><p>Thanks for reporting this issue. I've also been surprised today that <code>isort</code> does not enforce any blank lines inside of nested blocks but that seems intentional</p>
<p>https://github.com/astral-sh/ruff/blob/727e389cac222e64c6f89ea1341f99ee54109b9d/crates/ruff_linter/src/rules/isort/block.rs#L71-L74</p>
<p>@charliermarsh do you know what the motivation is behind this?</p>
<p>You can either use our formatter or the <code>E3*</code> rules (preview) if you want to enforce blank lines at the top level.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BranislavBajuzik">@BranislavBajuzik</a> on 2024-02-24 20:47</div>
            <div class="timeline-body"><p>I turned on all of the E3* (one-by-one) rules, but there are still no blank lines after the if block.</p>
<p>I use the ruff pre-commit hook, in the &quot;standard&quot; configuration, where I call the <code>ruff</code> hook and then the <code>ruff-format</code> hook. this still leaves 0, 1, or 2 lines after that block. I apologize for not stating this, as I only copy-pasted the hook config and was thinking of ruff as having one entry point.</p>
<p>This is not an issue, we can live with the amount of blank lines we get. This also happens only with top-level statements (mostly <code>log = ...</code>), not function/class definitions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-25 09:23</div>
            <div class="timeline-body"><p>@BranislavBajuzik sorry that was my mistake. I forgot that the <code>E3</code> rules only enforce blank lines between functions and classes but not between other statements.</p>
<p>Let's see what @charliermarsh opinion is on this</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:32:49 UTC
    </footer>
</body>
</html>
