```yaml
number: 3443
title: "Use `CI_PROJECT_DIR`-relative paths for GitLab annotations"
type: issue
state: closed
author: charliermarsh
labels:
  - bug
assignees: []
created_at: 2023-03-10T16:06:33Z
updated_at: 2023-03-13T03:03:39Z
url: https://github.com/astral-sh/ruff/issues/3443
synced_at: 2026-01-10T01:56:46Z
```

# Use `CI_PROJECT_DIR`-relative paths for GitLab annotations

---

_Issue opened by @charliermarsh on 2023-03-10 16:06_

At least for Gitlab [`path` should be relative](https://docs.gitlab.com/ee/ci/testing/code_quality.html#implement-a-custom-tool) to the `CI_PROJECT_DIR` location. With this implementation links in widgets are broken.

_Originally posted by @Agalin in https://github.com/charliermarsh/ruff/issues/1837#issuecomment-1464014758_


---

_Label `bug` added by @charliermarsh on 2023-03-10 16:06_

---

_Comment by @Agalin on 2023-03-10 16:11_

I'd say there are two options:
* Make it relative to the mentioned variable if present - but what happens if it's not defined?
* Keep paths just relative. I'm not familiar with Github's directory changing but I see no reason why toll cannot be called from a parent directory. It's already possible to use a config from subdirectory and select only subdir files for scan.

---

_Comment by @charliermarsh on 2023-03-10 16:32_

I guess my initial reaction is that we should try to make relative to `CI_PROJECT_DIR`, then fallback to cwd-relative if it's not defined.

---

_Referenced in [astral-sh/ruff#3475](../../astral-sh/ruff/pulls/3475.md) on 2023-03-13 02:55_

---

_Closed by @charliermarsh on 2023-03-13 03:03_

---
