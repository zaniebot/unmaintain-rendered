<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorting priority seems wrong? - astral-sh/ruff #15305</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Sorting priority seems wrong?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15305">#15305</a>
        opened by <a href="https://github.com/daenny">@daenny</a>
        on 2025-01-06 16:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/daenny">@daenny</a></div>
            <div class="timeline-body"><p>We prefix everything in our company. I would like to sort all company package before my current package. In <code>isort</code> that works.</p>
<p>example <code>test.py</code>:</p>
<pre><code>import sys

import third_party

import my_company_package
import my_extra_package

import my_current_package
</code></pre>
<p>I have the following configuration:</p>
<pre><code>[lint]
select = [&quot;I&quot;]

[lint.isort]
required-imports = [&quot;from __future__ import annotations&quot;]
known-first-party = [&quot;my_current_package&quot;, &quot;my_current package.*&quot;]
section-order = [&quot;future&quot;, &quot;standard-library&quot;, &quot;third-party&quot;, &quot;my-company&quot;, &quot;first-party&quot;,&quot;local-folder&quot;]

[lint.isort.sections]
my-company = [&quot;my_*&quot;]
</code></pre>
<p>running:</p>
<pre><code>ruff check test.py --fix
</code></pre>
<p>with <code>test.py</code>:</p>
<p>will result in:</p>
<pre><code>from __future__ import annotations

import sys

import third_party

import my_company_package
import my_current_package
import my_extra_package
</code></pre>
<p>Is this a bug or wrong configuration?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-06 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-06 17:47</div>
            <div class="timeline-body"><p>Hi @daenny</p>
<p>I played with this locally and the issue is that the custom <code>sections</code> take precedence over <code>known-local-folders</code> (<code>local-folders</code>) and <code>known-first-party</code>. For example, it works as expected if I change the &quot;local&quot; folder to <code>other</code> which doesn&#x27;t match the <code>sections</code> regex:</p>
<pre><code>[lint]
select = [&quot;I&quot;]

[lint.isort]
required-imports = [&quot;from __future__ import annotations&quot;]
  known-local-folder = [&quot;my_current_package&quot;, &quot;my_current package&quot;]
section-order = [&quot;future&quot;, &quot;standard-library&quot;, &quot;third-party&quot;, &quot;my-company&quot;, &quot;first-party&quot;, &quot;local-folder&quot;]

[lint.isort.sections]
my-company = [&quot;my_*&quot;]
</code></pre>
<p>Gets sorted to</p>
<pre><code>import abc
import sys

import abcd
import third_party

import my_company_package
import my_extra_package

import other
</code></pre>
<p>Now, I think you&#x27;d need a negative Glob for the <code>my-company</code> package selector, but Ruff doesn&#x27;t support negative globs. I guess your best solution for now is to make the <code>my-company</code> glob more explicit, so that it doesn&#x27;t select the local folder anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-06 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daenny">@daenny</a> on 2025-01-06 19:51</div>
            <div class="timeline-body"><p>Thanks for investigating.
I did try to change the <code>my-company</code> glob in various ways, but without negative selection (which gets ignored indeed) I would need to list all packages separately, which is cumbersome and more difficult to template.
Currently, we are using the python <code>isort</code> pre-commit, which works as expected with the corresponding configuration. I am replacing as much as I can with <code>ruff</code>.
I am not on a pc now, I will test tomorrow , if it works if I add another custom section with <code>my_current_package</code>.
But so this seems to be a bug in the resolution then.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-07 07:19</div>
            <div class="timeline-body"><p>It&#x27;s a bit hard to make an example without knowing the exact package names but working with what you provided:</p>
<pre><code>[lint.isort.sections]
my-company = [
	# Match all packages except the once starting with my_c, e.g. `my_current_package`
	&quot;my_[!c]*&quot;,
	# Add more specific patterns until all conflicts with other non-local packages are resolved
	&quot;my_c[!u]*&quot;,
	&quot;my_cu[!r]&quot;
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/daenny">@daenny</a> on 2025-01-07 07:56</div>
            <div class="timeline-body"><p>Thanks for your suggestions.
I solved it by using this now. This works for me:</p>
<pre><code>[lint]
select = [&quot;I&quot;]

[lint.isort]
required-imports = [&quot;from __future__ import annotations&quot;]
section-order = [&quot;future&quot;, &quot;standard-library&quot;, &quot;third-party&quot;, &quot;my-company&quot;, &quot;first-party&quot;, &quot;my-package&quot;, &quot;local-folder&quot;]

[lint.isort.sections]
my-package = [&quot;my_package&quot;]
my-company = [&quot;my_*&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-07 07:58</div>
            <div class="timeline-body"><p>That&#x27;s even better :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-07 07:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:15 UTC
    </footer>
</body>
</html>
