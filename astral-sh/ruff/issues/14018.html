<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF013 undocumented limitation `x: CustomClass = None` is not caught - astral-sh/ruff #14018</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF013 undocumented limitation `x: CustomClass = None` is not caught</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/14018">#14018</a>
        opened by <a href="https://github.com/jond01">@jond01</a>
        on 2024-10-31 13:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jond01">@jond01</a> on 2024-10-31 13:26</div>
            <div class="timeline-body"><p>It seems like the following should be caught or at least be added to the <a href="https://docs.astral.sh/ruff/rules/implicit-optional/#limitations">documented limitations</a>:</p>
<pre><code class="language-py">from enum import Enum
from typing import Optional


class Letter(Enum):
    &quot;&quot;&quot;ok.&quot;&quot;&quot;

    A = &quot;A&quot;


class CatchMe:
    &quot;&quot;&quot;class.&quot;&quot;&quot;


def f(
    letter: Letter = None,  # &lt;--- should be caught
    word: Optional[str] = None,
    catch: CatchMe = None,  # &lt;--- should be caught
) -&gt; None:
    &quot;&quot;&quot;Doc.&quot;&quot;&quot;
</code></pre>
<ul>
<li>List of keywords you searched for before creating this issue: RUF013</li>
<li>A minimal code snippet that reproduces the bug: https://play.ruff.rs/afaf262e-0615-4732-83aa-4cc32af930c2</li>
<li>The command you invoked: <code>ruff check file.py --select RUF013</code></li>
<li>The current Ruff settings: in the snippet.</li>
<li>The current Ruff version: 0.7.1</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mlrun/mlrun/pulls/6607.html">mlrun/mlrun#6607</a> on 2024-10-31 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2024-10-31 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-10-31 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @MichaReiser on 2024-10-31 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-31 13:40</div>
            <div class="timeline-body"><p>Thanks. I agree that this is surprising. I assume this is &quot;intentional&quot; because Ruff doesn't know to what types <code>Letter</code> resolves. E.g. <code>Letter</code> could be defined as <code>type Letter = str | None</code> in which case the assignment is valid. Not sure if there's another reason for it as well (CC: @charliermarsh )</p>
<p>Documenting this restriction is a good idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @dylwil3 on 2024-11-06 04:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-06 04:58</div>
            <div class="timeline-body"><blockquote>
<p>I assume this is &quot;intentional&quot; because Ruff doesn't know to what types <code>Letter</code> resolves. E.g. <code>Letter</code> could be defined as <code>type Letter = str | None</code> in which case the assignment is valid. Not sure if there's another reason for it as well</p>
</blockquote>
<p>Yeah, I think this is pretty much the reason. The logic considers all custom type to be similar to <code>Any</code> which is the case here.</p>
<p>For context, the fallback branch tries to resolve the name <code>Letter</code> to a qualified name which doesn't exists and thus fallback to using <code>Unknown</code> (similar to <code>Any</code>).</p>
<p>https://github.com/astral-sh/ruff/blob/4ece8e5c1e674eb0d751fa55b5a72950aa9d20f0/crates/ruff_linter/src/rules/ruff/typing.rs#L116-L119</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
