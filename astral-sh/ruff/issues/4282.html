<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC1901 false positive in `__bool__` methods - astral-sh/ruff #4282</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>PLC1901 false positive in `__bool__` methods</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4282">#4282</a>
        opened by <a href="https://github.com/trag1c">@trag1c</a>
        on 2023-05-08 13:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/trag1c">@trag1c</a> on 2023-05-08 13:18</div>
            <div class="timeline-body"><pre><code class="language-py">class X:
    val: str

    def __bool__(self) -&gt; bool:
        return self.val != &quot;&quot;
</code></pre>
<pre><code class="language-sh">$ ruff check test.py --select=PLC1901
test.py:5:28: PLC1901 `self.val != &quot;&quot;` can be simplified to `self.val` as an empty string is falsey
Found 1 error.
</code></pre>
<p>Trying to correct this to <code>self.val</code> will lead to an error:</p>
<pre><code>TypeError: __bool__ should return bool, returned str
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-05-08 14:15</div>
            <div class="timeline-body"><p>Yeah, The &quot;safe&quot; fix for this rule should probably be <code>bool(self.val)</code>. But even that is not entirely safe, because it now no longer reads <code>self.val</code>, which could have side effects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2023-05-08 16:32</div>
            <div class="timeline-body"><p>In one case I specifically need the comparison :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-08 18:07</div>
            <div class="timeline-body"><p>I dislike this rule, too many false positives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karolinepauls">@karolinepauls</a> on 2023-06-21 18:45</div>
            <div class="timeline-body"><p>This rule is fundamentally incorrect for assertions or assignments, since <code>None != &quot;&quot;</code> - unless it can infer that the variable is a string.</p>
<pre><code>a = 0

def test_sth() -&gt; None:
    assert a == &quot;&quot;
</code></pre>
<p>Command: <code>ruff --isolated --select PLC1901 a.py</code></p>
<p>Output:</p>
<pre><code>a.py:4:17: PLC1901 `a == &quot;&quot;` can be simplified to `not a` as an empty string is falsey
Found 1 error.
</code></pre>
<pre><code>$ ruff --version
ruff 0.0.274
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-21 18:48</div>
            <div class="timeline-body"><p>Yes, Pylint's implementation has the same problem:</p>
<pre><code class="language-python">‚ùØ pylint --load-plugins=pylint.extensions.emptystring foo.py
************* Module foo
foo.py:1:0: C0114: Missing module docstring (missing-module-docstring)
foo.py:1:0: C0104: Disallowed name &quot;foo&quot; (disallowed-name)
foo.py:1:0: C0103: Constant name &quot;a&quot; doesn't conform to UPPER_CASE naming style (invalid-name)
foo.py:3:0: C0116: Missing function or method docstring (missing-function-docstring)
foo.py:4:11: C1901: &quot;a == ''&quot; can be simplified to &quot;not a&quot; as an empty string is falsey (compare-to-empty-string)
</code></pre>
<p>I'm going to move this rule to the nursery so that it's explicitly opt-in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-06-21 18:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5264.html">astral-sh/ruff#5264</a> on 2023-06-21 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-21 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adifelice-godaddy">@adifelice-godaddy</a> on 2023-07-31 21:28</div>
            <div class="timeline-body"><p>Looks like the rule was renamed/revisited:
https://pylint.pycqa.org/en/latest/user_guide/messages/convention/use-implicit-booleaness-not-comparison-to-string.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bersbersbers">@bersbersbers</a> on 2023-09-10 16:09</div>
            <div class="timeline-body"><p>Here's another example where this rule creates false positives with <code>numpy</code>:</p>
<pre><code class="language-python">import numpy as np

array = np.array((&quot;X&quot;, &quot;&quot;, &quot;X&quot;), dtype=str)
indices = array == &quot;&quot;
print(indices)

print(not array)
</code></pre>
<p>At least in this case, <code>not array</code> raises a <code>ValueError</code>, so incorrect fixes become obvious (at least at runtime).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14602.html">astral-sh/ruff#14602</a> on 2024-11-26 06:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
