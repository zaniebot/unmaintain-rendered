<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff formatter still removes semicolon in Jupyter notebooks - astral-sh/ruff #19980</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Ruff formatter still removes semicolon in Jupyter notebooks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/19980">#19980</a>
        opened by <a href="https://github.com/jsh9">@jsh9</a>
        on 2025-08-18 23:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jsh9">@jsh9</a> on 2025-08-18 23:07</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Even with this fix (https://github.com/astral-sh/ruff/issues/8254), Ruff formatter still removes semicolon in Jupyter notebooks.</p>
<p>Steps to reproduce this:</p>
<ol>
<li>Install Ruff 0.12.9</li>
<li>Clone this repo: https://github.com/jsh9/pyseismosoil (at this commit: d2be10711e899593a99c33c588138aa0ad06a6f0)</li>
<li>Put this in <code>ruff.toml</code>:</li>
</ol>
<pre><code>line-length = 79

[format]
quote-style = &quot;single&quot;
docstring-code-format = true
</code></pre>
<ol start="4">
<li>Run <code>ruff format .</code></li>
<li>Check git diff</li>
</ol>
<pre><code class="language-bash">&gt;&gt;&gt; git diff examples/Demo_03_Frequency_Spectrum.ipynb
diff --git a/examples/Demo_03_Frequency_Spectrum.ipynb b/examples/Demo_03_Frequency_Spectrum.ipynb
index 2cd833f..1a6d708 100644
--- a/examples/Demo_03_Frequency_Spectrum.ipynb
+++ b/examples/Demo_03_Frequency_Spectrum.ipynb
@@ -588,7 +588,7 @@
     }
    ],
    &quot;source&quot;: [
-    &quot;smoothed, fig, ax = fs.get_smoothed(show_fig=True, log_scale=True);&quot;
+    &quot;smoothed, fig, ax = fs.get_smoothed(show_fig=True, log_scale=True)&quot;
    ]
   },
   {
</code></pre>
<p>This semicolon should not be removed. (Several other Jupyter notebooks in this repo also suffered from this bug.)</p>
<h3>Version</h3>
<p>0.9.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2025-08-19 06:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-08-19 06:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-19 14:38</div>
            <div class="timeline-body"><p>Thanks, I can reproduce this on 0.12.9 too:</p>
<pre><code class="language-shell">&gt; ruff format Untitled.ipynb --diff
--- Untitled.ipynb:cell 1
+++ Untitled.ipynb:cell 1
@@ -1 +1 @@
-import math;
+import math

1 file would be reformatted
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-19 15:16</div>
            <div class="timeline-body"><p>The PR that added this feature lists a few conditions that must be fulfilled for the formatter to preserve the semicolon:</p>
<p>The conditions required as to when the trailing semicolon should be preserved are:</p>
<ol>
<li>It should be a top-level statement which is last in the module.</li>
<li>For statement, it can be either assignment, annotated assignment, or augmented assignment.
Here, the target should only be a single identifier i.e., multiple assignments or tuple     unpacking isn't considered.</li>
<li>For expression, it can be any.</li>
</ol>
<p>https://github.com/astral-sh/ruff/pull/8590</p>
<p>@dhruvmanila might have more context on the why</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @MichaReiser on 2025-08-19 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2025-08-19 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-08-19 15:23</div>
            <div class="timeline-body"><p>Looking into this...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-08-19 15:35</div>
            <div class="timeline-body"><p>Can you specify why would you not want to remove the semicolon in that position?</p>
<p>IIRC, the main advantage of using a semicolon is to hide the output if that's not intended. The main reason that this heuristic was chosen is the <a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell.ast_node_interactivity"><code>ast_node_interactivity</code></a> config option which I played around with when I was working on this but currently I don't remember exactly why is it so.</p>
<p>Cloning the linked repository and running the mentioned notebook suggests that the semicolon is unnecessary because the chart is plotted regardless of whether the semicolon is present or not as seen in the below video:</p>
<p>https://github.com/user-attachments/assets/e6e1a5ad-725f-4b33-9d15-ad7601cba486</p>
<p>Can you provide an example where it's changing the behavior i.e., is removing the semicolon making the output visible when it wasn't when the semicolon was present?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-08-19 15:42</div>
            <div class="timeline-body"><p>I think IPython only chooses to show the output in certain conditions which, IIRC, is what I've tried to replicate here so that the semicolons are still removed in other conditions.</p>
<p>Additionally, I tried to document the conditions in the test notebook (https://github.com/astral-sh/ruff/blob/main/crates/ruff/resources/test/fixtures/trailing_semicolon.ipynb) by running the notebook with various combinations of statements / expressions with or without semicolons. You can see in what conditions the output is shown and not shown.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2025-10-02 11:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-11-17 07:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
