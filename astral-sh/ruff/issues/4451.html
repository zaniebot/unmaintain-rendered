<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF009 false positive for descriptor fields - astral-sh/ruff #4451</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>RUF009 false positive for descriptor fields</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4451">#4451</a>
        opened by <a href="https://github.com/nstarman">@nstarman</a>
        on 2023-05-16 14:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nstarman">@nstarman</a> on 2023-05-16 14:41</div>
            <div class="timeline-body"><p>Dataclasses permit descriptor fields (https://docs.python.org/3.10/library/dataclasses.html#descriptor-typed-fields) but RUF009 is complaining about function calls at class construction. This is similar to https://github.com/charliermarsh/ruff/issues/4091, but I think sufficiently different to merit its own issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-05-16 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-05-16 15:25</div>
            <div class="timeline-body"><p>You can use <a href="https://beta.ruff.rs/docs/settings#extend-immutable-calls">flake8-bugbear.extend-immutable-calls</a> to set your descriptor as immutable.
You can find this option in the rule documentation <a href="https://beta.ruff.rs/docs/rules/function-call-in-dataclass-default-argument/">function-call-in-dataclass-default-argument</a></p>
<p>The documentation could be explicit on the possibility to mark a call as immutable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 17:17</div>
            <div class="timeline-body"><p>That's almost certainly the &quot;best we can do&quot; for now, until we can reliably detect that a class is a descriptor across files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nstarman">@nstarman</a> on 2023-05-16 20:13</div>
            <div class="timeline-body"><p>Thanks @JonathanPlasse. That looks like it will work for now.</p>
<p>@charliermarsh, what about within a file? Many of my descriptor field classes are defined in the same file as the dataclass.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-05-16 20:51</div>
            <div class="timeline-body"><p>Ruff did not have the type checking necessary to do this now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 20:52</div>
            <div class="timeline-body"><p>We might be able to do it based on references though, even without type-checking. In the linked example, if the file were <code>src/foo.py</code>, we could certainly detect that references within that file to <code>IntConversionDescriptor</code> are <code>foo.IntConversionDescriptor</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-05-16 20:54</div>
            <div class="timeline-body"><p>@charliermarsh, should we add a tag for issues that could be improved with type checking ability?
It would facilitate finding what should be changed when we add the type checker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @charliermarsh on 2023-05-16 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 20:55</div>
            <div class="timeline-body"><p>Yeah, we have an existing tag -- just added it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5537.html">astral-sh/ruff#5537</a> on 2023-07-05 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-05 19:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
