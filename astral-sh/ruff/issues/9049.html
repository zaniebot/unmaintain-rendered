<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FURB152 has too many false positives - astral-sh/ruff #9049</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FURB152 has too many false positives</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/9049">#9049</a>
        opened by <a href="https://github.com/alanhdu">@alanhdu</a>
        on 2023-12-07 20:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alanhdu">@alanhdu</a> on 2023-12-07 20:56</div>
            <div class="timeline-body"><p>FURB152 tries to replace hard-coded constants with the built-in constants (e.g. <code>3.1415</code> to <code>math.pi</code>). Unfortunately -- I have found it to be too false-positive happy -- e.g. it will correct <code>3.15</code> to <code>math.pi</code>.</p>
<p>At the very least, I'd argue that this should be an <em>unsafe</em> fix if the constant does not exactly match the builtin (since we will observe some behavioral difference). But I think we should <em>also</em> increase the precision required (e.g. https://github.com/astral-sh/ruff/blob/6bbabceead840e0d232950a1ed1e8f02cdafb92c/crates/ruff_linter/src/rules/refurb/rules/math_constant.rs#L61C29-L61C29) -- I don't have a strong opinion about how precise it should be, but IMO <code>3.15</code> should not be corrected to <code>math.pi</code> (maybe do it based on the # of digits vs the rounded version?).</p>
<p>Would be happy to contribute a patch if you think this a good idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-12-07 21:04</div>
            <div class="timeline-body"><p>There was some discussion about safety at https://github.com/astral-sh/ruff/pull/8727#discussion_r1396381872 and we're a bit divided on it. I'd prefer to leave it as safe for now and instead reduce the false positives. Unsafe isn't really intended to account for false positives i.e. if the rule was always applied correctly would it be safe? It's true that it changes the precision slightly but I don't think it should effect the intent of the code. If we still get feedback that it's causing problems, we can consider changing it.</p>
<p>I agree 3.15 should definitely not change to <code>math.pi</code>. I'd welcome a pull request resolving that issue (and similar).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2023-12-07 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-12-08 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 16:26</div>
            <div class="timeline-body"><p>Gonna fix this real quick, seems bad.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9054.html">astral-sh/ruff#9054</a> on 2023-12-08 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-08 17:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
