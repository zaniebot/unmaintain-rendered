<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detect unused `# fmt: off` &amp; `# fmt: on` comments - astral-sh/ruff #17098</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Detect unused <code># fmt: off</code> &amp; <code># fmt: on</code> comments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17098">#17098</a>
        opened by <a href="https://github.com/jack-mcivor">@jack-mcivor</a>
        on 2025-03-31 17:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jack-mcivor">@jack-mcivor</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>From the format documentation https://docs.astral.sh/ruff/formatter/#format-suppression</p>
<blockquote>
<p>As such, adding # fmt: on and # fmt: off comments within expressions will have no effect. In the following example, both list entries will be formatted, despite the # fmt: off:</p>
<pre><code class="language-python">[
    # fmt: off
    '1',
    # fmt: on
    '2',
]
</code></pre>
</blockquote>
<p>Should there be a new rule to detect such cases? I think it's in the spirit of an unused noqa comment, for which there is RUF100 https://docs.astral.sh/ruff/rules/unused-noqa/.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-31 17:10</div>
            <div class="timeline-body"><p>That's an interesting idea. Not quiet sure how I'd go about implementing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-03-31 17:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2025-03-31 17:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jack-mcivor">@jack-mcivor</a> on 2025-04-01 15:12</div>
            <div class="timeline-body"><p>Ah this is implemented already in RUF028 https://docs.astral.sh/ruff/rules/invalid-formatter-suppression-comment/ https://github.com/astral-sh/ruff/pull/9899</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @jack-mcivor on 2025-04-01 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 15:14</div>
            <div class="timeline-body"><p>I think that's different in that it detects suppression comments in places where they aren't valid. It doesn't detect cases where the suppression comment is unused (because the formatted statement would be exactly the same). But glad to hear that we already support what you were looking for :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jack-mcivor">@jack-mcivor</a> on 2025-04-01 15:19</div>
            <div class="timeline-body"><p>Yeah got you. I'm migrating a large codebase from black-&gt;ruff. Actually both would be useful for me so that I could do two steps:</p>
<ul>
<li>Remove unused suppression comments (many are invalid but the code is formatted fine)</li>
<li>For all invalid suppression comments, decide what to do (either lift into the nearest statement, or remove the suppression)</li>
</ul>
<p>I guess finding unused &amp; invalid suppression comments is harder than finding unused &amp; valid suppression comments. By unused &amp; invalid I mean even if the suppression statement were valid, it would still not result in a change to the code.</p>
<p>So not a burning desire to have this, but feel free to reopen</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:52:29 UTC
    </footer>
</body>
</html>
