<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruff incorrectly flags imports included in __all__ - astral-sh/ruff #82</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ruff incorrectly flags imports included in <strong>all</strong></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/82">#82</a>
        opened by <a href="https://github.com/john-dupuy">@john-dupuy</a>
        on 2022-09-01 22:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/john-dupuy">@john-dupuy</a></div>
            <div class="timeline-body"><p><strong>Steps to reproduce</strong></p>
<ol>
<li>Create two files, <code>__init__.py</code> and <code>blah.py</code>.</li>
</ol>
<p><code>blah.py</code></p>
<pre><code class="language-python">class MyBlahClass:
    pass
</code></pre>
<p><code>__init__.py</code></p>
<pre><code class="language-python">from blah import MyBlahClass

__all__ = [&quot;MyBlahClass&quot;]
</code></pre>
<ol start="2">
<li>Run ruff</li>
</ol>
<p><strong>Expected results</strong>
2. ruff should not have an issue with the import in <code>MyBlahClass</code> as it's included in <code>__all__</code>.</p>
<p><strong>Actual results</strong>
2. ruff reports a F401, class imported but unused</p>
<p><strong>ruff output</strong>:</p>
<pre><code>ruff . -v  
[2022-09-01][15:17:28][ruff][DEBUG] Identified files to lint in: 25.778µs
[2022-09-01][15:17:28][ruff::linter][DEBUG] Cache hit for: ./blah.py
[2022-09-01][15:17:28][ruff::linter][DEBUG] Cache hit for: ./__init__.py
[2022-09-01][15:17:28][ruff][DEBUG] Checked files in: 588.674µs
Found 1 error(s).

./__init__.py:1:1: F401 `blah.MyBlahClass` imported but unused
</code></pre>
<p><strong>flake8 output</strong>:</p>
<pre><code>flake8 . -v
flake8.checker            MainProcess     53 INFO     Making checkers
flake8.checker            MainProcess     54 INFO     Checking 2 files
flake8.main.application   MainProcess     71 INFO     Finished running
flake8.main.application   MainProcess     71 INFO     Reporting errors
flake8.main.application   MainProcess     71 INFO     Found a total of 0 violations and reported 0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/john-dupuy">@john-dupuy</a> on 2022-09-01 22:23</div>
            <div class="timeline-body"><p>https://github.com/charliermarsh/ruff/pull/34 potentially related?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-09-02 00:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-09-02 00:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-02 00:20</div>
            <div class="timeline-body"><p>Thanks, that's a legitimate bug, will fix :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @charliermarsh on 2022-09-02 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-09-02 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-02 14:17</div>
            <div class="timeline-body"><p>Fixed in #87.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-02 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/john-dupuy">@john-dupuy</a> on 2022-09-06 14:02</div>
            <div class="timeline-body"><p>Thanks for the quick fix @charliermarsh! :slightly_smiling_face:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2022-12-05 15:46</div>
            <div class="timeline-body"><p>@charliermarsh I found a slight wrinkle in this fix, doesn't quite work with importing a module.</p>
<p>Consider:</p>
<pre><code class="language-python">foo/
    __init__.py
bar/
    __init__.py
</code></pre>
<p>Then in foo/<strong>init</strong>.py:</p>
<pre><code class="language-python">import bar

__all__ = [&quot;bar&quot;]
</code></pre>
<p>Ruff detects as an unused import. But if I give it an explicit name:</p>
<pre><code class="language-python">import bar as bar

__all__ = [&quot;bar&quot;]
</code></pre>
<p>Ruff reports no issues. Shouldn't both be detected as no issues?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-05 15:50</div>
            <div class="timeline-body"><p>Yeah looks like that first case is a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-05 15:51</div>
            <div class="timeline-body"><p>(The explicit re-export (<code>import bar as bar</code>) is always protected.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:16 UTC
    </footer>
</body>
</html>
