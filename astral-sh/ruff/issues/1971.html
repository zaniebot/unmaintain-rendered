<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E501 not triggered in context managers - astral-sh/ruff #1971</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>E501 not triggered in context managers</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/1971">#1971</a>
        opened by <a href="https://github.com/zevisert">@zevisert</a>
        on 2023-01-18 19:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zevisert">@zevisert</a> on 2023-01-18 19:29</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

- A minimal code snippet that reproduces the bug.
- The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
- The current Ruff settings (any relevant sections from your `pyproject.toml`).
- The current Ruff version (`ruff --version`).
-->

<p>Example code:</p>
<pre><code class="language-py"># ruff-example.py

with open(
    file=&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
):
    pass

file = &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;

</code></pre>
<p>Command:</p>
<pre><code class="language-console">&gt; ruff --isolated ruff-example.py
ruff-example.py:8:89: E501 Line too long (180 &gt; 88 characters)
Found 1 error(s).
</code></pre>
<p>Expected:</p>
<ul>
<li>Two E501 errors: One on line 4 and as well as the reported one on line 8.</li>
</ul>
<p>Version:</p>
<pre><code class="language-console">&gt; ruff -V                               
ruff 0.0.224
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 19:33</div>
            <div class="timeline-body"><p>I think we're probably allowing that right now because it looks like &quot;one long token&quot;, since there's no space delimiting it within the line.</p>
<p>It's similar to how we allow:</p>
<pre><code class="language-py">&quot;&quot;&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;&quot;&quot;
</code></pre>
<p>Since there's no reasonable way for the user to break up the string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 19:34</div>
            <div class="timeline-body"><p>Probably hard to fix right now because that check isn't AST- or token-aware.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-01-18 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zevisert">@zevisert</a> on 2023-01-18 20:16</div>
            <div class="timeline-body"><p>Ah - I think you're correct on that.</p>
<p>The actual example I ran into looked more like this:</p>
<pre><code class="language-py"># ruff-example.py
import os

from httpx import Client

API_V4_URL = os.environ[&quot;API_V4_URL&quot;]
PROJECT_ID = os.environ[&quot;PROJECT_ID&quot;]
LOCATION_IID = os.environ[&quot;LOCATION_IID&quot;]
RESOURCE_IID = os.environ[&quot;RESOURCE_IID&quot;]
API_TOKEN = os.environ[&quot;API_TOKEN&quot;]

with Client(
    base_url=f&quot;{API_V4_URL}/projects/{PROJECT_ID}/locations/{LOCATION_IID}/resources/{RESOURCE_IID}/updates&quot;,
    headers={&quot;Authorization&quot;: f&quot;Bearer {API_TOKEN}&quot;},
) as client:
    pass
</code></pre>
<p>The f-string must act as a single token. If I refactor to use a join instead, I'll start seeing F501 again.</p>
<pre><code class="language-py">with Client(
    base_url=&quot;/&quot;.join([API_V4_URL, &quot;projects&quot;, PROJECT_ID, &quot;locations&quot;, LOCATION_IID, &quot;resources&quot;, RESOURCE_IID, &quot;updates&quot;]),
    headers={&quot;Authorization&quot;: f&quot;Bearer {API_TOKEN}&quot;},                                 # ^ ruff-example.py:18:89: E501 Line too long (98 &gt; 88 characters)
) as client:
    pass
</code></pre>
<p>Feel free to close this, I think this behaviour is fine as is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 21:25</div>
            <div class="timeline-body"><p>Ahh ok -- thank you for following up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-18 21:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
