<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[flake8-type-checking] Add include-modules option (Feature Request) - astral-sh/ruff #13428</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[flake8-type-checking] Add include-modules option (Feature Request)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13428">#13428</a>
        opened by <a href="https://github.com/gregbrowndev">@gregbrowndev</a>
        on 2024-09-20 19:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gregbrowndev">@gregbrowndev</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hi, thank you for the work on ruff and lint/auto-fix rules!</p>
<p>I've added the flake8-type-checking (TCH) rules to my codebase to automatically move type-only imports to an <code>if TYPE_CHECKING</code> block. Super helpful to build lean, production images without superfluous type-shed libraries.</p>
<p>Ruff allows me to disable the <code>TCH001</code> and <code>TCH003</code> rules to ignore first-party and standard library type-only imports. However, the <code>TCH002</code> rule treats all third-party typing-only imports the same. Since some third-party libraries ship with type annotations, these are available in the production build. These types could be imported directly and avoid the additional stringified, forward references throughout the code.</p>
<p>I feel this would be a smaller migration step for teams to introduce, easing the experience for people less familiar with type hints (since IMO the quotes do add some additional visual clutter).</p>
<p>I've used the <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-type-checking_exempt-modules">exempt-modules</a> option to exclude common third-party libraries so they can be imported directly, but it would be simpler to specify specifically which third-party libraries to fix, i.e., the type shed ones.</p>
<p>Thanks a lot</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-23 09:07</div>
            <div class="timeline-body"><p>Thanks for the kind words.</p>
<p>I'm not sure if I fully understand what you're asking for.</p>
<blockquote>
<p>avoid the additional stringified, forward references throughout the code.</p>
</blockquote>
<p>From reading <a href="https://docs.astral.sh/ruff/rules/typing-only-third-party-import/"><code>TCH002</code>'s documentation</a>, I understand that the rule doesn't stringify type annotations. It only does so for a few or when <code>[lint.flake8-type-checking.quote-annotations](https://docs.astral.sh/ruff/settings/#lint_flake8-type-checking_quote-annotations)</code> is enabled. Could you share an example with your configuration where the type annotations get stringified?</p>
<blockquote>
<p>I've used the <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-type-checking_exempt-modules">exempt-modules</a> option to exclude common third-party libraries so they can be imported directly, but it would be simpler to specify specifically which third-party libraries to fix, i.e., the type shed ones.</p>
</blockquote>
<p>I prefer <code>excempt-modules</code>. Yes, it's more annoying to set up initially because it requires listing all modules, but it prevents a new module from accidentally &quot;slipping&quot; through. Maybe you don't want to exclude that new module because you decide to use deferred type annotations for all imports from that new module, there's no existing code after all.</p>
<p>The other reason I prefer <code>excempt-modules</code> is because the main motivation of <code>TCH002</code> is to reduce the runtime overhead of importing typing only modules at runtime. Only including few modules defeats the purpose of the rule, IMO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-09-23 09:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-09-23 09:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:07 UTC
    </footer>
</body>
</html>
