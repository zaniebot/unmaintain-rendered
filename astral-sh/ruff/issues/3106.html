<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suggested fix columns in JSON output may be off by 1 - astral-sh/ruff #3106</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Suggested fix columns in JSON output may be off by 1</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/3106">#3106</a>
        opened by <a href="https://github.com/tasgon">@tasgon</a>
        on 2023-02-21 23:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tasgon">@tasgon</a> on 2023-02-21 23:01</div>
            <div class="timeline-body"><p>Consider the following file:</p>
<pre><code class="language-py">import sys, json # comment
sys.exit(42)
</code></pre>
<p>Running <code>ruff check --output json --select F401</code> on that yields:</p>
<pre><code>[
  {
    &quot;code&quot;: &quot;F401&quot;,
    &quot;message&quot;: &quot;`json` imported but unused&quot;,
    &quot;fix&quot;: {
      &quot;content&quot;: &quot;import sys&quot;,
      &quot;message&quot;: &quot;Remove unused import: `json`&quot;,
      &quot;location&quot;: {
        &quot;row&quot;: 1,
        &quot;column&quot;: 0
      },
      &quot;end_location&quot;: {
        &quot;row&quot;: 1,
        &quot;column&quot;: 16
      }
    },
    &quot;location&quot;: {
      &quot;row&quot;: 1,
      &quot;column&quot;: 13
    },
    &quot;end_location&quot;: {
      &quot;row&quot;: 1,
      &quot;column&quot;: 17
    },
    &quot;filename&quot;: &quot;test.py&quot;
  }
]
</code></pre>
<p>Is this intended, or should the column fields in the <code>fix</code> object be 1 and 17, respectively?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-21 23:18</div>
            <div class="timeline-body"><p>Yeah this is bad but &quot;known&quot; (and existing clients, like the LSP, rely on it). It happened unintentionally. RustPython returns locations with a one-indexed row and a zero-indexed column. When we create those top-level locations, we modify the column to be one-indexed, which is more natural when reporting. However, we forgot to do the same for the fix locations (which don't appear in the standard output, so it was an oversight).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-21 23:19</div>
            <div class="timeline-body"><p>You're welcome to rely on these semantics as other clients already do so. Perhaps I'll fix this as a breaking change when we go to 1.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @charliermarsh on 2023-02-21 23:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youknowone">@youknowone</a> on 2023-04-20 15:11</div>
            <div class="timeline-body"><p>Is this a bug of Location or only related to spec of json output?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-21 02:03</div>
            <div class="timeline-body"><p>@youknowone - It's a bug on our end -- we're just not consistent about using zero- or one-based indexing for these, but @MichaReiser has a fix for it on our side.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-10 21:56</div>
            <div class="timeline-body"><p>I believe this was fixed by #4007.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-10 21:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
