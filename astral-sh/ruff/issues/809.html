<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Feature Request / Proposal] Upstream / preset / profile to preconfigure options - astral-sh/ruff #809</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Feature Request / Proposal] Upstream / preset / profile to preconfigure options</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/809">#809</a>
        opened by <a href="https://github.com/pwoolvett">@pwoolvett</a>
        on 2022-11-18 18:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pwoolvett">@pwoolvett</a></div>
            <div class="timeline-body"><p>Would something like preset or a profile be a feature you'd like to see?</p>
<p>for example:</p>
<pre><code class="language-toml">[tool.ruff]
preset = &quot;charliemarsh&quot;
</code></pre>
<p>alternatively</p>
<pre><code class="language-toml">[tool.ruff]
upstream = &quot;https://.../ruff-profile.toml&quot;
</code></pre>
<p>The idea would be to (1) add a new parameter <a href="">in the cli</a> and <a href="">in the config</a> , and (2) override defaults eg <a href="https://github.com/charliermarsh/ruff/blob/49559da54e013b46314c5fdd1473de4dcd04c8c3/src/settings/configuration.rs#L76">after this</a> with the loaded contents of the profile / upstream file.</p>
<p>would a PR with mentioned implementation be accepted? Or would more discussion be required (eg as part of the eventual plugin system)? Or maybe it's just a non-goal?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-18 19:15</div>
            <div class="timeline-body"><p>Yeah I like this idea, I think this could be quite useful. The main question that comes to mind is where / how the presets should be defined.</p>
<p><code>isort</code> supports presets (called &quot;profiles&quot;), but they're all <a href="https://pycqa.github.io/isort/docs/configuration/profiles.html">defined in <code>isort</code> itself</a>, which is probably not what we want here.</p>
<p><code>eslint</code> supports <a href="https://eslint.org/docs/latest/developer-guide/shareable-configs">shareable configs</a>, but they have to be released on npm (or defined and loaded from the local filesystem), which we also probably don't want.</p>
<p>A URL seems reasonable, but we'd definitely want to cache it.</p>
<p>Can we think of other examples to model on here? Maybe something <code>pre-commit</code> like, where you specify a URL and explicitly run <code>install</code> to fetch (or update) the config locally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2022-11-18 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2022-11-18 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pwoolvett">@pwoolvett</a> on 2022-11-18 19:31</div>
            <div class="timeline-body"><p>Presets seem to involve more logic.</p>
<p>I think the most straightforward would be the &quot;upstream&quot; variant, which would just be a local or cached remote <code>.toml</code> with configuration to use as defaults, overriden by local ruff config+cli. Then most common &quot;presets&quot; could just be tomls hosted together with the documentation :).</p>
<p>In that case, the pre-commit hook could be used to invalidate cached url (stage 1), before actually running ruff (stage 2). Or actually just provide two ruff hooks <a href="https://github.com/charliermarsh/ruff-pre-commit/blob/main/.pre-commit-hooks.yaml">here</a>: one to invalidate remote (people not using upstream wont care about this), and the current one.
(you were talking about <a href="https://pre-commit.com/">pre-commit</a>, not <a href="https://git-scm.com/docs/githooks#_pre_commit">pre-commit</a>, right?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-18 19:41</div>
            <div class="timeline-body"><p>Yeah. We could also just cache it in <code>.ruff_cache</code> and then users can always <code>rm -rf .ruff_cache</code> to clear it out. (I want to make regular purging of the <code>.ruff_cache</code> slightly more automatic anyway, right now it just gets bigger with every release.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-18 23:48</div>
            <div class="timeline-body"><p>@pwoolvett - Are you interested in working on it? :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pwoolvett">@pwoolvett</a> on 2022-11-20 00:09</div>
            <div class="timeline-body"><p>sure! ill have a go at it and send a pr</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-16 05:30</div>
            <div class="timeline-body"><p>We now have <code>extend = &quot;/path/to/pyproject.toml&quot;</code> which is relevant here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @charliermarsh on 2022-12-31 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michaeloliverx">@michaeloliverx</a> on 2023-02-07 17:45</div>
            <div class="timeline-body"><p>Maybe relevant, Something akin to tsconfig.json extends?</p>
<p>https://www.typescriptlang.org/tsconfig#extends</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-06 17:52</div>
            <div class="timeline-body"><p>Created a Discussion around this: https://github.com/charliermarsh/ruff/discussions/3363</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-04-12 15:50</div>
            <div class="timeline-body"><blockquote>
<p>We now have <code>extend = &quot;/path/to/pyproject.toml&quot;</code> which is relevant here.</p>
</blockquote>
<p>The more projects I move over to Ruff, the more I really wish I could extend some base configs cross-projects. Something like being able to use a URL in <code>extend</code> or a path relative to site-packages, like:</p>
<blockquote>
<p>Maybe relevant, Something akin to tsconfig.json extends?</p>
<p><a href="https://www.typescriptlang.org/tsconfig#extends">typescriptlang.org/tsconfig#extends</a></p>
</blockquote>
<p>It's also the last major feature missing before I feel confident showing off (and integrating) Ruff at my workplace, where we love being able to reference a global base configuration for our tooling, massively simplifying other dev's work when it comes to following company-wide standards, staying up to date, and integrating/configuring the tools in all projects as easily as possible.</p>
<p>(tl;dr: adoption is easier when I can say &quot;add these 3 lines to your configs&quot; instead of &quot;copy these config files that will soon be out of date&quot;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2023-04-26 21:27</div>
            <div class="timeline-body"><p>@charliermarsh we spoke about this at PyCon how for Python would generalize better if one could pull configuration via a plugin system of an additionaly installed Python package.  Ideally, we'd not even need any configuration such as:</p>
<pre><code class="language-toml">[tool.ruff]
preset = &quot;tox_ruff_config&quot;
</code></pre>
<p>When installed into a Python interpreter, we could just use https://docs.python.org/3/library/importlib.metadata.html#entry-points via the ruff key, and if a such library is detected load that configuration file as a base (still overwrite-able via pyproject.toml). How one woud use this is via pre-commit:</p>
<pre><code class="language-YAML">- repo: https://github.com/charliermarsh/ruff-pre-commit
  rev: &quot;v0.0.263&quot;
  hooks:
    - id: ruff
       additional_dependencies: [tox_ruff_config==1.0.1]
</code></pre>
<p>This solution would cache natively, would be versioned by design, and would work behind enterprise firewalls too. This feature would only work if ruff is installed via Python, and would be no-op should you run ruff as a dedicated binary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yoann9344">@yoann9344</a> on 2024-02-19 23:01</div>
            <div class="timeline-body"><p>It would be nice to be able to extend the config from a main project on another git.</p>
<pre><code class="language-toml">[tool.ruff]
extend = &quot;../ruff/pyproject.toml&quot;
# instead we could write something like this :
extend = { git = &quot;https://github.com/astral-sh/ruff.git&quot;, tag=&quot;0.2.1&quot; }
extend = { git = &quot;https://github.com/astral-sh/ruff.git&quot;, branch=&quot;some_branch&quot; }
# maybe with the possibility to configure the path to the `pyproject.toml`
extend = { git = &quot;https://github.com/astral-sh/ruff.git&quot;, tag=&quot;0.2.1&quot;, path = &quot;my_dir_configs/pyproject.toml&quot; }
</code></pre>
<p>Could even imagine to retrieve a config from a dependency manager like pep compliant or poetry :</p>
<pre><code class="language-toml">[project]
dependencies = [
    &quot;my-repo @ git+https://github.com/my-repo/ruff.git@0.2.1&quot;
]
[tool.poetry.dependencies]
my-repo = { git = &quot;https://github.com/my-repo/ruff.git&quot;, tag=&quot;0.2.1&quot; }

[tool.ruff]
extend = { pep = &quot;my-repo&quot;, path = &quot;my_dir_configs/pyproject.toml&quot; }
extend = { poetry = &quot;my-repo&quot;, path = &quot;my_dir_configs/pyproject.toml&quot; }
</code></pre>
<p>The logic behind will basically do something like this :</p>
<pre><code class="language-bash"># With default values :
# extend_tag=&quot;&quot;
# extend_branch=&quot;&quot;
# extend_path=&quot;pyproject.toml&quot;
position=`pwd`
git clone --no-checkout --depth=1 --no-tags $extend_git $somewhere_in_ruff_cache
cd $somewhere_in_ruff_cache
if [ &quot;$extend_tag&quot; != &quot;&quot; ]; then
    git fetch origin &quot;+refs/tags/${extend_tag}:refs/tags/${extend_tag}&quot; --no-tags
    git checkout $extend_tag -- $extend_path
else
    git checkout $extend_branch -- $extend_path  # empty branch is HEAD
fi
cd $position
# config ruff to point on the retrieved toml
config_extend &quot;${somewhere_in_ruff_cache}/${extend_path}&quot;
</code></pre>
<p>Then we could imagine that extend can include presets :</p>
<pre><code class="language-toml">extend = { preset = &quot;strict_without_doc&quot; }
# Would be be an alias for :
extend = { git = &quot;https://github.com/astral-sh/ruff.git&quot;, tag = &quot;&lt;running_ruff_version&gt;&quot;, path = &quot;presets_config/strict_without_doc.toml&quot; }
# We could even imagine to block the config to an older version
extend = { preset = &quot;strict_without_doc&quot;, tag = &quot;0.2.0&quot; }
</code></pre>
<p>I think it is better to keep the same key for adding other configs. So everything that involves joining a toml would be under <code>extend</code>, doc, config and code would be clearer this way. Then to have multiple configs, we could image a list, where order matters :</p>
<pre><code class="language-toml">extend = [
    { preset = &quot;Doc_permissive&quot; },
    { preset = &quot;Flake8_without_warnings&quot; },
    { preset = &quot;Import&quot; },
    { preset = &quot;Security_strict&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hinricht">@hinricht</a> on 2024-04-18 07:30</div>
            <div class="timeline-body"><p>Also very interested in the feature to extend from a remote URL.
Use-case is to settle on a sane base config for ruff which can get included in all projects, but individual rules could easly tuned without code duplication.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-04-18 08:43</div>
            <div class="timeline-body"><p>Do keep in mind though that online shared configs will break pre-commit.ci as it doesn't allow internet acces whilst running, only on install.</p>
<p>This could be worked around if the pre-commit action can &quot;dry-run&quot; and cache the extended config file.</p>
<p>dprint currently has this issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:31 UTC
    </footer>
</body>
</html>
