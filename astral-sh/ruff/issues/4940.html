<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F841 fix since 0.0.264 can break code - astral-sh/ruff #4940</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>F841 fix since 0.0.264 can break code</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4940">#4940</a>
        opened by <a href="https://github.com/scop">@scop</a>
        on 2023-06-07 21:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/scop">@scop</a> on 2023-06-07 21:07</div>
            <div class="timeline-body"><pre><code class="language-shellsession">$ curl -O https://raw.githubusercontent.com/home-assistant/core/03710e58b5cc3cd1e2472d2e497bf5780695eca5/tests/components/homekit_controller/test_init.py
$ ruff test_init.py
test_init.py:150:5: F841 [*] Local variable `is_connected` is assigned to but never used
test_init.py:218:5: F841 [*] Local variable `is_available` is assigned to but never used
Found 2 errors.
[*] 2 potentially fixable with the --fix option.
$ ruff --fix test_init.py
Found 6 errors (6 fixed, 0 remaining).
</code></pre>
<p>Note found 2 vs 6 errors. After the <code>--fix</code>:</p>
<pre><code class="language-shellsession">$ python3 -m test_init
Traceback (most recent call last):
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 185, in _run_module_as_main
    mod_name, mod_spec, code = _get_module_details(mod_name, _Error)
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 155, in _get_module_details
    code = loader.get_code(mod_name)
  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 981, in get_code
  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 911, in source_to_code
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 219, in _call_with_frames_removed
  File &quot;.../test_init.py&quot;, line 116
    nonlocal is_connected
    ^
SyntaxError: no binding for nonlocal 'is_connected' found
</code></pre>
<p>Haven't actually checked, but I suppose the fix for these issues is removing too many of the same named variables, not only the two it flagged errors for in non-fix mode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-07 21:10</div>
            <div class="timeline-body"><p>None of those should be considered &quot;assigned but unused&quot;, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-07 21:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scop">@scop</a> on 2023-06-07 21:14</div>
            <div class="timeline-body"><p>I guess so. But the code is a bit hairy, can't tell for sure on a quick skim, and unfortunately have no time right now to dig deeper.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-06-07 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-06-07 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-07 21:21</div>
            <div class="timeline-body"><p>No worries. I feel like the <code>nonlocal</code> reads aren't being properly attributed to the scope above, or something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4943.html">astral-sh/ruff#4943</a> on 2023-06-07 22:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-06-07 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-07 22:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
