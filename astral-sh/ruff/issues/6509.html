<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playground option for &quot;print comments&quot; - astral-sh/ruff #6509</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Playground option for &quot;print comments&quot;</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6509">#6509</a>
        opened by <a href="https://github.com/cnpryer">@cnpryer</a>
        on 2023-08-11 17:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-08-11 17:54</div>
            <div class="timeline-body"><p>In https://prettier.io/playground/ you can toggle an option to display the comments. It'd be nice to add that to https://play.ruff.rs/.</p>
<p>I mentioned this on Discord and didn't want to lose track of it. I can't claim this yet, but I'm happy to come back here to grab it if I can.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add playground option for "print comments"" to "Playground option for "print comments"" by @cnpryer on 2023-08-11 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> added by @MichaReiser on 2023-08-11 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-08-11 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-08-27 02:02</div>
            <div class="timeline-body"><p>I can hack this together by exporting certain things as public and adding <code>ruff_formatter</code> as a dep for <code>ruff_wasm</code>. I need to think about this more. Maybe it's just a matter of exposing some public <code>print_comments</code> function?</p>
<p>Here's my hacky diff:</p>
<pre><code class="language-diff">diff --git a/crates/ruff_python_formatter/src/comments/debug.rs b/crates/ruff_python_formatter/src/comments/debug.rs
index 578b463b4..c9122314b 100644
--- a/crates/ruff_python_formatter/src/comments/debug.rs
+++ b/crates/ruff_python_formatter/src/comments/debug.rs
@@ -37,7 +37,7 @@ impl Debug for DebugComment&lt;'_&gt; {
 }
 
 /// Pretty-printed debug representation of [`Comments`].
-pub(crate) struct DebugComments&lt;'a&gt; {
+pub struct DebugComments&lt;'a&gt; {
     comments: &amp;'a CommentsMap&lt;'a&gt;,
     source_code: SourceCode&lt;'a&gt;,
 }
diff --git a/crates/ruff_python_formatter/src/comments/mod.rs b/crates/ruff_python_formatter/src/comments/mod.rs
index d46014ae2..9879e234d 100644
--- a/crates/ruff_python_formatter/src/comments/mod.rs
+++ b/crates/ruff_python_formatter/src/comments/mod.rs
@@ -282,7 +282,7 @@ type CommentsMap&lt;'a&gt; = MultiMap&lt;NodeRefEqualityKey&lt;'a&gt;, SourceComment&gt;;
 ///
 /// Cloning `comments` is cheap as it only involves bumping a reference counter.
 #[derive(Debug, Clone, Default)]
-pub(crate) struct Comments&lt;'a&gt; {
+pub struct Comments&lt;'a&gt; {
     /// The implementation uses an [Rc] so that [Comments] has a lifetime independent from the [crate::Formatter].
     /// Independent lifetimes are necessary to support the use case where a (formattable object)[crate::Format]
     /// iterates over all comments, and writes them into the [crate::Formatter] (mutably borrowing the [crate::Formatter] and in turn its context).
@@ -463,7 +463,7 @@ impl&lt;'a&gt; Comments&lt;'a&gt; {
     }
 
     /// Returns an object that implements [Debug] for nicely printing the [`Comments`].
-    pub(crate) fn debug(&amp;'a self, source_code: SourceCode&lt;'a&gt;) -&gt; DebugComments&lt;'a&gt; {
+    pub fn debug(&amp;'a self, source_code: SourceCode&lt;'a&gt;) -&gt; DebugComments&lt;'a&gt; {
         DebugComments::new(&amp;self.data.comments, source_code)
     }
 }
diff --git a/crates/ruff_python_formatter/src/context.rs b/crates/ruff_python_formatter/src/context.rs
index 01caed9e6..46a1f1c07 100644
--- a/crates/ruff_python_formatter/src/context.rs
+++ b/crates/ruff_python_formatter/src/context.rs
@@ -40,7 +40,7 @@ impl&lt;'a&gt; PyFormatContext&lt;'a&gt; {
         self.node_level
     }
 
-    pub(crate) fn comments(&amp;self) -&gt; &amp;Comments&lt;'a&gt; {
+    pub fn comments(&amp;self) -&gt; &amp;Comments&lt;'a&gt; {
         &amp;self.comments
     }
 }
diff --git a/crates/ruff_wasm/Cargo.toml b/crates/ruff_wasm/Cargo.toml
index f3707a736..f919b801f 100644
--- a/crates/ruff_wasm/Cargo.toml
+++ b/crates/ruff_wasm/Cargo.toml
@@ -22,6 +22,7 @@ ruff = { path = &quot;../ruff&quot; }
 ruff_diagnostics = { path = &quot;../ruff_diagnostics&quot; }
 ruff_python_ast = { path = &quot;../ruff_python_ast&quot; }
 ruff_python_codegen = { path = &quot;../ruff_python_codegen&quot; }
+ruff_formatter = { path = &quot;../ruff_formatter&quot; }
 ruff_python_formatter = { path = &quot;../ruff_python_formatter&quot; }
 ruff_python_index = { path = &quot;../ruff_python_index&quot; }
 ruff_python_parser = { path = &quot;../ruff_python_parser&quot; }
diff --git a/crates/ruff_wasm/src/lib.rs b/crates/ruff_wasm/src/lib.rs
index 602b18f55..fee8ca90b 100644
--- a/crates/ruff_wasm/src/lib.rs
+++ b/crates/ruff_wasm/src/lib.rs
@@ -25,6 +25,7 @@ use ruff::settings::{defaults, flags, Settings};
 use ruff_python_ast::PySourceType;
 use ruff_python_codegen::Stylist;
 use ruff_python_formatter::{format_module, format_node, PyFormatOptions};
+use ruff_formatter::SourceCode;
 use ruff_python_index::{CommentRangesBuilder, Indexer};
 use ruff_python_parser::AsMode;
 use ruff_source_file::{Locator, SourceLocation};
@@ -294,6 +295,25 @@ impl Workspace {
         Ok(format!(&quot;{formatted}&quot;))
     }
 
+    pub fn comments(&amp;self, contents: &amp;str) -&gt; Result&lt;String, Error&gt; {
+        let tokens: Vec&lt;_&gt; = ruff_python_parser::lexer::lex(contents, Mode::Module).collect();
+        let mut comment_ranges = CommentRangesBuilder::default();
+
+        for (token, range) in tokens.iter().flatten() {
+            comment_ranges.visit_token(token, *range);
+        }
+        let comment_ranges = comment_ranges.finish();
+        let module = parse_tokens(tokens, Mode::Module, &quot;.&quot;).map_err(into_error)?;
+
+        // TODO(konstin): Add an options for py/pyi to the UI (2/2)
+        let options = PyFormatOptions::from_source_type(PySourceType::default());
+        let formatted =
+            format_node(&amp;module, &amp;comment_ranges, contents, options).map_err(into_error)?;
+        let comments = formatted.context().comments().debug(SourceCode::new(contents));
+        
+        Ok(format!(&quot;{comments:#?}&quot;))
+    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-08-27 02:11</div>
            <div class="timeline-body"><img width="1512" alt="image" src="https://github.com/astral-sh/ruff/assets/14341145/5bdc65a9-2b1f-4523-846a-7b0c0bbe7343">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6911.html">astral-sh/ruff#6911</a> on 2023-08-27 02:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @cnpryer by @MichaReiser on 2023-08-27 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-08-28 07:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-09-02 08:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
