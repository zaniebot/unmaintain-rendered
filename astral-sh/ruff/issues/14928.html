<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff requires multiple calls for certain import configurations - astral-sh/ruff #14928</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Ruff requires multiple calls for certain import configurations</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14928">#14928</a>
        opened by <a href="https://github.com/leep-frog">@leep-frog</a>
        on 2024-12-12 04:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/leep-frog">@leep-frog</a> on 2024-12-12 04:01</div>
            <div class="timeline-body"><p>I noticed that I need to call ruff multiple times for the following configuration/code:</p>
<p>Configuration:</p>
<pre><code>      lint: {
        select: [
          'I001',
          'I002',
        ],
        isort: {
          'required-imports': [
            &quot;from typing import Dict&quot;
          ],
          'lines-after-imports': 2,
          'combine-as-imports': true,
        },
</code></pre>
<p>Code:</p>
<pre><code class="language-python">from typing import Any

def func() -&gt; Any:
  pass
</code></pre>
<p>After first pass of ruff:</p>
<pre><code class="language-python">from typing import Dict
from typing import Any


def func() -&gt; Any:
    pass
</code></pre>
<p>After second pass of ruff:</p>
<pre><code class="language-python">from typing import Any, Dict


def func() -&gt; Any:
    pass
</code></pre>
<p>Not sure if there is a config flag to add that would allow this to work in one go.  If not, seems like a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-12-12 04:16</div>
            <div class="timeline-body"><p>Hmm... I'm not able to reproduce this. Does it look like I'm doing everything you're doing?</p>
<pre><code class="language-console">❯ uv run ruff --version
ruff 0.8.2

❯ cat ruff.toml
[lint]
select = [&quot;I001&quot;,&quot;I002&quot;]

[lint.isort]
required-imports = [&quot;from typing import Dict&quot;]
lines-after-imports = 2
combine-as-imports = true

❯ cat ex.py
from typing import Any

def func() -&gt; Any:
  pass%                                     
❯ uv run ruff check --fix ex.py
Found 3 errors (3 fixed, 0 remaining).

❯ cat ex.py
from typing import Any, Dict


def func() -&gt; Any:
  pass%  
</code></pre>
<p>(For what it's worth, under the hood <code>ruff check --fix</code> <em>is</em> running ruff multiple times and applying fixes. So maybe you're invoking Ruff in a different setting where only one iteration is being applied?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @dylwil3 on 2024-12-12 04:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leep-frog">@leep-frog</a> on 2024-12-12 04:37</div>
            <div class="timeline-body"><p>Ah I see. I'm using the <a href="https://www.npmjs.com/package/@astral-sh/ruff-wasm-nodejs">ruff-wasm-nodejs</a> npm package.</p>
<p>Any chance that can be updated to do the same?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-12 07:00</div>
            <div class="timeline-body"><p>I consider this out of scope for the JS API. It only provides an API to get all diagnostics for the initial source text. It doesn't even provide an official API for applying fixes. Instead, that's left to the caller.</p>
<p>You have to keep calling <code>check</code> until it returns no more diagnostics with fixes. You also have to be careful, fixes can overlap and some fixes shouldn't be applied when other fixes are present (e.g. one fix might try to remove an import when another edit adds it or even requires it).</p>
<p>Overall, the JS api has no support for fixes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-12-12 07:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
