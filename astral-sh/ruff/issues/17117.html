<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don’t flag “await outside async function” for notebooks - astral-sh/ruff #17117</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don’t flag “await outside async function” for notebooks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/17117">#17117</a>
        opened by <a href="https://github.com/ctcjab">@ctcjab</a>
        on 2025-04-01 12:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ctcjab">@ctcjab</a> on 2025-04-01 12:25</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We have a monorepo set up for all the notebooks at our firm and are using Jupytext to keep those notebooks in version control as .py files rather than .ipynb files. (This setup isn’t all that uncommon when keeping notebooks in version control.)</p>
<p>In Jupyter notebooks, <a href="https://docs.astral.sh/ruff/rules/await-outside-async/">await outside async function</a> is not an error, but ruff is flagging it as such. What do you think of having logic in ruff to detect if a .py file is actually a Jupytext notebook (straightforward to detect via the telltale Jupytext metadata comment at the top of the file), and automatically ignore rules that don’t apply to notebooks in this case?</p>
<p>Thanks for your consideration and for the amazing work on ruff ❤️</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ctcjab">@ctcjab</a> on 2025-04-01 12:27</div>
            <div class="timeline-body"><p>Note, this issue is compounded for us by https://github.com/python-lsp/python-lsp-ruff/issues/102 — We can’t currently configure ruff to ignore this rule for all notebooks in our monorepo via a ruff.toml at the root of the repo due to that bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 12:32</div>
            <div class="timeline-body"><p>The rule documentation suggests that this is already the case for notebooks (<code>.ipynb</code>). Do you use a different file extension?</p>
<blockquote>
<p>As an exception, await is allowed at the top level of a Jupyter notebook (see: <a href="https://ipython.readthedocs.io/en/stable/interactive/autoawait.html">autoawait</a>).</p>
</blockquote>
<p>CC: @ntBre because this might be important for your syntax work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2025-04-01 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-01 12:34</div>
            <div class="timeline-body"><p>I think they're using .py files, which explains the issue.</p>
<blockquote>
<p>using Jupytext to keep those notebooks in version control as .py files rather than .ipynb files</p>
</blockquote>
<p>I thought we had a setting for specifying other extensions as notebooks, but I can't find it now. That's not as nice as auto-detection, but it could help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 12:41</div>
            <div class="timeline-body"><blockquote>
<p>I thought we had a setting for specifying other extensions as notebooks, but I can't find it now. That's not as nice as auto-detection, but it could help.</p>
</blockquote>
<p>I think it's CLI only, see <code>--extensions</code></p>
<p>This is probably a duplicate of https://github.com/astral-sh/ruff/issues/8800</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python-lsp/python-lsp-ruff/issues/102.html">python-lsp/python-lsp-ruff#102</a> on 2025-04-01 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">notebook</span> added by @AlexWaygood on 2025-04-02 09:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-04-28 08:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8800.html">astral-sh/ruff#8800</a> on 2025-04-29 17:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
