<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--extend-select` and `--extend-ignore` work in unexpected ways - astral-sh/ruff #2300</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>--extend-select</code> and <code>--extend-ignore</code> work in unexpected ways</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2300">#2300</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2023-01-28 15:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-28 15:42</div>
            <div class="timeline-body"><pre><code>$ ruff --select E501 --ignore ALL scripts
scripts/add_rule.py:44:89: E501 Line too long (92 &gt; 88 characters)
$ ruff --select E501 --extend-ignore ALL scripts
# (nothing)
</code></pre>
<p>I would expect <code>--extend-select</code> and <code>--extend-ignore</code> to simply append the values to the <code>--select</code> and <code>--ignore</code> values however they in fact take precedence over the former.</p>
<p>I find the current behavior to be unintuitive, is it intentional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 15:43</div>
            <div class="timeline-body"><p>Yes it's intentional.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 15:45</div>
            <div class="timeline-body"><p>Here are some resources on the reasoning behind it:</p>
<ul>
<li>https://github.com/charliermarsh/ruff/pull/1245</li>
<li>https://github.com/charliermarsh/ruff/issues/1838</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 15:46</div>
            <div class="timeline-body"><p>Closing as this is correct from my perspective but happy to keep discussing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-28 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-28 15:48</div>
            <div class="timeline-body"><p>If it's intentional I think the options should rather be called <code>--override-*</code> because that would be more accurate than <code>extend</code> ... my point is that it doesn't extend.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 15:50</div>
            <div class="timeline-body"><p>I'm open to it. Though I'd like it to be done in a backwards-compatible way, and I'd prefer not to support all of <code>--select</code>, <code>--extend-select</code> (with old semantics), and <code>--override-select</code> (with the existing semantics), so I'd likely want to just not support <code>--extend-select</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 15:53</div>
            <div class="timeline-body"><p>Although, <code>--override-select</code> suggests to me that it's clearing out the <code>select</code> and replacing it entirely -- which isn't the case. The extends just get applied last.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-28 15:55</div>
            <div class="timeline-body"><p>To be honest I don't find your reasoning in #1245 convincing.</p>
<p>If I understand correctly you say that it's unintuitive that <code>--extend-select F401</code> doesn't do anything when you have <code>ignore = [&quot;F401&quot;]</code> in your <code>pyproject.toml</code> ... however we could simply have CLI options take precedence over <code>pyproject.toml</code>  ... that doesn't require <code>extend-select</code> to always be applied last.</p>
<p>That is I'd argue even <code>--select F401</code> should work when you have <code>ignore = [&quot;F401&quot;]</code> in your <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 16:17</div>
            <div class="timeline-body"><p>There are a lot of cases to consider.</p>
<p>The primary motivation for this change wasn't the CLI. It was that, if you don't use these semantics for <code>extend-select</code> and <code>extend-ignore</code> in a <code>pyproject.toml</code>, it becomes <em>impossible</em> for configuration files that extend other configuration files to turn rules on and off in common cases.</p>
<p>Specifically, prior to that change, if you had a <code>pyproject.toml</code> like this:</p>
<pre><code class="language-toml">[tool.ruff]
select = [&quot;F&quot;]
ignore = [&quot;F401&quot;]
</code></pre>
<p>And then a child that extended it:</p>
<pre><code class="language-toml">[tool.ruff]
extend = &quot;../pyproject.toml&quot;
extend-select = [&quot;F401&quot;]
</code></pre>
<p><code>F401</code> would <em>not</em> be turned on. And in fact, it'd be impossible for the child to turn it on.</p>
<p>This change allowed us to treat the resolution in two passes: resolve the (select, ignore) rules, then apply the (extend-select, extend-ignore) rules.</p>
<p>Happy to consider a proposal that takes all of these cases into account. What you describe <em>sounds</em> like replacing <code>--extend-select</code> and <code>--extend-ignore</code> on the CLI with <code>--select</code> and <code>--ignore</code>, but perhaps it's slightly different.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-01-28 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2023-01-28 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 16:31</div>
            <div class="timeline-body"><blockquote>
<p>however we could simply have CLI options take precedence over pyproject.toml</p>
</blockquote>
<p>What does &quot;take precedence&quot; here mean precisely? Could you provide examples of the expected behavior? In a sense, it <em>does</em> take precedence right now, since it overrides the <code>select</code>.</p>
<p>Is the suggestion that if a user provides either <code>--select</code> or <code>--ignore</code>, we omit any selection and ignore rules specified in <code>pyproject.toml</code> entirely? Just trying to understand the exact semantics of what you're proposing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 16:38</div>
            <div class="timeline-body"><p>To be clear: I'd love to make this stuff more intuitive. I won't personally be working on it right now, but I'm very open to suggestions. I just want to make sure we're thinking through all the implications and that I'm clearly explaining <em>why</em> certain things work the way they do right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-28 16:49</div>
            <div class="timeline-body"><blockquote>
<p>Specifically, prior to that change, if you had a pyproject.toml like this [..] And then a child that extended it [..] F401 would not be turned on. And in fact, it'd be impossible for the child to turn it on.</p>
</blockquote>
<p>Right I agree that this is a problem however I think the obvious cause is that <code>Configuration::combine</code> is combining <code>select</code>, <code>ignore</code>, <code>extend_select</code> and <code>extend_ignore</code> all independently, whereas it should preserve them together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 16:52</div>
            <div class="timeline-body"><p>Like, keep every foursome intact, then when resolving, resolve the first foursome, then pass those rules along and &quot;apply&quot; the next foursome, etc.?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-28 16:52</div>
            <div class="timeline-body"><p>Yes. This would also mean that latter <code>select</code>s override earlier <code>ignore</code>s which currently isn't the case but I think really should be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 16:58</div>
            <div class="timeline-body"><p>Would we have any need for <code>extend-select</code> and <code>extend-ignore</code> in that world?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-28 17:30</div>
            <div class="timeline-body"><p>I feel like you need a PhD in <code>--select</code> to understand all the possible resolution semantics. Makes me very sad!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-30 21:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:04 UTC
    </footer>
</body>
</html>
