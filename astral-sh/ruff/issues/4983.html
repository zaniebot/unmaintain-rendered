<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug in number line with --show-source - astral-sh/ruff #4983</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug in number line with --show-source</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4983">#4983</a>
        opened by <a href="https://github.com/victorcrrd">@victorcrrd</a>
        on 2023-06-09 13:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/victorcrrd">@victorcrrd</a></div>
            <div class="timeline-body"><p>When printing the code fragment with a violation with the <code>--show-source</code> option, it always happens (unless it&#x27;s on the first line as I can see) that the number at the beginning of each source line doesn&#x27;t match the actual line number. For example, here</p>
<pre><code>src/dropboxAPI.py:2:26: F401 [*] `urllib.parse.urlencode` imported but unused
          |
        2 | from urllib import request
        3 | from urllib.parse import urlencode
          |                          ^^^^^^^^^ F401
        4 | import requests, os
        5 | from base64 import b64encode
          |
          = help: Remove unused import: `urllib.parse.urlencode`
</code></pre>
<p>I have a violation at line 2, but the number line printed in the source-code fragment is 3.</p>
<p>However, it doesn&#x27;t happen when the violation is on the first line:</p>
<pre><code>src/dropboxAPI.py:1:20: F401 [*] `urllib.request` imported but unused
          |
        1 | from urllib import request
          |                    ^^^^^^^ F401
        2 | from urllib.parse import urlencode
        3 | import requests, os
          |
          = help: Remove unused import: `urllib.request`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-09 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-09 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-09 14:00</div>
            <div class="timeline-body"><p>Thanks for reporting this bug. It&#x27;s a bit embarrassing, the line numbers are even off in our test snapshots. I take a look (how to catch up with @charliermarsh &#x27;s insane added/removed stats: mess up the line numbers so that all snapshot tests need updating)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-09 15:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:37 UTC
    </footer>
</body>
</html>
