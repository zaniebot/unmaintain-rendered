```yaml
number: 6638
title: "`PERF102` is not detected in generators or comprehensions"
type: issue
state: open
author: dosisod
labels:
  - rule
  - accepted
assignees: []
created_at: 2023-08-17T03:42:10Z
updated_at: 2023-08-20T12:57:26Z
url: https://github.com/astral-sh/ruff/issues/6638
synced_at: 2026-01-10T01:56:48Z
```

# `PERF102` is not detected in generators or comprehensions

---

_Issue opened by @dosisod on 2023-08-17 03:42_

`PERF102` is not detected in generators or comprehensions, only in `for` loops:

```python
d = {}

for k, _ in d.items():
    print(k)

_ = (k for k, _ in d.items())
_ = [k for k, _ in d.items()]
_ = {k for k, _ in d.items()}
_ = {k: "v" for k, _ in d.items()}
```

Running:

```
$ ruff --version
ruff 0.0.284

$ ruff x.py
x.py:3:13: PERF102 [*] When using only the keys of a dict use the `keys()` method
Found 1 error.
[*] 1 potentially fixable with the --fix option.
```

Expected: A line for the `d.items()` call in the generator and each of the `list`/`set`/`dict` comprehension.

---

_Comment by @charliermarsh on 2023-08-17 14:04_

Good call, we should catch this.

---

_Label `rule` added by @charliermarsh on 2023-08-17 14:05_

---

_Label `accepted` added by @charliermarsh on 2023-08-17 14:05_

---

_Comment by @harupy on 2023-08-20 06:51_

Can I work on this?

---

_Assigned to @harupy by @dhruvmanila on 2023-08-20 07:40_

---

_Comment by @harupy on 2023-08-20 07:51_

One question: To detect whether the iterator variables are used in the comprehension, can we use the same approach as the `function_uses_loop_variable` rule?

https://github.com/astral-sh/ruff/blob/7e9023b6f85c28bcfdc7fe82a507d7752e84edcf/crates/ruff/src/rules/flake8_bugbear/rules/function_uses_loop_variable.rs#L283-L284

---

_Referenced in [astral-sh/ruff#7022](../../astral-sh/ruff/pulls/7022.md) on 2023-08-31 14:12_

---
