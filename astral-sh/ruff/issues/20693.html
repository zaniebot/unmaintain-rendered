<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Rule to Validate Pytest Argnames - astral-sh/ruff #20693</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>New Rule to Validate Pytest Argnames</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20693">#20693</a>
        opened by <a href="https://github.com/George-Ogden">@George-Ogden</a>
        on 2025-10-03 15:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/George-Ogden">@George-Ogden</a></div>
            <div class="timeline-body">Summary
Intro
<p>Hey,</p>
<p>I&#x27;ve been relying on Ruff heavily in my projects for pre-commit checks, linting and the VS Code extension. Like many developers, I make a lot of mistakes and use other tools to compensate for my finite memory.</p>
Overview
<p>One mistake I frequently make is changing the names of arguments in my test and then not updating the <code>argnames</code> string when using Pytest.</p>
Example
<p>Here&#x27;s an example:</p>
<pre><code>@pytest.mark.parametrize(&quot;object&quot;, [[&quot;foo&quot;, &quot;bar&quot;]])
def test_simple(objects: list[str]) -&gt; None: ...
</code></pre>
<p>Here, &quot;object&quot; is incorrect and <code>argnames</code> should be &quot;objects&quot; instead. I would like to create a rule that warns you of this error. I think that checking for arguments in <code>argnames</code> that are not function arguments would be a good place to start, before trying to validate all the <code>argnames</code>.</p>
<p>Looking at <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/flake8_pytest_style/rules/parametrize.rs">crates/ruff_linter/src/rules/flake8_pytest_style/rules/parametrize.rs</a>, it seems like this would be possible to implement, but nontrivial. I haven&#x27;t contributed to Ruff before, but I would be keen to work on this.</p>
Edge Cases
<p>There are a lot of edge cases, which I&#x27;m going to list, that make this harder:</p>
Multiple Arguments
<pre><code>@pytest.mark.parametrize(&quot;arg1, arg2&quot;, [(1, 1.0), (2, 2.0)])
def test_multi_args_together(arg1: int, arg2: float) -&gt; None: ...

@pytest.mark.parametrize(&quot;arg1&quot;, [1, 2])
@pytest.mark.parametrize(&quot;arg2&quot;, [1.0, 2.0])
def test_multi_args_independent(arg1: int, arg2: float) -&gt; None: ...
</code></pre>
Automatic Fixtures
<pre><code>@pytest.fixture
def auto_fixture(): ...

@pytest.mark.parametrize(&quot;arg&quot;, [None])
def test_auto_fixture(auto_fixture: pytest.FixtureDef, arg: None) -&gt; None: ...
</code></pre>
<p>This includes default Pytest fixtures, such as <code>capsys</code>.</p>
Indirect Fixtures
<pre><code>@pytest.fixture(autouse=True)
def indirect_fixture(indirect_arg): # may exist in a different file
    yield indirect_arg

@pytest.mark.parametrize(&quot;indirect_arg&quot;, [1, 2, 3])
def test_indirect(indirect_fixture: int) -&gt; None: ...
</code></pre>
<p>Solving this specific case would require checking <code>conftest.py</code> files in parent directories to be fully exhaustive. A full algorithm would create a graph to identify whether the current arguments form a valid path to the root (current test). A simplified version could create a set of valid argument names (from all fixtures and tests) and validate whether each argname is the argument to one of these, raising an error if not.</p>
Closing
<p>Thanks for your hard work on Ruff so far, and I&#x27;d be interested to hear your thoughts on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-03 19:35</div>
            <div class="timeline-body"><p>Thanks for the kind words and the suggestion!</p>
<p>This does sound reasonable to me and related to the <a href="https://docs.astral.sh/ruff/rules/pytest-parametrize-names-wrong-type/#pytest-parametrize-names-wrong-type-pt006">pytest-parametrize-names-wrong-type (PT006)</a> implementation you found. It also reminds me of <a href="https://docs.astral.sh/ruff/rules/fast-api-unused-path-parameter/#fast-api-unused-path-parameter-fast003">fast-api-unused-path-parameter (FAST003)</a>.</p>
<p>I&#x27;ll just add the <code>needs-decision</code> label for now to give others a chance to weigh in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-03 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-03 19:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:28 UTC
    </footer>
</body>
</html>
