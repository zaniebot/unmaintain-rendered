```yaml
number: 7795
title: "Bug: RUF015 leading to autofix error (`IndexError` gets changed to `StopIteration`)"
type: issue
state: closed
author: jamesbraza
labels: []
assignees: []
created_at: 2023-10-04T00:43:00Z
updated_at: 2023-10-18T16:13:39Z
url: https://github.com/astral-sh/ruff/issues/7795
synced_at: 2026-01-10T01:56:49Z
```

# Bug: RUF015 leading to autofix error (`IndexError` gets changed to `StopIteration`)

---

_Issue opened by @jamesbraza on 2023-10-04 00:43_

I am using `ruff==0.0.292`:

```python
# a.py

empty_tuple = tuple()
try:
    hi = list(empty_tuple)[0]
except IndexError:  # Works
    pass
```

Running `ruff --isolated --select=RUF015 a.py` it throws a `RUF015` on line 3.  Autofixing it with `ruff --fix --select=RUF015 a.py`

```
empty_tuple = tuple()
try:
    hi = next(iter(empty_tuple))
except IndexError:  # I fail now, because the Exception thrown was a StopIteration
    pass
```

What do you think?

---

_Comment by @charliermarsh on 2023-10-04 00:46_

I believe this is documented in the rule documentation for `RUF015`: https://docs.astral.sh/ruff/rules/unnecessary-iterable-allocation-for-first-element/

> Note that migrating from list(...)[0] to next(iter(...)) can change the behavior of your program in two ways:

> First, list(...) will eagerly evaluate the entire collection, while next(iter(...)) will only evaluate the first element. As such, any side effects that occur during iteration will be delayed.

> Second, list(...)[0] will raise IndexError if the collection is empty, while next(iter(...)) will raise StopIteration.

It's also a suggested rather than an automatic fix, so it will require opt-in soon.


---

_Comment by @jamesbraza on 2023-10-04 00:49_

Shoot, I jumped the gun on this report, I should have read the docs on this.  Is there any way we can preserve autofix, just not when inside a `try-except` block?

Also, feel free to close this out, as it seems you've already thought this through

---

_Comment by @charliermarsh on 2023-10-04 04:27_

No worries at all. It'll still be possible to fix -- you'll just need to pass a different flag (like `--fix-suggested`).

---

_Closed by @charliermarsh on 2023-10-04 04:27_

---

_Comment by @jamesbraza on 2023-10-18 16:13_

https://astral.sh/blog/ruff-v0.1.0#respecting-fix-safety

Looks like this example got used here, love it! üöÄ üëç 

---
