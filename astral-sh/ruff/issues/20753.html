<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 false positive: closure captures variable before `del` statement - astral-sh/ruff #20753</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F821 false positive: closure captures variable before <code>del</code> statement</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20753">#20753</a>
        opened by <a href="https://github.com/lamteteeow">@lamteteeow</a>
        on 2025-10-07 20:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lamteteeow">@lamteteeow</a></div>
            <div class="timeline-body">Summary
Description
<p>Ruff incorrectly reports F821 &quot;Undefined name&quot; when a variable is captured by a nested function (closure) before being deleted with <code>del</code> in the outer scope.
This has been occurring since ruff 0.13.3 first time I encountered it.</p>
Minimal Reproduction
<pre><code>def main(A: int) -&gt; int:
    A = A + 1
    def func_inner(B: int) -&gt; int:
        return A + B  # F821: Undefined name `A` &lt;- FALSE POSITIVE
    C = func_inner(3)
    del A
    return C

if __name__ == &quot;__main__&quot;:
    result = main(10)
    print(result)  # Outputs: 14
</code></pre>
Version
<p>ruff 0.14.0 (2025-10-07)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-07 20:51</div>
            <div class="timeline-body"><p>Thanks for the report! I think this is a duplicate of #9858. It&#x27;s a tricky bug to fix, unfortunately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-07 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lamteteeow">@lamteteeow</a> on 2025-10-07 21:23</div>
            <div class="timeline-body"><p>Thanks for quick response to this. It does not bother me too much. I saw the other issue but I was not sure they rooted from the same problem so deliberately posted another one. Sorry for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-08 13:01</div>
            <div class="timeline-body"><p>No problem at all, it&#x27;s good to double check! Thanks again :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:29 UTC
    </footer>
</body>
</html>
