<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>panic: `internal error: entered unreachable code: IPython escape command expression is only allowed for % and !` - astral-sh/ruff #21705</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>panic: <code>internal error: entered unreachable code: IPython escape command expression is only allowed for % and !</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/21705">#21705</a>
        opened by <a href="https://github.com/correctmost">@correctmost</a>
        on 2025-11-30 18:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/correctmost">@correctmost</a></div>
            <div class="timeline-body">Summary
<p>I ran some follow-up tests for #21465 and found a similar notebook crash:</p>
<pre><code>panic: Panicked at crates/ruff_python_parser/src/parser/expression.rs:2782:13 when checking `/home/user/crash.ipynb`: `internal error: entered unreachable code: IPython escape command expression is only allowed for % and !`
</code></pre>
<p><strong>crash.ipynb</strong></p>
<pre><code>{
  &quot;cells&quot;: [
    {
      &quot;cell_type&quot;: &quot;code&quot;,
      &quot;metadata&quot;: {},
      &quot;outputs&quot;: [],
      &quot;source&quot;: [
        &quot;{]\n,&quot;
      ]
    }
  ],
  &quot;metadata&quot;: {},
  &quot;nbformat&quot;: 4,
  &quot;nbformat_minor&quot;: 2
}
</code></pre>
Version
<p>ruff 0.14.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-30 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">notebook</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-30 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-30 23:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:40 UTC
    </footer>
</body>
</html>
