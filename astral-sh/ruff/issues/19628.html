<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF033 fix introduces an error for a type variable scoped to `__post_init__` - astral-sh/ruff #19628</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF033 fix introduces an error for a type variable scoped to <code>__post_init__</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19628">#19628</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-07-30 01:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body">Summary
<p>The fix for <a href="https://docs.astral.sh/ruff/rules/post-init-default/"><code>post-init-default</code> (RUF033)</a> introduces an error when the parameterâ€™s type uses a type variable scoped to <code>__post_init__</code>. It might not be possible to fix this automatically. <a href="https://play.ruff.rs/a929b4a1-f338-4169-a937-cb7ecb20727a">Example</a>:</p>
<pre><code>$ cat &gt;ruf033.py &lt;&lt;&#x27;# EOF&#x27;
from annotationlib import get_annotations
from dataclasses import dataclass
@dataclass
class C:
    def __post_init__[T: (str, bytes)](self, a: T | None = None, b: T | None = None) -&gt; None:
        self.a = str(a)
        self.b = str(b)
print(get_annotations(C))
# EOF

$ python3.14 ruf033.py
{}

$ ruff --isolated check ruf033.py --select RUF033 --unsafe-fixes --fix
Found 2 errors (2 fixed, 0 remaining).

$ cat ruf033.py
from annotationlib import get_annotations
from dataclasses import dataclass, InitVar
@dataclass
class C:
    a: InitVar[T | None] = None
    b: InitVar[T | None] = None
    def __post_init__[T: (str, bytes)](self, a: T | None, b: T | None) -&gt; None:
        self.a = a
        self.b = b
print(get_annotations(C))

$ python3.14 ruf033.py 2&gt;&amp;1 | tail -n 1
NameError: name &#x27;T&#x27; is not defined
</code></pre>
Version
<p>ruff 0.12.7 (c5ac99889 2025-07-29)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-30 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-30 12:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:17 UTC
    </footer>
</body>
</html>
