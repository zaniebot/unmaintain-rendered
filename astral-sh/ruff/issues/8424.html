<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[format] Candidates for improvement from testing on a large code repository - astral-sh/ruff #8424</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[format] Candidates for improvement from testing on a large code repository</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8424">#8424</a>
        opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a>
        on 2023-11-01 21:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saippuakauppias">@saippuakauppias</a></div>
            <div class="timeline-body"><p>A few examples that could be improved. We ran <code>ruff==0.1.3</code> on a large codebase, I noticed some issues during the review, I don&#x27;t want to describe each one separately, so I&#x27;ll put it all together here. If you need - please, please, saw it into subtasks (I can&#x27;t do it, because MR with changes is big and I&#x27;m already tired of looking into it).</p>
<ol>
<li></li>
</ol>
<pre><code>            raise TypeError(
+               &quot;some: {}. &quot; &quot;bar&quot;.format(foobar),
-               &#x27;some: {}. &#x27; &quot;bar&quot;.format(foobar),
            )
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>        pending = [
            task_id
            for task_id, task_data in response.items()
-           if task_id not in completed and
+           if task_id not in completed
+           and
            # foo
            len(task_id) == UUID_LEN and
        ]
</code></pre>
<p>better:</p>
<pre><code>        pending = [
            task_id
            for task_id, task_data in response.items()
-           if task_id not in completed and
+           if task_id not in completed
            # foo
-           len(task_id) == UUID_LEN and
+           and len(task_id) == UUID_LEN and
        ]
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>        if &#x27;foo&#x27; in keys:
-           sql = &#x27;&#x27;&#x27;`a` = `b` + VALUES(`a`),&#x27;&#x27;&#x27;
+           sql = &quot;&quot;&quot;
+               `a` = `b` + VALUES(`a`),
+           &quot;&quot;&quot; 
</code></pre>
<p>better (no quotation marks inside the string):</p>
<pre><code>        if &#x27;foo&#x27; in keys:
-           sql = &#x27;&#x27;&#x27;`a` = `b` + VALUES(`a`),&#x27;&#x27;&#x27;
+           sql = &#x27;`a` = `b` + VALUES(`a`),&#x27;
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>-            foo = f&#x27;&#x27;&#x27;date &gt; toDate(&#x27;{start}&#x27;)&#x27;&#x27;&#x27;
+            foo = f&quot;&quot;&quot;date &gt; toDate(&#x27;{start}&#x27;)&quot;&quot;&quot;
</code></pre>
<p>better:</p>
<pre><code>-            foo = f&#x27;&#x27;&#x27;date &gt; toDate(&#x27;{start}&#x27;)&#x27;&#x27;&#x27;
+            foo = f&quot;date &gt; toDate(&#x27;{start}&#x27;)&quot;
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>-&#x27;&#x27;&#x27;
+&quot;&quot;&quot;
some comment in multiline string
foo bar
-&#x27;&#x27;&#x27;
+&quot;&quot;&quot;
</code></pre>
<p>better (use comment, if it comment):</p>
<pre><code>-&#x27;&#x27;&#x27;
-some comment in multiline string
+# some comment in multiline string
-foo bar
+# foo bar
-&#x27;&#x27;&#x27;
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>    foo = func(
-        &#x27;&#x27;&#x27;
+        &quot;&quot;&quot;
        SELECT a, b, c FROM bar
-   &#x27;&#x27;&#x27;,
+   &quot;&quot;&quot;,
    )
</code></pre>
<p>better:</p>
<pre><code>    foo = func(
-        &#x27;&#x27;&#x27;
+        &quot;&quot;&quot;
        SELECT a, b, c FROM bar
-   &#x27;&#x27;&#x27;,
+        &quot;&quot;&quot;,
    )
</code></pre>
<ol>
<li>Why?</li>
</ol>
<pre><code>-        self.assertEqual(&#x27;foo `;\&#x27; or `&quot;\&#x27; bar&#x27;, foo)
+        self.assertEqual(&quot;foo `;&#x27; or `\&quot;&#x27; bar&quot;, foo)
</code></pre>
<ol>
<li>⚠️</li>
</ol>
<pre><code>-    SOME: str = (
-        &quot;DELETE FROM {0} WHERE `id` = {1} AND `parent_id` = &#x27;{2}&#x27;&quot;
-    )
+    SOME: (
+        str
+    ) = &quot;DELETE FROM {0} WHERE `id` = {1} AND `parent_id` = &#x27;{2}&#x27;&quot;
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>return {
    v: (va[v], count)
    for v, count in vy.items()
    if v in va
    and (
        # comment
-        count &lt; th
-        or v not in vt
+        count &lt; th or v not in vt
    )
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-01 22:03</div>
            <div class="timeline-body"><p>I believe (8) is already fixed in v0.1.3 -- if you remove the parentheses around the <code>(str)</code>, and re-run, it won&#x27;t re-add them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-01 23:22</div>
            <div class="timeline-body"><p>Hey @saippuakauppias. Thanks for listing all these examples that you find worth improving. Could yo provide some more information to help me triage the issue?</p>
<ul>
<li>did you use Black before and this is a list of examples where Ruff formatted code differently to Black?</li>
<li>What&#x27;s your ruff formatter configuration?</li>
<li>if you used black, what was your black configuration?</li>
</ul>
<p>Out of interest if you don&#x27;t mind sharing: How large is the repository (lines of code, number of files)? How long does it take ruff to format all files? How long did formatting take using black</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-01 23:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-06 14:10</div>
            <div class="timeline-body"><p>Will take these into advisement but going to close for now in the absence of more info. Thanks for filing!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-06 14:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:45 UTC
    </footer>
</body>
</html>
