<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>polars vet? - astral-sh/ruff #7721</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>polars vet?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7721">#7721</a>
        opened by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>
        on 2023-09-30 12:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MarcoGorelli">@MarcoGorelli</a></div>
            <div class="timeline-body">

<p>Hello,</p>
<p>I&#x27;ve noticed that <code>ruff</code> has a <code>pandas-vet</code> plugin. Would you open to adding a Polars-vet one?</p>
<p>It could make suggestions such as</p>
<pre><code>- pl.read_csv(file_name).lazy()
+ pl.scan_csv(file_name)
</code></pre>
<p>or</p>
<pre><code>- df.select(pl.col(&#x27;a&#x27;).map_elements(lambda lst: &#x27; &#x27;.join([str(x) for x in lst])))
+ df.select(pl.col(&#x27;a&#x27;).list.join(&#x27; &#x27;))
</code></pre>
<p>which can have a real impact on performance</p>
<p>I could try putting something together if you&#x27;d be open to it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-30 17:13</div>
            <div class="timeline-body"><p>I&#x27;m happy to add something like this! I&#x27;d prefer if we had a non-trivial set of rules in mind (e.g., at least five or so?) before we started to add them. I want to avoid a situation in which we create a new category, add one rule, then fail to expand it to a meaningful set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-30 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a> on 2023-09-30 18:08</div>
            <div class="timeline-body"><p>Sure, thanks! For a start, there&#x27;s all the rewrites from <a href="https://github.com/pola-rs/polars/issues/9968">pola-rs/polars#9968</a>, such as</p>
<pre><code>- pl.col(&#x27;a&#x27;).map_elements(lambda x: np.sin(x))
+ pl.col(&#x27;a&#x27;).sin()

- pl.col(&#x27;a&#x27;).map_elements(lambda x: x+1)
+ (pl.col(&#x27;a&#x27;) + 1)

- pl.col(&#x27;a&#x27;).map_elements(lambda x: json.loads(x))
+ pl.col(&quot;a&quot;).str.json_extract()

- pl.col(&#x27;a&#x27;).map_elements(lambda x: dt.datetime.strptime(x, &quot;%Y-%m-%d&quot;))
+ pl.col(&#x27;a&#x27;).str.to_datetime(format=&#x27;%Y-%m-%d&#x27;)

- pl.col(&#x27;a&#x27;).map_elements(lambda x: x.upper())
+ pl.col(&quot;a&quot;).str.to_uppercase()
</code></pre>
<p>. Within Polars, warnings are emitted for some of these by parsing the bytecode of the passed function - but as Ruff deals with the AST, then I&#x27;d expect it to be possible to cover a lot more from that list</p>
<p>The full list of test cases is here, there&#x27;s quite a few already:</p>
<p>https://github.com/pola-rs/polars/blob/f3142ccd321873d7be5b339fd6ec5536e8c3153e/py-polars/tests/test_udfs.py#L28-L144</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ritchie46">@ritchie46</a> on 2023-09-30 18:35</div>
            <div class="timeline-body"><p>Any read operation followed by a lazy is very fishy.</p>
<p>E.g. <code>pl.read_parquet(..).lazy()</code> should suggest <code>pl.scan_parquet(..)</code>.</p>
<p>And that for all our scan supported file types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stinodego">@stinodego</a> on 2023-10-19 11:05</div>
            <div class="timeline-body"><p>One more suggestion in the &#x27;lazy&#x27; category:</p>
<pre><code>- DataFrame(...).lazy()
+ LazyFrame(...)
</code></pre>
<p>Maybe one for assertions (the equality statements would result in an error):</p>
<pre><code>- assert s1 == s2
+ assert_series_equal(s1, s2)

- assert df1 == df2
+ assert_frame_equal(df1, df2)

- assert lf1 == lf2
+ assert_frame_equal(lf1, lf2)

- assert s1 != s2
+ assert_series_not_equal(s1, s2)
...

</code></pre>
<p>One for <code>select</code>/<code>with_columns</code>:</p>
<pre><code>- df.select(pl.all(), ...)
+ df.with_columns(...)

- df.select(pl.col(&quot;*&quot;), ...)
+ df.with_columns(...)
</code></pre>
<p>Keyword syntax in <code>select</code>/<code>with_columns</code>:</p>
<pre><code>- df.select(pl.col(&#x27;a&#x27;).abs().alias(&#x27;abs&#x27;))
+ df.select(abs=pl.col(&#x27;a&#x27;).abs())
</code></pre>
<p>Keyword syntax in <code>filter</code>:</p>
<pre><code>- df.filter(pl.col(&#x27;a&#x27;) == &#x27;foo&#x27;)
+ df.filter(a=&#x27;foo&#x27;)
</code></pre>
<p>Using positional args instead of lists where possible:</p>
<pre><code>- df.sort([&#x27;a&#x27;, &#x27;b&#x27;])
+ df.sort(&#x27;a&#x27;, &#x27;b&#x27;)
</code></pre>
<p>...I&#x27;m sure I can come up with more :smile:
@MarcoGorelli Is this enough input?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MRigal">@MRigal</a> on 2025-10-07 11:04</div>
            <div class="timeline-body"><p>In 2025, with increasing polars adoption, this would still be very cool!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:43 UTC
    </footer>
</body>
</html>
