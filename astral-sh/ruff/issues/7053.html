<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter parenthesizes and expands multiple-assigment values - astral-sh/ruff #7053</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter parenthesizes and expands multiple-assigment values</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7053">#7053</a>
        opened by <a href="https://github.com/cnpryer">@cnpryer</a>
        on 2023-09-01 20:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-09-01 20:32</div>
            <div class="timeline-body"><p>I actually really like this result. Reporting anyway. I thought this was reported already, I but couldn't find any issues.</p>
<p>Line-length: 88</p>
<p>Black (23.7.0):</p>
<pre><code class="language-py">def some_fn() -&gt; None:
    s_aaaaaaa1, s_aaaaaaa2 = df1[&quot;aaaaaaaaaaaaaaaaa&quot;].rename(&quot;aaa&quot;), df2[
        &quot;aaaaaaaaaaaaaaaaa&quot;
    ].rename(&quot;aaa&quot;)
</code></pre>
<p>Ruff (0.0.287):</p>
<pre><code class="language-py">def some_fn() -&gt; None:
    s_aaaaaaa1, s_aaaaaaa2 = (
        df1[&quot;aaaaaaaaaaaaaaaaa&quot;].rename(&quot;aaa&quot;),
        df2[&quot;aaaaaaaaaaaaaaaaa&quot;].rename(&quot;aaa&quot;),
    )
</code></pre>
<p>Playground: https://play.ruff.rs/c2cc8a7c-e525-4d3f-8c6c-8063f2272ba1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @charliermarsh on 2023-09-01 23:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-02 08:12</div>
            <div class="timeline-body"><p>This matches <a href="https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AELAIZdAD2IimZxl1N_WlbvK5V_r8p8RWVQQnw9iapsVWAURY3SxClurVnV7aXA1aSAFyJDV_6KbhdEOAF6iWHwQpsW8LqvZgg0uA8_AllGpgDXu-99fTtWZaXXli_pe1jrTl-Pusr6e6XNQgFQsZYiQf0UEuVCiygH0IBiAkjiBxZoJLpZsqRswVAAAAAA6vtt-_240qIAAaIBjAIAAGWQ6g6xxGf7AgAAAAAEWVo=">Black's preview style</a> and IMO, is more readable overall.</p>
<p>How frequent was this change in your code base? I recommend leaving as is if it was a rare change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-09-02 08:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-02 11:25</div>
            <div class="timeline-body"><p>In general, I find it reasonable not to fix deviations that already exist in Black's preview style, though of course depends on how common they are, how hard they are to fix, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-09-02 12:23</div>
            <div class="timeline-body"><p>This was the most frequently altered pattern. It's common throughout my test suite.</p>
<p>Very much prefer this though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-09-02 12:34</div>
            <div class="timeline-body"><p>I'm going to update the snippet I provided for clarity. Looks like these are all series-based tests.</p>
<p>Edit: Heh, can't copy the new playground link on mobile. I'll fix in a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2023-09-04 07:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-04 07:50</div>
            <div class="timeline-body"><p>Okay this has a different reason than I initially thought and you correctly called it out:</p>
<blockquote>
<p>I'm going to update the snippet I provided for clarity. Looks like these are all series-based tests.</p>
</blockquote>
<p>The issue is that ruff prefers parenthesizing the tuple in assignment positions rather than breaking them left to right (the default is right to left). I personally find this much easier to read. I struggled a lot scanning what the assignment targets and what the values are.</p>
<p>This is probably related to another Ruff deviation in relation with Tuples:</p>
<p>Ruff is inserting parentheses for tuple's in more places than Black. I wasn't aware that this is also happening in assignments, but we're deviating in expression statements because I and @konstin believe that it overall improves readability. For example a common incorrect use of tuples in django (<a href="https://github.com/django/django/pull/17181">PR</a>) was</p>
<pre><code class="language-python">label_for_field(&quot;nonexistent&quot;, Article, form=ArticleForm()),
</code></pre>
<p>Which clearly is an incidental use of tuples. Ruff formats this as</p>
<pre><code>(label_for_field(&quot;nonexistent&quot;, Article, form=ArticleForm()),)
</code></pre>
<p>This makes the tuple very prominent, making you aware of the potential mistake (but Ruff removes the parentheses once there are at least two values).</p>
<p>I'm interested to hear @konstin opinion on this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-04 07:53</div>
            <div class="timeline-body"><blockquote>
<p>This matches <a href="https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AELAIZdAD2IimZxl1N_WlbvK5V_r8p8RWVQQnw9iapsVWAURY3SxClurVnV7aXA1aSAFyJDV_6KbhdEOAF6iWHwQpsW8LqvZgg0uA8_AllGpgDXu-99fTtWZaXXli_pe1jrTl-Pusr6e6XNQgFQsZYiQf0UEuVCiygH0IBiAkjiBxZoJLpZsqRswVAAAAAA6vtt-_240qIAAaIBjAIAAGWQ6g6xxGf7AgAAAAAEWVo=">Black's preview style</a> and IMO, is more readable overall.</p>
<p>How frequent was this change in your code base? I recommend leaving as is if it was a rare change.</p>
</blockquote>
<p>I need to revise this statement. Black's preview style isn't changing the output. The output only changes when the tuple on the right is parenthesized in the source, in which case Black preserves the parentheses.</p>
<p>I suspect that Black uses the &quot;can omit optional parentheses&quot; layout for the tuple on the right which I think we could mimic by using <code>in_parentheses_only_group</code> and <code>in_parentheses_only_soft_line_break</code>. We could try using  <code>TupleParentheses::OptionalParentheses</code> for assignment values.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-04 12:24</div>
            <div class="timeline-body"><blockquote>
<p>I'm interested to hear @konstin opinion on this issue.</p>
</blockquote>
<p>For the given example, i strongly prefer the ruff style over the black stable style, i find the black stable style confusing wrt to seeing that the RHS is a tuple expression. I'm a bit worried though that there are cases where the deviations are unintended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-13 07:40</div>
            <div class="timeline-body"><p>Related to #7317 Closing to track the discussion there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-09-13 07:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
