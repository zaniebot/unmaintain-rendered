<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Not autofixing `F901` when `raise NotImplemented` - astral-sh/ruff #6663</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Not autofixing `F901` when `raise NotImplemented`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/6663">#6663</a>
        opened by <a href="https://github.com/jamesbraza">@jamesbraza</a>
        on 2023-08-17 22:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2023-08-17 22:48</div>
            <div class="timeline-body"><p>I am using <code>ruff==0.0.285</code> on the below code:</p>
<pre><code class="language-python">class Foo:
    def __eq__(self, other: object) -&gt; bool:
        if not isinstance(other, type(self)):
            raise NotImplemented  # Erroneous code, and ruff autofix can be considered erroneous too
        return object.__eq__(self, other)
</code></pre>
<p><code>F901</code> (<a href="https://beta.ruff.rs/docs/rules/raise-not-implemented/"><code>raise-not-implemented</code></a>) autofixes line 4 to <code>raise NotImplementedError</code>.</p>
<p>However, this is actually undesirable in this case, because the correct fix is actually <code>return NotImplemented</code>.</p>
<pre><code class="language-python">class Foo:
    def __eq__(self, other: object) -&gt; bool:
        if not isinstance(other, type(self)):
            return NotImplemented  # Now this is correct
        return object.__eq__(self, other)
</code></pre>
<p>In conclusion, I think <code>raise NotImplemented</code> should not be auto-fixed to <code>raise NotImplementedError</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-18 03:30</div>
            <div class="timeline-body"><p>Could we not detect and suggest <code>return NotImplemented</code> when inside of a supported method? FWIW, I also think this is perfectly fine as a suggested fix (which will be opt-in once we respect those on the CLI), since it's likely to be correct in the vast majority of cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-08-18 03:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2023-08-18 04:39</div>
            <div class="timeline-body"><blockquote>
<p>Could we not detect and suggest return NotImplemented when inside of a supported method?</p>
</blockquote>
<p>Yeah that sounds great! üëç</p>
<p>Would you repurpose <code>F901</code>/<code>raise-not-implemented</code> to handle that?  I am not sure how close <code>ruff</code> stays to the original <code>flake8</code> rules' intent, or would you make a new <code>RUF</code> rule for it?</p>
<p>Also, what is CLI0?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-18 04:41</div>
            <div class="timeline-body"><p>Hmm -- maybe we'd avoid raising F901 in such cases, and we could add a new rule in <code>RUF</code> to detect this alternate case (though open to alternatives, it's late and that's just the first idea that popped into my head).</p>
<blockquote>
<p>Also, what is CLI0?</p>
</blockquote>
<p>Sorry, that was a type -- it meant to say &quot;CLI&quot; followed by a closing parenthesis :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> removed by @charliermarsh on 2023-08-18 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-08-18 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-08-18 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2023-08-18 04:59</div>
            <div class="timeline-body"><p>I am thinking the behavior could be:</p>
<ol>
<li><code>raise NotImplementedError(&quot;has message&quot;)</code>, anywhere: this is fine</li>
<li><code>return NotImplemented</code> inside of <code>object</code> comparison methods: this is fine</li>
<li><code>return NotImplemented</code> outside of <code>object</code> comparison methods: <code>RUF###</code>/<code>improper-return-not-implemented</code>, no autofix</li>
<li><code>raise NotImplemented</code> inside of <code>object</code> comparison methods: <code>RUF###</code>/<code>improper-return-not-implemented</code>, and <code>RUF###</code> overrides <code>F901</code> if both are enabled</li>
<li><code>raise NotImplemented</code> outside of <code>object</code> comparison methods: <code>F901</code>/<code>raise-not-implemented</code>, with autofix</li>
</ol>
<p>I would lean towards making an autofix for point 4 because:</p>
<ul>
<li>We know we're inside an <code>object</code> comparison method</li>
<li>Developer didn't specify a message</li>
</ul>
<p>So it's safe to assume <code>return NotImplemented</code> was desired.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaywonchung">@jaywonchung</a> on 2024-06-07 01:58</div>
            <div class="timeline-body"><p>I just hit this situation. I also think suggesting to replace <code>raise NotImplemented</code> with <code>raise NotImplementedError</code> can be misleading. I think another way to handle this is to simply update the error message from</p>
<blockquote>
<p>raise NotImplemented should be raise NotImplementedError</p>
</blockquote>
<p>to something along the lines of</p>
<blockquote>
<p>raise NotImplemented should either be raise NotImplementedError or return NotImplemented (if you're overloading binary special methods)</p>
</blockquote>
<p>The phrase <em>binary special methods</em> was taken from the <a href="https://docs.python.org/3/library/constants.html#NotImplemented">Python documentation of <code>NotImplemented</code></a>.</p>
<p>This will make Ruff's F901 slightly deviate from the original pyflakes8 specification. I personally find no problem with that because I think this is a strict enhancement, but it would be a project policy decision.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calliecameron">@calliecameron</a> on 2025-09-06 13:59</div>
            <div class="timeline-body"><p>It might also be useful to detect <code>raise NotImplementedError</code> inside binary special methods - although this is allowed if the method hasn't been implemented yet, I've come across code where it's used accidentally in place of <code>return NotImplemented</code>.</p>
<p>I.e. add another rule that only allows <code>raise NotImplementedError</code> inside binary special methods if it's the only line in the method?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calliecameron">@calliecameron</a> on 2025-09-06 19:53</div>
            <div class="timeline-body"><p>Actually, maybe the rule should detect <code>raise NotImplementedError</code> in <em>any</em> non-abstract method, since the only(?) uses of it are in abstract methods or to temporarily mark methods that will be implemented later - and a warning ensures these won't be forgotten. Thoughts?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:10 UTC
    </footer>
</body>
</html>
