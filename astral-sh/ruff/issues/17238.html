<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] improve function and class literal type display - astral-sh/ruff #17238</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] improve function and class literal type display</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/17238">#17238</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-04-06 18:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/carljm">@carljm</a> on 2025-04-06 18:36</div>
            <div class="timeline-body"><p>The <code>Literal[..]</code> display doesn't match the spec or other type checkers and is confusing.</p>
<p>The display for function types should include the signature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @carljm on 2025-04-06 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Red Knot Alpha" by @carljm on 2025-04-06 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] improve functiona and class literal type display" to "[red-knot] improve function and class literal type display" by @carljm on 2025-04-06 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-04-06 20:10</div>
            <div class="timeline-body"><p>I'll take it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @mishamsk by @carljm on 2025-04-06 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-06 21:16</div>
            <div class="timeline-body"><p>In which places is it confusing. In our mdtests or on hover/inlay hints?</p>
<p>I'm asking because on hover needs custom rendering anyway to render pretty markdown and we could also use a different render for inlay hints</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-04-06 21:43</div>
            <div class="timeline-body"><p>I think we should avoid significant differences between our rendering of types in any of those places; it will just cause more confusion if we aren't even consistent about how a type is spelled. There may of course be some presentation-related details that differ, but the basic text we use to represent a given type should always be the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-07 06:39</div>
            <div class="timeline-body"><p>Sounds painful to update all our mdtests.</p>
<p>I do expect some difference between reveal_type and on-hover where on-hover will only show the signature (but not the type) for classes, functions, methods, and maybe more. E.g. pyright renders a function as <code>def foo(a: int) -&gt; str</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-04-07 10:40</div>
            <div class="timeline-body"><p>I agree that the type we display when users call <code>reveal_type</code> on a function-literal or class-literal is currently quite confusing and that it should be high priority for us to improve it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-04-07 14:11</div>
            <div class="timeline-body"><p>I was assuming we are just changing from <code>Literal[some_type.some_bound_symbol]</code> to <code>(args...) -&gt; return_ty</code> for <code>reveal_type</code> and by extension LSP.</p>
<blockquote>
<p>Sounds painful to update all our mdtests.</p>
</blockquote>
<p>Yes. But I've already done such things, I am fine doing this as long as we quickly merge a PR, so I do not have to constantly update test files as main is moving ahead.</p>
<p>Are we aligned on the scope here? @carljm @MichaReiser @AlexWaygood</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-04-07 17:41</div>
            <div class="timeline-body"><blockquote>
<p>I do expect some difference between reveal_type and on-hover where on-hover will only show the signature (but not the type) for classes, functions, methods, and maybe more. E.g. pyright renders a function as <code>def foo(a: int) -&gt; str</code></p>
</blockquote>
<p>This description seems backwards to me from pyright's actual behavior? For a function literal <code>f</code>, pyright renders it on-hover as &quot;(function) def f(x: int) -&gt; str&quot;, and on <code>reveal_type</code> gives just <code>(x: int) -&gt; str</code>. I'm not too bothered by that minimal level of difference, though I also don't see any strong rationale <em>not</em> to include the function name in <code>reveal_type</code> and make them even more similar. I think we should keep them identical until/unless we have strong and clear reasons to do otherwise.</p>
<blockquote>
<p>I was assuming we are just changing from <code>Literal[some_type.some_bound_symbol]</code> to <code>(args...) -&gt; return_ty</code> for <code>reveal_type</code> and by extension LSP.</p>
</blockquote>
<p>I would be inclined to include the function name for a function literal (as that's one of the few things that distinguishes it from a general callable type), so more like <code>f(x: int) -&gt; str</code>. But otherwise yes, your assumption matches my intention in filing this issue.</p>
<blockquote>
<p>Yes. But I've already done such things, I am fine doing this as long as we quickly merge a PR, so I do not have to constantly update test files as main is moving ahead.</p>
</blockquote>
<p>Thank you, and makes sense. The one thing I would suggest is to first push just the change without the mdtest updates and make sure we are all happy with how the new format looks in all tested cases (with the new inline mdtest failures on CI, it will be easy to see the differences even if mdtests are failing). Once we are confirmed happy with the new format, then update the mdtests and land immediately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17294.html">astral-sh/ruff#17294</a> on 2025-04-08 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17889.html">astral-sh/ruff#17889</a> on 2025-05-06 13:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-05-07 00:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
