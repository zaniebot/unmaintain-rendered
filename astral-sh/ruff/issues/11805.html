<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot setup ruff-lsp configuration in Helix config file - astral-sh/ruff #11805</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot setup ruff-lsp configuration in Helix config file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11805">#11805</a>
        opened by <a href="https://github.com/ondrej-ivanko">@ondrej-ivanko</a>
        on 2024-06-08 18:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ondrej-ivanko">@ondrej-ivanko</a></div>
            <div class="timeline-body"><p>Hi,</p>
<p>I tried to set up global settings for ruff-lsp/ruff. I am aware that such settings could be done with ruff.toml file in <code>~/.config/ruff/ruff.toml</code>. What I wanted to try is set up the same configuration in helix file languages.toml located in <code>~/.config/helix/languages.toml</code> as per documentation, it should be <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_server/docs/setup/HELIX.md">possible</a></p>
<p>I tried changing <code>flake8-pytest-style</code> subsection</p>
<p>Neither this approach:
<img src="https://github.com/astral-sh/ruff-lsp/assets/44980578/c2c17af7-8847-4e74-b95f-e2673f4b0e35" alt="Screenshot from 2024-06-08 20-15-34" /></p>
<p>Nor this have worked.
<img src="https://github.com/astral-sh/ruff-lsp/assets/44980578/6148d09e-6f75-4363-87fa-639c4300e476" alt="Screenshot from 2024-06-08 20-16-20" /></p>
<p>It's just one example of single setting. The result is the same with other kind of settings in lint subsections.</p>
<p>Besides this issue, the lsp server works just fine.</p>
<p>I can enforce these settings by putting ruff.toml to project level directory with desired settings.</p>
<p>These kind of settings are not defined anywhere else. <code>Pyproject.toml</code> does not contain any ruff configuration. Ruff lsp is run only with <code>server --preview</code> args per documentation.</p>
<p>What's interesting is that err codes to be ignored defined in <code>[language-server.ruff.config.settings.lint]</code> are being actually registered and ignored by lsp, so I reckon it's only related to settings in subsections of <code>lint</code> key</p>
<p>By looking at helix logs, there is not issue with ruff server.</p>
<p>Version:
<code>ruff 0.4.8</code>
<code>ruff-lsp 0.0.53</code>
<code>helix 24.3 (44504b72)</code> - it's bleeding edge build</p>
<p>EDIT: The ruff-lsp does not seem to find or look for configuration file in <code>~/.config/ruff/ruff.toml</code></p>
<p>I tried running ruff lsp with this config in helix config file:</p>
<pre><code>[language-server.ruff]
command = &quot;ruff&quot;
args = [&quot;server&quot;, &quot;--preview&quot;, &quot;--config&quot;, &quot;/home/oji/.config/ruff/ruff.toml&quot;, &quot;--isolated&quot;]
</code></pre>
<ul>
<li>the configuration file lint subsections were still ignored.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-06-08 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2024-06-08 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-08 20:37</div>
            <div class="timeline-body"><p>Moving this to Ruff because it looks like you're using the native server (<code>ruff server</code>) rather than <code>ruff-lsp</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @charliermarsh on 2024-06-08 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-08 20:38</div>
            <div class="timeline-body"><p>Can you share how you determined that &quot;The ruff-lsp does not seem to find or look for configuration file in <code>~/.config/ruff/ruff.toml</code>&quot;? Did you restart the server after adding that configuration file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ondrej-ivanko">@ondrej-ivanko</a> on 2024-06-08 21:39</div>
            <div class="timeline-body"><p>Hi @charliermarsh, sry if there is any confusion. What I wrote is that the specific definitions for how ruff should treat certain &quot;errors&quot; is ignored when defined in subsections of <code>lint</code> key in the <code>~/.config/ruff/ruff.toml</code>.</p>
<p>It seems the ruff only uses certain keys from toml file to configure ruff server. When I set up changes in <code>[lint.flake8-annotations]</code> for example, it did not have any impact on what lint messages were displayed in the Helix IDE. Only when the same changes were made in <code>ruff.toml</code> on project level. This behaviour applied to all subsections of <code>lint</code> key that I tried.</p>
<p>I restarted server every time I made change to the configuration either by leaving the IDE or by restarting the lsp-server in IDE itself.</p>
<p>I was under the impression that <code>ruff server</code> start s<code>ruff-lsp</code> server.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @snowsignal by @snowsignal on 2024-06-10 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andrewcrook">@andrewcrook</a> on 2024-06-10 16:00</div>
            <div class="timeline-body"><blockquote>
<p>I was under the impression that ruff server start sruff-lsp server.</p>
</blockquote>
<p>Correct me if I am wrong but I think</p>
<p>ruff-lsp is a third-party wrapper for ruff. Ruff didn’t have a lsp server originally.
ruff server --preview  was the  preview of the native (built in)  lsp server
I believe the native lsp is production ready and ruff-lsp isn't required anymore, unless it offers something different.</p>
<p>Personally I haven't gotten the native ruff lsp to work with neovim under lspconfig yet</p>
<p>On a side note. You have to be careful when you see server or daemon with type checks, linters and formatters because with some its an lsp interface and with others its running as a daemon for quicker start up times.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-10 17:01</div>
            <div class="timeline-body"><blockquote>
<p>Personally I haven't gotten the native ruff lsp to work with neovim under lspconfig yet</p>
</blockquote>
<p>@andrewcrook If this isn't too much to ask - could you file an issue describing what you're doing and what's going wrong? I'd like to help you figure this out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-10 17:37</div>
            <div class="timeline-body"><blockquote>
<p>ruff-lsp is a third-party wrapper for ruff. Ruff didn’t have a lsp server originally.
ruff server --preview was the preview of the native (built in) lsp server
I believe the native lsp is production ready and ruff-lsp isn't required anymore, unless it offers something different.</p>
</blockquote>
<p>Mostly right. <code>ruff-lsp</code> is an official Ruff thing (so it's &quot;first-party&quot; in that sense), but it is indeed a Python wrapper around the Ruff CLI that implements the Language Server Protocol. <code>ruff server</code> is the native, built-in LSP server. Our intent is to eventually sunset <code>ruff-lsp</code> (which we maintain) in favor of <code>ruff server</code>, but <code>ruff server</code> is currently in Beta.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-10 18:02</div>
            <div class="timeline-body"><p>@ondrej-ivanko The reason why the <code>flake8-pytest-style</code> setting isn't working is because right now, we only expose a subset of Ruff's settings through the LSP settings. A list of the available settings can be found <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_server/docs/MIGRATION.md#new-settings">here</a>.</p>
<p>In this case, putting <code>flake8-pytest-style</code> in <code>~/.config/ruff/ruff.toml</code> is what you should be doing.</p>
<p>Also, you shouldn't have to pass <code>--config</code> to <code>ruff server</code> - we don't support this argument. instead, you can use the <code>configuration</code> setting like so:</p>
<pre><code class="language-toml">[language-server.ruff.config.settings]
configuration = &quot;~/.config/ruff/ruff.toml&quot;
</code></pre>
<p>I hope this helps!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ondrej-ivanko">@ondrej-ivanko</a> on 2024-06-10 18:24</div>
            <div class="timeline-body"><p>Ok @snowsignal, all is clearer now. Thank you. I will keep ruff configured via ruff.toml for now. I'm closing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ondrej-ivanko on 2024-06-10 18:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:26 UTC
    </footer>
</body>
</html>
