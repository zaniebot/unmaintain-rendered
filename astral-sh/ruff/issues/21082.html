<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw strings break the FLY002 fix - astral-sh/ruff #21082</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Raw strings break the FLY002 fix</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/21082">#21082</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-10-27 00:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-10-27 00:02</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When the argument to <code>str.join</code> contains only string literals and the first is raw, the fix for <a href="https://docs.astral.sh/ruff/rules/static-join-to-f-string/"><code>static-join-to-f-string</code> (FLY002)</a> can introduce a syntax error or change the program’s behavior.</p>
<p>If a subsequent string isn’t raw, its contents will be inserted into the fix’s string, regardless of syntax errors. <a href="https://play.ruff.rs/372f5506-c7bf-41ba-8ef7-fc3eafe725a8">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fly002_1.py &lt;&lt;'# EOF'
&quot;&quot;.join((r&quot;&quot;, '&quot;'))
# EOF

$ ruff check --isolated fly002_1.py --select FLY002 --unsafe-fixes --diff 2&gt;&amp;1 | grep error:
error: Fix introduced a syntax error. Reverting all changes.
</code></pre>
<p><a href="https://play.ruff.rs/503176c6-9a2e-428c-befc-1130af96d1e0">Another example</a>:</p>
<pre><code class="language-console">$ cat &gt;fly002_2.py &lt;&lt;'# EOF'
&quot;&quot;.join((r&quot;&quot;, &quot;\\&quot;))
# EOF

$ ruff check --isolated fly002_2.py --select FLY002 --unsafe-fixes --diff 2&gt;&amp;1 | grep error:
error: Fix introduced a syntax error. Reverting all changes.
</code></pre>
<p><a href="https://play.ruff.rs/83a55ba4-cf6f-4bd1-85ed-6824692f6dbd">Another example</a>:</p>
<pre><code class="language-console">$ cat &gt;fly002_3.py &lt;&lt;'# EOF'
&quot;&quot;.join((r&quot;&quot;, &quot;\0&quot;))
# EOF

$ ruff check --isolated fly002_3.py --select FLY002 --unsafe-fixes --fix
Found 1 error (1 fixed, 0 remaining).

$ xxd fly002_3.py
00000000: 7222 0022 0a                             r&quot;.&quot;.

$ python fly002_3.py 2&gt;&amp;1 | tail -n 1
SyntaxError: source code cannot contain null bytes
</code></pre>
<p>It can also change the program’s behavior. <a href="https://play.ruff.rs/35984440-7add-4737-a205-77af0417c5d2">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fly002_4.py &lt;&lt;'# EOF'
print(&quot;&quot;.join((r&quot;&quot;, r'&quot;.__class__.__name__, 0xA, sep=&quot;~')))
# EOF

$ python fly002_4.py
&quot;.__class__.__name__, 0xA, sep=&quot;~

$ ruff check --isolated fly002_4.py --select FLY002 --unsafe-fixes --fix
Found 1 error (1 fixed, 0 remaining).

$ cat fly002_4.py
print(r&quot;&quot;.__class__.__name__, 0xA, sep=&quot;~&quot;)

$ python fly002_4.py
str~10
</code></pre>
<p>If any string contains a carriage return via an escape sequence, the fix emits a multiline string containing a literal carriage return. Literal carriage returns are interpreted as line feeds, so this changes the program’s behavior. <a href="https://play.ruff.rs/a0fee72c-bb57-4a46-8410-672fd9039c5d">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;fly002_5.py &lt;&lt;'# EOF'
print(repr(&quot;&quot;.join((r&quot;&quot;, &quot;\r&quot;))))
# EOF

$ python fly002_5.py
'\r'

$ ruff check --isolated fly002_5.py --select FLY002 --unsafe-fixes --fix
Found 1 error (1 fixed, 0 remaining).

$ xxd fly002_5.py
00000000: 7072 696e 7428 7265 7072 2872 2222 220d  print(repr(r&quot;&quot;&quot;.
00000010: 2222 2229 290a                           &quot;&quot;&quot;)).

$ python fly002_5.py
'\n'
</code></pre>
<h3>Version</h3>
<p>ruff 0.14.2 (83a3bc4ee 2025-10-23)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/21087.html">astral-sh/ruff#21087</a> on 2025-10-27 00:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-10-27 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-10-27 13:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
