<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Doc] `reimplemented-starmap` does not mention performance - astral-sh/ruff #7771</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Doc] `reimplemented-starmap` does not mention performance</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7771">#7771</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2023-10-03 03:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Avasam">@Avasam</a> on 2023-10-03 03:08</div>
            <div class="timeline-body"><p>https://github.com/dosisod/refurb/blob/master/docs/checks.md#furb140-use-starmap mentions performance.</p>
<p>https://docs.astral.sh/ruff/rules/reimplemented-starmap/ does not</p>
<p>My local tests seem to agree:</p>
<pre><code class="language-py">from itertools import starmap
from timeit import timeit

def foo(a: int, b: str): pass

big_list = [&quot;*&quot;] * 99

def test_generator_comprehension():
    return (
        foo(index, value) for index, value
        in enumerate(big_list)
    )

def test_list_comprehension():
    return [
        foo(index, value) for index, value
        in enumerate(big_list)
    ]

def test_generator_starmap():
    return starmap(
        foo,
        enumerate(big_list),
    )

def test_list_starmap():
    return list(
        starmap(
            foo,
            enumerate(big_list),
        ),
    )

print(&quot;test_generator_comprehension&quot;, timeit(test_generator_comprehension))
print(&quot;test_list_comprehension&quot;, timeit(test_list_comprehension))
print(&quot;test_generator_starmap&quot;, timeit(test_generator_starmap))
print(&quot;test_list_starmap&quot;, timeit(test_list_starmap))

</code></pre>
<p>Python 3.9.13:</p>
<pre><code>test_generator_comprehension 0.3537939
test_list_comprehension 9.4948082
test_generator_starmap 0.22116740000000057
test_list_starmap 6.5608599000000005
</code></pre>
<p>Python 3.11.2 (surprisingly the generator comprehension is even slower in Python 3.11, despite the proclaimed comprehension speed improvements, list comprehension checks out):</p>
<pre><code>test_generator_comprehension 0.46688559994800016
test_list_comprehension 8.789011800021399
test_generator_starmap 0.24132720002671704
test_list_starmap 7.120547099970281
</code></pre>
<p>Scales similarly with a list of ~100 or ~1million items (the list examples takes forever though)</p>
<p>I think it would be important to mention as well. It is not insignificant (a little bit for list, ~2x for generators) and the doc makes it sounds like a simple stylistic change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2023-10-03 03:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @zanieb on 2023-10-03 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2023-10-04 02:03</div>
            <div class="timeline-body"><p>On Python 3.12 the listcomp is faster (likely thanks to PEP 709). Running @Avasam's benchmark:</p>
<pre><code>test_generator_comprehension 0.19647120800800622
test_list_comprehension 3.4521896250080317
test_generator_starmap 0.15749416704056785
test_list_starmap 3.6789443339803256
</code></pre>
<p>(The numbers for generators don't feel very meaningful as it's just for creating the generator, not iterating over it.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-10-07 09:54</div>
            <div class="timeline-body"><p>I ran the code passing the generators to <code>all</code> to make them actually do things.</p>
<p>On Python 3.11:</p>
<pre><code>test_generator_comprehension 3.9400883330017678
test_generator_starmap 2.439227167000354
</code></pre>
<p>On Python 3.12:</p>
<pre><code>test_generator_comprehension 4.032705583002098
test_generator_starmap 3.4624144999979762
</code></pre>
<p>So it looks like <code>itertools.starmap</code> is faster for generators, just not comprehensions.</p>
<p>(Accidentally deleted previous comment instead of editing it when trying to correct numbers, apologises for the noise.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7846.html">astral-sh/ruff#7846</a> on 2023-10-07 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-07 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14835.html">astral-sh/ruff#14835</a> on 2024-12-08 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../numpy/numpy/pulls/28879.html">numpy/numpy#28879</a> on 2025-05-01 15:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
