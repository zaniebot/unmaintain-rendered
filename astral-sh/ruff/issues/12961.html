<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idea: Test for bad version parsing `tuple(map(int, __version__)))` - astral-sh/ruff #12961</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Idea: Test for bad version parsing <code>tuple(map(int, __version__)))</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12961">#12961</a>
        opened by <a href="https://github.com/randolf-scholz">@randolf-scholz</a>
        on 2024-08-18 09:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/randolf-scholz">@randolf-scholz</a></div>
            <div class="timeline-body"><p>Inspired by a <a href="https://youtrack.jetbrains.com/issue/PY-75115">recent bug in pycharm</a>, caused by bad version parsing that went undetected until <code>matplotlib</code>, <a href="https://pypi.org/project/matplotlib/#history">for the first time in 20 years</a>, published a non-pre-release version with a postfix (<code>3.9.1.post1</code> on Aug 7th).</p>
What it does
<p>Checks for the presence of <code>tuple(map(int, obj.__version__.split(&quot;.&quot;)))</code> and equivalent variants thereof.</p>
Why this is bad
<p>This breaks if the package uses a postfix that is not convertible to integer, such as <code>matplotlib==3.9.1.post1</code>.</p>
Use instead
<p>Version string should be parsed using the PEP440 specification.</p>
<ul>
<li>PyPA&#x27;s <code>packaging</code> provides the <a href="https://packaging.pypa.io/en/latest/version.html">packaging.version</a> utility.</li>
<li>PEP440 provides a <a href="https://peps.python.org/pep-0440/#appendix-b-parsing-version-strings-with-regular-expressions">canonical regex</a> if one wants to avoid additional dependencies.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2024-08-18 09:57</div>
            <div class="timeline-body"><p>A quick <a href="https://github.com/search?q=%2Ftuple%5C%28map%5C%28int%2C+%5Cw%2B%5C.__version__.split%5C%28%5B%22%27%5D%5C.%5B%22%27%5D%5C%29%5C%29%5C%29%2F+language%3APython&amp;type=code">GitHub search</a> shows that this vulnerability is present in many packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:54</div>
            <div class="timeline-body"><p>I&#x27;m in favor of this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-18 13:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:57 UTC
    </footer>
</body>
</html>
