<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Jupyter Notebook ruff should ignore bash cells - astral-sh/ruff #6445</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>In Jupyter Notebook ruff should ignore bash cells</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6445">#6445</a>
        opened by <a href="https://github.com/shaneahmed">@shaneahmed</a>
        on 2023-08-09 12:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/shaneahmed">@shaneahmed</a> on 2023-08-09 12:01</div>
            <div class="timeline-body"><p>The command you invoked: <code>ruff check . --fix</code></p>
<p>Pre-commit yaml available here: https://github.com/TissueImageAnalytics/tiatoolbox/blob/d722f67f4c7584db6a6607544477613dee95aac0/.pre-commit-config.yaml#L75</p>
<p>The current Ruff settings (any relevant sections from your <code>pyproject.toml</code>) : https://github.com/TissueImageAnalytics/tiatoolbox/blob/d722f67f4c7584db6a6607544477613dee95aac0/pyproject.toml#L74</p>
<p>The current Ruff version (<code>ruff --version</code>) : 0.0.283</p>
<p>Pull request for this bug is available at this link: https://github.com/TissueImageAnalytics/tiatoolbox/pull/689</p>
<p>Issue:
The new version 0.0.283 generates errors for jupyter notebooks such as: <code>E402 Module level import not at top of file</code> when the first cell is a bash script which installs the package. This is useful for new users who want to test the jupyter notebooks on online platforms such as Google Colab or Anaconda Cloud.</p>
<p>While testing Jupyter Notebooks, ruff should ignore bash scripts at the top of the cell e.g., in this file https://github.com/TissueImageAnalytics/tiatoolbox/blob/upgrade-ruff-version/examples/01-wsi-reading.ipynb the first cell installs the package on Colab which is not available already. Similarly print statements in this cell should be ignored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-09 13:51</div>
            <div class="timeline-body"><p>Hey, thanks for using Ruff with Jupyter Notebooks during the experimental phase :)</p>
<p>So, to give some context, earlier we would ignore any cells containing any of the IPython escape commands[^1]. This is because a cell could contain both the escape commands and valid Python code but it would fail to parse the escape commands. With the recent release, we've added support for parsing such commands and thus we don't ignore such cells. However, a cell is still ignored if it contains <a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#cell-magics">cell magics</a> as they're applied on the entire cell.</p>
<p>The reason we need to not ignore cells containing both Python code and escape commands is that otherwise we might raise false positive. For example, if cell 1 contains any escape command and an import statement and cell 2 contains the usage of that module, if we ignore cell 1 we would mark the module usage in cell 2 as <code>undefined-name</code>.</p>
<p>We <a href="https://astral.sh/blog/ruff-v0.0.276#jupyter-notebook-support">would recommend to ignore</a> certain rule codes for Jupyter Notebooks using <code>per-file-ignores</code>:</p>
<pre><code class="language-toml">[tool.ruff]
# Allow imports to appear anywhere in Jupyter Notebooks.
per-file-ignores = { &quot;*.ipynb&quot; = [&quot;E402&quot;] }
</code></pre>
<p>[^1]: <code>!pip install ...</code>, <code>%matplotlib ...</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-09 13:55</div>
            <div class="timeline-body"><p>(closing as intended behavior)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-08-09 13:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shaneahmed">@shaneahmed</a> on 2023-08-09 16:04</div>
            <div class="timeline-body"><p>I understand Jupyter notebooks is still experimental but it is very useful. Thanks for this :)</p>
<p>Thanks for the suggestions. I now understand the problem and have modified the notebooks accordingly.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:10 UTC
    </footer>
</body>
</html>
