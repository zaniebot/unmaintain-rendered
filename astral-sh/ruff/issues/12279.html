<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server` QOL improvement: Make code action ordering more consistent - astral-sh/ruff #12279</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff server</code> QOL improvement: Make code action ordering more consistent</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12279">#12279</a>
        opened by <a href="https://github.com/ravibrock">@ravibrock</a>
        on 2024-07-10 16:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ravibrock">@ravibrock</a> on 2024-07-10 16:25</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hello,</p>
<p>I wanted to suggest that code action ordering be kept consistent. For example, in Neovim I have <code>&lt;leader&gt;ca</code> bound to toggling code actions, so it would be helpful if <code>&lt;leader&gt;ca 2</code> always selected &quot;Organize imports&quot;:</p>
<p><em>On line with no diagnostics:</em>
<img src="https://github.com/astral-sh/ruff/assets/66334356/a8ab6c5b-c548-4fd2-96df-667a5b9d2ece" alt="Screenshot 2024-07-10 at 11 22 44" />
<em>On line with diagnostics:</em>
<img src="https://github.com/astral-sh/ruff/assets/66334356/2710174c-588c-4b1a-8530-ae5537c4b5ac" alt="Screenshot 2024-07-10 at 11 23 12" /></p>
<p>Ideally, <code>1</code> and <code>2</code> would select the same thing in both cases since those options are always available.</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-11 04:43</div>
            <div class="timeline-body"><p>Thank you for the suggestion! For discussion around the current ordering, refer to https://github.com/astral-sh/ruff-lsp/issues/210.</p>
<p>The code actions that you've mentioned are the source level code actions i.e., they apply to an entire file. Currently, Ruff always provide the said code actions even if they're no-op but that could change in the future (https://github.com/astral-sh/ruff-lsp/issues/91). For example, the <code>Ruff: Organize imports</code> action won't be provided if there are no imports to organize.</p>
<p>I would instead suggest to use a keybinding if you always need to execute a specific source code action. For example, the following will apply the <code>Ruff: Organize imports</code> code actions:</p>
<pre><code class="language-lua">local function ruff_organize_imports()
	vim.lsp.buf.code_action {
	  context = {
	    only = { 'source.organizeImports.ruff' },
	  },
	  apply = true,
	}
end

vim.keymap.set('n', '&lt;leader&gt;oi', ruff_organize_imports, {
	desc = 'ruff: [o]rganize [i]mports'
})
</code></pre>
<p>Does this help?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2024-07-11 04:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ravibrock">@ravibrock</a> on 2024-07-11 05:03</div>
            <div class="timeline-body"><p>Ah, that looks good thank you! I might even modify that for use as a <code>BufWritePre</code> autocommand so I don't have to worry about organizing them by hand. And yeah, I see the benefits of the other approach too given the example in https://github.com/astral-sh/ruff-lsp/issues/210.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-07-11 06:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @dhruvmanila on 2025-01-07 05:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:20 UTC
    </footer>
</body>
</html>
