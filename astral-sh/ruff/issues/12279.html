<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server` QOL improvement: Make code action ordering more consistent - astral-sh/ruff #12279</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff server</code> QOL improvement: Make code action ordering more consistent</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12279">#12279</a>
        opened by <a href="https://github.com/ravibrock">@ravibrock</a>
        on 2024-07-10 16:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ravibrock">@ravibrock</a></div>
            <div class="timeline-body">

<p>Hello,</p>
<p>I wanted to suggest that code action ordering be kept consistent. For example, in Neovim I have <code>&lt;leader&gt;ca</code> bound to toggling code actions, so it would be helpful if <code>&lt;leader&gt;ca 2</code> always selected &quot;Organize imports&quot;:</p>
<p><em>On line with no diagnostics:</em>
<img src="https://github.com/astral-sh/ruff/assets/66334356/a8ab6c5b-c548-4fd2-96df-667a5b9d2ece" alt="Screenshot 2024-07-10 at 11 22 44">
<em>On line with diagnostics:</em>
<img src="https://github.com/astral-sh/ruff/assets/66334356/2710174c-588c-4b1a-8530-ae5537c4b5ac" alt="Screenshot 2024-07-10 at 11 23 12"></p>
<p>Ideally, <code>1</code> and <code>2</code> would select the same thing in both cases since those options are always available.</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-11 04:43</div>
            <div class="timeline-body"><p>Thank you for the suggestion! For discussion around the current ordering, refer to <a href="https://github.com/astral-sh/ruff-lsp/issues/210">astral-sh/ruff-lsp#210</a>.</p>
<p>The code actions that you&#x27;ve mentioned are the source level code actions i.e., they apply to an entire file. Currently, Ruff always provide the said code actions even if they&#x27;re no-op but that could change in the future (<a href="https://github.com/astral-sh/ruff-lsp/issues/91">astral-sh/ruff-lsp#91</a>). For example, the <code>Ruff: Organize imports</code> action won&#x27;t be provided if there are no imports to organize.</p>
<p>I would instead suggest to use a keybinding if you always need to execute a specific source code action. For example, the following will apply the <code>Ruff: Organize imports</code> code actions:</p>
<pre><code>local function ruff_organize_imports()
	vim.lsp.buf.code_action {
	  context = {
	    only = { &#x27;source.organizeImports.ruff&#x27; },
	  },
	  apply = true,
	}
end

vim.keymap.set(&#x27;n&#x27;, &#x27;&lt;leader&gt;oi&#x27;, ruff_organize_imports, {
	desc = &#x27;ruff: [o]rganize [i]mports&#x27;
})
</code></pre>
<p>Does this help?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-11 04:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ravibrock">@ravibrock</a> on 2024-07-11 05:03</div>
            <div class="timeline-body"><p>Ah, that looks good thank you! I might even modify that for use as a <code>BufWritePre</code> autocommand so I don&#x27;t have to worry about organizing them by hand. And yeah, I see the benefits of the other approach too given the example in <a href="https://github.com/astral-sh/ruff-lsp/issues/210">astral-sh/ruff-lsp#210</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-11 06:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-07 05:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:55 UTC
    </footer>
</body>
</html>
