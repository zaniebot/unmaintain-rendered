<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC003: Allow `TYPE_CHECKING = False` - astral-sh/ruff #16176</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>TC003: Allow `TYPE_CHECKING = False`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/16176">#16176</a>
        opened by <a href="https://github.com/hugovk">@hugovk</a>
        on 2025-02-15 15:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hugovk">@hugovk</a> on 2025-02-15 15:47</div>
            <div class="timeline-body"><h3>Description</h3>
<p>TC003:</p>
<blockquote>
<p>Checks for standard library imports that are only used for type annotations, but aren't defined in a type-checking block.</p>
</blockquote>
<p>https://docs.astral.sh/ruff/rules/typing-only-standard-library-import/#typing-only-standard-library-import-tc003</p>
<h2><code>TYPE_CHECKING = False</code></h2>
<pre><code class="language-python">from __future__ import annotations

TYPE_CHECKING = False
if TYPE_CHECKING:
    import os


def thing(locale: os.PathLike[str]) -&gt; None: ...
</code></pre>
<p>Ruff doesn't allow it:</p>
<pre><code class="language-sh">❯ ruff --version
ruff 0.9.6
❯ ruff check --select TC --isolated 1.py
1.py:5:12: TC003 Move standard library import `os` into a type-checking block
  |
3 | TYPE_CHECKING = False
4 | if TYPE_CHECKING:
5 |     import os
  |            ^^ TC003
  |
  = help: Move into type-checking block

Found 1 error.
</code></pre>
<p>But upstream https://pypi.org/project/flake8-type-checking/ does:</p>
<pre><code>❯ flake8 --version
7.1.1 (flake8-2020: 1.8.1, flake8-implicit-str-concat: 0.5.0, flake8-type-checking: 3.0.0, mccabe: 0.7.0, pycodestyle: 2.12.1, pyflakes: 3.2.0) CPython 3.13.2 on Darwin
❯ flake8 1.py
❯ 
</code></pre>
<h2><code>from typing import TYPE_CHECKING</code></h2>
<p>Both are fine with this:</p>
<pre><code class="language-python">from __future__ import annotations

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    import os
</code></pre>
<pre><code class="language-sh">❯ ruff check --select TC --isolated 1.py
All checks passed!

❯ flake8 1.py --statistics
❯ 
</code></pre>
<p>But the whole point of this <code>typing-only-standard-library-import</code> TC003 check is to avoid imports that are only needed for type checking:</p>
<blockquote>
<p>Unused imports add a performance overhead at runtime, and risk creating import cycles. If an import is only used in typing-only contexts, it can instead be imported conditionally under an <code>if TYPE_CHECKING:</code> block to minimize runtime overhead.</p>
</blockquote>
<p>See also:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/15681</li>
<li>https://github.com/astral-sh/ruff/pull/15719</li>
</ul>
<p>Which look like it should have fixed it in 0.9.5, but I can repro in 0.9.4-0.9.6.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-15 18:06</div>
            <div class="timeline-body"><p>Does this still repro if you use <code>--preview</code>? #15719 only changed the behaviour in preview mode for now, since it's technically a breaking change. We might be able to stabilise it in v0.10; if not, it'll probably be stabilised in v0.11 :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2025-02-15 18:11</div>
            <div class="timeline-body"><p>Hooray, it passes!</p>
<pre><code class="language-console">❯ ruff --version &amp;&amp; ruff check --select TC --isolated 1.py --preview
ruff 0.9.6
All checks passed!
</code></pre>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @hugovk on 2025-02-15 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-15 18:12</div>
            <div class="timeline-body"><p>no worries!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
