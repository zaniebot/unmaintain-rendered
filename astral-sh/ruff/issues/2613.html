<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`Removes quotes from annotations` removes quotes from literal values - astral-sh/ruff #2613</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>Removes quotes from annotations</code> removes quotes from literal values</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2613">#2613</a>
        opened by <a href="https://github.com/Czaki">@Czaki</a>
        on 2023-02-06 22:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Czaki">@Czaki</a></div>
            <div class="timeline-body">

<p>It looks like  #2431 also removes quotes from literal values in type annotation</p>
<p>In general, when bump ruff from 0.0.237 to 0.0.242 the following change is generated by ruff:</p>
<pre><code>Literal[&quot;x86_64&quot;, &quot;arm64&quot;]
</code></pre>
<p>to</p>
<pre><code>Literal[x86_64, arm64]
</code></pre>
<p>cibuilwheel PR with visible problem</p>
<p>https://github.com/pypa/cibuildwheel/pull/1412</p>
<p>The change, when force revert changes</p>
<p><a href="https://github.com/pypa/cibuildwheel/pull/1412/commits/923fd3c493f26461cd22a85ce736bb7cd54bc273">pypa/cibuildwheel@<code>923fd3c</code> (#1412)</a></p>
<p>And log from ruff:</p>
<p>https://results.pre-commit.ci/run/github/85508223/1675723555.oUgkXTipRmOlnOPISWV1OA</p>
<p>ruff configuration https://github.com/pypa/cibuildwheel/blob/e42277a69204ccfae9a1f4ae3b574eaa54109925/pyproject.toml#L120</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:02</div>
            <div class="timeline-body"><p>Thank you, I&#x27;ll fix this tonight and cut a new release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-06 23:04</div>
            <div class="timeline-body"><p>Breaking pypa/build too: <a href="https://github.com/pypa/build/pull/576">pypa/build#576</a>/files</p>
<pre><code>- PathType = Union[str, &#x27;os.PathLike[str]&#x27;]
+ PathType = Union[str, os.PathLike[str]]

- _TProjectBuilder = TypeVar(&#x27;_TProjectBuilder&#x27;, bound=&#x27;ProjectBuilder&#x27;)
+ _TProjectBuilder = TypeVar(&#x27;_TProjectBuilder&#x27;, bound=ProjectBuilder)
</code></pre>
<p>These are both broken. <code>os.PathLike[str]</code> is not valid on Python 3.7 (and it&#x27;s not an annotation). TypeVar can&#x27;t have the quotes removed, the thing it&#x27;s bound to doesn&#x27;t exist yet. And it&#x27;s also not an annotation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-06 23:07</div>
            <div class="timeline-body"><p>Also, I&#x27;d really love for a way to see see fixed operaitons too. I have no idea what rules were applied when things are &quot;fixed&quot;. Maybe there&#x27;s a flag I missed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:07</div>
            <div class="timeline-body"><p>In the <code>Literal</code> case, the issue is that you&#x27;re accessing <code>Literal</code> from a module that isn&#x27;t <code>typing</code> or <code>typing_extensions</code>.</p>
<p>For example, this doesn&#x27;t raise an error:</p>
<pre><code>from __future__ import annotations

from typing import Literal

x: Literal[&quot;x86_64&quot;, &quot;arm64&quot;]
</code></pre>
<p>But this does:</p>
<pre><code>from __future__ import annotations

from .typing import Literal

x: Literal[&quot;x86_64&quot;, &quot;arm64&quot;]
</code></pre>
<p>We use <a href="https://github.com/charliermarsh/ruff#typing-modules"><code>typing-modules</code></a> to fix this, but it doesn&#x27;t support relative imports right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:08</div>
            <div class="timeline-body"><blockquote>
<p>Also, I&#x27;d really love for a way to see see fixed operaitons too. I have no idea what rules were applied when things are &quot;fixed&quot;. Maybe there&#x27;s a flag I missed?</p>
</blockquote>
<p>There&#x27;s a <code>--diff</code> flag -- is that along the lines of what you&#x27;re describing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:15</div>
            <div class="timeline-body"><p>The issues that @henryiii raised are fixed in #2614.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:16</div>
            <div class="timeline-body"><p>I can add support for relative import paths with <code>typing-modules</code> to fix the issue @Czaki raised. (I&#x27;m actually surprised that hasn&#x27;t bitten you already prior to this lint rule!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-06 23:16</div>
            <div class="timeline-body"><p>I can see a diff of what changed via git, I just can&#x27;t see the list of rules that were applied to make those changes. For example, if I make a fixable change to a Ruby file and run rubocop:</p>
<pre><code>Inspecting 16 files
....C...........

Offenses:

_plugins/checkproj.rb:36:7: C: [Corrected] Style/RedundantReturn: Redundant return detected.
      return @people ||= people_gen
      ^^^^^^

16 files inspected, 1 offense detected, 1 offense corrected
</code></pre>
<p>I can see exactly what rules were applied in the fixes.</p>
<p>Something like <code>Fixed:\n</code> followed by the rules that were fixed, for example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-06 23:18</div>
            <div class="timeline-body"><p>The typing modules issue has bit before, it&#x27;s <a href="https://github.com/charliermarsh/ruff/issues/2005">charliermarsh/ruff#2005</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-06 23:45</div>
            <div class="timeline-body"><p>Gonna try and fix that tonight.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-07 00:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Czaki">@Czaki</a> on 2023-02-07 19:28</div>
            <div class="timeline-body"><p>Thanks for the really fast action :) :heart:</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:32 UTC
    </footer>
</body>
</html>
