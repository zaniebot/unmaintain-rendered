```yaml
number: 18817
title: "Fix that causes `SyntaxError` is not reverted if the error is version dependent"
type: issue
state: open
author: MeGaGiGaGon
labels:
  - needs-decision
assignees: []
created_at: 2025-06-20T06:54:10Z
updated_at: 2025-06-20T06:58:21Z
url: https://github.com/astral-sh/ruff/issues/18817
synced_at: 2026-01-10T01:56:56Z
```

# Fix that causes `SyntaxError` is not reverted if the error is version dependent

---

_Issue opened by @MeGaGiGaGon on 2025-06-20 06:54_

### Summary

I noticed this while making #18816, but a version dependent `SyntaxError` caused by a fix will cause the fix be reverted.

No syntax error when the check command is run without `--fix`:
```
PS D:\python_projects> uvx ruff check issue.py --isolated --select PLE --target-version py39
```
```snap
issue.py:1:5: PLE2510 [*] Invalid unescaped character backspace, use "\b" instead
  |
1 | f"{'âˆ'}"
  |     ^ PLE2510
  |
  = help: Replace with escape sequence

Found 1 error.
[*] 1 fixable with the `--fix` option.
```
When `--fix` is subsequently run, the message includes both a new `SyntaxError` and the `1 fixed` message.
```
PS D:\python_projects> uvx ruff check issue.py --isolated --select PLE --target-version py39 --fix
```
```snap
issue.py:1:5: SyntaxError: Cannot use an escape sequence (backslash) in f-strings on Python 3.9 (syntax was added in Python 3.12)
  |
1 | f"{'\b'}"
  |     ^
  |

Found 2 errors (1 fixed, 1 remaining).
```

Compare this to the fix causing a syntax error in #18813 - the fix is reverted because of the `SyntaxError`, and the "please file a bug" message is displayed
```
PS D:\python_projects> uvx ruff check issue.py --isolated --select PLC --unsafe-fixes --fix --preview
```
```snap

error: Fix introduced a syntax error. Reverting all changes.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BFix%20error%5D

...quoting the contents of `issue.py`, the rule codes PLC2801, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

issue.py:1:20: PLC2801 Unnecessary dunder call to `__str__`. Use `str()` builtin.
  |
1 | three = 1 if 1 else(3.0).__str__()
  |                    ^^^^^^^^^^^^^^^ PLC2801
  |
  = help: Use `str()` builtin

Found 1 error.
[*] 1 fixable with the --fix option.
```
So this looks to me like for whatever reason, if a fix causes a version dependent `SyntaxError` it will not be reverted.

### Version

ruff 0.12.0 (87f0feb 2025-06-17)

---

_Comment by @MichaReiser on 2025-06-20 06:58_

version and semantic syntax errors are different from parse errors. Most lints don't run if there are parse errors and we also don't apply any fixes. This is not the case for version or semantic sytnax errors because we actually know what the user meant, they're just not allowed to use that syntax. 

The challenge here is how to detect whether a version or semantic syntax error is new and if it is worth the complexity. I'm not sure it is

---

_Label `needs-decision` added by @MichaReiser on 2025-06-20 06:58_

---
