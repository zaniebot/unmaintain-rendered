<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Bug] Ruff doesn't detect DJ012 rule after first fix - astral-sh/ruff #9150</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Bug] Ruff doesn't detect DJ012 rule after first fix</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9150">#9150</a>
        opened by <a href="https://github.com/vldmrrz">@vldmrrz</a>
        on 2023-12-15 14:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vldmrrz">@vldmrrz</a> on 2023-12-15 14:07</div>
            <div class="timeline-body"><h3>Bug description</h3>
<p>I got an error DJ012 with some models when running command.</p>
<pre><code>apps/app/models.py:113:5: DJ012 Order of model's inner classes, methods, and fields does not follow the Django Style Guide: field declaration should come before `Meta` class
</code></pre>
<p>Code example:</p>
<pre><code class="language-(python)">class MyModel(models.Model):
    class Meta:
        db_table = &quot;my_model_table&quot;

    model_field = models.TextField()

class MySecondModel(models.Model):
    class Meta:
        db_table = &quot;my_second_model_table&quot;

    model_field = models.TextField()
</code></pre>
<p>After fixing the first model and running the <code>ruff check .</code> I didn't get a warning about the second model</p>
<pre><code class="language-(python)">class MyModel(models.Model):
    model_field = models.TextField()

    class Meta:
        db_table = &quot;my_model_table&quot;

class MySecondModel(models.Model):
    class Meta:
        db_table = &quot;my_second_model_table&quot;

    model_field = models.TextField()
</code></pre>
<h3>My configuration</h3>
<ul>
<li>Command I run: <code>ruff check .</code></li>
<li>Ruff settings:</li>
</ul>
<pre><code>[tool.ruff]
# Enabled rules
select = [
    &quot;E&quot;, # pycodestyle
    &quot;F&quot;, # pyflakes
    &quot;W&quot;, # pycodestyle
    &quot;B&quot;, # bugbear
    &quot;I&quot;, # isort
    &quot;RUF&quot;, # ruff
    &quot;UP&quot;, # pyupgrade
    &quot;DJ&quot;, # django
    &quot;N&quot;, # pep8-naming
    &quot;PL&quot;, # pylint
    &quot;TD&quot;, # todos
    &quot;TCH&quot;, # flake8-type-checking
    &quot;SIM&quot;, # flake8-simplify
    &quot;Q&quot;, # flake8-quotes
    &quot;T20&quot;, # flake8-print
    &quot;COM&quot;, # flake8-comas
    &quot;C90&quot;, # mccabe
]
# Ignored rules
ignore = [
    &quot;RUF012&quot;, # mutable default values in class attributes
    &quot;I001&quot;, # isort import ordering and blank lines in imports
    &quot;DJ001&quot;, # Avoid using `null=True` on string-based fields such as TextField
]

# Allow fix for all enabled rules (when `--fix`) is provided.
fixable = [&quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;, &quot;I&quot;, &quot;N&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;T&quot;, &quot;W&quot;, &quot;ANN&quot;, &quot;ARG&quot;, &quot;BLE&quot;, &quot;COM&quot;, &quot;DJ&quot;, &quot;DTZ&quot;, &quot;EM&quot;, &quot;ERA&quot;, &quot;EXE&quot;, &quot;FBT&quot;, &quot;ICN&quot;, &quot;INP&quot;, &quot;ISC&quot;, &quot;NPY&quot;, &quot;PD&quot;, &quot;PGH&quot;, &quot;PIE&quot;, &quot;PL&quot;, &quot;PT&quot;, &quot;PTH&quot;, &quot;PYI&quot;, &quot;RET&quot;, &quot;RSE&quot;, &quot;RUF&quot;, &quot;SIM&quot;, &quot;SLF&quot;, &quot;TCH&quot;, &quot;TID&quot;, &quot;TRY&quot;, &quot;UP&quot;, &quot;YTT&quot;]
unfixable = []

line-length = 120

# Allow unused variables when underscore-prefixed.
dummy-variable-rgx = &quot;^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$&quot;

# Assume Python 3.11
target-version = &quot;py311&quot;

# Exclude a variety of commonly ignored directories.
exclude = [
    &quot;.direnv&quot;,
    &quot;.git&quot;,
    &quot;.mypy_cache&quot;,
    &quot;.pytype&quot;,
    &quot;.ruff_cache&quot;,
    &quot;.tox&quot;,
    &quot;.venv&quot;,
    &quot;__pypackages__&quot;,
    &quot;_build&quot;,
    &quot;buck-out&quot;,
    &quot;build&quot;,
    &quot;dist&quot;,
    &quot;venv&quot;,
]

[tool.ruff.mccabe]
max-complexity = 10

[tool.ruff.flake8-quotes]
docstring-quotes = &quot;double&quot;
</code></pre>
<ul>
<li>ruff 0.1.8</li>
<li>python 3.11.7</li>
<li>Django 4.2.8</li>
</ul>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-15 14:22</div>
            <div class="timeline-body"><p>I might be missing some context here but the playground shows the warning with the second code snippet: https://play.ruff.rs/407c7303-ed56-4cc0-8300-fd523728e97a</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vldmrrz">@vldmrrz</a> on 2023-12-15 14:35</div>
            <div class="timeline-body"><p>@dhruvmanila I found the problem.</p>
<p>Warning not fires when model inherited from another model (even non-abstract), like this https://play.ruff.rs/b7dbc350-21a2-4f97-9490-165d6226720c</p>
<p>But still looks like bug for me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-15 14:44</div>
            <div class="timeline-body"><p>Thanks! Yes, the rule wouldn't trigger if the model isn't inherited <em>directly</em> from Django's <code>Model</code> class. I'll have to check if it's currently possible to resolve inheritance all the way to the base class \cc @charliermarsh ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vldmrrz">@vldmrrz</a> on 2023-12-15 14:45</div>
            <div class="timeline-body"><p>@dhruvmanila thank you so much for your attention. Hope it will be possible to fix this issue :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-15 14:45</div>
            <div class="timeline-body"><p>We can do it within a single file, but not across files. So we can fix the single-file case, but the multi-file analysis case should just be merged into the larger tracking issue since itâ€™s not at all specific to the Django rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vldmrrz">@vldmrrz</a> on 2023-12-15 14:48</div>
            <div class="timeline-body"><p>@charliermarsh appreciate it.
It would be nice if we will have this functionality across multiple files in the future</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-12-15 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-12-15 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-15 17:22</div>
            <div class="timeline-body"><p>I can fix within the same file and make a note in the multi-file issue!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-15 18:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:32:14 UTC
    </footer>
</body>
</html>
