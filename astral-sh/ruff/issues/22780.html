<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC1802 false negative when a sequence is an attribute - astral-sh/ruff #22780</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLC1802 false negative when a sequence is an attribute</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22780">#22780</a>
        opened by <a href="https://github.com/leandrobbraga">@leandrobbraga</a>
        on 2026-01-20 23:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrobbraga">@leandrobbraga</a></div>
            <div class="timeline-body"><p>PLC1802 wonâ€™t trigger if the sequence is an attribute.</p>
<p>https://play.ruff.rs/74477bb6-7796-4884-927a-2d0a8f93e4e2</p>
Example
<p>By running</p>
<pre><code>$ echo &#x27;class Fruits:
    fruits: list[str]

    def __init__(self):
        self.fruits = [&quot;apple&quot;, &quot;orange&quot;]

        if len(self.fruits):
            ...

fruits = [&quot;apple&quot;, &quot;orange&quot;]
if len(fruits):
    ...&#x27; | cargo run -p ruff -- check --select PLC1802 -
</code></pre>
<p>We get this output, which is missing the <code>self.fruits</code> inside the Fruits class:</p>
<pre><code>PLC1802 [*] `len(fruits)` used as condition without comparison
  --&gt; -:11:4
   |
10 | fruits = [&quot;apple&quot;, &quot;orange&quot;]
11 | if len(fruits):
   |    ^^^^^^^^^^^
12 |     ...
   |
help: Remove `len`

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on 2026-01-21 00:00</div>
            <div class="timeline-body"><p>It seems related to ruff giving up on resolving <code>Expr::Attribute</code> in <code>From&lt;&amp;Expr&gt; for ResolvedPythonType</code> <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_python_semantic/src/analyze/type_inference.rs#L348-L353">here</a>.</p>
<pre><code>impl From&lt;&amp;Expr&gt; for ResolvedPythonType {
    fn from(expr: &amp;Expr) -&gt; Self {
        match expr {
            // Primitives.
            Expr::Dict(_) =&gt; ResolvedPythonType::Atom(PythonType::Dict),
            Expr::DictComp(_) =&gt; ResolvedPythonType::Atom(PythonType::Dict),
            // (...)
            Expr::Lambda(_)
            | Expr::Await(_)
            | Expr::Yield(_)
            | Expr::YieldFrom(_)
            | Expr::Compare(_)
            | Expr::Call(_)
            | Expr::Attribute(_)
            | Expr::Subscript(_)
            | Expr::Starred(_)
            | Expr::Name(_)
            | Expr::Slice(_)
            | Expr::IpyEscapeCommand(_) =&gt; ResolvedPythonType::Unknown,
        }
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-21 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-21 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-21 14:03</div>
            <div class="timeline-body"><p>I think this would probably follow a code path more like <code>is_indirect_sequence</code></p>
<p>https://github.com/astral-sh/ruff/blob/9f34b4634d407b4a2fd1257bfea65f5b4c0eacf0/crates/ruff_linter/src/rules/pylint/rules/len_test.rs#L130-L133</p>
<p>than <code>is_sequence</code>, which uses <code>ResolvedPythonType</code> because we have to resolve the definition and other assignments to the attribute. I think it would be very tricky to do that reliably without type inference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-21 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leandrodamascena">@leandrodamascena</a> on 2026-01-21 14:49</div>
            <div class="timeline-body"><p>I had the same problem and was about to open a new issue, but I found this one. I just submitted a PR for review.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 15:07:13 UTC
    </footer>
</body>
</html>
