<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linter: new rule regarding `=` in functions with complex expressions - astral-sh/ruff #20471</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Linter: new rule regarding `=` in functions with complex expressions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/20471">#20471</a>
        opened by <a href="https://github.com/adamsol">@adamsol</a>
        on 2025-09-18 17:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adamsol">@adamsol</a> on 2025-09-18 17:03</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>It is generally agreed that formatting like <code>foo(x: int=42)</code> or <code>foo[T: int | str=int]</code> (example from #13699) looks strange, as the equals sign visually contradicts operator precedence. That's why <a href="https://peps.python.org/pep-0008/#other-recommendations">PEP 8</a> makes an exception from its own rule and dictates putting spaces around <code>=</code> in such situations, which is properly implemented in Ruff.</p>
<p>What about formatting like <code>foo(x=a + b)</code>? This is a symmetrical situation, yet there exists no exception for it, and no separate rule to flag such cases.</p>
<p>Or a more practical example from Django:</p>
<pre><code class="language-py">Order.objects.filter(timestamp__gt=timezone.now() - timedelta(minutes=30))
</code></pre>
<p>where it's quite difficult to even notice the equals sign at the first glance.</p>
<p>Some time ago I reported this in https://github.com/PyCQA/pycodestyle/issues/1240, but the idea was rejected. Is there any interest in Ruff to implement such a linter rule that would report this as bad formatting?</p>
<hr />
<p>PS. Personally I'd love to simplify this and just always put spaces around <code>=</code> (and I'm not the only one - see <a href="https://stackoverflow.com/questions/8853063/pep-8-why-no-spaces-around-in-keyword-argument-or-a-default-parameter-value">this SO thread</a> or <a href="https://github.com/astral-sh/ruff/discussions/20034">this discussion</a>), but I know the general stance against violating PEP 8 is strong, so I'm not asking about this here (although it's already &quot;implemented&quot; in Ruff for type variable defaults: #18746).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-19 06:54</div>
            <div class="timeline-body"><p>I come from the JS ecosystem and I was also suprised by this formatting, but Ruff follows PEP8:</p>
<blockquote>
<p>Donâ€™t use spaces around the = sign when used to indicate a keyword argument, or when used to indicate a default value for an unannotated function parameter:</p>
</blockquote>
<p>We currently don't accept any lint rules that aren't in line with PEP8.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-09-19 06:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamsol">@adamsol</a> on 2025-09-19 08:01</div>
            <div class="timeline-body"><p>This rule would not violate PEP8. As I already wrote in https://github.com/PyCQA/pycodestyle/issues/1240, there are at least 3 different ways the snippet's readability could be improved without putting spaces around <code>=</code>:</p>
<ul>
<li>Factor out the expression to a separate variable.</li>
<li>Put parentheses around the expression.</li>
<li>Remove spaces around the binary operator.</li>
</ul>
<p>Even though PEP 8 doesn't mention that formatting as bad style, I'm sure there are many style rules that PEP8 doesn't mention, but are still implemented in Ruff. The point is to have these cases flagged in a repo, so we can then manually make a decision how to improve the formatting.</p>
<p>Edit: in case anyone is interested, here's my Flake8 plugin that implements this: https://github.com/adamsol/flake8-arg-spacing (since it seems Ruff doesn't currently support plugins: #283).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
