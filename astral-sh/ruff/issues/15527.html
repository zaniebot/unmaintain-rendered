<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reduced readability reformatting around getitem - astral-sh/ruff #15527</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Reduced readability reformatting around getitem</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/15527">#15527</a>
        opened by <a href="https://github.com/behrmann">@behrmann</a>
        on 2025-01-16 09:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/behrmann">@behrmann</a> on 2025-01-16 09:43</div>
            <div class="timeline-body"><p>ruff is a lovely tool, but with ruff 0.9.1 we just experienced a reformatting that reduces readability in the result in <a href="https://github.com/systemd/mkosi/pull/3366#discussion_r1918087220">this PR</a></p>
<p>The <a href="https://github.com/systemd/mkosi/pull/3366/files#diff-ac46bb8a2229a019bcf1d0667948e3539896a4488e46ab7ca248f8c6c6e4daf8R918">bit of code</a> with ruff's reformatting is</p>
<pre><code class="language-diff">         return needs_repository_key_fetch(namespace.distribution)
 
     if namespace.tools_tree != Path(&quot;default&quot;):
-        return (
-            detect_distribution(namespace.tools_tree)[0] == Distribution.ubuntu
-            and needs_repository_key_fetch(namespace.distribution)
-        ) 
+        return detect_distribution(namespace.tools_tree)[
+            0
+        ] == Distribution.ubuntu and needs_repository_key_fetch(namespace.distribution)
 
     return (
         namespace.tools_tree_distribution == Distribution.ubuntu
</code></pre>
<p>A <code># fmt: skip</code> solved this, but it would nice if it were not necessary.</p>
<p>The used ruff version is 0.9.1 and the relevant settings from <code>pyproject.toml</code> are</p>
<pre><code class="language-toml">[tool.ruff]
target-version = &quot;py39&quot;
line-length = 109
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../systemd/mkosi/pulls/3366.html">systemd/mkosi#3366</a> on 2025-01-16 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @AlexWaygood on 2025-01-16 10:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @AlexWaygood on 2025-01-16 10:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-16 11:51</div>
            <div class="timeline-body"><p>Thanks for reporting and the kind words. I tend to prefer adding parentheses over splitting the expression the way Ruff does here. I also expect that changing the behavior here might have far reaching effects unless we make it more specific, e.g. never break subscripts with single int literals (I think that's what Prettier does).</p>
<p><a href="https://play.ruff.rs/d840e22a-34d8-4bb5-8a26-ee279648ef9b">Playground</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
