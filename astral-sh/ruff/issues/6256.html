<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement `valid-magic-values` setting for rule PLR2004 - astral-sh/ruff #6256</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement <code>valid-magic-values</code> setting for rule PLR2004</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6256">#6256</a>
        opened by <a href="https://github.com/dzh-ad">@dzh-ad</a>
        on 2023-08-01 21:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dzh-ad">@dzh-ad</a> on 2023-08-01 21:22</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Pylinter has a nice configuration that ignores warnings for specified values, <a href="https://pylint.readthedocs.io/en/latest/user_guide/configuration/all-options.html#magic-value-options">valid-magic-values</a></p>
<pre><code>[tool.pylint.magic-value]
valid-magic-values = [0, -1, 1, &quot;&quot;, &quot;__main__&quot;]
</code></pre>
<p>Ruff does not current have an equivalent configuration. The closest one seems to be <a href="https://beta.ruff.rs/docs/settings/#pylint-allow-magic-value-types">allow-magic-value-types</a>, which would ignore any variables of a specific type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 21:33</div>
            <div class="timeline-body"><p>This was an intentional divergence, if I recall correctly, since we couldn't find any motivating use-cases for parameterizing on specific values, the thinking being that if there's a value that should be allowed that's specific to the codebase, it should probably be encoded as a variable; and if a value should be allowed but isn't specific to the codebase, it should probably just be allowed by default (like <code>0</code>).</p>
<p>What's the use-case? What value were you looking to allow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-08-01 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dzh-ad">@dzh-ad</a> on 2023-08-02 17:05</div>
            <div class="timeline-body"><p>Ah I see. Thank you for your quick reply!</p>
<p>Our project deals with 2D and 3D arrays quite a bit, so I was hoping to ignore the warning for <code>2</code> and <code>3</code> as well (for the axis, checking if the number of dimension is correct etc).</p>
<p>Another place where it might be helpful is performing a certain action for a given http response status codes (ie. <code>200</code> for success)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dzh-ad">@dzh-ad</a> on 2023-08-02 17:19</div>
            <div class="timeline-body"><p>One more example for the use of <code>2</code>, the simple line of</p>
<p><code>if len(header_elements) != 2:</code></p>
<p>would be flagged, and editing to the following looks kind of funny</p>
<pre><code>expected_header_elements = 2
if len(header_elements) != expected_header_elements:
</code></pre>
<p>In-line ignore also works, but it would make our life a lot easier if we can add other common (and easily understood) values to the ignore list for our project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-02 17:22</div>
            <div class="timeline-body"><p>I would generally recommend using status codes as constants e.g. https://github.com/encode/starlette/blob/a8b8856ce393a82ab4a714131085dbc4d658e34d/starlette/status.py#L96 which tends to be clearer anyway.</p>
<p>Regarding other small integers, I'm not sure what the best course is. Why is <code>expected_header_elements</code> bad? That seems like it follows the spirit of the rule. That number should probably be a constant with a comment explaining why it is that length.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-04 01:40</div>
            <div class="timeline-body"><p>Yeah I think many of these adhere to the spirit of the rule, and I'm hesitant to make this configurable. We could consider adding 2 and 3 to the allow list though since they are commonly used as dimensions. Wdyt @zanieb?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dzh-ad">@dzh-ad</a> on 2023-08-04 21:21</div>
            <div class="timeline-body"><p>Woo the starlette looks like a cool package! Thanks @zanieb!
You comments make sense. I don't have a strong preference on if we add 2 and 3 into the allow list now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dzh-ad on 2023-08-04 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonyscathe">@jonyscathe</a> on 2023-12-04 05:12</div>
            <div class="timeline-body"><p>Was there any resolution on adding 2 and 3 to the list?</p>
<p>Even the ruff example of this rule violates the rule by using 2 as a magic number... https://docs.astral.sh/ruff/rules/magic-value-comparison/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-12-04 09:39</div>
            <div class="timeline-body"><p>I think <code>2</code> is allowed as a magic value (I linted the example in the documentation, and Ruff only complained about <code>100</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-04 15:16</div>
            <div class="timeline-body"><p>@tjkuson - I <em>think</em> it's that magic values are only linted in comparisons, and not arbitrary expressions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonyscathe">@jonyscathe</a> on 2023-12-04 22:20</div>
            <div class="timeline-body"><p>Oh yes sorry. I had missed the magic numbers can only not be used in comparisons but are fine to use elsewhere according to this rule.
I guess that makes it less of an issue that 2 and 3 are not exempt as using those values as indexes in 2D, 3D arrays etc is still fine to do.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:53 UTC
    </footer>
</body>
</html>
