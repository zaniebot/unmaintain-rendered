<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rules FURB113 cause autofix error - astral-sh/ruff #7095</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rules FURB113 cause autofix error</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7095">#7095</a>
        opened by <a href="https://github.com/qarmin">@qarmin</a>
        on 2023-09-03 18:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qarmin">@qarmin</a></div>
            <div class="timeline-body"><p>Ruff 0.0.287 (latest changes from main branch)</p>
<pre><code>ruff  *.py --select FURB113 --no-cache --fix
</code></pre>
<p>file content(at least simple cpython script shows that this is valid python file):</p>
<pre><code>def prettify(
) -&gt; str:
    r = []
    fmtlink = lambda uri: encryptor.handle_cipher(
    )[1]
    folders, videos, audios, photos, programs, documents, etc = (
    )
    r.append(
    )
    r.append(
    )
    r.append(
        '&lt;meta content=&quot;width=width-device, initial-scale=1.0&quot; name=&quot;viewport&quot;&gt;&lt;/meta&gt;'
    )
    if args.preload:
        if os.path.isdir(fullname):
            linkname = name + &quot;/&quot;
        if os.path.islink(fullname):
                r.append(
                    '&lt;p&gt;&lt;a class=&quot;dir&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/p&gt;'
                    % (
                    )
                )
                r.append(
                    '&lt;p&gt;&lt;a class=&quot;file&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/p&gt;'
                    % (
                    )
                )
                folders.append(
                    '&lt;button&gt;&lt;a class=&quot;dir&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/button&gt;'
                    % (
                    )
                )
                if len(linknm) &gt; 30:
                    linknm = linknm[0:30] + &quot;...&quot;
                    rp = f&quot;&quot;&quot;&lt;div id='info' class='vida'&gt;&lt;p class='doc'&gt;{linknm}&lt;/p&gt;
            			&lt;source src=&quot;{link}&quot; type=&quot;video/mp4&quot;&gt;&lt;/video&gt;{'&lt;br&gt;'*2}&lt;/div&gt;&quot;&quot;&quot;
                elif displayname.endswith(
                ):
                    rp = f&quot;&quot;&quot;&lt;div id='info' class='aud'&gt;&lt;p class='doc'&gt;{linknm}&lt;/p&gt;&lt;audio controls&gt;
            			&lt;/audio&gt;&lt;/div&gt;&quot;&quot;&quot;
                    (
                    )
                elif displayname.endswith(
                ):
                    documents.append(
                    )
                    etc.append(
                    )
                hd = [
                ]
                for x in range(len(dt)):
                            r.append(
                            )
    r.append(
        f&quot;&quot;&quot;
        &lt;/form&gt;&quot;&quot;&quot;
        if args.upload
        else &quot;&quot;
    )
    r.append(
        f&quot;&quot;&quot;&lt;hr&gt;&lt;div class=&quot;container&quot;&gt;&lt;footer&gt;
        { '&lt;a class=&quot;admin_login&quot; href=&quot;/admin/fileadmin&quot;&gt;Manage Files&lt;/a&gt;&lt;br&gt;&lt;br&gt;' if args.admin else ''} 
       &quot;&quot;&quot;
    )
</code></pre>
<p>error</p>
<pre><code>/home/rafal/test/tmp_folder/8304481.py:19:17: FURB113 Use `r.extend(...)` instead of repeatedly calling `r.append()`
/home/rafal/test/tmp_folder/8304481.py:55:5: FURB113 Use `r.extend(...)` instead of repeatedly calling `r.append()`
Found 2 errors.

error: Autofix introduced a syntax error. Reverting all changes.

This indicates a bug in `ruff`. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BAutofix%20error%5D

...quoting the contents of `/home/rafal/test/tmp_folder/8304481.py`, the rule codes FURB113, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!


</code></pre>
<pre><code>    </code></pre>
<p><a href="https://github.com/astral-sh/ruff/files/12506821/python_compressed.zip">python_compressed.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fuzzer</span> added by @zanieb on 2023-09-03 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-09-03 22:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-05 20:29</div>
            <div class="timeline-body"><p>The underlying problem is that the generator doesn't know which string quotes there are and picks the wrong ones for f-strings with nested strings:</p>
<pre><code class="language-python">def f():
    r = []
    r.append('')
    r.append(f&quot;&quot;&quot;{'&quot;'}&quot;&quot;&quot;)
</code></pre>
<p>gets turned into</p>
<pre><code class="language-python">def f():
    r = []
    r.extend(('', f'{\'&quot;\'}'))
</code></pre>
<p>The solutions could be adding quote kinds to the AST (i remember this being suggested before) or reimplementing/refactoring the entire machinery for picking the right quote type in python up to 3.12 from the formatter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-05 20:54</div>
            <div class="timeline-body"><p>I wasn't able to bisect this to the exact commit, but I can't reproduce this after 0.9.4, probably as a result of these quoting changes from the changelog:</p>
<blockquote>
<p>Preserve quote style in generated code (https://github.com/astral-sh/ruff/pull/15726, https://github.com/astral-sh/ruff/pull/15778, https://github.com/astral-sh/ruff/pull/15794)</p>
</blockquote>
<p>Feel free to reopen if it's still an issue!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-06-05 20:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:13 UTC
    </footer>
</body>
</html>
