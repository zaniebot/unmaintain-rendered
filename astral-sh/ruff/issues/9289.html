<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>line-length for formatter doesn't follow the E501 lint rules. - astral-sh/ruff #9289</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>line-length for formatter doesn't follow the E501 lint rules.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9289">#9289</a>
        opened by <a href="https://github.com/jungwookim">@jungwookim</a>
        on 2023-12-27 03:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jungwookim">@jungwookim</a></div>
            <div class="timeline-body"><p>I want to set the proper line length but its behaviour is pretty weird. I've attached the reproducible example code and my configurations below.</p>
<pre><code class="language-bash">$ ruff --version
ruff 0.1.8

$ ruff check a.py
a.py:5:81: E501 Line too long (108 &gt; 80)
a.py:9:81: E501 Line too long (96 &gt; 80)
</code></pre>
<p>After I fix the E501 above with new line, I format it with <code>ruff format a.py</code>. It produces line too long again.</p>
<p>In other words, ruff format doesn't do anything with wrap lines even they violate their own rule (i set line-length = 80 but it rolls back)</p>
<h2>pyproject.toml</h2>
<p>I skipped some unrelated configurations.</p>
<pre><code class="language-toml">[tool.ruff]
line-length = 80
indent-width = 4

# Assume Python 3.10
# NOTE: Need to be same as DEFAULT_PYTHON_TAG in build_tools/w4.bzl.
target-version = &quot;py310&quot;

[tool.ruff.lint]
select = [&quot;E4&quot;, &quot;E7&quot;, &quot;E9&quot;, &quot;F&quot;, &quot;E501&quot;]
ignore = []

[tool.ruff.lint.pycodestyle]
max-line-length = 80
</code></pre>
<h2>example code</h2>
<pre><code class="language-python"># a.py (origin)
def line_too_long_test_fn():
    config_enums = {'DataType': {'TEST_DATA_1': 0, 'TEST_DATA_2': 1}}
    test_data_1 = {
        'LessThan80': 'This is a test string that is less than 80 characters',
        'MoreThan80CharactersMoreThan80Characters': 'This is a test string that is more than 80 characters',
    }
    test_data = {
        config_enums.DataType.TEST_DATA_1: test_data_1.LessThan80,
        config_enums.DataType.TEST_DATA_2: test_data_1.MoreThan80CharactersMoreThan80Characters,
    }

    return test_data
</code></pre>
<pre><code class="language-python"># a.py (I fixed)
def line_too_long_test_fn():
    config_enums = {'DataType': {'TEST_DATA_1': 0, 'TEST_DATA_2': 1}}
    test_data_1 = {
        'MoreThan80CharactersMoreThan80Characters':
            'This is a test string that is more than 80 characters',
    }
    test_data = {
        config_enums.DataType.TEST_DATA_2:
            test_data_1.MoreThan80CharactersMoreThan80Characters,
    }

    return test_data
</code></pre>
<pre><code class="language-python"># a.py (after ruff format)
def line_too_long_test_fn():
    config_enums = {'DataType': {'TEST_DATA_1': 0, 'TEST_DATA_2': 1}}
    test_data_1 = {
        'MoreThan80CharactersMoreThan80Characters': 'This is a test string that is more than 80 characters',
    }
    test_data = {
        config_enums.DataType.TEST_DATA_2: test_data_1.MoreThan80CharactersMoreThan80Characters,
    }

    return test_data
</code></pre>
<p>I guess it happens on dictionary data or edge cases or a bug?..?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-27 13:53</div>
            <div class="timeline-body"><p>Thanks! I believe this is only handled as part of Black's preview style (#8437) -- note that Black does not reformat in this case: https://black.vercel.app/?version=main&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AJ8AQ5dAD2IimZxl1N_WlbvK5V-T0Ww3PRf-11njtYzMrWsaS3TRmKAkAKHBe-gctPasA09OYB17rb6BAdKGuTIrNpp8UTVoUaMUhqWdUHOHIacwiygEsEI1DsgOkazDIUZxfybAW9FQZlu8DJTBJ5q6Gdk_jG_sPsKaU-TIdllvTjRRqobO4UXHxnKlBsfWgUtFURbh_dDhtxESCpTFoJMyFu2DICb__XKdsd372sWNpwwXBjuY43Hyang3a-xjZR517pphtuOiOt9p_UzNn-G8u-vuJ6ZYL-dp1dpEMI_CC2A937-CbK_SCaTw8ugV5IJWHYCQuE-lMbmvJzVn19GFL3jRSf3xLdpFQ0NgDEBDN2gvwAAABOMzzQ8w--hAAGqAv0EAACT0xdyscRn-wIAAAAABFla -- so I consider it a duplicate of that issue.</p>
<p>Note that this is (to some degree) expected... The formatter uses the line length as a guideline, but no formatter can guarantee that <em>all</em> content will be reformatted within that line length. (We recommend disabling E501 when using the formatter, though strictly speaking it's not considered &quot;incompatible&quot;.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-27 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2023-12-27 22:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:20 UTC
    </footer>
</body>
</html>
