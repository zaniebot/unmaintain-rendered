<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`pip install .` from src is failing - astral-sh/ruff #9975</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`pip install .` from src is failing</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9975">#9975</a>
        opened by <a href="https://github.com/Skylion007">@Skylion007</a>
        on 2024-02-13 15:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Skylion007">@Skylion007</a> on 2024-02-13 15:54</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<ul>
<li>I git cloned the latest main.</li>
<li>Ran <code>pip install -vv .</code> in the root directory</li>
<li>Hit the following error:</li>
</ul>
<pre><code>Using pip 24.0 from /Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip (python 3.8)
Non-user install because user site-packages disabled
Created temporary directory: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-build-tracker-tl9e__1m
Initialized build tracking at /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-build-tracker-tl9e__1m
Created build tracker: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-build-tracker-tl9e__1m
Entered build tracker: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-build-tracker-tl9e__1m
Created temporary directory: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-install-rl8b7g2j
Created temporary directory: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-ephem-wheel-cache-9jnzxe4w
Processing /Users/agokaslan/git/ruff
  Added file:///Users/agokaslan/git/ruff to build tracker '/private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-build-tracker-tl9e__1m'
  Created temporary directory: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-build-env-y4y6m2mj
  Running command pip subprocess to install build dependencies
  Using pip 24.0 from /Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip (python 3.8)
  Collecting maturin&lt;2.0,&gt;=1.0
    Obtaining dependency information for maturin&lt;2.0,&gt;=1.0 from https://files.pythonhosted.org/packages/6b/fb/95fd7476bdf9565a45e14e3211e94dd87109d3a2d9dcfaaeef5e211a5cfc/maturin-1.4.0-py3-none-macosx_10_12_x86_64.whl.metadata
    Using cached maturin-1.4.0-py3-none-macosx_10_12_x86_64.whl.metadata (18 kB)
  Collecting tomli&gt;=1.1.0 (from maturin&lt;2.0,&gt;=1.0)
    Using cached tomli-2.0.1-py3-none-any.whl (12 kB)
  Using cached maturin-1.4.0-py3-none-macosx_10_12_x86_64.whl (8.0 MB)
  Installing collected packages: tomli, maturin
  Successfully installed maturin-1.4.0 tomli-2.0.1
  Installing build dependencies ... done
  Running command Getting requirements to build wheel
  Getting requirements to build wheel ... done
  Created temporary directory: /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-modern-metadata-wfcqvutd
  Running command Preparing metadata (pyproject.toml)
  error: failed to load manifest for workspace member `/Users/agokaslan/git/ruff/crates/ruff_cli`

  Caused by:
    failed to read `/Users/agokaslan/git/ruff/crates/ruff_cli/Cargo.toml`

  Caused by:
    No such file or directory (os error 2)
  ðŸ’¥ maturin failed
    Caused by: Cargo metadata failed. Does your crate compile with `cargo build`?
    Caused by: `cargo metadata` exited with an error:
  Error running maturin: Command '['maturin', 'pep517', 'write-dist-info', '--metadata-directory', '/private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-modern-metadata-wfcqvutd', '--interpreter', '/Users/agokaslan/venvs/ai_habitat_sys_py3/bin/python']' returned non-zero exit status 1.
  Checking for Rust toolchain....
  Running `maturin pep517 write-dist-info --metadata-directory /private/var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/pip-modern-metadata-wfcqvutd --interpreter /Users/agokaslan/venvs/ai_habitat_sys_py3/bin/python`
  error: subprocess-exited-with-error

  Ã— Preparing metadata (pyproject.toml) did not run successfully.
  â”‚ exit code: 1
  â•°â”€&gt; See above for output.

  note: This error originates from a subprocess, and is likely not a problem with pip.
  full command: /Users/agokaslan/venvs/ai_habitat_sys_py3/bin/python /Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/mv/ql5dp3xj2wd5f1n45w8jv6z00000gn/T/tmpoydyvpvc
  cwd: /Users/agokaslan/git/ruff
  Preparing metadata (pyproject.toml) ... error
error: metadata-generation-failed

Ã— Encountered error while generating package metadata.
â•°â”€&gt; See above for output.

note: This is an issue with the package mentioned above, not pip.
hint: See above for details.
Exception information:
Traceback (most recent call last):
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/operations/build/metadata.py&quot;, line 35, in generate_metadata
    distinfo_dir = backend.prepare_metadata_for_build_wheel(metadata_dir)
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/utils/misc.py&quot;, line 766, in prepare_metadata_for_build_wheel
    return super().prepare_metadata_for_build_wheel(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_vendor/pyproject_hooks/_impl.py&quot;, line 186, in prepare_metadata_for_build_wheel
    return self._call_hook('prepare_metadata_for_build_wheel', {
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_vendor/pyproject_hooks/_impl.py&quot;, line 311, in _call_hook
    self._subprocess_runner(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/utils/subprocess.py&quot;, line 252, in runner
    call_subprocess(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/utils/subprocess.py&quot;, line 224, in call_subprocess
    raise error
pip._internal.exceptions.InstallationSubprocessError: Preparing metadata (pyproject.toml) exited with 1

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/cli/base_command.py&quot;, line 180, in exc_logging_wrapper
    status = run_func(*args)
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/cli/req_command.py&quot;, line 245, in wrapper
    return func(self, options, args)
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/commands/install.py&quot;, line 377, in run
    requirement_set = resolver.resolve(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/resolver.py&quot;, line 76, in resolve
    collected = self.factory.collect_root_requirements(root_reqs)
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/factory.py&quot;, line 534, in collect_root_requirements
    reqs = list(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/factory.py&quot;, line 490, in _make_requirements_from_install_req
    cand = self._make_base_candidate_from_link(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/factory.py&quot;, line 228, in _make_base_candidate_from_link
    self._link_candidate_cache[link] = LinkCandidate(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/candidates.py&quot;, line 290, in __init__
    super().__init__(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/candidates.py&quot;, line 156, in __init__
    self.dist = self._prepare()
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/candidates.py&quot;, line 222, in _prepare
    dist = self._prepare_distribution()
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/candidates.py&quot;, line 301, in _prepare_distribution
    return preparer.prepare_linked_requirement(self._ireq, parallel_builds=True)
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/operations/prepare.py&quot;, line 525, in prepare_linked_requirement
    return self._prepare_linked_requirement(req, parallel_builds)
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/operations/prepare.py&quot;, line 640, in _prepare_linked_requirement
    dist = _get_prepared_distribution(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/operations/prepare.py&quot;, line 71, in _get_prepared_distribution
    abstract_dist.prepare_distribution_metadata(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/distributions/sdist.py&quot;, line 67, in prepare_distribution_metadata
    self.req.prepare_metadata()
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/req/req_install.py&quot;, line 579, in prepare_metadata
    self.metadata_directory = generate_metadata(
  File &quot;/Users/agokaslan/venvs/ai_habitat_sys_py3/lib/python3.8/site-packages/pip/_internal/operations/build/metadata.py&quot;, line 37, in generate_metadata
    raise MetadataGenerationFailed(package_details=details) from error
pip._internal.exceptions.MetadataGenerationFailed: metadata generation failed
</code></pre>
<p>Running <code>python 3.8.2</code> pip build 24.0 . Does ruff actually not support building itself on python 3.8?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-13 15:56</div>
            <div class="timeline-body"><p>Do you know where the <code>ruff_cli</code> reference is coming from? That crate was renamed to <code>ruff</code>. (Do you happen to have a <code>crates/ruff_cli</code> folder lingering in your local directory?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2024-02-13 16:02</div>
            <div class="timeline-body"><p><code>rm -rf  crates/ruff_cli</code> fixed it. There was a <code>resources</code> folder in there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Skylion007 on 2024-02-13 16:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:11 UTC
    </footer>
</body>
</html>
