<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: overlong values without breakpoint are never parenthesized - astral-sh/ruff #6271</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: overlong values without breakpoint are never parenthesized</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6271">#6271</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-08-02 12:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2023-08-02 12:23</div>
            <div class="timeline-body"><p>Overlong values in e.g. assignment position without sometimes be parenthesized, this seems to depend on whether parenthesizing actually help too not be overlong anymore. The first step of fixing this issue is figuring out the exact criteria for what is indented and what isn't.</p>
<p>input and our output:</p>
<pre><code class="language-python">x = aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
x_aaaa = aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
y_aaaa = a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
z_aaaa = a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
x = &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
x_aaaa = &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
y_aaaa = &quot;a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
z_aaaa = &quot;a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
</code></pre>
<p>black:</p>
<pre><code class="language-python">x = aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
x_aaaa = (
    aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
)
y_aaaa = (
    a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
)
z_aaaa = (
    a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
)
x = &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
x_aaaa = (
    &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
)
y_aaaa = (
    &quot;a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
)
z_aaaa = &quot;a.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2023-08-02 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-08-02 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: overlong attribute chains should be wrapped in parentheses" to "Formatter: overlong value in assignment position without breakpoint are wrongly formatted" by @konstin on 2023-08-02 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: overlong value in assignment position without breakpoint are wrongly formatted" to "Formatter: overlong values in assignment position without breakpoint are wrongly formatted" by @konstin on 2023-08-02 12:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @konstin on 2023-08-02 12:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @MichaReiser on 2023-08-03 06:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-03 06:05</div>
            <div class="timeline-body"><p>This behavior isn't just specific to assignments but applies in general (I haven't understood the details yet).</p>
<p>I believe <a href="https://github.com/psf/black/blob/01b8d3d4095ebdb91d0d39012a517931625c63cb/src/black/linegen.py#L1572-L1578">this</a> is the relevant logic in black. Where it splits the line by adding optional parentheses, but only keeps them if all lines now fit.</p>
<p>I have a <a href="https://github.com/astral-sh/ruff/compare/main...random-tries-to-format-strings">branch</a> where I tried to get to the bottom of it but I haven't yet found out the right rules that apply (or messed up the Printer implementation)</p>
<p>This is the same as https://github.com/astral-sh/ruff/issues/6059.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: overlong values in assignment position without breakpoint are wrongly formatted" to "Formatter: overlong values without breakpoint are parenthesized" by @MichaReiser on 2023-08-03 06:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: overlong values without breakpoint are parenthesized" to "Formatter: overlong values without breakpoint are never parenthesized" by @MichaReiser on 2023-08-03 06:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-08-16 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2023-08-17 09:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-08-24 12:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:53 UTC
    </footer>
</body>
</html>
