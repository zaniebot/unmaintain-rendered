<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add flake8-markupsafe or broaden S308 - astral-sh/ruff #14124</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add flake8-markupsafe or broaden S308</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14124">#14124</a>
        opened by <a href="https://github.com/Daverball">@Daverball</a>
        on 2024-11-06 08:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Daverball">@Daverball</a> on 2024-11-06 08:10</div>
            <div class="timeline-body"><p>Improper use of <code>markupsafe.Markup</code> is a common source of XSS vulnerabilities and I've seen many people, including myself, make mistakes here regardless of how experienced they are, in part due to f-string's convenience and sometimes due to being API-compatible with regular <code>str</code>, so it's easy to write <code>Markup(''.format(unsafe))</code> instead of <code>Markup('').format(safe)</code>, this particular error can also be quite tricky to spot depending on the formatting.</p>
<p>There is an existing <a href="https://github.com/vmagamedov/flake8-markupsafe">flake8 plugin</a>, however it was never published on pypi and it makes a questionable exception for i18n.</p>
<p>Providing support for additional classes that behave like <code>Markup</code> on the other hand, like the <code>webhelpers</code> <code>literal</code> (which is a subclass of <code>Markup</code>) with a user-configurable list of fully qualified names seems sensible, since there's also <code>flask.Markup</code> which is an alias for <code>markupsafe.Markup</code>.</p>
<p>There's an existing issue to either add a rule or extend the existing <code>B308</code> rule in bandit, although it never went anywhere. So it could make sense to extend <code>S308</code> in ruff instead, or even just add a new <code>RUF</code> rule, rather than use up the <code>MS</code> prefix for a single rule.</p>
<p>In any case, the implementation should be quite simple and I'd be happy to provide one if you're open to adding a rule for it or augment the existing bandit rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-11-06 12:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-07 12:07</div>
            <div class="timeline-body"><p>Thanks for the clear writeup!</p>
<p>One aspect to take into consideration is that mapping this implementation to <code>flake8-markupsafe</code> then that's a nice way of providing attribution to the original author (which I believe is crucial in open-source software).</p>
<p>I could not find a single open-source repository using this plugin, so we can expect no or very few users of the original <code>MS001</code> code.</p>
<p>@Daverball there is an effort going on to recategorise the rules, and this rule would be a valuable addition to the <code>security</code> rules (#1774). I'd encourage you to go ahead with the implementation!</p>
<p>Note that <a href="https://github.com/astral-sh/ruff/issues/3653">mako</a> and jinja files are currently not supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14224.html">astral-sh/ruff#14224</a> on 2024-11-09 12:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-11-11 18:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:54 UTC
    </footer>
</body>
</html>
