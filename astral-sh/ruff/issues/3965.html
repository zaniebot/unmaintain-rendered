<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: ruff rule to replace `.pop(...)` with `del dict[...]` when the return is unused - astral-sh/ruff #3965</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: ruff rule to replace <code>.pop(...)</code> with <code>del dict[...]</code> when the return is unused</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3965">#3965</a>
        opened by <a href="https://github.com/markis">@markis</a>
        on 2023-04-13 20:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/markis">@markis</a> on 2023-04-13 20:34</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>When using a dictionary, a developer could use the <code>dict.pop(key)</code> or <code>del dict[key]</code> syntax to remove an item from a dictionary.  The <code>pop</code> syntax has the additional feature of returning the value from the dictionary, but it comes with a slight performance cost over the <code>del</code> syntax.  It would be nice if ruff could identify places that the return from the <code>pop</code> call was unused and would suggest the <code>del</code> instead.</p>
<p>Example</p>
<pre><code class="language-python">fruits = { 'apples': 3, 'pears': 4, 'bananas': 1 }

fruits.pop('apples') # &lt;-- suggest that developer change this to `del fruits['apples']`
del fruits['pears']

print(fruits)  # output: {'bananas':1}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-04-13 20:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-14 01:52</div>
            <div class="timeline-body"><p>Do you have any benchmark to support the performance difference? I'm doing a preliminary analysis and it shows no significant difference:</p>
<pre><code class="language-python">In [21]: %timeit d = {chr(i): i for i in range(10000)}; del d[chr(456)]
1.29 ms ± 55.5 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

In [22]: %timeit d = {chr(i): i for i in range(10000)}; d.pop(chr(456))
1.25 ms ± 14.6 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-14 01:56</div>
            <div class="timeline-body"><p>Another thing to note is this example:</p>
<pre><code class="language-python">fruits = {'apples': 3, 'pears': 4, 'bananas': 1}

# This will raise a KeyError
fruits.pop('oranges')

# This will _not_ raise a KeyError, so we can't recommend to use `del fruits['oranges']`
fruits.pop('oranges', None)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markis">@markis</a> on 2023-04-14 02:21</div>
            <div class="timeline-body"><blockquote>
<p>Do you have any benchmark to support the performance difference? I'm doing a preliminary analysis and it shows no significant difference:</p>
<pre><code class="language-python">In [21]: %timeit d = {chr(i): i for i in range(10000)}; del d[chr(456)]
1.29 ms ± 55.5 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

In [22]: %timeit d = {chr(i): i for i in range(10000)}; d.pop(chr(456))
1.25 ms ± 14.6 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</code></pre>
</blockquote>
<p>Earlier, I ran a similar test on my machine (python 3.10 on an M1) and <code>del</code> was definitely more performant and a quick google search confirmed <a href="https://stackoverflow.com/questions/60425973/which-is-faster-list-pop0-vs-del-list0">my bias</a>.</p>
<p>But after you mentioned that, I ran the same test on a production python server.  And seems like the timings are about the same.  Closing as it's environment specific and not globally true.  Thanks for checking, @dhruvmanila !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @markis on 2023-04-14 02:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-04-14 02:31</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for checking, @dhruvmanila !</p>
</blockquote>
<p>Happy to help! :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:52 UTC
    </footer>
</body>
</html>
