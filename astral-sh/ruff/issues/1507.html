<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use `banned-api` for deprecation checks in general - astral-sh/ruff #1507</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use <code>banned-api</code> for deprecation checks in general</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1507">#1507</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2022-12-31 09:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a></div>
            <div class="timeline-body"><p>The checks for uses of deprecated standard library features are currently split up across different rules, for example:</p>
<ul>
<li>UP019: <code>typing.Text</code> is deprecated, use <code>str</code></li>
<li>PGH002: <code>warn</code> is deprecated in favor of <code>warning</code></li>
</ul>
<p>Since there are many more deprecated things in the standard library (e.g. the <a href="https://docs.python.org/3/library/superseded.html">24 superseded modules</a>), I think it would make more sense to define these checks via the recently introduced <code>banned-api</code> mechanism rather than introducing separate checks for every single thing that is deprecated in the standard library. And I think we could reuse the flexible configuration  mechanism we already have for rules.</p>
<p>In particular I suggest the following to be a default config:</p>
<pre><code class="language-toml">[tool.ruff.banned-api.select]
&quot;typing.Text&quot; = {msg = &quot;deprecated&quot;, autofix-to = &quot;str&quot;}
&quot;logging.warn&quot; = {msg = &quot;deprecated&quot;, autofix-to = &quot;logging.warning&quot;}
&quot;optparse&quot; = {msg = &quot;deprecated, use `argparse` instead&quot;}
# etc ... other 23 deprecated stdlib modules
</code></pre>
<p>And allow users to either:</p>
<ul>
<li>disable these checks completely via <code>tool.ruff.banned-api.select = {}</code></li>
<li>ignore specific errors via e.g. <code>tool.ruff.banned-api.ignore = [&quot;optparse&quot;]</code></li>
<li>ban additional API via <code>tool.ruff.banned-api.extend-select</code></li>
</ul>
<p>Since this would make <code>banned-api</code> more of a core feature I think it would make sense to move the setting out of the <code>flake8-tidy-imports</code> namespace (and change the check code from TID251 to some RUF code).</p>
<p>The steps I have in mind are:</p>
<ol>
<li>convert TID251 to RUF???, moving the config section and enabling <code>banned-api</code> to be configured via select, ignore, extend-select &amp; extend-ignore</li>
<li>ban the 24 deprecated stdlib modules by default (along with <code>typing.Text</code> and <code>logging.warn</code> as shown above)</li>
<li>make UP019 and PGH002 transform <code>banned-api</code>, e.g. <code>ruff.extend-ignore = [ &quot;UP019&quot; ]</code> would be internally converted to <code>ruff.banned-api.extend-ignore = [&quot;typing.Text&quot;]</code></li>
<li>#835</li>
<li>Implement <code>autofix-to</code> for <code>banned-api</code>.</li>
<li>Introduce a <code>params</code> setting for <code>banned-api</code>, so that e.g. UP021 could be defined as
<code>banned-api.select.&quot;subprocess.run&quot; = {params = {universal_newlines = {autofix-to=&quot;text&quot;}}</code></li>
</ol>
<p>What do you think of this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow `banned-api` to be configured via the same mechanism we use for rules" to "Use `banned-api` for deprecation checks in general" by @not-my-profile on 2022-12-31 09:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2022-12-31 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-06-23 10:56</div>
            <div class="timeline-body"><p>This also intersects with <a href="https://beta.ruff.rs/docs/rules/deprecated-import/">UP035 / deprecated-import</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:45:53 UTC
    </footer>
</body>
</html>
