<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add license classifier back to pyproject.toml - astral-sh/ruff #19599</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add license classifier back to pyproject.toml</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19599">#19599</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-07-28 13:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-28 13:46</div>
            <div class="timeline-body"><p>Reverts astral-sh/ruff#19499</p>
<p>@AlexWaygood brought to light that the same change caused a lot of churn for <code>typing_extensions</code> users:</p>
<blockquote>
<p>Just as an FYI, we received a lot of confused bug reports at typing_extensions after we made a similar change, due to some tooling not yet supporting PEP 639</p>
<ul>
<li>https://github.com/python/typing_extensions/issues/576</li>
<li>https://github.com/python/typing_extensions/issues/563</li>
<li>https://github.com/python/typing_extensions/issues/562</li>
<li>https://github.com/python/typing_extensions/issues/559</li>
<li>https://github.com/python/typing_extensions/pull/584</li>
</ul>
</blockquote>
<p>Given that this causes significant churn without a very clear benefit for users, we decided to wait with this change until the ecosystem is further along.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-07-28 13:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>pyproject.toml</code>:26 on 2025-07-28 13:50</div>
            <div class="timeline-body"><p>We only need this line for backwards compatibility with pip-licenses, the rest can be PEP 639: https://github.com/raimon49/pip-licenses/blob/3fbf20f9d757d2b9298dfc97af1bd3a987124c98/piplicenses.py#L603-L612</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @MichaReiser on 2025-07-28 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-07-28 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-28 16:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>pyproject.toml</code>:26 on 2025-07-28 16:37</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    &quot;License :: OSI Approved :: MIT License&quot;,  # for compatibility with tooling such as pip-licenses
</code></pre>
<p>in case some eager contributors try to remove this, since it's officially deprecated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Revert "Use PEP 639 license information for Ruff itself instead of classifier"" to "Add license classifier back to pyproject.toml" by @AlexWaygood on 2025-07-28 16:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-07-28 19:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-07-28 19:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-28 19:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2025-07-31 07:53</div>
            <div class="timeline-body"><blockquote>
<p>Given that this causes significant churn without a very clear benefit for users, we decided to wait with this change until the ecosystem is further along.</p>
</blockquote>
<p>However, <code>typing_extensions</code> has not reverted this change.</p>
<p><a href="https://peps.python.org/pep-0639/#deprecate-license-classifiers">PEP 639</a> <strong>explicitly recommends removing the license classifier</strong>. Ruff should lead by example in adopting PEP 639 and encourage tools such as <code>pip-license</code> to follow suit.</p>
<p>Given its wide adoption, Ruff, like <code>typing_extensions</code>, bears a responsibility to help advance the Python ecosystem. @MichaReiser @AlexWaygood</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DimitriPapadopoulos">@DimitriPapadopoulos</a> on 2025-07-31 09:29</div>
            <div class="timeline-body"><p>@AlexWaygood I understand the <a href="https://github.com/python/typing_extensions"><code>typing_extensions</code></a> issues  are caused by <a href="https://github.com/raimon49/pip-licenses"><code>pip-licenses</code></a> missing support for PEP 639 (https://github.com/raimon49/pip-licenses/issues/225 and https://github.com/raimon49/pip-licenses/pull/213), aren't they?</p>
<p>But then the <strong>Test Plan</strong> in https://github.com/astral-sh/ruff/pull/19624#issue-3275015612 seems to suggest that <code>uv build --sdist</code> might not add the <code>LICENSE</code> file to the package. @ntBre Could you shed some light on the actual problem with #19499?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-31 09:37</div>
            <div class="timeline-body"><blockquote>
<p>But then the Test Plan in https://github.com/astral-sh/ruff/pull/19624#issue-3275015612 seems to suggest that uv build --sdist might not add the LICENSE file to the package. @ntBre Could you shed some light on the actual problem with https://github.com/astral-sh/ruff/pull/19499?</p>
</blockquote>
<p>This is the reason why we reverted the entire change and it requires a fix to maturin first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DimitriPapadopoulos">@DimitriPapadopoulos</a> on 2025-07-31 11:19</div>
            <div class="timeline-body"><p>Are you certain this is an issue with maturin? In theory, maturin ≥ 1.9 is supposed to support PEP 639:
https://www.maturin.rs/changelog.html</p>
<p>As far as I can understand, this is an issue with <a href="https://github.com/raimon49/pip-licenses">pip-licenses</a> which is unable to find the licensing information in package metadata. Are you really implying the licensing information is missing from package metadata?</p>
<p>According to https://github.com/raimon49/pip-licenses/blob/master/README.md#option-from:</p>
<blockquote>
<p>this tool finds the license from <a href="https://pypi.org/classifiers/">Trove Classifiers</a> or package Metadata.</p>
</blockquote>
<p>Change #19499 does two things:</p>
<ol>
<li>Removing the classifier, which means pip-licenses will be unable to find licensing information in classifiers and should fall back to package metatdata.</li>
<li>Modifying licensing declaration in <code>pyproject.toml</code> which modifies package metadata. I must admit I don't know which exact changes are applied by maturin, but see below the changes applied by setuptools.</li>
</ol>
<p>Using setuptools, a <code>pyproject.toml</code> file looking like this:</p>
<pre><code class="language-toml">license = {text = &quot;GPL-3.0-or-later&quot;}
classifiers = [
    &quot;License :: OSI Approved :: GNU General Public License v3 (GPLv3)&quot;,
]
</code></pre>
<p>yields a <code>PKG-INFO</code> like this one, with the <code>LICENSE</code> file found without explicit declaration:</p>
<pre><code>License: GPL-3.0-or-later
Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
License-File: LICENSE
</code></pre>
<p>while such a <code>pyproject.toml</code> file:</p>
<pre><code class="language-toml">license = &quot;GPL-3.0-or-later&quot;
</code></pre>
<p>yields a <code>PKG-INFO</code> like this one:</p>
<pre><code>License-Expression: GPL-3.0-or-later
License-File: LICENSE
</code></pre>
<p>I believe pip-licences does not support the switch from <code>License</code> to <code>License-Expression</code> in package metadata, which is caused by the switch from <code>license = {text = &quot;...&quot;}</code> to <code>license = &quot;...&quot;</code> in <code>pyproject.toml</code>. However, this could be mitigated by keeping the Trove classifier for compatibility. How does this sound?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-31 11:51</div>
            <div class="timeline-body"><p>A maturin maintainer identified it as a bug https://github.com/PyO3/maturin/compare/konsti/add-license-files-to-sdist</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DimitriPapadopoulos">@DimitriPapadopoulos</a> on 2025-08-01 14:26</div>
            <div class="timeline-body"><p>Once the maturin bug is fixed, hopefully in release 1.9.3, perhaps #19499 can be reconsidered as #19661.</p>
<p>It turns out <a href="https://github.com/raimon49/pip-licenses">pip-licences</a> is not much maintained and has been forked into <a href="https://github.com/stefan6419846/pip-licenses-cli">pip-licenses-cli</a> which does support PEP 639. Not sure it's worth taking it into account.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-04 18:59</div>
            <div class="timeline-body"><p>Maturin 1.9.3 with the fix for source dist license file inclusions is out</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:52:43 UTC
    </footer>
</body>
</html>
