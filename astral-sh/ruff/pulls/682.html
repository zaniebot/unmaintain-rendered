<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add fixes for __future__ import removal - astral-sh/ruff #682</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add fixes for <strong>future</strong> import removal</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/682">#682</a>
        opened by <a href="https://github.com/chammika-become">@chammika-become</a>
        on 2022-11-11 12:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/chammika-become">@chammika-become</a> on 2022-11-11 12:53</div>
            <div class="timeline-body"><p>This PR will close #312</p>
<ul>
<li>Added Fixes to remove detected imports</li>
<li>Added more test fixtures</li>
<li>Added <code>UnnecessaryFutureImports</code> to <code>fixable</code></li>
<li>Updated README</li>
</ul>
<p>Detection/fix code is elevated to the <code>Stmt</code> level since some imports need to be fully removed. Earlier detection at <code>alias</code> level doesn't seem right for that. As suggested, fix code is heavily borrowed from <code>pyflakes::fixes::remove_unused_import_froms</code>, perhaps need to refactor in future to share code.
One main thing to object to, is that fix code pretty much do the detection all over again.
@charliermarsh is there better way to share detection results for fix purposes other than to display messages ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/checks.rs</code>:1469 on 2022-11-11 16:21</div>
            <div class="timeline-body"><p>Nit: can we make this <code>names</code> and take a vector, rather than a pre-formatted string? Then we can split the check to have proper pluralization, like:</p>
<pre><code class="language-rust">CheckKind::DuplicateHandlerException(names) =&gt; {
    if names.len() == 1 {
        let name = &amp;names[0];
        format!(&quot;Exception handler with duplicate exception: `{name}`&quot;)
    } else {
        let names = names.iter().map(|name| format!(&quot;`{name}`&quot;)).join(&quot;, &quot;);
        format!(&quot;Exception handler with duplicate exceptions: {names}&quot;)
    }
}
</code></pre>
<p>(Using a vector as the argument, rather than a pre-formatted string, will also yield a nicer fixture file, since the list of names will be structured data rather than a comma-joined string.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/fixes.rs</code>:187 on 2022-11-11 16:23</div>
            <div class="timeline-body"><p>I know you mentioned this in the PR summary, but we should try to avoid having this logic in two places (right now it's here, but also in <code>pyupgrade/checks.rs</code>).</p>
<p>How bout we remove <code>pyupgrade/checks.rs</code>, move the detection logic into <code>pyupgrade/plugins/unnecessary_future_import.rs</code> directly, and then pass in the list of names to remove as an argument to this function directly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/fixes.rs</code>:199 on 2022-11-11 16:25</div>
            <div class="timeline-body"><p>We do need to pass in <code>parent</code> and <code>deleted</code> here, as in <code>remove_unused_import_froms</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-11-11 16:26</div>
            <div class="timeline-body"><p>Great! Some feedback below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chammika-become">@chammika-become</a> on <code>src/pyupgrade/fixes.rs</code>:187 on 2022-11-12 15:04</div>
            <div class="timeline-body"><p>Make sense. Removed from <code>checks</code> and moved to the <code>plugins</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chammika-become">@chammika-become</a> reviewed on 2022-11-12 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chammika-become">@chammika-become</a> reviewed on 2022-11-12 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chammika-become">@chammika-become</a> on <code>src/pyupgrade/fixes.rs</code>:199 on 2022-11-12 15:07</div>
            <div class="timeline-body"><p>Got the <code>deleted</code>, I am at lost about how to get the <code>parent</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-11-12 15:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/fixes.rs</code>:199 on 2022-11-12 15:25</div>
            <div class="timeline-body"><p>All good, Iâ€™ll take a look and fix before merging :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2022-11-12 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2022-11-12 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-11-12 16:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 05:50:58 UTC
    </footer>
</body>
</html>
