<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drop `Violation::placeholder` - astral-sh/ruff #1996</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Drop <code>Violation::placeholder</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1996">#1996</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2023-01-19 14:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a></div>
            <div class="timeline-body"><p>This PR removes the following associated function from the Violation trait:</p>
<pre><code>fn placeholder() -&gt; Self;</code></pre>
<p>ruff previously used this placeholder approach for the messages it
listed in the README and displayed when invoked with <code>--explain &lt;code&gt;</code>.</p>
<p>This approach is suboptimal for three reasons:</p>
<ol>
<li><p>The placeholder implementations are completely boring code since they
just initialize the struct with some dummy values.</p>
</li>
<li><p>Displaying concrete error messages with arbitrary interpolated values
can be confusing for the user since they might not recognize that the
values are interpolated.</p>
</li>
<li><p>Some violations have varying format strings depending on the
violation which could not be documented with the previous approach
(while we could have changed the signature to return Vec this
would still very much suffer from the previous two points).</p>
</li>
</ol>
<p>We therefore drop Violation::placeholder in favor of a new macro-based
approach, explained in commit 4/5.</p>
<p>For the details please refer to the individual commit messages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:33 on 2023-01-19 15:22</div>
            <div class="timeline-body"><p>I&#x27;d prefer to leave this for now. We should make it clearer eventually, but I worry that as-is it&#x27;ll hurt the readability and simplicity of the table.</p>
<p>I&#x27;m happy to play around with some alternate formats in a future PR.</p>
<p><img src="https://user-images.githubusercontent.com/1309177/213482810-feb07291-7dbd-49e1-a268-8e6c4c218c38.png" alt="Screen Shot 2023-01-19 at 10 26 25 AM"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs</code>:1 on 2023-01-19 15:25</div>
            <div class="timeline-body"><p>Should these include the rule code at the end, like you did in the DTZ examples?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:33 on 2023-01-19 15:28</div>
            <div class="timeline-body"><p>(Unrelatedly: the use of the actual format strings is not only simpler for maintenance but so much clearer for users. Nice job.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_macros/src/derive_message_formats.rs</code>:16 on 2023-01-19 15:29</div>
            <div class="timeline-body"><p>What&#x27;s the failure mode in the event that a violation doesn&#x27;t contain a format string?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-19 15:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 15:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:33 on 2023-01-19 15:49</div>
            <div class="timeline-body"><p>Fair enough I have removed the display of &quot;(sometimes)&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs</code>:1 on 2023-01-19 15:57</div>
            <div class="timeline-body"><p>I don&#x27;t think so. I think my goal is to centrally define all rule codes within a single file (including many to many mappings) and have our documentation generator combine these doc comments with the codes from that file.</p>
<p>I just included the codes in the datetimez comments since they were there previously ... but I don&#x27;t think it really matters there since I think the datetimez rule implementations should ultimately be replaced by #1507.</p>
<p>(I still have to think about how to best implement the documentation generation from such doc comments ... but that&#x27;s out of the scope of this PR.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>ruff_macros/src/derive_message_formats.rs</code>:16 on 2023-01-19 15:58</div>
            <div class="timeline-body"><p>Compilation fails with a nice error message:</p>
<pre><code>error: expected last expression to be a format! macro or a match block
   --&gt; src/violations.rs:539:9
    |
539 |         &quot;foo&quot;.to_string()
    |         ^^^^^
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 15:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-19 16:01</div>
            <div class="timeline-body"><p>I have just changed the associated constant introduced in the 3rd commit from:</p>
<pre><code>const AUTOFIXABLE: Autofixability = Autofixability::Never;
</code></pre>
<p>to</p>
<pre><code>const AUTOFIX: Option&lt;AutofixKind&gt; = None;
</code></pre>
<p>so that we can easily introduce another field for applicability (#1997) in the future :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-19 16:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_macros/src/derive_message_formats.rs</code>:16 on 2023-01-19 16:01</div>
            <div class="timeline-body"><p>Perfect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-19 16:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs</code>:1 on 2023-01-19 16:02</div>
            <div class="timeline-body"><p>I mostly find those comments useful for grep. E.g., if someone reports a bug in <code>SIM109</code>, it&#x27;s useful to be able to search <code>/// SIM109</code> and jump to the definition. I think there&#x27;s some value in making that easy, since even if we move away from those codes internally, they&#x27;ll still pop up in issue reports and such. (It doesn&#x27;t matter to me that they&#x27;re in the rustdoc or not.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 16:04</div>
            <div class="timeline-body"><p>You&#x27;re doing so much good work on pushing these abstractions forward. These are highly complex changes and you&#x27;re handling them expertly. It&#x27;s much appreciated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 16:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs</code>:1 on 2023-01-19 16:08</div>
            <div class="timeline-body"><p>Right I think we could end up having a <code>cargo dev jump SIM109</code> command that would print where the respective rule is defined (if we end up no longer defining them next to the functions).</p>
<blockquote>
<p>It doesn&#x27;t matter to me that they&#x27;re in the rustdoc or not.</p>
</blockquote>
<p>The plan is that such doc comments will become the user documentation.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:52 UTC
    </footer>
</body>
</html>
