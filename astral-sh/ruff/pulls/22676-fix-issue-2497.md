```yaml
number: 22676
title: Fix issue 2497
type: pull_request
state: open
author: MichaReiser
labels: []
assignees: []
draft: true
base: main
head: claude/fix-issue-2497-j5GU2
created_at: 2026-01-18T11:58:49Z
updated_at: 2026-01-18T12:09:26Z
url: https://github.com/astral-sh/ruff/pull/22676
synced_at: 2026-01-18T12:19:40Z
```

# Fix issue 2497

---

_@MichaReiser_

## Summary

When a doctest ended on a blank line, `in_doctest` was not reset to `false`. This could cause issues when a docstring contained a doctest followed by a literal block (::) with blank lines inside it.

In that scenario, a blank line inside the literal block would incorrectly trigger the doctest-ending logic (because `in_doctest` was still `true` from the earlier doctest), prematurely closing the literal block and causing subsequent code content to be rendered as regular text with `&nbsp;` indentation instead of being inside the code block.

Fixes https://github.com/astral-sh/ty/issues/2497

## Test Plan

Added test

---
