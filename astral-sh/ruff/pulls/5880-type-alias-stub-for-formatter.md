```yaml
number: 5880
title: Type alias stub for formatter
type: pull_request
state: merged
author: konstin
labels:
  - formatter
assignees: []
merged: true
base: main
head: type_alias_stub_for_formatter
created_at: 2023-07-19T11:36:16Z
updated_at: 2023-07-19T15:28:08Z
url: https://github.com/astral-sh/ruff/pull/5880
synced_at: 2026-01-12T03:30:22Z
```

# Type alias stub for formatter

---

_Pull request opened by @konstin on 2023-07-19 11:36_

**Summary** This replaces the `todo!()` with a type alias stub in the formatter. I added the tests from https://github.com/RustPython/Parser/blob/704eb40108239a8faf9bd1d4217e8dad0ac7edb3/parser/src/parser.rs#L901-L936 as ruff python formatter tests.

**Test Plan** None, testing is part of the actual implementation


---

_Comment by @konstin on 2023-07-19 11:36_

Current dependencies on/for this PR:
* main
  * **PR #5880** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5880" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ğŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5880?utm_source=stack-comment).

---

_@MichaReiser approved on 2023-07-19 11:38_

---

_Comment by @MichaReiser on 2023-07-19 11:38_

We should pull in Black's type alias tests too (`py12` folder)

https://github.com/astral-sh/ruff/blob/5d68ad9008ba97c01655d8c481826155db39c201/crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py#L45-L56


---

_Comment by @github-actions[bot] on 2023-07-19 11:46_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.4Â±0.03ms     4.3 MB/sec    1.01      9.5Â±0.04ms     4.3 MB/sec
formatter/numpy/ctypeslib.py               1.00   1877.1Â±1.74Âµs     8.9 MB/sec    1.00   1883.3Â±1.89Âµs     8.8 MB/sec
formatter/numpy/globals.py                 1.00    210.4Â±2.31Âµs    14.0 MB/sec    1.01   212.0Â±10.04Âµs    13.9 MB/sec
formatter/pydantic/types.py                1.00      4.0Â±0.02ms     6.3 MB/sec    1.01      4.1Â±0.02ms     6.3 MB/sec
linter/all-rules/large/dataset.py          1.00     12.9Â±0.09ms     3.1 MB/sec    1.01     13.1Â±0.08ms     3.1 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.3Â±0.01ms     5.1 MB/sec    1.01      3.3Â±0.01ms     5.0 MB/sec
linter/all-rules/numpy/globals.py          1.00    434.8Â±0.81Âµs     6.8 MB/sec    1.00    435.8Â±0.88Âµs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.9Â±0.02ms     4.3 MB/sec    1.01      5.9Â±0.02ms     4.3 MB/sec
linter/default-rules/large/dataset.py      1.00      6.6Â±0.02ms     6.1 MB/sec    1.01      6.7Â±0.02ms     6.1 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1427.3Â±2.74Âµs    11.7 MB/sec    1.00   1429.5Â±1.81Âµs    11.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    156.6Â±0.28Âµs    18.8 MB/sec    1.01    157.4Â±0.24Âµs    18.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.0Â±0.01ms     8.5 MB/sec    1.01      3.0Â±0.01ms     8.4 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.1Â±0.34ms     3.7 MB/sec    1.04     11.5Â±0.12ms     3.5 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.2Â±0.03ms     7.6 MB/sec    1.03      2.2Â±0.03ms     7.4 MB/sec
formatter/numpy/globals.py                 1.00    247.5Â±5.55Âµs    11.9 MB/sec    1.02    251.8Â±6.99Âµs    11.7 MB/sec
formatter/pydantic/types.py                1.00      4.8Â±0.07ms     5.3 MB/sec    1.05      5.0Â±0.09ms     5.1 MB/sec
linter/all-rules/large/dataset.py          1.01     15.6Â±0.20ms     2.6 MB/sec    1.00     15.4Â±0.19ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.1Â±0.05ms     4.1 MB/sec    1.00      4.1Â±0.04ms     4.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    489.1Â±6.29Âµs     6.0 MB/sec    1.01   493.3Â±11.88Âµs     6.0 MB/sec
linter/all-rules/pydantic/types.py         1.01      7.1Â±0.14ms     3.6 MB/sec    1.00      7.0Â±0.09ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.1Â±0.11ms     5.0 MB/sec    1.00      8.1Â±0.07ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1672.5Â±19.32Âµs    10.0 MB/sec    1.01  1682.6Â±18.61Âµs     9.9 MB/sec
linter/default-rules/numpy/globals.py      1.00    190.1Â±4.52Âµs    15.5 MB/sec    1.01    192.9Â±6.45Âµs    15.3 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6Â±0.04ms     7.2 MB/sec    1.02      3.6Â±0.05ms     7.0 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Label `formatter` added by @konstin on 2023-07-19 12:56_

---

_Comment by @konstin on 2023-07-19 13:01_

I've updated the black tests and imported the 3.12 tests

---

_@zanieb reviewed on 2023-07-19 13:27_

---

_Review comment by @zanieb on `crates/ruff_python_formatter/resources/test/fixtures/black/py_312/type_params.py`:9 on 2023-07-19 13:27_

We probably want test coverage for long bounds with multiple items.

---

_Review comment by @zanieb on `crates/ruff_python_formatter/resources/test/fixtures/black/py_312/type_params.py`:5 on 2023-07-19 13:28_

We probably want a "long" case with type var tuples (`*Ts`) and (`**P`) to cover splitting behavior with the leading stars.

---

_@zanieb reviewed on 2023-07-19 13:28_

---

_@zanieb reviewed on 2023-07-19 13:30_

---

_Review comment by @zanieb on `crates/ruff_python_formatter/resources/test/fixtures/black/py_312/type_aliases.py`:1 on 2023-07-19 13:30_

Why no long cases here?

We're also missing quite a few use cases. Perhaps https://github.com/RustPython/Parser/blob/704eb40108239a8faf9bd1d4217e8dad0ac7edb3/parser/src/parser.rs#L901-L936 would be helpful

---

_@zanieb reviewed on 2023-07-19 13:31_

---

_Review comment by @zanieb on `crates/ruff_python_formatter/resources/test/fixtures/black/py_312/type_aliases.py`:5 on 2023-07-19 13:31_

Is this covering use as an identifier? Many more cases at https://github.com/RustPython/Parser/blob/704eb40108239a8faf9bd1d4217e8dad0ac7edb3/parser/src/parser.rs#L945-L974 but honestly I'm not sure these belong in the formatter tests unless we can't assume the parser is handling this correctly?

---

_Comment by @konstin on 2023-07-19 14:21_

@zanieb These tests are automatically copied from black, they are a baseline for our formatter, we normally add our own tests whenever we implement a node (i only added a stub is it writes a dummy instead of panicking). I now added the tests from https://github.com/RustPython/Parser/blob/704eb40108239a8faf9bd1d4217e8dad0ac7edb3/parser/src/parser.rs#L901-L936 as crates/ruff_python_formatter/resources/test/fixtures/ruff/statement/type_alias.py

---

_Comment by @zanieb on 2023-07-19 14:37_

Ah I see ğŸ‘ 

---

_Merged by @konstin on 2023-07-19 15:28_

---

_Closed by @konstin on 2023-07-19 15:28_

---

_Branch deleted on 2023-07-19 15:28_

---
