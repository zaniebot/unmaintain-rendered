<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignore deprecated rules unless selected by exact code - astral-sh/ruff #20167</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignore deprecated rules unless selected by exact code</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20167">#20167</a>
        opened by <a href="https://github.com/LoicRiegel">@LoicRiegel</a>
        on 2025-08-30 14:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LoicRiegel">@LoicRiegel</a></div>
            <div class="timeline-body">

Summary
<p>Closes #18349</p>
<p>After this change:</p>
<ul>
<li>All deprecated rules are deselected by default</li>
<li>They are only selected if the user specifically selects them by code, e.g. <code>--select UP038</code></li>
<li>Thus, <code>--select ALL --select UP --select UP0</code> won&#x27;t select the deprecated rule UP038</li>
<li>Documented the change in version policy. From now on, deprecating a rule should increase the minor version</li>
</ul>
Test Plan
<p>Integration tests in &quot;integration_tests.rs&quot;</p>
<p>Also tested with a temporary test package:</p>
<pre><code>~&gt; ../../ruff/target/debug/ruff.exe check --select UP038
warning: Rule `UP038` is deprecated and will be removed in a future release.
warning: Detected debug build without --no-cache.
UP038 Use `X | Y` in `isinstance` call instead of `(X, Y)`
 --&gt; main.py:2:11
  |
1 | def main():
2 |     print(isinstance(25, (str, int)))
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Convert to `X | Y`

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).

~&gt; ../../ruff/target/debug/ruff.exe check --select UP03
warning: Detected debug build without --no-cache.
All checks passed!

~&gt; ../../ruff/target/debug/ruff.exe check --select UP0
warning: Detected debug build without --no-cache.
All checks passed!

~&gt; ../../ruff/target/debug/ruff.exe check --select UP
warning: Detected debug build without --no-cache.
All checks passed!

~&gt; ../../ruff/target/debug/ruff.exe check --select ALL
# warnings and errors, but because of other errors, UP038 was deselected
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v0.13&quot; by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-03 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1473 on 2025-09-03 14:56</div>
            <div class="timeline-body"><p>This is a pretty small nit, but I&#x27;d lean toward not changing any names or comments unless they&#x27;re really outdated. I think this case, and <code>deprecated_multiple_direct</code> at least were okay with the old names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1515 on 2025-09-03 14:58</div>
            <div class="timeline-body"><p>Similar to the above, I think the name here was okay. But the new comment makes sense to me given the changed test result.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1545 on 2025-09-03 15:00</div>
            <div class="timeline-body"><p>I&#x27;d kind of prefer to preserve the existing tests and add new ones rather than modify these, unless they&#x27;re now redundant with other tests. Is that the case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-03 15:04</div>
            <div class="timeline-body"><p>Thank you!  The code and docs changes look good to me, I just had a few nits about the tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-03 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-03 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-03 15:07</div>
            <div class="timeline-body"><p>I also labeled this breaking, as Micha mentioned <a href="https://github.com/astral-sh/ruff/issues/18349#issuecomment-2929741873">here</a>. But we&#x27;re preparing for a minor release next week, so we can merge this into the <a href="https://github.com/astral-sh/ruff/pull/20194">release branch</a> instead of <code>main</code>. GitHub warned me that changing the base branch might remove review comments, though, so I held off for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-03 15:16</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -1 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<a href="https://github.com/rotki/rotki">rotki/rotki</a> (+0 -1 violations, +0 -0 fixes)
<p>

<pre>
- <a href="https://github.com/rotki/rotki/blob/59fc8d51b8805fd9b427b67f0f1282c6a2e12ee2/rotkehlchen/externalapis/blockscout.py#L205">rotkehlchen/externalapis/blockscout.py:205:40:</a> UP038 Use `X | Y` in `isinstance` call instead of `(X, Y)`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| UP038 | 1 | 0 | 1 | 0 | 0 |</p>
</p>


Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on 2025-09-03 15:23</div>
            <div class="timeline-body"><p>Thank you for the review, I will make the changes now.
Do you want me to keep the commit history clean, or will you squash everything anyway?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-03 15:25</div>
            <div class="timeline-body"><p>Thank you! We&#x27;ll squash everything when merging, so it&#x27;s actually a bit easier to review if you push additional commits, in my opinion</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on 2025-09-03 21:41</div>
            <div class="timeline-body"><p>I just pushed three commits where</p>
<ul>
<li>I reverted the tests to the way they were</li>
<li>Wrote comments for all tests concerned by this change so they are more precise and all consistent</li>
<li>I swapped two tests to make the order consistent, I hope that&#x27;s okay</li>
</ul>
<p>Tell me if everything&#x27;s alright now :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1473 on 2025-09-05 14:15</div>
            <div class="timeline-body"><p>I think the <code>without preview</code> part is still accurate right? I do slightly prefer your wording otherwise, but I&#x27;d probably still leave this comment alone just to minimize the diff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1532 on 2025-09-05 14:16</div>
            <div class="timeline-body"><p>Yeah looks like the preview behavior is still preserved, which I think is desired. I&#x27;d say just to revert this comment change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1548 on 2025-09-05 14:19</div>
            <div class="timeline-body"><p>The old test still seems relevant to me. It shows that indirect selection in preview does <em>not</em> produce the failure that a direct selection in preview does. I think we can revert the changes to this test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1567 on 2025-09-05 14:20</div>
            <div class="timeline-body"><p>Ohh, I see. It looks like you swapped the order of these two tests. I think the existing tests were okay, we can probably just revert this too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-05 14:22</div>
            <div class="timeline-body"><p>Thanks! Just a few more test suggestions to reduce the diff a bit more. I have a better understanding of the tests now and think they mostly still look relevant in their original form.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LoicRiegel">@LoicRiegel</a> reviewed on 2025-09-05 14:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on <code>crates/ruff/tests/integration_test.rs</code>:1473 on 2025-09-05 14:53</div>
            <div class="timeline-body"><p>Is minimizing the diff such a big goal?
In my experience, it&#x27;s better to allow (even encourage) small improvements like this. This helps keep the code clean and up-to-date.
If the change is too big (like renaming a variable which is used a lot across the project), I&#x27;d want it to be a proper PR/commit but in my case, the diff is small.</p>
<p>That said, I understand it&#x27;s important in this project, so I&#x27;ll comply, no problem:)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff/tests/integration_test.rs</code>:1473 on 2025-09-05 15:29</div>
            <div class="timeline-body"><p>It&#x27;s not such a big deal, I just lean toward preserving the original code/comments if it&#x27;s not a really clear improvement. This is just a slight phrasing improvement, so I don&#x27;t think it&#x27;s worth adding another step to checking the git-blame in the future, for example. In other cases I&#x27;d probably agree with you :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-05 15:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LoicRiegel">@LoicRiegel</a> reviewed on 2025-09-07 11:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on <code>crates/ruff/tests/integration_test.rs</code>:1567 on 2025-09-07 11:20</div>
            <div class="timeline-body"><p>reverted</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LoicRiegel">@LoicRiegel</a> reviewed on 2025-09-07 11:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on <code>crates/ruff/tests/integration_test.rs</code>:1548 on 2025-09-07 11:21</div>
            <div class="timeline-body"><p>reverted</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LoicRiegel">@LoicRiegel</a> reviewed on 2025-09-07 11:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on <code>crates/ruff/tests/integration_test.rs</code>:1532 on 2025-09-07 11:21</div>
            <div class="timeline-body"><p>reverted</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LoicRiegel">@LoicRiegel</a> reviewed on 2025-09-07 11:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on <code>crates/ruff/tests/integration_test.rs</code>:1473 on 2025-09-07 11:21</div>
            <div class="timeline-body"><p>reverted</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LoicRiegel">@LoicRiegel</a> on 2025-09-07 11:21</div>
            <div class="timeline-body"><blockquote>
<p>Thanks! Just a few more test suggestions to reduce the diff a bit more. I have a better understanding of the tests now and think they mostly still look relevant in their original form.</p>
</blockquote>
<p>Done :)
Now the diff is as small as it can be :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-09-08 15:58</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Feat/ignore deprecated rules by unless selected by exact code&quot; to &quot;Ignore deprecated rules unless selected by exact code&quot; by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-08 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-08 16:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-08 16:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:12 UTC
    </footer>
</body>
</html>
