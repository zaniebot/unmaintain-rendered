<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF027: Ignore template strings passed to logging calls and `builtins._()` calls - astral-sh/ruff #12889</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF027: Ignore template strings passed to logging calls and <code>builtins._()</code> calls</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12889">#12889</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-08-14 09:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>#12869 initially proposed stabilising RUF027, but the ecosystem report showed that there were too many false positives. Some of those false positives stem from the fact that we currently emit errors on calls like this:</p>
<pre><code class="language-py">import logging

foo = 42
logging.error(&quot;{foo}&quot;)
</code></pre>
<p>But you're not meant to pass f-strings to logging calls, as the <code>logging</code> module lazily evaluates template strings like this to improve performance. The default style of string interpolation used by the <code>logging</code> module is <code>%</code>-style interpolation, but this can be configured to use <code>{}</code>-style instead: https://docs.python.org/3/howto/logging-cookbook.html#formatting-styles. As such, this PR adjusts the rule's logic to ignore any strings that are inside logging calls.</p>
<p>I'm also making another small tweak to the logic used to detect <code>gettext</code> calls. Specifically, we weren't recognising a fully qualified call to <code>builtins._()</code> as a <code>gettext</code> call. But running <code>gettext.install()</code> literally monkeypatches the <code>builtins</code> module, so even this fully qualified access should be recognised by us as a <code>gettext</code> call.</p>
<h2>Test Plan</h2>
<p>I added some new fixtures that Ruff will emit errors on currently, but doesn't with this PR branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-08-14 09:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @AlexWaygood on 2024-08-14 09:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-14 10:07</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-14 10:11</div>
            <div class="timeline-body"><blockquote>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</blockquote>
<p>I suspected that this might be the case. The false positives highlighted in the ecosystem check in https://github.com/astral-sh/ruff/pull/12869 looked like this, which we'll still currently emit a false positive error on, even with this PR (because the string is assigned to a variable <em>before</em> being passed to a <code>logging</code> call):</p>
<pre><code class="language-py">import logging
foo = 42
logging_string = &quot;{foo}&quot;
logging.error(logging_string)
</code></pre>
<p>I have ideas for how to get rid of this false positive, but it's more involved, so I'd prefer to do it as a followup to this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-08-14 10:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-14 10:26</div>
            <div class="timeline-body"><p>Nice! And thanks for the very detailed summary. It made reviewing a piece of cake</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-08-14 10:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-08-14 10:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-14 10:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:05:58 UTC
    </footer>
</body>
</html>
