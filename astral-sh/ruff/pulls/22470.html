<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIP: Ruffen docs prototype - astral-sh/ruff #22470</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>WIP: Ruffen docs prototype</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22470">#22470</a>
        opened by <a href="https://github.com/amyreese">@amyreese</a>
        on 2026-01-09 01:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a></div>
            <div class="timeline-body"><p>Issue #3792</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-09 01:39</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Ruffen docs prototype" to "WIP: Ruffen docs prototype" by @amyreese on 2026-01-09 16:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-13 02:21</div>
            <div class="timeline-body"><p>minimal working prototype using regex adapted from blacken-docs:</p>
<pre><code>amethyst@lunatone ~/workspace/ruff amy/ruffen-docs » cat ~/scratch/test.md
Hello, this is a *markdown* document.

This is a rust code block:

```rust
fn main() {
    for x in 0..10 {
        println!(&quot;x = {x}&quot;);
    }
}
```

This is a poorly formatted python code block:

```py
def foo(arg1,
           arg2):
    print( &quot;hello world&quot;)



foo(1 , 2)
```

This is another python code block, also poorly formatted, but now in a list:

1. List item 1
2. List item 2

    ```python
    dataset = [1, 2, 3,
        4, 5, 6]
    if 1+2==3:
        print('yes')
    ```

And here's an unlabeled code block that happens to have valid python code — what do we do?

```
print(&quot;hello&quot;)
```

amethyst@lunatone ~/workspace/ruff amy/ruffen-docs » cargo run -p ruff -- format --no-cache --diff ~/scratch/test.md
   Compiling ruff v0.14.11 (/Users/amethyst/workspace/ruff/crates/ruff)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.66s
     Running `target/debug/ruff format --no-cache --diff /Users/amethyst/scratch/test.md`
--- /Users/amethyst/scratch/test.md
+++ /Users/amethyst/scratch/test.md
@@ -13,13 +13,11 @@
 This is a poorly formatted python code block:

 ```py
-def foo(arg1,
-           arg2):
-    print( &quot;hello world&quot;)
+def foo(arg1, arg2):
+    print(&quot;hello world&quot;)


-
-foo(1 , 2)
+foo(1, 2)
 ```

 This is another python code block, also poorly formatted, but now in a list:
@@ -28,10 +26,9 @@
 2. List item 2

     ```python
-    dataset = [1, 2, 3,
-        4, 5, 6]
-    if 1+2==3:
-        print('yes')
+    dataset = [1, 2, 3, 4, 5, 6]
+    if 1 + 2 == 3:
+        print(&quot;yes&quot;)
     ```

 And here's an unlabeled code block that happens to have valid python code — what do we do?

1 file would be reformatted
&gt; [1]

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-13 02:25</div>
            <div class="timeline-body"><p>Some notes on the regex adapted from blacken-docs:</p>
<ul>
<li>it does not support <code>~~~</code> delimited code blocks</li>
<li>it does not support code blocks delimited by more than three backticks/tildes</li>
<li>it does verify that indentation and the end delimiter matches the starting delimiter</li>
</ul>
<p>Prototype also silently discards any formatting error, and those should either be warnings or get tracked somehow to re-raise them outside of the closure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2026-01-13 02:25</div>
            <div class="timeline-body"><p>Also need to decide on if/how to gate this behind <code>--preview</code></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-13 03:22:13 UTC
    </footer>
</body>
</html>
