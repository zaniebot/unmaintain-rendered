<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use non-parenthesized range for `DebugText` - astral-sh/ruff #9953</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use non-parenthesized range for <code>DebugText</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9953">#9953</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-02-12 15:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>This PR fixes the <code>DebugText</code> implementation to use the expression range instead of the parenthesized range.</p>
<p>Taking the following code snippet as an example:</p>
<pre><code>x = 1
print(f&quot;{  ( x  ) = }&quot;)
</code></pre>
<p>The output of running it would be:</p>
<pre><code>  ( x  ) = 1
</code></pre>
<p>Notice that the whitespace between the parentheses and the expression is preserved as is.</p>
<p>Currently, we don&#x27;t preserve this information in the AST which defeats the purpose of <code>DebugText</code> as the main purpose of the struct is to preserve whitespaces <em>around</em> the expression.</p>
<p>This is also problematic when generating the code from the AST node as then the generator has no information about the parentheses the whitespaces between them and the expression which would lead to the removal of the parentheses in the generated code.</p>
<p>I noticed this while working on the f-string formatting where the debug text would be used to preserve the text surrounding the expression in the presence of debug expression. The parentheses were being dropped then which made me realize that the problem is instead in the parser.</p>
Test Plan
<ol>
<li>Add a test case for the parser</li>
<li>Add a test case for the generator</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-12 15:20</div>
            <div class="timeline-body"><p>Can you add a short explanation why it should use the expression range instead of the parenthesized range?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-12 15:33</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-02-12 16:48</div>
            <div class="timeline-body"><p>Thanks for the explanation. It helped me understand the change and makes this a very easy review :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Update `DebugText` with non-parenthesized range&quot; to &quot;Use non-parenthesized range for `DebugText`&quot; by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-12 17:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:01:38 UTC
    </footer>
</body>
</html>
