<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add property test generators for variable-length tuples - astral-sh/ruff #18901</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add property test generators for variable-length tuples</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18901">#18901</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2025-06-23 17:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a></div>
            <div class="timeline-body"><p>Add property test generators for the new variable-length tuples. This covers homogeneous tuples as well.</p>
<p>The property tests did their job! This identified several fixes we needed to make to various type property methods.</p>
<p>cf <a href="https://github.com/astral-sh/ruff/pull/18600">astral-sh/ruff#18600</a>#issuecomment-2993764471</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-23 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-23 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-23 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-23 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-23 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-23 17:42</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>paasta (https://github.com/yelp/paasta)
+ error[unresolved-reference] paasta_tools/paastaapi/model/instance_status_adhoc.py:152:30: Name `_path_to_item` used when not defined
+ error[unresolved-reference] paasta_tools/paastaapi/model/instance_tasks.py:147:30: Name `_path_to_item` used when not defined
+ error[unresolved-reference] paasta_tools/paastaapi/model/resource.py:152:30: Name `_path_to_item` used when not defined
- Found 934 diagnostics
+ Found 937 diagnostics

strawberry (https://github.com/strawberry-graphql/strawberry)
- error[unresolved-attribute] strawberry/tools/merge_types.py:26:11: Type `type` has no attribute `__strawberry_definition__`
- Found 372 diagnostics
+ Found 371 diagnostics

hydra-zen (https://github.com/mit-ll-responsible-ai/hydra-zen)
+ warning[possibly-unbound-attribute] src/hydra_zen/structured_configs/_implementations.py:2146:28: Attribute `get` on type `DataclassOptions | None` is possibly unbound
+ warning[possibly-unbound-attribute] src/hydra_zen/structured_configs/_implementations.py:3153:21: Attribute `get` on type `DataclassOptions | None` is possibly unbound
- Found 595 diagnostics
+ Found 597 diagnostics

jinja (https://github.com/pallets/jinja)
+ warning[possibly-unresolved-reference] src/jinja2/filters.py:1740:17: Name `name` used when possibly not defined
- Found 205 diagnostics
+ Found 206 diagnostics

vision (https://github.com/pytorch/vision)
+ error[invalid-assignment] test/datasets_utils.py:1043:9: Object of type `LiteralString` is not assignable to `tuple[str, ...]`
- Found 1510 diagnostics
+ Found 1511 diagnostics

pytest (https://github.com/pytest-dev/pytest)
+ error[no-matching-overload] src/_pytest/raises.py:283:20: No overload of bound method `__init__` matches arguments
- Found 640 diagnostics
+ Found 641 diagnostics

aiohttp (https://github.com/aio-libs/aiohttp)
+ warning[possibly-unbound-attribute] aiohttp/resolver.py:102:26: Attribute `get_resolver` on type `_DNSResolverManager | None` is possibly unbound
- Found 136 diagnostics
+ Found 137 diagnostics

static-frame (https://github.com/static-frame/static-frame)
+ error[invalid-argument-type] static_frame/test/unit/test_type_clinic.py:2100:29: Argument to bound method `__init__` is incorrect: Expected `Sequence[Unknown]`, found `EllipsisType`
+ error[invalid-argument-type] static_frame/test/unit/test_type_clinic.py:2103:29: Argument to bound method `__init__` is incorrect: Expected `Sequence[Unknown]`, found `EllipsisType`
+ error[invalid-argument-type] static_frame/test/unit/test_type_clinic.py:2106:43: Argument to bound method `__init__` is incorrect: Expected `Sequence[Unknown]`, found `EllipsisType`
+ error[invalid-argument-type] static_frame/test/unit/test_type_clinic.py:2109:29: Argument to bound method `__init__` is incorrect: Expected `Sequence[Unknown]`, found `EllipsisType`
+ error[invalid-argument-type] static_frame/test/unit/test_type_clinic.py:2131:29: Argument to bound method `__init__` is incorrect: Expected `Sequence[Unknown]`, found `EllipsisType`
- Found 1833 diagnostics
+ Found 1838 diagnostics

sympy (https://github.com/sympy/sympy)
+ warning[possibly-unbound-attribute] sympy/calculus/euler.py:84:16: Attribute `args` on type `@Todo(Subscript expressions on intersections) | tuple[()]` is possibly unbound
+ warning[possibly-unbound-attribute] sympy/calculus/euler.py:92:24: Attribute `args` on type `@Todo(map_with_boundness: intersections with negative contributions) | tuple[()]` is possibly unbound
+ error[index-out-of-bounds] sympy/polys/polymatrix.py:79:42: Index 0 is out of bounds for tuple `tuple[()]` with length 0
+ error[index-out-of-bounds] sympy/polys/polymatrix.py:80:20: Index 0 is out of bounds for tuple `tuple[()]` with length 0
- error[not-iterable] sympy/simplify/radsimp.py:707:28: Object of type `Basic` is not iterable
+ error[not-iterable] sympy/simplify/radsimp.py:707:28: Object of type `set[Unknown] | Basic` may not be iterable
- error[invalid-argument-type] sympy/solvers/solveset.py:3128:25: Argument to function `next` is incorrect: Expected `SupportsNext[Unknown]`, found `tuple[Unknown, ...] | (Unknown &amp; &lt;Protocol with members &#x27;__iter__&#x27;&gt;)`
+ error[invalid-argument-type] sympy/solvers/solveset.py:3128:25: Argument to function `next` is incorrect: Expected `SupportsNext[Unknown]`, found `tuple[Unknown, ...] | (@Todo(Subscript expressions on intersections) &amp; &lt;Protocol with members &#x27;__iter__&#x27;&gt;)`
- Found 17915 diagnostics
+ Found 17919 diagnostics

</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-23 18:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-23 18:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-06-23 21:42</div>
            <div class="timeline-body"><p>Looks good! But I am seeing some property test failures here (see below). We need to either fix the underlying problems, or create issues for them and move those property tests into the &quot;flaky&quot; section (but that would be less preferable). I think some of these are not OK to move into &quot;flaky&quot; (subtyping transitivity in particular.)</p>
<p>Repro: <code>QUICKCHECK_TESTS=1000000 cargo test -p ty_python_semantic -- --ignored types::property_tests::stable</code></p>
<p>(Running with a million iterations like this is pretty slow, but is the standard we need to hit in order to not get flaky CI failures on the property tests.)</p>
<p>Failures:</p>
<pre><code>failures:

---- types::property_tests::stable::all_type_pairs_are_assignable_to_their_union stdout ----

thread &#x27;types::property_tests::stable::all_type_pairs_are_assignable_to_their_union&#x27; panicked at /Users/carlmeyer/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (VariableLengthTuple([], Intersection { pos: [None, SubclassOfAbcClass(&quot;ABC&quot;)], neg: [] }, []), Union([FixedLengthTuple([]), VariableLengthTuple([AlwaysTruthy], KnownClassInstance(Str), [])]))
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

---- types::property_tests::stable::all_fully_static_type_pairs_are_subtype_of_their_union stdout ----

thread &#x27;types::property_tests::stable::all_fully_static_type_pairs_are_subtype_of_their_union&#x27; panicked at /Users/carlmeyer/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (VariableLengthTuple([], BytesLiteral(&quot;\0&quot;), []), Union([FixedLengthTuple([]), AlwaysTruthy]))

---- types::property_tests::stable::subtype_of_is_transitive stdout ----

thread &#x27;types::property_tests::stable::subtype_of_is_transitive&#x27; panicked at /Users/carlmeyer/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (FixedLengthTuple([]), VariableLengthTuple([], BuiltinClassLiteral(&quot;bool&quot;), []), VariableLengthTuple([BuiltinInstance(&quot;type&quot;)], Intersection { pos: [], neg: [] }, []))

---- types::property_tests::stable::subtype_of_implies_not_disjoint_from stdout ----

thread &#x27;types::property_tests::stable::subtype_of_implies_not_disjoint_from&#x27; panicked at /Users/carlmeyer/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (Intersection { pos: [FixedLengthTuple([])], neg: [VariableLengthTuple([], BytesLiteral(&quot;&quot;), [SubclassOfAbcClass(&quot;ABC&quot;)])] }, VariableLengthTuple([], VariableLengthTuple([], KnownClassInstance(Int), [Never]), []))

---- types::property_tests::stable::subtype_of_is_antisymmetric stdout ----

thread &#x27;types::property_tests::stable::subtype_of_is_antisymmetric&#x27; panicked at /Users/carlmeyer/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (VariableLengthTuple([], FixedLengthTuple([]), [FixedLengthTuple([])]), VariableLengthTuple([], FixedLengthTuple([]), []))


failures:
    types::property_tests::stable::all_fully_static_type_pairs_are_subtype_of_their_union
    types::property_tests::stable::all_type_pairs_are_assignable_to_their_union
    types::property_tests::stable::subtype_of_implies_not_disjoint_from
    types::property_tests::stable::subtype_of_is_antisymmetric
    types::property_tests::stable::subtype_of_is_transitive
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-06-23 21:45</div>
            <div class="timeline-body"><p>(Based on my experience debugging these property test failures recently, I recommend starting with the <code>subtype_of_is_transitive</code> failure, because failures of subtyping transitivity can lead to all kinds of other cascading problems where union simplification depends on the order elements are added, making other property test failures sensitive to ordering in ways that make them slippery to reproduce.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-24 12:51</div>
            <div class="timeline-body"><blockquote>
<p>Running with a million iterations like this is pretty slow, but is the standard we need to hit in order to not get flaky CI failures on the property tests</p>
</blockquote>
<p>Ha! I ran it yesterday with around 500,000 runs and didn&#x27;t see any failures. I ran it this morning to reproduce your results and got a failure with the default of 100 :joy:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-24 19:13</div>
            <div class="timeline-body"><p>Okay it&#x27;s been running on a loop for around 15 minutes now and I&#x27;m not seeing any more proptest failures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-06-24 19:23</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/dcreager%2Fproptest-tuple?runnerMode=WallTime">CodSpeed WallTime Performance Report</a>
Merging #18901 will <strong>not alter performance</strong>
<p>Comparing <code>dcreager/proptest-tuple</code> (35a675f) with <code>main</code> (919af96)</p>
Summary
<p><code>âœ… 8</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-24 19:30</div>
            <div class="timeline-body"><p>Are the new primer diagnostics here expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-24 19:48</div>
            <div class="timeline-body"><blockquote>
<p>Are the new primer diagnostics here expected?</p>
</blockquote>
<p>My hope is they&#x27;re related to the test failure that I just fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-24 19:55</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Are the new primer diagnostics here expected?</p>
</blockquote>
<p>My hope is they&#x27;re related to the test failure that I just fixed</p>
</blockquote>
<p>looks like we still have a few new ones</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3475 on 2025-06-24 20:41</div>
            <div class="timeline-body"><pre><code>                // The tuple type is AlwaysTrue if its inhabitants must always have length &gt;=1
                (minimum, _) if minimum &gt; 0 =&gt; Truthiness::AlwaysTrue,
                // The tuple type is Ambiguous if its inhabitants could be of any length
                _ =&gt; Truthiness::Ambiguous
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:366 on 2025-06-24 20:43</div>
            <div class="timeline-body"><p>this is a great observation! ðŸ˜ƒ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:414 on 2025-06-24 20:43</div>
            <div class="timeline-body"><p>nit: this is quite a complicated type to repeat twice in the same file. Maybe introduce a type alias?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:404 on 2025-06-24 20:46</div>
            <div class="timeline-body"><p>I feel like I understand all the words here but don&#x27;t understand how they relate to the method, or what this method would be practically used for :-(</p>
<p>Why do we need to &quot;prenormalize&quot; tuples? What&#x27;s the meaning of the <code>skip_while</code> call in the method body?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:864 on 2025-06-24 21:04</div>
            <div class="timeline-body"><pre><code>        if let ((minimum, _), (_, Some(maximum))) | ((_, Some(maximum)), (minimum, _)) =
            (self.size_hint(), other.size_hint())
        {
            if maximum &lt; minimum {
                return true;
            }
        }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:193 on 2025-06-24 21:12</div>
            <div class="timeline-body"><p>aaaaaah, this is what the &quot;prenormalization&quot; stuff in <code>tuple.rs</code> is for? Serves me right for reading the code before the tests, I guess ðŸ˜† though I still feel like we could use more (and clearer) comments alongside the code.</p>
<p>Another really cool observation that <code>tuple[int, *tuple[int, ...]]</code> describes exactly the same set of possible runtime objects as <code>tuple[*tuple[int, ...], int]</code> ðŸ˜ƒ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:207 on 2025-06-24 21:13</div>
            <div class="timeline-body"><p>I think <code>type[object] == type</code> is not the <em>best</em> example of equivalent types here, since we eagerly normalize <code>type[object]</code> to <code>type</code>. <code>(int | str) == (str | int)</code> might be a better example, since we only lazily normalize unions when we check equivalence?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 21:14</div>
            <div class="timeline-body"><p>Very cool work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:348 on 2025-06-24 21:18</div>
            <div class="timeline-body"><p>What about testing truthiness of mixed tuples with a prefix/suffix and a variable-length portion? They should be always truthy, but I don&#x27;t see any tests for it here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:304 on 2025-06-24 21:19</div>
            <div class="timeline-body"><p>I think it would be worth a note here like this:</p>
<pre><code>The truthiness of the empty tuple is `False`.

(TODO: this is only true as long as we assume that a subclass of `tuple` doesn&#x27;t override `__bool__` or `__len__` -- we should enforce this.)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-24 21:19</div>
            <div class="timeline-body"><blockquote>
<p>looks like we still have a few new ones</p>
</blockquote>
<p>Most of them look like new true positives!</p>
<p>This one is a false positive:</p>
<pre><code>error[index-out-of-bounds] sympy/polys/polymatrix.py:79:42: Index 0 is out of bounds for tuple `tuple[()]` with length 0
</code></pre>
<p>There are a bunch of unannotated assignments to a variable in an <code>if/elif/...</code> chain. The first branch assigns it <code>()</code>, but other branches assign it a list slice, so I&#x27;m not sure why only the empty tuple is making it to this point. (There&#x27;s also a length guard which is something we don&#x27;t support yet, <a href="https://github.com/astral-sh/ty/issues/560">astral-sh/ty#560</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:414 on 2025-06-24 21:22</div>
            <div class="timeline-body"><p>Unfortunately it&#x27;s not a type, it&#x27;s an <code>impl</code> trait(s), so I don&#x27;t think I can make an alias for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3475 on 2025-06-24 21:22</div>
            <div class="timeline-body"><p>I don&#x27;t think we should use the word &quot;inhabitants&quot; in this way; we usually use that word to refer to runtime values that &quot;inhabit&quot; types. If we need to refer to the parts of a tuple, we could use &quot;elements&quot;. But I&#x27;m not sure we need to; why can&#x27;t we just say &quot;The tuple type is AlwaysFalse if it can only have a length of 0&quot;, &quot;The tuple type is AlwaysTrue if it must have a length &gt;= 1&quot;, etc.?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:207 on 2025-06-24 21:26</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-06-24 21:28</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 21:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3475 on 2025-06-24 21:31</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t think we should use the word &quot;inhabitants&quot; in this way; we usually use that word to refer to runtime values that &quot;inhabit&quot; types.</p>
</blockquote>
<p>I don&#x27;t understand this objection -- isn&#x27;t that exactly how I&#x27;m using the word? The tuple type is <code>AlwaysTrue</code> if all concrete inhabitants of that tuple type -- e.g. <code>(1, 2)</code>, <code>(1, 2, 3)</code> -- all have length &gt;=1. The length of that first tuple has 2; the length of that second tuple is 3; both tuples are runtime values that &quot;inhabit&quot; certain tuple types?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-06-24 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3475 on 2025-06-24 21:33</div>
            <div class="timeline-body"><p>Sorry, I misunderstood your wording! Yes, I think it&#x27;s accurate</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-24 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 21:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:863 on 2025-06-24 21:36</div>
            <div class="timeline-body"><p>I don&#x27;t totally understand why this doesn&#x27;t work when your previous <code>match</code> statement did (they seem like they should produce equivalent code!) -- but I think this should fix the regression caused by my previous suggestion, and it seems more obviously correct as well!</p>
<pre><code>        let (self_min, self_max) = self.size_hint();
        let (other_min, other_max) = other.size_hint();
        if self_max.is_some_and(|max|max &lt; other_min) {
            return true;
        }
        if other_max.is_some_and(|max|max &lt; self_min) {
            return true;
        }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:404 on 2025-06-24 21:44</div>
            <div class="timeline-body"><p>Added a (hopefully) better comment</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:193 on 2025-06-24 21:45</div>
            <div class="timeline-body"><p>see above â€” hopefully better comment up at the code</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-06-24 21:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 21:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:404 on 2025-06-24 21:46</div>
            <div class="timeline-body"><p>it&#x27;s <em>much</em> better, thank you!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:348 on 2025-06-24 21:49</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:304 on 2025-06-24 21:51</div>
            <div class="timeline-body"><p>There is a note at the bottom of the section mentioning this (along with a test that shows we currently allow a subclass that overrides <code>__bool__</code>).  Is that sufficient, or do you think it needs a note here too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-06-24 21:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 21:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:414 on 2025-06-24 21:53</div>
            <div class="timeline-body"><p>you could maybe just use the concrete type instead of the trait, and then you can alias it? This seems to compile fine:</p>
<pre><code>diff --git a/crates/ty_python_semantic/src/types/tuple.rs b/crates/ty_python_semantic/src/types/tuple.rs
index d19666fcd2..5d264a35f5 100644
--- a/crates/ty_python_semantic/src/types/tuple.rs
+++ b/crates/ty_python_semantic/src/types/tuple.rs
@@ -154,6 +154,8 @@ impl&lt;&#x27;db&gt; TupleType&lt;&#x27;db&gt; {
     }
 }
 
+type TupleElementIterator&lt;&#x27;a, &#x27;db&gt; = std::iter::Copied&lt;std::slice::Iter&lt;&#x27;a, Type&lt;&#x27;db&gt;&gt;&gt;;
+
 /// A fixed-length tuple spec.
 ///
 /// Tuple specs are used for more than just `tuple` instances, so they allow `Never` to appear as a
@@ -179,9 +181,7 @@ impl&lt;&#x27;db&gt; FixedLengthTupleSpec&lt;&#x27;db&gt; {
         &amp;self.0
     }
 
-    pub(crate) fn elements(
-        &amp;self,
-    ) -&gt; impl DoubleEndedIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + ExactSizeIterator + &#x27;_ {
+    pub(crate) fn elements(&amp;self) -&gt; TupleElementIterator&lt;&#x27;_, &#x27;db&gt; {
         self.0.iter().copied()
     }
 
@@ -372,9 +372,7 @@ impl&lt;&#x27;db&gt; VariableLengthTupleSpec&lt;&#x27;db&gt; {
         })
     }
 
-    fn prefix_elements(
-        &amp;self,
-    ) -&gt; impl DoubleEndedIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + ExactSizeIterator + &#x27;_ {
+    fn prefix_elements(&amp;self) -&gt; TupleElementIterator&lt;&#x27;_, &#x27;db&gt; {
         self.prefix.iter().copied()
     }
 
@@ -409,9 +407,7 @@ impl&lt;&#x27;db&gt; VariableLengthTupleSpec&lt;&#x27;db&gt; {
         )
     }
 
-    fn suffix_elements(
-        &amp;self,
-    ) -&gt; impl DoubleEndedIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + ExactSizeIterator + &#x27;_ {
+    fn suffix_elements(&amp;self) -&gt; TupleElementIterator&lt;&#x27;_, &#x27;db&gt; {
         self.suffix.iter().copied()
     }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 21:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:304 on 2025-06-24 21:54</div>
            <div class="timeline-body"><p>(I&#x27;m also planning on tackling this this week or next as part of my tuple subclasses/NamedTuples work)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:414 on 2025-06-24 21:55</div>
            <div class="timeline-body"><p>I mildly prefer the <code>impl</code> trait, since I don&#x27;t like encoding concrete types into the function signature if we don&#x27;t need to name them for some other reason.  But I can make this change if you feel strongly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-06-24 21:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-24 22:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:414 on 2025-06-24 22:04</div>
            <div class="timeline-body"><p>I guess you could do something âœ¨fancyâœ¨ like this, but it probably isn&#x27;t worth it just to make some type signatures less complicated ðŸ˜†</p>
<pre><code>diff --git a/crates/ty_python_semantic/src/types/tuple.rs b/crates/ty_python_semantic/src/types/tuple.rs
index d19666fcd2..5c1c7b09e1 100644
--- a/crates/ty_python_semantic/src/types/tuple.rs
+++ b/crates/ty_python_semantic/src/types/tuple.rs
@@ -154,6 +154,16 @@ impl&lt;&#x27;db&gt; TupleType&lt;&#x27;db&gt; {
     }
 }
 
+pub(crate) trait TupleElementIterator&lt;&#x27;db&gt;:
+    ExactSizeIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + DoubleEndedIterator
+{
+}
+
+impl&lt;&#x27;db, T&gt; TupleElementIterator&lt;&#x27;db&gt; for T where
+    T: ExactSizeIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + DoubleEndedIterator
+{
+}
+
 /// A fixed-length tuple spec.
 ///
 /// Tuple specs are used for more than just `tuple` instances, so they allow `Never` to appear as a
@@ -179,9 +189,7 @@ impl&lt;&#x27;db&gt; FixedLengthTupleSpec&lt;&#x27;db&gt; {
         &amp;self.0
     }
 
-    pub(crate) fn elements(
-        &amp;self,
-    ) -&gt; impl DoubleEndedIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + ExactSizeIterator + &#x27;_ {
+    pub(crate) fn elements(&amp;self) -&gt; impl TupleElementIterator&lt;&#x27;db&gt; + &#x27;_ {
         self.0.iter().copied()
     }
 
@@ -372,9 +380,7 @@ impl&lt;&#x27;db&gt; VariableLengthTupleSpec&lt;&#x27;db&gt; {
         })
     }
 
-    fn prefix_elements(
-        &amp;self,
-    ) -&gt; impl DoubleEndedIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + ExactSizeIterator + &#x27;_ {
+    fn prefix_elements(&amp;self) -&gt; impl TupleElementIterator&lt;&#x27;db&gt; + &#x27;_ {
         self.prefix.iter().copied()
     }
 
@@ -409,9 +415,7 @@ impl&lt;&#x27;db&gt; VariableLengthTupleSpec&lt;&#x27;db&gt; {
         )
     }
 
-    fn suffix_elements(
-        &amp;self,
-    ) -&gt; impl DoubleEndedIterator&lt;Item = Type&lt;&#x27;db&gt;&gt; + ExactSizeIterator + &#x27;_ {
+    fn suffix_elements(&amp;self) -&gt; impl TupleElementIterator&lt;&#x27;db&gt; + &#x27;_ {
         self.suffix.iter().copied()
     }
</code></pre>
<p>Feel free to leave things as they are, I don&#x27;t feel strongly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-06-24 22:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/type_compendium/tuple.md</code>:304 on 2025-06-24 22:05</div>
            <div class="timeline-body"><p>Oh that&#x27;s probably sufficient if we have it mentioned somewhere</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-06-24 22:07</div>
            <div class="timeline-body"><p>nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-24 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dcreager">@dcreager</a> on 2025-06-24 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-24 22:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:50 UTC
    </footer>
</body>
</html>
