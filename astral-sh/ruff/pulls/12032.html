<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Add `exception-message-without-placeholder` rule (#11979) - astral-sh/ruff #12032</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Add <code>exception-message-without-placeholder</code> rule (#11979)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12032">#12032</a>
        opened by <a href="https://github.com/denwong47">@denwong47</a>
        on 2024-06-25 19:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/denwong47">@denwong47</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Addresses #11979 to add a <code>RUF</code> rule to check for static exception messages, which does not contain any runtime contextual information.</p>
<p>For example:</p>
<pre><code class="language-python">from pathlib import Path
settings_file = Path(__file__) / &quot;settings.json&quot;
if not settings_file.exists():
   raise FileNotFoundError(&quot;File not found&quot;)
</code></pre>
<p>This exception instance will give out the static error message regardless of where it is looking for <code>settings_file</code>. The user could not have known if he misnamed the JSON, or he placed the script in the wrong folder. This could easily be resolved by formatting the message with <code>settings_file</code>:</p>
<pre><code class="language-python">if not settings_file.exists():
   raise FileNotFoundError(f&quot;Settings not found at '{settings_file.resolve().as_posix()}'&quot;)
</code></pre>
<p>This currently covers all built-in exceptions classes except:</p>
<ul>
<li><code>NotImplementedError</code> - this, by definition, is not an error related to any runtime states.</li>
<li><code>UnicodeDecodeError</code>, <code>UnicodeEncodeError</code> and <code>UnicodeTranslateError</code> - these by its <code>__init__</code> already mandates contextual information.</li>
</ul>
<p>The user will be prompted to either</p>
<ul>
<li>Provide a variable in the message, or</li>
<li>Create a custom Exception class for the specific error condition.</li>
</ul>
<h2>Test Plan</h2>
<p><code>cargo test</code>.</p>
<h2>What is static or not static?</h2>
<p>Some examples of static messages:</p>
<pre><code class="language-python">MY_STATIC_VARIABLE = &quot;This is a static message&quot;
my_other_static_variable = MY_STATIC_VARIABLE
raise ValueError(&quot;This is a static message&quot;)
raise ValueError(f&quot;This is a {'static':-^11} message even with an f-string&quot;)
raise ValueError(&quot;This is a {kind} message&quot;.format(kind=&quot;static&quot;))
raise ValueError(my_other_static_variable)
</code></pre>
<p>Some examples of dynamic messages:</p>
<pre><code class="language-python">MY_STATIC_TEMPLATE = &quot;Your error is because of {reasons}&quot;
raise ValueError(MY_STATIC_TEMPLATE.format(reasons=&quot;reasons&quot;))

reasons = &quot;reasons&quot;
raise ValueError(f&quot;Your error is because of {reasons}&quot;)

raise ValueError(&quot;Your error is because of {reasons}&quot;.format(reasons=reasons))

raise ValueError(&quot;This error&quot; if some_condition() else &quot;That error&quot;)
</code></pre>
<p>The above examples differs from the static messages in that there could be
conditions that change the message at runtime. For example:</p>
<pre><code class="language-python">MY_STATIC_TEMPLATE = &quot;Your error is because of {reasons}&quot;

if some_condition():
   raise ValueError(MY_STATIC_TEMPLATE.format(reasons=&quot;reason 1&quot;))
else:
   raise ValueError(MY_STATIC_TEMPLATE.format(reasons=&quot;reason 2&quot;))
</code></pre>
<p>In this case, the message being formatted is a static value, but subject to
change at runtime, hence it is considered a dynamic message.</p>
<h2>Interaction with other rules</h2>
<p>Notable overlapping or similar rules:</p>
<ul>
<li><code>EM101, EM102, EM103</code> - these <code>flake8</code> rules will look for string literals as Exception messages, and encourage the user to store them in a variable, to reduce duplication in the raised error message. This rule will consider both its condition and its fix to be violations.</li>
<li><code>TRY003</code> - this checks for exception messages that is a string literal containing any whitespaces, and encourage the user to create a custom exception class instead. Arguably this is a stricter rule than the proposed rule here, with a overlapping goal of making exceptions more specific.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2024-06-28 04:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2024-06-28 04:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @dhruvmanila on 2024-06-28 04:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:05:01 UTC
    </footer>
</body>
</html>
