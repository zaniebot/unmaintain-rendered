```yaml
number: 16645
title: "[red-knot] Auto generate statement nodes"
type: pull_request
state: merged
author: Glyphack
labels:
  - internal
  - ty
assignees: []
merged: true
base: main
head: ast-autogen-stmt
created_at: 2025-03-11T19:40:42Z
updated_at: 2025-03-13T15:16:54Z
url: https://github.com/astral-sh/ruff/pull/16645
synced_at: 2026-01-10T19:49:02Z
```

# [red-knot] Auto generate statement nodes

---

_Pull request opened by @Glyphack on 2025-03-11 19:40_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

<!-- What's the purpose of the change? What does it do, and why? -->

Part of #15655 

Replaced statement nodes with autogenerated ones. Reused the stuff we introduced in #16285. Nothing except for copying the nodes to new format.

## Test Plan

Tests run without any changes. Also moved the test that checks size of AST nodes to `generated.rs` since all of the structs that it tests are now there.
<!-- How was it tested? -->


---

_Label `internal` added by @MichaReiser on 2025-03-12 07:25_

---

_Comment by @github-actions[bot] on 2025-03-12 08:00_

<!-- generated-comment ecosystem -->
## `ruff-ecosystem` results
### Linter (stable)
✅ ecosystem check detected no linter changes.

### Linter (preview)
✅ ecosystem check detected no linter changes.

### Formatter (stable)
✅ ecosystem check detected no format changes.

### Formatter (preview)
✅ ecosystem check detected no format changes.




---

_@Glyphack reviewed on 2025-03-12 21:45_

---

_Review comment by @Glyphack on `crates/ruff_python_ast/ast.toml`:78 on 2025-03-12 21:45_

Interesting, this is boxed here to reduce the size of statement. But it's not the same in `StmtTypeAlias` was is tested there and the benefit was small?

---

_Marked ready for review by @Glyphack on 2025-03-12 21:52_

---

_Review requested from @dcreager by @MichaReiser on 2025-03-13 08:51_

---

_Review comment by @MichaReiser on `crates/ruff_python_ast/ast.toml`:78 on 2025-03-13 08:53_

You can try, but I suspect that `StmtFunctionDef` is simply the largest statement node and reducing the size of any other node doesn't help to reduce the size of `Stmt`.

---

_Review comment by @MichaReiser on `crates/ruff_python_ast/generate.py`:693 on 2025-03-13 08:54_

I think I prefer to keep this code outside `generate.rs`. It doesn't benefit from the codegen and being able to change code directly in `rs` file has better ergonomics (I don't have to go searching where the code is coming from and I've an IDE that can help me figure out the code)

---

_@MichaReiser approved on 2025-03-13 08:55_

Nice

---

_Review comment by @dhruvmanila on `crates/ruff_python_ast/generate.py`:693 on 2025-03-13 12:13_

+1, it's also easier to just hover over the type and find the size there.

While you're at it, can you also remove the size assertions for `Pattern` and `ExprFString` specifically for Rustc < 1.76 as our MSRV is 1.83 now.

---

_@dhruvmanila reviewed on 2025-03-13 12:13_

---

_@Glyphack reviewed on 2025-03-13 12:32_

---

_Review comment by @Glyphack on `crates/ruff_python_ast/ast.toml`:78 on 2025-03-13 12:32_

Oh right, I forgot about the enum size thing. Thanks.

---

_Review comment by @dcreager on `crates/ruff_python_ast/generate.py`:693 on 2025-03-13 13:35_

You've already addressed this, but just calling out that I agree with @MichaReiser on this — the generate script should only produce code that actually depends on the AST definitions in `ast.toml`. Anything that is not parameterized like that should go in a hand-edited `.rs` file like you have now.

---

_@dcreager approved on 2025-03-13 13:36_

---

_Renamed from "Auto generate statement nodes" to "[red-knot] Auto generate statement nodes" by @dcreager on 2025-03-13 13:36_

---

_Label `red-knot` added by @dcreager on 2025-03-13 13:36_

---

_Merged by @MichaReiser on 2025-03-13 14:43_

---

_Closed by @MichaReiser on 2025-03-13 14:43_

---

_Branch deleted on 2025-03-13 15:16_

---
