```yaml
number: 9897
title: Use Rust 1.76
type: pull_request
state: merged
author: MichaReiser
labels:
  - internal
assignees: []
merged: true
base: main
head: rust-1.76
created_at: 2024-02-08T17:40:28Z
updated_at: 2024-02-08T18:33:12Z
url: https://github.com/astral-sh/ruff/pull/9897
synced_at: 2026-01-10T22:57:09Z
```

# Use Rust 1.76

---

_Pull request opened by @MichaReiser on 2024-02-08 17:40_

## Summary

This PR upgrades our default toolchain to 1.76. It does not change the minimal required rust version.

This new version of Rust is now able to better optimise our enums which shrinked the size of some AST nodes. 

## Test Plan

`cargo test` and `cargo +1.75 test`


---

_Label `internal` added by @MichaReiser on 2024-02-08 17:41_

---

_@MichaReiser reviewed on 2024-02-08 17:41_

---

_Review comment by @MichaReiser on `crates/ruff_python_ast/src/nodes.rs`:3896 on 2024-02-08 17:41_

The size of Expr and Pattern decreased.

---

_Comment by @codspeed-hq[bot] on 2024-02-08 17:55_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/rust-1.76)

### Merging #9897 will **improve performances by 8.17%**

<sub>Comparing <code>rust-1.76</code> (4ca548d) with <code>main</code> (6fffde7)</sub>



### Summary

`⚡ 5` improvements
`✅ 25` untouched benchmarks




### Benchmarks breakdown

|     | Benchmark | `main` | `rust-1.76` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ⚡ | `parser[numpy/globals.py]` | 1,053.4 µs | 981.9 µs | +7.29% |
| ⚡ | `parser[large/dataset.py]` | 69.1 ms | 63.9 ms | +8.17% |
| ⚡ | `parser[pydantic/types.py]` | 26.4 ms | 24.5 ms | +7.66% |
| ⚡ | `parser[unicode/pypinyin.py]` | 4.3 ms | 4 ms | +7.56% |
| ⚡ | `parser[numpy/ctypeslib.py]` | 11.6 ms | 10.8 ms | +7.58% |


---

_Comment by @charliermarsh on 2024-02-08 17:56_

Amazing work Micha.

---

_@charliermarsh approved on 2024-02-08 17:57_

---

_Comment by @github-actions[bot] on 2024-02-08 18:06_

<!-- generated-comment ecosystem -->
## `ruff-ecosystem` results
### Linter (stable)
✅ ecosystem check detected no linter changes.

### Linter (preview)
✅ ecosystem check detected no linter changes.

### Formatter (stable)
✅ ecosystem check detected no format changes.

### Formatter (preview)
✅ ecosystem check detected no format changes.




---

_Merged by @MichaReiser on 2024-02-08 18:20_

---

_Closed by @MichaReiser on 2024-02-08 18:20_

---

_Branch deleted on 2024-02-08 18:20_

---
