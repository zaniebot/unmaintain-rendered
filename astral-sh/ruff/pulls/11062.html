<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server`: Ruff configuration from client settings overrides project configuration - astral-sh/ruff #11062</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff server</code>: Ruff configuration from client settings overrides project configuration</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11062">#11062</a>
        opened by <a href="https://github.com/snowsignal">@snowsignal</a>
        on 2024-04-21 01:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a follow-up to https://github.com/astral-sh/ruff/pull/10984 that implements configuration resolution for editor configuration. By 'editor configuration', I'm referring to the client settings that correspond to Ruff configuration/options, like <code>preview</code>, <code>select</code>, and so on. These will be combined with 'project configuration' (configuration taken from project files such as <code>pyproject.toml</code>) to generate the final linter and formatter settings used by <code>RuffSettings</code>. Editor configuration takes priority over project configuration.</p>
<p>In a follow-up pull request, I'll implement a new client setting that allows project configuration to override editor configuration, as per <a href="https://github.com/astral-sh/ruff-vscode/issues/425">this issue</a>.</p>
<h2>Review guide</h2>
<p>The first commit, e38966d8843becc7234fa7d46009c16af4ba41e9, is just doing re-arrangement so that we can pass the right things to <code>RuffSettings::resolve</code>. The actual resolution logic is in the second commit, 0eec9ee75c10e5ec423bd9f5ce1764f4d7a5ad86. It might help to look at these comments individually since the diff is rather messy.</p>
<h2>Test Plan</h2>
<p>For the settings to show up in VS Code, you'll need to checkout this branch: https://github.com/astral-sh/ruff-vscode/pull/456.</p>
<p>To test that the resolution for a specific setting works as expected, run through the following scenarios, setting it in project and editor configuration as needed:</p>
<p>| Set in project configuration? | Set in editor configuration?                     | Expected Outcome                                                                         |
|-------------------------------|--------------------------------------------------|------------------------------------------------------------------------------------------|
| No                            | No                                               | The editor should behave as if the setting was set to its default value.                  |
| Yes                           | No                                               | The editor should behave as if the setting was set to the value in project configuration. |
| No                            | Yes                                              | The editor should behave as if the setting was set to the value in editor configuration.  |
| Yes                           | Yes (but distinctive from project configuration) | The editor should behave as if the setting was set to the value in editor configuration.  |</p>
<p>An exception to this is <code>extendSelect</code>, which does not have an analog in TOML configuration. Instead, you should verify that <code>extendSelect</code> amends the <code>select</code> setting. If <code>select</code> is set in both editor and project configuration, <code>extendSelect</code> will only append to the <code>select</code> value in editor configuration, so make sure to un-set it there if you're testing <code>extendSelect</code> with <code>select</code> in project configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @snowsignal on 2024-04-21 01:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @snowsignal on 2024-04-21 01:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-21 01:40</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @snowsignal on 2024-04-21 23:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-04-22 01:32</div>
            <div class="timeline-body"><p>I'm working on adding some snapshot tests, but the PR should be ready for review regardless.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_server/src/session/workspace/ruff_settings.rs</code>:74 on 2024-04-22 07:59</div>
            <div class="timeline-body"><p>Have you considered implementing <code>ConfigurationTransformer</code> for <code>ResolvedEditorSettings</code>. It's our current mechanism for transforming configurations and is used by the CLI to merge the CLI arguments with the project configuration. See <code>ConfigArguments</code>. You could then continue using <code>resolve_root_settings</code>.</p>
<p>It would also remove the need for the empty <code>LSPConfigTransformer</code> (or implement the logic on <code>LSPConfigTransformer</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-22 08:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-04-22 15:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_server/src/session/workspace/ruff_settings.rs</code>:74 on 2024-04-22 15:15</div>
            <div class="timeline-body"><p>Oh, good catch!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @snowsignal on 2024-04-22 20:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-23 07:11</div>
            <div class="timeline-body"><p>Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-04-23 08:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-04-23 18:19</div>
            <div class="timeline-body"><p>I'll implement snapshot tests <a href="https://github.com/astral-sh/ruff/issues/11112">as a follow-up</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @snowsignal on 2024-04-23 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @snowsignal on 2024-04-23 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-23 18:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:03:54 UTC
    </footer>
</body>
</html>
