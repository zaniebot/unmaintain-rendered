<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for sorting diagnostics without a range - astral-sh/ruff #20251</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for sorting diagnostics without a range</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20251">#20251</a>
        opened by <a href="https://github.com/amyreese">@amyreese</a>
        on 2025-09-04 19:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a></div>
            <div class="timeline-body"><p>Stack from <a href="https://github.com/ezyang/ghstack">ghstack</a> (oldest at bottom):</p>
<ul>
<li>#20252</li>
<li><strong>-&gt;</strong> #20251</li>
</ul>
<hr>
<ul>
<li>Update ruff ordering compare to work with optional ranges (treating
them as starting from zero)</li>
<li>Add a simple from impl to convert std::Path to Span with empty range</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/amyreese">@amyreese</a> on 2025-09-04 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/amyreese">@amyreese</a> on 2025-09-04 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/amyreese">@amyreese</a> on 2025-09-04 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/amyreese">@amyreese</a> on 2025-09-04 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/dcreager">@dcreager</a> removed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/sharkdp">@sharkdp</a> removed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1224 on 2025-09-04 20:48</div>
            <div class="timeline-body"><p>Is this used in this PR, and I&#x27;m overlooking it? If not, I&#x27;d kind of rather group this with the code change that uses it since we&#x27;re going to land this commit separately.</p>
<p>I&#x27;m also not sure this really belongs in <code>ruff_db</code>, which is generally agnostic to the <code>UnifiedFile</code> variant, while this is specific to a Ruff <code>SourceFile</code>. We can probably just inline this code, like we do for IO errors:</p>
<p>https://github.com/astral-sh/ruff/blob/df142def7a2796c9b48e1fa2314d27c4f3a94076/crates/ruff/src/diagnostics.rs#L67-L70</p>
<p>I think we can reuse the <code>Path::to_string_lossy</code> helper and avoid the <code>to_owned</code> call too.</p>
<p>But this looks like the right approach, we don&#x27;t have access to any other <code>SourceFile</code> here üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:509 on 2025-09-04 21:00</div>
            <div class="timeline-body"><p>I think I&#x27;d probably just inline <code>self.range().unwrap_or_default().start()</code> (and <code>other...</code>) and not factor out an internal helper function, but either way is fine.</p>
<p>We should also update the docstring now that this doesn&#x27;t panic if the span has no range.</p>
<p>More broadly, I&#x27;m wondering how helpful this change will be on its own. I checked the references for <code>Diagnostic::expect_range</code>, and there are quite a few more than I expected (sorry!). Do you think we should try to remove all of those at once? Otherwise it seems like we could potentially run into problems  beyond this sort call.</p>
<p>Most of the uses are in tests, so it&#x27;s safe to slap an <code>unwrap()</code> on those, but a few of them will need more consideration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-04 21:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/amyreese">@amyreese</a> on 2025-09-05 00:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-25 02:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:20 UTC
    </footer>
</body>
</html>
