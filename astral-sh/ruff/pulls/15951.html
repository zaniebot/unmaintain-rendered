<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-builtins`] Make strict module name comparison optional (`A005`) - astral-sh/ruff #15951</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-builtins</code>] Make strict module name comparison optional (<code>A005</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15951">#15951</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-02-04 22:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-04 22:22</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds the configuration option <code>lint.flake8-builtins.builtins-strict-checking</code>, which is used in A005 to determine whether the fully-qualified module name (relative to the project root or source directories) should be checked instead of just the final component as is currently the case.</p>
<p>As discussed in https://github.com/astral-sh/ruff/issues/15399#issuecomment-2587017147, the default value of the new option is <code>false</code> on preview, so modules like <code>utils.logging</code> from the initial report are no longer flagged by default. For non-preview the default is still strict checking.</p>
<h2>Test Plan</h2>
<p>New A005 test module with the structure reported in #15399.</p>
<p>Fixes #15399</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-02-04 22:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:101 on 2025-02-04 22:28</div>
            <div class="timeline-body"><p>Before the last commit, I was doing more processing on the input <code>path</code> to build a fully-qualified module name below the package root and <code>src</code> directories to pass to <code>is_known_standard_library</code>, but then I noticed this and simplified the check to this parent code.</p>
<p>This was inspired by some of the checks in <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/flake8_no_pep420/rules/implicit_namespace_package.rs#L77"><code>implicit_namespace_package.rs</code></a>, which also checks for shebang lines and PEP 723 scripts. Should we do that there too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-04 22:42</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -105 violations, +0 -0 fixes in 6 projects; 49 projects unchanged)</p>
<details><summary><a href="https://github.com/Snowflake-Labs/snowcli">Snowflake-Labs/snowcli</a> (+0 -7 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/_plugins/cortex/types.py#L1'>src/snowflake/cli/_plugins/cortex/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/_plugins/notebook/types.py#L1'>src/snowflake/cli/_plugins/notebook/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/api/console/abc.py#L1'>src/snowflake/cli/api/console/abc.py:1:1:</a> A005 Module `abc` shadows a Python standard-library module
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/api/console/enum.py#L1'>src/snowflake/cli/api/console/enum.py:1:1:</a> A005 Module `enum` shadows a Python standard-library module
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/api/errno.py#L1'>src/snowflake/cli/api/errno.py:1:1:</a> A005 Module `errno` shadows a Python standard-library module
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/api/output/types.py#L1'>src/snowflake/cli/api/output/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/e23b0a7f31fb88aba08424135af8fdf8185b9f93/src/snowflake/cli/api/utils/types.py#L1'>src/snowflake/cli/api/utils/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -49 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/api_connexion/types.py#L1'>airflow/api_connexion/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/api_fastapi/common/types.py#L1'>airflow/api_fastapi/common/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/api_fastapi/execution_api/datamodels/token.py#L1'>airflow/api_fastapi/execution_api/datamodels/token.py:1:1:</a> A005 Module `token` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/api_fastapi/logging/__init__.py#L1'>airflow/api_fastapi/logging/__init__.py:1:1:</a> A005 Module `logging` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/io/__init__.py#L1'>airflow/io/__init__.py:1:1:</a> A005 Module `io` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/io/utils/stat.py#L1'>airflow/io/utils/stat.py:1:1:</a> A005 Module `stat` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/models/operator.py#L1'>airflow/models/operator.py:1:1:</a> A005 Module `operator` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/operators/email.py#L1'>airflow/operators/email.py:1:1:</a> A005 Module `email` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/secrets/__init__.py#L1'>airflow/secrets/__init__.py:1:1:</a> A005 Module `secrets` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/serialization/serializers/datetime.py#L1'>airflow/serialization/serializers/datetime.py:1:1:</a> A005 Module `datetime` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/utils/email.py#L1'>airflow/utils/email.py:1:1:</a> A005 Module `email` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/utils/json.py#L1'>airflow/utils/json.py:1:1:</a> A005 Module `json` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/utils/platform.py#L1'>airflow/utils/platform.py:1:1:</a> A005 Module `platform` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/utils/types.py#L1'>airflow/utils/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/airflow/utils/warnings.py#L1'>airflow/utils/warnings.py:1:1:</a> A005 Module `warnings` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/cncf/kubernetes/src/airflow/providers/cncf/kubernetes/operators/resource.py#L1'>providers/cncf/kubernetes/src/airflow/providers/cncf/kubernetes/operators/resource.py:1:1:</a> A005 Module `resource` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/common/io/src/airflow/providers/common/io/__init__.py#L1'>providers/common/io/src/airflow/providers/common/io/__init__.py:1:1:</a> A005 Module `io` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/common/io/tests/provider_tests/common/io/__init__.py#L1'>providers/common/io/tests/provider_tests/common/io/__init__.py:1:1:</a> A005 Module `io` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/common/io/tests/system/common/io/__init__.py#L1'>providers/common/io/tests/system/common/io/__init__.py:1:1:</a> A005 Module `io` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/fab/src/airflow/providers/fab/www/api_connexion/types.py#L1'>providers/fab/src/airflow/providers/fab/www/api_connexion/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/google/src/airflow/providers/google/cloud/secrets/__init__.py#L1'>providers/google/src/airflow/providers/google/cloud/secrets/__init__.py:1:1:</a> A005 Module `secrets` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/google/src/airflow/providers/google/suite/hooks/calendar.py#L1'>providers/google/src/airflow/providers/google/suite/hooks/calendar.py:1:1:</a> A005 Module `calendar` shadows a Python standard-library module
- <a href='https://github.com/apache/airflow/blob/c1d85bd689e4e17d5e64aeca798cf3258737164d/providers/google/tests/provider_tests/google/cloud/secrets/__init__.py#L1'>providers/google/tests/provider_tests/google/cloud/secrets/__init__.py:1:1:</a> A005 Module `secrets` shadows a Python standard-library module
... 26 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+0 -15 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/advanced_data_type/types.py#L1'>superset/advanced_data_type/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/commands/dashboard/copy.py#L1'>superset/commands/dashboard/copy.py:1:1:</a> A005 Module `copy` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/dashboards/permalink/types.py#L1'>superset/dashboards/permalink/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/databases/types.py#L1'>superset/databases/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/distributed_lock/types.py#L1'>superset/distributed_lock/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/explore/permalink/types.py#L1'>superset/explore/permalink/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/key_value/types.py#L1'>superset/key_value/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/reports/notifications/email.py#L1'>superset/reports/notifications/email.py:1:1:</a> A005 Module `email` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/reports/types.py#L1'>superset/reports/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/apache/superset/blob/06f8f8e6082371df603571aa3fde8c763ed4f77e/superset/sqllab/permalink/types.py#L1'>superset/sqllab/permalink/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
... 5 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+0 -17 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/interaction/widgets/fileinput.py#L1'>examples/interaction/widgets/fileinput.py:1:1:</a> A005 Module `fileinput` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/code.py#L1'>src/bokeh/application/handlers/code.py:1:1:</a> A005 Module `code` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/command/subcommands/json.py#L1'>src/bokeh/command/subcommands/json.py:1:1:</a> A005 Module `json` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/property/datetime.py#L1'>src/bokeh/core/property/datetime.py:1:1:</a> A005 Module `datetime` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/property/enum.py#L1'>src/bokeh/core/property/enum.py:1:1:</a> A005 Module `enum` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/property/json.py#L1'>src/bokeh/core/property/json.py:1:1:</a> A005 Module `json` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/property/string.py#L1'>src/bokeh/core/property/string.py:1:1:</a> A005 Module `string` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/property/struct.py#L1'>src/bokeh/core/property/struct.py:1:1:</a> A005 Module `struct` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/types.py#L1'>src/bokeh/core/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/validation/warnings.py#L1'>src/bokeh/core/validation/warnings.py:1:1:</a> A005 Module `warnings` shadows a Python standard-library module
... 7 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/latchbio/latch">latchbio/latch</a> (+0 -10 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/functions/secrets.py#L1'>src/latch/functions/secrets.py:1:1:</a> A005 Module `secrets` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/idl/core/types.py#L1'>src/latch/idl/core/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/registry/types.py#L1'>src/latch/registry/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/registry/upstream_types/types.py#L1'>src/latch/registry/upstream_types/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/types/__init__.py#L1'>src/latch/types/__init__.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/types/glob.py#L1'>src/latch/types/glob.py:1:1:</a> A005 Module `glob` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch/types/json.py#L1'>src/latch/types/json.py:1:1:</a> A005 Module `json` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch_cli/exceptions/traceback.py#L1'>src/latch_cli/exceptions/traceback.py:1:1:</a> A005 Module `traceback` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch_cli/services/cp/glob.py#L1'>src/latch_cli/services/cp/glob.py:1:1:</a> A005 Module `glob` shadows a Python standard-library module
- <a href='https://github.com/latchbio/latch/blob/dd8f9fbb1a02b18a5d14dfaebd6b250dc43de553/src/latch_cli/snakemake/config/parser.py#L1'>src/latch_cli/snakemake/config/parser.py:1:1:</a> A005 Module `parser` shadows a Python standard-library module
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+0 -7 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/actions/typing.py#L1'>zerver/actions/typing.py:1:1:</a> A005 Module `typing` shadows a Python standard-library module
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/lib/profile.py#L1'>zerver/lib/profile.py:1:1:</a> A005 Module `profile` shadows a Python standard-library module
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/lib/queue.py#L1'>zerver/lib/queue.py:1:1:</a> A005 Module `queue` shadows a Python standard-library module
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/lib/types.py#L1'>zerver/lib/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/lib/url_preview/types.py#L1'>zerver/lib/url_preview/types.py:1:1:</a> A005 Module `types` shadows a Python standard-library module
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/views/typing.py#L1'>zerver/views/typing.py:1:1:</a> A005 Module `typing` shadows a Python standard-library module
- <a href='https://github.com/zulip/zulip/blob/d28f7d86223bab4f11629637d4237381943f6fc1/zerver/webhooks/json/__init__.py#L1'>zerver/webhooks/json/__init__.py:1:1:</a> A005 Module `json` shadows a Python standard-library module
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| A005 | 105 | 0 | 105 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-02-04 22:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @ntBre on 2025-02-04 22:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-05 07:26</div>
            <div class="timeline-body"><p>Have you considered implementing the approach mentioned in https://github.com/astral-sh/ruff/issues/15399#issuecomment-2612005957 and if so, why did you decide against it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-05 13:27</div>
            <div class="timeline-body"><p>I could certainly be missing something here, but from my reading of the comment, this implementation (with the bugfix I just added) should cover that case. Possibly this should be added as a test, but I just added this directrory structure locally:</p>
<pre><code class="language-text">.
├── abc
│   └── __init__.py
├── collections
│   ├── __init__.py
│   ├── abc
│   │   └── __init__.py
│   └── foobar
│       └── __init__.py
├── foobar
│   ├── abc
│   │   └── __init__.py
│   └── collections
│       ├── __init__.py
│       ├── abc
│       │   └── __init__.py
│       └── foobar
│           └── __init__.py
├── ruff.toml
└── urlparse
    └── __init__.py
</code></pre>
<p>And ran my debug build of ruff:</p>
<pre><code class="language-text">/home/brent/astral/ruff/target/debug/ruff check --no-cache --select A005  .
abc/__init__.py:1:1: A005 Module `abc` shadows a Python standard-library module
collections/__init__.py:1:1: A005 Module `collections` shadows a Python standard-library module
collections/abc/__init__.py:1:1: A005 Module `collections` shadows a Python standard-library module
collections/foobar/__init__.py:1:1: A005 Module `collections` shadows a Python standard-library module
Found 4 errors.
</code></pre>
<p>If I enable strict checking, I get 4 additional errors for the <code>foobar</code> subpackages, which is the behavior I understood from the comment.</p>
<p>Again, I could be missing something, but we don't really have to treat the fully-qualified path or worry about parent-child relationships mentioned in the comment directly because we check each of the files separately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/checkers/filesystem.rs</code>:55 on 2025-02-05 13:52</div>
            <div class="timeline-body"><p>Nit: Should we just pass the entire <code>Settings</code> struct instead of picking individual fields?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:1152 on 2025-02-05 13:55</div>
            <div class="timeline-body"><p>I think we have to keep the existing default and wait for the next minor to change it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:80 on 2025-02-05 14:04</div>
            <div class="timeline-body"><p>Nit: the only difference between the two branches seems to be whether we call the operations on <code>package.path</code> or <code>path</code>. Could we change the <code>if</code> to either return <code>package.path</code> or <code>path</code> and then extract the <code>module_name</code> and <code>parent</code> outside the <code>if</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:101 on 2025-02-05 14:06</div>
            <div class="timeline-body"><p>I don't think we should exclude PEP 723 scripts or scripts with shebang lines that are at the top level and have the same name as a standard library module because it doesn't change that they shadow the built-in module. Or what's your reasoning for wanting to ignore them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-05 14:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-02-05 14:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_workspace/src/options.rs</code>:1152 on 2025-02-05 14:10</div>
            <div class="timeline-body"><p>That makes sense, I'll set the default back to <code>true</code>. Is there a special label I need to apply here or otherwise track that for the next minor release?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-02-05 14:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:80 on 2025-02-05 14:12</div>
            <div class="timeline-body"><p>There's also <code>file_name</code> vs <code>file_stem</code> to remove the <code>.py</code> from the non-module file, but this did look a bit better before I made it a tuple. I'll think about an improvement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-02-05 14:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:80 on 2025-02-05 14:13</div>
            <div class="timeline-body"><p>Oh, I missed that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-02-05 14:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:101 on 2025-02-05 14:14</div>
            <div class="timeline-body"><p>I thought it was related to this comment https://github.com/astral-sh/ruff/issues/15399#issuecomment-2582929030, but my main reasoning was just that it was handled specially by the other rule. I think I agree with you that it makes sense <em>not</em> to do it though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:1152 on 2025-02-05 14:14</div>
            <div class="timeline-body"><p>We can change the default for preview. Although I'm not sure if we did that before but it would give us some preview testing.</p>
<p>The easiest for tracking is to create an issue and tag it with the next milestone. Or you can create a follow up PR, mark it as breaking, and add it to the milestone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-02-05 14:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-05 15:32</div>
            <div class="timeline-body"><p>I think my example from earlier was actually misleading because I didn't have a <code>foobar/__init__.py</code> file. With that file, the existing behavior in ruff is already as described in the issue comment. We get the four errors above and don't error on the <code>foobar/</code> subtree. This is because the <code>package.path()</code> always seems to return the root package, rather than the leaf package. For example, when <code>path</code> is <code>foobar/abc/__init__.py</code>, the <code>package.path()</code> is still <code>foobar</code>.</p>
<p>Related to your <code>is_module_path</code> suggestion, I think if we want the strictness option to have any effect, we should actually check <code>path.file_name()</code> in both cases and not even use the <code>package</code> argument at all.</p>
<p>I noticed this when testing a default strict value and not being able to reproduce the eight-error case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-05 19:45</div>
            <div class="timeline-body"><p>Sorry @MichaReiser, I now believe that you were right all along. I ended up writing a few integration tests with the exact module structure above (including <code>foobar/__init__.py</code>), and trying to pass those pushed me back toward the path-component implementation.</p>
<p>I also changed the default for <code>builtins_strict_checking</code> to <code>true</code>, so I expected the stable ecosystem check to show no changes and the preview check to match the previous report (-88), but apparently I've made the default even more strict than it was before. Is that okay, or should I try to get rid of the new violations? It looks like these are true positives, if our intention is to flag any module with a name from the standard library.</p>
<p>Once the non-strict behavior becomes default, there will still be a substantial net decrease in violations too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-02-05 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-02-06 08:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:79 on 2025-02-06 08:26</div>
            <div class="timeline-body"><p>Shouldn't we break after we found the first path or we might end up stripping the same path more than once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:74 on 2025-02-06 08:28</div>
            <div class="timeline-body"><p>This is unfortunate as it means we sort <code>src</code> for every file. I think we can avoid sorting by instead have a <code>prefix: Option&lt;&amp;Path&gt;</code> variable and we only update it if the current checked <code>src</code> prefix is longer than <code>prefix</code>. This gives us the same behavior without sorting (sorting always allocates a vec!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:72 on 2025-02-06 08:28</div>
            <div class="timeline-body"><p>Same as above. It's now possible that we strip the path more than once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_builtins/rules/stdlib_module_shadowing.rs</code>:91 on 2025-02-06 08:29</div>
            <div class="timeline-body"><p>We could use a <code>Cow</code> here to avoid allocating (we try to avoid allocations in the &quot;check&quot; path. Allocations in the fix path are mostly fine)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-06 09:34</div>
            <div class="timeline-body"><blockquote>
<p>but apparently I've made the default even more strict than it was before. Is that okay, or should I try to get rid of the new violations?</p>
</blockquote>
<p>Can you explain in what ways you made the check more strict than it used to be before? I ask because it depends if the changed behavior classifies as a bug fix (fine to do in a patch release) or a behavior change (it depends but generally no)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-02-06 09:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-06 13:23</div>
            <div class="timeline-body"><blockquote>
<p>Can you explain in what ways you made the check more strict than it used to be before? I ask because it depends if the changed behavior classifies as a bug fix (fine to do in a patch release) or a behavior change (it depends but generally no)</p>
</blockquote>
<p>For modules, the original code used <code>package.path()</code> to get the <code>module_name</code>, which appears to give the top-level module name and I think could be considered a bug. This leads to the following output on <code>main</code>:</p>
<pre><code class="language-text">path                                   module_name
----                                   ------------
foobar/collections/abc/__init__.py     foobar
foobar/abc/__init__.py                 foobar
collections/__init__.py                collections
abc/__init__.py                        abc
urlparse/__init__.py                   urlparse
collections/abc/__init__.py            collections
foobar/collections/__init__.py         foobar
foobar/collections/foobar/__init__.py  foobar
foobar/__init__.py                     foobar
collections/foobar/__init__.py         collections
foobar/logging.py                      logging      # new, not in tree above
</code></pre>
<p>The <code>package.path()</code> behavior is different from the treatment of <code>.py</code> files, where <code>main</code> uses the basename of the file. Instead of checking one or the other, we now consider each component of the module path separately in strict mode, so all of the <code>foobar/</code> subtree (<code>abc</code>, <code>collections</code>, <code>collections/foobar</code>) is marked with errors.</p>
<p>I think we're being more faithful to the <code>## What it does</code> section in the docs now:</p>
<blockquote>
<p>Checks for modules that use the same names as Python standard-library modules.</p>
</blockquote>
<p>But I'm definitely wary of introducing <em>more</em> diagnostics, especially when the issue I set out to fix was for too many diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-06 18:19</div>
            <div class="timeline-body"><p>Thanks again for the feedback here and on Discord! I think I've handled all of the review comments here and also revised the implementation to reflect the upstream behavior better. To help visualize the behavior, here's a table of the strict vs non-strict behavior, operating on the tree from above (again with <code>foobar/logging.py</code> added):</p>
<p>| Path                                    | Strict | Non-strict | Main | Flake8 |
|-----------------------------------------|--------|------------|------|--------|
| <code>abc/__init__.py</code>                       | ✅     | ✅         | ✅   | ✅     |
| <code>collections/__init__.py</code>               | ✅     | ✅         | ✅   | ✅     |
| <code>collections/abc/__init__.py</code>           | ✅     | ❌         | ✅   | ✅     |
| <code>collections/foobar/__init__.py</code>        | ❌     | ❌         | ✅   | ❌     |
| <code>foobar/__init__.py</code>                    | ❌     | ❌         | ❌   | ❌     |
| <code>foobar/abc/__init__.py</code>                | ✅     | ❌         | ❌   | ✅     |
| <code>foobar/collections/__init__.py</code>        | ✅     | ❌         | ❌   | ✅     |
| <code>foobar/collections/abc/__init__.py</code>    | ✅     | ❌         | ❌   | ✅     |
| <code>foobar/collections/foobar/__init__.py</code> | ❌     | ❌         | ❌   | ❌     |
| <code>urlparse/__init__.py</code>                  | ❌     | ❌         | ❌   | ❌     |
| <code>foobar/logging.py</code>                     | ✅     | ❌         | ✅   | ✅     |</p>
<p>Like https://github.com/astral-sh/ruff/issues/15399#issuecomment-2612005957, ✅ means we emit a diagnostic and ❌ means no diagnostic.</p>
<p>We now match the behavior of the upstream <code>flake8-builtins</code> in strict mode, but allow configuring a non-strict mode too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-06 18:23</div>
            <div class="timeline-body"><p>Thanks for the nice table. I think we should split out the bug fix from the preview behavior change for a clear changelog entry. I hope it isn't too tedious (we can update the changelog manually if it is)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-06 19:02</div>
            <div class="timeline-body"><blockquote>
<p>I think we should split out the bug fix from the preview behavior change for a clear changelog entry.</p>
</blockquote>
<p>Sure, no problem! Just to make sure, the bug fix is matching the behavior of upstream (so most of the changes in the rule file, minus the new option), and the preview change is everything to do with the new config option?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-06 21:13</div>
            <div class="timeline-body"><p>Exactly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-07 08:07</div>
            <div class="timeline-body"><p>I think I'll have to wait to review this one until your other PR lands. I put it back in draft mode and you can signal that it's ready by marking it ready for review again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @MichaReiser on 2025-02-07 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-02-08 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-08 18:08</div>
            <div class="timeline-body"><p>I think this should be ready to review again. It's now only a couple of lines changed in the rule itself, the addition of the config option, and adding the right option value to a couple of existing tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-09 18:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-02-10 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-02-10 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-10 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-02-11 10:38</div>
            <div class="timeline-body"><p>I believe that the documentation for this was not yet updated, right? Was trying to read there what this new setting is without having to go through pages of discussion about it, but dont see it there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-11 10:40</div>
            <div class="timeline-body"><p>The website should be updated (<a href="https://docs.astral.sh/ruff/settings/#lint_flake8-builtins_builtins-strict-checking">see</a>) but yes, we should reference the option in the rule's documentation. @ntBre would you mind following up on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DaniBodor">@DaniBodor</a> on 2025-02-11 10:44</div>
            <div class="timeline-body"><p>I indeed meant the rule documentation, which is where i (and i guess most people) normally first land when looking up how to change settings regarding a specific rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-11 13:20</div>
            <div class="timeline-body"><p>Will do!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:52 UTC
    </footer>
</body>
</html>
