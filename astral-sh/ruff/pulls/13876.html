<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] is_subtype_of: treat literals as subtype of 'object' - astral-sh/ruff #13876</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] is_subtype_of: treat literals as subtype of 'object'</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13876">#13876</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2024-10-22 10:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Just something I found while trying to fix #13870. But probably useful on its own.</p>
<p>Add the following subtype relations:</p>
<ul>
<li><code>BooleanLiteral &lt;: object</code></li>
<li><code>IntLiteral &lt;: object</code></li>
<li><code>StringLiteral &lt;: object</code></li>
<li><code>LiteralString &lt;: object</code></li>
<li><code>BytesLiteral &lt;: object</code></li>
</ul>
<p>Added a test case for <code>bool &lt;: int</code>.</p>
<h2>Test Plan</h2>
<p>New unit tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2024-10-22 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @sharkdp on 2024-10-22 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2024-10-22 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:419 on 2024-10-22 10:21</div>
            <div class="timeline-body"><p>Another way of doing this might be to move these branches higher up so that they come immediately below the <code>Type::Never</code> branches, before any of the <code>Literal</code> branches:</p>
<p>https://github.com/astral-sh/ruff/blob/cd6c9371943db7d10fc5c449eccfb2700c485cd2/crates/red_knot_python_semantic/src/types.rs#L445-L446</p>
<p>Which might be slightly less efficient, but also slightly less error-prone? Since we won't have to remember to account for <code>object</code> in all the other branches if we deal with them upfront at the top of the <code>match</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 10:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-22 10:30</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 10:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:419 on 2024-10-22 10:31</div>
            <div class="timeline-body"><p>That also works, yes. I thought about it.</p>
<blockquote>
<p>Which might be slightly less efficient</p>
</blockquote>
<p>That's why I didn't implement it this way. Happy to change it though, if you think it helps. On the other hand, if we add new type variants, we would probably check what other branches do.. but then again, your solution would be less code :man_shrugging:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 10:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:419 on 2024-10-22 10:32</div>
            <div class="timeline-body"><p>I don't mind too much; happy to defer to what you think is best. I'm sure you have better instincts than me for what will be best in terms of performance ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-22 10:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-10-22 10:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 10:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:419 on 2024-10-22 10:56</div>
            <div class="timeline-body"><p>Let's not trust any instincts when it comes to performance. I like your version better — changed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-22 10:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2024-10-22 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2024-10-22 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-22 11:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:09 UTC
    </footer>
</body>
</html>
