```yaml
number: 7265
title: Add range to lexer test snapshots
type: pull_request
state: merged
author: dhruvmanila
labels:
  - internal
assignees: []
merged: true
base: main
head: dhruv/lexer-test-2
created_at: 2023-09-11T08:18:43Z
updated_at: 2023-09-11T19:22:06Z
url: https://github.com/astral-sh/ruff/pull/7265
synced_at: 2026-01-12T02:45:38Z
```

# Add range to lexer test snapshots

---

_Pull request opened by @dhruvmanila on 2023-09-11 08:18_

## Summary

This PR updates the lexer test snapshots to include the range value as well.
This is mainly a mechanical refactor.

### Motivation

The main motivation is so that we can verify that the ranges are valid and do
not overlap.

## Test Plan

`cargo test`


---

_Comment by @dhruvmanila on 2023-09-11 08:18_

Current dependencies on/for this PR:
* main
  * **PR #7264** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7264" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7265** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7265" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7265?utm_source=stack-comment).

---

_Label `internal` added by @dhruvmanila on 2023-09-11 08:19_

---

_Comment by @codspeed-hq[bot] on 2023-09-11 08:29_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/dhruv/lexer-test-2)

### Merging #7265 will **degrade performances by 3.17%**

<sub>Comparing <code>dhruv/lexer-test-2</code> (aa47dfd) with <code>dhruv/lexer-test-1</code> (52fbbc3)</sub>



### Summary

`âŒ 1 (ðŸ‘ 1)` regressions
`âœ… 24` untouched benchmarks



> :warning: _Please fix the performance issues or [acknowledge them on CodSpeed](https://codspeed.io/astral-sh/ruff/branches/dhruv/lexer-test-2)._

### Benchmarks breakdown

|     | Benchmark | `dhruv/lexer-test-1` | `dhruv/lexer-test-2` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ðŸ‘ | `lexer[large/dataset.py]` | 9.8 ms | 10.1 ms | -3.17% |


---

_Review requested from @MichaReiser by @dhruvmanila on 2023-09-11 08:29_

---

_Comment by @github-actions[bot] on 2023-09-11 08:41_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/lexer.rs`:1280 on 2023-09-11 14:31_

What's the reason for using `Token` vs `Spanned` directly? 

---

_@MichaReiser approved on 2023-09-11 14:32_

---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/snapshots/ruff_python_parser__lexer__tests__comment_until_mac_eol.snap`:11 on 2023-09-11 14:33_

This is a very verbose format. It could make sense to pick a more condense style `Token(Int { ...}, 0..3)` (You can get this by using `f.debug_tuple("Token").field(self.value).field(self.range).finish()`

---

_@MichaReiser reviewed on 2023-09-11 14:33_

---

_Comment by @MichaReiser on 2023-09-11 14:43_

Hmm, why should this change the lexer benchmark. Or was it because you haven't rebased on main yet?

---

_Comment by @dhruvmanila on 2023-09-11 17:07_

> Hmm, why should this change the lexer benchmark. Or was it because you haven't rebased on main yet?

Ah yes, it's because I haven't rebased it. I'll do it now. Sorry for the noise.

---

_@dhruvmanila reviewed on 2023-09-11 17:37_

---

_Review comment by @dhruvmanila on `crates/ruff_python_parser/src/lexer.rs`:1280 on 2023-09-11 17:37_

It must've been an oversight. I think `Spanned` is a more concise representation as you've also pointed out in your other comment :)

---

_@dhruvmanila reviewed on 2023-09-11 17:42_

---

_Review comment by @dhruvmanila on `crates/ruff_python_parser/src/snapshots/ruff_python_parser__lexer__tests__comment_until_mac_eol.snap`:11 on 2023-09-11 17:42_

This is similar to the struct output but without the field names. Taking the above example:
```
    (
        Int {
            value: 123,
        },
        0..3,
    ),
```

---

_Merged by @dhruvmanila on 2023-09-11 19:12_

---

_Closed by @dhruvmanila on 2023-09-11 19:12_

---

_Branch deleted on 2023-09-11 19:12_

---
