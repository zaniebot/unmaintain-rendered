<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add attribute assignment tests - astral-sh/ruff #18527</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add attribute assignment tests</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18527">#18527</a>
        opened by <a href="https://github.com/thejchap">@thejchap</a>
        on 2025-06-07 02:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a></div>
            <div class="timeline-body">Summary
<p>Related to: <a href="https://github.com/astral-sh/ruff/pull/18347">astral-sh/ruff#18347</a></p>
<p>This PR adds tests for some of the current behavior of <code>validate_attribute_assignment</code>, to help with the refactor. This catches some issues that surfaced in the ecosystem check.</p>
<p>Opening as a separate PR so I can see these pass against <code>main</code> then rebase <a href="https://github.com/astral-sh/ruff/pull/18347">astral-sh/ruff#18347</a> on top of this and fail them</p>
Projects
<ul>
<li>[ ] beartype</li>
<li>[ ] datadog</li>
<li>[ ] sphinx<ul>
<li>https://sourceforge.net/p/docutils/code/HEAD/tree/trunk/docutils/docutils/frontend.py#l568 conditional initialization</li>
<li>https://github.com/sphinx-doc/sphinx/blob/master/sphinx/builders/<strong>init</strong>.py#L689</li>
</ul>
</li>
<li>[ ] streamlit</li>
</ul>
Test Plan
<p>New mdtests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-06-07 02:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_python_semantic/resources/mdtest/attributes.md</code>:1669 on 2025-06-07 02:32</div>
            <div class="timeline-body"><p>mypy:</p>
<p><code>../test.py:12: error: Item &quot;A&quot; of &quot;A | B&quot; has no attribute &quot;x&quot;  [union-attr]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Add attribute assignment tests for unions&quot; to &quot;[ty] Add attribute assignment tests&quot; by <a href="https://github.com/thejchap">@thejchap</a> on 2025-06-07 02:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-07 02:37</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-06-07 02:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_python_semantic/resources/mdtest/attributes.md</code>:1784 on 2025-06-07 02:55</div>
            <div class="timeline-body"><p>~this should address the <a href="https://github.com/astral-sh/ruff/pull/18347#issuecomment-2915053687">beartype regression</a>~ this doesn&#x27;t catch the issue/<a href="https://github.com/astral-sh/ruff/pull/18347">fail on the other branch</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-06-07 03:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_python_semantic/resources/mdtest/attributes.md</code>:1790 on 2025-06-07 03:09</div>
            <div class="timeline-body"><p>~this should address the datadog regression~ doesn&#x27;t seem to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-07 07:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_python_semantic/resources/mdtest/attributes.md</code>:1784 on 2025-06-12 01:13</div>
            <div class="timeline-body"><p>@sharkdp</p>
<p>making slow progress on these - limited time :)</p>
<p>i&#x27;m still unclear on why the warning in beartype (<code>warning[possibly-unbound-attribute] beartype/_util/api/external/utilclick.py:108:5: Attribute </code>callback<code>on type</code>BeartypeableT<code> is possibly unbound</code>) is no longer being emitted on <a href="https://github.com/astral-sh/ruff/pull/18347">astral-sh/ruff#18347</a></p>
<p>however while investigating i did find what i think is an issue on <code>main</code> with setting attributes on generics where the upper bound is a union, after narrowing. added a <a href="https://github.com/astral-sh/ruff/pull/18527/files#diff-19ac4a4d9337821d0bbfb544ab4e3fda87df59c6ea06065b77d3fcf5cf682ec2R1750">test</a> to illustrate</p>
<p>this results in a <code>possibly-unbound-attribute</code> from <code>ty</code> but no diagnostic from <code>mypy</code></p>
mypy
<pre><code>../test.py:16: note: Revealed type is &quot;test.B&quot;
Success: no issues found in 1 source file
</code></pre>
ty
<pre><code>info[revealed-type]: Revealed type
  --&gt; /Users/justinchapman/src/test.py:16:23
   |
14 |     if not isinstance(b, B):
15 |         raise TypeError(&quot;Expected instance of B&quot;)
16 |     print(reveal_type(b))
   |                       ^ `C &amp; B`
17 |     b.x = 42
   |
</code></pre>
code
<pre><code>from typing import Union, TypeVar
from typing_extensions import reveal_type

class A:
    pass

class B:
    def __init__(self) -&gt; None:
        self.x: int = 0

C = TypeVar(&quot;C&quot;, bound=Union[A, B])

def _(b: C):
    if not isinstance(b, B):
        raise TypeError(&quot;Expected instance of B&quot;)
    print(reveal_type(b))
    b.x = 42

b = B()
_(b)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-06-12 01:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/attributes.md</code>:1784 on 2025-06-12 12:51</div>
            <div class="timeline-body"><p>That looks like a bug, yes. A similar bug was mentioned on Discord the other day. Would you mind reporting that as a separate issue? A simplified example would be https://play.ty.dev/62d91bdb-cbf1-4758-8f2c-6a26722c9f47</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-06-12 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_python_semantic/resources/mdtest/attributes.md</code>:1784 on 2025-06-13 23:07</div>
            <div class="timeline-body"><p>@sharkdp <a href="https://github.com/astral-sh/ty/issues/653">astral-sh/ty#653</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-06-13 23:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/thejchap">@thejchap</a> on 2025-07-20 23:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:17 UTC
    </footer>
</body>
</html>
