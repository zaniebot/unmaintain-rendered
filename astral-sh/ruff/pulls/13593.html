<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Fix a few details around `Type::call` - astral-sh/ruff #13593</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Fix a few details around <code>Type::call</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13593">#13593</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-10-01 16:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-01 16:44</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Most method calls of the form <code>x.y()</code> desugar to <code>y = x.y; y()</code>. However, this is not true for dunder methods when they are implicitly called. <code>iter(x)</code> does not desugar to <code>x.__iter__()</code>, it desugars to <code>type(x).__iter__(x)</code>. For several dunders, we're looking up the method on the type of the object (correct!) but then we're not passing <code>self</code> into the dunder when it's called (incorrect!).</p>
<p>This PR fixes that. It doesn't have any user-visible change right now (and it's not really possible to test right now) because we don't validate the types of arguments passed to functions yet. But it's good to get things right now; it will make things less confusing when somebody comes to implementing validation of argument types.</p>
<p>I also reworked the <code>CallOutcome::union</code> constructor method so that it accepts an <code>IntoIterator&lt;Item=Type&lt;'db&gt;&gt;</code> rather than a <code>Box&lt;[Type&lt;'db&gt;]&gt;</code>. This makes the signature slightly more flexible and ergonomic.</p>
<h2>Test Plan</h2>
<p><code>cargo test -p red_knot_python_semantic --lib</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2024-10-01 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2024-10-01 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2024-10-01 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-10-01 16:47</div>
            <div class="timeline-body"><p>Nice, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-10-01 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-10-01 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-01 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-01 16:58</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -1 violations, +0 -0 fixes in 1 projects; 53 projects unchanged)</p>
<details><summary><a href="https://github.com/python/typeshed">python/typeshed</a> (+0 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select E,F,FA,I,PYI,RUF,UP,W</pre>
</p>
<p>

<pre>
- <a href='https://github.com/python/typeshed/blob/44aa63330b03bdacab731af2333ff9bf70855de3/stubs/tensorflow/tensorflow/saved_model/__init__.pyi#L114'>stubs/tensorflow/tensorflow/saved_model/__init__.pyi:114:1:</a> F821 Undefined name `PREDI`
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| F821 | 1 | 0 | 1 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:00:07 UTC
    </footer>
</body>
</html>
