<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spruce up docs for flake8-pyi rules - astral-sh/ruff #10422</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Spruce up docs for flake8-pyi rules</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10422">#10422</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-03-15 13:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><p>This started off as an attempt to clarify some of the confusion in <a href="https://github.com/astral-sh/ruff/issues/9810">astral-sh/ruff#9810</a>#issuecomment-1999339083 and <a href="https://github.com/astral-sh/ruff/issues/9810">astral-sh/ruff#9810</a>#issuecomment-1999349880, but I figured I would take a more comprehensive look at the docs for the flake8-pyi rules while I was about it.</p>
<p>Summary of the changes:</p>
<ul>
<li>Improve clarity over the motivation for some rules</li>
<li>Improve links to external references. In particular, reduce links to PEPs, as PEPs are generally historical documents rather than pieces of living documentation. Where possible, it&#x27;s better to link to the <a href="https://typing.readthedocs.io/en/latest/spec/">official typing spec</a>, the other docs at https://typing.readthedocs.io/en/latest/, or the docs at https://docs.python.org/3/library/typing.html.</li>
<li>Add some missing imports to code examples</li>
<li>Use more concise language in a few places</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-03-15 14:00</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-18 12:58</div>
            <div class="timeline-body"><p>I haven&#x27;t reviewed the docs for all the flake8-pyi rules yet -- only up to <code>redundant_numeric_union.rs</code> -- but I&#x27;ll cut scope here and tackle the others in a separate PR, so that this is easier to review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-18 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-18 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/any_eq_ne_annotation.rs</code>:24 on 2024-03-18 16:05</div>
            <div class="timeline-body"><p>This is probably on me but I don&#x27;t understand the relation between &quot;<code>==</code> or<code> !=</code> should never raise an exception&quot; and why the method should then use <code>object</code> rather than <code>Any</code>. How does using <code>object</code> guards against exceptions (other than that it might catch a few more typing errors)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/collections_named_tuple.rs</code>:21 on 2024-03-18 16:08</div>
            <div class="timeline-body"><pre><code>/// However, using `typing.NamedTuple` allows you to provide a type annotation
/// for each field in the class. This means that type checkers will have
/// more information to work with, and will be able to analyze your code
/// more precisely.
</code></pre>
<p>Maybe we can rephrase it to say that <code>namedtuple</code> types all fields as <code>Any</code> (I guess?) and that <code>typing.NamedTuple</code> allows you to specify the field types instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/complex_assignment_in_stub.rs</code>:44 on 2024-03-18 16:09</div>
            <div class="timeline-body"><p>Noob question. Is this preferred over <code>type X = int</code> or is that syntax not allowed in classes/stubs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/future_annotations_in_stub.rs</code>:15 on 2024-03-18 16:19</div>
            <div class="timeline-body"><p>This might be correct but it&#x27;s weird that the <code>.</code> is inside of the parentheses :sweat_smile:</p>
<pre><code>/// type checkers). As such, the `from __future__ import annotations` import
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/iter_method_return_iterable.rs</code>:20 on 2024-03-18 16:21</div>
            <div class="timeline-body"><p>I would probably remove the second &quot;in Python&quot;, assuming that&#x27;s clear from a python linter.</p>
<pre><code>/// `__iter__` methods are expected to return `Iterator`s. Type
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/iter_method_return_iterable.rs</code>:39 on 2024-03-18 16:24</div>
            <div class="timeline-body"><p>What I understood from the description &quot;by calling <code>iter</code> on the list&quot; is that you write <code>y = x.iter()</code>.</p>
<p>Maybe that&#x27;s because of my German background but &quot;on&quot; sounds like it&#x27;s a method on list. It might already be sufficient to change the example to <code>iter(...)</code> or <code>iter(x)</code> or use another word than <code>on</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/iter_method_return_iterable.rs</code>:50 on 2024-03-18 16:24</div>
            <div class="timeline-body"><p>Nit: I&#x27;m okay with either.</p>
<pre><code>/// on the returned object, violating the contract of the interface.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/no_return_argument_annotation.rs</code>:18 on 2024-03-18 16:27</div>
            <div class="timeline-body"><p>I think this misses an explanation of why it&#x27;s more idiomatic (or a preferred stylistic choice) to use  <code>Never</code> over <code>NoReturn</code>. I assume it&#x27;s mainly that <code>NoReturn</code> is intended for function return types and everything else should use <code>Never</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_literal_union.rs</code>:37 on 2024-03-18 16:30</div>
            <div class="timeline-body"><p>Shouldn&#x27;t this be <code>str</code>?</p>
<blockquote>
<p>For example, <code>Literal[&quot;A&quot;] | str</code> is equivalent to <code>str</code>, and</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-03-18 16:31</div>
            <div class="timeline-body"><p>Nice improvements. I learned a couple of things by reading through your new documentation.</p>
<p>I left a few Python noob understand comments</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 16:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/iter_method_return_iterable.rs</code>:50 on 2024-03-18 16:46</div>
            <div class="timeline-body"><p>I weakly prefer &quot;expectations of the interface&quot;, so I&#x27;ll stick with my current wording here üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 16:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/any_eq_ne_annotation.rs</code>:24 on 2024-03-18 16:50</div>
            <div class="timeline-body"><p>Basically, for any two objects <code>x</code> and <code>y</code>, <code>x == y</code> should <em>never</em> raise an exception -- calling <code>x.__eq__(y)</code> should be safe regardless of what the types are. That means that <code>object</code> is the better type here, as it&#x27;s Python&#x27;s true &quot;top type&quot; from a type theory perspective.</p>
<p><code>Any</code> should be reserved for situations where you either want to allow unsafe behaviour for some reason, or for situations where your code is safe, but the true type that a function accepts is inexpressible. That should never be the case for <code>__eq__</code> or <code>__ne__</code> methods -- <code>object</code> should do just fine in all cases.</p>
<p>Now, how can I put that more succinctly üòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 16:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/complex_assignment_in_stub.rs</code>:44 on 2024-03-18 16:53</div>
            <div class="timeline-body"><p><code>type X = int</code> is allowed in classes/stubs, but it&#x27;s new syntax that&#x27;s only available on Python 3.12+ -- I think it&#x27;s better to use syntax here that all users of Python will be able to use</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 16:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/future_annotations_in_stub.rs</code>:15 on 2024-03-18 16:54</div>
            <div class="timeline-body"><p>The rule is that if it&#x27;s a complete sentence inside the parentheses, the period goes inside the parentheses, but if it&#x27;s only part of a sentence inside the parentheses, the period goes outside: https://www.masterclass.com/articles/period-inside-or-outside-parentheses</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 16:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/no_return_argument_annotation.rs</code>:18 on 2024-03-18 16:59</div>
            <div class="timeline-body"><p>It&#x27;s basically just because it&#x27;s really confusing to see a type called <code>NoReturn</code> in a parameter annotation -- that&#x27;s the only reason we added the <code>Never</code> type in Python 3.11 üòÑ It has exactly the same semantics as <code>Noreturn</code>.</p>
<p>I&#x27;ll try to flesh this out a little more...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_literal_union.rs</code>:37 on 2024-03-18 16:59</div>
            <div class="timeline-body"><p>Whoops, good catch. This should be <code>Literal[b&quot;B&quot;] | str</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 16:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 17:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/collections_named_tuple.rs</code>:21 on 2024-03-18 17:57</div>
            <div class="timeline-body"><blockquote>
<p>Maybe we can rephrase it to say that <code>namedtuple</code> types all fields as <code>Any</code> (I guess?)</p>
</blockquote>
<p>That&#x27;s correct, but I wonder if we really need to go into that much detail here... I think simply saying that it will make type-checking more accurate is okay for our purposes here, and helps avoid too much information overload</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-18 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/iter_method_return_iterable.rs</code>:39 on 2024-03-18 18:01</div>
            <div class="timeline-body"><p>You&#x27;re right that this was unclear -- I changed the wording from</p>
<pre><code>calling `iter()` on the list
</code></pre>
<p>to</p>
<pre><code>passing the list to `iter()`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-18 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-18 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-20 16:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:02:18 UTC
    </footer>
</body>
</html>
