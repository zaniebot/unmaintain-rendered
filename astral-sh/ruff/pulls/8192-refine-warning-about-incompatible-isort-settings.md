```yaml
number: 8192
title: "Refine warning about incompatible `isort` settings"
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: refine-format-isort-warning
created_at: 2023-10-25T01:33:16Z
updated_at: 2025-04-22T17:27:04Z
url: https://github.com/astral-sh/ruff/pull/8192
synced_at: 2026-01-10T19:33:02Z
```

# Refine warning about incompatible `isort` settings

---

_Pull request opened by @MichaReiser on 2023-10-25 01:33_

## Summary

This PR refines the warning shown when running `ruff format` about incompatible `isort` settings:

* Only warn if `I001` (unsorted imports) is enabled. 
* `lines-after-imports`: Warn about values other than `-1`, `1`, and `2` because the formatter enforces at least one empty and at most two empty lines after imports. 
* `lines-between-types`: Warn about values > 1 because the formatter preserves at most one empty line in nested import blocks. 
* `split_on_trailing_comma`: Only warn when `skip-magic-trailing-comma` is `true` to ensure the formatter preserves the trailing commas.
* Remove `force-single-line`: I think removing the warnings is safe. The setting seems to mainly be about removing parentheses around alieses:
  ```python
  from .utils2 import (
    test_directory as test_directory,
  )
  from .utils2 import (
      test_id as test_id,
  )

   # isorted
  from .utils import (
    test_directory as teeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee,
  )
  from .utils import test_id as t2
  from .utils2 import test_directory as test_directory
  from .utils2 import test_id as test_id  
  ```
  
  which the formatter leaves unchanged
* Only warn about `force_wrap_aliases` when `skip-magic-trailing-comma` is `true`. Isort inserts trailing commas that the formatter respects, except when `skip-magic-trailing-comma` isn't set to `true`.


## Test Plan

Added test plans. Played around with different examples in the playground to identify the `isort` behavior. 


---

_Comment by @MichaReiser on 2023-10-25 01:33_

Current dependencies on/for this PR:
* main
  * **PR #8192** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8192" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #8196** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8196" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #8244** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8244" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/8192?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-10-25 01:51_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Label `formatter` added by @MichaReiser on 2023-10-25 01:59_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-10-25 01:59_

---

_Comment by @MichaReiser on 2023-10-25 02:00_

@charliermarsh you have a better understanding of `isort` than I. I would appreciate if you could review the compatibility in detail to make sure we get it right this time.

---

_Marked ready for review by @MichaReiser on 2023-10-25 02:01_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:723 on 2023-10-25 03:03_

This one looks right (going through one-by-one).

---

_@charliermarsh reviewed on 2023-10-25 03:03_

---

_@charliermarsh reviewed on 2023-10-25 03:04_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:727 on 2023-10-25 03:04_

This makes sense (nit: "isort", lowercase).

---

_@charliermarsh reviewed on 2023-10-25 03:04_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/options.rs`:1914 on 2023-10-25 03:04_

Nit: no apostrophe after `Value`

---

_@charliermarsh reviewed on 2023-10-25 03:04_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/options.rs`:1915 on 2023-10-25 03:04_

Nit: `emty`, and space between `import` and period.

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:720 on 2023-10-25 03:05_

Yeah, this is fine to allow.

---

_@charliermarsh reviewed on 2023-10-25 03:05_

---

_@charliermarsh reviewed on 2023-10-25 03:06_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:727 on 2023-10-25 03:06_

I think we should have the same logic for [`split-on-trailing-comma`](https://docs.astral.sh/ruff/settings/#isort-split-on-trailing-comma).

---

_@charliermarsh reviewed on 2023-10-25 03:08_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:727 on 2023-10-25 03:08_

`split-on-trailing-comma` needs to be identical to `setting.formatter.magic_trailing_comma` (i.e., if `split-on-trailing-comma` is `true`, we need `setting.formatter.magic_trailing_comma.is_respect()`, I think).

---

_@charliermarsh reviewed on 2023-10-25 03:10_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:717 on 2023-10-25 03:10_

Confirmed this is correct...

---

_@charliermarsh approved on 2023-10-25 03:12_

These look correct to me. I also scanned through the full list of options and confirmed the omitted settings seem compatible too.

---

_Merged by @MichaReiser on 2023-10-25 07:41_

---

_Closed by @MichaReiser on 2023-10-25 07:41_

---

_Branch deleted on 2023-10-25 07:41_

---
