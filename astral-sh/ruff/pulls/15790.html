<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Check for shadowed `map` before suggesting fix (`RUF058`) - astral-sh/ruff #15790</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Check for shadowed <code>map</code> before suggesting fix (<code>RUF058</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15790">#15790</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-01-28 17:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-01-28 17:07</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes #15786 by not suggesting a fix if <code>map</code> doesn't have its builtin binding.</p>
<h2>Test Plan</h2>
<p>New test taken from the report in #15786.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-01-28 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-01-28 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-01-28 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-28 17:26</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-01-28 17:29</div>
            <div class="timeline-body"><p>Nice! While we're here, as an optional extra: this rule is lacking docs on why the fix is sometimes marked as unsafe (the reason looks like it's because it could destroy comments in some situations). We should probably add a <code>## Fix safety</code> section to the docs that explains this (see https://github.com/astral-sh/ruff/issues/15584)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-01-28 17:53</div>
            <div class="timeline-body"><p>Good catch! I adapted the fix safety section from RUF055:</p>
<pre><code class="language-rust">/// ## Fix safety
///
/// This rule's fix is marked as unsafe if the `starmap` or `zip` expressions contain comments that
/// would be deleted by applying the fix. Otherwise, the fix can be applied safely.
</code></pre>
<p>What about a <code>## Fix availability</code> section? I only found one example of that in RUF052 with a quick grep. Maybe it's not usually in a separate section.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-28 17:55</div>
            <div class="timeline-body"><blockquote>
<p>What about a <code>## Fix availability</code> section? I only found one example of that in RUF052 with a quick grep. Maybe it's not usually in a separate section.</p>
</blockquote>
<p>It's true that we don't document it as often currently, but I think it's nice to document that too when we can, for sure!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-01-28 18:03</div>
            <div class="timeline-body"><p>Sounds good! I added both new sections. I put safety first (pun somewhat intended), then availability, but happy to reverse it too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-01-28 18:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-01-28 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-01-28 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-28 19:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:51 UTC
    </footer>
</body>
</html>
