<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drop WSL1 special case in flake8-executable - astral-sh/ruff #21724</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Drop WSL1 special case in flake8-executable</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21724">#21724</a>
        opened by <a href="https://github.com/K900">@K900</a>
        on 2025-12-01 11:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/K900">@K900</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>WSL1 is very very dead, and WSL2 handles permissions properly. Fixes <code>cargo test</code> on Ruff itself failing on WSL2, and removes what's generally a high potential footgun.</p>
<p>Fixes #10084 in a simpler way than #17584.</p>
<h2>Test Plan</h2>
<p><code>cargo test</code> on a WSL2 system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @amyreese on 2025-12-01 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a> approved on 2025-12-01 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-01 19:04</div>
            <div class="timeline-body"><p>This feels like it could be a breaking change to me (so we could try it in preview first), but I'm curious what others think. We may also need to update the rule docs, which both mention WSL.</p>
<p>Otherwise the change looks reasonable to me, and it's nice to drop a dependency!</p>
<p>cc @MichaReiser who reviewed #17584.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-01 20:18</div>
            <div class="timeline-body"><p>Oops, missed the doc change. Fixed it now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-02 09:22</div>
            <div class="timeline-body"><p>@K900 would you mind testing the example in https://github.com/astral-sh/ruff/issues/5445</p>
<p>I don't use WSL myself, so I'm not very familiar with how it works but what I understand is that all files on a windows disk <code>/mnt/...</code> always have the executable bit set, in which case we'd flag every single file on that disk if they miss a shebang.</p>
<p>I agree, that we should preview gate this change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-02 09:27</div>
            <div class="timeline-body"><p>It's a little more complicated than that on WSL2. Linux permissions are persisted on Windows partitions, as NTFS xattrs, but files without any xattrs, e.g. ones created on the Windows side, are defaulted to 0777. So if you, say, run <code>git clone</code> on Windows to clone a repo and then try to access it on WSL, it will have 0777 permissions on everything, but if you <code>git clone</code> the same repo to the same path from the WSL side, it will have correct permissions on both sides. This is not entirely obvious behavior, but it will also throw off git (if used from WSL) and basically any other tool, and I don't think Ruff has to try and work around this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-02 09:29</div>
            <div class="timeline-body"><p>To clarify:</p>
<pre><code>~
❯ cd /mnt/d/test/

/mnt/d/test
❯ ls
╭────────────╮
│ empty list │
╰────────────╯

/mnt/d/test
❯ touch beep

/mnt/d/test
❯ /mnt/c/Windows/System32/cmd.exe /c &quot;echo &gt; boop&quot;  # this escapes back to Windows and creates a file &quot;from Windows&quot;

/mnt/d/test
❯ ls -la
╭────┬──────┬──────┬────────┬──────────┬───────────┬───────────┬────────────────────┬──────┬───────┬──────┬─────────┬─────╮
│  # │ name │ type │ target │ readonly │   mode    │ num_links │       inode        │ user │ group │ size │ created │ ... │
├────┼──────┼──────┼────────┼──────────┼───────────┼───────────┼────────────────────┼──────┼───────┼──────┼─────────┼─────┤
│  0 │ beep │ file │        │ false    │ rw-r--r-- │         1 │ 143552238122452878 │ k900 │ users │  0 B │         │ ... │
│  1 │ boop │ file │        │ false    │ rwxrwxrwx │         1 │ 133137663984158607 │ k900 │ users │ 13 B │         │ ... │
╰────┴──────┴──────┴────────┴──────────┴───────────┴───────────┴────────────────────┴──────┴───────┴──────┴─────────┴─────╯

/mnt/d/test
❯ chmod 0666 boop

/mnt/d/test
❯ ls -la
╭────┬──────┬──────┬────────┬──────────┬───────────┬───────────┬────────────────────┬──────┬───────┬──────┬─────────┬─────╮
│  # │ name │ type │ target │ readonly │   mode    │ num_links │       inode        │ user │ group │ size │ created │ ... │
├────┼──────┼──────┼────────┼──────────┼───────────┼───────────┼────────────────────┼──────┼───────┼──────┼─────────┼─────┤
│  0 │ beep │ file │        │ false    │ rw-r--r-- │         1 │ 143552238122452878 │ k900 │ users │  0 B │         │ ... │
│  1 │ boop │ file │        │ false    │ rw-rw-rw- │         1 │ 133137663984158607 │ k900 │ users │ 13 B │         │ ... │
╰────┴──────┴──────┴────────┴──────────┴───────────┴───────────┴────────────────────┴──────┴───────┴──────┴─────────┴─────╯
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-02 09:31</div>
            <div class="timeline-body"><p>I'm not yet convinced that we should make this change but we should explain this caveat in the documentation and explain to users how they can &quot;fix their setup&quot; if they run into this situation (clone from within WSL)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-02 09:34</div>
            <div class="timeline-body"><p>I don't know if I agree, to be honest. This is kind of similar levels of user error as, say, putting stuff on a noexec filesystem, or on a FAT32 or something. There's really no good way to <em>actually know</em> if the filesystem has sane semantics. Maybe some sort of global detection that skips the check if all files come back executable? But even that feels iffy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-02 09:47</div>
            <div class="timeline-body"><p>I'm not sure if you're misunderstanding me. What I'm suggesting is that we make this change in preview, but we also extend the rule documentation with a <code>WSL</code> section, explaining in which situations they might see violations for every single file and what they can do to fix it. I don't see what the issue is with helping users in case they see confusing behavior and I would also find this documentation useful for myself, if a user asks for help in the future.</p>
<p>The use case I'm worried about is users who switch between WSL and non-WSL, creating some files in Windows and others in WSL, but flake8-executable is enforced in their organisation. They would have to change their behavior. We could consider recommending that they turn off the rule at a user-level configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-02 09:58</div>
            <div class="timeline-body"><p>The thing here is that WSL preserves permissions correctly, if set on the WSL side, so just running autofix should repair any sort of WSL setup, <em>even if the files are then updated from the Windows side</em>, because xattrs stay. (wait, does this rule even have an autofix? maybe it should if it doesn't yet) However, there are also other kinds of weird setups that are already not caught by this check, and I'm not sure there's a good way to identify those in a general enough way to try and be smart about this particular check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-02 10:15</div>
            <div class="timeline-body"><p>We don't necessarily have to agree here, but I see some documentation giving users a hint on how to solve this problem that users have run into with Ruff in the past, which is a prerequisite to merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-02 10:23</div>
            <div class="timeline-body"><p>Sorry, to be clear, I'm not saying this exact change shouldn't have documentation, I'm kind of thinking out loud about whether there is a way to implement this that doesn't <em>need</em> documentation. What do you think about adding an autofix for this, and then maybe explicitly documenting something like &quot;if the autofix didn't work, your filesystem is probably being weird&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-02 13:04</div>
            <div class="timeline-body"><p>I see.</p>
<p>I don't see an obvious way for Ruff to detect this, given that it depends on where a file was created. I'm leaning towards making the change you suggestg with better documentation and we can always introduce a <code>skip_on_wsl</code> option</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-02 13:07</div>
            <div class="timeline-body"><p>Do you mean just this change, or also adding an auto fix? I can look into doing that in a couple hours.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-02 13:11</div>
            <div class="timeline-body"><p>Just this change. Adding an auto fix seems unrelated to this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-04 09:41</div>
            <div class="timeline-body"><p>The autofix is a good way to fix a messed up repo, possibly, if you cloned from Windows and ran ruff from WSL. Also, I wonder how hard it'll be to have git support the WSL xattrs... That would solve most issues before they even happen.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-09 15:44</div>
            <div class="timeline-body"><p>Added some documentation that is hopefully generic enough to catch most causes of false positives. Sorry for the delay, caught a cold :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2025-12-09 15:45</div>
            <div class="timeline-body"><p>(and yes, NTFS filesystems mounted to WSL technically <em>do</em> support Unix permissions, but this is a can of worms that is probably out of scope for Ruff rule documentation)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-11 09:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_executable/rules/shebang_missing_executable_file.rs</code>:35 on 2025-12-11 09:25</div>
            <div class="timeline-body"><p>I understood that it's less about where the file is stored but more about how the file was created (WSL side or from within windows).</p>
<p>Should we also document how users can fix their file system state, e.g. by running chmod from within WSL and setting the file to its default permissions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-11 09:26</div>
            <div class="timeline-body"><blockquote>
<p>Added some documentation that is hopefully generic enough to catch most causes of false positives. Sorry for the delay, caught a cold :(</p>
</blockquote>
<p>No need to feel sorry. Thanks for looking into this. I find it very helpful to have someone with deep WSL understanding to talk this change through.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/K900">@K900</a> reviewed on 2025-12-11 09:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/K900">@K900</a> on <code>crates/ruff_linter/src/rules/flake8_executable/rules/shebang_missing_executable_file.rs</code>:35 on 2025-12-11 09:30</div>
            <div class="timeline-body"><p>It's kind of both, because WSL is not the only failure mode here, it's also native Linux drivers for filesystems that don't have the concept of POSIX permission bits (vfat etc). WSL in particular is extra weird because it stores POSIX permissions bits in NTFS xattrs and just assumes 0755 if the xattr isn't set, so it's extra confusing and Windows applications touching those files can also make xattrs be weird and I don't know if trying to explain all of this in a note for this lint is a good idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/K900">@K900</a> reviewed on 2025-12-11 09:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/K900">@K900</a> on <code>crates/ruff_linter/src/rules/flake8_executable/rules/shebang_missing_executable_file.rs</code>:35 on 2025-12-11 09:32</div>
            <div class="timeline-body"><p>Or at least I really have no idea how to communicate this in a way that's both easy to understand and <em>actually technically correct</em>, which is what made me go for the &quot;Just Don't&quot; hint.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-12 10:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_executable/rules/shebang_missing_executable_file.rs</code>:35 on 2025-12-12 10:09</div>
            <div class="timeline-body"><p>I see. I think my conclusion is we can't make this change and instead need a setting or we risk breaking users that use WSL in combination with such a file system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/K900">@K900</a> reviewed on 2025-12-12 10:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/K900">@K900</a> on <code>crates/ruff_linter/src/rules/flake8_executable/rules/shebang_missing_executable_file.rs</code>:35 on 2025-12-12 10:11</div>
            <div class="timeline-body"><p>It's not just WSL, you can mount a vfat partition on normal Linux, put a repo on it and it'll all be 0755 no matter what, because vfat just makes up the permission bits. I don't know if WSL will even <em>let you</em> access non-NTFS partitions over drvfs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-11 09:02</div>
            <div class="timeline-body"><p>I hope it's OK to chime in here as the author of #10084 and someone with a lot of experience both using WSL and looking at potential solutions to this issue.</p>
<p>@ntBre, you are correct - this <em>is</em> a breaking change and will cause false positives for a subset of users, where the status quo causes false negatives for a different subset of users. (I'll add a table summary to #10084 and copy it here too)</p>
<p>@MichaReiser's original argumentation when discussing this was that false negatives are worse, as settings are mainly on a per-project basis - so it's hard to disable the rule only for some contributors.</p>
<p>@K900 - this is definitely the easiest of &quot;solutions&quot; and I agree with you, and initially argued myself, that it has long been a strong recommendation by MS, that WSL users avoid using mounted windows partitions for performance reasons (see the note at the end of the description on #17584 for example timings)</p>
<p>My personal opinion, FWIW, is that identifying default file permissions is the best: covers all use-cases, actually improves performance. (This is not what I first thought, when beginning to discuss and look at this issue; I actually agreed with the approach proposed in the PR when I first opened the issue).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> reviewed on 2026-01-11 09:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on <code>crates/ruff_linter/src/rules/flake8_executable/rules/shebang_missing_executable_file.rs</code>:35 on 2026-01-11 09:09</div>
            <div class="timeline-body"><p>To be absolutely clear: the underlying problem is purely a <strong>file-system issue</strong> and in <strong>no way inherent to WSL</strong>.</p>
<p>The reason it comes up in relation to WSL is that this is the most common real-life scenario of a linux user storing their code on an FS without <em>nix permission bits *and</em> where the user doesn't understand the consequences. (A linux user storing code on an xFAT UBS stick is more likely to understand why they are getting this problem and simply ignore it - but see #12941)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 09:12</div>
            <div class="timeline-body"><p>The problem I have with identifying file permissions is that to do that we need to:</p>
<ul>
<li>find a place to write a test file to (we can't always do that)</li>
<li>be reasonably confident that the filesystem will behave the same way as the file we just wrote (drvfs doesn't)</li>
</ul>
<p>Edit: to be clear, #17584 does not in fact work for the &quot;WSL, source root on drvfs, cloned from Windows&quot; use case, because it will create a file with 644 permissions, drvfs will record that and give us back the correct permissions, but none of the other files will have the correct xattrs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-11 09:21</div>
            <div class="timeline-body"><p>Overview of currently proposed solutions:</p>
<p>| | WSL user, WSL FS (#10084) | Linux user USB stick (#12941) | WSL user, Win FS (#3110, #5445) |
| -- | -- | -- | -- |
| Status Quo | :x: (false negatives) | :x: (false positives) | :x: (false negatives) |
| #17548 | :white_check_mark: | :white_check_mark: | :white_check_mark: |
| #21724 | :white_check_mark: | :x: (false positives) | :x: (false positives) |</p>
<p>https://github.com/astral-sh/ruff/issues/10084#issuecomment-3734292000</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-11 09:32</div>
            <div class="timeline-body"><blockquote>
<p>The problem I have with identifying file permissions is that to do that we need to:</p>
<ul>
<li>find a place to write a test file to (we can't always do that)</li>
<li>be reasonably confident that the filesystem will behave the same way as the file we just wrote (drvfs doesn't)</li>
</ul>
</blockquote>
<p>Did you take a look at the approach in the other PR?</p>
<ol>
<li>check if pryproject.toml is executable (if not, then we can guarantee that we have a settable executable-bit)</li>
<li>touch a file in project_root (could fail if project root is read-only, although this is a more acceptable edge case than current status quo and only triggers on FS with no exe-bit)</li>
</ol>
<p>What specifically do you have in mind by cases where we can't write a test file?</p>
<p>I've not tested drvfs, do you have a test setup to see whether #17584 fails in that case? My understanding is that it is only relevant for WSL1 (as you say, now dead) and the above test would disable the lints at step 1 anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 09:36</div>
            <div class="timeline-body"><p>drvfs is still what WSL2 calls the 9p stuff internally, the case I'm imagining is: user clones repo from Windows, then runs ruff in WSL. What happens then is:</p>
<ul>
<li>pyproject.toml is executable, so we continue</li>
<li>we touch a file in project root, which is 644 by default because umask, that's recorded in NTFS xattrs, reading back the permissions gives us 644</li>
<li>all the other files are still marked executable because they have no xattrs</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-11 09:45</div>
            <div class="timeline-body"><blockquote>
<p>drvfs is still what WSL2 calls the 9p stuff internally, the case I'm imagining is: user clones repo from Windows, then runs ruff in WSL. What happens then is:</p>
<ul>
<li>pyproject.toml is executable, so we continue</li>
<li>we touch a file in project root, which is 644 by default because umask, that's recorded in NTFS xattrs, reading back the permissions gives us 644</li>
<li>all the other files are still marked executable because they have no xattrs</li>
</ul>
</blockquote>
<p>imagining or tested?</p>
<p>I have tested exactly this setup both locally, and in CI (https://github.com/MusicalNinjaDad/forks-ruff/actions/runs/14663820841/job/41154168824) and in both cases the touched file is executable and the lints are disabled.</p>
<p>If you have a specific setup which leads to the behaviour you describe then I'd be really interested to hear the config in place, both from general curiosity and to help with this case.</p>
<p>(EDIT: just tested this manually, again, on WSL2 with <code>cd /mnt/c/Users.../Temp; touch foo; ls -al foo</code> and <code>foo</code> has <code>0777</code> permissions)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 09:52</div>
            <div class="timeline-body"><p><img width="1860" height="303" alt="image" src="https://github.com/user-attachments/assets/0672d31d-50cf-4aca-948e-77978a60b5d3" /></p>
<p>On my end, the file touched from WSL is 0644.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 10:00</div>
            <div class="timeline-body"><p>Also here's a run with ruff from your branch (and a few dbg's sprinkled in):</p>
<pre><code>d/test/chinatsu-master
❯ ~/ruff/target/debug/ruff check --no-cache --select EXE
[crates/ruff_linter/src/rules/flake8_executable/helpers.rs:29:9] is_executable(&amp;settings.project_root.join(&quot;pyproject.toml&quot;)) = Ok(
    true,
)
[crates/ruff_linter/src/rules/flake8_executable/helpers.rs:33:37] is_executable(tmpfile.path()) = Ok(
    false,
)
chinatsu/__init__.py:1:1: EXE002 The file is executable but no shebang is present
(etc)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 10:01</div>
            <div class="timeline-body"><pre><code class="language-diff">diff --git a/crates/ruff_linter/src/rules/flake8_executable/helpers.rs b/crates/ruff_linter/src/rules/flake8_executable/helpers.rs
index 717c805721..47e1e7352d 100644
--- a/crates/ruff_linter/src/rules/flake8_executable/helpers.rs
+++ b/crates/ruff_linter/src/rules/flake8_executable/helpers.rs
@@ -26,11 +26,11 @@ static EXECUTABLE_BY_DEFAULT: OnceLock&lt;bool&gt; = OnceLock::new();
 #[cfg(target_family = &quot;unix&quot;)]
 pub(super) fn executable_by_default(settings: &amp;LinterSettings) -&gt; bool {
     *EXECUTABLE_BY_DEFAULT.get_or_init(|| {
-        is_executable(&amp;settings.project_root.join(&quot;pyproject.toml&quot;)).unwrap_or(true)
+        dbg!(is_executable(&amp;settings.project_root.join(&quot;pyproject.toml&quot;))).unwrap_or(true)
             // if pyproject.toml is executable or doesn't exist, run a slower check too:
             &amp;&amp; NamedTempFile::new_in(&amp;settings.project_root)
                 .map_err(std::convert::Into::into)
-                .and_then(|tmpfile| is_executable(tmpfile.path()))
+                .and_then(|tmpfile| dbg!(is_executable(tmpfile.path())))
                 .unwrap_or(false) // Assume a normal filesystem in case of read-only, IOError, ...
     })
 }
</code></pre>
<p>(for posterity)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-11 10:09</div>
            <div class="timeline-body"><p>Thanks for the confirmation.</p>
<p>Did you adjust your <code>[automount]</code> settings in <code>wsl.conf</code> to enable metadata and set a specific umask? Or are you running with default config and getting these results?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 10:10</div>
            <div class="timeline-body"><p>I have <code>options=metadata,uid=1000,gid=100</code>, the uid/gid stuff is just NixOS weirdness for historical reasons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-11 14:25</div>
            <div class="timeline-body"><p>Thanks - think I've got it now... I see that NixOS <a href="https://nix-community.github.io/NixOS-WSL/options.html#wslwslconfautomountenabled">defaults metadata enabled</a>, unlike the <a href="https://learn.microsoft.com/en-us/windows/wsl/wsl-config?source=recommendations#automount-options">base WSL default</a>, and for various reasons you have chosen/need to keep your code on an NTFS partition rather than the native linux one.</p>
<ol>
<li><p>I'm assuming from your comments above that you usually clone with linux git. So in your case your system usually behaves like the native WSL case and either of the PRs give you valid lints, status quo gives you potentially false negatives (?)</p>
</li>
<li><p>I don't have git for windows installed, but from looking at <a href="https://github.com/astral-sh/ruff/pull/21724#issuecomment-3734341168">your example under <code>d/test/chaintsu-master</code></a> it appears that cloning to an NTFS partition under windows doesn't add xattr info to maintain the *nix exe-bit. I'm assuming this is not your usual workflow(?)</p>
<ul>
<li>I'd expect that this could get messy quickly, as any future <code>git pull</code>s inside WSL will update file permissions for added/changed files that it retrieves from the remote, and any new files will not have 0644 perms. These perms will persist thanks to the metadata setting. <strong>&lt;-- <em>Could you confirm that easily?</em></strong></li>
<li>As you say, there's no decent heuristic available to help in this situation. So the only option would be a command-line-option/environment-variable. I looked into this and dropped it as doing it nicely and well documented affects a lot more code and forces the option to also be exposed via the config files. It's doable but at a higher cost to the maintainers ...</li>
<li>There is an argument to say that anyone working this way hopefully understands the consequences of their setup choices and will be in a small minority. Personally, I never like taking that attitude if it can be avoided ...</li>
</ul>
</li>
</ol>
<p>If I've understood things correctly this means we have the following situation:
| | WSL user, WSL FS (#10084) | Linux user USB stick (#12941) | WSL user, Win FS (#3110, #5445) | WSL user, metadata (@k900) | WSL user, metadata, cloned on Win |
| -- | -- | -- | -- | -- | -- |
| Status Quo | :exclamation: (false negatives) | :x: (false positives) | :exclamation: (false negatives) | :exclamation: (false negatives) | :exclamation: (false negatives) |
| #17548 | :white_check_mark: | :white_check_mark: | :white_check_mark: | :white_check_mark: | :exclamation: (false negatives) |
| #21724 | :white_check_mark: | :x: (false positives) | :x: (false positives) | :white_check_mark: | :exclamation: (false negatives) |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-11 14:31</div>
            <div class="timeline-body"><p>To be clear, this is not my actual setup that I actually use, it's a setup that I assume people ran into which led to the initial change. However, it's also yet another proof that guessing &quot;is the filesystem broken&quot; in the general case is impossible (even ignoring all kinds of obviously-pathological things like FileStation 9000 which returns random permission bits on every read).</p>
<p>My normal usage of Ruff doesn't actually trigger this bug - I've run into it because I occasionally build NixOS from source on my WSL systems, and Ruff fails <em>in its own tests</em> because those are not designed to run under WSL.</p>
<p>Also, Git knows nothing about the NTFS Unix-permission xattrs, so it never writes or updates them for any reason, meaning newly added files (if pulled from Windows) will be 0755, and any updated files will keep their existing permissions (unless moved, possibly?). Teaching Git about these xattrs is another thing that could probably improve things a lot, but not my can and not my worms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MusicalNinjaDad">@MusicalNinjaDad</a> on 2026-01-12 08:04</div>
            <div class="timeline-body"><p>Thanks. Yeah, no heuristic will be perfect for this. I'd see the &quot;WSL user, metadata enabled, cloned on Win&quot; as an unusual edge case which requires someone to actively adjust settings from defaults AND work against recommended practices, with consequences far beyond these lints - so reasonable to assume &quot;they know what they're doing&quot;.</p>
<p>Could you confirm the below table matches your experience and I'll update the issue to reflect it:</p>
<p>| | WSL user, WSL FS (official MS recommendation) (#10084) | WSL user, NTFS metadata enabled (e.g. NixOs) <a href="https://github.com/astral-sh/ruff/pull/21724#issuecomment-3734350142">see #21724</a> | Linux user exFAT USB stick (#12941) | WSL user, Win FS (#3110, #5445) |
| -- | -- | -- | -- | -- |
| Status Quo | :exclamation: (disabled) | :exclamation: (disabled) | :x: | :exclamation: (disabled) |
| #17548 | :white_check_mark: | :white_check_mark: | :exclamation: (disabled) | :exclamation: (disabled) |
| #21724 | :white_check_mark: | :white_check_mark: | :x: | :x: |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-12 08:17</div>
            <div class="timeline-body"><p>This seems accurate yeah. I hate how the table just keeps growing...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-18 08:27</div>
            <div class="timeline-body"><p>So folks, should we make some kind of call here? I'm still leaning towards just removing the check and documenting it better that cursed filesystem setups are the end user's problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-18 10:50</div>
            <div class="timeline-body"><blockquote>
<p>So folks, should we make some kind of call here? I'm still leaning towards just removing the check and documenting it better that cursed filesystem setups are the end user's problem.</p>
</blockquote>
<p>I don't feel a strong need to make a change here, especially since this has a very high chance of breaking someone's setup.</p>
<p>I'd be open to adding a config option that allows opting in on WSL, and extending the documentaiton</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/K900">@K900</a> on 2026-01-19 10:11</div>
            <div class="timeline-body"><p>The other issue, and the one that actually led me to discovering this behavior, is that running <code>cargo test</code> on Ruff itself breaks on WSL, because it makes this assumption and the tests aren't designed for it. This could be fixed by skipping the tests on WSL, I guess?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-19 10:19</div>
            <div class="timeline-body"><blockquote>
<p>The other issue, and the one that actually led me to discovering this behavior, is that running cargo test on Ruff itself breaks on WSL, because it makes this assumption and the tests aren't designed for it. This could be fixed by skipping the tests on WSL, I guess?</p>
</blockquote>
<p>Yes, I consider this to be a separate issue from changing the rule's behavior. Skipping it on WSL seems fine and something we can do in a seperate PR</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-19 10:31:31 UTC
    </footer>
</body>
</html>
