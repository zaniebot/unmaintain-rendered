<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ci(check_ecosystem): add PyPa/build - astral-sh/ruff #3569</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ci(check_ecosystem): add PyPa/build</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3569">#3569</a>
        opened by <a href="https://github.com/henryiii">@henryiii</a>
        on 2023-03-17 03:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/henryiii">@henryiii</a></div>
            <div class="timeline-body"><p>Adding PyPA/build.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-03-17 03:17</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     13.8Â±0.06ms     3.0 MB/sec    1.00     13.8Â±0.07ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.6Â±0.01ms     4.6 MB/sec    1.00      3.6Â±0.01ms     4.6 MB/sec
linter/all-rules/numpy/globals.py          1.00    505.9Â±1.82Âµs     5.8 MB/sec    1.00    505.5Â±1.15Âµs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1Â±0.02ms     4.2 MB/sec    1.00      6.1Â±0.02ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.00      7.5Â±0.02ms     5.4 MB/sec    1.00      7.5Â±0.02ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1688.5Â±4.52Âµs     9.9 MB/sec    1.00   1686.5Â±4.27Âµs     9.9 MB/sec
linter/default-rules/numpy/globals.py      1.00    192.8Â±0.61Âµs    15.3 MB/sec    1.00    192.5Â±0.44Âµs    15.3 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.5Â±0.01ms     7.3 MB/sec    1.00      3.5Â±0.02ms     7.3 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.01     15.9Â±0.27ms     2.6 MB/sec    1.00     15.8Â±0.15ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.2Â±0.06ms     3.9 MB/sec    1.00      4.2Â±0.05ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00    544.0Â±8.03Âµs     5.4 MB/sec    1.00    542.2Â±8.34Âµs     5.4 MB/sec
linter/all-rules/pydantic/types.py         1.01      6.9Â±0.10ms     3.7 MB/sec    1.00      6.9Â±0.08ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.01      8.8Â±0.09ms     4.6 MB/sec    1.00      8.7Â±0.13ms     4.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01  1921.3Â±20.96Âµs     8.7 MB/sec    1.00  1907.8Â±21.42Âµs     8.7 MB/sec
linter/default-rules/numpy/globals.py      1.00    211.2Â±2.91Âµs    14.0 MB/sec    1.02    214.9Â±5.95Âµs    13.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.1Â±0.05ms     6.3 MB/sec    1.01      4.1Â±0.07ms     6.2 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-17 03:37</div>
            <div class="timeline-body"><p>@henryiii - Any ideas on how to resolve the above?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-17 03:55</div>
            <div class="timeline-body"><p>Itâ€™s reading the pyproject.tomlâ€™s in test, I guess? Those need to be ignored. There are examples of broken toml files. Running it normally doesnâ€™t have this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-17 03:57</div>
            <div class="timeline-body"><p>I do get it when running locally:</p>
<pre><code>â¯ ruff .
error: TOML parse error at line 2, column 19
  |
2 | requires = ['bad' 'syntax']
  |                   ^
invalid array
expected `]
</code></pre>
<p>Does the typical invocation run over <code>src</code> specifically, or something like that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-17 04:28</div>
            <div class="timeline-body"><p>Typical invocation is via pre-commit, https://github.com/pypa/build/blob/e496fe6342f0e4729b69d0ea93eef529f27875a6/.pre-commit-config.yaml#L41. It probably passes all Python files explicitly. Maybe it doesnâ€™t pick up nested pyproject.toml files in that case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-17 04:30</div>
            <div class="timeline-body"><p>Will it ignore them if I exclude tests/**/pyproject.toml?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ci(check_ecosystem): add build" to "ci(check_ecosystem): add PyPa/build" by @MichaReiser on 2023-03-17 07:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-17 14:06</div>
            <div class="timeline-body"><pre><code class="language-toml">exclude = [&quot;tests/packages/test-bad-syntax/pyproject.toml&quot;]
</code></pre>
<p>Doesn't seem to get <code>ruff .</code> to ignore trying to read this pyproject.toml file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-17 16:08</div>
            <div class="timeline-body"><p>I'll take a look, we need to exclude the entire directory so that it doesn't try to find the <code>pyproject.toml</code> file for any of the surfaced files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-17 18:41</div>
            <div class="timeline-body"><p>Omitting <code>test</code> entirely works, but that's not what you want. Omitting <em>just</em> that directory doesn't seem to work. I'll take a look, we might need to fix something in Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-17 18:41</div>
            <div class="timeline-body"><p>Yeah, I tried omitting the directory and the file. Don't want to omit <code>test</code>. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-17 18:44</div>
            <div class="timeline-body"><p>Haha yeah I figured :)</p>
<p>We have to load configuration files as we traverse, because the set of exclusions can change as we go deeper into the filesystem and find the relevant configuration files for each directory. So I'm guessing we're loading that config too eagerly somewhere despite the exclusion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-18 18:49</div>
            <div class="timeline-body"><p>I expect the exclusion still needs to be added to build. I can do that in a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-18 18:51</div>
            <div class="timeline-body"><p>ğŸ¤¦ Right right, sorry. A <em>release</em> isn't necessary, but the exclusion does need to be added.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-18 20:07</div>
            <div class="timeline-body"><p>Why is it passing, actually?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-18 20:09</div>
            <div class="timeline-body"><p>The ecosystem check doesn't fail CI, but the error <em>is</em> being reported in the comment, I think:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/226135856-b6514fd6-b520-4981-a950-b59f832e9cb8.png" alt="Screen Shot 2023-03-18 at 4 08 32 PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-18 23:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-18 23:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:41 UTC
    </footer>
</body>
</html>
