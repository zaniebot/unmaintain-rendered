<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Include document specific debug info - astral-sh/ruff #16215</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Include document specific debug info</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16215">#16215</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-02-17 15:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Related https://github.com/astral-sh/ruff-vscode/pull/692.</p>
<h2>Test Plan</h2>
<p><strong>When there's no active text document:</strong></p>
<pre><code>[Info  - 10:57:03 PM] Global:
executable = /Users/dhruv/work/astral/ruff/target/debug/ruff
version = 0.9.6
position_encoding = UTF16
workspace_root_folders = [
    &quot;/Users/dhruv/playground/ruff&quot;,
]
indexed_configuration_files = [
    &quot;/Users/dhruv/playground/ruff/pyproject.toml&quot;,
    &quot;/Users/dhruv/playground/ruff/formatter/ruff.toml&quot;,
]
open_documents = 0
client_capabilities = ResolvedClientCapabilities {
    code_action_deferred_edit_resolution: true,
    apply_edit: true,
    document_changes: true,
    workspace_refresh: true,
    pull_diagnostics: true,
}

global_client_settings = ResolvedClientSettings {
    fix_all: true,
    organize_imports: true,
    lint_enable: true,
    disable_rule_comment_enable: true,
    fix_violation_enable: true,
    show_syntax_errors: true,
    editor_settings: ResolvedEditorSettings {
        configuration: None,
        lint_preview: None,
        format_preview: None,
        select: None,
        extend_select: None,
        ignore: None,
        exclude: None,
        line_length: None,
        configuration_preference: EditorFirst,
    },
}
</code></pre>
<p><strong>When there's an active text document that's been passed as param:</strong></p>
<pre><code>[Info  - 10:53:33 PM] Global:
executable = /Users/dhruv/work/astral/ruff/target/debug/ruff
version = 0.9.6
position_encoding = UTF16
workspace_root_folders = [
    &quot;/Users/dhruv/playground/ruff&quot;,
]
indexed_configuration_files = [
    &quot;/Users/dhruv/playground/ruff/pyproject.toml&quot;,
    &quot;/Users/dhruv/playground/ruff/formatter/ruff.toml&quot;,
]
open_documents = 1
client_capabilities = ResolvedClientCapabilities {
    code_action_deferred_edit_resolution: true,
    apply_edit: true,
    document_changes: true,
    workspace_refresh: true,
    pull_diagnostics: true,
}

Document:
uri = file:///Users/dhruv/playground/ruff/lsp/play.py
kind = Text
version = 1
client_settings = ResolvedClientSettings {
    fix_all: true,
    organize_imports: true,
    lint_enable: true,
    disable_rule_comment_enable: true,
    fix_violation_enable: true,
    show_syntax_errors: true,
    editor_settings: ResolvedEditorSettings {
        configuration: None,
        lint_preview: None,
        format_preview: None,
        select: None,
        extend_select: None,
        ignore: None,
        exclude: None,
        line_length: None,
        configuration_preference: EditorFirst,
    },
}
config_path = Some(&quot;/Users/dhruv/playground/ruff/pyproject.toml&quot;)

...
</code></pre>
<p>Replace <code>...</code> at the end with the output of <code>ruff check --show-settings path.py</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @dhruvmanila on 2025-02-17 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-17 17:36</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-02-18 04:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:48 on 2025-02-18 04:42</div>
            <div class="timeline-body"><p>Currently, we only look at the first argument but a potential new VS Code command could be to look at all opened documents which would require passing multiple arguments. But, I'm going to leave this for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dhruvmanila on 2025-02-18 04:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2025-02-18 04:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:25 on 2025-02-18 07:46</div>
            <div class="timeline-body"><p>Could we document the <code>uri</code> parameter? The name doesn't give any information (nor the struct name) what the uri points to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:182 on 2025-02-18 07:46</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            &quot;Active Document:
</code></pre>
<p>Or <code>Open Document</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:199 on 2025-02-18 07:47</div>
            <div class="timeline-body"><p>Nit: You may want to store <code>query</code> in a temporary variable to shorten some of those calls.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_server/src/session.rs</code>:171 on 2025-02-18 07:48</div>
            <div class="timeline-body"><p>Nit: I think I prefer <code>open_documents_len</code> to make it explicit that this doesn't return the open documents itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-18 07:48</div>
            <div class="timeline-body"><p>This is great and i also forgot about it. At least, it never came to my mind when asking users for debugging information which is a shame.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-02-18 08:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:25 on 2025-02-18 08:48</div>
            <div class="timeline-body"><p>I'll replace <code>DebugCommandArgument</code> with <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocumentIdentifier"><code>TextDocumentIdentifier</code></a> because that's what we want here.</p>
<p>Edit: wait, I'm thinking a bit about this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-02-18 09:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:25 on 2025-02-18 09:01</div>
            <div class="timeline-body"><p>Looking at how <code>rust-analyzer</code> accepts parameters, it seems useful to have a consistent structure similar to how requests would accept params, so this could be updated to:</p>
<pre><code>{ textDocument?: TextDocumentIdentifier }
</code></pre>
<p>For example:</p>
<pre><code>{
    textDocument: {
        uri: &quot;file:///Users/dhruv/dotfiles/config/nvim/lua/dm/lsp/extensions/rust_analyzer.lua&quot;
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-02-18 09:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:182 on 2025-02-18 09:04</div>
            <div class="timeline-body"><p>It could possibly be any document, it depends on what the client sends us. In case of our VS Code extension, we send the active document but, for example, I could send any other document that I would want the information for in Neovim :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-02-18 10:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-02-18 10:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-18 10:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:10:08 UTC
    </footer>
</body>
</html>
