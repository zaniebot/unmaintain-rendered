<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flake8_to_ruff: support `isort` options - astral-sh/ruff #2082</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>flake8_to_ruff: support <code>isort</code> options</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2082">#2082</a>
        opened by <a href="https://github.com/shannonrothe">@shannonrothe</a>
        on 2023-01-22 04:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a></div>
            <div class="timeline-body"><p>Hey @charliermarsh üëãüèº I've been learning Rust for a little bit but haven't contributed any PRs until this one, so excuse me if it's a little rough. I mostly followed what was already in place for picking up <code>Black</code> options in the <code>flake8_to_ruff</code> converter.</p>
<p>For the <code>isort</code> options, I've chosen to support only <code>src_paths</code> for now as a simple starting point (this could be extended upon).</p>
<p>Admittedly, I'm not super familiar with the Python ecosystem and the associated tools (isort/Black), so let me know if I'm missing anything obvious üëåüèº</p>
<p>See: https://github.com/charliermarsh/ruff/issues/1749</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-22 04:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/flake8_to_ruff/isort.rs</code>:8 on 2023-01-22 04:58</div>
            <div class="timeline-body"><p>left over comment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-22 04:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/flake8_to_ruff/isort.rs</code>:11 on 2023-01-22 04:59</div>
            <div class="timeline-body"><p>I think it would make sense to add a doc comment (a comment starting with <code>///</code>) linking the isort config documentation, so e.g.</p>
<pre><code>/// The [isort configuration](https://pycqa.github.io/isort/docs/configuration/config_files.html).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:03</div>
            <div class="timeline-body"><p>Would you prefer if this was combined with the <code>black</code> argument above as a single argument? Maybe something like a <code>(Option&lt;&amp;Black&gt;, Option&lt;&amp;ISort&gt;)</code> tuple? Or maybe even a new struct:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/isort.rs</code>:8 on 2023-01-22 05:04</div>
            <div class="timeline-body"><p>Yep, copy-paste from <code>black.rs</code> and forgot the remove üëçüèº</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/isort.rs</code>:11 on 2023-01-22 05:10</div>
            <div class="timeline-body"><p>It's a nit but I think this can be <code>Isort</code> (rather than <code>ISort</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:11</div>
            <div class="timeline-body"><p>I think what you have here is totally fine! A struct would also be reasonable, but honestly this is simple and clear so not sure that'd even be preferable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-22 05:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:11</div>
            <div class="timeline-body"><p>Using tuples like that isn't really idiomatic in Rust. Introducing a struct with named fields would however probably be a good idea if we assume that more such config structs will be introduced in the future ... maybe <code>struct ToolConfigs { black: Option&lt;&amp;Black&gt;, isort: Option&lt;&amp;ISort&gt; }</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:11</div>
            <div class="timeline-body"><p>Thanks for getting involved!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:11</div>
            <div class="timeline-body"><p>Alternatively, what about a new struct to hold &quot;external&quot; options:</p>
<pre><code class="language-rust">pub struct ExternalOptions {
  pub black: Option&lt;Black&gt;,
  pub isort: Option&lt;ISort&gt;,
}
</code></pre>
<p>Then <code>convert</code> could take <code>Option&lt;ExternalOptions&gt;</code> instead of <code>Option&lt;&amp;Black&gt;</code> and it would be easy to extend upon for future &quot;external&quot; tools.</p>
<p><strong>Edit</strong>: beat me to it üôà happy to go with either option, what would you prefer @charliermarsh?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:13</div>
            <div class="timeline-body"><p>Yeah what @not-my-profile suggested is good too. Either way.</p>
<p>(I'm not sure what additional configuration options we'd respect in the future, though it's plausible that e.g. we could grab the target Python version.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:17</div>
            <div class="timeline-body"><p>Great, pushed code with <code>ToolConfigs</code> option here: https://github.com/charliermarsh/ruff/pull/2082/commits/37a87df1ca5d96122db130509d34501a97f04b43</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-22 05:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:17</div>
            <div class="timeline-body"><p>(<code>ExternalConfig</code> is probably a better name than <code>ToolConfigs</code>) ... I wouldn't name it <code>ExternalOptions</code> since it contains the <code>Option</code> type which could be a bit confusing^^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/tool_configs.rs</code>:9 on 2023-01-22 05:17</div>
            <div class="timeline-body"><p>Does it matter that the struct takes ownership here of <code>Black</code> and <code>Isort</code> respectively? Ideally these could be references but I had a hard time making that play nice in <code>parse_tool_configs</code> below üëáüèº</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/tool_configs.rs</code>:15 on 2023-01-22 05:18</div>
            <div class="timeline-body"><p>Should these both take <code>path.as_ref()</code>? (Does using <code>path</code> for both, without <code>.as_ref()</code>, lead to a borrowing error?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 05:19</div>
            <div class="timeline-body"><p>For posterity: relevant issue is #1749.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/converter.rs</code>:28 on 2023-01-22 05:19</div>
            <div class="timeline-body"><p>Renamed here: https://github.com/charliermarsh/ruff/pull/2082/commits/aa15c6ad0361769938ae536cad5fb584a2054630</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on 2023-01-22 05:20</div>
            <div class="timeline-body"><blockquote>
<p>For posterity: relevant issue is #1749.</p>
</blockquote>
<p>Added to description üëåüèº</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/tool_configs.rs</code>:15 on 2023-01-22 05:21</div>
            <div class="timeline-body"><p>Potentially yes, I'm guessing if more external configurations were added here, we'd need to <code>.as_ref()</code> all except the last.</p>
<p>Without <code>.as_ref()</code> I get the following in <code>parse_external_config</code>:</p>
<img width="833" alt="image" src="https://user-images.githubusercontent.com/803013/213901866-abbe98ef-7d43-450f-96ca-0c38b75e6e3e.png">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/tool_configs.rs</code>:9 on 2023-01-22 05:22</div>
            <div class="timeline-body"><p>Not a big deal. You could probably introduce a lifetime to do something like:</p>
<pre><code class="language-rs">pub struct ToolConfigs&lt;'a&gt; {
    pub black: Option&lt;&amp;'a Black&gt;,
    pub isort: Option&lt;&amp;'a Isort&gt;,
}
</code></pre>
<p>But then you'd have to ensure that the values outlive this struct. So you'd need to parse the values at a level above <code>parse_tool_configs</code> (like, in <code>main.rs</code>), then pass them to <code>ToolConfigs</code> as references.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/tool_configs.rs</code>:9 on 2023-01-22 05:38</div>
            <div class="timeline-body"><p>Added lifetime in https://github.com/charliermarsh/ruff/pull/2082/commits/8c8c497b97b7eb87a8afe67d9d3876ae1559f6d9. Happy to revert that commit if the previous approach is preferable too üëçüèº</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-22 05:43</div>
            <div class="timeline-body"><p>I am not sure if this PR should close #1749 given that isort also has other settings not implemented by this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on 2023-01-22 05:45</div>
            <div class="timeline-body"><blockquote>
<p>I am not sure if this PR should close #1749 given that isort also has other settings not implemented by this PR.</p>
</blockquote>
<p>Fair enough, happy to remove from the description.</p>
<p>Another question - we could probably build off this PR to alleviate https://github.com/charliermarsh/ruff/issues/1567 right? Is there a counterpart option in Ruff for the <code>Line-Length</code> isort option?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/isort.rs</code>:23 on 2023-01-22 05:46</div>
            <div class="timeline-body"><p>Should we consolidate these with the same structs defined in <code>black.rs</code> too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 05:47</div>
            <div class="timeline-body"><p>Ah yeah, sorry, it shouldn't close #1749 -- it should just reference it, like &quot;See: #1749&quot; or similar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/isort.rs</code>:23 on 2023-01-22 05:48</div>
            <div class="timeline-body"><p>Yeah we might as well. We can have a single <code>Pyproject</code> and <code>Tools</code>, with <code>Isort</code> and <code>Black</code> structs defined in their respective files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 05:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/isort.rs</code>:23 on 2023-01-22 05:50</div>
            <div class="timeline-body"><p>Consolidated here: https://github.com/charliermarsh/ruff/pull/2082/commits/0780fa0f4c66a6fc5fbb0bc0f1fd2f474db2273f</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 05:52</div>
            <div class="timeline-body"><blockquote>
<p>Another question - we could probably build off this PR to alleviate https://github.com/charliermarsh/ruff/issues/1567 right? Is there a counterpart option in Ruff for the Line-Length isort option?</p>
</blockquote>
<p>It's actually a bit different -- that issue references a setting that tells isort to sort the imports by their string length. isort <em>does</em> have a <a href="https://pycqa.github.io/isort/docs/configuration/options.html#line-length">line-length</a> setting, and we <em>should</em> extract that and pass it along to Ruff (we have a top-level option for that), but it wouldn't close that issue :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 05:53</div>
            <div class="timeline-body"><p>Relatedly, everything in <a href="https://github.com/charliermarsh/ruff#isort">this section</a> of the configuration options can be extracted from the <code>isort</code> section in a <code>pyproject.toml</code>, like you're doing here for <code>src</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 05:56</div>
            <div class="timeline-body"><p>I think we should have one <code>parse</code> function that returns <code>ExternalConfig</code>. Right now, we're parsing the TOML twice into <code>Pyproject</code>, then extracting <code>tool.black</code> and <code>tool.isort</code> respectively, then merging them back into a single struct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 05:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 05:57</div>
            <div class="timeline-body"><p>(Or, one parse function that returns <code>Pyproject</code> to <code>main.rs</code>, then create <code>ExternalConfig</code> from <code>Pyproject</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 06:23</div>
            <div class="timeline-body"><p>Ah yep that makes sense.</p>
<p><code>Tools</code> has to own <code>black</code>/<code>isort</code> presumably for <code>serde</code> (de)serialization. I'm trying to do something like:</p>
<pre><code class="language-rust">pub fn parse&lt;'a, P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; Result&lt;ExternalConfig&lt;'a&gt;&gt; {
    let contents = std::fs::read_to_string(path)?;
    let pyproject = toml_edit::easy::from_str::&lt;Pyproject&gt;(&amp;contents)?;
    Ok(pyproject
        .tool
        .map(|tool| ExternalConfig {
            black: tool.black.as_ref(),
            isort: tool.isort.as_ref(),
        })
        .unwrap_or_default())
}
</code></pre>
<p>but the <code>tool.{black,isort}.as_ref()</code> lines complain because we're referencing <code>tool.{black,isort}</code> which is not owned by the current function. Any ideas? :)</p>
<p>Or, alternatively, if <code>flake8_to_ruff::parse</code> returns <code>Pyproject</code> and we try and produce an <code>ExternalConfig</code> from <code>main.rs</code>:</p>
<pre><code class="language-rust">let pyproject = cli.pyproject.map(flake8_to_ruff::parse).transpose()?;
let external_config = pyproject
    .map(|pyproject| {
        pyproject
            .tool
            .map(|tool| ExternalConfig {
                // these lines aren't happy
                black: tool.black.as_ref(),
                isort: tool.isort.as_ref(),
            })
            .unwrap_or_default()
    })
    .unwrap_or_default();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 06:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-22 06:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 06:39</div>
            <div class="timeline-body"><p>The signature doesn't make sense:</p>
<pre><code class="language-rs">pub fn parse&lt;'a, P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; Result&lt;ExternalConfig&lt;'a&gt;&gt; {
</code></pre>
<p>The liftetime in the return type has to come from somewhere ... you can either change the input to <code>text: &amp;'a str</code> or make the return type owned.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 06:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 06:52</div>
            <div class="timeline-body"><p>Sorry @not-my-profile, I've changed <code>flake8_to_ruff::parse</code> to return <code>Pyproject</code> instead, which circumvents the above issue.</p>
<p>The current issue is mapping out of <code>Tools</code> (where <code>black</code>/<code>isort</code> are owned) into <code>ExternalConfig</code> (where <code>black</code>/<code>isort</code> are references).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 07:00</div>
            <div class="timeline-body"><p>This seems to work, but is there a preferred (more idiomatic) way?</p>
<pre><code class="language-rust">let mut external_config = ExternalConfig::default();
let pyproject = cli.pyproject.map(flake8_to_ruff::parse).transpose()?;
if let Some(pyproject) = &amp;pyproject {
    if let Some(tool) = &amp;pyproject.tool {
        external_config = ExternalConfig {
            black: tool.black.as_ref(),
            isort: tool.isort.as_ref(),
        };
    }
}
</code></pre>
<p><strong>Edit</strong>: maybe this?</p>
<pre><code class="language-rust">let external_config = pyproject
    .as_ref()
    .map(|pyproject| {
        pyproject
            .tool
            .as_ref()
            .map(|tool| ExternalConfig {
                black: tool.black.as_ref(),
                isort: tool.isort.as_ref(),
            })
            .unwrap_or_default()
    })
    .unwrap_or_default();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 07:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shannonrothe">@shannonrothe</a> reviewed on 2023-01-22 07:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/shannonrothe">@shannonrothe</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 07:04</div>
            <div class="timeline-body"><p>Implemented suggestions here @charliermarsh: https://github.com/charliermarsh/ruff/pull/2082/commits/4127eb451877e3a687b4c74103dce99f11ceca69 üëçüèº</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 16:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 16:51</div>
            <div class="timeline-body"><p>Awesome -- will review in a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-22 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-22 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/flake8_to_ruff/black.rs</code>:20 on 2023-01-22 18:18</div>
            <div class="timeline-body"><p>Thank you! I tweaked it a little bit to remove some levels of nesting by using <code>.and_then</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-22 18:18</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:42 UTC
    </footer>
</body>
</html>
