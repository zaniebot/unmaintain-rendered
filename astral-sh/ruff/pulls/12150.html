<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove use of deprecated `E999` from the `fuzz-parser` script - astral-sh/ruff #12150</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove use of deprecated <code>E999</code> from the <code>fuzz-parser</code> script</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12150">#12150</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-07-02 13:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Using the <code>E999</code> code is now deprecated, so we shouldn't use it in the <code>fuzz-parser</code> script anymore. I <em>think</em> the most idiomatic way of asking Ruff to &quot;please detect syntax errors, but do not report any other checks&quot; is now <code>--config='lint.select=[]'</code>.</p>
<p>I also bumped the requirement pins in the <code>requirements.txt</code> file, as they hadn't been updated in a while.</p>
<h2>Test Plan</h2>
<p>In a virtual environment with the requirements installed, I ran <code>python scripts/fuzz-parser/fuzz.py $(shuf -i 0-100000 -n 1000)</code> to verify that the script still succeeded with these changes (it did). I then deliberately broke the parser with the below diff, and reran the command, to check that the fuzzer still reports when Ruff fails to parse valid syntax (it does):</p>
<pre><code class="language-diff">diff --git a/crates/ruff_python_parser/src/lexer.rs b/crates/ruff_python_parser/src/lexer.rs
index d407ab357..2996b657a 100644
--- a/crates/ruff_python_parser/src/lexer.rs
+++ b/crates/ruff_python_parser/src/lexer.rs
@@ -364,18 +364,14 @@ impl&lt;'src&gt; Lexer&lt;'src&gt; {
             '\'' | '&quot;' =&gt; self.lex_string(c),
             '=' =&gt; {
                 if self.cursor.eat_char('=') {
-                    TokenKind::EqEqual
+                    TokenKind::Unknown
                 } else {
                     self.state = State::AfterEqual;
-                    return TokenKind::Equal;
+                    return TokenKind::Unknown;
                 }
             }
             '+' =&gt; {
-                if self.cursor.eat_char('=') {
-                    TokenKind::PlusEqual
-                } else {
-                    TokenKind::Plus
-                }
+                TokenKind::Unknown
             }
             '*' =&gt; {
                 if self.cursor.eat_char('=') {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by @AlexWaygood on 2024-07-02 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @AlexWaygood on 2024-07-02 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-07-02 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-02 13:15</div>
            <div class="timeline-body"><p>fun fact: my initial attempt to break the parser (not the diff I posted above) did indeed break the parser, but the outcome was that the script started using 100% of available memory on my MacBook, meaning everything completely froze and I had to force restart</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-07-02 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-07-02 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-02 13:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:05:09 UTC
    </footer>
</body>
</html>
