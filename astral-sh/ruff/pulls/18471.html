<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combine lint and syntax error handling - astral-sh/ruff #18471</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Combine lint and syntax error handling</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18471">#18471</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-06-04 20:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a spin-off from https://github.com/astral-sh/ruff/pull/18447#discussion_r2125844669 to avoid using <code>Message::noqa_code</code> to differentiate between lints and syntax errors. I went through all of the calls on <code>main</code> and on the branch from #18447, and the instance in <code>ruff_server</code> noted in the linked comment was actually the primary place where this was being done. Other calls to <code>noqa_code</code> are typically some variation of <code>message.noqa_code().map_or(String::new, format!(...))</code>, with the major exception of the gitlab output format:</p>
<p>https://github.com/astral-sh/ruff/blob/a120610b5b01a9e7bb91740a23f6c2b5bbcd4b5f/crates/ruff_linter/src/message/gitlab.rs#L93-L105</p>
<p>which obviously assumes that <code>None</code> means syntax error. A simple fix here would be to use <code>message.name()</code> for <code>check_name</code> instead of the noqa code, but I'm not sure how breaking that would be. This could just be:</p>
<pre><code class="language-rust"> let description = message.body();
 let description = description.strip_prefix(&quot;SyntaxError: &quot;).unwrap_or(description).to_string();
 let check_name = message.name();
</code></pre>
<p>In that case. This sounds reasonable based on the <a href="https://docs.gitlab.com/ci/testing/code_quality/#code-quality-report-format">Code Quality report format</a> docs:</p>
<blockquote>
<p>| Name | Type | Description|
|-----|-----|----|
|<code>check_name</code> | String | A unique name representing the check, or rule, associated with this violation. |</p>
</blockquote>
<h2>Test Plan</h2>
<p>Existing tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ntBre on 2025-06-04 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @ntBre on 2025-06-04 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @ntBre on 2025-06-04 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @ntBre on 2025-06-04 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-06-04 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-04 20:39</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/lint.rs</code>:267 on 2025-06-05 04:55</div>
            <div class="timeline-body"><p>nit: we could short-circuit if <code>code</code> is <code>None</code> and avoid generating the edits although I think currently it's only the syntax errors that doesn't have code and those doesn't have fixes, so maybe this isn't that useful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-06-05 04:58</div>
            <div class="timeline-body"><p>This looks pretty straightforward!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-06-05 06:11</div>
            <div class="timeline-body"><p>Sweet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-06-05 12:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_server/src/lint.rs</code>:267 on 2025-06-05 12:45</div>
            <div class="timeline-body"><p>Yeah, I think the <code>fix.is_some() || noqa_edit.is_some()</code> condition should virtually guarantee this is never <code>None</code>, but I can move it to the top of the closure just in case. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-06-05 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-06-05 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-05 12:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:08 UTC
    </footer>
</body>
</html>
