<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] don't remove negations when simplifying constrained typevars - astral-sh/ruff #17189</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] don&#x27;t remove negations when simplifying constrained typevars</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17189">#17189</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-04-03 23:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>For two non-disjoint types <code>P</code> and <code>Q</code>, the simplification of <code>(P | Q) &amp; ~Q</code> is not <code>P</code>, but <code>P &amp; ~Q</code>. In other words, the non-empty set <code>P &amp; Q</code> is also excluded from the type.</p>
<p>The same applies for a constrained typevar <code>[T: (P, Q)]</code>: <code>T &amp; ~Q</code> should simplify to <code>P &amp; ~Q</code>, not just <code>P</code>.</p>
<p>Implementing this is actually purely a matter of removing code from the constrained typevar simplification logic; we just need to not bother removing the negations. If the negations are actually redundant (because the constraint types are disjoint), normal intersection simplification will already eliminate them (as shown in the added test.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/carljm">@carljm</a> on 2025-04-03 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/carljm">@carljm</a> on 2025-04-03 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/carljm">@carljm</a> on 2025-04-03 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-03 23:17</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> approved on 2025-04-03 23:27</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/carljm">@carljm</a> on 2025-04-03 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-04-03 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-03 23:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:57 UTC
    </footer>
</body>
</html>
