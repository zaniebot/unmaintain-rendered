<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pyflakes`] Add fix safety section (`F841`) - astral-sh/ruff #17410</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pyflakes</code>] Add fix safety section (<code>F841</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17410">#17410</a>
        opened by <a href="https://github.com/Kalmaegi">@Kalmaegi</a>
        on 2025-04-15 15:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-15 15:59</div>
            <div class="timeline-body"><p>add fix safety section to docs for #15584, I'm new to ruff and not sure if the content of this PR is correct, but I hope it can be helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @AlexWaygood on 2025-04-15 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-15 16:17</div>
            <div class="timeline-body"><p>A small question: Do we need to list all possible cases that may lead to modifications in the comments, and ensure that there are test cases for all of them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_variable.rs</code>:47 on 2025-04-15 18:50</div>
            <div class="timeline-body"><p>I think we can leave this out. This is pretty well covered by our general docs on <a href="https://docs.astral.sh/ruff/linter/#fix-safety">fix safety</a>.</p>
<pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_variable.rs</code>:45 on 2025-04-15 18:53</div>
            <div class="timeline-body"><p>I'm not sure if this second point is entirely true. We at least have a heuristic for preserving the right-hand side:</p>
<p>https://github.com/astral-sh/ruff/blob/431f10e7885a1a9057fb40f67d4df73c28650e32/crates/ruff_linter/src/rules/pyflakes/rules/unused_variable.rs#L209-L212</p>
<p>Are there test cases showing a false positive with a function? If not, maybe we could find another example here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-04-15 19:08</div>
            <div class="timeline-body"><p>Thanks for working on this!</p>
<p>This rule is a little tricky since it's always unsafe and there's not much commentary in the file. Did you try finding the original PR adding the rule? That could be a good place to find more discussion. I tried a bit and didn't find it, though.</p>
<p>If we can't find any further discussion, I think what you have is fine, despite my comment on the side effects point below.</p>
<blockquote>
<p>A small question: Do we need to list all possible cases that may lead to modifications in the comments, and ensure that there are test cases for all of them?</p>
</blockquote>
<p>I think just a couple of reasons for the unsafety is good, like you have here. I think I'd also lean away from modifying code or tests in these PRs and just add docs for what's there now. On the other hand, if you add tests that help you determine when the fix is safe or not, we might as well include them! (That may be more applicable for rules that are <em>sometimes</em> safe, unlike this one)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-04-16 02:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_variable.rs</code>:45 on 2025-04-16 02:14</div>
            <div class="timeline-body"><p>You're absolutely right, I got some details wrong. Thank you very much for your help! Next, I'll check the logic of the other rules and conduct some thorough testing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-16 09:07</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for working on this!</p>
<p>This rule is a little tricky since it's always unsafe and there's not much commentary in the file. Did you try finding the original PR adding the rule? That could be a good place to find more discussion. I tried a bit and didn't find it, though.</p>
<p>If we can't find any further discussion, I think what you have is fine, despite my comment on the side effects point below.</p>
<blockquote>
<p>A small question: Do we need to list all possible cases that may lead to modifications in the comments, and ensure that there are test cases for all of them?</p>
</blockquote>
<p>I think just a couple of reasons for the unsafety is good, like you have here. I think I'd also lean away from modifying code or tests in these PRs and just add docs for what's there now. On the other hand, if you add tests that help you determine when the fix is safe or not, we might as well include them! (That may be more applicable for rules that are <em>sometimes</em> safe, unlike this one)</p>
</blockquote>
<p>The only potential insecurity of this rule seems to be that it deletes comments (if any) when removing content. I've reviewed several other rules, and they all appear to behave similarly. For such cases, do we just need to list the unique associations related to the comments?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_variable.rs</code>:44 on 2025-04-16 17:21</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// This rule's fix is marked as unsafe because removing an unused variable assignment may
/// delete comments that are attached to the assignment.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-04-16 17:22</div>
            <div class="timeline-body"><p>Thank you! One more tiny stylistic nit. I think the list format might be good for rules with many possible unsafe conditions, but we typically keep these as regular paragraphs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-16 17:30</div>
            <div class="timeline-body"><blockquote>
<p>The only potential insecurity of this rule seems to be that it deletes comments (if any) when removing content. I've reviewed several other rules, and they all appear to behave similarly. For such cases, do we just need to list the unique associations related to the comments?</p>
</blockquote>
<p>I think what you have here is great. For some other rules, you could list a couple of examples of places where comments could be deleted if you want, but most existing rules I found just say that comments could be deleted without more explanation, so that's fine to do too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-17 00:56</div>
            <div class="timeline-body"><p>@ntBre Thank you very much for your help! It has been incredibly helpful in deepening my understanding of these matters. Initially, I tried to identify all possible points of impact, but apart from the deletion of comments, I didn’t find any others—the same goes for the other files. Moving forward, I will strive to conduct more thorough checks and carefully review the other rules. I believe this is a good start. Once again, I truly appreciate your efforts!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-17 13:55</div>
            <div class="timeline-body"><p>No problem, thanks for working on this! I'll give your other PRs a look soon.</p>
<p>I pushed one small commit just updating the test snapshot that shows the rule documentation. Then I'll merge right after the checks finish!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-17 13:56</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "add fix safety section to docs" to "[`pyflakes`] Add fix safety section (`F841`)" by @ntBre on 2025-04-17 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-04-17 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-04-17 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-17 15:07</div>
            <div class="timeline-body"><blockquote>
<p>No problem, thanks for working on this! I'll give your other PRs a look soon.</p>
<p>I pushed one small commit just updating the test snapshot that shows the rule documentation. Then I'll merge right after the checks finish!</p>
</blockquote>
<p>Thank you for your help! I'm not sure if I checked everything thoroughly, but most of them don't have side effects.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:33:28 UTC
    </footer>
</body>
</html>
