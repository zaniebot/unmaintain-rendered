<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix missing newline before first diagnostic - astral-sh/ruff #21058</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix missing newline before first diagnostic</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21058">#21058</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-10-24 08:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 08:21</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Copy pasting ty's output from the CLI into GitHub resulted in a missing newline after <code>Checked 9/9 files</code> and the first diagnostic
when they are rendered. This is a known issue in indicatif (https://github.com/console-rs/indicatif/issues/695).</p>
<p>The easiest fix is to clear the progress bar on completion, which I prefer anyways because it reduces the output produced by ty.</p>
<p>Fixes https://github.com/astral-sh/ty/issues/1424</p>
<h2>Test Plan</h2>
<pre><code>cargo run --manifest-path ../ruff/Cargo.toml --bin ty -- check 444/
   Compiling ty v0.0.0 (/Users/micha/astral/ruff/crates/ty)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 6.54s
     Running `/Users/micha/astral/ruff/target/debug/ty check 444/`
error[unresolved-import]: Cannot resolve imported module `binary`
 --&gt; 444/lib.py:1:6
  |
1 | from binary import *
  |      ^^^^^^
2 | from py3compat import *
  |
info: Searched in the following paths during module resolution:
info:   1. /Users/micha/astral/test (first-party code)
info:   2. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   3. /Users/micha/astral/test/.venv/lib/python3.10/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

error[unresolved-import]: Cannot resolve imported module `py3compat`
 --&gt; 444/lib.py:2:6
  |
1 | from binary import *
2 | from py3compat import *
  |      ^^^^^^^^^
  |
info: Searched in the following paths during module resolution:
info:   1. /Users/micha/astral/test (first-party code)
info:   2. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   3. /Users/micha/astral/test/.venv/lib/python3.10/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

error[unresolved-import]: Cannot resolve imported module `construct`
 --&gt; 444/mre.py:3:6
  |
1 | from io import BytesIO
2 |
3 | from construct import Float32l
  |      ^^^^^^^^^
  |
info: Searched in the following paths during module resolution:
info:   1. /Users/micha/astral/test (first-party code)
info:   2. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   3. /Users/micha/astral/test/.venv/lib/python3.10/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

Found 3 diagnostics
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ibraheemdev by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @MichaReiser on 2025-10-24 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-24 08:23</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-24 08:25</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Fix missing newline after progress bar" to "[ty] Fix missing newline before first diagnostic" by @MichaReiser on 2025-10-24 08:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> approved on 2025-10-24 15:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-10-24 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-10-24 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-24 15:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:29:08 UTC
    </footer>
</body>
</html>
