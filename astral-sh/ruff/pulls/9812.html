<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New lint rule: flake8_cognitive_complexity function_is_too_cognitive_complex - astral-sh/ruff #9812</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>New lint rule: flake8_cognitive_complexity function_is_too_cognitive_complex</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9812">#9812</a>
        opened by <a href="https://github.com/Anders-Steen">@Anders-Steen</a>
        on 2024-02-04 14:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Anders-Steen">@Anders-Steen</a></div>
            <div class="timeline-body">

Summary
<p>Cognitive complexity is a more modern way of calculating the complexity of a code. We do not care how hard it is to test, but rather how hard it is to read and understand.</p>
<p>Created a new lint rule. Took a lot of inspiration from mccabe rule (aka cyclomatic complexity).</p>
<p>fixes #2418</p>


Test Plan
<p>This was tested with a python file <a>crates/ruff_linter/resources/test/fixtures/flake8_cognitive_complexity/CCR001.py</a> as well as unit-tests in <a>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</a>.</p>
Please help
<p>I tried to follow <a href="https://docs.astral.sh/ruff/contributing/">contributing guide</a> but ran into a problem on <em>creating a new release, step 2</em>. <code>&quot;Could not resolve to a Repository with the name &#x27;AndersSteenNilsen/ruff.git&#x27;.</code>. Maybe I shouldn&#x27;t have forked the repo?</p>
Further work
<p>This linting rule is not perfectly complete, it does not test for nested functions and recursion. But I believe those are edge-cases, also nested functions should not count for decorators.
Did not test and implement bitwise operators, but focused on boolean operators.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-04 15:26</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>encountered linter errors</strong>. (no lint changes; 1 project error)</p>
<a href="https://github.com/sphinx-doc/sphinx">sphinx-doc/sphinx</a> (error)
<p>

<pre><code>ruff failed
  Cause: Selection of unstable rules without the `--preview` flag is not allowed. Enable preview or remove selection of:
	- FURB113
	- FURB131
	- FURB132
</code></pre>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1612 -0 violations, +0 -0 fixes in 3 projects; 40 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+934 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/auth/backend/kerberos_auth.py#L138">airflow/api/auth/backend/kerberos_auth.py:138:5:</a> CCR001 `requires_authentication` is too cognitive complex (9 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/auth/backend/kerberos_auth.py#L150">airflow/api/auth/backend/kerberos_auth.py:150:9:</a> CCR001 `decorated` is too cognitive complex (8 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/delete_dag.py#L41">airflow/api/common/delete_dag.py:41:5:</a> CCR001 `delete_dag` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/mark_tasks.py#L209">airflow/api/common/mark_tasks.py:209:5:</a> CCR001 `_iter_subdag_run_ids` is too cognitive complex (15 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/mark_tasks.py#L279">airflow/api/common/mark_tasks.py:279:5:</a> CCR001 `find_task_relatives` is too cognitive complex (14 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/mark_tasks.py#L378">airflow/api/common/mark_tasks.py:378:5:</a> CCR001 `set_dag_run_state_to_success` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/mark_tasks.py#L432">airflow/api/common/mark_tasks.py:432:5:</a> CCR001 `set_dag_run_state_to_failed` is too cognitive complex (15 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/mark_tasks.py#L522">airflow/api/common/mark_tasks.py:522:5:</a> CCR001 `__set_dag_run_state_to_running_or_queued` is too cognitive complex (9 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/mark_tasks.py#L83">airflow/api/common/mark_tasks.py:83:5:</a> CCR001 `set_state` is too cognitive complex (19 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api/common/trigger_dag.py#L34">airflow/api/common/trigger_dag.py:34:5:</a> CCR001 `_trigger_dag` is too cognitive complex (12 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/config_endpoint.py#L106">airflow/api_connexion/endpoints/config_endpoint.py:106:5:</a> CCR001 `get_value` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/config_endpoint.py#L69">airflow/api_connexion/endpoints/config_endpoint.py:69:5:</a> CCR001 `get_config` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/dag_run_endpoint.py#L140">airflow/api_connexion/endpoints/dag_run_endpoint.py:140:5:</a> CCR001 `_fetch_dag_runs` is too cognitive complex (8 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/log_endpoint.py#L45">airflow/api_connexion/endpoints/log_endpoint.py:45:5:</a> CCR001 `get_log` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/pool_endpoint.py#L86">airflow/api_connexion/endpoints/pool_endpoint.py:86:5:</a> CCR001 `patch_pool` is too cognitive complex (12 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/task_instance_endpoint.py#L157">airflow/api_connexion/endpoints/task_instance_endpoint.py:157:5:</a> CCR001 `get_mapped_task_instances` is too cognitive complex (12 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/task_instance_endpoint.py#L444">airflow/api_connexion/endpoints/task_instance_endpoint.py:444:5:</a> CCR001 `post_clear_task_instances` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/endpoints/xcom_endpoint.py#L83">airflow/api_connexion/endpoints/xcom_endpoint.py:83:5:</a> CCR001 `get_xcom_entry` is too cognitive complex (8 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/api_connexion/schemas/task_instance_schema.py#L140">airflow/api_connexion/schemas/task_instance_schema.py:140:9:</a> CCR001 `validate_form` is too cognitive complex (12 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/auth/managers/base_auth_manager.py#L377">airflow/auth/managers/base_auth_manager.py:377:9:</a> CCR001 `get_permitted_menu_items` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/celery_command.py#L119">airflow/cli/commands/celery_command.py:119:5:</a> CCR001 `worker` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/cheat_sheet_command.py#L35">airflow/cli/commands/cheat_sheet_command.py:35:5:</a> CCR001 `display_commands_index` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/cheat_sheet_command.py#L38">airflow/cli/commands/cheat_sheet_command.py:38:9:</a> CCR001 `display_recursive` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/connection_command.py#L114">airflow/cli/commands/connection_command.py:114:5:</a> CCR001 `_format_connections` is too cognitive complex (9 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/connection_command.py#L160">airflow/cli/commands/connection_command.py:160:5:</a> CCR001 `connections_export` is too cognitive complex (15 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/connection_command.py#L206">airflow/cli/commands/connection_command.py:206:5:</a> CCR001 `connections_add` is too cognitive complex (33 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/connection_command.py#L322">airflow/cli/commands/connection_command.py:322:5:</a> CCR001 `_import_helper` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/apache/airflow/blob/46470aba68e5ebeee24a03dc22d012a50ee287ad/airflow/cli/commands/dag_command.py#L558">airflow/cli/commands/dag_command.py:558:5:</a> CCR001 `dag_test` is too cognitive complex (11 &gt; 7)
... 906 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+128 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/server/app/clustering/main.py#L26">examples/server/app/clustering/main.py:26:5:</a> CCR001 `clustering` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/server/app/crossfilter/main.py#L35">examples/server/app/crossfilter/main.py:35:5:</a> CCR001 `create_figure` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/server/app/image_blur.py#L33">examples/server/app/image_blur.py:33:5:</a> CCR001 `blur` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/release/pipeline.py#L39">release/pipeline.py:39:9:</a> CCR001 `execute` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/scripts/milestone.py#L122">scripts/milestone.py:122:5:</a> CCR001 `check_issue` is too cognitive complex (8 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/scripts/milestone.py#L158">scripts/milestone.py:158:5:</a> CCR001 `check_pr` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/scripts/milestone.py#L284">scripts/milestone.py:284:5:</a> CCR001 `main` is too cognitive complex (14 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/setup.py#L80">setup.py:80:5:</a> CCR001 `install_js` is too cognitive complex (12 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/directory.py#L110">src/bokeh/application/handlers/directory.py:110:9:</a> CCR001 `__init__` is too cognitive complex (18 &gt; 7)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/server_lifecycle.py#L55">src/bokeh/application/handlers/server_lifecycle.py:55:9:</a> CCR001 `__init__` is too cognitive complex (9 &gt; 7)
... 118 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+550 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/lib/counts.py#L119">analytics/lib/counts.py:119:5:</a> CCR001 `process_count_stat` is too cognitive complex (12 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/lib/counts.py#L304">analytics/lib/counts.py:304:5:</a> CCR001 `do_increment_logging_stat` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/lib/fixtures.py#L8">analytics/lib/fixtures.py:8:5:</a> CCR001 `generate_time_series_data` is too cognitive complex (15 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/management/commands/check_analytics_state.py#L41">analytics/management/commands/check_analytics_state.py:41:9:</a> CCR001 `get_fill_state` is too cognitive complex (15 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/management/commands/update_analytics_counts.py#L59">analytics/management/commands/update_analytics_counts.py:59:9:</a> CCR001 `run_update_analytics_counts` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/migrations/0015_clear_duplicate_counts.py#L7">analytics/migrations/0015_clear_duplicate_counts.py:7:5:</a> CCR001 `clear_duplicate_counts` is too cognitive complex (11 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/tests/test_counts.py#L220">analytics/tests/test_counts.py:220:9:</a> CCR001 `assertTableState` is too cognitive complex (13 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/views/stats.py#L250">analytics/views/stats.py:250:5:</a> CCR001 `get_chart_data` is too cognitive complex (53 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/analytics/views/stats.py#L519">analytics/views/stats.py:519:5:</a> CCR001 `client_label_map` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/activity.py#L311">corporate/lib/activity.py:311:5:</a> CCR001 `get_plan_data_by_remote_realm` is too cognitive complex (8 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L1407">corporate/lib/stripe.py:1407:9:</a> CCR001 `process_initial_upgrade` is too cognitive complex (40 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L1626">corporate/lib/stripe.py:1626:9:</a> CCR001 `do_upgrade` is too cognitive complex (10 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L1803">corporate/lib/stripe.py:1803:9:</a> CCR001 `make_end_of_cycle_updates_if_needed` is too cognitive complex (25 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L1995">corporate/lib/stripe.py:1995:9:</a> CCR001 `get_billing_context_from_plan` is too cognitive complex (18 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L2181">corporate/lib/stripe.py:2181:9:</a> CCR001 `get_initial_upgrade_context` is too cognitive complex (19 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L2374">corporate/lib/stripe.py:2374:9:</a> CCR001 `do_update_plan` is too cognitive complex (35 &gt; 7)
+ <a href="https://github.com/zulip/zulip/blob/da7cb0af1c42eadb195849a8d8b3b8a323048239/corporate/lib/stripe.py#L2553">corporate/lib/stripe.py:2553:9:</a> CCR001 `invoice_plan` is too cognitive complex (23 &gt; 7)
... 533 additional changes omitted for project
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| CCR001 | 1612 | 1612 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:21 on 2024-02-26 11:41</div>
            <div class="timeline-body"><p>This links to a local file. Is this available online too and we could link to it instead? This link seems to bypass sonar&#x27;s registration form https://www.sonarsource.com/docs/CognitiveComplexity.pdf</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-26 11:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:13 on 2024-02-26 12:26</div>
            <div class="timeline-body"><p>What&#x27;s the licensing of Sonar&#x27;s rule? The whitespaper has a footer mentioning &quot;Copyright SonarSource S . A., 2023, Switzerland. All content is copyright protected&quot;. I don&#x27;t know to what extend this applies to algorithms but something we should consider.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:85 on 2024-02-26 12:32</div>
            <div class="timeline-body"><p>The code here needs to visit all expression or you miss out in nested expressions: <code>call(a and b)</code> or does the algorithm intentionally ignore this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:96 on 2024-02-26 12:33</div>
            <div class="timeline-body"><p>You may want to take a look at implementing the <code>Visitor</code> or <code>PreorderVisitor</code> traits. Visitors allow you to traverse an entire subtree and ensure that e.g. nested expressions get visited.</p>
<p>The code of the upstream plugin https://github.com/Melevir/cognitive_complexity/blob/master/cognitive_complexity/utils/ast.py</p>
<p>It traverses all nodes recursively, except boolean operators it seems. It&#x27;s also worth noting that the upstream plugin doesn&#x27;t precisely implement the algorithm outlined in the whitepaper.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:145 on 2024-02-26 12:34</div>
            <div class="timeline-body"><p>Nit: You can pass the entire function instead of individual parts</p>
<pre><code>    definition: &amp;FunctionDef,
    max_cognitive_complexity: usize,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:1104 on 2024-02-26 12:35</div>
            <div class="timeline-body"><p>How did you decide on the default? Is it the same as the upstream rule uses?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-26 12:36</div>
            <div class="timeline-body"><p>Thanks for working on this.</p>
<p>We have to figure out what the copyright of the rule is before implementing and reviewing fully.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Anders-Steen">@Anders-Steen</a> on 2024-02-26 14:38</div>
            <div class="timeline-body"><p>Thank you for reviewing @MichaReiser, I&#x27;ll see if I have time this evening to go through the feedback this evening or later this week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Anders-Steen">@Anders-Steen</a> reviewed on 2024-02-26 14:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Anders-Steen">@Anders-Steen</a> on <code>crates/ruff_workspace/src/options.rs</code>:1104 on 2024-02-26 14:49</div>
            <div class="timeline-body"><p>Correct! I copied the default max <a href="https://github.com/Melevir/flake8-cognitive-complexity/blob/d88502e1abdcc4540c27dac430c616ae6ba1eb9b/flake8_cognitive_complexity/checker.py#L10">ref</a>.</p>
<p>Though the author thinks it should be 15 but also states that there perhaps shouldn&#x27;t be a default... <a href="https://stackoverflow.com/a/45084107">ref</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Anders-Steen">@Anders-Steen</a> reviewed on 2024-02-26 14:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Anders-Steen">@Anders-Steen</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:21 on 2024-02-26 14:52</div>
            <div class="timeline-body"><p>Oops, a blunder, yes, it is the same <code>.pdf</code> that I used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Anders-Steen">@Anders-Steen</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:13 on 2024-02-26 18:16</div>
            <div class="timeline-body"><p>https://github.com/SonarSource/sonar-python?tab=LGPL-3.0-1-ov-file
Looks like it is <em>LGPL</em>, so I guess??? Not completely sure if it means we can use it within this <em>MIT</em> licenced project .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Anders-Steen">@Anders-Steen</a> reviewed on 2024-02-26 18:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-02-26 18:23</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/AndersSteenNilsen:cognitive_complexity">CodSpeed Performance Report</a>
Merging #9812 will <strong>improve performances by 44.6%</strong>
<p>Comparing <code>AndersSteenNilsen:cognitive_complexity</code> (b51d4be) with <code>main</code> (c53aae0)</p>
Summary
<p><code>⚡ 21</code> improvements
<code>✅ 9</code> untouched benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>AndersSteenNilsen:cognitive_complexity</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ⚡ | <code>formatter[numpy/ctypeslib.py]</code> | 10.2 ms | 9.7 ms | +4.97% |
| ⚡ | <code>formatter[numpy/globals.py]</code> | 1,152.8 µs | 990.1 µs | +16.43% |
| ⚡ | <code>formatter[unicode/pypinyin.py]</code> | 3.4 ms | 3.3 ms | +4.61% |
| ⚡ | <code>lexer[numpy/ctypeslib.py]</code> | 1.8 ms | 1.6 ms | +15.26% |
| ⚡ | <code>lexer[numpy/globals.py]</code> | 223.5 µs | 154.5 µs | +44.6% |
| ⚡ | <code>lexer[unicode/pypinyin.py]</code> | 571.5 µs | 526.4 µs | +8.57% |
| ⚡ | <code>linter/all-rules[large/dataset.py]</code> | 94.1 ms | 81.4 ms | +15.56% |
| ⚡ | <code>linter/all-rules[numpy/ctypeslib.py]</code> | 22 ms | 18.7 ms | +17.78% |
| ⚡ | <code>linter/all-rules[numpy/globals.py]</code> | 2.8 ms | 2.6 ms | +8.14% |
| ⚡ | <code>linter/all-rules[pydantic/types.py]</code> | 44.3 ms | 39.1 ms | +13.49% |
| ⚡ | <code>linter/all-rules[unicode/pypinyin.py]</code> | 11.8 ms | 9.8 ms | +20.28% |
| ⚡ | <code>linter/all-with-preview-rules[large/dataset.py]</code> | 106.9 ms | 96 ms | +11.39% |
| ⚡ | <code>linter/all-with-preview-rules[numpy/ctypeslib.py]</code> | 24.6 ms | 22.1 ms | +11.23% |
| ⚡ | <code>linter/all-with-preview-rules[numpy/globals.py]</code> | 3.1 ms | 3 ms | +4.6% |
| ⚡ | <code>linter/all-with-preview-rules[pydantic/types.py]</code> | 51.9 ms | 47.1 ms | +10.11% |
| ⚡ | <code>linter/all-with-preview-rules[unicode/pypinyin.py]</code> | 12.8 ms | 11.1 ms | +15.59% |
| ⚡ | <code>parser[large/dataset.py]</code> | 69.1 ms | 63.6 ms | +8.59% |
| ⚡ | <code>parser[numpy/ctypeslib.py]</code> | 11.8 ms | 10.8 ms | +9.73% |
| ⚡ | <code>parser[numpy/globals.py]</code> | 1,117.4 µs | 963.9 µs | +15.92% |
| ⚡ | <code>parser[pydantic/types.py]</code> | 26.4 ms | 24.4 ms | +7.9% |
| ... | ... | ... | ... | ... |</p>
<p><br></p>
<blockquote>
<p>:information_source: <em>Only the first 20 benchmarks are displayed. <a href="https://codspeed.io/astral-sh/ruff/branches/AndersSteenNilsen:cognitive_complexity">Go to the app to view all benchmarks</a>.</em></p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Anders-Steen">@Anders-Steen</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:85 on 2024-02-26 20:57</div>
            <div class="timeline-body"><p>I am not quite sure what you mean, but I think nested expressions should be covered from the outer check <code>get_cognitive_complexity_number</code>. Could you perhaps give an example which is not in the tests in the bottom of the file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Anders-Steen">@Anders-Steen</a> reviewed on 2024-02-26 20:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-06 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-06 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-03-06 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_cognitive_complexity/rules/function_is_too_cognitive_complex.rs</code>:13 on 2024-03-06 15:39</div>
            <div class="timeline-body"><p>Nice. Yeah that looks okay. Also, code climate implements the same rule. So I think we should be good https://docs.codeclimate.com/docs/cognitive-complexity</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-28 16:17</div>
            <div class="timeline-body"><p>Thank you @AndersSteenNilsen for contributing this new cognitive complexity rule. I like how Sonar quantifies complexity, and I think I prefer it over MC Cabe.</p>
<p>I&#x27;m sorry but we can&#x27;t merge the rule as it is today. Our concern is that this new rule overlaps with the existing Mc Cabe complexity rule. A possible solution is to merge the two rules with a configuration option that controls which complexity metric to use. One open design question is how to incorporate other rules that measure complexity like <code>too-many-local-variables</code>, <code>too-many-lines</code>, <code>too-many-instance-attributes</code>, etc. Should the same rule cover these? Should we have two rules, one for control flow complexity and one for structural/shape complexity? etc...</p>
<p>I&#x27;m sorry that we failed to make it clear on the issue that implementing this rule requires more design work. I hope we can build on top of your PR once we figure out these design decisions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-28 16:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:01:24 UTC
    </footer>
</body>
</html>
