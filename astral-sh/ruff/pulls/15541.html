<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-bandit`] Report all references to suspicious functions (`S3`) - astral-sh/ruff #15541</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-bandit</code>] Report all references to suspicious functions (<code>S3</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15541">#15541</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2025-01-17 00:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Resolves #15522.</p>
<h2>Test Plan</h2>
<p><code>cargo nextest run</code> and <code>cargo insta test</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-17 00:17</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+8 -0 violations, +0 -0 fixes in 2 projects; 53 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+7 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/providers/src/airflow/providers/ftp/hooks/ftp.py#L66'>providers/src/airflow/providers/ftp/hooks/ftp.py:66:24:</a> S321 FTP-related functions are being called. FTP is considered insecure. Use SSH/SFTP/SCP or some other encrypted protocol.
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/providers/src/airflow/providers/ftp/operators/ftp.py#L201'>providers/src/airflow/providers/ftp/operators/ftp.py:201:24:</a> S321 FTP-related functions are being called. FTP is considered insecure. Use SSH/SFTP/SCP or some other encrypted protocol.
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/providers/src/airflow/providers/ftp/sensors/ftp.py#L84'>providers/src/airflow/providers/ftp/sensors/ftp.py:84:20:</a> S321 FTP-related functions are being called. FTP is considered insecure. Use SSH/SFTP/SCP or some other encrypted protocol.
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/providers/tests/ftp/sensors/test_ftp.py#L54'>providers/tests/ftp/sensors/test_ftp.py:54:28:</a> S321 FTP-related functions are being called. FTP is considered insecure. Use SSH/SFTP/SCP or some other encrypted protocol.
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/providers/tests/ftp/sensors/test_ftp.py#L67'>providers/tests/ftp/sensors/test_ftp.py:67:28:</a> S321 FTP-related functions are being called. FTP is considered insecure. Use SSH/SFTP/SCP or some other encrypted protocol.
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/providers/tests/ftp/sensors/test_ftp.py#L80'>providers/tests/ftp/sensors/test_ftp.py:80:28:</a> S321 FTP-related functions are being called. FTP is considered insecure. Use SSH/SFTP/SCP or some other encrypted protocol.
+ <a href='https://github.com/apache/airflow/blob/ee785a89ba27a59246cdfcc0d83129b691a39f3e/tests/decorators/test_python.py#L74'>tests/decorators/test_python.py:74:26:</a> S307 Use of possibly insecure function; consider using `ast.literal_eval`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/superset/blob/8960db4132409d563483cadd7311a30bf3f7b6d7/superset/migrations/versions/2023-05-01_12-03_9c2a5681ddfd_convert_key_value_entries_to_json.py#L46'>superset/migrations/versions/2023-05-01_12-03_9c2a5681ddfd_convert_key_value_entries_to_json.py:46:27:</a> S301 `pickle` and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue
</pre>

</p>
</details>
<details><summary>Changes by rule (3 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| S321 | 6 | 6 | 0 | 0 | 0 |
| S307 | 1 | 1 | 0 | 0 | 0 |
| S301 | 1 | 1 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @InSyncWithFoo on 2025-01-17 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-bandit`] Report all references (`S3`)" to "[`flake8-bandit`] Report all references to suspicious functions (`S3`)" by @InSyncWithFoo on 2025-01-17 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @InSyncWithFoo on 2025-01-17 02:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-17 02:42</div>
            <div class="timeline-body"><p>The ecosystem changes are mostly as expected, except for this:</p>
<p><a href="https://github.com/apache/airflow/blob/060eeb73d3636f7ff692acb6c61c7ff948c3574f/providers/src/airflow/providers/ftp/hooks/ftp.py#L282">@apache/airflow</a>:</p>
<pre><code class="language-py">class FTPSHook(FTPHook):
    def get_conn(self) -&gt; ftplib.FTP:
#                         ^^^^^^^^^^
</code></pre>
<p>Should references in type hints be reported?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:1013 on 2025-01-17 04:10</div>
            <div class="timeline-body"><p>What's the reason for updating this two match patterns?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:916 on 2025-01-17 04:11</div>
            <div class="timeline-body"><p>Just to confirm, this is because now we check all references which can come from type annotations as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:847 on 2025-01-17 04:27</div>
            <div class="timeline-body"><p>I'm not sure what this condition is avoiding, can you expand on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-17 04:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-17 04:30</div>
            <div class="timeline-body"><blockquote>
<p>Should references in type hints be reported?</p>
</blockquote>
<p>I think we should ignore them which, I think, is what you've done as well in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-01-17 04:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-01-17 04:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2025-01-17 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:1013 on 2025-01-17 13:34</div>
            <div class="timeline-body"><p>I think these should not be reported:</p>
<pre><code class="language-py">import ftplib

# References to the module
print(ftplib)
#     ^^^^^^
print(ftplib.foo)
#     ^^^^^^
</code></pre>
<p>The second pattern is also covered by <a href="https://github.com/astral-sh/ruff/pull/15541/files#diff-2eb1b56423c04f6d7842839aa6ea3d70f56306c9fb15c678f7abd3a8cd97719dR848-R850">a <code>match</code> branch</a> in <code>suspicious_function_reference</code>. Previously this wasn't a problem because it's unlikely for users to call a module (<code>ftplib()</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2025-01-17 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:916 on 2025-01-17 13:34</div>
            <div class="timeline-body"><p>Yes, that's correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:847 on 2025-01-17 13:34</div>
            <div class="timeline-body"><p>This is to avoid duplicated diagnostics:</p>
<pre><code class="language-python"># vvvvvvvvvvvvvvvvvvvvv Already reported as a call expression
  foo.bar(lorem, ipsum)
# ^^^^^^^ Should not be reported as a reference
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2025-01-17 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-20 08:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:1013 on 2025-01-20 08:24</div>
            <div class="timeline-body"><p>Thanks for providing those examples. I agree that it's unlikely that a module can be callable but it is possible. Regardless, this would mean that we won't be highlighting code like:</p>
<pre><code class="language-py">import ftplib

getattr(ftplib, 'Error')
</code></pre>
<p>I don't expect to see this kind of usages but there's no cost to us in detecting them. So, I'd favor in reverting this change unless it's causing some other problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-01-20 08:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-20 08:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/suspicious_function_call.rs</code>:1013 on 2025-01-20 08:37</div>
            <div class="timeline-body"><p>I reverted this but feel free to comment :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-20 08:47</div>
            <div class="timeline-body"><p>Updating the docs with the new preview behavior and then will merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-01-20 09:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-01-20 09:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-20 12:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:09:13 UTC
    </footer>
</body>
</html>
