<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pyupgrade`] properly trigger in nested class (`UP008`) - astral-sh/ruff #22677</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pyupgrade</code>] properly trigger in nested class (<code>UP008</code>)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22677">#22677</a>
        opened by <a href="https://github.com/leandrobbraga">@leandrobbraga</a>
        on 2026-01-18 13:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrobbraga">@leandrobbraga</a></div>
            <div class="timeline-body"><p>While debugging, I noticed that the function parameters were of type <code>Expr::Name</code> in the normal case and <code>Expr::Attribute</code> when the function was in a nested class. Reading the <a href="https://docs.python.org/3/library/ast.html#ast.expr">documentation</a>, it seems that being an <code>Expr::Attribute</code> makes sense because <code>Inner</code> is an attribute of <code>Outer</code>.</p>
<p>I did some thinking and could not identify any additional <code>Expr</code> types I should be pattern-matching here, but I would like some input from you.</p>
<p>The change seems to fix the issue without any regression.</p>
<pre><code>echo &#x27;class Base:
      def __init__(self, foo):
          self.foo = foo


  class Outer(Base):
      def __init__(self, foo):
          super().__init__(foo)  # Should not trigger UP008

      class Inner(Base):
          def __init__(self, foo):
              super().__init__(foo)  # Should not trigger UP008

      class InnerInner(Base):
          def __init__(self, foo):
              super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008

  &#x27; | cargo run -p ruff -- check --select UP008 -
UP008 Use `super()` instead of `super(__class__, self)`
  --&gt; -:16:18
   |
14 |     class InnerInner(Base):
15 |         def __init__(self, foo):
16 |             super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Remove `super()` parameters

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
<p>Closes #22597</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`pyupgrade`] properly trigger UP008 in nested class&quot; to &quot;[`pyupgrade`] properly trigger in nested class (`UP008`)&quot; by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on 2026-01-18 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-18 13:17</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -0 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<a href="https://github.com/apache/superset">apache/superset</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/superset/blob/25647942fd774d8c193cb570ba5fc3d74f037999/superset/sql/dialects/pinot.py#L172">superset/sql/dialects/pinot.py:172:25:</a> UP008 Use `super()` instead of `super(__class__, self)`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| UP008 | 1 | 1 | 0 | 0 | 0 |</p>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -0 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<a href="https://github.com/apache/superset">apache/superset</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/superset/blob/25647942fd774d8c193cb570ba5fc3d74f037999/superset/sql/dialects/pinot.py#L172">superset/sql/dialects/pinot.py:172:25:</a> UP008 [*] Use `super()` instead of `super(__class__, self)`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| UP008 | 1 | 1 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-20 22:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-20 22:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-20 22:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on 2026-01-20 23:40</div>
            <div class="timeline-body"><p>This bug seems easy to introduce into the codebase. I did a quick search and found another example.</p>
<p>PLC1802 won’t trigger if the list is an attribute.</p>
<p>https://play.ruff.rs/f9f8f76b-c468-4f4f-a3b8-0bca5850daf1</p>
<pre><code>class Fruits:
    fruits: list[str]

    def __init__(self, fruits: list[str]):
        self.fruits = fruits

fruits_class = Fruits([&quot;orange&quot;, &quot;apple&quot;])
fruits_list = [&quot;a&quot;, &quot;b&quot;]

if len(fruits_class.fruits):
    ...

if len(fruits_list):
    ...
</code></pre>
<p>I opened an <a href="https://github.com/astral-sh/ruff/issues/22780">issue</a> and I can&#x27;t think on how to prevent this class of bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a> approved on 2026-01-21 00:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/generalmimon">@generalmimon</a> reviewed on 2026-01-21 04:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/generalmimon">@generalmimon</a> on <code>crates/ruff_linter/resources/test/fixtures/pyupgrade/UP008.py</code>:314 on 2026-01-21 04:50</div>
            <div class="timeline-body"><p>I&#x27;m not sure what you intended here with the 1-argument <code>super(self)</code> call, but it actually raises an error at runtime:</p>
<pre><code>Python 3.14.2 (tags/v3.14.2:df79316, Dec  5 2025, 17:18:21) [MSC v.1944 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; class Base:
...     def __init__(self, foo):
...         self.foo = foo
...
&gt;&gt;&gt; class Outer(Base):
...     def __init__(self, foo):
...         super(self).__init__(foo)  # Should not trigger UP008
...
&gt;&gt;&gt; o = Outer(5)
Traceback (most recent call last):
  File &quot;&lt;python-input-2&gt;&quot;, line 1, in &lt;module&gt;
    o = Outer(5)
  File &quot;&lt;python-input-1&gt;&quot;, line 3, in __init__
    super(self).__init__(foo)  # Should not trigger UP008
    ~~~~~^^^^^^
TypeError: super() argument 1 must be a type, not Outer
</code></pre>
<p>Perhaps you wanted to use either a 2-argument or 0-argument call instead? Also, if the <code>super</code> call doesn&#x27;t have two arguments, the lint will return early, so I don&#x27;t know if you wanted to verify that there is no panic in that case, for example?</p>
<p>https://github.com/astral-sh/ruff/blob/6f8ae1ba7c62d8197371c43c5501fc005b91824c/crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs#L91-L96</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/generalmimon">@generalmimon</a> on 2026-01-21 05:09</div>
            <div class="timeline-body"><p>@leandrobbraga (<a href="https://github.com/astral-sh/ruff/pull/22677">astral-sh/ruff#22677</a>#issue-3826762723):</p>
<blockquote>
<pre><code>echo &#x27;class Base:
      def __init__(self, foo):
          self.foo = foo


  class Outer(Base):
      def __init__(self, foo):
          super().__init__(foo)  # Should not trigger UP008

      class Inner(Base):
          def __init__(self, foo):
              super().__init__(foo)  # Should not trigger UP008

      class InnerInner(Base):
          def __init__(self, foo):
              super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008

  &#x27; | cargo run -p ruff -- check --select UP008 -
UP008 Use `super()` instead of `super(__class__, self)`
  --&gt; -:16:18
   |
14 |     class InnerInner(Base):
15 |         def __init__(self, foo):
16 |             super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Remove `super()` parameters

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
</blockquote>
<p>This doesn&#x27;t work either - I suppose the indentation isn&#x27;t what you intended?</p>
<pre><code>$ cat test.py
class Base:
    def __init__(self, foo):
        self.foo = foo


class Outer(Base):
    def __init__(self, foo):
        super().__init__(foo)  # Should not trigger UP008

    class Inner(Base):
        def __init__(self, foo):
            super().__init__(foo)  # Should not trigger UP008

    class InnerInner(Base):
        def __init__(self, foo):
            super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008


o = Outer(5)
i = Outer.Inner(5)
ii = Outer.InnerInner(5)

$ python3 --version
Python 3.14.2

$ python3 test.py
Traceback (most recent call last):
  File &quot;/home/pp/test.py&quot;, line 21, in &lt;module&gt;
    ii = Outer.InnerInner(5)
  File &quot;/home/pp/test.py&quot;, line 16, in __init__
    super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008
          ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object &#x27;Inner&#x27; has no attribute &#x27;InnerInner&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrobbraga">@leandrobbraga</a> reviewed on 2026-01-21 09:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on <code>crates/ruff_linter/resources/test/fixtures/pyupgrade/UP008.py</code>:314 on 2026-01-21 09:32</div>
            <div class="timeline-body"><p>It was supposed to be with 0-argument, thanks for pointing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on 2026-01-21 09:36</div>
            <div class="timeline-body"><p>This was a copy-paste indentation error, for some reason I lost the indentation when I copy-pasted, but it was tested properly.</p>
<p>Try linting this code:</p>
<pre><code>class Base:
    def __init__(self, foo):
        self.foo = foo


class Outer(Base):
    def __init__(self, foo):
        super().__init__(foo)  # Should not trigger UP008

    class Inner(Base):
        def __init__(self, foo):
            super(Outer.Inner, self).__init__(foo)  # Should trigger UP008

        class InnerInner(Base):
            def __init__(self, foo):
                super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008

oii = Outer.Inner.InnerInner(1)
</code></pre>
<p>Output:</p>
<pre><code>&gt; echo &#x27;class Base:
      def __init__(self, foo):
          self.foo = foo


  class Outer(Base):
      def __init__(self, foo):
          super().__init__(foo)  # Should not trigger UP008

      class Inner(Base):
          def __init__(self, foo):
              super(Outer.Inner, self).__init__(foo)  # Should trigger UP008

          class InnerInner(Base):
              def __init__(self, foo):
                  super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008

  oii = Outer.Inner.InnerInner(1)&#x27; | cargo run -p ruff -- check --select UP008 -
UP008 Use `super()` instead of `super(__class__, self)`
  --&gt; -:12:18
   |
10 |     class Inner(Base):
11 |         def __init__(self, foo):
12 |             super(Outer.Inner, self).__init__(foo)  # Should trigger UP008
   |                  ^^^^^^^^^^^^^^^^^^^
13 |
14 |         class InnerInner(Base):
   |
help: Remove `super()` parameters

UP008 Use `super()` instead of `super(__class__, self)`
  --&gt; -:16:22
   |
14 |         class InnerInner(Base):
15 |             def __init__(self, foo):
16 |                 super(Outer.Inner.InnerInner, self).__init__(foo)  # Should trigger UP008
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/generalmimon">@generalmimon</a> reviewed on 2026-01-21 10:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/generalmimon">@generalmimon</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs</code>:140 on 2026-01-21 10:05</div>
            <div class="timeline-body"><p>What&#x27;s the point of accepting an attribute in the second argument? This <code>second_arg_id</code> is required to be equal to the name of the &quot;parent argument&quot; (<code>parent_arg</code>), which is typically <code>self</code>:</p>
<p>https://github.com/astral-sh/ruff/blob/ff11db466dc5fae8272a026e86638b04505855cb/crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs#L147</p>
<p>I think it doesn&#x27;t make sense to accept wild stuff like <code>super(..., a.b.c.self)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrobbraga">@leandrobbraga</a> reviewed on 2026-01-21 10:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs</code>:140 on 2026-01-21 10:44</div>
            <div class="timeline-body"><p>That&#x27;s correct, I removed the match on <code>Expr::Attribute</code> for the second parameter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/generalmimon">@generalmimon</a> reviewed on 2026-01-21 20:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/generalmimon">@generalmimon</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs</code>:134 on 2026-01-21 20:42</div>
            <div class="timeline-body"><p>This assumes that whenever <code>super(A.B, self)</code> appears inside a class named <code>B</code>, it must be the <code>super(__class__, self)</code> case and an upgrade can be performed. Unfortunately, this is not necessarily true. Consider this:</p>
<pre><code>class Base:
    def __init__(self, foo):
        print(f&quot;Base.__init__({foo}) called&quot;)
        self.foo = foo


class Outer:
    class Inner(Base):
        def __init__(self, foo):
            print(f&quot;Outer.Inner.__init__({foo}) called&quot;)
            super().__init__(foo)


class Inner(Outer.Inner):
    def __init__(self, foo):
        super(Outer.Inner, self).__init__(foo)


i = Inner(5)
</code></pre>
<p>Note that the <code>super</code> call in the <code>Inner.__init__</code> method body is <code>super(Outer.Inner, self)</code>, not <code>super(Inner, self)</code>. If you run the above code, the output is the following:</p>
<pre><code>root@d2a45e4529f7:~# python3 --version
Python 3.13.5
root@d2a45e4529f7:~# python3 test.py
Base.__init__(5) called
</code></pre>
<p>As you can see, only <code>Base.__init__</code> was called, not <code>Outer.Inner.__init__</code>.</p>
<p>Nevertheless, your current implementation at https://github.com/astral-sh/ruff/commit/a9b58e1d3610ef14430569af480d9a5fd0b4d209 still suggests omitting arguments to this <code>super</code> call:</p>
<pre><code>root@d2a45e4529f7:~/ruff# git status
On branch bugfix/up008-inner-class
Your branch is up to date with &#x27;origin/bugfix/up008-inner-class&#x27;.

nothing to commit, working tree clean
root@d2a45e4529f7:~/ruff# git rev-parse HEAD
a9b58e1d3610ef14430569af480d9a5fd0b4d209
root@d2a45e4529f7:~/ruff# cargo run -p ruff -- check --select UP ../test.py --no-cache
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.27s
     Running `target/debug/ruff check --select UP ../test.py --no-cache`
UP008 Use `super()` instead of `super(__class__, self)`
  --&gt; /root/test.py:16:14
   |
14 | class Inner(Outer.Inner):
15 |     def __init__(self, foo):
16 |         super(Outer.Inner, self).__init__(foo)
   |              ^^^^^^^^^^^^^^^^^^^
   |
help: Remove `super()` parameters

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
<p>In preview, this is even offered as a safe fix:</p>
<pre><code>root@d2a45e4529f7:~/ruff# cargo run -p ruff -- check --preview --select UP ../test.py --no-cache
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.21s
     Running `target/debug/ruff check --preview --select UP ../test.py --no-cache`
UP008 [*] Use `super()` instead of `super(__class__, self)`
  --&gt; /root/test.py:16:14
   |
14 | class Inner(Outer.Inner):
15 |     def __init__(self, foo):
16 |         super(Outer.Inner, self).__init__(foo)
   |              ^^^^^^^^^^^^^^^^^^^
   |
help: Remove `super()` parameters
13 |
14 | class Inner(Outer.Inner):
15 |     def __init__(self, foo):
   -         super(Outer.Inner, self).__init__(foo)
16 +         super().__init__(foo)
17 |
18 |
19 | i = Inner(5)

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>However, if you apply it, the behavior of the program changes - notice the additional message <code>Outer.Inner.__init__(5) called</code>, which the original program did not print:</p>
<pre><code>root@d2a45e4529f7:~# cat test.py
class Base:
    def __init__(self, foo):
        print(f&quot;Base.__init__({foo}) called&quot;)
        self.foo = foo


class Outer:
    class Inner(Base):
        def __init__(self, foo):
            print(f&quot;Outer.Inner.__init__({foo}) called&quot;)
            super().__init__(foo)


class Inner(Outer.Inner):
    def __init__(self, foo):
        super().__init__(foo)


i = Inner(5)
root@d2a45e4529f7:~# python3 test.py
Outer.Inner.__init__(5) called
Base.__init__(5) called
</code></pre>
<p>I admit that this is perhaps an unusual scenario. Calling <code>super(Outer.Inner, self)</code> in the <code>Inner</code> class looks rather unintentional or at least suspicious, but from Python&#x27;s point of view, it is a valid program that does not raise any runtime errors.</p>
<p>So I believe that Ruff should verify whether the entire attribute chain (in this case <code>Outer.Inner</code>) matches, not just its last segment. This means that instead of just finding the closest enclosing class:</p>
<p>https://github.com/astral-sh/ruff/blob/a9b58e1d3610ef14430569af480d9a5fd0b4d209/crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs#L120-L128</p>
<p>... and comparing its name with the last segment in the attribute chain:</p>
<p>https://github.com/astral-sh/ruff/blob/a9b58e1d3610ef14430569af480d9a5fd0b4d209/crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs#L148</p>
<p>..., Ruff should also inspect further (nested) enclosing classes and compare the second-to-last segment in the attribute chain, third-to-last segment, etc. If anything doesn&#x27;t match, UP008 should not be triggered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrobbraga">@leandrobbraga</a> reviewed on 2026-01-21 20:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs</code>:134 on 2026-01-21 20:56</div>
            <div class="timeline-body"><p>Thank you for your review, I&#x27;ll try to think about the corner cases and come up with a solution in the next days.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrobbraga">@leandrobbraga</a> reviewed on 2026-01-21 20:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leandrobbraga">@leandrobbraga</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/super_call_with_parameters.rs</code>:134 on 2026-01-21 20:56</div>
            <div class="timeline-body"><p>Thank you for your review, I&#x27;ll try to think about the corner cases and come up with a solution in the next days.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 21:26:54 UTC
    </footer>
</body>
</html>
