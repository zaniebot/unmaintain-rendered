<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support `__getitem__` type inference for subscripts - astral-sh/ruff #13579</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support <code>__getitem__</code> type inference for subscripts</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13579">#13579</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-10-01 03:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>Follow-up to <a href="https://github.com/astral-sh/ruff/pull/13562">astral-sh/ruff#13562</a>, to add support for &quot;arbitrary&quot; subscript operations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 03:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 03:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 03:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 03:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2639 on 2024-10-01 03:42</div>
            <div class="timeline-body"><p>Very hard to test these right now given various TODO types that are returned.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 03:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2633 on 2024-10-01 03:42</div>
            <div class="timeline-body"><p>Is there anything to do here yet? E.g., I <em>could</em> &quot;manually&quot; validate that <code>&quot;abc&quot;[()]</code> is not a valid operation, but I guess I&#x27;d rather get this &quot;for free&quot; from typeshed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 03:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Support __getitem__ type inference for subscripts&quot; to &quot;Support `__getitem__` type inference for subscripts&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 03:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-01 03:55</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 04:16</div>
            <div class="timeline-body"><p>We&#x27;re getting new errors in the benchmark due to expressions like <code>frozenset[str]</code> or <code>dict[str]</code>:</p>
<pre><code>Dunder method `__class_getitem__` is not callable on type &#x27;Literal[frozenset]&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 04:18</div>
            <div class="timeline-body"><p>Those seem to have a type that&#x27;s a union of <code>Unknown</code> and the <code>__class_getitem__</code> function definition.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 04:19</div>
            <div class="timeline-body"><p>Okay, I think (?) that&#x27;s because in typeshed they&#x27;re defined as:</p>
<pre><code>if sys.version_info &gt;= (3, 9):
    def __class_getitem__(cls, item: Any, /) -&gt; GenericAlias: ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 07:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2633 on 2024-10-01 07:30</div>
            <div class="timeline-body"><p>Correct, nothing really to do here at this point!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 07:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2667 on 2024-10-01 07:31</div>
            <div class="timeline-body"><p>nit:</p>
<pre><code>                // Otherwise, emit a diagnostic.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-01 10:23</div>
            <div class="timeline-body"><blockquote>
<p>Those seem to have a type that&#x27;s a union of <code>Unknown</code> and the <code>__class_getitem__</code> function definition.</p>
</blockquote>
<p>Hmm, that&#x27;s kinda odd that it&#x27;s creating issues, though. Both <code>Unknown</code> and the <code>__class_getitem__</code> function should be treated as callable, because <code>Unknown</code> should have all possible attributes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 10:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2613 on 2024-10-01 10:25</div>
            <div class="timeline-body"><p>I wrote these docs! Glad they&#x27;re coming in useful ðŸ˜ƒ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 10:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:6794 on 2024-10-01 10:26</div>
            <div class="timeline-body"><p>nit (since a literal <code>str</code> is inferred as a different <code>Type</code> variant to an arbitrary <code>str</code> in our semantic model):</p>
<pre><code>    fn subscript_str_literal() -&gt; anyhow::Result&lt;()&gt; {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 10:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2639 on 2024-10-01 10:32</div>
            <div class="timeline-body"><p>Something like this seems to pass for me locally:</p>
<pre><code>diff --git a/crates/red_knot_python_semantic/src/types/infer.rs b/crates/red_knot_python_semantic/src/types/infer.rs
index 15b2626a8..f74c833ef 100644
--- a/crates/red_knot_python_semantic/src/types/infer.rs
+++ b/crates/red_knot_python_semantic/src/types/infer.rs
@@ -6829,6 +6829,30 @@ mod tests {
         Ok(())
     }
 
+    #[test]
+    fn subscript_not_callable_getitem() -&gt; anyhow::Result&lt;()&gt; {
+        let mut db = setup_db();
+
+        db.write_dedented(
+            &quot;/src/a.py&quot;,
+            &quot;
+                class NotSubscriptable:
+                    __getitem__ = None
+
+                a = NotSubscriptable()[0]
+            &quot;,
+        )?;
+
+        assert_public_ty(&amp;db, &quot;/src/a.py&quot;, &quot;a&quot;, &quot;Unknown&quot;);
+        assert_file_diagnostics(
+            &amp;db,
+            &quot;/src/a.py&quot;,
+            &amp;[&quot;Dunder method `__getitem__` is not callable on type &#x27;NotSubscriptable&#x27;.&quot;],
+        );
+
+        Ok(())
+    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-01 14:13</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Those seem to have a type that&#x27;s a union of <code>Unknown</code> and the <code>__class_getitem__</code> function definition.</p>
</blockquote>
<p>Hmm, that&#x27;s kinda odd that it&#x27;s creating issues, though. Both <code>Unknown</code> and the <code>__class_getitem__</code> function should be treated as callable, because <code>Unknown</code> should have all possible attributes</p>
</blockquote>
<p>Okay @charliermarsh I think this is because you&#x27;re doing this:</p>
<pre><code>                    let CallOutcome::Callable { return_ty } =
                        dunder_getitem_method.call(self.db, &amp;[slice_ty])
                    else
</code></pre>
<p>But the result of <code>Union[Unknown, &lt;some function&gt;].call()</code> is not <code>CallOutcome::Callable</code> (even though all items in the union are actually callable), it&#x27;s <code>CallOutcome::Union</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-01 14:15</div>
            <div class="timeline-body"><p>I think you can fix this by making use of one of these two helper methods we have on <code>CallOutcome</code>, both of which abstract away the difference between <code>CallOutcome::Callable</code> and <code>CallOutcome::Union</code>:</p>
<p>https://github.com/astral-sh/ruff/blob/cfd5d639176730a6d4a299864e7606d024a0f55a/crates/red_knot_python_semantic/src/types.rs#L851-L971</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:1335 on 2024-10-01 16:51</div>
            <div class="timeline-body"><p>Nit: this feels a bit less verbose, and more consistent with our other diagnostics:</p>
<pre><code>                &quot;Cannot subscript object of type &#x27;{}&#x27; with no `__getitem__` method.&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:1352 on 2024-10-01 16:53</div>
            <div class="timeline-body"><p>Nit: I don&#x27;t like using &quot;dunder&quot; in diagnostic messages, it feels a little too casual to me. It&#x27;s snuck into the Python docs here and there, but it&#x27;s not used in the data model docs.</p>
<pre><code>                &quot;Method `{dunder}` is not callable on object of type &#x27;{}&#x27;.&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2633 on 2024-10-01 16:55</div>
            <div class="timeline-body"><p>I actually would remove this TODO comment, because we already have a TODO for it inside <code>Type::call</code>, and that&#x27;s where the validation should actually happen. I don&#x27;t think there&#x27;s anything more to do at this particular location.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2636 on 2024-10-01 17:00</div>
            <div class="timeline-body"><p>As @AlexWaygood mentioned in another comment, matching directly on <code>CallOutcome</code> this way doesn&#x27;t work correctly for calling unions. It also bypasses the diagnostics emitted by <code>CallOutcome::unwrap_with_diagnostic</code>, meaning the user gets no feedback about what the type of <code>__getitem__</code> is, that isn&#x27;t callable.</p>
<p>The intended way to use <code>CallOutcome</code> is to just call <code>unwrap_with_diagnostic</code> on it, and not necessarily emit your own diagnostic on top of that. In this case, that means the user won&#x27;t get the context that it&#x27;s the <code>__getitem__</code> that wasn&#x27;t callable, so we may want to add a way to pass additional context into <code>CallOutcome::unwrap_with_diagnostic</code> further identifying what it is that we tried and failed to call. (This would then mean we don&#x27;t need <code>dunder_not_callable_diagnostic</code> anymore.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2639 on 2024-10-01 17:01</div>
            <div class="timeline-body"><p>Yeah, a test like that should work; I&#x27;m curious what forms of test you tried, and what Todo types you ran into.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2648 on 2024-10-01 17:08</div>
            <div class="timeline-body"><p>I think we should add <code>Type::is_class</code> (true if it&#x27;s a <code>Type::Class</code> or a union of them) instead of directly matching on the <code>Type</code> variant this way. The reason is because we should also support <code>__class_getitem__</code> on a union of classes. <code>Type::member</code> and <code>Type::call</code> both already support unions, so it should &quot;just work&quot; if we don&#x27;t prevent it here.</p>
<p>And lets also add a test for this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2654 on 2024-10-01 17:09</div>
            <div class="timeline-body"><p>Same comment as above about using <code>CallOutcome::unwrap_with_diagnostic</code> instead of directly matching on the <code>CallOutcome</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-10-01 17:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2648 on 2024-10-01 17:15</div>
            <div class="timeline-body"><p>When we add support for <code>type[T]</code>, we&#x27;ll need to remember to modify <code>Type::is_class()</code> so that it returns <code>true</code> for <code>type[T]</code> as well. <code>x.__class_getitem__</code> should not be an error if the type of <code>x</code> is <code>type[dict]</code> (since all subclasses of <code>dict</code> have <code>__class_getitem__</code> methods as well as <code>dict</code>).</p>
<p>Nothing to do for now, but a TODO comment in <code>Type::is_class</code> might be good</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2639 on 2024-10-01 17:20</div>
            <div class="timeline-body"><p>I honestly can&#x27;t remember what I tried but it led to me adding <code>__call__</code> support. I think I was looking to resolve a type annotation in a class member and it was returning <code>Todo</code>, but I can&#x27;t remember the details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2648 on 2024-10-01 17:33</div>
            <div class="timeline-body"><p>So the test case here would be &quot;The class is a union&quot; rather than &quot;<code>__class_getitem</code> is a union&quot;, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 17:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-10-01 17:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:2648 on 2024-10-01 17:35</div>
            <div class="timeline-body"><p>Yeah -- in part because the former will necessarily imply the latter (when you get a member of a union, you get the union of the members of all the constituent types of the union)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 17:37</div>
            <div class="timeline-body"><p>@carljm -- I believe all the feedback is resolved with the exception that the dunder diagnostic regressed due to the use of <code>unwrap_with_diagnostic</code> (as you mentioned). I may look at that in a separate PR since it doesn&#x27;t necessarily need to be coupled to these changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:410 on 2024-10-01 17:39</div>
            <div class="timeline-body"><p>Per Alex&#x27;s comment:</p>
<pre><code>            // TODO also type[X], once we add that type
            _ =&gt; false,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-10-01 17:41</div>
            <div class="timeline-body"><p>Looks great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:410 on 2024-10-01 17:41</div>
            <div class="timeline-body"><p>Thank you missed that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 17:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 17:45</div>
            <div class="timeline-body"><p>I&#x27;m not sure we&#x27;ll do the right thing with this for something like</p>
<pre><code>flag = True

if flag:
    class Foo:
        def __class_getitem__(self, x: int) -&gt; str:
            pass
else:
    class Foo:
        pass

Foo[42]
</code></pre>
<p>Here we want to:</p>
<ol>
<li>Infer a union type for the <code>Foo</code> variable (it could be the first class definition, or the second)</li>
<li>Emit a diagnostic because not all items in the union support being subscripted</li>
<li>Infer <code>str | Unknown</code> for the result of the subscription</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 17:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 17:50</div>
            <div class="timeline-body"><p>I think that is working as described? I added a test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-10-01 17:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 17:51</div>
            <div class="timeline-body"><p>Yeah, I was debating whether to bring this up earlier, or whether it&#x27;s adequate to just say &quot;not subscriptable&quot; in this case. I agree the behavior you&#x27;re describing is probably more ideal. It might require explicitly handling unions as a special case here, and calling the class-getitem resolution method per element of the union? I&#x27;d also be fine with a TODO for this so this PR can land.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 17:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 17:54</div>
            <div class="timeline-body"><p>Are you instead thinking of something like this:</p>
<pre><code>flag = True

if flag:
    class Foo:
        def __class_getitem__(self, x: int) -&gt; str:
            pass
else:
    Foo = 1

Foo[42]
</code></pre>
<p>Where not all members of the union are classes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 17:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 17:57</div>
            <div class="timeline-body"><p>Huh, your tests are pretty convincing. Thanks for adding them!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-01 17:57</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 17:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 17:59</div>
            <div class="timeline-body"><p>I added a test for the case I described above, which <em>does</em> resolve to <code>Unknown</code> (with a TODO).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-01 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:412 on 2024-10-01 18:01</div>
            <div class="timeline-body"><p>Ahh, I think I <em>did</em> spot a bug but didn&#x27;t accurately identify where the bug would manifest? Anyway, thanks again, a TODO for now is fine by me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-01 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-01 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-10-01 18:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:7019 on 2024-10-01 18:07</div>
            <div class="timeline-body"><p>This case also highlights that perhaps our &quot;not subscriptable&quot; diagnostic should mention <code>__class_getitem__</code> instead of <code>__getitem__</code> if <code>Type::is_class</code> is true? But I don&#x27;t think that&#x27;s critical to fix now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-01 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:7019 on 2024-10-01 18:11</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/pull/13596</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:07:09 UTC
    </footer>
</body>
</html>
