<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[syntax-errors] Type parameter lists before Python 3.12 - astral-sh/ruff #16479</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[syntax-errors] Type parameter lists before Python 3.12</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16479">#16479</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-03-03 19:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Another simple one, just detect type parameter lists in <code>type</code> statements, functions, and classes. <a href="https://pyright-play.net/?pythonVersion=3.8&amp;strict=true&amp;code=C4TwDgpgBAHg2gFQLpQLxQJYDthA">pyright</a> only reports the <code>type</code> statement in the alias case, whereas we'll currently report both diagnostics, in combination with #16478.</p>
<h2>Test Plan</h2>
<p>Inline tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by @ntBre on 2025-03-03 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-03-03 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ntBre on 2025-03-03 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @ntBre on 2025-03-03 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-03 19:20</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a> on 2025-03-03 22:38</div>
            <div class="timeline-body"><p>This is <a href="https://pylint.readthedocs.io/en/latest/user_guide/messages/warning/using-generic-type-syntax-in-unsupported-version.html">W2604</a> from Pylint.  You may want to add it <a href="https://github.com/astral-sh/ruff/issues/970">here</a> and tick it off if you want :smile: I think your other PRs are similarly listed in Pylint.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-03 23:50</div>
            <div class="timeline-body"><p>Ah, thank you! I've only been tracking them in #6591. I'll update #970 too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-04 08:07</div>
            <div class="timeline-body"><p>For reference: https://docs.python.org/3/reference/compound_stmts.html#type-parameter-lists</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/error.rs</code>:452 on 2025-03-04 08:08</div>
            <div class="timeline-body"><p>Should this be <code>TypeParameterList</code> or should we rename the message to <code>type parameters</code>?</p>
<p>It might also be helpful to start documenting the variants. E.g. by adding a link to the Python documentation https://docs.python.org/3/reference/compound_stmts.html#type-parameter-lists</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-03-04 08:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-04 11:24</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://pyright-play.net/?pythonVersion=3.8&amp;strict=true&amp;code=C4TwDgpgBAHg2gFQLpQLxQJYDthA">pyright</a> only reports the <code>type</code> statement in the alias case, whereas we'll currently report both diagnostics, in combination with #16478.</p>
</blockquote>
<p>I think this is because the <code>type</code> statement itself was added in 3.12 so maybe it might be worth not raising this error for <code>type</code> statement as the entire statement is invalid?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-04 11:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:3119 on 2025-03-04 11:26</div>
            <div class="timeline-body"><p>Can we add a case with multiple type parameters? Or, we can just mix them up by using single type parameter in function and multiple type parameters in class.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_parser/src/error.rs</code>:452 on 2025-03-04 17:31</div>
            <div class="timeline-body"><p><code>TypeParameterList</code> sounds good. I'll start documenting them too, I think that's a great idea. As in #16404, I included something similar to ruff rule docs in case we want to show these to users eventually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-04 17:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-04 17:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:3119 on 2025-03-04 17:42</div>
            <div class="timeline-body"><p>I added an example from the <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/resources/test/fixtures/pyupgrade/UP046_0.py"><code>UP046</code></a> tests with bounds and constraints, as well as an unpacked <code>TypeVarTuple</code> and a <code>ParamSpec</code>.</p>
<p>We just mark the whole list at once, so there aren't additional errors for each type parameter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-04 17:52</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p><a href="https://pyright-play.net/?pythonVersion=3.8&amp;strict=true&amp;code=C4TwDgpgBAHg2gFQLpQLxQJYDthA">pyright</a> only reports the <code>type</code> statement in the alias case, whereas we'll currently report both diagnostics, in combination with #16478.</p>
</blockquote>
<p>I think this is because the <code>type</code> statement itself was added in 3.12 so maybe it might be worth not raising this error for <code>type</code> statement as the entire statement is invalid?</p>
</blockquote>
<p>I think that's fair. I can just hoist the check to where <code>try_parse_type_params</code> is called for classes and functions instead of keeping it in <code>parse_type_params</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1800 on 2025-03-05 02:47</div>
            <div class="timeline-body"><p>What's the reason for this condition? As a user I'd find it confusing if Ruff told me to first add the type parameters and then tell me to remove the entire list. Sorry if I missed this in my initial review if it was already present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1933 on 2025-03-05 02:47</div>
            <div class="timeline-body"><p>Same as above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/error.rs</code>:477 on 2025-03-05 02:59</div>
            <div class="timeline-body"><p>Does this work? Shouldn't the link be after <code>[..]:</code> on the same line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-03-05 02:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-05 03:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1800 on 2025-03-05 03:08</div>
            <div class="timeline-body"><p>Oh that's a good point... I was just trying to avoid duplicates, but if anything, it might make sense to suppress the <code>ParseError</code> in this case. Removing the condition is certainly easiest though.</p>
<p>And you didn't miss it, I added it here in the revision when I added the empty test cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-05 03:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_parser/src/error.rs</code>:477 on 2025-03-05 03:08</div>
            <div class="timeline-body"><p>It appeared to work in Emacs, but I can put it on one line to be safe!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-05 03:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1800 on 2025-03-05 03:17</div>
            <div class="timeline-body"><p>I think I'd prefer keep it both. I don't think we should suppress any syntax errors.</p>
<p>I know this goes against what I said earlier in https://github.com/astral-sh/ruff/pull/16479#issuecomment-2697193450 but my argument for that would be that it's a new statement altogether. Maybe for now we can just avoid suppressing <em>any</em> syntax errors based on other syntax errors and we can act on it based on user feedback? Happy to hear others thoughts on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1800 on 2025-03-05 07:27</div>
            <div class="timeline-body"><p>The parser does have some logic to avoid multiple errors at the same location for invalid syntax errors. https://github.com/astral-sh/ruff/blob/37fbe58b13b905bfafac326a74c922f72f3b54a1/crates/ruff_python_parser/src/parser/mod.rs#L424-L438</p>
<p>But I agree that we should solve this holisticly because it will otherwise be very error prone to avoid all possible errors at the same location</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-03-05 07:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-05 13:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1800 on 2025-03-05 13:08</div>
            <div class="timeline-body"><p>Ah nice! I'll remove these checks for now, and then maybe we can add <code>UnsupportedSyntaxError</code>s to that check or a similar one later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-03-05 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-03-05 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-05 13:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:10:27 UTC
    </footer>
</body>
</html>
