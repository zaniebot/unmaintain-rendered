<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show fixes by default - astral-sh/ruff #19919</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Show fixes by default</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19919">#19919</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-08-14 18:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-14 18:52</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR fixes #7352 by exposing the <code>show_fix_diff</code> option used in our snapshot tests in the CLI. As the issue suggests, we plan to make this the default output format in the future, so this is added to the <code>full</code> output format in preview for now.</p>
<p>This turned out to be pretty straightforward. I just used our existing <code>Applicability</code> settings to determine whether or not to print the diff.</p>
<p>The snapshot differences are because we now set <code>Applicability::DisplayOnly</code> for our snapshot tests. This <code>Applicability</code> is also used to determine whether or not the fix icon (<code>[*]</code>) is rendered, so this is now shown for display-only fixes in our snapshots. This was already the case previously, but we were only setting <code>Applicability::Unsafe</code> in these tests and ignoring the <code>Applicability</code> when rendering fix diffs. CLI users can't enable display-only fixes, so this is only a test change for now, but this should work smoothly if we decide to expose a <code>--display-only-fixes</code> flag or similar in the future.</p>
<p>I also deleted the <code>PrinterFlags::SHOW_FIX_DIFF</code> flag. This was completely unused before, and it seemed less confusing just to delete it than to enable it in the right place and check it along with the <code>OutputFormat</code> and <code>preview</code>.</p>
<h2>Test Plan</h2>
<p>I only added one CLI test for now. I'm kind of assuming that we have decent coverage of the cases where this shouldn't be firing, especially the <code>output_format</code> CLI test, which shows that this definitely doesn't affect non-preview <code>full</code> output. I'm happy to add more tests with different combinations of options, if we're worried about any in particular. I did try <code>--diff</code> and <code>--preview</code> and a few other combinations manually.</p>
<p>And here's a screenshot using our trusty UP049 example from the design discussion confirming that all the colors and other formatting still look as expected:</p>
<p><img width="786" height="629" alt="image" src="https://github.com/user-attachments/assets/94e408bc-af7b-4573-b546-a5ceac2620f2" /></p>
<p>And one with an unsafe fix to see the footer:</p>
<p><img width="782" height="367" alt="image" src="https://github.com/user-attachments/assets/bbb29e47-310b-4293-b2c2-cc7aee3baff4" /></p>
<h2>Related issues and PR</h2>
<ul>
<li>https://github.com/astral-sh/ruff/issues/7352</li>
<li>https://github.com/astral-sh/ruff/pull/12595</li>
<li>https://github.com/astral-sh/ruff/issues/12598</li>
<li>https://github.com/astral-sh/ruff/issues/12599</li>
<li>https://github.com/astral-sh/ruff/issues/12600</li>
</ul>
<p>I think we could probably close all of these issues now. I think we've either resolved or avoided most of them, and if we encounter them again with the new output format, it would probably make sense to open new ones anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @ntBre on 2025-08-14 18:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-08-14 18:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-14 19:04</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[prototype] Show fixes by default" to "Show fixes by default" by @ntBre on 2025-08-28 17:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-08-28 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @ntBre on 2025-08-28 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ntBre on 2025-08-28 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @ntBre on 2025-08-28 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @ntBre on 2025-08-28 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @ntBre on 2025-08-28 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @ntBre on 2025-08-28 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @ntBre on 2025-08-28 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @ntBre on 2025-08-28 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @ntBre on 2025-08-28 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @ntBre on 2025-08-28 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @ntBre on 2025-08-28 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-08-28 19:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:354 on 2025-08-29 08:21</div>
            <div class="timeline-body"><p>nit: <code>fix_applicable</code> / <code>is_fix_applicable</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-08-29 08:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:354 on 2025-08-29 13:24</div>
            <div class="timeline-body"><p>I was also thinking about this but landed on not saying something :) I think my best idea was <code>has_applicable_fix</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 13:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:354 on 2025-08-29 13:25</div>
            <div class="timeline-body"><p>(I think the <code>is_applicable</code> verbiage makes more sense on the fix type)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:354 on 2025-08-29 13:26</div>
            <div class="timeline-body"><p>(@ntBre un-resolving because I commented as you were resolving. Just for visibility — I don't have strong feelings)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 13:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-08-29 13:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:354 on 2025-08-29 13:27</div>
            <div class="timeline-body"><p>Ah <code>diagnostic.has_applicable_fix</code> does read nicely, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-08-29 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-08-29 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-29 13:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:46:47 UTC
    </footer>
</body>
</html>
