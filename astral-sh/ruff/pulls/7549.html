<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `lint` section to Ruff configuration - astral-sh/ruff #7549</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>lint</code> section to Ruff configuration</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7549">#7549</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-09-20 16:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-20 16:04</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds a new <code>lint</code> section to the configuration that groups all linter-specific settings. The existing top-level configurations continue to work without any warning because the <code>lint.*</code> settings are experimental.</p>
<p>The configuration merges the top level and <code>lint.*</code> settings where the settings in <code>lint</code> have higher precedence (override the top-level settings). The reasoning behind this is that the settings in <code>lint.</code> are more specific and more specific settings should override less specific settings.</p>
<p>I decided against showing the new <code>lint.*</code> options on our website because it would make the page extremely long (it's technically easy to do, just attribute <code>lint</code> with <code>[option_group</code>]). We may want to explore adding an <code>alias</code> field to the <code>option</code> attribute and show the alias on the website along with its regular name.</p>
<h2>Test Plan</h2>
<ul>
<li>I added new integration tests</li>
<li>I verified that the generated <code>options.md</code> is identical</li>
<li>Verified the default settings in the playground</li>
</ul>
<p><img src="https://github.com/astral-sh/ruff/assets/1203881/7b4d9689-aa88-402e-9199-9c43c8d8cc2d" alt="Screenshot from 2023-09-22 13-52-23" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-20 16:04</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #7566</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7566" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #7591</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7591" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #7593</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7593" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #7549</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7549" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ<ul>
<li><strong>PR #7599</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7599" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7549?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2023-09-20 16:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:41 on 2023-09-20 16:15</div>
            <div class="timeline-body"><p>The documentation moves to the new option names, but the old settings are still in the schema (thanks to <code>serde(flatten)</code>. Very neat feature for this use case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-20 16:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2023-09-21 12:27</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/lint-options">CodSpeed Performance Report</a></h2>
<h3>Merging #7549 will <strong>improve performances by 8.46%</strong></h3>
<p><sub>Comparing <code>lint-options</code> (8827264) with <code>main</code> (39ddad7)</sub></p>
<h3>Summary</h3>
<p><code>âš¡ 7</code> improvements
<code>âœ… 18</code> untouched benchmarks</p>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>main</code> | <code>lint-options</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| âš¡ | <code>linter/default-rules[pydantic/types.py]</code> | 38 ms | 37.2 ms | +2.07% |
| âš¡ | <code>linter/default-rules[numpy/ctypeslib.py]</code> | 18.5 ms | 18.1 ms | +2.27% |
| âš¡ | <code>lexer[unicode/pypinyin.py]</code> | 620.1 Âµs | 592 Âµs | +4.75% |
| âš¡ | <code>linter/default-rules[large/dataset.py]</code> | 94.1 ms | 90.6 ms | +3.88% |
| âš¡ | <code>lexer[numpy/ctypeslib.py]</code> | 2 ms | 1.9 ms | +2.55% |
| âš¡ | <code>lexer[large/dataset.py]</code> | 9.8 ms | 9 ms | +8.46% |
| âš¡ | <code>lexer[pydantic/types.py]</code> | 4.1 ms | 4 ms | +3.69% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-09-21 12:33</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-22 11:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_dev/src/generate_options.rs</code>:85 on 2023-09-22 11:55</div>
            <div class="timeline-body"><p>Add proper sub-headings for options under <code>lint</code>. We actually don't need this yet except if we decide to show the <code>lint.*</code> options on the website.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-22 11:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_macros/src/config.rs</code>:51 on 2023-09-22 11:56</div>
            <div class="timeline-body"><p>I admit, this is a bit hacky but implementing full parsing for serde attributes felt overkill</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-22 11:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_macros/src/config.rs</code>:160 on 2023-09-22 11:56</div>
            <div class="timeline-body"><p>Documentation is only required for top-level settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-22 11:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:61 on 2023-09-22 11:57</div>
            <div class="timeline-body"><p>Please double check that I didn't remove any global option or forgot to move a linter specific option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2023-09-22 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @MichaReiser on 2023-09-22 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @MichaReiser on 2023-09-22 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:71 on 2023-09-22 12:50</div>
            <div class="timeline-body"><p>nit: sort these alphabetically again</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:401 on 2023-09-22 12:53</div>
            <div class="timeline-body"><p>that's something i'd like a macro for (not a review comment)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-09-22 12:59</div>
            <div class="timeline-body"><p>The options become quite long/nested when used in pyproject.toml (which is the default people) when nesting each linter option under <code>tool.ruff.lint.&lt;flake8plugin&gt;.&lt;option-name&gt;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-22 13:33</div>
            <div class="timeline-body"><blockquote>
<p>The options become quite long/nested when used in pyproject.toml (which is the default people) when nesting each linter option under <code>tool.ruff.lint.&lt;flake8plugin&gt;.&lt;option-name&gt;</code>.</p>
</blockquote>
<p>Yeah, I noticed that too. I think we want to reconsider how we configure rules with their settings in the future (rule categorisation). For example, I like clippys lints configuration schema (which avoids the deep nesting)</p>
<pre><code>[tool.ruff.lint]
group.rule = &quot;warn&quot;
group.rule2 = { severity: &quot;allow&quot;, option: xx }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:41 on 2023-09-26 18:11</div>
            <div class="timeline-body"><p>How does this manifest in the documentation? Trying to reconcile this with the PR summary (and also grok the code). Like what does https://docs.astral.sh/ruff/settings look like now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:299 on 2023-09-26 18:11</div>
            <div class="timeline-body"><p>Nit: <code>TODO(micha): </code> or resolve.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:298 on 2023-09-26 18:11</div>
            <div class="timeline-body"><p>You could do this with option chaining, probably, if you want :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:302 on 2023-09-26 18:12</div>
            <div class="timeline-body"><p>Having the options vs. configuration separation is useful here!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:41 on 2023-09-26 18:18</div>
            <div class="timeline-body"><p>Okay, I'm not sure how, but it looks like the docs are basically unchanged (as suggested in the PR summary):</p>
<img width="1792" alt="Screen Shot 2023-09-26 at 2 17 49 PM" src="https://github.com/astral-sh/ruff/assets/1309177/4715c6b3-6024-4117-9eb6-752eb8e59372">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:86 on 2023-09-26 18:24</div>
            <div class="timeline-body"><p>Hmm. I think <code>typing_modules</code> and <code>logger_objects</code> should arguably be treated the same. They're both used to mark modules or objects for multi-file analysis. E.g., if a module is in <code>typing_modules</code>, we assume it's exporting stuff from the standard library <code>typing</code> module. If an object is in <code>logger_objects</code>, we assume it's a <code>logging.Logger</code>.</p>
<p>I think these can probably both be part of the <code>lint</code> section.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:61 on 2023-09-26 18:24</div>
            <div class="timeline-body"><p>Confirming that I spent some time looking through.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-09-26 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2023-09-26 18:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-26 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:41 on 2023-09-26 20:05</div>
            <div class="timeline-body"><p>They are unchanged because the new lint field isn't attributed with option_group</p>
<p>We could change that but I think it would make it too verbose. The only real alternative IMO is to add alias support</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-26 20:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:41 on 2023-09-26 20:37</div>
            <div class="timeline-body"><p>This end-result seems right to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:401 on 2023-09-27 06:21</div>
            <div class="timeline-body"><p>Potentially, but then, macros are hard to understand and its not so much trouble to write it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-27 06:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-27 06:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:298 on 2023-09-27 06:24</div>
            <div class="timeline-body"><p>Not sure how, the following doesn't work because <code>combine</code> consumes <code>options.lint_top_level</code>:</p>
<pre><code class="language-rust">let lint = options.lint.map_or_else(|| options.lint_top_level, |lint| lint.combine(options.lint_top_level))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-27 06:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:302 on 2023-09-27 06:24</div>
            <div class="timeline-body"><p>It is. It also makes sense in many other places. I'm fairly happy with our <code>Options</code> -&gt; <code>Configuration</code> -&gt; <code>Settings</code> separation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-09-27 06:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-09-27 06:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-27 06:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-27 06:46</div>
            <div class="timeline-body"><h3>Merge Activity</h3>
<ul>
<li><strong>Sep 27, 2:46 AM</strong>: @MichaReiser merged this pull request with <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7549">Graphite</a>.</li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:39:47 UTC
    </footer>
</body>
</html>
