<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`DJ`] Add `django-model-with-dunder-unicode` - astral-sh/ruff #12607</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>DJ</code>] Add <code>django-model-with-dunder-unicode</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12607">#12607</a>
        opened by <a href="https://github.com/Amar1729">@Amar1729</a>
        on 2024-08-01 05:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Amar1729">@Amar1729</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Derived from a <a href="https://docs.datadoghq.com/code_analysis/static_analysis_rules/python-django/no-unicode-on-models/">datadog rule</a>, I've implemented a check for a Django model implementing a <code>__unicode__</code> method. This was a python2-ism that is not used anymore (as of Python 3.0).</p>
<ul>
<li><a href="https://docs.djangoproject.com/en/1.11/topics/python3/#str-and-unicode-methods">Link to Django docs</a> from 1.11 explaining why it's no longer necessary</li>
</ul>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>This method is probably quite uncommon by now, but i recently ran into a legacy codebase where <code>__unicode__()</code> was still defined and figured it might be helpful to write a simple rule for it. I believe this method was common in Django projects at the time, but it's entirely possibly to have defined a <code>__unicode__</code> method outside of using Django; as such, I'm not sure if it makes sense to put this rule somewhere else (e.g. PYUP?) and make it more general, to any kind of class. Either way, it's not directly derived from either of those checkers, and so I'm not sure either if <code>DJ014</code> is necessarily the best number for it. Thoughts?</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<ul>
<li><code>cargo run -p ruff -- check crates/ruff_linter/resources/test/fixtures/flake8_django/DJ014.py --no-cache --preview --select DJ014</code></li>
<li><code>cargo test</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-01 06:16</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-08-09 02:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-08-09 02:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-09 02:08</div>
            <div class="timeline-body"><p>This looks reasonable to me, but would be helpful to have a second opinion -- maybe @AlexWaygood or @carljm with Django expertise?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-08-09 06:18</div>
            <div class="timeline-body"><p>I think this rule makes sense, but I don't think there should be anything Django specific about it. The <code>__unicode__</code> method was part of the Python 2 data model and is not part of the Python 3 data model, so it makes sense to lint against its definition anywhere in a Python 3 only code base, as it isn't doing what the author likely thought it might do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-09 09:12</div>
            <div class="timeline-body"><p>Would this already be caught by PLW3201? If not, should it be?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-09 15:57</div>
            <div class="timeline-body"><blockquote>
<p>Would this already be caught by PLW3201?</p>
</blockquote>
<p>Nope, this doesn't seem to be the case today <a href="https://play.ruff.rs/af09fdd6-7a62-4a67-b224-39b40970a2a3">playground</a></p>
<p>Including it in <code>PLW3201</code> does make sense to me if the method was removed entirely. Although it could be nice to have a more specific error message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-09 16:01</div>
            <div class="timeline-body"><blockquote>
<p>Including it in <code>PLW3201</code> does make sense to me if the method was removed entirely.</p>
</blockquote>
<p>The special handling of the method has been removed from Python's data model. I wouldn't say that the <em>method</em> was removed, since you can still define it on any class you like, and you won't get an error. It's just that it now behaves as a normal method rather than one that has any special semantics. But anybody defining it on any class is almost certainly doing so erroneously, because they think that it will have special semantics when it won't.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Amar1729">@Amar1729</a> on 2024-08-10 14:27</div>
            <div class="timeline-body"><p>Hm, is there a straightforward way within the PLW3201 ruff code to output an extra message for a specific case? or would it make more sense to introduce a new code eg PLW3202 deprecated-dunder? (are there even any other deprecated dunder methods?*)</p>
<p>*edit: a <a href="https://stackoverflow.com/questions/70316851/do-python-2-and-3-share-the-same-set-of-magic-methods">quick search of the docs</a> indicates some magic methods in py2 documentation that aren't mentioned in docs for py3. i don't know about some of them but <code>__cmp__</code> for example is also no longer used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-13 15:49</div>
            <div class="timeline-body"><p>@carljm do you know if there are any other dunder methods that were deprecated as part of Python 3?</p>
<p>@Amar1729 here's an example of a rule that uses different messages.</p>
<p>https://github.com/astral-sh/ruff/blob/18452cf477390e849979df46dbceb88a8c3dfbe1/crates/ruff_linter/src/rules/pylint/rules/assert_on_string_literal.rs#L28-L43</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-13 15:58</div>
            <div class="timeline-body"><blockquote>
<p>@carljm do you know if there are any other dunder methods that were deprecated as part of Python 3?</p>
</blockquote>
<p>Four that I know off, offhand, are <code>__div__</code>, <code>__rdiv__</code>, <code>__idiv__</code> and <code>__nonzero__</code>. <code>__metaclass__</code> also has no special meaning in Python 3, though it was never a special method, just a special attribute.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-08-13 16:16</div>
            <div class="timeline-body"><p>In addition to the ones Alex mentioned, these are also all gone in Python 3: <code>__cmp__</code>, <code>__getslice__</code>, <code>__setslice__</code>, <code>__delslice__</code>, <code>__oct__</code>, <code>__hex__</code>, <code>__members__</code>, <code>__methods__</code>, <code>__nonzero__</code>, <code>__rdiv__</code>, <code>__idiv__</code>. There may be others, that's just what I found in https://docs.python.org/3/whatsnew/3.0.html plus some I already knew of (it doesn't seem like they are all listed in that doc.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2024-08-13 16:55</div>
            <div class="timeline-body"><p>Other removed dunder methods are <code>__coerce__</code>, <code>__long__</code>, and <code>__rcmp__</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-14 07:14</div>
            <div class="timeline-body"><p>Thanks @Amar1729 for creating this PR and triggering this discussion. Considering that <code>PLW3201</code> already covers this (in preview mode), I suggest extending the rule to give a custom error message if it detects any Python 2  dunder methods. Would you be interested on PRing this change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-08-14 07:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-14 07:19</div>
            <div class="timeline-body"><p>I created an issue for the improvement</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-14 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Amar1729">@Amar1729</a> on 2024-08-14 13:51</div>
            <div class="timeline-body"><p>no problem! a new PR sounds good, I'll see what I can do.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:05:37 UTC
    </footer>
</body>
</html>
