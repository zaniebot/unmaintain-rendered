<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Make `FileResolver::path` return a full path - astral-sh/ruff #20550</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Make <code>FileResolver::path</code> return a full path</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20550">#20550</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-09-24 13:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-24 13:50</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes https://github.com/astral-sh/ty/issues/1242</p>
<p>From finding references with the LSP, <code>FileResolver::path</code> is only called once, in <code>UnifiedFile::path</code>, so I went through those references, and it looked safe to make this change in every case. Most of the references are in the various output formats, where we inherited the absolute vs relative path decision from Ruff. Two other uses are as fallbacks if converting a relativized path to a string fails. Finally, we use the path for sorting and in <code>UnifiedFile::relative_path</code>.</p>
<h2>Test Plan</h2>
<p>Existing tests, with snapshots updated to show absolute paths (in the <code>TestDb</code> this just added a <code>/</code> in front of the file names). I also updated the GitLab CLI test to set the <code>CI_PROJECT_DIR</code> environment variable and ran a test in GitLab CI:</p>
<p><img width="613" height="114" alt="image" src="https://github.com/user-attachments/assets/8ab81dba-54fd-4a24-9110-77ef89293cff" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-24 13:53</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-24 13:53</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-24 13:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:13 on 2025-09-24 13:56</div>
            <div class="timeline-body"><p>Were those paths (and in other output formatters) relative or absolute before you migrated the renderers to the new diagnostic output? Some folks might depend on paths being relative or absolute.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-24 14:03</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-24 14:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:13 on 2025-09-24 14:06</div>
            <div class="timeline-body"><p>They were always absolute in Ruff (they just used <code>SourceFile::name</code>, which is still the case now just via <code>UnifiedFile</code>). JSON for example:</p>
<pre><code>&gt; uvx ruff@0.9.0 check try.py --output-format json | jq '.[].filename'
&quot;/tmp/tmp.9hyS01e8LF/try.py&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-09-24 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @ntBre on 2025-09-24 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @ntBre on 2025-09-24 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @ntBre on 2025-09-24 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-09-24 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @ntBre on 2025-09-24 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @ntBre on 2025-09-24 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @ntBre on 2025-09-24 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @ntBre on 2025-09-24 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:13 on 2025-09-24 15:09</div>
            <div class="timeline-body"><p>I guess I'm slightly confused why the snapshots change...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-24 15:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-09-24 15:10</div>
            <div class="timeline-body"><p>Looks good, if we're certain that this isn't a behavior change for Ruff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-24 15:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:13 on 2025-09-24 15:14</div>
            <div class="timeline-body"><p>The snapshots in <code>ruff_db</code> use the <code>TestDb</code> infrastructure shared with ty. The Ruff snapshots like <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff/tests/snapshots/lint__output_format_json.snap"><code>lint__output_format_json.snap</code></a> from the Ruff CLI tests didn't change.</p>
<p>I probably should have made that more clear in the summary.</p>
<p>This shouldn't affect anything on the Ruff side, only formats using a <code>Db</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-09-24 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-24 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-24 17:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:40:54 UTC
    </footer>
</body>
</html>
