<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Carry generic context through when converting class into `Callable` - astral-sh/ruff #21798</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Carry generic context through when converting class into <code>Callable</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21798">#21798</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2025-12-04 19:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a></div>
            <div class="timeline-body"><p>When converting a class (whether specialized or not) into a <code>Callable</code> type, we should carry through any generic context that the constructor has. This includes both the generic context of the class itself (if it&#x27;s generic) and of the constructor methods (if they are separately generic).</p>
<p>To help test this, this also updates the <code>generic_context</code> extension function to work on <code>Callable</code> types and unions; and adds a new <code>into_callable</code> extension function that works just like <code>CallableTypeOf</code>, but on value forms instead of type forms.</p>
<p>Pulled this out of #21551 for separate review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-04 19:58</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-04 20:00</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>bidict (https://github.com/jab/bidict)
+ bidict/_base.py:501:9: error[no-matching-overload] No overload of bound method `update` matches arguments
- Found 14 diagnostics
+ Found 15 diagnostics

werkzeug (https://github.com/pallets/werkzeug)
- src/werkzeug/datastructures/structures.py:951:46: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 367 diagnostics
+ Found 366 diagnostics

dulwich (https://github.com/dulwich/dulwich)
- dulwich/config.py:361:80: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 226 diagnostics
+ Found 225 diagnostics

typeshed-stats (https://github.com/AlexWaygood/typeshed-stats)
+ src/typeshed_stats/gather.py:1000:35: warning[unused-ignore-comment] Unused `ty: ignore` directive
- Found 16 diagnostics
+ Found 17 diagnostics

mypy (https://github.com/python/mypy)
- mypy/typeshed/stdlib/_ctypes.pyi:104:55: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- mypy/typeshed/stdlib/_io.pyi:268:43: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 1783 diagnostics
+ Found 1781 diagnostics

meson (https://github.com/mesonbuild/meson)
+ mesonbuild/utils/universal.py:613:9: error[invalid-method-override] Invalid override of method `default_missing`: Definition is incompatible with `PerMachineDefaultable.default_missing`
- Found 1917 diagnostics
+ Found 1918 diagnostics

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
- bson/son.py:162:15: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 458 diagnostics
+ Found 457 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
+ src/integrations/prefect-ray/prefect_ray/task_runners.py:242:9: error[invalid-method-override] Invalid override of method `submit`: Definition is incompatible with `TaskRunner.submit`
+ src/prefect/_internal/concurrency/waiters.py:141:9: error[invalid-method-override] Invalid override of method `wait`: Definition is incompatible with `Waiter.wait`
+ src/prefect/_internal/concurrency/waiters.py:259:15: error[invalid-method-override] Invalid override of method `wait`: Definition is incompatible with `Waiter.wait`
+ src/prefect/server/database/dependencies.py:282:9: error[invalid-method-override] Invalid override of method `__get__`: Definition is incompatible with `PrefectDescriptorBase.__get__`
- Found 4952 diagnostics
+ Found 4956 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ ddtrace/testing/internal/test_data.py:140:15: warning[unsupported-base] Unsupported class base with type `&lt;class &#x27;TestItem[Test, Never]&#x27;&gt; | &lt;class &#x27;TestItem[Unknown, Unknown]&#x27;&gt;`
- Found 8331 diagnostics
+ Found 8332 diagnostics

scipy-stubs (https://github.com/scipy/scipy-stubs)
+ scipy-stubs/_lib/_docscrape.pyi:42:9: error[invalid-method-override] Invalid override of method `__iter__`: Definition is incompatible with `Iterable.__iter__`
- Found 95 diagnostics
+ Found 96 diagnostics

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
+ src/scikit_build_core/_logging.py:153:13: warning[unsupported-base] Unsupported class base with type `&lt;class &#x27;Mapping[str, Style]&#x27;&gt; | &lt;class &#x27;Mapping[str, Divergent]&#x27;&gt;`
- Found 38 diagnostics
+ Found 39 diagnostics

aiohttp (https://github.com/aio-libs/aiohttp)
- aiohttp/web_server.py:74:71: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 179 diagnostics
+ Found 178 diagnostics

bokeh (https://github.com/bokeh/bokeh)
+ src/bokeh/core/property/container.py:138:9: error[invalid-method-override] Invalid override of method `wrap`: Definition is incompatible with `Property.wrap`
+ src/bokeh/core/property/container.py:165:9: error[invalid-method-override] Invalid override of method `wrap`: Definition is incompatible with `Property.wrap`
- Found 856 diagnostics
+ Found 858 diagnostics

django-stubs (https://github.com/typeddjango/django-stubs)
- django-stubs/contrib/admin/options.pyi:330:106: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- django-stubs/contrib/admin/options.pyi:331:106: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- django-stubs/contrib/admin/options.pyi:332:104: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ django-stubs/core/files/base.pyi:49:9: error[invalid-method-override] Invalid override of method `write`: Definition is incompatible with `IO.write`
- django-stubs/db/models/expressions.pyi:247:38: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- django-stubs/utils/datastructures.pyi:83:63: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 440 diagnostics
+ Found 436 diagnostics

pandas-stubs (https://github.com/pandas-dev/pandas-stubs)
- pandas-stubs/_typing.pyi:1209:16: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 5514 diagnostics
+ Found 5513 diagnostics

egglog-python (https://github.com/egraphs-good/egglog-python)
+ python/egglog/egraph.py:2259:60: error[invalid-type-arguments] Type `COST@_CostModel` is not assignable to upper bound `_Cost` of type variable `_COST@CostModel`
- Found 1489 diagnostics
+ Found 1490 diagnostics


</code></pre>


<p>No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-04 20:20</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>unused-ignore-comment</code> | 1 | 11 | 0 |
| <code>invalid-method-override</code> | 9 | 0 | 0 |
| <code>unsupported-base</code> | 3 | 0 | 0 |
| <code>invalid-type-arguments</code> | 1 | 0 | 0 |
| <code>no-matching-overload</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>15</strong> | <strong>11</strong> | <strong>0</strong> |</p>
<p><strong><a href="https://dcreager-generic-context-of.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://dcreager-generic-context-of.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-04 20:27</div>
            <div class="timeline-body"><p>The ecosystem changes are largely due to picking up more Liskov violations, like the TODO that was removed from the <code>liskov.md</code> mdtest</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-12-05 01:39</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-05 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dcreager">@dcreager</a> on 2025-12-05 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-05 13:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:21:24 UTC
    </footer>
</body>
</html>
