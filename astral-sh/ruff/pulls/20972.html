<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pydoclint`] Support NumPy-style comma-separated parameters (`DOC102`) - astral-sh/ruff #20972</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pydoclint</code>] Support NumPy-style comma-separated parameters (<code>DOC102</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20972">#20972</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-10-19 21:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a></div>
            <div class="timeline-body">Summary
<p>Fixes #20959. Enhanced the DOC102 rule to recognize and validate multiple parameters listed together in NumPy-style docstrings using comma separation.</p>
Problem Analysis
<p>The existing DOC102 rule failed to detect extraneous parameters when NumPy-style docstrings combined multiple parameters with commas (e.g., <code>x1, x2 : object</code>), causing false negatives.</p>
Approach
<p>Updated the <code>parse_parameters_numpy</code> function to split comma-separated parameter names and validate each individually, added comprehensive test cases covering the original issue and edge cases, and ensured code compliance with project standards.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-19 22:03</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:672 on 2025-10-22 16:22</div>
            <div class="timeline-body"><p>I think this is just</p>
<pre><code>                                + param_part_trimmed.text_len();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:668 on 2025-10-22 16:27</div>
            <div class="timeline-body"><pre><code>                                + TextSize::try_from(param_start_in_line).unwrap();
</code></pre>
<p>This is one of the rare cases where plain <code>unwrap</code> is fine. Any usize within a document that we&#x27;re linting (and in this case an offset within a single line) should definitely be convertible into a u32 or <code>TextSize</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:665 on 2025-10-22 16:47</div>
            <div class="timeline-body"><p>Let&#x27;s just make this an <code>unwrap</code> too. We&#x27;re searching for a substring in a line we just split, so it should be okay. And if we end up unwrapping to zero  somehow, the rendered range could look really bad. It might be worth a short safety comment to that effect, e.g.:</p>
<blockquote>
<p>Safety: searching for a substring we just split above</p>
</blockquote>
<p>Ideally I feel like we&#x27;d just update the <code>current_pos</code> or a similar offset value as we go instead of <code>find</code>ing after the fact, but I think that&#x27;s hard to do with <code>split</code>, so this seems okay.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-10-22 16:48</div>
            <div class="timeline-body"><p>Thanks! Just a few nits</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-22 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-22 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/danparizher">@danparizher</a> on 2025-10-24 21:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2025-10-30 22:37</div>
            <div class="timeline-body"><p>Can you add a test case for a type less docstring with comma, e.g.:</p>
<pre><code>def add_numbers(a, b):
    &quot;&quot;&quot;
    Adds two numbers and returns the result.

    Parameters
    ----------
    a, b
        The numbers to add.

    Returns
    -------
    int
        The sum of the two numbers.
    &quot;&quot;&quot;
    return a + b
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:664 on 2025-11-10 12:37</div>
            <div class="timeline-body"><p>I suspect that the <code>trim_end</code> call here now is unnecessary, given that you also trim each parameter part.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:673 on 2025-11-10 12:40</div>
            <div class="timeline-body"><p>I&#x27;d be inclined to keep track of the offset instead of finding the parameter aggain.</p>
<pre><code>let mut current_offset = TextSize::MIN;

for param_part in ... {
	...

	let param_start_in_line = current_offset + (param_part.text_len() - param_part_trimmed.text_len());

	current_offset = current_offset + param_part.text_len() + &#x27;,&#x27;.text_len()
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:684 on 2025-11-10 12:41</div>
            <div class="timeline-body"><pre><code>                                range: TextRange::at(
                                    content_start + param_start,
                                    param_part_trimmed.text_len(),
                                ),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-11-10 12:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a> reviewed on 2025-11-10 20:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/danparizher">@danparizher</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:664 on 2025-11-10 20:54</div>
            <div class="timeline-body"><p>Removing it causes incorrect column positions in the diagnostic ranges, from my testing.</p>
<p>Even though we <code>trim()</code> each parameter part, the offset calculation happens before trimming, so the trailing whitespace in <code>before_colon</code> affects the positions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-11 11:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:677 on 2025-11-11 11:07</div>
            <div class="timeline-body"><p>This seems unnecessarily complicated to go from <code>TextSize -&gt; u32 -&gt; TextSize</code>. Can you say more why you added that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a> reviewed on 2025-11-11 21:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/danparizher">@danparizher</a> on <code>crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs</code>:677 on 2025-11-11 21:26</div>
            <div class="timeline-body"><p>Oversight on my part - Since both <code>param_part.text_len()</code> and <code>param_part_trimmed.text_len()</code> return <code>TextSize</code>, we can subtract them directly without the conversion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-11-12 07:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-12 07:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-12 07:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-12 07:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:42 UTC
    </footer>
</body>
</html>
