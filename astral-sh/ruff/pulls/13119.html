<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disable E741 in stub files - astral-sh/ruff #13119</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Disable E741 in stub files</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13119">#13119</a>
        opened by <a href="https://github.com/calumy">@calumy</a>
        on 2024-08-26 22:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/calumy">@calumy</a> on 2024-08-26 22:52</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>As noted in #10569, E741 should not be active in <code>.pyi</code> files as the file author does not control the variable name. Instead, this is deferred to the author of the package for which the stub file is substituting for.</p>
<p>My rust skills are being stretched here. I assume there is a more elegant way of implementing the check <code>checker.source_type != PySourceType::Stub</code> in the <code>ambiguous_variable_name</code> function so that it is only implemented in one place (similar to <code>non_unique_enums</code>); however, I can't get the borrow checker to agree to this.</p>
<h2>Test Plan</h2>
<p>Added a new test case were <code>E741.py</code> was duplicated and renamed to <code>E741.pyi</code> and a snapshot to confirm that no errors were raised for this new case as E741 should be disabled in <code>.pyi</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-26 23:06</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-08-27 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-08-27 13:51</div>
            <div class="timeline-body"><p>Thanks @calumy, this is great! I pushed a few small fixups to your PR:</p>
<ol>
<li>I made the change preview-only for now; we can stabilise it in Ruff 0.7. Strictly speaking we could <em>probably</em> get away with doing this in a patch release, since it's a reduction in scope rather than an increase in scope -- but it's still a big <em>change</em> in scope, so I feel much safer doing it in preview only first :-)</li>
<li>I added some docs on how it works differently for <code>.pyi</code> files</li>
<li>I made it a bit more DRY by putting the check for whether it's a stub file in the <code>ambiguous_variable_name()</code> function itself, so we don't have to repeat it everywhere.</li>
</ol>
<p>LMK if you'd like me to explain any of it, very happy to do so :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @AlexWaygood on 2024-08-27 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-08-27 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-08-27 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2024-08-27 14:56</div>
            <div class="timeline-body"><blockquote>
<p>Thanks @calumy, this is great! I pushed a few small fixups to your PR:</p>
<ol>
<li>I made the change preview-only for now; we can stabilise it in Ruff 0.7. Strictly speaking we could <em>probably</em> get away with doing this in a patch release, since it's a reduction in scope rather than an increase in scope -- but it's still a big <em>change</em> in scope, so I feel much safer doing it in preview only first :-)</li>
<li>I added some docs on how it works differently for <code>.pyi</code> files</li>
<li>I made it a bit more DRY by putting the check for whether it's a stub file in the <code>ambiguous_variable_name()</code> function itself, so we don't have to repeat it everywhere.</li>
</ol>
<p>LMK if you'd like me to explain any of it, very happy to do so :-)</p>
</blockquote>
<p>All makes sense to me; thanks for laying it out clearly.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:39:02 UTC
    </footer>
</body>
</html>
