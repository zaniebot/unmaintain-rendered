<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid parsing joint rule codes as distinct codes in `# noqa` - astral-sh/ruff #12809</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid parsing joint rule codes as distinct codes in <code># noqa</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12809">#12809</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-08-11 23:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>We should enable warnings for unsupported codes, but this at least fixes the parsing for <code># noqa: F401F841</code>.</p>
<p>Closes https://github.com/astral-sh/ruff/issues/12808.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-11 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by @charliermarsh on 2024-08-11 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-08-11 23:20</div>
            <div class="timeline-body"><p><a href="https://doc.rust-lang.org/std/primitive.char.html#method.is_alphanumeric"><code>is_alphanumeric()</code></a> also allows non-ASCII-digits and letters:</p>
<pre><code class="language-py"># noqa: A三
</code></pre>
<p>Did you mean to use <a href="https://doc.rust-lang.org/std/primitive.char.html#method.is_ascii_alphanumeric"><code>is_ascii_alphanumeric()</code></a> instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-11 23:22</div>
            <div class="timeline-body"><p>Seems reasonable to exclude non-ASCII.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-08-11 23:28</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/charlie/parse">CodSpeed Performance Report</a></h2>
<h3>Merging #12809 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>charlie/parse</code> (c2e9746) with <code>main</code> (f837428)</sub></p>
<h3>Summary</h3>
<p><code>✅ 32</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-08-11 23:31</div>
            <div class="timeline-body"><p>On that same note, <a href="https://doc.rust-lang.org/std/primitive.char.html#method.is_whitespace"><code>is_whitespace()</code></a> and <a href="https://doc.rust-lang.org/std/primitive.str.html#method.trim"><code>trim_start()</code> / <code>trim_end()</code></a> also handle Unicode whitespace. They should be replaced with <a href="https://doc.rust-lang.org/std/primitive.char.html#method.is_ascii_whitespace"><code>is_ascii_whitespace()</code></a> and <a href="https://doc.rust-lang.org/std/primitive.str.html#method.trim_ascii"><code>trim_ascii_start()</code> / <code>trim_ascii_end()</code></a>, accordingly.</p>
<p>&quot;ASCII whitespace&quot; is <a href="https://doc.rust-lang.org/std/primitive.u8.html#method.is_ascii_whitespace">defined</a> as &quot;space, tab, LF, FF, CR&quot;. In our case, since Python comments don't allow line breaks, that boils down to just spaces and tabs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-11 23:36</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+3 -0 violations, +0 -0 fixes in 2 projects; 52 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/229c6a3e4673db03119c78828e546ebae272ef75/providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py#L45'>providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py:45:37:</a> RUF100 [*] Unused `noqa` directive (unknown: `Ignore`)
+ <a href='https://github.com/apache/airflow/blob/229c6a3e4673db03119c78828e546ebae272ef75/providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py#L50'>providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py:50:38:</a> RUF100 [*] Unused `noqa` directive (unknown: `Ignore`)
+ <a href='https://github.com/apache/airflow/blob/229c6a3e4673db03119c78828e546ebae272ef75/providers/src/airflow/providers/google/cloud/hooks/bigquery.py#L59'>providers/src/airflow/providers/google/cloud/hooks/bigquery.py:59:42:</a> RUF100 [*] Unused `noqa` directive (unknown: `Used`)
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+0 -0 violations, +0 -0 fixes)</summary>
<p>

<pre>
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF100 | 3 | 3 | 0 | 0 | 0 |</p>
</p>
</details>

<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+3 -0 violations, +0 -0 fixes in 1 projects; 53 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/229c6a3e4673db03119c78828e546ebae272ef75/providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py#L45'>providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py:45:37:</a> RUF100 [*] Unused `noqa` directive (unknown: `Ignore`)
+ <a href='https://github.com/apache/airflow/blob/229c6a3e4673db03119c78828e546ebae272ef75/providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py#L50'>providers/src/airflow/providers/apache/hdfs/sensors/hdfs.py:50:38:</a> RUF100 [*] Unused `noqa` directive (unknown: `Ignore`)
+ <a href='https://github.com/apache/airflow/blob/229c6a3e4673db03119c78828e546ebae272ef75/providers/src/airflow/providers/google/cloud/hooks/bigquery.py#L59'>providers/src/airflow/providers/google/cloud/hooks/bigquery.py:59:42:</a> RUF100 [*] Unused `noqa` directive (unknown: `Used`)
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF100 | 3 | 3 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-11 23:41</div>
            <div class="timeline-body"><p>But Python comments can contain non-ASCII whitespace? We already have an <code>is_python_whitespace</code> that respects the spec for tokens: https://docs.python.org/3/reference/lexical_analysis.html#whitespace-between-tokens</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-08-11 23:57</div>
            <div class="timeline-body"><blockquote>
<p>But Python comments can contain non-ASCII whitespace?</p>
</blockquote>
<p>Fair enough, though I still don't see why someone would want to use non-ASCII whitespace in the <code>noqa</code> part of a comment. A user might want to write an explanation in their native language in the same comment, sure, but <code>noqa</code> and the rule codes are never localized.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-08-12 03:42</div>
            <div class="timeline-body"><p>One more thing: <code>ParsedFileExemption::try_extract()</code> <a href="https://github.com/astral-sh/ruff/blob/feba5031dca5c5ad1c9b77c2003b2fee738bba93/crates/ruff_linter/src/noqa.rs#L475">currently treats</a> <code>A001 , B002</code> (whitespace before comma) and <code>A001,,B002</code> (empty slot) as if <code>B002</code> doesn't exist. Is this difference in behaviour intended?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-12 03:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/noqa.rs</code>:1202 on 2024-08-12 03:58</div>
            <div class="timeline-body"><p>I think we should show a warning in this case but still parse the remaining codes (if that's possible currently). This would be similar to how we <em>recover</em> from a missing element in list parsing: https://play.ruff.rs/308ab356-9355-43f3-99b7-12c7c2de7334.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-08-12 04:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-11-02 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-02 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-02 20:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:05:51 UTC
    </footer>
</body>
</html>
