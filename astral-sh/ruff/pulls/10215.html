<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pep8_naming`] Add fixes `N804` and `N805` - astral-sh/ruff #10215</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pep8_naming</code>] Add fixes <code>N804</code> and <code>N805</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10215">#10215</a>
        opened by <a href="https://github.com/GtrMo">@GtrMo</a>
        on 2024-03-03 18:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/GtrMo">@GtrMo</a> on 2024-03-03 18:58</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR fixes for <code>invalid-first-argument</code> rules.
The fixes rename the first argument of methods and class methods to the valid one. References to this argument are also renamed.
Fixes are skipped when another argument is named as the valid first argument.
The fix is marked as unsafe due</p>
<p>The functions for the <code>N804</code> and <code>N805</code> rules are now merged, as they only differ by the name of the valid first argument.
The rules were moved from the AST iteration to the deferred scopes to be in the function scope while creating the fix.</p>
<h2>Test Plan</h2>
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-03-03 19:11</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+12 -12 violations, +0 -0 fixes in 2 projects; 41 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+6 -6 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/connection.py#L352'>airflow/models/connection.py:352:18:</a> ANN101 Missing type annotation for `cls` in method
- <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/connection.py#L352'>airflow/models/connection.py:352:18:</a> ANN101 Missing type annotation for `cls` in method
+ <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/connection.py#L384'>airflow/models/connection.py:384:15:</a> ANN101 Missing type annotation for `cls` in method
- <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/connection.py#L384'>airflow/models/connection.py:384:15:</a> ANN101 Missing type annotation for `cls` in method
+ <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/taskinstance.py#L1454'>airflow/models/taskinstance.py:1454:20:</a> ANN101 Missing type annotation for `cls` in method
- <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/taskinstance.py#L1454'>airflow/models/taskinstance.py:1454:20:</a> ANN101 Missing type annotation for `cls` in method
+ <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/variable.py#L96'>airflow/models/variable.py:96:13:</a> ANN101 Missing type annotation for `cls` in method
- <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/airflow/models/variable.py#L96'>airflow/models/variable.py:96:13:</a> ANN101 Missing type annotation for `cls` in method
+ <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/tests/providers/dbt/cloud/hooks/test_dbt.py#L519'>tests/providers/dbt/cloud/hooks/test_dbt.py:519:38:</a> ANN101 Missing type annotation for `hook` in method
- <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/tests/providers/dbt/cloud/hooks/test_dbt.py#L519'>tests/providers/dbt/cloud/hooks/test_dbt.py:519:38:</a> ANN101 Missing type annotation for `hook` in method
+ <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/tests/providers/odbc/hooks/test_odbc.py#L70'>tests/providers/odbc/hooks/test_odbc.py:70:31:</a> ANN101 Missing type annotation for `self` in method
- <a href='https://github.com/apache/airflow/blob/1b4b73e20d2f0826151000368e939238f7d1d137/tests/providers/odbc/hooks/test_odbc.py#L70'>tests/providers/odbc/hooks/test_odbc.py:70:31:</a> ANN101 Missing type annotation for `self` in method
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+6 -6 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L53'>src/bokeh/colors/util.py:53:17:</a> ANN101 Missing type annotation for `self` in method
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L53'>src/bokeh/colors/util.py:53:17:</a> ANN101 Missing type annotation for `self` in method
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L56'>src/bokeh/colors/util.py:56:21:</a> ANN101 Missing type annotation for `self` in method
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L56'>src/bokeh/colors/util.py:56:21:</a> ANN101 Missing type annotation for `self` in method
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L68'>src/bokeh/colors/util.py:68:18:</a> ANN101 Missing type annotation for `self` in method
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L68'>src/bokeh/colors/util.py:68:18:</a> ANN101 Missing type annotation for `self` in method
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L72'>src/bokeh/colors/util.py:72:21:</a> ANN101 Missing type annotation for `self` in method
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/util.py#L72'>src/bokeh/colors/util.py:72:21:</a> ANN101 Missing type annotation for `self` in method
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L65'>tests/unit/bokeh/test_transform.py:65:20:</a> N805 First argument of a method should be named `self`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L65'>tests/unit/bokeh/test_transform.py:65:20:</a> N805 First argument of a method should be named `self`
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L72'>tests/unit/bokeh/test_transform.py:72:27:</a> N805 First argument of a method should be named `self`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L72'>tests/unit/bokeh/test_transform.py:72:27:</a> N805 First argument of a method should be named `self`
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| ANN101 | 20 | 10 | 10 | 0 | 0 |
| N805 | 4 | 2 | 2 | 0 | 0 |</p>
</p>
</details>

<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+3 -3 violations, +0 -0 fixes in 2 projects; 41 projects unchanged)</p>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+2 -2 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L65'>tests/unit/bokeh/test_transform.py:65:20:</a> A002 Argument `object` is shadowing a Python builtin
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L65'>tests/unit/bokeh/test_transform.py:65:20:</a> A002 Argument `object` is shadowing a Python builtin
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L72'>tests/unit/bokeh/test_transform.py:72:27:</a> A002 Argument `object` is shadowing a Python builtin
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/test_transform.py#L72'>tests/unit/bokeh/test_transform.py:72:27:</a> A002 Argument `object` is shadowing a Python builtin
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+1 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/aaa6f1653816e16c29b595d2e38133f2066be08a/zerver/models/realms.py#L1'>zerver/models/realms.py:1:1:</a> D100 Missing docstring in public module
- <a href='https://github.com/zulip/zulip/blob/aaa6f1653816e16c29b595d2e38133f2066be08a/zerver/models/realms.py#L1'>zerver/models/realms.py:1:1:</a> D100 Missing docstring in public module
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| A002 | 4 | 2 | 2 | 0 | 0 |
| D100 | 2 | 1 | 1 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-03-03 20:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pep8_naming/rules/invalid_first_argument_name.rs</code>:260 on 2024-03-03 20:02</div>
            <div class="timeline-body"><p>Can you see if <code>Renamer::rename</code> would be useful here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/GtrMo">@GtrMo</a> reviewed on 2024-03-04 00:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/GtrMo">@GtrMo</a> on <code>crates/ruff_linter/src/rules/pep8_naming/rules/invalid_first_argument_name.rs</code>:260 on 2024-03-04 00:10</div>
            <div class="timeline-body"><p><code>Renamer::rename</code> would rename all <code>first_parameter.name</code> bindings. I wanted to only renaming references to the argument binding, like this:
https://github.com/astral-sh/ruff/blob/90651a281076d91ca06721c59cbc8b469b03ee02/crates/ruff_linter/src/rules/pep8_naming/snapshots/ruff_linter__rules__pep8_naming__tests__N805_N805.py.snap#L241-L245</p>
<p>But I didn't know the <code>Renamer</code> existed, and from what I've tested Pyright lsp also renames with the same logic as the <code>Renamer</code>. I've updated the PR to use it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-04 02:08</div>
            <div class="timeline-body"><p>This is nice work, great job figuring this out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @charliermarsh on 2024-03-04 02:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-03-04 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-04 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-04 09:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:47:54 UTC
    </footer>
</body>
</html>
