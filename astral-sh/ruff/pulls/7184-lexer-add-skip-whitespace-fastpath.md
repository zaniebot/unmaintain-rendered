```yaml
number: 7184
title: "Lexer: Add skip whitespace fastpath"
type: pull_request
state: merged
author: MichaReiser
labels:
  - performance
  - parser
assignees: []
merged: true
base: main
head: lexer-perf-skip-whitespace
created_at: 2023-09-06T09:24:48Z
updated_at: 2023-09-06T14:14:03Z
url: https://github.com/astral-sh/ruff/pull/7184
synced_at: 2026-01-12T02:45:38Z
```

# Lexer: Add skip whitespace fastpath

---

_Pull request opened by @MichaReiser on 2023-09-06 09:24_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

Adds a fast path for skiping whitespace when indentation handling (when inside parentheses) isn't needed. 



<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

This improves performance by about 2-4% when running locally

`cargo test`

<!-- How was it tested? -->


---

_Comment by @MichaReiser on 2023-09-06 09:24_

Current dependencies on/for this PR:
* main
  * **PR #7184** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7184" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7184?utm_source=stack-comment).

---

_@MichaReiser reviewed on 2023-09-06 09:25_

---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/lexer.rs`:592 on 2023-09-06 09:25_

This part is unchanged. Just github being confused

---

_@MichaReiser reviewed on 2023-09-06 09:25_

---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/lexer.rs`:698 on 2023-09-06 09:25_

This is unchanged. Just github being confused

---

_Label `performance` added by @MichaReiser on 2023-09-06 09:28_

---

_Label `parser` added by @MichaReiser on 2023-09-06 09:28_

---

_Review requested from @dhruvmanila by @MichaReiser on 2023-09-06 09:28_

---

_Comment by @github-actions[bot] on 2023-09-06 09:40_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Review comment by @dhruvmanila on `crates/ruff_python_parser/src/lexer.rs`:590 on 2023-09-06 12:18_

If I understand the diff correctly, the whitespace lexing loop is repeated twice. If we're right after the newline only then we'll try to handle indentation otherwise we'll use the fast loop to _not_ handle indentation and skip any whitespace.

---

_@dhruvmanila approved on 2023-09-06 12:19_

This actually makes it quite readable as well. Thanks!

---

_@MichaReiser reviewed on 2023-09-06 12:21_

---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/lexer.rs`:590 on 2023-09-06 12:21_

Yes, that's correct

---

_Merged by @MichaReiser on 2023-09-06 14:14_

---

_Closed by @MichaReiser on 2023-09-06 14:14_

---

_Branch deleted on 2023-09-06 14:14_

---
