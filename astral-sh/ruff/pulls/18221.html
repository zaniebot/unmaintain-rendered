<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule: large number without underscore separators (PEP 515) - astral-sh/ruff #18221</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule: large number without underscore separators (PEP 515)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18221">#18221</a>
        opened by <a href="https://github.com/guillp">@guillp</a>
        on 2025-05-20 15:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/guillp">@guillp</a> on 2025-05-20 15:05</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This adds a rule (with code RUF062) that automatically formats large numbers with underscore separators to make them more readable. This is as described in <a href="https://peps.python.org/pep-0515/">PEP515</a>, and discussed in #12787 which I opened a while back.</p>
<p>E.g:
<code>123456</code> becomes <code>123_456</code>
<code>.12345</code> becomes <code>.123_45</code>
<code>0xDEADBEEF</code> becomes <code>0xDEAD_BEEF</code>
(see <a href="https://github.com/astral-sh/ruff/pull/18221/files#diff-fc9994b8c3092dd604dedd0c9d6a3920f3a5699a69c31915be9ab028c166a6e8">test snapshot</a> for more examples)</p>
<p>This rule works for:</p>
<ul>
<li>integers: if they are 5 digits or more (configurable), the rule will require underscores as thousands, millions, billions, etc. separators. This threshold avoid formatting relatively small integers (<code>9999</code> or less)  since they are already readable enough. <code>123456789</code> gives <code>123_456_789</code></li>
<li>floats: same rules as integers, and the float part is also formatted with those same rules, but the groups are formed left to right (thousandths, millionths, etc.)
<code>123456789.123456789</code> gives <code>123_456_789.123_456_789</code></li>
<li>hexadecimal notation (<code>0xABCD</code>): add underscores to form groups of 4 digits by default (configurable)
<code>0x1234567890ABCD</code> gives <code>0x12_3456_7890_ABCD</code></li>
<li>octal notation (<code>0o1234</code>): add underscores to form groups of 4 digits by default (configurable)
<code>0o1234567</code> gives <code>0o123_4567</code></li>
<li>binary notation (<code>0b1010101</code>): add underscores to from groups of 8 bits (octets) by default (configurable)
<code>0o1010111100100101</code> gives <code>0o10101111_00100101</code></li>
<li>scientific notation (<code>123e10</code>): the leading part is formatted with the same rules as integers. The exponent part is untouched as it should never be more than 3 chars anyway.</li>
<li>positive or negative literals: the leading <code>+</code> or <code>-</code> sign is not part of <code>Expr::NumberLiteral</code> instances once parsed by ruff, so this rule does not modify them in any way, they just stay in place.</li>
<li>any kind of number already containing separators but in the wrong places: number will be reformatted with the defined configuration.</li>
</ul>
<h3>Support for indian-style number formatting:</h3>
<p>According to https://randombits.dev/articles/number-localization/formatting , most of the world groups decimal digits 3 by 3, excepted for India who uses groups of 2 after the first group of 3 (so thousands, hundred of thousands, hundreds of hundreds of thousands, etc.). A configuration option allows enabling this kind of grouping.
I am however not sure about what is the practice for formatting the float part in India. I implemented a &quot;reversed&quot; logic, with separators on thousandth, then hundredth of thousandth, hundredth of hundredth of thousandth, etc. (not sure if anyone ever needed such a float precision ^^'). This may need to be adjusted.</p>
<p>So <code>123456789.123456789</code> formatted with indian mode will give <code>12_34_56_789.123_45_67_89</code></p>
<h2>Test Plan</h2>
<p>A new test file <code>RUF062.py</code> is part of the PR and is executed on <code>cargo test</code>.</p>
<h2>TODO / to discuss</h2>
<ul>
<li>rule code: I took RUF062 as it is the next available in the RUFF group, and I selected this group because I did not see such a rule implemented in any other formatter/linter.</li>
<li>naming of configuration options should be reviewed and probably improved</li>
<li>default config values to be discussed</li>
<li>more tests?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Rule/large number without separators" to "Rule: large number without underscore separators (PEP 515)" by @guillp on 2025-05-20 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-05-20 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2025-05-20 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @guillp on 2025-07-01 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @BurntSushi removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @MichaReiser removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dhruvmanila removed by @AlexWaygood on 2025-07-01 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guillp">@guillp</a> on 2025-07-01 14:11</div>
            <div class="timeline-body"><p>I rebased on current main and changed the code to RUF062 since 061 is now taken by another rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-01 14:13</div>
            <div class="timeline-body"><p>I think something went wrong with the rebase, as GitHub is now showing more than 500 commits and over 100,000 lines changed, which would make it pretty difficult to review!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guillp">@guillp</a> on 2025-07-03 07:13</div>
            <div class="timeline-body"><p>Not sure what I did wrong. But I made some clean-up so there is a single commit on top of current main with all the changes now.
And also I added configuration options for digit group sizes, and also added support for indian-style number formatting.
Edited the PR description to reflect this. Thanks for reviewing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-04 19:26</div>
            <div class="timeline-body"><p>Thanks for tidying up and for your work on this! I think we'll still want to resolve the <code>needs-decision</code> label on the issue before giving this a full review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-07 14:21</div>
            <div class="timeline-body"><p>I agree that we still need to answer the question if we want to have such an opinionated rule that enforces specific grouping of numbers.</p>
<p>I do like clippy's rule that are less opinionated but enforce good practice:</p>
<ul>
<li>Enforce consistent grouping inside a single number: https://rust-lang.github.io/rust-clippy/master/index.html?groups=pedantic%2Cstyle#inconsistent_digit_grouping</li>
<li>Warn about uncommon byte groupings: https://rust-lang.github.io/rust-clippy/master/index.html?groups=pedantic%2Cstyle#unusual_byte_groupings</li>
<li>Too large groups (it's not quiet clear to me what that means): https://rust-lang.github.io/rust-clippy/master/index.html?groups=pedantic%2Cstyle#large_digit_groups</li>
</ul>
<p>The first two seem very useful to me. It's less clear to me if we want to add any more opinionated rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guillp">@guillp</a> on 2025-08-07 14:25</div>
            <div class="timeline-body"><p>I think the point of having an opinionated rule is to allow auto-fixing, which should be suitable for most cases. If some codebase has very specific requirements, the rule should be configurable enough to accommodate them (as long as those requirements are consistent across the whole code-base). Or the rule can be disabled otherwise.</p>
<p>Another different rule that only <em>warns</em> about inconsistent, uncommon or too large grouping (like in clippy) may also be created, and user may choose to activate one or the other. Or even both, because if the &quot;enforcer&quot; rule (from this PR) is ran before the &quot;warning&quot; rule, the former should fix any issue before any warning is issued by the later. Would that suit what you had in mind? I can implement that <em>warning</em> rule if needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-07 15:22</div>
            <div class="timeline-body"><blockquote>
<p>Another different rule that only <em>warns</em> about inconsistent, uncommon or too large grouping (like in clippy) may also be created, and user may choose to activate one or the other. Or even both, because if the &quot;enforcer&quot; rule (from this PR) is ran before the &quot;warning&quot; rule, the former should fix any issue before any warning is issued by the later. Would that suit what you had in mind? I can implement that <em>warning</em> rule if needed.</p>
</blockquote>
<p>I think it would be very unusual, probably unprecedented, to have two overlapping rules with different severities, so I don't think that's a viable option. We do plan to add a warning level/severity (https://github.com/astral-sh/ruff/issues/1256) in the future, though.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:52:42 UTC
    </footer>
</body>
</html>
