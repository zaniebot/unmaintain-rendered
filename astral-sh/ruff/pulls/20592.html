<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix subtyping for dynamic specializations - astral-sh/ruff #20592</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix subtyping for dynamic specializations</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20592">#20592</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-09-26 12:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>Fixes a bug observed by @AlexWaygood where <code>C[Any] &lt;: C[object]</code> should hold for a class that is covariant in its type parameter (and similar subtyping relations involving dynamic types for other variance configurations).</p>
Test Plan
<p>New and updated Markdown tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-09-26 12:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/variance.md</code>:305 on 2025-09-26 12:19</div>
            <div class="timeline-body"><p>I would argue that these tests were asserting the wrong thing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-09-26 12:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/variance.md</code>:312 on 2025-09-26 12:19</div>
            <div class="timeline-body"><p>Same here...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-26 12:21</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-26 12:22</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>mkosi (https://github.com/systemd/mkosi)
+ mkosi/config.py:1857:33: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
+ mkosi/config.py:1866:37: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
+ mkosi/config.py:2433:33: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
+ mkosi/config.py:2442:40: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
- Found 110 diagnostics
+ Found 114 diagnostics

pydantic (https://github.com/pydantic/pydantic)
- pydantic/v1/utils.py:610:17: error[invalid-argument-type] Argument to function `assert_never` is incorrect: Expected `Never`, found `(Unknown &amp; ~Top[Mapping[Unknown, object]] &amp; ~AbstractSet[object]) | (AbstractSet[@Todo] &amp; ~Top[Mapping[Unknown, object]] &amp; ~AbstractSet[object])`
+ pydantic/v1/utils.py:610:17: error[invalid-argument-type] Argument to function `assert_never` is incorrect: Expected `Never`, found `Unknown &amp; ~Top[Mapping[Unknown, object]] &amp; ~AbstractSet[object]`

tornado (https://github.com/tornadoweb/tornado)
- tornado/template.py:829:14: error[unsupported-operator] Operator `&lt;` is not supported for types `slice[Any, Any, Any]` and `int`, in comparing `int | slice[Any, Any, Any]` with `Literal[0]`
- Found 250 diagnostics
+ Found 249 diagnostics

pandera (https://github.com/pandera-dev/pandera)
+ pandera/engines/utils.py:73:47: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 1584 diagnostics
+ Found 1585 diagnostics

vision (https://github.com/pytorch/vision)
- torchvision/prototype/utils/_internal.py:34:82: error[invalid-argument-type] Argument is incorrect: Expected `Sequence[str]`, found `Sequence[object] | list[Unknown]`
+ torchvision/prototype/utils/_internal.py:34:82: error[invalid-argument-type] Argument is incorrect: Expected `Sequence[str]`, found `Sequence[object]`
- torchvision/transforms/functional.py:168:61: warning[possibly-missing-attribute] Attribute `mode` on type `(Image &amp; ~ndarray[object, object]) | (ndarray[@Todo, Unknown] &amp; ~ndarray[object, object])` may be missing
- torchvision/transforms/functional.py:170:8: warning[possibly-missing-attribute] Attribute `mode` on type `(Image &amp; ~ndarray[object, object]) | (ndarray[@Todo, Unknown] &amp; ~ndarray[object, object])` may be missing
- torchvision/transforms/functional.py:172:20: error[non-subscriptable] Cannot subscript object of type `int` with no `__getitem__` method
- torchvision/transforms/functional.py:172:33: error[non-subscriptable] Cannot subscript object of type `int` with no `__getitem__` method
- torchvision/tv_tensors/_tv_tensor.py:82:90: error[index-out-of-bounds] Index 0 is out of bounds for tuple `tuple[()]` with length 0
- Found 1478 diagnostics
+ Found 1473 diagnostics

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
- bson/json_util.py:1015:9: error[invalid-assignment] Method `__setitem__` of type `bound method dict[int, (Any, JSONOptions, /) -&gt; Any].__setitem__(key: int, value: (Any, JSONOptions, /) -&gt; Any, /) -&gt; None` cannot be called with a key of type `object` and a value of type `((Any, JSONOptions, /) -&gt; Any) | ((obj: Any, dummy0: Any) -&gt; Any) | ((obj: bytes, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: datetime, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: Any, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: int | float, json_options: JSONOptions) -&gt; Any) | ((obj: int, json_options: JSONOptions) -&gt; Any) | ((obj: UUID, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: Binary, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: Int64, json_options: JSONOptions) -&gt; Any) | ((obj: Code, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: DBRef, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((dummy0: Any, dummy1: Any) -&gt; dict[Unknown, Unknown]) | ((obj: ObjectId, dummy0: Any) -&gt; dict[Unknown, Unknown]) | ((obj: Timestamp, dummy0: Any) -&gt; dict[Unknown, Unknown])` on object of type `dict[int, (Any, JSONOptions, /) -&gt; Any]`
+ bson/json_util.py:1015:9: error[invalid-assignment] Method `__setitem__` of type `bound method dict[int, (Any, JSONOptions, /) -&gt; Any].__setitem__(key: int, value: (Any, JSONOptions, /) -&gt; Any, /) -&gt; None` cannot be called with a key of type `object` and a value of type `((Any, JSONOptions, /) -&gt; Any) | ((obj: Any, dummy0: Any) -&gt; Any) | ((obj: Binary, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: datetime, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: Any, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: int | float, json_options: JSONOptions) -&gt; Any) | ((obj: int, json_options: JSONOptions) -&gt; Any) | ((obj: UUID, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: Int64, json_options: JSONOptions) -&gt; Any) | ((obj: Code, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((obj: DBRef, json_options: JSONOptions) -&gt; dict[Unknown, Unknown]) | ((dummy0: Any, dummy1: Any) -&gt; dict[Unknown, Unknown]) | ((obj: ObjectId, dummy0: Any) -&gt; dict[Unknown, Unknown]) | ((obj: Timestamp, dummy0: Any) -&gt; dict[Unknown, Unknown])` on object of type `dict[int, (Any, JSONOptions, /) -&gt; Any]`

apprise (https://github.com/caronc/apprise)
- apprise/utils/parse.py:790:5: error[unsupported-operator] Operator `+=` is unsupported between objects of type `None` and `Unknown | None | str | dict[Unknown, Unknown] | (Unknown &amp; ~AlwaysFalsy) | (dict[Unknown, Unknown] &amp; ~AlwaysFalsy)`
+ apprise/utils/parse.py:790:5: error[unsupported-operator] Operator `+=` is unsupported between objects of type `None` and `Unknown | None | str | dict[Unknown, Unknown] | (Unknown &amp; ~AlwaysFalsy)`
- apprise/utils/parse.py:790:5: error[unsupported-operator] Operator `+=` is unsupported between objects of type `str` and `Unknown | None | str | dict[Unknown, Unknown] | (Unknown &amp; ~AlwaysFalsy) | (dict[Unknown, Unknown] &amp; ~AlwaysFalsy)`
+ apprise/utils/parse.py:790:5: error[unsupported-operator] Operator `+=` is unsupported between objects of type `str` and `Unknown | None | str | dict[Unknown, Unknown] | (Unknown &amp; ~AlwaysFalsy)`
- apprise/utils/parse.py:790:5: error[unsupported-operator] Operator `+=` is unsupported between objects of type `dict[Unknown, Unknown]` and `Unknown | None | str | dict[Unknown, Unknown] | (Unknown &amp; ~AlwaysFalsy) | (dict[Unknown, Unknown] &amp; ~AlwaysFalsy)`
+ apprise/utils/parse.py:790:5: error[unsupported-operator] Operator `+=` is unsupported between objects of type `dict[Unknown, Unknown]` and `Unknown | None | str | dict[Unknown, Unknown] | (Unknown &amp; ~AlwaysFalsy)`

scikit-learn (https://github.com/scikit-learn/scikit-learn)
- sklearn/datasets/_openml.py:569:9: warning[possibly-missing-attribute] Attribute `update` on type `str | dict[Unknown, Unknown] | list[str] | tuple[int, int] | None | (dict[Unknown, Unknown] &amp; ~AlwaysFalsy)` may be missing
+ sklearn/datasets/_openml.py:569:9: warning[possibly-missing-attribute] Attribute `update` on type `str | dict[Unknown, Unknown] | list[str] | tuple[int, int] | None` may be missing

xarray (https://github.com/pydata/xarray)
- xarray/core/indexing.py:545:38: warning[possibly-missing-attribute] Attribute `dtype` on type `slice[Any, Any, Any] | ndarray[Any, dtype[generic[Any]]]` may be missing
+ xarray/core/indexing.py:550:36: warning[unused-ignore-comment] Unused blanket `type: ignore` directive

jax (https://github.com/google/jax)
- jax/_src/dtypes.py:984:10: warning[possibly-missing-attribute] Attribute `dtype` on type `(Any &amp; ~None &amp; ~str &amp; ~dtype[object]) | dtype[Any]` may be missing
- jax/_src/numpy/index_tricks.py:87:86: error[not-iterable] Object of type `slice[Any, Any, Any] | tuple[slice[Any, Any, Any], ...]` may not be iterable
- jax/_src/numpy/index_tricks.py:132:86: error[not-iterable] Object of type `slice[Any, Any, Any] | tuple[slice[Any, Any, Any], ...]` may not be iterable
- jax/_src/numpy/lax_numpy.py:4420:51: error[invalid-argument-type] Argument to function `ensure_arraylike_tuple` is incorrect: Expected `Sequence[Any]`, found `(ndarray[@Todo, Unknown] &amp; ~ndarray[object, object] &amp; ~Array) | (Sequence[@Todo] &amp; ~ndarray[object, object] &amp; ~Array)`
- jax/_src/numpy/lax_numpy.py:4582:55: error[invalid-argument-type] Argument to function `ensure_arraylike_tuple` is incorrect: Expected `Sequence[Any]`, found `(ndarray[@Todo, Unknown] &amp; ~ndarray[object, object] &amp; ~Array) | (Sequence[@Todo] &amp; ~ndarray[object, object] &amp; ~Array)`
- jax/_src/numpy/lax_numpy.py:4824:49: error[invalid-argument-type] Argument to function `ensure_arraylike_tuple` is incorrect: Expected `Sequence[Any]`, found `(ndarray[@Todo, Unknown] &amp; ~ndarray[object, object] &amp; ~Array) | (Sequence[@Todo] &amp; ~ndarray[object, object] &amp; ~Array)`
- jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `Mesh | AbstractMesh | None`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `Mesh | AbstractMesh | None`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `AbstractSet[Hashable]`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `AbstractSet[Hashable]`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:143:36: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `Mesh | AbstractMesh | None`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `Mesh | AbstractMesh | None`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `AbstractSet[Hashable]`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `AbstractSet[Hashable]`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | frozenset[Unknown] | bool`
+ jax/_src/shard_map.py:144:24: error[invalid-argument-type] Argument to function `_shard_map` is incorrect: Expected `bool`, found `Mesh | AbstractMesh | None | Any | InferFromArgs | AbstractSet[Hashable] | bool`
- Found 2273 diagnostics
+ Found 2267 diagnostics

django-stubs (https://github.com/typeddjango/django-stubs)
- mypy_django_plugin/django/context.py:375:33: warning[possibly-missing-attribute] Attribute `field` on type `(RelatedField[Any, Any] &amp; ~RelatedField[Never, object]) | (ForeignObjectRel &amp; ~RelatedField[Never, object])` may be missing
- Found 465 diagnostics
+ Found 464 diagnostics

colour (https://github.com/colour-science/colour)
- colour/io/fichet2021.py:863:42: warning[possibly-missing-attribute] Attribute `items` on type `(Any &amp; ~Sequence[object] &amp; ~SpectralDistribution &amp; ~MultiSpectralDistributions &amp; ~ValuesView[object]) | (ValuesView[Unknown] &amp; ~Sequence[object] &amp; ~SpectralDistribution &amp; ~MultiSpectralDistributions &amp; ~ValuesView[object]) | Any` may be missing
- Found 700 diagnostics
+ Found 699 diagnostics

streamlit (https://github.com/streamlit/streamlit)
- lib/streamlit/commands/navigation.py:321:43: warning[possibly-missing-attribute] Attribute `items` on type `(Sequence[@Todo] &amp; ~Sequence[object]) | (Mapping[str, Sequence[@Todo]] &amp; ~Sequence[object])` may be missing
- Found 196 diagnostics
+ Found 195 diagnostics

static-frame (https://github.com/static-frame/static-frame)
- static_frame/core/frame.py:7335:31: error[index-out-of-bounds] Index 0 is out of bounds for tuple `tuple[()]` with length 0
- static_frame/core/frame.py:7335:61: error[index-out-of-bounds] Index 0 is out of bounds for tuple `tuple[()]` with length 0
- static_frame/core/frame.py:7337:49: error[index-out-of-bounds] Index 0 is out of bounds for tuple `tuple[()]` with length 0
+ static_frame/core/frame.py:7346:61: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- static_frame/test/property/strategies.py:927:17: error[invalid-argument-type] Argument to function `get_index_hierarchy` is incorrect: Expected `(...) -&gt; IndexHierarchy`, found `(bound method type[Index[Any]].from_labels(labels: Iterable[Unknown], *, /, name: Unknown = None) -&gt; Index[Any]) | (bound method &lt;class &#x27;Index&#x27;&gt;.from_labels(labels: Iterable[Unknown], *, /, name: Unknown = None) -&gt; Index[Any])`
+ static_frame/test/property/strategies.py:927:17: error[invalid-argument-type] Argument to function `get_index_hierarchy` is incorrect: Expected `(...) -&gt; IndexHierarchy`, found `bound method type[Index[Any]].from_labels(labels: Iterable[Unknown], *, /, name: Unknown = None) -&gt; Index[Any]`
- Found 1878 diagnostics
+ Found 1876 diagnostics

ibis (https://github.com/ibis-project/ibis)
- ibis/legacy/udf/vectorized.py:98:16: error[invalid-return-type] Return type does not match returned value: expected `Series[Any]`, found `ndarray[Unknown, Unknown] &amp; ~Top[list[Unknown]] &amp; ~ndarray[object, object] &amp; ~Top[Series[Any]]`
- Found 3286 diagnostics
+ Found 3285 diagnostics

pandas (https://github.com/pandas-dev/pandas)
- pandas/compat/numpy/function.py:110:12: error[invalid-return-type] Return type does not match returned value: expected `tuple[bool, Any]`, found `tuple[bool | (ndarray[@Todo, Unknown] &amp; ~ndarray[object, object]), Unknown]`
+ pandas/compat/numpy/function.py:208:18: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- pandas/core/arrays/datetimes.py:325:20: warning[possibly-missing-attribute] Attribute `_creso` on type `DatetimeTZDtype | (Unknown &amp; ~dtype[object]) | dtype[Any]` may be missing
- pandas/core/indexes/base.py:6766:24: error[unsupported-operator] Operator `+` is unsupported between objects of type `(Unknown &amp; ~ndarray[object, object] &amp; ~slice[object, object, object]) | slice[Any, Any, Any]` and `Literal[1]`
- pandas/core/indexes/base.py:6768:24: error[invalid-return-type] Return type does not match returned value: expected `int`, found `(Unknown &amp; ~ndarray[object, object] &amp; ~slice[object, object, object]) | slice[Any, Any, Any]`
- pandas/core/indexing.py:1767:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `Iterable[Unknown]`, found `(Unknown &amp; ~EllipsisType &amp; ~DataFrame &amp; ~slice[object, object, object]) | slice[Any, Any, Any]`
- pandas/core/internals/managers.py:994:42: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Iterable[Unknown]`, found `slice[Any, Any, Any] | (@Todo &amp; ~slice[object, object, object])`
- pandas/io/pytables.py:2740:17: error[invalid-argument-type] Argument to function `_unconvert_string_array` is incorrect: Expected `ndarray[@Todo, Unknown]`, found `DatetimeArray | @Todo`
+ pandas/io/pytables.py:2740:17: error[invalid-argument-type] Argument to function `_unconvert_string_array` is incorrect: Expected `ndarray[@Todo, Unknown]`, found `DatetimeArray | @Todo | ndarray[@Todo, @Todo]`
- Found 3325 diagnostics
+ Found 3320 diagnostics

sympy (https://github.com/sympy/sympy)
- sympy/solvers/solvers.py:3428:16: error[unsupported-operator] Operator `&amp;` is unsupported between objects of type `set[Basic]` and `tuple[Unknown, ...] | (set[Unknown] &amp; ~AlwaysFalsy) | Unknown | set[Unknown]`
+ sympy/solvers/solvers.py:3428:16: error[unsupported-operator] Operator `&amp;` is unsupported between objects of type `set[Basic]` and `tuple[Unknown, ...] | set[Unknown] | Unknown`

scipy (https://github.com/scipy/scipy)
+ subprojects/highs/src/highspy/highs.py:269:63: error[invalid-argument-type] Argument to function `internal_get_value` is incorrect: Expected `Integral | highs_var | highs_cons | highs_linear_expression | Mapping[Any, Any] | Sequence[Any] | ndarray[Any, dtype[Any]]`, found `object`
- Found 6694 diagnostics
+ Found 6695 diagnostics

</code></pre>

No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-26 12:27</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 13 | 5 | 14 |
| <code>possibly-missing-attribute</code> | 0 | 8 | 1 |
| <code>unsupported-operator</code> | 2 | 2 | 4 |
| <code>index-out-of-bounds</code> | 0 | 4 | 0 |
| <code>unused-ignore-comment</code> | 4 | 0 | 0 |
| <code>invalid-return-type</code> | 0 | 3 | 0 |
| <code>non-subscriptable</code> | 0 | 2 | 0 |
| <code>not-iterable</code> | 0 | 2 | 0 |
| <code>invalid-assignment</code> | 0 | 0 | 1 |
| <code>no-matching-overload</code> | 0 | 1 | 0 |
| <strong>Total</strong> | <strong>19</strong> | <strong>27</strong> | <strong>20</strong> |</p>
<p><strong><a href="https://david-fix-subtyping-for-dyna.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://david-fix-subtyping-for-dyna.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:854 on 2025-09-26 12:30</div>
            <div class="timeline-body"><p>I think you can just inline the condition into the <code>if</code> test above now, without the <code>match</code>:</p>
<pre><code>diff --git a/crates/ty_python_semantic/src/types/generics.rs b/crates/ty_python_semantic/src/types/generics.rs
index 2495bdf055..5bdd33eb29 100644
--- a/crates/ty_python_semantic/src/types/generics.rs
+++ b/crates/ty_python_semantic/src/types/generics.rs
@@ -841,16 +841,14 @@ impl&lt;&#x27;db&gt; Specialization&lt;&#x27;db&gt; {
             .zip(self.types(db))
             .zip(other.types(db))
         {
-            // As an optimization, we can return early if either type is dynamic, unless
-            // we&#x27;re dealing with a top or bottom materialization.
-            if other_materialization_kind.is_none()
+            // As an optimization, we can return early if `relation` is `TypeRelation::Assignability`
+            // and either type is dynamic, unless we&#x27;re dealing with a top or bottom materialization.
+            if relation.is_assignability()
+                &amp;&amp; other_materialization_kind.is_none()
                 &amp;&amp; self_materialization_kind.is_none()
                 &amp;&amp; (self_type.is_dynamic() || other_type.is_dynamic())
             {
-                match relation {
-                    TypeRelation::Assignability =&gt; continue,
-                    TypeRelation::Subtyping =&gt; {}
-                }
+                continue;
             }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-09-26 12:32</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-09-26 12:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:854 on 2025-09-26 12:34</div>
            <div class="timeline-body"><p>Honestly, there are so many conditions we need to check before we can safely <code>continue</code> that I really wonder if this is an optimisation at all. We should short-circuit for <code>Any</code> and <code>Unknown</code> specializations fairly quickly in the generalised fallthrough logic anyway?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-09-26 12:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:854 on 2025-09-26 12:34</div>
            <div class="timeline-body"><p>But we could experiment separately with removing the optimisation altogether</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 12:38</div>
            <div class="timeline-body"><blockquote>
<pre><code>+ mkosi/config.py:1857:33: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
+ mkosi/config.py:1866:37: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
+ mkosi/config.py:2433:33: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
+ mkosi/config.py:2442:40: error[invalid-argument-type] Argument to function `key_transformer` is incorrect: Expected `str`, found `object`
</code></pre>
</blockquote>
<p>This looks like it is caused by <a href="https://github.com/astral-sh/ty/issues/1130">astral-sh/ty#1130</a>. The rest of the ecosystem impact looks good, from a first glance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 13:04</div>
            <div class="timeline-body"><p>Benchmarks seem neutral (or even faster)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 13:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-26 13:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-26 13:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:02 UTC
    </footer>
</body>
</html>
