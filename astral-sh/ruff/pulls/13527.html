<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do not offer an invalid fix for PLR1716 when the comparisons contain parenthesis - astral-sh/ruff #13527</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Do not offer an invalid fix for PLR1716 when the comparisons contain parenthesis</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13527">#13527</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-09-26 15:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Related to https://github.com/astral-sh/ruff/issues/13524</p>
<p>Doesn't offer a valid fix, opting to instead just not offer a fix at all. If someone points me to a good way to handle parenthesis here I'm down to try to fix the fix separately, but it looks quite hard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-09-26 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-09-26 15:14</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-09-26 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:94 on 2024-09-26 15:19</div>
            <div class="timeline-body"><p>This is probably fine considering that we're opting out of a fix but you can use <code>SimpleTokenizer</code> to get proper lexing. But the solution might actually be to use <code>parenthesized_range</code> which gives you the parenthesized expression range.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 16:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:94 on 2024-09-26 16:11</div>
            <div class="timeline-body"><p>Ah <code>parenthesized_range</code> is my dream</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:94 on 2024-09-26 16:23</div>
            <div class="timeline-body"><p>This still looks hard to get quite right. What do you think about patching the bug then dealing with adding a fix later?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-09-26 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-09-26 16:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:94 on 2024-09-26 16:31</div>
            <div class="timeline-body"><p>I would need to look into what's needed to fix this but I would prefer using <code>parenthesized_range</code> to detect if the left or right are parenthesized if that's possible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 16:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:94 on 2024-09-26 16:42</div>
            <div class="timeline-body"><p>Sure, we can do that at least.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 16:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:94 on 2024-09-26 16:48</div>
            <div class="timeline-body"><p>Added that, and we'll offer a fix if they're both parenthesized.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Do not offer an invalid fix for PLR1716 where the comparison contains parenthesis" to "Do not offer an invalid fix for PLR1716 where the comparison contains unbalanced parenthesis" by @zanieb on 2024-09-26 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Do not offer an invalid fix for PLR1716 where the comparison contains unbalanced parenthesis" to "Do not offer an invalid fix for PLR1716 when the comparisons contain unbalanced parenthesis" by @zanieb on 2024-09-26 16:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:110 on 2024-09-26 18:15</div>
            <div class="timeline-body"><p>Does this work in the case of (((a &lt; b))) and (b &lt; c)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-09-26 18:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 18:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:110 on 2024-09-26 18:19</div>
            <div class="timeline-body"><p>No, which brings me back to not wanting to offer a fix here — I just want to fix the syntax bug and find a way to introduce a correct fix again separately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Do not offer an invalid fix for PLR1716 when the comparisons contain unbalanced parenthesis" to "Do not offer an invalid fix for PLR1716 when the comparisons contain parenthesis" by @zanieb on 2024-09-26 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-09-26 18:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:110 on 2024-09-26 18:26</div>
            <div class="timeline-body"><p>Yeah. I would just not offer a fix if either side is parenthesized (Or you could use the <code>parentheses_range</code> iterator if you want to detect the balanced case</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/boolean_chained_comparison.rs</code>:96 on 2024-09-26 18:27</div>
            <div class="timeline-body"><p>Nit: You can do the <code>into</code> game if you want to</p>
<pre><code class="language-suggestion">                left_compare.into(),
                expr_bool_op.into(),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-09-26 18:27</div>
            <div class="timeline-body"><p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-26 18:35</div>
            <div class="timeline-body"><p>Thanks for the reviews!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-09-26 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-26 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-26 19:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:06:43 UTC
    </footer>
</body>
</html>
