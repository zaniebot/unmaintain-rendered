<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>refactor CLI (2/3): Group options in `--help` - astral-sh/ruff #2155</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>refactor CLI (2/3): Group options in <code>--help</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2155">#2155</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2023-01-25 14:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a></div>
            <div class="timeline-body"><p>This is the followup PR for #2145.</p>
<p>New <code>ruff --help</code> output:</p>
<pre><code>Ruff: An extremely fast Python linter.

Usage: ruff [OPTIONS] [FILES]...

Arguments:
  [FILES]...  

Options:
      --fix              Attempt to automatically fix lint violations
      --show-source      Show violations with source code
      --diff             Avoid writing any fixed files back; instead, output a diff for each changed file to stdout
  -w, --watch            Run in watch mode by re-running whenever files change
      --fix-only         Fix any fixable lint violations, but don&#x27;t report on leftover violations. Implies `--fix`
      --format &lt;FORMAT&gt;  Output serialization format for violations [env: RUFF_FORMAT=] [possible values: text, json, junit, grouped, github, gitlab, pylint]
      --config &lt;CONFIG&gt;  Path to the `pyproject.toml` or `ruff.toml` file to use for configuration
      --add-noqa         Enable automatic additions of `noqa` directives to failing lines
      --show-files       See the files Ruff will be run against with the current settings
      --show-settings    See the settings Ruff will use to lint a given Python file
  -h, --help             Print help
  -V, --version          Print version

Rule selection:
      --select &lt;RULE_CODE&gt;
          Comma-separated list of rule codes to enable (or ALL, to enable all rules)
      --ignore &lt;RULE_CODE&gt;
          Comma-separated list of rule codes to disable
      --extend-select &lt;RULE_CODE&gt;
          Like --select, but adds additional rule codes on top of the selected ones
      --extend-ignore &lt;RULE_CODE&gt;
          Like --ignore, but adds additional rule codes on top of the ignored ones
      --per-file-ignores &lt;PER_FILE_IGNORES&gt;
          List of mappings from file pattern to code to exclude
      --fixable &lt;RULE_CODE&gt;
          List of rule codes to treat as eligible for autofix. Only applicable when autofix itself is enabled (e.g., via `--fix`)
      --unfixable &lt;RULE_CODE&gt;
          List of rule codes to treat as ineligible for autofix. Only applicable when autofix itself is enabled (e.g., via `--fix`)

File selection:
      --exclude &lt;FILE_PATTERN&gt;         List of paths, used to omit files and/or directories from analysis
      --extend-exclude &lt;FILE_PATTERN&gt;  Like --exclude, but adds additional files and directories on top of those already excluded
      --respect-gitignore              Respect file exclusions via `.gitignore` and other standard ignore files
      --force-exclude                  Enforce exclusions, even for paths passed to Ruff directly on the command-line

Rule configuration:
      --target-version &lt;TARGET_VERSION&gt;
          The minimum Python version that should be supported
      --line-length &lt;LINE_LENGTH&gt;
          Set the line-length for length-associated rules and automatic formatting
      --dummy-variable-rgx &lt;DUMMY_VARIABLE_RGX&gt;
          Regular expression matching the name of dummy variables

Miscellaneous:
  -n, --no-cache
          Disable cache reads
      --isolated
          Ignore all configuration files
      --cache-dir &lt;CACHE_DIR&gt;
          Path to the cache directory [env: RUFF_CACHE_DIR=]
      --stdin-filename &lt;STDIN_FILENAME&gt;
          The name of the file when passing it through stdin
  -e, --exit-zero
          Exit with status code &quot;0&quot;, even upon detecting lint violations
      --update-check
          Enable or disable automatic update checks

Subcommands:
      --explain &lt;EXPLAIN&gt;  Explain a rule
      --clean              Clear any caches in the current directory or any subdirectories

Log levels:
  -v, --verbose  Enable verbose logging
  -q, --quiet    Print lint violations, but nothing else
  -s, --silent   Disable all logging (but still exit with status code &quot;1&quot; upon detecting lint violations)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;refactor CLI (2/2)&quot; to &quot;refactor CLI (2/2): Use subcommands&quot; by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-25 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;refactor CLI (2/2): Use subcommands&quot; to &quot;refactor CLI (2/2): Use clap subcommands&quot; by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-25 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-26 03:13</div>
            <div class="timeline-body"><p>This is a significant improvement. And migrating to subcommands opens up a lot of opportunities</p>
<p>I&#x27;ve been hesitant to do this out of fear of breaking compatibility. But the setup you&#x27;ve achieved here is pretty interesting. I need some time to digest the impact and implications.</p>
<p>I do think we should have clear answers to a few questions that&#x27;ve come up before:</p>
<ol>
<li>Do we expect <code>ruff .</code> to <em>always</em> work? That is, should <code>check</code> always be the &quot;default&quot; subcommand? Or is this just a temporarily measure, for compatibility?</li>
<li>Do we want to move <code>ruff . --fix</code> to <code>ruff fix</code>? Is there any value, at all, in that? <code>deno</code> has <code>deno check</code> (to type-check) and <code>deno fmt</code> to format, but no clear analog here. (I think the answer is &quot;no&quot;, but now is the time to ask it.)</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-26 04:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;refactor CLI (2/2): Use clap subcommands&quot; to &quot;rework CLI (2/3): Group options in `--help`&quot; by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-26 05:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-26 05:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-26 05:49</div>
            <div class="timeline-body"><p>I have updated this PR to only group the options in <code>--help</code> for now so that it can be merged and the subcommands can be implemented in a followup PR :) Please see the latest commit message for the reasoning.</p>
<p>To be clear this PR is now purely a refactor (aside from the changed <code>--help</code> output).</p>
<blockquote>
<p>Do we expect <code>ruff .</code> to <em>always</em> work?</p>
</blockquote>
<p>Yes I&#x27;d expect it to always work. I think it makes sense that a tool defaults to its main functionality. <code>ruff</code> is a linter so it makes sense that invoking it with some files/directories just &quot;does the thing it&#x27;s supposed to do&quot; (linting).</p>
<blockquote>
<p>Do we want to move <code>ruff . --fix</code> to <code>ruff fix</code>? Is there any value, at all, in that?</p>
</blockquote>
<p>I think subcommands primarily make sense when they have a different synopsis, e.g:</p>
<ul>
<li><code>--explain</code> and <code>--clean</code> don&#x27;t support any of the other options (=&gt; they should be subcommands)</li>
<li><code>--fix</code> and <code>--add-noqa</code> act like boolean flags (that ideally should be combinable, =&gt; option flags are fine)</li>
</ul>
<p>Thanks for asking this question ... it made me realize that <code>--add-noqa</code> really shouldn&#x27;t be a subcommand, since it would make sense to be able to combine it with <code>--fix</code> (even though that currently doesn&#x27;t work at all, see #2187).
In the same vein I think <code>--show-settings</code> and <code>--show-files</code> shouldn&#x27;t be subcommands since combining them with the other options would be useful, e.g. you should be able to see how <code>--select</code> or <code>--no-respect-gitignore</code> affects the selected rules / files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;rework CLI (2/3): Group options in `--help`&quot; to &quot;refactor CLI (2/3): Group options in `--help`&quot; by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-26 05:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-26 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_cli/src/args.rs</code>:47 on 2023-01-26 17:32</div>
            <div class="timeline-body"><p>Should this not be grouped with <code>show_source</code>? Same for <code>no_fix</code> and <code>fix</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>ruff_cli/src/args.rs</code>:47 on 2023-01-26 17:41</div>
            <div class="timeline-body"><p>Ah yes, good catch ... fixed :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-26 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-26 17:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/settings/mod.rs</code>:134 on 2023-01-26 17:47</div>
            <div class="timeline-body"><p>Is the idea here that we now validate when reading the config, rather than when transforming it into <code>Settings</code>? I wonder why I didn&#x27;t do it this way initially. I&#x27;m getting Chesterton&#x27;s fence vibes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-26 17:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/settings/mod.rs</code>:134 on 2023-01-26 17:55</div>
            <div class="timeline-body"><p>I am sorry I cannot tell you why you wrote it this way ... looking at it just doesn&#x27;t make sense to me ... as I explained in the commit message in Rust you ideally manage to make illegal states unrepresentable ... since <code>Settings</code> is used all over the codebase it only makes sense that <code>Settings</code> denotes valid settings as opposed to settings that may be invalid. So yes I think the Settings constructor is the right place for any settings validation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-26 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-26 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/settings/mod.rs</code>:134 on 2023-01-26 18:06</div>
            <div class="timeline-body"><p>Are you saying you don&#x27;t like my code...? (Joking)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-26 18:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-26 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/settings/mod.rs</code>:134 on 2023-01-26 18:24</div>
            <div class="timeline-body"><p>Haha ... no. I think it&#x27;s very impressive that you managed to get ruff so far and keep grinding on the issues that matter. I tend to get sidetracked too much while pursuing my own projects ...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-26 19:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/settings/mod.rs</code>:134 on 2023-01-26 19:03</div>
            <div class="timeline-body"><p>Thank you :) I was only kidding but maybe I&#x27;ll just say a few quick things:</p>
<ul>
<li>I try to stay unattached to my code so, of course, always feel free to suggest improvements.</li>
<li>To me much of building software is tradeoffs and prioritization... Ruff is a big project and so required making a lot of tradeoffs!</li>
<li>As a result, there&#x27;s certainly &quot;bad&quot; code in various places, things that are done poorly that I know I&#x27;d like to be done differently, things that are done poorly that I&#x27;ve totally forgotten about, etc.</li>
<li>...and as such, I&#x27;m really appreciative of all the larger refactors you&#x27;ve taken on! They&#x27;ve made the project much better. Some of them aligned with things I wanted to change, some of them hadn&#x27;t even occurred to me.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-26 19:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/settings/mod.rs</code>:134 on 2023-01-26 19:19</div>
            <div class="timeline-body"><p>I know you were kidding^^</p>
<p>Right ... I just often don&#x27;t like making tradeoffs and try to avoid them and end up going down some rabbit hole.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:57 UTC
    </footer>
</body>
</html>
