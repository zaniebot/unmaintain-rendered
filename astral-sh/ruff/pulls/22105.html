<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] fix comparisons and arithmetic with `NewType`s of `float` - astral-sh/ruff #22105</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] fix comparisons and arithmetic with <code>NewType</code>s of <code>float</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22105">#22105</a>
        opened by <a href="https://github.com/oconnor663">@oconnor663</a>
        on 2025-12-20 03:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a></div>
            <div class="timeline-body"><p>Fixes https://github.com/astral-sh/ty/issues/2077.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 03:50</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ‚úÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-20 03:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:10232 on 2025-12-20 03:51</div>
            <div class="timeline-body"><p>Claude helped me find this fix, but I have to admit I don't yet understand why it's needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-20 03:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/new_types.md</code>:317 on 2025-12-20 03:51</div>
            <div class="timeline-body"><p>Similarly, I don't yet understand why it fixes this TODO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 03:52</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">pydantic (https://github.com/pydantic/pydantic)
- pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`
+ pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, Divergent], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`

xarray (https://github.com/pydata/xarray)
- xarray/core/dataarray.py:5757:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `T_Xarray@map_blocks | DataArray | Dataset`
+ xarray/core/dataarray.py:5757:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `DataArray | Dataset`
- xarray/core/dataset.py:8873:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `T_Xarray@map_blocks | DataArray | Dataset`
+ xarray/core/dataset.py:8873:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `DataArray | Dataset`

static-frame (https://github.com/static-frame/static-frame)
- static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Top[Bus[Any]] | TypeBlocks | Batch | ... omitted 6 union elements, object_]`
+ static_frame/core/bus.py:675:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Bus[Any], object_]`, found `InterGetItemILocReduces[Self@iloc | Bus[Any], object_ | Self@iloc]`
- static_frame/core/bus.py:675:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Bus[Any], object_]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 6 union elements, generic[object]]`
- static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 6 union elements, generic[object]]`
+ static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Top[Index[Any]] | Top[Series[Any, Any]] | TypeBlocks | ... omitted 6 union elements, generic[object]]`
- static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 7 union elements, generic[object]]`
+ static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[TypeBlocks | Batch | SeriesAssign | ... omitted 6 union elements, generic[object]]`
- static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Top[Yarn[Any]] | TypeBlocks | Batch | ... omitted 6 union elements, generic[object]]`
+ static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Self@iloc | Yarn[Any], generic[object]]`
- Found 1842 diagnostics
+ Found 1841 diagnostics


</code></pre>
</details>

<p>No memory usage changes detected ‚úÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-12-20 09:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-12-20 09:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/new_types.md</code>:317 on 2025-12-24 03:01</div>
            <div class="timeline-body"><p>Ok this part is because <code>is</code> comparisons with <code>EllipsisType</code> end up going through this check:</p>
<p>https://github.com/astral-sh/ruff/blob/b72391746345ee4d3695a4f76654f44e9884e890/crates/ty_python_semantic/src/types/infer/builder.rs#L10793-L10794</p>
<p><code>is_equivalent_to</code> there only comes out true if we delegate to the base type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-24 03:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-24 03:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:11058 on 2025-12-24 03:40</div>
            <div class="timeline-body"><p>I still don't see why these special cases are needed. It seems like <code>infer_rich_type_comparison</code> is failing to find matching bindings, but these bindings in typeshed should be fine:</p>
<pre><code class="language-py">    def __lt__(self, value: float, /) -&gt; bool: ...
    def __le__(self, value: float, /) -&gt; bool: ...
    def __gt__(self, value: float, /) -&gt; bool: ...
    def __ge__(self, value: float, /) -&gt; bool: ...
</code></pre>
<p><code>float</code> there in type position should(?) expand to <code>float | int</code>, and a <code>NewType</code> of <code>float</code> should be assignable to that...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-30 01:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:11058 on 2025-12-30 01:14</div>
            <div class="timeline-body"><p>Ok progress: This special case is needed because it allows the recursive call to reach the <code>Type::Union</code> special case above. Without that, the generic <code>try_dunder</code> -&gt; <code>infer_rich_comparison</code> -&gt; <code>call_dunder</code> path ends up asking whether the <code>NewType</code> is assignable to the parameters of e.g. <code>float.__lt__</code>. It turns out it is assignable to the positional parameter, which benefits from the <code>float</code> -&gt; <code>int | float</code> transformation, but it's <em>not</em> assignable to the <code>self</code> parameter, which is just <code>float</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-30 01:51</div>
            <div class="timeline-body"><p>I've added support/tests for <code>has_relation_to_impl</code>, which was also evaluating assignability incorrectly in these cases, though that (surprisingly) didn't turn out to be the root cause for the original &quot;unsupported operation&quot; errors. I've also added a bunch of comments explaining why these new special cases are needed. This PR is now ready for review.</p>
<p>Edit: ChatGPT caught a real mistake below, which I think is responsible for the failing fuzz tests and the excessive new ecosystem errors. Will update.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @oconnor663 on 2025-12-30 01:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @oconnor663 on 2025-12-30 01:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @oconnor663 on 2025-12-30 01:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @oconnor663 on 2025-12-30 01:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @oconnor663 on 2025-12-30 01:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @oconnor663 on 2025-12-30 01:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chatgpt-codex-connector[bot]">@chatgpt-codex-connector[bot]</a> reviewed on 2025-12-30 01:57</div>
            <div class="timeline-body"><h3>üí° Codex Review</h3>
<p>Here are some automated review suggestions for this pull request.</p>
<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

<p><a href="http://chatgpt.com/codex/settings/general">Your team has set up Codex to review pull requests in this repo</a>. Reviews are triggered when you</p>
<ul>
<li>Open a pull request for review</li>
<li>Mark a draft as ready</li>
<li>Comment &quot;@codex review&quot;.</li>
</ul>
<p>If Codex has suggestions, it will comment; otherwise it will react with üëç.</p>
<p>Codex can also answer questions or update the PR. Try commenting &quot;@codex address that feedback&quot;.</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chatgpt-codex-connector[bot]">@chatgpt-codex-connector[bot]</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2446 on 2025-12-30 01:57</div>
            <div class="timeline-body"><p><strong><sub><sub><img src="https://img.shields.io/badge/P1-orange?style=flat" alt="P1 Badge" /></sub></sub>  Keep NewType instances assignable to unions containing them</strong></p>
<p>The new <code>Type::NewTypeInstance</code> arm now runs before the union cases and unwraps every NewType to its concrete base before checking relations. With this ordering, assigning <code>Foo(1)</code> to a variable annotated <code>Foo | None</code> becomes a check of whether <code>int</code> (the base of <code>Foo</code>) is assignable to <code>Foo</code> or <code>None</code>, which fails, so optional NewTypes are rejected even when the union explicitly contains the NewType. Previously the <code>(_, Type::Union)</code> arm matched first and handled unions containing the NewType correctly. This change breaks assignability for any union that includes the NewType itself.</p>
<p>Useful? React with üëç¬†/ üëé.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-30 02:03</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-await</code> | 0 | 2 | 6 |
| <code>invalid-return-type</code> | 0 | 1 | 5 |
| <code>possibly-missing-attribute</code> | 0 | 3 | 1 |
| <code>unresolved-attribute</code> | 0 | 0 | 2 |
| <code>invalid-argument-type</code> | 0 | 1 | 0 |
| <code>unused-ignore-comment</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>1</strong> | <strong>7</strong> | <strong>14</strong> |</p>
<p><strong><a href="https://69cc764b.ty-ecosystem-ext.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://69cc764b.ty-ecosystem-ext.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-30 02:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2446 on 2025-12-30 02:05</div>
            <div class="timeline-body"><p>Ah this is right. I need to fix it and add more test cases. (Local tests pass despite this mistake.) This is probably why there are 3000 new errors in the ecosystem report lol.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-30 21:09</div>
            <div class="timeline-body"><p>Most of the new diagnostics are gone, but there are still a few that look like they're probably my fault:
<img width="2372" height="164" alt="image" src="https://github.com/user-attachments/assets/a2221f91-b024-4f40-9530-84d75a77b2dc" />
Looking into it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-30 22:46</div>
            <div class="timeline-body"><p>Minimal repro for these failures, new in this PR:</p>
<pre><code class="language-py">from typing import NewType

Key = NewType(&quot;Key&quot;, object)

class ThingWithKeys:
    def __contains__(self, refname: Key) -&gt; bool:
        return False

def _(key: Key, keys: ThingWithKeys):
    key in keys  # error[unsupported-operator]: Unsupported `in` operation
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-31 01:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/new_types.md</code>:415 on 2025-12-31 01:40</div>
            <div class="timeline-body"><p>Previously this PR fixed this TODO, but now it no longer does. One way to fix it could be to check the expression on the base type first, and then only on the <code>NewType</code> if the former fails, but checking the <code>NewType</code> first feels more correct to me in general. It gives us less in this case (because we only see <code>is_equivalent</code> when we look at the base), but maybe there are other cases where it gives us more?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-31 01:43</div>
            <div class="timeline-body"><p>Ok all of the added and removed diagnostics are gone. (Is there really <em>nobody</em> in the ecosystem report trying to do arithmetic on newtypes of float?) What remains is just unions that get printed differently. Some of them look like random ordering flakes, but others are cases where <code>int</code> and <code>float</code> simplify out now, which seems reasonable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2026-01-02 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/new_types.md</code>:317 on 2026-01-02 17:18</div>
            <div class="timeline-body"><p>The latest version un-fixed this TODO, so it's back the way it was.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2026-01-05 21:20</div>
            <div class="timeline-body"><p>94d22ea1c764cae10b4ac394c0b9f324e3859ea0 is a big rebase on top of https://github.com/astral-sh/ruff/pull/22232.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/new_types.md</code>:336 on 2026-01-06 16:15</div>
            <div class="timeline-body"><p>Can you include the negative cases like you had for int? Those seemed important/valuable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2026-01-06 16:21</div>
            <div class="timeline-body"><p>This all makes sense on paper. This special-case is only triggered by float/complex because NewType otherwise doesn't permit taking a union as an argument, right? Are there other cases where you can smuggle unions that we might not be checking for though? Type aliases (of various flavours)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2026-01-06 16:47</div>
            <div class="timeline-body"><blockquote>
<p>This special-case is only triggered by float/complex because NewType otherwise doesn't permit taking a union as an argument, right?</p>
</blockquote>
<p>Right. That restriction is <a href="https://github.com/astral-sh/ruff/blob/d65542c05eb46166814e3bfb02968da3125d1ef7/crates/ty_python_semantic/src/types/infer/builder.rs#L5957-L5972">implemented here</a>. Apart from the <code>float</code> and <code>int</code> special cases, only class types and other newtypes are allowed in the base.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @oconnor663 on 2026-01-06 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @oconnor663 on 2026-01-06 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-06 17:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:18:17 UTC
    </footer>
</body>
</html>
