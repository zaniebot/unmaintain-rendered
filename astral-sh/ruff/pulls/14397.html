<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understand `typing.Optional` in annotations - astral-sh/ruff #14397</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Understand <code>typing.Optional</code> in annotations</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14397">#14397</a>
        opened by <a href="https://github.com/Glyphack">@Glyphack</a>
        on 2024-11-17 09:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Glyphack">@Glyphack</a></div>
            <div class="timeline-body">

<p>Fix: #14354</p>
Summary
<p>Recognize <code>Optional</code> special form in annotation. Both <code>typing</code> and <code>typing_extensions</code> modules are valid for importing <code>Optional</code>.
The result type is a Union with <code>None</code>.</p>


Test Plan
<p>Added tests for importing from modules and assignability and different combinations for the <code>Optional</code> parameter.</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-17 10:09</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-17 10:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Glyphack">@Glyphack</a> reviewed on 2024-11-17 10:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Glyphack">@Glyphack</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:1810 on 2024-11-17 10:33</div>
            <div class="timeline-body"><p>Should this comment be repeated on every special form? Most of them have this properties.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/Glyphack">@Glyphack</a> on 2024-11-17 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/Glyphack">@Glyphack</a> on 2024-11-17 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/Glyphack">@Glyphack</a> on 2024-11-17 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/Glyphack">@Glyphack</a> on 2024-11-17 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/Glyphack">@Glyphack</a> on 2024-11-17 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-17 10:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:1830 on 2024-11-17 10:51</div>
            <div class="timeline-body"><pre><code>            Self::Literal | Self::Optional | Self::TypeVar(_) =&gt; Truthiness::AlwaysTrue,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Understand typing.Optional in annotations&quot; to &quot;Understand `typing.Optional` in annotations&quot; by <a href="https://github.com/Glyphack">@Glyphack</a> on 2024-11-17 11:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-11-17 14:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:4533 on 2024-11-17 14:15</div>
            <div class="timeline-body"><p>I think <code>Optional</code> contains type expressions as per the grammar:</p>
<pre><code>| &lt;Optional&gt; &#x27;[&#x27; type_expression &#x27;]&#x27;
</code></pre>
<p>So, you&#x27;ll need to use <code>self.infer_type_expression</code> instead.</p>
<p>Ref: https://typing.readthedocs.io/en/latest/spec/annotations.html#grammar-token-expression-grammar-type_expression</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-17 15:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:1810 on 2024-11-17 15:23</div>
            <div class="timeline-body"><p>I find the doc-comments helpful. It&#x27;s true that many will likely be quite similar, but the comment for an enum variant shows up in the tooltip when you hover over that enum variant in your IDE with the ruff repo open</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Glyphack">@Glyphack</a> reviewed on 2024-11-17 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Glyphack">@Glyphack</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:4533 on 2024-11-17 15:39</div>
            <div class="timeline-body"><p>Thanks I was not aware of that function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-11-17 17:04</div>
            <div class="timeline-body"><p>Looks great, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-17 17:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-17 17:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-17 17:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:08:33 UTC
    </footer>
</body>
</html>
