<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade to clap 4 - astral-sh/ruff #272</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Upgrade to clap 4</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/272">#272</a>
        opened by <a href="https://github.com/andersk">@andersk</a>
        on 2022-09-28 20:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andersk">@andersk</a></div>
            <div class="timeline-body"><p>https://epage.github.io/blog/2022/09/clap4/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-28 21:11</div>
            <div class="timeline-body"><p>This rules! Thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2022-09-28 21:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-28 21:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-09-28 21:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>src/main.rs</code>:35 on 2022-09-29 00:48</div>
            <div class="timeline-body"><p>If you remove this line, clap will automatically fill in <code>name = CARGO_PKG_NAME</code> for you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>src/main.rs</code>:39 on 2022-09-29 00:48</div>
            <div class="timeline-body"><p>irc that value hint is now the default for <code>PathBuf</code> automatically</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>src/main.rs</code>:61 on 2022-09-29 00:50</div>
            <div class="timeline-body"><p>How come you accept both <code>--select code --select code</code> and <code>--select code code</code>?</p>
<p>Normally appls just accept <code>--select code,code --select code</code> instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>src/main.rs</code>:90 on 2022-09-29 00:50</div>
            <div class="timeline-body"><p>btw <code>action</code> is now enabled automatically for you, so you don't need the bald <code>action</code> attribute anymore.  Run <code>cargo check -F clap/deprecated</code> and it <em>should</em> tell you that.  Won't be a problem until clap v5 though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2022-09-29 00:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-09-29 00:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/main.rs</code>:61 on 2022-09-29 00:59</div>
            <div class="timeline-body"><p>I'd like to only accept <code>--select code+</code>, is that not what's happening here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-09-29 01:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/main.rs</code>:61 on 2022-09-29 01:01</div>
            <div class="timeline-body"><p>(As in: either <code>--select F401</code> or <code>--select F401 E501</code> should be valid .)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2022-09-29 01:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>src/main.rs</code>:61 on 2022-09-29 01:02</div>
            <div class="timeline-body"><p>Could you write that out further to make sure I understand?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-09-29 01:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/main.rs</code>:61 on 2022-09-29 01:04</div>
            <div class="timeline-body"><p>Yes, sorry. The intent is that either <code>--select F401</code> or <code>--select F401 E501</code> should be accepted. <code>--select F401 --select E501</code> shouldn't be though (and neither should <code>--select F401,E501</code>).</p>
<p>Though, regardless of whether that aligns with the <em>actual</em> behavior here, perhaps that intent is misguided?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andersk">@andersk</a> reviewed on 2022-09-29 01:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/andersk">@andersk</a> on <code>src/main.rs</code>:61 on 2022-09-29 01:16</div>
            <div class="timeline-body"><p>I note that <code>flake8</code> accepts <code>--select F401,E501</code> and not <code>--select F401 E501</code> or <code>--select F401 --select E501</code>.</p>
<p>The <code>--select F401 E501</code> syntax confused me at first because it prevents you from writing <code>ruff --select F401 file.py</code>. (You can write <code>ruff --select F401 -- file.py</code>, but nobody expects to need that.)</p>
<p>Generally UNIX options only ever consume a known number of arguments, and this is why.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2022-09-29 02:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>src/main.rs</code>:61 on 2022-09-29 02:01</div>
            <div class="timeline-body"><p><code>--select F401 E501</code> without multiple occurrences would requiring overriding the default <code>ArgAction</code> for <code>Vec</code> (<code>Append</code>) with <code>action = ArgAction::Set</code>.</p>
<p>And yes, this general leads to ambiguities in parsing which is why we <a href="https://docs.rs/clap/latest/clap/builder/struct.Arg.html#method.num_args">place warnings around it</a>.</p>
<p>I would recommend instead <code>#[arg(long, value_delimiter = &quot;,&quot;)]</code> or <code>#[arg(long, value_delimiter = &quot;,&quot;, action = ArgAction::Set)]</code>, depending on if your want to allow multiple occurrences.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-09-29 02:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/main.rs</code>:61 on 2022-09-29 02:18</div>
            <div class="timeline-body"><p>Thank you both, much appreciated + I'm convinced. Changed in #278.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:54:38 UTC
    </footer>
</body>
</html>
