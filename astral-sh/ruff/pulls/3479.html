<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ci: Use rust toolchain actions - astral-sh/ruff #3479</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ci: Use rust toolchain actions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3479">#3479</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-03-13 10:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Use the <code>actions-rs/toolchain</code> action to install Rust, <code>actions-rs/cargo</code> to run cargo commands, and <code>action-rs/clippy-check</code> to run clippy.</p>
<ul>
<li>Using <code>actinos-rs/toolchain</code> ensures that our workflows work with <a href="https://github.com/nektos/act">act</a>, allowing to test locally</li>
<li>Using <code>actions-rs/cargo</code>: It gives nice warnings and errors in the GitHub UI</li>
<li>Using <code>actions/clippy-check</code>: Posts lint annotations</li>
</ul>
<h2>Test Plan</h2>
<p>Sample output after I added clippy errors</p>
<p>https://github.com/charliermarsh/ruff/actions/runs/4404224020/jobs/7713601234</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-03-13 11:06</div>
            <div class="timeline-body"><p>âœ… ecosystem check detected no changes.</p>
<!-- thollander/actions-comment-pull-request "ecosystem-results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-13 12:57</div>
            <div class="timeline-body"><p>Seems reasonable to me. We intentionally moved away from <code>actions-rs/toolchain</code> at Boshen's recommendation based on profiling work from Rome. I'm curious if your benchmarking shows that it's much slower (or not).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-03-13 14:10</div>
            <div class="timeline-body"><blockquote>
<p>Seems reasonable to me. We intentionally moved away from <code>actions-rs/toolchain</code> at Boshen's recommendation based on profiling work from Rome. I'm curious if your benchmarking shows that it's much slower (or not).</p>
</blockquote>
<p>Oh, interesting. This does make sense. Using <code>rustup</code> directly is easier (write stupid code) because it is installed on all GitHub runners. The question is if we're okay with the added complexity to support local-testing with act.</p>
<p>I did a quick check on performance and it seems to be about the same:</p>
<ul>
<li><a href="https://github.com/charliermarsh/ruff/actions/runs/4405150357/jobs/7715673284">Job using <code>rustup</code></a>: ~14s</li>
<li><a href="https://github.com/charliermarsh/ruff/actions/runs/4404934798/jobs/7715184666">Job using <code>actions-rs/toolchain</code></a>: ~14s</li>
</ul>
<p>@Boshen's <a href="https://github.com/rome/tools/commit/da5b5c07f961e4961838273b76a2156dd5d95c26">commit</a> that removes the action from Rome's CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Boshen">@Boshen</a> on 2023-03-13 14:29</div>
            <div class="timeline-body"><p>The benefit is that you don't have to sync your CI Rust versions with rust-toolchain.toml.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-03-13 15:36</div>
            <div class="timeline-body"><p>:wave: @Boshen Thanks for chiming in.</p>
<blockquote>
<p>The benefit is that you don't have to sync your CI Rust versions with rust-toolchain.toml.</p>
</blockquote>
<p>That's very helpful to know. Because this seems to be no longer an issue. The action now supports the <a href="https://github.com/actions-rs/toolchain#the-toolchain-file">toolchain file</a>.</p>
<blockquote>
<p>This Action supports <a href="https://rust-lang.github.io/rustup/overrides.html#the-toolchain-file">toolchain files</a>, so it is not necessary to use toolchain input anymore. ....</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-03-13 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-13 16:30</div>
            <div class="timeline-body"><p>@Boshen heard me even without the tag</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stinodego">@stinodego</a> on 2023-03-13 21:41</div>
            <div class="timeline-body"><p>For what it's worth, we moved away from <code>actions-rs/toolchain</code> as it is <a href="https://github.com/actions-rs/toolchain/issues/216">unmaintained</a>. We moved to <a href="https://github.com/dtolnay/rust-toolchain"><code>dtolnay/rust-toolchain</code></a>, which seems to work fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-03-14 07:21</div>
            <div class="timeline-body"><blockquote>
<p>For what it's worth, we moved away from <code>actions-rs/toolchain</code> as it is <a href="https://github.com/actions-rs/toolchain/issues/216">unmaintained</a>. We moved to <a href="https://github.com/dtolnay/rust-toolchain"><code>dtolnay/rust-toolchain</code></a>, which seems to work fine.</p>
</blockquote>
<p>Hmm, that's a good point. I believe <a href="https://github.com/dtolnay/rust-toolchain"><code>dtolnay/rust-toolchain</code></a> doesn't respect the version specified in the <code>toolchain.toml</code>. But we could give <a href="https://github.com/actions-rust-lang/setup-rust-toolchain">setup-rust-toolchain</a> a try.</p>
<p>Edit: <code>setup-rust-toolchain</code> doesn't work either because it ONLY installs the tools specified in the <code>toolchain.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-03-14 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-24 15:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:37 UTC
    </footer>
</body>
</html>
