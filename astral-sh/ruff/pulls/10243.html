<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pycodestyle`] Implement `blank-line-at-end-of-file` (`W391`) - astral-sh/ruff #10243</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pycodestyle</code>] Implement <code>blank-line-at-end-of-file</code> (<code>W391</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10243">#10243</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2024-03-06 05:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a></div>
            <div class="timeline-body">

Summary
<p>Implements the <a href="https://pycodestyle.pycqa.org/en/latest/intro.html#error-codes">blank line at end of file</a> rule (W391) from pycodestyle. Renamed to TooManyNewlinesAtEndOfFile for clarity.</p>
Test Plan
<p>New fixtures have been added</p>
<p>Part of #2402</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Too many newlines&quot; to &quot;[pycodestyle] Implement &quot;&quot; by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-06 05:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[pycodestyle] Implement &quot;&quot; to &quot;[pycodestyle] Implement &quot;blank line at end of file&quot; (W391)&quot; by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-06 05:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[pycodestyle] Implement &quot;blank line at end of file&quot; (W391)&quot; to &quot;[`pycodestyle`] Implement `blank-line-at-end-of-file` (W391)&quot; by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-06 05:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`pycodestyle`] Implement `blank-line-at-end-of-file` (W391)&quot; to &quot;[`pycodestyle`] Implement `blank-line-at-end-of-file` (`W391`)&quot; by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-06 05:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-03-06 05:44</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/augustelalande:too_many_newlines">CodSpeed Performance Report</a>
Merging #10243 will <strong>not alter performance</strong>
<p>Comparing <code>augustelalande:too_many_newlines</code> (2d4e2fe) with <code>main</code> (c746912)</p>
Summary
<p><code>‚úÖ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-03-06 05:57</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+27 -0 violations, +0 -0 fixes in 5 projects; 38 projects unchanged)</p>
<a href="https://github.com/commaai/openpilot">commaai/openpilot</a> (+10 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/common/transformations/camera.py#L163">common/transformations/camera.py:163:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/selfdrive/car/card.py#L142">selfdrive/car/card.py:142:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/selfdrive/car/subaru/carstate.py#L229">selfdrive/car/subaru/carstate.py:229:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/selfdrive/debug/internal/fuzz_fw_fingerprint.py#L51">selfdrive/debug/internal/fuzz_fw_fingerprint.py:51:1:</a> W391 [*] Too many newlines at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/selfdrive/debug/test_fw_query_on_routes.py#L187">selfdrive/debug/test_fw_query_on_routes.py:187:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/selfdrive/thermald/fan_controller.py#L38">selfdrive/thermald/fan_controller.py:38:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/system/loggerd/tests/test_loggerd.py#L285">system/loggerd/tests/test_loggerd.py:285:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/tools/zookeeper/disable.py#L8">tools/zookeeper/disable.py:8:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/tools/zookeeper/enable_and_wait.py#L31">tools/zookeeper/enable_and_wait.py:31:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/commaai/openpilot/blob/78d72d7dc390984496dd6633fd588bfd06ae1939/tools/zookeeper/ignition.py#L10">tools/zookeeper/ignition.py:10:1:</a> W391 [*] Extra newline at end of file
</pre>

</p>

<a href="https://github.com/docker/docker-py">docker/docker-py</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/docker/docker-py/blob/bd164f928ab82e798e30db455903578d06ba2070/docker/utils/__init__.py#L13">docker/utils/__init__.py:13:1:</a> W391 [*] Extra newline at end of file
</pre>

</p>

<a href="https://github.com/fronzbot/blinkpy">fronzbot/blinkpy</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/fronzbot/blinkpy/blob/72f69acef4e73a5d9a17d82ed0402533191c0bc5/blinksync/forms.py#L122">blinksync/forms.py:122:1:</a> W391 [*] Extra newline at end of file
</pre>

</p>

<a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+3 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/milvus-io/pymilvus/blob/6086d5c99f22590c881511f52ac4ff3d659ca355/examples/example_bulkwriter.py#L418">examples/example_bulkwriter.py:418:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/milvus-io/pymilvus/blob/6086d5c99f22590c881511f52ac4ff3d659ca355/examples/milvus_client/rbac.py#L104">examples/milvus_client/rbac.py:104:1:</a> W391 [*] Extra newline at end of file
+ <a href="https://github.com/milvus-io/pymilvus/blob/6086d5c99f22590c881511f52ac4ff3d659ca355/examples/user.py#L93">examples/user.py:93:1:</a> W391 [*] Extra newline at end of file
</pre>

</p>

<a href="https://github.com/mlflow/mlflow">mlflow/mlflow</a> (+12 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ docs/source/llms/llm-evaluate/notebooks/question-answering-evaluation.ipynb:cell 28:1:1: W391 [*] Extra newline at end of file
+ docs/source/llms/llm-evaluate/notebooks/rag-evaluation-llama2.ipynb:cell 22:1:1: W391 [*] Extra newline at end of file
+ docs/source/llms/llm-evaluate/notebooks/rag-evaluation.ipynb:cell 19:1:1: W391 [*] Extra newline at end of file
+ docs/source/llms/rag/notebooks/retriever-evaluation-tutorial.ipynb:cell 48:1:1: W391 [*] Extra newline at end of file
+ docs/source/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/parent-child-runs.ipynb:cell 15:1:1: W391 [*] Extra newline at end of file
+ docs/source/traditional-ml/serving-multiple-models-with-pyfunc/notebooks/MME_Tutorial.ipynb:cell 25:1:1: W391 [*] Extra newline at end of file
+ examples/evaluation/qa-evaluation.ipynb:cell 29:1:1: W391 [*] Extra newline at end of file
+ examples/evaluation/rag-evaluation.ipynb:cell 16:1:1: W391 [*] Extra newline at end of file
+ examples/h2o/random_forest.ipynb:cell 6:1:1: W391 [*] Extra newline at end of file
+ examples/llms/RAG/retriever-evaluation-tutorial.ipynb:cell 48:1:1: W391 [*] Extra newline at end of file
+ examples/rapids/mlflow_project/notebooks/rapids_mlflow.ipynb:cell 14:1:1: W391 [*] Extra newline at end of file
+ examples/sklearn_elasticnet_wine/train.ipynb:cell 6:1:1: W391 [*] Extra newline at end of file
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| W391 | 27 | 27 | 0 | 0 | 0 |</p>
</p>


Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/too_many_newlines_at_end_of_file.rs</code>:63 on 2024-03-06 09:07</div>
            <div class="timeline-body"><p>It might be best to make this a token based rule and move it to <code>check_tokens</code>. You can then simply consume the tokens from the back and test if there&#x27;s more than one <code>NEWLINE</code> token at the back. That should fix the performance regression.</p>
<p>Or you rewrite the rule to not use a <code>Regex</code> here (a Regex is a very powerful tool to test for some empty whitespace at the end of a file), because Regex are expensive to construct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-03-06 09:08</div>
            <div class="timeline-body"><p>Thanks for your contribution.</p>
<p>We should convert this to a token based rule OR avoid using a regex to fix the performance regression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a> reviewed on 2024-03-06 23:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/augustelalande">@augustelalande</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/too_many_newlines_at_end_of_file.rs</code>:63 on 2024-03-06 23:53</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-08 04:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-12 01:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/too_many_newlines_at_end_of_file.rs</code>:60 on 2024-03-12 01:36</div>
            <div class="timeline-body"><p>I removed the <code>Locator</code>. I don&#x27;t think we need to guard on empty files here -- that&#x27;s just for the &quot;no trailing newline&quot; check, since empty files would be a false positive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-03-12 01:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 02:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 02:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-12 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-04-30 18:06</div>
            <div class="timeline-body"><p>One more step towards https://github.com/astral-sh/ruff/discussions/9057 üéâ</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:01:59 UTC
    </footer>
</body>
</html>
