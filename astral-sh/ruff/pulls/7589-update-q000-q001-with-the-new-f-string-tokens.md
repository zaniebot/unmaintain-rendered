```yaml
number: 7589
title: "Update `Q000`, `Q001` with the new f-string tokens"
type: pull_request
state: merged
author: dhruvmanila
labels:
  - rule
  - python312
assignees: []
merged: true
base: dhruv/pep-701
head: dhruv/issue-7297-2
created_at: 2023-09-22T05:15:01Z
updated_at: 2023-09-28T03:59:02Z
url: https://github.com/astral-sh/ruff/pull/7589
synced_at: 2026-01-12T02:39:10Z
```

# Update `Q000`, `Q001` with the new f-string tokens

---

_Pull request opened by @dhruvmanila on 2023-09-22 05:15_

## Summary

This PR updates the `Q000`, and `Q001` rules to consider the new f-string tokens. The docstring rule (`Q002`) doesn't need to be updated because f-strings cannot be used as docstrings.

I tried implementing the nested f-string support but there are still some edge cases in my current implementation so I've decided to pause it for now and I'll pick it up sometime soon. So, for now this doesn't support nested f-strings.

### Implementation

The implementation uses the same `FStringRangeBuilder` introduced in #7586 to build up the outermost f-string range. The reason to use the same implementation is because this is a temporary solution until we add support for nested f-strings.

## Test Plan

`cargo test`


---

_Comment by @dhruvmanila on 2023-09-22 05:15_

Current dependencies on/for this PR:
* main
  * **PR #7376** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7376" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7690** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7690" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7667** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7667" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7597** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7597" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7588** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7588" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #7589** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7589" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #7586** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7586" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7515** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7515" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7477** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7477" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7387** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7387" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7378** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7378" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7329** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7329" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7328** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7328" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7327** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7327" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7326** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7326" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7325** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7325" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7589?utm_source=stack-comment).

---

_Comment by @codspeed-hq[bot] on 2023-09-22 05:30_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/dhruv/issue-7297-2)

### Merging #7589 will **not alter performance**

<sub>Comparing <code>dhruv/issue-7297-2</code> (715b5df) with <code>dhruv/issue-7297</code> (7753ce8)</sub>



### Summary

`âœ… 25` untouched benchmarks






---

_Renamed from "Update `Q000-002` with the new f-string tokens" to "Update `Q000`, `Q001` with the new f-string tokens" by @dhruvmanila on 2023-09-22 06:01_

---

_Label `rule` added by @dhruvmanila on 2023-09-22 06:01_

---

_Label `python312` added by @dhruvmanila on 2023-09-22 06:01_

---

_Marked ready for review by @dhruvmanila on 2023-09-22 06:02_

---

_Review requested from @MichaReiser by @dhruvmanila on 2023-09-22 06:02_

---

_Review requested from @charliermarsh by @dhruvmanila on 2023-09-22 06:02_

---

_Review comment by @MichaReiser on `crates/ruff_linter/src/rules/flake8_quotes/rules/check_string_quotes.rs`:381 on 2023-09-22 13:40_

This will overflow if `self.nesting` is already 0 (which could happen because we use `flatten()`). So I think we should use `saturating_sub` or test if `self.nesting == 1` -> set the `end_location` and decrement. Otherwise decrement only

---

_@MichaReiser approved on 2023-09-22 13:42_

---

_@dhruvmanila reviewed on 2023-09-22 13:46_

---

_Review comment by @dhruvmanila on `crates/ruff_linter/src/rules/flake8_quotes/rules/check_string_quotes.rs`:381 on 2023-09-22 13:46_

Yes, sorry. A bad copy paste mistake.

---

_Closed by @dhruvmanila on 2023-09-22 17:20_

---

_Reopened by @dhruvmanila on 2023-09-22 17:20_

---

_Merged by @dhruvmanila on 2023-09-27 08:04_

---

_Closed by @dhruvmanila on 2023-09-27 08:04_

---

_Branch deleted on 2023-09-27 08:04_

---
