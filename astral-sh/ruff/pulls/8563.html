<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply consistent code block labels - astral-sh/ruff #8563</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Apply consistent code block labels</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8563">#8563</a>
        opened by <a href="https://github.com/doolio">@doolio</a>
        on 2023-11-08 14:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/doolio">@doolio</a> on 2023-11-08 14:35</div>
            <div class="timeline-body"><p>This ensures the python label is used for all python code blocks for consistency.</p>
<h2>Test Plan</h2>
<p>Visual inspection of all changes via git client ensuring no other changes were made in error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/doolio">@doolio</a> on 2023-11-08 16:35</div>
            <div class="timeline-body"><p>I don't know why these checks fail. I don't think it is related to the changes I made.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-08 17:06</div>
            <div class="timeline-body"><p>@doolio you edited a bunch of our test snapshots in which ```py is generated</p>
<p>https://github.com/astral-sh/ruff/blob/317d3dd61218bcc35b20a42403f3c9acc1963be2/crates/ruff_python_formatter/tests/fixtures.rs#L267</p>
<p>That's why the tests are failing now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/doolio">@doolio</a> on 2023-11-08 17:34</div>
            <div class="timeline-body"><p>Oh ok. So I should not have made the changes in the <code>.snap</code> files? I made this PR because I noticed there were many more instances of <code> ```python</code> than <code> ```py</code> code blocks across the codebase even in the <code>.rs</code> files.</p>
<p>If I change the string from &quot;py&quot; to &quot;python&quot; in the following and equivalent lines would that allow these checks to pass?</p>
<p>https://github.com/astral-sh/ruff/blob/3ebaca52464e1db3d808adca9c3de09b90dabfaf/crates/ruff_python_formatter/tests/fixtures.rs#L74</p>
<p>If these changes are unwelcome feel free to close this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-08 17:37</div>
            <div class="timeline-body"><blockquote>
<p>So I should not have made the changes in the .snap files?</p>
</blockquote>
<p>Yeah the snapshots are generally updated by <code>cargo insta test</code> and <code>cargo insta review</code>.</p>
<p>This pull request would be simpler if you didn't touch those files, I'm not sure if we care about the language header there cc @konstin</p>
<blockquote>
<p>If I change the string from &quot;py&quot; to &quot;python&quot; in the following and equivalent lines would that allow these checks to pass?</p>
</blockquote>
<p>They might — I'm not sure of all the details for the formatter test fixtures without trying it.</p>
<blockquote>
<p>If these changes are unwelcome feel free to close this PR.</p>
</blockquote>
<p>They seem reasonable!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2023-11-08 17:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-08 17:59</div>
            <div class="timeline-body"><p>Changing <code>CodeFrame::new(&quot;py&quot;</code> to <code>CodeFrame::new(&quot;python&quot;</code> and then running the test should give the desired formatting, i'm in favor of changing the snapshot files for consistency. You don't need to edit the snap file automatically, they are generated by <a href="https://insta.rs/">insta</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/doolio">@doolio</a> on 2023-11-08 18:02</div>
            <div class="timeline-body"><p>OK cool. Is it simpler then for me to close this PR and create a new one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-08 18:03</div>
            <div class="timeline-body"><p>It's ok for it to be part of this PR. You can change the reference above, and then run <code>cargo test</code> followed by <code>cargo insta review</code>. It should ask you about each snapshot change, and you can confirm them all, then check in the changes and push.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/doolio">@doolio</a> on 2023-11-08 18:58</div>
            <div class="timeline-body"><blockquote>
<p>then run <code>cargo test</code> followed by <code>cargo insta review</code>.</p>
</blockquote>
<p><code>cargo test</code> seems to have run without issue but I get the following error trying to run the second command.</p>
<p><img src="https://github.com/astral-sh/ruff/assets/13859009/847572fa-5b68-452a-a94d-9956bf6d77ac" alt="image" /></p>
<p>I can confirm though <code>insta-1.34.0</code> is in my <code>cargo</code> registry.</p>
<p>I installed <code>cargo-insta</code> (necessary?) and re-ran both commands. Again the tests passed without issue but I now get the following output from the second command.</p>
<p><img src="https://github.com/astral-sh/ruff/assets/13859009/aae6e621-f796-4f17-b4bb-94137f7d6bd0" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 01:42</div>
            <div class="timeline-body"><p>@doolio - They may be nothing to review because you already modified the snapshots themselves. (Typically, if you change something, you run tests, then run <code>cargo insta review</code> to review and accept the changes.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 01:42</div>
            <div class="timeline-body"><p>Anyway, this looks good to me! Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-11-09 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-09 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-11-09 02:00</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-09 08:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:13:18 UTC
    </footer>
</body>
</html>
