<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] rename {Class,Module,Function} =&gt; {Class,Module,Function}Literal - astral-sh/ruff #13873</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] rename {Class,Module,Function} =&gt; {Class,Module,Function}Literal</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13873">#13873</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2024-10-22 06:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<ul>
<li>Rename <code>Type::Class</code> =&gt; <code>Type::ClassLiteral</code></li>
<li>Rename <code>Type::Function</code> =&gt; <code>Type::FunctionLiteral</code></li>
<li>Do not rename <code>Type::Module</code></li>
<li>Remove <code>*Literal</code> suffixes in <code>display::LiteralTypeKind</code> variants, as per clippy suggestion</li>
<li>Get rid of <code>Type::is_class()</code> in favor of <code>is_subtype_of(â€¦, 'type')</code>; modifiy <code>is_subtype_of</code> to support this.</li>
<li>Add new <code>Type::is_xyz()</code> methods and use them instead of matching on <code>Type</code> variants.</li>
</ul>
<p>closes #13863</p>
<h2>Test Plan</h2>
<p>New <code>is_subtype_of_class_literals</code> unit test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2024-10-22 06:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @sharkdp on 2024-10-22 06:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2024-10-22 06:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @sharkdp on 2024-10-22 06:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types/display.rs</code>:194 on 2024-10-22 06:54</div>
            <div class="timeline-body"><p>Instead of adding suffixes to the <code>Class</code> and <code>Function</code> variants, I removed the suffix from the other remaining variants.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 06:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-22 07:07</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 07:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 07:45</div>
            <div class="timeline-body"><p>I wonder if it also makes sense to rename this to <code>ModuleLiteral</code>, to distinguish it from <code>Type::Instance(types.ModuleType)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-10-22 07:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/display.rs</code>:194 on 2024-10-22 07:50</div>
            <div class="timeline-body"><p>Makes sense. I think clippy would also start yelling at you if all have the same suffix :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 07:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types/display.rs</code>:194 on 2024-10-22 07:55</div>
            <div class="timeline-body"><p>Exactly (see PR description)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 07:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 07:58</div>
            <div class="timeline-body"><p>Same thought here. Then I saw that <code>Module</code> was not part of <code>LiteralTypeKind</code>, so it's not treated as a literal in the <code>display</code> mod. On the other hand, we treat it similar to <code>FunctionLiteral</code> and <code>ClassLiteral</code> almost everywhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 08:22</div>
            <div class="timeline-body"><p>I think how we display the type should probably be secondary to how we use and think about the type when it comes to naming. And there are already some confusing things about the <code>LiteralTypeKind</code> enum, e.g. that it (correctly) does not contain a variant for <code>LiteralString</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 08:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 08:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 08:28</div>
            <div class="timeline-body"><p>In #13257 I proposed renaming <code>LiteralTypeKind</code> to <code>CondensedDisplayTypeKind</code> (as part of a broader changeset) â€” that PR isn't going anywhere fast, so it might be worth you doing that here or me pulling it out into a standalone PR. I think it's a clearer name</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 08:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 08:35</div>
            <div class="timeline-body"><blockquote>
<p>renaming <code>LiteralTypeKind</code> to <code>CondensedDisplayTypeKind</code></p>
</blockquote>
<p>I can do that.</p>
<p>And what do we do with <code>Type::Module</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 08:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 08:45</div>
            <div class="timeline-body"><blockquote>
<p>And what do we do with <code>Type::Module</code>?</p>
</blockquote>
<p>I would vote to rename it to <code>ModuleLiteral</code> but otherwise leave it unchanged in this PR. I think if we rename <code>LiteralTypeKind</code> to <code>CondensedDisplayTypeKind</code>, it becomes more obvious that not all &quot;literal&quot; types really need to be included in that enum, just the ones that have condensed displays</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] rename {Class,Function} => {Class,Function}Literal" to "[red-knot] rename {Class,Module,Function} => {Class,Module,Function}Literal" by @sharkdp on 2024-10-22 08:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 10:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:260 on 2024-10-22 10:32</div>
            <div class="timeline-body"><p>Done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_model.rs</code>:208 on 2024-10-22 10:33</div>
            <div class="timeline-body"><p>nit: we could add <code>is_function_literal()</code> and <code>is_class_literal</code> methods to <code>Type</code>, and use them here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/display.rs</code>:188 on 2024-10-22 10:37</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// Enumeration of literal types that are displayed in a &quot;condensed way&quot; inside `Literal` slices.
///
/// For example, `Literal[1] | Literal[2]` is displayed as `&quot;Literal[1, 2]&quot;`.
/// Not all `Literal` types are displayed using `Literal` slices
/// (e.g. it would be inappropriate to display `LiteralString`
/// as `Literal[LiteralString]`).
#[derive(Copy, Clone, Debug, Eq, PartialEq, Hash)]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-22 10:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-22 10:39</div>
            <div class="timeline-body"><p>(Could possibly wait for @carljm's review as well on this before landing, in case he disagrees with me on anything ðŸ˜„)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 10:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/semantic_model.rs</code>:208 on 2024-10-22 10:50</div>
            <div class="timeline-body"><p>This method does not exist :smile:. I could do <code>assert!(ty.into_function_literal_type().is_some())</code>, but I don't think that's much better than matching on the variant?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_model.rs</code>:208 on 2024-10-22 10:53</div>
            <div class="timeline-body"><blockquote>
<p>This method does not exist ðŸ˜„</p>
</blockquote>
<p>I know! Sorry for being unclear. I'm suggesting we could add <code>Type::is_function_literal()</code> and <code>Type::is_class_literal()</code> methods to the <code>Type</code> enum, for consistency with our existing <code>Type::is_unbound</code> and <code>Type::is_never</code> methods. It doesn't <em>have</em> to be done in this PR, but it also <em>might as well</em> if we're touching these lines anyway ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 10:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/semantic_model.rs</code>:208 on 2024-10-22 11:03</div>
            <div class="timeline-body"><p>No, sorry. I misread.</p>
<p><code>is_function_literal</code> does not exist, but <code>is_class_literal</code> exists. It does something different from just matching against <code>Type::ClassLiteral</code> though :see_no_evil:</p>
<pre><code class="language-rs">pub fn is_class_literal(&amp;self, db: &amp;'db dyn Db) -&gt; bool {
    match self {
        Type::Union(union) =&gt; union.elements(db).iter().all(|ty| ty.is_class_literal(db)),
        Type::ClassLiteral(_) =&gt; true,
        // / TODO include type[X], once we add that type
        _ =&gt; false,
    }
}
</code></pre>
<p>So if we want to do this properly, I guess we would have to rename the existing <code>is_class_literal</code> function...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 11:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-22 11:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_model.rs</code>:208 on 2024-10-22 11:10</div>
            <div class="timeline-body"><blockquote>
<p>So if we want to do this properly, I guess we would have to rename the existing <code>is_class_literal</code> function...</p>
</blockquote>
<p>We're well down the renaming rabbit hole now. May as well ðŸ˜†</p>
<p>It seems like the question the existing <code>is_class_literal</code> method is <em>actually</em> trying to answer is &quot;Is the type a subtype of <code>Instance(builtins.type)</code>?&quot;. Maybe we could try to just get rid of it and make <code>is_subtype_of</code> work correctly for <code>Instance(builtins.type)</code>, so that it recognises all <code>Type::ClassLiteral</code>s as subtypes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:397 on 2024-10-22 14:33</div>
            <div class="timeline-body"><p>This is the only callsite of the existing <code>is_class_literal</code>. I agree that the question this is really trying to answer is &quot;is this a subtype of <code>builtins.type</code>&quot;, and ideally we should just support that in <code>Type::is_subtype_of</code> (that a <code>ClassLiteral</code> is a subtype of <code>builtins.type</code>). And ideally <code>Type::is_class_literal</code> would simply mean &quot;is the Type::ClassLiteral variant&quot;.</p>
<p>Don't feel strongly about whether that happens in this PR or not, though.</p>
<p>(EDIT: oops, this isn't the callsite, it's the definition ðŸ˜† but this does have just one callsite, and it would be correct, in terms of the runtime behavior that callsite is trying to model, to change that callsite to an <code>is_subtype_of(builtins.type)</code> call.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-10-22 14:33</div>
            <div class="timeline-body"><p>Looks great to me, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2024-10-22 19:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/semantic_model.rs</code>:208 on 2024-10-22 19:59</div>
            <div class="timeline-body"><p>Did that now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-10-22 20:09</div>
            <div class="timeline-body"><p>Looks excellent!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2024-10-22 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2024-10-22 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-22 20:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:09 UTC
    </footer>
</body>
</html>
