<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add t-string fixtures for rules that do not need to be modified - astral-sh/ruff #19146</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add t-string fixtures for rules that do not need to be modified</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19146">#19146</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-07-04 15:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>I used a script to attempt to identify those rules with the following property: changing f-strings to t-strings in the corresponding fixture altered the number of lint errors emitted. In other words, those rules for which f-strings and t-strings are not treated the same in the current implementation.</p>
<p>This PR documents the subset of such rules where this is fine and no changes need to be made to the implementation of the rule. Mostly these are the rules where it is relevant that an f-string evaluates to type <code>str</code> at runtime whereas t-strings do not.</p>
<p>In theory many of these fixtures are not super necessary - it's unlikely t-strings would be used for most of these. However, the internal handling of t-strings is tightly coupled with that of f-strings, and may become even more so as we implement the upcoming changes due to https://github.com/python/cpython/pull/135996 . So I'd like to keep these around as regression tests.</p>
<p>Note: The <code>flake8-bandit</code> fixtures were already added during the original t-string implementation.</p>
<p>| Rule(s) | Reason |
| --- | --- |
| <a href="https://docs.astral.sh/ruff/rules/unused-method-argument/#unused-method-argument-arg002"><code>unused-method-argument</code> (<code>ARG002</code>)</a> | f-strings exempted for msg in <code>NotImplementedError</code> not relevant for t-strings |
| <a href="https://docs.astral.sh/ruff/rules/logging-f-string/#logging-f-string-g004"><code>logging-f-string</code> (<code>G004</code>)</a> | t-strings cannot be used here |
| <a href="https://docs.astral.sh/ruff/rules/f-string-in-get-text-func-call/#f-string-in-get-text-func-call-int001"><code>f-string-in-get-text-func-call</code> (<code>INT001</code>)</a> | rule justified by eager evaluation of interpolations |
| <a href="https://docs.astral.sh/ruff/rules/#flake8-bandit-s"><code>flake8-bandit</code></a>| rules justified by eager evaluation of interpolations |
| <a href="https://docs.astral.sh/ruff/rules/single-string-slots/#single-string-slots-plc0205"><code>single-string-slots</code> (<code>PLC0205</code>)</a> | t-strings cannot be slots in general |
| <a href="https://docs.astral.sh/ruff/rules/unnecessary-encode-utf8/#unnecessary-encode-utf8-up012"><code>unnecessary-encode-utf8</code> (<code>UP012</code>)</a> | cannot encode t-strings |
| <a href="https://docs.astral.sh/ruff/rules/no-self-use/#no-self-use-plr6301"><code>no-self-use</code> (<code>PLR6301</code>)</a> | f-strings exempted for msg in NotImplementedError not relevant for t-strings |
| <a href="https://docs.astral.sh/ruff/rules/pytest-raises-too-broad/"><code>pytest-raises-too-broad</code> (<code>PT011</code>)</a> / <a href="https://docs.astral.sh/ruff/rules/pytest-fail-without-message/#pytest-fail-without-message-pt016"><code>pytest-fail-without-message</code> (<code>PT016</code>)</a> / <a href="https://docs.astral.sh/ruff/rules/pytest-warns-too-broad/#pytest-warns-too-broad-pt030"><code>pytest-warns-too-broad</code> (<code>PT030</code>)</a> | t-strings cannot be empty or used as messages |
| <a href="https://docs.astral.sh/ruff/rules/assert-on-string-literal/#assert-on-string-literal-plw0129"><code>assert-on-string-literal</code> (<code>PLW0129</code>)</a> | t-strings are not strings and cannot be empty |
| <a href="https://docs.astral.sh/ruff/rules/native-literals/#native-literals-up018"><code>native-literals</code> (<code>UP018</code>)</a> | t-strings are not native literals |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @dylwil3 on 2025-07-04 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-04 15:43</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-07-04 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-07-04 18:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/resources/test/fixtures/pylint/single_string_slots.py</code>:39 on 2025-07-04 18:29</div>
            <div class="timeline-body"><p>Somewhat perversely someone <em>could</em> put <code>__slots__ = t&quot;abc&quot;</code> since t-strings are iterables that iterate over the string and interpolation objects within them. So that would accidentally be an iterable with a single string object &quot;abc&quot; in it.</p>
<p>If people are doing that (no way they are) we should probably implement a different lint rule for it though, that just says &quot;why have you done this?&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/resources/test/fixtures/pylint/assert_on_string_literal.py</code>:29 on 2025-07-08 06:50</div>
            <div class="timeline-body"><p>It's not a 100% clear to me if they should be excluded but I think it's a good starting point and it should be a way less common mistake and they would be a better fit for a <code>assert-on-always-true</code> or similar rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-07-08 06:51</div>
            <div class="timeline-body"><p>Thanks for the nice summary!</p>
<p>I do find some of the reasoning a bit confusing:</p>
<ul>
<li><a href="https://docs.astral.sh/ruff/rules/assert-on-string-literal/#assert-on-string-literal-plw0129">assert-on-string-literal (PLW0129)</a>: It's correct that t-strings don't evaluate to strings but that they're never empty is exactly what this rule is trying to catch. I also think it's confusing to say that t-strings can't be empty, t&quot;&quot; is an empty t-string.  I think the reasoning here is simply that they're not a string and it's unlikely that a user would make the same mistake.</li>
<li>The same applies for other rules where you reason that a t-string can't be empty. I think the reasoning there mainly is that t-strings aren't allowed/correct in those positions because they don't evaluate to a str</li>
<li><a href="https://docs.astral.sh/ruff/rules/#flake8-bandit-s">flake8-bandit</a>: It's unclear to me about which rules you're talking here. Is it the hardcoded password rules (which may apply?)</li>
<li><a href="https://docs.astral.sh/ruff/rules/f-string-docstring/#f-string-docstring-b021">f-string-docstring (B021)</a>: I'm not sure how this is different to f-strings that can't be docstrings either. We may need to create a new rule or rename the existing one but it seems the same fundamental problem applies to f- and t-strings.</li>
<li><a href="https://docs.astral.sh/ruff/rules/useless-expression/#useless-expression-b018">useless-expression (B018)</a>: I assume this is mainly about the allowing of f-string literals. Which I'm wondering is actually unnecessary/incorrect. But that's unrelated to this PR (and we could make it more accurate by testing if we're in a docstring position and only allow it there rather than always)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-07-08 12:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/resources/test/fixtures/pylint/assert_on_string_literal.py</code>:29 on 2025-07-08 12:24</div>
            <div class="timeline-body"><p>This is what I meant by &quot;cannot be empty&quot;. The actual documentation for this rule justifies it as:</p>
<blockquote>
<p>An assert on a non-empty string literal will always pass, while an assert on an empty string literal will always fail.</p>
</blockquote>
<p>which does not apply to t-strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-07-14 14:46</div>
            <div class="timeline-body"><p>Thanks for catching the oversight re B018/B021 - reverting those fixtures now. The rest looks correct to me - see my clarification of what I meant by &quot;no empty t-string&quot; (essentially that, unlike other string types, <code>t&quot;&quot;</code> is truthy, so it's not &quot;empty&quot; in the same way).</p>
<p>The bandit rules in question are:</p>
<ul>
<li><a href="https://docs.astral.sh/ruff/rules/hardcoded-bind-all-interfaces/#hardcoded-bind-all-interfaces-s104">hardcoded-bind-all-interfaces (S104)</a></li>
<li><a href="https://docs.astral.sh/ruff/rules/hardcoded-temp-file/#hardcoded-temp-file-s108">hardcoded-temp-file (S108)</a></li>
<li><a href="https://docs.astral.sh/ruff/rules/hardcoded-sql-expression/#hardcoded-sql-expression-s608">hardcoded-sql-expression (S608)</a></li>
</ul>
<p>At the moment the hardcoded password rules do not trigger for f-strings. So if we want them to trigger for t-strings, then we should have them trigger for both. Either way that would involve changing the implementation, so out of scope for the current PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2025-07-14 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-07-14 14:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:58 UTC
    </footer>
</body>
</html>
