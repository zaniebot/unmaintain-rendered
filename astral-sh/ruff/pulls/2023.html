<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-executable`] EXE003-005 - astral-sh/ruff #2023</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-executable</code>] EXE003-005</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2023">#2023</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2023-01-20 11:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a></div>
            <div class="timeline-body"><p>Tracking issue: <a href="https://github.com/charliermarsh/ruff/issues/2024">charliermarsh/ruff#2024</a></p>
<p>Implementation for EXE003, EXE004 and EXE005 of <code>flake8-executable</code>
(shebang should contain &quot;python&quot;, not have whitespace before, and should be on the first line)</p>
<p>Please take in mind that this is my first rust contribution.</p>
<p>The remaining EXE-rules are a combination of shebang (<code>lines.rs</code>), file permissions (<code>fs.rs</code>) and if-conditions (<code>ast.rs</code>). I was not able to find other rules that have interactions/dependencies in them. Any advice on how this can be best implemented would be very welcome.</p>
<p>For autofixing <code>EXE005</code>, I had in mind to <em>move</em>  the shebang line to the top op the file. This could be achieved by a combination of <code>Fix::insert</code> and <code>Fix::delete</code> (multiple fixes per diagnostic), or by implementing a dedicated <code>Fix::move</code>, or perhaps in other ways. For now I&#x27;ve left it out, but keen on hearing what you think would be most consistent with the package, and pointer where to start (if at all).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>resources/test/fixtures/flake8_executable/EXE005_3.py</code>:6 on 2023-01-20 12:21</div>
            <div class="timeline-body"><p>Are these intentionally missing newlines at end-of-file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`flake8-executable`] EXE004 and EXE005&quot; to &quot;[`flake8-executable`] EXE003-005&quot; by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-01-20 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_executable/rules/shebang_whitespace.rs</code>:17 on 2023-01-20 12:24</div>
            <div class="timeline-body"><p>Sorry for the nit, but we tend to exclude punctuation unless it&#x27;s a multi-sentence message. Stylistically, this might fit in a little more: <code>format!(&quot;Avoid whitespace before shebang&quot;)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_executable/helpers.rs</code>:11 on 2023-01-20 12:24</div>
            <div class="timeline-body"><p>Can we add a comment here to document these fields? (Or use a struct with named fields and comments?) Will make it a bit clearer by disambiguating all the <code>usize</code> members.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-20 12:25</div>
            <div class="timeline-body"><p>This looks excellent, thank you for putting it together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 23:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 23:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/checkers/lines.rs</code>:71 on 2023-01-20 23:20</div>
            <div class="timeline-body"><p>@sbrugman - I did some benchmarking and using a single <code>extract_shebang</code> call (+ the weird optimization track I added to the extraction method) brought time down from ~180ms to 100ms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-20 23:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/checkers/lines.rs</code>:71 on 2023-01-20 23:20</div>
            <div class="timeline-body"><p>(Just noting here so that you&#x27;re not confused if you come back to finish off the plugin.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-20 23:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/checkers/lines.rs</code>:71 on 2023-01-20 23:42</div>
            <div class="timeline-body"><p>Excellent, thanks. I considered it but was not sure if having the logic in <code>lines.rs</code> was ok, or that is should have been moved to the <code>flake8-executable</code> rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-20 23:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-20 23:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/flake8_executable/helpers.rs</code>:17 on 2023-01-20 23:42</div>
            <div class="timeline-body"><p>Good one</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-01-20 23:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_executable/helpers.rs</code>:17 on 2023-01-20 23:48</div>
            <div class="timeline-body"><p>I feel like my brain is too small to understand why this is so effective (it reduced time from ~120ms to 100ms). I guess we&#x27;re exploiting the fact that we know <code>!</code> is very uncommon, which <code>regex</code> itself can&#x27;t know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-20 23:48</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:53 UTC
    </footer>
</body>
</html>
