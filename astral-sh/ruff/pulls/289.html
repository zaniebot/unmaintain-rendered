<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expose a public 'check' method - astral-sh/ruff #289</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Expose a public 'check' method</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/289">#289</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-09-29 22:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>See: #271.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-29 22:31</div>
            <div class="timeline-body"><p>@Seamooo - Is this roughly what's needed for the LSP? (Is there any way to get the LSP to pass us a path, even as a string, to include in the error messages?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-09-29 22:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/lib.rs</code>:29 on 2022-09-29 22:44</div>
            <div class="timeline-body"><p>With this, you can do:</p>
<pre><code class="language-rust">use anyhow::Result;
use ruff;

fn main() -&gt; Result&lt;()&gt; {
    println!(&quot;{:?}&quot;, ruff::check(&quot;def f(): x = 1&quot;)?);
    Ok(())
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-29 23:06</div>
            <div class="timeline-body"><p>@Seamooo - What are you planning to use to implement the LSP? https://github.com/ebkalderon/tower-lsp?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-09-29 23:49</div>
            <div class="timeline-body"><p>the lsp can definitely pass a path, the source requirement is due to the dynamic nature of the buffer updating. I've implemented a rough version of the lsp from scratch https://github.com/Seamooo/ruffd, getting this in would enable a proof of concept.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 00:29</div>
            <div class="timeline-body"><p>That's awesome. And it's <a href="https://github.com/Seamooo/ruffd/blob/main/ruffd-core/src/server_ops.rs#L62">here</a> that we can plug into ruff as a library?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 00:30</div>
            <div class="timeline-body"><p>(Did you write that implementation from scratch? Is it based off anything else?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 00:33</div>
            <div class="timeline-body"><p>Two questions:</p>
<ol>
<li>Should I change the method signature to include something like <code>path: &amp;str</code> or even <code>path: Path</code>? Some of the internals like to have a <code>Path</code>, e.g., for formatting the <code>Message</code> body, but it could be worked around if it needs to be omitted.</li>
<li>How should we determine the <code>pyproject.toml</code> path here? Is there any way to base it on the user's current working directory? Or can the LSP path an absolute path to a file?</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2022-09-30 00:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 00:36</div>
            <div class="timeline-body"><p>(I went ahead and did (1); if we pass the absolute <code>Path</code>, it will in turn solve (2).)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-09-30 00:50</div>
            <div class="timeline-body"><blockquote>
<p>That's awesome. And it's <a href="https://github.com/Seamooo/ruffd/blob/main/ruffd-core/src/server_ops.rs#L62">here</a> that we can plug into ruff as a library?</p>
</blockquote>
<p>Exactly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-09-30 00:52</div>
            <div class="timeline-body"><blockquote>
<p>(Did you write that implementation from scratch? Is it based off anything else?)</p>
</blockquote>
<p>it's implemented from scratch from the specification, with coc-nvim as the client to verify</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-09-30 00:53</div>
            <div class="timeline-body"><p>There's potentially some ambiguity for solving the <code>pyproject.toml</code> path. The easiest would just be using the workspace root provided by the lsp client, but potentially there's cases where the workspace has nested configurations underneath it. For that case the implementation would be to recurse from the file path upwards until finding a <code>pyproject.toml</code> terminating at the workspace root. If the public method takes in <code>&amp;Settings</code>, potentially the public api shouldn't have to account for it. This may also enable global configs outside of pyproject.toml that can create the settings type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 15:30</div>
            <div class="timeline-body"><blockquote>
<p>For that case the implementation would be to recurse from the file path upwards until finding a pyproject.toml terminating at the workspace root.</p>
</blockquote>
<p>If we pass <code>check</code> a path to a file, then <code>find_project_root</code> will automatically do this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2022-09-30 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-30 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-09-30 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 15:30</div>
            <div class="timeline-body"><p>@Seamooo - I've merged this for now. Let me know if it works for you or if we need to amend the API!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seamooo">@Seamooo</a> on 2022-09-30 17:34</div>
            <div class="timeline-body"><p><img src="https://user-images.githubusercontent.com/48548685/193325446-08c3931c-6479-4a39-8b81-f660439bb7d9.png" alt="image" />
looking good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 18:03</div>
            <div class="timeline-body"><p>Nice! That's awesome!</p>
<p>What does it take to enable others to use the LSP from VS Code and elsewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-30 23:28</div>
            <div class="timeline-body"><p>(E.g., do we need to publish this on some sort of extension marketplace?)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:54:38 UTC
    </footer>
</body>
</html>
