<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rename string AST nodes - astral-sh/ruff #9120</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rename string AST nodes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9120">#9120</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-12-13 20:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>Rename the string nodes for better understanding between the types. The following renames are performed:</p>
<p><strong>Enum variants:</strong></p>
<ul>
<li><code>Expr::StringLiteral</code>-&gt; <code>Expr::String</code></li>
<li><code>Expr::BytesLiteral</code> -&gt; <code>Expr::Bytes</code></li>
<li><code>FStringPart::Literal</code> -&gt; <code>FStringPart::String</code> - This includes the string literal part of an implictly concatenated f-string (e.g. <code>&quot;foo&quot; f&quot;bar {x}&quot;</code>)<ul>
<li><code>FStringExprValue::literals</code> -&gt; <code>FStringExprValue::strings</code></li>
</ul>
</li>
</ul>
<p><strong>AST nodes:</strong></p>
<ul>
<li><code>ExprStringLiteral</code> -&gt; <code>ExprString</code></li>
<li><code>ExprBytesLiteral</code> -&gt; <code>ExprBytes</code></li>
</ul>
<p>To better reflect that the following are expressions:</p>
<ul>
<li><code>StringValue</code> -&gt; <code>StringExprValue</code></li>
<li><code>BytesValue</code> -&gt; <code>BytesExprValue</code></li>
<li><code>FStringValue</code> -&gt; <code>FStringExprValue</code></li>
</ul>
Open ended renames
<ul>
<li><code>LiteralExpressionRef::StringLiteral</code> -&gt; <code>LiteralExpressionRef::String</code> (enum variant)</li>
<li><code>LiteralExpressionRef::BytesLiteral</code> -&gt; <code>LiteralExpressionRef::Bytes</code> (enum variant)</li>
<li><code>StringLike::StringLiteral</code> -&gt; <code>StringLike::String</code> (enum variant)</li>
<li><code>StringLike::BytesLiteral</code> -&gt; <code>StringLike::Bytes</code> (enum variant)</li>
<li><code>FStringElement</code> / <code>FStringPart</code> -&gt; <code>FStringComponent</code> (enum type)</li>
<li>Expand <code>FString</code> to <code>FormattedString</code> everywhere (struct, enum)</li>
</ul>
<p><strong>LibCST f-string names:</strong> https://github.com/Instagram/LibCST/blob/52bbff6dfc2dd7b3086710bc64896ccfaaed1a3d/native/libcst/src/nodes/expression.rs#L2430-L2443</p>
<ul>
<li><code>FormattedString</code></li>
<li><code>FormattedStringContent</code> (aka <code>FStringElement</code>)</li>
<li><code>FormattedStringText</code> (aka <code>FStringLiteralElement</code>)</li>
<li><code>FormattedStringExpression</code> (aka <code>FStringExpressionElement</code>)</li>
</ul>
<p>I like the rename of <code>FStringElement</code> to <code>FStringContent</code> as &quot;content&quot; better describes the value between the quotes or a &quot;string content&quot;.</p>
<p>Reference:</p>
<ul>
<li>https://github.com/astral-sh/ruff/pull/8835#discussion_r1414759829</li>
<li>https://github.com/astral-sh/ruff/pull/9058#pullrequestreview-1778954720</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-13 20:34</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li><code>main</code><ul>
<li><strong>PR #9120</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/9120?utm_source=stack-comment-icon"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
<p>This <a href="https://stacking.dev/?utm_source=stack-comment">stack of pull requests</a> is managed by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/9120?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-12-13 20:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-12-14 02:57</div>
            <div class="timeline-body"><p>I only looked at the changes in <code>nodes.rs</code> so far. Here a few notes (before you perform the entire rename):</p>
<ul>
<li><code>is_literal_expr</code>: I guess this is a downside of removing the <code>Literal</code> suffix from <code>ExprString</code> and <code>ExprBytes</code> because it may now be unexpected that <code>is_literal_expr</code> returns <code>true</code> for these two nodes. Maybe rename to <code>is_constant()</code>?</li>
<li>The <code>value</code> types: I find that they&#x27;re adding cognitive overhead because it isn&#x27;t a real concept that exists, but a optimization to avoid allocating in the common case of non-concatenated strings. Ideally, they would be hidden from the public API as discussed in the string formatting PR</li>
<li>You renamed the <code>literals</code> methods to <code>strings</code>. i think I liked <code>literals</code> better because I would expect that <code>strings</code> returns <code>ExprString</code>s and not literals.</li>
<li><code>FString</code>: I would rename it to <code>FStringLiteral</code> to be consistent with <code>StringLiteral</code> and <code>BytesLiteral</code></li>
<li><code>FStringPart::String</code>: I think I would either prefer <code>FStringLiteral::String</code> and <code>FStringLiteral::FString</code> (although the name then conflicts with the <code>FStringLiteral</code>, maybe <code>ExprFStringLiteral</code> or <code>AnyFStringLiteral</code>) or <code>FStringPart::StringLiteral</code> and <code>FStringPart::FStringLiteral</code> (clippy might complain).</li>
<li>FStrings with parts and elements always trip me over... I wonder if it&#x27;s worth re-using <code>StringLiteral</code> in FStrings or if we should normalize all of them to <code>FStringLiteral</code> and add a <code>is_f_string</code> boolean flag which is true if the literal uses the <code>f</code> flag. It would remove the need for the entire <code>FStringPart</code> which adds a significant overhead in my view. Although it would require supporting more flags than just <code>f</code> because it&#x27;s valid to mix f-strings with raw and unicode string literals <code>f&quot;a&quot; u&quot;b&quot;</code> or <code>f&quot;a&quot; r&quot;b&quot;</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-12 18:53</div>
            <div class="timeline-body"><p>@dhruvmanila is this still relevant?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 07:54</div>
            <div class="timeline-body"><blockquote>
<p>@dhruvmanila is this still relevant?</p>
</blockquote>
<p>Yes, although I&#x27;ll close this and take this up once the parser rewrite is finished to avoid rebasing and the information is already captured in PR description and Micha&#x27;s review comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-03-13 07:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:59:58 UTC
    </footer>
</body>
</html>
