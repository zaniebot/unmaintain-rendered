<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Support dataclass-transform `field_specifiers` - astral-sh/ruff #20888</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Support dataclass-transform <code>field_specifiers</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20888">#20888</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-10-15 12:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Add support for the <code>field_specifiers</code> parameter on <code>dataclass_transform</code> decorator calls.</p>
<p>closes https://github.com/astral-sh/ty/issues/1068</p>
<h2>Conformance test results</h2>
<p>All true positives :heavy_check_mark:</p>
<h2>Ecosystem analysis</h2>
<ul>
<li><p><code>trio</code>: this is the kind of change that I would expect from this PR. The code makes use of a dataclass <code>Outcome</code> with a <code>_unwrapped: bool = attr.ib(default=False, eq=False, init=False)</code> field that is excluded from the <code>__init__</code> signature, so we now see a bunch of constructor-call-related errors going away.</p>
</li>
<li><p><code>home-assistant/core</code>: They have a <code>domain: str = attr.ib(init=False, repr=False)</code> field and then use</p>
<pre><code class="language-py">  @domain.default
  def _domain_default(self) -&gt; str:
      # â€¦
</code></pre>
<p>This accesses the <code>default</code> attribute on <code>dataclasses.Field[â€¦]</code> with a type of <code>default: _T | Literal[_MISSING_TYPE.MISSING]</code>, so we get those &quot;Object of type <code>_MISSING_TYPE</code> is not callable&quot; errors. I don't really understand how that is supposed to work. Even if <code>_MISSING_TYPE</code> would be absent from that union, what does this try to call? pyright also issues an error and it doesn't seem to work at runtime? So this looks like a true positive?</p>
</li>
<li><p><code>attrs</code>: Similar here. There are some new diagnostics on code that tries to access <code>.validator</code> on a field. This <em>does</em> work at runtime, but I'm not sure how that is supposed to type-check (without a <a href="https://github.com/python/mypy/blob/2c6c3959356674262d9b2c2dc43a33486e807a9c/mypy/plugins/attrs.py#L575-L602">custom plugin</a>). pyright errors on this as well.</p>
</li>
<li><p>A handful of new false positives because we don't support <code>alias</code> yet</p>
</li>
</ul>
<h2>Test Plan</h2>
<p>Updated tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-10-15 12:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-15 12:05</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<details>
<summary>Changes were detected when running ty on typing conformance tests</summary>

<pre><code class="language-diff">--- old-output.txt	2025-10-16 13:58:15.685593376 +0000
+++ new-output.txt	2025-10-16 13:58:19.040608580 +0000
@@ -1,5 +1,5 @@
 fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_type_statement.py`: `PEP695TypeAliasType &lt; 'db &gt;::value_type_(Id(d417)): execute: too many cycle iterations`
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(16c43)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(17443)): execute: too many cycle iterations`
 _directives_deprecated_library.py:15:31: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 _directives_deprecated_library.py:30:26: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
@@ -279,6 +279,8 @@
 dataclasses_transform_converter.py:121:11: error[too-many-positional-arguments] Too many positional arguments to bound method `__init__`: expected 1, got 7
 dataclasses_transform_converter.py:130:31: error[invalid-argument-type] Argument to function `model_field` is incorrect: Expected `(Literal[1], /) -&gt; int`, found `def converter_simple(s: str) -&gt; int`
 dataclasses_transform_field.py:49:43: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(...) -&gt; @Todo(unsupported type[X] special form)`
+dataclasses_transform_field.py:64:16: error[unknown-argument] Argument `id` does not match any known parameter
+dataclasses_transform_field.py:75:1: error[missing-argument] No argument provided for required parameter `name`
 dataclasses_transform_field.py:75:16: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 1
 dataclasses_transform_func.py:57:1: error[invalid-assignment] Object of type `Literal[3]` is not assignable to attribute `name` of type `str`
 dataclasses_transform_func.py:61:6: error[unsupported-operator] Operator `&lt;` is not supported for types `Customer1` and `Customer1`
@@ -288,6 +290,7 @@
 dataclasses_transform_func.py:77:36: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `T@create_model_frozen`
 dataclasses_transform_func.py:97:1: error[invalid-assignment] Property `id` defined in `Customer3` is read-only
 dataclasses_transform_meta.py:60:36: error[unknown-argument] Argument `other_name` does not match any known parameter
+dataclasses_transform_meta.py:66:8: error[missing-argument] No arguments provided for required parameters `id`, `name`
 dataclasses_transform_meta.py:66:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 2
 dataclasses_transform_meta.py:73:6: error[unsupported-operator] Operator `&lt;` is not supported for types `Customer1` and `Customer1`
 dataclasses_transform_meta.py:79:6: error[unsupported-operator] Operator `&lt;` is not supported for types `Customer2` and `Customer2`
@@ -898,5 +901,5 @@
 typeddicts_usage.py:28:17: error[missing-typed-dict-key] Missing required key 'name' in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Invalid key access on TypedDict `Movie`: Unknown key &quot;title&quot;
 typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions. Did you mean to use a concrete TypedDict or `collections.abc.Mapping[str, object]` instead?
-Found 900 diagnostics
+Found 903 diagnostics
 WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-15 12:06</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">attrs (https://github.com/python-attrs/attrs)
- tests/dataclass_transform_example.py:21:13: info[revealed-type] Revealed type: `(self: DefineConverter, with_converter: int = int) -&gt; None`
+ tests/dataclass_transform_example.py:21:13: info[revealed-type] Revealed type: `(self: DefineConverter, with_converter: int) -&gt; None`
- tests/dataclass_transform_example.py:56:13: info[revealed-type] Revealed type: `(_a: int = Any) -&gt; None`
+ tests/dataclass_transform_example.py:56:13: info[revealed-type] Revealed type: `(_a: int) -&gt; None`
+ tests/test_hooks.py:154:48: error[missing-argument] No argument provided for required parameter `y`
+ tests/test_next_gen.py:142:14: error[unresolved-attribute] Type `dataclasses.Field` has no attribute `validator`
- tests/test_next_gen.py:380:14: error[unresolved-attribute] Type `int` has no attribute `validator`
+ tests/test_next_gen.py:380:14: error[unresolved-attribute] Type `dataclasses.Field` has no attribute `validator`
- Found 559 diagnostics
+ Found 561 diagnostics

artigraph (https://github.com/artigraph/artigraph)
- src/arti/internal/mappings.py:124:24: error[missing-argument] No argument provided for required parameter `root`
- src/arti/internal/mappings.py:124:34: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Literal[&quot;open&quot;]`
- tests/arti/types/test_types.py:146:73: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | tuple[str]`
- tests/arti/types/test_types.py:146:73: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `Unknown | tuple[str]`
- tests/arti/types/test_types.py:146:73: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | tuple[str]`
- tests/arti/types/test_types.py:150:36: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | tuple[str]`
- tests/arti/types/test_types.py:150:36: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `Unknown | tuple[str]`
- tests/arti/types/test_types.py:150:36: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | tuple[str]`
- Found 146 diagnostics
+ Found 138 diagnostics

Tanjun (https://github.com/FasterSpeeding/Tanjun)
+ tanjun/commands/menu.py:608:19: error[missing-argument] No arguments provided for required parameters `_name`, `_type`
+ tanjun/context/autocomplete.py:236:13: error[missing-argument] No arguments provided for required parameters `_name`, `_value`
- Found 113 diagnostics
+ Found 115 diagnostics

trio (https://github.com/python-trio/trio)
- src/trio/_channel.py:203:50: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `SendType@MemorySendChannel`
- src/trio/_channel.py:295:50: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ClosedResourceError`
- src/trio/_channel.py:303:54: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `EndOfChannel`
- src/trio/_channel.py:447:50: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ClosedResourceError`
- src/trio/_channel.py:455:54: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `BrokenResourceError`
- src/trio/_core/_io_common.py:28:54: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `BaseException`
- src/trio/_core/_io_kqueue.py:287:58: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ClosedResourceError`
- src/trio/_core/_parking_lot.py:303:21: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `BrokenResourceError`
+ src/trio/_core/_run.py:628:35: error[missing-argument] No argument provided for required parameter `_scope`
- src/trio/_core/_run.py:1760:38: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `TrioInternalError`
+ src/trio/_core/_run.py:1749:80: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- src/trio/_core/_run.py:1925:31: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `None`
- src/trio/_core/_run.py:2055:33: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `RuntimeError`
- src/trio/_core/_run.py:2071:33: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `None`
- src/trio/_core/_run.py:2169:56: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `BaseException`
- src/trio/_core/_run.py:2705:48: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `@Todo | list[Unknown]`
- src/trio/_core/_run.py:2884:43: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `BaseException`
- src/trio/_core/_run.py:2963:46: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `KeyboardInterrupt`
- src/trio/_core/_tests/test_ki.py:406:50: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[1]`
- src/trio/_core/_tests/test_run.py:246:54: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ValueError`
- src/trio/_core/_tests/test_run.py:253:54: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[0]`
- src/trio/_core/_tests/test_run.py:1030:65: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[1]`
- src/trio/_core/_tests/test_run.py:1287:66: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ValueError`
- src/trio/_core/_tests/test_run.py:1321:31: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ValueError`
- src/trio/_core/_tests/test_run.py:1352:66: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ValueError`
- src/trio/_core/_tests/test_run.py:1391:31: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ValueError`
- src/trio/_core/_tests/test_run.py:2431:64: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `None`
- src/trio/_core/_tests/test_run.py:2439:42: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[&quot;be free!&quot;]`
- src/trio/_core/_tests/test_run.py:2448:68: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `KeyError`
- src/trio/_core/_tests/test_run.py:2452:42: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `ValueError`
- src/trio/_core/_tests/test_run.py:2459:79: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `None`
- src/trio/_core/_traps.py:308:41: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[&quot;reattaching&quot;]`
- src/trio/_core/_traps.py:310:35: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[&quot;reattaching&quot;]`
- src/trio/_tests/test_timeouts.py:100:54: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `None`
- src/trio/_threads.py:205:35: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `RunFinishedError`
- src/trio/_threads.py:379:70: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Value[Unknown] | Error`
- Found 645 diagnostics
+ Found 613 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
- src/integrations/prefect-docker/prefect_docker/worker.py:950:35: error[missing-argument] No argument provided for required parameter `root`
- src/integrations/prefect-docker/tests/test_worker.py:1187:9: error[missing-argument] No argument provided for required parameter `root`
- src/integrations/prefect-kubernetes/tests/test_observer.py:78:42: error[missing-argument] No argument provided for required parameter `root`
- src/integrations/prefect-kubernetes/tests/test_observer.py:155:42: error[missing-argument] No argument provided for required parameter `root`
- src/integrations/prefect-redis/tests/test_messaging.py:452:30: error[missing-argument] No argument provided for required parameter `root`
- src/integrations/prefect-redis/tests/test_ordering.py:23:12: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/cli/variable.py:163:57: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | str | int | ... omitted 5 union elements`
- src/prefect/cli/variable.py:163:57: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `Unknown | str | int | ... omitted 5 union elements`
- src/prefect/cli/variable.py:163:57: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | str | int | ... omitted 5 union elements`
- src/prefect/cli/variable.py:165:57: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | str | int | ... omitted 5 union elements`
- src/prefect/cli/variable.py:165:57: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `Unknown | str | int | ... omitted 5 union elements`
- src/prefect/cli/variable.py:165:57: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Unknown | str | int | ... omitted 5 union elements`
- src/prefect/client/schemas/responses.py:469:16: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/events/related.py:36:9: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/events/related.py:51:12: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/events/utilities.py:96:27: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Any | str | dict[str, str] | dict[str, Any] | None`
- src/prefect/events/utilities.py:96:27: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `Any | str | dict[str, str] | dict[str, Any] | None`
- src/prefect/events/utilities.py:96:27: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Any] | None`, found `Any | str | dict[str, str] | dict[str, Any] | None`
- src/prefect/runner/runner.py:1052:17: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/runner/runner.py:1068:26: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/runner/runner.py:1101:17: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/runner/runner.py:1110:13: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/runner/runner.py:1126:26: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/events/actions.py:143:20: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/events/actions.py:201:20: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/events/actions.py:217:30: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/events/actions.py:233:30: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/events/schemas/automations.py:432:25: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/events/schemas/automations.py:448:21: error[missing-argument] No argument provided for required parameter `root`
- src/prefect/server/models/work_queues.py:397:17: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `dict[str, Unknown] | dict[str, Unknown | bool]`
- src/prefect/server/models/work_queues.py:415:13: error[invalid-argument-type] Argument is incorrect: Expected `set[str]`, found `dict[str, Unknown] | dict[str, Unknown | bool]`
- Found 3173 diagnostics
+ Found 3142 diagnostics

core (https://github.com/home-assistant/core)
+ homeassistant/components/device_tracker/legacy.py:409:12: error[missing-argument] No argument provided for required parameter `config`
+ homeassistant/helpers/entity_registry.py:218:5: error[call-non-callable] Object of type `_MISSING_TYPE` is not callable
+ homeassistant/helpers/entity_registry.py:443:5: error[call-non-callable] Object of type `_MISSING_TYPE` is not callable
- Found 13758 diagnostics
+ Found 13761 diagnostics

</code></pre>
</details>
<details>
<summary>Memory usage changes were detected when running on open source projects</summary>

<pre><code class="language-diff">prefect (https://github.com/PrefectHQ/prefect)
-     struct fields = ~35MB
+     struct fields = ~36MB
-     memo metadata = ~98MB
+     memo metadata = ~103MB

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-15 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-15 13:29</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 0 | 52 | 0 |
| <code>missing-argument</code> | 5 | 21 | 0 |
| <code>call-non-callable</code> | 2 | 0 | 0 |
| <code>unresolved-attribute</code> | 1 | 0 | 1 |
| <code>unused-ignore-comment</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>9</strong> | <strong>73</strong> | <strong>1</strong> |</p>
<p><strong><a href="https://david-field-specifiers.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://david-field-specifiers.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:605 on 2025-10-15 14:24</div>
            <div class="timeline-body"><p>the code inside this branch has just moved</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:4561 on 2025-10-15 14:43</div>
            <div class="timeline-body"><p>This is the key change. When we see an annotated assignment like the one for <code>id</code> in <code>C</code> â€¦</p>
<pre><code class="language-py">def fancy_field(*, init: bool = True, kw_only: bool = False) -&gt; Any: ...
@dataclass_transform(field_specifiers=(fancy_field,))

def fancy_model[T](cls: type[T]) -&gt; type[T]:
    # ...
    return cls

@fancy_model
class Person:
    id: int = fancy_field(init=False)
</code></pre>
<p>â€¦ we temporarily store a list of &quot;active&quot; field-specifiers (for this class: <code>[fancy_field]</code>) in the inference builder. Later, when inferring the call expression on the right-hand side of that assignment, we can pass down this list of field-specifiers into the call resolution logic in order to specialize calls to <code>fancy_field</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-10-15 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2025-10-15 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-10-15 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @sharkdp on 2025-10-15 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-15 15:15</div>
            <div class="timeline-body"><p>Support for metaclass-based models is actually missing here (and we generally don't support baseclass-based models yet). I think it makes sense to do this <a href="https://github.com/astral-sh/ruff/pull/20896">in a second step</a>, actually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:632 on 2025-10-15 15:27</div>
            <div class="timeline-body"><p>nit: it's a pre-existing issue, but most of our bitflags in this repo use bitshifts rather than octal to define the flags, which I find more readable, e.g.</p>
<p>https://github.com/astral-sh/ruff/blob/98d27c412810e157f8a65ea75726d66676628225/crates/ruff_python_ast/src/nodes.rs#L812-L823</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 15:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:602 on 2025-10-15 15:42</div>
            <div class="timeline-body"><p>Hm, this is probably too naive for overloaded functions (which is common for field specifiers)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @sharkdp on 2025-10-15 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:697 on 2025-10-15 17:01</div>
            <div class="timeline-body"><p>Why are we falling back to the Python <code>None</code> type here -- wouldn't we normally fall back to <code>Unknown</code> for this kind of thing? Seems probably worth a comment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:610 on 2025-10-15 17:08</div>
            <div class="timeline-body"><p>I guess all these <code>.unwrap_or(None)</code> calls could also be <code>.unwrap_or_default()</code> calls, but IDK if that's actually clearer</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:283 on 2025-10-15 17:12</div>
            <div class="timeline-body"><p>why <code>2</code>, specifically?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:4550 on 2025-10-15 17:21</div>
            <div class="timeline-body"><p>(<code>enclosing_scope.node().as_class()?</code> looks very cheap; I don't think it's any faster to explicitly check <code>enclosing_scope.kind()</code> before doing that call)</p>
<pre><code class="language-suggestion">                let enclosing_scope = index.scope(scope.file_scope_id(db));
                let class_node = enclosing_scope.node().as_class()?;
                let class_definition = index.expect_single_definition(class_node);
                binding_type(db, class_definition)
                    .as_class_literal()?
                    .dataclass_params(db)
                    .map(|params| SmallVec::from(params.field_specifiers(db)))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:4561 on 2025-10-15 17:39</div>
            <div class="timeline-body"><p>nice solution!</p>
<p>...Though I wonder what happens if you have nested classes with different dataclass_transform functions... does such a concept even make sense? It might be an interesting test, anyway... curious what other type checkers do for this kind of thing...</p>
<pre><code class="language-py">def fancy_field(*, init: bool = True, kw_only: bool = False) -&gt; Any: ...

def other_fancy_field(*, init: bool = True, kw_only: bool = False) -&gt; Any: ...

@dataclass_transform(field_specifiers=(fancy_field,))
def fancy_model[T](cls: type[T]) -&gt; type[T]:
    # ...
    return cls

@dataclass_transform(field_specifiers=(other_fancy_field,))
def other_fancy_model[T](cls: type[T]) -&gt; type[T]:
    # ...
    return cls

@fancy_model
class Person:
    id: int = fancy_field(init=False)

    @other_fancy_model
    class Whatever:
        id: int = other_fancy_field(init=False)
        is_this_legal: str = fancy_field(init=False)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-15 17:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-16 10:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:602 on 2025-10-16 10:37</div>
            <div class="timeline-body"><p>... no, that's fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-16 10:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:697 on 2025-10-16 10:39</div>
            <div class="timeline-body"><p>Just plain wrong. I was using <code>Type::none(db)</code> as the fallback representation for missing field specifiers on this branch initially. That's my only explanation for why I possibly wrote that ;-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-16 10:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:610 on 2025-10-16 10:39</div>
            <div class="timeline-body"><p>This is pre-existing code, and I think I like the explicit form better?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:283 on 2025-10-16 10:45</div>
            <div class="timeline-body"><p>Maybe 3 would be better, so we can still handle Pydantic models inline? Otherwise, 1 also seems reasonable if we only want to be able to handle standard dataclasses inline.</p>
<ul>
<li>Standard dataclasses use 1 field specifier</li>
<li>attrs uses 2 field specifiers</li>
<li>pydantic uses 3 field specifiers</li>
<li>SQLAlchemy uses 9 field specifiers, but I certainly don't want to reserve space for 9 <code>Type</code>s in every type inference builder, just in case.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-16 10:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-16 10:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:283 on 2025-10-16 10:55</div>
            <div class="timeline-body"><p>1, 2, or 3 all seem like reasonable choices, in that case! But I'd love for this to be captured in a comment, so other people reading through the source code don't have the same question as me ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-10-16 11:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-16 11:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-10-16 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-16 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-16 12:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:4561 on 2025-10-16 12:43</div>
            <div class="timeline-body"><p>Added a test case for this. Did not yet look into how all kinds of libraries handle this, but we implement the behavior that makes the most sense to me: models only react to field-specifiers of their own dataclass transformer.</p>
<p>It works because nested classes will use their own <code>TypeInferenceBuilder</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-10-16 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-16 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-10-16 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-16 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-10-16 13:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/dataclasses/dataclass_transform.md</code>:518 on 2025-10-16 18:42</div>
            <div class="timeline-body"><p>[insert &quot;all your base are belong to us&quot; joke]</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:702 on 2025-10-16 18:44</div>
            <div class="timeline-body"><p>I am sort-of morbidly curious about what <em>does</em> happen to our inference if you try to define a dataclass, with <code>dataclasses.field</code> for one of the fields, and you're using a custom typeshed that doesn't have <code>dataclasses.field</code> in it. That might be an interesting test, but it's almost certainly not worth spending time on it right now ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-10-16 18:46</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-10-16 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-10-16 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-16 18:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:16:27 UTC
    </footer>
</body>
</html>
