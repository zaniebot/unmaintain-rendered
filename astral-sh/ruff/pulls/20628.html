<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-bandit`] Fix false negative with implicit string concatenation (`S608`) - astral-sh/ruff #20628</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-bandit</code>] Fix false negative with implicit string concatenation (<code>S608</code>)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20628">#20628</a>
        opened by <a href="https://github.com/UgoM">@UgoM</a>
        on 2025-09-29 12:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/UgoM">@UgoM</a></div>
            <div class="timeline-body">Disclaimer
<p>This is my first PR to Ruff, and I’m still learning Rust. I’ve done my best to follow the contributing guide and the repository’s patterns, though I may have missed some details. I’d be grateful for your patience and feedback to help me improve.</p>
Summary
<p>The S608 rule (flake8-bandit&#x27;s hardcoded_sql_expression) was not detecting SQL injection vulnerabilities in expressions that combine implicit string concatenation with binary operations.</p>
Bug Description
<p>The rule failed to catch SQL injection patterns like:</p>
<pre><code>query(&quot;select * &quot;
&quot;from \&quot;&quot; + schema + &quot;\&quot;&quot;)
</code></pre>
Testing
<ul>
<li>Added test case query66 that reproduces the vulnerability</li>
<li>Verified all existing tests pass</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-09-29 13:10</div>
            <div class="timeline-body"><p>Thank you! Do you know if there is a linked issue, or did you notice the bug yourself and file the PR? No worries if so, just wanted to double check - I couldn&#x27;t immediately find a related issue searching for <code>S608</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[flake8-bandit] Fix S608 false negative with implicit string concatenation (S608)&quot; to &quot;[`flake8-bandit`] Fix false negative with implicit string concatenation (`S608`)&quot; by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-09-29 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-09-29 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dylwil3">@dylwil3</a> by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-09-29 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-29 13:19</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/UgoM">@UgoM</a> on 2025-09-29 13:24</div>
            <div class="timeline-body"><blockquote>
<p>Thank you! Do you know if there is a linked issue, or did you notice the bug yourself and file the PR? No worries if so, just wanted to double check - I couldn&#x27;t immediately find a related issue searching for <code>S608</code>.</p>
</blockquote>
<p>I noticed the bug myself, found no related issue. The bug looked like a good first issue so I tackled it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-21 08:01</div>
            <div class="timeline-body"><p>@dylwil3 would you mind taking another look at this PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_bandit/S608.py</code>:188 on 2025-11-25 13:14</div>
            <div class="timeline-body"><p>Can you add a more complicated example? In particular I&#x27;d like to see some examples using <code>r</code>-prefixes and f-strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/hardcoded_sql_expression.rs</code>:147 on 2025-11-25 13:15</div>
            <div class="timeline-body"><p>Nit: can we rename this? I don&#x27;t think a &quot;binary string&quot; is really a thing. Maybe <code>evaluate_concatenated_string</code>? And in the doc comment you can point out that it evaluates both implicit and explicit string concatenation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_bandit/rules/hardcoded_sql_expression.rs</code>:162 on 2025-11-25 13:16</div>
            <div class="timeline-body"><p>Is this doing the correct thing if one of the operands is an f-string, for example? Also, should we be returning a <code>Result</code> and <code>Err</code> (or an <code>Option</code> as in <code>is_explicit_concatenation</code>) sometimes? Should we be re-using or refactoring to use some of the logic in <code>is_explicit_concatenation</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> requested changes on 2025-11-25 13:24</div>
            <div class="timeline-body"><p>Thanks for finding this and submitting a PR! I agree that there is a bug, but I&#x27;m not sure that this solution is correct. Could you increase the test coverage here and see if we&#x27;re properly handling things like f-string operands and ternary expression operands etc. here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-21 10:25</div>
            <div class="timeline-body"><p>Thanks for your contribution. I&#x27;ll close this due to inactivity. Feel free to re-submit the PR with the feedback addressed and referencing this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-21 10:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 11:02:18 UTC
    </footer>
</body>
</html>
