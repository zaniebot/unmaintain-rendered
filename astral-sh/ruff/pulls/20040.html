<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add search paths info to unresolved import diagnostics - astral-sh/ruff #20040</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add search paths info to unresolved import diagnostics</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20040">#20040</a>
        opened by <a href="https://github.com/Renkai">@Renkai</a>
        on 2025-08-22 07:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Renkai">@Renkai</a></div>
            <div class="timeline-body"><p>Fixes <a href="https://github.com/astral-sh/ty/issues/457">astral-sh/ty#457</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-22 07:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-22 08:01</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[WIP] Add search paths info to unresolved import diagnostics&quot; to &quot;[ty] [WIP] Add search paths info to unresolved import diagnostics&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-22 08:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-22 08:03</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] [WIP] Add search paths info to unresolved import diagnostics&quot; to &quot;[ty] Add search paths info to unresolved import diagnostics&quot; by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 08:28</div>
            <div class="timeline-body"><p>This solution called <code>search_paths</code> again to show the paths, not sure if carry the original results here is a better way, that way seems need changes in many places.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 08:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-22 08:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-22 11:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/carljm">@carljm</a> on 2025-08-22 18:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-22 18:42</div>
            <div class="timeline-body"><p>Thanks for working on this!</p>
<p>@AlexWaygood can you take the lead on review here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-22 18:56</div>
            <div class="timeline-body"><p>Sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-22 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/module_resolver/path.rs</code>:715 on 2025-08-23 19:02</div>
            <div class="timeline-body"><p>Ideally I feel like we&#x27;d be able to tell the user whether it was a CLI option or a config-file setting that caused us to look at an extra search path (or a custom stdlib search paths) during module resolution. But that would involve a fair bit of refactoring probably; I think it&#x27;s best to leave it out of this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:5011 on 2025-08-23 19:03</div>
            <div class="timeline-body"><p>@BurntSushi -- thoughts on having a multiline diagnostic like this? Would it be better to render each line as a separate <code>info</code> diagnostic, or is this okay?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-08-23 19:04</div>
            <div class="timeline-body"><p>Thanks, this looks great! I pushed a few minor tweaks to the PR.</p>
<p>It would be great to add a few more integration tests that have extra-paths set and/or an editable install.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-25 16:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:77 on 2025-08-25 16:51</div>
            <div class="timeline-body"><p>Why insert this extra newline? (And also below.)</p>
<p>I guess the ones below are whatever, but this one should probably be removed to keep <code>crate</code> imports together in the same block.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:5011 on 2025-08-25 16:52</div>
            <div class="timeline-body"><p>Good catch. Yes, I think each item should be its own info sub-diagnostic, like what we do for overloads:</p>
<p>https://github.com/astral-sh/ruff/blob/e7237652a9048e5fa0e6ec002855d89f9554833b/crates/ty_python_semantic/src/types/call/bind.rs#L1809-L1819</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2025-08-25 16:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Renkai">@Renkai</a> reviewed on 2025-08-26 01:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Renkai">@Renkai</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:77 on 2025-08-26 01:54</div>
            <div class="timeline-body"><p>Maybe some of my local formatter did this, I just removed it. Is it possible to include your role <code>keep crate imports together in the same block</code> in <code>cargo fmt</code> or something similar?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Renkai">@Renkai</a> reviewed on 2025-08-26 02:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Renkai">@Renkai</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:5011 on 2025-08-26 02:09</div>
            <div class="timeline-body"><p>updated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/Renkai">@Renkai</a> on 2025-08-26 02:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-08-26 11:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:77 on 2025-08-26 11:59</div>
            <div class="timeline-body"><p>Do you mean <a href="https://rust-lang.github.io/rustfmt/?version=v1.8.0&amp;search=#imports_granularity"><code>imports_granularity</code></a>? That isn&#x27;t a stable rustfmt option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:4997 on 2025-08-26 12:01</div>
            <div class="timeline-body"><p>Why collect all the search paths into memory first? It seems a little gratuitous. You could do <code>let search_paths = search_paths(..).peekable();</code> and then <code>if search_paths.peek().is_some() {</code> and <code>for (index, path) in search_paths.enumerate() {</code> below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-08-26 12:01</div>
            <div class="timeline-body"><p>LGTM with one minor nit and passing CI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Renkai">@Renkai</a> reviewed on 2025-08-26 13:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Renkai">@Renkai</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:4997 on 2025-08-26 13:51</div>
            <div class="timeline-body"><p>updated by peekable. It seems requires more review to trigger next CI test. But the test looks fine on my computer now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-26 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-26 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-26 15:01</div>
            <div class="timeline-body"><p>Thank you!!!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:17:57 UTC
    </footer>
</body>
</html>
