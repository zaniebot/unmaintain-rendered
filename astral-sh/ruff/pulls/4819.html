<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move `Binding` initialization into `SemanticModel` - astral-sh/ruff #4819</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Move <code>Binding</code> initialization into <code>SemanticModel</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4819">#4819</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-06-02 21:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Adds some convenience methods to create a new <code>Binding</code> in the current semantic context based on a kind and range.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @charliermarsh on 2023-06-02 21:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-06-02 22:06</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>✅ ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     18.7±0.69ms     2.2 MB/sec    1.01     18.8±0.70ms     2.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.5±0.16ms     3.7 MB/sec    1.00      4.5±0.20ms     3.7 MB/sec
linter/all-rules/numpy/globals.py          1.01   575.4±24.00µs     5.1 MB/sec    1.00   568.3±34.26µs     5.2 MB/sec
linter/all-rules/pydantic/types.py         1.00      8.0±0.36ms     3.2 MB/sec    1.00      8.0±0.35ms     3.2 MB/sec
linter/default-rules/large/dataset.py      1.00      9.1±0.28ms     4.5 MB/sec    1.00      9.1±0.43ms     4.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1969.8±72.05µs     8.5 MB/sec    1.03      2.0±0.11ms     8.2 MB/sec
linter/default-rules/numpy/globals.py      1.02    240.0±9.76µs    12.3 MB/sec    1.00   235.3±15.47µs    12.5 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.2±0.17ms     6.1 MB/sec    1.01      4.2±0.26ms     6.0 MB/sec
parser/large/dataset.py                    1.00      6.9±0.22ms     5.9 MB/sec    1.02      7.1±0.24ms     5.7 MB/sec
parser/numpy/ctypeslib.py                  1.00  1397.6±82.16µs    11.9 MB/sec    1.02  1427.2±78.63µs    11.7 MB/sec
parser/numpy/globals.py                    1.00    143.1±9.39µs    20.6 MB/sec    1.02    145.7±8.83µs    20.3 MB/sec
parser/pydantic/types.py                   1.00      3.1±0.12ms     8.1 MB/sec    1.02      3.2±0.15ms     8.0 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     17.1±0.24ms     2.4 MB/sec    1.02     17.4±0.33ms     2.3 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.3±0.05ms     3.9 MB/sec    1.00      4.3±0.08ms     3.9 MB/sec
linter/all-rules/numpy/globals.py          1.00   507.6±10.23µs     5.8 MB/sec    1.00    507.3±7.95µs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.3±0.11ms     3.5 MB/sec    1.01      7.3±0.12ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.00      8.4±0.10ms     4.8 MB/sec    1.02      8.5±0.09ms     4.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1775.8±19.53µs     9.4 MB/sec    1.02  1813.3±24.23µs     9.2 MB/sec
linter/default-rules/numpy/globals.py      1.00    205.2±3.87µs    14.4 MB/sec    1.01    207.7±6.45µs    14.2 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.8±0.05ms     6.7 MB/sec    1.01      3.8±0.05ms     6.7 MB/sec
parser/large/dataset.py                    1.00      6.4±0.04ms     6.3 MB/sec    1.00      6.4±0.04ms     6.4 MB/sec
parser/numpy/ctypeslib.py                  1.01  1219.6±15.07µs    13.7 MB/sec    1.00  1205.5±14.56µs    13.8 MB/sec
parser/numpy/globals.py                    1.02    125.9±2.83µs    23.4 MB/sec    1.00    123.0±2.16µs    24.0 MB/sec
parser/pydantic/types.py                   1.01      2.8±0.03ms     9.3 MB/sec    1.00      2.7±0.03ms     9.3 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:4474 on 2023-06-02 22:08</div>
            <div class="timeline-body"><p>This is cleaner but does mean we're doing the scope lookup every time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-06-02 22:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:267 on 2023-06-03 14:05</div>
            <div class="timeline-body"><p>What's the reason that <code>scoped_binding</code> does not perform the <code>bindings.push</code> operation? Are there cases where we don't want to push the binding to bindings?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-06-03 14:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-06-03 19:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:267 on 2023-06-03 19:05</div>
            <div class="timeline-body"><p>Let me revisit this in a separate PR. There's some complicated stuff that happens in <code>add_binding</code> whereby we need to determine whether a new binding is shadowing an existing binding, and so we need to create the binding in order to do that check, but can't push it into the scope yet. I'd like to move that entire thing into the semantic model.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-06-03 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-03 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-06-03 19:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:57:49 UTC
    </footer>
</body>
</html>
