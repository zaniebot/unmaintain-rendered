```yaml
number: 6117
title: "Update `F841` autofix to not remove line magic expr"
type: pull_request
state: merged
author: dhruvmanila
labels: []
assignees: []
merged: true
base: dhruv/jupyter-cell-magic
head: dhruv/F841-line-magic-expr
created_at: 2023-07-27T05:16:57Z
updated_at: 2023-07-28T01:35:55Z
url: https://github.com/astral-sh/ruff/pull/6117
synced_at: 2026-01-12T15:55:20Z
```

# Update `F841` autofix to not remove line magic expr

---

_@dhruvmanila_

## Summary

Update `F841` autofix to not remove line magic expr

## Test Plan

Added test case for assignment statement with and without type annotation

fixes: #6116


---

_Comment by @dhruvmanila on 2023-07-27 05:17_

Current dependencies on/for this PR:
* main
  * **PR #6086** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6086" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #5552** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5552" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #6141** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6141" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #6117** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6117" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ğŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6117?utm_source=stack-comment).

---

_Review requested from @konstin by @dhruvmanila on 2023-07-27 05:17_

---

_Comment by @github-actions[bot] on 2023-07-27 05:30_

## PR Check Results
### Ecosystem
â„¹ï¸ ecosystem check **detected changes**. (+0, -4, 0 error(s))

<details><summary>typeshed (+0, -4)</summary>
<p>

<pre>
- <a href='https://github.com/python/typeshed/blob/852882b8bfe9e1792448b94809351a392e83ce9e/stubs/Pillow/PIL/_imaging.pyi#L12'>stubs/Pillow/PIL/_imaging.pyi:12:7:</a> PYI046 Private protocol `_PixelAccessor` is never used
- <a href='https://github.com/python/typeshed/blob/852882b8bfe9e1792448b94809351a392e83ce9e/stubs/bleach/bleach/callbacks.pyi#L9'>stubs/bleach/bleach/callbacks.pyi:9:7:</a> PYI046 Private protocol `_Callback` is never used
- <a href='https://github.com/python/typeshed/blob/852882b8bfe9e1792448b94809351a392e83ce9e/stubs/openpyxl/openpyxl/xml/_functions_overloads.pyi#L26'>stubs/openpyxl/openpyxl/xml/_functions_overloads.pyi:26:7:</a> PYI046 Private protocol `_HasTagAndText` is never used
- <a href='https://github.com/python/typeshed/blob/852882b8bfe9e1792448b94809351a392e83ce9e/stubs/openpyxl/openpyxl/xml/_functions_overloads.pyi#L28'>stubs/openpyxl/openpyxl/xml/_functions_overloads.pyi:28:7:</a> PYI046 Private protocol `_HasTagAndTextAndAttrib` is never used
</pre>

</p>
</details>
Rules changed: 1

| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PYI046 | 4 | 0 | 4 |

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      8.5Â±0.08ms     4.8 MB/sec    1.00      8.6Â±0.15ms     4.8 MB/sec
formatter/numpy/ctypeslib.py               1.00  1686.6Â±17.93Âµs     9.9 MB/sec    1.01  1705.8Â±36.93Âµs     9.8 MB/sec
formatter/numpy/globals.py                 1.00    192.5Â±6.98Âµs    15.3 MB/sec    1.01    193.8Â±5.98Âµs    15.2 MB/sec
formatter/pydantic/types.py                1.00      3.6Â±0.09ms     7.0 MB/sec    1.01      3.7Â±0.09ms     6.9 MB/sec
linter/all-rules/large/dataset.py          1.00     11.8Â±0.03ms     3.4 MB/sec    1.00     11.8Â±0.03ms     3.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.0Â±0.02ms     5.5 MB/sec    1.00      3.0Â±0.03ms     5.5 MB/sec
linter/all-rules/numpy/globals.py          1.00    397.0Â±0.88Âµs     7.4 MB/sec    1.00    397.8Â±1.12Âµs     7.4 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.4Â±0.11ms     4.7 MB/sec    1.00      5.4Â±0.08ms     4.7 MB/sec
linter/default-rules/large/dataset.py      1.00      5.8Â±0.04ms     7.0 MB/sec    1.01      5.9Â±0.05ms     6.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1227.6Â±11.42Âµs    13.6 MB/sec    1.01  1236.4Â±18.49Âµs    13.5 MB/sec
linter/default-rules/numpy/globals.py      1.03    138.2Â±6.48Âµs    21.3 MB/sec    1.00    134.6Â±0.58Âµs    21.9 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.6Â±0.06ms     9.8 MB/sec    1.01      2.6Â±0.05ms     9.7 MB/sec
```

#### Windows
```
group                                      main                                    pr
-----                                      ----                                    --
formatter/large/dataset.py                 1.00     10.5Â±0.53ms     3.9 MB/sec     1.27     13.4Â±1.03ms     3.0 MB/sec
formatter/numpy/ctypeslib.py               1.00  1984.1Â±101.60Âµs     8.4 MB/sec    1.34      2.7Â±0.14ms     6.3 MB/sec
formatter/numpy/globals.py                 1.00   230.4Â±17.09Âµs    12.8 MB/sec     1.08   248.4Â±24.82Âµs    11.9 MB/sec
formatter/pydantic/types.py                1.00      4.3Â±0.21ms     5.9 MB/sec     1.25      5.4Â±0.58ms     4.7 MB/sec
linter/all-rules/large/dataset.py          1.09     18.7Â±0.80ms     2.2 MB/sec     1.00     17.1Â±0.38ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.10      5.0Â±0.22ms     3.3 MB/sec     1.00      4.5Â±0.17ms     3.7 MB/sec
linter/all-rules/numpy/globals.py          1.11   617.6Â±52.83Âµs     4.8 MB/sec     1.00   558.1Â±25.21Âµs     5.3 MB/sec
linter/all-rules/pydantic/types.py         1.09      8.4Â±0.36ms     3.0 MB/sec     1.00      7.7Â±0.22ms     3.3 MB/sec
linter/default-rules/large/dataset.py      1.12     10.6Â±0.83ms     3.8 MB/sec     1.00      9.4Â±0.42ms     4.3 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1780.7Â±195.19Âµs     9.4 MB/sec    1.13      2.0Â±0.12ms     8.3 MB/sec
linter/default-rules/numpy/globals.py      1.00   190.2Â±11.09Âµs    15.5 MB/sec     1.19   225.4Â±13.42Âµs    13.1 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.5Â±0.16ms     7.3 MB/sec     1.23      4.3Â±0.19ms     5.9 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_@MichaReiser approved on 2023-07-27 06:03_

---

_Review comment by @konstin on `crates/ruff/src/jupyter/notebook.rs`:566 on 2023-07-27 06:48_

When these tests get more we can at some point move them into `#[test_case]`

---

_@konstin approved on 2023-07-27 06:49_

---

_@charliermarsh approved on 2023-07-27 18:19_

---

_Merged by @charliermarsh on 2023-07-27 18:54_

---

_Closed by @charliermarsh on 2023-07-27 18:54_

---

_Branch deleted on 2023-07-27 18:55_

---
