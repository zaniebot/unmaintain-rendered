<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[flake8-comprehensions] Account for list and set comprehensions in `unnecessary-literal-within-tuple-call` (`C409`) - astral-sh/ruff #12657</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[flake8-comprehensions] Account for list and set comprehensions in <code>unnecessary-literal-within-tuple-call</code> (<code>C409</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12657">#12657</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2024-08-04 00:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body">Summary
<p>Make it a violation of <code>C409</code> to call <code>tuple</code> with a list or set comprehension, and
implement the (unsafe) fix of calling the <code>tuple</code> with the underlying generator instead.</p>
<p>Closes #12648.</p>
Test Plan
<p>Test fixture updated, cargo test, docs checked for updated description.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-08-04 00:37</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/dylwil3:tuple-comprehensions">CodSpeed Performance Report</a>
Merging #12657 will <strong>not alter performance</strong>
<p>Comparing <code>dylwil3:tuple-comprehensions</code> (6862cd3) with <code>main</code> (d6c6db5)</p>
Summary
<p><code>✅ 32</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-04 00:44</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+7 -0 violations, +0 -0 fixes in 4 projects; 50 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/1546d7fafd549eab8b01b8f08104d2a1a9b956d3/airflow/providers/google/cloud/transfers/sql_to_gcs.py#L259">airflow/providers/google/cloud/transfers/sql_to_gcs.py:259:41:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
+ <a href="https://github.com/apache/airflow/blob/1546d7fafd549eab8b01b8f08104d2a1a9b956d3/dev/breeze/src/airflow_breeze/utils/packages.py#L374">dev/breeze/src/airflow_breeze/utils/packages.py:374:12:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
+ <a href="https://github.com/apache/airflow/blob/1546d7fafd549eab8b01b8f08104d2a1a9b956d3/tests/_internals/capture_warnings.py#L187">tests/_internals/capture_warnings.py:187:55:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
+ <a href="https://github.com/apache/airflow/blob/1546d7fafd549eab8b01b8f08104d2a1a9b956d3/tests/always/test_example_dags.py#L132">tests/always/test_example_dags.py:132:25:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
</pre>

</p>

<a href="https://github.com/latchbio/latch">latchbio/latch</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/latchbio/latch/blob/5d90fd2e26155fa0c9089dd92b3b034f83f42c83/latch/functions/operators.py#L106">latch/functions/operators.py:106:27:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
</pre>

</p>

<a href="https://github.com/mlflow/mlflow">mlflow/mlflow</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/mlflow/mlflow/blob/a98e1a9d2edcff82cca19bfa0ddd4dd133096e68/tests/utils/test_uri.py#L194">tests/utils/test_uri.py:194:20:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
</pre>

</p>

<a href="https://github.com/python/mypy">python/mypy</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/python/mypy/blob/50d0d047eb3dedf3b801c3731a37d56c320bad3e/mypy/checkpattern.py#L390">mypy/checkpattern.py:390:17:</a> C409 Unnecessary list comprehension passed to `tuple()` (rewrite as a generator)
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| C409 | 7 | 7 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Skylion007">@Skylion007</a> on <code>crates/ruff_linter/src/rules/flake8_comprehensions/snapshots/ruff_linter__rules__flake8_comprehensions__tests__C409_C409.py.snap</code>:275 on 2024-08-04 14:28</div>
            <div class="timeline-body"><p>This is not a safe transform, a set could be used here for deduplicating elements in the iterable before the tuple is created. I&#x27;m pretty sure this is only safe / sensible to flag for list comprehensions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Skylion007">@Skylion007</a> reviewed on 2024-08-04 14:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2024-08-04 14:32</div>
            <div class="timeline-body"><p>I&#x27;d argue this is only safe to flag for list comprehensions as set comprehensions will dedup and potentially reorder elements as well (not that you should rely on that nondeterm ordering but still).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-08-04 17:47</div>
            <div class="timeline-body"><p>Good point! Another thing I noticed is that the suggestion text doesn&#x27;t make sense in the context of comprehensions. I&#x27;ll fix both next time I&#x27;m in front of a computer.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-08-05 01:37</div>
            <div class="timeline-body"><p>Ok, should be good to go!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-05 02:08</div>
            <div class="timeline-body"><p>Thanks! (FYI I had to move this behavior to preview to adhere to our versioning policy since it&#x27;s an expansion in scope.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 02:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 02:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-05 11:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-08-15 23:02</div>
            <div class="timeline-body"><p>I find this kind of thing unfortunate, because <code>tuple(i for i in range(10000))</code> is like 50% slower than <code>tuple([i for i in range(10000)])</code>.</p>
<p>There&#x27;s no way to configure ruff to disambiguate between the two.
Edit: I should probably open a new issue <a href="https://github.com/astral-sh/ruff/issues/12912">astral-sh/ruff#12912</a> :-)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:05:40 UTC
    </footer>
</body>
</html>
