<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a newtype wrapper around `Vec&lt;FStringElement&gt;` - astral-sh/ruff #11400</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Create a newtype wrapper around <code>Vec&lt;FStringElement&gt;</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11400">#11400</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-05-13 09:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-13 09:05</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds a newtype wrapper around <code>Vec&lt;FStringElement&gt;</code> that derefs to a <code>&amp;Vec&lt;FStringElement&gt;</code>.</p>
<p>Both f-string and format specifier are made up of <code>Vec&lt;FStringElement&gt;</code>. By creating a newtype wrapper around it, we can share the methods for both parent types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @dhruvmanila on 2024-05-13 09:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2024-05-13 09:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-05-13 10:36</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_ast/src/visitor.rs</code>:742 on 2024-05-13 13:35</div>
            <div class="timeline-body"><p>Did you consider adding an <code>IntoIterator</code> implementation for <code>&amp;'a FStringElements</code>? I think you could avoid changes like this if you did.</p>
<pre><code class="language-rs">impl&lt;'a&gt; IntoIterator for &amp;'a FStringElements {
    type IntoIter = Iter&lt;'a, FStringElement&gt;;
    type Item = &amp;'a FStringElement;
    fn into_iter(self) -&gt; Self::IntoIter {
        self.iter()
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1505 on 2024-05-13 13:38</div>
            <div class="timeline-body"><p>I would be tempted to keep these methods as simple wrappers, e.g.</p>
<pre><code class="language-rs">impl FString {
    pub fn literals(&amp;self) -&gt; impl Iterator&lt;Item = &amp;FStringLiteralElement&gt; {
        self.elements.literals()
    }

    pub fn expressions(&amp;self) -&gt; impl Iterator&lt;Item = &amp;FStringExpressionElement&gt; {
        self.elements.expressions()
    }
}
</code></pre>
<p>As I think <code>for literal in f_string.literals()</code> feels like a slightly more natural API for downstream users than <code>for literal in f_string.elements.literals()</code>. But this is just a nit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-05-13 13:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-05-13 14:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1505 on 2024-05-13 14:11</div>
            <div class="timeline-body"><p>Yeah, I thought about that but then I'm not sure if there's any more benefit to implement the newtype. Also, the reason I think <code>f_string.elements.literals()</code> API is better is because <code>elements</code> is a public field, so the user can either get all of the element or apply a filter on top of it (<code>elements.literals()</code>). And, this wrapper would need to be implemented for <code>FStringFormatSpec</code> as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 14:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1505 on 2024-05-13 14:14</div>
            <div class="timeline-body"><p>Maybe part of the issue is the name of the method... what if <code>FStringElements.literals()</code> was renamed to <code>iter_literal_elements()</code>? And <code>expressions</code> renamed to <code>iter_expression_elements</code>? That might make it slightly clearer -- I think <code>for literal in f_string.elements.iter_literal_elements()</code> would read more naturally to me, although it's obviously slightly more verbose</p>
<p>But, as I say, this is just a nit :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-05-13 15:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/visitor.rs</code>:742 on 2024-05-13 15:50</div>
            <div class="timeline-body"><p>No I didn't consider that although it makes sense to implement it. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1505 on 2024-05-13 15:58</div>
            <div class="timeline-body"><p>That suggestion is valid although I'm fine with this and this naming pattern has been used in a lot of similar places ;)</p>
<p>Thanks for the suggestion!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-05-13 15:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-05-13 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-05-13 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-13 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 16:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_ast/src/visitor.rs</code>:742 on 2024-05-13 16:05</div>
            <div class="timeline-body"><p>Are you going to do this in a followup?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-05-13 16:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/visitor.rs</code>:742 on 2024-05-13 16:06</div>
            <div class="timeline-body"><p>I've implemented it in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-05-13 16:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/visitor.rs</code>:742 on 2024-05-13 16:07</div>
            <div class="timeline-body"><p>Oh my, how did I lost that change lol. I'll implement it in a follow-up then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-05-27 07:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1530 on 2024-05-27 07:31</div>
            <div class="timeline-body"><p>Nit: Should this be dereferencing to <code>[FStringElement]</code> or are there cases where we need a Vec?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-05-27 15:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1530 on 2024-05-27 15:47</div>
            <div class="timeline-body"><p>I don't think so. I think I wanted it to be <code>[FStringElement]</code>. I'll change it.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:56:31 UTC
    </footer>
</body>
</html>
