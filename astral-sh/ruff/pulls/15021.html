<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `actionlint` as a pre-commit hook (with shellcheck integration) - astral-sh/ruff #15021</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>actionlint</code> as a pre-commit hook (with shellcheck integration)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15021">#15021</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-12-16 14:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>This PR adds <a href="https://github.com/rhysd/actionlint">actionlint</a> as a pre-commit hook. actionlint is a tool that analyzes your GitHub Actions and verifies that you have correct syntax in your workflows.</p>
<p>One of actionlint&#x27;s most useful features is a <a href="https://github.com/koalaman/shellcheck">shellcheck</a> integration. Shellcheck is a tool that checks for errors in shell scripts; actionlint&#x27;s shellcheck integration extracts bash scripts from <code>run:</code> steps in GitHub Actions workflows and passes them to shellcheck. All the changes to workflow files in this PR are due to issues shellcheck identified via actionlint&#x27;s shellcheck integration.</p>
<p>The motivation behind this PR is that it would have caught the mistakes fixed in <a href="https://github.com/astral-sh/ruff/pull/14938">astral-sh/ruff#14938</a> before they happened. I&#x27;d like to upgrade our zizmor pre-commit hook to the latest version (<a href="https://github.com/astral-sh/ruff/pull/15022">astral-sh/ruff#15022</a>), but doing so requires further changes to our GitHub workflows; I&#x27;m unwilling to do that until we have better linters for our GitHub workflows in CI.</p>
Test Plan
<ul>
<li><code>uvx pre-commit run -a</code> passes locally, and I verified that it is correctly running the shellcheck integration due to the <code>additional_dependencies</code> in the pre-commit entry</li>
<li>Let&#x27;s see if CI passes on this PR...</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-16 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-16 14:43</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-16 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-16 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.github/workflows/build-docker.yml</code>:294 on 2024-12-16 17:07</div>
            <div class="timeline-body"><p>This <em>might</em> actually be ok to quote but it&#x27;s ok for now to disable this as we might need to test this a bit to verify.</p>
<p>But, the other one is probably correct to ignore because it contains glob <code>*</code> character.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.github/workflows/daily_fuzz.yaml</code>:49 on 2024-12-16 17:10</div>
            <div class="timeline-body"><p>It might be ok to quote this:</p>
<pre><code>&quot;$(shuf ...)&quot;
</code></pre>
<p>Although I don&#x27;t really have a linux machine to test. I&#x27;d be fine to ignore this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-16 17:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/daily_fuzz.yaml</code>:49 on 2024-12-16 17:12</div>
            <div class="timeline-body"><p>I checked it on my Mac, and the command copied-and-pasted into my shell works as it currently is on <code>main</code>, but adding the quoting breaks it. It&#x27;s possible it might be different on Linux, but it&#x27;s also just quite nice to use commands in our GitHub workflows that I can test locally</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.github/workflows/publish-docs.yml</code>:115 on 2024-12-16 17:15</div>
            <div class="timeline-body"><p>Maybe we should just use quotes on the outer value?</p>
<pre><code>          pull_request_title=&quot;Update ruff documentation for ${display_name}&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.github/workflows/publish-docs.yml</code>:131 on 2024-12-16 17:15</div>
            <div class="timeline-body"><p>Same as above</p>
<pre><code>            --body=&quot;Automated documentation update for ${display_name}&quot; \
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.pre-commit-config.yaml</code>:115 on 2024-12-16 17:16</div>
            <div class="timeline-body"><p>Can you provide the case where it&#x27;s giving false positive?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-12-16 17:17</div>
            <div class="timeline-body"><p>Looks good, I&#x27;ve some minor comments but otherwise should be good to go. Thanks for taking this on!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-16 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/publish-docs.yml</code>:115 on 2024-12-16 17:19</div>
            <div class="timeline-body"><p>Thanks! Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-16 17:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.pre-commit-config.yaml</code>:115 on 2024-12-16 17:21</div>
            <div class="timeline-body"><p>This is the report:</p>
<pre><code>Lint GitHub Actions workflow files.......................................Failed
- hook id: actionlint
- exit code: 1

.github/workflows/publish-docs.yml:113:9: shellcheck reported issue in this script: SC2016:info:7:43: Expressions don&#x27;t expand in single quotes, use double quotes for that [shellcheck]
    |
113 |         run: |
    |         ^~~~
.github/workflows/pr-comment.yaml:52:9: shellcheck reported issue in this script: SC2016:info:13:6: Expressions don&#x27;t expand in single quotes, use double quotes for that [shellcheck]
   |
52 |         run: |
   |         ^~~~
</code></pre>
<p>they <em>might</em> be fixable? Not sure. I don&#x27;t think there&#x27;s an actual bug on those lines anyway.</p>
<p>We could just put inline ignore comments on those lines? But that specific check didn&#x27;t seem to actually flag any real issues in our shell scripts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.pre-commit-config.yaml</code>:115 on 2024-12-16 17:31</div>
            <div class="timeline-body"><p>Oh right, I think the one in <code>publish-docs</code> is a false positive because the <code>pull_request_title</code> needs to be quoted as the title contains multiple words separated by whitespace:</p>
<pre><code>$ gh pr list --state open --json title --jq &quot;.[] | select(.title == ${pull_request_title}) | .number&quot;
failed to parse jq expression (line 1, column 35)
    .[] | select(.title == [red-knot] Statically known branches) | .number
                                      ^  unexpected token &quot;Statically&quot;
</code></pre>
<p>Let&#x27;s ignore this for now as we know it&#x27;s already working.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-16 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-16 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-16 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-12-16 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>.github/workflows/daily_fuzz.yaml</code>:49 on 2024-12-16 17:32</div>
            <div class="timeline-body"><p>I see, let&#x27;s keep it disabled then. Thanks for testing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-16 17:33</div>
            <div class="timeline-body"><p>Thanks for the review!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:09:33 UTC
    </footer>
</body>
</html>
