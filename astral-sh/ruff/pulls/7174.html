<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix D204 when there's a semicolon after a docstring - astral-sh/ruff #7174</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix D204 when there's a semicolon after a docstring</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7174">#7174</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-09-05 21:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Another statement on the same line as the docstring would previous make the D204 (newline after docstring) fix fail:</p>
<pre><code class="language-python">class StatementOnSameLineAsDocstring:
    &quot;After this docstring there's another statement on the same line separated by a semicolon.&quot; ;priorities=1
    def sort_services(self):
        pass
</code></pre>
<p>The fix handles this case manually:</p>
<pre><code class="language-python">class StatementOnSameLineAsDocstring:
    &quot;After this docstring there's another statement on the same line separated by a semicolon.&quot;

    priorities=1
    def sort_services(self):
        pass
</code></pre>
<p>Fixes #7088</p>
<h2>Test Plan</h2>
<p>Added a new <code>D</code> test case</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-05 21:31</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #7173</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7173" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #7174</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7174" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  üëà</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7174?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-05 21:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:239 on 2023-09-05 21:32</div>
            <div class="timeline-body"><p>@MichaReiser since this is not indentation but whitespace between statement and a following <code>;</code> i don't need to use the python whitespace functions, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2023-09-05 21:42</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/09-05-Fix_D204_when_there_s_a_semicolon_after_a_docstring">CodSpeed Performance Report</a></h2>
<h3>Merging #7174 will <strong>degrade performances by 4.52%</strong></h3>
<p><sub>Comparing <code>09-05-Fix_D204_when_there_s_a_semicolon_after_a_docstring</code> (9d114a8) with <code>09-05-Ignore_single_quote_docstrings_with_newline_escape</code> (2d20e37)</sub></p>
<h3>Summary</h3>
<p><code>‚ùå 1</code> regressions
<code>‚úÖ 24</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/09-05-Fix_D204_when_there_s_a_semicolon_after_a_docstring">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>09-05-Ignore_single_quote_docstrings_with_newline_escape</code> | <code>09-05-Fix_D204_when_there_s_a_semicolon_after_a_docstring</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ùå | <code>linter/all-rules[unicode/pypinyin.py]</code> | 15.4 ms | 16.2 ms | -4.52% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-05 22:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:241 on 2023-09-05 22:28</div>
            <div class="timeline-body"><p>What if it‚Äôs followed by a comment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:239 on 2023-09-05 22:29</div>
            <div class="timeline-body"><p>It‚Äôs best to use the Python whitespace functions unless you‚Äôre parsing text within a string or within a comment (is my understanding).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-05 22:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:240 on 2023-09-05 22:30</div>
            <div class="timeline-body"><p>We have some has_following_content utilities - can we use any of them here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-05 22:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:239 on 2023-09-06 06:21</div>
            <div class="timeline-body"><p>From the python spec</p>
<blockquote>
<p>Except at the beginning of a logical line or in string literals, the whitespace characters space, tab and formfeed can be used interchangeably to separate tokens. Whitespace is needed between two tokens only if their concatenation could otherwise be interpreted as a different token (e.g., ab is one token, but a b is two tokens).</p>
</blockquote>
<p><a href="https://docs.python.org/3/reference/lexical_analysis.html#whitespace-between-tokens">source</a></p>
<p>To me this means that any other whitespace should not be considered whitespace and are a syntax error (because whitespace isn't a valid identifier start).</p>
<p>I use the python whitespace methods consistently to:</p>
<ul>
<li>Avoid having to reason about whether it is guaranteed that the input program is correct and thus, it is safe to accept all whitesapce</li>
<li><code>is_python_whitespace</code> (or the trim variants) could in theory be faster because they can operate on bytes (no unicode)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:267 on 2023-09-06 06:25</div>
            <div class="timeline-body"><p>Could we move this up to line 223 where we intentionally skip the first line?</p>
<p>We could then improve the perforamnce by cloning the univeral newlines iterator rather than creating a new one from scratch on line 230. That avoids that we scan the first line 2 (actually 3 times, 2 to find the end of the first line, once to trim it.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-09-06 06:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-06 09:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:241 on 2023-09-06 09:55</div>
            <div class="timeline-body"><p>Good catch, added a comment test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-06 09:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:240 on 2023-09-06 09:57</div>
            <div class="timeline-body"><p>i tried but i don't think they fit here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-06 10:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pydocstyle/rules/blank_before_after_class.rs</code>:267 on 2023-09-06 10:24</div>
            <div class="timeline-body"><p>Turns out we do actually have to parse the first line twice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-09-06 10:38</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>‚úÖ ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-09-11 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-09-11 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-11 13:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:03 UTC
    </footer>
</body>
</html>
