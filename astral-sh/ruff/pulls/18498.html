<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] File inclusion and exclusion - astral-sh/ruff #18498</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] File inclusion and exclusion</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18498">#18498</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-06-06 14:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>This PR adds two new configuration options:</p>
<ul>
<li><code>src.include</code>: gitignore-like glob patterns but inverted: <code>src</code> includes the directory <code>src</code> instead of excluding it. This is similar to npm&#x27;s <a href="https://docs.npmjs.com/cli/v11/configuring-npm/package-json#files"><code>files</code></a> option in the <code>package.json</code>.</li>
<li><code>src.exclude</code>: gitignore-like glob patterns that exclude files from analysis. Exclude takes precedence over include.</li>
</ul>
<p>This PR also adds <code>--exclude</code> to the CLI. It allows adding more exclude patterns. I decided against adding an <code>--include</code> option because it is redundant to <code>ty check &lt;paths&gt;</code> which already allows to include additional files. The only difference between <code>ty check &lt;paths&gt;</code> is that paths specified like that take precedence over <code>exclude</code>. We could consider adding an <code>--include</code> option as an alternative to Ruff&#x27;s <code>--force-exclude</code>.</p>
<p>Sorry, this PR got a bit large but I required everything in place to verify that the ergonomics are what we want.</p>
<p>Closes <a href="https://github.com/astral-sh/ty/issues/176">astral-sh/ty#176</a></p>
Test Plan
<p>Added CLI and unit tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-06 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-06 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-06 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-06 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/glob/include.rs</code>:1 on 2025-06-06 14:21</div>
            <div class="timeline-body"><p>Most of the credit for this goes to @konstin because I shamelessly copied most from the uv implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-06 14:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-06 14:23</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-06 14:26</div>
            <div class="timeline-body"><p>Ugh, Windows isn&#x27;t happy with at least one of my hacks :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-06 16:44</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-09 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-09 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-09 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-09 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-09 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-09 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/carljm">@carljm</a> on 2025-06-10 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty/docs/configuration.md</code>:165 on 2025-06-12 12:18</div>
            <div class="timeline-body"><p>I think I would be tempted to word this as, &quot;<code>**</code> matches zero or more path components.&quot; So like, <code>**a</code> is kind of a weird glob. I think <code>globset</code> does currently accept that and does implement the semantics you describe here though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty/docs/configuration.md</code>:168 on 2025-06-12 12:18</div>
            <div class="timeline-body"><p>What about <code>{a,b,...}</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty/tests/cli/file_selection.rs</code>:621 on 2025-06-12 12:20</div>
            <div class="timeline-body"><p>Ah I see you&#x27;re way ahead of me about <code>**a</code> haha.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty/docs/configuration.md</code>:168 on 2025-06-12 12:28</div>
            <div class="timeline-body"><p>Oh nevermind, you&#x27;re using your own portable glob syntax that doesn&#x27;t have this. Makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-06-12 12:29</div>
            <div class="timeline-body"><p>Nice! Reviewing this ended up being pretty easy because we&#x27;ve already talked so much about the semantics. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-12 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-12 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-12 17:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:15 UTC
    </footer>
</body>
</html>
