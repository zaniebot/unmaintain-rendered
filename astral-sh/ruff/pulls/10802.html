<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`refurb`] Implement `write-whole-file` (`FURB103`) - astral-sh/ruff #10802</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>refurb</code>] Implement <code>write-whole-file</code> (<code>FURB103</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10802">#10802</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2024-04-06 16:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-04-06 16:10</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Implement <code>write-whole-file</code> (<code>FURB103</code>), part of #1348. This is largely a copy and paste of <code>read-whole-file</code> #7682.</p>
<h2>Test Plan</h2>
<p>Text fixture added.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a> reviewed on 2024-04-06 16:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/augustelalande">@augustelalande</a> on <code>crates/ruff_linter/src/rules/refurb/snapshots/ruff_linter__rules__refurb__tests__FURB103_FURB103.py.snap</code>:88 on 2024-04-06 16:22</div>
            <div class="timeline-body"><p>I understand that <code>foobar</code> is being placed after <code>newline=&quot;\r\n&quot;</code> because the generator uses source order, and <code>foobar</code> comes later, but I'm not sure how to remedy it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-06 16:37</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+137 -0 violations, +0 -0 fixes in 5 projects; 39 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+35 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/cli/commands/kubernetes_command.py#L70'>airflow/cli/commands/kubernetes_command.py:70:14:</a> FURB103 `open` and `write` should be replaced by `Path(...).write_text(yaml.dump(sanitized_pod))`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/cli/commands/pool_command.py#L147'>airflow/cli/commands/pool_command.py:147:10:</a> FURB103 `open` and `write` should be replaced by `Path(filepath)....`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/example_dags/example_kubernetes_executor.py#L91'>airflow/example_dags/example_kubernetes_executor.py:91:18:</a> FURB103 `open` and `write` should be replaced by `Path("/foo/volume_mount_test.txt").write_text("Hello")`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/providers/databricks/operators/databricks_sql.py#L152'>airflow/providers/databricks/operators/databricks_sql.py:152:18:</a> FURB103 `open` and `write` should be replaced by `Path(self._output_path)....`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/providers/fab/auth_manager/security_manager/override.py#L776'>airflow/providers/fab/auth_manager/security_manager/override.py:776:18:</a> FURB103 `open` and `write` should be replaced by `Path(password_path).write_text(password)`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/providers/google/cloud/hooks/cloud_sql.py#L529'>airflow/providers/google/cloud/hooks/cloud_sql.py:529:14:</a> FURB103 `open` and `write` should be replaced by `Path(proxy_path_tmp).write_bytes(response.content)`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/providers/imap/hooks/imap.py#L291'>airflow/providers/imap/hooks/imap.py:291:14:</a> FURB103 `open` and `write` should be replaced by `Path(file_path).write_bytes(payload)`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/airflow/providers/microsoft/azure/hooks/wasb.py#L391'>airflow/providers/microsoft/azure/hooks/wasb.py:391:14:</a> FURB103 `open` and `write` should be replaced by `Path(file_path).write_bytes(stream.readall())`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/dev/breeze/src/airflow_breeze/utils/docs_publisher.py#L104'>dev/breeze/src/airflow_breeze/utils/docs_publisher.py:104:18:</a> FURB103 `open` and `write` should be replaced by `Path(os.path.join(output_dir, "..", "stable.txt")).write_text(self._current_version)`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/docs/exts/docs_build/dev_index_generator.py#L68'>docs/exts/docs_build/dev_index_generator.py:68:10:</a> FURB103 `open` and `write` should be replaced by `Path(out_file).write_text(content)`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/docs/exts/redirects.py#L80'>docs/exts/redirects.py:80:18:</a> FURB103 `open` and `write` should be replaced by `Path(redirected_filename).write_text(TEMPLATE.format(to_path))`
+ <a href='https://github.com/apache/airflow/blob/4f169bd2f3e27b8530da4b82d0d3b25b796eff39/docs/exts/sphinx_script_update.py#L87'>docs/exts/sphinx_script_update.py:87:10:</a> FURB103 `open` and `write` should be replaced by `Path(cache_filepath).write_bytes(res.content)`
... 23 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+41 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/basic_plot.py#L42'>examples/models/basic_plot.py:42:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/buttons.py#L75'>examples/models/buttons.py:75:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(file_html(title="Button widgets", doc))`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/calendars.py#L104'>examples/models/calendars.py:104:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(file_html(title="Calendar 2014", doc))`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/colors.py#L69'>examples/models/colors.py:69:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/custom.py#L117'>examples/models/custom.py:117:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/customjs.py#L38'>examples/models/customjs.py:38:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/dateaxis.py#L36'>examples/models/dateaxis.py:36:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/daylight.py#L107'>examples/models/daylight.py:107:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(file_html(title="Daylight Plot", doc))`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/gauges.py#L110'>examples/models/gauges.py:110:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(file_html(title="Gauges", doc))`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/glyphs.py#L115'>examples/models/glyphs.py:115:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(file_html(title="Glyphs", doc))`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/maps.py#L59'>examples/models/maps.py:59:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/maps_cities.py#L46'>examples/models/maps_cities.py:46:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/sliders.py#L74'>examples/models/sliders.py:74:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(file_html(title="sliders", doc))`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/models/tile_source.py#L38'>examples/models/tile_source.py:38:10:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
... 27 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/rotki/rotki">rotki/rotki</a> (+19 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/package.py#L734'>package.py:734:14:</a> FURB103 `open` and `write` should be replaced by `Path(p12).write_bytes(certificate_data)`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/chain/ethereum/airdrops.py#L248'>rotkehlchen/chain/ethereum/airdrops.py:248:18:</a> FURB103 `open` and `write` should be replaced by `Path(filename).write_text(response.text, encoding='utf8')`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/chain/ethereum/airdrops.py#L284'>rotkehlchen/chain/ethereum/airdrops.py:284:14:</a> FURB103 `open` and `write` should be replaced by `Path(filename)....`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/chain/ethereum/utils.py#L224'>rotkehlchen/chain/ethereum/utils.py:224:10:</a> FURB103 `open` and `write` should be replaced by `Path(avatars_dir / f'{ens_name}.png').write_bytes(avatar)`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/db/dbhandler.py#L300'>rotkehlchen/db/dbhandler.py:300:14:</a> FURB103 `open` and `write` should be replaced by `Path(self.user_data_dir / DBINFO_FILENAME).write_text(rlk_jsondumps(dbinfo), encoding='utf8')`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/db/dbhandler.py#L593'>rotkehlchen/db/dbhandler.py:593:18:</a> FURB103 `open` and `write` should be replaced by `Path(tempdbpath).write_bytes(unencrypted_db_data)`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/icons.py#L190'>rotkehlchen/icons.py:190:14:</a> FURB103 `open` and `write` should be replaced by `Path(self.iconfile_path(asset)).write_bytes(response.content)`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/tests/api/test_caching.py#L42'>rotkehlchen/tests/api/test_caching.py:42:10:</a> FURB103 `open` and `write` should be replaced by `Path(f'{icons_dir}/ETH_small.png').write_bytes(b'')`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/tests/api/test_caching.py#L45'>rotkehlchen/tests/api/test_caching.py:45:10:</a> FURB103 `open` and `write` should be replaced by `Path(f'{icons_dir}/BTC_small.png').write_bytes(b'')`
+ <a href='https://github.com/rotki/rotki/blob/c48315b753d59c5d8e418e89edb49e1b816d0cfb/rotkehlchen/tests/api/test_caching.py#L48'>rotkehlchen/tests/api/test_caching.py:48:10:</a> FURB103 `open` and `write` should be replaced by `Path(f'{icons_dir}/AVAX_small.png').write_bytes(b'')`
... 9 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+35 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/analytics/management/commands/check_analytics_state.py#L37'>analytics/management/commands/check_analytics_state.py:37:14:</a> FURB103 `open` and `write` should be replaced by `Path(state_file_tmp)....`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/corporate/tests/test_stripe.py#L169'>corporate/tests/test_stripe.py:169:18:</a> FURB103 `open` and `write` should be replaced by `Path(fixture_path)....`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/corporate/tests/test_stripe.py#L298'>corporate/tests/test_stripe.py:298:14:</a> FURB103 `open` and `write` should be replaced by `Path(fixture_file).write_text(file_content)`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/scripts/lib/setup_venv.py#L272'>scripts/lib/setup_venv.py:272:10:</a> FURB103 `open` and `write` should be replaced by `Path(script_path).write_text("".join(lines))`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/scripts/lib/zulip_tools.py#L535'>scripts/lib/zulip_tools.py:535:10:</a> FURB103 `open` and `write` should be replaced by `Path(hash_path).write_text(new_hash)`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/tools/lib/pretty_print.py#L160'>tools/lib/pretty_print.py:160:18:</a> FURB103 `open` and `write` should be replaced by `Path(fn).write_text(phtml)`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/tools/lib/provision.py#L388'>tools/lib/provision.py:388:14:</a> FURB103 `open` and `write` should be replaced by `Path(apt_hash_file_path).write_text(new_apt_dependencies_hash)`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/tools/lib/provision_inner.py#L366'>tools/lib/provision_inner.py:366:10:</a> FURB103 `open` and `write` should be replaced by `Path(version_file)....`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/tools/setup/generate_integration_bots_avatars.py#L54'>tools/setup/generate_integration_bots_avatars.py:54:10:</a> FURB103 `open` and `write` should be replaced by `Path(bot_avatar_path).write_bytes(avatar)`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/zerver/data_import/gitter.py#L396'>zerver/data_import/gitter.py:396:10:</a> FURB103 `open` and `write` should be replaced by `Path(output_file)....`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/zerver/data_import/import_util.py#L749'>zerver/data_import/import_util.py:749:10:</a> FURB103 `open` and `write` should be replaced by `Path(output_file)....`
+ <a href='https://github.com/zulip/zulip/blob/36aa0177bd0312c32503ca3e368f25664e724ef7/zerver/data_import/rocketchat.py#L301'>zerver/data_import/rocketchat.py:301:14:</a> FURB103 `open` and `write` should be replaced by `Path(target_path).write_bytes(emoji_data)`
... 23 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/indico/indico">indico/indico</a> (+7 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/bin/maintenance/generate_moment_locales.py#L100'>bin/maintenance/generate_moment_locales.py:100:10:</a> FURB103 `open` and `write` should be replaced by `Path(output).write_text(header + locales)`
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/indico/cli/i18n.py#L296'>indico/cli/i18n.py:296:18:</a> FURB103 `open` and `write` should be replaced by `Path(json_file).write_text(output)`
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/indico/cli/i18n.py#L321'>indico/cli/i18n.py:321:10:</a> FURB103 `open` and `write` should be replaced by `Path(_get_messages_react_pot(directory)).write_bytes(output)`
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/indico/cli/setup.py#L674'>indico/cli/setup.py:674:14:</a> FURB103 `open` and `write` should be replaced by `Path(self.config_path).write_text(config + '\n')`
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/indico/web/assets/blueprint.py#L111'>indico/web/assets/blueprint.py:111:14:</a> FURB103 `open` and `write` should be replaced by `Path(cache_file)....`
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/indico/web/assets/blueprint.py#L63'>indico/web/assets/blueprint.py:63:14:</a> FURB103 `open` and `write` should be replaced by `Path(cache_file).write_text(data)`
+ <a href='https://github.com/indico/indico/blob/bff9d0bf9c15170dd6781b55eada809cee573857/setup.py#L42'>setup.py:42:18:</a> FURB103 `open` and `write` should be replaced by `Path(json_file).write_bytes(output)`
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| FURB103 | 137 | 137 | 0 | 0 | 0 |</p>
</p>
</details>

<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/T-256">@T-256</a> reviewed on 2024-04-09 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/T-256">@T-256</a> on <code>crates/ruff_linter/src/rules/refurb/snapshots/ruff_linter__rules__refurb__tests__FURB103_FURB103.py.snap</code>:28 on 2024-04-09 12:51</div>
            <div class="timeline-body"><p>I think <code>encoding=&quot;utf8&quot;</code> keyword argument should go after <code>foobar</code> positional argument</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a> reviewed on 2024-04-09 20:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/augustelalande">@augustelalande</a> on <code>crates/ruff_linter/src/rules/refurb/snapshots/ruff_linter__rules__refurb__tests__FURB103_FURB103.py.snap</code>:28 on 2024-04-09 20:18</div>
            <div class="timeline-body"><p>Ya it's the same thing I commented above, but I'm not sure how to correct it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> requested changes on 2024-04-10 07:44</div>
            <div class="timeline-body"><p>Thanks you for the PR.</p>
<p>I think a lot of the definitions and functions are repeated as you've mentioned. It would be useful to move the common structs and functions to <code>crates/ruff_linter/src/rules/refurb/helpers.rs</code> module to avoid having duplicate logic. You can find similar examples in other rule modules as well. Can you please make this change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2024-04-10 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-04-10 21:17</div>
            <div class="timeline-body"><p>@dhruvmanila Done. Any suggestion on the comments above?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @MichaReiser on 2024-04-11 06:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2024-04-11 07:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/refurb/helpers.rs</code>:70 on 2024-04-11 07:19</div>
            <div class="timeline-body"><p>We should just limit this to the <code>refurb</code> directory for now. If there's any need in the future to use this in another rule module, we can make it at the crate level.</p>
<pre><code class="language-suggestion">pub(super) enum OpenMode {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/refurb/helpers.rs</code>:69 on 2024-04-11 07:22</div>
            <div class="timeline-body"><p>nit: I think we can make this enum use copy semantics:</p>
<pre><code class="language-suggestion">// Helpers for read-whole-file and write-whole-file
#[derive(Debug, Copy, Clone)]
</code></pre>
<p>Clippy will then probably start complaining in certain places to use copy semantics instead of reference. Refer https://rust-lang.github.io/rust-clippy/master/index.html#/trivially_copy_pass_by_ref</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/refurb/helpers.rs</code>:106 on 2024-04-11 07:23</div>
            <div class="timeline-body"><p>We should make this limited as well. Use <code>super</code> instead of <code>crate in the </code>pub` declaration. I would suggest to make this change for all public items in this module.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/refurb/rules/write_whole_file.rs</code>:112 on 2024-04-11 07:49</div>
            <div class="timeline-body"><p>I think we can avoid the clone here and the one in <code>match_write_call</code> (<code>.to_vec()</code> call) by using a <code>Vec&lt;&amp;'a [Expr]&gt;</code> instead of <code>Vec&lt;Vec&lt;Expr&gt;&gt;</code>. Here's what I'm suggesting:</p>
<pre><code class="language-diff">diff --git a/crates/ruff_linter/src/rules/refurb/rules/write_whole_file.rs b/crates/ruff_linter/src/rules/refurb/rules/write_whole_file.rs
index 9830f3364..76ed21566 100644
--- a/crates/ruff_linter/src/rules/refurb/rules/write_whole_file.rs
+++ b/crates/ruff_linter/src/rules/refurb/rules/write_whole_file.rs
@@ -62,13 +62,14 @@ pub(crate) fn write_whole_file(checker: &amp;mut Checker, with: &amp;ast::StmtWith) {
     }
 
     // Then we need to match each `open` operation with exactly one `write` call.
-    let mut matcher = WriteMatcher::new(candidates);
-    visitor::walk_body(&amp;mut matcher, &amp;with.body);
-    let contents = matcher.contents();
+    let (matches, contents) = {
+        let mut matcher = WriteMatcher::new(candidates);
+        visitor::walk_body(&amp;mut matcher, &amp;with.body);
+        matcher.finish()
+    };
 
     // All the matched operations should be reported.
-    let diagnostics: Vec&lt;Diagnostic&gt; = matcher
-        .into_matches()
+    let diagnostics: Vec&lt;Diagnostic&gt; = matches
         .iter()
         .zip(contents)
         .map(|(open, content)| {
@@ -89,7 +90,7 @@ pub(crate) fn write_whole_file(checker: &amp;mut Checker, with: &amp;ast::StmtWith) {
 struct WriteMatcher&lt;'a&gt; {
     candidates: Vec&lt;helpers::FileOpen&lt;'a&gt;&gt;,
     matches: Vec&lt;helpers::FileOpen&lt;'a&gt;&gt;,
-    contents: Vec&lt;Vec&lt;Expr&gt;&gt;,
+    contents: Vec&lt;&amp;'a [Expr]&gt;,
     loop_counter: u32,
 }
 
@@ -103,12 +104,8 @@ impl&lt;'a&gt; WriteMatcher&lt;'a&gt; {
         }
     }
 
-    fn into_matches(self) -&gt; Vec&lt;helpers::FileOpen&lt;'a&gt;&gt; {
-        self.matches
-    }
-
-    fn contents(&amp;self) -&gt; Vec&lt;Vec&lt;Expr&gt;&gt; {
-        self.contents.clone()
+    fn finish(self) -&gt; (Vec&lt;helpers::FileOpen&lt;'a&gt;&gt;, Vec&lt;&amp;'a [Expr]&gt;) {
+        (self.matches, self.contents)
     }
 }
 
@@ -144,7 +141,7 @@ impl&lt;'a&gt; Visitor&lt;'a&gt; for WriteMatcher&lt;'a&gt; {
 }
 
 /// Match `x.write(foo)` expression and return expression `x` and `foo` on success.
-fn match_write_call(expr: &amp;Expr) -&gt; Option&lt;(&amp;Expr, Vec&lt;Expr&gt;)&gt; {
+fn match_write_call(expr: &amp;Expr) -&gt; Option&lt;(&amp;Expr, &amp;[Expr])&gt; {
     let call = expr.as_call_expr()?;
     let attr = call.func.as_attribute_expr()?;
     let method_name = &amp;attr.attr;
@@ -157,5 +154,5 @@ fn match_write_call(expr: &amp;Expr) -&gt; Option&lt;(&amp;Expr, Vec&lt;Expr&gt;)&gt; {
         return None;
     }
 
-    Some((attr.value.as_ref(), call.arguments.args.as_ref().to_vec()))
+    Some((&amp;*attr.value, &amp;*call.arguments.args))
 }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/refurb/snapshots/ruff_linter__rules__refurb__tests__FURB103_FURB103.py.snap</code>:88 on 2024-04-11 08:12</div>
            <div class="timeline-body"><p>Yeah, that's unfortunate. I think I'd suggest to have two different variants of <code>make_suggestion</code>. We can keep the one in <code>read_whole_file</code> as is.</p>
<p>Here, one thing to note is that the <code>write</code> function only takes in one positional argument which we can assume. So, the <code>make_suggestion</code> in <code>write_whole_file</code> would take in the argument expression as an additional parameter.</p>
<p>We can use <a href="https://github.com/astral-sh/ruff/blob/1b31d4e9f16d56ac71a32b8f610011e92b61a665/crates/ruff_python_ast/src/relocate.rs"><code>relocate_expr</code></a> to relocate it to the default range before calling the <code>make_suggestion</code> function.</p>
<pre><code class="language-rs">pub(super) fn make_suggestion(
    open: &amp;FileOpen&lt;'_&gt;,
    arg: &amp;Expr,
    generator: Generator,
) -&gt; SourceCodeSnippet {
    let name = ast::ExprName {
        id: open.mode.pathlib_method(),
        ctx: ast::ExprContext::Load,
        range: TextRange::default(),
    };
    let call = ast::ExprCall {
        func: Box::new(name.into()),
        arguments: ast::Arguments {
            args: Box::new([arg.clone()]),
            keywords: open.keywords.iter().copied().cloned().collect(),
            range: TextRange::default(),
        },
        range: TextRange::default(),
    };
    SourceCodeSnippet::from_str(&amp;generator.expr(&amp;call.into()))
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> requested changes on 2024-04-11 08:14</div>
            <div class="timeline-body"><p>Thank you for quickly following up with the requested change.</p>
<p>I've a few suggestion to avoid cloning and have provided a suggestion for the incorrect argument order that you've highlighted.</p>
<p>I haven't looked at the test cases yet which I'll do so now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-11 08:29</div>
            <div class="timeline-body"><p>@augustelalande Sorry, I was playing around with the suggestions I made which fixes the &quot;suggestion&quot; problem, so I've pushed that. I'll list down what all changes I made, feel free to revert any of them if you think otherwise:</p>
<ol>
<li>Use copy semantics on <code>OpenMode</code></li>
<li>Make everything in <code>helpers</code> scoped to <code>super</code></li>
<li>Implement <code>make_suggestion</code> twice where the <code>write_*</code> one would take in a single argument, relocate it to the default text range and send it to the generator. This fixes the bug you commented about</li>
<li>Avoid having multiple clones for the <code>WriteMatcher</code> struct</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-04-11 08:43</div>
            <div class="timeline-body"><p>Thank you for working on this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2024-04-11 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-11 08:47</div>
            <div class="timeline-body"><p>(Looking at the ecosystem checks, making sure they're correct.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-04-11 08:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-04-11 08:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-04-11 18:35</div>
            <div class="timeline-body"><p>Thanks for cleaning things up. <code>relocate_expr</code> is exactly what I was looking for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-11 18:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:37:32 UTC
    </footer>
</body>
</html>
