<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visit PEP 764 inline `TypedDict`s' keys as non-type-expressions - astral-sh/ruff #15073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Visit PEP 764 inline <code>TypedDict</code>s&#x27; keys as non-type-expressions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15073">#15073</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2024-12-20 00:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body">Summary
<p>Resolves #10812.</p>
Test Plan
<p><code>cargo nextest run</code> and <code>cargo insta test</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-20 00:40</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-20 00:41</div>
            <div class="timeline-body"><p>The <code>INLINE_TYPEDDICT</code> bitflag was added &quot;just in case&quot;. I&#x27;ll remove it if it is not desired.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-24 06:29</div>
            <div class="timeline-body"><blockquote>
<p>The <code>INLINE_TYPEDDICT</code> bitflag was added &quot;just in case&quot;. I&#x27;ll remove it if it is not desired.</p>
</blockquote>
<p>Yeah, we should remove it if it&#x27;s not being used currently.</p>
<p>I&#x27;ll also make a general recommendation to use <code>typed_dict</code> instead of <code>typeddict</code> as I&#x27;d consider them two separate words.</p>
<p>Apart from this, I&#x27;m not exactly sure what the scope of this should be as the PEP is still in draft so we don&#x27;t know where all we need to change this. What about when the slice element is not a dictionary like the one in your test case? I don&#x27;t see it being supported in the PEP yet. Should we only limit it to the following syntax (https://github.com/Viicos/peps/blob/inlined-typed-dictionaries/peps/pep-0764.rst#typing-specification-changes)?</p>
<pre><code>&lt;TypedDict&gt; &#x27;[&#x27; &#x27;{&#x27; (string: &#x27;:&#x27; annotation_expression &#x27;,&#x27;)* &#x27;}&#x27; &#x27;]&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-24 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-24 06:57</div>
            <div class="timeline-body"><p>@dhruvmanila When the expression is not a dictionary literal, <code>TypedDict[expr]</code> is invalid as a type expression. In this case, I think <code>expr</code> should be visited as a normal (non-type) expression, which is <a href="https://github.com/astral-sh/ruff/pull/15073/files#diff-3c2207aa8a10ed7a5c8ed3a0ed0c89a0228b95a6c4d6e12436313f8431287f51R1521">already the case</a> with this PR.</p>
<p>This PR could be considered provisional support for the PEP. Pyright (and Basedpyright) already did so; parity by other tools could help the PEP gain wider recognition.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-12-30 09:33</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-30 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-30 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-30 09:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:09:38 UTC
    </footer>
</body>
</html>
