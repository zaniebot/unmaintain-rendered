<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] IDE: only provide declarations and bindings as completions - astral-sh/ruff #18456</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] IDE: only provide declarations and bindings as completions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18456">#18456</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-06-04 09:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-04 09:14</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Previously, all symbols where provided as possible completions. In an example like the following, both <code>foo</code> and <code>f</code> were suggested as completions, because <code>f</code> itself is a symbol.</p>
<pre><code class="language-py">foo = 1

f&lt;CURSOR&gt;
</code></pre>
<p>Similarly, in the following example, <code>hidden_symbol</code> was suggested, even though it is not statically visible:</p>
<pre><code class="language-py">if 1 + 2 != 3:
    hidden_symbol = 1

hidden_&lt;CURSOR&gt;
</code></pre>
<p>With the change suggested here, we only use statically visible declarations and bindings as a source for completions. In the scenario from <a href="https://github.com/astral-sh/ruff/pull/18425#issuecomment-2935753258">this comment</a>, we do not include <code>ReadableBuffer</code> anymore (which is available as a symbol, but not re-exported from <code>typing</code>). A test for this was also added here.</p>
<p><img src="https://github.com/user-attachments/assets/01cfc206-d036-4828-826b-c2b9dc8202e9" alt="image" /></p>
<h2>Test Plan</h2>
<ul>
<li>Updated snapshot tests</li>
<li>New test for statically hidden definitions</li>
<li>Added test for star import</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @sharkdp on 2025-06-04 09:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-06-04 09:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_ide/src/completion.rs</code>:927 on 2025-06-04 09:17</div>
            <div class="timeline-body"><p><code>float</code> will be available again once we add all builtins as a source for completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-06-04 09:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-04 09:17</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-06-04 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2025-06-04 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-06-04 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @sharkdp on 2025-06-04 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @sharkdp on 2025-06-04 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:154 on 2025-06-04 09:36</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        self.members.extend(all_declarations_and_bindings(db, scope_id));
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:74 on 2025-06-04 09:37</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            symbols.extend(all_declarations_and_bindings(self.db, file_scope.to_scope_id(self.db, self.file)));
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:74 on 2025-06-04 09:38</div>
            <div class="timeline-body"><p>I still think we might want to include unreachable bindings if the cursor is actually in an unreachable area of code -- it might be worth a TODO? But the autocomplete behaviour for <code>*</code> imports is very unintuitive right now where it's suggesting all these symbols that just don't exist at runtime, so this is definitely the right thing to do for now IMO</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-06-04 09:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @MichaReiser on 2025-06-04 09:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-06-04 09:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:74 on 2025-06-04 09:46</div>
            <div class="timeline-body"><blockquote>
<p>it might be worth a TODO?</p>
</blockquote>
<p>Done, added a test for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-04 09:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:848 on 2025-06-04 09:49</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        // currently make no effort to provide a good IDE experience within sections that
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-06-04 14:07</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-06-04 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-06-04 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-04 14:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:45:32 UTC
    </footer>
</body>
</html>
