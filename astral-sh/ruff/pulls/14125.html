<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix duplicate unpack diagnostics - astral-sh/ruff #14125</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix duplicate unpack diagnostics</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14125">#14125</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-11-06 09:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-06 09:06</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes the issue where we emitted duplicated diagnostics for unpack assignments.</p>
<p>The solution is fairly simple. All we need is a deterministic way to know when we should add the
diagnostics. The approach I used here is only to add the diagnostics for the first unpacking.</p>
<p>This works because <code>check_types</code> pulls all types.</p>
<p>What about accumulators. We may still want to use accumulators in the future, e.g. if other, non type checking queries start emitting diagnostics. However, we have to solve the performance regression first. I have an idea on how that could be done. See the <a href="https://salsa.zulipchat.com/#narrow/channel/333573-Contributing-to-Salsa/topic/Accumulator.20performance">zulip discussion</a></p>
<h2>Test Plan</h2>
<p>See updated mdtest</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2024-11-06 09:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2024-11-06 09:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2024-11-06 09:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-11-06 09:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-06 09:21</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/unpacking.md</code>:148 on 2024-11-06 10:54</div>
            <div class="timeline-body"><p>Should fix the mdformat complaints in pre-commit:</p>
<pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-11-06 10:55</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-11-06 11:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-11-06 11:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-11-06 11:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-06 11:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:51:27 UTC
    </footer>
</body>
</html>
