<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Teach autofix for `used-dummy-variable` about TypeVars etc. (`RUF052`) - astral-sh/ruff #14819</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Teach autofix for <code>used-dummy-variable</code> about TypeVars etc. (<code>RUF052</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14819">#14819</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-12-06 14:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-06 14:21</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>For some bindings, such as assignments where the right-hand-side is a <code>TypeVar</code> constructor call, renaming the binding can result in invalid code. For example, this diff that <code>renamer.rs</code> might make would take code that mypy (or any other spec-compliant type checker) would have accepted, and turns it into something a type checker will reject:</p>
<pre><code class="language-diff">  from typing import TypeVar

- _T = TypeVar(&quot;_T&quot;)
+ T = TypeVar(&quot;_T&quot;)
</code></pre>
<p>This is because the first argument to the <code>TypeVar</code> constructor must be the same as the variable the typevar is being bound to. Detecting this issue in general is impossible (there are lots of classes where this pattern is required), but it seems reasonable to special-case several standard-library classes where this pattern is required.</p>
<p>Fixes #14798</p>
<h2>Test Plan</h2>
<p>Added some more fixtures to RUF052 to check that the new logic in <code>renamer.rs</code> works as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-12-06 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2024-12-06 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @AlexWaygood on 2024-12-06 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @AlexWaygood on 2024-12-06 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-06 14:27</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-06 16:33</div>
            <div class="timeline-body"><p>Do you know what editors do when you rename a variable that's a <code>TypeVar</code> declaration?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-12-06 16:34</div>
            <div class="timeline-body"><p>This is very cool! Nice work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-06 17:05</div>
            <div class="timeline-body"><blockquote>
<p>Do you know what editors do when you rename a variable that's a <code>TypeVar</code> declaration?</p>
</blockquote>
<p>VSCode just does this, so we'll do a better job than them with this change ;)</p>
<pre><code class="language-diff">-_T = TypeVar(&quot;_T&quot;)
+T = TypeVar(&quot;_T&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-12-06 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-12-06 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-06 17:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:42:56 UTC
    </footer>
</body>
</html>
