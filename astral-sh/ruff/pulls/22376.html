<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Add ruff rules to catch deprecated Airflow imports for Airflow 3.1 (`AIR321`) - astral-sh/ruff #22376</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Add ruff rules to catch deprecated Airflow imports for Airflow 3.1 (<code>AIR321</code>)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22376">#22376</a>
        opened by <a href="https://github.com/sjyangkevin">@sjyangkevin</a>
        on 2026-01-04 21:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR is related to the discussion: https://github.com/apache/airflow/issues/54714</p>
<p>This change creates a new code (<code>AIR321</code>) and implement ruff rules to catch, and/or fix deprecated imports in Airflow for <strong>Airflow 3.1</strong>. The rules are implemented by following the structure of <code>AIR301</code>. The rules check whether a removed Airflow name is used, and match on <code>Expr::Name</code> and <code>Expr::Attribute</code>.</p>
<h2>Test Plan</h2>
<p>The following two test files are added:</p>
<ol>
<li>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names.py</li>
<li>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names_fix.py</li>
</ol>
<p><code>AIR321_names.py</code>
All the test cases in this file should raise violations and fixes should be suggested when running the test with <code>--unsafe-fixes</code>. The test results shown in the snapshot are expected.</p>
<pre><code class="language-bash">cargo run -p ruff -- check crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names.py --no-cache --preview --select AIR321 --unsafe-fixes
</code></pre>
<p><code>AIR321_names_fix.py </code>
All the test cases in this file raise NO violation (i.e., all checks should pass). The snapshot file is empty.</p>
<p><img width="1330" height="384" alt="Screenshot from 2026-01-04 16-37-51" src="https://github.com/user-attachments/assets/8a1d6dca-dc69-41f8-ba9f-822e0bcd04a7" /></p>
<h2>Document Update</h2>
<p><img width="942" height="56" alt="Screenshot from 2026-01-04 16-37-02" src="https://github.com/user-attachments/assets/e678837d-895f-483b-94a0-58dde7c60032" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-04 21:53</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+444 -0 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+444 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/airflow-core/tests/unit/ti_deps/deps/test_task_concurrency.py#L35'>airflow-core/tests/unit/ti_deps/deps/test_task_concurrency.py:35:16:</a> AIR321 `airflow.models.baseoperator.BaseOperator` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/dev/airflow_perf/scheduler_dag_execution_timing.py#L181'>dev/airflow_perf/scheduler_dag_execution_timing.py:181:24:</a> AIR321 [*] `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/kubernetes-tests/tests/kubernetes_tests/test_kubernetes_pod_operator.py#L59'>kubernetes-tests/tests/kubernetes_tests/test_kubernetes_pod_operator.py:59:20:</a> AIR321 [*] `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/performance/src/performance_dags/performance_dag/performance_dag_utils.py#L83'>performance/src/performance_dags/performance_dag/performance_dag_utils.py:83:27:</a> AIR321 [*] `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/alibaba/tests/unit/alibaba/cloud/log/test_oss_task_handler.py#L59'>providers/alibaba/tests/unit/alibaba/cloud/log/test_oss_task_handler.py:59:26:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/alibaba/tests/unit/alibaba/cloud/sensors/test_analyticdb_spark.py#L26'>providers/alibaba/tests/unit/alibaba/cloud/sensors/test_analyticdb_spark.py:26:16:</a> AIR321 [*] `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/src/airflow/providers/amazon/aws/executors/utils/exponential_backoff_retry.py#L72'>providers/amazon/src/airflow/providers/amazon/aws/executors/utils/exponential_backoff_retry.py:72:20:</a> AIR321 [*] `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/system/amazon/aws/example_mongo_to_s3.py#L45'>providers/amazon/tests/system/amazon/aws/example_mongo_to_s3.py:45:16:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/system/amazon/aws/example_mwaa.py#L121'>providers/amazon/tests/system/amazon/aws/example_mwaa.py:121:35:</a> AIR321 [*] `airflow.utils.timezone.utc` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/system/amazon/aws/example_mwaa.py#L151'>providers/amazon/tests/system/amazon/aws/example_mwaa.py:151:35:</a> AIR321 [*] `airflow.utils.timezone.utc` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/executors/ecs/test_ecs_executor.py#L878'>providers/amazon/tests/unit/amazon/aws/executors/ecs/test_ecs_executor.py:878:77:</a> AIR321 `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L325'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:325:25:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L326'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:326:23:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L585'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:585:74:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L586'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:586:75:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L601'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:601:66:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L602'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:602:67:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L694'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:694:74:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L695'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:695:75:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L725'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:725:74:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L726'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:726:75:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L762'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:762:41:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L800'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:800:74:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L801'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:801:75:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L928'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:928:41:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L934'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:934:41:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L945'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:945:41:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L951'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:951:41:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py#L995'>providers/amazon/tests/unit/amazon/aws/hooks/test_s3.py:995:41:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py#L143'>providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py:143:26:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py#L197'>providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py:197:16:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py#L263'>providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py:263:26:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py#L336'>providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py:336:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py#L337'>providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py:337:42:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py#L391'>providers/amazon/tests/unit/amazon/aws/log/test_cloudwatch_task_handler.py:391:33:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L651'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:651:24:</a> AIR321 `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L652'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:652:42:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L676'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:676:27:</a> AIR321 `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L707'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:707:15:</a> AIR321 `airflow.utils.timezone.utcnow` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L796'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:796:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L803'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:803:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L804'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:804:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L832'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:832:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L839'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:839:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/operators/test_s3.py#L840'>providers/amazon/tests/unit/amazon/aws/operators/test_s3.py:840:17:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/transfers/test_s3_to_sftp.py#L47'>providers/amazon/tests/unit/amazon/aws/transfers/test_s3_to_sftp.py:47:16:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/amazon/tests/unit/amazon/aws/transfers/test_sftp_to_s3.py#L45'>providers/amazon/tests/unit/amazon/aws/transfers/test_sftp_to_s3.py:45:16:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/apache/flink/tests/unit/apache/flink/operators/test_flink_kubernetes.py#L200'>providers/apache/flink/tests/unit/apache/flink/operators/test_flink_kubernetes.py:200:51:</a> AIR321 [*] `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/apache/flink/tests/unit/apache/flink/sensors/test_flink_kubernetes.py#L886'>providers/apache/flink/tests/unit/apache/flink/sensors/test_flink_kubernetes.py:886:51:</a> AIR321 [*] `airflow.utils.timezone.datetime` is removed in Airflow 3.1
+ <a href='https://github.com/apache/airflow/blob/0d07c70ae3a67b0fb7d9490a972eb06c2a9f1bcc/providers/apache/hdfs/tests/unit/apache/hdfs/log/test_hdfs_task_handler.py#L37'>providers/apache/hdfs/tests/unit/apache/hdfs/log/test_hdfs_task_handler.py:37:16:</a> AIR321 `airflow.utils.timezone.datetime` is removed in Airflow 3.1
... 394 additional changes omitted for project
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| AIR321 | 444 | 444 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:36 on 2026-01-04 21:55</div>
            <div class="timeline-body"><p>wondering if it is the right version to set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR321_AIR321_names_fix.py.snap</code>:1 on 2026-01-04 21:56</div>
            <div class="timeline-body"><p>The test cases in this snapshot do not raise any violation. The <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR321_AIR321_names.py.snap</code> is the &quot;unhappy path&quot;, and this file is the &quot;happy path&quot;. Wondering if there is a better way to implement these tests, would appreciate if there is any feedback.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:112 on 2026-01-04 21:57</div>
            <div class="timeline-body"><p>At the moment, we are only checking for deprecated imports, but in future there could be more cases come in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-04 21:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-05 10:23</div>
            <div class="timeline-body"><p>@Lee-W could you take a look at the PR if it catches the semantics you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2026-01-05 10:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:124 on 2026-01-05 10:32</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        ] =&gt; Replacement::SourceModuleMoved {
</code></pre>
<p>I think it makes more sense to use <code>SourceModuleMoved</code>. Same for the following ones without rename</p>
<hr />
<p>@amoghrajesh should we use these <code>_internal</code> thing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:158 on 2026-01-05 10:35</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        [&quot;airflow&quot;, &quot;utils&quot;, &quot;timezone&quot;, rest @ (&quot;convert_to_utc&quot;, &quot;datetime&quot;, &quot;make_naive&quot;)] =&gt; Replacement::SourceModuleMoved {
            module: &quot;airflow.sdk.timezone&quot;,
            name: format!(&quot;conf.{rest}&quot;),
        },
</code></pre>
<p>we can try something like this in many places</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-05 10:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2026-01-05 10:36</div>
            <div class="timeline-body"><blockquote>
<p>@Lee-W could you take a look at the PR if it catches the semantics you want.</p>
</blockquote>
<p>At a high level, yes, but some details will need some polish. Will let you know when it's at least ok from my side. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:158 on 2026-01-05 13:27</div>
            <div class="timeline-body"><p>Thanks for the feedback. I will group things if they are under the same submodules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-05 13:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-06 03:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:124 on 2026-01-06 03:57</div>
            <div class="timeline-body"><blockquote>
<p>I think it makes more sense to use <code>SourceModuleMoved</code>. Same for the following ones without rename</p>
</blockquote>
<p>updated to use <code>SourceModuleMoved</code> instead of <code>Rename</code> as only the locations are changed. Thanks for the feedback.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-06 03:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:158 on 2026-01-06 03:57</div>
            <div class="timeline-body"><p>related imports have been grouped together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Lee-W by @sjyangkevin on 2026-01-06 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/amoghrajesh">@amoghrajesh</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names_fix.py</code>:7 on 2026-01-06 07:10</div>
            <div class="timeline-body"><p>I wonder if there is even a need to have this in the public API? If so, we should not be importing it from <code>_internal</code> ever and add it to lazy imports here: https://github.com/apache/airflow/blob/main/task-sdk/src/airflow/sdk/<strong>init</strong>.py#L113</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/amoghrajesh">@amoghrajesh</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names_fix.py</code>:15 on 2026-01-06 07:11</div>
            <div class="timeline-body"><p>This is true if the usage is in <code>airflow-core</code> but otherwise its inside <code>BaseXcom</code> now: https://github.com/apache/airflow/blob/main/task-sdk/src/airflow/sdk/bases/xcom.py#L50</p>
<p>Not sure what you can do about it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/amoghrajesh">@amoghrajesh</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names_fix.py</code>:48 on 2026-01-06 07:13</div>
            <div class="timeline-body"><p>We should not reference internal modules. We do not need to maintain compat for these I'd say</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/amoghrajesh">@amoghrajesh</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names_fix.py</code>:65 on 2026-01-06 07:14</div>
            <div class="timeline-body"><pre><code class="language-suggestion">from airflow.sdk import BaseOperator
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amoghrajesh">@amoghrajesh</a> reviewed on 2026-01-06 07:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-06 08:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR321_names_fix.py</code>:15 on 2026-01-06 08:58</div>
            <div class="timeline-body"><p>We can add a warning message instead of a fix, but isn't that a breaking change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2026-01-06 09:03</div>
            <div class="timeline-body"><p>The logic looks solid, but we’ll need to revisit the list. @sjyangkevin, could you please make this a draft? We can discuss the list further in relation to the Airflow issue. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @sjyangkevin on 2026-01-06 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on 2026-01-06 13:38</div>
            <div class="timeline-body"><p>@Lee-W and @amoghrajesh , thanks for the feedback! I have converted it into a draft. I will also happy to work on the fix after the further discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/suggested_to_update_3_0.rs</code>:1 on 2026-01-14 04:16</div>
            <div class="timeline-body"><p>I noticed we also have some rules for module moved to task sdk. So, we can also refine those messages here using the new <code>SourceModuleMovedToSDK</code> Replacement. We might need to check which task sdk version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR301_AIR301_names.py.snap</code>:1 on 2026-01-14 04:16</div>
            <div class="timeline-body"><p>This is moved to AIR321.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-14 04:23</div>
            <div class="timeline-body"><p>Hi @Lee-W and @amoghrajesh ,</p>
<p>I've refined the rules based on the feedback. I not sure if we can make a rule a &quot;warning&quot; in ruff; currently, I introduce a new Replacement <code>SourceModuleMovedToSDK</code> which we can use to embed a warning message. Let me know if it is the right approach.</p>
<blockquote>
<p>airflow.utils.task_group.get_task_group_children_getter
airflow.utils.task_group.task_group_to_dict</p>
</blockquote>
<ol>
<li>Exclude the followings</li>
</ol>
<blockquote>
<p>airflow.sensors.base.poke_mode_only → airflow.sdk.bases.sensor.poke_mode_only</p>
</blockquote>
<blockquote>
<p>airflow.secrets.cache.SecretCache → from airflow.sdk import SecretCache</p>
</blockquote>
<p>Below is the summary of changes.
2. Fix Import Path in AIR311
3. Move from AIR301 to AIR321
4. Keep <code>_internal</code> modules and show a warning message to indicate these are internal API that may change without notice.
5. Update the other rules to adapt for the new Replacement <code>SourceModuleMovedToSDK</code></p>
<p>Thanks!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @amoghrajesh by @sjyangkevin on 2026-01-14 04:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2026-01-14 09:28</div>
            <div class="timeline-body"><blockquote>
<p>I not sure if we can make a rule a &quot;warning&quot; in ruff</p>
</blockquote>
<p>A Diagnotic without fix is basically a warning</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-14 09:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR301_AIR301_names.py.snap</code>:1 on 2026-01-14 09:28</div>
            <div class="timeline-body"><p>It might be worth checking how it works in Airflow 3.0.x. If the original path works fine, we're safe to move it to AIR321</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-14 16:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR301_AIR301_names.py.snap</code>:1 on 2026-01-14 16:09</div>
            <div class="timeline-body"><p>checked in 3.0.6, and the original path still working.</p>
<p><img width="1054" height="197" alt="Screenshot from 2026-01-14 11-08-38" src="https://github.com/user-attachments/assets/20331dba-541e-43da-b0a7-ccb507150c8d" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on 2026-01-14 16:20</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>I not sure if we can make a rule a &quot;warning&quot; in ruff</p>
</blockquote>
<p>A Diagnotic without fix is basically a warning</p>
</blockquote>
<p>Thanks! The current implementation proposes a fix and include a warning message. I can refactor this to use a simple message to notify the module move, and include a message to tell these APIs are subject to change (don't encourage using these). So, we don't suggest fix for it. Which one do you think could be a better idea?</p>
<p>Current Implementation suggest fixes and show warning message.
<img width="1083" height="383" alt="Screenshot from 2026-01-14 11-17-28" src="https://github.com/user-attachments/assets/1d5b1bb5-5818-4048-aa6a-1071b46f534d" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-15 15:06</div>
            <div class="timeline-body"><p>Hi @Lee-W and @amoghrajesh , I made a few adjustments to the PR and I think it is almost ready for open it again for review. Let me know if you have any feedback before opening it again. Below is the summary of changes made.</p>
<ol>
<li>Move <code>SecretCache</code> from AIR301 to AIR321 (tested in Airflow 3.0.6 and the original import is still valid)</li>
<li>Move the test case for <code>SecretCache</code> from AIR301 to AIR321</li>
<li>For <code>_internal</code> modules, the rule is updated to use <code>Message</code> to show a warning. Hence, the <code>warning_message</code> field is removed from the <code>SourceModuleMovedToSDK</code>. This field is only used for the internal module cases, but will be <code>None</code> for majority.</li>
<li>Update the <code>fix_title</code> for <code>SourceModuleMovedToSDK</code> to <strong>&quot;<code>{name}</code> has been moved to <code>{module}</code> since Airflow 3.x (with apache-airflow-task-sdk&gt;={version}).&quot;</strong>, where version is <code>1.0.6</code> for rules in AIR301, and <code>1.1.6</code> for rules in AIR321.</li>
<li>For AIR321, update <code>preview_since</code> to <code>0.14.12</code></li>
<li>Test snapshots are all updated.</li>
<li>Comments in https://github.com/apache/airflow/issues/54714#issuecomment-3741920944 are resolved.</li>
</ol>
<p>Thanks!</p>
<p><img width="988" height="224" alt="Screenshot from 2026-01-15 10-22-16" src="https://github.com/user-attachments/assets/fb11db9f-83b5-4be5-b36e-45ef568b29d1" /></p>
<p><img width="985" height="295" alt="Screenshot from 2026-01-15 10-21-47" src="https://github.com/user-attachments/assets/a71fddfb-fdf1-4dc0-97bf-827bf54de7a7" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:141 on 2026-01-16 08:30</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        [
            &quot;airflow&quot;,
            &quot;utils&quot;,
            &quot;setup_teardown&quot;,
            rest @ (&quot;BaseSetupTeardownContext&quot;, &quot;SetupTeardownContext&quot;)
        ] =&gt; Replacement::Message(
            format!(
                &quot;`{rest}` has been moved to `airflow.sdk.definitions._internal.setup_teardown` \
                since Airflow 3.1. This is an internal module and is subject to change without notice.&quot;
            ),
        )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:151 on 2026-01-16 08:31</div>
            <div class="timeline-body"><p>I think <code>airflow.models</code> is not supposed to be used. We should make it a warning message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:184 on 2026-01-16 08:32</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        [
            &quot;airflow&quot;,
            &quot;utils&quot;,
            &quot;decorators&quot;,
            rest @ (&quot;fixup_decorator_warning_stack&quot;, &quot;remove_task_decorator&quot;),
        ] =&gt; Replacement::Message(
            &quot;`{rest}` has been moved to `airflow.sdk.definitions._internal.decorators` \
            since Airflow 3.1. This is an internal module and is subject to change without notice.&quot;,
        ),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:184 on 2026-01-16 08:33</div>
            <div class="timeline-body"><p>we can apply ths to elsewhere as well</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:184 on 2026-01-16 08:33</div>
            <div class="timeline-body"><p>or even make it a new enum item? the message are similair</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-16 08:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-16 14:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:184 on 2026-01-16 14:30</div>
            <div class="timeline-body"><p>Thanks for the feedback! I attempted to use <code>format!</code> to template the message and pass the <code>rest</code>, but it returns a <code>String</code> type. However, <code>Message</code> is static string and has type error. I will play around with it and see if there is a way to use <code>Message</code>, if not, we can create a new enum item.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/helpers.rs</code>:50 on 2026-01-16 20:44</div>
            <div class="timeline-body"><p>add a new item in the enum which used to show warning message for internal module</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3_1.rs</code>:151 on 2026-01-16 20:45</div>
            <div class="timeline-body"><p>updated this to show a warning. <code>[&quot;airflow&quot;, &quot;utils&quot;, &quot;xcom&quot;, &quot;XCOM_RETURN_KEY&quot;] =&gt; Replacement::InternalModule { ...</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR321_AIR321_names.py.snap</code>:24 on 2026-01-16 20:46</div>
            <div class="timeline-body"><p>updated warning message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-16 20:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Lee-W by @sjyangkevin on 2026-01-16 20:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-19 04:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1031 on 2026-01-19 04:16</div>
            <div class="timeline-body"><p>Here, we leveraged the <code>suggest_fix</code> parameter from <code>SourceModuleMovedWithMessage</code> to handle when we would like to show a warning and when we would like to suggest a fix with custom message.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-19 04:20:20 UTC
    </footer>
</body>
</html>
