<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Local type, public type, imported type, attribute type, nonlocal type - astral-sh/ruff #19116</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Local type, public type, imported type, attribute type, nonlocal type</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19116">#19116</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-07-03 08:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-03 08:35</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR attempts to clarify the terminology around local types, public types, imported types, attribute types and nonlocal types. I think we now use the &quot;correct&quot; term in all places, but I'm not 100% satisfied with this for two reasons: (1) these are <em>a lot</em> of new terms (2) &quot;nonlocal&quot; is not the opposite of &quot;local&quot;, &quot;public&quot; is the opposite of &quot;local&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2025-07-03 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-07-03 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @sharkdp on 2025-07-03 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @sharkdp on 2025-07-03 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-07-03 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/function.rs</code>:49 on 2025-07-03 08:36</div>
            <div class="timeline-body"><p>I don't think it's particularly important to refer to the correct category of type here. This is trying to make a different point. &quot;Public&quot; is too narrow: this would also work for local uses of <code>f</code> after this definition.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-03 08:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-03 08:38</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">mypy_primer (https://github.com/hauntsaninja/mypy_primer)
-     memo fields = ~41MB
+     memo fields = ~45MB

pytest-robotframework (https://github.com/detachhead/pytest-robotframework)
- TOTAL MEMORY USAGE: ~45MB
+ TOTAL MEMORY USAGE: ~49MB

Expression (https://github.com/cognitedata/Expression)
-     memo fields = ~49MB
+     memo fields = ~54MB

discord.py (https://github.com/Rapptz/discord.py)
-     memo fields = ~189MB
+     memo fields = ~207MB

hydra-zen (https://github.com/mit-ll-responsible-ai/hydra-zen)
- TOTAL MEMORY USAGE: ~88MB
+ TOTAL MEMORY USAGE: ~80MB

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
-     memo fields = ~156MB
+     memo fields = ~171MB

mkosi (https://github.com/systemd/mkosi)
-     memo fields = ~106MB
+     memo fields = ~97MB

bandersnatch (https://github.com/pypa/bandersnatch)
-     memo fields = ~66MB
+     memo fields = ~72MB

tornado (https://github.com/tornadoweb/tornado)
-     memo fields = ~142MB
+     memo fields = ~129MB

mkdocs (https://github.com/mkdocs/mkdocs)
- TOTAL MEMORY USAGE: ~129MB
+ TOTAL MEMORY USAGE: ~117MB

django-stubs (https://github.com/typeddjango/django-stubs)
- TOTAL MEMORY USAGE: ~171MB
+ TOTAL MEMORY USAGE: ~189MB

meson (https://github.com/mesonbuild/meson)
-     memo fields = ~304MB
+     memo fields = ~334MB

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-03 08:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:1 on 2025-07-03 08:41</div>
            <div class="timeline-body"><p>Documents like these tend to stagnate over time, so I'm also fine moving this content somewhere else and less central. But I think there would be room for more things that we could explain here. For example:</p>
<ul>
<li>Definition vs bindings vs declaration</li>
<li>Place vs symbol vs qualified types vs types</li>
<li>&quot;Symbol&quot; in semantic index building vs &quot;symbol&quot; in type inference</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:78 on 2025-07-03 11:36</div>
            <div class="timeline-body"><p>The fact that we need to subdivide the concept of &quot;public types&quot; into three sub-concepts makes me wonder if the &quot;public types&quot; concept is even useful at all at this point? Could we not have four top-level categories (local types; imported types; attribute types; nonlocal types) instead of two top-level categories, of which one has three subcategories?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-03 11:36</div>
            <div class="timeline-body"><p>thanks, this is useful!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-03 11:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:78 on 2025-07-03 11:54</div>
            <div class="timeline-body"><blockquote>
<p>The fact that we need to subdivide the concept of &quot;public types&quot; into three sub-concepts makes me wonder if the &quot;public types&quot; concept is even useful at all at this point?</p>
</blockquote>
<p>&quot;public type&quot; is still used in many places in the codebase and in tests for that exact purpose. We treat all public types together in a special way when it comes to this union-with-Unknown thing. So I'd rather get rid of &quot;imported types&quot; and &quot;attribute types&quot; then to get rid of &quot;public types&quot;, I think?</p>
<p>Otherwise I have to use &quot;imported types or attribute types or nonlocal types&quot; everywhere (I can't use &quot;all types that are not local&quot; because that sounds too much like nonlocal).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-03 12:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:78 on 2025-07-03 12:41</div>
            <div class="timeline-body"><p>Hmm, okay, we can leave this as-is then :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-07-03 13:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:63 on 2025-07-03 16:53</div>
            <div class="timeline-body"><p>I think these statements are not true of all public types. Specifically for <a href="https://play.ty.dev/14b48f87-c21e-4a3c-9e8a-ed50ac07ce8d">nonlocal use which resolves to an enclosing function scope</a> -- in this case we <em>can</em> see all potential bindings, we just don't know which one is most recent at the time we are called, so we do union all reachable definitions, but we don't union with unknown.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:70 on 2025-07-03 16:55</div>
            <div class="timeline-body"><p>Maybe worth mentioning in passing here that for imported types, that scope will always be a module global scope (by the nature of imports)</p>
<pre><code class="language-suggestion">    imported type always refers to the local type that the symbol would have at the *end of the
    module scope* in which it was defined.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/glossary.md</code>:78 on 2025-07-03 16:58</div>
            <div class="timeline-body"><blockquote>
<p>We treat all public types together in a special way when it comes to this union-with-Unknown thing.</p>
</blockquote>
<p>Even this isn't true of all public types, as I mentioned in another comment above.</p>
<p>(But I'm still OK with keeping the blanket term, if there are places we use it that correctly apply to all kinds of public types.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-07-03 17:01</div>
            <div class="timeline-body"><p>Thank you!</p>
<p>I agree that I don't love the term &quot;nonlocal&quot;, both because it seems like it should describe everything that isn't a &quot;local type&quot;, and because it seems like it might be connected to the <code>nonlocal</code> keyword, which it is in a sort of general semantic sense, but it's applicability isn't limited to cases where the <code>nonlocal</code> keyword is used.</p>
<p>But I also don't have a better idea for what term to use there: &quot;nonlocal&quot; seems to clearly describe what we are talking about.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @sharkdp on 2025-07-08 08:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:33:38 UTC
    </footer>
</body>
</html>
