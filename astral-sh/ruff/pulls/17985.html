<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Update `AIR301` and `AIR311` with the latest Airflow implementations - astral-sh/ruff #17985</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Update <code>AIR301</code> and <code>AIR311</code> with the latest Airflow implementations</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17985">#17985</a>
        opened by <a href="https://github.com/Lee-W">@Lee-W</a>
        on 2025-05-09 14:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<ul>
<li>Remove the following rules<ul>
<li>name<ul>
<li><code>airflow.auth.managers.base_auth_manager.is_authorized_dataset</code> → <code>airflow.api_fastapi.auth.managers.base_auth_manager.is_authorized_asset</code></li>
<li><code>airflow.providers.fab.auth_manager.fab_auth_manager.is_authorized_dataset</code> → <code>airflow.providers.fab.auth_manager.fab_auth_manager.is_authorized_asset</code></li>
</ul>
</li>
</ul>
</li>
<li>Update the following rules<ul>
<li>name<ul>
<li><code>airflow.models.baseoperatorlink.BaseOperatorLink</code> → <code>airflow.sdk.BaseOperatorLink</code></li>
<li><code>airflow.api_connexion.security.requires_access</code> → &quot;Use <code>airflow.api_fastapi.core_api.security.requires_access_*</code> instead`&quot;</li>
<li><code>airflow.api_connexion.security.requires_access_dataset</code>→ <code>airflow.api_fastapi.core_api.security.requires_access_asset</code></li>
<li><code>airflow.notifications.basenotifier.BaseNotifier</code> → <code>airflow.sdk.bases.notifier.BaseNotifier</code></li>
<li><code>airflow.www.auth.has_access</code>  → None</li>
<li><code>airflow.www.auth.has_access_dataset</code> → None</li>
<li><code>airflow.www.utils.get_sensitive_variables_fields</code>→ None</li>
<li><code>airflow.www.utils.should_hide_value_for_key</code>→ None</li>
</ul>
</li>
<li>class attribute<ul>
<li><code>airflow..sensors.weekday.DayOfWeekSensor</code><ul>
<li><code>use_task_execution_day</code> removed</li>
</ul>
</li>
<li><code>airflow.providers.amazon.aws.auth_manager.aws_auth_manager.AwsAuthManager</code><ul>
<li><code>is_authorized_dataset</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Add the following rules<ul>
<li>class attribute<ul>
<li><code>airflow.auth.managers.base_auth_manager.BaseAuthManager</code> | <code>airflow.providers.fab.auth_manager.fab_auth_manager.FabAuthManager</code></li>
</ul>
</li>
<li>name<ul>
<li><code>airflow.auth.managers.base_auth_manager.BaseAuthManager</code> → <code>airflow.api_fastapi.auth.managers.base_auth_manager.BaseAuthManager</code>           * <code>is_authorized_dataset</code> → <code>is_authorized_asset</code></li>
</ul>
</li>
</ul>
</li>
<li>refactor<ul>
<li>simplify unnecessary match with if else</li>
<li>rename Replacement::Name as Replacement::AttrName</li>
</ul>
</li>
</ul>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>The test fixtures have been revised and updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Update air301 air311 rules" to "[`airflow`] Update `AIR301`, `AIR311` rules with the latest Airflow implemnetation" by @Lee-W on 2025-05-09 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-12 15:06</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+21 -2 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+21 -2 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/dev/airflow_perf/scheduler_dag_execution_timing.py#L255'>dev/airflow_perf/scheduler_dag_execution_timing.py:255:10:</a> AIR301 `airflow.utils.db.create_session` is removed in Airflow 3.0
- <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/dev/airflow_perf/scheduler_dag_execution_timing.py#L255'>dev/airflow_perf/scheduler_dag_execution_timing.py:255:13:</a> AIR301 `airflow.utils.db.create_session` is removed in Airflow 3.0
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/dev/airflow_perf/scheduler_dag_execution_timing.py#L302'>dev/airflow_perf/scheduler_dag_execution_timing.py:302:18:</a> AIR301 `airflow.utils.db.create_session` is removed in Airflow 3.0
- <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/dev/airflow_perf/scheduler_dag_execution_timing.py#L302'>dev/airflow_perf/scheduler_dag_execution_timing.py:302:21:</a> AIR301 `airflow.utils.db.create_session` is removed in Airflow 3.0
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/amazon/src/airflow/providers/amazon/aws/links/base_aws.py#L41'>providers/amazon/src/airflow/providers/amazon/aws/links/base_aws.py:41:19:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/databricks/src/airflow/providers/databricks/operators/databricks.py#L250'>providers/databricks/src/airflow/providers/databricks/operators/databricks.py:250:28:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/databricks/src/airflow/providers/databricks/plugins/databricks_workflow.py#L238'>providers/databricks/src/airflow/providers/databricks/plugins/databricks_workflow.py:238:26:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/databricks/src/airflow/providers/databricks/plugins/databricks_workflow.py#L272'>providers/databricks/src/airflow/providers/databricks/plugins/databricks_workflow.py:272:38:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/databricks/src/airflow/providers/databricks/plugins/databricks_workflow.py#L366'>providers/databricks/src/airflow/providers/databricks/plugins/databricks_workflow.py:366:39:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/dbt/cloud/src/airflow/providers/dbt/cloud/operators/dbt.py#L50'>providers/dbt/cloud/src/airflow/providers/dbt/cloud/operators/dbt.py:50:34:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/cloud/links/base.py#L38'>providers/google/src/airflow/providers/google/cloud/links/base.py:38:22:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/cloud/links/datafusion.py#L44'>providers/google/src/airflow/providers/google/cloud/links/datafusion.py:44:22:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/cloud/links/dataproc.py#L136'>providers/google/src/airflow/providers/google/cloud/links/dataproc.py:136:24:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/cloud/links/dataproc.py#L83'>providers/google/src/airflow/providers/google/cloud/links/dataproc.py:83:20:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/cloud/operators/dataproc_metastore.py#L112'>providers/google/src/airflow/providers/google/cloud/operators/dataproc_metastore.py:112:37:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/cloud/operators/dataproc_metastore.py#L64'>providers/google/src/airflow/providers/google/cloud/operators/dataproc_metastore.py:64:29:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/google/src/airflow/providers/google/marketing_platform/links/analytics_admin.py#L39'>providers/google/src/airflow/providers/google/marketing_platform/links/analytics_admin.py:39:31:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/microsoft/azure/src/airflow/providers/microsoft/azure/operators/data_factory.py#L52'>providers/microsoft/azure/src/airflow/providers/microsoft/azure/operators/data_factory.py:52:53:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/microsoft/azure/src/airflow/providers/microsoft/azure/operators/powerbi.py#L46'>providers/microsoft/azure/src/airflow/providers/microsoft/azure/operators/powerbi.py:46:19:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/microsoft/azure/src/airflow/providers/microsoft/azure/operators/synapse.py#L133'>providers/microsoft/azure/src/airflow/providers/microsoft/azure/operators/synapse.py:133:35:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/standard/src/airflow/providers/standard/operators/trigger_dagrun.py#L81'>providers/standard/src/airflow/providers/standard/operators/trigger_dagrun.py:81:25:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/standard/src/airflow/providers/standard/sensors/external_task.py#L72'>providers/standard/src/airflow/providers/standard/sensors/external_task.py:72:23:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/dedf4df66ad83d66df7640421fc2b475f43e3f11/providers/yandex/src/airflow/providers/yandex/links/yq.py#L43'>providers/yandex/src/airflow/providers/yandex/links/yq.py:43:14:</a> AIR311 `airflow.models.baseoperatorlink.BaseOperatorLink` is removed in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| AIR311 | 19 | 19 | 0 | 0 | 0 |
| AIR301 | 4 | 2 | 2 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @ntBre on 2025-05-13 01:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Lee-W on 2025-05-15 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-05-15 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-05-15 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:104 on 2025-05-15 19:44</div>
            <div class="timeline-body"><pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:483 on 2025-05-15 19:47</div>
            <div class="timeline-body"><p>nit: the <code>match</code>es seemed a bit more compact, but <code>if-else</code> is okay with me if you prefer it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:537 on 2025-05-15 19:49</div>
            <div class="timeline-body"><p>I think you could collapse this check like the one below it:</p>
<pre><code class="language-suggestion">            } else if is_airflow_auth_manager(segments) &amp;&amp; attr.as_str() == &quot;is_authorized_dataset&quot; {
                    Replacement::AttrName(&quot;is_authorized_asset&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:902 on 2025-05-15 19:52</div>
            <div class="timeline-body"><p>I think you can do this and avoid the <code>unwrap</code>, but haven't tested it:</p>
<pre><code class="language-suggestion">        let import_target = name.split('.').next().unwrap_or(name);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1002 on 2025-05-15 19:54</div>
            <div class="timeline-body"><p>I think you're supposed to use the <code>binding</code> returned by <code>get_or_import_symbol</code>. Was something going wrong here when you did that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-05-15 20:00</div>
            <div class="timeline-body"><p>This overall looks good to me. I had a few minor suggestions and one question about the import code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-05-16 10:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:104 on 2025-05-16 10:34</div>
            <div class="timeline-body"><p>updated. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:483 on 2025-05-16 10:35</div>
            <div class="timeline-body"><p>oh, I thought it's better to use <code>if-else</code> this way. Just revert that commit. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-05-16 10:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-05-16 10:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:537 on 2025-05-16 10:36</div>
            <div class="timeline-body"><p>yep, just updated it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-05-16 10:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1002 on 2025-05-16 10:41</div>
            <div class="timeline-body"><p>There 2 cases like the following that need to be handled this way.</p>
<pre><code class="language-python">from airflow.providers.amazon.aws.auth_manager.avp.entities import AvpEntities

AvpEntities.DATASET
</code></pre>
<p>which should be fixed as</p>
<pre><code class="language-python">from airflow.providers.amazon.aws.auth_manager.avp.entities import AvpEntities

AvpEntities.ASSET
</code></pre>
<p>is we use <code>binding</code>, it will be fixed as</p>
<pre><code class="language-python">from airflow.providers.amazon.aws.auth_manager.avp.entities import AvpEntities

AvpEntities
</code></pre>
<p>which is wrong</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-05-16 10:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:902 on 2025-05-16 10:44</div>
            <div class="timeline-body"><p>neat!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-05-19 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1002 on 2025-05-19 17:27</div>
            <div class="timeline-body"><p>Okay, I think that makes sense. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-05-19 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`airflow`] Update `AIR301`, `AIR311` rules with the latest Airflow implemnetation" to "[`airflow`] Update `AIR301` and `AIR311` with the latest Airflow implementations" by @ntBre on 2025-05-19 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-05-19 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-05-19 17:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:12:22 UTC
    </footer>
</body>
</html>
