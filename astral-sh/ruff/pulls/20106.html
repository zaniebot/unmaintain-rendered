<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Add U+061C to `PLE2502` - astral-sh/ruff #20106</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Add U+061C to <code>PLE2502</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20106">#20106</a>
        opened by <a href="https://github.com/kotx">@kotx</a>
        on 2025-08-26 21:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kotx">@kotx</a></div>
            <div class="timeline-body"><p>Resolves #20058</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-08-27 18:54</div>
            <div class="timeline-body"><p>Thank you!</p>
<p>I'm a bit conflicted because this clearly seems within the original intent of the rule, but a conservative reading of our <a href="https://docs.astral.sh/ruff/versioning/#version-changes">versioning guidelines</a> suggests that this needs to be a preview change since it increases the scope of a stable rule.</p>
<p>Would you mind making this a preview change? You can find examples of our preview checks in this file:</p>
<p>https://github.com/astral-sh/ruff/blob/e5e217fcd611ab24f516b2af4fa21e25eadc5645/crates/ruff_linter/src/preview.rs#L254-L257</p>
<p>and I'd recommend making a copy of the test function here with preview enabled (often called <code>preview_rules</code>):</p>
<p>https://github.com/astral-sh/ruff/blob/e5e217fcd611ab24f516b2af4fa21e25eadc5645/crates/ruff_linter/src/rules/pylint/mod.rs#L237</p>
<p>with just one <code>test_case</code> for <code>bidirectional_unicode.py</code>.</p>
<p>We'll probably want to move the character out of <code>BIDI_UNICODE</code> for now and combine it with the preview check, but what you have here is perfect once we stabilize the behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-08-27 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-08-27 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-27 19:08</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kotx">@kotx</a> on 2025-08-27 19:43</div>
            <div class="timeline-body"><p>@ntBre The guidelines say minor version is bumped when &quot;The scope of a stable rule is <em>significantly</em> increased&quot; (emphasis added). Is this significant enough to warrant a preview change? Will proceed if this is the case (thank you for the detailed instructions!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-27 21:06</div>
            <div class="timeline-body"><p>Yeah, that's why I was conflicted. I guess I consider it significant within the niche of the rule itself, and it just errs on the safe side to keep it in preview. It's also a departure from the upstream <code>pylint</code> rule based on a quick test I just did, which is another reason.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @kotx on 2025-08-28 02:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-28 15:48</div>
            <div class="timeline-body"><p>Thank you! This looks good overall. I did try to push one small patch to put the new test case back in <code>bidirectional_unicode.py</code> instead of a separate <code>_preview</code> file. That will make it a little easier to update things when we stabilize the change. But I couldn't push to the PR branch for some reason. Would you mind applying this patch or making similar changes? This is good to go otherwise.</p>
<details><summary>Patch</summary>
<p>

<pre><code class="language-diff">diff --git a/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode.py b/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode.py
index 25accb3aad..f72695d0c4 100644
--- a/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode.py
+++ b/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode.py
@@ -4,6 +4,9 @@ print(&quot;◊©◊ú◊ï◊ù‚Ä¨&quot;)
 # E2502
 example = &quot;x‚Äè&quot; * 100  #    &quot;‚Äèx&quot; is assigned
 
+# E2502
+another = &quot;xÿú&quot; * 50  #    &quot;ÿúx&quot; is assigned
+
 # E2502
 if access_level != &quot;none‚ÄÆ‚Å¶&quot;:  # Check if admin ‚Å©‚Å¶' and access_level != 'user
     print(&quot;You are an admin.&quot;)
diff --git a/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode_preview.py b/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode_preview.py
deleted file mode 100644
index 1445423c99..0000000000
--- a/crates/ruff_linter/resources/test/fixtures/pylint/bidirectional_unicode_preview.py
+++ /dev/null
@@ -1,11 +0,0 @@
-# E2502
-hello = &quot;xÿú&quot; * 50  #    &quot;ÿúx&quot; is assigned
-
-# OK
-print(&quot;\u061C&quot;)
-
-# OK
-print(&quot;\N{ARABIC LETTER MARK}&quot;)
-
-# OK
-print(&quot;Hello World&quot;)
diff --git a/crates/ruff_linter/src/rules/pylint/mod.rs b/crates/ruff_linter/src/rules/pylint/mod.rs
index 9d2d26072e..e181c0a146 100644
--- a/crates/ruff_linter/src/rules/pylint/mod.rs
+++ b/crates/ruff_linter/src/rules/pylint/mod.rs
@@ -252,12 +252,13 @@ mod tests {
         Ok(())
     }
 
-    #[test_case(
-        Rule::BidirectionalUnicode,
-        Path::new(&quot;bidirectional_unicode_preview.py&quot;)
-    )]
+    #[test_case(Rule::BidirectionalUnicode, Path::new(&quot;bidirectional_unicode.py&quot;))]
     fn preview_rules(rule_code: Rule, path: &amp;Path) -&gt; Result&lt;()&gt; {
-        let snapshot = format!(&quot;{}_{}&quot;, rule_code.noqa_code(), path.to_string_lossy());
+        let snapshot = format!(
+            &quot;preview__{}_{}&quot;,
+            rule_code.noqa_code(),
+            path.to_string_lossy()
+        );
         let diagnostics = test_path(
             Path::new(&quot;pylint&quot;).join(path).as_path(),
             &amp;LinterSettings {
diff --git a/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLE2502_bidirectional_unicode.py.snap b/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLE2502_bidirectional_unicode.py.snap
index 18356831d7..0d584e8108 100644
--- a/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLE2502_bidirectional_unicode.py.snap
+++ b/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLE2502_bidirectional_unicode.py.snap
@@ -22,21 +22,21 @@ PLE2502 Contains control characters that can permit obfuscated code
   |
 
 PLE2502 Contains control characters that can permit obfuscated code
- --&gt; bidirectional_unicode.py:8:1
-  |
-7 | # E2502
-8 | if access_level != &quot;none&quot;:  # Check if admin ' and access_level != 'user
-  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
-9 |     print(&quot;You are an admin.&quot;)
-  |
+  --&gt; bidirectional_unicode.py:11:1
+   |
+10 | # E2502
+11 | if access_level != &quot;none&quot;:  # Check if admin ' and access_level != 'user
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+12 |     print(&quot;You are an admin.&quot;)
+   |
 
 PLE2502 Contains control characters that can permit obfuscated code
-  --&gt; bidirectional_unicode.py:14:1
+  --&gt; bidirectional_unicode.py:17:1
    |
-12 | # E2502
-13 | def subtract_funds(account: str, amount: int):
-14 |     &quot;&quot;&quot;Subtract funds from bank account then &quot;&quot;&quot;
+15 | # E2502
+16 | def subtract_funds(account: str, amount: int):
+17 |     &quot;&quot;&quot;Subtract funds from bank account then &quot;&quot;&quot;
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
-15 |     return
-16 |     bank[account] -= amount
+18 |     return
+19 |     bank[account] -= amount
    |
diff --git a/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__preview__PLE2502_bidirectional_unicode.py.snap b/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__preview__PLE2502_bidirectional_unicode.py.snap
new file mode 100644
index 0000000000..4a1555ebe8
--- /dev/null
+++ b/crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__preview__PLE2502_bidirectional_unicode.py.snap
@@ -0,0 +1,52 @@
+---
+source: crates/ruff_linter/src/rules/pylint/mod.rs
+---
+PLE2502 Contains control characters that can permit obfuscated code
+ --&gt; bidirectional_unicode.py:2:1
+  |
+1 | # E2502
+2 | print(&quot;◊©◊ú◊ï◊ù&quot;)
+  | ^^^^^^^^^^^^^
+3 |
+4 | # E2502
+  |
+
+PLE2502 Contains control characters that can permit obfuscated code
+ --&gt; bidirectional_unicode.py:5:1
+  |
+4 | # E2502
+5 | example = &quot;x‚Äè&quot; * 100  #    &quot;‚Äèx&quot; is assigned
+  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+6 |
+7 | # E2502
+  |
+
+PLE2502 Contains control characters that can permit obfuscated code
+  --&gt; bidirectional_unicode.py:8:1
+   |
+ 7 | # E2502
+ 8 | another = &quot;xÿú&quot; * 50  #    &quot;ÿúx&quot; is assigned
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+ 9 |
+10 | # E2502
+   |
+
+PLE2502 Contains control characters that can permit obfuscated code
+  --&gt; bidirectional_unicode.py:11:1
+   |
+10 | # E2502
+11 | if access_level != &quot;none&quot;:  # Check if admin ' and access_level != 'user
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+12 |     print(&quot;You are an admin.&quot;)
+   |
+
+PLE2502 Contains control characters that can permit obfuscated code
+  --&gt; bidirectional_unicode.py:17:1
+   |
+15 | # E2502
+16 | def subtract_funds(account: str, amount: int):
+17 |     &quot;&quot;&quot;Subtract funds from bank account then &quot;&quot;&quot;
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+18 |     return
+19 |     bank[account] -= amount
+   |
</code></pre>
</p>
</details> 

<p>This is mostly restoring the test case you had before, which is the only reason I was going to push it quickly and then merge instead of bothering you again :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kotx">@kotx</a> on 2025-08-28 19:01</div>
            <div class="timeline-body"><p>@ntBre pushed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-08-28 19:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLE2502_bidirectional_unicode_preview.py.snap</code>:1 on 2025-08-28 19:34</div>
            <div class="timeline-body"><p>I think you might have to delete this now-unused snapshot to pass CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kotx">@kotx</a> reviewed on 2025-08-28 19:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kotx">@kotx</a> on <code>crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__PLE2502_bidirectional_unicode_preview.py.snap</code>:1 on 2025-08-28 19:42</div>
            <div class="timeline-body"><p>Fixed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-28 20:01</div>
            <div class="timeline-body"><p>Did you fix the clippy <a href="https://github.com/astral-sh/ruff/actions/runs/17305337828/job/49128933685">error</a> too? I think it just wanted you to combine your if branches with an <code>||</code>. I noticed that but wasn't going to comment since I think it's easier to read this way, but clippy wasn't so generous üòÜ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kotx">@kotx</a> on 2025-08-28 20:14</div>
            <div class="timeline-body"><p>You're right, I had totally missed that! Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-08-28 20:31</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add U+061C to PLE2502" to "[`pylint`] Add U+061C to `PLE2502`" by @ntBre on 2025-08-28 20:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-08-28 20:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-08-28 20:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:15:21 UTC
    </footer>
</body>
</html>
