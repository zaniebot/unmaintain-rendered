<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use insta_cmd - astral-sh/ruff #6737</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use insta_cmd</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6737">#6737</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-08-21 19:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-08-21 19:00</div>
            <div class="timeline-body"><p>I've experimented with using <a href="https://github.com/mitsuhiko/insta-cmd">insta_cmd</a> as a replacement for <a href="https://github.com/assert-rs/assert_cmd">assert_cmd</a>. I like it a lot, if we have consensus we want to do the switch i'll finish this PR. merging depends on the https://github.com/mitsuhiko/insta-cmd/issues/2 fix being shipped in a release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2023-08-21 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @konstin on 2023-08-21 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> removed by @konstin on 2023-08-21 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-21 19:35</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-22 01:23</div>
            <div class="timeline-body"><p>I support this change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/src/commands/snapshots/ruff_cli__commands__run__test__E902_E902.py.snap</code>:4 on 2023-08-22 06:02</div>
            <div class="timeline-body"><p>Can we remove the ASCII codes before printing to text?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-08-22 06:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-22 08:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/snapshots/ruff_cli__commands__run__test__E902_E902.py.snap</code>:4 on 2023-08-22 08:13</div>
            <div class="timeline-body"><p>yes this needs to be fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-22 09:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/tests/black_compatibility_test.rs</code>:180 on 2023-08-22 09:41</div>
            <div class="timeline-body"><p>i don't think this worked before</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-22 09:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/Cargo.toml</code>:74 on 2023-08-22 09:52</div>
            <div class="timeline-body"><p>Can you test that the colors still show when running <code>cargo run --bin ruff_cli</code> locally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-22 10:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/Cargo.toml</code>:74 on 2023-08-22 10:16</div>
            <div class="timeline-body"><p>yes, <code>cargo run -p ruff_cli -- --no-cache .</code> shows colors</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-22 10:16</div>
            <div class="timeline-body"><p>This will remain a draft until we have a new insta_cmd release</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-08-22 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @konstin on 2023-08-22 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-09-04 07:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-04 07:54</div>
            <div class="timeline-body"><p>Style question: Do we want snapshot files (<code>stdin_success</code>) or inline snapshots (<code>stdin_error</code>) for <code>ruff_cli</code>? I find inline snapshots easier to review, but we don't have any other inline insta tests yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-04 07:57</div>
            <div class="timeline-body"><blockquote>
<p>Style question: Do we want snapshot files (<code>stdin_success</code>) or inline snapshots (<code>stdin_error</code>) for <code>ruff_cli</code>? I find inline snapshots easier to review, but we don't have any other inline insta tests yet.</p>
</blockquote>
<p>I don't follow the question because I'm not familiar with the subject. Do you have an example?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-04 07:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/tests/integration_test.rs</code>:50 on 2023-09-04 07:58</div>
            <div class="timeline-body"><p>Is this an inline snapshot? I'm a huge fan of inline snapshots if the content isn't massive because I then don't need to switch between test and expected output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-04 08:56</div>
            <div class="timeline-body"><blockquote>
<p>I don't follow the question because I'm not familiar with the subject. Do you have an example?</p>
</blockquote>
<p>There are two possible styles we could use in the ruff_cli tests:</p>
<p>a) Test with snapshot file</p>
<p>https://github.com/astral-sh/ruff/blob/095e94008bad50f6693ef82d5f7945a565a70436/crates/ruff_cli/tests/integration_test.rs#L33-L38</p>
<p>https://github.com/astral-sh/ruff/blob/095e94008bad50f6693ef82d5f7945a565a70436/crates/ruff_cli/tests/snapshots/integration_test__stdin_success.snap#L1-L16</p>
<p>b) Test with inline snapshot</p>
<p>https://github.com/astral-sh/ruff/blob/095e94008bad50f6693ef82d5f7945a565a70436/crates/ruff_cli/tests/integration_test.rs#L40-L54</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-04 09:07</div>
            <div class="timeline-body"><p>Thanks! For me it depends on the size of the snapshot. I very much like inline snapshots for short assertions if they are easy to update (although I would have loved to have a more explicit API, like <code>assert_inline_cmd_snapshot</code> similar to Jest). But I would prefer external snapshots for long assertions (I don't know, like ~20 lines plus) because the file becomes massive.</p>
<p>What's your preference and why?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-04 09:44</div>
            <div class="timeline-body"><p>I prefer the inline snapshots because the external files make it hard to review what output belongs to what test and require a lot of context switches, plus the inline tests are more concise. I agree with the length issue; our CLI test should in most cases be short, with the exception of the json output and the rule explanation maybe which can remain snapshot file test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-04 10:47</div>
            <div class="timeline-body"><blockquote>
<p>I prefer the inline snapshots because the external files make it hard to review what output belongs to what test and require a lot of context switches, plus the inline tests are more concise. I agree with the length issue; our CLI test should in most cases be short, with the exception of the json output and the rule explanation maybe which can remain snapshot file test.</p>
</blockquote>
<p>I like that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-05 12:13</div>
            <div class="timeline-body"><p>merging with the current format, i can change the style in a follow up PR if required</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-09-05 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-09-05 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-05 12:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:46:15 UTC
    </footer>
</body>
</html>
