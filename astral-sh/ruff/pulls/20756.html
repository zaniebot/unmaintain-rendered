<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Disambiguate classes that live in different modules but have the same fully qualified names - astral-sh/ruff #20756</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Disambiguate classes that live in different modules but have the same fully qualified names</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20756">#20756</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-10-07 23:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>Even disambiguating classes using their fully qualified names is not enough for some diagnostics. We&#x27;ve seen real-world examples in the ecosystem (and <a href="https://github.com/astral-sh/ruff/pull/20368">astral-sh/ruff#20368</a> introduces some more!) where two types can be different, but can still have the same fully qualified name. In these cases, our disambiguation machinery needs to print the file path and line number of the class in order to disambiguate classes with similar names in our diagnostics.</p>
<p>Helps with <a href="https://github.com/astral-sh/ty/issues/1306">astral-sh/ty#1306</a></p>
Test Plan
<p>Mdtests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 23:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 23:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-07 23:34</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-07 23:35</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>bokeh (https://github.com/bokeh/bokeh)
- src/bokeh/model/model.py:496:16: error[invalid-return-type] Return type does not match returned value: expected `set[bokeh.model.model.Model]`, found `set[bokeh.model.model.Model]`
+ src/bokeh/model/model.py:496:16: error[invalid-return-type] Return type does not match returned value: expected `set[bokeh.model.model.Model @ src/bokeh/model/model.py:79]`, found `set[bokeh.model.model.Model @ src/bokeh/model/model.pyi:40]`

</code></pre>

No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-08 00:13</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:290 on 2025-10-08 04:41</div>
            <div class="timeline-body"><p>Why can&#x27;t we use <code>self.db</code> here anymore?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:333 on 2025-10-08 04:42</div>
            <div class="timeline-body"><p>I don&#x27;t think we should do this. We intentionally use platform specific path representations anywhere where we display a path. I don&#x27;t see why we should deviate from that here and it results in an inconsistent experience (I don&#x27;t think easier testing is a good enough reason)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:122 on 2025-10-08 04:45</div>
            <div class="timeline-body"><p>I&#x27;m not sure I fully understand this code but what if you have something like this</p>
<pre><code>class B:
	...

class A(B):
	...
</code></pre>
<p>both are defined in a pyi and in the py file and there&#x27;s a diagnostic involving <code>A</code>. Would it mean that we don&#x27;t show the file and line number for <code>A</code> because it has different parents?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-10-08 04:45</div>
            <div class="timeline-body"><p>Lovely :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/sharkdp">@sharkdp</a> removed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-08 06:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:290 on 2025-10-08 11:50</div>
            <div class="timeline-body"><p>Because it&#x27;s now a method on <code>ClassLiteral</code> (it used to be a method on <code>ClassDisplay</code>), and <code>ClassLiteral</code> doesn&#x27;t have a <code>self.db</code> field. It&#x27;s now a method on <code>ClassLiteral</code> rather than <code>ClassDisplay</code> because it makes it easier to reuse the method from other places in this module.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-08 11:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-08 11:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:333 on 2025-10-08 11:51</div>
            <div class="timeline-body"><p>Yeah, fair enough. I guess I have to go write some complicated regexes to get mdtest to work with these paths that are rendered differently on differnt platforms. So be it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-08 11:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:122 on 2025-10-08 11:56</div>
            <div class="timeline-body"><p>&quot;class parents&quot; is possibly a slightly confusing term here. (I didn&#x27;t add or name that method, in my defence ;)</p>
<p>For a class <code>A</code> in a module <code>foo.bar</code>, the &quot;parents&quot; of <code>A</code> will be <code>[&quot;foo&quot;, &quot;bar&quot;]</code>. For a class <code>B</code> defined in the scope of a method <code>m</code> of a class <code>D</code> in a module <code>foo.bar</code>, the &quot;parents&quot; of <code>B</code> will be <code>[&quot;foo&quot;, &quot;bar&quot;, &quot;D&quot;, &quot;&lt;locals of function &#x27;m&#x27;&gt;&quot;]</code>.</p>
<p>On <code>main</code>, we currently only disambiguate classes in our diagnostics if there are two classes with the same unqualified name appearing in the same diagnostic (e.g. &quot;expected <code>A</code>, got <code>A</code>&quot; is a terrible diagnostic message -- &quot;expected <code>foo.bar.A</code>, got <code>baz.A</code>&quot; is much better). This PR goes a step further by also comparing the <em>fully</em> qualified names of the classes: if using the fully qualified names would also not be sufficient to disambiguate the classes (because they have the same fully qualified names, as well as the same unqualified names!), we also display the file and line number when displaying the class.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-08 12:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:122 on 2025-10-08 12:35</div>
            <div class="timeline-body"><p>I renamed the method and added some docs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-08 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-10-08 17:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-08 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-08 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-08 17:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:19 UTC
    </footer>
</body>
</html>
