<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pyi`] Make example error out-of-the-box (`PYI007`, `PYI008`) - astral-sh/ruff #19103</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pyi</code>] Make example error out-of-the-box (<code>PYI007</code>, <code>PYI008</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19103">#19103</a>
        opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a>
        on 2025-07-02 21:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a></div>
            <div class="timeline-body">

Summary


<p>Part of #18972</p>
<p>Both in one PR since they are in the same file</p>
<p>No playground links since the playground does not support rules that only apply to PYI files</p>
PYI007
<p>This PR makes <a href="https://docs.astral.sh/ruff/rules/unrecognized-platform-check/#unrecognized-platform-check-pyi007">unrecognized-platform-check (PYI007)</a>&#x27;s example error out-of-the-box</p>
<p>Old example:</p>
<pre><code>PS ~\Desktop\New_folder\ruff&gt;echo @&quot;
</code></pre>
<pre><code>if sys.platform.startswith(&quot;linux&quot;):
    # Linux specific definitions
    ...
else:
    # Posix specific definitions
    ...
</code></pre>
<pre><code>&quot;@ | uvx ruff check --isolated --preview --select PYI007 --stdin-filename &quot;test.pyi&quot; -
</code></pre>
<pre><code>All checks passed!
</code></pre>
<p>New example:</p>
<pre><code>PS ~\Desktop\New_folder\ruff&gt;echo @&quot;
</code></pre>
<pre><code>import sys

if sys.platform is &quot;linux&quot;:
    # Linux specific definitions
    ...
else:
    # Posix specific definitions
    ...
</code></pre>
<pre><code>&quot;@ | uvx ruff check --isolated --preview --select PYI007 --stdin-filename &quot;test.pyi&quot; -
</code></pre>
<pre><code>test.pyi:3:4: PYI007 Unrecognized `sys.platform` check
  |
1 | import sys
2 |
3 | if sys.platform is &quot;linux&quot;:
  |    ^^^^^^^^^^^^^^^^^^^^^^^ PYI007
4 |     # Linux specific definitions
5 |     ...
  |

Found 1 error.
</code></pre>
<p>Imports were also added to the &quot;use instead&quot; section</p>
<blockquote>
<p>[!NOTE]
<code>PYI007</code> is really hard to trigger, it&#x27;s only specifically in the case of a comparison where the operator is not <code>!=</code> or <code>==</code>. The original example raises <a href="https://docs.astral.sh/ruff/rules/complex-if-statement-in-stub/#complex-if-statement-in-stub-pyi002">complex-if-statement-in-stub (PYI002)</a> with or without the <code>import sys</code></p>
</blockquote>
PYI008
<p>This PR makes <a href="https://docs.astral.sh/ruff/rules/unrecognized-platform-name/#unrecognized-platform-name-pyi008">unrecognized-platform-name (PYI008)</a>&#x27;s example error out-of-the-box</p>
<p>Old example:</p>
<pre><code>PS ~\Desktop\New_folder\ruff&gt;echo @&quot;
</code></pre>
<pre><code>if sys.platform == &quot;linus&quot;: ...
</code></pre>
<pre><code>&quot;@ | uvx ruff check --isolated --preview --select PYI008 --stdin-filename &quot;test.pyi&quot; -
</code></pre>
<pre><code>All checks passed!
</code></pre>
<p>New example:</p>
<pre><code>PS ~\Desktop\New_folder\ruff&gt;echo @&quot;
</code></pre>
<pre><code>import sys

if sys.platform == &quot;linus&quot;: ...
</code></pre>
<pre><code>&quot;@ | uvx ruff check --isolated --preview --select PYI008 --stdin-filename &quot;test.pyi&quot; -
</code></pre>
<pre><code>test.pyi:3:20: PYI008 Unrecognized platform `linus`
  |
1 | import sys
2 |
3 | if sys.platform == &quot;linus&quot;: ...
  |                    ^^^^^^^ PYI008
  |

Found 1 error.
</code></pre>
<p>Imports were also added to the &quot;use instead&quot; section</p>
<blockquote>
<p>[!NOTE]
The original example raises <code>PYI002</code> instead</p>
</blockquote>
Test Plan


<p>N/A, no functionality/tests affected</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-07-02 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-02 21:42</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/unrecognized_platform.rs</code>:26 on 2025-07-03 11:29</div>
            <div class="timeline-body"><p>this feels like it might be slightly more in keeping with the spirit of the rule, and also triggers PYI007:</p>
<pre><code>/// if sys.platform == &quot;xunil&quot;[::-1]:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-03 11:29</div>
            <div class="timeline-body"><p>thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-07 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-07 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-07 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-07 20:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:10 UTC
    </footer>
</body>
</html>
