<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Fix `RUF056` false negative on shadowed bindings - astral-sh/ruff #18861</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Fix <code>RUF056</code> false negative on shadowed bindings</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18861">#18861</a>
        opened by <a href="https://github.com/LaBatata101">@LaBatata101</a>
        on 2025-06-22 13:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-22 13:46</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR also affects <code>RUF051</code> and <code>SIM401</code> due to a change made to <code>is_known_to_be_of_type_dict</code> function.</p>
<p>Fixes #18855</p>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<p>Add regression test</p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-22 13:55</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+4 -0 violations, +0 -24 fixes in 5 projects; 50 projects unchanged)</p>
<details><summary><a href="https://github.com/DisnakeDev/disnake">DisnakeDev/disnake</a> (+0 -0 violations, +0 -6 fixes)</summary>
<p>

<pre>
+ <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L177'>disnake/ext/commands/cog.py:177:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L177'>disnake/ext/commands/cog.py:177:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L179'>disnake/ext/commands/cog.py:179:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L179'>disnake/ext/commands/cog.py:179:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L181'>disnake/ext/commands/cog.py:181:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L181'>disnake/ext/commands/cog.py:181:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+0 -0 violations, +0 -4 fixes)</summary>
<p>

<pre>
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/migrate.py#L134'>rasa/core/migrate.py:134:9:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/migrate.py#L134'>rasa/core/migrate.py:134:9:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/nlu/classifiers/diet_classifier.py#L781'>rasa/nlu/classifiers/diet_classifier.py:781:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/nlu/classifiers/diet_classifier.py#L781'>rasa/nlu/classifiers/diet_classifier.py:781:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+1 -0 violations, +0 -10 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L763'>devel-common/src/docs/build_docs.py:763:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L763'>devel-common/src/docs/build_docs.py:763:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L765'>devel-common/src/docs/build_docs.py:765:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L765'>devel-common/src/docs/build_docs.py:765:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/databricks/src/airflow/providers/databricks/operators/databricks_sql.py#L150'>providers/databricks/src/airflow/providers/databricks/operators/databricks_sql.py:150:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L664'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:664:17:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L664'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:664:17:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L678'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:678:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L678'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:678:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/task-sdk/src/airflow/sdk/bases/operator.py#L1276'>task-sdk/src/airflow/sdk/bases/operator.py:1276:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/task-sdk/src/airflow/sdk/bases/operator.py#L1276'>task-sdk/src/airflow/sdk/bases/operator.py:1276:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+0 -0 violations, +0 -4 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/dashboards/schemas.py#L184'>superset/dashboards/schemas.py:184:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/dashboards/schemas.py#L184'>superset/dashboards/schemas.py:184:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/db_engine_specs/gsheets.py#L194'>superset/db_engine_specs/gsheets.py:194:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/db_engine_specs/gsheets.py#L194'>superset/db_engine_specs/gsheets.py:194:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/astropy/astropy">astropy/astropy</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>

<pre>
+ <a href='https://github.com/astropy/astropy/blob/e48dd1c64b2433965363c7aa1d1ac19d70a93f28/astropy/io/fits/diff.py#L1379'>astropy/io/fits/diff.py:1379:17:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/astropy/astropy/blob/e48dd1c64b2433965363c7aa1d1ac19d70a93f28/astropy/io/fits/diff.py#L1381'>astropy/io/fits/diff.py:1381:17:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/astropy/astropy/blob/e48dd1c64b2433965363c7aa1d1ac19d70a93f28/astropy/table/serialize.py#L222'>astropy/table/serialize.py:222:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF051 | 28 | 4 | 0 | 0 | 24 |</p>
</p>
</details>

<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+5 -0 violations, +0 -24 fixes in 6 projects; 49 projects unchanged)</p>
<details><summary><a href="https://github.com/DisnakeDev/disnake">DisnakeDev/disnake</a> (+0 -0 violations, +0 -6 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L177'>disnake/ext/commands/cog.py:177:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L177'>disnake/ext/commands/cog.py:177:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L179'>disnake/ext/commands/cog.py:179:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L179'>disnake/ext/commands/cog.py:179:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L181'>disnake/ext/commands/cog.py:181:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/cog.py#L181'>disnake/ext/commands/cog.py:181:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+0 -0 violations, +0 -4 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/migrate.py#L134'>rasa/core/migrate.py:134:9:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/migrate.py#L134'>rasa/core/migrate.py:134:9:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/nlu/classifiers/diet_classifier.py#L781'>rasa/nlu/classifiers/diet_classifier.py:781:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/nlu/classifiers/diet_classifier.py#L781'>rasa/nlu/classifiers/diet_classifier.py:781:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+1 -0 violations, +0 -10 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L763'>devel-common/src/docs/build_docs.py:763:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L763'>devel-common/src/docs/build_docs.py:763:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L765'>devel-common/src/docs/build_docs.py:765:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/devel-common/src/docs/build_docs.py#L765'>devel-common/src/docs/build_docs.py:765:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/databricks/src/airflow/providers/databricks/operators/databricks_sql.py#L150'>providers/databricks/src/airflow/providers/databricks/operators/databricks_sql.py:150:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L664'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:664:17:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L664'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:664:17:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L678'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:678:21:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/providers/google/src/airflow/providers/google/cloud/operators/dataproc.py#L678'>providers/google/src/airflow/providers/google/cloud/operators/dataproc.py:678:21:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/task-sdk/src/airflow/sdk/bases/operator.py#L1276'>task-sdk/src/airflow/sdk/bases/operator.py:1276:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/airflow/blob/3df86abc26bbd4d5ebeb80a38e7267ea1007754f/task-sdk/src/airflow/sdk/bases/operator.py#L1276'>task-sdk/src/airflow/sdk/bases/operator.py:1276:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+0 -0 violations, +0 -4 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/dashboards/schemas.py#L184'>superset/dashboards/schemas.py:184:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/dashboards/schemas.py#L184'>superset/dashboards/schemas.py:184:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/db_engine_specs/gsheets.py#L194'>superset/db_engine_specs/gsheets.py:194:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
- <a href='https://github.com/apache/superset/blob/cd3191bb79e13eb7098f3ab36b37d53da05b4fa5/superset/db_engine_specs/gsheets.py#L194'>superset/db_engine_specs/gsheets.py:194:13:</a> RUF051 [*] Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/c406db2480d087e7d09e9b43e2fe118f0bd40933/zerver/lib/send_email.py#L219'>zerver/lib/send_email.py:219:51:</a> RUF056 [*] Avoid providing a falsy fallback to `dict.get()` in boolean test positions. The default fallback `None` is already falsy.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/astropy/astropy">astropy/astropy</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/astropy/astropy/blob/e48dd1c64b2433965363c7aa1d1ac19d70a93f28/astropy/io/fits/diff.py#L1379'>astropy/io/fits/diff.py:1379:17:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/astropy/astropy/blob/e48dd1c64b2433965363c7aa1d1ac19d70a93f28/astropy/io/fits/diff.py#L1381'>astropy/io/fits/diff.py:1381:17:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
+ <a href='https://github.com/astropy/astropy/blob/e48dd1c64b2433965363c7aa1d1ac19d70a93f28/astropy/table/serialize.py#L222'>astropy/table/serialize.py:222:13:</a> RUF051 Use `pop` instead of `key in dict` followed by `del dict[key]`
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF051 | 28 | 4 | 0 | 0 | 24 |
| RUF056 | 1 | 1 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-22 19:46</div>
            <div class="timeline-body"><p>Ecosystem changes seem correct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-23 08:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:50 on 2025-06-23 08:49</div>
            <div class="timeline-body"><p>It seems that this function is also used by other rules. Did you check if the change is correct for those rules too?</p>
<p>For example, I don't think this cange is safe for <code>if_key_in_dict_del</code>:</p>
<pre><code class="language-py">dictionary = {}
if key in dictionary:
		dictionary = {}
    del dictionary[key]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-23 13:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:50 on 2025-06-23 13:48</div>
            <div class="timeline-body"><p>It looks correct to me, all the changes in the ecosystem seems to be due to false negatives. For the example, you provided, <code>RUF051</code> is neither triggered in this branch nor in stable (<a href="https://play.ruff.rs/e81ce998-6703-475b-9950-e87ed5b73f18">playground</a>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @LaBatata101 on 2025-06-23 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-23 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:50 on 2025-06-23 14:54</div>
            <div class="timeline-body"><p>@InSyncWithFoo do you remember what the reason was that you used <code>only_binding</code> over <code>resolve_name</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-23 14:55</div>
            <div class="timeline-body"><p>We should update the summary to mention all affected rules. I'll try to do another review at a later point (in meetings now)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-23 15:55</div>
            <div class="timeline-body"><p>This is an example where Ruff now reports a false positive.</p>
<pre><code class="language-py">def demonstrate_false_positive():
    a = {}  # Initially a dict

    if True:
        a= set()
    else:
        a = {}


    # dict is now a string, should NOT trigger RUF056
    if a.get(key, False):  # But this DOES trigger - FALSE POSITIVE
        pass
</code></pre>
<p>I'm not quiet sure if this should prevent us from making this change because it's probably very unlikely in practice (because <code>get</code> will now also result in a runtime error) and I think most type checkers don't like redeclarations like this.</p>
<p>If we make the change, then all fixes should be marked as unsafe at least.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2025-06-23 17:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:50 on 2025-06-23 17:07</div>
            <div class="timeline-body"><p>@MichaReiser If I recall correctly, I thought it would be safer to make a conclusion when there is only one binding.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-23 21:54</div>
            <div class="timeline-body"><blockquote>
<p>This is an example where Ruff now reports a false positive.</p>
<pre><code class="language-python">def demonstrate_false_positive():
    a = {}  # Initially a dict

    if True:
        a= set()
    else:
        a = {}


    # dict is now a string, should NOT trigger RUF056
    if a.get(key, False):  # But this DOES trigger - FALSE POSITIVE
        pass
</code></pre>
<p>I'm not quiet sure if this should prevent us from making this change because it's probably very unlikely in practice (because <code>get</code> will now also result in a runtime error) and I think most type checkers don't like redeclarations like this.</p>
<p>If we make the change, then all fixes should be marked as unsafe at least.</p>
</blockquote>
<p>I made the fixes unsafe</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-24 06:12</div>
            <div class="timeline-body"><blockquote>
<p>I made the fixes unsafe</p>
</blockquote>
<p>The idea wasn't to make all fixes unsafe. I'd argue that this is a step back compared to today.</p>
<p>I think what we should do here instead is to either change <code>resolve_name</code> or change <code>only_binding</code> to allow redeclarations, but only if they are all in the same control flow path. I'm unsure how challenging this is or if it's even possible, as I'm not very familiar with Ruff's semantic model. While unlikely, I don't think that trading false positives with false negatives here is a good outcome. That's why I'll close this PR for now and raise this on the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-06-24 06:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:39:36 UTC
    </footer>
</body>
</html>
