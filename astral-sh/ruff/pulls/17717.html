<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`red-knot`] Allow subclasses of Any to be assignable to Callable types - astral-sh/ruff #17717</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>red-knot</code>] Allow subclasses of Any to be assignable to Callable types</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17717">#17717</a>
        opened by <a href="https://github.com/Kalmaegi">@Kalmaegi</a>
        on 2025-04-29 17:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes #17701. I'm uncertain whether this Python code needs to be added to the test cases. I'd be happy to supplement it if needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @Kalmaegi on 2025-04-29 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @Kalmaegi on 2025-04-29 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @Kalmaegi on 2025-04-29 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @Kalmaegi on 2025-04-29 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-29 17:06</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">starlette (https://github.com/encode/starlette)
- error[lint:invalid-argument-type] tests/test_templates.py:191:39: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Unknown | MagicMock`
- error[lint:invalid-argument-type] tests/test_templates.py:267:39: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Unknown | MagicMock`
- error[lint:invalid-argument-type] tests/test_templates.py:388:32: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Unknown | MagicMock`
- error[lint:invalid-argument-type] tests/test_templates.py:420:39: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Unknown | MagicMock`
- Found 181 diagnostics
+ Found 177 diagnostics

cki-lib (https://gitlab.com/cki-project/cki-lib)
- error[lint:invalid-assignment] tests/test_messagequeue.py:238:9: Object of type `Mock` is not assignable to attribute `_connect_no_keepalive` of type `(...) -&gt; Unknown`
- error[lint:invalid-assignment] tests/test_messagequeue.py:239:9: Object of type `Mock` is not assignable to attribute `_connect_and_keepalive` of type `(...) -&gt; Unknown`
- Found 174 diagnostics
+ Found 172 diagnostics

ignite (https://github.com/pytorch/ignite)
- error[lint:invalid-argument-type] tests/ignite/contrib/engines/test_tbptt.py:61:68: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/contrib/engines/test_tbptt.py:63:70: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_create_supervised.py:374:77: Argument to this function is incorrect: Expected `(Any, Any, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_create_supervised.py:410:73: Argument to this function is incorrect: Expected `(Any, Any, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_custom_events.py:89:55: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_custom_events.py:126:72: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:79:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:93:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:107:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:117:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:139:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:197:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:306:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:405:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:409:60: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:412:62: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:431:25: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_engine.py:848:52: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:32:21: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:180:43: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:181:47: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:182:45: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:183:45: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:184:41: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:185:45: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:186:41: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:187:41: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:193:47: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:197:45: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:198:45: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:199:41: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:341:48: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:349:41: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:350:37: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:351:37: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:352:41: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:375:54: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:378:33: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:383:33: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:443:21: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:451:21: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:468:21: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/engine/test_event_handlers.py:478:21: Argument to this function is incorrect: Expected `(Engine, Any, /) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/handlers/test_base_logger.py:238:28: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/handlers/test_base_logger.py:262:32: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/handlers/test_base_logger.py:268:32: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/handlers/test_base_logger.py:289:32: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- error[lint:invalid-argument-type] tests/ignite/handlers/test_base_logger.py:338:32: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `MagicMock`
- Found 2461 diagnostics
+ Found 2413 diagnostics

comtypes (https://github.com/enthought/comtypes)
- error[lint:invalid-argument-type] comtypes/test/test_inout_args.py:38:33: Argument to this function is incorrect: Expected `(...) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] comtypes/test/test_inout_args.py:83:33: Argument to this function is incorrect: Expected `(...) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] comtypes/test/test_inout_args.py:111:33: Argument to this function is incorrect: Expected `(...) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] comtypes/test/test_inout_args.py:138:33: Argument to this function is incorrect: Expected `(...) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] comtypes/test/test_inout_args.py:283:41: Argument to this function is incorrect: Expected `(...) -&gt; Any`, found `MagicMock`
- error[lint:invalid-argument-type] comtypes/test/test_inout_args.py:491:33: Argument to this function is incorrect: Expected `(...) -&gt; Any`, found `MagicMock`
- Found 705 diagnostics
+ Found 699 diagnostics

optuna (https://github.com/optuna/optuna)
- error[lint:invalid-argument-type] tests/samplers_tests/test_nsgaii.py:663:54: Argument to this function is incorrect: Expected `((...) -&gt; @Todo(specialized non-generic class)) | None`, found `MagicMock`
- Found 2136 diagnostics
+ Found 2135 diagnostics

vision (https://github.com/pytorch/vision)
- error[lint:invalid-argument-type] gallery/transforms/plot_cutmix_mixup.py:44:56: Argument to this function is incorrect: Expected `((...) -&gt; Unknown) | None`, found `Compose`
- Found 2251 diagnostics
+ Found 2250 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
- error[lint:invalid-argument-type] tests/appsec/iast/secure_marks/test_sanitizers.py:33:39: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/appsec/iast/secure_marks/test_sanitizers.py:58:29: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/appsec/iast/secure_marks/test_sanitizers.py:82:29: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/appsec/iast/secure_marks/test_validators.py:29:30: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/appsec/iast/secure_marks/test_validators.py:53:20: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/appsec/iast/secure_marks/test_validators.py:77:20: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- error[lint:invalid-argument-type] tests/appsec/iast/taint_sinks/test_command_injection.py:233:29: Argument to this function is incorrect: Expected `(...) -&gt; Unknown`, found `Mock`
- Found 6776 diagnostics
+ Found 6769 diagnostics

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2025-04-29 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2025-04-29 17:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:1291 on 2025-04-29 20:43</div>
            <div class="timeline-body"><p>The typing spec does not specify the behavior of subclassing <code>Any</code>, it just says it should be possible. And PEP 484 is a historical document, not an authoritative source (and it also doesn't mention subclassing <code>Any</code>). So there is no simple statement from authority that we are following here. Rather, we are following the &quot;core concepts&quot; section of the typing spec, and reasoning from that basis. The <code>Any</code> that is inherited can be &quot;materialized&quot; to any type, therefore <code>C</code> (where <code>class C(Any): ...</code>) is assignable to non-final types, because that <code>Any</code> could &quot;materialize&quot; to any non-final type. But it is not assignable to final types, because that <code>Any</code> cannot materialize to a final type (it would lead to an invalid inheritance from a final type.) Similar logic applies to literal types; there is no possible type that the <code>Any</code> in <code>class C(Any): ...</code> could materialize to, which would make an instance of <code>C</code> assignable, to, e.g., a <code>Literal</code> type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> requested changes on 2025-04-29 20:45</div>
            <div class="timeline-body"><p>Thanks for the PR!</p>
<p>As @sharkdp mentioned on the issue, there should be some exceptions here. One of those exceptions (subclass of <code>Any</code> can't be a subclass of a final class) we already have a test for, which is causing the tests to fail on this PR. I think all literal types should also be excluded (an instance of an <code>Any</code> subclass can't possibly inhabit <code>Literal[1]</code> or any other literal type).</p>
<p>I am not 100% sure that a separate catchall check at the top of the function will still be the clearest implementation here, once we account for all the exceptions. It depends on the balance of how many types we have to carve out of this catchall, vs how many we'd have to add a dedicated check for inheritance-from-Any to.</p>
<p>And yes, Python code samples should be added to the mdtests in this PR demonstrating the cases we want to handle that were not previously handled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Kalmaegi on 2025-04-30 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-04-30 08:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:1291 on 2025-04-30 08:21</div>
            <div class="timeline-body"><p>Thank you very much! I thought we needed to link a rule here XD.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Kalmaegi on 2025-04-30 10:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-30 10:58</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the PR!</p>
<p>As @sharkdp mentioned on the issue, there should be some exceptions here. One of those exceptions (subclass of <code>Any</code> can't be a subclass of a final class) we already have a test for, which is causing the tests to fail on this PR. I think all literal types should also be excluded (an instance of an <code>Any</code> subclass can't possibly inhabit <code>Literal[1]</code> or any other literal type).</p>
<p>I am not 100% sure that a separate catchall check at the top of the function will still be the clearest implementation here, once we account for all the exceptions. It depends on the balance of how many types we have to carve out of this catchall, vs how many we'd have to add a dedicated check for inheritance-from-Any to.</p>
<p>And yes, Python code samples should be added to the mdtests in this PR demonstrating the cases we want to handle that were not previously handled.</p>
</blockquote>
<p>I checked for existing tests and found that assignments from Any to both Final and Literal are already covered. I just added a test for the Callable case.
I haven’t found other cases that need special handling for now—just these two. Since we’re checking <code>self </code> at the start of the method, I think this placement works reasonably well XD</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-04-30 13:30</div>
            <div class="timeline-body"><blockquote>
<p>I checked for existing tests and found that assignments from Any to both Final and Literal are already covered.</p>
</blockquote>
<p>Where do we cover assignments to literals? It looks like it is possibly to assign to a literal on your branch. You will need a test that makes sure that instances of <code>Subclass(Any)</code> are not assignable to something like <code>Literal[1]</code>:</p>
<pre><code class="language-py">from typing import Any, Literal

class C(Any):
    pass

x: Literal[1] = C()  # this should fail, but does not on your branch.
</code></pre>
<p>As @carljm mentioned, it might be better to follow a &quot;opt in&quot; strategy, i.e. to handle special cases to the existing match statement. This way, we make sure that we exhaustively handle all type variants; and that we properly treat union and intersection types. For example:</p>
<pre><code class="language-py">from typing import final, Any

@final
class F1: ...

@final
class F2: ...

class Subclass(Any): ...

f: F1 | F2 = Subclass()  # this should fail, but does not on your branch.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-30 14:23</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>I checked for existing tests and found that assignments from Any to both Final and Literal are already covered.</p>
</blockquote>
<p>Where do we cover assignments to literals? It looks like it is possibly to assign to a literal on your branch. You will need a test that makes sure that instances of <code>Subclass(Any)</code> are not assignable to something like <code>Literal[1]</code>:</p>
<pre><code class="language-python">from typing import Any, Literal

class C(Any):
    pass

x: Literal[1] = C()  # this should fail, but does not on your branch.
</code></pre>
<p>As @carljm mentioned, it might be better to follow a &quot;opt in&quot; strategy, i.e. to handle special cases to the existing match statement. This way, we make sure that we exhaustively handle all type variants; and that we properly treat union and intersection types. For example:</p>
<pre><code class="language-python">from typing import final, Any

@final
class F1: ...

@final
class F2: ...

class Subclass(Any): ...

f: F1 | F2 = Subclass()  # this should fail, but does not on your branch.
</code></pre>
</blockquote>
<p>Ah, sorry about that—I misread the test. I’ll update the code accordingly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Kalmaegi on 2025-04-30 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-05-01 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2025-05-01 08:11</div>
            <div class="timeline-body"><p>@Kalmaegi I didn't really see any evidence in the newly added tests here that we need the catch-all case. In fact, there were some new ecosystem false-positives that looked incorrect (see below). It might be that we're still missing some cases where we should allow assignability, but until then, I'd rather be conservative and only allow assignability to <code>Callable</code> specifically. I changed the code to reflect this, hope that's fine for you. These false positives are now gone after the update:</p>
<pre><code class="language-diff">pytest-robotframework (https://github.com/detachhead/pytest-robotframework)
+ error[lint:invalid-argument-type] pytest_robotframework/_internal/pytest/plugin.py:374:26: Argument to this function is incorrect: Expected `PytestRuntestProtocolHooks`, found `PytestRuntestProtocolHooks`
- Found 322 diagnostics
+ Found 323 diagnostics

mypy-protobuf (https://github.com/dropbox/mypy-protobuf)
+ error[lint:invalid-argument-type] mypy_protobuf/main.py:134:64: Argument to this function is incorrect: Expected `FileDescriptorProto`, found `FileDescriptorProto`
+ error[lint:invalid-argument-type] mypy_protobuf/main.py:135:59: Argument to this function is incorrect: Expected `FileDescriptorProto`, found `FileDescriptorProto`
+ error[lint:invalid-argument-type] mypy_protobuf/main.py:941:22: Argument to this function is incorrect: Expected `FieldDescriptorProto`, found `FieldDescriptorProto`
</code></pre>
<p>Thank you for working on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`red-knot`] Allow subclasses of Any to be assignable to all types" to "[`red-knot`] Allow subclasses of Any to be assignable to Callable types" by @sharkdp on 2025-05-01 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-05-01 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-05-01 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-05-01 08:27</div>
            <div class="timeline-body"><blockquote>
<p>@Kalmaegi I didn't really see any evidence in the newly added tests here that we need the catch-all case. In fact, there were some new ecosystem false-positives that looked incorrect (see below). It might be that we're still missing some cases where we should allow assignability, but until then, I'd rather be conservative and only allow assignability to <code>Callable</code> specifically. I changed the code to reflect this, hope that's fine for you. These false positives are now gone after the update:</p>
<pre><code class="language-diff">pytest-robotframework (https://github.com/detachhead/pytest-robotframework)
+ error[lint:invalid-argument-type] pytest_robotframework/_internal/pytest/plugin.py:374:26: Argument to this function is incorrect: Expected `PytestRuntestProtocolHooks`, found `PytestRuntestProtocolHooks`
- Found 322 diagnostics
+ Found 323 diagnostics

mypy-protobuf (https://github.com/dropbox/mypy-protobuf)
+ error[lint:invalid-argument-type] mypy_protobuf/main.py:134:64: Argument to this function is incorrect: Expected `FileDescriptorProto`, found `FileDescriptorProto`
+ error[lint:invalid-argument-type] mypy_protobuf/main.py:135:59: Argument to this function is incorrect: Expected `FileDescriptorProto`, found `FileDescriptorProto`
+ error[lint:invalid-argument-type] mypy_protobuf/main.py:941:22: Argument to this function is incorrect: Expected `FieldDescriptorProto`, found `FieldDescriptorProto`
</code></pre>
<p>Thank you for working on this.</p>
</blockquote>
<p>@sharkdp Thank you so much for your help. I'm still familiarizing myself with the project structure, so some of my ideas might be a bit rudimentary.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:12:02 UTC
    </footer>
</body>
</html>
