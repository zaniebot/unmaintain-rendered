```yaml
number: 18374
title: "[ty] Improve tests for `site-packages` discovery"
type: pull_request
state: merged
author: AlexWaygood
labels:
  - internal
  - ty
assignees: []
merged: true
base: main
head: alex/site-packages-mdtest
created_at: 2025-05-29T16:24:24Z
updated_at: 2025-05-30T06:32:22Z
url: https://github.com/astral-sh/ruff/pull/18374
synced_at: 2026-01-10T18:45:04Z
```

# [ty] Improve tests for `site-packages` discovery

---

_Pull request opened by @AlexWaygood on 2025-05-29 16:24_

## Summary

- Convert tests demonstrating our resilience to malformed/absent `version` fields in `pyvenf.cfg` files to mdtests. Also make them more expansive.
- Convert the regression test I added in https://github.com/astral-sh/ruff/pull/18157 to an mdtest
- Add comments next to unit tests that cannot be converted to mdtests (but where it's not obvious why they can't) so I don't have to do this exercise again ðŸ˜„
- In `site_packages.rs`, factor out the logic for figuring out where we expect the system-installation `site-packages` to be. Currently we have the same logic twice.

## Test Plan

`cargo test -p ty_python_semantic`


---

_Review requested from @carljm by @AlexWaygood on 2025-05-29 16:24_

---

_Review requested from @sharkdp by @AlexWaygood on 2025-05-29 16:24_

---

_Review requested from @dcreager by @AlexWaygood on 2025-05-29 16:24_

---

_Label `internal` added by @AlexWaygood on 2025-05-29 16:24_

---

_Label `ty` added by @AlexWaygood on 2025-05-29 16:24_

---

_Comment by @github-actions[bot] on 2025-05-29 16:27_

<!-- generated-comment mypy_primer -->
## `mypy_primer` results
No ecosystem changes detected âœ…


---

_@MichaReiser approved on 2025-05-30 05:56_

---

_Merged by @AlexWaygood on 2025-05-30 06:32_

---

_Closed by @AlexWaygood on 2025-05-30 06:32_

---

_Branch deleted on 2025-05-30 06:32_

---
