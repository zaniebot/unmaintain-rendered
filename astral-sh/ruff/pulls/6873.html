<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unify line size settings between ruff and the formatter - astral-sh/ruff #6873</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unify line size settings between ruff and the formatter</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6873">#6873</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-08-25 13:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p><strong>Summary</strong> Previuosly, there had been <code>LineLength</code> in ruff and <code>LineWidth</code> in the formatter. <code>LineLength</code> was a lenient usize wrapper, while <code>LineWidth</code> was a strict u16. With the formatter moving into the ruff cli, we need to unify the two types. This PR makes both crates share a new <code>LineLength</code> type based on the previous ruff formatter type. It currently lives in <code>ruff_python_trivia</code> but i'm happy to move it wherever.</p>
<p>This is technically a breaking change because the line limit afterwards has a limit of 320 that it didn't have before.</p>
<p><strong>Test Plan</strong> No functional changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-25 13:27</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #6871</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6871" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #6873</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6873" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6873?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-08-25 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @konstin on 2023-08-25 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-25 14:06</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-08-25 15:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 15:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/add_rule.py</code>:143 on 2023-08-25 15:25</div>
            <div class="timeline-body"><p>that's the deviation from black we're introducing, i'm using it to confirm that it actually formats</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2023-08-25 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-25 15:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_trivia/src/line_width.rs</code>:14 on 2023-08-25 15:59</div>
            <div class="timeline-body"><p>My preference is to keep them separate. The <code>LineLength</code> in the settings builds our API to users (and the configuration), the one in the formatter doesn't need to have the same constraints. The way I would avoid too much duplicate code is to only implement the parsing on the <code>LineLength</code> in the settings crate (and remove it from <code>ruff_formatter</code>). It is no longer needed on the formatter because we can directly convert between the two without needing any parsing.</p>
<p>Edit: To extend on this. We'll likely need multiple types in the future to avoid otherwise unnecessary dependencies between crates. What I envision is that our settings represent the tool agnostic configuration (and can depend on all tools). However, what we pass to individual tools is only the resolved configuration relevant for that tool. This will lead to some code duplication but most of it are simple structs with very little behavior (cheap to maintain)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-25 16:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_trivia/src/line_width.rs</code>:14 on 2023-08-25 16:21</div>
            <div class="timeline-body"><p>I can make that change on Monday</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:54 on 2023-08-26 15:51</div>
            <div class="timeline-body"><p>It's unfortunate that <code>LineLength</code> cannot implement <code>Into&lt;LineWidth&gt;</code> because it doesn't depend on <code>ruff_formatter</code> but this isn't too bad.</p>
<p>We probably want to have an independent <code>LineLength</code> inside of ruff too, so that settings no longer need to depend on <code>ruff</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-26 15:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @MichaReiser on 2023-08-27 08:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Unify line size settings between ruff and the formatter" to "Unify line size settings between ruff and the formatter" by @MichaReiser on 2023-08-28 06:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-08-28 06:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-08-28 06:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-28 06:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:59:49 UTC
    </footer>
</body>
</html>
