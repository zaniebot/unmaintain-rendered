<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid flagging missing whitespace for decorators - astral-sh/ruff #4454</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid flagging missing whitespace for decorators</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4454">#4454</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-05-16 16:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 16:46</div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/token_kind.rs</code>:177 on 2023-05-16 16:50</div>
            <div class="timeline-body"><p>I think it would be good to instead create a new function or move this method to a function because the name unary is now misleading (@ isn't an unary operator)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 16:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 16:52</div>
            <div class="timeline-body"><p>This is a deviation from pycodestyle, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_ast/src/token_kind.rs</code>:177 on 2023-05-16 16:52</div>
            <div class="timeline-body"><p>Neither is <code>TokenKind::Star</code> in this context, no? E.g., is <code>*</code> a unary operator in <code>foo(*a)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-16 16:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 16:52</div>
            <div class="timeline-body"><p>This is a fix that corrects a deviation from pycodestyle. It brings our behavior in-line with pycodestyle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 16:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/token_kind.rs</code>:177 on 2023-05-16 16:52</div>
            <div class="timeline-body"><p>That's correct. The blame is on me ðŸ™ˆ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-16 16:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_ast/src/token_kind.rs</code>:177 on 2023-05-16 16:53</div>
            <div class="timeline-body"><p>Though I guess <code>**</code> is handled as a special-case in the rule (<code>if kind.is_unary() || kind == TokenKind::DoubleStar</code>) -- I'll just do that too for <code>@</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-16 16:54</div>
            <div class="timeline-body"><p>(Sorry for the wordy answer, I can't tell if you're asking whether the old or new behavior is the deviation.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-16 16:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_ast/src/token_kind.rs</code>:177 on 2023-05-16 16:55</div>
            <div class="timeline-body"><p>I removed star too .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 16:55</div>
            <div class="timeline-body"><p>An you explain the fix. It's unclear to me how it works. I would have expected that the @ always goes into the else branch that requires no space, and thus, doesn't create any diagnostics</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 16:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-16 16:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 16:59</div>
            <div class="timeline-body"><p><code>@</code> can be used as a binary operator in Python -- it represents matrix multiplication:</p>
<pre><code>#: E225
i = 1 @2
#: E225
i = 1@ 2
</code></pre>
<p>So equivalently to <code>*</code> or <code>+</code>, we need to detect whether we're seeing a decorator, or a binary operator.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-16 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 17:00</div>
            <div class="timeline-body"><p>I think in practice, for this particular piece of syntax, it will be a &quot;unary&quot; token IFF it's the first token in the logical line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 17:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 17:05</div>
            <div class="timeline-body"><p>Oh wow, I didn't know!</p>
<p>Hmm, I'm wondering right now if my refactored implementation misses the handling for <code>WS_OPTIONAL</code>. Because the <code>@</code> is part of the <code>is_whitespace</code> required, which returns <code>NeedsSpace::Yes</code> rather than setting it to <code>NeedsSpace::Optional</code></p>
<p>https://github.com/PyCQA/pycodestyle/blob/f6500e2170406b664a721b5e3a0f5d66bcb757e1/pycodestyle.py#L108</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-05-16 17:08</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     16.6Â±0.18ms     2.4 MB/sec    1.00     16.6Â±0.17ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.0Â±0.05ms     4.1 MB/sec    1.01      4.1Â±0.04ms     4.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    505.0Â±4.44Âµs     5.8 MB/sec    1.00    506.7Â±3.88Âµs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.9Â±0.07ms     3.7 MB/sec    1.01      6.9Â±0.06ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.00      8.0Â±0.07ms     5.1 MB/sec    1.00      8.0Â±0.08ms     5.1 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1726.9Â±20.76Âµs     9.6 MB/sec    1.01  1738.3Â±16.46Âµs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    192.9Â±2.70Âµs    15.3 MB/sec    1.02    195.8Â±2.63Âµs    15.1 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6Â±0.04ms     7.2 MB/sec    1.02      3.6Â±0.03ms     7.1 MB/sec
parser/large/dataset.py                    1.02      6.4Â±0.05ms     6.4 MB/sec    1.00      6.3Â±0.05ms     6.5 MB/sec
parser/numpy/ctypeslib.py                  1.01  1247.3Â±14.00Âµs    13.4 MB/sec    1.00  1233.7Â±14.80Âµs    13.5 MB/sec
parser/numpy/globals.py                    1.00    127.2Â±1.95Âµs    23.2 MB/sec    1.00    126.7Â±1.72Âµs    23.3 MB/sec
parser/pydantic/types.py                   1.01      2.7Â±0.03ms     9.4 MB/sec    1.00      2.7Â±0.03ms     9.5 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     18.8Â±0.34ms     2.2 MB/sec    1.00     18.7Â±0.35ms     2.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.03      4.7Â±0.13ms     3.6 MB/sec    1.00      4.5Â±0.12ms     3.7 MB/sec
linter/all-rules/numpy/globals.py          1.01   534.6Â±10.92Âµs     5.5 MB/sec    1.00   526.8Â±11.08Âµs     5.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.8Â±0.26ms     3.3 MB/sec    1.00      7.8Â±0.13ms     3.3 MB/sec
linter/default-rules/large/dataset.py      1.00      8.8Â±0.27ms     4.6 MB/sec    1.00      8.9Â±0.13ms     4.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1830.3Â±40.73Âµs     9.1 MB/sec    1.01  1840.5Â±24.71Âµs     9.0 MB/sec
linter/default-rules/numpy/globals.py      1.00    204.3Â±6.52Âµs    14.4 MB/sec    1.01    206.1Â±6.98Âµs    14.3 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.9Â±0.06ms     6.6 MB/sec    1.00      3.9Â±0.06ms     6.6 MB/sec
parser/large/dataset.py                    1.02      7.0Â±0.10ms     5.8 MB/sec    1.00      6.9Â±0.10ms     5.9 MB/sec
parser/numpy/ctypeslib.py                  1.02  1330.2Â±31.84Âµs    12.5 MB/sec    1.00  1301.7Â±28.86Âµs    12.8 MB/sec
parser/numpy/globals.py                    1.03    135.7Â±3.54Âµs    21.7 MB/sec    1.00    132.4Â±2.30Âµs    22.3 MB/sec
parser/pydantic/types.py                   1.02      3.0Â±0.04ms     8.6 MB/sec    1.00      2.9Â±0.04ms     8.8 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-16 17:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 17:14</div>
            <div class="timeline-body"><p>Hmm, I will take a look in a quick follow-up PR (or you can, if you're already working on it?).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-05-16 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-16 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-05-16 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 17:19</div>
            <div class="timeline-body"><p>I'm not and would appreciate it if you can have a look. I believe we're missing the whole optional branch because <code>pycodestyle</code> has no explicit handling of the <code>@</code> in the <code>unary</code> branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-16 17:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pycodestyle/rules/logical_lines/missing_whitespace_around_operator.rs</code>:96 on 2023-05-16 17:39</div>
            <div class="timeline-body"><p>Okay, I now remember briefly what is happening. The arithmetic and bitwise aren't optional. It's just that they are different rules (handled here https://github.com/PyCQA/pycodestyle/blob/f6500e2170406b664a721b5e3a0f5d66bcb757e1/pycodestyle.py#LL914C26-L920C66)</p>
<p>What I don't understand right now is why <code>@</code> would require any special treatment (more specifically, why we need where pycodestyle has none)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:50:42 UTC
    </footer>
</body>
</html>
