<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Read user configuration from `~/.config/ruff/ruff.toml` on macOS - astral-sh/ruff #11115</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Read user configuration from <code>~/.config/ruff/ruff.toml</code> on macOS</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11115">#11115</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-04-23 20:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR moves Ruff's user-specific configuration from <code>~/Library/Application Support/ruff/ruff.toml</code> to <code>~/.config/ruff/ruff.toml</code>.</p>
<p>Many other tools do this. On my machine alone: dagger, zed, gatsby, gh, wandb, etc.</p>
<p>I also polled Twitter and it won in a landslide:</p>
<p><img src="https://github.com/astral-sh/ruff/assets/1309177/d2840968-f310-4501-85a8-6994c4e7085b" alt="Screenshot 2024-04-23 at 4 07 19 PM" /></p>
<p>Let's ship this in v0.5.0, along with a deprecation warning (so we'll continue to respect <code>~/Library/Application Support/ruff/ruff.toml</code>, but log a warning).</p>
<p>Closes https://github.com/astral-sh/ruff/issues/10739.</p>
<h2>Test Plan</h2>
<ul>
<li>Created a file with an unused import.</li>
<li>Ran <code>cargo check foo.py</code>.</li>
<li>Verified that the deprecated configuration was loaded and respected, with a warning:</li>
</ul>
<pre><code>warning: Reading configuration from `~/Library/Application Support` is deprecated. Please move your configuration to `/Users/crmarsh/.config/ruff/ruff/ruff.toml`.
[2024-04-23][16:09:10][ruff::resolve][DEBUG] Using configuration file (via cwd) at: /Users/crmarsh/Library/Application Support/ruff/ruff.toml
</code></pre>
<ul>
<li>Created <code>~/.config/ruff/ruff.toml</code>.</li>
<li>Verified that the new configuration was loaded:</li>
</ul>
<pre><code>[2024-04-23][16:10:23][ruff::resolve][DEBUG] Using configuration file (via cwd) at: /Users/crmarsh/.config/ruff/ruff.toml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.5.0" by @charliermarsh on 2024-04-23 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @charliermarsh on 2024-04-23 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-04-23 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> removed by @charliermarsh on 2024-04-23 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-04-23 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2024-04-23 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-23 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>Cargo.toml</code>:63 on 2024-04-23 20:28</div>
            <div class="timeline-body"><p>@konstin suggested this crate, and it does what we want across Windows and Linux / macOS, but open to other suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-23 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>Cargo.toml</code>:61 on 2024-04-23 20:28</div>
            <div class="timeline-body"><p>We can remove <code>dirs</code> in a future release, but it stays around for now for backwards compatibility.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-23 20:45</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-24 07:28</div>
            <div class="timeline-body"><p>Sooo, we're doing twitter driven development now :joy:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-24 07:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-04-24 11:36</div>
            <div class="timeline-body"><p>I would change the reasoning/description: Follow the XDG specification on all Unix platforms. Ruff will now use the XDG config directory to read user-level configuration (default: <code>~/.config/ruff/ruff.toml</code>) over <code>Library/Application Support/ruff/ruff.toml</code> on macOS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-04-24 11:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-06-24 12:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/pyproject.rs</code>:117 on 2024-06-24 12:23</div>
            <div class="timeline-body"><p>Could we use https://docs.rs/etcetera/latest/etcetera/app_strategy/struct.Apple.html here and remove the <code>dirs</code> dependency (trading one dependency for another ;))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2024-06-24 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-06-24 12:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/pyproject.rs</code>:117 on 2024-06-24 12:38</div>
            <div class="timeline-body"><p>Okay I checked, we can use the <code>Apple</code> strategy but we need to use the <code>data_dir</code> to map to the <code>Application Support</code> folder (hardcoded).</p>
<p>The <code>etcetera</code> crate clearly documents that <code>config_dir</code> shouldn't be used on Mac when the config is user editable. I'm going to make this change.</p>
<p>From the <a href="https://crates.io/crates/dirs"><code>dirs</code> documentation</a>:</p>
<pre><code>// Mac: Some(/Users/Alice/Library/Application Support)
dirs::config_dir();
</code></pre>
<p>From the <a href="https://docs.rs/etcetera/latest/etcetera/base_strategy/struct.Apple.html"><code>etcetera</code> documentation</a>:</p>
<pre><code class="language-rust">assert_eq!(
    base_strategy.data_dir().strip_prefix(&amp;home_dir),
    Ok(Path::new(&quot;Library/Application Support/&quot;))
);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-24 12:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/pyproject.rs</code>:117 on 2024-06-24 12:50</div>
            <div class="timeline-body"><p>Interesting. Feel free to merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-06-24 12:50</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/charlie/xdg">CodSpeed Performance Report</a></h2>
<h3>Merging #11115 will <strong>degrade performances by 4.69%</strong></h3>
<p><sub>Comparing <code>charlie/xdg</code> (c4d143a) with <code>ruff-0.5</code> (9348821)</sub></p>
<h3>Summary</h3>
<p><code>❌ 1</code> regressions
<code>✅ 29</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/charlie/xdg">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>ruff-0.5</code> | <code>charlie/xdg</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>linter/default-rules[pydantic/types.py]</code> | 1.8 ms | 1.9 ms | -4.69% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-24 13:03</div>
            <div class="timeline-body"><p>I ran through the test plan and verified the deprecation message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-06-24 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-06-24 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-24 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @MichaReiser on 2024-06-24 13:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:03:57 UTC
    </footer>
</body>
</html>
