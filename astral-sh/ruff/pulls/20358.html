<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add GitHub output format - astral-sh/ruff #20358</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add GitHub output format</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20358">#20358</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-09-11 21:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-11 21:51</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR wires up the GitHub output format moved to <code>ruff_db</code> in #20320 to the ty CLI.</p>
<p>It's a bit smaller than the GitLab version (#20155) because some of the helpers were already in place, but I did factor out a few <code>DisplayDiagnosticConfig</code> constructor calls in Ruff. I also exposed the <code>GithubRenderer</code> and a wrapper <code>DisplayGithubDiagnostics</code> type because we needed a way to configure the program name displayed in the GitHub diagnostics. This was previously hard-coded to <code>Ruff</code>:</p>
<p><img width="675" height="247" alt="image" src="https://github.com/user-attachments/assets/592da860-d2f5-4abd-bc5a-66071d742509" /></p>
<p>Another option would be to drop the program name in the output format, but I think it can be helpful in workflows with multiple programs emitting annotations (such as Ruff and ty!)</p>
<h2>Test Plan</h2>
<p>New CLI test, and a manual test with <code>--config 'terminal.output-format = &quot;github&quot;'</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @ntBre on 2025-09-11 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @ntBre on 2025-09-11 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-11 21:53</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-11 21:56</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-11 22:22</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-09-11 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @ntBre on 2025-09-11 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ntBre on 2025-09-11 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @ntBre on 2025-09-11 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @ntBre on 2025-09-11 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__github__tests__output.snap</code>:7 on 2025-09-13 10:15</div>
            <div class="timeline-body"><p>Just confirming that this change is basically just a side effect of having ty as the default for <code>Program</code> and is not because there's someplace where the program is not being set correctly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1404 on 2025-09-13 10:19</div>
            <div class="timeline-body"><p>I think at this point, it might be useful to refactor this into a <code>new</code> method that takes in a <code>program: Program</code> as the sole parameter because there's no valid default value for this field and the caller should always provide the program for which this rendering is to be done for. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1317 on 2025-09-13 10:19</div>
            <div class="timeline-body"><p>Refer to my other comment, I'd probably remove the default value for this field.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-09-13 10:20</div>
            <div class="timeline-body"><p>This looks great!</p>
<p>I just have one minor concern, refer to inline comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1473 on 2025-09-15 11:41</div>
            <div class="timeline-body"><p>Nit: It would probably be fine to just use a <code>String</code> here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1318 on 2025-09-15 11:45</div>
            <div class="timeline-body"><p>I think I brought this up before and it isn't something that we need to change in this PR but I personally find it a bit difficult to reason about which settings are used for which output format (most settings are only used by one or very few formats).</p>
<p>The main reason I see today why we need a single <code>Config</code> struct is because <code>DisplayDiagnostics</code> matches on the output format, which I'm not sure we should keep because we also match over the output format in ruff's rendering code (meaning, we first match to create the generic configuration only to then match on the format again to call into specific renderers). To me, it would feel simpler to just have a single match in ruff's printer that calls the corresponding renderer directly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/github.rs</code>:21 on 2025-09-15 11:45</div>
            <div class="timeline-body"><p>I think we want to use the correct severity for ty diagnostics and not always default to error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-09-15 11:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-15 13:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1318 on 2025-09-15 13:35</div>
            <div class="timeline-body"><p>I thought eventually we would be able to hoist the <code>Config</code> out of the match in Ruff and have something like <code>DisplayDiagnosticsConfig::from(ruff_output_format)</code> and a single <code>DisplayDiagnostics</code> call, but I guess you're right. We may not want to port over all of the output formats, and some other logic is mixed in on the Ruff side, such as the <code>SHOW_FIX_SUMMARY</code> flag and writing of summary text. I can follow up on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__github__tests__output.snap</code>:7 on 2025-09-15 13:48</div>
            <div class="timeline-body"><p>Yes, that's right!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-15 13:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-15 13:56</div>
            <div class="timeline-body"><p>Thanks for the reviews! I pushed one commit to use the real severity. I think Dhruv's suggestions about not having a default <code>Program</code> make a lot of sense, but it looks like the <code>Program</code> config field can go away entirely with Micha's restructuring suggestion (we can just pass a <code>&amp;str</code> to <code>GithubRenderer::new</code> instead of a config).</p>
<p>I briefly started that refactor on this branch, but I think it would help to finally make the <code>DisplayDiagnostics</code> rendering take a <code>std::io::Write</code> instead of a <code>std::fmt::Write</code>, so it seems best to address these all at once in an immediate follow-up PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-09-17 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-17 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-17 13:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:40:53 UTC
    </footer>
</body>
</html>
