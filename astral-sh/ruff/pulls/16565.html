<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`isort`] Check full module path against project root(s) when categorizing first-party - astral-sh/ruff #16565</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>isort</code>] Check full module path against project root(s) when categorizing first-party</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16565">#16565</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-03-08 09:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>When attempting to determine whether <code>import foo.bar.baz</code> is a known first-party import relative to <a href="https://docs.astral.sh/ruff/settings/#src">user-provided source paths</a>, when <code>preview</code> is enabled we now check that <code>SRC/foo/bar/baz</code> is a directory or <code>SRC/foo/bar/baz.py</code> or <code>SRC/foo/bar/baz.pyi</code> exist.</p>
<p>Previously, we just checked the analogous thing for <code>SRC/foo</code>, but this can be misleading in situations with disjoint namespace packages that share a common base name (e.g. we may be working inside the namespace package <code>foo.buzz</code> and importing <code>foo.bar</code> from elsewhere).</p>
<p>Supersedes #12987
Closes #12984</p>
<h1>Testing</h1>
<p>We've added some unit tests displaying the different behavior in the function <code>match_sources</code> which implements this logic. In addition, here are the results of an ad-hoc, local test and comparison with <code>isort</code>. Notice that the preview behavior now coincides with <code>isort</code> - including the inconsistent classification of <code>from</code> imports.</p>
<p>(I've manually edited out some of the irrelevant logs and such in the outputs)</p>
<pre><code class="language-console">‚ùØ tree
.
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ src
    ‚îî‚îÄ‚îÄ mynamespace
        ‚îî‚îÄ‚îÄ subpackage_a
            ‚îî‚îÄ‚îÄ __init__.py

‚ùØ ../target/debug/ruff check src/mynamespace/subpackage_a/__init__.py --no-cache --select I -v
[2025-04-13][12:33:24][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'mynamespace.subpackage_b' as Known(FirstParty) (SourceMatch(&quot;/Users/dmbp/Documents/dev/contrib/ruff/exampleproj/src&quot;))
[2025-04-13][12:33:24][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'mynamespace' as Known(FirstParty) (SourceMatch(&quot;/Users/dmbp/Documents/dev/contrib/ruff/exampleproj/src&quot;))
All checks passed!

‚ùØ ../target/debug/ruff check src/mynamespace/subpackage_a/__init__.py --no-cache --select I -v --preview
[2025-04-13][12:33:30][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'mynamespace.subpackage_b' as Known(ThirdParty) (NoMatch)
[2025-04-13][12:33:30][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'mynamespace' as Known(FirstParty) (SourceMatch(&quot;/Users/dmbp/Documents/dev/contrib/ruff/exampleproj/src&quot;))
src/mynamespace/subpackage_a/__init__.py:1:1: I001 [*] Import block is un-sorted or un-formatted
  |
1 | / import mynamespace.subpackage_b
2 | | from mynamespace import subpackage_b
  | |____________________________________^ I001
  |
  = help: Organize imports

Found 1 error.
[*] 1 fixable with the `--fix` option.

‚ùØ uvx isort . --check --diff -v --src src

else-type place_module for mynamespace.subpackage_b returned THIRDPARTY
from-type place_module for mynamespace returned FIRSTPARTY
ERROR: /Users/dmbp/Documents/dev/contrib/ruff/exampleproj/src/mynamespace/subpackage_a/__init__.py Imports are incorrectly sorted and/or formatted.
else-type place_module for mynamespace.subpackage_b returned THIRDPARTY
from-type place_module for mynamespace returned FIRSTPARTY
--- /Users/dmbp/Documents/dev/contrib/ruff/exampleproj/src/mynamespace/subpackage_a/__init__.py:before	2025-04-13 12:29:49.050993
+++ /Users/dmbp/Documents/dev/contrib/ruff/exampleproj/src/mynamespace/subpackage_a/__init__.py:after	2025-04-13 12:36:28.299245
@@ -1,2 +1,3 @@
 import mynamespace.subpackage_b
+
 from mynamespace import subpackage_b
</code></pre>
<h1>Summary of Ecosystem Checks</h1>
<h2><code>snowcli</code></h2>
<p>These are all true positives! The package in this repo is <code>snowflake.cli</code>, and the ecosystem reports all have to do with importing third-party packages like <code>snowflake.snowpark</code> and <code>snowflake.connector</code>.</p>
<h2><code>airflow</code></h2>
<p>Also true positives: the dependency <code>docs.utils.conf_constants</code> appears in various places and is correctly identified as third-party, whereas before it was considered first-party because a <code>docs</code> folder.</p>
<h2><code>freedomofpress</code></h2>
<p>This is a false positive because this repo contains a Python file that does not have a <code>.py</code> suffix, but instead uses the shebang specification: https://github.com/freedomofpress/securedrop/blob/develop/journalist_gui/SecureDropUpdater</p>
<h2><code>mlflow</code></h2>
<p>The <em>change</em> is a true positive, but there is a leftover false positive. The change concerns two imports:</p>
<pre><code class="language-python">import docker
from docker.errors import APIError, BuildError
</code></pre>
<p>On <code>main</code>, these are <em>both</em> incorrectly identified as first-party due to a local folder named <code>docker</code>. In this PR with preview enabled, <code>docker.errors</code> is correctly identified as third-party, which causes a lint error to be emitted.</p>
<h2><code>pytest</code></h2>
<p>The problematic import here is <code>from py.path import error</code> which is, unfortunately, incorrectly labeled as third-party in <code>preview</code>. This is because it is not possible to know this import is first party from the file system alone! Indeed, <code>path</code> is actually a submodule of a module called <code>_py</code>, and then we have:</p>
<pre><code class="language-python"># src/py.py
import _pytest._py.path as path
</code></pre>
<p>If that's not bad enough, if you go to <code>src/_pytest/_py</code> you will not find <code>path/error</code> instead you will find <code>path.py</code> which has this line:</p>
<pre><code class="language-python"># path.py
from . import error
</code></pre>
<p>I don't think it's in scope to support something like that here! Maybe one day <code>ty</code> will power our import sorting!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dylwil3 on 2025-03-08 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dylwil3 on 2025-03-08 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @dylwil3 on 2025-03-08 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-08 09:50</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+22 -13 violations, +0 -0 fixes in 5 projects; 50 projects unchanged)</p>
<details><summary><a href="https://github.com/Snowflake-Labs/snowcli">Snowflake-Labs/snowcli</a> (+15 -13 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/scripts/cleanup.py#L14'>scripts/cleanup.py:14:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/connection/util.py#L15'>src/snowflake/cli/_plugins/connection/util.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/logs/manager.py#L1'>src/snowflake/cli/_plugins/logs/manager.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/logs/utils.py#L1'>src/snowflake/cli/_plugins/logs/utils.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/nativeapp/sf_sql_facade.py#L14'>src/snowflake/cli/_plugins/nativeapp/sf_sql_facade.py:14:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/project/manager.py#L14'>src/snowflake/cli/_plugins/project/manager.py:14:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/spcs/compute_pool/manager.py#L15'>src/snowflake/cli/_plugins/spcs/compute_pool/manager.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/spcs/image_repository/manager.py#L15'>src/snowflake/cli/_plugins/spcs/image_repository/manager.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/sql/manager.py#L15'>src/snowflake/cli/_plugins/sql/manager.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/sql/snowsql_commands.py#L1'>src/snowflake/cli/_plugins/sql/snowsql_commands.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/_plugins/stage/diff.py#L15'>src/snowflake/cli/_plugins/stage/diff.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/api/cli_global_context.py#L15'>src/snowflake/cli/api/cli_global_context.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/api/connections.py#L15'>src/snowflake/cli/api/connections.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/api/entities/common.py#L1'>src/snowflake/cli/api/entities/common.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/src/snowflake/cli/api/sql_execution.py#L15'>src/snowflake/cli/api/sql_execution.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/test_external_plugins/snowpark_hello_single_command/src/snowflakecli/test_plugins/snowpark_hello/manager.py#L14'>test_external_plugins/snowpark_hello_single_command/src/snowflakecli/test_plugins/snowpark_hello/manager.py:14:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests/nativeapp/utils.py#L15'>tests/nativeapp/utils.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests/test_data/projects/glob_patterns/main.py#L1'>tests/test_data/projects/glob_patterns/main.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests/test_data/projects/glob_patterns/src/app.py#L1'>tests/test_data/projects/glob_patterns/src/app.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests/test_data/projects/glob_patterns_zip/main.py#L1'>tests/test_data/projects/glob_patterns_zip/main.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests/test_data/projects/glob_patterns_zip/src/app.py#L1'>tests/test_data/projects/glob_patterns_zip/src/app.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests/test_main.py#L17'>tests/test_main.py:17:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests_integration/nativeapp/test_debug_mode.py#L15'>tests_integration/nativeapp/test_debug_mode.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests_integration/nativeapp/test_telemetry_errors.py#L14'>tests_integration/nativeapp/test_telemetry_errors.py:14:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests_integration/notebook/test_notebooks.py#L15'>tests_integration/notebook/test_notebooks.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests_integration/spcs/testing_utils/image_repository_utils.py#L1'>tests_integration/spcs/testing_utils/image_repository_utils.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests_integration/test_config.py#L15'>tests_integration/test_config.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
- <a href='https://github.com/Snowflake-Labs/snowcli/blob/7db8e8eed4bceb3e7aafd427e0294b18dfb24543/tests_integration/testing_utils/sql_utils.py#L15'>tests_integration/testing_utils/sql_utils.py:15:1:</a> I001 [*] Import block is un-sorted or un-formatted
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+4 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/3b80419e28a6ea95246b546460ffba78d09f3255/airflow-core/docs/conf.py#L21'>airflow-core/docs/conf.py:21:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/apache/airflow/blob/3b80419e28a6ea95246b546460ffba78d09f3255/chart/docs/conf.py#L21'>chart/docs/conf.py:21:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/apache/airflow/blob/3b80419e28a6ea95246b546460ffba78d09f3255/docker-stack-docs/conf.py#L21'>docker-stack-docs/conf.py:21:1:</a> I001 [*] Import block is un-sorted or un-formatted
+ <a href='https://github.com/apache/airflow/blob/3b80419e28a6ea95246b546460ffba78d09f3255/providers-summary-docs/conf.py#L21'>providers-summary-docs/conf.py:21:1:</a> I001 [*] Import block is un-sorted or un-formatted
</pre>

</p>
</details>
<details><summary><a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/freedomofpress/securedrop/blob/216a5ca20d9075ec8a0a53f3d6b017522961a039/journalist_gui/test_gui.py#L1'>journalist_gui/test_gui.py:1:1:</a> I001 [*] Import block is un-sorted or un-formatted
</pre>

</p>
</details>
<details><summary><a href="https://github.com/mlflow/mlflow">mlflow/mlflow</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/mlflow/mlflow/blob/cd5ad85d6ed18c7298135a2ead3534267ca18bb2/tests/projects/utils.py#L50'>tests/projects/utils.py:50:5:</a> I001 [*] Import block is un-sorted or un-formatted
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pytest-dev/pytest">pytest-dev/pytest</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pytest-dev/pytest/blob/89b84cb56295c46e1d8834b599e858bc65c15a5b/testing/_py/test_local.py#L2'>testing/_py/test_local.py:2:1:</a> I001 [*] Import block is un-sorted or un-formatted
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| I001 | 35 | 22 | 13 | 0 | 0 |</p>
</p>
</details>

<h3>Formatter (stable)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/mesonbuild/meson-python">mesonbuild/meson-python</a> (error)</summary>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to read tests/packages/symlinks/baz.py: No such file or directory (os error 2)
error: Failed to read tests/packages/symlinks/qux.py: No such file or directory (os error 2)
</code></pre>
</p>
</details>

<h3>Formatter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/mesonbuild/meson-python">mesonbuild/meson-python</a> (error)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to read tests/packages/symlinks/baz.py: No such file or directory (os error 2)
error: Failed to read tests/packages/symlinks/qux.py: No such file or directory (os error 2)
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`isort`] Only infer subpackages of namespace packages as first-party" to "[`isort`] Check full module path against project root(s) when categorizing first-party" by @dylwil3 on 2025-03-27 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-03-27 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @dylwil3 on 2025-03-27 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 12:18</div>
            <div class="timeline-body"><p>I think that PR slipped our attention last week. At least I didn't notice it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-01 12:19</div>
            <div class="timeline-body"><p>Did you click through the ecosystem checks?</p>
<p>I'm torn but I think this should be gated behind preview. The ecosystem fallouts are significant enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-04-01 12:20</div>
            <div class="timeline-body"><p>I haven't forgotten about this. I'm still waging war against my notification queue after the on-site üò¢</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-04-02 10:34</div>
            <div class="timeline-body"><blockquote>
<p>I think that PR slipped our attention last week. At least I didn't notice it :)
I haven't forgotten about this. I'm still waging war against my notification queue after the on-site üò¢</p>
</blockquote>
<p>No worries!</p>
<blockquote>
<p>Did you click through the ecosystem checks?</p>
</blockquote>
<p>I did quickly before, but going through them again I noticed two examples that need more investigation.</p>
<ul>
<li><code>freedomofpress</code> has a strange directory layout leading to a false positive, but it's possible that this is expected and they just need to specify a different <code>tool.ruff.src</code></li>
<li><code>mlflow</code> has a directory named <code>docker</code> with a Dockerfile in it... and imports a Python package named <code>docker</code>. This caused a <em>silent</em> error before where both imports <code>docker</code> and <code>docker.errors</code> were labeled as first party, but, since they were the only imports present, this had no effect on import sorting. But now we see that there is not <code>docker/errors</code> and label the second as third party.</li>
</ul>
<blockquote>
<p>I'm torn but I think this should be gated behind preview. The ecosystem fallouts are significant enough.</p>
</blockquote>
<p>Good point - I'll try to sort out the least ugly way to do that...</p>
<hr />
<p>Finally, I think I should try to fix the following limitation of the current approach. When we see</p>
<pre><code class="language-python">from foo import bar
</code></pre>
<p>the former approach would look for a <code>foo</code> directory or a <code>foo.py</code> file and call it a day. The present approach does the same - we don't look for a <code>bar</code> subdirectory because we don't know whether <code>bar</code> is supposed to be an imported <em>object</em> or <em>module</em>. In fact, one source of false positives in the ecosystem check, and the reason for introducing <code>.module_source</code>, was that <code>categorize</code> was being passed the fully qualified name <code>foo.bar</code>, failing to find <code>foo/bar.py</code> or <code>foo/bar/</code>, and then declaring the import third party. So I think I need to add some logic around this, otherwise we could get different categorizations for importing a submodule depending on whether you did</p>
<pre><code class="language-python">from foo import bar
</code></pre>
<p>or</p>
<pre><code class="language-python">import foo.bar as bar
</code></pre>
<p>I'm going to revert back to draft while I sort out all of the above. Sorry for the needless ping!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @dylwil3 on 2025-04-02 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dylwil3 on 2025-04-13 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-04-13 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-23 07:32</div>
            <div class="timeline-body"><p>I haven't looked at the code yet but could you update the PR summary or add a new comment that replies to your ecosystem findings and explains why we think they're correct. This will help us to remember the reasoning when writing the changelog in the next minor release</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/Cargo.toml</code>:79 on 2025-04-23 07:33</div>
            <div class="timeline-body"><pre><code class="language-suggestion">tempfile = { workspace = true }
</code></pre>
<p>I don't know why we use the long form, I think @charliermarsh migrated it some time ago but I prefer to keep using a consistent format.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-04-23 07:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs</code>:317 on 2025-04-23 07:37</div>
            <div class="timeline-body"><p>I'll use this PR to establish a new practice around preview checks that, hopefully, will make promoting preview features easier (and finding them!)</p>
<p>Let's create a <code>preview.rs</code> file similar to the one we have in the <a href="https://github.com/astral-sh/ruff/blob/1aad180aae84cd5d12d5a47c879183f559c871ed/crates/ruff_python_formatter/src/preview.rs#L1-L0">formatter</a> where we create a dedicated function for each preview functionality of the form:</p>
<pre><code>def fn is_xy_enabled(settings: &amp;LinterSettings) -&gt; bool {
    settings.preview.is_enabled()
}
</code></pre>
<p>This has the advantage that:</p>
<ol>
<li>It's easy to find all preview behavior and it gives us a place to document it (including instructions on what needs to be changed when promoting this behavior, e.g. update the documentations for x, y, z)</li>
<li>It's easy to promote the preview behavior. Simply delete the function and Rust will guide you to change all call sites</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs</code>:315 on 2025-04-23 07:39</div>
            <div class="timeline-body"><p>Nit: Maybe add a <code>QualifiedName.to_dotted_name()</code> function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/isort/mod.rs</code>:175 on 2025-04-23 07:40</div>
            <div class="timeline-body"><p>Would it make sense to move this check into <code>categorize_imports</code> instead of repeating it on every call site?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/isort/categorize.rs</code>:203 on 2025-04-23 07:45</div>
            <div class="timeline-body"><p>I find the early return here hard to understand. Why is it necessary? What I understand is that this can only be true if <code>name</code> is empty (has no components). Should we instead have a test if name is empty and early return in <code>match_sources</code>? Is it even possible that <code>name</code> is empty?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/faq.md</code>:315 on 2025-04-23 07:47</div>
            <div class="timeline-body"><p>Can we add some documentation explaining how to work around the case you found in the ecosystem check where a project has a <code>docker</code> folder but also uses the <code>docker</code> third party module?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-04-23 07:49</div>
            <div class="timeline-body"><p>Thanks to work on this. This looks good to me. I've a few smaller nit comments and I think we need to extend the documentation and the motivation for the change a bit before landing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-26 19:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs</code>:317 on 2025-04-26 19:39</div>
            <div class="timeline-body"><p>Is this the sort of thing you mean? https://github.com/astral-sh/ruff/pull/17646</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-26 20:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/faq.md</code>:315 on 2025-04-26 20:16</div>
            <div class="timeline-body"><p>I've added some... I'm tempted to say something like &quot;this is much less likely to happen if you use the <code>src</code> layout&quot; but I was worried it would come across a bit harsh.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-26 20:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/isort/categorize.rs</code>:203 on 2025-04-26 20:16</div>
            <div class="timeline-body"><p>I think it's written that way because <code>components()</code> doesn't have an <code>is_empty</code> method. in theory if <code>name</code> was, say &quot;.&quot; or &quot;....&quot; then this would trigger. I've turned it into an explicit check.</p>
<p>I think that won't ever actually happen by the time we get to <code>match_sources</code> because <code>categorize</code> has already handled the relative import case by then - but I didn't want this function to depend on that assumption.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-26 20:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs</code>:315 on 2025-04-26 20:17</div>
            <div class="timeline-body"><p><code>import.source_name()</code> is just a slice not a <code>QualifiedName</code>, and <code>import</code> is something implementing the <code>Import</code> trait - so it seems like it could be somewhat disruptive to put that method everywhere? But I'm happy to do ti if you still think I should!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-26 20:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/isort/categorize.rs</code>:203 on 2025-04-26 20:18</div>
            <div class="timeline-body"><p>Haha never mind it's clippy's fault:</p>
<pre><code>error: this block may be rewritten with the `?` operator
   --&gt; crates/ruff_linter/src/rules/isort/categorize.rs:204:13
    |
204 | /             if relative_path.components().next().is_none() {
205 | |                 return None;
206 | |             }
    | |_____________^ help: replace it with: `relative_path.components().next()?;`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-04-26 20:24</div>
            <div class="timeline-body"><p>Note: There have been some other issues raised in #10519 but I think they are orthogonal to this fix (the issues are present both before and after the current change) so it's worth exploring solutions in a followup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-04-27 09:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs</code>:317 on 2025-04-27 09:56</div>
            <div class="timeline-body"><p>Yes! I didn't expect that you would change all existing preview usages too. Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-28 21:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs</code>:317 on 2025-04-28 21:56</div>
            <div class="timeline-body"><p>Ok this is now gated using the new <code>preview</code> module!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2025-05-05 13:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 13:05</div>
            <div class="timeline-body"><p>I basically lost all context on this because the work I did on it was such a long time ago :-(</p>
<p>if @MichaReiser is happy with this, I'm happy with it! I trust both of you to get it right üòÉ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2025-05-05 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-05-05 16:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:10:33 UTC
    </footer>
</body>
</html>
