<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pyi`] Implement `redundant-none-literal` (`PYI061`) - astral-sh/ruff #14316</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pyi</code>] Implement <code>redundant-none-literal</code> (<code>PYI061</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14316">#14316</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2024-11-13 12:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a></div>
            <div class="timeline-body">

Summary
<p><code>Literal[None]</code> can be simplified into <code>None</code> in type annotations.</p>
<p>Surprising to see that this is not that rare:</p>
<ul>
<li>https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/chat_models/base.py#L54</li>
<li>https://github.com/sqlalchemy/sqlalchemy/blob/main/lib/sqlalchemy/sql/annotation.py#L69</li>
<li>https://github.com/jax-ml/jax/blob/main/jax/numpy/<strong>init</strong>.pyi#L961</li>
<li>https://github.com/huggingface/huggingface_hub/blob/main/src/huggingface_hub/inference/_common.py#L179</li>
</ul>
Test Plan
<p><code>cargo test</code></p>
<p>Reviewed all ecosystem results, and they are true positives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-13 12:41</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+14 -0 violations, +0 -0 fixes in 4 projects; 50 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/a85d94e6cdcd09efe93c3acee0b4ce5c9508bc23/airflow/models/dag.py#L1038">airflow/models/dag.py:1038:36:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
</pre>

</p>

<a href="https://github.com/latchbio/latch">latchbio/latch</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/latchbio/latch/blob/2c739ac73730d9e6de8b075e8c2c9bae26eca5c2/src/latch/types/metadata.py#L500">src/latch/types/metadata.py:500:45:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
</pre>

</p>

<a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/pandas-dev/pandas/blob/fae3e8034faf66eb8ef00bcbed73d48e4ef791d3/pandas/core/groupby/groupby.py#L4069">pandas/core/groupby/groupby.py:4069:39:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/pandas-dev/pandas/blob/fae3e8034faf66eb8ef00bcbed73d48e4ef791d3/pandas/core/groupby/indexing.py#L299">pandas/core/groupby/indexing.py:299:39:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/pandas-dev/pandas/blob/fae3e8034faf66eb8ef00bcbed73d48e4ef791d3/pandas/io/html.py#L1027">pandas/io/html.py:1027:28:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/pandas-dev/pandas/blob/fae3e8034faf66eb8ef00bcbed73d48e4ef791d3/pandas/io/html.py#L223">pandas/io/html.py:223:32:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+8 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/billing_page.py#L326">corporate/views/billing_page.py:326:24:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L158">corporate/views/remote_billing_page.py:158:26:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L159">corporate/views/remote_billing_page.py:159:42:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L160">corporate/views/remote_billing_page.py:160:48:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L678">corporate/views/remote_billing_page.py:678:26:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L679">corporate/views/remote_billing_page.py:679:42:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L680">corporate/views/remote_billing_page.py:680:48:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
+ <a href="https://github.com/zulip/zulip/blob/e172c717f7b622175dc3a93f16ecec6d2a4c3bee/corporate/views/remote_billing_page.py#L70">corporate/views/remote_billing_page.py:70:5:</a> PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PYI061 | 14 | 14 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-13 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-13 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-13 16:32</div>
            <div class="timeline-body"><p>Hi @sbrugman Thanks for another PR. It would help me review your PRs and avoid unnecessary work if you could fill out the Test plan. E.g. did you review the ecosystem changes already? If so, then I don&#x27;t have to do so :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-13 16:34</div>
            <div class="timeline-body"><p>Is there some previous issue where we discussed this rule? I&#x27;m asking because the rule itself would be a better fit for <code>flake8-annotations</code>... except that it isn&#x27;t an upstream rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-13 16:44</div>
            <div class="timeline-body"><p>@MichaReiser I&#x27;ve updated the test plan above, will do so for the other issues as well.</p>
<p>You&#x27;re right that these rules fit better in another category, but since there is no upstream rule I&#x27;ve placed them here.
I don&#x27;t think we should hold back on contributing new rules, especially with the new categorisation upcoming.</p>
<p>I&#x27;m ok moving the rules if preferred.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-13 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-13 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-13 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-13 21:49</div>
            <div class="timeline-body"><p>It looks like this could actually be in flake8-pyi:
https://github.com/PyCQA/flake8-pyi/blob/main/ERRORCODES.md#Y061</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-14 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`ruff`] Implement `redundant-none-literal` (`RUF037`)&quot; to &quot;[`flake8-pyi`] Implement `redundant-none-literal` (`PYI061`)&quot; by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-14 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-14 07:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-14 07:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-14 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_none_literal.rs</code>:109 on 2024-11-14 07:58</div>
            <div class="timeline-body"><p>I&#x27;m surprised that setting the same fix works :laughing:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-14 07:59</div>
            <div class="timeline-body"><p>LGTM, @AlexWaygood could you sign off the rule :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_none_literal.rs</code>:14 on 2024-11-14 13:07</div>
            <div class="timeline-body"><p>The motivation of this rule is purely for stylistic consistency: it doesn&#x27;t detect a bug or anything that&#x27;s incorrect, it just makes your annotations more concise and enforces a consistent style. I&#x27;d prefer to say that more explicitly here, like we do in <a href="https://github.com/PyCQA/flake8-pyi/blob/main/ERRORCODES.md#Y061">the flake8-pyi docs</a>:</p>
<pre><code>/// `Literal[None]` is legal as a type annotation, but means the same thing as `None`.
/// For stylistic consistency, prefer using `None`, which is more concise. 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_none_literal.rs</code>:22 on 2024-11-14 13:14</div>
            <div class="timeline-body"><pre><code>/// from typing import Literal
///
/// Literal[None]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_none_literal.rs</code>:30 on 2024-11-14 13:14</div>
            <div class="timeline-body"><pre><code>/// from typing import Literal
///
/// None
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/redundant_none_literal.rs</code>:32 on 2024-11-14 13:15</div>
            <div class="timeline-body"><p>nit: the name of this field feels a little opaque to me. Maybe something like <code>other_literal_elements_seen</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI061.py</code>:1 on 2024-11-14 13:18</div>
            <div class="timeline-body"><p>Could you add a test that does have a comment in the middle of a <code>Literal</code> slice, to show that this produces a fix that&#x27;s marked as unsafe?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-14 13:18</div>
            <div class="timeline-body"><p>Thanks! A couple of nitpicks, but looks great overall</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-14 15:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI061.py</code>:1 on 2024-11-14 15:06</div>
            <div class="timeline-body"><p>Good call. I realised that now it&#x27;s mapped to an existing <code>flake8-pyi</code> rule, I could also look at those test cases.</p>
<p>It turned out that <code>comment_ranges().has_comments()</code> also marks a fix as unsafe on a trailing comment, which is safe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI061.pyi</code>:37 on 2024-11-14 15:09</div>
            <div class="timeline-body"><pre><code>Literal[None]  # PYI061 None inside &quot;Literal[]&quot; expression. Replace with &quot;None&quot;
Literal[True, None]  # PYI061 None inside &quot;Literal[]&quot; expression. Replace with &quot;Literal[True] | None&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI061.pyi</code>:52 on 2024-11-14 15:10</div>
            <div class="timeline-body"><p>These test cases made sense in the context of flake8-pyi&#x27;s test suite, but I wonder if they make sense here? flake8-pyi has a pretty different code structure to us; in Ruff, we tend to consider each rule in isolation, rather than changing whether one diagnostic will be emitted depending on whether another diagnostic for a different rule is going to be emitted on the same expression</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-11-14 15:11</div>
            <div class="timeline-body"><p>Thank you! Looks great, just a couple of nits about the test remaining</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-16 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-16 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-16 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-16 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-18 08:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:08:26 UTC
    </footer>
</body>
</html>
