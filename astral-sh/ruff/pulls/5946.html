<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't format trailing comma for lambda arguments - astral-sh/ruff #5946</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't format trailing comma for lambda arguments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5946">#5946</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-07-21 11:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p><strong>Summary</strong> lambda arguments don't have parentheses, so they shouldn't get a magic trailing comma either. This fixes some unstable formatting</p>
<p><strong>Test Plan</strong> Added a regression test.</p>
<p>89 (from previously 145) instances of unstable formatting remaining.</p>
<pre><code>$ cargo run --bin ruff_dev --release -- format-dev --stability-check --error-file formatter-ecosystem-errors.txt --multi-project target/checkouts &gt; formatter-ecosystem-progress.txt
$ rg &quot;Unstable formatting&quot; target/formatter-ecosystem-errors.txt | wc -l
89
</code></pre>
<p>Closes #5892</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-21 11:12</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #5944</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5944" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #5946</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5946" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5946?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-21 11:43</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.3Â±0.04ms     4.4 MB/sec    1.00      9.3Â±0.12ms     4.4 MB/sec
formatter/numpy/ctypeslib.py               1.00  1864.6Â±11.02Âµs     8.9 MB/sec    1.00   1855.5Â±4.07Âµs     9.0 MB/sec
formatter/numpy/globals.py                 1.04    210.1Â±1.16Âµs    14.0 MB/sec    1.00    202.7Â±0.23Âµs    14.6 MB/sec
formatter/pydantic/types.py                1.00      4.0Â±0.01ms     6.4 MB/sec    1.00      4.0Â±0.01ms     6.4 MB/sec
linter/all-rules/large/dataset.py          1.00     12.9Â±0.06ms     3.1 MB/sec    1.01     13.1Â±0.04ms     3.1 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.3Â±0.01ms     5.1 MB/sec    1.01      3.3Â±0.01ms     5.0 MB/sec
linter/all-rules/numpy/globals.py          1.00    426.2Â±0.65Âµs     6.9 MB/sec    1.01    431.3Â±0.69Âµs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.8Â±0.01ms     4.4 MB/sec    1.01      5.9Â±0.03ms     4.3 MB/sec
linter/default-rules/large/dataset.py      1.00      6.6Â±0.02ms     6.2 MB/sec    1.02      6.8Â±0.01ms     6.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1411.2Â±1.49Âµs    11.8 MB/sec    1.02   1442.4Â±1.42Âµs    11.5 MB/sec
linter/default-rules/numpy/globals.py      1.00    155.2Â±0.50Âµs    19.0 MB/sec    1.02    158.7Â±0.28Âµs    18.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.0Â±0.01ms     8.5 MB/sec    1.02      3.1Â±0.01ms     8.3 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.1Â±0.12ms     3.7 MB/sec    1.01     11.1Â±0.12ms     3.7 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.2Â±0.06ms     7.7 MB/sec    1.00      2.2Â±0.03ms     7.6 MB/sec
formatter/numpy/globals.py                 1.00    243.0Â±4.84Âµs    12.1 MB/sec    1.02   248.0Â±11.21Âµs    11.9 MB/sec
formatter/pydantic/types.py                1.00      4.8Â±0.07ms     5.3 MB/sec    1.00      4.8Â±0.07ms     5.3 MB/sec
linter/all-rules/large/dataset.py          1.00     15.5Â±0.21ms     2.6 MB/sec    1.00     15.5Â±0.13ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.1Â±0.06ms     4.1 MB/sec    1.00      4.0Â±0.05ms     4.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    484.8Â±7.64Âµs     6.1 MB/sec    1.01    487.4Â±6.31Âµs     6.1 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.1Â±0.08ms     3.6 MB/sec    1.01      7.2Â±0.51ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.1Â±0.08ms     5.0 MB/sec    1.01      8.2Â±0.08ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1696.4Â±20.86Âµs     9.8 MB/sec    1.00  1690.0Â±15.49Âµs     9.9 MB/sec
linter/default-rules/numpy/globals.py      1.00    190.1Â±2.87Âµs    15.5 MB/sec    1.00    190.0Â±3.05Âµs    15.5 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.6Â±0.05ms     7.0 MB/sec    1.00      3.6Â±0.04ms     7.0 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:154 on 2023-07-21 11:51</div>
            <div class="timeline-body"><p>Unrelated to this PR. Do we need to test if the magic trailing comma option is enabled?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-21 11:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @konstin on 2023-07-21 13:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:154 on 2023-07-21 13:16</div>
            <div class="timeline-body"><p>lambdas seem to have their own trailing comma rules that are different magic trailing comma</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-21 13:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-21 13:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:154 on 2023-07-21 13:29</div>
            <div class="timeline-body"><p>That makes sense. But do we need to respect the magic trailing comma option for regular arguments?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-07-21 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-07-21 15:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-21 15:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:154 on 2023-07-21 15:51</div>
            <div class="timeline-body"><p>We do,</p>
<pre><code class="language-python">def f(a,): pass
</code></pre>
<p>gets formatted as</p>
<pre><code class="language-python">def f(
    a,
):
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @konstin on 2023-07-21 15:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-21 16:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:154 on 2023-07-21 16:40</div>
            <div class="timeline-body"><p>But do we need to respect <code>context.options.magic_trailing_comma()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-21 16:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-23 11:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:154 on 2023-07-23 11:32</div>
            <div class="timeline-body"><p>sorry i misunderstand what you were aiming at, yes, for functions (but not lambdas) we need to respect the magic trailing comma setting and we previously didn't. I've added this now in this PR because separating these two aspects doesn't make sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-23 12:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:162 on 2023-07-23 12:38</div>
            <div class="timeline-body"><p>I hope those comments are sufficiently clear</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-07-27 10:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-07-27 10:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-27 10:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:58:57 UTC
    </footer>
</body>
</html>
