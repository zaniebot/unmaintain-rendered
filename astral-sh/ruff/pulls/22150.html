<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Emit diagnostic on tuple subclasses that override `__eq__`, `__ne__` or `__bool__` methods - astral-sh/ruff #22150</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Emit diagnostic on tuple subclasses that override <code>__eq__</code>, <code>__ne__</code> or <code>__bool__</code> methods</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22150">#22150</a>
        opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a>
        on 2025-12-22 23:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-12-22 23:50</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Resolves https://github.com/astral-sh/ty/issues/2171</p>
<h2>Test Plan</h2>
<p>Add <code>unsafe_tuple_subclass.md</code> mdtest file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-22 23:52</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-22 23:52</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">parso (https://github.com/davidhalter/parso)
+ parso/utils.py:151:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ parso/utils.py:158:9: warning[unsafe-tuple-subclass] Unsafe override of method `__ne__` in a subclass of `tuple`
- Found 199 diagnostics
+ Found 201 diagnostics

pip (https://github.com/pypa/pip)
+ src/pip/_vendor/rich/segment.py:100:9: warning[unsafe-tuple-subclass] Unsafe override of method `__bool__` in a subclass of `tuple`
+ src/pip/_vendor/rich/text.py:60:9: warning[unsafe-tuple-subclass] Unsafe override of method `__bool__` in a subclass of `tuple`
- Found 611 diagnostics
+ Found 613 diagnostics

graphql-core (https://github.com/graphql-python/graphql-core)
+ src/graphql/language/location.py:36:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ src/graphql/language/location.py:41:9: warning[unsafe-tuple-subclass] Unsafe override of method `__ne__` in a subclass of `tuple`
- Found 423 diagnostics
+ Found 425 diagnostics

kopf (https://github.com/nolar/kopf)
+ kopf/_cogs/structs/diffs.py:53:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ kopf/_cogs/structs/diffs.py:59:9: warning[unsafe-tuple-subclass] Unsafe override of method `__ne__` in a subclass of `tuple`
- Found 267 diagnostics
+ Found 269 diagnostics

pylint (https://github.com/pycqa/pylint)
+ pylint/checkers/symilar.py:186:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
- Found 216 diagnostics
+ Found 217 diagnostics

rich (https://github.com/Textualize/rich)
+ rich/segment.py:100:9: warning[unsafe-tuple-subclass] Unsafe override of method `__bool__` in a subclass of `tuple`
+ rich/text.py:60:9: warning[unsafe-tuple-subclass] Unsafe override of method `__bool__` in a subclass of `tuple`
- Found 346 diagnostics
+ Found 348 diagnostics

dedupe (https://github.com/dedupeio/dedupe)
+ dedupe/predicates.py:356:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
- Found 56 diagnostics
+ Found 57 diagnostics

pydantic (https://github.com/pydantic/pydantic)
- pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`
+ pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, Divergent], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`

mypy (https://github.com/python/mypy)
+ mypy/typeshed/stdlib/importlib/metadata/__init__.pyi:89:13: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ mypy/typeshed/stdlib/unittest/mock.pyi:90:13: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ mypy/typeshed/stdlib/unittest/mock.pyi:91:13: warning[unsafe-tuple-subclass] Unsafe override of method `__ne__` in a subclass of `tuple`
+ mypy/typeshed/stdlib/unittest/mock.pyi:121:13: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ mypy/typeshed/stdlib/unittest/mock.pyi:122:13: warning[unsafe-tuple-subclass] Unsafe override of method `__ne__` in a subclass of `tuple`
- Found 1784 diagnostics
+ Found 1789 diagnostics

discord.py (https://github.com/Rapptz/discord.py)
+ discord/app_commands/namespace.py:53:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
- Found 555 diagnostics
+ Found 556 diagnostics

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
+ pymongo/message.py:1894:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ pymongo/message.py:1899:9: warning[unsafe-tuple-subclass] Unsafe override of method `__ne__` in a subclass of `tuple`
- Found 448 diagnostics
+ Found 450 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
+ src/prefect/utilities/annotations.py:33:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
- Found 5548 diagnostics
+ Found 5549 diagnostics

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
+ src/scikit_build_core/build/wheel.py:98:20: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- Found 47 diagnostics
+ Found 48 diagnostics

jax (https://github.com/google/jax)
+ jax/_src/pjit.py:129:7: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ jax/_src/tree_util.py:302:31: error[invalid-argument-type] Argument to bound method `register_node` is incorrect: Expected `(Hashable, Iterable[object], /) -&gt; T@register_pytree_node`, found `(_AuxData@register_pytree_node, _Children@register_pytree_node, /) -&gt; T@register_pytree_node`
+ jax/_src/tree_util.py:305:31: error[invalid-argument-type] Argument to bound method `register_node` is incorrect: Expected `(Hashable, Iterable[object], /) -&gt; T@register_pytree_node`, found `(_AuxData@register_pytree_node, _Children@register_pytree_node, /) -&gt; T@register_pytree_node`
+ jax/_src/tree_util.py:308:31: error[invalid-argument-type] Argument to bound method `register_node` is incorrect: Expected `(Hashable, Iterable[object], /) -&gt; T@register_pytree_node`, found `(_AuxData@register_pytree_node, _Children@register_pytree_node, /) -&gt; T@register_pytree_node`
- Found 2799 diagnostics
+ Found 2803 diagnostics

static-frame (https://github.com/static-frame/static-frame)
- static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Top[Bus[Any]] | TypeBlocks | Batch | ... omitted 6 union elements, object_]`
+ static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Top[Index[Any]] | Top[Series[Any, Any]] | TypeBlocks | ... omitted 6 union elements, object_]`
- static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 6 union elements, generic[object]]`
+ static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any] | TypeBlocks | Batch | ... omitted 6 union elements, generic[object]]`
- static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 7 union elements, generic[object]]`
+ static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Bottom[Series[Any, Any]] | TypeBlocks | Batch | ... omitted 7 union elements, generic[object]]`
- static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 6 union elements, generic[object]]`
+ static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Top[Yarn[Any]] | TypeBlocks | Batch | ... omitted 6 union elements, generic[object]]`

sympy (https://github.com/sympy/sympy)
+ sympy/combinatorics/free_groups.py:706:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
- Found 15407 diagnostics
+ Found 15408 diagnostics

rotki (https://github.com/rotki/rotki)
+ rotkehlchen/chain/bitcoin/xpub.py:53:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
+ rotkehlchen/types.py:399:9: warning[unsafe-tuple-subclass] Unsafe override of method `__eq__` in a subclass of `tuple`
- Found 2099 diagnostics
+ Found 2101 diagnostics

pandas-stubs (https://github.com/pandas-dev/pandas-stubs)
+ pandas-stubs/_typing.pyi:1232:16: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 5092 diagnostics
+ Found 5093 diagnostics

core (https://github.com/home-assistant/core)
- homeassistant/util/variance.py:47:12: error[invalid-return-type] Return type does not match returned value: expected `(**_P@ignore_variance) -&gt; _R@ignore_variance`, found `_Wrapped[_P@ignore_variance, _R@ignore_variance | int | float | datetime, _P@ignore_variance, _R@ignore_variance | int | float | datetime]`
- Found 14412 diagnostics
+ Found 14411 diagnostics

scipy (https://github.com/scipy/scipy)
- scipy/_lib/array_api_extra/src/array_api_extra/_lib/_at.py:300:17: warning[possibly-missing-attribute] Attribute `dtype` may be missing on object of type `int | slice[Any, Any, Any] | EllipsisType | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...]`
+ scipy/_lib/array_api_extra/src/array_api_extra/_lib/_at.py:300:17: warning[possibly-missing-attribute] Attribute `dtype` may be missing on object of type `int | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...] | slice[Any, Any, Any] | EllipsisType`
- scipy/_lib/array_api_extra/src/array_api_extra/_lib/_at.py:301:17: warning[possibly-missing-attribute] Attribute `shape` may be missing on object of type `int | slice[Any, Any, Any] | EllipsisType | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...]`
+ scipy/_lib/array_api_extra/src/array_api_extra/_lib/_at.py:301:17: warning[possibly-missing-attribute] Attribute `shape` may be missing on object of type `int | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...] | slice[Any, Any, Any] | EllipsisType`
- scipy/_lib/array_api_extra/src/array_api_extra/_lib/_at.py:308:25: error[invalid-argument-type] Argument to function `apply_where` is incorrect: Expected `Array`, found `int | slice[Any, Any, Any] | EllipsisType | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...]`
+ scipy/_lib/array_api_extra/src/array_api_extra/_lib/_at.py:308:25: error[invalid-argument-type] Argument to function `apply_where` is incorrect: Expected `Array`, found `int | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...] | slice[Any, Any, Any] | EllipsisType`


</code></pre>
</details>

<p>No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-12-23 00:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_python_semantic/src/types/diagnostic.rs</code>:4074 on 2025-12-23 00:17</div>
            <div class="timeline-body"><p>I'm not sure how much we should explain <em>why</em> it is unsafe to override certain methods.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @ntBre on 2025-12-23 00:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Emit diagnostic on tuple subclasses that override certain dunder methods" to "[ty] Warn on tuple subclasses that override certain dunder methods" by @MatthewMckee4 on 2025-12-23 00:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MatthewMckee4 on 2025-12-23 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MatthewMckee4 on 2025-12-23 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MatthewMckee4 on 2025-12-23 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MatthewMckee4 on 2025-12-23 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MatthewMckee4 on 2025-12-23 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @MatthewMckee4 on 2025-12-23 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/expression/boolean.md</code>:105 on 2025-12-23 10:38</div>
            <div class="timeline-body"><p>I don't think we need to complain about this one. I think we only need to complain about <code>__bool__</code> or <code>__len__</code> overrides if there's a possibility that this would violate our assumptions elsewhere.</p>
<p>This class is a subclass of a tuple with an unknown length, so we wouldn't ever make any assumptions about whether it's truthy or falsy anyway. So there's no unsoundness here, and there's no need for us to issue a diagnostic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/expression/len.md</code>:101 on 2025-12-23 10:39</div>
            <div class="timeline-body"><p>same here, I don't think we need to complain about this override. We wouldn't make any assumptions about the length or the truthiness of a <code>tuple[int, ...]</code> subtype, so this override is safe</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/expression/len.md</code>:107 on 2025-12-23 10:40</div>
            <div class="timeline-body"><p>I don't think we need to issue an <code>unsafe-tuple-subclass</code> diagnostic here if we'll naturally emit a Liskov diagnostic anyway. The two diagnostics are warning about essentially the same problem</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 10:48</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>This looks like it's a <em>bit</em> too trigger-happy right now:</p>
<ul>
<li>I don't think we ever need to issue <code>unsafe-tuple-subclass</code> for a <code>__len__</code> override. Our existing Liskov Substitution Principle check takes care of that for us</li>
<li>For other methods such as <code>__bool__</code>, <code>__eq__</code>, etc., I think we should avoid emitting this lint if the override would anyway cause us to emit a Liskov diagnostic. For something like this, we don't yet emit a Liskov diagnostic, but <a href="https://github.com/astral-sh/ty/issues/2156">we should</a>, so I don't think it should be covered by this check:<pre><code class="language-py">class Foo(tuple[int]):
    __len__ = None
</code></pre>
</li>
<li>I don't think we need to issue <code>unsafe-tuple-subclass</code> for a <code>__bool__</code> override unless we would infer the tuple superclass as either always-truthy or always-falsy. It's fine to override <code>__bool__</code> on a tuple subclass if the superclass has ambiguous truthiness; that won't violate any of our type-inference or narrowing assumptions elsewhere</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 10:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/overrides.rs</code>:461 on 2025-12-23 10:58</div>
            <div class="timeline-body"><p>other methods where we have special-cased behaviour for tuples are <code>__lt__</code>, <code>__le__</code>, <code>__gt__</code>, <code>__ge__</code>, <code>__ne__</code>, and <code>__contains__</code>. We probably need to ban overriding all of those too, unfortunately.</p>
<p>But as I said elsewhere, I think we can get rid of <code>__len__</code> from this list (it's already covered by our Liskov checks). And there are many situations where overriding <code>__bool__</code> on a tuple subclass should be fine.</p>
<p>We have very special-cased behaviour for <code>__getitem__</code>, but that should also be taken care of by our Liskov checks once we've finished implementing them, so I don't think you need to worry about <code>__getitem__</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 12:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/overrides.rs</code>:461 on 2025-12-23 12:20</div>
            <div class="timeline-body"><blockquote>
<p>We have very special-cased behaviour for <code>__getitem__</code>, but that should also be taken care of by our Liskov checks once we've finished implementing them, so I don't think you need to worry about <code>__getitem__</code>.</p>
</blockquote>
<p>Ah, no, we do need to ban <code>__getitem__</code> overrides too, I think, because our special casing for slices of tuples is not reflected in our synthesized <code>__getitem__</code> overloads for specialized tuples.</p>
<p>And there is maybe one <em>specific</em> kind of <code>__len__</code> override that we need to ban, which is <code>__len__</code> being overridden on subclasses of &quot;mixed&quot; tuples. <code>tuple[int, *tuple[int, ...]]</code> means &quot;a tuple of length at least one, but of potentially arbitrary length&quot;. Either of these overrides would not be caught by our Liskov checks, but both are clearly inconsistent with the tuple spec of the superclass:</p>
<pre><code class="language-py">from typing import Literal

class Foo(tuple[int, *tuple[int, ...]]):
    def __len__(self) -&gt; int:
        return 2

class Bar(tuple[int, *tuple[int, ...]):
    def __len__(self) -&gt; Literal[2]:
        return 2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-12-23 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_python_semantic/resources/mdtest/unsafe_tuple_subclass.md</code>:48 on 2025-12-23 15:48</div>
            <div class="timeline-body"><p>I assume this is okay as we shouldn't complain about unannotated methods?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 15:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/unsafe_tuple_subclass.md</code>:48 on 2025-12-23 15:58</div>
            <div class="timeline-body"><p>Yeah, I think that's fine. We also don't issue any diagnostics for Liskov violations that could come about as a result of an override where the subclass method isn't annotated. This is consistent with that behaviour</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-12-23 16:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_python_semantic/resources/mdtest/unsafe_tuple_subclass.md</code>:48 on 2025-12-23 16:00</div>
            <div class="timeline-body"><p>Okay thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-12-23 16:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_python_semantic/resources/mdtest/unsafe_tuple_subclass.md</code>:63 on 2025-12-23 16:00</div>
            <div class="timeline-body"><p>Should we emit a diagnostic here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 16:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/unsafe_tuple_subclass.md</code>:63 on 2025-12-23 16:03</div>
            <div class="timeline-body"><p>Yeah. We'd infer the superclass as <code>AlwaysFalsy</code>, but the subclass override obscures that. If it was annotated as returning <code>Literal[False]</code> that would be fine, but <code>bool</code> isn't consistent with an always-falsy tuple</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-12-23 16:04</div>
            <div class="timeline-body"><p>Perhaps this can be repurposed to just cover <code>__eq__</code>, <code>__ne__</code> and <code>__bool__</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-23 16:06</div>
            <div class="timeline-body"><blockquote>
<p>Perhaps this can be repurposed to just cover <code>__eq__</code>, <code>__ne__</code> and <code>__bool__</code></p>
</blockquote>
<p>Sure!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/unsafe_tuple_subclass.md</code>:1 on 2025-12-23 16:12</div>
            <div class="timeline-body"><p>Can you add a few tests for overrides of &quot;mixed&quot; tuples?</p>
<pre><code class="language-py">class A(tuple[int, *tuple[int, ...]]):
    def __bool__(self): ...  # fine

class B(tuple[int, *tuple[int, ...]]):
    def __bool__(self) -&gt; Literal[True]: ...  # fine

class C(tuple[int, *tuple[int, ...]]):
    def __bool__(self) -&gt; bool: ...  # error

class D(tuple[int, *tuple[int, ...]]):
    def __bool__(self) -&gt; Literal[False]: ...  # error

class A(tuple[*tuple[int, ...], str]):
    def __bool__(self): ...  # fine

class B(tuple[*tuple[int, ...], str]):
    def __bool__(self) -&gt; Literal[True]: ...  # fine

class C(tuple[*tuple[int, ...], str]):
    def __bool__(self) -&gt; bool: ...  # error

class D(tuple[*tuple[int, ...], str]):
    def __bool__(self) -&gt; Literal[False]: ...  # error
</code></pre>
<p>You'll need to add a block like this to those tests or you'll get spurious <code>invalid-syntax</code> errors issued:</p>
<pre><code class="language-md">```toml
[environment]
python-version = &quot;3.11&quot;
```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @MatthewMckee4 on 2025-12-23 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MatthewMckee4 on 2025-12-23 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-12-23 16:23</div>
            <div class="timeline-body"><p>I maybe need some advice on diagnostic messages</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Warn on tuple subclasses that override certain dunder methods" to "[ty] Emit diagnostic on tuple subclasses that override `__eq__`, `__ne__` or `__bool__` methods" by @MatthewMckee4 on 2025-12-23 16:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/class_base.rs</code>:418 on 2025-12-23 16:27</div>
            <div class="timeline-body"><p>we already have a <code>ClassBase::into_class()</code> method that does this, so I don't think this is necessary</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/diagnostic.rs</code>:3866 on 2025-12-23 16:28</div>
            <div class="timeline-body"><p>should this be a method on <code>FunctionType</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/overrides.rs</code>:551 on 2025-12-23 16:28</div>
            <div class="timeline-body"><p>this is a fantastic subdiagnostic, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-12-24 01:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-29 09:37</div>
            <div class="timeline-body"><p>Thank you for your work on this feature. Almost the entire team is out this week. It may take a few days before someone finds time to review your PR. Happy holidays.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:36:42 UTC
    </footer>
</body>
</html>
