<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `Expr::Name` checks to rules which use `is_logger_candidate`  - astral-sh/ruff #7521</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>Expr::Name</code> checks to rules which use <code>is_logger_candidate</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7521">#7521</a>
        opened by <a href="https://github.com/qdegraaf">@qdegraaf</a>
        on 2023-09-19 15:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qdegraaf">@qdegraaf</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Expands several rules to also check for <code>Expr::Name</code> values. As they would previously not consider:</p>
<pre><code class="language-python">from logging import error

error(&quot;foo&quot;)
</code></pre>
<p>as potential violations</p>
<pre><code class="language-python">import logging

logging.error(&quot;foo&quot;)
</code></pre>
<p>as potential violations leading to inconsistent behaviour.</p>
<p>The rules impacted are:</p>
<ul>
<li><code>BLE001</code></li>
<li><code>TRY400</code></li>
<li><code>TRY401</code></li>
<li><code>PLE1205</code></li>
<li><code>PLE1206</code></li>
<li><code>LOG007</code></li>
<li><code>G001</code>-<code>G004</code></li>
<li><code>G101</code></li>
<li><code>G201</code></li>
<li><code>G202</code></li>
</ul>
<h2>Test Plan</h2>
<p>Fixtures for all impacted rules expanded.</p>
<h2>Issue Link</h2>
<p>Refers: https://github.com/astral-sh/ruff/issues/7502</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-09-19 15:40</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-19 17:16</div>
            <div class="timeline-body"><p>So I think there's a little more to do here, but it's not clear from this PR because there's actually a bug in <code>LOG007</code>. Lemme push a fix, then I'll come back and explain.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-19 17:20</div>
            <div class="timeline-body"><p>Take a look at https://github.com/astral-sh/ruff/pull/7524. The issue is that we assume all calls are done on attributes, so that we can resolve the attribute to, e.g., <code>.exception</code> or <code>.info</code> or whatever. The same pattern is used in <code>logging_call</code>, in <code>crates/ruff/src/rules/flake8_logging_format/rules/logging_call.rs</code>.</p>
<p>We may want to change <code>logging_call</code> (and the <code>LOG007</code> method) to match on either name or attribute, and use separate paths to determine whether it's a logger and, if so, what the log level is. <em>Or</em> we could try changing <em>this</em> method to return the logging attribute too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @charliermarsh on 2023-09-19 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-09-19 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-09-19 22:27</div>
            <div class="timeline-body"><p>Interesting, thanks for the taking the time to explain and clarifying my previous misinterpretation of <code>is_logger_candidate</code> in <code>LOG007</code>. I'll have a look tomorrow if I can implement what you're suggesting. Will mark as draft until then.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @qdegraaf on 2023-09-19 22:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Expand `is_logger_candidate` to check `Expr::Name` expressions" to "Expand `LOG007` and `logging_call.rs` to check `Expr::Name` expressions" by @qdegraaf on 2023-09-20 14:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @qdegraaf on 2023-09-20 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-20 20:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:172 on 2023-09-20 20:29</div>
            <div class="timeline-body"><p>@qdegraaf - I changed this to always use <code>resolve_call_path</code>. I think we want this to <em>only</em> match the logging imports.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-20 20:35</div>
            <div class="timeline-body"><p>@qdegraaf - Nice! I think we need to extend this to a few more call sites. Are you able to look into the other usages of <code>is_logger_candidate</code> and apply similar logic? E.g., in <code>blind_except</code>, in the callers of <code>LoggerCandidateVisitor</code>, and so on. If not, we can merge and fix those up later, but I believe they do also need refinement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-09-20 22:17</div>
            <div class="timeline-body"><p>Happy to add those to the PR! Will have a look tomorrow</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Expand `LOG007` and `logging_call.rs` to check `Expr::Name` expressions" to "Add `Expr::Name` checks to rules which use `is_logger_candidate` " by @qdegraaf on 2023-09-21 11:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 00:01</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-09-27 00:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-09-27 00:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-27 00:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-27 09:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:24 UTC
    </footer>
</body>
</html>
