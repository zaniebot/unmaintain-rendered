```yaml
number: 5915
title: Document formatter error shrinking
type: pull_request
state: merged
author: konstin
labels:
  - formatter
assignees: []
merged: true
base: main
head: Don_t_minimize_files_that_don_t_match_in_the_first_place
created_at: 2023-07-20T10:52:09Z
updated_at: 2023-07-21T09:32:14Z
url: https://github.com/astral-sh/ruff/pull/5915
synced_at: 2026-01-12T03:30:22Z
```

# Document formatter error shrinking

---

_Pull request opened by @konstin on 2023-07-20 10:52_

## Summary

**Don't minimize files that don't match in the first place** This adds a sanity check to the minimizer script that the
input matches the condition (e.g. unstable formatting). Otherwise we run
through all checks with the whole file, which is extremely slow. It's
more reasonable for downstream usage to write an empty string to the
output file instead.


---

_Comment by @konstin on 2023-07-20 10:52_

Current dependencies on/for this PR:
* main
  * **PR #5915** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5915" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #5942** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5942" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #5943** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5943" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5915?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-07-20 11:23_

## PR Check Results
### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.8Â±0.02ms     4.2 MB/sec    1.00      9.8Â±0.02ms     4.2 MB/sec
formatter/numpy/ctypeslib.py               1.00   1905.9Â±5.15Âµs     8.7 MB/sec    1.00   1903.8Â±5.67Âµs     8.7 MB/sec
formatter/numpy/globals.py                 1.00    207.6Â±0.83Âµs    14.2 MB/sec    1.00    208.1Â±0.28Âµs    14.2 MB/sec
formatter/pydantic/types.py                1.00      4.2Â±0.01ms     6.1 MB/sec    1.00      4.2Â±0.00ms     6.0 MB/sec
linter/all-rules/large/dataset.py          1.00     13.5Â±0.06ms     3.0 MB/sec    1.00     13.5Â±0.04ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      3.4Â±0.00ms     4.8 MB/sec    1.00      3.4Â±0.01ms     4.9 MB/sec
linter/all-rules/numpy/globals.py          1.01    370.9Â±0.81Âµs     8.0 MB/sec    1.00    368.7Â±1.00Âµs     8.0 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1Â±0.01ms     4.2 MB/sec    1.00      6.1Â±0.01ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.00      7.0Â±0.01ms     5.8 MB/sec    1.00      7.0Â±0.01ms     5.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1428.5Â±3.26Âµs    11.7 MB/sec    1.00   1422.1Â±3.82Âµs    11.7 MB/sec
linter/default-rules/numpy/globals.py      1.00    149.5Â±0.20Âµs    19.7 MB/sec    1.00    149.4Â±0.24Âµs    19.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.1Â±0.00ms     8.2 MB/sec    1.00      3.1Â±0.01ms     8.2 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.0Â±0.07ms     4.5 MB/sec    1.05      9.4Â±0.11ms     4.3 MB/sec
formatter/numpy/ctypeslib.py               1.00  1724.6Â±13.52Âµs     9.7 MB/sec    1.03  1777.1Â±10.01Âµs     9.4 MB/sec
formatter/numpy/globals.py                 1.00    179.4Â±2.87Âµs    16.4 MB/sec    1.04    186.4Â±4.49Âµs    15.8 MB/sec
formatter/pydantic/types.py                1.00      3.8Â±0.03ms     6.7 MB/sec    1.04      4.0Â±0.04ms     6.4 MB/sec
linter/all-rules/large/dataset.py          1.00     12.4Â±0.09ms     3.3 MB/sec    1.00     12.3Â±0.07ms     3.3 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.2Â±0.01ms     5.2 MB/sec    1.01      3.2Â±0.01ms     5.2 MB/sec
linter/all-rules/numpy/globals.py          1.00    338.1Â±3.74Âµs     8.7 MB/sec    1.01    342.1Â±2.32Âµs     8.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.5Â±0.03ms     4.6 MB/sec    1.00      5.5Â±0.03ms     4.6 MB/sec
linter/default-rules/large/dataset.py      1.00      6.6Â±0.04ms     6.2 MB/sec    1.01      6.7Â±0.03ms     6.1 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1303.7Â±7.40Âµs    12.8 MB/sec    1.02   1323.3Â±7.28Âµs    12.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    138.8Â±1.04Âµs    21.3 MB/sec    1.02    142.1Â±1.60Âµs    20.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.9Â±0.01ms     8.9 MB/sec    1.01      2.9Â±0.02ms     8.8 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review requested from @MichaReiser by @konstin on 2023-07-20 15:21_

---

_Label `formatter` added by @konstin on 2023-07-20 16:09_

---

_@MichaReiser approved on 2023-07-21 06:52_

The documentation looks good to me. 

I recommend splitting the other changes into their own PR, it otherwise reading the Git history. Who would suspect that a PR *Documenting...* contains code changes. 

Splitting should be straightforward as each change is its own commit. You can split the PR by using `gt branch split`

---

_Comment by @konstin on 2023-07-21 08:20_

> I recommend splitting the other changes into their own PR, it otherwise reading the Git history. Who would suspect that a PR Documenting... contains code changes.

good point, i didn't consider how this interacts with squash merge

---

_Merged by @konstin on 2023-07-21 09:32_

---

_Closed by @konstin on 2023-07-21 09:32_

---

_Branch deleted on 2023-07-21 09:32_

---
