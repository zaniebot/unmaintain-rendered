<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rename `custom-typeshed-dir`, `target-version` and `current-directory` CLI options - astral-sh/ruff #14930</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rename <code>custom-typeshed-dir</code>, <code>target-version</code> and <code>current-directory</code> CLI options</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14930">#14930</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-12-12 10:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-12 10:45</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR renames the <code>--custom-typeshed-dir</code>, <code>target-version</code>, and <code>--current-directory</code> cli options to <code>--typeshed</code>, <code>--python-version</code>, and <code>--project</code> as discussed in the CLI proposal document.
I added aliases for <code>--target-version</code> (for Ruff compat) and <code>--custom-typeshed-dir</code> (for Alex)</p>
<h2>Test Plan</h2>
<p>Long help</p>
<pre><code>An extremely fast Python type checker.

Usage: red_knot [OPTIONS] [COMMAND]

Commands:
  server  Start the language server
  help    Print this message or the help of the given subcommand(s)

Options:
      --project &lt;PROJECT&gt;
          Run the command within the given project directory.
          
          All `pyproject.toml` files will be discovered by walking up the directory tree from the project root, as will the project's virtual environment (`.venv`).
          
          Other command-line arguments (such as relative paths) will be resolved relative to the current working directory.&quot;#,

      --venv-path &lt;PATH&gt;
          Path to the virtual environment the project uses.
          
          If provided, red-knot will use the `site-packages` directory of this virtual environment to resolve type information for the project's third-party dependencies.

      --typeshed-path &lt;PATH&gt;
          Custom directory to use for stdlib typeshed stubs

      --extra-search-path &lt;PATH&gt;
          Additional path to use as a module-resolution source (can be passed multiple times)

      --python-version &lt;VERSION&gt;
          Python version to assume when resolving types
          
          [possible values: 3.7, 3.8, 3.9, 3.10, 3.11, 3.12, 3.13]

  -v, --verbose...
          Use verbose output (or `-vv` and `-vvv` for more verbose output)

  -W, --watch
          Run in watch mode by re-running whenever files change

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
<p>Short help</p>
<pre><code>An extremely fast Python type checker.

Usage: red_knot [OPTIONS] [COMMAND]

Commands:
  server  Start the language server
  help    Print this message or the help of the given subcommand(s)

Options:
      --project &lt;PROJECT&gt;         Run the command within the given project directory
      --venv-path &lt;PATH&gt;          Path to the virtual environment the project uses
      --typeshed-path &lt;PATH&gt;      Custom directory to use for stdlib typeshed stubs
      --extra-search-path &lt;PATH&gt;  Additional path to use as a module-resolution source (can be passed multiple times)
      --python-version &lt;VERSION&gt;  Python version to assume when resolving types [possible values: 3.7, 3.8, 3.9, 3.10, 3.11, 3.12, 3.13]
  -v, --verbose...                Use verbose output (or `-vv` and `-vvv` for more verbose output)
  -W, --watch                     Run in watch mode by re-running whenever files change
  -h, --help                      Print help (see more with '--help')
  -V, --version                   Print version

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2024-12-12 10:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2024-12-12 10:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2024-12-12 10:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-12-12 10:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/python_version.rs</code>:32 on 2024-12-12 10:49</div>
            <div class="timeline-body"><p>should these all now be dotted?</p>
<pre><code class="language-suggestion">            Self::Py37 =&gt; &quot;3.7&quot;,
            Self::Py38 =&gt; &quot;3.8&quot;,
            Self::Py39 =&gt; &quot;3.9&quot;,
            Self::Py310 =&gt; &quot;3.10&quot;,
            Self::Py311 =&gt; &quot;3.11&quot;,
            Self::Py312 =&gt; &quot;3.12&quot;,
            Self::Py313 =&gt; &quot;3.13&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/main.rs</code>:54 on 2024-12-12 10:50</div>
            <div class="timeline-body"><p>...maybe <code>typeshed_dir</code> rather than <code>typeshed_path</code>, since it has to be a directory? But I don't care too deeply, you can disregard this if you diagree :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/main.rs</code>:39 on 2024-12-12 10:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// All `pyproject.toml` files will be discovered by walking up the directory tree from the project root,
    /// as will the project's virtual environment (`.venv`) unless the `venv-path` option is set.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-12 10:51</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-12-12 10:54</div>
            <div class="timeline-body"><p>I still sorta think <code>target-version</code> more clearly communicates that it should be the Python version your code is <em>targeting</em>, which could be very different to the Python version you're using for local development. But hopefully we can address this with excellent documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-12 12:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/main.rs</code>:54 on 2024-12-12 12:04</div>
            <div class="timeline-body"><p>I'm not very opinionated on this. I'd prefer using <code>typeshed_directory</code> but that's somewhat long. It would also require renaming <code>extra_search_path</code> to <code>extra_search_directory</code> which I think we should not, because it then no longer maps to <code>sys.path</code></p>
<p>That's why I'm leaning towards keeping it as is or even just remove the <code>path</code> entirely and just call it <code>typeshed</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/main.rs</code>:54 on 2024-12-12 12:06</div>
            <div class="timeline-body"><p><code>--typeshed</code> seems quite nice to me. I agree it's good to keep it concise</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-12 12:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-12 12:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/main.rs</code>:54 on 2024-12-12 12:08</div>
            <div class="timeline-body"><p>Okay, I'll then go with typeshed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/main.rs</code>:42 on 2024-12-12 12:37</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// Other command-line arguments (such as relative paths) will be resolved relative to the current working directory.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-12 12:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2024-12-12 14:23</div>
            <div class="timeline-body"><p>Thanks. Looking forward to not having to type <code>--current-directory</code> anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot/src/main.rs</code>:39 on 2024-12-12 17:09</div>
            <div class="timeline-body"><p>I find this sentence a bit confusing, because I thought the &quot;project root&quot; is defined by where we find a <code>pyproject.toml</code> with the expected config? It might make more sense to phrase this as something like &quot;The project root will be found relative to this directory&quot; or similar?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-12-12 17:10</div>
            <div class="timeline-body"><p>LGTM!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-12-12 17:12</div>
            <div class="timeline-body"><blockquote>
<p>I still sorta think <code>target-version</code> more clearly communicates that it should be the Python version your code is <em>targeting</em>, which could be very different to the Python version you're using for local development.</p>
</blockquote>
<p>I don't really understand what the potential confusion would be here. If you are telling a type checker your Python version, what other meaning could there be other than &quot;please typecheck this code for this Python version&quot;? I guess I think it's totally fine if in simple cases people conflate &quot;Python version I'm using for local development&quot; with &quot;Python version this code is targeting&quot; -- wanting to separate those is a slightly more advanced use case, and I just don't see any likelihood that anyone who needs to separate those two will be confused about what <code>--python-version</code> means.</p>
<p>It has the advantage over <code>--target-version</code> that it's clear about &quot;version of what&quot; -- it's not a red-knot version, for example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-12 17:29</div>
            <div class="timeline-body"><p>I obviously don't feel strongly, or I wouldn't have approved!</p>
<blockquote>
<p>I don't really understand what the potential confusion would be here. If you are telling a type checker your Python version, what other meaning could there be other than &quot;please typecheck this code for this Python version&quot;?</p>
</blockquote>
<p>I think the potential confusion is that users might not understand why we need this setting at all, given that we already have other settings with which users can tell us the path to the Python executable they're using. If we always used the local-development Python version, we could just derive this information from that setting. But the setting doesn't really mean that at all -- it means &quot;Please specify the minimum Python version you expect this app/library to support (not necessarily the version you're running now), so that we can emit errors if you use features or syntax that are newer than that&quot;.</p>
<blockquote>
<p>I guess I think it's totally fine if in simple cases people conflate &quot;Python version I'm using for local development&quot; with &quot;Python version this code is targeting&quot; -- wanting to separate those is a slightly more advanced use case, and I just don't see any likelihood that anyone who needs to separate those two will be confused about what <code>--python-version</code> means.</p>
</blockquote>
<p>It doesn't seem that advanced to me. I think it's pretty common that people use a version of Python for local development that's pretty new, but they nonetheless want it to be possible for other users to run their code on older versions of Python as well.</p>
<blockquote>
<p>It has the advantage over <code>--target-version</code> that it's clear about &quot;version of what&quot; -- it's not a red-knot version, for example.</p>
</blockquote>
<p>I can't recall anybody ever being confused about this on the Ruff issue tracker (Ruff uses <code>--target-version</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-12-12 17:44</div>
            <div class="timeline-body"><p>I don't feel strongly either! Just trying to understand what I'm missing about the arguments either way.</p>
<blockquote>
<p>users might not understand why we need this setting at all, given that we already have other settings with which users can tell us the path to the Python executable they're using.</p>
</blockquote>
<p>One answer to this is simply that we want to avoid <em>running</em> a Python executable as part of red-knot settings derivation, and there's no reliable way to tell the Python version of a Python executable without running it. If there were such a way, I would be in favor of automatically deriving the Python version from the executable we are pointed towards, if a version isn't explicitly given.</p>
<blockquote>
<p>I can't recall anybody ever being confused about this on the Ruff issue tracker (Ruff uses <code>--target-version</code>)</p>
</blockquote>
<p>Fair enough, that's certainly relevant data!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-13 08:14</div>
            <div class="timeline-body"><blockquote>
<p>It doesn't seem that advanced to me. I think it's pretty common that people use a version of Python for local development that's pretty new, but they nonetheless want it to be possible for other users to run their code on older versions of Python as well.</p>
</blockquote>
<p>I expect most users will use <code>requires-python</code> in their <code>pyproject.toml. The main use case that I see for </code>-python-version`, and why it's important as a CLI flag, is to check a library for newer Python versions than their minimal supported Python version.</p>
<p>I also think that the setting is clearer because it is in <code>environment.python-version</code>. The main motivation for renaming is to be consistent with uv.</p>
<p>However, I agree with you that we could also just derive the value from <code>--venv-path</code> (to be renamed to <code>--python</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-13 08:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/main.rs</code>:39 on 2024-12-13 08:14</div>
            <div class="timeline-body"><p>Fair, I copied this from uv ðŸ¤­</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-12-13 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-12-13 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-13 08:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:42:56 UTC
    </footer>
</body>
</html>
