<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Extend airflow context parameter check for `BaseOperator.execute` (`AIR302`) - astral-sh/ruff #15713</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Extend airflow context parameter check for <code>BaseOperator.execute</code> (<code>AIR302</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15713">#15713</a>
        opened by <a href="https://github.com/Lee-W">@Lee-W</a>
        on 2025-01-24 10:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-01-24 10:45</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<ul>
<li>feat<ul>
<li>add is_execute_method_inherits_from_airflow_operator for checking the removed context key in the execute method</li>
</ul>
</li>
<li>refactor: rename<ul>
<li>is_airflow_task as is_airflow_task_function_def</li>
<li>in_airflow_task as in_airflow_task_function_def</li>
<li>removed_in_3 as airflow_3_removal_expr</li>
<li>removed_in_3_function_def as airflow_3_removal_function_def</li>
</ul>
</li>
<li>test:<ul>
<li>reorganize test cases</li>
</ul>
</li>
</ul>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>a test fixture has been updated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-01-24 10:49</div>
            <div class="timeline-body"><p>as a heads up, I'll be less active next week as it's the lunar new year in Taiwan. Thanks for helping out!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-24 10:55</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 13:51</div>
            <div class="timeline-body"><blockquote>
<p>refactor: rename</p>
<ul>
<li>is_airflow_task as is_decorated_by_airflow_task</li>
<li>check_function_parameters as check_parameters_in_function_def</li>
<li>removed_in_3 as removed_expr_in_3</li>
<li>removed_in_3_function_def as removed_funciton_def_in_3</li>
</ul>
</blockquote>
<p>Can you provide the motivation for these renames? We usually prefer to have active voice instead of passive (at least regarding the first two renames) (https://github.com/astral-sh/ruff/blob/2b3550c85fcc55d93216c4d4ef64c5f0a5766053/crates/ruff_python_semantic/src/analyze/visibility.rs). I'm a bit torn on the last two renames because it indicates to me that some expression / function definition has been removed but that's not the case. I think we should rename them to <code>airflow_3_removal</code> (similar to <a href="https://github.com/astral-sh/ruff/blob/2b3550c85fcc55d93216c4d4ef64c5f0a5766053/crates/ruff_linter/src/rules/numpy/rules/numpy_2_0_deprecation.rs#L158-L159"><code>numpy_2_0_deprecation</code></a>) and add suffix <code>_expr</code> / <code>_function_def</code> to indicate the node that's being checked. Happy to hear your thoughts on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 13:52</div>
            <div class="timeline-body"><blockquote>
<p>as a heads up, I'll be less active next week as it's the lunar new year in Taiwan. Thanks for helping out!</p>
</blockquote>
<p>Thanks for the heads up. Have a great week! Do you know if there's more work required to complete https://github.com/astral-sh/ruff/issues/14626 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1115 on 2025-01-24 14:02</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    class_def.bases().iter().any(|class_base| {
        semantic
            .resolve_qualified_name(class_base)
            .is_some_and(|qualified_name| {
                matches!(qualified_name.segments(), [&quot;airflow&quot;, .., &quot;BaseOperator&quot;])
            })
    })
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-01-24 14:03</div>
            <div class="timeline-body"><p>Looks good, thank you.</p>
<p>I've a minor concern about the renames.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-01-24 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-01-24 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-01-24 15:13</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>refactor: rename</p>
<ul>
<li>is_airflow_task as is_decorated_by_airflow_task</li>
<li>check_function_parameters as check_parameters_in_function_def</li>
<li>removed_in_3 as removed_expr_in_3</li>
<li>removed_in_3_function_def as removed_funciton_def_in_3</li>
</ul>
</blockquote>
<p>Can you provide the motivation for these renames? We usually prefer to have active voice instead of passive (at least regarding the first two renames) (https://github.com/astral-sh/ruff/blob/2b3550c85fcc55d93216c4d4ef64c5f0a5766053/crates/ruff_python_semantic/src/analyze/visibility.rs). I'm a bit torn on the last two renames because it indicates to me that some expression / function definition has been removed but that's not the case. I think we should rename them to <code>airflow_3_removal</code> (similar to <a href="https://github.com/astral-sh/ruff/blob/2b3550c85fcc55d93216c4d4ef64c5f0a5766053/crates/ruff_linter/src/rules/numpy/rules/numpy_2_0_deprecation.rs#L158-L159"><code>numpy_2_0_deprecation</code></a>) and add suffix <code>_expr</code> / <code>_function_def</code> to indicate the node that's being checked. Happy to hear your thoughts on this.</p>
</blockquote>
<p>The motivation was to make it more accurate. I tried to change it a bit. Please take a look. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-01-24 15:17</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>as a heads up, I'll be less active next week as it's the lunar new year in Taiwan. Thanks for helping out!</p>
</blockquote>
<p>Thanks for the heads up. Have a great week! Do you know if there's more work required to complete #14626 ?</p>
</blockquote>
<p>There're 3 cases I can think of as of now.</p>
<ol>
<li><code>context.get(&quot;conf&quot;)</code> or <code>context[&quot;get&quot;]</code> in <code>BaseOperator.execute</code></li>
<li>In <code>PythonOperator(..., python_callable=func)</code>, the <code>func</code> needs to be checked</li>
<li>templated variable (e.g., <code>params=&quot;{{ conf }}&quot;</code></li>
</ol>
<p>The first should be easy, the second might need some exploration, and the third one is a bit tricky, and I'm not even sure whether we should check it.
Whether a variable can be templated is somewhat flexible, but on the other hand, it's also uncommon to have a string happen to be in that format</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @Lee-W on 2025-01-24 16:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] Extend airflow context parameter check in BaseOperator.execute (AIR302)" to "[`airflow`] Extend airflow context parameter check for `BaseOperator.execute` (`AIR302`)" by @dylwil3 on 2025-01-25 03:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-27 15:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1075 on 2025-01-27 15:17</div>
            <div class="timeline-body"><p>I think we should revert these two renames as it's very confusing - the only difference between the two is &quot;in_&quot; and &quot;is_ prefix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-01-27 15:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-27 15:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1075 on 2025-01-27 15:18</div>
            <div class="timeline-body"><p>(I know you're out this week, so will merge this and rename as I can't edit this PR.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-01-27 15:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-01-27 15:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-02-03 05:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/removal_in_3.rs</code>:1075 on 2025-02-03 05:48</div>
            <div class="timeline-body"><p>Thanks for helping out! I tried to check whether I could allow modification, but it seems I do not have the permission either ðŸ¥²</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:51 UTC
    </footer>
</body>
</html>
