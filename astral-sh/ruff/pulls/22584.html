<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Infer implicit type of `cls` in `__new__` methods - astral-sh/ruff #22584</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Infer implicit type of <code>cls</code> in <code>__new__</code> methods</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22584">#22584</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2026-01-14 21:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a></div>
            <div class="timeline-body">Summary
<p>Resolves <a href="https://github.com/astral-sh/ty/issues/2489">astral-sh/ty#2489</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-14 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-14 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-14 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-14 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-14 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-14 21:28</div>
            <div class="timeline-body">

<a href="https://github.com/python/typing/blob/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance/">Typing conformance results</a>
<p>No changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-14 21:30</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>parso (https://github.com/davidhalter/parso)
+ parso/normalizer.py:8:9: error[unresolved-attribute] Unresolved attribute `rule_value_classes` on type `Self@__new__`
+ parso/normalizer.py:9:9: error[unresolved-attribute] Unresolved attribute `rule_type_classes` on type `Self@__new__`
- Found 199 diagnostics
+ Found 201 diagnostics

pip (https://github.com/pypa/pip)
+ src/pip/_vendor/pygments/style.py:63:29: error[unresolved-attribute] Object of type `Self@__new__` has no attribute `styles`
+ src/pip/_vendor/pygments/style.py:64:17: error[unresolved-attribute] Object of type `Self@__new__` has no attribute `styles`
+ src/pip/_vendor/pygments/style.py:81:19: error[unresolved-attribute] Unresolved attribute `_styles` on type `Self@__new__`
+ src/pip/_vendor/pygments/style.py:83:22: error[unresolved-attribute] Object of type `Self@__new__` has no attribute `styles`
+ src/pip/_vendor/pygments/style.py:88:29: error[unresolved-attribute] Object of type `Self@__new__` has no attribute `styles`
+ src/pip/_vendor/pygments/style.py:96:33: error[unresolved-attribute] Object of type `Self@__new__` has no attribute `styles`
- Found 588 diagnostics
+ Found 594 diagnostics

spack (https://github.com/spack/spack)
+ lib/spack/spack/vendor/pyrsistent/_pclass.py:52:28: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_pclass_fields`
+ lib/spack/spack/vendor/pyrsistent/_pclass.py:77:41: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_pclass_invariants`
+ lib/spack/spack/vendor/pyrsistent/_precord.py:44:12: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_precord_initial_values`
+ lib/spack/spack/vendor/pyrsistent/_precord.py:46:47: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_precord_initial_values`
+ lib/spack/spack/vendor/pyrsistent/_precord.py:49:52: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_precord_fields`
+ lib/spack/spack/vendor/typing_extensions.py:1176:13: error[unresolved-attribute] Unresolved attribute `__required_keys__` on type `Self@__new__`
+ lib/spack/spack/vendor/typing_extensions.py:1177:13: error[unresolved-attribute] Unresolved attribute `__optional_keys__` on type `Self@__new__`
+ lib/spack/spack/vendor/typing_extensions.py:1179:17: error[invalid-assignment] Object of type `Unknown | Literal[True]` is not assignable to attribute `__total__` on type `Self@__new__ &amp; ~&lt;Protocol with members &#x27;__total__&#x27;&gt;`
- Found 4339 diagnostics
+ Found 4347 diagnostics

paasta (https://github.com/yelp/paasta)
+ paasta_tools/paastaapi/model_utils.py:194:13: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `discriminator`
+ paasta_tools/paastaapi/model_utils.py:218:38: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `discriminator`
+ paasta_tools/paastaapi/model_utils.py:219:33: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `attribute_map`
+ paasta_tools/paastaapi/model_utils.py:271:12: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_composed_schemas`
+ paasta_tools/paastaapi/model_utils.py:273:17: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_composed_schemas`
+ paasta_tools/paastaapi/model_utils.py:274:17: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_composed_schemas`
+ paasta_tools/paastaapi/model_utils.py:278:12: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_composed_schemas`
- Found 1097 diagnostics
+ Found 1104 diagnostics

scrapy (https://github.com/scrapy/scrapy)
+ scrapy/item.py:39:58: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `tuple[type, ...]`, found `tuple[object, ...]`
- Found 1788 diagnostics
+ Found 1789 diagnostics

optuna (https://github.com/optuna/optuna)
+ optuna/testing/tempfile_pool.py:20:13: error[invalid-assignment] Object of type `Unknown` is not assignable to attribute `_instance` on type `type[Self@__new__] &amp; ~&lt;Protocol with members &#x27;_instance&#x27;&gt;`
+ optuna/testing/tempfile_pool.py:21:29: error[unresolved-attribute] Object of type `type[Self@__new__] &amp; ~&lt;Protocol with members &#x27;_instance&#x27;&gt;` has no attribute `_instance`
+ optuna/testing/tempfile_pool.py:22:16: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_instance`
- Found 577 diagnostics
+ Found 580 diagnostics

discord.py (https://github.com/Rapptz/discord.py)
- discord/utils.py:824:84: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 552 diagnostics
+ Found 551 diagnostics

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
+ pymongo/driver_info.py:45:16: error[invalid-return-type] Return type does not match returned value: expected `pymongo.driver_info.DriverInfo @ pymongo/driver_info.py:25:7`, found `pymongo.driver_info.DriverInfo @ pymongo/driver_info.py:25:18`
- Found 447 diagnostics
+ Found 448 diagnostics

zope.interface (https://github.com/zopefoundation/zope.interface)
+ src/zope/interface/interface.py:651:9: error[unresolved-attribute] Unresolved attribute `__module` on type `Self@__new__`
- Found 421 diagnostics
+ Found 422 diagnostics

cloud-init (https://github.com/canonical/cloud-init)
+ cloudinit/lifecycle.py:52:16: error[invalid-return-type] Return type does not match returned value: expected `cloudinit.lifecycle.Version @ cloudinit/lifecycle.py:19:7`, found `cloudinit.lifecycle.Version @ cloudinit/lifecycle.py:20:5`
- Found 1169 diagnostics
+ Found 1170 diagnostics

manticore (https://github.com/trailofbits/manticore)
+ manticore/utils/event.py:37:40: warning[possibly-missing-attribute] Attribute `_published_events` may be missing on object of type `Unknown | Self@__new__`
+ manticore/utils/event.py:38:9: error[invalid-assignment] Invalid subscript assignment with key of type `Self@__new__` and value of type `set[Unknown]` on object of type `dict[Eventful, set[str]]`
- Found 11068 diagnostics
+ Found 11070 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
- src/integrations/prefect-dbt/prefect_dbt/core/settings.py:94:28: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/integrations/prefect-dbt/prefect_dbt/core/settings.py:94:28: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/integrations/prefect-dbt/prefect_dbt/core/settings.py:99:28: error[invalid-assignment] Object of type `T@resolve_variables | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/integrations/prefect-dbt/prefect_dbt/core/settings.py:99:28: error[invalid-assignment] Object of type `T@resolve_variables | str | int | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/cli/deploy/_core.py:86:21: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/prefect/cli/deploy/_core.py:86:21: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/cli/deploy/_core.py:87:21: error[invalid-assignment] Object of type `T@resolve_variables` is not assignable to `dict[str, Any]`
+ src/prefect/cli/deploy/_core.py:87:21: error[invalid-assignment] Object of type `T@resolve_variables | str | int | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/deployments/runner.py:795:70: warning[possibly-missing-attribute] Attribute `__name__` may be missing on object of type `Unknown | (((...) -&gt; Any) &amp; ((*args: object, **kwargs: object) -&gt; object))`
+ src/prefect/deployments/runner.py:795:70: warning[possibly-missing-attribute] Attribute `__name__` may be missing on object of type `Unknown | ((...) -&gt; Any)`
- src/prefect/deployments/steps/core.py:137:38: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any]`
+ src/prefect/deployments/steps/core.py:137:38: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements`
+ src/prefect/flow_engine.py:812:32: error[invalid-await] `Unknown | R@FlowRunEngine | Coroutine[Any, Any, R@FlowRunEngine]` is not awaitable
+ src/prefect/flow_engine.py:1401:24: error[invalid-await] `Unknown | R@AsyncFlowRunEngine | Coroutine[Any, Any, R@AsyncFlowRunEngine]` is not awaitable
+ src/prefect/flow_engine.py:1482:43: error[invalid-argument-type] Argument to function `next` is incorrect: Expected `SupportsNext[Unknown]`, found `Unknown | R@run_generator_flow_sync`
+ src/prefect/flow_engine.py:1490:21: warning[possibly-missing-attribute] Attribute `throw` may be missing on object of type `Unknown | R@run_generator_flow_sync`
+ src/prefect/flow_engine.py:1524:44: warning[possibly-missing-attribute] Attribute `__anext__` may be missing on object of type `Unknown | R@run_generator_flow_async`
+ src/prefect/flow_engine.py:1531:25: warning[possibly-missing-attribute] Attribute `throw` may be missing on object of type `Unknown | R@run_generator_flow_async`
- src/prefect/flows.py:286:34: error[unresolved-attribute] Object of type `((**P@Flow) -&gt; R@Flow) &amp; ((*args: object, **kwargs: object) -&gt; object)` has no attribute `__name__`
+ src/prefect/flows.py:286:34: error[unresolved-attribute] Object of type `(**P@Flow) -&gt; R@Flow` has no attribute `__name__`
- src/prefect/flows.py:404:68: error[unresolved-attribute] Object of type `((**P@Flow) -&gt; R@Flow) &amp; ((*args: object, **kwargs: object) -&gt; object)` has no attribute `__name__`
+ src/prefect/flows.py:404:68: error[unresolved-attribute] Object of type `(**P@Flow) -&gt; R@Flow` has no attribute `__name__`
- src/prefect/flows.py:1750:53: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ src/prefect/server/api/server.py:849:16: error[invalid-return-type] Return type does not match returned value: expected `Self@__new__`, found `SubprocessASGIServer`
- src/prefect/utilities/templating.py:320:13: error[invalid-assignment] Invalid subscript assignment with key of type `object` and value of type `T@resolve_block_document_references | dict[str, Any]` on object of type `dict[str, Any]`
+ src/prefect/utilities/templating.py:320:13: error[invalid-assignment] Invalid subscript assignment with key of type `object` and value of type `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements` on object of type `dict[str, Any]`
- src/prefect/utilities/templating.py:323:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_block_document_references | dict[str, Any]`, found `list[T@resolve_block_document_references | dict[str, Any] | Unknown]`
+ src/prefect/utilities/templating.py:323:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_block_document_references | dict[str, Any]`, found `list[T@resolve_block_document_references | dict[str, Any] | str | ... omitted 5 union elements]`
- src/prefect/utilities/templating.py:437:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `dict[object, T@resolve_variables | Unknown]`
+ src/prefect/utilities/templating.py:437:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `dict[object, T@resolve_variables | str | int | ... omitted 5 union elements]`
- src/prefect/utilities/templating.py:442:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `list[T@resolve_variables | Unknown]`
+ src/prefect/utilities/templating.py:442:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `list[T@resolve_variables | str | int | ... omitted 5 union elements]`
- src/prefect/workers/base.py:232:13: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any]`
+ src/prefect/workers/base.py:232:13: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements`
- src/prefect/workers/base.py:234:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `T@resolve_variables`
+ src/prefect/workers/base.py:234:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `T@resolve_variables | str | int | ... omitted 4 union elements`
- Found 5405 diagnostics
+ Found 5411 diagnostics

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
+ src/scikit_build_core/build/wheel.py:99:20: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- Found 46 diagnostics
+ Found 47 diagnostics

aiohttp (https://github.com/aio-libs/aiohttp)
+ aiohttp/helpers.py:136:16: error[invalid-return-type] Return type does not match returned value: expected `aiohttp.helpers.BasicAuth @ aiohttp/helpers.py:121:7`, found `aiohttp.helpers.BasicAuth @ aiohttp/helpers.py:121:17`
- Found 180 diagnostics
+ Found 181 diagnostics

hydpy (https://github.com/hydpy-dev/hydpy)
- hydpy/core/devicetools.py:1198:38: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 665 diagnostics
+ Found 664 diagnostics

static-frame (https://github.com/static-frame/static-frame)
- static_frame/core/bus.py:675:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Bus[Any], object_]`, found `InterGetItemILocReduces[Bus[Any] | Bottom[Index[Any]] | TypeBlocks | ... omitted 6 union elements, object_ | Self@iloc]`
+ static_frame/core/bus.py:675:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Bus[Any], object_]`, found `InterGetItemILocReduces[Bottom[Series[Any, Any]] | Bus[Any] | ndarray[Never, Never] | ... omitted 6 union elements, object_ | Self@iloc]`
- static_frame/core/index.py:580:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[TVContainer_co@loc, TVDtype@Index]`, found `InterGetItemLocReduces[Any | Bottom[Series[Any, Any]], TVDtype@Index]`
+ static_frame/core/index.py:580:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[TVContainer_co@loc, TVDtype@Index]`, found `InterGetItemLocReduces[Bottom[Series[Any, Any]] | Any, TVDtype@Index]`
- static_frame/core/node_selector.py:526:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[TVContainer_co@InterfaceSelectQuartet, Any]`, found `InterGetItemLocReduces[Unknown | Bottom[Series[Any, Any]], Any]`
+ static_frame/core/node_selector.py:526:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[TVContainer_co@InterfaceSelectQuartet, Any]`, found `InterGetItemLocReduces[Bottom[Series[Any, Any]] | Unknown, Any]`
- static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any] | Bottom[Index[Any]] | TypeBlocks | ... omitted 6 union elements, TVDtype@Series]`
- static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Bottom[Series[Any, Any]] | ndarray[Never, Never] | TypeBlocks | ... omitted 7 union elements, TVDtype@SeriesHE]`
- static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Yarn[Any] | Bottom[Index[Any]] | TypeBlocks | ... omitted 6 union elements, object_]`
+ static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Yarn[Any] | Bottom[Index[Any]] | Bottom[Series[Any, Any]] | ... omitted 6 union elements, object_]`
- Found 1825 diagnostics
+ Found 1823 diagnostics

pandas (https://github.com/pandas-dev/pandas)
+ pandas/core/dtypes/dtypes.py:1066:26: error[unresolved-attribute] Object of type `BaseOffset` has no attribute `_period_dtype_code`
- Found 3757 diagnostics
+ Found 3758 diagnostics

ibis (https://github.com/ibis-project/ibis)
+ ibis/common/bases.py:48:9: error[unresolved-attribute] Unresolved attribute `__abstractmethods__` on type `Self@__new__`
- Found 4605 diagnostics
+ Found 4606 diagnostics

sympy (https://github.com/sympy/sympy)
+ sympy/algebras/quaternion.py:137:36: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Basic`, found `Expr | int | float | complex`
+ sympy/algebras/quaternion.py:137:39: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Basic`, found `Expr | int | float | complex`
+ sympy/algebras/quaternion.py:137:42: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Basic`, found `Expr | int | float | complex`
+ sympy/algebras/quaternion.py:137:45: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Basic`, found `Expr | int | float | complex`
- sympy/core/function.py:925:21: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ sympy/core/kind.py:76:20: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_inst`
+ sympy/core/kind.py:77:20: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_inst`
+ sympy/core/kind.py:80:13: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_inst`
+ sympy/core/logic.py:310:21: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `op_x_notx`
+ sympy/core/logic.py:312:28: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `op_x_notx`
+ sympy/core/logic.py:320:24: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `op_x_notx`
+ sympy/core/logic.py:325:24: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `op_x_notx`
+ sympy/core/operations.py:101:45: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `identity`
+ sympy/core/operations.py:104:20: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `identity`
+ sympy/core/operations.py:546:28: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `zero`
+ sympy/core/operations.py:548:28: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `identity`
- sympy/core/relational.py:192:45: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ sympy/functions/elementary/miscellaneous.py:392:24: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `zero`
+ sympy/functions/elementary/miscellaneous.py:400:20: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `identity`
+ sympy/physics/units/quantities.py:39:9: error[invalid-attribute-access] Cannot assign to instance attribute `_is_prefixed` from the class object `type[Self@__new__]`
+ sympy/sets/conditionset.py:158:44: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Boolean | bool`, found `Basic`
+ sympy/sets/conditionset.py:166:59: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Boolean | bool`, found `Basic`
+ sympy/vector/basisdependent.py:194:36: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_expr_type`
+ sympy/vector/basisdependent.py:196:27: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_mul_func`
+ sympy/vector/basisdependent.py:198:27: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_add_func`
+ sympy/vector/basisdependent.py:222:20: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_mul_func`
+ sympy/vector/basisdependent.py:224:9: error[invalid-assignment] Object of type `StdFactKB` is not assignable to attribute `_assumptions` on type `Expr &amp; ~Mul`
+ sympy/vector/basisdependent.py:225:9: error[invalid-assignment] Object of type `dict[Unknown, Unknown]` is not assignable to attribute `_components` on type `Expr &amp; ~Mul`
+ sympy/vector/basisdependent.py:226:9: error[invalid-assignment] Object of type `Unknown` is not assignable to attribute `_sys` on type `Expr &amp; ~Mul`
+ sympy/vector/orienters.py:132:12: error[unresolved-attribute] Object of type `type[Self@__new__]` has no attribute `_in_order`
- Found 15597 diagnostics
+ Found 15623 diagnostics


</code></pre>


<p>No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-14 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-14 21:37</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>unresolved-attribute</code> | 45 | 0 | 2 |
| <code>invalid-argument-type</code> | 8 | 0 | 1 |
| <code>invalid-assignment</code> | 6 | 0 | 0 |
| <code>invalid-return-type</code> | 4 | 0 | 2 |
| <code>possibly-missing-attribute</code> | 4 | 0 | 1 |
| <code>unused-ignore-comment</code> | 0 | 5 | 0 |
| <code>invalid-await</code> | 2 | 0 | 0 |
| <code>invalid-attribute-access</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>70</strong> | <strong>5</strong> | <strong>6</strong> |</p>
<p><strong><a href="https://e5a5129f.ty-ecosystem-ext.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://e5a5129f.ty-ecosystem-ext.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/self.md</code>:590 on 2026-01-14 23:16</div>
            <div class="timeline-body"><p>The point of this test is that the usage of <code>Self</code> above should return a diagnostic, but it seems mildly confusing to introduce another unrelated diagnostic. Here&#x27;s a version that doesn&#x27;t introduce a diagnostic:</p>
<pre><code>    def __new__(cls, name, bases, dct) -&gt; Self:
        return cls(name, bases, dct)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2026-01-14 23:16</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-14 23:49</div>
            <div class="timeline-body"><p>The new ecosystem diagnostics here are technically false positives, but they are also emitted by pyright and strict-mode mypy, and they look expected, in that it&#x27;s known that we won&#x27;t see attributes dynamically attached in <code>__new__</code> or in metaclasses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Infer implicit type of `self` in `__new__` methods&quot; to &quot;[ty] Infer implicit type of `cls` in `__new__` methods&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/AlexWaygood">@AlexWaygood</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 13:59</div>
            <div class="timeline-body"><p>It looks like the <code>__new__</code> method we synthesize for <code>NamedTuple</code> classes is buggy -- here&#x27;s some minimal repros of some diagnostics in the ecosystem report on this PR:</p>
<pre><code>from collections import namedtuple
from typing import NamedTuple, Self

class Foo(NamedTuple):
    x: int

class Bar(Foo):
    def __new__(cls) -&gt; &quot;Bar&quot;:
        return super().__new__(cls, x=42)  # error[invalid-return-type] &quot;Return type does not match returned value: expected `Bar`, found `Foo`&quot;

class Bar2(Foo):
    def __new__(cls) -&gt; Self:
        return super().__new__(cls, x=42)  # error[invalid-return-type] &quot;Return type does not match returned value: expected `Self@__new__`, found `Foo`&quot;

Baz = namedtuple(&quot;Baz&quot;, &quot;x y&quot;)

class Spam(Baz):
    def __new__(cls) -&gt; &quot;Spam&quot;:
        return super().__new__(cls, x=42, y=56)  # error[invalid-return-type] &quot;Return type does not match returned value: expected `Spam`, found `Baz`&quot;

class Spam2(Baz):
    def __new__(cls) -&gt; Self:
        return super().__new__(cls, x=42, y=56)  # error[invalid-return-type] &quot;Return type does not match returned value: expected `Self@__new__`, found `Baz`&quot;
</code></pre>
<p>I think the return type we synthesize for these methods changed in https://github.com/astral-sh/ruff/commit/3e0299488e72fa80f59473565cf724041d0f3f3c. We need to infer these methods as returning <code>Self</code> rather than an instance of the namedtuple class, I think. cc. @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 14:09</div>
            <div class="timeline-body"><blockquote>
<p>The new ecosystem diagnostics here are technically false positives, but they are also emitted by pyright and strict-mode mypy, and they look expected, in that it&#x27;s known that we won&#x27;t see attributes dynamically attached in <code>__new__</code> or in metaclasses.</p>
</blockquote>
<p>I wouldn&#x27;t necessarily characterise setting an attribute in <code>__new__</code> as &quot;dynamically attaching&quot; an attribute. I thought it was often considered best practice to set an attribute in <code>__new__</code>, and not have an <code>__init__</code> method at all, if you wanted instances of your class to be considered pseudo-immutable for outside consumers. (For example, the stdlib <a href="https://github.com/python/cpython/blob/3514ba2175764e4d746e6862e2fcfc06b5fcd6c2/Lib/fractions.py#L205-L206"><code>fractions.Fraction</code></a> class.)</p>
<p>So I&#x27;d love to support recognising implicit instance attributes set in <code>__new__</code> at <em>some</em> point. That said, I agree that it shouldn&#x27;t block this PR being merged! Especially if mypy/pyright don&#x27;t support it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-15 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-15 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-15 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 20:45</div>
            <div class="timeline-body"><p>I opened <a href="https://github.com/astral-sh/ty/issues/2522">astral-sh/ty#2522</a> to track the new NamedTuple false positives</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:23:02 UTC
    </footer>
</body>
</html>
