<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-import-conventions`] Syntax check aliases supplied in configuration for `unconventional-import-alias (ICN001)` - astral-sh/ruff #14477</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-import-conventions</code>] Syntax check aliases supplied in configuration for <code>unconventional-import-alias (ICN001)</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14477">#14477</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2024-11-20 05:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>This PR introduces a validation step to the deserialization of the configuration for <a href="https://docs.astral.sh/ruff/rules/unconventional-import-alias/#unconventional-import-alias-icn001">unconventional-import-alias (ICN001)</a>. We verify that the import module and alias supplied have valid syntax in order to avoid a panic if these aliases are added in during a fix.</p>
<p>Closes #14439</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-20 05:04</div>
            <div class="timeline-body"><p>Two notes:</p>
<ul>
<li>Sorry for bloating the workspace crate with serde and especially with serde_json (since I only use the latter for a test)... let me know if you&#x27;d like me to work around that</li>
<li>I don&#x27;t add a deserialization check for &quot;banned aliases&quot; or &quot;banned from&quot; since a fix would never <em>add</em> those to the source code</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-20 05:11</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-20 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-20 07:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/Cargo.toml</code>:46 on 2024-11-20 07:33</div>
            <div class="timeline-body"><p>This should be a dev-dependency if it is only used in tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:3449 on 2024-11-20 07:35</div>
            <div class="timeline-body"><p>I&#x27;m leaning towards making this a ruff cli integration test. It then also demonstrates how the error message is displayed to the users.</p>
<p>See https://github.com/astral-sh/ruff/blob/c847cad389f202edae868765e690cb7042e88264/crates/ruff/tests/lint.rs#L23</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:1394 on 2024-11-20 07:36</div>
            <div class="timeline-body"><p>I suggest that we use two dedicated errors: One for <code>alias</code> and one for <code>module</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-20 07:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-20 07:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-20 07:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:48</div>
            <div class="timeline-body"><p>Let&#x27;s try to get this into ruff 0.8 if we can â€” while it <em>is</em> a bugfix, it might still be breaking for some users who are currently &quot;using the rule incorrectly&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v0.8&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/sharkdp">@sharkdp</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/AlexWaygood">@AlexWaygood</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 08:52</div>
            <div class="timeline-body"><p>Sorry â€” I optimistically tried to change the target branch, but it messed up the diff, so I swiftly reverted that back ðŸ˜…</p>
<p>It&#x27;s probably fine if this goes straight into <code>main</code>, though, as long as we merge it before the 0.8 release goes out. I highly doubt we&#x27;ll be cutting another patch release before 0.8, since everything is roughly on schedule for the minor release</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 09:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-20 12:08</div>
            <div class="timeline-body"><p>I also don&#x27;t consider this breaking. It doesn&#x27;t change the intent of the rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-20 12:12</div>
            <div class="timeline-body"><blockquote>
<p>I also don&#x27;t consider this breaking. It doesn&#x27;t change the intent of the rule.</p>
</blockquote>
<p>I agree that it doesn&#x27;t change the intent of the rule, but clearly <em>some</em> users are not using the rule <em>as it was intended</em>: <a href="https://github.com/astral-sh/ruff/issues/14439">astral-sh/ruff#14439</a>#issuecomment-2485302976. We will break those users; this is a case of <a href="https://www.hyrumslaw.com/">Hyrum&#x27;s law</a>.</p>
<p>I strongly agree with the change, I&#x27;d just prefer to have it go into Ruff 0.8 and to list it in <code>BREAKING_CHANGES.md</code>, out of an abundance of caution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2024-11-20 19:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_workspace/src/options.rs</code>:3449 on 2024-11-20 19:18</div>
            <div class="timeline-body"><p>Done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2024-11-20 19:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_workspace/src/options.rs</code>:1394 on 2024-11-20 19:18</div>
            <div class="timeline-body"><p>Done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2024-11-20 19:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_workspace/Cargo.toml</code>:46 on 2024-11-20 19:19</div>
            <div class="timeline-body"><p>No longer used (test moved to integration test)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-20 19:20</div>
            <div class="timeline-body"><blockquote>
<p>I agree that it doesn&#x27;t change the intent of the rule, but clearly <em>some</em> users are not using the rule <em>as it was intended</em>: <a href="https://github.com/astral-sh/ruff/issues/14439#issuecomment-2485302976">#14439 (comment)</a>. We will break those users; this is a case of <a href="https://www.hyrumslaw.com/">Hyrum&#x27;s law</a>.</p>
</blockquote>
<p><a href="https://xkcd.com/1172/">Relevant xkcd</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/tests/lint.rs</code>:1999 on 2024-11-20 20:18</div>
            <div class="timeline-body"><p>Hmm. The errors aren&#x27;t great. Let&#x27;s at least include the alias in the error message to help users figure out what&#x27;s going on. The same for the module name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:1333 on 2024-11-20 20:20</div>
            <div class="timeline-body"><p>We would probably get better error messages if you create a newtype for <code>ModuleName</code> and <code>Alias</code> and implement <code>Deserialize</code> for them. I would expect that serde can then narrow the error message to the specific line rather than the entire table</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-11-20 20:22</div>
            <div class="timeline-body"><p>Thanks for adding the integration tests. They show that the error messages aren&#x27;t great. We should either:</p>
<ul>
<li>minimal: Include the alias and module name in the error message</li>
<li>better: Use newtype wrappers for <code>Module</code> and <code>Alias</code> (<code>FxHashMap&lt;ModuleName, Alias&gt;</code>) and implement <code>Deserialize</code> on the newtype wrappers. That should allow serde to highlight the relevant line and column in the error message.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;v0.8&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-21 15:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-21 15:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_workspace/src/options.rs</code>:1333 on 2024-11-21 15:34</div>
            <div class="timeline-body"><p>This PR does actually already seem to be a small improvement on the status quo when it comes to line numbers. Currently if I make this change to typeshed&#x27;s pyproject.toml file:</p>
<pre><code>diff --git a/pyproject.toml b/pyproject.toml
index 46014bcd2..927da6162 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -111,6 +111,9 @@ ignore = [
     &quot;E501&quot;, # Line too long
 ]
 
+[tool.ruff.lint.flake8-import-conventions.aliases]
+&quot;pandas&quot; = 42
+
</code></pre>
<p>Then Ruff v0.7.1 gives me this error message:</p>
<pre><code>ruff failed
  Cause: Failed to parse /Users/alexw/dev/typeshed/pyproject.toml
  Cause: TOML parse error at line 27, column 1
   |
27 | [tool.ruff.lint]
   | ^^^^^^^^^^^^^^^^
invalid type: integer `42`, expected a string
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:40</div>
            <div class="timeline-body"><p>I pushed a change that implements <code>Deserialize</code> for the key and value. I&#x27;m surprised that serde isn&#x27;t better at handling this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-21 15:41</div>
            <div class="timeline-body"><p>@AlexWaygood should we merge?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-11-21 15:49</div>
            <div class="timeline-body"><p>Thanks @dylwil3!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-11-21 15:51</div>
            <div class="timeline-body"><p>@MichaReiser you beat me to it! Much improved error message, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-21 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v0.8&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-21 15:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:08:41 UTC
    </footer>
</body>
</html>
