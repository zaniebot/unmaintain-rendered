<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Derive `PartialOrd, Ord` for `KnownInstanceType` - astral-sh/ruff #18340</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Derive <code>PartialOrd, Ord</code> for <code>KnownInstanceType</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18340">#18340</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-05-27 18:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>Unlike a series of integers or strings, there&#x27;s no self-evident way in which a series of <code>KnownInstanceType</code>s should always be ordered if you&#x27;re sorting them. This has always been the motivation for not deriving <code>PartialOrd</code> and <code>Ord</code> on this enum, and instead tediously writing this huge <code>match</code> statement out by hand.</p>
<p>Following <a href="https://github.com/astral-sh/ruff/pull/18212">astral-sh/ruff#18212</a>, however, we must explicitly derive <code>PartialOrd</code> and <code>Ord</code> for any Salsa-tracked structs that we wish to sort into an order. This is a good change -- it sharply brings into focus the fact that the orderings Salsa was previously implicitly deriving for us were also arbitrary orderings that had no grounding in the underlying type being represented by the Salsa ID. We already knew this, but now it&#x27;s explicit.</p>
<p>The ordering of <code>KnownInstanceType</code>s isn&#x27;t inherently any more arbitrary than the orderings we&#x27;re deriving elsewhere; so let&#x27;s just derive <code>PartialOrd, Ord</code> here too. It makes the code a fair bit simpler :-)</p>
Test Plan
<p><code>cargo test -p ty_python_semantic</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-27 18:19</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/known_instance.rs</code>:27 on 2025-05-27 18:33</div>
            <div class="timeline-body"><pre><code>/// The id may change between runs, or when the known instance was garbage collected and recreated.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-05-27 18:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-05-27 18:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/known_instance.rs</code>:27 on 2025-05-27 18:35</div>
            <div class="timeline-body"><p>Oh never mind, I see now that this was probably intentional -- the wrapped data are typevars.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-27 18:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:14:58 UTC
    </footer>
</body>
</html>
