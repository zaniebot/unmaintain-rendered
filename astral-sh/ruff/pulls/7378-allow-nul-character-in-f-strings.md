```yaml
number: 7378
title: "Allow `NUL` character in f-strings"
type: pull_request
state: merged
author: dhruvmanila
labels:
  - parser
  - python312
assignees: []
merged: true
base: dhruv/pep-701
head: dhruv/fstring-nul
created_at: 2023-09-14T07:24:24Z
updated_at: 2023-09-28T03:58:54Z
url: https://github.com/astral-sh/ruff/pull/7378
synced_at: 2026-01-12T02:39:09Z
```

# Allow `NUL` character in f-strings

---

_Pull request opened by @dhruvmanila on 2023-09-14 07:24_

## Summary

This PR fixes the bug to allow `NUL` (`\0`) character inside f-strings.

## Test Plan

Add test case with `NUL` character inside f-string.


---

_Comment by @dhruvmanila on 2023-09-14 07:24_

Current dependencies on/for this PR:
* main
  * **PR #7376** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7376" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7690** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7690" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7667** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7667" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7597** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7597" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7588** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7588" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #7589** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7589" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7586** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7586" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7515** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7515" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7477** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7477" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7387** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7387" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7378** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7378" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #7329** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7329" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7328** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7328" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7327** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7327" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7326** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7326" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7325** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7325" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7378?utm_source=stack-comment).

---

_@dhruvmanila reviewed on 2023-09-14 07:25_

---

_Review comment by @dhruvmanila on `crates/ruff_python_parser/src/lexer.rs`:558 on 2023-09-14 07:25_

We could move this in the catch-all branch but that would mean that the check will be performed for almost _every_ character.

---

_Label `parser` added by @dhruvmanila on 2023-09-14 07:26_

---

_Label `python312` added by @dhruvmanila on 2023-09-14 07:26_

---

_Review requested from @MichaReiser by @dhruvmanila on 2023-09-14 07:26_

---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/lexer.rs`:558 on 2023-09-14 08:47_

Hmm yeah. That's why using `self.cursor.first() ` is "dangerous" and I prefer to use `bump` wherever I can. Can you do a quick double check if any other code needs to check for `self.cursor.is_eof()`

---

_@MichaReiser approved on 2023-09-14 08:47_

---

_@dhruvmanila reviewed on 2023-09-14 10:57_

---

_Review comment by @dhruvmanila on `crates/ruff_python_parser/src/lexer.rs`:558 on 2023-09-14 10:57_

Yeah, that's the only place where it seems necessary.

---

_Merged by @dhruvmanila on 2023-09-14 10:58_

---

_Closed by @dhruvmanila on 2023-09-14 10:58_

---

_Branch deleted on 2023-09-14 10:58_

---
