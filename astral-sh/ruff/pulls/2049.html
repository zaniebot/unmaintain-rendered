<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pyupgrade`] Implement import-replacement rule (`UP035`) - astral-sh/ruff #2049</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pyupgrade</code>] Implement import-replacement rule (<code>UP035</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2049">#2049</a>
        opened by <a href="https://github.com/colin99d">@colin99d</a>
        on 2023-01-21 03:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a></div>
            <div class="timeline-body"><p>A part of #827. I started this trying to use libcst. However, if found it added a lot of complexity because I have to change the order of the imports, which really messed up the formatting. If you know of a good way to handle this I will be happy to switch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-21 19:39</div>
            <div class="timeline-body"><p>@charliermarsh , I don't love the way I am handling muli-line imports. Pretty much, if there is a match I am always changing it to:</p>
<pre><code>from unmatching (
    import1,
    import2
)
from matching {
    import1
    import2
)
</code></pre>
<p>However, I think this might be the best way for a few reasons:</p>
<ol>
<li>Libcst makes this a lot more complicated (unless there is something I am missing)</li>
<li>If we are adding our own version of black, it makes sense for these functions to export in one standard way, and then let black clean up the change</li>
<li>This standardizes all ruff code, which may be beneficial</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-22 21:57</div>
            <div class="timeline-body"><p>I am moving this out of draft status. However, I will still be adding some more test cases to make sure it always works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @colin99d on 2023-01-22 22:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-25 23:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:16 on 2023-01-25 23:09</div>
            <div class="timeline-body"><p>Would initialising from an array not be better suited here?
(Should be more performant, but might be compiled away anyway)</p>
<pre><code>let solar_distance = HashMap::from([
    (&quot;Mercury&quot;, 0.4),
    (&quot;Venus&quot;, 0.7),
    (&quot;Earth&quot;, 1.0),
    (&quot;Mars&quot;, 1.5),
]);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-25 23:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:117 on 2023-01-25 23:11</div>
            <div class="timeline-body"><p><code>stylist.line_ending().as_str()</code> to have appropriate cross-platform line ending</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/pyupgrade/snapshots/ruff__rules__pyupgrade__tests__UP035_UP035.py.snap</code>:14 on 2023-01-25 23:12</div>
            <div class="timeline-body"><p>The snap format has changed (slightly) to accommodate newlines. Should be autogenerated after a rebase and test run</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-25 23:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/violations.rs</code>:3221 on 2023-01-25 23:13</div>
            <div class="timeline-body"><p>Violations have moved to the specific module, might as well move these directly into <code>pyupgrade</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-25 23:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-25 23:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:155 on 2023-01-25 23:14</div>
            <div class="timeline-body"><p>Pass <code>checker.stylist</code> here (charliermarsh prefers just after locator)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-01-25 23:17</div>
            <div class="timeline-body"><p>A couple of pointers, hope it helps. Great effort üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/violations.rs</code>:3221 on 2023-01-26 01:24</div>
            <div class="timeline-body"><p>I love this refactor! @charliermarsh, say the word and I will do it for the rest of the modules in pyupgrade.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2023-01-26 01:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2023-01-26 02:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:155 on 2023-01-26 02:17</div>
            <div class="timeline-body"><p>Do you mind clarifying what you mean here. I interpret it as you want me to use <code>checker.stylist.locator</code>, but the <code>locator</code> member of <code>Stylist</code> is private. So I am assuming you mean something else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-26 02:17</div>
            <div class="timeline-body"><p>Thanks for the feedback!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-29 01:39</div>
            <div class="timeline-body"><p>@charliermarsh what else do you want here for a merge (im not sure why only the windows texts are failing).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-29 01:43</div>
            <div class="timeline-body"><p>@colin99d - Nothing on your end. I just need to find time to review. Sorry for the delay. I'll rebase etc. when necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-29 01:49</div>
            <div class="timeline-body"><p>Perfect! Just wanted to make sure you weren't waiting on something. Thank you for all the work you put into this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-29 23:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-29 23:38</div>
            <div class="timeline-body"><p>Why is the <code>six</code> stuff a separate rule? Is that following a <code>pyupgrade</code> convention?</p>
<p>This is maybe controversial, but my instinct is to skip all the explicit Python 2-to-Python 3 conversion stuff (like <code>six</code> conversions). We have some of that already, but it feels really one-time, whereas much of the other <code>pyupgrade</code> stuff is useful for new Python 3 code that's being written on an ongoing basis (e.g., the <code>typing</code> import replacements, or the type annotation rewrites, or the string format rewrites). Those kinds of things come up as you write new Python 3 code. But you'd never really expect to accidentally import <code>six</code> in new Python 3 code.</p>
<p>Does that make sense? In other words: I'm proposing that we omit the rules from <code>pyupgrade</code> that you'd expect to be &quot;one-time changes&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-29 23:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-29 23:40</div>
            <div class="timeline-body"><p>Although now that I'm looking at the code, again wondering what the difference is between the responsibilities of this rule and <code>import_replacements.rs</code> :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:01</div>
            <div class="timeline-body"><p>I actually agree with this a lot. It does not seem wise to me to maintain code, when the user could go directly to pyupgrade once, and then use us from then on. Would you like me to remove all of <code>import_replacements_six.rs</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2023-01-30 00:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2023-01-30 00:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:02</div>
            <div class="timeline-body"><p>I split them up because they function slightly differently, and I thought it would be easier to split the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-30 00:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:02</div>
            <div class="timeline-body"><p>Does this file <em>also</em> do some <code>six</code> import replacement though? E.g., this file has <code>SIX_MOVES_TO_COLLECTIONS</code>. (Just trying to understand before I chime in further.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2023-01-30 00:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:09</div>
            <div class="timeline-body"><p>Yes, I just handled the two groups a little differently, since pyupgrade did. I can also remove all references to six in <code>import_replacements.rs</code> as well if you like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-30 00:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:10</div>
            <div class="timeline-body"><p>Ok, sounds good. Let's do it, I think. We can also remove <code>src/rules/pyupgrade/rules/remove_six_compat.rs</code>, but lets do that separately, since we need to deprecate the actual check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:11</div>
            <div class="timeline-body"><p>(Do you want to make that change? I can also do it, I'm in this file now. Just LMK what you prefer.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-30 00:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/rules/pyupgrade/rules/import_replacements_six.rs</code>:19 on 2023-01-30 00:13</div>
            <div class="timeline-body"><p>I can get it done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2023-01-30 00:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-30 02:25</div>
            <div class="timeline-body"><p>@charliermarsh I got all the six stuff removed, would you like me to add a blurb in the readme about why we do not have six, and how users can run pyupgrade once, and then use us?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-30 02:26</div>
            <div class="timeline-body"><p>@colin99d - No that's ok. I'll add something to <code>BREAKING_CHANGES.md</code> and the release notes prior to release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-30 04:30</div>
            <div class="timeline-body"><p>I want to change one more thing here, but hopefully it can go out tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Pyupgrade: Import Replacements" to "[`pyupgrade`] Implement import-replacement rule (`UP035`)" by @charliermarsh on 2023-01-31 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-31 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-31 00:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:40 UTC
    </footer>
</body>
</html>
