<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement pycodestyle's logical line detection - astral-sh/ruff #1130</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement pycodestyle's logical line detection</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1130">#1130</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-12-07 22:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>Along with the logical line detection, this adds 14 of the missing <code>pycodestyle</code> rules.</p>
<p>For now, this is all gated behind a <code>logical_lines</code> feature that's off-by-default, which will let us implement all rules prior to shipping, since we want to couple the release of these rules with new defaults and instructions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 15:50</div>
            <div class="timeline-body"><p>Closing for now to keep the PR list up-to-date, can always reopen.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-06 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2023-01-31 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2023-01-31 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-31 23:17</div>
            <div class="timeline-body"><p>Rebased + re-opened.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-01 04:32</div>
            <div class="timeline-body"><p>The main blocker here is that I don't really want to turn these on by default. I want them to be explicitly opt-in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-01 04:57</div>
            <div class="timeline-body"><p>@not-my-profile - No obligation to reply, but since we've talked about this kind of thing a few times: any thoughts on how to enable the above? I want to add these new <code>E</code> rules, but I don't want users with <code>E</code> enabled to get them &quot;automatically&quot;.</p>
<p>I'm learning towards adding them in their own category, with their own prefix (e.g., <code>EX</code> or something), so that they're opt-in. It's a little awkward, since we're then changing the codes vs. Flake8. But no one that uses an autoformatter needs these rules, and they have a greater-than-average performance penalty. (Lots of users have requested them, so I don't mind supporting them, but I want them to be off-by-default.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-01 06:47</div>
            <div class="timeline-body"><p>Our rule codes consist of:</p>
<ul>
<li>a common prefix[^1] (that is shared by all rule codes from the linter)</li>
<li>a linter-specific code (that identifies the rule within the linter namespace)</li>
</ul>
<p>Ruff often changes the common prefix from the upstream rule codes to avoid namespace collisions ... which I think makes perfect sense. However I think that we should avoid changing the linter-specific codes at all cost.</p>
<p>The common prefix for pycodestyle is the empty string &quot;&quot;, &quot;E&quot; is therefore part of the linter-specific code, so I strongly think that we should <strong>not</strong> change linter-specific codes such as E221, E222, E223, and E224.</p>
<p>Something like #2292 could be a short-term solution, but I think long-term we clearly want to use categories for this (#1774).</p>
<p>I'd like us to put this on hold for now and firstly:</p>
<ol>
<li>Do the <code>crates/</code> migration.</li>
<li>Implement the many-to-many mapping.</li>
</ol>
<p>[^1]: See also b532fce79268de1b6a93a0c5180e63791127f159.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-03 05:15</div>
            <div class="timeline-body"><p>Yeah I agree RE changing the prefix. I don't think we have great options in the interim. We could change the default configuration to use <code>[&quot;E4&quot;, &quot;E5&quot;, &quot;E7&quot;, &quot;E9&quot;]</code> rather than <code>[&quot;E&quot;]</code>, which helps, but users that have <code>E</code> enabled already will now be paying this performance cost and probably won't realize it. (I do think new users tend to copy over the default configuration, so it might be ~fine from that perspective.)</p>
<p>I'm going to keep implementing these because I do want to ship them (a lot of it is now mechanical since it's a straight 1:1 port of <code>pycodestyle</code> with some performance optimizations). But I'm still undecided on the right compromise here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-03 05:15</div>
            <div class="timeline-body"><p>Maybe we just change the default going forward and move on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-05 05:18</div>
            <div class="timeline-body"><p>Gonna merge this tomorrow, possibly behind a feature flag while we figure out how to categorize and enable etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-02-05 05:34</div>
            <div class="timeline-body"><p>The <code>define_rule_mapping!</code> macro currently doesn't support feature flags.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-05 05:37</div>
            <div class="timeline-body"><p>Iâ€™ve already run into that :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-05 16:25</div>
            <div class="timeline-body"><p>I got <code>define_rule_mapping!</code> to propagate attribute macros. But I'll merge it as a separate PR once it passes CI here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-02-05 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-05 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-02-05 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonathan-s">@jonathan-s</a> on 2023-02-19 15:26</div>
            <div class="timeline-body"><p>@charliermarsh, just a heads up, as a user of of ruff. The way I'm thinking about it is that ruff is in development and I'm expecting that new rules may be added, so I'm keeping my version pinned to get consistent result. So I'm expecting as more rules are added to the same category (&quot;E&quot; for pycodestyles) I might need to update my code.</p>
<p>So in other words I wouldn't want or expect more categories for more rules of pycodestyles.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:06 UTC
    </footer>
</body>
</html>
