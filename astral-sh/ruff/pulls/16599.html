<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] mypy_primer: comment on PRs - astral-sh/ruff #16599</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] mypy_primer: comment on PRs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16599">#16599</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-03-10 13:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>Add a new pipeline to comment on PRs if there is a mypy_primer diff result.</p>
Test Plan
<p>Not yet, I&#x27;m afraid I will have to merge this first to have the pipeline available on main.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-10 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-10 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/mypy_primer_comment.yaml</code>:1 on 2025-03-10 13:40</div>
            <div class="timeline-body"><p>Could we avoid duplicating this entire workflow and instead use the existing workflow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-10 13:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-10 13:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>.github/workflows/mypy_primer_comment.yaml</code>:1 on 2025-03-10 13:55</div>
            <div class="timeline-body"><p>What if there are ruff-ecosystem and mypy_primer ecosystem changes (e.g. for changes in the parser / AST)? Should the generic workflow be triggered twice and manage two separate comments? Or should it be be triggered once and then loop internally? Or should it be triggered once and even try to merge those changes into a single PR comment?</p>
<p>Even in the simplest case (triggered twice), this will require quite a bit of parametrization (from which workflow was this triggered? where do we find the artifacts? what is the artifact filename? what is the special tag to find the comment? â€¦) and branching due to custom logic in the &quot;Generate comment content&quot; step.</p>
<p>I can attempt to do this, but I&#x27;d like to know the desired outcome first, because my GitHub actions &quot;skills&quot; are quite underdeveloped, so this will probably take me some time :upside_down_face:.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-10 14:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/mypy_primer_comment.yaml</code>:1 on 2025-03-10 14:13</div>
            <div class="timeline-body"><p>Hmm, that&#x27;s a good point. I didn&#x27;t consider that we may have to run both. So maybe it&#x27;s fine to keep it as is for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-10 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-03-10 14:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/mypy_primer_comment.yaml</code>:1 on 2025-03-10 14:22</div>
            <div class="timeline-body"><p>There are also advantages to keeping it similar to the mypy_primer workflow at typeshed/pyright/mypy, since I&#x27;m fairly familiar with the workflows in those repositories, and Shantanu is very familiar with the workflows in those repositories (and I&#x27;m sure Shantanu would be happy to help if we have issues!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-10 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>.github/workflows/mypy_primer_comment.yaml</code>:1 on 2025-03-10 14:24</div>
            <div class="timeline-body"><p>I didn&#x27;t copy over the typeshed/pyright/mypy workflow because I&#x27;m not sure that the sharding will be helpful. At least for now, the bottleneck is building Red Knot, not running it across on projects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-10 14:25</div>
            <div class="timeline-body"><p>Merging this to test it. Happy to make adjustments later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-10 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-10 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-10 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-03-10 14:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/mypy_primer_comment.yaml</code>:1 on 2025-03-10 14:26</div>
            <div class="timeline-body"><p>Yeah, pyright initially didn&#x27;t use sharding either. They also started off with a very minimal set of projects to run pyright on, but Shantanu and Eric worked together to expand it over time. After the list of projects grew large, pyright started using sharding as well.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:09 UTC
    </footer>
</body>
</html>
