<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Stabilize completions - astral-sh/ruff #18650</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Stabilize completions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18650">#18650</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-06-12 19:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>Specifically, this PR reverts &quot;Make completions an opt-in LSP feature (#17921)&quot;,
corresponding to commit 51e2effd2d6b6cf61bd245a3219168fe661d1a7d.</p>
<p>In practice, this means you don't need to opt into completions working
by enabling experimental features. i.e., I was able to remove this from
my LSP configuration:</p>
<pre><code>&quot;experimental&quot;: {
    &quot;completions&quot;: {
        &quot;enable&quot;: true
    }
},
</code></pre>
<p>There's still a lot of work left to do to make completions awesome, but
I think it's in a state where it would be useful to get real user
feedback. It's also meaningfully using ty to provide completions that
use type information.</p>
<p>Ref astral-sh/ty#86</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @BurntSushi on 2025-06-12 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @BurntSushi on 2025-06-12 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @BurntSushi on 2025-06-12 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @BurntSushi on 2025-06-12 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @BurntSushi on 2025-06-12 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-12 19:03</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @BurntSushi on 2025-06-12 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @BurntSushi on 2025-06-12 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-13 07:05</div>
            <div class="timeline-body"><p>I think @dhruvmanila expressed some concerns around stabilizing the feature. We should make sure that he reviewed this PR before merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/src/session/settings.rs</code>:38 on 2025-06-13 07:06</div>
            <div class="timeline-body"><p>This is, technically, a breaking change. I think it's fine, considering where we're at with ty.</p>
<p>We'll also need to update the <code>ty-vscode</code> extension to no longer list this option and update the documentation as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-06-13 07:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-06-13 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-06-13 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @MichaReiser on 2025-06-13 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-13 10:06</div>
            <div class="timeline-body"><p>At this stage, the ty language server doesn't have all the capabilities that a developer might use on a daily basis e.g., go to definition, rename, etc. This means that it's more than likely that the ty language server will be used alongside another language server (e.g., Pyright) to provide other capabilities. Now, if we stabilize this i.e., show completions without opt-in, it would mean that the completion menu would contain duplicate entries from both the language server.</p>
<p>One way to solve this, and is a solution that Pyrefly has implemented, would be to provide a <code>python.ty.disableLanguageServices</code> option that disables all the language services from ty and then the server will be used only for providing type checking diagnostics. This is something that I've implemented <a href="https://github.com/astral-sh/ty-vscode/pull/36">here</a> but is currently blocked on an upstream change (https://github.com/microsoft/vscode-python/pull/25041). This would mainly be useful in VS Code where we would add support for recognizing this option in the Python extension so that it can disable the Pylance language server when the user wants to use ty language server exclusively.</p>
<p>The above solution is not granular as it would either enable all language features or disable them, nothing in between. Another solution would be to provide granular configuration, like allowing users to use completions from ty but navigation capabilities like goto definition, declaration, etc. from another language server. Or, an even granular options that allows users to enable / disable each capability.</p>
<p><strong>tl;dr</strong> The main issue here is how do we allow users to keep using ty server's capabilities even when another language server is active. I'd prefer if we can wait until we have the <code>python.ty.disableLanguageServices</code> option in, so that users can still use ty for type checking and keep using another language server for other capabilities.</p>
<p>That said, I think we could still merge the PRs for adding the above config option on ty's side so that there's still an option for users to opt-out of language services like auto-completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-06-13 13:29</div>
            <div class="timeline-body"><p>Hmmm okay. Do we already have a problem today with conflicting LSPs running simultaneously? e.g., If you do a goto type definition request with ty and pyright enabled, which one services it?</p>
<p>Another issue I see is that even if we offer granular enable/disable options, that still seemingly requires the <em>other</em> LSP you use to <em>also</em> have granular enable/disable options.</p>
<p>I'm fine waiting here for <code>python.ty.disableLanguageServices</code>, but I'd prefer not doing that if it's truly blocked on upstream.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-13 14:08</div>
            <div class="timeline-body"><p>I think what we can do is:</p>
<ol>
<li>Merge this PR stabilizing completions</li>
<li>I'll make the <code>python.ty.disableLanguageServices</code> PRs ready for review for the ty server and ty VS Code extension</li>
<li>I'll open a PR in the Python extension to at least detect this option</li>
<li>I'll see if I can fix the issue as stated in https://github.com/microsoft/vscode-python/pull/25041 in that PR</li>
</ol>
<p>Pyrefly has a hack that does the refresh on their VS Code extension. I'd prefer and see if I can just fix the issue on the Python extension side. I just didn't prioritized it as it wasn't that helpful earlier but given that completions would be available it might be useful to prioritize that now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-13 14:11</div>
            <div class="timeline-body"><p>So, all in all, I'm fine moving ahead with this PR.</p>
<p>We should also remove this option from https://github.com/astral-sh/ty/blob/main/docs/reference/editor-settings.md#experimental.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-13 14:13</div>
            <div class="timeline-body"><blockquote>
<p>Hmmm okay. Do we already have a problem today with conflicting LSPs running simultaneously? e.g., If you do a goto type definition request with ty and pyright enabled, which one services it?</p>
</blockquote>
<p>I think this depends on client implementation. For example, Neovim supports multiple servers for navigation capabilities like goto type definition where it'll collect all the locations for the request from all the available language servers and provide them as quickfix list so you can navigate through all available options.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-06-13 16:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @sharkdp on 2025-06-14 07:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2025-06-16 11:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-06-16 11:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-16 11:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:22 UTC
    </footer>
</body>
</html>
