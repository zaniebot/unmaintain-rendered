<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Render concise snapshots in linter tests - astral-sh/ruff #19916</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Render concise snapshots in linter tests</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19916">#19916</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-08-14 13:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body">Summary
<p>This is a quick implementation of the idea in <a href="https://github.com/astral-sh/ruff/pull/19900">astral-sh/ruff#19900</a>#issuecomment-3188463902. Especially as we start using new diagnostic features, it seems like a good idea to keep an eye on the <code>concise</code> output format as well as the <code>full</code>. This PR just appends a second rendering of the diagnostics in our rule snapshots in the <code>concise</code> format. The concise message is typically reused in the other output formats too, so this kind of gives us a bit of coverage for all the output formats.</p>
<p>I noticed that some of our concise messages are still quite long. That might be another good class of diagnostic to use new features for. Some explanatory pieces might fit better as sub-diagnostics, now that we&#x27;re not limited to a single line in the default case.</p>
<p>Adding these lines (and adding a <code>let</code> binding for <code>emitter</code>) is the only code change:</p>
<p>https://github.com/astral-sh/ruff/blob/1fbb88f6505a2f05b30267defed0e62ca88e196a/crates/ruff_linter/src/test.rs#L371-L383</p>
Test Plan
<p>Existing snapshots. Again, I clicked through these individually, but very, very quickly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-14 14:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-14 14:10</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-14 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-14 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-14 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-18 07:32</div>
            <div class="timeline-body"><p>Thanks for looking into this.</p>
<p>IMO, this contains too much redundant information and will only increase the noise when making changes to our tests. That&#x27;s why I&#x27;d prefer a more granular opt in to testing the concise output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/AlexWaygood">@AlexWaygood</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-18 07:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-18 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-18 12:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:17:43 UTC
    </footer>
</body>
</html>
