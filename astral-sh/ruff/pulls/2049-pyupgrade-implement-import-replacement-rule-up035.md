```yaml
number: 2049
title: "[`pyupgrade`] Implement import-replacement rule (`UP035`)"
type: pull_request
state: merged
author: colin99d
labels: []
assignees: []
merged: true
base: main
head: ImportReplacements
created_at: 2023-01-21T03:55:58Z
updated_at: 2023-01-31T00:58:29Z
url: https://github.com/astral-sh/ruff/pull/2049
synced_at: 2026-01-12T04:52:00Z
```

# [`pyupgrade`] Implement import-replacement rule (`UP035`)

---

_Pull request opened by @colin99d on 2023-01-21 03:55_

A part of #827. I started this trying to use libcst. However, if found it added a lot of complexity because I have to change the order of the imports, which really messed up the formatting. If you know of a good way to handle this I will be happy to switch.

---

_Comment by @colin99d on 2023-01-21 19:39_

@charliermarsh , I don't love the way I am handling muli-line imports. Pretty much, if there is a match I am always changing it to:
```
from unmatching (
    import1,
    import2
)
from matching {
    import1
    import2
)
```
However, I think this might be the best way for a few reasons:
1. Libcst makes this a lot more complicated (unless there is something I am missing)
2. If we are adding our own version of black, it makes sense for these functions to export in one standard way, and then let black clean up the change
3. This standardizes all ruff code, which may be beneficial

---

_Comment by @colin99d on 2023-01-22 21:57_

I am moving this out of draft status. However, I will still be adding some more test cases to make sure it always works.

---

_Marked ready for review by @colin99d on 2023-01-22 22:42_

---

_@sbrugman reviewed on 2023-01-25 23:09_

---

_Review comment by @sbrugman on `src/rules/pyupgrade/rules/import_replacements_six.rs`:16 on 2023-01-25 23:09_

Would initialising from an array not be better suited here?
(Should be more performant, but might be compiled away anyway)
```
let solar_distance = HashMap::from([
    ("Mercury", 0.4),
    ("Venus", 0.7),
    ("Earth", 1.0),
    ("Mars", 1.5),
]);
```

---

_@sbrugman reviewed on 2023-01-25 23:11_

---

_Review comment by @sbrugman on `src/rules/pyupgrade/rules/import_replacements_six.rs`:117 on 2023-01-25 23:11_

`stylist.line_ending().as_str()` to have appropriate cross-platform line ending

---

_Review comment by @sbrugman on `src/rules/pyupgrade/snapshots/ruff__rules__pyupgrade__tests__UP035_UP035.py.snap`:14 on 2023-01-25 23:12_

The snap format has changed (slightly) to accommodate newlines. Should be autogenerated after a rebase and test run

---

_@sbrugman reviewed on 2023-01-25 23:12_

---

_Review comment by @sbrugman on `src/violations.rs`:3221 on 2023-01-25 23:13_

Violations have moved to the specific module, might as well move these directly into `pyupgrade`

---

_@sbrugman reviewed on 2023-01-25 23:13_

---

_@sbrugman reviewed on 2023-01-25 23:14_

---

_Review comment by @sbrugman on `src/rules/pyupgrade/rules/import_replacements_six.rs`:155 on 2023-01-25 23:14_

Pass `checker.stylist` here (charliermarsh prefers just after locator)

---

_Comment by @sbrugman on 2023-01-25 23:17_

A couple of pointers, hope it helps. Great effort üëç 

---

_Review comment by @colin99d on `src/violations.rs`:3221 on 2023-01-26 01:24_

I love this refactor! @charliermarsh, say the word and I will do it for the rest of the modules in pyupgrade.

---

_@colin99d reviewed on 2023-01-26 01:24_

---

_@colin99d reviewed on 2023-01-26 02:17_

---

_Review comment by @colin99d on `src/rules/pyupgrade/rules/import_replacements_six.rs`:155 on 2023-01-26 02:17_

Do you mind clarifying what you mean here. I interpret it as you want me to use `checker.stylist.locator`, but the `locator` member of `Stylist` is private. So I am assuming you mean something else.

---

_Comment by @colin99d on 2023-01-26 02:17_

Thanks for the feedback!

---

_Comment by @colin99d on 2023-01-29 01:39_

@charliermarsh what else do you want here for a merge (im not sure why only the windows texts are failing).

---

_Comment by @charliermarsh on 2023-01-29 01:43_

@colin99d - Nothing on your end. I just need to find time to review. Sorry for the delay. I'll rebase etc. when necessary.

---

_Comment by @colin99d on 2023-01-29 01:49_

Perfect! Just wanted to make sure you weren't waiting on something. Thank you for all the work you put into this!

---

_@charliermarsh reviewed on 2023-01-29 23:38_

---

_Review comment by @charliermarsh on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-29 23:38_

Why is the `six` stuff a separate rule? Is that following a `pyupgrade` convention?

This is maybe controversial, but my instinct is to skip all the explicit Python 2-to-Python 3 conversion stuff (like `six` conversions). We have some of that already, but it feels really one-time, whereas much of the other `pyupgrade` stuff is useful for new Python 3 code that's being written on an ongoing basis (e.g., the `typing` import replacements, or the type annotation rewrites, or the string format rewrites). Those kinds of things come up as you write new Python 3 code. But you'd never really expect to accidentally import `six` in new Python 3 code.

Does that make sense? In other words: I'm proposing that we omit the rules from `pyupgrade` that you'd expect to be "one-time changes".


---

_@charliermarsh reviewed on 2023-01-29 23:40_

---

_Review comment by @charliermarsh on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-29 23:40_

Although now that I'm looking at the code, again wondering what the difference is between the responsibilities of this rule and `import_replacements.rs` :)

---

_Review comment by @colin99d on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:01_

I actually agree with this a lot. It does not seem wise to me to maintain code, when the user could go directly to pyupgrade once, and then use us from then on. Would you like me to remove all of `import_replacements_six.rs`?

---

_@colin99d reviewed on 2023-01-30 00:01_

---

_@colin99d reviewed on 2023-01-30 00:02_

---

_Review comment by @colin99d on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:02_

I split them up because they function slightly differently, and I thought it would be easier to split the code.

---

_@charliermarsh reviewed on 2023-01-30 00:02_

---

_Review comment by @charliermarsh on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:02_

Does this file _also_ do some `six` import replacement though? E.g., this file has `SIX_MOVES_TO_COLLECTIONS`. (Just trying to understand before I chime in further.)

---

_@colin99d reviewed on 2023-01-30 00:09_

---

_Review comment by @colin99d on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:09_

Yes, I just handled the two groups a little differently, since pyupgrade did. I can also remove all references to six in `import_replacements.rs` as well if you like.

---

_@charliermarsh reviewed on 2023-01-30 00:10_

---

_Review comment by @charliermarsh on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:10_

Ok, sounds good. Let's do it, I think. We can also remove `src/rules/pyupgrade/rules/remove_six_compat.rs`, but lets do that separately, since we need to deprecate the actual check.

---

_Review comment by @charliermarsh on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:11_

(Do you want to make that change? I can also do it, I'm in this file now. Just LMK what you prefer.)

---

_@charliermarsh reviewed on 2023-01-30 00:11_

---

_Review comment by @colin99d on `src/rules/pyupgrade/rules/import_replacements_six.rs`:19 on 2023-01-30 00:13_

I can get it done!

---

_@colin99d reviewed on 2023-01-30 00:13_

---

_Comment by @colin99d on 2023-01-30 02:25_

@charliermarsh I got all the six stuff removed, would you like me to add a blurb in the readme about why we do not have six, and how users can run pyupgrade once, and then use us?

---

_Comment by @charliermarsh on 2023-01-30 02:26_

@colin99d - No that's ok. I'll add something to `BREAKING_CHANGES.md` and the release notes prior to release.

---

_Comment by @charliermarsh on 2023-01-30 04:30_

I want to change one more thing here, but hopefully it can go out tomorrow.

---

_Renamed from "Pyupgrade: Import Replacements" to "[`pyupgrade`] Implement import-replacement rule (`UP035`)" by @charliermarsh on 2023-01-31 00:58_

---

_Merged by @charliermarsh on 2023-01-31 00:58_

---

_Closed by @charliermarsh on 2023-01-31 00:58_

---
