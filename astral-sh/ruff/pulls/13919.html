<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`perflint`] implement quick-fix for `manual-list-comprehension` (`PERF401`) - astral-sh/ruff #13919</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>perflint</code>] implement quick-fix for <code>manual-list-comprehension</code> (<code>PERF401</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13919">#13919</a>
        opened by <a href="https://github.com/w0nder1ng">@w0nder1ng</a>
        on 2024-10-24 23:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/w0nder1ng">@w0nder1ng</a></div>
            <div class="timeline-body">Summary
<p>I implemented a fix to rewrite for-loops where PERF401 applies into <code>list.extend</code>s. Since the target is guaranteed to be a list, and the lint (seemingly) guarantees that the iterator doesn&#x27;t reference itself, this should be valid for all for-loops where the lint is applicable. It would be nice to implement this to rewrite the entire for-loop/variable assignment into a single list comprehensions, but I thought of several cases where this would affect how the code works, so this would need more consideration to write.</p>
Test Plan
<p>I tried this on local files and it seemed to work, but I couldn&#x27;t find where tests for <code>ruff check --fix</code> lints go. I&#x27;d be happy to add tests if someone points me in the right direction.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:21</div>
            <div class="timeline-body"><p>Nice, thank you.
Would you mind adding a few tests showing the fix? Are there cases where a comprehension would be preferred over
<code>list.extend</code>. If so, then I don&#x27;t think we should provide a code fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-10-25 22:23</div>
            <div class="timeline-body"><p>Again, I&#x27;m not sure where to add tests for fixes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-26 07:52</div>
            <div class="timeline-body"><p>You can extend the existing tests. The testing framework runs your lint rule against the file and snapshots all created diagnostics with their fixes.</p>
<p>https://github.com/astral-sh/ruff/blob/b34278e0cd25a24b69f4786897ca80c19fc3d5f1/crates/ruff_linter/src/rules/perflint/mod.rs#L20</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-28 17:04</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+49 -49 violations, +0 -0 fixes in 4 projects; 50 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+31 -31 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/ci_commands.py#L374">dev/breeze/src/airflow_breeze/commands/ci_commands.py:374:25:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/ci_commands.py#L374">dev/breeze/src/airflow_breeze/commands/ci_commands.py:374:25:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/release_management_commands.py#L3055">dev/breeze/src/airflow_breeze/commands/release_management_commands.py:3055:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/release_management_commands.py#L3055">dev/breeze/src/airflow_breeze/commands/release_management_commands.py:3055:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/sbom_commands.py#L973">dev/breeze/src/airflow_breeze/commands/sbom_commands.py:973:13:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/sbom_commands.py#L973">dev/breeze/src/airflow_breeze/commands/sbom_commands.py:973:13:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/params/shell_params.py#L385">dev/breeze/src/airflow_breeze/params/shell_params.py:385:13:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/params/shell_params.py#L385">dev/breeze/src/airflow_breeze/params/shell_params.py:385:13:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py#L32">dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py:32:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py#L32">dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py:32:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/packages.py#L326">dev/breeze/src/airflow_breeze/utils/packages.py:326:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/packages.py#L326">dev/breeze/src/airflow_breeze/utils/packages.py:326:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/reproducible.py#L124">dev/breeze/src/airflow_breeze/utils/reproducible.py:124:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/reproducible.py#L124">dev/breeze/src/airflow_breeze/utils/reproducible.py:124:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L1073">dev/breeze/src/airflow_breeze/utils/selective_checks.py:1073:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L1073">dev/breeze/src/airflow_breeze/utils/selective_checks.py:1073:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L103">docs/exts/docs_build/fetch_inventories.py:103:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L103">docs/exts/docs_build/fetch_inventories.py:103:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L111">docs/exts/docs_build/fetch_inventories.py:111:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L111">docs/exts/docs_build/fetch_inventories.py:111:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L119">docs/exts/docs_build/fetch_inventories.py:119:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L119">docs/exts/docs_build/fetch_inventories.py:119:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L486">providers/src/airflow/providers/amazon/aws/hooks/s3.py:486:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L486">providers/src/airflow/providers/amazon/aws/hooks/s3.py:486:21:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L669">providers/src/airflow/providers/amazon/aws/hooks/s3.py:669:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L669">providers/src/airflow/providers/amazon/aws/hooks/s3.py:669:21:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py#L122">providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py:122:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py#L122">providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py:122:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/operators/sagemaker.py#L1210">providers/src/airflow/providers/amazon/aws/operators/sagemaker.py:1210:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/operators/sagemaker.py#L1210">providers/src/airflow/providers/amazon/aws/operators/sagemaker.py:1210:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/operators/sagemaker.py#L379">providers/src/airflow/providers/amazon/aws/operators/sagemaker.py:379:17:</a> PERF401 Use `list.extend` to create a transformed list
... 31 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/apache/superset">apache/superset</a> (+11 -11 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/scripts/benchmark_migration.py#L128">scripts/benchmark_migration.py:128:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/scripts/benchmark_migration.py#L128">scripts/benchmark_migration.py:128:21:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/db_engine_specs/base.py#L107">superset/db_engine_specs/base.py:107:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/db_engine_specs/base.py#L107">superset/db_engine_specs/base.py:107:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/tasks/cache.py#L192">superset/tasks/cache.py:192:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/tasks/cache.py#L192">superset/tasks/cache.py:192:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/utils/core.py#L1184">superset/utils/core.py:1184:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/utils/core.py#L1184">superset/utils/core.py:1184:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/tests/integration_tests/charts/api_tests.py#L353">tests/integration_tests/charts/api_tests.py:353:13:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/tests/integration_tests/charts/api_tests.py#L353">tests/integration_tests/charts/api_tests.py:353:13:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/tests/integration_tests/charts/api_tests.py#L467">tests/integration_tests/charts/api_tests.py:467:13:</a> PERF401 Use `list.extend` to create a transformed list
... 11 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+7 -7 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/layouts.py#L475">src/bokeh/layouts.py:475:25:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/layouts.py#L475">src/bokeh/layouts.py:475:25:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L479">src/bokeh/plotting/_figure.py:479:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L479">src/bokeh/plotting/_figure.py:479:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L485">src/bokeh/plotting/_figure.py:485:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L485">src/bokeh/plotting/_figure.py:485:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/contexts.py#L310">src/bokeh/server/contexts.py:310:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/contexts.py#L310">src/bokeh/server/contexts.py:310:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/settings.py#L780">src/bokeh/settings.py:780:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/settings.py#L780">src/bokeh/settings.py:780:21:</a> PERF401 Use a list comprehension to create a transformed list
... 4 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+0 -0 violations, +0 -0 fixes)
<p>

<pre>
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PERF401 | 98 | 49 | 49 | 0 | 0 |</p>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+49 -49 violations, +0 -0 fixes in 3 projects; 51 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+31 -31 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/ci_commands.py#L374">dev/breeze/src/airflow_breeze/commands/ci_commands.py:374:25:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/ci_commands.py#L374">dev/breeze/src/airflow_breeze/commands/ci_commands.py:374:25:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/release_management_commands.py#L3055">dev/breeze/src/airflow_breeze/commands/release_management_commands.py:3055:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/release_management_commands.py#L3055">dev/breeze/src/airflow_breeze/commands/release_management_commands.py:3055:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/sbom_commands.py#L973">dev/breeze/src/airflow_breeze/commands/sbom_commands.py:973:13:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/commands/sbom_commands.py#L973">dev/breeze/src/airflow_breeze/commands/sbom_commands.py:973:13:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/params/shell_params.py#L385">dev/breeze/src/airflow_breeze/params/shell_params.py:385:13:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/params/shell_params.py#L385">dev/breeze/src/airflow_breeze/params/shell_params.py:385:13:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py#L32">dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py:32:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py#L32">dev/breeze/src/airflow_breeze/utils/exclude_from_matrix.py:32:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/packages.py#L326">dev/breeze/src/airflow_breeze/utils/packages.py:326:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/packages.py#L326">dev/breeze/src/airflow_breeze/utils/packages.py:326:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/reproducible.py#L124">dev/breeze/src/airflow_breeze/utils/reproducible.py:124:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/reproducible.py#L124">dev/breeze/src/airflow_breeze/utils/reproducible.py:124:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L1073">dev/breeze/src/airflow_breeze/utils/selective_checks.py:1073:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L1073">dev/breeze/src/airflow_breeze/utils/selective_checks.py:1073:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L103">docs/exts/docs_build/fetch_inventories.py:103:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L103">docs/exts/docs_build/fetch_inventories.py:103:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L111">docs/exts/docs_build/fetch_inventories.py:111:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L111">docs/exts/docs_build/fetch_inventories.py:111:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L119">docs/exts/docs_build/fetch_inventories.py:119:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/docs/exts/docs_build/fetch_inventories.py#L119">docs/exts/docs_build/fetch_inventories.py:119:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L486">providers/src/airflow/providers/amazon/aws/hooks/s3.py:486:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L486">providers/src/airflow/providers/amazon/aws/hooks/s3.py:486:21:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L669">providers/src/airflow/providers/amazon/aws/hooks/s3.py:669:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/hooks/s3.py#L669">providers/src/airflow/providers/amazon/aws/hooks/s3.py:669:21:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py#L122">providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py:122:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py#L122">providers/src/airflow/providers/amazon/aws/log/s3_task_handler.py:122:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/operators/sagemaker.py#L1210">providers/src/airflow/providers/amazon/aws/operators/sagemaker.py:1210:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/operators/sagemaker.py#L1210">providers/src/airflow/providers/amazon/aws/operators/sagemaker.py:1210:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/airflow/blob/ccb18abdba26978c31db6bd3407689c73322273c/providers/src/airflow/providers/amazon/aws/operators/sagemaker.py#L379">providers/src/airflow/providers/amazon/aws/operators/sagemaker.py:379:17:</a> PERF401 Use `list.extend` to create a transformed list
... 31 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/apache/superset">apache/superset</a> (+11 -11 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/scripts/benchmark_migration.py#L128">scripts/benchmark_migration.py:128:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/scripts/benchmark_migration.py#L128">scripts/benchmark_migration.py:128:21:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/db_engine_specs/base.py#L107">superset/db_engine_specs/base.py:107:9:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/db_engine_specs/base.py#L107">superset/db_engine_specs/base.py:107:9:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/tasks/cache.py#L192">superset/tasks/cache.py:192:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/tasks/cache.py#L192">superset/tasks/cache.py:192:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/utils/core.py#L1184">superset/utils/core.py:1184:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/superset/utils/core.py#L1184">superset/utils/core.py:1184:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/tests/integration_tests/charts/api_tests.py#L353">tests/integration_tests/charts/api_tests.py:353:13:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/tests/integration_tests/charts/api_tests.py#L353">tests/integration_tests/charts/api_tests.py:353:13:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/apache/superset/blob/683ed0d943c3c3e9d6a25e64829eae7e7bc2b2bb/tests/integration_tests/charts/api_tests.py#L467">tests/integration_tests/charts/api_tests.py:467:13:</a> PERF401 Use `list.extend` to create a transformed list
... 11 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+7 -7 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/layouts.py#L475">src/bokeh/layouts.py:475:25:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/layouts.py#L475">src/bokeh/layouts.py:475:25:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L479">src/bokeh/plotting/_figure.py:479:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L479">src/bokeh/plotting/_figure.py:479:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L485">src/bokeh/plotting/_figure.py:485:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/plotting/_figure.py#L485">src/bokeh/plotting/_figure.py:485:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/contexts.py#L310">src/bokeh/server/contexts.py:310:17:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/contexts.py#L310">src/bokeh/server/contexts.py:310:17:</a> PERF401 Use a list comprehension to create a transformed list
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/settings.py#L780">src/bokeh/settings.py:780:21:</a> PERF401 Use `list.extend` to create a transformed list
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/settings.py#L780">src/bokeh/settings.py:780:21:</a> PERF401 Use a list comprehension to create a transformed list
... 4 additional changes omitted for project
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PERF401 | 98 | 49 | 49 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-10-28 17:07</div>
            <div class="timeline-body"><p>One thing that I wasn&#x27;t sure how to handle is cases where there is control flow between the binding and the loop.</p>
<pre><code>def f(early_return):
    result = []
    if early_return:
        return
    for i in range(10):
        result.append(i+1)
</code></pre>
<p>Currently, this fix offers to rewrite the code:</p>
<pre><code>def f(early_return):
    result = [i+1 for i in range(10)]
    if early_return:
        return
</code></pre>
<p>How do you think this case ought to be handled?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`PERF401`] implement quick-fix for `manual-list-comprehension` (`PERF401`)&quot; to &quot;[`perflint`] implement quick-fix for `manual-list-comprehension` (`PERF401`)&quot; by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-10-28 18:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:60 on 2024-10-29 17:29</div>
            <div class="timeline-body"><p>Let&#x27;s adjust the message to make use of the new <code>comprehension_type</code> as well to avoid inconsistency between the message and the fix title.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:242 on 2024-10-29 17:52</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code>    let binding_has_one_target = {
        match binding_stmt.map(|binding_stmt| binding_stmt.targets.as_slice()) {
            Some([only_target]) =&gt; only_target.is_name_expr(),
            _ =&gt; false,
        }
    };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:248 on 2024-10-29 17:58</div>
            <div class="timeline-body"><p>Nit: the check for <code>binding_stmt.is_some</code> here seems unnecessary because <code>comprehension_type</code> can only be <code>List</code> when <code>binding_is_empty_list</code> is true.</p>
<p>I suggest that we merge the <code>comprehension_type</code> definition on line 218 with the definition here:</p>
<pre><code>    let comprehension_type = if binding_is_empty_list
        &amp;&amp; assignment_in_same_statement
        &amp;&amp; binding_has_one_target
    {
        ComprehensionType::ListComprehension
    } else {
        ComprehensionType::Extend
    };
</code></pre>
<p>This should also simplify the match statement inside of <code>try_set_optional_fix</code> because it&#x27;s no longer necessary to match on <code>Option&lt;ComprehensionType&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:261 on 2024-10-30 06:53</div>
            <div class="timeline-body"><p>Let&#x27;s gate the new fix behind preview <code>if checker.settings.preview.is_enabled() { ... }</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/snapshots/ruff_linter__rules__perflint__tests__PERF401_PERF401.py.snap</code>:21 on 2024-10-30 06:54</div>
            <div class="timeline-body"><p>The comment handling is a bit weird. Is there anything we can do to improve it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-10-30 06:56</div>
            <div class="timeline-body"><p>This looks great. Thanks for working on this fix.</p>
<p>I have a few smaller code improvements that are up to you. The one change we should make is to gate the fix behind preview to give us a chance to catch any errors before rolling it out to all users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/w0nder1ng">@w0nder1ng</a> reviewed on 2024-11-01 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on <code>crates/ruff_linter/src/rules/perflint/snapshots/ruff_linter__rules__perflint__tests__PERF401_PERF401.py.snap</code>:21 on 2024-11-01 15:07</div>
            <div class="timeline-body"><p>I also just noticed that comments which are inside of the for loop get deleted, so I&#x27;ll see if I can modify it so it keeps those and fixes the whitespace</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-01 15:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/snapshots/ruff_linter__rules__perflint__tests__PERF401_PERF401.py.snap</code>:21 on 2024-11-01 15:45</div>
            <div class="timeline-body"><p>That might be fine. I wouldn&#x27;t spent too much time on it. The way we normally preserve comments is by not using generator and instead build the fix directly from source (by doing string manipulations)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-11-03 21:49</div>
            <div class="timeline-body"><p>I&#x27;ve modified the code to preserve comments and not leave a newline when removing the for loop. The tests seem to be failing because the fix is now gated behind a preview--is there a way to allow the test to set the preview flag, or should I temporarily change the fix availability to &quot;sometimes&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-04 03:20</div>
            <div class="timeline-body"><blockquote>
<p>The tests seem to be failing because the fix is now gated behind a preview--is there a way to allow the test to set the preview flag, or should I temporarily change the fix availability to &quot;sometimes&quot;?</p>
</blockquote>
<p>@w0nder1ng You&#x27;ll need to add a new test case where the preview flag is enabled. Refer to the following as an example:</p>
<p>https://github.com/astral-sh/ruff/blob/8d7dda9fb7066f02ebedc1e63a270861816c4c72/crates/ruff_linter/src/rules/ruff/mod.rs#L386-L402</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-11-04 16:00</div>
            <div class="timeline-body"><p>How should I deal with the existing test case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-05 07:16</div>
            <div class="timeline-body"><blockquote>
<p>How should I deal with the existing test case?</p>
</blockquote>
<p>You would have to mark the rule as sometimes fixable. I suggest to add a <code>TODO</code> comment to the preview check that says that the rule should be changed to always fixable when promoting the fix to stable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:68 on 2024-11-06 11:47</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code>            Some(ComprehensionType::ListComprehension) | None =&gt; &quot;comprehension&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:233 on 2024-11-06 11:48</div>
            <div class="timeline-body"><p>Nit: We can avoid looking up the <code>for_loop_parent</code> if the <code>binding</code> is <code>None</code></p>
<pre><code>        binding.source.is_some_and(|binding_source| {
        	  let for_loop_parent = checker.semantic().current_statement_parent_id();
            let binding_parent = checker.semantic().parent_statement_id(binding_source);
            for_loop_parent == binding_parent
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:262 on 2024-11-06 11:48</div>
            <div class="timeline-body"><pre><code>    // TODO: once this fix is stabilized, change the rule to always fixable
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:307 on 2024-11-06 11:53</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code>    let elt_str = locator.slice(to_append);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:294 on 2024-11-06 11:54</div>
            <div class="timeline-body"><p>Nit: Let&#x27;s move this closer to where it&#x27;s used (line 320). It should help with readability</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/perflint/rules/manual_list_comprehension.rs</code>:72 on 2024-11-06 12:04</div>
            <div class="timeline-body"><p>The message with <code>extend</code> reads a bit off. <code>Use a list extend to create a transformed list</code>. It should be something like <code>Use </code>list.extend<code> to append to an existing list</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-06 12:09</div>
            <div class="timeline-body"><p>This is great</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-11-07 01:54</div>
            <div class="timeline-body"><p>I changed the diagnostic message, does the new one make more sense? Also, do you know why the tests aren&#x27;t running?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-07 04:06</div>
            <div class="timeline-body"><p>@w0nder1ng there are merge conflicts which needs to be resolved to get the CI running</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-08 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-08 08:31</div>
            <div class="timeline-body"><p>This is great and very impressive comment handling!</p>
<p>I pushed a small change that uses the improved message even in stable mode</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-08 08:33</div>
            <div class="timeline-body"><p>Hmm, what&#x27;s up with the ecosystem check... Let&#x27;s re-run to get a better sense of the changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-08 08:48</div>
            <div class="timeline-body"><p>I suspect that the ecosystem check is panicking during the fix generation. Let me run it locally</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-11-08 08:56</div>
            <div class="timeline-body"><p>Here&#x27;s an example that currently panics:</p>
<pre><code># Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# &quot;License&quot;); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
&quot;&quot;&quot;migrate_old_annotation_layers

Revision ID: 21e88bc06c02
Revises: 67a6ac9b727b
Create Date: 2017-12-17 11:06:30.180267

&quot;&quot;&quot;

from alembic import op
from sqlalchemy import Column, Integer, or_, String, Text
from sqlalchemy.ext.declarative import declarative_base

from superset import db
from superset.utils import json

# revision identifiers, used by Alembic.
revision = &quot;21e88bc06c02&quot;
down_revision = &quot;67a6ac9b727b&quot;

Base = declarative_base()


class Slice(Base):
    __tablename__ = &quot;slices&quot;
    id = Column(Integer, primary_key=True)
    viz_type = Column(String(250))
    params = Column(Text)


def upgrade():
    bind = op.get_bind()
    session = db.Session(bind=bind)

    for slc in session.query(Slice).filter(
        or_(Slice.viz_type.like(&quot;line&quot;), Slice.viz_type.like(&quot;bar&quot;))
    ):
        params = json.loads(slc.params)
        layers = params.get(&quot;annotation_layers&quot;, [])
        if layers:
            new_layers = []
            for layer in layers:
                new_layers.append(
                    {
                        &quot;annotationType&quot;: &quot;INTERVAL&quot;,
                        &quot;style&quot;: &quot;solid&quot;,
                        &quot;name&quot;: f&quot;Layer {layer}&quot;,
                        &quot;show&quot;: True,
                        &quot;overrides&quot;: {&quot;since&quot;: None, &quot;until&quot;: None},
                        &quot;value&quot;: layer,
                        &quot;width&quot;: 1,
                        &quot;sourceType&quot;: &quot;NATIVE&quot;,
                    }
                )
            params[&quot;annotation_layers&quot;] = new_layers
            slc.params = json.dumps(params)
            session.commit()
    session.close()


def downgrade():
    bind = op.get_bind()
    session = db.Session(bind=bind)

    for slc in session.query(Slice).filter(
        or_(Slice.viz_type.like(&quot;line&quot;), Slice.viz_type.like(&quot;bar&quot;))
    ):
        params = json.loads(slc.params)
        layers = params.get(&quot;annotation_layers&quot;, [])
        if layers:
            params[&quot;annotation_layers&quot;] = [layer[&quot;value&quot;] for layer in layers]
            slc.params = json.dumps(params)
            session.commit()
    session.close()

</code></pre>
<p>@w0nder1ng could you take a look at what&#x27;s the source of the panic?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-11-08 16:13</div>
            <div class="timeline-body"><p>The issue was that having no comments inside the for loop caused an empty insert, and that made a debug assert panic. The reason I didn&#x27;t catch it before was because every test case for the fix has <code># PERF401</code> following the lint target! I added a new test case to hopefully spot this type of error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/w0nder1ng">@w0nder1ng</a> on 2024-11-08 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-11 11:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-11 11:16</div>
            <div class="timeline-body"><p>Ah, that makes sense. This is great. Thank you so much for working on the fix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-11 11:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-11 11:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:07:47 UTC
    </footer>
</body>
</html>
