<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid short-circuiting when detecting RET rules - astral-sh/ruff #4002</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid short-circuiting when detecting RET rules</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4002">#4002</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-04-18 02:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-18 02:35</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>We have some logic in the <code>RET</code> rule set that ejects from checking certain rules as soon as we hit errors in other rules. This can lead to confusing situations whereby we surface one error, the user fixes it, re-runs Ruff, then sees a seemingly unrelated error (which was previously suppressed by our short-circuiting).</p>
<p>This behavior matched flake8-return, but I think it's clearer to just run all checks regardless of the outcomes of other checks.</p>
<p>Closes #3989.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-04-18 02:49</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+76, -0, 0 error(s))</p>
<details><summary>airflow (+38, -0)</summary>
<p>

<pre><code class="language-diff">+ airflow/executors/kubernetes_executor.py:144:13: RET505 Unnecessary `else` after `return` statement
+ airflow/models/dag.py:2387:9: RET506 Unnecessary `else` after `raise` statement
+ airflow/models/dagcode.py:185:16: RET504 Unnecessary variable assignment before `return` statement
+ airflow/models/renderedtifields.py:150:20: RET504 Unnecessary variable assignment before `return` statement
+ airflow/providers/amazon/aws/operators/eks.py:197:13: RET501 [*] Do not explicitly `return None` in function if it is the only possible return value
+ airflow/providers/amazon/aws/secrets/secrets_manager.py:266:20: RET504 Unnecessary variable assignment before `return` statement
+ airflow/providers/apache/beam/operators/beam.py:345:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/apache/beam/operators/beam.py:500:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/apache/beam/operators/beam.py:652:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/apache/livy/hooks/livy.py:674:9: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/cncf/kubernetes/hooks/kubernetes.py:462:9: RET505 Unnecessary `elif` after `return` statement
+ airflow/providers/common/sql/sensors/sql.py:108:13: RET505 Unnecessary `else` after `return` statement
+ airflow/providers/dbt/cloud/operators/dbt.py:157:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/docker/operators/docker.py:390:13: RET505 Unnecessary `elif` after `return` statement
+ airflow/providers/docker/operators/docker.py:396:21: RET505 Unnecessary `else` after `return` statement
+ airflow/providers/google/cloud/operators/cloud_composer.py:606:13: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/google/cloud/transfers/cassandra_to_gcs.py:284:13: RET505 Unnecessary `else` after `return` statement
+ airflow/providers/google/cloud/transfers/gcs_to_bigquery.py:474:9: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/google/cloud/transfers/gcs_to_bigquery.py:499:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/google_vendor/googleads/interceptors/logging_interceptor.py:138:13: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/providers/papermill/operators/papermill.py:88:9: RET506 Unnecessary `elif` after `raise` statement
+ airflow/providers/trino/hooks/trino.py:141:16: RET504 Unnecessary variable assignment before `return` statement
+ airflow/sensors/base.py:252:13: RET506 Unnecessary `else` after `raise` statement
+ airflow/sensors/bash.py:105:25: RET505 Unnecessary `else` after `return` statement
+ airflow/sensors/external_task.py:301:13: RET506 Unnecessary `elif` after `raise` statement
+ airflow/serialization/serialized_objects.py:484:13: RET505 Unnecessary `elif` after `return` statement
+ airflow/serialization/serialized_objects.py:526:9: RET505 Unnecessary `elif` after `return` statement
+ airflow/serialization/serialized_objects.py:558:13: RET505 Unnecessary `elif` after `return` statement
+ airflow/serialization/serialized_objects.py:562:13: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/utils/dates.py:206:13: RET505 Unnecessary `else` after `return` statement
+ airflow/utils/helpers.py:349:13: RET507 Unnecessary `elif` after `continue` statement
+ airflow/utils/helpers.py:361:13: RET507 Unnecessary `elif` after `continue` statement
+ airflow/www/fab_security/manager.py:1235:13: RET505 Unnecessary `else` after `return` statement
+ airflow/www/fab_security/manager.py:544:9: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ airflow/www/fab_security/sqla/manager.py:177:9: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ dev/breeze/src/airflow_breeze/commands/ci_image_commands.py:403:17: RET505 Unnecessary `else` after `return` statement
+ dev/breeze/src/airflow_breeze/utils/confirm.py:82:21: RET505 Unnecessary `else` after `return` statement
+ tests/test_utils/logging_command_executor.py:103:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
</code></pre>
</p>
</details>
<details><summary>bokeh (+21, -0)</summary>
<p>

<pre><code class="language-diff">+ examples/server/app/clustering/main.py:96:5: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/client/connection.py:332:13: RET501 [*] Do not explicitly `return None` in function if it is the only possible return value
+ src/bokeh/core/serialization.py:291:13: RET505 Unnecessary `else` after `return` statement
+ src/bokeh/core/serialization.py:394:17: RET505 Unnecessary `elif` after `return` statement
+ src/bokeh/core/serialization.py:403:17: RET505 Unnecessary `elif` after `return` statement
+ src/bokeh/core/serialization.py:409:13: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/core/serialization.py:466:9: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/core/serialization.py:550:21: RET505 Unnecessary `else` after `return` statement
+ src/bokeh/core/serialization.py:553:21: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/core/serialization.py:569:13: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/core/serialization.py:708:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/core/serialization.py:714:17: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ src/bokeh/models/plots.py:524:9: RET505 Unnecessary `else` after `return` statement
+ src/bokeh/plotting/_plot.py:153:9: RET505 Unnecessary `elif` after `return` statement
+ src/bokeh/server/tornado.py:326:9: RET506 Unnecessary `elif` after `raise` statement
+ src/bokeh/server/tornado.py:332:9: RET506 Unnecessary `elif` after `raise` statement
+ src/bokeh/server/tornado.py:338:9: RET506 Unnecessary `elif` after `raise` statement
+ src/bokeh/server/tornado.py:345:9: RET506 Unnecessary `elif` after `raise` statement
+ src/bokeh/server/tornado.py:356:9: RET506 Unnecessary `elif` after `raise` statement
+ src/bokeh/server/tornado.py:374:9: RET506 Unnecessary `else` after `raise` statement
+ src/bokeh/server/views/ws.py:147:9: RET506 Unnecessary `elif` after `raise` statement
</code></pre>
</p>
</details>
<details><summary>zulip (+17, -0)</summary>
<p>

<pre><code class="language-diff">+ tools/lib/template_parser.py:340:9: RET505 Unnecessary `else` after `return` statement
+ tools/lib/template_parser.py:679:12: RET504 Unnecessary variable assignment before `return` statement
+ zerver/lib/addressee.py:141:13: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
+ zerver/lib/addressee.py:141:13: RET505 Unnecessary `elif` after `return` statement
+ zerver/lib/push_notifications.py:676:9: RET505 Unnecessary `else` after `return` statement
+ zerver/lib/remote_server.py:95:9: RET506 Unnecessary `else` after `raise` statement
+ zerver/management/commands/change_user_role.py:89:13: RET506 Unnecessary `elif` after `raise` statement
+ zerver/tests/test_openapi.py:466:21: RET507 Unnecessary `else` after `continue` statement
+ zerver/webhooks/freshstatus/view.py:177:9: RET505 Unnecessary `elif` after `return` statement
+ zerver/webhooks/freshstatus/view.py:190:9: RET505 Unnecessary `else` after `return` statement
+ zerver/webhooks/github/view.py:838:9: RET505 Unnecessary `else` after `return` statement
+ zerver/webhooks/lidarr/view.py:141:9: RET505 Unnecessary `else` after `return` statement
+ zerver/webhooks/radarr/view.py:101:9: RET505 Unnecessary `else` after `return` statement
+ zerver/webhooks/sonarr/view.py:160:9: RET505 Unnecessary `else` after `return` statement
+ zerver/webhooks/sonarr/view.py:167:9: RET505 Unnecessary `else` after `return` statement
+ zerver/webhooks/trello/view/card_actions.py:106:13: RET505 Unnecessary `else` after `return` statement
+ zproject/backends.py:1537:13: RET505 Unnecessary `else` after `return` statement
</code></pre>
</p>
</details>

<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                    pr
-----                                      ----                                    --
linter/all-rules/large/dataset.py          1.00     16.6±0.30ms     2.5 MB/sec     1.01     16.7±0.33ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.04      4.4±0.14ms     3.8 MB/sec     1.00      4.2±0.15ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00   545.2±31.46µs     5.4 MB/sec     1.05   574.8±28.09µs     5.1 MB/sec
linter/all-rules/pydantic/types.py         1.02      7.4±0.38ms     3.4 MB/sec     1.00      7.3±0.32ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.07      9.5±0.71ms     4.3 MB/sec     1.00      9.0±0.61ms     4.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.16  1933.9±178.25µs     8.6 MB/sec    1.00  1672.2±79.94µs    10.0 MB/sec
linter/default-rules/numpy/globals.py      1.00    196.0±7.30µs    15.1 MB/sec     1.03   201.6±13.66µs    14.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.5±0.24ms     7.4 MB/sec     1.05      3.6±0.31ms     7.0 MB/sec
parser/large/dataset.py                    1.08      7.0±0.31ms     5.8 MB/sec     1.00      6.5±0.43ms     6.2 MB/sec
parser/numpy/ctypeslib.py                  1.02  1381.0±37.65µs    12.1 MB/sec     1.00  1351.9±35.89µs    12.3 MB/sec
parser/numpy/globals.py                    1.05    140.5±7.53µs    21.0 MB/sec     1.00    133.9±5.72µs    22.0 MB/sec
parser/pydantic/types.py                   1.01      3.0±0.09ms     8.6 MB/sec     1.00      3.0±0.07ms     8.6 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     14.5±0.04ms     2.8 MB/sec    1.01     14.6±0.10ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.4±0.01ms     4.9 MB/sec    1.00      3.4±0.01ms     4.8 MB/sec
linter/all-rules/numpy/globals.py          1.00    380.3±1.89µs     7.8 MB/sec    1.01    383.6±6.82µs     7.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.9±0.02ms     4.3 MB/sec    1.01      6.0±0.02ms     4.3 MB/sec
linter/default-rules/large/dataset.py      1.00      7.4±0.02ms     5.5 MB/sec    1.01      7.5±0.10ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1537.9±5.56µs    10.8 MB/sec    1.01   1545.8±5.00µs    10.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    165.3±1.02µs    17.9 MB/sec    1.02    167.8±2.98µs    17.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.3±0.01ms     7.8 MB/sec    1.00      3.3±0.01ms     7.8 MB/sec
parser/large/dataset.py                    1.00      6.1±0.02ms     6.6 MB/sec    1.00      6.1±0.02ms     6.6 MB/sec
parser/numpy/ctypeslib.py                  1.00   1136.6±4.16µs    14.7 MB/sec    1.01   1143.6±4.13µs    14.6 MB/sec
parser/numpy/globals.py                    1.00    115.2±0.42µs    25.6 MB/sec    1.00    115.0±0.58µs    25.7 MB/sec
parser/pydantic/types.py                   1.00      2.5±0.01ms    10.0 MB/sec    1.00      2.5±0.01ms    10.0 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-04-18 02:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-04-18 02:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-04-18 02:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:29:49 UTC
    </footer>
</body>
</html>
