```yaml
number: 5438
title: Update Black tests
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: update-black-tests
created_at: 2023-06-29T11:03:33Z
updated_at: 2023-06-30T07:42:06Z
url: https://github.com/astral-sh/ruff/pull/5438
synced_at: 2026-01-12T15:55:18Z
```

# Update Black tests

---

_@MichaReiser_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This PR updates our Black tests, adds new tests, and introduces a script that automates the process of *importing* tests.

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

`cargo test`


---

_Comment by @MichaReiser on 2023-06-29 11:03_

Current dependencies on/for this PR:
* main
  * **PR #5438** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5438" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #5440** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5440" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #5441** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5441" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #5451** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5451" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5438?utm_source=stack-comment).

---

_Review requested from @konstin by @MichaReiser on 2023-06-29 11:04_

---

_Label `formatter` added by @MichaReiser on 2023-06-29 11:04_

---

_Comment by @github-actions[bot] on 2023-06-29 11:19_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      8.2Â±0.06ms     4.9 MB/sec    1.01      8.3Â±0.01ms     4.9 MB/sec
formatter/numpy/ctypeslib.py               1.00   1746.5Â±4.55Âµs     9.5 MB/sec    1.01   1755.5Â±2.24Âµs     9.5 MB/sec
formatter/numpy/globals.py                 1.00    188.3Â±0.60Âµs    15.7 MB/sec    1.01    189.6Â±0.91Âµs    15.6 MB/sec
formatter/pydantic/types.py                1.01      3.9Â±0.01ms     6.5 MB/sec    1.00      3.9Â±0.00ms     6.5 MB/sec
linter/all-rules/large/dataset.py          1.00     13.7Â±0.02ms     3.0 MB/sec    1.00     13.8Â±0.03ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5Â±0.01ms     4.8 MB/sec    1.00      3.5Â±0.00ms     4.8 MB/sec
linter/all-rules/numpy/globals.py          1.00    366.7Â±1.63Âµs     8.0 MB/sec    1.01    368.6Â±1.57Âµs     8.0 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1Â±0.02ms     4.2 MB/sec    1.00      6.1Â±0.02ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.00      7.1Â±0.01ms     5.7 MB/sec    1.00      7.1Â±0.01ms     5.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1476.7Â±3.11Âµs    11.3 MB/sec    1.00   1482.5Â±2.58Âµs    11.2 MB/sec
linter/default-rules/numpy/globals.py      1.00    158.0Â±0.14Âµs    18.7 MB/sec    1.01    159.6Â±0.16Âµs    18.5 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.2Â±0.00ms     8.0 MB/sec    1.01      3.2Â±0.01ms     8.0 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     10.0Â±0.44ms     4.1 MB/sec    1.01     10.1Â±0.35ms     4.0 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.1Â±0.03ms     8.0 MB/sec    1.00      2.1Â±0.05ms     8.0 MB/sec
formatter/numpy/globals.py                 1.00   233.1Â±14.51Âµs    12.7 MB/sec    1.01   235.8Â±12.65Âµs    12.5 MB/sec
formatter/pydantic/types.py                1.02      4.7Â±0.19ms     5.4 MB/sec    1.00      4.6Â±0.13ms     5.5 MB/sec
linter/all-rules/large/dataset.py          1.00     16.5Â±0.45ms     2.5 MB/sec    1.04     17.1Â±0.37ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.4Â±0.19ms     3.8 MB/sec    1.04      4.5Â±0.11ms     3.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    518.1Â±9.28Âµs     5.7 MB/sec    1.01   524.0Â±18.47Âµs     5.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.5Â±0.33ms     3.4 MB/sec    1.02      7.6Â±0.27ms     3.3 MB/sec
linter/default-rules/large/dataset.py      1.00      8.6Â±0.38ms     4.7 MB/sec    1.03      8.8Â±0.21ms     4.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1783.4Â±32.93Âµs     9.3 MB/sec    1.03  1831.2Â±81.45Âµs     9.1 MB/sec
linter/default-rules/numpy/globals.py      1.00    208.5Â±5.45Âµs    14.2 MB/sec    1.03    213.8Â±8.09Âµs    13.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.8Â±0.09ms     6.7 MB/sec    1.02      3.9Â±0.07ms     6.5 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:9 on 2023-06-29 15:04_

nit: `from pathlib import Path`

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:20 on 2023-06-29 15:06_

```suggestion
        black_input.open("r") as black_file,
        fixture_path.open("w") as fixture_file,
        expect_path.open("w") as expect_file
```

there's some bad cases on windows where that's needed but that should be the case here

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:10 on 2023-06-29 15:06_

```suggestion
    output_directory = pathlib.Path(__file__).parent.joinpath("black").joinpath(fixture_set)
```

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:26 on 2023-06-29 15:07_

no need for parentheses :P
```suggestion
        for i, line in enumerate(lines):
```

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:22 on 2023-06-29 15:08_

you should be able to just iterate over the file, lines is the default

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:79 on 2023-06-29 15:09_

Does `fixture_directory.glob("*.py")` work?

---

_@konstin approved on 2023-06-29 15:10_

---

_@MichaReiser reviewed on 2023-06-30 06:16_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:26 on 2023-06-30 06:16_

Surprisingly, black didn't remove them.... 

---

_@MichaReiser reviewed on 2023-06-30 06:21_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:22 on 2023-06-30 06:21_

Right, that also removes the need to use enumerate. Nice.

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:79 on 2023-06-30 06:25_

Nice. It also removes the need to later join the paths manually again.

---

_@MichaReiser reviewed on 2023-06-30 06:25_

---

_Merged by @MichaReiser on 2023-06-30 06:32_

---

_Closed by @MichaReiser on 2023-06-30 06:32_

---

_Branch deleted on 2023-06-30 06:32_

---

_@konstin reviewed on 2023-06-30 07:39_

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:31 on 2023-06-30 07:39_

sorry, it did not realize you're reusing lines here

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/resources/test/fixtures/import_black_tests.py`:31 on 2023-06-30 07:42_

Why sorry? It works like a charm. I don't have to use indices anymore, because the iterator now tracks all state :)

---

_@MichaReiser reviewed on 2023-06-30 07:42_

---
