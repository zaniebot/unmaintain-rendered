<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-use-pathlib`] Add autofixes for `PTH203`, `PTH204`, `PTH205` - astral-sh/ruff #18922</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-use-pathlib</code>] Add autofixes for <code>PTH203</code>, <code>PTH204</code>, <code>PTH205</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18922">#18922</a>
        opened by <a href="https://github.com/chirizxc">@chirizxc</a>
        on 2025-06-24 19:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-24 19:40</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Part of #2331 | <a href="https://github.com/astral-sh/ruff/pull/18763#issuecomment-2988340436">#18763</a></p>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<p>update snapshots</p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @chirizxc on 2025-06-24 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-24 20:01</div>
            <div class="timeline-body"><p>idk why <code>cargo nextest run pth205</code> doesn't go through properly after these names
<img src="https://github.com/user-attachments/assets/d5f9f9fb-766c-408a-828a-6d0559ef8f65" alt="изображение" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 08:07</div>
            <div class="timeline-body"><p>You'll need to update the snapshots (they assert the expected output) using <code>cargo insta review</code> (https://insta.rs/docs/cli/)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 08:09</div>
            <div class="timeline-body"><blockquote>
<p>You'll need to update the snapshots (they assert the expected output) usi</p>
</blockquote>
<p>i did, but the problem is that they don't update correctly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 08:36</div>
            <div class="timeline-body"><blockquote>
<p>i did, but the problem is that they don't update correctly</p>
</blockquote>
<p>Can you say more about why they don't update correctly? I did</p>
<pre><code>cargo nextest run -p ruff_linter --no-fail-fast
cargo insta review
</code></pre>
<p>and the snapshots were updated correctly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 08:44</div>
            <div class="timeline-body"><blockquote>
<p>cargo insta review</p>
</blockquote>
<p><img src="https://github.com/user-attachments/assets/e2021aa9-1c86-426d-92e4-8d5722699e66" alt="изображение" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 08:45</div>
            <div class="timeline-body"><p>i applied the changes from past snapshots, but for some reason they didn't overwrite now, very strange</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 08:50</div>
            <div class="timeline-body"><p>Did you add them with <code>git add &lt;path to snapshot&gt;</code> or <code>git add .</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 08:51</div>
            <div class="timeline-body"><blockquote>
<p>Did you add them with <code>git add &lt;path to snapshot&gt;</code> or <code>git add .</code>?</p>
</blockquote>
<p>yes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 08:53</div>
            <div class="timeline-body"><p>Can you run <code>git status</code> and <code>git diff</code> and share the output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 08:55</div>
            <div class="timeline-body"><pre><code class="language-diff">❯ git status                                                                                                                                          
On branch feat/autofixes                                                                                                                              
Your branch is up to date with 'origin/feat/autofixes'.

Changes to be committed:
  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)
        modified:   crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH203_PTH203.py.snap
        new file:   crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__preview__PTH203_PTH203.py.snap
        new file:   crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__preview__PTH204_PTH204.py.snap
        new file:   crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__preview__PTH205_PTH205.py.snap

Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)
        modified:   crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
        modified:   crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH205_PTH205.py.
       ```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 08:55</div>
            <div class="timeline-body"><pre><code class="language-diff">❯ git diff                                                                                                                                            
diff --git a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
index b137cbd77..6d3b40def 100644
--- a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
+++ b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
@@ -1,51 +1,357 @@                                                                                                                                    
 ---
 source: crates/ruff_linter/src/rules/flake8_use_pathlib/mod.rs
-snapshot_kind: text                                                                                                                                  
 ---
-PTH204.py:6:1: PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`                                                                
-  |                                                                                                                                                  
-6 | os.path.getmtime(&quot;filename&quot;)                                                                                                                     
-  | ^^^^^^^^^^^^^^^^ PTH204                                                                                                                          
-7 | os.path.getmtime(b&quot;filename&quot;)                                                                                                                    
-8 | os.path.getmtime(Path(&quot;filename&quot;))                                                                                                               
-  |                                                                                                                                                  
+PTH204.py:11:1: PTH202 `os.path.getsize` should be replaced by `Path.stat().st_size`                                                                 
+   |                                                                                                                                                 
+11 | os.path.getmtime(&quot;filename&quot;)                                                                                                                    
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ PTH202                                                                                                             
+12 | os.path.getmtime(b&quot;filename&quot;)                                                                                                                   
+13 | os.path.getmtime(Path(&quot;filename&quot;))                                                                                                              
+   |                                                                                                                                                 
:...skipping...
diff --git a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
index b137cbd77..6d3b40def 100644
--- a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
+++ b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
@@ -1,51 +1,357 @@
 ---
 source: crates/ruff_linter/src/rules/flake8_use_pathlib/mod.rs
-snapshot_kind: text
 ---
-PTH204.py:6:1: PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
-  |
-6 | os.path.getmtime(&quot;filename&quot;)
-  | ^^^^^^^^^^^^^^^^ PTH204
-7 | os.path.getmtime(b&quot;filename&quot;)
-8 | os.path.getmtime(Path(&quot;filename&quot;))
-  |
+PTH204.py:11:1: PTH202 `os.path.getsize` should be replaced by `Path.stat().st_size`
+   |
+11 | os.path.getmtime(&quot;filename&quot;)
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ PTH202
+12 | os.path.getmtime(b&quot;filename&quot;)
+13 | os.path.getmtime(Path(&quot;filename&quot;))
+   |
+   = help: Replace with `Path(...).stat().st_size`
+
+PTH204.py:12:1: PTH202 `os.path.getsize` should be replaced by `Path.stat().st_size`
+   |
+11 | os.path.getmtime(&quot;filename&quot;)
 ESCOD
diff --git a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
index b137cbd77..6d3b40def 100644
--- a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
+++ b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
index b137cbd77..6d3b40def 100644
--- a/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
+++ b/crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH204_PTH204.py.snap
@@ -1,51 +1,357 @@                                                                                                                                    
 ---
 source: crates/ruff_linter/src/rules/flake8_use_pathlib/mod.rs
-snapshot_kind: text                                                                                                                                  
 ---
-PTH204.py:6:1: PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`                                                                
-  |                                                                                                                                                  
-6 | os.path.getmtime(&quot;filename&quot;)                                                                                                                     
-  | ^^^^^^^^^^^^^^^^ PTH204                                                                                                                          
-7 | os.path.getmtime(b&quot;filename&quot;)                                                                                                                    
-8 | os.path.getmtime(Path(&quot;filename&quot;))                                                                                                               
-  |                                                                                                                                                  
+PTH204.py:11:1: PTH202 `os.path.getsize` should be replaced by `Path.stat().st_size`                                                                 
+   |                                                                                                                                                 
+11 | os.path.getmtime(&quot;filename&quot;)                                                                                                                    
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ PTH202                                                                                                             
+12 | os.path.getmtime(b&quot;filename&quot;)                                                                                                                   
+13 | os.path.getmtime(Path(&quot;filename&quot;))                                                                                                              
+   |                                                                                                                                                 
+   = help: Replace with `Path(...).stat().st_size`                                                                                                   
+                                                                                                                                                     
+PTH204.py:12:1: PTH202 `os.path.getsize` should be replaced by `Path.stat().st_size`                                                                 
+   |                                                                                                                                                 
+11 | os.path.getmtime(&quot;filename&quot;)                                                                                                                    
+12 | os.path.getmtime(b&quot;filename&quot;)                                                                                                                   
+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ PTH202     
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-25 08:57</div>
            <div class="timeline-body"><p>The output suggests that you still have uncommited local changes. You have to stage them using <code>git add .</code>, then commit and push them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-25 18:41</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -0 violations, +28 -0 fixes in 3 projects; 52 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -0 violations, +12 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/airflow-core/src/airflow/dag_processing/manager.py#L931'>airflow-core/src/airflow/dag_processing/manager.py:931:38:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/airflow-core/src/airflow/dag_processing/manager.py#L931'>airflow-core/src/airflow/dag_processing/manager.py:931:38:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/airflow-core/src/airflow/models/dagbag.py#L318'>airflow-core/src/airflow/models/dagbag.py:318:64:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/airflow-core/src/airflow/models/dagbag.py#L318'>airflow-core/src/airflow/models/dagbag.py:318:64:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/devel-common/src/sphinx_exts/docs_build/fetch_inventories.py#L92'>devel-common/src/sphinx_exts/docs_build/fetch_inventories.py:92:71:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/devel-common/src/sphinx_exts/docs_build/fetch_inventories.py#L92'>devel-common/src/sphinx_exts/docs_build/fetch_inventories.py:92:71:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/providers/standard/src/airflow/providers/standard/sensors/filesystem.py#L132'>providers/standard/src/airflow/providers/standard/sensors/filesystem.py:132:60:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/providers/standard/src/airflow/providers/standard/sensors/filesystem.py#L132'>providers/standard/src/airflow/providers/standard/sensors/filesystem.py:132:60:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/providers/standard/src/airflow/providers/standard/triggers/file.py#L124'>providers/standard/src/airflow/providers/standard/triggers/file.py:124:30:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/providers/standard/src/airflow/providers/standard/triggers/file.py#L124'>providers/standard/src/airflow/providers/standard/triggers/file.py:124:30:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/providers/standard/src/airflow/providers/standard/triggers/file.py#L77'>providers/standard/src/airflow/providers/standard/triggers/file.py:77:34:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/apache/airflow/blob/83348cda3aa95df1157bb09f7d88bdd574f4a5cb/providers/standard/src/airflow/providers/standard/triggers/file.py#L77'>providers/standard/src/airflow/providers/standard/triggers/file.py:77:34:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+0 -0 violations, +4 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/sphinxext/bokeh_gallery.py#L125'>src/bokeh/sphinxext/bokeh_gallery.py:125:26:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/sphinxext/bokeh_gallery.py#L125'>src/bokeh/sphinxext/bokeh_gallery.py:125:26:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/sphinxext/bokeh_gallery.py#L146'>src/bokeh/sphinxext/bokeh_gallery.py:146:41:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/sphinxext/bokeh_gallery.py#L146'>src/bokeh/sphinxext/bokeh_gallery.py:146:41:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+0 -0 violations, +12 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/scripts/lib/zulip_tools.py#L359'>scripts/lib/zulip_tools.py:359:12:</a> PTH205 [*] `os.path.getctime` should be replaced by `Path.stat().st_ctime`
- <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/scripts/lib/zulip_tools.py#L359'>scripts/lib/zulip_tools.py:359:12:</a> PTH205 `os.path.getctime` should be replaced by `Path.stat().st_ctime`
+ <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/data_import/mattermost.py#L362'>zerver/data_import/mattermost.py:362:24:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/data_import/mattermost.py#L362'>zerver/data_import/mattermost.py:362:24:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/compatibility.py#L30'>zerver/lib/compatibility.py:30:49:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/compatibility.py#L30'>zerver/lib/compatibility.py:30:49:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/test_fixtures.py#L329'>zerver/lib/test_fixtures.py:329:33:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/test_fixtures.py#L329'>zerver/lib/test_fixtures.py:329:33:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/test_fixtures.py#L357'>zerver/lib/test_fixtures.py:357:33:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/test_fixtures.py#L357'>zerver/lib/test_fixtures.py:357:33:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
+ <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/upload/local.py#L134'>zerver/lib/upload/local.py:134:43:</a> PTH204 [*] `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
- <a href='https://github.com/zulip/zulip/blob/a3e7ef8e71929154691361b36e2d06c57fc87270/zerver/lib/upload/local.py#L134'>zerver/lib/upload/local.py:134:43:</a> PTH204 `os.path.getmtime` should be replaced by `Path.stat().st_mtime`
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PTH204 | 26 | 0 | 0 | 26 | 0 |
| PTH205 | 2 | 0 | 0 | 2 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 18:42</div>
            <div class="timeline-body"><p>tests on github runners also passed, i don't really understand why, maybe it's because i did something wrong in adding the tests <code>crates/ruff_linter/src/rules/flake8_use_pathlib/mod.rs</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-25 18:46</div>
            <div class="timeline-body"><p>oh, sorry, i found my stupid mistake :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @chirizxc on 2025-06-25 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @MichaReiser on 2025-06-26 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @MichaReiser on 2025-06-26 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @MichaReiser on 2025-06-26 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_path_getatime.rs</code>:115 on 2025-06-26 17:53</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            Ok(
                Fix::applicable_edits(Edit::range_replacement(replacement, range), [import_edit], applicability)
            )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_path_getctime.rs</code>:114 on 2025-06-26 17:53</div>
            <div class="timeline-body"><p>Same as above, let's use <code>applicable_edits</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_path_getmtime.rs</code>:114 on 2025-06-26 17:54</div>
            <div class="timeline-body"><p><code>applicable_edits</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-06-26 17:56</div>
            <div class="timeline-body"><p>Do we need all of these new tests? The answer could definitely be &quot;yes,&quot; but could you explain what new coverage they're adding? I think it would make sense to add at least one case with comments to each rule, but this seems like a lot of new cases for rules I thought would already have good test coverage.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_path_getctime.rs</code>:65 on 2025-06-26 17:57</div>
            <div class="timeline-body"><p>I feel like there's more that we should be able to factor out here. These three implementations look virtually identical. All that changes is the attribute being checked, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-06-26 18:01</div>
            <div class="timeline-body"><p>Thanks! I had some suggestions to factor out common code and maybe strip down new test cases a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-06-27 09:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_path_getctime.rs</code>:65 on 2025-06-27 09:35</div>
            <div class="timeline-body"><p>yes, i put the implementation in a <code>helper.rs</code>, but not sure about the name of the function, what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-06-27 09:49</div>
            <div class="timeline-body"><p>I think we can cut the tests down to:</p>
<pre><code class="language-python">import os
import pathlib
from os.path import getatime
from pathlib import Path

file = __file__

os.path.getatime(file)
os.path.getatime(&quot;filename&quot;)
os.path.getatime(Path(&quot;filename&quot;))

os.path.getatime(filename=&quot;filename&quot;)
os.path.getatime(filename=Path(&quot;filename&quot;))

getatime(&quot;filename&quot;)
getatime(Path(&quot;filename&quot;))

os.path.getatime(
    &quot;filename&quot;, # comment
)

os.path.getatime(
    # comment
    &quot;filename&quot;
    ,
    # comment
)

os.path.getatime( # comment
    Path(__file__)
    # comment
) # comment

getatime( # comment
    &quot;filename&quot;)

getatime( # comment
    b&quot;filename&quot;,
    #comment
)

os.path.getatime(&quot;file&quot; + &quot;name&quot;)

getatime \
 \
 \
        ( # comment
        &quot;filename&quot;,
    )

getatime(Path(&quot;filename&quot;).resolve())

os.path.getatime(pathlib.Path(&quot;filename&quot;))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-06-27 09:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-06-27 09:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-06-27 09:54</div>
            <div class="timeline-body"><p>new tests are needed to check unsafe fix when there are comments, check filename, and check that <code>pathlib.Path(pathlib.Path(&quot;test&quot;))</code> becomes <code>pathlib.Path(&quot;test&quot;)</code> too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-06-27 09:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-06-27 09:55</div>
            <div class="timeline-body"><p><img src="https://github.com/user-attachments/assets/bf095932-72b8-46bc-8b96-13ab80a200a5" alt="изображение" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-27 10:04</div>
            <div class="timeline-body"><p>looks like windows runner down</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-07-02 13:40</div>
            <div class="timeline-body"><p>This would be my suggestion for this file:</p>
<pre><code class="language-python">import os.path, pathlib
from pathlib import Path
from os.path import getatime

os.path.getatime(&quot;filename&quot;)
os.path.getatime(b&quot;filename&quot;)
os.path.getatime(Path(&quot;filename&quot;))


getatime(&quot;filename&quot;)
getatime(b&quot;filename&quot;)
getatime(Path(&quot;filename&quot;))


file = __file__

os.path.getatime(file)
os.path.getatime(filename=&quot;filename&quot;)
os.path.getatime(filename=Path(&quot;filename&quot;))

os.path.getatime(  # comment 1
    # comment 2
    &quot;filename&quot;  # comment 3
    # comment 4
    ,  # comment 5
    # comment 6
)  # comment 7

os.path.getatime(&quot;file&quot; + &quot;name&quot;)

getatime(Path(&quot;filename&quot;).resolve())

os.path.getatime(pathlib.Path(&quot;filename&quot;))
</code></pre>
<p>It avoids a diff for the existing test cases, which makes it easier to review, and it condenses the various comment cases into a single case with basically all of the possible comment locations.</p>
<p>Since we're using the same helper method for the other two rules, I think we can probably just leave their tests alone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:53 on 2025-07-02 13:48</div>
            <div class="timeline-body"><p>nit: we could check this in the <code>if fix_enabled</code> branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-07-02 13:59</div>
            <div class="timeline-body"><p>We may also want a test like this:</p>
<pre><code class="language-python">getatime(Path(&quot;dir&quot;) / &quot;file.txt&quot;)
</code></pre>
<p>I tried locally, and I think it works out because we wrap it in <code>Path</code> again, otherwise we'd need parentheses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-02 14:00</div>
            <div class="timeline-body"><p>Thanks! Just a couple more suggestions, mostly around test organization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-07-02 14:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH203.py</code>:1 on 2025-07-02 14:33</div>
            <div class="timeline-body"><blockquote>
<p>We may also want a test like this:</p>
<pre><code class="language-python">getatime(Path(&quot;dir&quot;) / &quot;file.txt&quot;)
</code></pre>
<p>I tried locally, and I think it works out because we wrap it in <code>Path</code> again, otherwise we'd need parentheses.</p>
</blockquote>
<p>yea it should work, if we remove <code>Path()</code> here we would get <code>TypeError: unsupported operand type(s) for /: ‘str’ and ‘str’</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-07-04 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH203_PTH203.py.snap</code>:9 on 2025-07-04 19:36</div>
            <div class="timeline-body"><p>I think we have the wrong range selected here. I'd prefer to keep the old one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_use_pathlib/PTH204.py</code>:13 on 2025-07-04 19:38</div>
            <div class="timeline-body"><p>While fixing the range, can you go ahead and revert the changes to these files? Just to clear them from the diff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:36 on 2025-07-04 19:45</div>
            <div class="timeline-body"><p>I think this is a slight simplification to the signature and the qualified name check:</p>
<pre><code class="language-suggestion">pub(crate) fn check_os_path_get_calls(
    checker: &amp;Checker,
    call: &amp;ExprCall,
    fn_name: &amp;str,
    attr: &amp;str,
    fix_enabled: bool,
    violation: impl Violation,
) {
    if checker
        .semantic()
        .resolve_qualified_name(&amp;call.func)
        .is_some_and(|qualified_name| qualified_name.segments() != &amp;[&quot;os&quot;, &quot;path&quot;, fn_name])
    {
        return;
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:49 on 2025-07-04 19:45</div>
            <div class="timeline-body"><p>I think this should fix the snapshot ranges:</p>
<pre><code class="language-suggestion">    let mut diagnostic = checker.report_diagnostic(violation, call.func.range());
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-04 19:50</div>
            <div class="timeline-body"><p>Thanks! Just a couple more nits and a larger, but easy to fix, concern about the diagnostic range that I didn't notice before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-07-04 20:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:36 on 2025-07-04 20:09</div>
            <div class="timeline-body"><p>thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-04 20:09</div>
            <div class="timeline-body"><p>done! waiting CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-07-04 20:18</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/chirizxc%3Afeat%2Fautofixes?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a></h2>
<h3>Merging #18922 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>chirizxc:feat/autofixes</code> (de70bda) with <code>main</code> (44f2f77)</sub></p>
<h3>Summary</h3>
<p><code>✅ 40</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-04 20:27</div>
            <div class="timeline-body"><p>Uh, I think something very weird just happened with CI. Both the ecosystem report and benchmarks are showing very unreasonable results. I'll try rerunning it. I definitely don't think your changes caused this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-04 20:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__PTH202_PTH202.py.snap</code>:7 on 2025-07-04 20:31</div>
            <div class="timeline-body"><p>Ahh, I see. I missed this on https://github.com/astral-sh/ruff/pull/18763. The shorter range is how PTH202 used to be too, so this is perfect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-07-04 20:33</div>
            <div class="timeline-body"><p>Thanks! We'll get CI to pass somehow and then this is good to go. I may try closing and reopening the PR to fully re-trigger it if re-running through the actions interface doesn't work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-07-04 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @ntBre on 2025-07-04 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-04 21:19</div>
            <div class="timeline-body"><p>Hmm, rerunning didn't seem to help. Do you want to try merging <code>main</code> into your branch? Just in case it's a real change from the past couple of days.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-05 05:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:27 on 2025-07-05 05:06</div>
            <div class="timeline-body"><p>Well this is a bit embarrassing, but I just realized that my suggestion <em>did</em> break your code, and CI was correct. This should be <code>is_none_or</code> to preserve the original behavior.</p>
<pre><code class="language-suggestion">        .is_none_or(|qualified_name| qualified_name.segments() != [&quot;os&quot;, &quot;path&quot;, fn_name])
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-05 10:17</div>
            <div class="timeline-body"><p>oh, it seems to working, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @MichaReiser on 2025-07-07 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-07-07 20:55</div>
            <div class="timeline-body"><p>Great, thanks again! And sorry for the bad suggestion</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-07-07 20:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-07-07 20:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-08 05:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:33:37 UTC
    </footer>
</body>
</html>
