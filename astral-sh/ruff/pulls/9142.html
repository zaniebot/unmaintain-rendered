<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable annotation quoting for multi-line expressions - astral-sh/ruff #9142</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable annotation quoting for multi-line expressions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9142">#9142</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-12-15 00:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>Given:</p>
<pre><code class="language-python">x: DataFrame[
    int
] = 1
</code></pre>
<p>We currently wrap the annotation in single quotes, which leads to a syntax error:</p>
<pre><code class="language-python">x: &quot;DataFrame[
    int
]&quot; = 1
</code></pre>
<p>There are a few options for what to suggest for users here... Use triple quotes:</p>
<pre><code class="language-python">x: &quot;&quot;&quot;DataFrame[
    int
]&quot;&quot;&quot; = 1
</code></pre>
<p>Or, use an implicit string concatenation (which may require parentheses):</p>
<pre><code class="language-python">x: (&quot;DataFrame[&quot;
    &quot;int&quot;
&quot;]&quot;) = 1
</code></pre>
<p>The solution I settled on here is to use the <code>Generator</code>, which effectively means we write it out on a single line, like:</p>
<pre><code class="language-python">x: &quot;DataFrame[int]&quot; = 1
</code></pre>
<p>It's kind of the &quot;least opinionated&quot; solution, but it does mean we'll expand to a very long line in some cases.</p>
<p>Closes https://github.com/astral-sh/ruff/issues/9136.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-12-15 00:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2023-12-15 01:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-12-15 01:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-15 01:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-15 01:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-12-15 01:05</div>
            <div class="timeline-body"><blockquote>
<p>Or, use an implicit string concatenation (which may require parentheses):</p>
</blockquote>
<p>I wonder if that trips over static analysis tools.</p>
<blockquote>
<p>The solution I settled on here is to use the Generator, which effectively means we write it out on a single line, like:</p>
</blockquote>
<p>The main downside of this is that it undoes any formatting and the formatter won't be able to properly format the type annotation (except if we would parse it) on the next run, because it is now an unsplittable string. But I think it's a good enough solution to fix the bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-12-15 01:11</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:01:50 UTC
    </footer>
</body>
</html>
