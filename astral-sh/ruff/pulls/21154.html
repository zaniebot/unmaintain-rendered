<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pydocstyle`] Refactor `D417` to use the `pydoclint` docstring processing - astral-sh/ruff #21154</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pydocstyle</code>] Refactor <code>D417</code> to use the <code>pydoclint</code> docstring processing</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21154">#21154</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2025-10-30 23:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a></div>
            <div class="timeline-body">Summary
<p>This PR refactors <code>D417</code> to use the parameters detected in the <code>pydoclint</code> scope, the goal is to have a <code>D417</code> implementation which is equivalent to the previous one, but uses the <code>pydoclint</code> docstring processing. Later on <code>D417</code> can be renamed to <code>DOC101</code> and <code>D417</code> deprecated. This will make deploying <code>DOC101</code> easier.</p>
Test Plan
<p>The refactor is tested on the old fixtures, and the new snap was manually diffed. The following changes were found between the old and new implementation.</p>
<p>In the following the new implementation reports an error which the old didn&#x27;t. Notice that the code mixes google and numpy style elements which makes the docstring invalid for both.</p>
<pre><code>def f(x):
    &quot;&quot;&quot;Do something with valid description.

    Args:
    ----
        x: the value

    Returns:
    -------
        the value
    &quot;&quot;&quot;
    return x
</code></pre>
<p>In the following, the old implementation reports an error but the new one does not. This is because the old implementation enforces argument order in the docstring which the new one does not. Pydoclint has a seperate rule for checking documentation order which can be implemented later.</p>
<pre><code>    @classmethod
    @expect(&quot;D417: Missing argument descriptions in the docstring &quot;
            &quot;(argument(s) test, y, z are missing descriptions in &quot;
            &quot;&#x27;test_missing_args_class_method&#x27; docstring)&quot;, arg_count=4)
    def test_missing_args_class_method(cls, test, x, y, z=3):  # noqa: D213, D407
        &quot;&quot;&quot;Test a valid args section.

        Parameters
        ----------
        z
        x
            Another parameter. The parameters y, test below are
            missing descriptions. The parameter z above is also missing
            a description.
        y
        test

        &quot;&quot;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/augustelalande">@augustelalande</a> on 2025-10-30 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`pydocstyle`] Refactor `D417` to use the `pydoclint` scope&quot; to &quot;[`pydocstyle`] Refactor `D417` to use the `pydoclint` docstring processing&quot; by <a href="https://github.com/augustelalande">@augustelalande</a> on 2025-10-30 23:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-31 00:02</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+3 -7 violations, +0 -0 fixes in 2 projects; 53 projects unchanged)</p>
<a href="https://github.com/apache/superset">apache/superset</a> (+0 -5 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/apache/superset/blob/008c7c6517071e4b111f6232fa2477084bcb1215/scripts/erd/erd.py#L84">scripts/erd/erd.py:84:5:</a> D417 Missing argument descriptions in the docstring for `introspect_sqla_model`: `mapper`, `seen`
- <a href="https://github.com/apache/superset/blob/008c7c6517071e4b111f6232fa2477084bcb1215/superset/migrations/shared/catalogs.py#L131">superset/migrations/shared/catalogs.py:131:5:</a> D417 Missing argument descriptions in the docstring for `print_processed_batch`: `batch_size`, `model`, `offset`, `start_time`, `total_rows`
- <a href="https://github.com/apache/superset/blob/008c7c6517071e4b111f6232fa2477084bcb1215/superset/migrations/shared/catalogs.py#L166">superset/migrations/shared/catalogs.py:166:5:</a> D417 Missing argument descriptions in the docstring for `update_catalog_column`: `catalog`, `database`, `downgrade`, `session`
- <a href="https://github.com/apache/superset/blob/008c7c6517071e4b111f6232fa2477084bcb1215/superset/migrations/shared/catalogs.py#L295">superset/migrations/shared/catalogs.py:295:5:</a> D417 Missing argument descriptions in the docstring for `delete_models_non_default_catalog`: `catalog`, `database`, `session`
- <a href="https://github.com/apache/superset/blob/008c7c6517071e4b111f6232fa2477084bcb1215/superset/utils/pandas_postprocessing/histogram.py#L24">superset/utils/pandas_postprocessing/histogram.py:24:5:</a> D417 Missing argument descriptions in the docstring for `histogram`: `bins`, `column`, `cumulative`, `df`, `groupby`, `normalize`
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+3 -2 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/has_props.py#L421">src/bokeh/core/has_props.py:421:9:</a> D417 Missing argument description in the docstring for `set_from_json`: `value`
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/core/has_props.py#L421">src/bokeh/core/has_props.py:421:9:</a> D417 Missing argument descriptions in the docstring for `set_from_json`: `setter`, `value`
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/document/models.py#L257">src/bokeh/document/models.py:257:9:</a> D417 Missing argument descriptions in the docstring for `update_name`: `new_name`, `old_name`
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/model/model.py#L326">src/bokeh/model/model.py:326:9:</a> D417 Missing argument descriptions in the docstring for `js_link`: `attr_selector`, `other`, `other_attr`
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/resources.py#L194">src/bokeh/resources.py:194:5:</a> DOC501 Raised exception `RuntimeError` missing from docstring
</pre>

</p>

Changes by rule (2 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| D417 | 9 | 2 | 7 | 0 | 0 |
| DOC501 | 1 | 1 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/augustelalande">@augustelalande</a> on 2025-11-01 06:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2025-11-12 23:15</div>
            <div class="timeline-body"><p>The ecosystem changes are minimal, with the new implementation removing some old false positives. It introduces some new positives, caused by improper formatting which are debatably true positives in my opinion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-11-13 22:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-11-13 22:12</div>
            <div class="timeline-body"><p>Thanks for the merge and taking a look at the ecosystem results. This is in my inbox to have a look!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:00 UTC
    </footer>
</body>
</html>
