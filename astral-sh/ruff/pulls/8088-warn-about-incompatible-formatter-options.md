```yaml
number: 8088
title: Warn about incompatible formatter options
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: warn-about-incompatible-options
created_at: 2023-10-20T04:54:25Z
updated_at: 2023-10-26T15:05:35Z
url: https://github.com/astral-sh/ruff/pull/8088
synced_at: 2026-01-12T02:32:41Z
```

# Warn about incompatible formatter options

---

_Pull request opened by @MichaReiser on 2023-10-20 04:54_

## Summary

Warn users about options incompatible with the formatter when using `ruff format` 

Closes #7646

## Test Plan

Added integration test


---

_Label `formatter` added by @MichaReiser on 2023-10-20 04:54_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-10-20 04:54_

---

_Review requested from @zanieb by @MichaReiser on 2023-10-20 04:54_

---

_Comment by @MichaReiser on 2023-10-20 04:54_

Current dependencies on/for this PR:
* main
  * **PR #8088** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8088" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/8088?utm_source=stack-comment).

---

_@charliermarsh reviewed on 2023-10-20 05:07_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:671 on 2023-10-20 05:07_

One tricky thing here is that these don't necessarily _conflict_ with the formatter. Some of them do _overlap_, but in a way that's at least consistent. Some of them are also _arguably_ complimentary (like `MissingTrailingComma`, I think, is arguably complimentary, since it will insert trailing commas that the formatter will then respect).

---

_@MichaReiser reviewed on 2023-10-20 05:26_

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/commands/format.rs`:671 on 2023-10-20 05:26_

`COM812` is conflicting because it disallows:

```python
class PhotoMetadata:
    """Metadata about a photo."""

    def __init__(
        self, file: Path, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u
    ):
        ...
```

My goal is to only warn about rules that are incompatible. E.g. I excluded 

* E501 because there are valid use cases to use it alongside the formatter, even though it's mostly redundant
* `E701`: while redundant, it doesn't conflict with the formatter.

Is your feedback mainly about the naming of the variables or the wording of the warning message? I'm trying to understand what I should change.

---

_@charliermarsh reviewed on 2023-10-20 17:23_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:671 on 2023-10-20 17:23_

I think I'm just trying to understand what we consider to be a conflict (and, based on that answer, perhaps looking to refine the list, or change the wording of the message).

For example, above, if you ran the linter, wouldn't `COM812` just insert a trailing comma at the end, and then the formatter would in turn split the arguments over multiple lines? So it's not like the two tools would go back and forth endlessly disagreeing with one another, as they would if you set `BadQuotes` to divergent values. The `COM812` case feels like it fits some definition of a conflict though, like: formatted code can introduce these violations.


---

_@MichaReiser reviewed on 2023-10-20 23:18_

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/commands/format.rs`:671 on 2023-10-20 23:18_

> For example, above, if you ran the linter, wouldn't COM812 just insert a trailing comma at the end, and then the formatter would in turn split the arguments over multiple lines?

That's correct. But it requires that you need to run `formatter`, `linter`, and `formatter` again to get a stable result which doesn't seem ideal. I see incompatibilities as everything that leads to a bad experience. 


---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:671 on 2023-10-20 23:22_

So, anything that might trigger or require some command to be repeated, even if that cycle isn't infinite. In that case, we probably want to include ISC001?

---

_@charliermarsh reviewed on 2023-10-20 23:22_

---

_@MichaReiser reviewed on 2023-10-20 23:40_

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/commands/format.rs`:671 on 2023-10-20 23:40_

Probably we should. This rule won't be conflicting with the preview style but the formatter could produce code today that conflicts with it

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:609 on 2023-10-21 02:58_

Small nudges on the comment:

```
The following rules may cause conflicts when used with the formatter: {}.
To avoid unexpected behavior, we recommend disabling these rules, either
by removing them from your `select` or `extend-select`, or adding them to
your `ignore`.
```

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/commands/format.rs`:637 on 2023-10-21 02:58_

Small nudges on the comment:

```
The following isort options may cause conflicts when used with the formatter: {}.
To avoid unexpected behavior, we recommend disabling these options by removing
them from your configuration.
```

---

_@charliermarsh approved on 2023-10-21 02:58_

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/commands/format.rs`:637 on 2023-10-23 08:51_

Much better

---

_@MichaReiser reviewed on 2023-10-23 08:51_

---

_@MichaReiser reviewed on 2023-10-23 08:56_

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/commands/format.rs`:609 on 2023-10-23 08:56_

"your ignore" sounds a bit strange. I used your suggestion but changed it to "from the `select` or `extend-select` configuration. 

---

_Comment by @github-actions[bot] on 2023-10-23 09:14_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Closed by @MichaReiser on 2023-10-23 09:38_

---

_Reopened by @MichaReiser on 2023-10-23 09:39_

---

_Merged by @MichaReiser on 2023-10-23 10:04_

---

_Closed by @MichaReiser on 2023-10-23 10:04_

---

_Branch deleted on 2023-10-23 10:04_

---

_Comment by @smackesey on 2023-10-26 13:03_

```
warning: The following isort options may cause conflicts when used with the formatter: 'isort.force-wrap-aliases'. To avoid unexpected behavior, we recommend disabling these options by removing them from the configuration.
```

This rule is fairly important to us and it's not clear how it conflicts, as we never had a conflict using this together with `black`.

---

_Comment by @MichaReiser on 2023-10-26 14:00_

@smackesey Thanks for your feedback. I'm sorry, I was over-cautious with the warnings.  https://github.com/astral-sh/ruff/pull/8192 refines the warnings. You should no longer see it, as long as you don't set `format.skip-magic-trailing-comma` to `true`.

---

_Comment by @charliermarsh on 2023-10-26 15:05_

@smackesey - We're planning to cut a release today that will include that fix.

---
