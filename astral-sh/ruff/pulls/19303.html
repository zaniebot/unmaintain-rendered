<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-logging-format`] Add auto-fix for f-string logging calls (`G004`) - astral-sh/ruff #19303</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-logging-format</code>] Add auto-fix for f-string logging calls (<code>G004</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19303">#19303</a>
        opened by <a href="https://github.com/hamirmahal">@hamirmahal</a>
        on 2025-07-12 22:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hamirmahal">@hamirmahal</a></div>
            <div class="timeline-body"><p>Closes #19302</p>


Summary
<p>This adds an auto-fix for <code>Logging statement uses f-string</code> Ruff G004, so users don&#x27;t have to resolve it manually.</p>


Test Plan
<p>I ran the auto-fixes on a Python file locally and and it worked as expected.</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-12 22:56</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -0 violations, +138 -0 fixes in 3 projects; 52 projects unchanged)</p>
<a href="https://github.com/Snowflake-Labs/snowcli">Snowflake-Labs/snowcli</a> (+0 -0 violations, +4 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href="https://github.com/Snowflake-Labs/snowcli/blob/8cd100bd01853e7dc95dcf410cd85dda3baa95a4/tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py#L37">tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py:37:21:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/Snowflake-Labs/snowcli/blob/8cd100bd01853e7dc95dcf410cd85dda3baa95a4/tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py#L37">tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py:37:21:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/Snowflake-Labs/snowcli/blob/8cd100bd01853e7dc95dcf410cd85dda3baa95a4/tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py#L39">tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py:39:17:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/Snowflake-Labs/snowcli/blob/8cd100bd01853e7dc95dcf410cd85dda3baa95a4/tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py#L39">tests_integration/tests_using_container_services/spcs/docker/test_counter/simple_counter.py:39:17:</a> G004 [*] Logging statement uses f-string
</pre>

</p>

<a href="https://github.com/apache/superset">apache/superset</a> (+0 -0 violations, +120 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/app.py#L103">superset/app.py:103:21:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/app.py#L103">superset/app.py:103:21:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/cli/examples.py#L38">superset/cli/examples.py:38:21:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/cli/examples.py#L38">superset/cli/examples.py:38:21:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/commands/database/uploaders/csv_reader.py#L122">superset/commands/database/uploaders/csv_reader.py:122:17:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/commands/database/uploaders/csv_reader.py#L122">superset/commands/database/uploaders/csv_reader.py:122:17:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/commands/theme/seed.py#L104">superset/commands/theme/seed.py:104:26:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/commands/theme/seed.py#L104">superset/commands/theme/seed.py:104:26:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/commands/theme/seed.py#L96">superset/commands/theme/seed.py:96:26:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/commands/theme/seed.py#L96">superset/commands/theme/seed.py:96:26:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/bart_lines.py#L62">superset/examples/bart_lines.py:62:18:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/bart_lines.py#L62">superset/examples/bart_lines.py:62:18:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/birth_names.py#L111">superset/examples/birth_names.py:111:22:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/birth_names.py#L111">superset/examples/birth_names.py:111:22:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/multiformat_time_series.py#L87">superset/examples/multiformat_time_series.py:87:18:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/multiformat_time_series.py#L87">superset/examples/multiformat_time_series.py:87:18:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/paris.py#L58">superset/examples/paris.py:58:18:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/paris.py#L58">superset/examples/paris.py:58:18:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/random_time_series.py#L71">superset/examples/random_time_series.py:71:18:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/random_time_series.py#L71">superset/examples/random_time_series.py:71:18:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/sf_population_polygons.py#L62">superset/examples/sf_population_polygons.py:62:18:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/examples/sf_population_polygons.py#L62">superset/examples/sf_population_polygons.py:62:18:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L43">superset/extensions/discovery.py:43:24:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L43">superset/extensions/discovery.py:43:24:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L53">superset/extensions/discovery.py:53:21:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L53">superset/extensions/discovery.py:53:21:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L62">superset/extensions/discovery.py:62:33:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L62">superset/extensions/discovery.py:62:33:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L65">superset/extensions/discovery.py:65:30:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L65">superset/extensions/discovery.py:65:30:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L69">superset/extensions/discovery.py:69:22:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/discovery.py#L69">superset/extensions/discovery.py:69:22:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L103">superset/extensions/local_extensions_watcher.py:103:22:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L103">superset/extensions/local_extensions_watcher.py:103:22:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L47">superset/extensions/local_extensions_watcher.py:47:21:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L47">superset/extensions/local_extensions_watcher.py:47:21:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L73">superset/extensions/local_extensions_watcher.py:73:28:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L73">superset/extensions/local_extensions_watcher.py:73:28:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L78">superset/extensions/local_extensions_watcher.py:78:21:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L78">superset/extensions/local_extensions_watcher.py:78:21:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L92">superset/extensions/local_extensions_watcher.py:92:32:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/extensions/local_extensions_watcher.py#L92">superset/extensions/local_extensions_watcher.py:92:32:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/apache/superset/blob/a8be5a5a0caab08c3b3a18606808ec947dd9afe0/superset/migrations/shared/catalogs.py#L305">superset/migrations/shared/catalogs.py:305:17:</a> G004 Logging statement uses f-string
... 77 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+0 -0 violations, +14 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/directory.py#L135">src/bokeh/application/handlers/directory.py:135:25:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/directory.py#L135">src/bokeh/application/handlers/directory.py:135:25:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/document_lifecycle.py#L66">src/bokeh/application/handlers/document_lifecycle.py:66:25:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/document_lifecycle.py#L66">src/bokeh/application/handlers/document_lifecycle.py:66:25:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/io/notebook.py#L581">src/bokeh/io/notebook.py:581:19:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/io/notebook.py#L581">src/bokeh/io/notebook.py:581:19:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/io/notebook.py#L582">src/bokeh/io/notebook.py:582:19:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/io/notebook.py#L582">src/bokeh/io/notebook.py:582:19:</a> G004 [*] Logging statement uses f-string
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/io/state.py#L176">src/bokeh/io/state.py:176:22:</a> G004 Logging statement uses f-string
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/io/state.py#L176">src/bokeh/io/state.py:176:22:</a> G004 [*] Logging statement uses f-string
... 4 additional changes omitted for project
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| G004 | 138 | 0 | 0 | 138 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-07-13 01:12</div>
            <div class="timeline-body"><p>How does this handle arbitrary format specs? Reading the code it looks to me like they all get converted to <code>%s</code>, which is definitely not ideal, and should at the very least make the fix unsafe/not offer a fix at all. As an example, what does the fix do on this code?</p>
<pre><code>import logging
logging.info(f&quot;{x:arbitrary data in format spec} {x:{&#x27;nested format spec&#x27;}}&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-14 07:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 16:27</div>
            <div class="timeline-body"><p>Thanks for working on this! I think @MeGaGiGaGon raises some good points. I think it would make sense to bail out and not offer a fix if we see any complicated format specs, especially for a first iteration. We could keep the <code>%d</code> and <code>%f</code> handling that it looks like you already worked on, but I&#x27;d even be happy with only handling <code>{var}</code> -&gt; <code>%s</code> in a first version (omitting format specs entirely).</p>
<p>I can try to give this a review next week if you resolve the conflicts :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hamirmahal">@hamirmahal</a> on 2025-07-21 06:42</div>
            <div class="timeline-body"><p>You&#x27;re welcome! That works for me. I pulled the latest changes and fixed the merge conflicts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/violations.rs</code>:331 on 2025-07-21 21:44</div>
            <div class="timeline-body"><p>tiny nit: We usually put this below <code>message</code>.</p>
<p>I also think it might be nice to wrap % in backticks:</p>
<pre><code>    fn fix_title(&amp;self) -&gt; Option&lt;String&gt; {
        Some(&quot;Convert to lazy `%` formatting&quot;.to_string())
    }
</code></pre>
<p>This message feels very slightly misleading to me (it makes me think the fix is something like <code>&quot;%s&quot; % var</code> with the user adding a <code>%</code>), but I&#x27;m also not coming up with anything better, and they do need to add some <code>%</code>s themselves, in the quotes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:61 on 2025-07-21 21:45</div>
            <div class="timeline-body"><p>I think it would be nice to factor everything in the <code>is_rule_enabled</code> check into a function. We&#x27;re getting pretty indented here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:111 on 2025-07-21 21:52</div>
            <div class="timeline-body"><p>I believe that it&#x27;s a breaking change to add a safe fix on stable: <a href="https://docs.astral.sh/ruff/versioning/#version-changes">docs</a>. We should gate this behind a preview check like these:</p>
<p>https://github.com/astral-sh/ruff/blob/cabdd969ec3b7807a777ac87de94771a67525777/crates/ruff_linter/src/preview.rs#L204-L207</p>
<p>You can do something like this:</p>
<pre><code>let mut diagnostic = checker.report_diagnostic(LoggingFString, msg.range());

if !is_f_string_logging_fix_enabled(checker.settings()) {
    return
}

// fix code here
</code></pre>
<p><code>report_diagnostic</code> ensures the diagnostic gets reported when the guard it returns is dropped, so if you return early without setting a fix, everything should work out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:80 on 2025-07-22 00:44</div>
            <div class="timeline-body"><p>I think this would also be helped by my suggestion to create the diagnostic early and return if we don&#x27;t want a fix. Instead of setting a flag and breaking here, we can just return.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:110 on 2025-07-22 00:48</div>
            <div class="timeline-body"><p>nit: We usually try to use named arguments to <code>format!</code>. Something like this maybe:</p>
<pre><code>                    let replacement = format!(
                        &quot;\&quot;{format_string}\&quot;{sep}{args}&quot;,
                        sep = if args.is_empty() {
                            &quot;&quot;
                        } else {
                            &quot;, &quot;
                        },
                        args = args.join(&quot;, &quot;)
                    );
</code></pre>
<p>I think you can also use string literals instead of converting to <code>String</code>s.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:111 on 2025-07-22 00:57</div>
            <div class="timeline-body"><p>How does this fix handle an f-string with <code>%</code> formatting directives in it? I&#x27;m not sure if we have any utility functions for detecting that, but I think that would cause problems here. For example:</p>
<pre><code>import logging

x = 1
logging.error(f&quot;{x} -&gt; %s&quot;, x)
</code></pre>
<p>I think the current fix will overwrite the whole <code>logging.error</code> range. I think the logging functions also accept <code>**kwargs</code> as described on <a href="https://docs.python.org/3/library/logging.html#logging.Logger.debug"><code>Logger.debug</code></a>, so we may need to be more careful about existing arguments in general.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-22 00:59</div>
            <div class="timeline-body"><p>Thanks! I had some organizational suggestions and also some edge cases I think we&#x27;ll need to handle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hamirmahal">@hamirmahal</a> on 2025-07-23 16:21</div>
            <div class="timeline-body"><p>You&#x27;re welcome! Weekends are usually when I have more availability; I&#x27;ll see if I can commit your suggestions now, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hamirmahal">@hamirmahal</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:111 on 2025-07-27 18:27</div>
            <div class="timeline-body"><p>Hmm... I think the code in its current state does this.</p>
<pre><code>import logging

x = 1
logging.error(f&quot;{x} -&gt; %s&quot;, x) # original
logging.error(&quot;%s -&gt; %s&quot;, x, x) # auto-fixed
</code></pre>
<p>I&#x27;m seeing the same output for both the original and fixed line, so I think this is valid? I could be missing something.</p>
<pre><code>ERROR:root:1 -&gt; 1
ERROR:root:1 -&gt; 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hamirmahal">@hamirmahal</a> reviewed on 2025-07-27 18:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hamirmahal">@hamirmahal</a> reviewed on 2025-07-27 18:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hamirmahal">@hamirmahal</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:111 on 2025-07-27 18:28</div>
            <div class="timeline-body"><p>When I tried to <a href="https://github.com/astral-sh/ruff/commit/07990a73916030c077b279b61ad473dc491630b4">gate the f-string formatting fix behind a preview check</a>, that caused CI to fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/hamirmahal">@hamirmahal</a> on 2025-07-27 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:15 on 2025-08-07 18:50</div>
            <div class="timeline-body"><p>I think we could report the diagnostic here at the top and then immediately return if preview is not enabled:</p>
<pre><code>let mut diagnostic = checker.report_diagnostic(LoggingFString, msg.range());

if !is_fix_f_string_logging_enabled(checker.settings()) {
    return;
}
</code></pre>
<p>The diagnostic gets emitted when the guard returned by <code>report_diagnostic</code> is dropped, so we can do neat stuff like this. Later in the function we can just attach a fix to <code>diagnostic</code>, if needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:32 on 2025-08-07 18:51</div>
            <div class="timeline-body"><p>Yeah, then we can also drop these additional <code>report_diagnostic</code> calls and just return here, with the change above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:82 on 2025-08-07 18:51</div>
            <div class="timeline-body"><p>This can also be an early return:</p>
<pre><code>if args.is_empty() {
    return;
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:55 on 2025-08-07 18:52</div>
            <div class="timeline-body"><p>We already checked <code>args.is_empty()</code>, so this is always a comma.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:110 on 2025-08-07 18:53</div>
            <div class="timeline-body"><p>nit: I think we can just call the function <code>logging_f_string</code> to match the rule name.</p>
<p>We could also keep using <code>report_diagnostic_if_enabled</code> inside of the function, if we wanted. If it returns <code>None</code>, we&#x27;d just early return at the top of the function. This is fine too, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/snapshots/ruff_linter__rules__flake8_logging_format__tests__G004.py.snap</code>:278 on 2025-08-07 18:57</div>
            <div class="timeline-body"><p>We might want an example with a different variable name, just to make sure which <code>x</code> is which. That&#x27;s my bad for the initial suggestion. Maybe something like this:</p>
<pre><code>y = 1
logging.error(f&quot;{y} -&gt; %s&quot;, x)
</code></pre>
<p>I just want to make sure it comes out as <code>logging.error(&quot;%s -&gt; %s&quot;, y, x)</code> and not <code>x, y</code>. Hopefully that makes sense. We might also want to test the opposite order to be extra sure. I wouldn&#x27;t really mind bailing out if the format string contains an existing <code>%</code> either, just to avoid an erroneous fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:54 on 2025-08-07 19:22</div>
            <div class="timeline-body"><p>I think we should try to reuse the f-string&#x27;s quotes (at least the first element&#x27;s if it&#x27;s concatenated) here instead of hard-coding double quotes. You may need to add a <code>string_flags</code> method or something on <code>FStringPart</code>. I forget how we&#x27;ve done this before, but this should be a good start:</p>
<p>https://github.com/astral-sh/ruff/blob/1070e8cbf9211028a1add17d618ee7d7e78062e9/crates/ruff_python_ast/src/nodes.rs#L571-L576</p>
<p>Unfortunately <code>quote_style</code> isn&#x27;t quite enough because it doesn&#x27;t capture whether it&#x27;s a single- or triple-quoted string. We probably need something like this if it doesn&#x27;t already exist and I&#x27;m just overlooking it:</p>
<pre><code>    pub fn quote_str(&amp;self) -&gt; &amp;str {
        match self {
            Self::Literal(string_literal) =&gt; string_literal.flags.quote_str(),
            Self::FString(f_string) =&gt; f_string.flags.quote_str(),
        }
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-08-07 19:26</div>
            <div class="timeline-body"><p>Thanks, this is still looking good! Just a few more minor structural suggestions and another test idea. We still need to preview-gate this too. Let me know if you need help with that.</p>
<p>Apologies for the long delay in re-reviewing!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hamirmahal">@hamirmahal</a> reviewed on 2025-08-17 20:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hamirmahal">@hamirmahal</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:15 on 2025-08-17 20:02</div>
            <div class="timeline-body"><p>Oh, that makes sense. Thanks for the suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/hamirmahal">@hamirmahal</a> on 2025-08-19 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-20 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:16 on 2025-08-20 20:06</div>
            <div class="timeline-body"><pre><code>
fn logging_f_string(
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:94 on 2025-08-20 20:09</div>
            <div class="timeline-body"><p>Do we need to clone here? I think <code>args</code> is still a mutable <code>Vec</code> from above, so we could just extend it directly, unless I&#x27;m missing another binding that shadows line 31.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:41 on 2025-08-20 20:12</div>
            <div class="timeline-body"><p>Do we need this to be a <code>String</code> or could we leave it as a <code>&amp;str</code>? I could be missing it, but I&#x27;m not immediately seeing  a need for an owned string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:86 on 2025-08-20 20:17</div>
            <div class="timeline-body"><p>I <em>think</em> we could drop the <code>to_string</code> calls on everything we put into <code>args</code> and <code>existing_names</code>. It looks to me like it would be fine to have a <code>Vec&lt;&amp;str&gt;</code>, but it&#x27;s not a big deal if it doesn&#x27;t work out. Just a bit more efficient not to allocate <code>String</code>s if we can avoid it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/mod.rs</code>:53 on 2025-08-20 20:29</div>
            <div class="timeline-body"><p>What we usually do for preview tests is create a copy of the <code>rules</code> function above this called <code>preview_rules</code> and run all of the same <code>test_case</code>s through both functions. That&#x27;s a good way to compare preview and stable behavior across all the snapshots. Or maybe not all the files, since that would be a lot of snapshots :) Here&#x27;s an example from a different rule with only a subset of the snapshots:</p>
<p>https://github.com/astral-sh/ruff/blob/39f7a876d6aceedc3db4e3d63250d78bbb830fc2/crates/ruff_linter/src/rules/flake8_comprehensions/mod.rs#L54-L58</p>
<p>I was playing with this branch locally and came up with this:</p>
<pre><code>    #[test_case(Rule::LoggingFString, Path::new(&quot;G004.py&quot;))]
    #[test_case(Rule::LoggingFString, Path::new(&quot;G004_arg_order.py&quot;))]
    fn preview_rules(rule_code: Rule, path: &amp;Path) -&gt; Result&lt;()&gt; {
        let snapshot = format!(
            &quot;preview__{}_{}&quot;,
            rule_code.noqa_code(),
            path.to_string_lossy()
        );
        let diagnostics = test_path(
            Path::new(&quot;flake8_logging_format&quot;).join(path).as_path(),
            &amp;settings::LinterSettings {
                logger_objects: vec![&quot;logging_setup.logger&quot;.to_string()],
                preview: PreviewMode::Enabled,
                ..settings::LinterSettings::for_rule(rule_code)
            },
        )?;
        assert_diagnostics!(snapshot, diagnostics);
        Ok(())
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/mod.rs</code>:67 on 2025-08-20 20:30</div>
            <div class="timeline-body"><p>See my comment above, it&#x27;s also good to see the snapshots for this. I was wondering where the other snapshot file was!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:58 on 2025-08-20 20:37</div>
            <div class="timeline-body"><p>I think this check is slightly too conservative  because <code>%%</code> escapes the <code>%</code> and would be okay, but I think that&#x27;s fine. It would complicate our analysis substantially because we&#x27;d have to make sure not to add a <code>%s</code> next to an existing <code>%</code>. I spent a little while playing with this and think this simple check is probably best for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/snapshots/ruff_linter__rules__flake8_logging_format__tests__G004_arg_order.py.snap</code>:20 on 2025-08-20 21:03</div>
            <div class="timeline-body"><p>Ahhh, I forgot that we&#x27;re already bailing out if an existing <code>%</code> is present, so we don&#x27;t have to worry about these fixes. I think we should also bail out if there are any existing positional arguments since that can also be a problem. And then we can avoid the <code>existing_names</code> code above.</p>
<p>To reach that point of the code, the user would have to have existing positional arguments but no <code>%</code> placeholders in the string, which either indicates a mistake, or even worse, an f-string like this:</p>
<pre><code>placeholder = &quot;%s&quot;
logging.error(f&quot;{placeholder}&quot;, 123)
</code></pre>
<p>which we also shouldn&#x27;t try to fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-08-20 21:07</div>
            <div class="timeline-body"><p>Thank you again, this is very nearly ready. I mostly had very small performance-related nits and a suggestion on test placement. There&#x27;s also one last edge case I came up with, but I think we can mostly delete code to solve it, which is always nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/hamirmahal">@hamirmahal</a> on 2025-08-24 22:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-08-26 14:50</div>
            <div class="timeline-body"><p>Excellent, thanks again!</p>
<p>I went through the ecosystem changes, and they look good too. We don&#x27;t show the suggested fix, but they all look like simple cases that I&#x27;d expect the fix to handle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;feat: add auto-fix for f-string logging statements&quot; to &quot;[`flake8-logging-format`] Add auto-fix for f-string logging calls (`G004`)&quot; by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-26 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-26 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-26 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-27 03:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hamirmahal">@hamirmahal</a> on 2025-08-27 03:12</div>
            <div class="timeline-body"><p>You&#x27;re welcome! Thanks for the suggestions and feedback.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:33 UTC
    </footer>
</body>
</html>
