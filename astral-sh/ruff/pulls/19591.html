<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-simplify`] Fix raw string handling in `SIM905` for embedded quotes - astral-sh/ruff #19591</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-simplify</code>] Fix raw string handling in <code>SIM905</code> for embedded quotes</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19591">#19591</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-07-28 03:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/danparizher">@danparizher</a> on 2025-07-28 03:14</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes #19577</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-28 03:24</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dylwil3 by @dylwil3 on 2025-07-29 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @MichaReiser on 2025-07-31 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/split_static_string.rs</code>:125 on 2025-08-01 19:09</div>
            <div class="timeline-body"><p>can you combine these conditions to reduce nesting and remove one of the <code>else</code> branches?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/split_static_string.rs</code>:163 on 2025-08-01 19:09</div>
            <div class="timeline-body"><p>it would be nice to preserve this comment - maybe in the definition of <code>element_flags</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> requested changes on 2025-08-01 19:15</div>
            <div class="timeline-body"><p>This looks good, thank you! A couple of nits and then a design point:</p>
<p>I think we should gate this fix behavior under preview, and when not in preview just skip the check in this situation.</p>
<p>The reason is that it's unclear to me if the best thing to do here is to offer your fix (which would change part of a raw string into a string with escapes), to skip the check here, or to offer the fix with the &quot;ugly&quot; triple quotes for the relevant list items (or some compromise - like offer your fix but make it <code>Unsafe</code>). On the other hand, we have to do <em>something</em> to fix the syntax error, and I think this arrangements allows us to consider the other options in the meantime without making a breaking change.</p>
<p>(But I could be overruled on this)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdulcet">@tdulcet</a> on 2025-08-02 08:58</div>
            <div class="timeline-body"><blockquote>
<p>The reason is that it's unclear to me if the best thing to do here is to offer your fix (which would change part of a raw string into a string with escapes), to skip the check here, or to offer the fix with the &quot;ugly&quot; triple quotes for the relevant list items</p>
</blockquote>
<p>At least in the example from #19577, there are no embedded single quote characters, so one should be able to cleanly convert it to a raw single quoted string without needing to add any additional escaping:</p>
<pre><code class="language-py">test_email_addresses = [
    r&quot;simple@example.com&quot;,
    r&quot;very.common@example.com&quot;,
    r&quot;FirstName.LastName@EasierReading.org&quot;,
    r&quot;x@example.com&quot;,
    r&quot;long.email-address-with-hyphens@and.subdomains.example.com&quot;,
    r&quot;user.name+tag+sorting@example.com&quot;,
    r&quot;name/surname@example.com&quot;,
    r&quot;xample@s.example&quot;,
    r'&quot; &quot;@example.org',
    r'&quot;john..doe&quot;@example.org',
    r&quot;mailhost!username@example.org&quot;,
    r'&quot;very.(),:;&lt;&gt;[]\&quot;.VERY.\&quot;very@\\ \&quot;very\&quot;.unusual&quot;@strange.example.com',
    r&quot;user%example.com@example.org&quot;,
    r&quot;user-@example.org&quot;,
    r&quot;I❤️CHOCOLATE@example.com&quot;,
    r&quot;this\ still\&quot;not\\allowed@example.com&quot;,
    r&quot;stellyamburrr985@example.com&quot;,
    r&quot;Abc.123@example.com&quot;,
    r&quot;user+mailbox/department=shipping@example.com&quot;,
    r&quot;!#$%&amp;'*+-/=?^_`.{|}~@example.com&quot;,
    r'&quot;Abc@def&quot;@example.com',
    r'&quot;Fred\ Bloggs&quot;@example.com',
    r'&quot;Joe.\\Blow&quot;@example.com',
]
</code></pre>
<p>In (rare) cases where a triple quoted string does include both single and double quote characters, I would argue that the keeping the triple quotes for those items would be better than adding escaping, which would make the resulting items very difficult to read, especially if they already include backslash characters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-08-03 16:21</div>
            <div class="timeline-body"><p>That's a good point @tdulcet , thank you! I think at that point it's maybe unobtrusive enough to fix the bug this way without gating behind preview. Let me know if the new snapshots look objectionable - otherwise I'll merge this in shortly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> approved on 2025-08-03 16:24</div>
            <div class="timeline-body"><p>Thanks @danparizher !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dylwil3 on 2025-08-03 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @dylwil3 on 2025-08-03 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8_simplify`] Fix raw string handling in `SIM905` for embedded quotes" to "[`flake8-simplify`] Fix raw string handling in `SIM905` for embedded quotes" by @dylwil3 on 2025-08-03 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2025-08-03 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-08-03 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-03 16:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:52:43 UTC
    </footer>
</body>
</html>
