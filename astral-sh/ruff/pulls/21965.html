<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Respect intersections in iterations - astral-sh/ruff #21965</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Respect intersections in iterations</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21965">#21965</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-12-13 19:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-13 19:28</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR implements the strategy described in https://github.com/astral-sh/ty/issues/1871: we iterate over the positive types, resolve them, then intersect the results.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-13 19:30</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-13 19:32</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">kornia (https://github.com/kornia/kornia)
- kornia/augmentation/container/augment.py:405:35: error[unresolved-attribute] Object of type `object` has no attribute `type`
- kornia/augmentation/container/augment.py:414:35: error[unresolved-attribute] Object of type `object` has no attribute `type`
- Found 765 diagnostics
+ Found 763 diagnostics

spack (https://github.com/spack/spack)
- lib/spack/spack/spec.py:2727:24: error[invalid-return-type] Return type does not match returned value: expected `tuple[Spec, int]`, found `tuple[Spec | str, int]`
- lib/spack/spack/spec.py:2727:76: warning[possibly-missing-attribute] Attribute `split` may be missing on object of type `Spec | str`
- Found 4297 diagnostics
+ Found 4295 diagnostics

pip (https://github.com/pypa/pip)
- src/pip/_vendor/rich/text.py:397:24: error[invalid-argument-type] Argument to bound method `append` is incorrect: Expected `Text | str`, found `str | Style`
- Found 613 diagnostics
+ Found 612 diagnostics

werkzeug (https://github.com/pallets/werkzeug)
+ src/werkzeug/test.py:436:38: error[invalid-argument-type] Argument to bound method `add_file` is incorrect: Expected `str | PathLike[str] | IO[bytes] | FileStorage`, found `bytes | IO[bytes] | str`
- src/werkzeug/test.py:436:38: error[invalid-argument-type] Argument to bound method `add_file` is incorrect: Expected `str | None`, found `IO[bytes] | str`
+ src/werkzeug/test.py:436:38: error[invalid-argument-type] Argument to bound method `add_file` is incorrect: Expected `str | None`, found `bytes | IO[bytes] | str`
- src/werkzeug/test.py:436:38: error[invalid-argument-type] Argument to bound method `add_file` is incorrect: Expected `str | None`, found `IO[bytes] | str`
+ src/werkzeug/test.py:436:38: error[invalid-argument-type] Argument to bound method `add_file` is incorrect: Expected `str | None`, found `bytes | IO[bytes] | str`
- Found 386 diagnostics
+ Found 387 diagnostics

rich (https://github.com/Textualize/rich)
- rich/text.py:397:24: error[invalid-argument-type] Argument to bound method `append` is incorrect: Expected `Text | str`, found `str | Style`
- Found 349 diagnostics
+ Found 348 diagnostics

dulwich (https://github.com/dulwich/dulwich)
- dulwich/porcelain/__init__.py:3539:41: error[invalid-argument-type] Argument to function `_make_branch_ref` is incorrect: Expected `str | bytes`, found `Unknown | (Sequence[str | bytes] &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | bytes`
+ dulwich/porcelain/__init__.py:3539:41: error[invalid-argument-type] Argument to function `_make_branch_ref` is incorrect: Expected `str | bytes`, found `(Sequence[str | bytes] &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | bytes | Unknown`

boostedblob (https://github.com/hauntsaninja/boostedblob)
- boostedblob/globals.py:81:13: error[invalid-assignment] Invalid subscript assignment with key of type `tuple[@Todo, ...] | (Any &amp; ~Top[list[Unknown]])` and value of type `Any` on object of type `dict[T@TokenManager, Any]`
+ boostedblob/globals.py:81:13: error[invalid-assignment] Invalid subscript assignment with key of type `tuple[Any, ...] | (Any &amp; ~Top[list[Unknown]])` and value of type `Any` on object of type `dict[T@TokenManager, Any]`
- boostedblob/globals.py:82:13: error[invalid-assignment] Invalid subscript assignment with key of type `tuple[@Todo, ...] | (Any &amp; ~Top[list[Unknown]])` and value of type `Any` on object of type `dict[T@TokenManager, int | float]`
+ boostedblob/globals.py:82:13: error[invalid-assignment] Invalid subscript assignment with key of type `tuple[Any, ...] | (Any &amp; ~Top[list[Unknown]])` and value of type `Any` on object of type `dict[T@TokenManager, int | float]`

urllib3 (https://github.com/urllib3/urllib3)
- src/urllib3/filepost.py:48:44: error[invalid-argument-type] Argument to bound method `from_tuples` is incorrect: Expected `str`, found `str | bytes | tuple[str, str | bytes] | tuple[str, str | bytes, str]`
- src/urllib3/filepost.py:48:44: error[invalid-argument-type] Argument to bound method `from_tuples` is incorrect: Expected `((str, str | bytes, /) -&gt; str) | None`, found `str | bytes | tuple[str, str | bytes] | tuple[str, str | bytes, str]`
- Found 268 diagnostics
+ Found 266 diagnostics

mkdocs (https://github.com/mkdocs/mkdocs)
- mkdocs/structure/nav.py:223:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `str`, found `@Todo | None`
+ mkdocs/structure/nav.py:223:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `str`, found `Unknown | None`

Tanjun (https://github.com/FasterSpeeding/Tanjun)
- tanjun/dependencies/data.py:347:12: error[invalid-return-type] Return type does not match returned value: expected `_T@cached_inject`, found `Coroutine[Any, Any, _T@cached_inject | Coroutine[Any, Any, _T@cached_inject]] | _T@cached_inject`
+ tanjun/dependencies/data.py:347:12: error[invalid-return-type] Return type does not match returned value: expected `_T@cached_inject`, found `_T@cached_inject | Coroutine[Any, Any, _T@cached_inject | Coroutine[Any, Any, _T@cached_inject]]`

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
+ pymongo/helpers_shared.py:171:27: error[invalid-argument-type] Argument to bound method `append` is incorrect: Expected `tuple[str, int]`, found `tuple[str, int | str | Mapping[str, Any]]`
+ pymongo/helpers_shared.py:191:21: error[invalid-argument-type] Method `__getitem__` of type `bound method Mapping[str, Any].__getitem__(key: str, /) -&gt; Any` cannot be called with key of type `str | tuple[str, int | str | Mapping[str, Any]]` on object of type `Mapping[str, Any]`
+ pymongo/helpers_shared.py:193:13: error[invalid-assignment] Invalid subscript assignment with key of type `str | tuple[str, int | str | Mapping[str, Any]]` and value of type `@Todo` on object of type `dict[str, Any]`
- Found 446 diagnostics
+ Found 449 diagnostics

xarray (https://github.com/pydata/xarray)
- xarray/core/dataarray.py:5737:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `T_Xarray@map_blocks | DataArray | Dataset`
+ xarray/core/dataarray.py:5737:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `DataArray | Dataset`
- xarray/core/dataset.py:8866:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `T_Xarray@map_blocks | DataArray | Dataset`
+ xarray/core/dataset.py:8866:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `DataArray | Dataset`

cwltool (https://github.com/common-workflow-language/cwltool)
+ cwltool/cwlprov/provenance_profile.py:563:37: error[invalid-argument-type] Argument to bound method `used_artefacts` is incorrect: Expected `MutableMapping[str, None | int | str | ... omitted 3 union elements] | list[MutableMapping[str, None | int | str | ... omitted 3 union elements]]`, found `str | MutableMapping[str, None | int | str | ... omitted 3 union elements]`
+ cwltool/cwlprov/provenance_profile.py:592:43: error[invalid-argument-type] Argument to bound method `generate_output_prov` is incorrect: Expected `MutableMapping[str, None | int | str | ... omitted 3 union elements] | MutableSequence[MutableMapping[str, None | int | str | ... omitted 3 union elements]] | None`, found `str | MutableMapping[str, None | int | str | ... omitted 3 union elements]`
+ cwltool/process.py:321:47: error[invalid-argument-type] Argument to function `_collectDirEntries` is incorrect: Expected `MutableMapping[str, None | int | str | ... omitted 3 union elements] | MutableSequence[MutableMapping[str, None | int | str | ... omitted 3 union elements]] | None`, found `str | MutableMapping[str, None | int | str | ... omitted 3 union elements]`
- cwltool/utils.py:186:13: error[invalid-assignment] Invalid subscript assignment with key of type `str | @Todo` and value of type `str | MutableSequence[Any] | MutableMapping[str, Any]` on object of type `MutableSequence[Any]`
+ cwltool/utils.py:186:13: error[invalid-assignment] Invalid subscript assignment with key of type `str | Any` and value of type `str | MutableSequence[Any] | MutableMapping[str, Any]` on object of type `MutableSequence[Any]`
- Found 242 diagnostics
+ Found 245 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
- src/integrations/prefect-dbt/prefect_dbt/core/settings.py:94:28: error[invalid-assignment] Object of type `dict[str, Any] | T@resolve_block_document_references` is not assignable to `dict[str, Any]`
+ src/integrations/prefect-dbt/prefect_dbt/core/settings.py:94:28: error[invalid-assignment] Object of type `dict[str, Any] | T@resolve_block_document_references | str | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/integrations/prefect-dbt/prefect_dbt/core/settings.py:99:28: error[invalid-assignment] Object of type `dict[str, Any] | T@resolve_variables` is not assignable to `dict[str, Any]`
+ src/integrations/prefect-dbt/prefect_dbt/core/settings.py:99:28: error[invalid-assignment] Object of type `dict[str, Any] | T@resolve_variables | str | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/cli/deploy/_core.py:86:21: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/prefect/cli/deploy/_core.py:86:21: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/cli/deploy/_core.py:87:21: error[invalid-assignment] Object of type `T@resolve_variables` is not assignable to `dict[str, Any]`
+ src/prefect/cli/deploy/_core.py:87:21: error[invalid-assignment] Object of type `T@resolve_variables | str | int | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/deployments/steps/core.py:137:38: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any]`
+ src/prefect/deployments/steps/core.py:137:38: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements`
- src/prefect/utilities/templating.py:320:13: error[invalid-assignment] Invalid subscript assignment with key of type `object` and value of type `T@resolve_block_document_references | dict[str, Any]` on object of type `dict[str, Any]`
+ src/prefect/utilities/templating.py:320:13: error[invalid-assignment] Invalid subscript assignment with key of type `object` and value of type `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements` on object of type `dict[str, Any]`
- src/prefect/utilities/templating.py:323:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_block_document_references | dict[str, Any]`, found `list[T@resolve_block_document_references | dict[str, Any] | Unknown]`
+ src/prefect/utilities/templating.py:323:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_block_document_references | dict[str, Any]`, found `list[T@resolve_block_document_references | dict[str, Any] | str | ... omitted 5 union elements]`
- src/prefect/utilities/templating.py:437:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `dict[object, T@resolve_variables | Unknown]`
+ src/prefect/utilities/templating.py:437:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `dict[object, T@resolve_variables | str | int | ... omitted 5 union elements]`
- src/prefect/utilities/templating.py:442:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `list[T@resolve_variables | Unknown]`
+ src/prefect/utilities/templating.py:442:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `list[T@resolve_variables | str | int | ... omitted 5 union elements]`
- src/prefect/workers/base.py:228:13: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any]`
+ src/prefect/workers/base.py:228:13: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any] | str | ... omitted 4 union elements`
- src/prefect/workers/base.py:230:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `T@resolve_variables`
+ src/prefect/workers/base.py:230:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `T@resolve_variables | str | int | ... omitted 4 union elements`

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
- src/scikit_build_core/build/wheel.py:98:20: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- src/scikit_build_core/metadata/__init__.py:94:36: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 44 diagnostics
+ Found 42 diagnostics

arviz (https://github.com/arviz-devs/arviz)
- arviz/data/io_pystan.py:151:28: warning[possibly-missing-attribute] Attribute `values` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[@Todo | str, @Todo | str]`
+ arviz/data/io_pystan.py:151:28: warning[possibly-missing-attribute] Attribute `values` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[Unknown | str, Unknown | str]`
- arviz/data/io_pystan.py:157:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[@Todo | str, @Todo | str]`
+ arviz/data/io_pystan.py:157:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[Unknown | str, Unknown | str]`
- arviz/data/io_pystan.py:163:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[@Todo | str, @Todo | str]`
+ arviz/data/io_pystan.py:163:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[Unknown | str, Unknown | str]`
- arviz/data/io_pystan.py:437:28: warning[possibly-missing-attribute] Attribute `values` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[@Todo | str, @Todo | str]`
+ arviz/data/io_pystan.py:437:28: warning[possibly-missing-attribute] Attribute `values` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[Unknown | str, Unknown | str]`
- arviz/data/io_pystan.py:443:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[@Todo | str, @Todo | str]`
+ arviz/data/io_pystan.py:443:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[Unknown | str, Unknown | str]`
- arviz/data/io_pystan.py:448:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[@Todo | str, @Todo | str]`
+ arviz/data/io_pystan.py:448:48: warning[possibly-missing-attribute] Attribute `items` may be missing on object of type `(Unknown &amp; ~str &amp; ~Top[list[Unknown]] &amp; ~tuple[object, ...]) | None | dict[Unknown | str, Unknown | str]`

bokeh (https://github.com/bokeh/bokeh)
- src/bokeh/plotting/_plot.py:106:32: error[invalid-argument-type] Argument is incorrect: Expected `int | float | datetime | timedelta`, found `int | float | str | (@Todo &amp; ~None) | IntrinsicType`
+ src/bokeh/plotting/_plot.py:106:32: error[invalid-argument-type] Argument is incorrect: Expected `int | float | datetime | timedelta`, found `int | float | str | (Unknown &amp; ~None) | IntrinsicType`
- src/bokeh/plotting/_plot.py:106:45: error[invalid-argument-type] Argument is incorrect: Expected `int | float | datetime | timedelta`, found `int | float | str | (@Todo &amp; ~None) | IntrinsicType`
+ src/bokeh/plotting/_plot.py:106:45: error[invalid-argument-type] Argument is incorrect: Expected `int | float | datetime | timedelta`, found `int | float | str | (Unknown &amp; ~None) | IntrinsicType`

pandas (https://github.com/pandas-dev/pandas)
- pandas/tests/extension/date/array.py:99:31: warning[redundant-cast] Value is already of type `ndarray[tuple[Any, ...], dtype[Any]]`
- Found 3736 diagnostics
+ Found 3735 diagnostics

zulip (https://github.com/zulip/zulip)
- zerver/lib/rest.py:153:27: error[unresolved-attribute] Object of type `((...) -&gt; HttpResponse) | set[str]` has no attribute `__name__`
+ zerver/lib/rest.py:153:27: error[unresolved-attribute] Object of type `(...) -&gt; HttpResponse` has no attribute `__name__`
- zerver/lib/rest.py:164:12: error[unsupported-operator] Operator `not in` is not supported between objects of type `Literal[&quot;narrow_user_session_cache&quot;]` and `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:170:8: error[unsupported-operator] Operator `in` is not supported between objects of type `Literal[&quot;override_api_url_scheme&quot;]` and `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:176:80: error[invalid-argument-type] Argument is incorrect: Expected `(...) -&gt; HttpResponse`, found `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:177:10: error[unsupported-operator] Operator `in` is not supported between objects of type `Literal[&quot;override_api_url_scheme&quot;]` and `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:182:83: error[invalid-argument-type] Argument is incorrect: Expected `(...) -&gt; HttpResponse`, found `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:187:12: error[unsupported-operator] Operator `in` is not supported between objects of type `Literal[&quot;override_api_url_scheme&quot;]` and `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:189:64: error[invalid-argument-type] Argument to function `authenticated_json_view` is incorrect: Expected `(...) -&gt; HttpResponse`, found `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:197:34: error[unsupported-operator] Operator `in` is not supported between objects of type `Literal[&quot;allow_incoming_webhooks&quot;]` and `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:198:11: error[invalid-argument-type] Argument is incorrect: Expected `(...) -&gt; HttpResponse`, found `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:201:13: error[unsupported-operator] Operator `in` is not supported between objects of type `Literal[&quot;allow_anonymous_user_web&quot;]` and `((...) -&gt; HttpResponse) | set[str]`
- zerver/lib/rest.py:205:57: error[invalid-argument-type] Argument to function `public_json_view` is incorrect: Expected `(...) -&gt; HttpResponse`, found `((...) -&gt; HttpResponse) | set[str]`
- zilencer/auth.py:170:45: error[invalid-argument-type] Argument to function `authenticated_remote_server_view` is incorrect: Expected `(...) -&gt; HttpResponse`, found `((...) -&gt; HttpResponse) | set[str]`
- Found 3676 diagnostics
+ Found 3664 diagnostics

jax (https://github.com/google/jax)
+ jax/_src/numpy/tensor_contractions.py:548:46: error[invalid-argument-type] Argument to function `canonicalize_axis` is incorrect: Expected `SupportsIndex`, found `int | Sequence[int]`
+ jax/_src/numpy/tensor_contractions.py:549:46: error[invalid-argument-type] Argument to function `canonicalize_axis` is incorrect: Expected `SupportsIndex`, found `int | Sequence[int]`
+ jax/_src/tree_util.py:295:31: error[invalid-argument-type] Argument to bound method `register_node` is incorrect: Expected `(Hashable, Iterable[object], /) -&gt; T@register_pytree_node`, found `(_AuxData@register_pytree_node, _Children@register_pytree_node, /) -&gt; T@register_pytree_node`
+ jax/_src/tree_util.py:298:31: error[invalid-argument-type] Argument to bound method `register_node` is incorrect: Expected `(Hashable, Iterable[object], /) -&gt; T@register_pytree_node`, found `(_AuxData@register_pytree_node, _Children@register_pytree_node, /) -&gt; T@register_pytree_node`
+ jax/_src/tree_util.py:301:31: error[invalid-argument-type] Argument to bound method `register_node` is incorrect: Expected `(Hashable, Iterable[object], /) -&gt; T@register_pytree_node`, found `(_AuxData@register_pytree_node, _Children@register_pytree_node, /) -&gt; T@register_pytree_node`
- Found 2799 diagnostics
+ Found 2804 diagnostics

static-frame (https://github.com/static-frame/static-frame)
+ static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Bus[Any] | Top[Index[Any]] | Top[Series[Any, Any]] | ... omitted 7 union elements, object_]`
- static_frame/core/bus.py:675:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Bus[Any], object_]`, found `InterGetItemILocReduces[Bus[Any], object_ | Self@iloc]`
+ static_frame/core/bus.py:675:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Bus[Any], object_]`, found `InterGetItemILocReduces[Bus[Any] | Top[Index[Any]] | TypeBlocks | ... omitted 7 union elements, object_ | Self@iloc]`
- static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any], generic[object]]`
+ static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any] | TypeBlocks | Batch | ... omitted 6 union elements, generic[object]]`
- Found 1838 diagnostics
+ Found 1839 diagnostics

sympy (https://github.com/sympy/sympy)
- sympy/geometry/line.py:2544:26: warning[possibly-missing-attribute] Attribute `x` may be missing on object of type `@Todo | Point`
+ sympy/geometry/line.py:2544:26: warning[possibly-missing-attribute] Attribute `x` may be missing on object of type `(Unknown &amp; Basic) | Point`
- sympy/geometry/line.py:2544:53: warning[possibly-missing-attribute] Attribute `y` may be missing on object of type `@Todo | Point`
+ sympy/geometry/line.py:2544:53: warning[possibly-missing-attribute] Attribute `y` may be missing on object of type `(Unknown &amp; Basic) | Point`
- sympy/geometry/line.py:2545:26: warning[possibly-missing-attribute] Attribute `z` may be missing on object of type `@Todo | Point`
+ sympy/geometry/line.py:2545:26: warning[possibly-missing-attribute] Attribute `z` may be missing on object of type `(Unknown &amp; Basic) | Point`
- sympy/geometry/line.py:2726:26: warning[possibly-missing-attribute] Attribute `x` may be missing on object of type `@Todo | Point`
+ sympy/geometry/line.py:2726:26: warning[possibly-missing-attribute] Attribute `x` may be missing on object of type `(Unknown &amp; Basic) | Point`
- sympy/geometry/line.py:2726:53: warning[possibly-missing-attribute] Attribute `y` may be missing on object of type `@Todo | Point`
+ sympy/geometry/line.py:2726:53: warning[possibly-missing-attribute] Attribute `y` may be missing on object of type `(Unknown &amp; Basic) | Point`
- sympy/geometry/line.py:2727:26: warning[possibly-missing-attribute] Attribute `z` may be missing on object of type `@Todo | Point`
+ sympy/geometry/line.py:2727:26: warning[possibly-missing-attribute] Attribute `z` may be missing on object of type `(Unknown &amp; Basic) | Point`

rotki (https://github.com/rotki/rotki)
- rotkehlchen/chain/decoding/tools.py:97:13: error[invalid-argument-type] Argument to function `decode_transfer_direction` is incorrect: Expected `(A@BaseDecoderTools &amp; BTCAddress) | (A@BaseDecoderTools &amp; ChecksumAddress) | (A@BaseDecoderTools &amp; SubstrateAddress) | (A@BaseDecoderTools &amp; SolanaAddress)`, found `A@BaseDecoderTools`
+ rotkehlchen/chain/decoding/tools.py:99:13: error[invalid-argument-type] Argument to function `decode_transfer_direction` is incorrect: Expected `Sequence[A@BaseDecoderTools]`, found `Unknown | tuple[BTCAddress, ...] | tuple[ChecksumAddress, ...] | tuple[SubstrateAddress, ...] | tuple[SolanaAddress, ...]`
- rotkehlchen/chain/decoding/tools.py:98:13: error[invalid-argument-type] Argument to function `decode_transfer_direction` is incorrect: Expected `(A@BaseDecoderTools &amp; BTCAddress) | (A@BaseDecoderTools &amp; ChecksumAddress) | (A@BaseDecoderTools &amp; SubstrateAddress) | (A@BaseDecoderTools &amp; SolanaAddress) | None`, found `A@BaseDecoderTools | None`
- rotkehlchen/chain/decoding/tools.py:99:13: error[invalid-argument-type] Argument to function `decode_transfer_direction` is incorrect: Expected `Sequence[(A@BaseDecoderTools &amp; BTCAddress) | (A@BaseDecoderTools &amp; ChecksumAddress) | (A@BaseDecoderTools &amp; SubstrateAddress) | (A@BaseDecoderTools &amp; SolanaAddress)]`, found `Unknown | tuple[BTCAddress, ...] | tuple[ChecksumAddress, ...] | tuple[SubstrateAddress, ...] | tuple[SolanaAddress, ...]`
- Found 2093 diagnostics
+ Found 2091 diagnostics

core (https://github.com/home-assistant/core)
- homeassistant/components/template/light.py:738:13: error[invalid-assignment] Object of type `tuple[None | int | @Todo, None | int | @Todo, None | int | @Todo]` is not assignable to attribute `_attr_rgb_color` of type `tuple[int, int, int] | None`
+ homeassistant/components/template/light.py:738:13: error[invalid-assignment] Object of type `tuple[None | int | Unknown, None | int | Unknown, None | int | Unknown]` is not assignable to attribute `_attr_rgb_color` of type `tuple[int, int, int] | None`
- homeassistant/components/template/light.py:783:13: error[invalid-assignment] Object of type `tuple[None | int | @Todo, None | int | @Todo, None | int | @Todo, None | int | @Todo]` is not assignable to attribute `_attr_rgbw_color` of type `tuple[int, int, int, int] | None`
+ homeassistant/components/template/light.py:783:13: error[invalid-assignment] Object of type `tuple[None | int | Unknown, None | int | Unknown, None | int | Unknown, None | int | Unknown]` is not assignable to attribute `_attr_rgbw_color` of type `tuple[int, int, int, int] | None`
- homeassistant/components/template/light.py:829:13: error[invalid-assignment] Object of type `tuple[None | int | @Todo, None | int | @Todo, None | int | @Todo, None | int | @Todo, None | int | @Todo]` is not assignable to attribute `_attr_rgbww_color` of type `tuple[int, int, int, int, int] | None`
+ homeassistant/components/template/light.py:829:13: error[invalid-assignment] Object of type `tuple[None | int | Unknown, None | int | Unknown, None | int | Unknown, None | int | Unknown, None | int | Unknown]` is not assignable to attribute `_attr_rgbww_color` of type `tuple[int, int, int, int, int] | None`
- homeassistant/util/variance.py:47:12: error[invalid-return-type] Return type does not match returned value: expected `(**_P@ignore_variance) -&gt; _R@ignore_variance`, found `_Wrapped[_P@ignore_variance, _R@ignore_variance | int | float | datetime, _P@ignore_variance, _R@ignore_variance | int | float | datetime]`
- Found 14420 diagnostics
+ Found 14419 diagnostics

materialize (https://github.com/MaterializeInc/materialize)
+ misc/python/materialize/feature_benchmark/benchmark.py:119:17: warning[possibly-missing-attribute] Attribute `run` may be missing on object of type `None | Action | Unknown`
+ misc/python/materialize/feature_benchmark/benchmark.py:131:17: warning[possibly-missing-attribute] Attribute `run` may be missing on object of type `None | Action | Unknown`
+ misc/python/materialize/feature_benchmark/benchmark.py:142:17: warning[possibly-missing-attribute] Attribute `run` may be missing on object of type `None | Action | Unknown`
- Found 309 diagnostics
+ Found 312 diagnostics

pydantic (https://github.com/pydantic/pydantic)
- pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
+ pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
- pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`
+ pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, Divergent], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`


</code></pre>
</details>

<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Respect intersections in iterations" to "[ty] Respect intersections in iterations" by @charliermarsh on 2025-12-13 19:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @charliermarsh on 2025-12-13 19:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-13 20:07</div>
            <div class="timeline-body"><p>The ecosystem changes in Materialize seems incorrect, hmm...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-13 20:43</div>
            <div class="timeline-body"><p>Those diagnostics on materialize are correct, though arguably pedantic. They are us recognizing that it is possible for there to be a common subtype of <code>Action</code> and <code>list</code>, so the <code>isinstance(shared, list)</code> does not actually rule out <code>shared</code> being a subclass of <code>Action</code>. And <code>Action</code> has an <code>__iter__</code> method that returns <code>Iterator[None]</code>.</p>
<p>The fix for this code would be to check <code>isinstance(shared, Action)</code> instead of <code>isinstance(shared, list)</code>. (Or make <code>Action</code> <code>@final</code>.)</p>
<p>We could debate whether ty's pedantic correctness is <em>useful</em> in this kind of scenario (https://github.com/astral-sh/ty/issues/1578 tracks this), but in any case, it's not a problem for this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-12-13 20:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:6622 on 2025-12-13 20:49</div>
            <div class="timeline-body"><p>I don't think short-circuiting here (or above, for the first element) is correct. The error-handling logic here needs to be &quot;collect all successful results, ignoring failed ones, and intersect the successful ones&quot;. We should only fail iteration if <em>all</em> intersection elements fail to iterate.</p>
<p>We should add some tests where some intersection elements fail to iterate and others succeed. And some where all intersection elements fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2025-12-13 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @charliermarsh on 2025-12-13 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @charliermarsh on 2025-12-13 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @charliermarsh on 2025-12-13 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-13 22:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:1806 on 2025-12-13 22:21</div>
            <div class="timeline-body"><p>this branch doesn't have any test coverage yet -- I can apply this diff to your branch, and no tests fail:</p>
<pre><code class="language-diff">diff --git a/crates/ty_python_semantic/src/types/tuple.rs b/crates/ty_python_semantic/src/types/tuple.rs
index e551871539..566385ad14 100644
--- a/crates/ty_python_semantic/src/types/tuple.rs
+++ b/crates/ty_python_semantic/src/types/tuple.rs
@@ -1799,27 +1799,12 @@ impl&lt;'db&gt; TupleSpecBuilder&lt;'db&gt; {
     /// `tuple[int, str, bytes]`, the result will be a tuple-spec builder for
     /// `tuple[int &amp; str &amp; bytes, ...]`.
     pub(crate) fn intersect(mut self, db: &amp;'db dyn Db, other: &amp;TupleSpec&lt;'db&gt;) -&gt; Self {
-        match (&amp;mut self, other) {
-            (TupleSpecBuilder::Fixed(our_elements), TupleSpec::Fixed(new_elements))
-                if our_elements.len() == new_elements.len() =&gt;
-            {
-                for (existing, new) in our_elements.iter_mut().zip(new_elements.elements()) {
-                    *existing = IntersectionType::from_elements(db, [*existing, *new]);
-                }
-                self
-            }
-
-            _ =&gt; {
-                let intersected = IntersectionType::from_elements(
-                    db,
-                    self.all_elements().chain(other.all_elements()),
-                );
-                TupleSpecBuilder::Variable {
-                    prefix: vec![],
-                    variable: intersected,
-                    suffix: vec![],
-                }
-            }
+        let intersected =
+            IntersectionType::from_elements(db, self.all_elements().chain(other.all_elements()));
+        TupleSpecBuilder::Variable {
+            prefix: vec![],
+            variable: intersected,
+            suffix: vec![],
         }
     }
</code></pre>
<p>and in fact, I can't immediately think of a test that fails with that diff applied so -- unless you can -- that might just be a good simplification to make?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-13 22:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:1806 on 2025-12-13 22:31</div>
            <div class="timeline-body"><p>I tried writing this test to exercise the logic in this branch, but it doesn't look like it has the correct results right now...</p>
<pre><code class="language-py">from collections.abc import Iterator

class Foo:
    def __iter__(self) -&gt; Iterator[object]:
        raise NotImplementedError

def f(x: tuple[int, str, bytes]):
    if isinstance(x, Foo):
        a, b, c = x
        reveal_type(a)  # revealed: Unknown
        reveal_type(tuple(x))  # revealed: tuple[()]
</code></pre>
<p>that might be due to pre-existing issues rather than a bug in your PR, though -- not sure. We get those bad revealed types on <code>main</code> too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @carljm on 2025-12-15 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-15 18:59</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 7 | 13 | 6 |
| <code>possibly-missing-attribute</code> | 3 | 1 | 12 |
| <code>invalid-assignment</code> | 1 | 0 | 6 |
| <code>invalid-return-type</code> | 0 | 2 | 4 |
| <code>unsupported-operator</code> | 0 | 6 | 0 |
| <code>unresolved-attribute</code> | 0 | 2 | 1 |
| <code>redundant-cast</code> | 0 | 1 | 0 |
| <code>unused-ignore-comment</code> | 0 | 1 | 0 |
| <strong>Total</strong> | <strong>11</strong> | <strong>26</strong> | <strong>29</strong> |</p>
<p><strong><a href="https://charlie-int.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://charlie-int.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-12-19 01:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:1806 on 2025-12-19 01:39</div>
            <div class="timeline-body"><p>Okay, added handling for some other cases:</p>
<ul>
<li>Fixed-length tuple with a homogenous iterable (your example here)</li>
<li>Two variable-length, homogenous iterables</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @charliermarsh on 2025-12-19 01:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @charliermarsh on 2025-12-19 01:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/tuple.rs</code>:1796 on 2025-12-19 15:03</div>
            <div class="timeline-body"><p>My concern here is that if you have two tuples <code>X</code> and <code>Y</code>, the tuple spec of <code>X &amp; Y</code> should <em>always</em> be narrower than either the tuple spec for <code>X</code> or the tuple spec for <code>Y</code>. The last branch of this method violates that, I think: you could end up with a spec from the intersected tuples that's broader than one of the two tuples being thrown into the intersection, which is going to lead to some seriously weird behaviour at some point ðŸ˜„</p>
<p>Here's a version of this method that's still not totally free of TODOs, but I think is much more generalised than what you have currently:</p>
<pre><code class="language-rs">    /// Return a new tuple-spec builder that reflects the intersection of this tuple and another tuple.
    ///
    /// For example, if `self` is a tuple-spec builder for `tuple[int, str]` and `other` is a
    /// tuple-spec for `tuple[object, object]`, the result will be a tuple-spec builder for
    /// `tuple[int, str]` (since `int &amp; object` simplifies to `int`, and `str &amp; object` to `str`).
    pub(crate) fn intersect(mut self, db: &amp;'db dyn Db, other: &amp;TupleSpec&lt;'db&gt;) -&gt; Self {
        match (&amp;mut self, other) {
            // Both fixed-length with the same length: element-wise intersection.
            (TupleSpecBuilder::Fixed(our_elements), TupleSpec::Fixed(new_elements))
                if our_elements.len() == new_elements.len() =&gt;
            {
                for (existing, new) in our_elements.iter_mut().zip(new_elements.elements()) {
                    *existing = IntersectionType::from_elements(db, [*existing, *new]);
                }
                return self;
            }

            (TupleSpecBuilder::Fixed(our_elements), TupleSpec::Variable(var)) =&gt; {
                if let Ok(tuple) = var.resize(db, TupleLength::Fixed(our_elements.len())) {
                    return self.intersect(db, &amp;tuple);
                }
            }

            (TupleSpecBuilder::Variable { .. }, TupleSpec::Fixed(fixed)) =&gt; {
                if let Ok(tuple) = self
                    .clone()
                    .build()
                    .resize(db, TupleLength::Fixed(fixed.len()))
                {
                    return TupleSpecBuilder::from(&amp;tuple).intersect(db, other);
                }
            }

            (
                TupleSpecBuilder::Variable {
                    prefix,
                    variable,
                    suffix,
                },
                TupleSpec::Variable(var),
            ) =&gt; {
                if prefix.len() == var.prefix.len() &amp;&amp; suffix.len() == var.suffix.len() {
                    for (existing, new) in prefix.iter_mut().zip(var.prefix_elements()) {
                        *existing = IntersectionType::from_elements(db, [*existing, *new]);
                    }
                    *variable = IntersectionType::from_elements(db, [*variable, var.variable]);
                    for (existing, new) in suffix.iter_mut().zip(var.suffix_elements()) {
                        *existing = IntersectionType::from_elements(db, [*existing, *new]);
                    }
                    return self;
                }

                let self_built = self.clone().build();
                let self_len = self_built.len();
                if let Ok(resized) = var.resize(db, self_len) {
                    return self.intersect(db, &amp;resized);
                } else if let Ok(resized) = self_built.resize(db, var.len()) {
                    return TupleSpecBuilder::from(&amp;resized).intersect(db, other);
                }
            }

            _ =&gt; {}
        }

        // TODO: probably incorrect? `tuple[int, str] &amp; tuple[int, str, bytes]` should resolve to `Never`.
        // So maybe this function should be fallible (return an `Option`)?
        let intersected =
            IntersectionType::from_elements(db, self.all_elements().chain(other.all_elements()));
        TupleSpecBuilder::Variable {
            prefix: vec![],
            variable: intersected,
            suffix: vec![],
        }
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-12-19 15:03</div>
            <div class="timeline-body"><p>Thanks, looks good</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @AlexWaygood on 2025-12-19 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @AlexWaygood on 2025-12-19 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-12-19 17:32</div>
            <div class="timeline-body"><p>ecosystem report LG!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2025-12-19 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-12-19 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-19 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-19 17:36</div>
            <div class="timeline-body"><p>Tyvm!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:36:42 UTC
    </footer>
</body>
</html>
