<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move `ExprConstant::kind` to `StringConstant::unicode` - astral-sh/ruff #7180</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Move <code>ExprConstant::kind</code> to <code>StringConstant::unicode</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7180">#7180</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-09-06 07:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR refactors the <code>ExprConstant::kind</code> field to instead use
<code>StringConstant::unicode</code> to indicate a unicode string literal. The <code>kind</code>
field serves no other purpose, and is not used in any other way. This means
allocating a string to store <code>u</code>/<code>U</code> seems unnecessary.</p>
<p>The new field is similar to <code>implicit_concatenated</code>. It is a <code>bool</code> that
indicates whether the string literal is a unicode string literal.</p>
<p>This will also be useful in the f-string parsing to create an enum for possible
string literal types in implicit concatenation which are strings, bytes or
f-strings.</p>
<h2>Test Plan</h2>
<pre><code>cargo test --workspace --all-features
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-09-06 07:11</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #7180</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7180" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7180?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff/src/checkers/ast/analyze/expression.rs</code>:1227 on 2023-09-06 07:12</div>
            <div class="timeline-body"><p>We could instead add <code>is_unicode</code> but it seems redundant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_expr.rs</code>:218 on 2023-09-06 07:13</div>
            <div class="timeline-body"><p>This kind of change is required wherever the <code>kind</code> field was used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff/src/rules/pyupgrade/rules/unicode_kind_prefix.rs</code>:45 on 2023-09-06 07:14</div>
            <div class="timeline-body"><p>This is the only usage for the <code>unicode</code> field.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/comparable.rs</code>:337 on 2023-09-06 07:16</div>
            <div class="timeline-body"><p>I added this mainly as it's present in <code>ExprConstant</code> for <code>ComparableExpr</code> as well but I just checked this in Python that <code>&quot;foo&quot; == u&quot;foo&quot;</code> gives <code>True</code>. I think then the <code>unicode</code> field here should be removed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2023-09-06 07:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-09-06 07:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @MichaReiser on 2023-09-06 07:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-06 07:21</div>
            <div class="timeline-body"><p>Thanks for following up on this. Could you start adding the appropriate labels to your PR? Setting the appropriate label reduces the work involved in creating a new PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-09-06 07:22</div>
            <div class="timeline-body"><blockquote>
<p>Could you start adding the appropriate labels to your PR? Setting the appropriate label reduces the work involved in creating a new PR</p>
</blockquote>
<p>Yeah, sorry. I'll keep that in mind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-06 07:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/comparable.rs</code>:337 on 2023-09-06 07:23</div>
            <div class="timeline-body"><p>I'm not sure. Mainly because I never fully understood <code>ComparableExpr</code>. Is its intend to test if two trees are identical or if they resolve to the same runtime value? I think the later isn't true because that would require more than just comparing the expression trees but some of the implementation certainly does more so that the former isn't true either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2023-09-06 07:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/comparable.rs</code>:337 on 2023-09-06 07:35</div>
            <div class="timeline-body"><p>That's a good point. I think we should leave it as it is to match the old behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2023-09-06 07:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-09-06 07:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-06 07:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-09-06 07:47</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:04 UTC
    </footer>
</body>
</html>
