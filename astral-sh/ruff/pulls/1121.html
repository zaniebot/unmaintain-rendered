<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-generate the rules table of contents - astral-sh/ruff #1121</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Auto-generate the rules table of contents</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1121">#1121</a>
        opened by <a href="https://github.com/phillipuniverse">@phillipuniverse</a>
        on 2022-12-07 14:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/phillipuniverse">@phillipuniverse</a></div>
            <div class="timeline-body"><p>Follow-up to <a href="https://github.com/charliermarsh/ruff/pull/1109">charliermarsh/ruff#1109</a>#discussion_r1041740034</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/phillipuniverse">@phillipuniverse</a> reviewed on 2022-12-07 14:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:82 on 2022-12-07 14:31</div>
            <div class="timeline-body"><p>I wasn&#x27;t sure what the &quot;right&quot; way to handle multiple results here. I wanted to do something like:</p>
<pre><code>return Result(toc_ok, table_ok)
</code></pre>
<p>or pythonic-like:</p>
<pre><code>return toc_ok and table_ok
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:110 on 2022-12-07 14:31</div>
            <div class="timeline-body"><p>I removed the 2nd newline because rendering it inside the list caused an extra line to show up between list elements and it looked weird.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/phillipuniverse">@phillipuniverse</a> reviewed on 2022-12-07 14:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:82 on 2022-12-07 14:32</div>
            <div class="timeline-body"><p>I think here, you probably want:</p>
<pre><code>replace_readme_section(toc_out, TOC_BEGIN_PRAGMA, TOC_END_PRAGMA)?;
replace_readme_section(table_out, TABLE_BEGIN_PRAGMA, TABLE_END_PRAGMA)?;
</code></pre>
<p>That way, if either call returns an <code>Err</code>, this caller function will stop immediately and return that error.</p>
<p>(As-written, the code will basically ignore / drop the errors.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-07 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/phillipuniverse">@phillipuniverse</a> reviewed on 2022-12-07 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:79 on 2022-12-07 14:32</div>
            <div class="timeline-body"><p>Whoops - fixing this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/phillipuniverse">@phillipuniverse</a> reviewed on 2022-12-07 14:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:82 on 2022-12-07 14:33</div>
            <div class="timeline-body"><p>Got it, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-07 14:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff_dev/src/generate_rules_table.rs</code>:82 on 2022-12-07 14:34</div>
            <div class="timeline-body"><p>See my other comment!</p>
<p>If you&#x27;re calling a function that returns <code>Result&lt;T&gt;</code> from a function that returns <code>Result&lt;T&gt;</code> (as is the case here), you can always do <code>let ok_value = foo()?</code>, which will leave <code>ok_value</code> as type <code>T</code> but return immediately if <code>foo</code> returned an error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2022-12-07 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-07 14:39</div>
            <div class="timeline-body"><p>Seeing a few minor lint errors when running <code>cargo +nightly clippy --workspace --all-targets --all-features -- -W clippy::pedantic</code> but otherwise good to go:</p>
<pre><code>warning: variables can be used directly in the `format!` string
  --&gt; ruff_dev/src/generate_rules_table.rs:33:29
   |
33 |         table_out.push_str(&amp;format!(&quot;### {} ({})&quot;, check_category.title(), codes_csv));
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
   = note: `-W clippy::uninlined-format-args` implied by `-W clippy::pedantic`
help: change this to
   |
33 -         table_out.push_str(&amp;format!(&quot;### {} ({})&quot;, check_category.title(), codes_csv));
33 +         table_out.push_str(&amp;format!(&quot;### {} ({codes_csv})&quot;, check_category.title()));
   |

warning: single-character string constant used as pattern
  --&gt; ruff_dev/src/generate_rules_table.rs:41:59
   |
41 |             check_category.title().to_lowercase().replace(&quot; &quot;, &quot;-&quot;),
   |                                                           ^^^ help: try using a `char` instead: `&#x27; &#x27;`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#single_char_pattern
   = note: `#[warn(clippy::single_char_pattern)]` on by default

warning: single-character string constant used as pattern
  --&gt; ruff_dev/src/generate_rules_table.rs:42:64
   |
42 |             codes_csv.to_lowercase().replace(&quot;,&quot;, &quot;-&quot;).replace(&quot; &quot;, &quot;&quot;)
   |                                                                ^^^ help: try using a `char` instead: `&#x27; &#x27;`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#single_char_pattern

warning: single-character string constant used as pattern
  --&gt; ruff_dev/src/generate_rules_table.rs:42:46
   |
42 |             codes_csv.to_lowercase().replace(&quot;,&quot;, &quot;-&quot;).replace(&quot; &quot;, &quot;&quot;)
   |                                              ^^^ help: try using a `char` instead: `&#x27;,&#x27;`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#single_char_pattern

warning: this argument is passed by value, but not consumed in the function body
  --&gt; ruff_dev/src/generate_rules_table.rs:88:36
   |
88 | fn replace_readme_section(content: String, begin_pragma: &amp;str, end_pragma: &amp;str) -&gt; Result&lt;()&gt; {
   |                                    ^^^^^^ help: consider changing the type to: `&amp;str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
   = note: `-W clippy::needless-pass-by-value` implied by `-W clippy::pedantic`

warning: using `write!()` with a format string that ends in a single newline
   --&gt; ruff_dev/src/generate_rules_table.rs:110:5
    |
110 |     write!(f, &quot;{prefix}\n&quot;)?;
    |     ^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#write_with_newline
    = note: `#[warn(clippy::write_with_newline)]` on by default
help: use `writeln!` instead
    |
110 -     write!(f, &quot;{prefix}\n&quot;)?;
110 +     writeln!(f, &quot;{prefix}&quot;)?;
    |
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2022-12-07 14:41</div>
            <div class="timeline-body"><p>@charliermarsh 1 more thing, I validated the final rendering at https://github.com/phillipuniverse/ruff/tree/generate-rules-links#table-of-contents and the HTML comments screw up the sub-list.</p>
<img alt="image" src="https://user-images.githubusercontent.com/684275/206208081-b7e487f3-ba4a-4447-a10d-5dbc012a78c2.png">

<p>We could change the start/end pragma to:</p>
<pre><code>const TOC_BEGIN_PRAGMA: &amp;str = &quot;1. [Supported Rules](#supported-rules)&quot;;
const TOC_END_PRAGMA: &amp;str = &quot;1. [Editor Integrations](#editor-integrations)&quot;;
</code></pre>
<p>And that will work great, but has the downside that there isn&#x27;t a clear reference that it&#x27;s auto-generated. WDYT?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-07 14:45</div>
            <div class="timeline-body"><p>Ohh interesting, because it doesn&#x27;t like the HTML comment?</p>
<p>What about this?</p>
<p><img src="https://user-images.githubusercontent.com/1309177/206209440-f6c492ec-4cbc-4704-9043-8adf1e675abb.png" alt="Screen Shot 2022-12-07 at 9 44 54 AM"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phillipuniverse">@phillipuniverse</a> on 2022-12-07 14:52</div>
            <div class="timeline-body"><p>@charliermarsh great success!</p>
<img alt="image" src="https://user-images.githubusercontent.com/684275/206211158-37f6b3ee-5c62-4104-969a-ff5d902a6a07.png">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-07 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-07 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-07 15:03</div>
            <div class="timeline-body"><p>Awesome, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-12-07 15:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:34 UTC
    </footer>
</body>
</html>
