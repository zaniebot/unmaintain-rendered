<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Add symbols for `for` loop variables - astral-sh/ruff #13075</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Add symbols for <code>for</code> loop variables</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13075">#13075</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-08-23 11:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>This PR adds symbols introduced by <code>for</code> loops to red-knot:</p>
<ul>
<li><code>x</code> in <code>for x in range(10): pass</code></li>
<li><code>x</code> and <code>y</code> in <code>for x, y in d.items(): pass</code></li>
<li><code>a</code>, <code>b</code>, <code>c</code> and <code>d</code> in <code>for [((a,), b), (c, d)] in foo: pass</code></li>
</ul>
<p>This is the first one of these PRs that I&#x27;ve done, so I hope I haven&#x27;t missed anything!</p>
Test Plan
<p>Several tests added, and the assertion in the benchmarks has been updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 11:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:863 on 2024-08-23 11:52</div>
            <div class="timeline-body"><p>Eh, I guess this is quite a naive approach to unpacked definitions, since things like this are also possible:</p>
<pre><code>&gt;&gt;&gt; for x, *y in [(1, 2, 3), (4, 5, 6)]:
...     print(f&quot;{x=}, {y=}&quot;)
... 
x=1, y=[2, 3]
x=4, y=[5, 6]
</code></pre>
<p>Happy to take this out for now if we don&#x27;t want it, since I know that there are already some TODOs in this file about unpacked assignments (and <a href="https://github.com/astral-sh/ruff/issues/12698">astral-sh/ruff#12698</a> is open)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-08-23 11:56</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/alex/redknot-for-symbols">CodSpeed Performance Report</a>
Merging #13075 will <strong>improve performances by 9.06%</strong>
<p>Comparing <code>alex/redknot-for-symbols</code> (3fc3db2) with <code>main</code> (99df859)</p>
Summary
<p><code>⚡ 1</code> improvements
<code>✅ 31</code> untouched benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>alex/redknot-for-symbols</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ⚡ | <code>linter/all-with-preview-rules[numpy/globals.py]</code> | 904.1 µs | 829 µs | +9.06% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-23 12:04</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/semantic_index/builder.rs</code>:596 on 2024-08-23 12:17</div>
            <div class="timeline-body"><p>Nit: I would move the assertion closer to where we want to ensure that the assignment is null</p>
<pre><code>                self.add_standalone_expression(iter);
                self.visit_expr(iter);
                debug_assert!(self.current_assignment.is_none());
                self.current_assignment = Some(for_stmt.into());
</code></pre>
<p>Unrelated to this PR: We could do something more fancy if this is an assertion that we want whenever we set an assertion by:</p>
<ul>
<li>Adding a <code>current_assignment(for_stmt.into()) -&gt; AssignmentGuard</code> method. It asserts that <code>current_assignment</code> is <code>None</code></li>
<li>The <code>AssignmentGuard</code> is a wrapper around a <a href="https://docs.rs/drop_bomb/latest/drop_bomb/"><code>DropBomb</code></a></li>
<li>Add a <code>clear_assignment(guard)</code> method (or guard.clear(&amp;mut self)`)  that unsets the assignment and defuses the bomb.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-08-23 12:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 12:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_index/builder.rs</code>:596 on 2024-08-23 12:20</div>
            <div class="timeline-body"><p>That sounds fun to explore!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-23 12:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/semantic_index/builder.rs</code>:596 on 2024-08-23 12:45</div>
            <div class="timeline-body"><p>This existed for a while in the new parser, you can refer to it:</p>
<p>https://github.com/astral-sh/ruff/blob/1475a4d2a8a487a48593a53be33b9f0fac1d1a55/crates/ruff_python_parser/src/parser/mod.rs#L232-L248</p>
<p>Instead of <code>flags</code>, it would be <code>current_assignment: CurrentAssignment</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-23 12:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/semantic_index/definition.rs</code>:42 on 2024-08-23 12:50</div>
            <div class="timeline-body"><p>I think we would need to define a custom struct which determines which variable this definition is for. Considering the below example:</p>
<pre><code>for k, v in items:
	...
</code></pre>
<p>We will need to create two definitions for <code>k</code> and <code>v</code> variable and this new struct would capture that. It should probably be similar to <code>AssignmentDefinitionNodeRef</code> (similarly <code>AssignmentDefinitionNodeKind</code>), so:</p>
<pre><code>pub(crate) struct ForStmtDefinitionNodeRef&lt;&#x27;a&gt; {
	pub(crate) node: &amp;&#x27;a ast::StmtFor,
	pub(crate) target: &amp;&#x27;a ast::ExprName,
}
</code></pre>
<p>Maybe we could get away by just storing the <code>iter</code> instead of the entire node because the variable type can be inferred just from that expression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-23 12:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 12:52</div>
            <div class="timeline-body"><p>I think this should create two definitions each for <code>x</code> and <code>y</code> variable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 13:18</div>
            <div class="timeline-body"><p>So I&#x27;m currently creating two definitions: one for <code>x</code> and one for <code>y</code>. Is that what you mean? It&#x27;s possible I&#x27;m not doing that in the &quot;right place&quot;, though -- I&#x27;m doing it in <code>add_maybe_multiple_for_definitions()</code> in <code>infer.rs</code>.</p>
<p>I might also be misunderstanding what you mean, as this is my first PR adding new symbols to red-knot</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 13:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-23 13:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 13:57</div>
            <div class="timeline-body"><p>Ah, I see. Sorry for not noticing that earlier.</p>
<blockquote>
<p>So I&#x27;m currently creating two definitions: one for <code>x</code> and one for <code>y</code>. Is that what you mean? It&#x27;s possible I&#x27;m not doing that in the &quot;right place&quot;, though -- I&#x27;m doing it in <code>add_maybe_multiple_for_definitions()</code> in <code>infer.rs</code>.</p>
</blockquote>
<p>I think what&#x27;s happening here is that the <em>types</em> are being defined for two definitions but there&#x27;s still only a single definition. The reason being that the definitions are added at the symbol level and are defined by a unique key (<code>NodeKey</code> - a cheaper alternative to the node to reduce the cost of hashing). These are defined in the semantic index builder as is done by <code>add_definition</code> call. So, as the definition contains the entire <code>for</code> statement, the key would still be the same for each symbol in the target expression. In the example, for both <code>x</code> and <code>y</code> the definition node key is still the same for statement.</p>
<p>Each symbol should have a unique definition which, in one way, helps the inference engine to determine the type of that symbol. I&#x27;ve a suggestion in my other comment (<a href="https://github.com/astral-sh/ruff/pull/13075">astral-sh/ruff#13075</a>/files#r1728920074) on what could that look like.</p>
<p>https://github.com/astral-sh/ruff/blob/342473fd3f1ce40958719910f17154770b641ebd/crates/red_knot_python_semantic/src/semantic_index/builder.rs#L191-L192</p>
<p>Does this help?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 15:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 15:42</div>
            <div class="timeline-body"><p>Thanks, that helps a lot! I see the error now. I&#x27;m sort-of surprised that this didn&#x27;t cause any test failures or panics. (Is there another test I should have added, that would have caught this? Or is it not worth it to worry about that?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-23 16:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 16:08</div>
            <div class="timeline-body"><blockquote>
<p>(Is there another test I should have added, that would have caught this? Or is it not worth it to worry about that?)</p>
</blockquote>
<p>That&#x27;s a good question. I don&#x27;t know if there&#x27;s any way to test that <em>specific</em> behavior so I wouldn&#x27;t worry about it right now. This would be something to keep in mind when designing the test infrastructure where we assert that each symbol has a unique definition key or something along that line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/semantic_index/builder.rs</code>:600 on 2024-08-23 16:11</div>
            <div class="timeline-body"><p>We could add a TODO reminder here about needing control flow still</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/semantic_index/builder.rs</code>:634 on 2024-08-23 16:13</div>
            <div class="timeline-body"><p>Here&#x27;s where we&#x27;ll need to be passing in some node that is specific to the symbol (i.e. the name node), in addition to the overall for-stmt node, more like we do for Assign above (another case where unpacking can happen), so as to distinguish what the Definition is actually for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:863 on 2024-08-23 16:16</div>
            <div class="timeline-body"><p>Yeah I think we should probably remove this and follow the model of <code>infer_assignment_statement</code>, leaving unpacking as a TODO for now; we can tackle unpacking as a single project across all the definition kinds where it can occur.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:880 on 2024-08-23 16:18</div>
            <div class="timeline-body"><p>This will need to become a lookup by a specific name node, rather than the overall for statement node, so that we can lookup the right definition for each symbol. For now we can just match on the target and lookup the definition by it if its a name node, and leave unpacking as a TODO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 16:18</div>
            <div class="timeline-body"><p>I think this is mostly a consequence of doing Definitions without the actual type inference; if you&#x27;d had tests for the actual type inference of unpacked names, this would have failed in tests. (I&#x27;m not suggesting you should have done anything differently in that regard; that&#x27;s how we&#x27;ve been splitting up these PRs in general, maybe it wasn&#x27;t the best choice.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> requested changes on 2024-08-23 16:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-08-23 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 16:23</div>
            <div class="timeline-body"><p>Oh, another test assertion that I think would have caught this would be to assert that the two definitions you get back for the two symbols are actually different definition IDs? But obviously it&#x27;s not likely you&#x27;d write that assertion without already being aware of the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-08-23 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 17:19</div>
            <div class="timeline-body"><p>Sorry for triple-posting here :) It just occurred to me that another easy thing we could do that would have caught this up-front (and you could add in this PR) would be to <code>debug_assert</code> on the return value of <code>self.definitions_by_node.insert(...)</code> inside <code>add_definition</code>; I think if we are ever overwriting a previously-inserted <code>Definition</code> there, it&#x27;s a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 18:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:908 on 2024-08-23 18:20</div>
            <div class="timeline-body"><p>I think this is probably not really the right place for this TODO? Since the inferring of the iterator type (and the unpacking of whatever is returned from the iterator&#x27;s <code>__next__</code> method) really needs to be done at a higher level? but I&#x27;m also not really sure where else to put this TODO?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 18:24</div>
            <div class="timeline-body"><p>Hmm, I tried adding this debug assertion:</p>
<pre><code>diff --git a/crates/red_knot_python_semantic/src/semantic_index/builder.rs b/crates/red_knot_python_semantic/src/semantic_index/builder.rs
index 9805d2501..4185765ba 100644
--- a/crates/red_knot_python_semantic/src/semantic_index/builder.rs
+++ b/crates/red_knot_python_semantic/src/semantic_index/builder.rs
@@ -190,8 +190,13 @@ impl&lt;&#x27;db&gt; SemanticIndexBuilder&lt;&#x27;db&gt; {
             countme::Count::default(),
         );
 
-        self.definitions_by_node
+        let definition_already_existed = self
+            .definitions_by_node
             .insert(definition_node.key(), definition);
+        debug_assert_eq!(
+            definition_already_existed, None,
+            &quot;Should never overwrite an existing definition!&quot;
+        );
         self.current_use_def_map_mut()
             .record_definition(symbol, definition);
</code></pre>
<p>But it causes a panic in the corpus test (and not due to this PR, I don&#x27;t think?)</p>
<pre><code>checking &quot;/Users/alexw/dev/ruff/crates/red_knot_workspace/resources/test/corpus/58_async_for_dict_comp.py&quot;
thread &#x27;corpus_no_panic&#x27; panicked at crates/red_knot_python_semantic/src/semantic_index/builder.rs:196:9:
assertion `left == right` failed: Should never overwrite an existing definition!
  left: Some(Definition { [salsa id]: Id(45d1), file: File { [salsa id]: Id(cc3), path: System(&quot;/Users/alexw/dev/ruff/crates/red_knot_workspace/resources/test/corpus/58_async_for_dict_comp.py&quot;), permissions: Some(33188), revision: FileRevision(31781594018582998360096355038), status: Exists, count: Count { ghost: PhantomData&lt;fn(ruff_db::files::File)&gt; } }, file_scope: FileScopeId(2), symbol: ScopedSymbolId(0), node: Comprehension(ComprehensionDefinitionKind { node: AstNodeRef(Comprehension { range: 31..54, target: Tuple(ExprTuple { range: 41..45, elts: [Name(ExprName { range: 41..42, id: Name(&quot;k&quot;), ctx: Store }), Name(ExprName { range: 44..45, id: Name(&quot;v&quot;), ctx: Store })], ctx: Store, parenthesized: false }), iter: Call(ExprCall { range: 49..54, func: Name(ExprName { range: 49..52, id: Name(&quot;gen&quot;), ctx: Load }), arguments: Arguments { range: 52..54, args: [], keywords: [] } }), ifs: [], is_async: true }), first: true }), count: Count { ghost: PhantomData&lt;fn(red_knot_python_semantic::semantic_index::definition::Definition)&gt; } })
 right: None
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    corpus_no_panic
</code></pre>
<p>So I think I&#x27;ll leave this for now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 18:26</div>
            <div class="timeline-body"><p>Thanks @dhruvmanila and @carljm! Pushed some changes. Lmk if it&#x27;s still not quite right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-08-23 22:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/semantic_index.rs</code>:1117 on 2024-08-23 22:01</div>
            <div class="timeline-body"><p>Yeah, makes sense; if we&#x27;re already not keeping this invariant, it&#x27;s out of scope for this PR. I created an issue to follow up: <a href="https://github.com/astral-sh/ruff/issues/13085">astral-sh/ruff#13085</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:908 on 2024-08-23 22:23</div>
            <div class="timeline-body"><p>In the current architecture, this is the right place for the TODO; we will have to repeat this logic for each definition, in the case of unpacking. We don&#x27;t currently have another layer available at which to cache it. Caching also has an overhead and sometimes it&#x27;s better to just repeat some work. But we can also re-evaluate this when we implement unpacking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-08-23 22:24</div>
            <div class="timeline-body"><p>Looks great, thank you!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-23 22:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:908 on 2024-08-23 22:39</div>
            <div class="timeline-body"><p>I&#x27;m not 100% sure we&#x27;re on the same page here (but this may also just be me still getting used to this architecture) — anyway, I don&#x27;t think it&#x27;s massively important where this TODO lives, so I&#x27;ll leave this for now!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-23 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-23 22:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:06:18 UTC
    </footer>
</body>
</html>
