<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-simplify`] Implement `enumerate-for-loop` (`SIM113`) - astral-sh/ruff #7777</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-simplify</code>] Implement <code>enumerate-for-loop</code> (<code>SIM113</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7777">#7777</a>
        opened by <a href="https://github.com/chammika-become">@chammika-become</a>
        on 2023-10-03 12:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chammika-become">@chammika-become</a></div>
            <div class="timeline-body"><p>Implements SIM113 from #998</p>
<p>Added tests
Limitations</p>
<ul>
<li>No fix yet</li>
<li>Only flag cases where index variable immediately precede <code>for</code> loop</li>
</ul>
<p>@charliermarsh please review and let me know any improvements</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_simplify/SIM113.py</code>:1 on 2023-10-09 08:26</div>
            <div class="timeline-body"><p>good test cases!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:24 on 2023-10-09 08:30</div>
            <div class="timeline-body"><pre><code>///    idx += 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:31 on 2023-10-09 08:30</div>
            <div class="timeline-body"><pre><code>///     sum += func(item, idx)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:69 on 2023-10-09 08:38</div>
            <div class="timeline-body"><pre><code>        let diagnostic = Diagnostic::new(
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:80 on 2023-10-09 08:40</div>
            <div class="timeline-body"><p>I think you need to use <code>StatementVisitor</code> here instead. Using the visitor means that all the different cases are handled in one central place (so you don&#x27;t need to test them here) and it also makes updating to new python versions which introduce new statements (or changes to our AST independent of python) much easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:142 on 2023-10-09 08:52</div>
            <div class="timeline-body"><p>You should be able to directly match on <code>Constant::Int(Int::ZERO)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:157 on 2023-10-09 08:54</div>
            <div class="timeline-body"><p>Does</p>
<pre><code>        target, op: Operator::Add, value, ..
</code></pre>
<p>work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:127 on 2023-10-09 09:12</div>
            <div class="timeline-body"><p>This way does work, but i think it&#x27;s better to look the binding of the name up in the semantic model and then check if it&#x27;s in the same suite as the for and set to zero.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-10-09 09:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ncoish">@ncoish</a> reviewed on 2023-11-20 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ncoish">@ncoish</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/enumerate_for.rs</code>:45 on 2023-11-20 15:54</div>
            <div class="timeline-body"><p>Small typo in the output recommendation, but an important one since it&#x27;s the name of the replacement function.</p>
<p>The snapshots need this change too.</p>
<pre><code>        format!(&quot;Use enumerate() for index variable `{index_var}` in for loop&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2024-01-13 04:22</div>
            <div class="timeline-body"><p>any progress on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 02:50</div>
            <div class="timeline-body"><p>@danieleades - Na, but I can take it over.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-01-14 03:28</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/chammika-become:simplify-SIM113">CodSpeed Performance Report</a>
Merging #7777 will <strong>degrade performances by 4.35%</strong>
<p>Comparing <code>chammika-become:simplify-SIM113</code> (5c25d68) with <code>main</code> (b6ce4f5)</p>
Summary
<p><code>‚ùå 1</code> regressions
<code>‚úÖ 29</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/chammika-become:simplify-SIM113">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>chammika-become:simplify-SIM113</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ùå | <code>parser[numpy/ctypeslib.py]</code> | 12.2 ms | 12.8 ms | -4.35% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-01-14 03:39</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+14 -0 violations, +0 -0 fixes in 2 projects; 41 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/1455a3babb1bf4b890562a65610b33c0db206f69/airflow/cli/commands/webserver_command.py#L171">airflow/cli/commands/webserver_command.py:171:13:</a> SIM113 Use `enumerate()` for index variable `excess` in `for` loop
+ <a href="https://github.com/apache/airflow/blob/1455a3babb1bf4b890562a65610b33c0db206f69/airflow/providers/google/cloud/transfers/cassandra_to_gcs.py#L180">airflow/providers/google/cloud/transfers/cassandra_to_gcs.py:180:13:</a> SIM113 Use `enumerate()` for index variable `counter` in `for` loop
+ <a href="https://github.com/apache/airflow/blob/1455a3babb1bf4b890562a65610b33c0db206f69/airflow/providers/google/cloud/transfers/sql_to_gcs.py#L202">airflow/providers/google/cloud/transfers/sql_to_gcs.py:202:13:</a> SIM113 Use `enumerate()` for index variable `counter` in `for` loop
+ <a href="https://github.com/apache/airflow/blob/1455a3babb1bf4b890562a65610b33c0db206f69/scripts/ci/pre_commit/pre_commit_update_providers_dependencies.py#L317">scripts/ci/pre_commit/pre_commit_update_providers_dependencies.py:317:9:</a> SIM113 Use `enumerate()` for index variable `line_count` in `for` loop
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+10 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/data_import/import_util.py#L643">zerver/data_import/import_util.py:643:13:</a> SIM113 Use `enumerate()` for index variable `count` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/data_import/slack.py#L634">zerver/data_import/slack.py:634:9:</a> SIM113 Use `enumerate()` for index variable `recipient_id_count` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/data_import/slack.py#L635">zerver/data_import/slack.py:635:9:</a> SIM113 Use `enumerate()` for index variable `subscription_id_count` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/data_import/slack.py#L745">zerver/data_import/slack.py:745:13:</a> SIM113 Use `enumerate()` for index variable `_counter` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/lib/export.py#L1744">zerver/lib/export.py:1744:9:</a> SIM113 Use `enumerate()` for index variable `count` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/lib/export.py#L1865">zerver/lib/export.py:1865:9:</a> SIM113 Use `enumerate()` for index variable `count` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/lib/import_realm.py#L791">zerver/lib/import_realm.py:791:9:</a> SIM113 Use `enumerate()` for index variable `count` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/migrations/0177_user_message_add_and_index_is_private_flag.py#L42">zerver/migrations/0177_user_message_add_and_index_is_private_flag.py:42:9:</a> SIM113 Use `enumerate()` for index variable `i` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zerver/tests/test_message_edit.py#L1012">zerver/tests/test_message_edit.py:1012:13:</a> SIM113 Use `enumerate()` for index variable `i` in `for` loop
+ <a href="https://github.com/zulip/zulip/blob/a4fad5dda116048e22c3d559d370367e4e1c9b9a/zilencer/management/commands/populate_db.py#L705">zilencer/management/commands/populate_db.py:705:17:</a> SIM113 Use `enumerate()` for index variable `i` in `for` loop
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| SIM113 | 14 | 14 | 0 | 0 | 0 |</p>
</p>


Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 03:42</div>
            <div class="timeline-body"><p>(Taking over.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;flake8_simplify : SIM113&quot; to &quot;[`flake8-simplify`] Implement `enumerate-for-loop` (`SIM113`)&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 04:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 04:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 04:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2024-01-14 04:20</div>
            <div class="timeline-body"><blockquote>
<p>@danieleades - Na, but I can take it over.</p>
</blockquote>
<p>I only ask because I think this lint is the last hold-out for deprecating flake8 linting from the sphinx project!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 04:21</div>
            <div class="timeline-body"><p>üò≤ üò≤ üò≤</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 04:23</div>
            <div class="timeline-body"><p>Should be good to go, also addressed some false positives that exist in the upstream implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 13:55</div>
            <div class="timeline-body"><p>Looking at the ecosystem checks, there are a few more false positives we can fix here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 13:57</div>
            <div class="timeline-body"><p>Namely:</p>
<ul>
<li>Ensure that the initialization and the <code>for</code> loop have the same parent (not just the same branch).</li>
<li>If the variable is used <em>after</em> the loop, consider allowing it? As in:</li>
</ul>
<pre><code>count = 0
for entry in result:
    assert &#x27;thing&#x27; in entry[0]
    count += 1
assert count == 9, &#x27;only 9 query ranges should remain in the DB&#x27;
</code></pre>
<p>There&#x27;s a lot of this in tests, which seems ok? I could go either way. You can also write as:</p>
<pre><code>for count, entry in enumerate(result):
    assert &#x27;thing&#x27; in entry[0]
assert count == 9, &#x27;only 9 query ranges should remain in the DB&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-14 16:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:57:59 UTC
    </footer>
</body>
</html>
