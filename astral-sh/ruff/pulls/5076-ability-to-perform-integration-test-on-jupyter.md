```yaml
number: 5076
title: Ability to perform integration test on Jupyter notebooks
type: pull_request
state: merged
author: dhruvmanila
labels: []
assignees: []
merged: true
base: main
head: dhruv/jupyter-integration-test
created_at: 2023-06-14T05:11:00Z
updated_at: 2023-06-15T02:40:12Z
url: https://github.com/astral-sh/ruff/pull/5076
synced_at: 2026-01-12T03:43:30Z
```

# Ability to perform integration test on Jupyter notebooks

---

_Pull request opened by @dhruvmanila on 2023-06-14 05:11_

## Summary

Ability to perform integration test on Jupyter notebooks

Part of #1218

## Test Plan

`cargo test`


---

_Comment by @dhruvmanila on 2023-06-14 05:11_

Current dependencies on/for this PR:
* main
  * **PR #5076** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5076" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5076?utm_source=stack-comment).

---

_@dhruvmanila reviewed on 2023-06-14 05:16_

---

_Review comment by @dhruvmanila on `crates/ruff/src/jupyter/snapshots/ruff__jupyter__notebook__test__import_sorting.snap`:14 on 2023-06-14 05:16_

Oh right. I'll need to update the printer to include cell number and use Jupyter index.

---

_@dhruvmanila reviewed on 2023-06-14 05:17_

---

_Review comment by @dhruvmanila on `crates/ruff/src/test.rs`:71 on 2023-06-14 05:17_

Should we use snapshots as we'll be asserting the content here itself?

---

_Comment by @github-actions[bot] on 2023-06-14 05:26_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      7.2Â±0.43ms     5.6 MB/sec    1.02      7.4Â±0.37ms     5.5 MB/sec
formatter/numpy/ctypeslib.py               1.00  1550.4Â±94.02Âµs    10.7 MB/sec    1.02  1578.8Â±68.36Âµs    10.5 MB/sec
formatter/numpy/globals.py                 1.00   152.1Â±10.60Âµs    19.4 MB/sec    1.02    155.5Â±9.85Âµs    19.0 MB/sec
formatter/pydantic/types.py                1.04      3.2Â±0.17ms     8.1 MB/sec    1.00      3.0Â±0.19ms     8.4 MB/sec
linter/all-rules/large/dataset.py          1.00     16.3Â±1.00ms     2.5 MB/sec    1.00     16.2Â±0.72ms     2.5 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.7Â±0.20ms     4.4 MB/sec    1.03      3.8Â±0.17ms     4.3 MB/sec
linter/all-rules/numpy/globals.py          1.00   476.0Â±26.55Âµs     6.2 MB/sec    1.04   495.1Â±29.01Âµs     6.0 MB/sec
linter/all-rules/pydantic/types.py         1.02      6.8Â±0.36ms     3.8 MB/sec    1.00      6.7Â±0.26ms     3.8 MB/sec
linter/default-rules/large/dataset.py      1.02      7.9Â±0.40ms     5.1 MB/sec    1.00      7.8Â±0.37ms     5.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1683.5Â±86.41Âµs     9.9 MB/sec    1.00  1689.4Â±87.34Âµs     9.9 MB/sec
linter/default-rules/numpy/globals.py      1.02    199.3Â±8.77Âµs    14.8 MB/sec    1.00    196.1Â±9.63Âµs    15.1 MB/sec
linter/default-rules/pydantic/types.py     1.08      3.9Â±0.25ms     6.5 MB/sec    1.00      3.6Â±0.17ms     7.1 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.6Â±0.36ms     4.2 MB/sec    1.03      9.9Â±0.43ms     4.1 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.0Â±0.14ms     8.3 MB/sec    1.01      2.0Â±0.11ms     8.2 MB/sec
formatter/numpy/globals.py                 1.00   191.0Â±13.93Âµs    15.4 MB/sec    1.02   194.2Â±13.04Âµs    15.2 MB/sec
formatter/pydantic/types.py                1.00      4.0Â±0.19ms     6.5 MB/sec    1.04      4.1Â±0.31ms     6.2 MB/sec
linter/all-rules/large/dataset.py          1.00     21.1Â±0.84ms  1975.3 KB/sec    1.00     21.1Â±0.73ms  1972.0 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.3Â±0.21ms     3.2 MB/sec    1.00      5.2Â±0.23ms     3.2 MB/sec
linter/all-rules/numpy/globals.py          1.00   627.3Â±36.10Âµs     4.7 MB/sec    1.00   629.4Â±39.82Âµs     4.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      9.0Â±0.41ms     2.8 MB/sec    1.02      9.2Â±0.68ms     2.8 MB/sec
linter/default-rules/large/dataset.py      1.00     10.4Â±0.35ms     3.9 MB/sec    1.02     10.6Â±0.40ms     3.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01      2.2Â±0.11ms     7.5 MB/sec    1.00      2.2Â±0.12ms     7.5 MB/sec
linter/default-rules/numpy/globals.py      1.01   253.7Â±14.61Âµs    11.6 MB/sec    1.00   251.5Â±15.96Âµs    11.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.7Â±0.21ms     5.4 MB/sec    1.03      4.9Â±0.33ms     5.2 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review comment by @konstin on `crates/ruff/src/test.rs`:71 on 2023-06-14 06:33_

You could move the ` assert_messages!(diagnostics);` here but it's fine either way

---

_@konstin approved on 2023-06-14 06:33_

Looks good!

---

_Marked ready for review by @dhruvmanila on 2023-06-14 17:44_

---

_@dhruvmanila reviewed on 2023-06-14 17:46_

---

_Review comment by @dhruvmanila on `crates/ruff/src/test.rs`:277 on 2023-06-14 17:46_

This seems a bit hacky to print cell information in the snapshot but just thought to put it out there to gain some feedback. The diff lines are also incorrect which should be fixed once the support is added.

We could just avoid creating snapshots and test out using `assert_eq!` which is already being done for `cell_offsets`, `index` and `content`.

For reference, this is the commit which is isolated to this change (https://github.com/astral-sh/ruff/pull/5076/commits/f63103b20cd2fd6a0ad9ebbc2fa75fc0eb79f6f2)

\cc @charliermarsh @konstin 

---

_@konstin reviewed on 2023-06-14 19:07_

---

_Review comment by @konstin on `crates/ruff/src/test.rs`:277 on 2023-06-14 19:07_

i like it!

---

_@charliermarsh reviewed on 2023-06-14 19:35_

---

_Review comment by @charliermarsh on `crates/ruff/src/test.rs`:277 on 2023-06-14 19:35_

I trust @konstin on this one, not gonna review closely ;)

---

_Merged by @dhruvmanila on 2023-06-15 02:34_

---

_Closed by @dhruvmanila on 2023-06-15 02:34_

---

_Branch deleted on 2023-06-15 02:34_

---

_Comment by @dhruvmanila on 2023-06-15 02:40_

I'll add some more tests now that we've the ability to do so!

---
