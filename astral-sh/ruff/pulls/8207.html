<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter parentheses support for `IpyEscapeCommand` - astral-sh/ruff #8207</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter parentheses support for <code>IpyEscapeCommand</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8207">#8207</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-10-25 09:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR removes the <code>todo!()</code> around <code>IpyEscapeCommand</code> in the formatter.</p>
<p>The <code>NeedsParentheses</code> trait needs to be implemented which always return <code>Never</code>. The reason being that if an escape command is parenthesized, then that's not parsed as an escape command. IOW, the parentheses shouldn't be present around an escape command.</p>
<p>In the similar way, the <code>CanSkipOptionalParenthesesVisitor</code> will skip this node.</p>
<h2>Test Plan</h2>
<p>Updated the <code>unformatted.ipynb</code> fixture with new cells containing IPython escape commands and the corresponding snapshot was verified. Also, tested it out in a few open source repositories containing notebooks (<code>openai/openai-cookbook</code>, <code>huggingface/notebooks</code>).</p>
<h4>New cells in <code>unformatted.ipynb</code></h4>
<p><strong>Cell 2</strong></p>
<pre><code class="language-markdown">A markdown cell
</code></pre>
<p><strong>Cell 3</strong></p>
<pre><code class="language-python">def some_function(foo, bar):
    pass
%matplotlib inline
</code></pre>
<p><strong>Cell 4</strong></p>
<pre><code class="language-python">foo = %pwd
def some_function(foo,bar,):
	foo = %pwd
    print(foo
	)
</code></pre>
<p>fixes: #8204</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-25 09:47</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #8205</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8205" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #8207</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8207" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8207?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dhruvmanila on 2023-10-25 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2023-10-25 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @dhruvmanila on 2023-10-25 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2023-10-25 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @MichaReiser removed by @dhruvmanila on 2023-10-25 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @dhruvmanila on 2023-10-25 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2023-10-25 10:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-10-25 10:34</div>
            <div class="timeline-body"><p>Looks good to me. Can we add an E2E test (CLI test) in the parent PR that tests <code>ruff format</code> with a notebook that contains ipython commands?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-25 13:35</div>
            <div class="timeline-body"><blockquote>
<p>Can we add an E2E test (CLI test) in the parent PR that tests <code>ruff format</code> with a notebook that contains ipython commands?</p>
</blockquote>
<p>Do you mean in this PR? I've added it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-10-25 13:43</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-10-25 13:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-10-25 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @dhruvmanila on 2023-10-25 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2023-10-25 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-10-25 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-10-25 14:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:01:03 UTC
    </footer>
</body>
</html>
