<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add naive implementation of completions for unimported symbols - astral-sh/ruff #20207</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add naive implementation of completions for unimported symbols</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20207">#20207</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-09-02 15:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-02 15:00</div>
            <div class="timeline-body"><p>This PR takes a first step toward implementing auto-import (see #535).</p>
<p>There are two main reasons why this is considered naive:</p>
<ol>
<li>Once a helping of dependencies have been added to an environment,
completions can become quite slow. Into the hundreds of milliseconds.
I've intentionally not spent any time on performance here. We're
just using a per-file Salsa caching mechanism and searching is done
exhaustively.</li>
<li>When a completion for an unimported symbol is selected, the necessary
import is not yet added. (This is what I plan to focus on next.)</li>
</ol>
<p>For those two reasons, these completions will only appear when users opt
into them via the <code>ty.experimental.autoImport</code> setting.</p>
<p>This PR is best reviewed commit by commit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @BurntSushi on 2025-09-02 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @BurntSushi on 2025-09-02 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @BurntSushi on 2025-09-02 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @BurntSushi on 2025-09-02 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @BurntSushi on 2025-09-02 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @BurntSushi on 2025-09-02 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @BurntSushi on 2025-09-02 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @MichaReiser removed by @BurntSushi on 2025-09-02 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @BurntSushi on 2025-09-02 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @BurntSushi on 2025-09-02 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-02 15:03</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-02 15:03</div>
            <div class="timeline-body"><p>Demo:</p>
<p>https://github.com/user-attachments/assets/f960feb7-3cf0-4089-b7f8-7bceb3fda3e9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-02 15:05</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-02 15:28</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-02 15:33</div>
            <div class="timeline-body"><blockquote>
<p>2. When a completion for an unimported symbol is selected, the necessary
import is not yet added. (This is what I plan to focus on next.)</p>
</blockquote>
<p>We already have quite good infrastructure for this for some Ruff autofixes. It might be worth seeing if that can be factored out and put somewhere where it could be reused by ty. (It also might be completely impossible to reuse it, but it could be worth a look.) It's found here: https://github.com/astral-sh/ruff/tree/main/crates/ruff_linter/src/importer</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-02 15:36</div>
            <div class="timeline-body"><p>@AlexWaygood Nice yeah! I was planning to look for that. Thanks for finding it. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-09-02 22:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-09-02 22:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_ide/src/all_symbols.rs</code>:67 on 2025-09-03 08:25</div>
            <div class="timeline-body"><p>I think it's fine but I was wondering if we want to restrict the test cases to avoid the builtins because any changes to typeshed would require updating the snapshots here if it's related. And, I think this also allows us to get coverage over the builtins symbols which seems useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session/options.rs</code>:157 on 2025-09-03 09:15</div>
            <div class="timeline-body"><p>Oh shoot, the <code>unwrap_or</code> here was meant to be <code>false</code>. Can you make this change? Luckily, no one should be affected because there was only one setting in the experimental group.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/module_resolver/module.rs</code>:1 on 2025-09-03 09:19</div>
            <div class="timeline-body"><p>It might be useful to have @AlexWaygood to take a look at the changes here once he is back.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_ide/src/symbols.rs</code>:304 on 2025-09-03 09:21</div>
            <div class="timeline-body"><p>Yeah, I think it's fine to not do this now. Pylance does provide the icon and the documentation as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-09-03 09:25</div>
            <div class="timeline-body"><p>This looks great!</p>
<p>If it's not already planned, it would be great if you could update the ty documentation for editor settings to include the new setting over at https://github.com/astral-sh/ty/blob/59bf06d2675cc6add7b4ba6f603f70edebcf9499/docs/reference/editor-settings.md#L4 and update the VS Code extension to include the setting (<a href="https://github.com/astral-sh/ty-vscode/commit/e325761ea4f547b03fec7d9d26c9c7dae8851321">reference change</a>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-09-03 13:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_server/src/session/options.rs</code>:157 on 2025-09-03 13:31</div>
            <div class="timeline-body"><p>Yup, done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-09-03 13:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/module_resolver/module.rs</code>:1 on 2025-09-03 13:32</div>
            <div class="timeline-body"><p>Aye. I'd love that. I'll probably merge before then, but I'd be happy to address feedback post-merge.</p>
<p>(I think one known deficiency is that namespace packages aren't really supported. Which matches the status quo. I think they're going to need a dedicated strategy to deal with.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-09-03 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/all_symbols.rs</code>:67 on 2025-09-03 13:42</div>
            <div class="timeline-body"><p>Seems sensible. Done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2025-09-03 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-09-03 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-03 13:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:46:48 UTC
    </footer>
</body>
</html>
