<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement `yield`-to-`yield from` conversion - astral-sh/ruff #1544</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement <code>yield</code>-to-<code>yield from</code> conversion</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1544">#1544</a>
        opened by <a href="https://github.com/colin99d">@colin99d</a>
        on 2023-01-02 03:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a></div>
            <div class="timeline-body"><p>A part of #827.</p>
<p>I am creating this draft pr for visibility. This is easily the most challenging fixer I have done, due to the infinite amount of nesting of functions inside functions allowed in python. Because of this I have created a recursive function to get all potential yield from statements. There is still a lot of work to be done, but I just wanted to push this in case anyone sees a much simpler way to do it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-02 17:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2023-01-02 17:50</div>
            <div class="timeline-body"><p>This is done and ready for review. It passes all the tests provided by pyupgrade except for one case I document in the code. Current issues are as follows:</p>
<ol>
<li>Our implementation keeps more comments than pyupgrade does (this is the issue mentioned above). However, I think this is more of a plus than a minus. I REALLY doubt people want their comments removed by our linter.</li>
<li>The implementation would fail if before or after the loop x is defined as a separate thing and used. Our implementation would err in the side of NOT making changes.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-03 04:24</div>
            <div class="timeline-body"><p>Will try to get to this tomorrow, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Pyupgrade: Yieldfrom&quot; to &quot;Implement `yield`-to-`yield from` conversion&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-04 03:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-04 03:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-04 03:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-04 04:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/plugins/rewrite_yield_from.rs</code>:121 on 2023-01-04 04:03</div>
            <div class="timeline-body"><p>@colin99d - I ended up refactoring this quite a bit. You might be interested in checking out the current implementation. The logic is roughly: do one pass over the function to find any candidate <code>yield</code> statements to convert, do a second pass to find any references to variables, then cross-reference to ensure we don&#x27;t rewrite any yields whose variables are referenced elsewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-01-05 15:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:42 UTC
    </footer>
</body>
</html>
