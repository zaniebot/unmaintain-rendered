<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ruff] implement useless if-else (RUF034) - astral-sh/ruff #13218</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ruff] implement useless if-else (RUF034)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13218">#13218</a>
        opened by <a href="https://github.com/vieira127">@vieira127</a>
        on 2024-09-02 21:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/vieira127">@vieira127</a> on 2024-09-02 21:16</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Adds a new rule, RUF102, to check for redundant ternary operators. Message shows when both the true and false branches return the same value, as discussed in #12516</p>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<!-- How was it tested? -->

<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-09-02 21:54</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+2 -0 violations, +0 -0 fixes in 2 projects; 52 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/superset/blob/72a520fba4c021e0e6eca5caffe562f8683884e4/superset/utils/decorators.py#L158'>superset/utils/decorators.py:158:9:</a> RUF034 Useless if-else condition
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pandas-dev/pandas/blob/2244402942dbd30bdf367ceae49937c179e42bcb/pandas/tests/io/formats/style/test_style.py#L923'>pandas/tests/io/formats/style/test_style.py:923:26:</a> RUF034 Useless if-else condition
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF034 | 2 | 2 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RubenVanEldik">@RubenVanEldik</a> on 2024-09-02 21:55</div>
            <div class="timeline-body"><p>Hi Lucas,</p>
<p>I am new to Ruff an am just reading PRs to get a better understanding of how everything works. I was wondering, how did you decide to name it <code>RUF102</code>. Is there any logic behind the <code>RUF0XX</code>, <code>RUF1XX</code> sets?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/codes.rs</code>:966 on 2024-09-03 08:04</div>
            <div class="timeline-body"><p>The <code>1XX</code> ruff rules are reserved for noqa specific rules. Let's change the code to 034.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/expression.rs</code>:1407 on 2024-09-03 08:08</div>
            <div class="timeline-body"><p>I quickly checked other &quot;ternary&quot; specific rules and all of them use the term <code>if-expr</code> instead. We also use the term <code>Useless</code> when referring to <em>useless</em> code.</p>
<p>How about: <code>useless-if-expr</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-09-03 08:15</div>
            <div class="timeline-body"><p>This overall looks great to me but we should change the rule code and its name.</p>
<p>I have some concerns with the scope of the rule. I know it has previously been accepted but I only just now looked closer into it.</p>
<ul>
<li>There's some overlap with <code>SIM108</code> that simplifies if expressions</li>
<li>The scope of the rule is very narrow. Should it also apply to if-statements?</li>
</ul>
<p>@AlexWaygood what are your thoughts on the rule?</p>
<p>It would be great if the rule also provided a fix that removes the if expression with the true or false body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-09-03 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @MichaReiser on 2024-09-03 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-03 08:16</div>
            <div class="timeline-body"><p>The ecosystem check shows an interesting false positive:</p>
<p>https://github.com/apache/superset/blob/548d543efe81ecd6f0a6657550230b765ab4d955/superset/utils/decorators.py#L158</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vieira127">@vieira127</a> reviewed on 2024-09-03 10:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/vieira127">@vieira127</a> on <code>crates/ruff_linter/src/codes.rs</code>:966 on 2024-09-03 10:28</div>
            <div class="timeline-body"><p>@RubenVanEldik I think this answers it üòÑ. This is also my first time contributing here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-09-03 10:36</div>
            <div class="timeline-body"><blockquote>
<p>The ecosystem check shows an interesting false positive:</p>
<p><a href="https://github.com/apache/superset/blob/548d543efe81ecd6f0a6657550230b765ab4d955/superset/utils/decorators.py#L158">apache/superset@<code>548d543</code>/superset/utils/decorators.py#L158</a></p>
</blockquote>
<p>@MichaReiser <em>is</em> that a false positive? The snippet in question is:</p>
<pre><code class="language-py">sorted_args = tuple(
    x if hasattr(x, &quot;__repr__&quot;) else x for x in [*args, *sorted(kwargs.items())]
)
</code></pre>
<p>It seems like each element in the iterable there will be collected whether or not it has a <code>__repr__</code> method, so I think it can just be simplified to</p>
<pre><code class="language-py">sorted_args = tuple(x for x in [*args, *sorted(kwargs.items())])
</code></pre>
<p>or even just</p>
<pre><code class="language-py">sorted_args = (*args, *sorted(kwargs.items()))
</code></pre>
<p>What they probably <em>wanted</em> to do was</p>
<pre><code class="language-py">sorted_args = tuple(
    repr(x) if hasattr(x, &quot;__repr__&quot;) else x for x in [*args, *sorted(kwargs.items())]
)
</code></pre>
<p>But even that doesn't make much sense, because all objects in Python have a <code>__repr__</code> attribute:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; hasattr(object, &quot;__repr__&quot;)
True
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-09-03 10:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/expression.rs</code>:1407 on 2024-09-03 10:38</div>
            <div class="timeline-body"><p><code>useless-if-expr</code> sounds good to me. I agree that that's more approachable language than <code>ternary</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-09-03 10:42</div>
            <div class="timeline-body"><blockquote>
<p>There's some overlap with <code>SIM108</code> that simplifies if expressions</p>
</blockquote>
<p>I support this being a separate rule to <code>SIM108</code>. <code>SIM108</code> is quite opinionated IMO: I think it's questionable whether rewriting an <code>if/else</code> block as a ternary expression is always easier to read in Python, or always more idiomatic. This rule, on the other hand, seems like it's pointing out something that you'd almost always want to avoid. A useless ternary expression is almost certainly a straight-up mistake that you didn't mean to write üòÑ</p>
<blockquote>
<p>The scope of the rule is very narrow. Should it also apply to if-statements?</p>
</blockquote>
<p>Also applying it to if/else statements sounds reasonable to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vieira127">@vieira127</a> on 2024-09-03 11:28</div>
            <div class="timeline-body"><blockquote>
<p>It would be great if the rule also provided a fix that removes the if expression with the true or false body.</p>
</blockquote>
<p>I don't think a fix would fit this rule because users probably end up in this situation when they mistype one of the ternary ends. Instead of just removing the ternary, they probably need to correct one of the sides.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vieira127">@vieira127</a> reviewed on 2024-09-03 16:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/vieira127">@vieira127</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/expression.rs</code>:1407 on 2024-09-03 16:18</div>
            <div class="timeline-body"><p>Sounds good, but if we also cover if blocks maybe we will need a different name. For example: <code>useless-if-logic</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-09-03 16:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/expression.rs</code>:1407 on 2024-09-03 16:20</div>
            <div class="timeline-body"><p>hmm, good point. Maybe <code>useless-if-else</code>? Or <code>useless-if-condition</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ruff] implement redundant ternary rule (RUF102)" to "[ruff] implement redundant ternary rule (RUF034)" by @AlexWaygood on 2024-09-03 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vieira127">@vieira127</a> on 2024-09-03 16:23</div>
            <div class="timeline-body"><blockquote>
<ul>
<li>The scope of the rule is very narrow. Should it also apply to if-statements?</li>
</ul>
</blockquote>
<p>I wonder if rule SIM114 address that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vieira127">@vieira127</a> reviewed on 2024-09-03 16:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/vieira127">@vieira127</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/expression.rs</code>:1407 on 2024-09-03 16:33</div>
            <div class="timeline-body"><p>I like<code>useless-if-else</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-09-03 16:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/expression.rs</code>:1407 on 2024-09-03 16:33</div>
            <div class="timeline-body"><p>I like <code>useless-if-else</code>. It provides room for expanding the rule in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-03 16:35</div>
            <div class="timeline-body"><p><code>SIM114</code> only seems to flag <code>if-elif</code> but not <code>if-else</code>. https://play.ruff.rs/ae79ec83-f045-4262-bcfb-dc8a08a19460</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-09-03 19:04</div>
            <div class="timeline-body"><p>LGTM. I think we could merge this now and expand it to <code>if</code>/<code>else</code> statements as a followup. @MichaReiser what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ruff] implement redundant ternary rule (RUF034)" to "[ruff] implement useless if-else (RUF034)" by @MichaReiser on 2024-09-04 06:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-09-04 06:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-09-04 06:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:39:02 UTC
    </footer>
</body>
</html>
