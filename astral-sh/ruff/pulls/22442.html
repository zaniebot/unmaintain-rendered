<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix generally poor ranking in playground completions - astral-sh/ruff #22442</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix generally poor ranking in playground completions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22442">#22442</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2026-01-07 17:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-07 17:14</div>
            <div class="timeline-body"><p>We enabled <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#completionList"><code>CompletionList::isIncomplete</code></a> in our LSP server a while back
in order to have more of a say in how we rank and filter completions.
When it isn't set, the client tends to ask for completions less
frequently and will instead do its own filtering.</p>
<p>But... we did not enable it for the playground. Which I guess didn't
result in anything noticeably bad until we started limiting completions
to 1,000 suggestions. This meant that if the <em>initial</em> completion
response didn't include the ultimate desired answer, then it would never
show up in the results until the client requested completions again.
This in turn led to some very poor completions in some cases.</p>
<p>This all gets fixed by simply enabling <code>isIncomplete</code> for Monaco.</p>
<p>Fixes astral-sh/ty#2340</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-07 17:14</div>
            <div class="timeline-body"><p>Demo:</p>
<p>https://github.com/user-attachments/assets/13f0f3a6-d011-4059-a59e-912ba35cb530</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2026-01-07 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> added by @BurntSushi on 2026-01-07 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @BurntSushi on 2026-01-07 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @BurntSushi on 2026-01-07 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @BurntSushi on 2026-01-07 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2026-01-07 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2026-01-07 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2026-01-07 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-07 17:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:56:31 UTC
    </footer>
</body>
</html>
