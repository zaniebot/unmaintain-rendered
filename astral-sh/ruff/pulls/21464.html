<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Fix false positive for complex conversion specifiers in `logging-eager-conversion` (`RUF065`) - astral-sh/ruff #21464</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Fix false positive for complex conversion specifiers in <code>logging-eager-conversion</code> (<code>RUF065</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21464">#21464</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-11-14 22:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/danparizher">@danparizher</a> on 2025-11-14 22:47</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes a false positive in <code>RUF065</code> when <code>oct()</code> or <code>hex()</code> are used with conversion specifiers that have complex flags or precision.</p>
<p>Fixes #21458.</p>
<h2>Problem</h2>
<p>The rule incorrectly flagged <code>oct()</code> and <code>hex()</code> calls as unnecessary when conversion specifiers had flags (<code>0</code>, <code> </code>, <code>+</code>) or precision, which change behavior between <code>%s</code> and <code>%#o</code>/<code>%#x</code>.</p>
<h2>Approach</h2>
<p>Added <code>has_complex_conversion_specifier()</code> helper to detect complex specifiers (zero-pad with width, blank sign, sign char, or precision) and updated <code>oct()</code> and <code>hex()</code> checks to skip reporting when the specifier is complex.</p>
<h2>Test Plan</h2>
<p>Added test cases to <code>RUF065_0.py</code> covering <code>%06s</code>, <code>% s</code>, <code>%+s</code>, and <code>%.3s</code> with <code>oct()</code> and <code>hex()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 22:55</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @amyreese on 2025-11-18 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @amyreese by @ntBre on 2025-11-18 21:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amyreese">@amyreese</a> on 2025-11-18 21:44</div>
            <div class="timeline-body"><p>Pushed some changes to reduce verbosity (and duplication) of comments, and to condense the logic in <code>has_complex_conversion_specifier</code>. Also moved the &quot;OK&quot; cases into <code>RUF065_1.py</code> alongside similar cases, and included a link to the github issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @amyreese on 2025-11-18 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a> approved on 2025-11-18 21:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> removed by @MichaReiser on 2025-11-19 08:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2025-11-19 08:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-11-19 08:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-11-19 08:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-11-19 08:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:48:27 UTC
    </footer>
</body>
</html>
