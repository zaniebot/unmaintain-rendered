```yaml
number: 6857
title: POC of assert formatting
type: pull_request
state: closed
author: MichaReiser
labels:
  - formatter
assignees: []
base: main
head: poc-of-assert-formatting
created_at: 2023-08-24T17:35:26Z
updated_at: 2023-10-18T08:43:11Z
url: https://github.com/astral-sh/ruff/pull/6857
synced_at: 2026-01-12T15:55:22Z
```

# POC of assert formatting

---

_@MichaReiser_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This is a POC of formatting assertions where the left side is a `can_omit_optional_parenthees` expression
starting with a parenthesized expression and the right is a string. 

This PR doesn't perfectly match black yet, but the similarity index aren't improving for any of our tested projects, which makes me question whether this is worth perusing. 

I'm putting this up to get feedback on how important this formatting is. You can ignore the implementation and just look at the `assert.py` changes.

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

<!-- How was it tested? -->


---

_Comment by @MichaReiser on 2023-08-24 17:35_

Current dependencies on/for this PR:
* main
  * **PR #7490** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7490" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #6857** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6857" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6857?utm_source=stack-comment).

---

_@MichaReiser reviewed on 2023-08-24 17:37_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/tests/snapshots/format@statement__assert.py.snap`:264 on 2023-08-24 17:37_

String should be parenthesized

---

_@MichaReiser reviewed on 2023-08-24 17:38_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/tests/snapshots/format@statement__assert.py.snap`:252 on 2023-08-24 17:38_

Incorrect, should remain unchanged

---

_@MichaReiser reviewed on 2023-08-24 17:39_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/tests/snapshots/format@statement__assert.py.snap`:276 on 2023-08-24 17:39_

String should be parenthesized

---

_Review requested from @charliermarsh by @MichaReiser on 2023-08-24 17:39_

---

_Review requested from @zanieb by @MichaReiser on 2023-08-24 17:39_

---

_Comment by @github-actions[bot] on 2023-08-24 18:12_

## PR Check Results
### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.02      4.1Â±0.04ms    10.0 MB/sec    1.00      4.0Â±0.04ms    10.1 MB/sec
formatter/numpy/ctypeslib.py               1.01    824.0Â±5.39Âµs    20.2 MB/sec    1.00    819.0Â±5.61Âµs    20.3 MB/sec
formatter/numpy/globals.py                 1.00     79.9Â±0.30Âµs    36.9 MB/sec    1.00     79.5Â±0.47Âµs    37.1 MB/sec
formatter/pydantic/types.py                1.03  1688.9Â±14.13Âµs    15.1 MB/sec    1.00  1646.5Â±25.36Âµs    15.5 MB/sec
linter/all-rules/large/dataset.py          1.02     10.5Â±0.02ms     3.9 MB/sec    1.00     10.4Â±0.03ms     3.9 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      2.9Â±0.01ms     5.8 MB/sec    1.00      2.8Â±0.02ms     5.8 MB/sec
linter/all-rules/numpy/globals.py          1.00    317.7Â±1.29Âµs     9.3 MB/sec    1.01    321.2Â±1.09Âµs     9.2 MB/sec
linter/all-rules/pydantic/types.py         1.01      5.4Â±0.01ms     4.7 MB/sec    1.00      5.4Â±0.02ms     4.7 MB/sec
linter/default-rules/large/dataset.py      1.04      5.7Â±0.01ms     7.2 MB/sec    1.00      5.5Â±0.01ms     7.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02   1196.7Â±5.29Âµs    13.9 MB/sec    1.00   1171.8Â±9.50Âµs    14.2 MB/sec
linter/default-rules/numpy/globals.py      1.02    124.8Â±0.27Âµs    23.6 MB/sec    1.00    122.7Â±0.33Âµs    24.0 MB/sec
linter/default-rules/pydantic/types.py     1.02      2.6Â±0.01ms    10.0 MB/sec    1.00      2.5Â±0.02ms    10.2 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.02      5.9Â±0.28ms     6.9 MB/sec    1.00      5.8Â±0.17ms     7.1 MB/sec
formatter/numpy/ctypeslib.py               1.01  1194.4Â±49.89Âµs    13.9 MB/sec    1.00  1185.0Â±55.28Âµs    14.1 MB/sec
formatter/numpy/globals.py                 1.00    116.7Â±7.76Âµs    25.3 MB/sec    1.00    117.0Â±7.85Âµs    25.2 MB/sec
formatter/pydantic/types.py                1.00      2.4Â±0.10ms    10.7 MB/sec    1.01      2.4Â±0.08ms    10.7 MB/sec
linter/all-rules/large/dataset.py          1.05     16.1Â±0.42ms     2.5 MB/sec    1.00     15.2Â±0.49ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.09      4.5Â±0.25ms     3.7 MB/sec    1.00      4.1Â±0.11ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00   524.6Â±23.72Âµs     5.6 MB/sec    1.02   536.4Â±23.14Âµs     5.5 MB/sec
linter/all-rules/pydantic/types.py         1.00      8.0Â±0.28ms     3.2 MB/sec    1.03      8.3Â±0.35ms     3.1 MB/sec
linter/default-rules/large/dataset.py      1.00      8.5Â±0.18ms     4.8 MB/sec    1.02      8.7Â±0.23ms     4.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1818.8Â±71.50Âµs     9.2 MB/sec    1.01  1834.0Â±56.89Âµs     9.1 MB/sec
linter/default-rules/numpy/globals.py      1.00    214.4Â±9.40Âµs    13.8 MB/sec    1.02   218.4Â±11.66Âµs    13.5 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.9Â±0.13ms     6.5 MB/sec    1.01      4.0Â±0.18ms     6.4 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Label `formatter` added by @konstin on 2023-08-25 08:48_

---

_Closed by @MichaReiser on 2023-10-18 08:43_

---
