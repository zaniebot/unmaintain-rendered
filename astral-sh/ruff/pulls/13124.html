<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>red-knot: infer and display ellipsis type - astral-sh/ruff #13124</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>red-knot: infer and display ellipsis type</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13124">#13124</a>
        opened by <a href="https://github.com/chriskrycho">@chriskrycho</a>
        on 2024-08-27 16:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a></div>
            <div class="timeline-body">Summary
<p>Just what it says on the tin: adds basic <code>EllipsisType</code> inference for any time <code>...</code> appears in the AST.</p>
Test Plan
<p>Test that <code>x = ...</code> produces exactly what we would expect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/chriskrycho">@chriskrycho</a> on 2024-08-27 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/chriskrycho">@chriskrycho</a> on 2024-08-27 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/chriskrycho">@chriskrycho</a> on 2024-08-27 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-27 16:39</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:305 on 2024-08-27 16:43</div>
            <div class="timeline-body"><p>I&#x27;m not sure this needs to be its own variant in the <code>Type</code> enum... it&#x27;s conceptually just an instance of <code>types.EllipsisType</code>. <code>types.EllipsisType</code> was only exposed on Python 3.10+, but typeshed already provides a nice little compatibility workaround for us here: <a href="https://github.com/python/typeshed/blob/f58dac1d62d33bb2255b762783d06463c40f5065/stdlib/builtins.pyi#L1849-L1865">https://github.com/python/typeshed/blob/f58dac1d62d33bb2255b762783d06463c40f5065/stdlib/builtins.pyi#L1849-L1865</a></p>
<p>(<code>builtins.Ellipsis</code> is the same object as <code>...</code>)</p>
<pre><code>&gt;&gt;&gt; ...
Ellipsis
&gt;&gt;&gt; Ellipsis
Ellipsis
&gt;&gt;&gt; Ellipsis is ...
True
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:1340 on 2024-08-27 16:46</div>
            <div class="timeline-body"><p>I think I would probably just revert the changes you made to <code>types.rs</code> and <code>types/display.rs</code> and simply do this here:</p>
<pre><code>        builtins_symbol_ty_by_name(self.db, &quot;Ellipsis&quot;)
</code></pre>
<p>It doesn&#x27;t seem to get us quite the right answer currently (the typeshed stubs there are using some features we don&#x27;t support right now) so you may need to adjust the assertion in your test and add a TODO. But it&#x27;ll set us up better in the long run.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-27 16:46</div>
            <div class="timeline-body"><p>Hmm, not sure about this approach</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:305 on 2024-08-27 16:50</div>
            <div class="timeline-body"><p>One interesting way in which <code>...</code> <em>is</em> special is that it&#x27;s a singleton: it is the <em>only</em> instance of <code>types.EllipsisType</code> that there is, or that there could be. But that can be thought of as just a sealed type that has exactly one member, and we&#x27;ve yet to implement a generalised way of handling sealed types. (We&#x27;ll need them to tackle enums in Python!) See <a href="https://github.com/astral-sh/ruff/issues/12694">astral-sh/ruff#12694</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-27 16:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-08-27 19:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:1340 on 2024-08-27 19:27</div>
            <div class="timeline-body"><p>That seems reasonable. The resulting display/result is <code>Unknown | Literal[EllipsisType]</code>. As I am leaving a TODO: what <em>should</em> it be?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-27 19:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:1340 on 2024-08-27 19:39</div>
            <div class="timeline-body"><p>It should just be <code>types.EllipsisType</code> (if on py310+) or <code>ellipsis</code> (if on Python &lt;=3.9)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:1342 on 2024-08-27 19:42</div>
            <div class="timeline-body"><p>I would eliminate this TODO. This TODO will be resolved by other added features; the code right here shouldn&#x27;t need to change at all, which means we also don&#x27;t need a reminder TODO comment here.</p>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-08-27 19:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-27 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-27 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-27 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/carljm">@carljm</a> on 2024-08-27 23:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:06:22 UTC
    </footer>
</body>
</html>
