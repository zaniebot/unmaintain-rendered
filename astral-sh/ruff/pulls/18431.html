<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Treat lambda functions as instances of types.FunctionType - astral-sh/ruff #18431</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Treat lambda functions as instances of types.FunctionType</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18431">#18431</a>
        opened by <a href="https://github.com/lipefree">@lipefree</a>
        on 2025-06-02 14:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lipefree">@lipefree</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>Fixes https://github.com/astral-sh/ty/issues/567.</p>
<p>Since <code>lambda</code> functions are instance of <code>types.FunctionType</code>, we should be able to access to attribute such as <code>__code__</code>, <code>__name__</code> and more. With this PR, we will have the following type and no more errors :</p>
<pre><code class="language-py">from typing import reveal_type

x = lambda y: y

reveal_type(x.__code__)  # revealed: CodeType
</code></pre>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>I have added mdtests, but since I am not familiar with attributes of <code>types.FunctionType</code>, my tests may be either too redundant or not exhaustive enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @lipefree on 2025-06-02 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @lipefree on 2025-06-02 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @lipefree on 2025-06-02 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @lipefree on 2025-06-02 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-06-02 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Treat lambda functions as types.FunctionType" to "[ty] Treat lambda functions as instances of types.FunctionType" by @AlexWaygood on 2025-06-02 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-02 14:58</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">static-frame (https://github.com/static-frame/static-frame)
- error[unresolved-attribute] static_frame/core/util.py:571:5: Unresolved attribute `__name__` on type `(rhs, lhs, func=Any) -&gt; Unknown`.
- Found 1944 diagnostics
+ Found 1943 diagnostics

bokeh (https://github.com/bokeh/bokeh)
+ error[invalid-assignment] src/bokeh/core/templates.py:112:1: Object of type `dict[str, () -&gt; Unknown]` is not assignable to `dict[str, () -&gt; Template]`
- Found 951 diagnostics
+ Found 952 diagnostics

sphinx (https://github.com/sphinx-doc/sphinx)
- error[unresolved-attribute] sphinx/ext/autodoc/preserve_defaults.py:28:16: Type `() -&gt; Unknown` has no attribute `__name__`
- Found 657 diagnostics
+ Found 656 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
- error[unresolved-attribute] ddtrace/debugging/_signal/utils.py:227:38: Type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` has no attribute `__name__`
- error[unresolved-attribute] ddtrace/debugging/_signal/utils.py:257:38: Type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` has no attribute `__name__`
- error[unresolved-attribute] ddtrace/debugging/_signal/utils.py:313:41: Type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` has no attribute `__name__`
- error[unresolved-attribute] ddtrace/debugging/_signal/utils.py:332:34: Type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` has no attribute `__name__`
- error[unresolved-attribute] ddtrace/debugging/_signal/utils.py:358:37: Type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` has no attribute `__name__`
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:227:38: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:257:38: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:313:41: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:332:34: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:358:37: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
- error[unresolved-attribute] tests/tracer/test_writer.py:311:34: Type `(*args) -&gt; Unknown` has no attribute `__get__`
- Found 6861 diagnostics
+ Found 6860 diagnostics

sympy (https://github.com/sympy/sympy)
- error[unsupported-operator] sympy/codegen/tests/test_applications.py:23:17: Operator `&lt;` is not supported for types `Variable` and `Variable`
- error[unresolved-attribute] sympy/tensor/array/array_comprehension.py:342:58: Type `() -&gt; Unknown` has no attribute `__name__`
- Found 18575 diagnostics
+ Found 18573 diagnostics

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-02 15:45</div>
            <div class="timeline-body"><blockquote>
<pre><code class="language-diff">+ error[invalid-assignment] src/bokeh/core/templates.py:112:1: Object of type `dict[str, () -&gt; Unknown]` is not assignable to `dict[str, () -&gt; Template]`
</code></pre>
</blockquote>
<p>This error is occuring because <code>dict</code> is invariant: https://github.com/bokeh/bokeh/blob/7d6cedea470cb68f25afd126a29a45370c08f443/src/bokeh/core/templates.py#L112-L127. Bidirectional inference would fix this.</p>
<blockquote>
<pre><code class="language-diff">+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:227:38: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:257:38: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:313:41: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:332:34: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
+ warning[possibly-unbound-attribute] ddtrace/debugging/_signal/utils.py:358:37: Attribute `__name__` on type `((Any, /) -&gt; bool) | ((_) -&gt; Unknown)` is possibly unbound
</code></pre>
</blockquote>
<p>These are because we do not infer <code>Callable</code> types created from <code>Callable</code> type expressions as being function-like. Whether or not we should do that is a complicated question that's discussed in other issues.</p>
<p>So all the primer hits here look good to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-06-02 15:46</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-06-02 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-02 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2025-06-11 10:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:05 UTC
    </footer>
</body>
</html>
