<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Complete support for `ParamSpec` - astral-sh/ruff #21445</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Complete support for <code>ParamSpec</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21445">#21445</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-11-14 08:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-11-14 08:25</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Closes: https://github.com/astral-sh/ty/issues/157</p>
<p>This PR adds support for the following capabilities involving a <code>ParamSpec</code> type variable:</p>
<ul>
<li>Representing <code>P.args</code> and <code>P.kwargs</code> in the type system</li>
<li>Matching against a callable containing <code>P</code> to create a type mapping</li>
<li>Specializing <code>P</code> against the stored parameters</li>
</ul>
<p>The value of a <code>ParamSpec</code> type variable is being represented using <code>CallableType</code> with a <code>CallableTypeKind::ParamSpecValue</code> variant. This <code>CallableTypeKind</code> is expanded from the existing <code>is_function_like</code> boolean flag. An <code>enum</code> is used as these variants are mutually exclusive.</p>
<p>For context, an initial iteration made an attempt to expand the <code>Specialization</code> to use <code>TypeOrParameters</code> enum that represents that a type variable can specialize into either a <code>Type</code> or <code>Parameters</code> but that increased the complexity of the code as all downstream usages would need to handle both the variants appropriately. Additionally, we'd have also need to establish an invariant that a regular type variable always maps to a <code>Type</code> while a paramspec type variable always maps to a <code>Parameters</code>.</p>
<p>I've intentionally left out checking and raising diagnostics when the <code>ParamSpec</code> type variable and it's components are not being used correctly to avoid scope increase and it can easily be done as a follow-up. This would also include the scoping rules which I don't think a regular type variable implements either.</p>
<h2>Test Plan</h2>
<p>Add new mdtest cases and update existing test cases.</p>
<p>Ran this branch on pyx, no new diagnostics.</p>
<h3>Ecosystem analysis</h3>
<p>There's a case where in an annotated assignment like:</p>
<pre><code class="language-py">type CustomType[P] = Callable[...]

def value[**P](...): ...

def another[**P](...):
	target: CustomType[P] = value
</code></pre>
<p>The type of <code>value</code> is a callable and it has a paramspec that's bound to <code>value</code>, <code>CustomType</code> is a type alias that's a callable and <code>P</code> that's used in it's specialization is bound to <code>another</code>. Now, ty infers the type of <code>target</code> same as <code>value</code> and does not use the declared type <code>CustomType[P]</code>. <a href="https://github.com/mikeshardmind/async-utils/blob/0980b9d9ab2bc7a24777684a884f4ea96cbbe5f9/src/async_utils/gen_transform.py#L108">This is the assignment</a> that I'm referring to which then leads to error in downstream usage. Pyright and mypy does seem to use the declared type.</p>
<p>There are multiple diagnostics in <code>dd-trace-py</code> that requires support for <code>cls</code>.</p>
<p>I'm seeing <code>Divergent</code> type for an example like which ~~I'm not sure why, I'll look into it tomorrow~~ is because of a cycle as mentioned in https://github.com/astral-sh/ty/issues/1729#issuecomment-3612279974:</p>
<pre><code class="language-py">from typing import Callable

def decorator[**P](c: Callable[P, int]) -&gt; Callable[P, str]: ...

@decorator
def func(a: int) -&gt; int: ...

# ((a: int) -&gt; str) | ((a: Divergent) -&gt; str)
reveal_type(func)
</code></pre>
<p>I ~~need to look into why are the parameters not being specialized through multiple decorators in the following code~~ think this is also because of the cycle mentioned in https://github.com/astral-sh/ty/issues/1729#issuecomment-3612279974 and the fact that we don't support <code>staticmethod</code> properly:</p>
<pre><code class="language-py">from contextlib import contextmanager

class Foo:
    @staticmethod
    @contextmanager
    def method(x: int):
        yield

foo = Foo()
# ty: Revealed type: `() -&gt; _GeneratorContextManager[Unknown, None, None]` [revealed-type]
reveal_type(foo.method)
</code></pre>
<p>There's some issue related to <code>Protocol</code> that are generic over a <code>ParamSpec</code> in <code>starlette</code> which might be related to https://github.com/astral-sh/ty/issues/1635 but I'm not sure. Here's a minimal example to reproduce:</p>
<details><summary>Code snippet:</summary>
<p>

<pre><code class="language-py">from collections.abc import Awaitable, Callable, MutableMapping
from typing import Any, Callable, ParamSpec, Protocol

P = ParamSpec(&quot;P&quot;)

Scope = MutableMapping[str, Any]
Message = MutableMapping[str, Any]
Receive = Callable[[], Awaitable[Message]]
Send = Callable[[Message], Awaitable[None]]

ASGIApp = Callable[[Scope, Receive, Send], Awaitable[None]]

_Scope = Any
_Receive = Callable[[], Awaitable[Any]]
_Send = Callable[[Any], Awaitable[None]]

# Since `starlette.types.ASGIApp` type differs from `ASGIApplication` from `asgiref`
# we need to define a more permissive version of ASGIApp that doesn't cause type errors.
_ASGIApp = Callable[[_Scope, _Receive, _Send], Awaitable[None]]


class _MiddlewareFactory(Protocol[P]):
    def __call__(
        self, app: _ASGIApp, *args: P.args, **kwargs: P.kwargs
    ) -&gt; _ASGIApp: ...


class Middleware:
    def __init__(
        self, factory: _MiddlewareFactory[P], *args: P.args, **kwargs: P.kwargs
    ) -&gt; None:
        self.factory = factory
        self.args = args
        self.kwargs = kwargs


class ServerErrorMiddleware:
    def __init__(
        self,
        app: ASGIApp,
        value: int | None = None,
        flag: bool = False,
    ) -&gt; None:
        self.app = app
        self.value = value
        self.flag = flag

    async def __call__(self, scope: Scope, receive: Receive, send: Send) -&gt; None: ...


# ty: Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ServerErrorMiddleware'&gt;` [invalid-argument-type]
Middleware(ServerErrorMiddleware, value=500, flag=True)
</code></pre>
</p>
</details> 

<h3>Conformance analysis</h3>
<blockquote>
<pre><code class="language-diff">-constructors_callable.py:36:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:36:13: info[revealed-type] Revealed type: `(x: int) -&gt; Unknown`
</code></pre>
</blockquote>
<p>Requires return type inference i.e., https://github.com/astral-sh/ruff/pull/21551</p>
<blockquote>
<pre><code class="language-diff">+constructors_callable.py:194:16: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | str]`
+constructors_callable.py:194:22: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | str]`
+constructors_callable.py:195:4: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | int]`
+constructors_callable.py:195:9: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | str]`
</code></pre>
</blockquote>
<p>I might need to look into why this is happening...</p>
<blockquote>
<pre><code class="language-diff">+generics_defaults.py:79:1: error[type-assertion-failure] Type `type[Class_ParamSpec[(str, int, /)]]` does not match asserted type `&lt;class 'Class_ParamSpec'&gt;`
</code></pre>
</blockquote>
<p>which is on the following code</p>
<pre><code class="language-py">DefaultP = ParamSpec(&quot;DefaultP&quot;, default=[str, int])

class Class_ParamSpec(Generic[DefaultP]): ...

assert_type(Class_ParamSpec, type[Class_ParamSpec[str, int]])
</code></pre>
<p>It's occurring because there's no equivalence relationship defined between <code>ClassLiteral</code> and <code>KnownInstanceType::TypeGenericAlias</code> which is what these types are.</p>
<p>Everything else looks good to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @dhruvmanila on 2025-11-14 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add support for `P.args` and `P.kwargs`" to "[ty] Add support for `P.args` and `P.kwargs`" by @dhruvmanila on 2025-11-14 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 08:28</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<details>
<summary>Changes were detected when running ty on typing conformance tests</summary>

<pre><code class="language-diff">--- old-output.txt	2025-12-05 16:25:18.961900308 +0000
+++ new-output.txt	2025-12-05 16:25:22.658918282 +0000
@@ -3,22 +3,20 @@
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
 _directives_deprecated_library.py:41:25: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int | float`
 _directives_deprecated_library.py:45:24: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
-aliases_explicit.py:41:24: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[str, str]`?
 aliases_explicit.py:57:5: error[type-assertion-failure] Type `(int, str, str, /) -&gt; None` does not match asserted type `Unknown`
-aliases_explicit.py:60:5: error[type-assertion-failure] Type `(...) -&gt; None` does not match asserted type `@Todo(Callable[..] specialized with ParamSpec)`
 aliases_explicit.py:67:24: error[invalid-type-arguments] Too many type arguments: expected 0, got 1
 aliases_explicit.py:68:24: error[invalid-type-arguments] Too many type arguments: expected 0, got 1
 aliases_explicit.py:69:29: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
 aliases_explicit.py:70:29: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
+aliases_explicit.py:71:24: error[invalid-type-arguments] Type argument for `ParamSpec` must be either a list of types, `ParamSpec`, `Concatenate`, or `...`
 aliases_explicit.py:101:6: error[call-non-callable] Object of type `UnionType` is not callable
 aliases_explicit.py:102:20: error[invalid-type-arguments] Too many type arguments: expected 0, got 1
-aliases_implicit.py:54:24: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[str, str]`?
 aliases_implicit.py:68:5: error[type-assertion-failure] Type `(int, str, str, /) -&gt; None` does not match asserted type `Unknown`
-aliases_implicit.py:72:5: error[type-assertion-failure] Type `(...) -&gt; None` does not match asserted type `@Todo(Callable[..] specialized with ParamSpec)`
 aliases_implicit.py:76:24: error[invalid-type-arguments] Too many type arguments: expected 0, got 1
 aliases_implicit.py:77:24: error[invalid-type-arguments] Too many type arguments: expected 0, got 1
 aliases_implicit.py:78:29: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
 aliases_implicit.py:79:29: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
+aliases_implicit.py:80:24: error[invalid-type-arguments] Type argument for `ParamSpec` must be either a list of types, `ParamSpec`, `Concatenate`, or `...`
 aliases_implicit.py:81:25: error[invalid-type-arguments] Type `str` is not assignable to upper bound `int | float` of type variable `TFloat@GoodTypeAlias12`
 aliases_implicit.py:107:9: error[invalid-type-form] Variable of type `list[Unknown | &lt;class 'int'&gt; | &lt;class 'str'&gt;]` is not allowed in a type expression
 aliases_implicit.py:108:9: error[invalid-type-form] Variable of type `tuple[tuple[&lt;class 'int'&gt;, &lt;class 'str'&gt;]]` is not allowed in a type expression
@@ -44,7 +42,7 @@
 aliases_newtype.py:61:38: error[invalid-newtype] invalid base for `typing.NewType`: type `TD1`
 aliases_newtype.py:63:15: error[invalid-newtype] Wrong number of arguments in `NewType` creation, expected 2, found 3
 aliases_newtype.py:65:38: error[invalid-newtype] invalid base for `typing.NewType`: type `Any`
-aliases_type_statement.py:10:35: error[invalid-type-arguments] Too many type arguments: expected 1, got 3
+aliases_type_statement.py:10:52: error[invalid-type-arguments] Too many type arguments: expected 2, got 3
 aliases_type_statement.py:17:1: error[unresolved-attribute] Object of type `typing.TypeAliasType` has no attribute `bit_count`
 aliases_type_statement.py:19:1: error[call-non-callable] Object of type `TypeAliasType` is not callable
 aliases_type_statement.py:23:7: error[unresolved-attribute] Object of type `typing.TypeAliasType` has no attribute `other_attrib`
@@ -65,14 +63,8 @@
 aliases_type_statement.py:47:23: error[invalid-type-form] Int literals are not allowed in this context in a type expression
 aliases_type_statement.py:48:23: error[invalid-type-form] Boolean operations are not allowed in type expressions
 aliases_type_statement.py:49:23: error[fstring-type-annotation] Type expressions cannot use f-strings
-aliases_type_statement.py:75:107: error[invalid-type-arguments] Too many type arguments: expected 2, got 3
 aliases_type_statement.py:77:27: error[invalid-type-arguments] Type `str` is not assignable to upper bound `int` of type variable `S@RecursiveTypeAlias2`
-aliases_type_statement.py:77:37: error[invalid-type-arguments] Too many type arguments: expected 2, got 3
-aliases_type_statement.py:78:37: error[invalid-type-arguments] Too many type arguments: expected 2, got 3
 aliases_type_statement.py:79:32: error[invalid-type-arguments] Type `int` is not assignable to upper bound `str` of type variable `T@RecursiveTypeAlias2`
-aliases_type_statement.py:79:37: error[invalid-type-arguments] Too many type arguments: expected 2, got 3
-aliases_type_statement.py:80:37: error[invalid-type-arguments] Too many type arguments: expected 2, got 3
-aliases_type_statement.py:80:37: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[int, str]`?
 aliases_type_statement.py:82:1: error[cyclic-type-alias-definition] Cyclic definition of `RecursiveTypeAlias3`
 aliases_type_statement.py:88:1: error[cyclic-type-alias-definition] Cyclic definition of `RecursiveTypeAlias6`
 aliases_type_statement.py:89:1: error[cyclic-type-alias-definition] Cyclic definition of `RecursiveTypeAlias7`
@@ -158,7 +150,7 @@
 callables_protocol.py:169:7: error[invalid-assignment] Object of type `def cb8_bad1(x: int) -&gt; Any` is not assignable to `Proto8`
 callables_protocol.py:186:5: error[invalid-assignment] Object of type `Literal[&quot;str&quot;]` is not assignable to attribute `other_attribute` of type `int`
 callables_protocol.py:187:5: error[unresolved-attribute] Unresolved attribute `xxx` on type `Proto9[P@decorator1, R@decorator1]`.
-callables_protocol.py:197:7: error[unresolved-attribute] Object of type `Proto9[Unknown, Unknown]` has no attribute `other_attribute2`
+callables_protocol.py:197:7: error[unresolved-attribute] Object of type `Proto9[(x: int), Unknown] | Proto9[Divergent, Unknown]` has no attribute `other_attribute2`
 callables_protocol.py:238:8: error[invalid-assignment] Object of type `def cb11_bad1(x: int, y: str, /) -&gt; Any` is not assignable to `Proto11`
 callables_protocol.py:260:8: error[invalid-assignment] Object of type `def cb12_bad1(*args: Any, *, kwarg0: Any) -&gt; None` is not assignable to `Proto12`
 callables_protocol.py:284:27: error[invalid-assignment] Object of type `def cb13_no_default(path: str) -&gt; str` is not assignable to `Proto13_Default`
@@ -244,29 +236,41 @@
 constructors_call_type.py:59:9: error[too-many-positional-arguments] Too many positional arguments to bound method `__init__`: expected 1, got 2
 constructors_call_type.py:81:5: error[missing-argument] No argument provided for required parameter `y` of function `__new__`
 constructors_call_type.py:82:12: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `str`, found `Literal[2]`
-constructors_callable.py:36:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:36:13: info[revealed-type] Revealed type: `(x: int) -&gt; Unknown`
 constructors_callable.py:37:1: error[type-assertion-failure] Type `Class1` does not match asserted type `Unknown`
-constructors_callable.py:49:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:38:1: error[missing-argument] No argument provided for required parameter `x`
+constructors_callable.py:39:1: error[missing-argument] No argument provided for required parameter `x`
+constructors_callable.py:39:4: error[unknown-argument] Argument `y` does not match any known parameter
+constructors_callable.py:49:13: info[revealed-type] Revealed type: `() -&gt; Unknown`
 constructors_callable.py:50:1: error[type-assertion-failure] Type `Class2` does not match asserted type `Unknown`
+constructors_callable.py:51:4: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 1
 constructors_callable.py:57:42: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__new__`
 constructors_callable.py:63:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
 constructors_callable.py:64:1: error[type-assertion-failure] Type `Class3` does not match asserted type `Unknown`
 constructors_callable.py:73:33: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
-constructors_callable.py:77:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:77:13: info[revealed-type] Revealed type: `(x: int) -&gt; Unknown`
 constructors_callable.py:78:1: error[type-assertion-failure] Type `int` does not match asserted type `Unknown`
+constructors_callable.py:79:1: error[missing-argument] No argument provided for required parameter `x`
+constructors_callable.py:80:1: error[missing-argument] No argument provided for required parameter `x`
+constructors_callable.py:80:4: error[unknown-argument] Argument `y` does not match any known parameter
 constructors_callable.py:97:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
 constructors_callable.py:100:5: error[type-assertion-failure] Type `Never` does not match asserted type `Unknown`
 constructors_callable.py:105:5: error[type-assertion-failure] Type `Never` does not match asserted type `Unknown`
-constructors_callable.py:125:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:125:13: info[revealed-type] Revealed type: `() -&gt; Unknown`
 constructors_callable.py:126:1: error[type-assertion-failure] Type `Class6Proxy` does not match asserted type `Unknown`
+constructors_callable.py:127:4: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 1
 constructors_callable.py:142:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
-constructors_callable.py:162:5: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:162:5: info[revealed-type] Revealed type: `Overload[(x: int) -&gt; Unknown, (x: str) -&gt; Unknown]`
 constructors_callable.py:164:1: error[type-assertion-failure] Type `Class7[int]` does not match asserted type `Unknown`
 constructors_callable.py:165:1: error[type-assertion-failure] Type `Class7[str]` does not match asserted type `Unknown`
-constructors_callable.py:182:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:182:13: info[revealed-type] Revealed type: `(x: list[Unknown], y: list[Unknown]) -&gt; Unknown`
 constructors_callable.py:183:1: error[type-assertion-failure] Type `Class8[str]` does not match asserted type `Unknown`
-constructors_callable.py:193:13: info[revealed-type] Revealed type: `(...) -&gt; Unknown`
+constructors_callable.py:193:13: info[revealed-type] Revealed type: `(x: list[T@__init__], y: list[T@__init__]) -&gt; Unknown`
 constructors_callable.py:194:1: error[type-assertion-failure] Type `Class9` does not match asserted type `Unknown`
+constructors_callable.py:194:16: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | str]`
+constructors_callable.py:194:22: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | str]`
+constructors_callable.py:195:4: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | int]`
+constructors_callable.py:195:9: error[invalid-argument-type] Argument is incorrect: Expected `list[T@__init__]`, found `list[Unknown | str]`
 dataclasses_descriptors.py:23:62: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int | Desc1`
 dataclasses_descriptors.py:50:63: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `list[T@Desc2] | T@Desc2`
 dataclasses_descriptors.py:66:1: error[type-assertion-failure] Type `int` does not match asserted type `int | Desc2[int]`
@@ -403,7 +407,7 @@
 enums_member_values.py:96:1: error[type-assertion-failure] Type `int` does not match asserted type `Unknown`
 enums_members.py:82:1: error[type-assertion-failure] Type `Unknown` does not match asserted type `Unknown | ((x) -&gt; Unknown)`
 enums_members.py:82:37: error[invalid-type-form] Type arguments for `Literal` must be `None`, a literal value (int, bool, str, or bytes), or an enum member
-enums_members.py:83:1: error[type-assertion-failure] Type `Unknown` does not match asserted type `Unknown | ((...) -&gt; Unknown)`
+enums_members.py:83:1: error[type-assertion-failure] Type `Unknown` does not match asserted type `Unknown | ((x: int) -&gt; Unknown)`
 enums_members.py:83:37: error[invalid-type-form] Type arguments for `Literal` must be `None`, a literal value (int, bool, str, or bytes), or an enum member
 enums_members.py:84:1: error[type-assertion-failure] Type `Unknown` does not match asserted type `property`
 enums_members.py:84:35: error[invalid-type-form] Type arguments for `Literal` must be `None`, a literal value (int, bool, str, or bytes), or an enum member
@@ -446,11 +450,7 @@
 generics_defaults.py:55:1: error[type-assertion-failure] Type `type[AllTheDefaults[int, int | float | complex, str, int, bool]]` does not match asserted type `&lt;class 'AllTheDefaults[int, int | float | complex, str, int, bool]'&gt;`
 generics_defaults.py:59:1: error[type-assertion-failure] Type `type[AllTheDefaults[int, int | float | complex, str, int, bool]]` does not match asserted type `&lt;class 'AllTheDefaults[int, int | float | complex, str, int, bool]'&gt;`
 generics_defaults.py:63:1: error[type-assertion-failure] Type `type[AllTheDefaults[int, int | float | complex, str, int, bool]]` does not match asserted type `&lt;class 'AllTheDefaults[int, int | float | complex, str, int, bool]'&gt;`
-generics_defaults.py:79:1: error[type-assertion-failure] Type `type[Class_ParamSpec[Unknown]]` does not match asserted type `&lt;class 'Class_ParamSpec'&gt;`
-generics_defaults.py:79:56: error[invalid-type-arguments] Too many type arguments to class `Class_ParamSpec`: expected between 0 and 1, got 2
-generics_defaults.py:80:53: error[invalid-type-arguments] Too many type arguments to class `Class_ParamSpec`: expected between 0 and 1, got 2
-generics_defaults.py:81:29: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[bool, bool]`?
-generics_defaults.py:81:68: error[invalid-type-arguments] Too many type arguments to class `Class_ParamSpec`: expected between 0 and 1, got 2
+generics_defaults.py:79:1: error[type-assertion-failure] Type `type[Class_ParamSpec[(str, int, /)]]` does not match asserted type `&lt;class 'Class_ParamSpec'&gt;`
 generics_defaults.py:94:1: error[type-assertion-failure] Type `@Todo(specialized non-generic class)` does not match asserted type `&lt;class 'Class_TypeVarTuple'&gt;`
 generics_defaults.py:95:1: error[type-assertion-failure] Type `@Todo(specialized non-generic class)` does not match asserted type `Class_TypeVarTuple`
 generics_defaults.py:127:32: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `T4@func1`
@@ -468,32 +468,42 @@
 generics_paramspec_basic.py:10:1: error[invalid-paramspec] The name of a `ParamSpec` (`NotIt`) must match the name of the variable it is assigned to (`WrongName`)
 generics_paramspec_basic.py:23:20: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `P@func1`
 generics_paramspec_basic.py:27:38: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
-generics_paramspec_components.py:49:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `tuple[@Todo(ParamSpecArgs / ParamSpecKwargs), ...]`
+generics_paramspec_components.py:17:25: error[invalid-type-form] `P.kwargs` is valid only in `**kwargs` annotation: Did you mean `P.args`?
+generics_paramspec_components.py:17:45: error[invalid-type-form] `P.args` is valid only in `*args` annotation: Did you mean `P.kwargs`?
+generics_paramspec_components.py:23:46: error[invalid-type-form] `P.args` is valid only in `*args` annotation: Did you mean `P.kwargs`?
+generics_paramspec_components.py:49:11: error[invalid-argument-type] Argument is incorrect: Expected `P@decorator.args`, found `P@decorator.kwargs`
+generics_paramspec_components.py:49:20: error[invalid-argument-type] Argument is incorrect: Expected `P@decorator.kwargs`, found `P@decorator.args`
+generics_paramspec_components.py:51:11: error[invalid-argument-type] Argument is incorrect: Expected `P@decorator.args`, found `Literal[1]`
+generics_paramspec_components.py:83:18: error[invalid-argument-type] Argument to function `foo` is incorrect: Expected `int`, found `(...)`
 generics_paramspec_components.py:83:18: error[parameter-already-assigned] Multiple values provided for parameter 1 (`x`) of function `foo`
-generics_paramspec_semantics.py:13:56: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(...) -&gt; str`
+generics_paramspec_components.py:98:7: error[invalid-argument-type] Argument to function `twice` is incorrect: Expected `int`, found `Literal[&quot;A&quot;]`
+generics_paramspec_components.py:98:20: error[invalid-argument-type] Argument to function `twice` is incorrect: Expected `str`, found `Literal[1]`
+generics_paramspec_semantics.py:13:56: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(**P@changes_return_type_to_str) -&gt; str`
 generics_paramspec_semantics.py:17:40: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
-generics_paramspec_semantics.py:22:1: error[type-assertion-failure] Type `(str, bool, /) -&gt; str` does not match asserted type `(...) -&gt; str`
-generics_paramspec_semantics.py:30:56: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(...) -&gt; bool`
+generics_paramspec_semantics.py:26:4: error[positional-only-parameter-as-kwarg] Positional-only parameter 1 (`a`) passed as keyword argument
+generics_paramspec_semantics.py:26:11: error[positional-only-parameter-as-kwarg] Positional-only parameter 2 (`b`) passed as keyword argument
+generics_paramspec_semantics.py:27:9: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[&quot;A&quot;]`
+generics_paramspec_semantics.py:30:56: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(**P@func1) -&gt; bool`
 generics_paramspec_semantics.py:34:28: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_semantics.py:38:28: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
+generics_paramspec_semantics.py:46:17: error[invalid-argument-type] Argument to function `func1` is incorrect: Expected `(x: int, y: str) -&gt; int`, found `def y_x(y: int, x: str) -&gt; int`
 generics_paramspec_semantics.py:53:34: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_semantics.py:57:34: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
+generics_paramspec_semantics.py:61:23: error[invalid-argument-type] Argument to function `func1` is incorrect: Expected `(*, x: int) -&gt; int`, found `def keyword_only_y(*, y: int) -&gt; int`
 generics_paramspec_semantics.py:76:30: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
-generics_paramspec_semantics.py:82:28: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `list[int]`?
-generics_paramspec_semantics.py:84:5: error[type-assertion-failure] Type `(int, /) -&gt; str` does not match asserted type `(...) -&gt; str`
 generics_paramspec_semantics.py:87:33: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_semantics.py:91:33: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(...) -&gt; bool`
-generics_paramspec_semantics.py:101:54: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(...) -&gt; bool`
+generics_paramspec_semantics.py:101:54: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(**P@remove) -&gt; bool`
 generics_paramspec_semantics.py:113:6: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `(...) -&gt; bool`
 generics_paramspec_semantics.py:128:20: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_semantics.py:133:23: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_semantics.py:138:29: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_semantics.py:143:25: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
-generics_paramspec_specialization.py:32:27: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[int, bool]`?
-generics_paramspec_specialization.py:40:27: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[()]`?
-generics_paramspec_specialization.py:40:31: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[()]`?
-generics_paramspec_specialization.py:52:22: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[int, str, bool]`?
-generics_paramspec_specialization.py:58:27: error[invalid-type-arguments] Too many type arguments to class `ClassC`: expected 1, got 3
+generics_paramspec_specialization.py:44:27: error[invalid-type-arguments] Type argument for `ParamSpec` must be either a list of types, `ParamSpec`, `Concatenate`, or `...`
+generics_paramspec_specialization.py:54:9: error[invalid-argument-type] Argument is incorrect: Expected `int`, found `Literal[&quot;&quot;]`
+generics_paramspec_specialization.py:55:16: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[&quot;&quot;]`
+generics_paramspec_specialization.py:60:9: error[invalid-argument-type] Argument is incorrect: Expected `int`, found `Literal[&quot;&quot;]`
+generics_paramspec_specialization.py:61:16: error[invalid-argument-type] Argument is incorrect: Expected `bool`, found `Literal[&quot;&quot;]`
 generics_scoping.py:14:1: error[type-assertion-failure] Type `int` does not match asserted type `Literal[1]`
 generics_scoping.py:15:1: error[type-assertion-failure] Type `str` does not match asserted type `Literal[&quot;a&quot;]`
 generics_scoping.py:42:1: error[type-assertion-failure] Type `str` does not match asserted type `Literal[&quot;abc&quot;]`
@@ -575,9 +585,9 @@
 generics_syntax_infer_variance.py:165:45: error[invalid-assignment] Object of type `ShouldBeContravariant1[int]` is not assignable to `ShouldBeContravariant1[int | float]`
 generics_syntax_infer_variance.py:166:43: error[invalid-assignment] Object of type `ShouldBeContravariant1[int | float]` is not assignable to `ShouldBeContravariant1[int]`
 generics_syntax_scoping.py:35:7: error[unresolved-reference] Name `T` used when not defined
-generics_syntax_scoping.py:40:23: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `((...) -&gt; R@decorator1, /) -&gt; (...) -&gt; R@decorator1`
+generics_syntax_scoping.py:40:23: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `((**P@decorator1) -&gt; R@decorator1, /) -&gt; (**P@decorator1) -&gt; R@decorator1`
 generics_syntax_scoping.py:44:17: error[unresolved-reference] Name `T` used when not defined
-generics_syntax_scoping.py:81:35: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `((...) -&gt; R@decorator2, /) -&gt; (...) -&gt; R@decorator2`
+generics_syntax_scoping.py:81:35: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `((**P@decorator2) -&gt; R@decorator2, /) -&gt; (**P@decorator2) -&gt; R@decorator2`
 generics_syntax_scoping.py:113:9: error[type-assertion-failure] Type `str` does not match asserted type `Literal[&quot;&quot;]`
 generics_syntax_scoping.py:116:13: error[type-assertion-failure] Type `TypeVar` does not match asserted type `typing.TypeVar`
 generics_syntax_scoping.py:121:9: error[type-assertion-failure] Type `int | float | complex` does not match asserted type `complex`
@@ -1021,4 +1031,4 @@
 typeddicts_usage.py:28:17: error[missing-typed-dict-key] Missing required key 'name' in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Unknown key &quot;title&quot; for TypedDict `Movie`: Unknown key &quot;title&quot;
 typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions
-Found 1023 diagnostics
+Found 1033 diagnostics

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 08:28</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">anyio (https://github.com/agronholm/anyio)
+ src/anyio/_backends/_asyncio.py:2565:13: error[invalid-argument-type] Argument to bound method `run` is incorrect: Expected `Coroutine[Any, Any, _T@run_coroutine_threadsafe]`, found `CoroutineType[Any, Any, T_Retval@run_async_from_thread]`
- src/anyio/functools.py:199:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `(...) -&gt; Awaitable[Unknown]`, found `((...) -&gt; Coroutine[Any, Any, T@_LRUCacheWrapper]) | ((...) -&gt; T@_LRUCacheWrapper)`
+ src/anyio/functools.py:199:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `(...) -&gt; Awaitable[Unknown]`, found `((**P@__call__) -&gt; Coroutine[Any, Any, T@_LRUCacheWrapper]) | ((...) -&gt; T@_LRUCacheWrapper)`
- Found 89 diagnostics
+ Found 90 diagnostics

pytest-robotframework (https://github.com/detachhead/pytest-robotframework)
+ pytest_robotframework/__init__.py:351:9: error[invalid-method-override] Invalid override of method `inner`: Definition is incompatible with `_KeywordDecorator.inner`
- Found 167 diagnostics
+ Found 168 diagnostics

async-utils (https://github.com/mikeshardmind/async-utils)
- src/async_utils/corofunc_cache.py:46:51: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:46:73: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:50:48: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:50:58: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `CoroFunc[Unknown]`
+ src/async_utils/corofunc_cache.py:50:58: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `CoroFunc[P@f__call__, R@f__call__]`
+ src/async_utils/corofunc_cache.py:148:12: error[invalid-return-type] Return type does not match returned value: expected `CoroCacheDeco`, found `def wrapper[**P, R](coro: CoroLike[P@wrapper, R@wrapper], /) -&gt; CoroFunc[P@wrapper, R@wrapper]`
+ src/async_utils/corofunc_cache.py:231:12: error[invalid-return-type] Return type does not match returned value: expected `CoroCacheDeco`, found `def wrapper[**P, R](coro: CoroLike[P@wrapper, R@wrapper], /) -&gt; CoroFunc[P@wrapper, R@wrapper]`
+ src/async_utils/gen_transform.py:110:36: error[invalid-argument-type] Argument to function `to_thread` is incorrect: Expected `Queue[Y@_consumer]`, found `Queue[Y@_sync_to_async_gen]`
+ src/async_utils/gen_transform.py:110:48: error[invalid-argument-type] Argument to function `to_thread` is incorrect: Expected `(**P@_consumer) -&gt; Generator[Y@_consumer, None, None]`, found `(**P@_sync_to_async_gen) -&gt; Generator[Y@_sync_to_async_gen, None, None]`
+ src/async_utils/gen_transform.py:110:60: error[invalid-argument-type] Argument to function `to_thread` is incorrect: Expected `P@_consumer.args`, found `P@_sync_to_async_gen.args`
+ src/async_utils/gen_transform.py:110:63: error[invalid-argument-type] Argument to function `to_thread` is incorrect: Expected `P@_consumer.kwargs`, found `P@_sync_to_async_gen.kwargs`
- src/async_utils/corofunc_cache.py:50:70: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:116:43: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:116:65: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:199:43: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/corofunc_cache.py:199:65: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/gen_transform.py:62:64: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/gen_transform.py:108:24: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:32:41: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:32:58: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:48:38: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:49:26: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:53:52: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:53:62: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `TaskFunc[Unknown]`
+ src/async_utils/task_cache.py:53:62: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `TaskFunc[P@f__call__, R@f__call__]`
+ src/async_utils/task_cache.py:213:12: error[invalid-return-type] Return type does not match returned value: expected `TaskCacheDeco`, found `def wrapper[**P, R](coro: TaskCoroFunc[P@wrapper, R@wrapper], /) -&gt; TaskFunc[P@wrapper, R@wrapper]`
+ src/async_utils/task_cache.py:301:12: error[invalid-return-type] Return type does not match returned value: expected `TaskCacheDeco`, found `def wrapper[**P, R](coro: TaskCoroFunc[P@wrapper, R@wrapper], /) -&gt; TaskFunc[P@wrapper, R@wrapper]`
- src/async_utils/task_cache.py:53:74: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:85:43: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:85:62: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:181:47: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:181:69: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:269:47: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- src/async_utils/task_cache.py:269:69: error[invalid-type-arguments] Too many type arguments: expected 1, got 2
- Found 29 diagnostics
+ Found 15 diagnostics

spack (https://github.com/spack/spack)
- lib/spack/spack/vendor/jinja2/async_utils.py:41:9: error[unresolved-attribute] Unresolved attribute `jinja_async_variant` on type `_Wrapped[Unknown, Unknown, Unknown, Unknown]`.
+ lib/spack/spack/vendor/jinja2/async_utils.py:41:9: error[unresolved-attribute] Unresolved attribute `jinja_async_variant` on type `_Wrapped[(...), Unknown, (...), Unknown]`.
- lib/spack/spack/vendor/jinja2/compiler.py:56:12: error[invalid-return-type] Return type does not match returned value: expected `F@optimizeconst`, found `_Wrapped[Unknown, Unknown, Unknown, Unknown]`
+ lib/spack/spack/vendor/jinja2/compiler.py:56:12: error[invalid-return-type] Return type does not match returned value: expected `F@optimizeconst`, found `_Wrapped[(...), Unknown, (...), Unknown]`

beartype (https://github.com/beartype/beartype)
- beartype/bite/kind/infercallable.py:562:9: error[invalid-type-form] The first argument to `Callable` must be either a list of types, ParamSpec, Concatenate, or `...`
+ beartype/bite/kind/infercallable.py:562:18: error[invalid-type-form] The first argument to `Callable` must be either a list of types, ParamSpec, Concatenate, or `...`
- beartype/claw/_package/clawpkgtrie.py:66:29: warning[unsupported-base] Unsupported class base with type `&lt;class 'dict[str, PackagesTrieBlacklist]'&gt; | &lt;class 'dict[str, Divergent]'&gt;`
- beartype/claw/_package/clawpkgtrie.py:247:29: warning[unsupported-base] Unsupported class base with type `&lt;class 'dict[str, PackagesTrieWhitelist]'&gt; | &lt;class 'dict[str, Divergent]'&gt;`
- Found 494 diagnostics
+ Found 492 diagnostics

asynq (https://github.com/quora/asynq)
- asynq/tests/test_debug.py:179:15: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `__name__`
+ asynq/tests/test_debug.py:179:15: error[unresolved-attribute] Object of type `AsyncDecorator[Any, ()]` has no attribute `__name__`
- asynq/tests/test_debug.py:181:9: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `__name__`
+ asynq/tests/test_debug.py:181:9: error[unresolved-attribute] Object of type `AsyncDecorator[Any, ()]` has no attribute `__name__`
- asynq/tests/test_mock.py:271:13: error[unresolved-attribute] Unresolved attribute `cant_set_attribute` on type `bound method AsyncDecorator[Any, Unknown].asynq(...) -&gt; AsyncTask[Any]`.
+ asynq/tests/test_mock.py:271:13: error[unresolved-attribute] Unresolved attribute `cant_set_attribute` on type `bound method AsyncDecorator[Any, ()].asynq(...) -&gt; AsyncTask[Any]`.
+ asynq/tests/test_tools.py:72:39: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@afilter]`, found `list[Unknown | None | int]`
+ asynq/tests/test_tools.py:74:34: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@afilter]`, found `list[Unknown | None | int]`
+ asynq/tests/test_tools.py:82:53: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@afilterfalse]`, found `list[Unknown | None | int]`
+ asynq/tests/test_tools.py:90:53: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@asift]`, found `list[Unknown | None | int]`
+ asynq/tests/test_tools.py:95:45: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amap]`, found `list[Unknown | None]`
+ asynq/tests/test_tools.py:96:44: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amap]`, found `list[Unknown | int]`
+ asynq/tests/test_tools.py:98:58: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amap]`, found `list[Unknown | None | str]`
+ asynq/tests/test_tools.py:103:31: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@asorted]`, found `list[Unknown | None]`
+ asynq/tests/test_tools.py:104:37: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@asorted]`, found `list[Unknown | bool | None]`
+ asynq/tests/test_tools.py:105:31: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@asorted]`, found `list[Unknown | int]`
+ asynq/tests/test_tools.py:109:23: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `Literal[1]`
+ asynq/tests/test_tools.py:109:26: error[too-many-positional-arguments] Too many positional arguments to bound method `__call__`: expected 2, got 3
+ asynq/tests/test_tools.py:110:23: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `list[Unknown | int | None]`
+ asynq/tests/test_tools.py:111:23: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `GeneratorType[Literal[1] | None, None, None]`
+ asynq/tests/test_tools.py:112:31: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `list[Unknown | int]`
+ asynq/tests/test_tools.py:112:36: error[too-many-positional-arguments] Too many positional arguments to bound method `__call__`: expected 2, got 4
+ asynq/tests/test_tools.py:113:31: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `list[Unknown | list[Unknown | int]]`
+ asynq/tests/test_tools.py:115:23: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `Literal[1]`
+ asynq/tests/test_tools.py:115:26: error[too-many-positional-arguments] Too many positional arguments to bound method `__call__`: expected 2, got 5
+ asynq/tests/test_tools.py:118:9: error[missing-argument] No argument provided for required parameter `arg` of bound method `__call__`
+ asynq/tests/test_tools.py:122:33: error[unknown-argument] Argument `random_keyword_argument` does not match any known parameter of bound method `__call__`
+ asynq/tests/test_tools.py:126:26: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amin]`, found `Literal[1]`
+ asynq/tests/test_tools.py:126:35: error[parameter-already-assigned] Multiple values provided for parameter `key` of bound method `__call__`
+ asynq/tests/test_tools.py:127:26: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amin]`, found `list[Unknown | int | None]`
+ asynq/tests/test_tools.py:128:26: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amin]`, found `GeneratorType[Literal[1] | None, None, None]`
+ asynq/tests/test_tools.py:129:25: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amin]`, found `list[Unknown | int]`
+ asynq/tests/test_tools.py:129:30: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `((_T@amin, /) -&gt; Any) | None`, found `list[Unknown | int]`
+ asynq/tests/test_tools.py:129:41: error[too-many-positional-arguments] Too many positional arguments to bound method `__call__`: expected 3, got 4
+ asynq/tests/test_tools.py:129:49: error[parameter-already-assigned] Multiple values provided for parameter `key` of bound method `__call__`
+ asynq/tests/test_tools.py:130:25: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amin]`, found `list[Unknown | list[Unknown | int]]`
+ asynq/tests/test_tools.py:132:23: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amin]`, found `Literal[1]`
+ asynq/tests/test_tools.py:132:26: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `((_T@amin, /) -&gt; Any) | None`, found `Literal[2]`
+ asynq/tests/test_tools.py:132:29: error[too-many-positional-arguments] Too many positional arguments to bound method `__call__`: expected 3, got 5
+ asynq/tests/test_tools.py:135:9: error[missing-argument] No argument provided for required parameter `__arg` of bound method `__call__`
+ asynq/tests/test_tools.py:139:33: error[unknown-argument] Argument `random_keyword_argument` does not match any known parameter of bound method `__call__`
- asynq/tests/test_tools.py:440:5: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `dirty`
+ asynq/tests/test_tools.py:440:5: error[unresolved-attribute] Object of type `AsyncDecorator[Any, ()]` has no attribute `dirty`
- asynq/tests/test_tools.py:450:5: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `dirty`
+ asynq/tests/test_tools.py:450:5: error[unresolved-attribute] Object of type `AsyncDecorator[Any, ()]` has no attribute `dirty`
+ asynq/tests/test_typing.py:41:43: error[invalid-argument-type] Argument to bound method `asyncio` is incorrect: Expected `_T@generic`, found `str`
- asynq/tests/test_typing.py:44:40: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- asynq/tests/test_typing.py:45:36: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- asynq/tests/test_typing.py:46:38: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ asynq/tests/test_typing.py:54:16: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `((...) -&gt; _T@async_call) | ((...) -&gt; FutureBase[_T@async_call])`, found `def f(x: int) -&gt; str`
+ asynq/tests/test_typing.py:56:20: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `((...) -&gt; _T@async_call) | ((...) -&gt; FutureBase[_T@async_call])`, found `def f(x: int) -&gt; str`
+ asynq/tests/test_typing.py:61:26: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `Literal[1]`
+ asynq/tests/test_typing.py:61:29: error[too-many-positional-arguments] Too many positional arguments to bound method `__call__`: expected 2, got 3
+ asynq/tests/test_typing.py:61:32: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `((_T@amax, /) -&gt; Any) | None`, found `def len(obj: Sized, /) -&gt; int`
+ asynq/tests/test_typing.py:62:26: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `Iterable[_T@amax]`, found `list[Unknown | int]`
+ asynq/tests/test_typing.py:62:34: error[invalid-argument-type] Argument to bound method `__call__` is incorrect: Expected `((_T@amax, /) -&gt; Any) | None`, found `def len(obj: Sized, /) -&gt; int`
+ asynq/tests/typing_example/param_spec.py:15:21: error[invalid-argument-type] Argument to bound method `asyncio` is incorrect: Expected `int`, found `Literal[&quot;1&quot;]`
+ asynq/tests/typing_example/param_spec.py:15:31: error[invalid-argument-type] Argument to bound method `asyncio` is incorrect: Expected `str`, found `Literal[2]`
- asynq/tools.py:206:9: error[unresolved-attribute] Unresolved attribute `__acached_per_instance_cache__` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:206:9: error[unresolved-attribute] Unresolved attribute `__acached_per_instance_cache__` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:268:17: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `alazy_constant_refresh_time`
+ asynq/tools.py:268:17: error[unresolved-attribute] Object of type `AsyncDecorator[Any, (...)]` has no attribute `alazy_constant_refresh_time`
- asynq/tools.py:269:33: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `alazy_constant_refresh_time`
+ asynq/tools.py:269:33: error[unresolved-attribute] Object of type `AsyncDecorator[Any, (...)]` has no attribute `alazy_constant_refresh_time`
- asynq/tools.py:271:17: error[unresolved-attribute] Unresolved attribute `alazy_constant_cached_value` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:271:17: error[unresolved-attribute] Unresolved attribute `alazy_constant_cached_value` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:272:17: error[unresolved-attribute] Unresolved attribute `alazy_constant_refresh_time` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:272:17: error[unresolved-attribute] Unresolved attribute `alazy_constant_refresh_time` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:273:20: error[unresolved-attribute] Object of type `AsyncDecorator[Any, Unknown]` has no attribute `alazy_constant_cached_value`
+ asynq/tools.py:273:20: error[unresolved-attribute] Object of type `AsyncDecorator[Any, (...)]` has no attribute `alazy_constant_cached_value`
- asynq/tools.py:276:13: error[unresolved-attribute] Unresolved attribute `alazy_constant_refresh_time` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:276:13: error[unresolved-attribute] Unresolved attribute `alazy_constant_refresh_time` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:278:9: error[unresolved-attribute] Unresolved attribute `dirty` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:278:9: error[unresolved-attribute] Unresolved attribute `dirty` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:279:9: error[unresolved-attribute] Unresolved attribute `alazy_constant_refresh_time` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:279:9: error[unresolved-attribute] Unresolved attribute `alazy_constant_refresh_time` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:280:9: error[unresolved-attribute] Unresolved attribute `alazy_constant_cached_value` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:280:9: error[unresolved-attribute] Unresolved attribute `alazy_constant_cached_value` on type `AsyncDecorator[Any, (...)]`.
- asynq/tools.py:310:9: error[unresolved-attribute] Unresolved attribute `original_fn` on type `AsyncDecorator[Any, Unknown]`.
+ asynq/tools.py:310:9: error[unresolved-attribute] Unresolved attribute `original_fn` on type `AsyncDecorator[Any, (...)]`.
- Found 176 diagnostics
+ Found 218 diagnostics

graphql-core (https://github.com/graphql-python/graphql-core)
- src/graphql/execution/execute.py:216:59: error[invalid-assignment] Object of type `staticmethod[Unknown, Unknown]` is not assignable to `(Any, /) -&gt; Unknown`
+ src/graphql/execution/execute.py:216:59: error[invalid-assignment] Object of type `staticmethod[(value: Any), Unknown]` is not assignable to `(Any, /) -&gt; Unknown`

pytest (https://github.com/pytest-dev/pytest)
- src/_pytest/_py/error.py:111:26: error[unresolved-attribute] Object of type `(...) -&gt; R@checked_call` has no attribute `__name__`
+ src/_pytest/_py/error.py:111:26: error[unresolved-attribute] Object of type `(**P@checked_call) -&gt; R@checked_call` has no attribute `__name__`
+ src/_pytest/_py/path.py:760:17: error[invalid-argument-type] Argument to bound method `checked_call` is incorrect: Expected `Overload[(file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;r+&quot;, &quot;+r&quot;, &quot;rt+&quot;, &quot;r+t&quot;, &quot;+rt&quot;, ... omitted 48 literals] = Literal[&quot;r&quot;], buffering: int = Literal[-1], encoding: str | None = None, errors: str | None = None, newline: str | None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb+&quot;, &quot;r+b&quot;, &quot;+rb&quot;, &quot;br+&quot;, &quot;b+r&quot;, ... omitted 33 literals], buffering: Literal[0], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb+&quot;, &quot;r+b&quot;, &quot;+rb&quot;, &quot;br+&quot;, &quot;b+r&quot;, ... omitted 19 literals], buffering: Literal[-1, 1] = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;wb&quot;, &quot;bw&quot;, &quot;ab&quot;, &quot;ba&quot;, &quot;xb&quot;, &quot;bx&quot;], buffering: Literal[-1, 1] = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb&quot;, &quot;br&quot;, &quot;rbU&quot;, &quot;rUb&quot;, &quot;Urb&quot;, ... omitted 3 literals], buffering: Literal[-1, 1] = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb+&quot;, &quot;r+b&quot;, &quot;+rb&quot;, &quot;br+&quot;, &quot;b+r&quot;, ... omitted 33 literals], buffering: int = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: str, buffering: int = Literal[-1], encoding: str | None = None, errors: str | None = None, newline: str | None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown]`, found `Unknown | Literal[&quot;r&quot;]`
+ src/_pytest/_py/path.py:763:55: error[invalid-argument-type] Argument to bound method `checked_call` is incorrect: Expected `Overload[(file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;r+&quot;, &quot;+r&quot;, &quot;rt+&quot;, &quot;r+t&quot;, &quot;+rt&quot;, ... omitted 48 literals] = Literal[&quot;r&quot;], buffering: int = Literal[-1], encoding: str | None = None, errors: str | None = None, newline: str | None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb+&quot;, &quot;r+b&quot;, &quot;+rb&quot;, &quot;br+&quot;, &quot;b+r&quot;, ... omitted 33 literals], buffering: Literal[0], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb+&quot;, &quot;r+b&quot;, &quot;+rb&quot;, &quot;br+&quot;, &quot;b+r&quot;, ... omitted 19 literals], buffering: Literal[-1, 1] = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;wb&quot;, &quot;bw&quot;, &quot;ab&quot;, &quot;ba&quot;, &quot;xb&quot;, &quot;bx&quot;], buffering: Literal[-1, 1] = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb&quot;, &quot;br&quot;, &quot;rbU&quot;, &quot;rUb&quot;, &quot;Urb&quot;, ... omitted 3 literals], buffering: Literal[-1, 1] = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: Literal[&quot;rb+&quot;, &quot;r+b&quot;, &quot;+rb&quot;, &quot;br+&quot;, &quot;b+r&quot;, ... omitted 33 literals], buffering: int = Literal[-1], encoding: None = None, errors: None = None, newline: None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown, (file: int | str | bytes | PathLike[str] | PathLike[bytes], mode: str, buffering: int = Literal[-1], encoding: str | None = None, errors: str | None = None, newline: str | None = None, closefd: bool = Literal[True], opener: ((str, int, /) -&gt; int) | None = None) -&gt; Unknown]`, found `Unknown | Literal[&quot;r&quot;]`
+ src/_pytest/_py/path.py:1271:53: error[invalid-argument-type] Argument to bound method `checked_call` is incorrect: Expected `Overload[(suffix: str | None = None, prefix: str | None = None, dir: str | PathLike[str] | None = None) -&gt; Unknown, (suffix: bytes | None = None, prefix: bytes | None = None, dir: bytes | PathLike[bytes] | None = None) -&gt; Unknown]`, found `str`
+ src/_pytest/unittest.py:583:14: error[missing-argument] No argument provided for required parameter `cls`
+ src/_pytest/unittest.py:583:14: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_config.py:1426:14: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_config.py:1426:14: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_config.py:1748:10: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_config.py:1748:10: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_faulthandler.py:216:10: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_faulthandler.py:216:10: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_monkeypatch.py:426:10: error[missing-argument] No argument provided for required parameter `cls`
+ testing/test_monkeypatch.py:426:10: error[missing-argument] No argument provided for required parameter `cls`
- Found 433 diagnostics
+ Found 446 diagnostics

rich (https://github.com/Textualize/rich)
- examples/table_movie.py:62:1: error[invalid-argument-type] Argument to function `contextmanager` is incorrect: Expected `(...) -&gt; Iterator[Unknown]`, found `def beat(length: int = Literal[1]) -&gt; None`
+ examples/table_movie.py:62:1: error[invalid-argument-type] Argument to function `contextmanager` is incorrect: Expected `(length: int = Literal[1]) -&gt; Iterator[Unknown]`, found `def beat(length: int = Literal[1]) -&gt; None`

scrapy (https://github.com/scrapy/scrapy)
- scrapy/utils/decorators.py:31:54: error[unresolved-attribute] Object of type `(...) -&gt; _T@deprecated` has no attribute `__name__`
+ scrapy/utils/decorators.py:31:54: error[unresolved-attribute] Object of type `(**_P@deprecated) -&gt; _T@deprecated` has no attribute `__name__`
- scrapy/utils/decorators.py:98:51: error[unresolved-attribute] Object of type `(...) -&gt; _T@_warn_spider_arg` has no attribute `__qualname__`
+ scrapy/utils/decorators.py:98:51: error[unresolved-attribute] Object of type `(**_P@_warn_spider_arg) -&gt; _T@_warn_spider_arg` has no attribute `__qualname__`

starlette (https://github.com/encode/starlette)
- starlette/applications.py:86:25: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ServerErrorMiddleware'&gt;`
+ starlette/applications.py:86:25: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ServerErrorMiddleware'&gt;`
- starlette/applications.py:88:27: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ExceptionMiddleware'&gt;`
+ starlette/applications.py:88:27: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ExceptionMiddleware'&gt;`
- starlette/applications.py:241:33: error[invalid-argument-type] Argument to bound method `add_middleware` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ starlette/applications.py:241:33: error[invalid-argument-type] Argument to bound method `add_middleware` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:84:28: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CustomMiddleware'&gt;`
+ tests/middleware/test_base.py:84:28: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CustomMiddleware'&gt;`
- tests/middleware/test_base.py:152:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'aMiddleware'&gt;`
+ tests/middleware/test_base.py:152:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'aMiddleware'&gt;`
- tests/middleware/test_base.py:153:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'bMiddleware'&gt;`
+ tests/middleware/test_base.py:153:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'bMiddleware'&gt;`
- tests/middleware/test_base.py:154:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'cMiddleware'&gt;`
+ tests/middleware/test_base.py:154:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'cMiddleware'&gt;`
- tests/middleware/test_base.py:169:75: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CustomMiddleware'&gt;`
+ tests/middleware/test_base.py:169:75: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CustomMiddleware'&gt;`
- tests/middleware/test_base.py:187:44: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CustomMiddleware'&gt;`
+ tests/middleware/test_base.py:187:44: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CustomMiddleware'&gt;`
- tests/middleware/test_base.py:277:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ tests/middleware/test_base.py:277:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:315:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ tests/middleware/test_base.py:315:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:335:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ tests/middleware/test_base.py:335:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:362:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ tests/middleware/test_base.py:362:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:433:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ tests/middleware/test_base.py:433:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:434:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ContextManagerMiddleware'&gt;`
+ tests/middleware/test_base.py:434:24: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ContextManagerMiddleware'&gt;`
- tests/middleware/test_base.py:609:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:609:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:638:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:638:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:667:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:667:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:693:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:693:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:725:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:725:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:754:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:754:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:843:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:843:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:871:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'ConsumingMiddleware'&gt;`
+ tests/middleware/test_base.py:871:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'ConsumingMiddleware'&gt;`
- tests/middleware/test_base.py:1086:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'MyMiddleware'&gt;`
+ tests/middleware/test_base.py:1086:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'MyMiddleware'&gt;`
- tests/middleware/test_base.py:1220:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
+ tests/middleware/test_base.py:1220:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'BaseHTTPMiddleware'&gt;`
- tests/middleware/test_base.py:1278:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'PassthroughMiddleware'&gt;`
+ tests/middleware/test_base.py:1278:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'PassthroughMiddleware'&gt;`
- tests/middleware/test_cors.py:20:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:20:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:81:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:81:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:132:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:132:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:181:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:181:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:222:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:222:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:255:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:255:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:285:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:285:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:310:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:310:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:382:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:382:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:415:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:415:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:436:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:436:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:456:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:456:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:473:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:473:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:492:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:492:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:513:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:513:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:543:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:543:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_cors.py:583:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CORSMiddleware'&gt;`
+ tests/middleware/test_cors.py:583:17: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CORSMiddleware'&gt;`
- tests/middleware/test_gzip.py:23:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:23:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:41:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:41:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:61:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:61:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:84:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:84:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:107:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:107:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:132:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:132:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:155:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:155:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_gzip.py:180:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'GZipMiddleware'&gt;`
+ tests/middleware/test_gzip.py:180:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'GZipMiddleware'&gt;`
- tests/middleware/test_https_redirect.py:16:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'HTTPSRedirectMiddleware'&gt;`
+ tests/middleware/test_https_redirect.py:16:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'HTTPSRedirectMiddleware'&gt;`
- tests/middleware/test_middleware.py:16:29: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CustomMiddleware'&gt;`
+ tests/middleware/test_middleware.py:16:29: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CustomMiddleware'&gt;`
- tests/middleware/test_middleware.py:21:36: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'CustomMiddleware'&gt;`
+ tests/middleware/test_middleware.py:21:36: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'CustomMiddleware'&gt;`
- tests/middleware/test_session.py:35:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[Unknown]`, found `&lt;class 'SessionMiddleware'&gt;`
+ tests/middleware/test_session.py:35:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `_MiddlewareFactory[(...)]`, found `&lt;class 'SessionMiddleware'&gt;`
- tests/middleware/test_session.py:67:32: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: E

... (truncated 1638 lines) ...
</code></pre>
</details>

<details>
<summary>Memory usage changes were detected when running on open source projects</summary>

<pre><code class="language-diff">flake8 (https://github.com/pycqa/flake8)
-     struct fields = ~3MB
+     struct fields = ~4MB

prefect (https://github.com/PrefectHQ/prefect)
-     struct fields = ~52MB
+     struct fields = ~54MB


</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-11-20 06:43</div>
            <div class="timeline-body"><p>There's a stack overflow in <code>mypy_primer</code> repository which I'm trying to figure out why it's happening on this branch, I've narrowed it down to the following code:</p>
<pre><code class="language-py">from dataclasses import field

field(default_factory=dict)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-11-20 07:10</div>
            <div class="timeline-body"><p>Hmm, not really sure where is the stack overflow being triggered, a more minimal code that behaves the same way as above but without the <code>dataclasses</code> import:</p>
<pre><code class="language-py">from typing import Callable


def f[_T](*, default_factory: Callable[[], _T]) -&gt; _T:
    return default_factory()


f(default_factory=dict)
</code></pre>
<p>It's important that the <code>default_factory</code> is <code>dict</code> and not any other type like <code>list</code>, <code>int</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-11-20 07:20</div>
            <div class="timeline-body"><p>Nevermind, found the issue, it's a silly mistake on my end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-02 06:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/decorators.md</code>:131 on 2025-12-02 06:21</div>
            <div class="timeline-body"><p>I'm looking into this, a minimal repro:</p>
<pre><code class="language-py">from typing import Callable


class _Wrapped[**P, R]:
    def __call__(self, *args: P.args, **kwargs: P.kwargs) -&gt; R: ...


def update_wrapper[**P, R](wrapper: Callable[P, R]) -&gt; _Wrapped[P, R]: ...


def wrapper(*args, **kwargs): ...


# bound method _Wrapped[(...), Unknown].__call__(**P@_Wrapped) -&gt; Unknown
#
# This should actually reveal `(...) -&gt; Unknown`
reveal_type(update_wrapper(wrapper).__call__)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-12-02 09:49</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/dhruv%2Fparamspec-args-kwargs?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a></h2>
<h3>Merging #21445 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>dhruv/paramspec-args-kwargs</code> (e5a4f59) with <code>main</code> (f29436c)</sub></p>
<h3>Summary</h3>
<p><code> 22</code> untouched<br />
<code> 30</code> skipped[^skipped]</p>
<p>[^skipped]: 30 benchmarks were skipped, so the baseline results were used instead. If they were deleted from the codebase, <a href="https://codspeed.io/astral-sh/ruff/branches/dhruv%2Fparamspec-args-kwargs?sectionId=benchmark-comparison-section-baseline-result-skipped&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=archive">click here and archive them to remove them from the performance reports</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-02 13:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/decorators.md</code>:131 on 2025-12-02 13:16</div>
            <div class="timeline-body"><p>Oh man, this was hard to track! I was not passing around the ParamSpec type variable correctly in all places. Fixed this in <a href="https://github.com/astral-sh/ruff/pull/21445/commits/b358231686abed80e64c6c85dd68433a9a3f0693"><code>b358231</code> (#21445)</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @dhruvmanila on 2025-12-03 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-03 12:32</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 209 | 0 | 96 |
| <code>invalid-type-arguments</code> | 5 | 151 | 0 |
| <code>no-matching-overload</code> | 147 | 0 | 0 |
| <code>unresolved-attribute</code> | 0 | 4 | 114 |
| <code>missing-argument</code> | 104 | 0 | 0 |
| <code>unused-ignore-comment</code> | 1 | 79 | 0 |
| <code>invalid-type-form</code> | 0 | 45 | 1 |
| <code>unknown-argument</code> | 43 | 2 | 0 |
| <code>invalid-assignment</code> | 7 | 0 | 21 |
| <code>invalid-return-type</code> | 1 | 3 | 10 |
| <code>too-many-positional-arguments</code> | 10 | 0 | 0 |
| <code>possibly-missing-attribute</code> | 0 | 0 | 7 |
| <code>invalid-method-override</code> | 4 | 0 | 0 |
| <code>invalid-parameter-default</code> | 0 | 0 | 3 |
| <code>parameter-already-assigned</code> | 2 | 0 | 0 |
| <code>unsupported-base</code> | 1 | 1 | 0 |
| <code>invalid-await</code> | 0 | 0 | 1 |
| <code>redundant-cast</code> | 0 | 1 | 0 |
| <code>unsupported-operator</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>535</strong> | <strong>286</strong> | <strong>253</strong> |</p>
<p><strong><a href="https://dhruv-paramspec-args-kwargs.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://dhruv-paramspec-args-kwargs.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @dhruvmanila on 2025-12-03 17:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @dhruvmanila on 2025-12-03 17:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Add support for `P.args` and `P.kwargs`" to "[ty] Complete support for `ParamSpec`" by @dhruvmanila on 2025-12-03 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dhruvmanila on 2025-12-03 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @dhruvmanila on 2025-12-03 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @dhruvmanila on 2025-12-03 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @dhruvmanila on 2025-12-03 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @dhruvmanila on 2025-12-03 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2025-12-03 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/hover.rs</code>:2295 on 2025-12-04 16:36</div>
            <div class="timeline-body"><p>shouldn't this be contravariant? Is that worth a TODO comment?</p>
<p>E.g. when we hover over <code>T</code> here, we display it as being contravariant:</p>
<pre><code class="language-py">from typing import Callable
type X[T] = Callable[[T], int]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/unsupported_special_forms.md</code>:68 on 2025-12-04 16:40</div>
            <div class="timeline-body"><p>ideally I think we'd emit a diagnostic here -- an arbitrary instance of <code>ParamSpec</code> should not be valid in a type expression. (You could add a TODO comment for now.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:121 on 2025-12-04 16:41</div>
            <div class="timeline-body"><p>or as a type parameter to <code>Protocol</code>/<code>Generic</code>. Maybe:</p>
<pre><code class="language-suggestion">In type annotations, `ParamSpec` is only valid as the first element to `Callable` or the final element to `Concatenate`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:188 on 2025-12-04 16:44</div>
            <div class="timeline-body"><p>it could be worth having one test where the variadic parameters have different names, just to demonstrate that it's the <em>kind</em> of the parameter that matters rather than the name. E.g. this is fine:</p>
<pre><code class="language-py">class Foo(Generic[P]):
    def __call__(self, *arguments: P.args, **keyword_arguments: P.kwargs) -&gt; None: ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:248 on 2025-12-04 16:50</div>
            <div class="timeline-body"><p>is this not one of the things we should emit an <code>[invalid-type-arguments]</code> diagnostic on? <code>Any</code> is not a ParamSpec, <code>...</code> or a list of types</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:257 on 2025-12-04 16:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">Nor can they be omitted when there are more than one `ParamSpec`s.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:373 on 2025-12-04 16:55</div>
            <div class="timeline-body"><p>it could also be worth adding a test where a class is generic over <code>PAnother</code> but <em>not</em> generic over <code>P</code>. I think that should cause us to omit a diagnostic, since <code>PAnother</code> would have <code>P</code> as its default, but <code>P</code> wouldn't be in scope?</p>
<p>(It's obviously fine to just add a TODO to that test if it's not implemented yet)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:181 on 2025-12-04 17:02</div>
            <div class="timeline-body"><p>I don't think this TODO is accurate, because <code>None</code> is a subtype of <code>object</code>: <code>object | None</code> just immediately simplifies to <code>object</code>. The existing assertion is correct!</p>
<pre><code class="language-suggestion">    reveal_type(kwargs.get(&quot;key&quot;))  # revealed: object
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:235 on 2025-12-04 17:03</div>
            <div class="timeline-body"><p>same as in the legacy markdown test, I think this is something we should emit an error on -- <code>Any</code> is not a list of types, a ParamSpec or <code>...</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:280 on 2025-12-04 17:04</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># `P1` hasn't been specialized, so it defaults to `...` gradual form
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:469 on 2025-12-04 17:09</div>
            <div class="timeline-body"><p>you could possibly also add an example of keyword-arguments with default values. E.g.</p>
<pre><code class="language-py">def keyword_only_with_default_1(*, x: int = 42) -&gt; int:
    return 1

def keyword_only_with_default_2(*, y: int = 42) -&gt; int:
    return 2
</code></pre>
<p>In this case, the behavioural supertype of the parameter sets is <code>()</code>, since both <code>keyword_only_with_default_1</code> and <code>keyword_only_with_default_2</code> can be called with 0 arguments passed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:511 on 2025-12-04 17:13</div>
            <div class="timeline-body"><p>and also add a call to <code>foo1_with_extra_arg</code> that <em>doesn't</em> cause us to emit a diagnostic?</p>
<pre><code class="language-suggestion">    # error: [invalid-argument-type] &quot;Argument to function `foo1_with_extra_arg` is incorrect: Expected `str`, found `P2@foo2.args`&quot;
    foo1_with_extra_arg(func, *args, **kwargs)
    
    foo1_with_extra_arg(func, &quot;foooooo&quot;, *args, **kwargs)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:566 on 2025-12-04 17:17</div>
            <div class="timeline-body"><p>I think the &quot;union with <code>Unknown</code>&quot; thing is making this test a bit more confusing than it needs to be? Could you just explicitly annotate the instance attributes, so that they aren't unioned with <code>Unknown</code>?</p>
<pre><code class="language-suggestion">```py
class Foo[**P]:
    def __init__(self, *args: P.args, **kwargs: P.kwargs) -&gt; None:
        self.args: P.args = args
        self.kwargs: P.kwargs = kwargs

def bar[**P](foo: Foo[P]) -&gt; None:
    reveal_type(foo)  # revealed: Foo[P@bar]
    reveal_type(foo.args)  # revealed: P@bar.args
    reveal_type(foo.kwargs)  # revealed: P@bar.kwargs
```

ty will check whether the argument after `**` is a mapping type:

```py
from typing import Callable

def baz[**P](fn: Callable[P, None], foo: Foo[P]) -&gt; None:
    fn(*foo.args, **foo.kwargs)
    fn(*foo.kwargs, **foo.args)  # error
```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/with/async.md</code>:216 on 2025-12-04 17:19</div>
            <div class="timeline-body"><p>I guess we're nearly there on this TODO now </p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-04 17:19</div>
            <div class="timeline-body"><p>Just a review of the tests so far, which are overall fantastic. So excited to see how powerful this makes some of our type inference!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:4997 on 2025-12-04 17:47</div>
            <div class="timeline-body"><p>nit: I think you can do this without the <code>unreachable!()</code> call:</p>
<pre><code class="language-diff">diff --git a/crates/ty_python_semantic/src/types.rs b/crates/ty_python_semantic/src/types.rs
index c2d26b1124..a4871e093f 100644
--- a/crates/ty_python_semantic/src/types.rs
+++ b/crates/ty_python_semantic/src/types.rs
@@ -4985,14 +4985,17 @@ impl&lt;'db&gt; Type&lt;'db&gt; {
                     .into()
             }
 
-            Type::TypeVar(typevar)
-                if typevar.is_paramspec(db) &amp;&amp; matches!(name_str, &quot;args&quot; | &quot;kwargs&quot;) =&gt;
-            {
-                Place::declared(Type::TypeVar(match name_str {
-                    &quot;args&quot; =&gt; typevar.with_paramspec_attr(db, ParamSpecAttrKind::Args),
-                    &quot;kwargs&quot; =&gt; typevar.with_paramspec_attr(db, ParamSpecAttrKind::Kwargs),
-                    _ =&gt; unreachable!(),
-                }))
+            Type::TypeVar(typevar) if name_str == &quot;args&quot; &amp;&amp; typevar.is_paramspec(db) =&gt; {
+                Place::declared(Type::TypeVar(
+                    typevar.with_paramspec_attr(db, ParamSpecAttrKind::Args),
+                ))
+                .into()
+            }
+
+            Type::TypeVar(typevar) if name_str == &quot;kwargs&quot; &amp;&amp; typevar.is_paramspec(db) =&gt; {
+                Place::declared(Type::TypeVar(
+                    typevar.with_paramspec_attr(db, ParamSpecAttrKind::Kwargs),
+                ))
                 .into()
             }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8609 on 2025-12-04 17:52</div>
            <div class="timeline-body"><p>This TODO comment looks a bit orphaned -- what's it meant to refer to?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9718 on 2025-12-04 17:56</div>
            <div class="timeline-body"><p>I think it would be better here to do an exhaustive match over <code>DynamicType</code> variants, because we have 3 <code>Todo</code> variants currently and we might add or remove some in the future:</p>
<pre><code class="language-suggestion">                Type::Dynamic(dynamic) =&gt; match dynamic {
                    DynamicType::Todo(_) | DynamicType::TodoUnpack | DynamicType::TodoStarredExpression =&gt; Parameters::todo(),
                    DynamicType::Any | DynamicType::Unknown | DynamicType::Divergent(_) | DynamicType::UnknownDivergent(_) =&gt; Parameters::unknown(),
                }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9751 on 2025-12-04 18:02</div>
            <div class="timeline-body"><p>(optional nit)</p>
<pre><code class="language-suggestion">                if known_class == Some(KnownClass::ParamSpec) {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9920 on 2025-12-04 18:06</div>
            <div class="timeline-body"><p>for most other Salsa-interned types, we have this note about ordering:</p>
<pre><code class="language-suggestion">/// A type variable that has been bound to a generic context, and which can be specialized to a
/// concrete type.
///
/// # Ordering
///
/// Ordering is based on the wrapped data's salsa-assigned id and not on its values.
/// The id may change between runs, or when e.g. a `BoundTypeVarInstance` was garbage-collected and recreated.
#[salsa::interned(debug, heap_size=ruff_memory_usage::heap_size)]
#[derive(PartialOrd, Ord)]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9909 on 2025-12-04 18:09</div>
            <div class="timeline-body"><p>nit: add some docs?</p>
<pre><code class="language-suggestion">    /// If `Some()`, this indicates that this type variable is the `.args` or `.kwargs`
    /// attribute of a `ParamSpec`
    paramspec_attr: Option&lt;ParamSpecAttrKind&gt;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9926 on 2025-12-04 18:10</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// If `Some()`, this indicates that this type variable is the `.args` or `.kwargs`
    /// attribute of a `ParamSpec`
    paramspec_attr: Option&lt;ParamSpecAttrKind&gt;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9927 on 2025-12-04 18:12</div>
            <div class="timeline-body"><p>nit: could improve the error message here if this assertion fails</p>
<pre><code class="language-suggestion">        debug_assert!(
            self.is_paramspec(db),
            &quot;Expected a paramspec but got a {:?}&quot;,
            self.kind(db)
        );
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9955 on 2025-12-04 18:12</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        debug_assert!(
            self.is_paramspec(db),
            &quot;Expected a paramspec but got a {:?}&quot;,
            self.kind(db)
        );
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9941 on 2025-12-04 18:13</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            None, // `P.args` and `P.kwargs` cannot have defaults, even though `P` can
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9964 on 2025-12-04 18:13</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            None, // `P.args` and `P.kwargs` cannot have defaults, even though `P` can
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9940 on 2025-12-04 18:14</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            None, // ParamSpecs cannot have explicit variance
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9963 on 2025-12-04 18:14</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                None, // ParamSpecs cannot have explicit variance
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2582 on 2025-12-04 18:25</div>
            <div class="timeline-body"><p>it will only be <code>Unknown | P.args</code> if the instance attribute was unannotated, as I mentioned in https://github.com/astral-sh/ruff/pull/21445#discussion_r2589923699</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:3169 on 2025-12-04 18:38</div>
            <div class="timeline-body"><p>(optional nit)</p>
<pre><code class="language-suggestion">        if callable.kind(self.db) != CallableTypeKind::ParamSpecValue {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/display.rs</code>:1705 on 2025-12-04 18:42</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                write!(f, &quot;**{}&quot;, typevar.name(self.db))?;
                if let Some(name) = typevar.binding_context(self.db).name(self.db) {
                    write!(f, &quot;@{name}&quot;)?;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:1410 on 2025-12-04 18:43</div>
            <div class="timeline-body"><p>what's &quot;this&quot;, in this context?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:2639 on 2025-12-04 18:47</div>
            <div class="timeline-body"><p>I think what you have currently here is correct. We do know for a fact that <code>*args</code> will <em>always</em> be a tuple of some kind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:2646 on 2025-12-04 18:47</div>
            <div class="timeline-body"><p>same here, I think <code>tuple[Unknown, ...]</code> (what you currently have) is the best answer here!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:2766 on 2025-12-04 18:48</div>
            <div class="timeline-body"><p>and here, <code>dict[str, Unknown]</code> seems like the right answer to me; I'd just remove the TODO</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:2782 on 2025-12-04 18:48</div>
            <div class="timeline-body"><p>same here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3430 on 2025-12-04 18:49</div>
            <div class="timeline-body"><p>does it <em>have</em> to use <code>infer_type_expression</code>? We only get here in very specific situations; what you have here seems fine to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3485 on 2025-12-04 18:49</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                // This should be taken care of by the caller.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3491 on 2025-12-04 18:50</div>
            <div class="timeline-body"><p>nit: this assertion is probably very cheap; you could make this a non-debug assertion</p>
<pre><code class="language-suggestion">                    assert!(
                        exactly_one_paramspec,
                        &quot;Inferring ParamSpec value during explicit specialization for a \
                    tuple expression should only happen when it contains exactly one ParamSpec&quot;
                    );
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3541 on 2025-12-04 18:51</div>
            <div class="timeline-body"><p>nit</p>
<pre><code class="language-suggestion">                        // TODO: Emit diagnostic: &quot;ParamSpec &quot;P&quot; is unbound&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-12-04 18:56</div>
            <div class="timeline-body"><p>This looks fantastic!!</p>
<p>I'd appreciate it if @dcreager or @carljm could also take a look, as I don't consider myself an expert on our call-binding machinery or our generics machinery</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_ide/src/hover.rs</code>:1 on 2025-12-04 21:07</div>
            <div class="timeline-body"><p>These edits are probably what's causing the <code>cargo fmt</code> CI failure. You'll need to revert the whitespace edits and only keep the &quot;meaty&quot; change below in the diff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/with/async.md</code>:216 on 2025-12-04 21:09</div>
            <div class="timeline-body"><p>So close! I think #21551 is the rest of it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:322 on 2025-12-04 21:14</div>
            <div class="timeline-body"><p>To clarify  as written, this function returns whether the generic context contains exactly 1 <code>ParamSpec</code> and exactly 0 other <code>TypeVar</code>s. The comment suggests you might instead have intended to return whether it contains 1 <code>ParamSpec</code> and <em>0 or more</em> <code>TypeVar</code>s. If you meant the former I'd suggest rewording the docs:</p>
<pre><code class="language-suggestion">    /// Returns `true` if this generic context contains exactly one `ParamSpec`
    /// and no other type variables.
</code></pre>
<p>If you meant the latter then the method body is wrong.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/signatures.rs</code>:204 on 2025-12-04 21:21</div>
            <div class="timeline-body"><p>We'll need this logic for <code>TypeMapping::PartialSpecialization</code> too. It might be worth pulling much of the body out into a helper method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-12-04 21:24</div>
            <div class="timeline-body"><p>Some initial thoughts, still need to look through <code>call/bind.rs</code> in more detail</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:3131 on 2025-12-04 22:51</div>
            <div class="timeline-body"><p>For these helper methods, it would be nice to have some Python snippets in the doc comment describing the particular cases that they're meant to handle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2729 on 2025-12-04 22:58</div>
            <div class="timeline-body"><p>Instead of repeating the match statement here, you might consider adding this logic as a method on <code>VariadicArgumentType</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:3371 on 2025-12-04 22:59</div>
            <div class="timeline-body"><p>Same as above  ideally we wouldn't have to repeat this match statement here, and you could add this as a method on <code>VariadicArgumentType</code>. Though there you don't have access to that type, so in this case it might not be worth the refactoring churn</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3428 on 2025-12-04 23:02</div>
            <div class="timeline-body"><p>We have considered adding a new <code>Type</code> variant to handle heterogeneous lists. I don't know if there's an open issue for it. But if we ever do that, it will probably lean heavily on <code>TupleSpec</code>, so  to doing it this way for now, since that will make it most likely that this logic would carry over easily.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3544 on 2025-12-04 23:05</div>
            <div class="timeline-body"><p></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:1717 on 2025-12-04 23:13</div>
            <div class="timeline-body"><p>This is where the main conflict with #21551 will be. No suggested changes for this PR though!</p>
<p>To write down my plans for the merge conflict: #21551 adds a new <code>ConstraintSetAssignability</code> typing relation, and this logic will move over to <code>Type::has_relation_to_impl</code>, and will define what constraint set we create to describe when a callable lhs/actual is assignable to a <code>ParamSpec</code> callable rhs/formal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-12-04 23:13</div>
            <div class="timeline-body"><p>This is looking very good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 04:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/unsupported_special_forms.md</code>:68 on 2025-12-05 04:13</div>
            <div class="timeline-body"><p>This seems easy enough to do as I just need to remove the <code>ParamSpec</code> branch in <code>in_type_expression</code>, I'll do it in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 04:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:248 on 2025-12-05 04:50</div>
            <div class="timeline-body"><p>Yes, I should've clarified that both <a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=baf1446b0bfbf475c1a3233c49d50276">mypy</a> and <a href="https://pyright-play.net/?strict=true&amp;code=GYJw9gtgBALgngBwJYDsDmUkQWEMoCCKcAUCQMYA2AhgM61QBiYYA2gFTsAKANFACoBdAFxQAdBLIgApgDdp1SgH14CaQApmbInD6oYggJRA">Pyright</a> supports specifying <code>Any</code> for a paramspec and I've also seen instances of this in the ecosystem report specifically used in <code>staticmethod[Any, Any]</code> or <code>classmethod[Any, Any]</code>.</p>
<p>This is similar to how <code>Concatenate</code> is allowed as well in that position, it's the <code>default</code> of a <code>ParamSpec</code> where the limitation of &quot;ParamSpec, <code>...</code> or a list of types&quot; exists as per the spec but I can't find any reference specifying what is allowed to pass as explicit specialization to a ParamSpec.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 04:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:373 on 2025-12-05 04:56</div>
            <div class="timeline-body"><p>Yes, it should error because it's not in scope, I'll add the test case with a TODO as scoping rules aren't implemented in our generic implementation yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 04:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:235 on 2025-12-05 04:58</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/ruff/pull/21445#discussion_r2591394627, happy to revert it if you think otherwise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 04:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:181 on 2025-12-05 04:59</div>
            <div class="timeline-body"><p> thanks! I was a little bit confused to see this but yes it's obvious now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:280 on 2025-12-05 05:01</div>
            <div class="timeline-body"><p>I actually meant to say that it defaults to a gradual form where the type of parameters is <code>Unknown</code> aka <code>(*args: Unknown, **kwargs: Unknown)</code> but I guess that's more of an internal details. I'll use your suggestion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:469 on 2025-12-05 05:02</div>
            <div class="timeline-body"><p>Yeah, that makes sense, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:566 on 2025-12-05 05:08</div>
            <div class="timeline-body"><p>You cannot use <code>P.args</code> and <code>P.kwargs</code> in other position except for to annotate <code>*args</code> and <code>**kwargs</code> parameter, so <code>self.args: P.args = args</code> isn't allowed and will raise a diagnostic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:566 on 2025-12-05 05:27</div>
            <div class="timeline-body"><p>Hmm, actually, this prompted me to try something weird because this allows you to store the &quot;args&quot; and &quot;kwargs&quot; separately and then access it outside the class like so:</p>
<pre><code class="language-py">from typing import Callable

class Foo[**P]:
    def __init__(self, fn: Callable[P, int], *args: P.args, **kwargs: P.kwargs) -&gt; None:
        self.fn = fn
        self.args = args
        self.kwargs = kwargs

def fn(x: int, y: str) -&gt; int:
    return 1

foo = Foo(fn, 1, &quot;a&quot;)

reveal_type(foo)

# Pyright reveals here `Unknown`
# ty reveals `Unknown | ((x: int, y: str))`
# mypy has an INTERNAL ERROR here: https://mypy-play.net/?mypy=master&amp;python=3.12&amp;gist=55fbcad1f66e947123afe9920176fd32
reveal_type(foo.args)
reveal_type(foo.kwargs)

fn(*foo.args, **foo.kwargs)
fn(*foo.args)
fn(**foo.kwargs)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2582 on 2025-12-05 05:30</div>
            <div class="timeline-body"><p>Right, but you cannot annotate a variable with <code>P.args</code> or <code>P.kwargs</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types.rs</code>:4997 on 2025-12-05 05:32</div>
            <div class="timeline-body"><p>Love this, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8609 on 2025-12-05 05:33</div>
            <div class="timeline-body"><p>Oops, yes this was from the first iteration of this PR. I'll remove this, thanks for catching it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types.rs</code>:9718 on 2025-12-05 05:35</div>
            <div class="timeline-body"><p>Makes sense, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 05:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:1410 on 2025-12-05 05:59</div>
            <div class="timeline-body"><p>Consider the following example:</p>
<pre><code class="language-py">from typing import Callable

def foo[**P](f1: Callable[P, int], f2: Callable[P, int]) -&gt; Callable[P, bool]: ...

def f1(x: int) -&gt; int:
    return 1

def f2(x: str) -&gt; int:
    return &quot;&quot;

reveal_type(foo(f1, f2))
</code></pre>
<p>Here, <code>foo</code> is generic over a single <code>ParamSpec</code> which is used in multiple parameters. Later, when <code>P</code> is being specialized with two different parameter list, it will create a union which isn't then mapped in the return type. So, this allows us to pick the first specialization, type check the second occurrence using that and specialize the return type using that.</p>
<p>Without this early return, the reveal type would be <code>(**P@foo) -&gt; bool</code>, right now it's <code>(x: int) -&gt; bool</code>. This is mainly a workaround for now until ty supports specializing <code>P</code> here into a supertype considering all the parameter lists. I'll update the TODO and open a new follow-up issue to keep track.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 06:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3430 on 2025-12-05 06:03</div>
            <div class="timeline-body"><p>I don't think it has to use <code>infer_type_expression</code> but isn't <code>...</code> allowed in a few other places? I guess it's fine to special case this where required like here. I'll remove the TODO comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 06:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3491 on 2025-12-05 06:08</div>
            <div class="timeline-body"><p>I'm not sure if this provides any benefit as this would be a programming error faced by the user.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 06:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_ide/src/hover.rs</code>:1 on 2025-12-05 06:09</div>
            <div class="timeline-body"><p>Yup, my editor loves removing these whitespaces!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 06:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:322 on 2025-12-05 06:11</div>
            <div class="timeline-body"><p>Yes, I meant the former, I'll update the documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 06:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/signatures.rs</code>:204 on 2025-12-05 06:33</div>
            <div class="timeline-body"><p>Ah yes, I've extracted the common part as a nested function in this function body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-05 07:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3491 on 2025-12-05 07:11</div>
            <div class="timeline-body"><p>I have no opinion on this but a benefit of using <code>assert</code> is that we check the assertion in mypy primer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 07:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_ide/src/hover.rs</code>:1 on 2025-12-05 07:17</div>
            <div class="timeline-body"><p>And the best PR of the year award goes to  https://github.com/astral-sh/ruff/pull/21806</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2729 on 2025-12-05 08:57</div>
            <div class="timeline-body"><p>I'm not sure how would that work. The <code>VariadicArgumentType</code> is specific to <code>*args</code> but this is handling the <code>**kwargs</code> (keyword variadic). Let me see if I can think of a way to de-duplicate this, currently it's used in <code>match_variadic_argument</code>, <code>match_keyword_variadic</code> and <code>check_keyword_variadic_argument_type</code> but they have slightly different semantics. I think the keyword variadic handling can possibly be clubbed together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 08:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 13:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:566 on 2025-12-05 13:22</div>
            <div class="timeline-body"><p>Ahh, great point! I think I was getting mixed up with <code>TypeVarTuple</code>, where you of course <em>are</em> allowed to annotate something inside the class as <code>self.x: tuple[*Ts]</code> if the class as a whole is generic over a <code>TypeVarTuple</code> <code>Ts</code>.</p>
<p>The mypy crash seems to have already been reported at https://github.com/python/mypy/issues/19839. We should definitely add tests (if you haven't already) for the (invalid) case where you attempt to annotate things inside the class with <code>self.x: P.args</code> and <code>self.y: P.kwargs</code>, so that we can make sure that we at least don't crash on that </p>
<p>You might still be able to avoid the union-with-<code>Unknown</code> behaviour if you annotated <code>self.args</code> and <code>self.kwargs</code> as <code>Final</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 13:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3491 on 2025-12-05 13:23</div>
            <div class="timeline-body"><p>yeah, I have a general preference for cheap assertions to be always enabled where possible. It usually makes it easier to tell from the stack trace in bug reports where the bug is. And it can be confusing if an assertion triggers locally (using a debug build) but not on a released (non-debug) version of ty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:248 on 2025-12-05 13:28</div>
            <div class="timeline-body"><p>Huh. I find that quite surprising. Could you add a comment saying that this doesn't seem to be explicitly permitted by the spec, but we match mypy's/pyright's behaviour here for compatibility? (And also the same comment for the equivalent test in the pep695 mdtest suite)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 13:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2582 on 2025-12-05 13:39</div>
            <div class="timeline-body"><p>but I can still cunningly force ty to infer a type of <code>P.args</code> (rather than <code>P.args | Unknown</code>) if I annotate the instance variable with <code>Final</code> on your branch:</p>
<pre><code class="language-py">from typing import Final
from collections.abc import Callable

class F[**P]:
    def __init__(self, fn: Callable[P, int], *args: P.args, **kwargs: P.kwargs):
        self.args: Final = args
        self.kwargs: Final = kwargs

def f[**P](a: F[P]):
    reveal_type(a.args)  # revealed: P@f.args
    reveal_type(a.kwargs)  # revealed: P@f.kwargs
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 13:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-12-05 13:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2729 on 2025-12-05 13:52</div>
            <div class="timeline-body"><blockquote>
<p>I'm not sure how would that work. The <code>VariadicArgumentType</code> is specific to <code>*args</code> but this is handling the <code>**kwargs</code> (keyword variadic).</p>
</blockquote>
<p>Ah I missed that distinction! Yeah you could theoretically have both <code>VariadicArgumentType</code> and <code>KeywordVariadicArgumentType</code>, which would possibly look very similar to each other.</p>
<p>In general I like avoiding repeating these kinds of tests since it adds cognitive load to keep them in sync. But I'm fine if you decide not to do this, or mark it as a TODO. It's not worth doing if it will be a heavy lift  or at least not in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/legacy/paramspec.md</code>:248 on 2025-12-05 14:42</div>
            <div class="timeline-body"><p>Yeah, added a prose in both legacy and pep695 test case and in the actual source code as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 14:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:566 on 2025-12-05 14:49</div>
            <div class="timeline-body"><blockquote>
<p>We should definitely add tests (if you haven't already) for the (invalid) case where you attempt to annotate things inside the class with <code>self.x: P.args</code> and <code>self.y: P.kwargs</code>, so that we can make sure that we at least don't crash on that </p>
</blockquote>
<p>For sure, I've added the test case, we don't error right now as I've planned it for follow-up.</p>
<blockquote>
<p>You might still be able to avoid the union-with-<code>Unknown</code> behaviour if you annotated <code>self.args</code> and <code>self.kwargs</code> as <code>Final</code>?</p>
</blockquote>
<p>I think we should have both. The one without <code>Final</code> should be testing the special-case behavior that is implemented in <code>call/bind.rs</code> (<code>match_variadic</code>, <code>match_keyword_variadic</code> and <code>check_keyword_variadic_argument_type</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 14:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/paramspec.md</code>:566 on 2025-12-05 14:50</div>
            <div class="timeline-body"><p>That sounds great, thank you!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3491 on 2025-12-05 15:04</div>
            <div class="timeline-body"><p>That all sounds reasonable, I've changed it to use <code>assert</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:3131 on 2025-12-05 15:04</div>
            <div class="timeline-body"><p>Added doc comments with explanation and examples.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2582 on 2025-12-05 15:04</div>
            <div class="timeline-body"><p>I've added this as a test case, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 15:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2729 on 2025-12-05 15:30</div>
            <div class="timeline-body"><p>Makes sense, I'll try to take a stab at it before landing this PR but otherwise will prefer to do it as a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> approved on 2025-12-05 15:30</div>
            <div class="timeline-body"><p> I'm happy with where this is, I think we should go ahead and land this and address anything else as follow-on PRs. I can handle the merge conflict with #21551</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 16:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_ide/src/hover.rs</code>:2295 on 2025-12-05 16:22</div>
            <div class="timeline-body"><p>I'll add a TODO comment, I'm not actually sure about this but it does make sense for this to be Contravariant, the current variance is being inferred automatically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-05 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2729 on 2025-12-05 16:23</div>
            <div class="timeline-body"><p>I've noted this down, will do it as a follow-up instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/hover.rs</code>:2295 on 2025-12-05 16:25</div>
            <div class="timeline-body"><p>Yeah, I think it should either be contravariant or invariant... bivariant just seems definitely wrong, anyway </p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 16:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-05 16:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/hover.rs</code>:2295 on 2025-12-05 16:26</div>
            <div class="timeline-body"><p>(A TODO comment sounds great )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-12-05 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-12-05 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-05 16:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:42:35 UTC
    </footer>
</body>
</html>
