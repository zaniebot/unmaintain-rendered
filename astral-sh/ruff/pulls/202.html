<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable skipping based on .gitignore - astral-sh/ruff #202</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable skipping based on .gitignore</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/202">#202</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-09-15 15:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>This works but it&#x27;s kind of slow -- it increases the benchmark time from ~300ms to ~420ms which feels like a lot for a nice-to-have feature, so I&#x27;d want to make this opt-in.</p>
<p>Alternatively (or in addition): the .gitignore changes infrequently, so I could probably cache the exclusion checks?</p>
<p>Resolves #174.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-15 15:02</div>
            <div class="timeline-body"><p>(This still needs a CLI argument before it can be merged.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-15 15:03</div>
            <div class="timeline-body"><p>\cc @jack1142</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 15:26</div>
            <div class="timeline-body"><p>I pip installed it from the PR&#x27;s head branch and it doesn&#x27;t seem to work.</p>
<p>Contents of each Python file:</p>
<pre><code>def func():
    x = 1
</code></pre>
<p>Configuration:</p>
<ul>
<li><code>$PROJECT_ROOT/.gitignore</code></li>
</ul>
<pre><code>.folder/
should_not_be_here4.py
</code></pre>
<ul>
<li><code>$PROJECT_ROOT/.git/info/exclude</code>:</li>
</ul>
<pre><code>should_not_be_here2.py
</code></pre>
<ul>
<li><code>~/.gitignore_global</code> (I have <code>core.excludesFile</code> set to that file):</li>
</ul>
<pre><code>should_not_be_here3.py
</code></pre>
<p><code>$PROJECT_ROOT</code> file tree:</p>
<pre><code>- .folder/
+-- should_not_be_here1.py
- .git/
+-- files and folders
- .ruff_cache/
+-- files and folders
- .venv/
+-- files and folders
- .gitignore
- should_be_here.py
- should_not_be_here2.py
- should_not_be_here3.py
- should_not_be_here4.py
</code></pre>
<p>The output of <code>ruff .</code> (ran in <code>$PROJECT_ROOT</code>):</p>
<pre><code>❯ ruff . 
Failed to load pyproject.toml: No such file or directory (os error 2)
Falling back to default configuration...
Found 5 error(s).
./.folder/should_not_be_here1.py:2:5: F841 Local variable `x` is assigned to but never used
./should_be_here.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here2.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here3.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here4.py:2:5: F841 Local variable `x` is assigned to but never used
</code></pre>
<p><code>should_not_be_here*</code> files are the ones that should be ignored while <code>should_be_here*</code> shouldn&#x27;t.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 15:30</div>
            <div class="timeline-body"><p>Update: now that wheels got uploaded by CI, I tried installing from the built wheel instead but that didn&#x27;t change the result.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 15:34</div>
            <div class="timeline-body"><blockquote>
<p>(This still needs a CLI argument before it can be merged.)</p>
</blockquote>
<p>Okay, I just realized that this only means there&#x27;s no CLI option but the pyproject.toml setting is there :smile:</p>
<p>But surprisingly, adding this doesn&#x27;t change the result (aside from ruff no longer complaining about missing pyproject.toml):</p>
<pre><code>[tool.ruff]
skip-gitignore = true
</code></pre>
<p>Output:</p>
<pre><code>❯ ruff .
Found 5 error(s).
./.folder/should_not_be_here1.py:2:5: F841 Local variable `x` is assigned to but never used
./should_be_here.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here2.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here3.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here4.py:2:5: F841 Local variable `x` is assigned to but never used
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 15:59</div>
            <div class="timeline-body"><p>I made #203 which could be a potential cause for me having trouble with getting anything to match here as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-15 16:15</div>
            <div class="timeline-body"><p>The only files I&#x27;d expect to be excluded here with current implementation are <code>should_not_be_here1.py</code> and <code>should_not_be_here4.py</code> -- this is just looking at the local gitignore, and not at the global ignore or <code>.git/info/exclude</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-15 16:16</div>
            <div class="timeline-body"><p>I had the code setup to log-but-not-actually-ignore files so as to avoid affecting the benchmark while testing. Can you try again? If you run with <code>--verbose</code>, it should tell you which files are excluded (and why).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 16:23</div>
            <div class="timeline-body"><blockquote>
<p>I had the code setup to log-but-not-actually-ignore files so as to avoid affecting the benchmark while testing. Can you try again? If you run with <code>--verbose</code>, it should tell you which files are excluded (and why).</p>
</blockquote>
<p>Nothing was logged (tested with -v on both the build with the commit you added and the one before that):</p>
<pre><code>❯ ruff -v .        
[2022-09-15][18:19:39][ruff::pyproject][DEBUG] Found pyproject.toml at: &quot;./pyproject.toml&quot;
[2022-09-15][18:19:39][ruff::fs][DEBUG] Ignored path via `exclude`: &quot;./.venv&quot;
[2022-09-15][18:19:39][ruff::fs][DEBUG] Ignored path via `exclude`: &quot;./.git&quot;
[2022-09-15][18:19:39][ruff][DEBUG] Identified files to lint in: 149.729µs
[2022-09-15][18:19:39][ruff][DEBUG] Checked files in: 2.843897ms
Found 5 error(s).
./.folder/should_not_be_here1.py:2:5: F841 Local variable `x` is assigned to but never used
./should_be_here.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here2.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here3.py:2:5: F841 Local variable `x` is assigned to but never used
./should_not_be_here4.py:2:5: F841 Local variable `x` is assigned to but never used
</code></pre>
<blockquote>
<p>this is just looking at the local gitignore, and not at the global ignore or .git/info/exclude.</p>
</blockquote>
<p>On one hand, I get that this would further decrease the performance, on the other, I really would want at least the global gitignore to work because with how I name my venv folders, it&#x27;s not reasonable to expect the projects I work on to have it in their gitignore. <code>.git/info/exclude</code> also has its uses (I use it on one project I regularly work on to be able to put some scripts I use to make my work a bit easier) but I don&#x27;t feel as strongly about it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 16:44</div>
            <div class="timeline-body"><p>Actually one more case is adding <code>.gitignore</code> in subfolders, e.g.
<code>another_directory/.gitignore</code>:</p>
<pre><code>*
</code></pre>
<p>should cause entire <code>another_directory</code> to be ignored (which is taken advantage of by various tools).</p>
<p>That reminds me I need to make an issue for adding <code>.gitignore</code> with <code>*</code> contents to the <code>.ruff_cache</code> folder as that&#x27;s actually what a lot of tools do (mypy, pytest, virtualenv to name a few) :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-15 16:58</div>
            <div class="timeline-body"><p>Cool yeah, adding the <code>.gitignore</code> is straightforward :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-15 16:59</div>
            <div class="timeline-body"><p>I&#x27;m probably going to de-prioritize supporting auto-exclusion based on <code>.gitignore</code>, at least until I fix + stablize the <code>skip</code> globbing behavior, since (once that works) you can always just use skips to achieve the same effect (less conveniently).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-15 17:25</div>
            <div class="timeline-body"><p>My personal use case is ignoring directories specific to me (especially the virtual environment folders I create where I don&#x27;t particularly follow conventions as much, as the conventions don&#x27;t really allow me to have virtual environments for multiple Python version organized neatly) which is why I suggested a more general request for supporting git ignores since it&#x27;s more likely to be supported by multiple tools.</p>
<p>But personally, I wouldn&#x27;t mind much just having a user-specific file for configuring excludes but that has the whole other issue of whether the project config should override or extend such configuration (personally I want it to extend <em>but</em> it doesn&#x27;t work well for other settings in a more general case of user configuration rather than user excludes configuration) so I don&#x27;t think it would work as well as this could.</p>
<p>Either way, de-prioritizing it makes sense to me, it&#x27;s not particularly critical while ruff is in early adoption phase since it&#x27;s somewhat unlikely that I would personally work on a project that uses ruff and is not maintained by me (it could happen since you&#x27;ve already reached some big project maintainers but I&#x27;m guessing I won&#x27;t personally encounter an external project I want to contribute to that uses ruff quite yet) and I can put excludes specific to me in configuration for projects <em>I</em> maintain :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-21 15:25</div>
            <div class="timeline-body"><p>(Closing for now, can always re-open later on.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-09-21 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-02-03 05:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:18 UTC
    </footer>
</body>
</html>
