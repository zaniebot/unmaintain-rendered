<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[formatter] Indent docstrings using configured indent_style - astral-sh/ruff #9173</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[formatter] Indent docstrings using configured indent_style</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9173">#9173</a>
        opened by <a href="https://github.com/sciyoshi">@sciyoshi</a>
        on 2023-12-18 03:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sciyoshi">@sciyoshi</a> on 2023-12-18 03:03</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Ruff currently always formats docstrings using spaces for indentation. However, when <code>indent-style</code> is set to &quot;tab&quot;, this leads to E101 (mixed indentation) linter errors.</p>
<p>There are a few approaches to improving the situation, some of which are discussed in https://github.com/astral-sh/ruff/issues/8430. One option which is likely the simplest is to recommend turning off E101 when using the formatter. If this is the preferred route, then Ruff should probably also respect the <code>indent-width</code> when expanding tabs in docstrings to avoid the issue <a href="https://github.com/astral-sh/ruff/issues/8430#issuecomment-1822529090">described here</a>.</p>
<p>This PR implements an alternative solution which indents docstrings using the configured <code>indent-style</code>. In cases where docstrings have indents that aren't a multiple of the <code>indent-width</code>, this may mean E101 is still triggered in the formatted code. However, this should be very uncommon. I did a cursory check of the few codebases across GitHub that use Ruff with tabs and could not find any cases where docstrings would be negatively affected by this change.</p>
<p>Note that this means that Ruff will format code with tabs differently than Black, which always expands tabs to 8 spaces. I think this is acceptable in this case, because Black doesn't support tabs to begin with (so there's no real compatibility issue).</p>
<p>There is also the question of how other tooling treats tabs in docstrings. As of Python 3.13, docstrings will be dedented to save memory. However, tabs will also unfortunately be expanded to 8 spaces by the interpreter, which will negate the memory usage savings, but this difference should also be mostly inconsequential (and this may potentially be fixed in CPython in the future.)</p>
<p>Closes #8430</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-12-18 03:13</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Formatter (stable)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 2 project errors)</p>
<details><summary><a href="https://github.com/sphinx-doc/sphinx">sphinx-doc/sphinx</a> (error)</summary>
<p>
<pre>ruff format --no-preview --exclude tests/roots/test-pycode/cp_1251_coded.py</pre>
</p>
<p>

<pre><code>ruff failed
  Cause: Selection of unstable rules without the `--preview` flag is not allowed. Enable preview or remove selection of:
	- FURB113
	- FURB131
	- FURB132
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/dalle/Image_generations_edits_and_variations_with_DALL-E.ipynb:3:7:8: Unexpected token 'prompt'
</code></pre>
</p>
</details>

<h3>Formatter (preview)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/dalle/Image_generations_edits_and_variations_with_DALL-E.ipynb:3:7:8: Unexpected token 'prompt'
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-12-18 03:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2023-12-18 03:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-12-18 03:30</div>
            <div class="timeline-body"><p>Thank you for this PR and pushing for another decison.</p>
<p>I don't feel comfortable making this decision right now because I don't have a good enough understanding of docstring handling in Python and I want to avoid the situation where we change the definition only to later change it again. The PR also seems to change docstring formatting when using <code>indent-style=space</code>, meaning this PR reduces black compatibiliity. This doesn't mean we shouldn't move forward with this PR, it's just that I need to find time time to go through the issues and familiarize myself with Python's docstring handling. I'm happy to move forward with this PR if someone else from the team has enough context and feels comfortable making the decision.</p>
<p>Note: We need to double check how this affects code block formatting inside docstrings (@BurntSushi)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2024-02-06 01:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2024-02-06 01:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-06 01:57</div>
            <div class="timeline-body"><p>I'm now looking into this and plan to make a decision tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-08 14:57</div>
            <div class="timeline-body"><p>Thanks, @sciyoshi, for putting the work into this and pushing for a decision.</p>
<p>I understand that changing tabs in docstrings to spaces can be surprising if a specific documentation convention uses them. Unfortunately, changing spaces to a tab isn't safe when the spaces are used for alignment.</p>
<p>I believe the proper fix is to add support for docstring formatting (that supports the different conventions). This way, we avoid the risk of breaking alignment and match the expectation of using tabs in these cases.</p>
<p>See https://github.com/astral-sh/ruff/issues/8430#issuecomment-1934209625 for an in-depth explanation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-08 14:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:57:55 UTC
    </footer>
</body>
</html>
