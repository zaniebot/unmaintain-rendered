```yaml
number: 4453
title: Create dummy format CLI
type: pull_request
state: merged
author: konstin
labels:
  - formatter
assignees: []
merged: true
base: main
head: format_cli
created_at: 2023-05-16T16:32:10Z
updated_at: 2023-05-19T09:45:53Z
url: https://github.com/astral-sh/ruff/pull/4453
synced_at: 2026-01-12T03:50:03Z
```

# Create dummy format CLI

---

_Pull request opened by @konstin on 2023-05-16 16:32_

This currently only does a dummy replacement and is hidden behind a feature flag. See also the corresponding ruff-lsp PR.


---

_Comment by @konstin on 2023-05-16 16:32_

Current dependencies on/for this PR:
* main
  * **PR #4453** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4453" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/charliermarsh/ruff/4453?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-05-16 17:04_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.07     15.8Â±0.05ms     2.6 MB/sec    1.00     14.7Â±0.09ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.05      3.8Â±0.01ms     4.4 MB/sec    1.00      3.6Â±0.01ms     4.6 MB/sec
linter/all-rules/numpy/globals.py          1.05    382.2Â±1.67Âµs     7.7 MB/sec    1.00    363.3Â±0.86Âµs     8.1 MB/sec
linter/all-rules/pydantic/types.py         1.06      6.5Â±0.03ms     3.9 MB/sec    1.00      6.1Â±0.02ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.12      8.1Â±0.02ms     5.0 MB/sec    1.00      7.2Â±0.02ms     5.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.10   1645.2Â±6.29Âµs    10.1 MB/sec    1.00  1501.3Â±14.36Âµs    11.1 MB/sec
linter/default-rules/numpy/globals.py      1.07    173.9Â±0.36Âµs    17.0 MB/sec    1.00    162.7Â±0.20Âµs    18.1 MB/sec
linter/default-rules/pydantic/types.py     1.09      3.5Â±0.01ms     7.2 MB/sec    1.00      3.2Â±0.01ms     7.9 MB/sec
parser/large/dataset.py                    1.01      5.9Â±0.01ms     6.9 MB/sec    1.00      5.8Â±0.01ms     7.0 MB/sec
parser/numpy/ctypeslib.py                  1.01   1155.7Â±1.08Âµs    14.4 MB/sec    1.00   1139.5Â±1.88Âµs    14.6 MB/sec
parser/numpy/globals.py                    1.01    119.1Â±0.49Âµs    24.8 MB/sec    1.00    117.7Â±0.60Âµs    25.1 MB/sec
parser/pydantic/types.py                   1.01      2.5Â±0.00ms    10.2 MB/sec    1.00      2.5Â±0.00ms    10.3 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.04     17.2Â±0.30ms     2.4 MB/sec    1.00     16.6Â±0.35ms     2.5 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.03      4.3Â±0.09ms     3.9 MB/sec    1.00      4.2Â±0.08ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.03   504.7Â±10.33Âµs     5.8 MB/sec    1.00    490.2Â±7.46Âµs     6.0 MB/sec
linter/all-rules/pydantic/types.py         1.03      7.2Â±0.15ms     3.6 MB/sec    1.00      7.0Â±0.12ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.04      8.5Â±0.16ms     4.8 MB/sec    1.00      8.1Â±0.05ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.03  1785.0Â±22.32Âµs     9.3 MB/sec    1.00  1726.8Â±17.30Âµs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    194.7Â±2.87Âµs    15.2 MB/sec    1.01    196.7Â±5.14Âµs    15.0 MB/sec
linter/default-rules/pydantic/types.py     1.02      3.7Â±0.06ms     6.8 MB/sec    1.00      3.7Â±0.03ms     6.9 MB/sec
parser/large/dataset.py                    1.01      6.8Â±0.07ms     6.0 MB/sec    1.00      6.7Â±0.07ms     6.1 MB/sec
parser/numpy/ctypeslib.py                  1.01  1282.0Â±19.45Âµs    13.0 MB/sec    1.00  1267.9Â±12.84Âµs    13.1 MB/sec
parser/numpy/globals.py                    1.01    131.8Â±2.55Âµs    22.4 MB/sec    1.00    130.4Â±1.78Âµs    22.6 MB/sec
parser/pydantic/types.py                   1.01      2.9Â±0.02ms     8.9 MB/sec    1.00      2.8Â±0.03ms     9.0 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/lib.rs`:132 on 2023-05-17 06:21_

Nit: This equals check performs, if Rust isn't able to optimize it away, two allocations. One for the `vec` and another for the `PathBuf`. I assume you plan to rework this in follow-up PRs?

---

_@MichaReiser approved on 2023-05-17 06:22_

---

_Label `autoformatter` added by @MichaReiser on 2023-05-17 06:22_

---

_@konstin reviewed on 2023-05-17 08:44_

---

_Review comment by @konstin on `crates/ruff_cli/src/lib.rs`:132 on 2023-05-17 08:44_

I copied this from https://github.com/charliermarsh/ruff/blob/7cae4eaf086e5b952fa52a1d94678985f710f58a/crates/ruff_cli/src/lib.rs#L312

I would have hoped that llvm can see through this and just optimizes this away, but if not i can rewrite it

---

_@MichaReiser reviewed on 2023-05-17 10:45_

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/lib.rs`:132 on 2023-05-17 10:45_

One thing we could do that is low effort and also avoids ambiguity (what if I call ruff with `ruff format -` because I have a `-` directory) is to introduce a new `enum` with a `Stdin { filename }` and `Paths(Vec<PathBuf>)` variants.

---

_@konstin reviewed on 2023-05-17 20:06_

---

_Review comment by @konstin on `crates/ruff_cli/src/lib.rs`:132 on 2023-05-17 20:06_

i've changed this to a no-alloc version

---

_Review requested from @MichaReiser by @konstin on 2023-05-17 20:06_

---

_@charliermarsh reviewed on 2023-05-17 21:05_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/lib.rs`:129 on 2023-05-17 21:05_

Nit: you could use `warn_user_once!` here.

---

_@charliermarsh reviewed on 2023-05-17 21:09_

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/lib.rs`:129 on 2023-05-17 21:09_

Going to bikeshed the wording to be consistent in tone with other user-facing copy, maybe like: "`ruff format` is a work-in-progress, subject to change at any time, and intended for internal use only."?

---

_@konstin reviewed on 2023-05-17 21:11_

---

_Review comment by @konstin on `crates/ruff_cli/src/lib.rs`:129 on 2023-05-17 21:11_

that's neat!

---

_@konstin reviewed on 2023-05-17 21:29_

---

_Review comment by @konstin on `crates/ruff_cli/src/lib.rs`:129 on 2023-05-17 21:29_

that's a much nicer phrasing, thanks!

---

_Merged by @konstin on 2023-05-19 09:45_

---

_Closed by @konstin on 2023-05-19 09:45_

---

_Branch deleted on 2023-05-19 09:45_

---
