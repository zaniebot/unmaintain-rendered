<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Exclude members starting with `_abc_` from a protocol interface - astral-sh/ruff #18467</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Exclude members starting with <code>_abc_</code> from a protocol interface</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18467">#18467</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-06-04 18:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 18:30</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>As well as excluding a hardcoded set of special attributes, CPython at runtime also excludes any attributes or declarations starting with <code>_abc_</code> from the set of members that make up a protocol interface. I missed this in my initial implementation.</p>
<p>This is a bit of a CPython implementation detail, but I do think it's important that we try to model the runtime as best we can here. The closer we are to the runtime behaviour, the closer we come to sound behaviour when narrowing types from <code>isinstance()</code> checks against runtime-checkable protocols (for example)</p>
<h2>Test Plan</h2>
<p>Extended an existing mdtest</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-06-04 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-06-04 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-06-04 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-06-04 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-04 18:33</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-06-04 19:29</div>
            <div class="timeline-body"><p>Neither mypy nor pyright implement this, and I'm not sure how much the <em>static typing</em> understanding of protocols should be built around implementation details of runtime-checkable protocols.</p>
<p>But I guess this is not likely to hurt compatibility, since such attributes should be unusual. So it seems fine to do this and re-evaluate if it causes any actual issues.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-06-04 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-04 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-04 19:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:45:32 UTC
    </footer>
</body>
</html>
