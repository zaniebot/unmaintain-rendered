<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid syntax error notification for source code actions - astral-sh/ruff #12148</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid syntax error notification for source code actions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12148">#12148</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-07-02 11:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>This PR avoids the error notification if a user selects the source code actions and there&#x27;s a syntax error in the source.</p>
<p>Before <a href="https://github.com/astral-sh/ruff/pull/12134">astral-sh/ruff#12134</a>, the change would&#x27;ve been different. But that PR disables generating fixes if there&#x27;s a syntax error. This means that we can return an empty map instead as there won&#x27;t be any fixes in the diagnostics returned by the <code>lint_fix</code> function.</p>
<p>For reference, following are the screenshot as on <code>main</code> with the error:</p>
<p><strong>VS Code:</strong></p>
<img alt="Screenshot 2024-07-02 at 16 39 59" src="https://github.com/astral-sh/ruff/assets/67177269/62f3e99b-0b0c-4608-84a2-26aeabcc6933">

<p><strong>Neovim:</strong></p>
<img alt="Screenshot 2024-07-02 at 16 38 50" src="https://github.com/astral-sh/ruff/assets/67177269/5d637c36-d7f8-4a3b-8011-9a89708919a8">

<p>fixes: #11931</p>
Test Plan
<p>Considering the following code snippet where there are two diagnostics (syntax error and useless semicolon <code>E703</code>):</p>
<pre><code>x;

y =
</code></pre>
VS Code
<p>https://github.com/astral-sh/ruff/assets/67177269/943537fc-ed8d-448d-8a36-1e34536c4f3e</p>
Neovim
<p>https://github.com/astral-sh/ruff/assets/67177269/4e6f3372-6e5b-4380-8919-6221066efd5b</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-02 11:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-02 11:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-02 11:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-07-02 11:25</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>encountered linter errors</strong>. (no lint changes; 1 project error)</p>
<a href="https://github.com/demisto/content">demisto/content</a> (error)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre><code>warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - &#x27;ignore&#x27; -&gt; &#x27;lint.ignore&#x27;
  - &#x27;select&#x27; -&gt; &#x27;lint.select&#x27;
  - &#x27;unfixable&#x27; -&gt; &#x27;lint.unfixable&#x27;
  - &#x27;per-file-ignores&#x27; -&gt; &#x27;lint.per-file-ignores&#x27;
warning: `PGH001` has been remapped to `S307`.
warning: `PGH002` has been remapped to `G010`.
warning: `PLR1701` has been remapped to `SIM101`.
ruff failed
  Cause: Selection of deprecated rule `E999` is not allowed when preview is enabled.
</code></pre>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-07-03 06:41</div>
            <div class="timeline-body"><p>The code changes look good, but I&#x27;m not sure if we want to keep some indicator to why the action failed?</p>
<p>Let&#x27;s say you have a very long document and the syntax error is outside the visible area. It might now be unclear to users why the manually triggered action does <em>nothing</em>.</p>
<p>RustRover does show an error when running <code>rustfmt</code> failed because of a syntax error and I find this useful information.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-03 08:41</div>
            <div class="timeline-body"><blockquote>
<p>Let&#x27;s say you have a very long document and the syntax error is outside the visible area. It might now be unclear to users why the manually triggered action does <em>nothing</em>.</p>
<p>RustRover does show an error when running <code>rustfmt</code> failed because of a syntax error and I find this useful information.</p>
</blockquote>
<p>That is interesting. Does it show on every save? I don&#x27;t mind providing a notification.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-03 09:51</div>
            <div class="timeline-body"><blockquote>
<p>That is interesting. Does it show on every save? I don&#x27;t mind providing a notification.</p>
</blockquote>
<p>Only when I issue the <em>Reformat code</em> manually. It doesn&#x27;t show a notification when the formatting on save fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-04 04:06</div>
            <div class="timeline-body"><blockquote>
<p>Only when I issue the <em>Reformat code</em> manually. It doesn&#x27;t show a notification when the formatting on save fails.</p>
</blockquote>
<p>I think it&#x27;s difficult for a language server to know whether something was invoked manually or automatically by the client except for code actions for which there&#x27;s <code>CodeActionTriggerKind</code> but that&#x27;s also optional. I&#x27;ll make this change in a follow-up PR.</p>
<p>I guess RustRover is able to do this <em>reliably</em> because the entire stack is in their control.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-04 04:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-04 04:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-04 04:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-04 04:34</div>
            <div class="timeline-body"><p>I&#x27;ve opened <a href="https://github.com/astral-sh/ruff/issues/12176">astral-sh/ruff#12176</a> for now and I can tackle it later.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:05:02 UTC
    </footer>
</body>
</html>
