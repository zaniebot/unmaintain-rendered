<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create `ruff_notebook` crate - astral-sh/ruff #7039</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Create <code>ruff_notebook</code> crate</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7039">#7039</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-09-01 12:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR moves <code>ruff/jupyter</code> into its own <code>ruff_notebook</code> crate. Beyond the move itself, there were a few challenges:</p>
<ol>
<li><code>ruff_notebook</code> relies on the source map abstraction. I've moved the source map into <code>ruff_diagnostics</code>, since it doesn't have any dependencies on its own and is used alongside diagnostics.</li>
<li><code>ruff_notebook</code> has a couple tests for end-to-end linting and autofixing. I had to leave these tests in <code>ruff</code> itself.</li>
<li>We had code in <code>ruff/jupyter</code> that relied on Python lexing, in order to provide a more targeted error message in the event that a user saves a <code>.py</code> file with a <code>.ipynb</code> extension. I removed this in order to avoid a dependency on the parser, it felt like it wasn't worth retaining just for that dependency.</li>
</ol>
<h2>Test Plan</h2>
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @charliermarsh on 2023-09-01 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @charliermarsh on 2023-09-01 12:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @charliermarsh on 2023-09-01 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_diagnostics/src/source_map.rs</code>:1 on 2023-09-01 12:56</div>
            <div class="timeline-body"><p>I don't have a better recommendation but moving source map to diagnostic feels a bit off because it isn't the only possible use case for source maps. For example, source maps can be used to move the IDE cursor to the right position after applying fixes. However, that requires extracting our fix infrastructure which is rather involved and even <code>Fix</code> is defined in <code>Diagnostic</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/src/diagnostics.rs</code>:248 on 2023-09-01 12:58</div>
            <div class="timeline-body"><p>Can you explain what this change is about?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-09-01 12:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-09-01 13:01</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2023-09-01 13:11</div>
            <div class="timeline-body"><p>That was quick, thanks!</p>
<p>We might want to name it something along the lines of <code>ruff_notebook</code> as Jupyter is actually just a frontend while this crate would ideally handle notebooks in general (#6140)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_cli/src/diagnostics.rs</code>:248 on 2023-09-01 13:14</div>
            <div class="timeline-body"><p>I believe it's to merge the <code>write</code> and <code>write_inner</code> function on <code>Notebook</code>. <code>write</code> would require a <code>Path</code> while <code>write_inner</code> would use a <code>impl Write</code>. Now, there's only a single public function <code>write</code> which takes in a <code>impl Write</code>.</p>
<p>The main reason for the separation was in tests where the <code>write_inner</code> was being utilized to avoid changing the file on disk and to just use a <code>Vec</code> as a writer.</p>
<p>Hope this helps otherwise Charlie can expand as well :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2023-09-01 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-09-01 13:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_cli/src/diagnostics.rs</code>:248 on 2023-09-01 13:16</div>
            <div class="timeline-body"><p>Yeah, I think it's more flexible to expose an interface that takes <code>impl Write</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-01 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/src/diagnostics.rs</code>:248 on 2023-09-01 13:21</div>
            <div class="timeline-body"><p>We may want to consider a <code>&amp;dyn Write</code> to avoid monomorphizing this for every write implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Create `ruff_jupyter` crate" to "Create `ruff_notebook` crate" by @charliermarsh on 2023-09-01 13:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-09-01 13:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-01 13:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-01 13:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:59:58 UTC
    </footer>
</body>
</html>
