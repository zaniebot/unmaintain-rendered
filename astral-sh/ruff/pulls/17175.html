<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control flow: loops - astral-sh/ruff #17175</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Control flow: loops</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17175">#17175</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-04-03 13:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>This PR implements support for loop statements in the control flow graph, as well as the associated jumps <code>break</code> and <code>continue</code>. It is simplest to review commit by commit (now that I rewrote history...)</p>
<p>A few comments:</p>
<ol>
<li>We have ecosystem false positives for <code>unreachable</code> because we have not implemented the fallback option to &quot;draw edges for all possible control flow&quot; for unsupported statements. For all remaining statement types except try/catch, implementing this logic is actually just as hard as implementing the statement! So I propose to implement the remaining statements, and then implement the fallback for try/catch.</li>
<li>I tried for a bit to come up with a clever way to clean up the code and avoid repetition, but could not seem to come up with something that wouldn&#x27;t itself introduce a lot more complexity. For example: it would be nice to always add statements and edges at the same time... except the cleanup step at the end of the main loop doesn&#x27;t really allow for this. Or another example: it would be nice if the debug assertion that we never add statements to a block twice was actually a checkable at compile time. Again - I tried thinking through a few approaches (e.g. having a &quot;BlockBuilder&quot; or introduing more complex state on the CFG Builder - like a stack of statement slices  and pointers) but couldn&#x27;t quite find a way to make it all work. That doesn&#x27;t mean there isn&#x27;t an elegant solution - just that I&#x27;m not clever enough!</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-03 16:15</div>
            <div class="timeline-body"><p>I think there are a few lifetimes that can be simplified in the mermaid testing code</p>
<pre><code>Subject: [PATCH] Align server indexing with CLI behavior
---
Index: crates/ruff_python_semantic/src/cfg/graph.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/crates/ruff_python_semantic/src/cfg/graph.rs b/crates/ruff_python_semantic/src/cfg/graph.rs
--- a/crates/ruff_python_semantic/src/cfg/graph.rs	(revision dca1340348d73b1bf1cd10de593b1ef01d9363ec)
+++ b/crates/ruff_python_semantic/src/cfg/graph.rs	(date 1743696804592)
@@ -49,7 +49,7 @@
 
     /// Returns the [`Edges`] going out of the basic block at the given index
     pub fn outgoing(&amp;self, block: BlockId) -&gt; &amp;Edges {
-        &amp;self.blocks[block].out
+        self.blocks[block].out
     }
 
     /// Returns an iterator over the indices of the direct predecessors of the block at the given index
@@ -132,7 +132,7 @@
     }
 
     /// Returns iterator over [`Condition`]s which must be satisfied to traverse corresponding edge
-    pub fn conditions(&amp;self) -&gt; impl ExactSizeIterator&lt;Item = &amp;Condition&gt; {
+    pub fn conditions(&amp;self) -&gt; impl ExactSizeIterator&lt;Item = &amp;Condition&lt;&#x27;stmt&gt;&gt; {
         self.conditions.iter()
     }
 
@@ -140,7 +140,7 @@
         self.targets.is_empty()
     }
 
-    pub fn filter_targets_by_conditions&lt;&#x27;a, T: FnMut(&amp;Condition) -&gt; bool + &#x27;a&gt;(
+    pub fn filter_targets_by_conditions&lt;&#x27;a: &#x27;stmt, T: FnMut(&amp;Condition) -&gt; bool + &#x27;a&gt;(
         &amp;&#x27;a self,
         mut predicate: T,
     ) -&gt; impl Iterator&lt;Item = BlockId&gt; + &#x27;a {
Index: crates/ruff_python_semantic/src/cfg/visualize.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/crates/ruff_python_semantic/src/cfg/visualize.rs b/crates/ruff_python_semantic/src/cfg/visualize.rs
--- a/crates/ruff_python_semantic/src/cfg/visualize.rs	(revision dca1340348d73b1bf1cd10de593b1ef01d9363ec)
+++ b/crates/ruff_python_semantic/src/cfg/visualize.rs	(date 1743696538214)
@@ -10,7 +10,7 @@
     CFGWithSource::new(graph, source).draw_graph()
 }
 
-trait MermaidGraph&lt;&#x27;a&gt;: DirectedGraph&lt;&#x27;a&gt; {
+trait MermaidGraph: DirectedGraph {
     fn draw_node(&amp;self, node: Self::Node) -&gt; MermaidNode;
     fn draw_edges(&amp;self, node: Self::Node) -&gt; impl Iterator&lt;Item = (Self::Node, MermaidEdge)&gt;;
 
@@ -146,7 +146,7 @@
     }
 }
 
-pub trait DirectedGraph&lt;&#x27;a&gt; {
+pub trait DirectedGraph {
     type Node: Idx;
 
     fn num_nodes(&amp;self) -&gt; usize;
@@ -154,18 +154,18 @@
     fn successors(&amp;self, node: Self::Node) -&gt; impl ExactSizeIterator&lt;Item = Self::Node&gt; + &#x27;_;
 }
 
-struct CFGWithSource&lt;&#x27;stmt&gt; {
+struct CFGWithSource&lt;&#x27;source, &#x27;stmt&gt; {
     cfg: ControlFlowGraph&lt;&#x27;stmt&gt;,
-    source: &amp;&#x27;stmt str,
+    source: &amp;&#x27;source str,
 }
 
-impl&lt;&#x27;stmt&gt; CFGWithSource&lt;&#x27;stmt&gt; {
-    fn new(cfg: ControlFlowGraph&lt;&#x27;stmt&gt;, source: &amp;&#x27;stmt str) -&gt; Self {
+impl&lt;&#x27;source, &#x27;stmt&gt; CFGWithSource&lt;&#x27;source, &#x27;stmt&gt; {
+    fn new(cfg: ControlFlowGraph&lt;&#x27;stmt&gt;, source: &amp;&#x27;source str) -&gt; Self {
         Self { cfg, source }
     }
 }
 
-impl&lt;&#x27;stmt&gt; DirectedGraph&lt;&#x27;stmt&gt; for CFGWithSource&lt;&#x27;stmt&gt; {
+impl DirectedGraph for CFGWithSource&lt;&#x27;_, &#x27;_&gt; {
     type Node = BlockId;
 
     fn num_nodes(&amp;self) -&gt; usize {
@@ -181,7 +181,7 @@
     }
 }
 
-impl&lt;&#x27;stmt&gt; MermaidGraph&lt;&#x27;stmt&gt; for CFGWithSource&lt;&#x27;stmt&gt; {
+impl MermaidGraph for CFGWithSource&lt;&#x27;_, &#x27;_&gt; {
     fn draw_node(&amp;self, node: Self::Node) -&gt; MermaidNode {
         let statements: Vec&lt;String&gt; = self
             .cfg

</code></pre>
<p>But I don&#x27;t see an obvious work around for the lifetime issues other than using an <code>IndexVec</code> stored on <code>ControlFlowGraph</code> to store all the conditions and then store the <code>ConditionId</code> in <code>Edges::conditions</code> (or to use a <code>Vec</code> in <code>Edges::conditions</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-04-04 19:42</div>
            <div class="timeline-body"><p>Hmm... not sure what I did wrong but I applied your patch exactly and the code did not compile. This seems to be the problem:</p>
<pre><code>     /// Returns the [`Edges`] going out of the basic block at the given index
     pub fn outgoing(&amp;self, block: BlockId) -&gt; &amp;Edges {
-        &amp;self.blocks[block].out
+        self.blocks[block].out
     }
</code></pre>
<p>This doesn&#x27;t agree with the return signature. If we remove the borrow we get a lifetime issue. It all works fine if we switch from <code>SmallVec</code> to <code>Vec</code> though so I&#x27;m gonna do that for now, and we can revisit a more performant data structure a little later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-04 21:33</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+164 -1 violations, +0 -0 fixes in 19 projects; 36 projects unchanged)</p>
<a href="https://github.com/DisnakeDev/disnake">DisnakeDev/disnake</a> (+7 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/converter.py#L1019">disnake/ext/commands/converter.py:1019:9:</a> PLW0101 Unreachable code in `convert`
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ext/commands/slash_core.py#L56">disnake/ext/commands/slash_core.py:56:5:</a> PLW0101 Unreachable code in `_autocomplete`
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/message.py#L1328">disnake/message.py:1328:9:</a> PLW0101 Unreachable code in `_clear_emoji`
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/state.py#L2531">disnake/state.py:2531:9:</a> PLW0101 Unreachable code in `_delay_ready`
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/disnake/ui/select/base.py#L234">disnake/ui/select/base.py:234:13:</a> PLW0101 Unreachable code in `_transform_default_values`
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/scripts/codemods/overloads_no_missing.py#L29">scripts/codemods/overloads_no_missing.py:29:9:</a> PLW0101 Unreachable code in `leave_FunctionDef`
+ <a href="https://github.com/DisnakeDev/disnake/blob/2ab0c535b021dd120b5a6aff67dc1c195b9913ae/scripts/codemods/typed_permissions.py#L84">scripts/codemods/typed_permissions.py:84:9:</a> PLW0101 Unreachable code in `leave_ClassDef`
</pre>

</p>

<a href="https://github.com/apache/airflow">apache/airflow</a> (+28 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/airflow-core/src/airflow/example_dags/plugins/workday.py#L57">airflow-core/src/airflow/example_dags/plugins/workday.py:57:9:</a> PLW0101 Unreachable code in `get_next_workday`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/airflow-core/src/airflow/models/dag.py#L2581">airflow-core/src/airflow/models/dag.py:2581:5:</a> PLW0101 Unreachable code in `_run_task`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/airflow-core/tests/unit/serialization/test_dag_serialization.py#L636">airflow-core/tests/unit/serialization/test_dag_serialization.py:636:9:</a> PLW0101 Unreachable code in `test_deserialization_across_process`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/amazon/src/airflow/providers/amazon/aws/hooks/quicksight.py#L169">providers/amazon/src/airflow/providers/amazon/aws/hooks/quicksight.py:169:9:</a> PLW0101 Unreachable code in `wait_for_state`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/amazon/src/airflow/providers/amazon/aws/hooks/redshift_data.py#L269">providers/amazon/src/airflow/providers/amazon/aws/hooks/redshift_data.py:269:9:</a> PLW0101 Unreachable code in `get_table_primary_key`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/amazon/src/airflow/providers/amazon/aws/hooks/sagemaker.py#L760">providers/amazon/src/airflow/providers/amazon/aws/hooks/sagemaker.py:760:9:</a> PLW0101 Unreachable code in `check_status`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/amazon/src/airflow/providers/amazon/aws/hooks/sagemaker.py#L843">providers/amazon/src/airflow/providers/amazon/aws/hooks/sagemaker.py:843:9:</a> PLW0101 Unreachable code in `check_training_status_with_log`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/amazon/src/airflow/providers/amazon/aws/transfers/dynamodb_to_s3.py#L249">providers/amazon/src/airflow/providers/amazon/aws/transfers/dynamodb_to_s3.py:249:9:</a> PLW0101 Unreachable code in `_scan_dynamodb_and_upload_to_s3`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/apache/beam/src/airflow/providers/apache/beam/hooks/beam.py#L200">providers/apache/beam/src/airflow/providers/apache/beam/hooks/beam.py:200:5:</a> PLW0101 Unreachable code in `run_beam_command`
+ <a href="https://github.com/apache/airflow/blob/42024188b9553dd50072e717af754cb95c901972/providers/cncf/kubernetes/src/airflow/providers/cncf/kubernetes/utils/pod_manager.py#L659">providers/cncf/kubernetes/src/airflow/providers/cncf/kubernetes/utils/pod_manager.py:659:9:</a> PLW0101 Unreachable code in `await_pod_completion`
... 18 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/apache/superset">apache/superset</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/superset/blob/79afc2b545a21719eba6fce9136d3041af4e1428/superset/commands/importers/v1/utils.py#L323">superset/commands/importers/v1/utils.py:323:5:</a> PLW0101 Unreachable code in `get_resource_mappings_batched`
+ <a href="https://github.com/apache/superset/blob/79afc2b545a21719eba6fce9136d3041af4e1428/superset/migrations/shared/native_filters.py#L95">superset/migrations/shared/native_filters.py:95:13:</a> PLW0101 Unreachable code in `convert_filter_scopes_to_native_filters`
+ <a href="https://github.com/apache/superset/blob/79afc2b545a21719eba6fce9136d3041af4e1428/superset/tasks/cache.py#L311">superset/tasks/cache.py:311:5:</a> PLW0101 Unreachable code in `cache_warmup`
+ <a href="https://github.com/apache/superset/blob/79afc2b545a21719eba6fce9136d3041af4e1428/superset/utils/slack.py#L88">superset/utils/slack.py:88:5:</a> PLW0101 Unreachable code in `get_channels`
</pre>

</p>

<a href="https://github.com/aws/aws-sam-cli">aws/aws-sam-cli</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/aws/aws-sam-cli/blob/d3c7943b96161c2a448c6b89874a3c6db42a2c42/tests/integration/local/common_utils.py#L34">tests/integration/local/common_utils.py:34:5:</a> PLW0101 Unreachable code in `wait_for_local_process`
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+2 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/support/plugins/file_server.py#L93">tests/support/plugins/file_server.py:93:9:</a> PLW0101 Unreachable code in `__init__`
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/support/plugins/selenium.py#L79">tests/support/plugins/selenium.py:79:9:</a> PLW0101 Unreachable code in `chrome`
</pre>

</p>

<a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+5 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/freedomofpress/securedrop/blob/f1d8fc671d365fed582d169252e7c4a18907d759/securedrop/management/run.py#L125">securedrop/management/run.py:125:9:</a> PLW0101 Unreachable code in `monitor`
+ <a href="https://github.com/freedomofpress/securedrop/blob/f1d8fc671d365fed582d169252e7c4a18907d759/securedrop/pretty_bad_protocol/_meta.py#L666">securedrop/pretty_bad_protocol/_meta.py:666:9:</a> PLW0101 Unreachable code in `_read_response`
+ <a href="https://github.com/freedomofpress/securedrop/blob/f1d8fc671d365fed582d169252e7c4a18907d759/securedrop/pretty_bad_protocol/_meta.py#L689">securedrop/pretty_bad_protocol/_meta.py:689:9:</a> PLW0101 Unreachable code in `_read_data`
+ <a href="https://github.com/freedomofpress/securedrop/blob/f1d8fc671d365fed582d169252e7c4a18907d759/securedrop/pretty_bad_protocol/_util.py#L137">securedrop/pretty_bad_protocol/_util.py:137:5:</a> PLW0101 Unreachable code in `_copy_data`
+ <a href="https://github.com/freedomofpress/securedrop/blob/f1d8fc671d365fed582d169252e7c4a18907d759/securedrop/tests/test_secure_tempfile.py#L92">securedrop/tests/test_secure_tempfile.py:92:5:</a> PLW0101 Unreachable code in `test_buffered_read`
</pre>

</p>

<a href="https://github.com/fronzbot/blinkpy">fronzbot/blinkpy</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/fronzbot/blinkpy/blob/e2c747b5ad295424b08ff4fb03204129155666fc/blinksync/blinksync.py#L102">blinksync/blinksync.py:102:5:</a> PLW0101 Unreachable code in `main`
</pre>

</p>

<a href="https://github.com/ibis-project/ibis">ibis-project/ibis</a> (+3 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/ibis-project/ibis/blob/66ab2a5e5405ebac1f9a60dd6cc4497cc806d8b7/ibis/backends/impala/metadata.py#L153">ibis/backends/impala/metadata.py:153:9:</a> PLW0101 Unreachable code in `_parse_schema`
+ <a href="https://github.com/ibis-project/ibis/blob/66ab2a5e5405ebac1f9a60dd6cc4497cc806d8b7/ibis/backends/impala/metadata.py#L174">ibis/backends/impala/metadata.py:174:9:</a> PLW0101 Unreachable code in `_parse_info`
+ <a href="https://github.com/ibis-project/ibis/blob/66ab2a5e5405ebac1f9a60dd6cc4497cc806d8b7/ibis/backends/impala/metadata.py#L258">ibis/backends/impala/metadata.py:258:9:</a> PLW0101 Unreachable code in `_parse_nested_params`
</pre>

</p>

<a href="https://github.com/langchain-ai/langchain">langchain-ai/langchain</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/langchain-ai/langchain/blob/8574442c5709c429f01369c5ce969be8065c2f2b/libs/core/langchain_core/runnables/base.py#L5137">libs/core/langchain_core/runnables/base.py:5137:13:</a> PLW0101 Unreachable code in `astream_events`
</pre>

</p>

<a href="https://github.com/latchbio/latch">latchbio/latch</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/latchbio/latch/blob/3d40eb57259fbea100d5022f9ab04f5bb7686857/src/latch_cli/tinyrequests.py#L111">src/latch_cli/tinyrequests.py:111:5:</a> PLW0101 Unreachable code in `_req`
</pre>

</p>

<a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+10 -1 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/bulk_import/example_bulkinsert_csv.py#L170">examples/bulk_import/example_bulkinsert_csv.py:170:5:</a> PLW0101 Unreachable code in `wait_tasks_to_state`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/bulk_import/example_bulkinsert_json.py#L212">examples/bulk_import/example_bulkinsert_json.py:212:5:</a> PLW0101 Unreachable code in `wait_tasks_to_state`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/bulk_import/example_bulkinsert_numpy.py#L214">examples/bulk_import/example_bulkinsert_numpy.py:214:5:</a> PLW0101 Unreachable code in `wait_tasks_to_state`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/bulk_import/example_bulkinsert_withfunction.py#L170">examples/bulk_import/example_bulkinsert_withfunction.py:170:5:</a> PLW0101 Unreachable code in `wait_tasks_to_state`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/bulk_import/example_bulkwriter.py#L407">examples/bulk_import/example_bulkwriter.py:407:5:</a> PLW0101 Unreachable code in `call_bulkinsert`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/bulk_import/example_bulkwriter_with_nullable.py#L319">examples/bulk_import/example_bulkwriter_with_nullable.py:319:5:</a> PLW0101 Unreachable code in `call_bulkinsert`
- <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/iterator/iterator.py#L64">examples/iterator/iterator.py:64:9:</a> PLW0101 Unreachable code in `external_filter_func`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/iterator/iterator.py#L65">examples/iterator/iterator.py:65:9:</a> PLW0101 Unreachable code in `external_filter_func`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/examples/orm/iterator.py#L124">examples/orm/iterator.py:124:5:</a> PLW0101 Unreachable code in `query_iterate_collection_no_offset`
+ <a href="https://github.com/milvus-io/pymilvus/blob/b65b4f5c6e46b2b930d48f4593032b86803e848a/pymilvus/client/search_iterator.py#L150">pymilvus/client/search_iterator.py:150:9:</a> PLW0101 Unreachable code in `next`
... 1 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+5 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/pandas-dev/pandas/blob/e5898b8d33ac943a60250e1466006c073a506e8c/pandas/_version.py#L111">pandas/_version.py:111:5:</a> PLW0101 Unreachable code in `run_command`
+ <a href="https://github.com/pandas-dev/pandas/blob/e5898b8d33ac943a60250e1466006c073a506e8c/pandas/core/sorting.py#L208">pandas/core/sorting.py:208:5:</a> PLW0101 Unreachable code in `get_group_index`
+ <a href="https://github.com/pandas-dev/pandas/blob/e5898b8d33ac943a60250e1466006c073a506e8c/pandas/io/html.py#L1007">pandas/io/html.py:1007:5:</a> PLW0101 Unreachable code in `_parse`
+ <a href="https://github.com/pandas-dev/pandas/blob/e5898b8d33ac943a60250e1466006c073a506e8c/pandas/tests/extension/test_categorical.py#L39">pandas/tests/extension/test_categorical.py:39:5:</a> PLW0101 Unreachable code in `make_data`
+ <a href="https://github.com/pandas-dev/pandas/blob/e5898b8d33ac943a60250e1466006c073a506e8c/pandas/tests/io/test_sql.py#L1169">pandas/tests/io/test_sql.py:1169:5:</a> PLW0101 Unreachable code in `test_read_iris_query_string_with_parameter`
</pre>

</p>

<a href="https://github.com/pypa/cibuildwheel">pypa/cibuildwheel</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/pypa/cibuildwheel/blob/99183d68ac491ca04c562a5de91c7287b1bd1728/cibuildwheel/oci_container.py#L461">cibuildwheel/oci_container.py:461:9:</a> PLW0101 Unreachable code in `call`
</pre>

</p>

<a href="https://github.com/rotki/rotki">rotki/rotki</a> (+51 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/accounting/accountant.py#L235">rotkehlchen/accounting/accountant.py:235:9:</a> PLW0101 Unreachable code in `process_history`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/base/modules/echo/decoder.py#L156">rotkehlchen/chain/base/modules/echo/decoder.py:156:9:</a> PLW0101 Unreachable code in `_process_funding`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/etherscan.py#L113">rotkehlchen/chain/ethereum/etherscan.py:113:9:</a> PLW0101 Unreachable code in `get_withdrawals`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/compound/v2/decoder.py#L384">rotkehlchen/chain/ethereum/modules/compound/v2/decoder.py:384:9:</a> PLW0101 Unreachable code in `decode_comp_claim`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/curve/crvusd/decoder.py#L207">rotkehlchen/chain/ethereum/modules/curve/crvusd/decoder.py:207:9:</a> PLW0101 Unreachable code in `_decode_peg_keeper_update`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/golem/decoder.py#L71">rotkehlchen/chain/ethereum/modules/golem/decoder.py:71:9:</a> PLW0101 Unreachable code in `_decode_migration`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/lido/decoder.py#L83">rotkehlchen/chain/ethereum/modules/lido/decoder.py:83:9:</a> PLW0101 Unreachable code in `_decode_lido_staking_in_steth`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/shutter/decoder.py#L77">rotkehlchen/chain/ethereum/modules/shutter/decoder.py:77:9:</a> PLW0101 Unreachable code in `_decode_shutter_claim`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/yearn/decoder.py#L239">rotkehlchen/chain/ethereum/modules/yearn/decoder.py:239:9:</a> PLW0101 Unreachable code in `_handle_transfer_events`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/ethereum/modules/yearn/utils.py#L132">rotkehlchen/chain/ethereum/modules/yearn/utils.py:132:5:</a> PLW0101 Unreachable code in `_query_yearn_vaults`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/evm/decoding/aave/common.py#L442">rotkehlchen/chain/evm/decoding/aave/common.py:442:9:</a> PLW0101 Unreachable code in `_decode_incentives_common`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/evm/decoding/balancer/utils.py#L103">rotkehlchen/chain/evm/decoding/balancer/utils.py:103:5:</a> PLW0101 Unreachable code in `query_balancer_pools`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/evm/decoding/compound/v3/decoder.py#L206">rotkehlchen/chain/evm/decoding/compound/v3/decoder.py:206:9:</a> PLW0101 Unreachable code in `_decode_supply_or_repay_event`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/evm/decoding/compound/v3/decoder.py#L356">rotkehlchen/chain/evm/decoding/compound/v3/decoder.py:356:9:</a> PLW0101 Unreachable code in `_decode_collateral_movement`
+ <a href="https://github.com/rotki/rotki/blob/c624060abdd57e365dcf35fb5aceafae422a0d06/rotkehlchen/chain/evm/decoding/curve/decoder.py#L621">rotkehlchen/chain/evm/decoding/curve/decoder.py:621:13:</a> PLW0101 Unreachable code in `_decode_deposit_and_stake`
... 36 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+17 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/actions/message_flags.py#L93">zerver/actions/message_flags.py:93:5:</a> PLW0101 Unreachable code in `do_mark_all_as_read`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/actions/realm_settings.py#L671">zerver/actions/realm_settings.py:671:9:</a> PLW0101 Unreachable code in `do_delete_all_realm_attachments`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/data_import/slack.py#L1687">zerver/data_import/slack.py:1687:5:</a> PLW0101 Unreachable code in `get_slack_api_data`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/cache.py#L327">zerver/lib/cache.py:327:5:</a> PLW0101 Unreachable code in `cache_delete_many`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/export.py#L2693">zerver/lib/export.py:2693:5:</a> PLW0101 Unreachable code in `get_id_list_gently_from_database`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/export.py#L2708">zerver/lib/export.py:2708:5:</a> PLW0101 Unreachable code in `chunkify`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/import_realm.py#L1904">zerver/lib/import_realm.py:1904:5:</a> PLW0101 Unreachable code in `get_incoming_message_ids`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/retention.py#L179">zerver/lib/retention.py:179:5:</a> PLW0101 Unreachable code in `run_archiving`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/soft_deactivation.py#L299">zerver/lib/soft_deactivation.py:299:5:</a> PLW0101 Unreachable code in `do_soft_deactivate_users`
+ <a href="https://github.com/zulip/zulip/blob/18fdbc15196bbb8501435586ff60aab2c67aa345/zerver/lib/templates.py#L190">zerver/lib/templates.py:190:5:</a> PLW0101 Unreachable code in `webpack_entry`
... 7 additional changes omitted for project
</pre>

</p>


<p><em>... Truncated remaining completed project reports due to GitHub comment length restrictions</em></p>
Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLW0101 | 165 | 164 | 1 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-04-21 19:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[WIP] Cfg loops&quot; to &quot;Control flow: loops&quot; by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-04-21 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-04-21 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:105 on 2025-04-22 15:57</div>
            <div class="timeline-body"><p>Is this the condition in a loop? Maybe <code>LoopCondition</code>? Either way, it would be great to document what this is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:155 on 2025-04-22 15:57</div>
            <div class="timeline-body"><p>A better name for the lifetime might be <code>&#x27;ast</code>, considering that both usages aren&#x27;t for statements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:161 on 2025-04-22 15:58</div>
            <div class="timeline-body"><p>I&#x27;m a bit confused by the name. Should this simply be <code>StopIteration</code> or is the condition <code>true</code> if <code>next</code> <strong>doesn&#x27;t</strong> return <code>StopIteration</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:240 on 2025-04-22 16:01</div>
            <div class="timeline-body"><p>What&#x27;s the case where <code>self.current == guard</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:254 on 2025-04-22 16:05</div>
            <div class="timeline-body"><p>The fact that it&#x27;s the caller&#x27;s responsibility to ensure the <em><code>conditions</code> and <code>targets</code> must wlays be of the same length</em> constraint seems a bit fragile. How about an API like:</p>
<pre><code>let edges = Edges::default()
    .add(body, Condition::Test(&amp;stmt_while.test))
    .add(guard_target, Condition::Else);
</code></pre>
<p>It also makes it clearer how the targets and conditions belong together (I had to look at the source of <code>Edges</code> to understand the <code>conditions</code> variable.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:229 on 2025-04-22 16:08</div>
            <div class="timeline-body"><p>Is the <code>end + 1</code> indexing safe? What if the loop is the last statement?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:450 on 2025-04-22 16:11</div>
            <div class="timeline-body"><p>Nit: lets separete the words.</p>
<pre><code>        let Some(current_block) = self.cfg.blocks.get_mut(self.current) else {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:350 on 2025-04-22 16:14</div>
            <div class="timeline-body"><p>The parser could very well create an AST where a break statement is used outside a loop. That&#x27;s why I&#x27;d prefer to handle this case gracefully (simply ignore the break statement if outside a loop, treat it like any other statement). Unless there&#x27;s some documentation saying that the AST must be valid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:367 on 2025-04-22 16:15</div>
            <div class="timeline-body"><p>I guess that&#x27;s the same as <code>start &lt; stmts.len()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:486 on 2025-04-22 16:17</div>
            <div class="timeline-body"><p>Nit: I find it useful to add assertion that &quot;stack&quot; variables are empty once the builder phase is completed. It helped me in the past to find bugs. You could add a <code>asser_eq!(self.loops, &amp;[])</code> to <code>CfgBuilder::finish</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-04-22 16:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-26 20:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:229 on 2025-04-26 20:33</div>
            <div class="timeline-body"><p>yep it&#x27;s safe: https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=85e85507ac6e36cf45c499bc4d438d59</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-10-24 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-10 17:41</div>
            <div class="timeline-body"><p>@dylwil3 should we close the CFG PRs. It&#x27;s a shame but it doesn&#x27;t look like we&#x27;ll get back to them anytime soon (too much else that&#x27;s on our plate).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-10 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-10 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-10 18:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:55 UTC
    </footer>
</body>
</html>
