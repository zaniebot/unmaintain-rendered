<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`fastapi`] Handle ellipsis defaults in FAST002 autofix (`FAST002`) - astral-sh/ruff #20810</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>fastapi</code>] Handle ellipsis defaults in FAST002 autofix (<code>FAST002</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20810">#20810</a>
        opened by <a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a>
        on 2025-10-11 12:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Implement handling of ellipsis (<code>...</code>) defaults in the <code>FAST002</code> autofix to correctly differentiate between required and optional parameters in FastAPI route definitions.</p>
<p>Previously, the autofix did not properly handle cases where parameters used <code>...</code> as a default value (to indicate required parameters). This could lead to incorrect transformations when applying the autofix.</p>
<p>This change updates the <code>FAST002</code> autofix logic to:</p>
<ul>
<li>Correctly recognize <code>...</code> as a valid FastAPI required default.</li>
<li>Preserve the semantics of required parameters while still applying other autofix improvements.</li>
<li>Avoid incorrectly substituting or removing ellipsis defaults.</li>
</ul>
<p>Fixes https://github.com/astral-sh/ruff/issues/20800</p>
<h2>Test Plan</h2>
<p>Added a new test fixture at:
<code>crates/ruff_linter/resources/test/fixtures/fastapi/FAST002_2.py</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-10-15 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-10-15 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/fastapi/FAST002_2.py</code>:108 on 2025-10-15 19:01</div>
            <div class="timeline-body"><p>I think we could probably omit these cases since <code>Depends</code> and <code>Security</code> don't take ellipsis arguments. Is that right?</p>
<p>The names feel slightly misleading to me since there aren't ellipses in these examples, and we have other tests for <code>Depends</code> and <code>Security</code> in FAST002_1.py.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/fastapi/FAST002_2.py</code>:118 on 2025-10-15 19:03</div>
            <div class="timeline-body"><p>Do we have a test case where we bail out  because we removed a default? I think swapping the order of these two parameters to trigger that behavior might be more interesting, unless I missed another case like that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-10-15 19:05</div>
            <div class="timeline-body"><p>Thank you! This looks great. I just had a couple of small ideas/suggestions about the tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-15 19:06</div>
            <div class="timeline-body"><p>It looks like the linux test failure was just a transient issue. The only real CI problem is the formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> on 2025-10-16 00:57</div>
            <div class="timeline-body"><p>Thanks for the review! I’ll update it soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> reviewed on 2025-10-16 01:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> on <code>crates/ruff_linter/resources/test/fixtures/fastapi/FAST002_2.py</code>:118 on 2025-10-16 01:02</div>
            <div class="timeline-body"><p>Interesting thought! I’ll update it to include that case soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> on <code>crates/ruff_linter/resources/test/fixtures/fastapi/FAST002_2.py</code>:108 on 2025-10-16 01:07</div>
            <div class="timeline-body"><p>Oh right, I’ll remove those cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> reviewed on 2025-10-16 01:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @hengky-kurniawan-1 on 2025-10-16 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-10-20 21:49</div>
            <div class="timeline-body"><p>Thank you! We just need to update one more minor thing in the snapshots.</p>
<p>I tried to push a commit, but GitHub said I didn't have permission. Sorry for the trouble!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-10-20 21:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/fastapi/snapshots/ruff_linter__rules__fastapi__tests__fast-api-non-annotated-dependency_FAST002_2.py.snap</code>:273 on 2025-10-20 21:50</div>
            <div class="timeline-body"><p>It looks like this comment is just outdated. The new comment in the .py file looks perfect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> reviewed on 2025-10-21 01:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hengky-kurniawan-1">@hengky-kurniawan-1</a> on <code>crates/ruff_linter/src/rules/fastapi/snapshots/ruff_linter__rules__fastapi__tests__fast-api-non-annotated-dependency_FAST002_2.py.snap</code>:273 on 2025-10-21 01:49</div>
            <div class="timeline-body"><p>Nice catch.
I’ve updated the snapshot accordingly. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-10-21 02:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-10-21 02:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-21 02:52</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:16:21 UTC
    </footer>
</body>
</html>
