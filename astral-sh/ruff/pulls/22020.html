<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Experiment - astral-sh/ruff #22020</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Experiment</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22020">#22020</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-12-17 11:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Just an experiment, entirely written by claude. I didn&#x27;t review the code. There&#x27;s at least one test failure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-17 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-17 11:27</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ‚úÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-17 11:45</div>
            <div class="timeline-body"><p>Well, what claude did here is certainly useless üòÜ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-12-17 11:46</div>
            <div class="timeline-body">

<a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a>
Merging #22020 will <strong>degrade performances by 16.86%</strong>
<p>Comparing <code>micha/has_relation_to</code> (39b5c69) with <code>main</code> (85af715)</p>
Summary
<p><code>‚ö° 3</code> improvements<br>
<code>‚ùå 3</code> regressions<br>
<code>‚úÖ 16</code> untouched<br>
<code>‚è© 30</code> skipped[^skipped]</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?utm_source=github&amp;utm_medium=comment&amp;utm_content=acknowledge">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Mode | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | ---- | --------- | ------ | ------ | ------ |
| ‚ùå | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Alarge%5Bpydantic%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>large[pydantic]</code></a> | 216.2 s | 260 s | -16.86% |
| ‚ö° | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Amedium%5Bstatic-frame%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>medium[static-frame]</code></a> | 20.2 s | 18.4 s | +9.93% |
| ‚ö° | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Amedium%5Bpandas%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>medium[pandas]</code></a> | 66.4 s | 61 s | +8.94% |
| ‚ö° | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Amedium%5Bcolour-science%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>medium[colour-science]</code></a> | 106 s | 44.1 s | √ó2.4 |
| ‚ùå | Simulation | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?uri=crates%2Fruff_benchmark%2Fbenches%2Fty.rs%3A%3Aproject%3A%3Ahydra%3A%3Aproject%3A%3Ahydra-zen&amp;runnerMode=Instrumentation&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>hydra-zen</code></a> | 1.3 s | 1.4 s | -4.03% |
| ‚ùå | Simulation | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?uri=crates%2Fruff_benchmark%2Fbenches%2Fty.rs%3A%3Amicro%3A%3Abenchmark_many_enum_members%3A%3Aty_micro%5Bmany_enum_members%5D&amp;runnerMode=Instrumentation&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>ty_micro[many_enum_members]</code></a> | 123.4 ms | 129.1 ms | -4.45% |
[^skipped]: 30 benchmarks were skipped, so the baseline results were used instead. If they were deleted from the codebase, <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fhas_relation_to?sectionId=benchmark-comparison-section-baseline-result-skipped&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=archive">click here and archive them to remove them from the performance reports</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-17 11:48</div>
            <div class="timeline-body"><p>What claude did was caching <code>has_relation_to</code> in addition to <code>is_redudant_to</code>. This does show very promising results on <code>colour-science</code> (2x improvement) but it also significantely increases memory usage (we would want within revision GC)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-17 11:50</div>
            <div class="timeline-body"><blockquote>
<p>This does show very promising results on <code>colour-science</code> (2x improvement) but it also significantely increases memory usage (we would want within revision GC)</p>
</blockquote>
<p>it also shows us getting significantly worse on some of the codebases where we already have our most pathological performance (pydantic). And there are new panics in the mypy_primer CI job.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-17 11:53</div>
            <div class="timeline-body"><blockquote>
<p>it also shows us getting significantly worse on some of the codebases where we already have our most pathological performance (pydantic). And there are new panics in the mypy_primer CI job.</p>
</blockquote>
<p>Oh I know. I&#x27;m not saying we should do this or this is in any way a good PR (see summary)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-18 17:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:21:48 UTC
    </footer>
</body>
</html>
