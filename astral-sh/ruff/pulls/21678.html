<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix subtyping of `type[Any]` / `type[T]` and protocols - astral-sh/ruff #21678</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix subtyping of <code>type[Any]</code> / <code>type[T]</code> and protocols</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21678">#21678</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-11-28 14:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-28 14:19</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a bugfix for subtyping of <code>type[Any]</code> / <code>type[T]</code> and protocols.</p>
<h2>Test Plan</h2>
<p>Regression test that will only be really meaningful once https://github.com/astral-sh/ruff/pull/21553 lands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-11-28 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-28 14:21</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-28 14:23</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">beartype (https://github.com/beartype/beartype)
+ beartype/claw/_package/clawpkgtrie.py:66:29: warning[unsupported-base] Unsupported class base with type `&lt;class 'dict[str, PackagesTrieBlacklist]'&gt; | &lt;class 'dict[str, Divergent]'&gt;`
+ beartype/claw/_package/clawpkgtrie.py:247:29: warning[unsupported-base] Unsupported class base with type `&lt;class 'dict[str, PackagesTrieWhitelist]'&gt; | &lt;class 'dict[str, Divergent]'&gt;`
- Found 498 diagnostics
+ Found 500 diagnostics

xarray (https://github.com/pydata/xarray)
- xarray/core/common.py:1702:22: error[invalid-assignment] Object of type `(_SupportsDType[dtype[Any]] &amp; Top[Mapping[Unknown, object]]) | (str &amp; Top[Mapping[Unknown, object]]) | (tuple[Any, SupportsIndex | Sequence[SupportsIndex]] &amp; Top[Mapping[Unknown, object]]) | ... omitted 3 union elements` is not assignable to `Mapping[Any, dtype[Any] | None | _SupportsDType[dtype[Any]] | ... omitted 4 union elements]`
+ xarray/core/common.py:1702:22: error[invalid-assignment] Object of type `(type[Any] &amp; Top[Mapping[Unknown, object]]) | (str &amp; Top[Mapping[Unknown, object]]) | (tuple[Any, SupportsIndex | Sequence[SupportsIndex]] &amp; Top[Mapping[Unknown, object]]) | ... omitted 4 union elements` is not assignable to `Mapping[Any, dtype[Any] | None | type[Any] | ... omitted 5 union elements]`
- xarray/tests/test_dataarray.py:4157:18: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_dataarray.py:4163:13: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_dataset.py:6905:18: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_dataset.py:6921:18: error[no-matching-overload] No overload of function `full_like` matches arguments
+ xarray/tests/test_plot.py:232:64: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ xarray/tests/test_plot.py:1320:55: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- xarray/tests/test_variable.py:2837:34: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_variable.py:2844:13: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_variable.py:2863:13: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_variable.py:2883:26: error[no-matching-overload] No overload of function `zeros_like` matches arguments
- xarray/tests/test_variable.py:2883:55: error[no-matching-overload] No overload of function `full_like` matches arguments
- xarray/tests/test_variable.py:2890:26: error[no-matching-overload] No overload of function `ones_like` matches arguments
- xarray/tests/test_variable.py:2890:54: error[no-matching-overload] No overload of function `full_like` matches arguments
- Found 1786 diagnostics
+ Found 1777 diagnostics

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
+ src/scikit_build_core/_logging.py:153:13: warning[unsupported-base] Unsupported class base with type `&lt;class 'Mapping[str, Style]'&gt; | &lt;class 'Mapping[str, Divergent]'&gt;`
- Found 41 diagnostics
+ Found 42 diagnostics

jax (https://github.com/google/jax)
- jax/_src/cudnn/scaled_matmul_stablehlo.py:689:54: error[invalid-argument-type] Argument to function `scaled_dot_general_transpose_rhs` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `Unknown | list[Unknown]`
+ jax/_src/cudnn/scaled_matmul_stablehlo.py:689:54: error[invalid-argument-type] Argument to function `scaled_dot_general_transpose_rhs` is incorrect: Expected `str | type[Any] | dtype[Any] | SupportsDType`, found `Unknown | list[Unknown]`
- jax/_src/dtypes.py:637:45: error[invalid-assignment] Object of type `(SupportsDType &amp; tuple[object, ...]) | tuple[str | SupportsDType | dtype[Any], ...]` is not assignable to `tuple[str | SupportsDType | dtype[Any], ...]`
+ jax/_src/dtypes.py:637:45: error[invalid-assignment] Object of type `(SupportsDType &amp; tuple[object, ...]) | tuple[str | type[Any] | dtype[Any] | SupportsDType, ...]` is not assignable to `tuple[str | type[Any] | dtype[Any] | SupportsDType, ...]`
- jax/_src/lax/lax.py:5901:54: error[invalid-argument-type] Argument to function `dot_algorithm_attr` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `str | SupportsDType | dtype[Any] | None`
+ jax/_src/lax/lax.py:5901:54: error[invalid-argument-type] Argument to function `dot_algorithm_attr` is incorrect: Expected `str | type[Any] | dtype[Any] | SupportsDType`, found `str | type[Any] | dtype[Any] | SupportsDType | None`
- jax/_src/lax/lax.py:5901:65: error[invalid-argument-type] Argument to function `dot_algorithm_attr` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `str | SupportsDType | dtype[Any] | None`
+ jax/_src/lax/lax.py:5901:65: error[invalid-argument-type] Argument to function `dot_algorithm_attr` is incorrect: Expected `str | type[Any] | dtype[Any] | SupportsDType`, found `str | type[Any] | dtype[Any] | SupportsDType | None`
- jax/_src/lax/linalg.py:2707:19: error[invalid-argument-type] Argument to function `_tri` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'bool'&gt;`
- jax/_src/lax/linalg.py:2712:19: error[invalid-argument-type] Argument to function `_tri` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'bool'&gt;`
- jax/_src/lax/other.py:224:7: error[invalid-argument-type] Argument to function `conv_general_dilated_patches` is incorrect: Expected `Precision | None`, found `None | Precision | str | SupportsDType | dtype[Any]`
+ jax/_src/lax/other.py:224:7: error[invalid-argument-type] Argument to function `conv_general_dilated_patches` is incorrect: Expected `Precision | None`, found `None | Precision | str | ... omitted 3 union elements`
- jax/_src/numpy/array_methods.py:566:41: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'bool'&gt;`
- jax/_src/numpy/lax_numpy.py:5489:37: error[invalid-parameter-default] Default value of type `&lt;class 'float'&gt;` is not assignable to annotated parameter type `str | SupportsDType | dtype[Any]`
- jax/_src/numpy/lax_numpy.py:5637:21: error[invalid-parameter-default] Default value of type `&lt;class 'float'&gt;` is not assignable to annotated parameter type `str | SupportsDType | dtype[Any]`
- jax/_src/numpy/lax_numpy.py:5723:29: error[invalid-parameter-default] Default value of type `&lt;class 'float'&gt;` is not assignable to annotated parameter type `str | SupportsDType | dtype[Any]`
- jax/_src/numpy/lax_numpy.py:8269:60: error[invalid-argument-type] Argument to function `argmax` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'int'&gt;`
- jax/_src/numpy/lax_numpy.py:8330:60: error[invalid-argument-type] Argument to function `argmin` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'int'&gt;`
- jax/_src/numpy/lax_numpy.py:9021:40: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'bool'&gt;`
- jax/_src/numpy/lax_numpy.py:9351:81: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `type`
- jax/_src/numpy/reductions.py:2542:35: error[invalid-argument-type] Argument to function `broadcasted_iota` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'int'&gt;`
- jax/_src/numpy/ufuncs.py:1204:40: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'bool'&gt;`
- jax/_src/numpy/ufuncs.py:1248:40: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'bool'&gt;`
- jax/_src/pallas/mosaic_gpu/lowering.py:1407:13: error[invalid-assignment] Object of type `str | SupportsDType | dtype[Any] | None` is not assignable to `dtype[Any]`
+ jax/_src/pallas/mosaic_gpu/lowering.py:1407:13: error[invalid-assignment] Object of type `str | type[Any] | dtype[Any] | SupportsDType | None` is not assignable to `dtype[Any]`
- jax/_src/pallas/mosaic_gpu/lowering.py:2054:60: error[invalid-argument-type] Argument to function `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/_src/random.py:816:47: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/_src/scipy/linalg.py:2194:28: error[invalid-argument-type] Argument to function `broadcasted_iota` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'float'&gt;`
- jax/_src/tpu/linalg/eigh.py:621:32: error[invalid-argument-type] Argument to function `_tri` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'bool'&gt;`
- jax/_src/tpu/linalg/eigh.py:623:48: error[invalid-argument-type] Argument to function `_tri` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'bool'&gt;`
- jax/_src/tpu/linalg/eigh.py:627:37: error[invalid-argument-type] Argument to function `_tri` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'bool'&gt;`
- jax/_src/tpu/linalg/eigh.py:629:53: error[invalid-argument-type] Argument to function `_tri` is incorrect: Expected `str | SupportsDType | dtype[Any]`, found `&lt;class 'bool'&gt;`
- jax/experimental/jax2tf/tests/flax_models/seq2seq_lstm.py:83:41: error[invalid-argument-type] Argument to function `zeros` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'bool'&gt;`
- jax/experimental/pallas/ops/gpu/attention.py:662:68: error[invalid-argument-type] Argument to function `ones` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'bool'&gt;`
- jax/experimental/pallas/ops/gpu/transposed_ragged_dot_mgpu.py:59:21: error[invalid-argument-type] Argument to function `zeros` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/pallas/ops/gpu/transposed_ragged_dot_mgpu.py:60:12: error[invalid-argument-type] Argument to bound method `astype` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:582:94: error[invalid-argument-type] Argument to function `zeros` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:1122:53: error[invalid-argument-type] Argument to function `array` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:1123:53: error[invalid-argument-type] Argument to function `array` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:1124:85: error[invalid-argument-type] Argument to function `array` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:1125:85: error[invalid-argument-type] Argument to function `array` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:1758:34: error[invalid-argument-type] Argument to function `array` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- jax/experimental/sparse/bcoo.py:2238:46: error[invalid-argument-type] Argument to function `array` is incorrect: Expected `str | SupportsDType | dtype[Any] | None`, found `&lt;class 'int'&gt;`
- Found 2733 diagnostics
+ Found 2702 diagnostics


</code></pre>
</details>

<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-28 14:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/libraries/numpy.md</code>:49 on 2025-11-28 14:29</div>
            <div class="timeline-body"><p>These errors prevent us from running into the problem on <code>main</code>. But on https://github.com/astral-sh/ruff/pull/21553, these errors will go away, and then we need to properly understand all of this code here, or otherwise we see <code>np.array</code> calls failing all over the place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-11-28 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2025-11-28 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-11-28 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @sharkdp on 2025-11-28 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2476 on 2025-11-28 14:33</div>
            <div class="timeline-body"><p>but <code>type[T]</code> should always be <em>assignable</em> to a protocol-instance if <code>T</code>'s upper bound is assignable to the protocol-instance, right?</p>
<pre><code class="language-suggestion">            (Type::SubclassOf(self_subclass_ty), Type::ProtocolInstance(_))
                if self_subclass_ty.is_type_var() &amp;&amp; relation.is_assignability() =&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2489 on 2025-11-28 14:35</div>
            <div class="timeline-body"><p>I think the <code>type[Dynamic]</code> assignability case is already handled by the generalised member-lookup approach that <code>Type::satisfies_protocol()</code> does in the branch immediately below this one. What we really want to do in this branch is block subtyping for <code>type[Dynamic]</code>:</p>
<pre><code class="language-suggestion">            // `type[Any]` is assignable to arbitrary protocols as it has arbitrary attributes
            // (this is handled by a lower-down branch), but it is only a subtype of
            // a given protocol if `type` is a subtype of that protocol
            (Type::SubclassOf(self_subclass_ty), Type::ProtocolInstance(_))
                if self_subclass_ty.is_dynamic() &amp;&amp; !relation.is_assignability() =&gt;
            {
                KnownClass::Type.to_instance(db).has_relation_to_impl(
                    db,
                    target,
                    inferable,
                    relation,
                    relation_visitor,
                    disjointness_visitor,
                ),
            }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-28 14:36</div>
            <div class="timeline-body"><p>Some suggestions, but they're untested, so accept them with care ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-28 14:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2476 on 2025-11-28 14:51</div>
            <div class="timeline-body"><p>Do you mean: this branch should <em>return</em> <code>ConstraintSet::from(relation.is_assignability())</code>? Because if we guard it with <code>is_assignability</code>, the workaround would not be effective.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-28 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2476 on 2025-11-28 14:54</div>
            <div class="timeline-body"><p>Ah, right, yeah -- I think I got the polarity the wrong way round?</p>
<pre><code class="language-suggestion">            (Type::SubclassOf(self_subclass_ty), Type::ProtocolInstance(_))
                if self_subclass_ty.is_type_var() &amp;&amp; !relation.is_assignability() =&gt;
</code></pre>
<p>I don't think the body of the branch should be <code>ConstraintSet::from(relation.is_assignability())</code> -- if the relation is <code>TypeRelation::Assignability</code>, we only want the assignability check to hold for <code>type[T] &lt;: P</code> if the meta-type of <code>T</code>'s upper bound is assignable to <code>P</code> (we want to fall through to a later branch that should handle that for us)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-28 14:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2476 on 2025-11-28 14:57</div>
            <div class="timeline-body"><p>No, you probably meant <code>&amp;&amp; !relation.is_assignability()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-28 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-28 15:08</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 0 | 28 | 4 |
| <code>no-matching-overload</code> | 0 | 11 | 0 |
| <code>invalid-assignment</code> | 0 | 0 | 3 |
| <code>invalid-parameter-default</code> | 0 | 3 | 0 |
| <code>unused-ignore-comment</code> | 2 | 0 | 0 |
| <strong>Total</strong> | <strong>2</strong> | <strong>42</strong> | <strong>7</strong> |</p>
<p><strong><a href="https://david-numpy-workaround.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://david-numpy-workaround.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-28 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2494 on 2025-11-28 15:10</div>
            <div class="timeline-body"><p>and now that I look at it again, can these not be collapsed into a single branch? <code>type[T]</code> should always be a subtype of <code>P</code> if <code>type</code> is a subtype of <code>P</code>, since all <code>type[T]</code> branches will be a subtype of <code>type</code> no matter what the <code>T</code> type variable is solved to. So it's the exact same principle as with <code>type[Any]</code>.</p>
<pre><code class="language-suggestion">            // TODO: The following two branches are a temporary workaround to prevent an important union type
            // in numpy's internals from collapsing to a single type, which causes thousands of downstream
            // false positive diagnostics across the ecosytem. See https://github.com/astral-sh/ty/issues/1666
            // for details.
            //
            // `type[Any]` is assignable to arbitrary protocols as it has arbitrary attributes
            // (this is handled by a lower-down branch), but it is only a subtype of
            // a given protocol if `type` is a subtype of that protocol. Similarly,
            // `type[T]` will always be assignable to any protocol if `type[&lt;upper bound of T&gt;]`
            // is assignable to that protocol (handled lower down), but it is only a
            // subtype of that protocol if `type` is a subtype of that protocol.
            (Type::SubclassOf(self_subclass_ty), Type::ProtocolInstance(_))
                if (self_subclass_ty.is_dynamic() || self_subclass_ty.is_type_var()) &amp;&amp; !relation.is_assignability() =&gt;
            {
                KnownClass::Type.to_instance(db).has_relation_to_impl(
                    db,
                    target,
                    inferable,
                    relation,
                    relation_visitor,
                    disjointness_visitor,
                )
            }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Workaround for problem with numpy's `dtype`" to "[ty] Fix subtyping of `type[Any]` / `type[T]` and protocols" by @sharkdp on 2025-11-28 15:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-11-28 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-28 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:2494 on 2025-11-28 15:26</div>
            <div class="timeline-body"><p>Thank you Alex!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-28 15:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-11-28 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-11-28 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-28 15:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:48:28 UTC
    </footer>
</body>
</html>
