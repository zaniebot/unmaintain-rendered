<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test snapshots with inline checks - astral-sh/ruff #681</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Test snapshots with inline checks</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/681">#681</a>
        opened by <a href="https://github.com/squiddy">@squiddy</a>
        on 2022-11-11 11:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a></div>
            <div class="timeline-body"><p>This is a massive diff because I&#x27;m introducing new snapshots. The first and third commit are the relevant ones. To motivate this a bit:</p>
<p>When developing new lints or checking existing lints, I did one of these two things:</p>
<ul>
<li>manually &quot;translated&quot; the location from the yaml snapshot and check against the test fixture</li>
<li>run cargo against the test fixtures</li>
</ul>
<p>I also noticed that some test fixtures have inline comments/decorators to clarify what is expected.</p>
<hr>
<p>What I&#x27;m doing here is to add a new snapshot (to potentially replace the existing one eventually) that inlines the checks into the source code, similar to what we&#x27;d expect with <a href="https://github.com/charliermarsh/ruff/issues/525">charliermarsh/ruff#525</a> (which I&#x27;ve been looking into, hence this first step).
Looking at these snapshots it&#x27;s easier to visually confirm the correct location (currently just row based though).</p>
<p>What I did notice is that in some cases the end location is pretty far off, due to whitespace following it. The third commit is an attempt to narrow down this location to have a closer match.</p>
<p>Example initial snapshot</p>
<p><img src="https://user-images.githubusercontent.com/50333/201335542-b6fed52e-cf6b-400d-862e-d66c275a89f4.png" alt="carbon"></p>
<p>Example snapshot with narrowed down location</p>
<p><img src="https://user-images.githubusercontent.com/50333/201335537-6f47f535-813b-48da-b92c-ee36459673e9.png" alt="carbon2"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/squiddy">@squiddy</a> on 2022-11-11 12:01</div>
            <div class="timeline-body"><p>For narrowing down I need to check whether this is actually necessary or, in case the end points to the start of a line, I&#x27;ll just report the end of the check for the line before. Might just be being confused by the locations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/squiddy">@squiddy</a> on 2022-11-12 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-11-12 13:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:26 UTC
    </footer>
</body>
</html>
