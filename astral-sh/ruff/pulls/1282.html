<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>generate-check-code-prefix: Run `rustfmt` automatically; only write if changed - astral-sh/ruff #1282</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>generate-check-code-prefix: Run <code>rustfmt</code> automatically; only write if changed</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1282">#1282</a>
        opened by <a href="https://github.com/andersk">@andersk</a>
        on 2022-12-18 20:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/andersk">@andersk</a> on 2022-12-18 20:12</div>
            <div class="timeline-body"><p>This avoids unnecessary recompilation when nothing changed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a> reviewed on 2022-12-18 21:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/squiddy">@squiddy</a> on <code>ruff_dev/Cargo.toml</code>:19 on 2022-12-18 21:01</div>
            <div class="timeline-body"><p>Just curious, why the dependency on this crate and not <code>std::process</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andersk">@andersk</a> reviewed on 2022-12-18 21:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/andersk">@andersk</a> on <code>ruff_dev/Cargo.toml</code>:19 on 2022-12-18 21:42</div>
            <div class="timeline-body"><p><code>std::process</code> doesnâ€™t have the functionality of simultaneously writing to and reading from the child in a <a href="https://docs.rs/subprocess/latest/subprocess/struct.Popen.html#method.communicate_start">deadlock-free way</a>:</p>
<blockquote>
<p>The difference between this and simply writing input data to <code>self.stdin</code> and then reading output from <code>self.stdout</code> and <code>self.stderr</code> is that the reading and the writing are performed simultaneously. A naive implementation that writes and then reads has an issue when the subprocess responds to part of the input by providing output. The output must be read for the subprocess to accept further input, but the parent process is still blocked on writing the rest of the input daata. Since neither process can proceed, a deadlock occurs. This is why a correct implementation must write and read at the same time.</p>
</blockquote>
<p>But actually, it looks like <code>rustfmt</code> always buffers all input before starting to write, so maybe <code>std::process</code> is fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2022-12-18 22:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-18 22:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 05:38:26 UTC
    </footer>
</body>
</html>
