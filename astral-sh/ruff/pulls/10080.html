<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set PowerPC Page Size to 64KB - astral-sh/ruff #10080</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Set PowerPC Page Size to 64KB</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10080">#10080</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-02-22 13:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>Fixes <a href="https://github.com/astral-sh/ruff/issues/10073">astral-sh/ruff#10073</a></p>
<p>We had a similar issue with aarch64 and the fix was to increase the page size to 64KB: <a href="https://github.com/astral-sh/ruff/issues/3791">astral-sh/ruff#3791</a>#issuecomment-1488100121</p>
<blockquote>
<p>The issue seems to be that jemalloc is compiled with fixed page sizes and using a larger page size than what it is compiled for segfaults. But jemalloc supports running on systems with smaller page sizes then configured at compile time.
Sources: [<a href="https://github.com/jemalloc/jemalloc/issues/467">1</a>, <a href="https://gitlab.com/gitlab-org/omnibus-gitlab/-/merge_requests/4800">2</a>]</p>
</blockquote>
<p>This PR does the same for PowerPC because widely used PowerPC systems use a default page size of 64KB <a href="https://www.talospace.com/2020/10/where-did-64k-page-size-come-from.html">source</a></p>
Test Plan
<p>@nwf tested the built binary on their power pc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-22 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-22 17:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-22 18:46</div>
            <div class="timeline-body"><p>@nwf could you try one of the power pc binaries from (either wheel or from binaries) and report back if they are now working for you?</p>
<p>https://github.com/astral-sh/ruff/actions/runs/8005385997#artifacts</p>
<p>I can&#x27;t test it myself because I don&#x27;t have a power pc cpu</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwf">@nwf</a> on 2024-02-23 05:35</div>
            <div class="timeline-body"><p>Much better, thanks!</p>
<pre><code>0abaa1dc35a7% ./ruff 
Ruff: An extremely fast Python linter.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 07:32</div>
            <div class="timeline-body"><p>Awesome. Thank you @nwf for testing the change</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-23 07:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:01:45 UTC
    </footer>
</body>
</html>
