<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] use the name span rather than the statement span for unresolved `global` lints - astral-sh/ruff #19379</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] use the name span rather than the statement span for unresolved <code>global</code> lints</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19379">#19379</a>
        opened by <a href="https://github.com/oconnor663">@oconnor663</a>
        on 2025-07-16 00:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a></div>
            <div class="timeline-body"><p>This is a follow-up to <a href="https://github.com/astral-sh/ruff/pull/19344">astral-sh/ruff#19344</a> that improves the error formatting slightly. For example with this program:</p>
<pre><code>def f():
    global foo, bar
</code></pre>
<p>Before we printed:</p>
<pre><code>1 | def f():
2 |     global foo, bar
  |     ^^^^^^^^^^^^^^^ `foo` has no declarations or bindings in the global scope
...
1 | def f():
2 |     global foo, bar
  |     ^^^^^^^^^^^^^^^ `bar` has no declarations or bindings in the global scope
</code></pre>
<p>Now we print:</p>
<pre><code>1 | def f():
2 |     global foo, bar
  |            ^^^ `foo` has no declarations or bindings in the global scope
...
1 | def f():
2 |     global foo, bar
  |                 ^^^ `bar` has no declarations or bindings in the global scope
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-16 00:18</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>ignite (https://github.com/pytorch/ignite)
- warning[unresolved-global] tests/ignite/handlers/test_base_logger.py:320:5: Invalid global declaration of `close_counter`: `close_counter` has no declarations or bindings in the global scope
+ warning[unresolved-global] tests/ignite/handlers/test_base_logger.py:320:12: Invalid global declaration of `close_counter`: `close_counter` has no declarations or bindings in the global scope

asynq (https://github.com/quora/asynq)
- warning[unresolved-global] asynq/tests/test_contexts.py:105:5: Invalid global declaration of `expected_change_amount_base`: `expected_change_amount_base` has no declarations or bindings in the global scope
+ warning[unresolved-global] asynq/tests/test_contexts.py:105:12: Invalid global declaration of `expected_change_amount_base`: `expected_change_amount_base` has no declarations or bindings in the global scope
- warning[unresolved-global] asynq/tests/test_contexts.py:111:9: Invalid global declaration of `expected_change_amount_base`: `expected_change_amount_base` has no declarations or bindings in the global scope
+ warning[unresolved-global] asynq/tests/test_contexts.py:111:16: Invalid global declaration of `expected_change_amount_base`: `expected_change_amount_base` has no declarations or bindings in the global scope

pywin32 (https://github.com/mhammond/pywin32)
- warning[unresolved-global] Pythonwin/pywin/Demos/ocx/ocxtest.py:52:5: Invalid global declaration of `calendarParentModule`: `calendarParentModule` has no declarations or bindings in the global scope
+ warning[unresolved-global] Pythonwin/pywin/Demos/ocx/ocxtest.py:52:12: Invalid global declaration of `calendarParentModule`: `calendarParentModule` has no declarations or bindings in the global scope
- warning[unresolved-global] Pythonwin/pywin/Demos/ocx/ocxtest.py:119:5: Invalid global declaration of `videoControlModule`: `videoControlModule` has no declarations or bindings in the global scope
+ warning[unresolved-global] Pythonwin/pywin/Demos/ocx/ocxtest.py:119:12: Invalid global declaration of `videoControlModule`: `videoControlModule` has no declarations or bindings in the global scope
- warning[unresolved-global] Pythonwin/pywin/Demos/ocx/ocxtest.py:119:5: Invalid global declaration of `videoControlFileName`: `videoControlFileName` has no declarations or bindings in the global scope
+ warning[unresolved-global] Pythonwin/pywin/Demos/ocx/ocxtest.py:119:32: Invalid global declaration of `videoControlFileName`: `videoControlFileName` has no declarations or bindings in the global scope
- warning[unresolved-global] Pythonwin/pywin/test/test_pywin.py:57:9: Invalid global declaration of `teared_down`: `teared_down` has no declarations or bindings in the global scope
+ warning[unresolved-global] Pythonwin/pywin/test/test_pywin.py:57:16: Invalid global declaration of `teared_down`: `teared_down` has no declarations or bindings in the global scope
- warning[unresolved-global] win32/Lib/win32serviceutil.py:600:5: Invalid global declaration of `g_debugService`: `g_debugService` has no declarations or bindings in the global scope
+ warning[unresolved-global] win32/Lib/win32serviceutil.py:600:12: Invalid global declaration of `g_debugService`: `g_debugService` has no declarations or bindings in the global scope

pycryptodome (https://github.com/Legrandin/pycryptodome)
- warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:329:13: Invalid global declaration of `asked`: `asked` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:329:20: Invalid global declaration of `asked`: `asked` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:332:17: Invalid global declaration of `asked`: `asked` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:332:24: Invalid global declaration of `asked`: `asked` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:357:13: Invalid global declaration of `mgfcalls`: `mgfcalls` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:357:20: Invalid global declaration of `mgfcalls`: `mgfcalls` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:361:17: Invalid global declaration of `mgfcalls`: `mgfcalls` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py:361:24: Invalid global declaration of `mgfcalls`: `mgfcalls` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:9: Invalid global declaration of `DSA`: `DSA` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:16: Invalid global declaration of `DSA`: `DSA` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:9: Invalid global declaration of `Random`: `Random` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:21: Invalid global declaration of `Random`: `Random` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:9: Invalid global declaration of `bytes_to_long`: `bytes_to_long` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:29: Invalid global declaration of `bytes_to_long`: `bytes_to_long` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:9: Invalid global declaration of `size`: `size` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_DSA.py:71:44: Invalid global declaration of `size`: `size` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_RSA.py:90:9: Invalid global declaration of `RSA`: `RSA` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_RSA.py:90:16: Invalid global declaration of `RSA`: `RSA` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_RSA.py:90:9: Invalid global declaration of `Random`: `Random` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_RSA.py:90:21: Invalid global declaration of `Random`: `Random` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_RSA.py:90:9: Invalid global declaration of `bytes_to_long`: `bytes_to_long` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/PublicKey/test_RSA.py:90:29: Invalid global declaration of `bytes_to_long`: `bytes_to_long` has no declarations or bindings in the global scope
- warning[unresolved-global] lib/Crypto/SelfTest/Util/test_Counter.py:33:9: Invalid global declaration of `Counter`: `Counter` has no declarations or bindings in the global scope
+ warning[unresolved-global] lib/Crypto/SelfTest/Util/test_Counter.py:33:16: Invalid global declaration of `Counter`: `Counter` has no declarations or bindings in the global scope

mitmproxy (https://github.com/mitmproxy/mitmproxy)
- warning[unresolved-global] test/helper_tools/memoryleak.py:32:5: Invalid global declaration of `ssl`: `ssl` has no declarations or bindings in the global scope
+ warning[unresolved-global] test/helper_tools/memoryleak.py:32:18: Invalid global declaration of `ssl`: `ssl` has no declarations or bindings in the global scope

openlibrary (https://github.com/internetarchive/openlibrary)
- warning[unresolved-global] openlibrary/plugins/openlibrary/status.py:107:5: Invalid global declaration of `feature_flags`: `feature_flags` has no declarations or bindings in the global scope
+ warning[unresolved-global] openlibrary/plugins/openlibrary/status.py:107:25: Invalid global declaration of `feature_flags`: `feature_flags` has no declarations or bindings in the global scope

scikit-learn (https://github.com/scikit-learn/scikit-learn)
- warning[unresolved-global] sklearn/linear_model/tests/test_ransac.py:223:5: Invalid global declaration of `cause_skip`: `cause_skip` has no declarations or bindings in the global scope
+ warning[unresolved-global] sklearn/linear_model/tests/test_ransac.py:223:12: Invalid global declaration of `cause_skip`: `cause_skip` has no declarations or bindings in the global scope
- warning[unresolved-global] sklearn/linear_model/tests/test_ransac.py:227:9: Invalid global declaration of `cause_skip`: `cause_skip` has no declarations or bindings in the global scope
+ warning[unresolved-global] sklearn/linear_model/tests/test_ransac.py:227:16: Invalid global declaration of `cause_skip`: `cause_skip` has no declarations or bindings in the global scope

materialize (https://github.com/MaterializeInc/materialize)
- warning[unresolved-global] misc/python/materialize/scalability/executor/benchmark_executor.py:203:9: Invalid global declaration of `next_worker_id`: `next_worker_id` has no declarations or bindings in the global scope
+ warning[unresolved-global] misc/python/materialize/scalability/executor/benchmark_executor.py:203:16: Invalid global declaration of `next_worker_id`: `next_worker_id` has no declarations or bindings in the global scope
- warning[unresolved-global] misc/python/materialize/scalability/executor/benchmark_executor.py:300:9: Invalid global declaration of `next_worker_id`: `next_worker_id` has no declarations or bindings in the global scope
+ warning[unresolved-global] misc/python/materialize/scalability/executor/benchmark_executor.py:300:16: Invalid global declaration of `next_worker_id`: `next_worker_id` has no declarations or bindings in the global scope

dd-trace-py (https://github.com/DataDog/dd-trace-py)
- warning[unresolved-global] ddtrace/vendor/ply/lex.py:868:5: Invalid global declaration of `lexer`: `lexer` has no declarations or bindings in the global scope
+ warning[unresolved-global] ddtrace/vendor/ply/lex.py:868:12: Invalid global declaration of `lexer`: `lexer` has no declarations or bindings in the global scope
- warning[unresolved-global] ddtrace/vendor/ply/lex.py:874:5: Invalid global declaration of `token`: `token` has no declarations or bindings in the global scope
+ warning[unresolved-global] ddtrace/vendor/ply/lex.py:874:12: Invalid global declaration of `token`: `token` has no declarations or bindings in the global scope
- warning[unresolved-global] ddtrace/vendor/ply/lex.py:874:5: Invalid global declaration of `input`: `input` has no declarations or bindings in the global scope
+ warning[unresolved-global] ddtrace/vendor/ply/lex.py:874:19: Invalid global declaration of `input`: `input` has no declarations or bindings in the global scope
- warning[unresolved-global] ddtrace/vendor/ply/yacc.py:3224:5: Invalid global declaration of `parse`: `parse` has no declarations or bindings in the global scope
+ warning[unresolved-global] ddtrace/vendor/ply/yacc.py:3224:12: Invalid global declaration of `parse`: `parse` has no declarations or bindings in the global scope
- warning[unresolved-global] tests/internal/test_forksafe.py:351:9: Invalid global declaration of `service`: `service` has no declarations or bindings in the global scope
+ warning[unresolved-global] tests/internal/test_forksafe.py:351:16: Invalid global declaration of `service`: `service` has no declarations or bindings in the global scope
- warning[unresolved-global] tests/internal/test_settings.py:654:9: Invalid global declaration of `call_count`: `call_count` has no declarations or bindings in the global scope
+ warning[unresolved-global] tests/internal/test_settings.py:654:16: Invalid global declaration of `call_count`: `call_count` has no declarations or bindings in the global scope

scipy (https://github.com/scipy/scipy)
- warning[unresolved-global] scipy/io/tests/test_mmio.py:29:5: Invalid global declaration of `mminfo`: `mminfo` has no declarations or bindings in the global scope
+ warning[unresolved-global] scipy/io/tests/test_mmio.py:29:12: Invalid global declaration of `mminfo`: `mminfo` has no declarations or bindings in the global scope
- warning[unresolved-global] scipy/io/tests/test_mmio.py:30:5: Invalid global declaration of `mmread`: `mmread` has no declarations or bindings in the global scope
+ warning[unresolved-global] scipy/io/tests/test_mmio.py:30:12: Invalid global declaration of `mmread`: `mmread` has no declarations or bindings in the global scope
- warning[unresolved-global] scipy/io/tests/test_mmio.py:31:5: Invalid global declaration of `mmwrite`: `mmwrite` has no declarations or bindings in the global scope
+ warning[unresolved-global] scipy/io/tests/test_mmio.py:31:12: Invalid global declaration of `mmwrite`: `mmwrite` has no declarations or bindings in the global scope

sympy (https://github.com/sympy/sympy)
- warning[unresolved-global] sympy/ntheory/partitions_.py:13:5: Invalid global declaration of `_factor`: `_factor` has no declarations or bindings in the global scope
+ warning[unresolved-global] sympy/ntheory/partitions_.py:13:12: Invalid global declaration of `_factor`: `_factor` has no declarations or bindings in the global scope
- warning[unresolved-global] sympy/ntheory/partitions_.py:13:5: Invalid global declaration of `_totient`: `_totient` has no declarations or bindings in the global scope
+ warning[unresolved-global] sympy/ntheory/partitions_.py:13:21: Invalid global declaration of `_totient`: `_totient` has no declarations or bindings in the global scope
- warning[unresolved-global] sympy/testing/runtests.py:2233:9: Invalid global declaration of `text`: `text` has no declarations or bindings in the global scope
+ warning[unresolved-global] sympy/testing/runtests.py:2233:16: Invalid global declaration of `text`: `text` has no declarations or bindings in the global scope
- warning[unresolved-global] sympy/testing/runtests.py:2233:9: Invalid global declaration of `linelen`: `linelen` has no declarations or bindings in the global scope
+ warning[unresolved-global] sympy/testing/runtests.py:2233:22: Invalid global declaration of `linelen`: `linelen` has no declarations or bindings in the global scope
- warning[unresolved-global] sympy/testing/runtests.py:2238:13: Invalid global declaration of `text`: `text` has no declarations or bindings in the global scope
+ warning[unresolved-global] sympy/testing/runtests.py:2238:20: Invalid global declaration of `text`: `text` has no declarations or bindings in the global scope
- warning[unresolved-global] sympy/testing/runtests.py:2238:13: Invalid global declaration of `linelen`: `linelen` has no declarations or bindings in the global scope
+ warning[unresolved-global] sympy/testing/runtests.py:2238:26: Invalid global declaration of `linelen`: `linelen` has no declarations or bindings in the global scope

</code></pre>

No memory usage changes detected âœ…

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 00:41</div>
            <div class="timeline-body"><p>(<code>mypy_primer</code> changes are just formatting, no new/removed lints)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-16 06:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-07-16 06:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:4697 on 2025-07-16 06:11</div>
            <div class="timeline-body"><pre><code>            let Some(builder) = self.context.report_lint(&amp;UNRESOLVED_GLOBAL, name) else {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-07-16 06:12</div>
            <div class="timeline-body"><p>Nice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-16 06:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-16 06:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-16 06:15</div>
            <div class="timeline-body"><p>(Sorry, I should have said this! I added <code>internal</code> because the diagnostic being modified here hasn&#x27;t appeared in any released version of ty, so I didn&#x27;t think this PR needed a changelog entry of its own)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-16 06:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-16 06:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-07-16 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-16 15:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:40 UTC
    </footer>
</body>
</html>
