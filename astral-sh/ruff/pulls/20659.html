<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Extend FA102 with listed PEP 585-compatible APIs - astral-sh/ruff #20659</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Extend FA102 with listed PEP 585-compatible APIs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20659">#20659</a>
        opened by <a href="https://github.com/terror">@terror</a>
        on 2025-10-01 02:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a></div>
            <div class="timeline-body"><p>Resolves <a href="https://github.com/astral-sh/ruff/issues/20512">astral-sh/ruff#20512</a></p>
<p>This PR expands FA102’s preview coverage to flag every PEP 585-compatible API that breaks without from <code>from __future__ import annotations</code>, including <code>collections.abc</code>. The rule now treats asyncio futures, pathlib-style queues, weakref containers, shelve proxies, and the full <code>collections.abc</code> family as generics once preview mode is enabled.</p>
<p>Stable behavior is unchanged; the broader matching runs behind <code>is_future_required_preview_generics_enabled</code>, letting us vet the new diagnostics before marking them as stable.</p>
<p>I&#x27;ve also added a snapshot test that covers all of the newly supported  types.</p>
<p>Check out https://docs.python.org/3/library/stdtypes.html#standard-generic-classes for a list of commonly used PEP 585-compatible APIs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/terror">@terror</a> on 2025-10-01 02:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Extend FA102 with `collections.abc` types&quot; to &quot;[`ruff`] Extend FA102 with `collections.abc` types&quot; by <a href="https://github.com/terror">@terror</a> on 2025-10-01 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a> approved on 2025-10-02 00:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/amyreese">@amyreese</a> on 2025-10-02 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-02 00:32</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/preview.rs</code>:203 on 2025-10-02 20:36</div>
            <div class="timeline-body"><p>nit: this comment is generally the PR link. The description seems nice to have too, but the link is handy when working on stabilizations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_future_annotations/mod.rs</code>:69 on 2025-10-02 20:37</div>
            <div class="timeline-body"><p>We usually add a second test function like <code>fa102_preview</code> and only enable preview there. That way we can see the diff between the preview and non-preview behavior. This case is pretty straightforward, but I&#x27;d still prefer that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:159 on 2025-10-02 20:52</div>
            <div class="timeline-body"><p>I think it might make sense to inline <code>has_pep_585_generic</code> here and remove its comment about <code>as_pep_585_generic</code>. Unless I&#x27;m missing something, this is now the only reference to <code>has_pep_585_generic</code>.</p>
<p>I also found a few issues related to some of the other PEP 585 helpers here, but they seem unrelated to FA102. It looks like two of the PEP 585 helpers are only used by FA102 and two only used by UP006.</p>
<ul>
<li>https://github.com/astral-sh/ruff/pull/5454</li>
<li>https://github.com/astral-sh/ruff/pull/15250</li>
<li>https://github.com/astral-sh/ruff/issues/15251</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:168 on 2025-10-02 20:54</div>
            <div class="timeline-body"><p>Should we go ahead and add the other <a href="https://peps.python.org/pep-0585/#implementation">PEP 585</a>/<a href="https://docs.python.org/3/library/stdtypes.html#standard-generic-classes">standard generic aliases</a> while we&#x27;re here?</p>
<p>That&#x27;s actually how I found the related issues above, but it seems safer to do here than in the UP rule helpers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-10-02 20:55</div>
            <div class="timeline-body"><p>Nice! This looks good to me overall. I just had a couple of small nits and one question/suggestion to handle other PEP-585 generics while we&#x27;re here. But I&#x27;m curious to hear your and @amyreese&#x27;s thoughts on that too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-02 20:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-02 20:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-10-02 20:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/ruff_linter/src/preview.rs</code>:203 on 2025-10-02 20:58</div>
            <div class="timeline-body"><p>No worries, I&#x27;ll switch that over!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-10-02 21:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:159 on 2025-10-02 21:03</div>
            <div class="timeline-body"><p>Yeah I was wondering why that was separated, I&#x27;ll go ahead and inline it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-10-02 21:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/ruff_python_semantic/src/analyze/typing.rs</code>:168 on 2025-10-02 21:04</div>
            <div class="timeline-body"><p>Yep that makes sense to me, better to catch all cases here than having another extension to this rule later on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`ruff`] Extend FA102 with `collections.abc` types&quot; to &quot;[`ruff`] Extend FA102 with rest of PEP 585 generics&quot; by <a href="https://github.com/terror">@terror</a> on 2025-10-02 21:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`ruff`] Extend FA102 with rest of PEP 585 generics&quot; to &quot;[`ruff`] Extend FA102 with rest of PEP 585-compatible APIs&quot; by <a href="https://github.com/terror">@terror</a> on 2025-10-02 21:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/terror">@terror</a> on 2025-10-02 21:39</div>
            <div class="timeline-body"><p>@ntBre @amyreese I&#x27;ve re-purposed this PR to include listed PEP 585-compatible APIs <a href="https://docs.python.org/3/library/stdtypes.html#standard-generic-classes">here</a>. I&#x27;ve added a preview/non-preview test for all of these as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`ruff`] Extend FA102 with rest of PEP 585-compatible APIs&quot; to &quot;[`ruff`] Extend FA102 with listed PEP 585-compatible APIs&quot; by <a href="https://github.com/terror">@terror</a> on 2025-10-02 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/amyreese">@amyreese</a> approved on 2025-10-03 00:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-10-03 13:45</div>
            <div class="timeline-body"><p>Very nice, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-03 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-03 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-03 16:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:09 UTC
    </footer>
</body>
</html>
