```yaml
number: 7132
title: Add lexer benchmark
type: pull_request
state: merged
author: dhruvmanila
labels:
  - internal
assignees: []
merged: true
base: main
head: dhruv/lexer-benchmark
created_at: 2023-09-04T12:40:02Z
updated_at: 2023-09-06T07:31:46Z
url: https://github.com/astral-sh/ruff/pull/7132
synced_at: 2026-01-12T02:45:38Z
```

# Add lexer benchmark

---

_Pull request opened by @dhruvmanila on 2023-09-04 12:40_

## Summary

This PR adds a separate lexer benchmark. The parser benchmark might not be
sufficient to detect any regressions in the lexer performance.

## Test Plan

`cargo bench -p ruff_benchmark --bench lexer`


---

_Comment by @dhruvmanila on 2023-09-04 12:40_

Current dependencies on/for this PR:
* main
  * **PR #7132** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7132" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ğŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7132?utm_source=stack-comment).

---

_@MichaReiser approved on 2023-09-04 12:53_

Thank you

---

_Merged by @dhruvmanila on 2023-09-04 13:18_

---

_Closed by @dhruvmanila on 2023-09-04 13:18_

---

_Branch deleted on 2023-09-04 13:18_

---

_Comment by @codspeed-hq[bot] on 2023-09-04 13:21_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/dhruv/lexer-benchmark)

### Merging #7132 will **degrade performances by 2.49%**

<sub>Comparing <code>dhruv/lexer-benchmark</code> (39c91ef) with <code>main</code> (ece30e7)</sub>



### Summary

`âŒ 1` regressions
`âœ… 19` untouched benchmarks

`ğŸ†• 5` new benchmarks


> :warning: _Please fix the performance issues or [acknowledge them on CodSpeed](https://codspeed.io/astral-sh/ruff/branches/dhruv/lexer-benchmark)._

### Benchmarks breakdown

|     | Benchmark | `main` | `dhruv/lexer-benchmark` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ğŸ†• | `lexer[unicode/pypinyin.py]` | N/A | 700.4 Âµs | N/A |
| ğŸ†• | `lexer[numpy/globals.py]` | N/A | 257.7 Âµs | N/A |
| ğŸ†• | `lexer[numpy/ctypeslib.py]` | N/A | 2.3 ms | N/A |
| ğŸ†• | `lexer[pydantic/types.py]` | N/A | 4.8 ms | N/A |
| âŒ | `linter/all-rules[numpy/ctypeslib.py]` | 32.9 ms | 33.8 ms | -2.49% |
| ğŸ†• | `lexer[large/dataset.py]` | N/A | 11.6 ms | N/A |


---

_Comment by @github-actions[bot] on 2023-09-04 13:25_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Label `internal` added by @dhruvmanila on 2023-09-06 07:31_

---
