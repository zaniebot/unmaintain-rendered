<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't reorder parameters in function calls - astral-sh/ruff #7268</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't reorder parameters in function calls</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7268">#7268</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-09-11 12:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>In <code>f(*args, a=b, *args2, **kwargs)</code> the args (<code>*args</code>, <code>*args2</code>) and keywords (<code>a=b</code>, <code>**kwargs</code>) are interleaved, which we previously didn't handle.</p>
<p>Fixes #6498</p>
<p><strong>main</strong></p>
<p>| project      | similarity index  | total files       | changed files     |
|--------------|------------------:|------------------:|------------------:|
| cpython      |           0.76083 |              1789 |              1632 |
| <strong>django</strong>       |           0.99966 |              2760 |                58 |
| transformers |           0.99930 |              2587 |               447 |
| twine        |           1.00000 |                33 |                 0 |
| typeshed     |           0.99983 |              3496 |                18 |
| warehouse    |           0.99825 |               648 |                22 |
| zulip        |           0.99950 |              1437 |                27 |</p>
<p><strong>PR</strong></p>
<p>| project      | similarity index  | total files       | changed files     |
|--------------|------------------:|------------------:|------------------:|
| cpython      |           0.76083 |              1789 |              1632 |
| <strong>django</strong>       |           0.99967 |              2760 |                53 |
| transformers |           0.99930 |              2587 |               447 |
| twine        |           1.00000 |                33 |                 0 |
| typeshed     |           0.99983 |              3496 |                18 |
| warehouse    |           0.99825 |               648 |                22 |
| zulip        |           0.99950 |              1437 |                27 |</p>
<h2>Test Plan</h2>
<p>New fixtures</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-11 12:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/statement/stmt_function_def.rs</code>:45 on 2023-09-11 12:07</div>
            <div class="timeline-body"><p>This isn't really part of the PR but i got confused so i split this into it's own function (no functional changes). It's a separate commit already i can easily split the branch if you want</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:66 on 2023-09-11 12:08</div>
            <div class="timeline-body"><p>i unfortunately didn't find any pretty way to write this. itertool's <code>merge_by</code> also doesn't work due to different type</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-11 12:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-09-11 12:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_function_def.rs</code>:45 on 2023-09-11 13:45</div>
            <div class="timeline-body"><p>I think I would prefer if you write it as (I'm somewhat certain that this should work):</p>
<pre><code class="language-rust">fn format_function_header(item: &amp;StmtFunctionDef) -&gt; impl Format&lt;PyFormatContext&lt;'_&gt;&gt; {
	format_with(move |f| {
		... 
	})
}
</code></pre>
<p>It avoids the nested function call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:69 on 2023-09-11 13:47</div>
            <div class="timeline-body"><p>Isn't it guaranteed that <code>args.next()</code> must always return a value here?</p>
<pre><code class="language-suggestion">                            if let Some(arg) = args.next().unwrap() {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:259 on 2023-09-11 13:49</div>
            <div class="timeline-body"><p>Can we add some tests with comments too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:66 on 2023-09-11 13:54</div>
            <div class="timeline-body"><p>Considerably more code but avoids <code>peekable</code>. Not sure if it easier to understand due to avoiding <code>map</code></p>
<pre><code class="language-rust">let mut args = args.iter();
let mut keywords = keywords.iter();

let mut current_arg = args.next();
let mut current_keyword = keywords.next();

while let (Some(arg), Some(keyword)) = (current_arg, current_keyword) {
    if arg.start() &lt; keyword.start() {
        joiner.entry(arg, &amp;arg.format());
        current_arg = args.next();
    } else {
        joiner.entry(keyword, &amp;keyword.format());
        current_keyword = keywords.next();
    }
}

for arg in current_arg.into_iter().chain(args) {
    joiner.entry(arg, &amp;arg.format());
}

for keyword in current_keyword.into_iter().chain(keywords) {
    joiner.entry(keyword, &amp;keyword.format());
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:71 on 2023-09-11 13:55</div>
            <div class="timeline-body"><p>Nit: Preserve is the default</p>
<pre><code class="language-suggestion">                                    .entry(arg, &amp;arg.format();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:61 on 2023-09-11 13:55</div>
            <div class="timeline-body"><p>Nit: It may be worth explaining that the args and kwargs are formatted in their appearance in source and that the code here is a merge sort.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-09-11 13:56</div>
            <div class="timeline-body"><p>Can you add the similarity index comparison between the baseline and this PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-09-12 09:48</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #7302</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7302" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #7268</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7268" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7268?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-09-12 10:10</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-12 11:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:66 on 2023-09-12 11:14</div>
            <div class="timeline-body"><p>This will be nice and clean with your <code>ArgOrKeyword</code> abstraction :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Dont reorder parameters in function calls" to "Don't reorder parameters in function calls" by @charliermarsh on 2023-09-12 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @konstin on 2023-09-12 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-12 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:531 on 2023-09-12 15:19</div>
            <div class="timeline-body"><p>these get switched but that seems fine to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-09-12 15:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-13 08:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/statement/stmt_function_def.rs</code>:45 on 2023-09-13 08:36</div>
            <div class="timeline-body"><p>i prefer the flatter function body</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-09-13 09:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-09-13 09:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-13 09:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:09 UTC
    </footer>
</body>
</html>
