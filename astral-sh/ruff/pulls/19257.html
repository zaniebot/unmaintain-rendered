<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Remove countme from salsa-structs - astral-sh/ruff #19257</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Remove countme from salsa-structs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19257">#19257</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-07-10 11:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p><code>TY_MEMORY_REPORT</code> gives us the same and maore information. Making the countme approach for salsa structs obsolete.</p>
<p>E.g. <code>TY_MEMORY_REPORT</code> gives you</p>
<pre><code>`Definition`                                       metadata=7.41MB   fields=17.77MB  count=185129
`Expression`                                       metadata=2.34MB   fields=3.12MB   count=48748
`OverloadLiteral`                                  metadata=1.48MB   fields=1.05MB   count=26361
`Type &lt; 'db &gt;::member_lookup_with_policy_::interned_arguments` metadata=0.78MB   fields=0.89MB   count=13874
`File`                                             metadata=0.81MB   fields=0.81MB   count=12712
`FunctionType`                                     metadata=1.51MB   fields=0.65MB   count=26956
`ScopeId`                                          metadata=1.39MB   fields=0.60MB   count=49716
`IntersectionType`                                 metadata=0.27MB   fields=0.55MB   count=4899
`Type &lt; 'db &gt;::class_member_with_policy_::interned_arguments` metadata=0.39MB   fields=0.44MB   count=6925
`FunctionLiteral`                                  metadata=1.48MB   fields=0.42MB   count=26395
`ClassLiteral`                                     metadata=0.35MB   fields=0.25MB   count=6286
`TupleType`                                        metadata=0.16MB   fields=0.23MB   count=2919
`place_by_id::interned_arguments`                  metadata=0.75MB   fields=0.22MB   count=13439
`Type &lt; 'db &gt;::try_call_dunder_get_::interned_arguments` metadata=0.10MB   fields=0.17MB   count=1808
`StringLiteralType`                                metadata=0.59MB   fields=0.17MB   count=10562
`TypeVarInstance`                                  metadata=0.09MB   fields=0.16MB   count=1579
`ClassLiteral &lt; 'db &gt;::try_mro_::interned_arguments` metadata=0.56MB   fields=0.16MB   count=10054
`Type &lt; 'db &gt;::apply_specialization_::interned_arguments` metadata=0.22MB   fields=0.16MB   count=3970
`Specialization`                                   metadata=0.24MB   fields=0.14MB   count=4347
`GenericAlias`                                     metadata=0.36MB   fields=0.10MB   count=6429
`CallableType`                                     metadata=0.06MB   fields=0.10MB   count=1005
`StarImportPlaceholderPredicate`                   metadata=0.12MB   fields=0.08MB   count=4167
`ModuleNameIngredient`                             metadata=0.15MB   fields=0.07MB   count=2739
`PropertyInstanceType`                             metadata=0.06MB   fields=0.07MB   count=1016
`BoundMethodType`                                  metadata=0.09MB   fields=0.06MB   count=1523
`UnionType`                                        metadata=0.20MB   fields=0.06MB   count=3619
`PatternPredicate`                                 metadata=0.02MB   fields=0.04MB   count=768
`Unpack`                                           metadata=0.03MB   fields=0.04MB   count=637
`ModuleLiteralType`                                metadata=0.11MB   fields=0.03MB   count=1979
`GenericContext`                                   metadata=0.03MB   fields=0.03MB   count=507
`BareTypeAliasType`                                metadata=0.01MB   fields=0.01MB   count=201
`PEP695TypeAliasType`                              metadata=0.02MB   fields=0.01MB   count=272
`Type &lt; 'db &gt;::lookup_dunder_new_::interned_arguments` metadata=0.01MB   fields=0.01MB   count=238
`ProtocolInterface`                                metadata=0.01MB   fields=0.00MB   count=143
`BytesLiteralType`                                 metadata=0.01MB   fields=0.00MB   count=137
`TypeIsType`                                       metadata=0.00MB   fields=0.00MB   count=39
`BoundSuperType`                                   metadata=0.00MB   fields=0.00MB   count=26
`Program`                                          metadata=0.00MB   fields=0.00MB   count=1
`Project`                                          metadata=0.00MB   fields=0.00MB   count=1
`FileRoot`                                         metadata=0.00MB   fields=0.00MB   count=1
`module_type_symbols::interned_arguments`          metadata=0.00MB   fields=0.00MB   count=1
`dynamic_resolution_paths::interned_arguments`     metadata=0.00MB   fields=0.00MB   count=1
</code></pre>
<h2>Test Plan</h2>
<p>cargo build</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @MichaReiser on 2025-07-10 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-07-10 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-07-10 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-07-10 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-07-10 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-07-10 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-07-10 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-07-10 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-10 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-10 11:45</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-10 11:54</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:14:07 UTC
    </footer>
</body>
</html>
