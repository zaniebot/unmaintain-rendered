```yaml
number: 15759
title: Update Rust crate ureq to v3
type: pull_request
state: closed
author: renovate
labels:
  - internal
assignees: []
base: main
head: renovate/ureq-3.x
created_at: 2025-01-27T01:42:36Z
updated_at: 2025-02-02T16:13:51Z
url: https://github.com/astral-sh/ruff/pull/15759
synced_at: 2026-01-12T15:55:52Z
```

# Update Rust crate ureq to v3

---

_@renovate_

This PR contains the following updates:

| Package | Type | Update | Change |
|---|---|---|---|
| [ureq](https://redirect.github.com/algesten/ureq) | workspace.dependencies | major | `2.9.6` -> `3.0.0` |

---

> [!WARNING]
> Some dependencies could not be looked up. Check the Dependency Dashboard for more information.

---

### Release Notes

<details>
<summary>algesten/ureq (ureq)</summary>

### [`v3.0.1`](https://redirect.github.com/algesten/ureq/blob/HEAD/CHANGELOG.md#301)

[Compare Source](https://redirect.github.com/algesten/ureq/compare/3.0.0...3.0.1)

-   Fix excessive stack sizes ([#&#8203;950](https://redirect.github.com/algesten/ureq/issues/950))
    -   Do not enable **json** by default (breaking, but it was a mistake) ([#&#8203;948](https://redirect.github.com/algesten/ureq/issues/948))

### [`v3.0.0`](https://redirect.github.com/algesten/ureq/blob/HEAD/CHANGELOG.md#300)

[Compare Source](https://redirect.github.com/algesten/ureq/compare/2.12.1...3.0.0)

-   Replace RequestBuilder Deref with explicit wrappers ([#&#8203;944](https://redirect.github.com/algesten/ureq/issues/944))
    -   Remove dependency on `url` crate ([#&#8203;943](https://redirect.github.com/algesten/ureq/issues/943))
    -   Feature `Config::save_redirect_history` ([#&#8203;939](https://redirect.github.com/algesten/ureq/issues/939))

</details>

---

### Configuration

ðŸ“… **Schedule**: Branch creation - "before 4am on Monday" (UTC), Automerge - At any time (no schedule defined).

ðŸš¦ **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

â™» **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

ðŸ”• **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/astral-sh/ruff).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4xMjUuMSIsInVwZGF0ZWRJblZlciI6IjM5LjEyNS4xIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJpbnRlcm5hbCJdfQ==-->


---

_Label `internal` added by @renovate[bot] on 2025-01-27 01:42_

---

_Assigned to @dhruvmanila by @dhruvmanila on 2025-01-27 15:44_

---

_Comment by @codspeed-hq[bot] on 2025-01-27 15:57_

<!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->
<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/renovate%2Fureq-3.x)

### Merging #15759 will **improve performances by 4.59%**

<sub>Comparing <code>renovate/ureq-3.x</code> (b73e710) with <code>main</code> (d9a1034)</sub>



### Summary

`âš¡ 1` improvements  
`âœ… 31` untouched benchmarks  



### Benchmarks breakdown

|     | Benchmark | `BASE` | `HEAD` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| âš¡ | `` lexer[numpy/globals.py] `` | 30.5 Âµs | 29.2 Âµs | +4.59% |


---

_Comment by @github-actions[bot] on 2025-01-27 16:01_

<!-- generated-comment ecosystem -->
## `ruff-ecosystem` results
### Linter (stable)
âœ… ecosystem check detected no linter changes.

### Linter (preview)
âœ… ecosystem check detected no linter changes.

### Formatter (stable)
âœ… ecosystem check detected no format changes.

### Formatter (preview)
âœ… ecosystem check detected no format changes.




---

_Review comment by @AlexWaygood on `crates/ruff_benchmark/src/lib.rs`:124 on 2025-01-27 17:33_

could this just be

```suggestion
            let content = response.body_mut().read_to_string()?;
```

? Or are the semantics of `String::from_utf8_lossy()` important here?

---

_Review comment by @AlexWaygood on `Cargo.lock`:1 on 2025-01-27 17:39_

seems like quite a few new dependencies :/ do you know if any might be avoidable?

---

_@AlexWaygood reviewed on 2025-01-27 17:39_

---

_@dhruvmanila reviewed on 2025-01-29 04:47_

---

_Review comment by @dhruvmanila on `crates/ruff_benchmark/src/lib.rs`:124 on 2025-01-29 04:47_

I haven't really debugged why but it throws an error:
```
thread 'main' panicked at crates/ruff_benchmark/benches/formatter.rs:45:42:
called `Result::unwrap()` on an `Err` value: Request(Io(Error { kind: InvalidData, message: "stream did not contain valid UTF-8" }))
```

which seems unexpected given that `read_to_string` should convert incorrect UTF-8 chars to `?` character.

This is for https://raw.githubusercontent.com/mozillazg/python-pinyin/9521e47d96e3583a5477f5e43a2e82d513f27a3f/pypinyin/standard.py

---

_@dhruvmanila reviewed on 2025-01-29 04:48_

---

_Review comment by @dhruvmanila on `Cargo.lock`:1 on 2025-01-29 04:48_

I don't think so, it now switched to the [`http` crate](https://crates.io/crates/http) instead of implementing it's own `Response` and `Request` struct (https://github.com/algesten/ureq/blob/main/MIGRATE-2-to-3.md) plus added some more dependencies

---

_Comment by @dhruvmanila on 2025-01-29 05:21_

Not sure what's causing the perf regression, will look into it later.

---

_Review comment by @AlexWaygood on `crates/ruff_benchmark/benches/lexer.rs`:62 on 2025-02-02 11:48_

```suggestion
                        "Input should be valid python source code"
```

---

_Review comment by @AlexWaygood on `crates/ruff_benchmark/src/lib.rs`:124 on 2025-02-02 11:49_

```suggestion
            // Using `with_config` here because without, the `lossy_utf8` results in invalid
```

---

_@AlexWaygood reviewed on 2025-02-02 11:49_

---

_Comment by @MichaReiser on 2025-02-02 12:44_

I plan to remove the entire download functionality and instead commit the files. It should simplify the benchmarks, reduce our dependencies and allow running benchmarks even when offline 

---

_Comment by @MichaReiser on 2025-02-02 16:13_

See https://github.com/astral-sh/ruff/pull/15878

---

_Closed by @MichaReiser on 2025-02-02 16:13_

---

_Comment by @renovate[bot] on 2025-02-02 16:13_

### Renovate Ignore Notification

Because you closed this PR without merging, Renovate will ignore this update. You will not get PRs for *any* future `3.x` releases. But if you manually upgrade to `3.x` then Renovate will re-enable `minor` and `patch` updates automatically.

If you accidentally closed this PR, or if you changed your mind: rename this PR to get a fresh replacement PR.

---

_Branch deleted on 2025-02-02 16:13_

---
