<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `[format|lint].exclude` options - astral-sh/ruff #8000</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>[format|lint].exclude</code> options</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8000">#8000</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-10-17 03:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR introduces the new options <code>lint.exclude</code> and <code>format.exclude</code> that allow excluding files from linting or formatting only.</p>
<p>Being able to exclude entire files is useful when:</p>
<ul>
<li>you have generated code that you only want to format but not lint (or the other way round)</li>
<li>you have sub modules that you only want to lint because the code isn't using a formatter yet (but the rest of the project is)</li>
</ul>
<p>Closes https://github.com/astral-sh/ruff/issues/7645</p>
<h2>Considerations</h2>
<p>The <code>check</code> command (and now the format command) exposes the <code>exclude</code> option. This is the global <code>exclude</code> and not the <code>lint.exclude</code> or <code>format.exclude</code>. Only exposing the global <code>exclude</code> option should be sufficient and make little difference except if the user wants to clear out the <code>lint|format.exclude</code> option via the CLI.</p>
<p>Only exposing the global <code>exclude</code> option makes sense for me, considering that we plan to unify linting and formatting under the <code>check</code> command in the future. Whether this is the right design for <code>format</code> is less clear to me but I think it's in line with <code>check</code> and we can still decide to add a <code>format-exclude</code> CLI option if it proves necessary.</p>
<h2>Test Plan</h2>
<p>I added new integration tests that test the tool specific exclusion.</p>
<p>I played around with the <code>airflow</code> repository and excluded files for linting or formatting only and verified that they are only excluded for the specific tool (and the result is the same as when excluding the files globally). Verified that a file passed directly gets linted/formated regardless if it is excluded or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-17 03:01</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #8000</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8000" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ<ul>
<li><strong>PR #8002</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8002" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #8032</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8032" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a></li>
<li><strong>PR #8006</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8006" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #8035</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8035" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #8010</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8010" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>
* <strong>PR #8082</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8082" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>
* <strong>PR #8088</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8088" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>
* <strong>PR #8039</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8039" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
<li><strong>PR #8031</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8031" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8000?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/src/commands/check_stdin.rs</code>:26 on 2023-10-17 03:06</div>
            <div class="timeline-body"><p>It's a bit annoying that we have to duplicate this check everywhere. It would be nice to have a single CLI logic that handles the traversal of all files and decides if a file is eligible for a specific tool... Another day</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:380 on 2023-10-17 03:09</div>
            <div class="timeline-body"><p>The <code>LintCommonOptions</code> is necessary because we don't want to flatten the <code>exclude</code> option into the top-level settings (would  conflict with the global <code>exclude</code> setting)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/resolver.rs</code>:281 on 2023-10-17 03:10</div>
            <div class="timeline-body"><p>I had to introduce a new <code>ResolvedFile</code> type to know whether the file was explicitly passed to the CLI or not. I could have used <code>DirEntry::depth</code> but I found that it leaks internal details about <code>python_files_in_path</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-17 03:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-10-17 03:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2023-10-17 03:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-10-17 03:45</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2023-10-17 06:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @MichaReiser on 2023-10-17 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @MichaReiser on 2023-10-17 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-17 06:54</div>
            <div class="timeline-body"><p>@charliermarsh what's your preferred way to incorporate these extensions to the documentation? Should I open a PR to your documentation PR or do you want to write the documentation yourself?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/check.rs</code>:115 on 2023-10-17 09:00</div>
            <div class="timeline-body"><p>nit: the <code>.is_empty()</code> check should be inside <code>match_exclusion</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/check.rs</code>:208 on 2023-10-17 09:09</div>
            <div class="timeline-body"><p>This needs a comment what it does</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/tests/format.rs</code>:16 on 2023-10-17 09:14</div>
            <div class="timeline-body"><p>What's the reason for removing the isolated here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_workspace/src/options.rs</code>:2505 on 2023-10-17 09:24</div>
            <div class="timeline-body"><p>I dislike that we have effectively three copies of this but i don't have a good solution either unfortunately</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_workspace/src/resolver.rs</code>:311 on 2023-10-17 09:26</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    // How to avoid filtering out files that have been explicitly passed.
</code></pre>
<p>Good question, intuitively i'd say force exclude applies to a subcommand overall so it applies to all excludes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-10-17 09:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-17 15:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:380 on 2023-10-17 15:11</div>
            <div class="timeline-body"><p>Can this be removed when we remove the top-level lint options support?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-17 16:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_workspace/src/options.rs</code>:380 on 2023-10-17 16:15</div>
            <div class="timeline-body"><p>I think that's the plan!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_workspace/src/options.rs</code>:380 on 2023-10-17 16:15</div>
            <div class="timeline-body"><p>I think we should probably wait a while to drop support for top-level lint options though, maybe 0.3? maybe later? We should open a tracking issue we can add todos to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-17 16:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-17 23:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_workspace/src/options.rs</code>:380 on 2023-10-17 23:40</div>
            <div class="timeline-body"><blockquote>
<p>Can this be removed when we remove the top-level lint options support?
Yes</p>
</blockquote>
<blockquote>
<p>I think we should probably wait a while to drop support for top-level lint options though, maybe 0.3? maybe later? We should open a tracking issue we can add todos to</p>
</blockquote>
<p>I don't know the timeline yet but my thinking is:</p>
<ul>
<li>Not before we ship the stable formatter (the main goal of the beta is to get feedback on the configuration)</li>
<li>Promote the <code>lint</code> section over the <code>formatter</code> section (by changing the documentation)</li>
<li>Deprecate the top-level settings</li>
<li>Eventually, remove support for top-level lint settings</li>
</ul>
<p>I expect this to be 0.3+, maybe even 1.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-18 00:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_cli/src/commands/check.rs</code>:115 on 2023-10-18 00:59</div>
            <div class="timeline-body"><p>I ended up removing it. <code>Globset.matches</code> has an early <code>is_empty</code> check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-10-18 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-10-18 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-10-18 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch restored on 2023-10-18 01:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-16 10:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:51 UTC
    </footer>
</body>
</html>
