<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Implement `nan-comparison` (`PLW0117`) - astral-sh/ruff #10401</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Implement <code>nan-comparison</code> (<code>PLW0117</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10401">#10401</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2024-03-14 01:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a></div>
            <div class="timeline-body">

Summary
<p>Implement pylint&#x27;s nan-comparison, part of #970.</p>
Test Plan
<p>Text fixture was added.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-03-14 01:59</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+48 -0 violations, +0 -0 fixes in 1 projects; 42 projects unchanged)</p>
<a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+48 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/arrays/arrow/array.py#L1409">pandas/core/arrays/arrow/array.py:1409:29:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/arrays/categorical.py#L1597">pandas/core/arrays/categorical.py:1597:82:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/arrays/string_arrow.py#L710">pandas/core/arrays/string_arrow.py:710:20:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/base.py#L641">pandas/core/base.py:641:34:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/internals/managers.py#L1000">pandas/core/internals/managers.py:1000:48:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/strings/accessor.py#L347">pandas/core/strings/accessor.py:347:63:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/core/strings/object_array.py#L102">pandas/core/strings/object_array.py:102:28:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arithmetic/test_object.py#L71">pandas/tests/arithmetic/test_object.py:71:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arithmetic/test_object.py#L75">pandas/tests/arithmetic/test_object.py:75:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arrays/categorical/test_analytics.py#L107">pandas/tests/arrays/categorical/test_analytics.py:107:30:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arrays/categorical/test_analytics.py#L117">pandas/tests/arrays/categorical/test_analytics.py:117:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arrays/categorical/test_indexing.py#L292">pandas/tests/arrays/categorical/test_indexing.py:292:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arrays/categorical/test_indexing.py#L301">pandas/tests/arrays/categorical/test_indexing.py:301:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/arrays/floating/test_contains.py#L12">pandas/tests/arrays/floating/test_contains.py:12:12:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/frame/methods/test_astype.py#L762">pandas/tests/frame/methods/test_astype.py:762:28:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/frame/methods/test_replace.py#L1541">pandas/tests/frame/methods/test_replace.py:1541:21:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/groupby/test_categorical.py#L1496">pandas/tests/groupby/test_categorical.py:1496:20:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/categorical/test_indexing.py#L345">pandas/tests/indexes/categorical/test_indexing.py:345:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/categorical/test_indexing.py#L353">pandas/tests/indexes/categorical/test_indexing.py:353:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/categorical/test_indexing.py#L366">pandas/tests/indexes/categorical/test_indexing.py:366:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/categorical/test_indexing.py#L376">pandas/tests/indexes/categorical/test_indexing.py:376:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/categorical/test_indexing.py#L386">pandas/tests/indexes/categorical/test_indexing.py:386:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/multi/test_indexing.py#L822">pandas/tests/indexes/multi/test_indexing.py:822:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/multi/test_indexing.py#L825">pandas/tests/indexes/multi/test_indexing.py:825:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/numeric/test_indexing.py#L533">pandas/tests/indexes/numeric/test_indexing.py:533:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/period/test_indexing.py#L784">pandas/tests/indexes/period/test_indexing.py:784:16:</a> PLW0117 Comparing against a NaN value; use `math.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/period/test_indexing.py#L785">pandas/tests/indexes/period/test_indexing.py:785:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/period/test_indexing.py#L790">pandas/tests/indexes/period/test_indexing.py:790:16:</a> PLW0117 Comparing against a NaN value; use `math.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/indexes/period/test_indexing.py#L791">pandas/tests/indexes/period/test_indexing.py:791:16:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/io/excel/test_writers.py#L1021">pandas/tests/io/excel/test_writers.py:1021:38:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/io/excel/test_writers.py#L1072">pandas/tests/io/excel/test_writers.py:1072:50:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L150">pandas/tests/libs/test_libalgos.py:150:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L151">pandas/tests/libs/test_libalgos.py:151:27:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L152">pandas/tests/libs/test_libalgos.py:152:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L153">pandas/tests/libs/test_libalgos.py:153:27:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L154">pandas/tests/libs/test_libalgos.py:154:27:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L155">pandas/tests/libs/test_libalgos.py:155:23:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L157">pandas/tests/libs/test_libalgos.py:157:29:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L158">pandas/tests/libs/test_libalgos.py:158:30:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L159">pandas/tests/libs/test_libalgos.py:159:29:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L160">pandas/tests/libs/test_libalgos.py:160:30:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L161">pandas/tests/libs/test_libalgos.py:161:30:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/libs/test_libalgos.py#L162">pandas/tests/libs/test_libalgos.py:162:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/reductions/test_reductions.py#L1362">pandas/tests/reductions/test_reductions.py:1362:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/reductions/test_reductions.py#L1375">pandas/tests/reductions/test_reductions.py:1375:30:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/series/indexing/test_setitem.py#L1106">pandas/tests/series/indexing/test_setitem.py:1106:52:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/series/indexing/test_setitem.py#L619">pandas/tests/series/indexing/test_setitem.py:619:23:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
+ <a href="https://github.com/pandas-dev/pandas/blob/d17723c6d447d37c0cb753a517df74705806f4a2/pandas/tests/series/test_constructors.py#L1095">pandas/tests/series/test_constructors.py:1095:26:</a> PLW0117 Comparing against a NaN value; use `np.isnan` instead
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLW0117 | 48 | 48 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-14 02:27</div>
            <div class="timeline-body"><p>All the violations in pandas are false positives and are mostly checking for the actual <code>np.nan</code> object i.e. <code>na_value is np.nan</code>, but these seem more like exceptions to the rule, not reasons to change it. <code>np.nan is np.nan</code> will return True, but it&#x27;s a bad idea to check for a nan value by checking <code>x is np.nan</code>.</p>
<p>Interested to hear people&#x27;s thoughts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a> reviewed on 2024-03-14 02:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/augustelalande">@augustelalande</a> on <code>crates/ruff_linter/src/rules/pylint/rules/nan_comparison.rs</code>:46 on 2024-03-14 02:28</div>
            <div class="timeline-body"><p>Also interested to hear if there is a better way to do this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-21 00:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-03-21 00:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pylint/rules/nan_comparison.rs</code>:46 on 2024-03-21 00:19</div>
            <div class="timeline-body"><p>I tweaked it a little bit but it&#x27;s generally correct. Kind of tedious to write out, but correct!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-21 00:27</div>
            <div class="timeline-body"><p>Sorry had to fix the typo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-21 00:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-21 00:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:02:16 UTC
    </footer>
</body>
</html>
