<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server: Use `min` instead of `max` to limit the number of threads - astral-sh/ruff #17421</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Server: Use <code>min</code> instead of <code>max</code> to limit the number of threads</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17421">#17421</a>
        opened by <a href="https://github.com/jnooree">@jnooree</a>
        on 2025-04-16 08:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jnooree">@jnooree</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Prevent overcommit by using max 4 threads as intended.</p>
<p>Unintuitively, <code>.max()</code> returns the maximum value of <code>self</code> and the argument (not limiting to the argument). To limit the value to 4, one needs to use <code>.min()</code>.</p>
<p>https://doc.rust-lang.org/std/cmp/trait.Ord.html#method.max</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @jnooree on 2025-04-16 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @jnooree on 2025-04-16 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @jnooree on 2025-04-16 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @jnooree on 2025-04-16 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @jnooree on 2025-04-16 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "fix: use max four threads, not at least four threads" to "[red-knot] [ruff] use max four threads, not at least four threads" by @jnooree on 2025-04-16 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff/src/lib.rs</code>:228 on 2025-04-16 09:14</div>
            <div class="timeline-body"><p>Could you say a bit more about the problem this PR is trying to fix? According to this comment, it looks like the current way the code works is intentional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-04-16 09:14</div>
            <div class="timeline-body"><p>Thanks for the PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jnooree">@jnooree</a> reviewed on 2025-04-16 09:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jnooree">@jnooree</a> on <code>crates/ruff/src/lib.rs</code>:228 on 2025-04-16 09:21</div>
            <div class="timeline-body"><p>Unintuitively, <code>.max()</code> returns the maximum value of self and the argument (<em>not</em> limiting to the argument). To limit the value to 4, one needs to use <code>.min()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jnooree">@jnooree</a> on <code>crates/ruff/src/lib.rs</code>:228 on 2025-04-16 09:40</div>
            <div class="timeline-body"><p>See, e.g., https://github.com/astral-sh/ruff/blob/a2a7b1e26897e0257434b74f5734df84d7e3d5af/crates/ruff_db/src/system/os.rs#L433</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jnooree">@jnooree</a> reviewed on 2025-04-16 09:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-04-16 09:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff/src/lib.rs</code>:228 on 2025-04-16 09:51</div>
            <div class="timeline-body"><p>Oh I see. Right, that does make sense. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-16 09:53</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-16 09:59</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-04-16 10:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jnooree">@jnooree</a> on 2025-04-16 10:42</div>
            <div class="timeline-body"><p>@AlexWaygood Could you merge this for me? I don't have write access to this repo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-04-16 10:46</div>
            <div class="timeline-body"><blockquote>
<p>I don't have write access to this repo.</p>
</blockquote>
<p>I know! I'm not the only maintainer here, though, and wanted to give other maintainers some time to chime in if they wanted to. Your reasoning seems correct to me, but I'm not familiar with this area of the codebase :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-04-16 17:36</div>
            <div class="timeline-body"><p>This looks clearly correct to me (in that it makes the behavior match the comments describing the intended behavior.) If it were just the red-knot server, I'd just merge it, but since it also impacts the ruff LSP, I'd rather have @dhruvmanila confirm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-04-17 19:59</div>
            <div class="timeline-body"><p>Nice catch! I'm not sure how this slipped by but thank you for noticing and fixing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @dhruvmanila on 2025-04-17 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] [ruff] use max four threads, not at least four threads" to "Server: Use `min` instead of `max` to limit the number of threads" by @dhruvmanila on 2025-04-17 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @dhruvmanila on 2025-04-17 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-04-17 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-04-17 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-17 22:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:11:37 UTC
    </footer>
</body>
</html>
