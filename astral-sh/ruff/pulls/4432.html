<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement flake8-async plugin - astral-sh/ruff #4432</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement flake8-async plugin</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4432">#4432</a>
        opened by <a href="https://github.com/qdegraaf">@qdegraaf</a>
        on 2023-05-14 17:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-14 17:23</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This PR adds the flake8-async plugin: https://github.com/cooperlees/flake8-async</p>
<p>First Ruff PR, relatively new to Rust as well so all feedback is welcomed. I checked the contributing guide but if I ended up missing a step anyway let me know.</p>
<p>Closes: https://github.com/charliermarsh/ruff/issues/4246</p>
<p>Marked as draft until:</p>
<ul>
<li>[x] Fixed bug where from style imports are not caught</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-05-14 17:33</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     17.5Â±0.95ms     2.3 MB/sec    1.03     18.0Â±0.89ms     2.3 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.03      4.3Â±0.23ms     3.9 MB/sec    1.00      4.2Â±0.23ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00   533.2Â±39.15Âµs     5.5 MB/sec    1.04   554.6Â±31.35Âµs     5.3 MB/sec
linter/all-rules/pydantic/types.py         1.03      7.4Â±0.45ms     3.4 MB/sec    1.00      7.2Â±0.34ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.00      8.5Â±0.42ms     4.8 MB/sec    1.00      8.5Â±0.44ms     4.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1808.5Â±91.55Âµs     9.2 MB/sec    1.00  1816.0Â±85.27Âµs     9.2 MB/sec
linter/default-rules/numpy/globals.py      1.02   219.5Â±13.51Âµs    13.4 MB/sec    1.00   215.9Â±16.08Âµs    13.7 MB/sec
linter/default-rules/pydantic/types.py     1.02      3.9Â±0.18ms     6.5 MB/sec    1.00      3.8Â±0.21ms     6.7 MB/sec
parser/large/dataset.py                    1.00      6.7Â±0.36ms     6.0 MB/sec    1.00      6.7Â±0.39ms     6.1 MB/sec
parser/numpy/ctypeslib.py                  1.01  1388.5Â±67.48Âµs    12.0 MB/sec    1.00  1370.3Â±94.14Âµs    12.2 MB/sec
parser/numpy/globals.py                    1.01    137.7Â±9.72Âµs    21.4 MB/sec    1.00    136.4Â±7.38Âµs    21.6 MB/sec
parser/pydantic/types.py                   1.02      3.0Â±0.14ms     8.4 MB/sec    1.00      3.0Â±0.15ms     8.6 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     21.2Â±0.65ms  1963.7 KB/sec    1.00     21.3Â±0.72ms  1954.7 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.3Â±0.24ms     3.1 MB/sec    1.01      5.3Â±0.24ms     3.1 MB/sec
linter/all-rules/numpy/globals.py          1.00   631.5Â±31.84Âµs     4.7 MB/sec    1.01   637.0Â±55.14Âµs     4.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      8.9Â±0.30ms     2.9 MB/sec    1.01      9.0Â±0.39ms     2.8 MB/sec
linter/default-rules/large/dataset.py      1.01     10.4Â±0.63ms     3.9 MB/sec    1.00     10.4Â±0.28ms     3.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.2Â±0.10ms     7.7 MB/sec    1.01      2.2Â±0.09ms     7.6 MB/sec
linter/default-rules/numpy/globals.py      1.01   256.9Â±20.27Âµs    11.5 MB/sec    1.00   253.4Â±14.82Âµs    11.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.6Â±0.17ms     5.6 MB/sec    1.03      4.7Â±0.40ms     5.4 MB/sec
parser/large/dataset.py                    1.02      8.6Â±0.27ms     4.7 MB/sec    1.00      8.4Â±0.30ms     4.8 MB/sec
parser/numpy/ctypeslib.py                  1.02  1628.6Â±69.83Âµs    10.2 MB/sec    1.00  1600.4Â±64.20Âµs    10.4 MB/sec
parser/numpy/globals.py                    1.01    164.5Â±9.63Âµs    17.9 MB/sec    1.00   162.7Â±10.36Âµs    18.1 MB/sec
parser/pydantic/types.py                   1.02      3.6Â±0.12ms     7.1 MB/sec    1.00      3.5Â±0.12ms     7.2 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mara004">@mara004</a> on 2023-05-14 19:53</div>
            <div class="timeline-body"><p>Looks like #4433 was submitted simultaneously?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-14 21:16</div>
            <div class="timeline-body"><blockquote>
<p>Looks like #4433 was submitted simultaneously?</p>
</blockquote>
<p>Yeah, see Issue discussion at https://github.com/charliermarsh/ruff/issues/4246.</p>
<p>Started on this about a week ago only mentioning it in Discord while I was still in looking-and-playing-around-a-lot stage of devving and unsure whether I could get it to a proper feature in a reasonable time frame, so made no commitment on the issue. Only finished it up today when https://github.com/charliermarsh/ruff/pull/4433 was also pushed after a mention on the issue, which I then saw after already having opened the PR.</p>
<p>Happy to close if that implementation is preferred. Unsure what the protocol is in these scenarios.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @qdegraaf on 2023-05-14 22:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2023-05-15 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-15 02:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_async/rules.rs</code>:201 on 2023-05-15 02:46</div>
            <div class="timeline-body"><p>@qdegraaf - I changed this to use <code>resolve_call_path</code>, which will automatically detect situations like <code>from os import system</code> or even <code>from os import system as foo</code> or <code>import os as foo; foo.system</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-15 02:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_async/rules.rs</code>:138 on 2023-05-15 02:46</div>
            <div class="timeline-body"><p>@qdegraaf - I opted to remove the extra struct to house the candidate members, it didn't feel like it was buying us much, and without it we can just do a simple <code>.contains</code> check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-15 02:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/registry.rs</code>:743 on 2023-05-15 02:46</div>
            <div class="timeline-body"><p>We don't have any codes this long, but I don't see a good reason to deviate from upstream in this case ðŸ¤·</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-05-15 02:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-15 02:47</div>
            <div class="timeline-body"><p>@qdegraaf - From my perspective this is pretty much good to go -- but let me know if you have any questions or want to handle any follow-ups from your end before I merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inikolaev">@inikolaev</a> reviewed on 2023-05-15 06:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/inikolaev">@inikolaev</a> on <code>crates/ruff/src/rules/flake8_async/rules.rs</code>:67 on 2023-05-15 06:01</div>
            <div class="timeline-body"><p>Adjust these comments since we use <code>ASYNC</code> for clarity?</p>
<pre><code class="language-suggestion">/// ASYNC100
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inikolaev">@inikolaev</a> reviewed on 2023-05-15 06:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/inikolaev">@inikolaev</a> on <code>crates/ruff/src/rules/flake8_async/rules.rs</code>:224 on 2023-05-15 06:03</div>
            <div class="timeline-body"><p>@charliermarsh Do you see this as belonging to some utilities - might reusable in the future? Or how do you usually approach these?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_async/rules.rs</code>:223 on 2023-05-15 06:57</div>
            <div class="timeline-body"><p>Does <code>any</code> work here?</p>
<pre><code class="language-suggestion">        .any(|scope| {
            if let ScopeKind::Function(FunctionDef { async_, .. }) = &amp;scope.kind {
                *async_
            } else {
                false
            }
        })
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_async/rules.rs</code>:224 on 2023-05-15 06:58</div>
            <div class="timeline-body"><p>I tend to keep them local to rules until we see to use them in many places. But it could be helpful to have an <code>in_async</code> on <code>context</code> or <code>scopes</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-05-15 06:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-05-15 08:16</div>
            <div class="timeline-body"><blockquote>
<p>@qdegraaf - From my perspective this is pretty much good to go -- but let me know if you have any questions or want to handle any follow-ups from your end before I merge.</p>
</blockquote>
<p>@charliermarsh Awesome, agree with all the edits, thanks for polishing this up. Had a quick look at the await validation mentioned in the issue, but the original plugin does not cover this either by the looks of it, so probably best left separate or as part of some other plugin. Feel free to merge at your leisure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-05-15 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-15 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-05-15 21:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:50:42 UTC
    </footer>
</body>
</html>
