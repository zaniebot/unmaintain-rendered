<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pyupgrade`] Enable rule triggering for stub files  (`UP043`) - astral-sh/ruff #20027</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pyupgrade</code>] Enable rule triggering for stub files  (<code>UP043</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20027">#20027</a>
        opened by <a href="https://github.com/IDrokin117">@IDrokin117</a>
        on 2025-08-21 17:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/IDrokin117">@IDrokin117</a> on 2025-08-21 17:39</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Resolves #20011</p>
<p>Implemented alternative triggering condition for rule <a href="https://docs.astral.sh/ruff/rules/unnecessary-default-type-args/"><code>UP043</code></a> based on requirements outlined in <a href="https://github.com/astral-sh/ruff/issues/20011">issue #20011</a></p>
<h2>Test Plan</h2>
<p>Created .pyi file to ensure triggering the rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 17:50</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+265 -0 violations, +0 -0 fixes in 2 projects; 53 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/a697d78310c851a3a8a93c13649c5098f43acd58/providers/common/sql/src/airflow/providers/common/sql/hooks/sql.pyi#L112'>providers/common/sql/src/airflow/providers/common/sql/hooks/sql.pyi:112:10:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/apache/airflow/blob/a697d78310c851a3a8a93c13649c5098f43acd58/providers/common/sql/src/airflow/providers/common/sql/hooks/sql.pyi#L146'>providers/common/sql/src/airflow/providers/common/sql/hooks/sql.pyi:146:10:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/apache/airflow/blob/a697d78310c851a3a8a93c13649c5098f43acd58/providers/common/sql/src/airflow/providers/common/sql/hooks/sql.pyi#L156'>providers/common/sql/src/airflow/providers/common/sql/hooks/sql.pyi:156:10:</a> UP043 [*] Unnecessary default type arguments
</pre>

</p>
</details>
<details><summary><a href="https://github.com/python/typeshed">python/typeshed</a> (+262 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select E,F,FA,I,PYI,RUF,UP,W</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/argparse.pyi#L315'>stdlib/argparse.pyi:315:60:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/codecs.pyi#L198'>stdlib/codecs.pyi:198:83:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/codecs.pyi#L199'>stdlib/codecs.pyi:199:85:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/concurrent/futures/process.pyi#L100'>stdlib/concurrent/futures/process.pyi:100:53:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/email/message.pyi#L133'>stdlib/email/message.pyi:133:23:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/fixes/fix_except.pyi#L9'>stdlib/lib2to3/fixes/fix_except.pyi:9:42:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/fixes/fix_import.pyi#L8'>stdlib/lib2to3/fixes/fix_import.pyi:8:32:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/fixes/fix_imports.pyi#L11'>stdlib/lib2to3/fixes/fix_imports.pyi:11:35:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/fixes/fix_metaclass.pyi#L11'>stdlib/lib2to3/fixes/fix_metaclass.pyi:11:29:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/fixes/fix_renames.pyi#L10'>stdlib/lib2to3/fixes/fix_renames.pyi:10:24:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/fixes/fix_urllib.pyi#L8'>stdlib/lib2to3/fixes/fix_urllib.pyi:8:24:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/refactor.pyi#L72'>stdlib/lib2to3/refactor.pyi:72:10:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/lib2to3/refactor.pyi#L73'>stdlib/lib2to3/refactor.pyi:73:63:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/pathlib/__init__.pyi#L183'>stdlib/pathlib/__init__.pyi:183:80:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/pathlib/__init__.pyi#L184'>stdlib/pathlib/__init__.pyi:184:81:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/pathlib/__init__.pyi#L186'>stdlib/pathlib/__init__.pyi:186:41:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/pathlib/__init__.pyi#L187'>stdlib/pathlib/__init__.pyi:187:42:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/pathlib/__init__.pyi#L202'>stdlib/pathlib/__init__.pyi:202:26:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/sqlite3/__init__.pyi#L367'>stdlib/sqlite3/__init__.pyi:367:61:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/sqlite3/__init__.pyi#L369'>stdlib/sqlite3/__init__.pyi:369:31:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/tokenize.pyi#L154'>stdlib/tokenize.pyi:154:60:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/tokenize.pyi#L155'>stdlib/tokenize.pyi:155:53:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/traceback.pyi#L114'>stdlib/traceback.pyi:114:90:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/traceback.pyi#L235'>stdlib/traceback.pyi:235:96:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/traceback.pyi#L237'>stdlib/traceback.pyi:237:52:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/traceback.pyi#L240'>stdlib/traceback.pyi:240:90:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/traceback.pyi#L242'>stdlib/traceback.pyi:242:44:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementPath.pyi#L11'>stdlib/xml/etree/ElementPath.pyi:11:72:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementPath.pyi#L14'>stdlib/xml/etree/ElementPath.pyi:14:80:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementPath.pyi#L35'>stdlib/xml/etree/ElementPath.pyi:35:90:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementTree.pyi#L109'>stdlib/xml/etree/ElementTree.pyi:109:47:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementTree.pyi#L113'>stdlib/xml/etree/ElementTree.pyi:113:80:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementTree.pyi#L114'>stdlib/xml/etree/ElementTree.pyi:114:27:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementTree.pyi#L161'>stdlib/xml/etree/ElementTree.pyi:161:47:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stdlib/xml/etree/ElementTree.pyi#L171'>stdlib/xml/etree/ElementTree.pyi:171:80:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/JACK-Client/jack/__init__.pyi#L240'>stubs/JACK-Client/jack/__init__.pyi:240:39:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/PyScreeze/pyscreeze/__init__.pyi#L111'>stubs/PyScreeze/pyscreeze/__init__.pyi:111:6:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/PyScreeze/pyscreeze/__init__.pyi#L123'>stubs/PyScreeze/pyscreeze/__init__.pyi:123:6:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/PyScreeze/pyscreeze/__init__.pyi#L205'>stubs/PyScreeze/pyscreeze/__init__.pyi:205:6:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/PyScreeze/pyscreeze/__init__.pyi#L217'>stubs/PyScreeze/pyscreeze/__init__.pyi:217:6:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/Pygments/pygments/filters/__init__.pyi#L10'>stubs/Pygments/pygments/filters/__init__.pyi:10:26:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/Pygments/pygments/formatters/__init__.pyi#L22'>stubs/Pygments/pygments/formatters/__init__.pyi:22:29:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/Pygments/pygments/plugin.pyi#L24'>stubs/Pygments/pygments/plugin.pyi:24:29:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/Pygments/pygments/plugin.pyi#L25'>stubs/Pygments/pygments/plugin.pyi:25:33:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/Pygments/pygments/plugin.pyi#L26'>stubs/Pygments/pygments/plugin.pyi:26:29:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/Pygments/pygments/plugin.pyi#L27'>stubs/Pygments/pygments/plugin.pyi:27:30:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/antlr4-python3-runtime/antlr4/ParserRuleContext.pyi#L32'>stubs/antlr4-python3-runtime/antlr4/ParserRuleContext.pyi:32:46:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/antlr4-python3-runtime/antlr4/RuleContext.pyi#L26'>stubs/antlr4-python3-runtime/antlr4/RuleContext.pyi:26:30:</a> UP043 [*] Unnecessary default type arguments
+ <a href='https://github.com/python/typeshed/blob/de819980041bf9f86ba120e1f070456ce8800d5a/stubs/assertpy/assertpy/assertpy.pyi#L64'>stubs/assertpy/assertpy/assertpy.pyi:64:26:</a> UP043 [*] Unnecessary default type arguments
... 213 additional changes omitted for project
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| UP043 | 265 | 265 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-08-25 12:20</div>
            <div class="timeline-body"><p>This looks right to me but since there's (necessarily) such a huge diff in the ecosystem it would be great if e.g. @AlexWaygood could confirm it's all good (and shouldn't be in preview)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-08-25 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/IDrokin117">@IDrokin117</a> on 2025-09-08 17:47</div>
            <div class="timeline-body"><p>@AlexWaygood Could you please review PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/pyupgrade/UP043.pyi</code>:1 on 2025-09-08 21:50</div>
            <div class="timeline-body"><p>Thanks for identifying one of the files from the issue! However, I'd probably lean toward a stripped-down example over including a file verbatim from another project since the specifics of the code aren't really that important. We could even just duplicate <code>UP043.py</code> and call it <code>UP043.pyi</code>, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/unnecessary_default_type_args.rs</code>:10 on 2025-09-08 21:50</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// `AsyncGenerator` on Python 3.13+ or in stubs.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-08 22:00</div>
            <div class="timeline-body"><p>Thanks! I just had a couple of nits but otherwise I agree with Dylan. This looks good, but I'd like to get quick confirmation from Alex that it makes sense to apply this rule to stubs. I think that's the case based on his comment <a href="https://github.com/astral-sh/ruff/issues/19566#issuecomment-3121685461">here</a> but good to double check.</p>
<p>I also think this should probably be a preview change. It's a straightforward code fix, but expanding the scope of the rule to a new file type seems pretty significant to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-09 12:22</div>
            <div class="timeline-body"><p>Yup, it makes sense for this to always be enabled for stubs regardless of Python version.</p>
<p>I agree with Brent that this should probably be gated behind preview initially. The change was requested by a typeshed maintainer, and I'm also a typeshed maintainer, so I wouldn't worry too much about the impact on typeshed (it's not going to take <em>us</em> by surprise! üòÑ) -- but there are other authors of stubs out there, and it could take them by surprise to have such a big expansion of the rule go directly into a stable rule without a preview-only period first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-09 12:26</div>
            <div class="timeline-body"><p>(Sorry for the delayed response -- been a bit busy recently with a house move and other things!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/IDrokin117">@IDrokin117</a> on 2025-09-09 12:48</div>
            <div class="timeline-body"><p>@AlexWaygood Thanks!<br />
@ntBre I've gated changes behind preview.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> approved on 2025-09-09 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2025-09-09 12:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-09-09 12:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:46:47 UTC
    </footer>
</body>
</html>
