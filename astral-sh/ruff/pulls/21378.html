<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Faster subscript assignment checks for (unions of) `TypedDict`s - astral-sh/ruff #21378</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Faster subscript assignment checks for (unions of) <code>TypedDict</code>s</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21378">#21378</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-11-11 12:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-11 12:59</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>We synthesize a (potentially large) set of <code>__setitem__</code> overloads for every item in a <code>TypedDict</code>. Previously, validation of subscript assignments on <code>TypedDict</code>s relied on actually calling <code>__setitem__</code> with the provided key and value types, which implied that we needed to do the full overload call evaluation for this large set of overloads. This PR improves the performance of subscript assignment checks on <code>TypedDict</code>s by validating the assignment directly instead of calling <code>__setitem__</code>.</p>
<p>This PR also adds better handling for assignments to subscripts on union and intersection types (but does not attempt to make it perfect). It achieves this by distributing the check over unions and intersections, instead of calling <code>__setitem__</code> on the union/intersection directly. We already do something similar when validating <em>attribute</em> assignments.</p>
<h2>Ecosystem impact</h2>
<ul>
<li>A lot of diagnostics change their rule type, and/or split into multiple diagnostics. The new version is more verbose, but easier to understand, in my opinion</li>
<li>Almost all of the invalid-key diagnostics come from pydantic, and they should all go away (including many more) when we implement https://github.com/astral-sh/ty/issues/1479</li>
<li>Everything else looks correct to me. There may be some new diagnostics due to the fact that we now check intersections.</li>
</ul>
<h2>Test Plan</h2>
<p>New Markdown tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-11-11 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @sharkdp on 2025-11-11 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-11 13:02</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<details>
<summary>Changes were detected when running ty on typing conformance tests</summary>

<pre><code class="language-diff">--- old-output.txt	2025-11-12 15:50:26.056135771 +0000
+++ new-output.txt	2025-11-12 15:50:29.708160055 +0000
@@ -745,7 +745,7 @@
 namedtuples_usage.py:34:7: error[index-out-of-bounds] Index 3 is out of bounds for tuple `Point` with length 3
 namedtuples_usage.py:35:7: error[index-out-of-bounds] Index -4 is out of bounds for tuple `Point` with length 3
 namedtuples_usage.py:40:1: error[invalid-assignment] Cannot assign to read-only property `x` on object of type `Point`
-namedtuples_usage.py:41:1: error[invalid-assignment] Cannot assign to object of type `Point` with no `__setitem__` method
+namedtuples_usage.py:41:1: error[invalid-assignment] Cannot assign to a subscript on an object of type `Point` with no `__setitem__` method
 namedtuples_usage.py:52:1: error[invalid-assignment] Too many values to unpack: Expected 2
 namedtuples_usage.py:53:1: error[invalid-assignment] Not enough values to unpack: Expected 4
 narrowing_typeguard.py:17:9: error[type-assertion-failure] Argument does not have asserted type `tuple[str, str]`
@@ -971,7 +971,7 @@
 typeddicts_extra_items.py:339:1: error[type-assertion-failure] Argument does not have asserted type `tuple[str, int]`
 typeddicts_extra_items.py:339:13: error[unresolved-attribute] Object of type `IntDictWithNum` has no attribute `popitem`
 typeddicts_extra_items.py:342:27: error[invalid-key] Cannot access `IntDictWithNum` with a key of type `str`. Only string literals are allowed as keys on TypedDicts.
-typeddicts_extra_items.py:343:31: error[invalid-key] Invalid key for TypedDict `IntDictWithNum` of type `str`
+typeddicts_extra_items.py:343:31: error[invalid-key] Invalid key of type `str` for TypedDict `IntDictWithNum`
 typeddicts_extra_items.py:352:5: error[invalid-assignment] Object of type `dict[str, int]` is not assignable to `IntDict`
 typeddicts_operations.py:22:17: error[invalid-assignment] Invalid assignment to key &quot;name&quot; with declared type `str` on TypedDict `Movie`: value of type `Literal[1982]`
 typeddicts_operations.py:23:17: error[invalid-assignment] Invalid assignment to key &quot;year&quot; with declared type `int` on TypedDict `Movie`: value of type `Literal[&quot;&quot;]`

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-11 13:03</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">more-itertools (https://github.com/more-itertools/more-itertools)
- more_itertools/more.py:5392:21: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | list[Unknown | None] | None` may be missing
- more_itertools/more.py:5393:21: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | list[Unknown | None] | None` may be missing
+ more_itertools/more.py:5392:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ more_itertools/more.py:5393:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method

parso (https://github.com/davidhalter/parso)
- parso/pgen2/generator.py:100:9: error[invalid-assignment] Cannot assign to object of type `Mapping[str, DFAState[Unknown]]` with no `__setitem__` method
+ parso/pgen2/generator.py:100:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `Mapping[str, DFAState[Unknown]]` with no `__setitem__` method
- parso/pgen2/generator.py:105:17: error[invalid-assignment] Cannot assign to object of type `Mapping[str, DFAState[Unknown]]` with no `__setitem__` method
+ parso/pgen2/generator.py:105:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `Mapping[str, DFAState[Unknown]]` with no `__setitem__` method

spack (https://github.com/spack/spack)
- lib/spack/spack/vendor/macholib/MachO.py:405:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | list[Unknown]` may be missing
+ lib/spack/spack/vendor/macholib/MachO.py:405:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method

stone (https://github.com/dropbox/stone)
- stone/ir/data_types.py:1121:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown, Unknown]` may be missing
- stone/ir/data_types.py:1223:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | OrderedDict[Unknown, Unknown]` may be missing
- stone/ir/data_types.py:1259:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | OrderedDict[Unknown, Unknown]` may be missing
+ stone/ir/data_types.py:1121:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ stone/ir/data_types.py:1223:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ stone/ir/data_types.py:1259:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- stone/ir/data_types.py:1275:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | OrderedDict[Unknown, Unknown]` may be missing
+ stone/ir/data_types.py:1275:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- stone/ir/data_types.py:1483:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | OrderedDict[Unknown, Unknown]` may be missing
+ stone/ir/data_types.py:1483:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- stone/ir/data_types.py:1509:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | OrderedDict[Unknown, Unknown]` may be missing
- stone/ir/data_types.py:1515:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | OrderedDict[Unknown, Unknown]` may be missing
+ stone/ir/data_types.py:1509:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ stone/ir/data_types.py:1515:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method

werkzeug (https://github.com/pallets/werkzeug)
- src/werkzeug/utils.py:91:13: error[invalid-assignment] Cannot assign to object of type `object` with no `__setitem__` method
+ src/werkzeug/utils.py:91:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `object` with no `__setitem__` method
- tests/test_routing.py:604:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | Mapping[str, Any] | None` may be missing
+ tests/test_routing.py:604:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `Mapping[str, Any]` with no `__setitem__` method
+ tests/test_routing.py:604:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- Found 408 diagnostics
+ Found 409 diagnostics

pip (https://github.com/pypa/pip)
- src/pip/_vendor/requests/models.py:549:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | CaseInsensitiveDict` may be missing
- src/pip/_vendor/requests/models.py:551:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | CaseInsensitiveDict` may be missing
+ src/pip/_vendor/requests/models.py:549:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ src/pip/_vendor/requests/models.py:551:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- src/pip/_vendor/requests/models.py:568:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | CaseInsensitiveDict` may be missing
- src/pip/_vendor/requests/models.py:579:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | CaseInsensitiveDict` may be missing
+ src/pip/_vendor/requests/models.py:568:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ src/pip/_vendor/requests/models.py:579:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- src/pip/_vendor/requests/models.py:586:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | CaseInsensitiveDict` may be missing
- src/pip/_vendor/requests/models.py:628:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | CaseInsensitiveDict` may be missing
+ src/pip/_vendor/requests/models.py:586:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ src/pip/_vendor/requests/models.py:628:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method

twine (https://github.com/pypa/twine)
+ twine/package.py:264:38: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 10 diagnostics
+ Found 11 diagnostics

scrapy (https://github.com/scrapy/scrapy)
- tests/test_http2_client_protocol.py:114:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | dict[Unknown, Unknown] | str` may be missing
+ tests/test_http2_client_protocol.py:114:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- tests/test_logformatter.py:187:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `dict[str, Any] | tuple[Any, ...]` may be missing
+ tests/test_logformatter.py:187:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `tuple[Any, ...]` with no `__setitem__` method

paasta (https://github.com/yelp/paasta)
- paasta_tools/paastaapi/api_client.py:713:21: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown, Unknown] | list[Unknown]` may be missing
- paasta_tools/paastaapi/api_client.py:717:21: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown, Unknown] | list[Unknown]` may be missing
+ paasta_tools/paastaapi/api_client.py:713:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ paasta_tools/paastaapi/api_client.py:717:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- paasta_tools/paastaapi/api_client.py:722:21: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown, Unknown] | list[Unknown]` may be missing
- paasta_tools/paastaapi/api_client.py:725:21: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown, Unknown] | list[Unknown]` may be missing
+ paasta_tools/paastaapi/api_client.py:722:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ paasta_tools/paastaapi/api_client.py:725:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- paasta_tools/paastaapi/model_utils.py:169:9: error[invalid-assignment] Cannot assign to object of type `Self@__setattr__` with no `__setitem__` method
+ paasta_tools/paastaapi/model_utils.py:169:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `Self@__setattr__` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:307:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:307:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:311:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:311:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:314:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:314:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:317:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:317:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:318:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:318:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:319:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:319:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:320:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:320:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/setup_kubernetes_cr.py:321:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str] | dict[Unknown, Unknown]` may be missing
+ paasta_tools/setup_kubernetes_cr.py:321:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- paasta_tools/tron/client.py:50:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | dict[Unknown | str, Unknown | str]` may be missing
+ paasta_tools/tron/client.py:50:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method

kopf (https://github.com/nolar/kopf)
- kopf/_cogs/structs/credentials.py:164:25: warning[possibly-missing-implicit-call] Method `__setitem__` of type `dict[str, object] | None` may be missing
+ kopf/_cogs/structs/credentials.py:164:25: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method

pytest (https://github.com/pytest-dev/pytest)
- src/_pytest/pastebin.py:43:13: error[invalid-assignment] Method `__setitem__` of type `Unknown | (bound method Stash.__setitem__[T](key: StashKey[T@__setitem__], value: T@__setitem__) -&gt; None)` cannot be called with a key of type `StashKey[IO[bytes]]` and a value of type `TextIOWrapper[_WrappedBuffer]` on object of type `Unknown | Stash`
+ src/_pytest/pastebin.py:43:13: error[invalid-assignment] Method `__setitem__` of type `bound method Stash.__setitem__[T](key: StashKey[T@__setitem__], value: T@__setitem__) -&gt; None` cannot be called with a key of type `StashKey[IO[bytes]]` and a value of type `TextIOWrapper[_WrappedBuffer]` on object of type `Stash`

sockeye (https://github.com/awslabs/sockeye)
- sockeye/log.py:131:9: error[invalid-assignment] Method `__setitem__` of type `Unknown | (bound method dict[Unknown | str, Unknown | str].__setitem__(key: Unknown | str, value: Unknown | str, /) -&gt; None) | (bound method dict[Unknown | str, Unknown | str | None].__setitem__(key: Unknown | str, value: Unknown | str | None, /) -&gt; None) | (bound method dict[Unknown | str, Unknown | str | int].__setitem__(key: Unknown | str, value: Unknown | str | int, /) -&gt; None) | (Overload[(key: SupportsIndex, value: Unknown | str, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown | str], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;level&quot;]` and a value of type `Unknown | Literal[20]` on object of type `Unknown | dict[Unknown | str, Unknown | str] | dict[Unknown | str, Unknown | str | None] | ... omitted 3 union elements`
+ sockeye/log.py:131:9: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown | str, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown | str], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;level&quot;]` and a value of type `Unknown | Literal[20]` on object of type `list[Unknown | str]`
+ sockeye/log.py:131:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- Found 406 diagnostics
+ Found 407 diagnostics

pybind11 (https://github.com/pybind/pybind11)
- tests/test_sequences_and_iterators.py:157:5: error[invalid-assignment] Cannot assign to object of type `reversed[Unknown]` with no `__setitem__` method
+ tests/test_sequences_and_iterators.py:157:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `reversed[Unknown]` with no `__setitem__` method

tornado (https://github.com/tornadoweb/tornado)
- tornado/test/httpclient_test.py:521:17: error[invalid-assignment] Method `__setitem__` of type `Unknown | (bound method dict[Unknown, Unknown].__setitem__(key: Unknown, value: Unknown, /) -&gt; None) | (bound method HTTPHeaders.__setitem__(name: str, value: str) -&gt; None)` cannot be called with a key of type `Literal[&quot;User-Agent&quot;]` and a value of type `Unknown | str | bytes` on object of type `Unknown | dict[Unknown, Unknown] | HTTPHeaders`
+ tornado/test/httpclient_test.py:521:17: error[invalid-assignment] Method `__setitem__` of type `bound method HTTPHeaders.__setitem__(name: str, value: str) -&gt; None` cannot be called with a key of type `Literal[&quot;User-Agent&quot;]` and a value of type `Unknown | str | bytes` on object of type `HTTPHeaders`

poetry (https://github.com/python-poetry/poetry)
+ src/poetry/utils/env/mock_env.py:80:42: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 975 diagnostics
+ Found 976 diagnostics

urllib3 (https://github.com/urllib3/urllib3)
- src/urllib3/contrib/emscripten/fetch.py:400:9: error[invalid-assignment] Cannot assign to object of type `Buffer` with no `__setitem__` method
+ src/urllib3/contrib/emscripten/fetch.py:400:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `Buffer` with no `__setitem__` method

dragonchain (https://github.com/dragonchain/dragonchain)
- dragonchain/job_processor/contract_job.py:121:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:122:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:127:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:128:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:129:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:130:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:131:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
- dragonchain/job_processor/contract_job.py:132:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None` may be missing
+ dragonchain/job_processor/contract_job.py:121:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:122:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:127:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:128:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:129:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:130:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:131:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ dragonchain/job_processor/contract_job.py:132:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method

mitmproxy (https://github.com/mitmproxy/mitmproxy)
+ mitmproxy/addons/savehar.py:206:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ mitmproxy/addons/savehar.py:206:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- mitmproxy/addons/savehar.py:206:17: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]) | (bound method dict[Unknown | str, Unknown | int].__setitem__(key: Unknown | str, value: Unknown | int, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;text&quot;]` and a value of type `str` on object of type `Unknown | int | str | list[dict[Unknown, Unknown]] | dict[Unknown | str, Unknown | int]`
+ mitmproxy/addons/savehar.py:206:17: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;text&quot;]` and a value of type `str` on object of type `list[dict[Unknown, Unknown]]`
+ mitmproxy/addons/savehar.py:207:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ mitmproxy/addons/savehar.py:207:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- mitmproxy/addons/savehar.py:207:17: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]) | (bound method dict[Unknown | str, Unknown | int].__setitem__(key: Unknown | str, value: Unknown | int, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;encoding&quot;]` and a value of type `Literal[&quot;base64&quot;]` on object of type `Unknown | int | str | list[dict[Unknown, Unknown]] | dict[Unknown | str, Unknown | int]`
+ mitmproxy/addons/savehar.py:207:17: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;encoding&quot;]` and a value of type `Literal[&quot;base64&quot;]` on object of type `list[dict[Unknown, Unknown]]`
+ mitmproxy/addons/savehar.py:211:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ mitmproxy/addons/savehar.py:211:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- mitmproxy/addons/savehar.py:211:21: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]) | (bound method dict[Unknown | str, Unknown | int].__setitem__(key: Unknown | str, value: Unknown | int, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;text&quot;]` and a value of type `Literal[&quot;&quot;]` on object of type `Unknown | int | str | list[dict[Unknown, Unknown]] | dict[Unknown | str, Unknown | int]`
+ mitmproxy/addons/savehar.py:211:21: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;text&quot;]` and a value of type `Literal[&quot;&quot;]` on object of type `list[dict[Unknown, Unknown]]`
+ mitmproxy/addons/savehar.py:213:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ mitmproxy/addons/savehar.py:213:21: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- mitmproxy/addons/savehar.py:213:21: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]) | (bound method dict[Unknown | str, Unknown | int].__setitem__(key: Unknown | str, value: Unknown | int, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;text&quot;]` and a value of type `str` on object of type `Unknown | int | str | list[dict[Unknown, Unknown]] | dict[Unknown | str, Unknown | int]`
+ mitmproxy/addons/savehar.py:213:21: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: dict[Unknown, Unknown], /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[dict[Unknown, Unknown]], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;text&quot;]` and a value of type `str` on object of type `list[dict[Unknown, Unknown]]`
- mitmproxy/io/compat.py:324:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | dict[Unknown, Unknown] | str | ... omitted 3 union elements` may be missing
+ mitmproxy/io/compat.py:324:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
+ mitmproxy/io/compat.py:324:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ mitmproxy/io/compat.py:324:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
- Found 1833 diagnostics
+ Found 1843 diagnostics

schema_salad (https://github.com/common-workflow-language/schema_salad)
- schema_salad/jsonld_context.py:211:17: error[invalid-assignment] Method `__setitem__` of type `bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None` cannot be called with a key of type `Literal[&quot;@id&quot;]` and a value of type `@Todo` on object of type `(CommentedMap &amp; Top[MutableMapping[Unknown, Unknown]]) | (int &amp; Top[MutableMapping[Unknown, Unknown]]) | (float &amp; Top[MutableMapping[Unknown, Unknown]]) | (str &amp; Top[MutableMapping[Unknown, Unknown]]) | (CommentedSeq &amp; Top[MutableMapping[Unknown, Unknown]])`
+ schema_salad/jsonld_context.py:211:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ schema_salad/jsonld_context.py:211:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `float` with no `__setitem__` method
+ schema_salad/jsonld_context.py:211:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- schema_salad/jsonld_context.py:245:13: error[invalid-assignment] Cannot assign to object of type `object` with no `__setitem__` method
+ schema_salad/jsonld_context.py:245:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `object` with no `__setitem__` method
- schema_salad/jsonld_context.py:252:9: error[invalid-assignment] Method `__setitem__` of type `bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None` cannot be called with a key of type `Literal[&quot;@context&quot;]` and a value of type `@Todo` on object of type `(CommentedMap &amp; Top[MutableMapping[Unknown, Unknown]] &amp; ~Top[MutableSequence[Unknown]]) | (int &amp; Top[MutableMapping[Unknown, Unknown]] &amp; ~Top[MutableSequence[Unknown]]) | (float &amp; Top[MutableMapping[Unknown, Unknown]] &amp; ~Top[MutableSequence[Unknown]]) | (str &amp; Top[MutableMapping[Unknown, Unknown]] &amp; ~Top[MutableSequence[Unknown]])`
+ schema_salad/jsonld_context.py:252:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ schema_salad/jsonld_context.py:252:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `float` with no `__setitem__` method
+ schema_salad/jsonld_context.py:252:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- schema_salad/schema.py:541:17: error[invalid-assignment] Method `__setitem__` of type `(bound method MutableMapping[str, Any].__setitem__(key: str, value: Any, /) -&gt; None) | (bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;name&quot;]` and a value of type `str` on object of type `MutableMapping[str, Any] | (MutableSequence[Any] &amp; Top[MutableMapping[Unknown, Unknown]]) | (str &amp; Top[MutableMapping[Unknown, Unknown]])`
- schema_salad/schema.py:543:17: error[invalid-assignment] Method `__setitem__` of type `(bound method MutableMapping[str, Any].__setitem__(key: str, value: Any, /) -&gt; None) | (bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;name&quot;]` and a value of type `str` on object of type `MutableMapping[str, Any] | (MutableSequence[Any] &amp; Top[MutableMapping[Unknown, Unknown]]) | (str &amp; Top[MutableMapping[Unknown, Unknown]])`
+ schema_salad/schema.py:541:17: error[invalid-assignment] Method `__setitem__` of type `Overload[(index: int, value: Any) -&gt; None, (index: slice[Any, Any, Any], value: Iterable[Any]) -&gt; None]` cannot be called with a key of type `Literal[&quot;name&quot;]` and a value of type `str` on object of type `MutableSequence[Any]`
+ schema_salad/schema.py:541:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
+ schema_salad/schema.py:543:17: error[invalid-assignment] Method `__setitem__` of type `Overload[(index: int, value: Any) -&gt; None, (index: slice[Any, Any, Any], value: Iterable[Any]) -&gt; None]` cannot be called with a key of type `Literal[&quot;name&quot;]` and a value of type `str` on object of type `MutableSequence[Any]`
+ schema_salad/schema.py:543:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- schema_salad/schema.py:563:17: error[invalid-assignment] Method `__setitem__` of type `(bound method MutableMapping[str, Any].__setitem__(key: str, value: Any, /) -&gt; None) | (bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;type&quot;, &quot;items&quot;, &quot;names&quot;, &quot;values&quot;, &quot;fields&quot;]` and a value of type `MutableMapping[str, Any] | MutableSequence[Any] | str | MutableMapping[str, str] | list[Any | MutableMapping[str, str] | str]` on object of type `MutableMapping[str, Any] | (MutableSequence[Any] &amp; Top[MutableMapping[Unknown, Unknown]]) | (str &amp; Top[MutableMapping[Unknown, Unknown]])`
- schema_salad/schema.py:572:13: error[invalid-assignment] Method `__setitem__` of type `(bound method MutableMapping[str, Any].__setitem__(key: str, value: Any, /) -&gt; None) | (bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None)` cannot be called with a key of type `Literal[&quot;symbols&quot;]` and a value of type `list[str | Unknown]` on object of type `MutableMapping[str, Any] | (MutableSequence[Any] &amp; Top[MutableMapping[Unknown, Unknown]]) | (str &amp; Top[MutableMapping[Unknown, Unknown]])`
+ schema_salad/schema.py:563:17: error[invalid-assignment] Method `__setitem__` of type `Overload[(index: int, value: Any) -&gt; None, (index: slice[Any, Any, Any], value: Iterable[Any]) -&gt; None]` cannot be called with a key of type `Literal[&quot;type&quot;, &quot;items&quot;, &quot;names&quot;, &quot;values&quot;, &quot;fields&quot;]` and a value of type `MutableMapping[str, Any] | MutableSequence[Any] | str | MutableMapping[str, str] | list[Any | MutableMapping[str, str] | str]` on object of type `MutableSequence[Any]`
+ schema_salad/schema.py:563:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
+ schema_salad/schema.py:572:13: error[invalid-assignment] Method `__setitem__` of type `Overload[(index: int, value: Any) -&gt; None, (index: slice[Any, Any, Any], value: Iterable[Any]) -&gt; None]` cannot be called with a key of type `Literal[&quot;symbols&quot;]` and a value of type `list[str | Unknown]` on object of type `MutableSequence[Any]`
+ schema_salad/schema.py:572:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
- Found 176 diagnostics
+ Found 184 diagnostics

mypy (https://github.com/python/mypy)
- mypy/report.py:685:9: error[invalid-assignment] Method `__setitem__` of type `Unknown | (bound method dict[str, Any].__setitem__(key: str, value: Any, /) -&gt; None)` cannot be called with a key of type `bytes` and a value of type `Unknown` on object of type `Unknown | dict[str, Any]`
+ mypy/report.py:685:9: error[invalid-assignment] Method `__setitem__` of type `bound method dict[str, Any].__setitem__(key: str, value: Any, /) -&gt; None` cannot be called with a key of type `bytes` and a value of type `Unknown` on object of type `dict[str, Any]`

psycopg (https://github.com/psycopg/psycopg)
- psycopg/psycopg/_adapters_map.py:147:21: error[invalid-assignment] Method `__setitem__` of type `Unknown | (bound method dict[Unknown, Literal[False]].__setitem__(key: Unknown, value: Literal[False], /) -&gt; None) | (bound method dict[Unknown, Literal[True]].__setitem__(key: Unknown, value: Literal[True], /) -&gt; None)` cannot be called with a key of type `PyFormat` and a value of type `Literal[True]` on object of type `Unknown | dict[Unknown, Literal[False]] | dict[Unknown, Literal[True]]`
+ psycopg/psycopg/_adapters_map.py:147:21: error[invalid-assignment] Method `__setitem__` of type `bound method dict[Unknown, Literal[False]].__setitem__(key: Unknown, value: Literal[False], /) -&gt; None` cannot be called with a key of type `PyFormat` and a value of type `Literal[True]` on object of type `dict[Unknown, Literal[False]]`

Tanjun (https://github.com/FasterSpeeding/Tanjun)
- tanjun/clients.py:2720:13: error[invalid-assignment] Method `__setitem__` of type `(bound method dict[str, ModuleType].__setitem__(key: str, value: ModuleType, /) -&gt; None) | (bound method dict[Path, ModuleType].__setitem__(key: Path, value: ModuleType, /) -&gt; None)` cannot be called with a key of type `str | Path` and a value of type `@Todo` on object of type `dict[str, ModuleType] | dict[Path, ModuleType]`
+ tanjun/clients.py:2720:13: error[invalid-assignment] Method `__setitem__` of type `bound method dict[str, ModuleType].__setitem__(key: str, value: ModuleType, /) -&gt; None` cannot be called with a key of type `str | Path` and a value of type `@Todo` on object of type `dict[str, ModuleType]`
+ tanjun/clients.py:2720:13: error[invalid-assignment] Method `__setitem__` of type `bound method dict[Path, ModuleType].__setitem__(key: Path, value: ModuleType, /) -&gt; None` cannot be called with a key of type `str | Path` and a value of type `@Todo` on object of type `dict[Path, ModuleType]`
- Found 153 diagnostics
+ Found 154 diagnostics

freqtrade (https://github.com/freqtrade/freqtrade)
- freqtrade/freqai/freqai_interface.py:890:21: error[invalid-assignment] Method `__setitem__` of type `Unknown | (bound method dict[str, DataFrame].__setitem__(key: str, value: DataFrame, /) -&gt; None)` cannot be called with a key of type `Unknown | str` and a value of type `Series[Any]` on object of type `Unknown | dict[str, DataFrame]`
+ freqtrade/freqai/freqai_interface.py:890:21: error[invalid-assignment] Method `__setitem__` of type `bound method dict[str, DataFrame].__setitem__(key: str, value: DataFrame, /) -&gt; None` cannot be called with a key of type `Unknown | str` and a value of type `Series[Any]` on object of type `dict[str, DataFrame]`

xarray (https://github.com/pydata/xarray)
- xarray/core/dataset.py:4622:17: error[invalid-assignment] Method `__setitem__` of type `bound method Top[MutableMapping[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None` cannot be called with a key of type `Unknown` and a value of type `int` on object of type `Mapping[Hashable, Any] &amp; Top[MutableMapping[Unknown, Unknown]]`
+ xarray/core/dataset.py:4622:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `Mapping[Hashable, Any]` with no `__setitem__` method
- xarray/core/groupby.py:772:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `DatasetCoordinates | Any | property` may be missing
+ xarray/core/groupby.py:772:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `property` with no `__setitem__` method
- xarray/core/options.py:332:35: error[invalid-key] Invalid key for TypedDict `T_Options` of type `str`
+ xarray/core/options.py:332:35: error[invalid-key] Invalid key of type `str` for TypedDict `T_Options`
- xarray/core/variable.py:1226:17: error[invalid-assignment] Cannot assign to object of type `Mapping[Any, int | float | tuple[int | float, int | float]]` with no `__setitem__` method
+ xarray/core/variable.py:1226:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `Mapping[Any, int | float | tuple[int | float, int | float]]` with no `__setitem__` method
- xarray/groupers.py:637:9: error[invalid-assignment] Cannot assign to object of type `signedinteger[@Todo]` with no `__setitem__` method
+ xarray/groupers.py:637:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `signedinteger[@Todo]` with no `__setitem__` method
- xarray/groupers.py:639:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `signedinteger[@Todo] | @Todo` may be missing
+ xarray/groupers.py:639:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `signedinteger[@Todo]` with no `__setitem__` method

trio (https://github.com/python-trio/trio)
- src/trio/_wait_for_object.py:63:9: error[invalid-assignment] Cannot assign to object of type `HandleArray` with no `__setitem__` method
+ src/trio/_wait_for_object.py:63:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `HandleArray` with no `__setitem__` method

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
- pymongo/asynchronous/server.py:275:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | dict[Unknown | str, Unknown | Int64 | str] | int` may be missing
- pymongo/asynchronous/server.py:277:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | dict[Unknown | str, Unknown | Int64 | str] | int` may be missing
+ pymongo/asynchronous/server.py:275:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ pymongo/asynchronous/server.py:277:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
- pymongo/synchronous/server.py:275:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | dict[Unknown | str, Unknown | Int64 | str] | int` may be missing
- pymongo/synchronous/server.py:277:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | dict[Unknown | str, Unknown | Int64 | str] | int` may be missing
+ pymongo/synchronous/server.py:275:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ pymongo/synchronous/server.py:277:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method

discord.py (https://github.com/Rapptz/discord.py)
- discord/gateway.py:466:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | int | dict[Unknown | str, Unknown | str | None | dict[Unknown | str, Unknown | str] | int]` may be missing
- discord/gateway.py:470:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | int | dict[Unknown | str, Unknown | str | None | dict[Unknown | str, Unknown | str] | int]` may be missing
- discord/gateway.py:478:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | int | dict[Unknown | str, Unknown | str | None | dict[Unknown | str, Unknown | str] | int]` may be missing
+ discord/gateway.py:466:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ discord/gateway.py:470:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ discord/gateway.py:478:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
- discord/gateway.py:735:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | int | dict[Unknown | str, Unknown | int]` may be missing
- discord/gateway.py:738:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | int | dict[Unknown | str, Unknown | int]` may be missing
- discord/gateway.py:741:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | int | dict[Unknown | str, Unknown | int]` may be missing
+ discord/gateway.py:735:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ discord/gateway.py:738:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
+ discord/gateway.py:741:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `int` with no `__setitem__` method
- discord/message.py:2404:30: error[invalid-key] Invalid key for TypedDict `Message` of type `str`
+ discord/message.py:2404:30: error[invalid-key] Invalid key of type `str` for TypedDict `Message`

vision (https://github.com/pytorch/vision)
- references/classification/utils.py:319:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `None | Unknown` may be missing
+ references/classification/utils.py:319:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- torchvision/models/densenet.py:235:13: error[invalid-assignment] Cannot assign to object of type `Mapping[str, Any]` with no `__setitem__` method
+ torchvision/models/densenet.py:235:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `Mapping[str, Any]` with no `__setitem__` method
- torchvision/transforms/v2/_utils.py:69:13: error[invalid-assignment] Method `__setitem__` of type `(bound method Top[dict[Unknown, Unknown]].__setitem__(key: Never, value: Never, /) -&gt; None) | (bound method dict[type | str, int | float | Sequence[int | float] | None].__setitem__(key: type | str, value: int | float | Sequence[int | float] | None, /) -&gt; None)` cannot be called with a key of type `object` and a value of type `list[int | float] | None` on object of type `(Sequence[int | float] &amp; Top[dict[Unknown, Unknown]]) | dict[type | str, int | float | Sequence[int | float] | None]`
+ torchvision/transforms/v2/_utils.py:69:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `Sequence[int | float]` with no `__setitem__` method
+ torchvision/transforms/v2/_utils.py:69:13: error[invalid-assignment] Method `__setitem__` of type `bound method dict[type | str, int | float | Sequence[int | float] | None].__setitem__(key: type | str, value: int | float | Sequence[int | float] | None, /) -&gt; None` cannot be called with a key of type `object` and a value of type `list[int | float] | None` on object of type `dict[type | str, int | float | Sequence[int | float] | None]`
- Found 1445 diagnostics
+ Found 1446 diagnostics

pyppeteer (https://github.com/pyppeteer/pyppeteer)
- pyppeteer/network_manager.py:727:13: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | str | None | dict[Unknown, Unknown]` may be missing
+ pyppeteer/network_manager.py:727:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `str` with no `__setitem__` method
+ pyppeteer/network_manager.py:727:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- Found 87 diagnostics
+ Found 88 diagnostics

cloud-init (https://github.com/canonical/cloud-init)
- cloudinit/cmd/main.py:952:5: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown | str, Unknown | list[Unknown] | dict[Unknown, Unknown] | None]` may be missing
+ cloudinit/cmd/main.py:952:5: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- cloudinit/cmd/main.py:995:9: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | None | dict[Unknown | str, Unknown | list[Unknown] | dict[Unknown, Unknown] | None]` may be missing
+ cloudinit/cmd/main.py:995:9: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
+ cloudinit/cmd/main.py:1003:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- cloudinit/cmd/main.py:1003:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | list[Unknown] | dict[Unknown, Unknown] | None` may be missing
+ cloudinit/cmd/main.py:1010:17: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- cloudinit/cmd/main.py:1010:17: warning[possibly-missing-implicit-call] Method `__setitem__` of type `Unknown | list[Unknown] | dict[Unknown, Unknown] | None` may be missing
- cloudinit/net/network_state.py:340:17: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;dns&quot;]` and a value of type `dict[Unknown | str, Unknown]` on object of type `(Unknown &amp; ~AlwaysFalsy) | (list[Unknown] &amp; ~AlwaysFalsy)`
+ cloudinit/net/network_state.py:340:17: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;dns&quot;]` and a value of type `dict[Unknown | str, Unknown]` on object of type `list[Unknown]`
- cloudinit/net/network_state.py:437:13: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;mac_address&quot;]` and a value of type `Unknown` on object of type `Unknown | list[Unknown]`
+ cloudinit/net/network_state.py:437:13: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;mac_address&quot;]` and a value of type `Unknown` on object of type `list[Unknown]`
- cloudinit/net/network_state.py:456:9: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;vlan-raw-device&quot;]` and a value of type `Unknown` on object of type `Unknown | list[Unknown]`
+ cloudinit/net/network_state.py:456:9: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;vlan-raw-device&quot;]` and a value of type `Unknown` on object of type `list[Unknown]`
- cloudinit/net/network_state.py:457:9: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;vlan_id&quot;]` and a value of type `Unknown` on object of type `Unknown | list[Unknown]`
+ cloudinit/net/network_state.py:457:9: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;vlan_id&quot;]` and a value of type `Unknown` on object of type `list[Unknown]`
+ cloudinit/net/network_state.py:507:13: error[invalid-assignment] Cannot assign to a subscript on an object of type `None` with no `__setitem__` method
- cloudinit/net/network_state.py:507:13: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;bond-master&quot;]` and a value of type `Unknown` on object of type `Unknown | None | list[Unknown]`
+ cloudinit/net/network_state.py:507:13: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;bond-master&quot;]` and a value of type `Unknown` on object of type `list[Unknown]`
- cloudinit/net/network_state.py:558:9: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;bridge_ports&quot;]` and a value of type `Unknown` on object of type `Unknown | list[Unknown]`
+ cloudinit/net/network_state.py:558:9: error[invalid-assignment] Method `__setitem__` of type `Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None]` cannot be called with a key of type `Literal[&quot;bridge_ports&quot;]` and a value of type `Unknown` on object of type `list[Unknown]`
- cloudinit/net/network_state.py:616:9: error[invalid-assignment] Method `__setitem__` of type `Unknown | (Overload[(key: SupportsIndex, value: Unknown, /) -&gt; None, (key: slice[Any, Any, Any], value: Iterable[Unknown], /) -&gt; None])` cannot be called with a key of type `Literal[&quot;dns&quot;]` and a value of type `dict[Unknown | str, Unknown]

... (truncated 3104 lines) ...
</code></pre>
</details>

<details>
<summary>Memory usage changes were detected when running on open source projects</summary>

<pre><code class="language-diff">flake8 (https://github.com/pycqa/flake8)
- TOTAL MEMORY USAGE: ~66MB
+ TOTAL MEMORY USAGE: ~63MB


</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-11 13:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-11 13:10</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-key</code> | 1,907 | 0 | 122 |
| <code>invalid-assignment</code> | 504 | 49 | 183 |
| <code>possibly-missing-implicit-call</code> | 0 | 272 | 0 |
| <code>unused-ignore-comment</code> | 3 | 0 | 0 |
| <strong>Total</strong> | <strong>2,414</strong> | <strong>321</strong> | <strong>305</strong> |</p>
<p><strong><a href="https://david-faster-subscript-assig.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://david-faster-subscript-assig.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-11-11 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-11 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-11-11 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2025-11-11 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-11-11 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @sharkdp on 2025-11-11 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-11 14:00</div>
            <div class="timeline-body"><p>I wondered about how this might affect assignability and subtyping of <code>TypedDict</code>s to protocols, e.g.</p>
<pre><code class="language-py">from ty_extensions import static_assert, is_subtype_of, is_assignable_to
from typing import Protocol, Literal, TypedDict

class Foo(Protocol):
    def __setitem__(self, key: Literal[&quot;x&quot;], value: int, /) -&gt; None: ...

class Bar(TypedDict):
    x: int

static_assert(is_assignable_to(Bar, Foo))
static_assert(is_subtype_of(Bar, Foo))
</code></pre>
<p>but I suppose it's impossible to test that right now, because <code>TypedDict</code>s are currently considered assignable to everything and subtypes of nothing, until https://github.com/astral-sh/ty/issues/1387 is fixed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-11 14:01</div>
            <div class="timeline-body"><p>If need be, we could always add a special case for <code>TypedDict -&gt; Protocol</code> assignability/subtyping (we could synthesize the required method on the fly during the assignability/subtyping check?), but it's nice to keep that kind of special case to a minimum.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-11 14:17</div>
            <div class="timeline-body"><blockquote>
<p>I wondered about how this might affect assignability and subtyping of <code>TypedDict</code>s to protocols, e.g.</p>
</blockquote>
<p>Did you steal that from my comment yesterday? :smile:</p>
<p>I guess the PR would complicate the situation, but no other type checker generates these precise overloads either. I guess we could maybe keep these overloads and then prevent calling <code>__setitem__</code> in <code>validate_subscript_assignment</code>? But I'd rather like to postpone this discussion for now, unless you think it's important.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-11 14:22</div>
            <div class="timeline-body"><blockquote>
<p>I guess we could maybe keep these overloads and then prevent calling <code>__setitem__</code> in <code>validate_subscript_assignment</code>?</p>
</blockquote>
<p>I think I would prefer that? It'll probably make Jack's life easier, considering that he intends to start working on https://github.com/astral-sh/ty/issues/1387 today, I think. It doesn't seem like it'll be too hard to make that change in this PR, and it seems silly to get rid of the overloads here if there's a strong chance we'll only add them back in one or two days to fix this edge case.</p>
<p>And yes, other type checkers don't do great on this edge case either, but I hope that we can make ty better than other type checkers on things like this </p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-11 15:10</div>
            <div class="timeline-body"><blockquote>
<p>I think I would prefer that? It'll probably make Jack's life easier, considering that he intends to start working on <a href="https://github.com/astral-sh/ty/issues/1387">astral-sh/ty#1387</a> today, I think. It doesn't seem like it'll be too hard to make that change in this PR, and it seems silly to get rid of the overloads here if there's a strong chance we'll only add them back in one or two days to fix this edge case.</p>
</blockquote>
<p>I made the change, and I like it better. It lets us keep the overloads and improves the diagnostics in one case. But the optimization doesn't work anymore on pydantic :weary:. Looking into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Faster subscript assignment checks on `TypedDict`s" to "[ty] Faster subscript assignment checks for (unions of) `TypedDict`s" by @sharkdp on 2025-11-12 12:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-11-12 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-12 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @sharkdp on 2025-11-12 12:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-12 13:02</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p> ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p> ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-11-12 13:02</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/david%2Ffaster-subscript-assignment-checks?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a></h2>
<h3>Merging #21378 will <strong>improve performances by 86.14%</strong></h3>
<p><sub>Comparing <code>david/faster-subscript-assignment-checks</code> (ccb7a0c) with <code>main</code> (84c3cec)</sub></p>
<h3>Summary</h3>
<p><code> 1</code> improvement<br />
<code> 51</code> untouched<br />
<code> 2</code> skipped[^skipped]</p>
<h3>Benchmarks breakdown</h3>
<p>|     | Mode | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | ---- | --------- | ------ | ------ | ------ |
|  | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/david%2Ffaster-subscript-assignment-checks?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Alarge%5Bpydantic%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>large[pydantic]</code></a> | 38.2 s | 20.5 s | +86.14% |
[^skipped]: 2 benchmarks were skipped, so the baseline results were used instead. If they were deleted from the codebase, <a href="https://codspeed.io/astral-sh/ruff/branches/david%2Ffaster-subscript-assignment-checks?sectionId=benchmark-comparison-section-baseline-result-skipped&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=archive">click here and archive them to remove them from the performance reports</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-11-12 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-12 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-11-12 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-12 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-12 15:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3571 on 2025-11-12 15:27</div>
            <div class="timeline-body"><p>No, I am not proud, but it feels like there are more important things. Will add this as a personal TODO note.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-12 15:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ruff_benchmark/benches/ty_walltime.rs</code>:184 on 2025-11-12 15:28</div>
            <div class="timeline-body"><p>The increase here is caused by the fact that we now split diagnostic on unions into N_elements diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-11-12 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-11-12 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-11-12 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/assignment_diagnosti_-_Subscript_assignment_-_Possibly_missing_`___(efd3f0c02e9b89e9).snap</code>:30 on 2025-11-12 16:12</div>
            <div class="timeline-body"><p>This is definitely an improvement, but he summary line here still feels too long to me -- for a blanket &quot;cannot assign to a subscript&quot; diagnostic, there's no other reason why this would be emitted except for a missing <code>__setitem__</code> method. Ideally I'd go for something like this:</p>
<pre><code>error[invalid-assignment]: Cannot assign to a subscript on an object of type `None`
 --&gt; src/mdtest_snippet.py:2:5
  |
1 | def _(config: dict[str, int] | None) -&gt; None:
2 |     config[&quot;retries&quot;] = 3  # error: [invalid-assignment]
  |     ^^^^^^
  |
info: Subscript assignment implicitly calls `__setitem__`, but `None` has no `__setitem__` method
info: `config` has type `dict[str, int] | None`
info: rule `invalid-assignment` is enabled by default
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/assignment_diagnosti_-_Subscript_assignment_-_Possibly_missing_`___(efd3f0c02e9b89e9).snap</code>:27 on 2025-11-12 16:12</div>
            <div class="timeline-body"><p>the highlighted range here still looks incorrect -- shouldn't it be</p>
<pre><code class="language-suggestion">2 |     config[&quot;retries&quot;] = 3  # error: [invalid-assignment]
  |     ^^^^^^^^^^^^^^^^^^^^^
</code></pre>
<p>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/assignment_diagnosti_-_Subscript_assignment_-_Unknown_key_for_all__(1c685d9d10678263).snap</code>:43 on 2025-11-12 16:15</div>
            <div class="timeline-body"><p>What about including the name of the unknown key in the summary line here and taking it out of the primary-annotation message?</p>
<pre><code>error[invalid-key]: Invalid key &quot;surname&quot; for TypedDict `Person`
  --&gt; src/mdtest_snippet.py:13:5
   |
11 |     # error: [invalid-key]
12 |     # error: [invalid-key]
13 |     being[&quot;surname&quot;] = &quot;unknown&quot;
   |     ----- ^^^^^^^^^ Did you mean &quot;name&quot;?
   |     |
   |     TypedDict `Person` in union type `Person | Animal`
   |
info: rule `invalid-key` is enabled by default
</code></pre>
<p>We could also consider linking back to the definition of the <code>Person</code> typeddict in a subdiagnostic, though I guess that would be <em>very</em> verbose if you had a union of typeddicts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/typed_dict.md_-_`TypedDict`_-_Diagnostics_(e5289abf5c570c29).snap</code>:92 on 2025-11-12 16:17</div>
            <div class="timeline-body"><p>should we have an <code>info: TypedDicts can only be subscripted with string literals</code> subdiagnostic here? This might be a bit opaque for users unfamiliar with the rules around typeddicts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/typed_dict.rs</code>:143 on 2025-11-12 16:26</div>
            <div class="timeline-body"><p>Calls to this function are becoming quite difficult to read because of how many arguments there are. Especially the third argument, where <code>None</code> is often passed, and the last argument which is a <code>bool</code>. We could consider refactoring this into a struct that holds all the options for better readability, e.g.</p>
<pre><code class="language-rs">let validator = TypedDictValidator {
    context: &amp;self.context,
    typed_dict,
    full_object_ty: None,
    key,
    value_ty,
    typed_dict_node,
    key_node,
    value_node,
    assignment_kind,
    emit_diagnostics: true
};

validator.validate();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3659 on 2025-11-12 16:37</div>
            <div class="timeline-body"><p>Your logic here looks correct to me.</p>
<p>The question I had when reading this was &quot;But surely it wouldn't be valid to assign a key of type <code>str</code> to an object of type <code>list[int] &amp; Unknown</code> -- surely we know that all subtypes of <code>list[int]</code> only accept <code>int</code> keys? But no, we don't know that; this class is fine:</p>
<pre><code class="language-py">from typing import overload, Iterable, SupportsIndex

class F(list[int]):
    @overload
    def __setitem__(self, key: str | SupportsIndex, value: int) -&gt; None: ...
    @overload
    def __setitem__(self, key: slice, value: Iterable[int]) -&gt; None: ...
    def __setitem__(self, key: str | SupportsIndex | slice, value: int | Iterable[int]) -&gt; None: ...

F()[&quot;foo&quot;] = 42  # no diagnostic here
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3703 on 2025-11-12 16:40</div>
            <div class="timeline-body"><p>nit: rustfmt gives up formatting regions if lines in string literals are too long</p>
<pre><code class="language-suggestion">                                &quot;Cannot access `{value_d}` with a key of type `{}`. \
                                Only string literals are allowed as keys on TypedDicts.&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-12 16:41</div>
            <div class="timeline-body"><p>Awesome work. None of my comments below are blocking, just thoughts that occurred to me as I read through the diff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-12 19:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/assignment_diagnosti_-_Subscript_assignment_-_Possibly_missing_`___(efd3f0c02e9b89e9).snap</code>:27 on 2025-11-12 19:01</div>
            <div class="timeline-body"><p>Yes, absolutely. I haven't forgotten the comment, and absolutely agree with it. I just wanted to postpone this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-12 19:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/assignment_diagnosti_-_Subscript_assignment_-_Unknown_key_for_all__(1c685d9d10678263).snap</code>:43 on 2025-11-12 19:03</div>
            <div class="timeline-body"><blockquote>
<p>What about including the name of the unknown key in the summary line here and taking it out of the primary-annotation message?</p>
</blockquote>
<p>I can try that, but it's always a bit tricky to get both the full diagnostic and the concise diagnostic to look good. I still wish we had an API to set a separate concise message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-11-12 19:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/infer/builder.rs</code>:3703 on 2025-11-12 19:16</div>
            <div class="timeline-body"><p>Will also move this to a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-11-12 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-11-12 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-12 19:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:54:20 UTC
    </footer>
</body>
</html>
