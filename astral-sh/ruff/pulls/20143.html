<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-use-pathlib`] Fix `PTH101`, `PTH104`, `PTH105`, `PTH121` fixes - astral-sh/ruff #20143</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-use-pathlib</code>] Fix <code>PTH101</code>, <code>PTH104</code>, <code>PTH105</code>, <code>PTH121</code> fixes</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20143">#20143</a>
        opened by <a href="https://github.com/chirizxc">@chirizxc</a>
        on 2025-08-28 21:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes https://github.com/astral-sh/ruff/issues/20134</p>
<h2>Test Plan</h2>
<p><code>cargo nextest run flake8_use_pathlib</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-28 21:50</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-use-pathlib`] Fix PTH101, PTH104, PTH105, PTH121 fixes" to "[`flake8-use-pathlib`] Fix `PTH101`, `PTH104`, `PTH105`, `PTH121` fixes" by @chirizxc on 2025-08-28 22:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-08-30 16:25</div>
            <div class="timeline-body"><p>I don't know how to add a co-author to a PR, maybe only maintainers can do that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-09-02 21:38</div>
            <div class="timeline-body"><p>i use this cases:</p>
<pre><code class="language-python">import os
from pathlib import Path

# os.chmod(mode=0o600, follow_symlinks=True, path=&quot;pth1_link&quot;)
os.chmod(mode=0o600, follow_symlinks=True, path=&quot;pth1_link&quot;)
Path(&quot;pth1_link&quot;).chmod(mode=0o600)

# os.chmod(&quot;pth1_link&quot;, mode=0o600, follow_symlinks=      False                    )
os.chmod(&quot;pth1_link&quot;, mode=0o600, follow_symlinks=      False                    )
Path(&quot;pth1_link&quot;).chmod(mode=0o600, follow_symlinks=False)

# os.chmod(path=&quot;pth1_link&quot;, mode=0o600, follow_symlinks=True)
os.chmod(path=&quot;pth1_link&quot;, mode=0o600, follow_symlinks=True)
Path(&quot;pth1_link&quot;).chmod(mode=0o600)

# os.chmod(&quot;pth1_link&quot;, follow_symlinks=True, mode=0o600)
os.chmod(&quot;pth1_link&quot;, follow_symlinks=True, mode=0o600)
Path(&quot;pth1_link&quot;).chmod(mode=0o600)

# os.chmod(&quot;pth1_link&quot;, follow_symlinks=False, mode=0o600, dir_fd=None)
os.chmod(&quot;pth1_link&quot;, follow_symlinks=False, mode=0o600, dir_fd=None)
Path(&quot;pth1_link&quot;).chmod(follow_symlinks=False, mode=0o600)

# os.chmod(&quot;pth1_link&quot;, 0o600)
os.chmod(&quot;pth1_link&quot;, 0o600)
Path(&quot;pth1_link&quot;).chmod(0o600)

# os.chmod(&quot;pth1_link&quot;, 0o600, dir_fd=None)
os.chmod(&quot;pth1_link&quot;, 0o600, dir_fd=None)
Path(&quot;pth1_link&quot;).chmod(0o600)

# os.chmod(&quot;pth1_link&quot;, 0o600, follow_symlinks=False)
os.chmod(&quot;pth1_link&quot;, 0o600, follow_symlinks=False)
Path(&quot;pth1_link&quot;).chmod(0o600, follow_symlinks=False)

# os.chmod(&quot;pth1_link&quot;, 0o600, dir_fd=None, follow_symlinks=False)
os.chmod(&quot;pth1_link&quot;, 0o600, dir_fd=None, follow_symlinks=False)
Path(&quot;pth1_link&quot;).chmod(0o600, follow_symlinks=False)

# Only diagnostic
os.chmod(&quot;pth1_link&quot;, 0o600, follow_symlinks=&quot;False&quot;)
os.chmod(&quot;pth1_file&quot;, 0o700, None, True, 1, *[1], **{&quot;x&quot;: 1}, foo=1)
os.chmod()
os.chmod(&quot;pth1_link&quot;, follow_symlinks=True)
os.chmod(&quot;pth1_link&quot;, dir_fd=None)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-03 18:11</div>
            <div class="timeline-body"><blockquote>
<p>I don't know how to add a co-author to a PR, maybe only maintainers can do that?</p>
</blockquote>
<p>You can add a co-author in git with a special line like this in a commit message:</p>
<pre><code>Co-authored-by: NAME &lt;NAME@EXAMPLE.COM&gt;
</code></pre>
<p>But I can also add that when merging, no worries!</p>
<p>I'll try to give this a review soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-09-03 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-09-03 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-09-03 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:203 on 2025-09-11 15:16</div>
            <div class="timeline-body"><p>I think this can use <code>is_none_or</code>:</p>
<pre><code class="language-suggestion">    args.find_argument_value(name, pos).is_none_or(|expr| expr.is_boolean_literal_expr())
</code></pre>
<p>and assuming that <code>is_boolean_literal_expr</code> exists. I think all of the <code>Expr</code> variants should have <code>as_</code> and <code>is_</code> methods, but I could be wrong.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/helpers.rs</code>:199 on 2025-09-11 15:21</div>
            <div class="timeline-body"><p>It looks like we're often calling this either before or after a separate call to <code>args.find_argument_value(name, pos)</code>. Would it make sense just to pass in the <code>Expr</code> from that? Alternatively, maybe this could return <code>Some(&amp;Expr)</code> or <code>Some(&amp;ExprBooleanLiteral)</code> instead of a bool, just to avoid calling <code>find_argument_value</code> multiple times.</p>
<p>I don't think it's too big of a deal, just an idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:99 on 2025-09-11 15:23</div>
            <div class="timeline-body"><p>tiny nit: I'd probably check this before the number of arguments since that check is also for the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:139 on 2025-09-11 15:29</div>
            <div class="timeline-body"><p>This will drop the <code>follow_symlink</code> kwarg if it's <code>True</code> right? I think we should probably just preserve it, even if it matches the default <code>True</code> value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:142 on 2025-09-11 15:54</div>
            <div class="timeline-body"><p>I'm always hesitant to add a call to <code>unreachable!</code>, but just for my understanding, this <em>should</em> be unreachable right? At most I'd say to add a <code>debug_assert</code>, but <code>has_unknown_keywords_or_starred_expr</code> above should verify all of the kwargs, if I'm following correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_makedirs.rs</code>:101 on 2025-09-11 15:56</div>
            <div class="timeline-body"><p>Thinking more about this, do we really need to check for a boolean literal? It seems like any boolean or even truthy value would be fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__preview_full_name.py.snap</code>:853 on 2025-09-11 15:59</div>
            <div class="timeline-body"><p>This is very closely related to my other comment about this kwarg fix, but I think we should just use the whole <code>follow_symlinks=...</code> slice from the source code if possible. I don't think we really have to reformat it like this, unless I'm missing something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-11 16:01</div>
            <div class="timeline-body"><p>Thanks! Just a few comments/suggestions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 16:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:139 on 2025-09-11 16:19</div>
            <div class="timeline-body"><p>yea, but in other fixes we do the same thing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 16:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:142 on 2025-09-11 16:21</div>
            <div class="timeline-body"><p>yes, <code>has_unknown_keywords_or_starred_expr</code> is already checking kwargs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 16:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__preview_full_name.py.snap</code>:853 on 2025-09-11 16:32</div>
            <div class="timeline-body"><p>I think we're already doing this in the other fix:</p>
<p>https://github.com/astral-sh/ruff/pull/20049/files#diff-78c4eb312beda28752a62632b77bee91f7c01d6ad4c57961069d4115e299ec83R155</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 16:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:139 on 2025-09-11 16:36</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/pull/20049/files#diff-78c4eb312beda28752a62632b77bee91f7c01d6ad4c57961069d4115e299ec83L73</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 16:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_makedirs.rs</code>:101 on 2025-09-11 16:39</div>
            <div class="timeline-body"><p>I think it is still necessary to be sure of the fix, although it is strange enough if a string (&quot;True&quot;) is passed there, even if you fix such a variant it will turn out to be: garbage on input =&gt; garbage on output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 16:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_makedirs.rs</code>:101 on 2025-09-11 16:40</div>
            <div class="timeline-body"><p>I think for such variants it is better not to offer autofix, because broke the source code and it will be the same broken after fixing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-11 18:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:139 on 2025-09-11 18:42</div>
            <div class="timeline-body"><p>The logic in the other rule looks a bit different to me. It's okay to drop the extra whitespace, I forgot that that probably happens even if we slice the existing keyword range. I just don't think we need to check for a boolean literal or drop the user's explicit <code>follow_symlinks=True</code>. The only time we need to check for a default argument like that is so that we know it's safe to drop the argument <em>if</em> the <code>pathlib</code> version doesn't support it, at least that's my understanding. In general we should preserve as much of the user's code as we can.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-11 18:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_makedirs.rs</code>:101 on 2025-09-11 18:50</div>
            <div class="timeline-body"><p>If the code was broken initially because the keyword value had the wrong type, I think it's fine to preserve that. We don't check for <code>name</code> having the right type, for example. That's beyond the scope of the rule and really even Ruff. This version won't even fix a case like:</p>
<pre><code class="language-py">import os

exist_ok = True
os.makedirs(&quot;foo&quot;, exist_ok=exist_ok)
</code></pre>
<p>It just seems like an unnecessary restriction on the fix when we can just as easily forward whatever argument they passed. The only exception would be if <code>pathlib</code> has different behavior, but they both seem to accept truthy values just fine:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; from pathlib import Path
&gt;&gt;&gt; Path(&quot;foo&quot;).mkdir(exist_ok=True)
&gt;&gt;&gt; Path(&quot;foo&quot;).mkdir(exist_ok=[1])
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.makedirs(&quot;foo&quot;, exist_ok=[1])
&gt;&gt;&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-11 19:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:139 on 2025-09-11 19:18</div>
            <div class="timeline-body"><p>I think I know what you mean, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-09-11 19:26</div>
            <div class="timeline-body"><p>I think this good now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:134 on 2025-09-17 20:05</div>
            <div class="timeline-body"><p>Could we use the trick like in the other PR where we slice out the whole <code>kw</code>?</p>
<pre><code class="language-suggestion">                Some(&quot;mode&quot; | &quot;follow_symlinks&quot;) =&gt; locator.slice(kw),
</code></pre>
<p>then we can avoid the <code>to_string</code> call for positional args too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_symlink.rs</code>:107 on 2025-09-17 20:08</div>
            <div class="timeline-body"><p>I think it should be okay to omit this check too, by the same reasoning as the thread at https://github.com/astral-sh/ruff/pull/20143#discussion_r2341568706. It looks like this is the last call of <code>is_optional_bool_literal</code>, so we may also be able to delete the helper function entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-17 20:13</div>
            <div class="timeline-body"><p>Thanks, this is looking good! Two more small things (and a conflict from the other PTH PR, it looks like) and then I think this is good to go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chirizxc">@chirizxc</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:134 on 2025-09-17 20:34</div>
            <div class="timeline-body"><pre><code>error[E0308]: `match` arms have incompatible types                                                                                                   
   --&gt; crates\ruff_linter\src\rules\flake8_use_pathlib\rules\os_chmod.rs:132:22
    |
130 |               ArgOrKeyword::Keyword(kw) =&gt; match kw.arg.as_deref() {
    |  __________________________________________-
131 | |                 Some(&quot;mode&quot; | &quot;follow_symlinks&quot;) =&gt; locator.slice(kw),
    | |                                                     ----------------- this is found to be of type `&amp;str`
132 | |                 _ =&gt; None,
    | |                      ^^^^ expected `&amp;str`, found `Option&lt;_&gt;`
133 | |             },
    | |_____________- `match` arms have incompatible types
    |
    = note: expected reference `&amp;str`
                    found enum `std::option::Option&lt;_&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a> reviewed on 2025-09-17 20:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-09-17 20:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/os_chmod.rs</code>:134 on 2025-09-17 20:50</div>
            <div class="timeline-body"><p>Oh oops, I forgot to wrap it in <code>Some</code>, sorry! I think we can still remove <code>to_string</code> as long as we remove it from the <code>ArgOrKeyword::Arg</code> arm too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-09-17 21:06</div>
            <div class="timeline-body"><p>I couldn't find another e-mail on github so I used <code>&lt;danparizher@users.noreply.github.com&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-09-18 14:14</div>
            <div class="timeline-body"><p>Thank you! I just pushed one commit adding back the PTH211 test case. It seemed fine to keep it and a bit unrelated to the other changes here, from what I could tell.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-09-18 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-18 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-18 14:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:15:23 UTC
    </footer>
</body>
</html>
