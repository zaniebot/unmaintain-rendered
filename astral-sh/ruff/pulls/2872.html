<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `rome_formatter` fork as `ruff_formatter` - astral-sh/ruff #2872</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>rome_formatter</code> fork as <code>ruff_formatter</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2872">#2872</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-02-13 23:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>The Ruff autoformatter is going to be based on an intermediate representation (IR) formatted via <a href="https://homepages.inf.ed.ac.uk/wadler/papers/prettier/prettier.pdf">Wadler's algorithm</a>. This is architecturally similar to <a href="https://github.com/rome/tools">Rome</a>, Prettier, <a href="https://github.com/skiplang/skip/blob/master/src/tools/printer/printer.sk">Skip</a>, and others.</p>
<p>This PR adds a fork of the <code>rome_formatter</code> crate from <a href="https://github.com/rome/tools">Rome</a>, renamed here to <code>ruff_formatter</code>, which provides generic definitions for a formatter IR as well as a generic IR printer. (We've also pulled in <code>rome_rowan</code>, <code>rome_text_size</code>, and <code>rome_text_edit</code>, though some of these will be removed in future PRs.)</p>
<p>Why fork? <code>rome_formatter</code> contains code that's specific to Rome's AST representation (e.g., it relies on a fork of rust-analyzer's <code>rowan</code>), and we'll likely want to support different abstractions and formatting capabilities (there are already a few changes coming in future PRs). Once we've dropped <code>ruff_rowan</code> and trimmed down <code>ruff_formatter</code> to the code we currently need, it's also not a huge surface area to maintain and update.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autoformatter</span> added by @charliermarsh on 2023-02-13 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-13 23:31</div>
            <div class="timeline-body"><p>\cc @MichaReiser</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_formatter/Cargo.toml</code>:5 on 2023-02-14 08:43</div>
            <div class="timeline-body"><p>You may want to change the authors to Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-02-14 08:48</div>
            <div class="timeline-body"><p>LGTM</p>
<p>Some things to consider:</p>
<ul>
<li>Should we re-license the crates</li>
<li>Can we document the use of prior work in an acknowledgment section (pylint, Rome, Prettier...)</li>
<li>It's probably worth unifying the logging infrastructure. Rome uses <code>tracing</code> whereas Ruff uses some other crates.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-02-14 23:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_formatter/Cargo.toml</code>:5 on 2023-02-14 23:20</div>
            <div class="timeline-body"><p>I wasn't certain what the &quot;right&quot; pattern was here. I noticed (e.g.) that <code>rome_rowan</code> has <code>authors = [&quot;Aleksey Kladov &lt;aleksey.kladov@gmail.com&gt;&quot;]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-14 23:24</div>
            <div class="timeline-body"><blockquote>
<p>Should we re-license the crates</p>
</blockquote>
<p>Ah yeah. How should this work? We already include a bunch of licenses in our <code>LICENSE</code> file -- could we add the existing licenses there, and then cover these forks under the project's MIT license?</p>
<blockquote>
<p>Can we document the use of prior work in an acknowledgment section (pylint, Rome, Prettier...)</p>
</blockquote>
<p>Good idea -- I'll do this in a separate PR.</p>
<blockquote>
<p>It's probably worth unifying the logging infrastructure. Rome uses tracing whereas Ruff uses some other crates.</p>
</blockquote>
<p>Also a good idea -- I'll also do this in a separate PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-02-15 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-15 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-02-15 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-02-15 07:55</div>
            <div class="timeline-body"><blockquote>
<p>Ah yeah. How should this work? We already include a bunch of licenses in our LICENSE file -- could we add the existing licenses there, and then cover these forks under the project's MIT license?</p>
</blockquote>
<p>I'm not really familiar with re-licensing but adding another copyright seems to work (if that's even something we want)</p>
<p>https://gist.github.com/fbaierl/1d740a7925a6e0e608824eb27a429370</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:13 UTC
    </footer>
</body>
</html>
