<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement `AstNode` for `Identifier` - astral-sh/ruff #13207</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement <code>AstNode</code> for <code>Identifier</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13207">#13207</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-09-02 09:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Follow-up to #13147, this PR implements the <code>AstNode</code> for <code>Identifier</code>. This makes it easier to create the <code>NodeKey</code> in red knot because it uses a generic method to construct the key from <code>AnyNodeRef</code> and is important for definitions that are created only on identifiers instead of <code>ExprName</code>.</p>
<h2>Test Plan</h2>
<p><code>cargo test</code> and <code>cargo clippy</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @dhruvmanila on 2024-09-02 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @dhruvmanila on 2024-09-02 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2024-09-02 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @dhruvmanila on 2024-09-02 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-09-02 09:31</div>
            <div class="timeline-body"><p>Looks reasonable to me! @MichaReiser is probably the better reviewer on this, though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-09-02 09:31</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/chatgpt/gpt_actions_library/gpt_action_salesforce.ipynb:14:1:1: Expected an expression
</code></pre>
</p>
</details>

<h3>Formatter (preview)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/chatgpt/gpt_actions_library/gpt_action_salesforce.ipynb:14:1:1: Expected an expression
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-09-02 10:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-09-02 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-09-02 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-02 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-09-03 17:46</div>
            <div class="timeline-body"><p>Nice! Does this also mean that we'd now be able to just store the identifier directly as an <code>AstNodeRef</code> in the <code>MatchPatternDefinitionKind</code>, instead of storing an index? If so, that would make it more similar to assignment statements, which might be nice when we implement unpacking.</p>
<p>Or it may turn out that indices are nicer to work with than the node references, in which case we'd rather change assignments to use indices instead :) So maybe this is just something to consider when working on actually implementing unpacking assignment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-03 18:03</div>
            <div class="timeline-body"><blockquote>
<p>Nice! Does this also mean that we'd now be able to just store the identifier directly as an <code>AstNodeRef</code> in the <code>MatchPatternDefinitionKind</code>, instead of storing an index? If so, that would make it more similar to assignment statements, which might be nice when we implement unpacking.</p>
</blockquote>
<p>Yeah, although I think index might still be better to identify the type. This provides us the position of the identifier in the pattern, then we'll kinda zip through the subject / pattern to perform structural matching until we reach the index position. Without the index, we will have to compare each identifier in the pattern to determine the one that we're looking to determine the type for. Does this make sense? I can provide an example as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-09-03 18:17</div>
            <div class="timeline-body"><blockquote>
<p>Without the index, we will have to compare each identifier in the pattern to determine the one that we're looking to determine the type for</p>
</blockquote>
<p>It does make sense; that's what I was thinking of when I said &quot;it may turn out indices are nicer to work with.&quot; My main thought is that when we do unpacking, we should probably settle on a preference for either indices or node refs for these unpacking targets, and make them all work as similarly as possible (whichever way we decide is best), because I don't see a strong rationale for them to be different.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-17 10:12</div>
            <div class="timeline-body"><p>The part that we forgot to do here is to start visiting <code>Identifier</code> in nodes that store an identifier, for example <code>Parameter</code>. Although I think it's good that we forgot to do so because that would be a breaking change for the formatter where we suddenly would start associating comments with identifiers.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:06:20 UTC
    </footer>
</body>
</html>
