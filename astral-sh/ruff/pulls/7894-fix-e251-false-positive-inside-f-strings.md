```yaml
number: 7894
title: "Fix `E251` false positive inside f-strings"
type: pull_request
state: merged
author: dhruvmanila
labels:
  - bug
assignees: []
merged: true
base: main
head: dhruv/fstring-E25
created_at: 2023-10-10T13:27:58Z
updated_at: 2023-10-12T05:32:47Z
url: https://github.com/astral-sh/ruff/pull/7894
synced_at: 2026-01-12T02:32:41Z
```

# Fix `E251` false positive inside f-strings

---

_Pull request opened by @dhruvmanila on 2023-10-10 13:27_

## Summary

This PR fixes the bug where the rule `E251` was being triggered on a equal token
inside a f-string which was used in the context of debug expressions.

For example, the following was being flagged before the fix:

```python
print(f"{foo = }")
```

But, now it is not. This leads to false negatives such as:

```python
print(f"{foo(a = 1)}")
```

One solution would be to know if the opened parentheses was inside a f-string or
not. If it was then we can continue flagging until it's closed. If not, then we
should not flag it.

## Test Plan

Add new test cases and check that they don't raise any false positives.

fixes: #7882


---

_Comment by @dhruvmanila on 2023-10-10 13:28_

Current dependencies on/for this PR:
* main
  * **PR #7894** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7894" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7894?utm_source=stack-comment).

---

_Label `bug` added by @dhruvmanila on 2023-10-10 13:28_

---

_Comment by @github-actions[bot] on 2023-10-10 13:43_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Review requested from @charliermarsh by @dhruvmanila on 2023-10-10 14:52_

---

_@charliermarsh reviewed on 2023-10-10 15:55_

---

_Review comment by @charliermarsh on `crates/ruff_linter/src/rules/pycodestyle/rules/logical_lines/whitespace_around_named_parameter_equals.rs`:112 on 2023-10-10 15:55_

Nit: saturating add for parity with how we handle parens? Though shouldn't matter in practice.

---

_@charliermarsh approved on 2023-10-10 15:55_

---

_Merged by @dhruvmanila on 2023-10-12 05:26_

---

_Closed by @dhruvmanila on 2023-10-12 05:26_

---

_Branch deleted on 2023-10-12 05:26_

---
