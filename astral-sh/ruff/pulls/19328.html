<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Enum literal types - astral-sh/ruff #19328</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Enum literal types</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19328">#19328</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-07-14 13:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Add a new <code>Type::EnumLiteral(‚Ä¶)</code> variant and infer this type for member accesses on enums.</p>
<p><strong>Example</strong>: No more <code>@Todo</code> types here:</p>
<pre><code class="language-py">from enum import Enum

class Answer(Enum):
    YES = 1
    NO = 2

    def is_yes(self) -&gt; bool:
        return self == Answer.YES

reveal_type(Answer.YES)  # revealed: Literal[Answer.YES]
reveal_type(Answer.YES == Answer.NO)  # revealed: Literal[False]
reveal_type(Answer.YES.is_yes())  # revealed: bool
</code></pre>
<h2>Test Plan</h2>
<ul>
<li>Many new Markdown tests for the new type variant</li>
<li>Added enum literal types to property tests, ran property tests</li>
</ul>
<h2>Ecosystem analysis</h2>
<details>

<summary>Lots of false positives removed. All of the new diagnostics are either new true positives (the majority) or known problems. Click for detailed analysis</summary>

<pre><code class="language-diff">AutoSplit (https://github.com/Toufool/AutoSplit)
+ error[call-non-callable] src/capture_method/__init__.py:137:9: Method `__getitem__` of type `bound method CaptureMethodDict.__getitem__(key: Never, /) -&gt; type[CaptureMethodBase]` is not callable on object of type `CaptureMethodDict`
+ error[call-non-callable] src/capture_method/__init__.py:147:9: Method `__getitem__` of type `bound method CaptureMethodDict.__getitem__(key: Never, /) -&gt; type[CaptureMethodBase]` is not callable on object of type `CaptureMethodDict`
+ error[call-non-callable] src/capture_method/__init__.py:148:1: Method `__getitem__` of type `bound method CaptureMethodDict.__getitem__(key: Never, /) -&gt; type[CaptureMethodBase]` is not callable on object of type `CaptureMethodDict`
</code></pre>
<p>New true positives. That <code>__getitem__</code> method is apparently annotated with <code>Never</code> to prevent developers from using it.</p>
<pre><code class="language-diff">dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ error[invalid-assignment] ddtrace/vendor/psutil/_common.py:29:5: Object of type `None` is not assignable to `Literal[AddressFamily.AF_INET6]`
+ error[invalid-assignment] ddtrace/vendor/psutil/_common.py:33:5: Object of type `None` is not assignable to `Literal[AddressFamily.AF_UNIX]`
</code></pre>
<p>Arguably true positives: https://github.com/DataDog/dd-trace-py/blob/e0a772c28bc3897a4b5df73125274999e0f58f30/ddtrace/vendor/psutil/_common.py#L29</p>
<pre><code class="language-diff">ignite (https://github.com/pytorch/ignite)
+ error[invalid-argument-type] tests/ignite/engine/test_custom_events.py:190:34: Argument to bound method `__call__` is incorrect: Expected `((...) -&gt; Unknown) | None`, found `Literal[&quot;123&quot;]`
+ error[invalid-argument-type] tests/ignite/engine/test_custom_events.py:220:37: Argument to function `default_event_filter` is incorrect: Expected `Engine`, found `None`
+ error[invalid-argument-type] tests/ignite/engine/test_custom_events.py:220:43: Argument to function `default_event_filter` is incorrect: Expected `int`, found `None`
+ error[call-non-callable] tests/ignite/engine/test_custom_events.py:561:9: Object of type `CustomEvents` is not callable
+ error[invalid-argument-type] tests/ignite/metrics/test_frequency.py:50:38: Argument to bound method `attach` is incorrect: Expected `Events`, found `CallableEventWithFilter`
</code></pre>
<p>All true positives. Some of them are inside <code>pytest.raises(TypeError, ‚Ä¶)</code> blocks :upside_down_face:</p>
<pre><code class="language-diff">meson (https://github.com/mesonbuild/meson)
+ error[invalid-argument-type] unittests/internaltests.py:243:51: Argument to bound method `__init__` is incorrect: Expected `bool`, found `Literal[MachineChoice.HOST]`
+ error[invalid-argument-type] unittests/internaltests.py:271:51: Argument to bound method `__init__` is incorrect: Expected `bool`, found `Literal[MachineChoice.HOST]`
</code></pre>
<p>New true positives. Enum literals can not be assigned to <code>bool</code>, even if their value types are <code>0</code> and <code>1</code>.</p>
<pre><code class="language-diff">poetry (https://github.com/python-poetry/poetry)
+ error[invalid-assignment] src/poetry/console/exceptions.py:101:5: Object of type `Literal[&quot;&quot;]` is not assignable to `InitVar[str]`
</code></pre>
<p>New false positive, missing support for <code>InitVar</code>.</p>
<pre><code class="language-diff">prefect (https://github.com/PrefectHQ/prefect)
+ error[invalid-argument-type] src/integrations/prefect-dask/tests/test_task_runners.py:193:17: Argument is incorrect: Expected `StateType`, found `Literal[StateType.COMPLETED]`
</code></pre>
<p>This is confusing. There are two definitions (<a href="https://github.com/PrefectHQ/prefect/blob/74d8cd93eef68600d0c193fa8c4513cf9ac7fdb8/src/prefect/client/schemas/objects.py#L89-L100">one</a>, <a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/schemas/states.py#L40">two</a>) of the <code>StateType</code> enum. Here, we're trying to assign one to the other. I don't think that should be allowed, so this is a true positive (?).</p>
<pre><code class="language-diff">python-htmlgen (https://github.com/srittau/python-htmlgen)
+ error[invalid-assignment] test_htmlgen/form.py:51:9: Object of type `str` is not assignable to attribute `autocomplete` of type `Autocomplete | None`
+ error[invalid-assignment] test_htmlgen/video.py:38:9: Object of type `str` is not assignable to attribute `preload` of type `Preload | None`
</code></pre>
<p>True positives. <a href="https://github.com/srittau/python-htmlgen/blob/01e3b911ac282d067850bb324b913e3594bc0e23/htmlgen/form.pyi#L8-L10">The stubs are wrong</a>. These should not contain type annotations, but rather just <code>OFF = ...</code>.</p>
<pre><code class="language-diff">rotki (https://github.com/rotki/rotki)
+ error[invalid-argument-type] rotkehlchen/tests/unit/test_serialization.py:62:30: Argument to bound method `deserialize` is incorrect: Expected `str`, found `Literal[15]`
</code></pre>
<p>New true positive.</p>
<pre><code class="language-diff">vision (https://github.com/pytorch/vision)
+ error[unresolved-attribute] test/test_extended_models.py:302:17: Type `type[WeightsEnum]` has no attribute `DEFAULT`
+ error[unresolved-attribute] test/test_extended_models.py:302:58: Type `type[WeightsEnum]` has no attribute `DEFAULT`
</code></pre>
<p>Also new true positives. No <code>DEFAULT</code> member exists on <code>WeightsEnum</code>.</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-07-14 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-14 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-14 13:16</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">python-htmlgen (https://github.com/srittau/python-htmlgen)
+ error[invalid-assignment] test_htmlgen/form.py:51:9: Object of type `str` is not assignable to attribute `autocomplete` of type `Autocomplete | None`
+ error[invalid-assignment] test_htmlgen/video.py:38:9: Object of type `str` is not assignable to attribute `preload` of type `Preload | None`
- Found 26 diagnostics
+ Found 28 diagnostics

hydra-zen (https://github.com/mit-ll-responsible-ai/hydra-zen)
- warning[unused-ignore-comment] src/hydra_zen/structured_configs/_implementations.py:492:89: Unused blanket `type: ignore` directive
- Found 572 diagnostics
+ Found 571 diagnostics

trio (https://github.com/python-trio/trio)
- error[unresolved-attribute] src/trio/_abc.py:223:17: Type `def socket(self, family: Unknown | int = @Todo(Attribute access on enum classes), type: Unknown | int = @Todo(Attribute access on enum classes), proto: int = Literal[0]) -&gt; SocketType` has no attribute `AddressFamily`
- error[unresolved-attribute] src/trio/_abc.py:224:15: Type `def socket(self, family: Unknown | int = @Todo(Attribute access on enum classes), type: Unknown | int = @Todo(Attribute access on enum classes), proto: int = Literal[0]) -&gt; SocketType` has no attribute `SocketKind`
+ error[unresolved-attribute] src/trio/_abc.py:223:17: Type `def socket(self, family: Unknown | int = Literal[AddressFamily.AF_INET], type: Unknown | int = Literal[SocketKind.SOCK_STREAM], proto: int = Literal[0]) -&gt; SocketType` has no attribute `AddressFamily`
+ error[unresolved-attribute] src/trio/_abc.py:224:15: Type `def socket(self, family: Unknown | int = Literal[AddressFamily.AF_INET], type: Unknown | int = Literal[SocketKind.SOCK_STREAM], proto: int = Literal[0]) -&gt; SocketType` has no attribute `SocketKind`

jinja (https://github.com/pallets/jinja)
- warning[unused-ignore-comment] src/jinja2/nodes.py:758:45: Unused blanket `type: ignore` directive
- Found 197 diagnostics
+ Found 196 diagnostics

ignite (https://github.com/pytorch/ignite)
- warning[unused-ignore-comment] ignite/contrib/engines/common.py:194:96: Unused blanket `type: ignore` directive
+ error[invalid-argument-type] tests/ignite/engine/test_custom_events.py:190:34: Argument to bound method `__call__` is incorrect: Expected `((...) -&gt; Unknown) | None`, found `Literal[&quot;123&quot;]`
+ error[invalid-argument-type] tests/ignite/engine/test_custom_events.py:220:37: Argument to function `default_event_filter` is incorrect: Expected `Engine`, found `None`
+ error[invalid-argument-type] tests/ignite/engine/test_custom_events.py:220:43: Argument to function `default_event_filter` is incorrect: Expected `int`, found `None`
+ error[call-non-callable] tests/ignite/engine/test_custom_events.py:561:9: Object of type `CustomEvents` is not callable
+ error[invalid-argument-type] tests/ignite/metrics/test_frequency.py:50:38: Argument to bound method `attach` is incorrect: Expected `Events`, found `CallableEventWithFilter`
- Found 2125 diagnostics
+ Found 2129 diagnostics

poetry (https://github.com/python-poetry/poetry)
+ error[invalid-assignment] src/poetry/console/exceptions.py:101:5: Object of type `Literal[&quot;&quot;]` is not assignable to `InitVar[str]`
- Found 936 diagnostics
+ Found 937 diagnostics

vision (https://github.com/pytorch/vision)
+ error[unresolved-attribute] test/test_extended_models.py:302:17: Type `type[WeightsEnum]` has no attribute `DEFAULT`
+ error[unresolved-attribute] test/test_extended_models.py:302:58: Type `type[WeightsEnum]` has no attribute `DEFAULT`
- Found 1472 diagnostics
+ Found 1474 diagnostics

yarl (https://github.com/aio-libs/yarl)
- error[invalid-return-type] yarl/_url.py:360:20: Return type does not match returned value: expected `URL`, found `str | SplitResult | URL | UndefinedType | @Todo(Attribute access on enum classes)`
+ error[invalid-return-type] yarl/_url.py:360:20: Return type does not match returned value: expected `URL`, found `str | SplitResult | URL | UndefinedType`

urllib3 (https://github.com/urllib3/urllib3)
- error[invalid-return-type] src/urllib3/_collections.py:386:20: Return type does not match returned value: expected `list[str] | _DT`, found `_Sentinel | _DT | @Todo(Attribute access on enum classes)`
+ error[invalid-return-type] src/urllib3/_collections.py:386:20: Return type does not match returned value: expected `list[str] | _DT`, found `(_Sentinel &amp; ~Literal[_Sentinel.not_passed]) | (_DT &amp; ~Literal[_Sentinel.not_passed])`

AutoSplit (https://github.com/Toufool/AutoSplit)
+ error[call-non-callable] src/capture_method/__init__.py:137:9: Method `__getitem__` of type `bound method CaptureMethodDict.__getitem__(key: Never, /) -&gt; type[CaptureMethodBase]` is not callable on object of type `CaptureMethodDict`
+ error[call-non-callable] src/capture_method/__init__.py:147:9: Method `__getitem__` of type `bound method CaptureMethodDict.__getitem__(key: Never, /) -&gt; type[CaptureMethodBase]` is not callable on object of type `CaptureMethodDict`
+ error[call-non-callable] src/capture_method/__init__.py:148:1: Method `__getitem__` of type `bound method CaptureMethodDict.__getitem__(key: Never, /) -&gt; type[CaptureMethodBase]` is not callable on object of type `CaptureMethodDict`
- Found 38 diagnostics
+ Found 41 diagnostics

pytest (https://github.com/pytest-dev/pytest)
- error[invalid-argument-type] src/_pytest/fixtures.py:157:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Scope`
- error[invalid-argument-type] src/_pytest/fixtures.py:218:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Scope`
+ error[invalid-argument-type] src/_pytest/fixtures.py:157:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Scope &amp; ~Literal[Scope.Function] &amp; ~Literal[Scope.Class] &amp; ~Literal[Scope.Module] &amp; ~Literal[Scope.Package] &amp; ~Literal[Scope.Session]`
+ error[invalid-argument-type] src/_pytest/fixtures.py:218:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Scope &amp; ~Literal[Scope.Function] &amp; ~Literal[Scope.Session] &amp; ~Literal[Scope.Package] &amp; ~Literal[Scope.Module] &amp; ~Literal[Scope.Class]`
- error[invalid-argument-type] src/_pytest/pathlib.py:585:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `ImportMode`
+ error[invalid-argument-type] src/_pytest/pathlib.py:585:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `ImportMode &amp; ~Literal[ImportMode.importlib] &amp; ~Literal[ImportMode.append] &amp; ~Literal[ImportMode.prepend]`
- error[invalid-argument-type] testing/test_cacheprovider.py:1303:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Action`
+ error[invalid-argument-type] testing/test_cacheprovider.py:1303:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Action &amp; ~Literal[Action.MKDIR] &amp; ~Literal[Action.SET]`
- error[invalid-argument-type] testing/test_cacheprovider.py:1315:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Action`
+ error[invalid-argument-type] testing/test_cacheprovider.py:1315:22: Argument to function `assert_never` is incorrect: Expected `Never`, found `Action &amp; ~Literal[Action.MKDIR] &amp; ~Literal[Action.SET]`

django-stubs (https://github.com/typeddjango/django-stubs)
- error[type-assertion-failure] tests/assert_type/db/models/_enums.py:15:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/_enums.py:17:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/_enums.py:23:1: Argument does not have asserted type `Literal[True]`
+ error[subclass-of-final-class] tests/assert_type/db/models/test_enums.py:90:19: Class `VoidChoices` cannot inherit from final class `BaseEmptyChoices`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:139:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:140:1: Argument does not have asserted type `list[@Todo(Support for `typing.TypeAlias`)]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:141:1: Argument does not have asserted type `list[int]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:142:1: Argument does not have asserted type `list[tuple[int, @Todo(Support for `typing.TypeAlias`)]]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:147:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:150:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:151:1: Argument does not have asserted type `list[@Todo(Support for `typing.TypeAlias`)]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:152:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:153:1: Argument does not have asserted type `list[tuple[str, @Todo(Support for `typing.TypeAlias`)]]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:158:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:162:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:163:1: Argument does not have asserted type `list[@Todo(Support for `typing.TypeAlias`)]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:170:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:176:1: Argument does not have asserted type `list[str]`
+ error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:171:1: Argument does not have asserted type `@Todo(Support for `typing.TypeAlias`)`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:184:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:189:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:191:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:197:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:202:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:210:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:216:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:224:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:230:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:238:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:243:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:245:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:251:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:255:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:257:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:263:1: Argument does not have asserted type `Literal[True]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:267:1: Argument does not have asserted type `list[str]`
- error[type-assertion-failure] tests/assert_type/db/models/test_enums.py:269:1: Argument does not have asserted type `list[str]`
- Found 464 diagnostics
+ Found 431 diagnostics

meson (https://github.com/mesonbuild/meson)
+ error[invalid-argument-type] unittests/internaltests.py:243:51: Argument to bound method `__init__` is incorrect: Expected `bool`, found `Literal[MachineChoice.HOST]`
+ error[invalid-argument-type] unittests/internaltests.py:271:51: Argument to bound method `__init__` is incorrect: Expected `bool`, found `Literal[MachineChoice.HOST]`
- Found 901 diagnostics
+ Found 903 diagnostics

zulip (https://github.com/zulip/zulip)
+ error[invalid-assignment] zerver/actions/message_send.py:1834:5: Invalid assignment to data descriptor attribute `type` on type `Message` with custom `__set__` method
- Found 7265 diagnostics
+ Found 7266 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ error[invalid-assignment] ddtrace/vendor/psutil/_common.py:29:5: Object of type `None` is not assignable to `Literal[AddressFamily.AF_INET6]`
+ error[invalid-assignment] ddtrace/vendor/psutil/_common.py:33:5: Object of type `None` is not assignable to `Literal[AddressFamily.AF_UNIX]`
- Found 6822 diagnostics
+ Found 6824 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
+ error[invalid-argument-type] src/integrations/prefect-dask/tests/test_task_runners.py:193:17: Argument is incorrect: Expected `StateType`, found `Literal[StateType.COMPLETED]`
- Found 3728 diagnostics
+ Found 3729 diagnostics

rotki (https://github.com/rotki/rotki)
+ error[invalid-assignment] rotkehlchen/assets/asset.py:77:5: Object of type `Literal[False]` is not assignable to `InitVar[bool]`
- warning[unused-ignore-comment] rotkehlchen/chain/aggregator.py:582:83: Unused blanket `type: ignore` directive
- warning[unused-ignore-comment] rotkehlchen/exchanges/kraken.py:953:57: Unused blanket `type: ignore` directive
- error[invalid-argument-type] rotkehlchen/tests/api/test_exchanges.py:524:52: Argument to function `patch_poloniex_balances_query` is incorrect: Expected `Poloniex`, found `Binance`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:673:12: Type `Binance` has no attribute `account_type`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:713:12: Type `Binance` has no attribute `account_type`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:788:12: Type `Binance` has no attribute `api_passphrase`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:801:12: Type `Binance` has no attribute `api_passphrase`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:823:12: Type `Binance` has no attribute `account_type`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:824:12: Type `Binance` has no attribute `call_limit`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:825:12: Type `Binance` has no attribute `reduction_every_secs`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:834:12: Type `Binance` has no attribute `account_type`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:835:12: Type `Binance` has no attribute `call_limit`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:836:12: Type `Binance` has no attribute `reduction_every_secs`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:846:12: Type `Binance` has no attribute `account_type`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:847:12: Type `Binance` has no attribute `call_limit`
- error[unresolved-attribute] rotkehlchen/tests/api/test_exchanges.py:848:12: Type `Binance` has no attribute `reduction_every_secs`
- warning[unused-ignore-comment] rotkehlchen/tests/api/test_exchanges.py:869:78: Unused blanket `type: ignore` directive
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:872:21: Attribute `name` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:874:31: Attribute `name` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:886:20: Attribute `api_key` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:888:24: Attribute `secret` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:893:54: Attribute `session` on type `Binance | None` is possibly unbound
- warning[unused-ignore-comment] rotkehlchen/tests/api/test_exchanges.py:897:78: Unused blanket `type: ignore` directive
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:900:21: Attribute `name` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:902:31: Attribute `name` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:914:20: Attribute `api_key` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:916:24: Attribute `secret` on type `Binance | None` is possibly unbound
- warning[possibly-unbound-attribute] rotkehlchen/tests/api/test_exchanges.py:921:54: Attribute `session` on type `Binance | None` is possibly unbound
- error[invalid-assignment] rotkehlchen/tests/exchanges/test_kraken.py:933:5: Object of type `Literal[False]` is not assignable to attribute `random_ledgers_data` on type `Binance | None`
+ error[invalid-assignment] rotkehlchen/tests/exchanges/test_kraken.py:933:5: Object of type `Literal[False]` is not assignable to attribute `random_ledgers_data` on type `Kraken | None`
- warning[possibly-unbound-attribute] rotkehlchen/tests/exchanges/test_kraken.py:935:9: Attribute `query_history_events` on type `Binance | None` is possibly unbound
+ warning[possibly-unbound-attribute] rotkehlchen/tests/exchanges/test_kraken.py:935:9: Attribute `query_history_events` on type `Kraken | None` is possibly unbound
+ error[invalid-argument-type] rotkehlchen/tests/unit/test_serialization.py:62:30: Argument to bound method `deserialize` is incorrect: Expected `str`, found `Literal[15]`
- error[invalid-argument-type] rotkehlchen/tests/utils/rotkehlchen.py:181:52: Argument to function `patch_poloniex_balances_query` is incorrect: Expected `Poloniex`, found `Binance &amp; ~AlwaysFalsy`
- Found 1606 diagnostics
+ Found 1579 diagnostics

</code></pre>
</details>
<details>
<summary>Memory usage changes were detected when running on open source projects</summary>

<pre><code class="language-diff">trio (https://github.com/python-trio/trio)
-     memo metadata = ~20MB
+     memo metadata = ~21MB

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-14 13:21</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>type-assertion-failure</code> | 1 | 35 | 0 |
| <code>unresolved-attribute</code> | 2 | 13 | 2 |
| <code>invalid-argument-type</code> | 8 | 2 | 5 |
| <code>possibly-unbound-attribute</code> | 0 | 10 | 1 |
| <code>invalid-assignment</code> | 7 | 0 | 1 |
| <code>unused-ignore-comment</code> | 0 | 7 | 0 |
| <code>call-non-callable</code> | 4 | 0 | 0 |
| <code>invalid-return-type</code> | 0 | 0 | 2 |
| <code>subclass-of-final-class</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>23</strong> | <strong>67</strong> | <strong>11</strong> |</p>
<p><strong><a href="https://david-enum-literals.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-14 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-14 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-14 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-14 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-14 18:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-14 18:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 07:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/call/overloads.md</code>:405 on 2025-07-15 07:34</div>
            <div class="timeline-body"><p>I have not implemented expansion of enums yet. I didn't see any ecosystem impact (no new <code>no-matching-overload</code> diagnostics or similar), so I guess this change is fine. Returning <code>Unknown</code> instead of <code>A</code> seems better anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-15 07:45</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-15 08:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-15 08:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-15 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-15 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-15 09:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-15 09:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-07-15 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2025-07-15 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-07-15 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @sharkdp on 2025-07-15 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @sharkdp on 2025-07-15 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/enums.md</code>:442 on 2025-07-15 10:04</div>
            <div class="timeline-body"><p>you can even do this if you so desire:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; Answer.YES.NO
&lt;Answer.NO: 2&gt;
&gt;&gt;&gt; Answer.YES.NO.YES.NO
&lt;Answer.NO: 2&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/enums.md</code>:454 on 2025-07-15 10:05</div>
            <div class="timeline-body"><p>do we internally simplify <code>type[Answer]</code> to a class-literal type, the same as we do for <code>type[C]</code> where <code>C</code> is explicitly decorated with <code>@final</code>? Is it worth adding a test for that?</p>
<p>Do we have any tests for enum classes that are explicitly decorated with <code>@final</code>? Even though it's unnecessary, it should probably be allowed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 10:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/enums.rs</code>:49 on 2025-07-15 10:05</div>
            <div class="timeline-body"><p>Does this need <code>heap_size=get_size2::GetSize::get_heap_size</code>? Do we have some instructions on how to apply these new size-tracking attributes/traits? Similar question for the new <code>EnumLiteralType</code> in <code>types.rs</code>.</p>
<p>cc @ibraheemdev</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/narrow/conditionals/eq.md</code>:42 on 2025-07-15 10:07</div>
            <div class="timeline-body"><p>Note that the proposed narrowing behaviour here would be unsafe if the enum class (or any of its superclasses) defined a custom <code>__eq__</code> and/or <code>__ne__</code> method</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/type_properties/truthiness.md</code>:1 on 2025-07-15 10:10</div>
            <div class="timeline-body"><p>Can you also add a test for an enum class that defines (or inherits from a class that defines) a custom <code>__bool__</code> method? We can only consider enum members always-truthy if <code>__bool__</code> is either undefined or it is defined and it returns <code>Literal[True]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/type_properties/is_single_valued.md</code>:1 on 2025-07-15 10:16</div>
            <div class="timeline-body"><p>Enum literals are very weird because they're always singletons (you can always narrow them using <code>is</code>) but I think we can only safely treat them as single-valued providing <code>__eq__</code> and <code>__ne__</code> are not defined:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; class Unfortunate(Enum):
...     X = 2
...     Y = 3
...     def __eq__(self, other):
...         return isinstance(other, Unfortunate)
...         
&gt;&gt;&gt; Unfortunate.X is Unfortunate.Y
False
&gt;&gt;&gt; Unfortunate.X == Unfortunate.Y
True
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3252 on 2025-07-15 10:20</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                                    Type::instance(db, ClassType::NonGeneric(enum_class)),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:5652 on 2025-07-15 10:23</div>
            <div class="timeline-body"><p>Ideally I guess we'd jump to the definition of the actual enum member here, right? But I know that this would be much harder. Worth a TODO?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8313 on 2025-07-15 10:25</div>
            <div class="timeline-body"><p>Do we need to store a <code>Type</code> here or could we store a <code>ClassLiteral</code> instead (which we could lazily turn into a <code>Type</code> using <code>Type::instance()</code> on demand)? (It feels like it would be more strongly typed, and might use a tiny bit less memory? It would also mean that <code>EnumLiteralType</code> would unambiguously be a non-atomic type that the type-visitor in <code>visitor.rs</code> would not have to recurse into.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/enums.rs</code>:20 on 2025-07-15 10:29</div>
            <div class="timeline-body"><p>nit: we could enforce immutability here and maybe save a tiny bit of memory</p>
<pre><code class="language-suggestion">    pub(crate) members: Box&lt;[Name]&gt;,
    pub(crate) aliases: FxHashMap&lt;Name, Name&gt;,
}

impl EnumMetadata {
    fn empty() -&gt; Self {
        EnumMetadata {
            members: Box::default(),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-15 10:32</div>
            <div class="timeline-body"><p>Very nice!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-15 10:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8313 on 2025-07-15 10:38</div>
            <div class="timeline-body"><p>Hmm, but even if we made this change, maybe the type-visitor should materialize the instance fallback anyway and recurse into it, similar to PEP-695 <code>TypeAliasType</code>s.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-07-15 11:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/src/types/enums.rs</code>:49 on 2025-07-15 11:27</div>
            <div class="timeline-body"><p>You should add <code>heap_size=get_size2::GetSize::get_heap_size</code> to any tracked function to ensure accurate memory reports, otherwise salsa assumes the type does not contain any heap allocations.</p>
<p>The empty <code>GetSize</code> implementation for <code>EnumLiteralType</code> is correct, we don't have a way to report the heap size of the fields yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 11:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8313 on 2025-07-15 11:34</div>
            <div class="timeline-body"><p>Excellent suggestions that also solves a few other problems here ‚Äî thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 12:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/enums.md</code>:454 on 2025-07-15 12:28</div>
            <div class="timeline-body"><p>I fixed this by properly modeling the implicit final property of enum classes with members. This also resolved a few other TODOs (intersections collapse to Never, emit a diagnostic if you attempt to subclass an enum).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 13:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/type_properties/is_single_valued.md</code>:1 on 2025-07-15 13:15</div>
            <div class="timeline-body"><blockquote>
<p>Enum literals are very weird because they're always singletons (you can always narrow them using <code>is</code>) but I think we can only safely treat them as single-valued providing <code>__eq__</code> and <code>__ne__</code> are not defined:</p>
</blockquote>
<p>Hm, I don't think your example shows this? <code>Unfortunate.Y</code> is not of type <code>Literal[Unfortunate.X]</code>.</p>
<p>The only way in which a singleton type could not be a single-valued type is if the single inhabitant does not compare equal to itself, I think?</p>
<pre><code class="language-py">from enum import Enum

class Weird(Enum):
    A = 1
    B = 2

    def __eq__(self, other):
        return False
</code></pre>
<p>Anyway, I'll make single-valuedness dependent on the custom <code>__eq__</code>/<code>__ne__</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 13:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/type_properties/truthiness.md</code>:1 on 2025-07-15 13:46</div>
            <div class="timeline-body"><p>Done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-15 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-15 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-07-15 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-07-15 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/enums.md</code>:535 on 2025-07-15 14:31</div>
            <div class="timeline-body"><p>these might be useful additions to this test:</p>
<pre><code class="language-suggestion">reveal_type(type(Answer.YES))  # revealed: &lt;class 'Answer'&gt;

class NoMembers(Enum): ...

def _(x: Answer, y: NoMembers):
    reveal_type(type(x))  # revealed: &lt;class 'Answer'&gt;
    reveal_type(type(y))  # revealed: type[NoMembers]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/narrow/conditionals/eq.md</code>:54 on 2025-07-15 14:34</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __ne__(self, other) -&gt; bool:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/narrow/conditionals/eq.md</code>:62 on 2025-07-15 14:35</div>
            <div class="timeline-body"><p>is it worth also adding a test for an enum that <em>inherits</em> from a class with a custom <code>__eq__</code> method, e.g.</p>
<pre><code class="language-py">from enum import Enum

class Mixin:
    def __eq__(self, other) -&gt; bool:
        return True

class AlsoAmbiguous(Mixin, Enum):
    NO = 0
    YES = 1

def _(answer: AlsoAmbiguous):
    if answer == AlsoAmbiguous.NO:
        reveal_type(answer)  # revealed: AlsoAmbiguous
    else:
        reveal_type(answer)  # revealed: AlsoAmbiguous
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-07-15 14:40</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/david%2Fenum-literals?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a></h2>
<h3>Merging #19328 will <strong>degrade performances by 5.69%</strong></h3>
<p><sub>Comparing <code>david/enum-literals</code> (d0060c2) with <code>main</code> (a0d4e1f)</sub></p>
<h3>Summary</h3>
<p><code>‚ö° 1</code> improvements<br />
<code>‚ùå 2 (üëÅ 2)</code> regressions<br />
<code>‚úÖ 37</code> untouched benchmarks<br />
<code>üÜï 1</code> new benchmarks</p>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| üëÅ | <code>ty_micro[complex_constrained_attributes_1]</code> | 58 ms | 61.5 ms | -5.69% |
| üëÅ | <code>ty_micro[complex_constrained_attributes_2]</code> | 57.7 ms | 60.8 ms | -5.12% |
| üÜï | <code>ty_micro[many_enum_members]</code> | N/A | 112.4 ms | N/A |
| ‚ö° | <code>ty_micro[many_string_assignments]</code> | 78 ms | 74.8 ms | +4.28% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3501 on 2025-07-15 14:42</div>
            <div class="timeline-body"><p>hmmm... it looks like overriding <code>__len__</code> on an enum class also affects the truthiness of the enum members:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; class Foo(Enum):
...     def __len__(self):
...         return 0
...     A = 42
...     
&gt;&gt;&gt; bool(Foo.A)
False
</code></pre>
<p>I'm also not sure we should be doing anything for enum instances specifically that we wouldn't do for other instances of <code>@final</code> classes. E.g. it seems like it would be sound to infer instances of <code>Bar</code> here as being always truthy, since we can clearly see that no classes in its MRO define <code>__bool__</code> or <code>__len__</code>:</p>
<pre><code class="language-py">from typing import final

@final
class Bar: ...
</code></pre>
<p>I'd be okay with inferring an ambiguous truthiness for enum members for now and deferring this question, since it seems like there's a few things to think through here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-07-15 14:45</div>
            <div class="timeline-body"><p>Great work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-15 14:50</div>
            <div class="timeline-body"><p>hmm, could the codspeed complaints be due to the changes to <code>try_bool</code>? IIRC that's a very hot funciton</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3501 on 2025-07-15 17:24</div>
            <div class="timeline-body"><p>Makes sense, thanks. Changed to infer <code>Ambiguous</code> in all cases for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-15 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3501 on 2025-07-15 17:24</div>
            <div class="timeline-body"><p>‚Ä¶ but I kept a bunch of test cases with TODOs. Also added one for custom <code>__len__</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-15 17:39</div>
            <div class="timeline-body"><blockquote>
<p>hmm, could the codspeed complaints be due to the changes to <code>try_bool</code>? IIRC that's a very hot funciton</p>
</blockquote>
<p>No, I'm afraid it might be due to the new <code>is_final</code> changes? Looking into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-15 19:29</div>
            <div class="timeline-body"><blockquote>
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ùå | <code>ty_micro[complex_constrained_attributes_1]</code> | 58 ms | 61.5 ms | -5.69% |
| ‚ùå | <code>ty_micro[complex_constrained_attributes_2]</code> | 57.7 ms | 60.8 ms | -5.12% |
| üÜï | <code>ty_micro[many_enum_members]</code> | N/A | 112.4 ms | N/A |
| ‚ö° | <code>ty_micro[many_string_assignments]</code> | 78 ms | 74.8 ms | +4.28% |</p>
</blockquote>
<p>I did find a way to reduce the regression from -8% to -5% in the <code>complex_constrained_attributes_*</code> benchmarks. In the process, <code>many_string_assignments</code> is now suddenly a <code>+4.28%</code> improvement ‚Äî I do not understand why. All of these benchmarks are extremely short (they are regression tests for cases where we initially took a long time). And we do need to perform some more work on this branch, because whenever we check if a type is final, we now also check if it's an enum ‚Äî which requires a MRO traversal.</p>
<p>I don't think that small regressions on these benchmarks are a huge deal, and all other benchmarks are below -2%, so I'm not going to investigate much further. Not because I'm out of ideas, but because it starts to feel like there are more important things to do. If someone disagrees, please let me know. Happy to take another look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-07-15 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-07-15 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-15 19:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:14:14 UTC
    </footer>
</body>
</html>
