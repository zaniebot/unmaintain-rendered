<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 - Recommend adding unused import bindings to `__all__` - astral-sh/ruff #11314</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 - Recommend adding unused import bindings to <code>__all__</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11314">#11314</a>
        opened by <a href="https://github.com/plredmond">@plredmond</a>
        on 2024-05-06 19:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-06 19:16</div>
            <div class="timeline-body"><p>Followup on #11168 and resolve #10391</p>
<h1>User facing changes</h1>
<ul>
<li>F401 now recommends a fix to add unused import bindings to to <code>__all__</code> if a single <code>__all__</code> list or tuple is found in <code>__init__.py</code>.<ul>
<li>If there are no <code>__all__</code> found in the file, fall back to recommending redundant-aliases.</li>
<li>If there are multiple <code>__all__</code> or only one but of the wrong type (non list or tuple) then diagnostics are generated without fixes.</li>
</ul>
</li>
<li><code>fix_title</code> is updated to reflect what the fix/recommendation is.</li>
</ul>
<p>Subtlety: For a renamed import such as <code>import foo as bees</code>, we can generate a fix to add <code>bees</code> to <code>__all__</code> but cannot generate a fix to produce a redundant import (because that would break uses of the binding <code>bees</code>).</p>
<h1>Implementation changes</h1>
<ul>
<li>Add <code>name</code> field to <code>ImportBinding</code> to contain the name of the <em>binding</em> we want to add to <code>__all__</code> (important for the <code>import foo as bees</code> case). It previously only contained the <code>AnyImport</code> which can give us information about the import but not the binding.<ul>
<li>Add <code>binding</code> field to <code>UnusedImport</code> to contain the same. (Naming note: the field <code>name</code> field already existed on <code>UnusedImport</code> and contains the qualified name of the imported symbol/module)</li>
</ul>
</li>
<li>Change <code>fix_by_reexporting</code> to branch on the size of <code>dunder_all: Vec&lt;&amp;Expr&gt;</code><ul>
<li>For length 0 call the edit-producing function <code>make_redundant_alias</code>.</li>
<li>For length 1 call edit-producing function <code>add_to_dunder_all</code>.</li>
<li>Otherwise, produce no fix.</li>
</ul>
</li>
<li>Implement the edit-producing function <code>add_to_dunder_all</code> and add unit tests.</li>
<li>Implement several fixture tests: empty <code>__all__ = []</code>, nonempty <code>__all__ = [&quot;foo&quot;]</code>, mis-typed <code>__all__ = None</code>, plus-eq <code>__all__ += [&quot;foo&quot;]</code></li>
<li><code>UnusedImportContext::Init</code> variant now has two fields: whether the fix is in <code>__init__.py</code> and how many <code>__all__</code> were found.</li>
</ul>
<h1>Other changes</h1>
<ul>
<li>Remove a spurious pattern match and instead use field lookups b/c the addition of a field would have required changing the unrelated pattern.</li>
<li>Tweak input type of <code>make_redundant_alias</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-06 19:19</div>
            <div class="timeline-body"><p>Oops, didn't add clippy to my pre-push hook. Added now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-05-06 19:29</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @plredmond on 2024-05-06 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:155 on 2024-05-07 06:00</div>
            <div class="timeline-body"><p>What does the <code>- TextSize::from(1)</code> stand for? What we do in other places is to explicitly call e.g. <code>']'.text_len()</code> to make it clear what kind of character we're subtracting. If there are multiple possible characters, consider adding a comment.</p>
<p>Is it guaranteed that <code>__all__</code> is always a list or set at this point?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:178 on 2024-05-07 06:03</div>
            <div class="timeline-body"><p>I think it's also valid to use a set here (CC: @AlexWaygood)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:434 on 2024-05-07 06:08</div>
            <div class="timeline-body"><p>Is the <code>collect</code> here necessary, considering that you pass the iterator to <code>make_redundant_alias</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-05-07 06:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:178 on 2024-05-07 06:24</div>
            <div class="timeline-body"><p>I don't know about a set, but it's definitely valid (and common) to use a tuple, so we should definitely account for that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-07 06:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:178 on 2024-05-07 06:36</div>
            <div class="timeline-body"><p>ah, it was a tuple! Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-05-07 06:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:162 on 2024-05-07 11:50</div>
            <div class="timeline-body"><p>I believe this is going to mean that the added strings will always use double quotes, but that might look odd if all the other strings in the <code>__all__</code> sequence use single quotes. Consider using the <code>ruff_python_codegen::Stylist::quote()</code> method to determine the standard quoting style used by the source code in question, e.g.</p>
<p>https://github.com/astral-sh/ruff/blob/6774f27f4b96725084b04711aa5aec2c6ac2a597/crates/ruff_linter/src/rules/flake8_type_checking/helpers.rs#L278-L284</p>
<p>You can get a <code>Stylist</code> instance by calling <code>checker.stylist()</code> in a Ruff rule that has access to a <code>Checker</code> instance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-07 11:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-05-07 12:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:162 on 2024-05-07 12:42</div>
            <div class="timeline-body"><p>Nice find!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:155 on 2024-05-07 15:48</div>
            <div class="timeline-body"><p>Willfix: Comment and use of <code>text_len</code></p>
<p>~~Yes, <code>dunder_all</code> is guaranteed to be an <code>ExprList</code> by the type of this function~~</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 15:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:434 on 2024-05-07 15:56</div>
            <div class="timeline-body"><p>I'd like to avoid the collect if possible. I wasn't able to figure out how to obtain a reference to the result of calling <code>b.import.member_name()</code> on each element of the <code>imports</code> without collecting an intermediate vector.</p>
<p>Passing <code>imports.iter().map(|b| b.import.member_name())</code> directly into <code>make_redundant_alias</code> gets:</p>
<pre><code>436 |         fix::edits::make_redundant_alias(imports.iter().map(|b| b.import.member_name()), statement)
    |         -------------------------------- ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `&amp;str`, found `Cow&lt;'_, str&gt;`
</code></pre>
<p>So the closure passed to map must convert the <code>Cow&lt;'_, str&gt;</code> to <code>&amp;str</code>, but using <code>.as_ref()</code> in that closure causes an ownership error:</p>
<pre><code>437 |             imports.iter().map(|b| b.import.member_name().as_ref()),
    |                                    ----------------------^^^^^^^^^
    |                                    |
    |                                    returns a value referencing data owned by the current function
    |                                    temporary value created here
</code></pre>
<p>Suggestions are appreciated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 15:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:162 on 2024-05-07 15:59</div>
            <div class="timeline-body"><p>Great! I was wondering how to do this properly. Willfix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 16:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:178 on 2024-05-07 16:31</div>
            <div class="timeline-body"><p>~~Oops, I found that there is already a data structure for this in <code>ruff_python_ast</code>. Will fix.~~ It doesn't contain the necessary information.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-05-07 16:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:434 on 2024-05-07 16:42</div>
            <div class="timeline-body"><p>Hmm. Considering that <code>make_redundant_alias</code> is only called from <code>unused_import</code>. How about you move the implementation and simply make it accept a <code>Cow</code>? It doesn't seem worth figuring this puzzle out if we can make our lives easier by just changing the function signature ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 21:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:155 on 2024-05-07 21:34</div>
            <div class="timeline-body"><p>The structure of <code>dunder_all</code> is now checked in the body of this function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 21:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:178 on 2024-05-07 21:34</div>
            <div class="timeline-body"><p>Ended up using <code>Expr</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 21:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:434 on 2024-05-07 21:34</div>
            <div class="timeline-body"><p>:shrug: ok!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-07 21:53</div>
            <div class="timeline-body"><p>I swear I have fixed my pre-push hook now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-07 21:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:158 on 2024-05-07 21:54</div>
            <div class="timeline-body"><p>What if it's an unparenthesized tuple ðŸ‘€ I think this would give incorrect results for something like e.g. https://github.com/python/cpython/blob/460546529b0959ce9528dec1c5cd836dcc04ad2c/Lib/asyncio/base_events.py#L54</p>
<p>There's a field on the <code>ast::ExprTuple</code> node that you can query to check whether or not the tuple is parenthesized in the original Python source code</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-07 21:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:158 on 2024-05-07 21:55</div>
            <div class="timeline-body"><p>Oh what, this is horrible, but ok; willfix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 00:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:158 on 2024-05-08 00:19</div>
            <div class="timeline-body"><p>I think I've resolved this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @plredmond on 2024-05-08 16:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_27__all_mistyped____init__.py.snap</code>:9 on 2024-05-08 17:24</div>
            <div class="timeline-body"><p>This message feels kinda confusing to me right now; would it be possible for the message to say something like this instead?</p>
<pre><code class="language-suggestion">  = help: Use an explicit re-export: `from . import unused as unused`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 17:24</div>
            <div class="timeline-body"><p>What happens if you have something like</p>
<pre><code class="language-py">import sys

from . import exported, renamed as bees

if sys.version_info &gt; (3, 9):
    from . import also_exported

__all__ = [&quot;exported&quot;]

if sys.version_info &gt;= (3, 9):
    __all__ += [&quot;also_exported&quot;]
</code></pre>
<p>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:174 on 2024-05-08 17:30</div>
            <div class="timeline-body"><p>nit: I'd probably do something like</p>
<pre><code class="language-suggestion">        ast::Expr::Tuple(ast::ExprTuple {
            elts,
            range,
            parenthesized,
        }) =&gt; (
            if parenthesized {
                elts.last()
                    .map_or(range.end() - &quot;)&quot;.text_len(), |elt| elt.range().end())
            } else {
                elts.last()
                    .expect(&quot;unparenthesized empty tuple is not possible&quot;)
                    .range()
                    .end()
            },
            elts.len(),
        ),
</code></pre>
<p>(just personal preference)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-08 17:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 18:11</div>
            <div class="timeline-body"><p>The expected behavior would be for the fix will add <code>&quot;bees&quot;</code> to <code>__all__ = [&quot;exported&quot;]</code> but i'll add a fixture test for this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 18:12</div>
            <div class="timeline-body"><p>If it's adding to the last one, that's a mistake; but now that I think about it, that's what the existing fixture test does .. Hmm</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 18:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:174 on 2024-05-08 18:13</div>
            <div class="timeline-body"><p>I'm going to use two separate cases instead of nested conditionals here :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 18:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-08 18:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 18:31</div>
            <div class="timeline-body"><p>See I'm wondering if we should just not attempt to do an autofix at all if there's more than one <code>__all__</code> definition at the top level, since this kind of thing can get arbitrarily complicated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-08 18:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 18:33</div>
            <div class="timeline-body"><p>E.g. checkout https://github.com/python/typeshed/blob/2d33fe212221a05661c0db5215a91cf3d7b7f072/stdlib/typing.pyi#L106</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 18:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 18:54</div>
            <div class="timeline-body"><p>Changed to add to the first <code>__all__</code> binding.. this is of course still vulnerable to e.g.</p>
<pre><code class="language-python">if foo.version &lt; 3:
    __all__ = [&quot;foo&quot;]
else:
    __all__ = []
</code></pre>
<p>Here I believe we'd only add to the first <code>__all__</code> and not the 2nd. I think we could play whack-a-mole with these cases for awhile. What should we do?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-08 18:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-08 18:58</div>
            <div class="timeline-body"><p>This is better but I'd still find this message confusing if it popped up in my editor, especially if I wasn't familiar with the (slightly odd) convention that static-analysis tools use to distinguish explicit re-exports from implicit re-exports in modules without <code>__all__</code>. If I saw this message, I think my natural interpretation would be to assume it was telling me to do this:</p>
<pre><code class="language-diff">- from . import unused
+ from . import .unused
</code></pre>
<p>But that's not what we're telling the user to do at all (it's invalid syntax), and it's not what the autofix does. Could the help message be this instead?</p>
<pre><code class="language-suggestion">   = help: Use an explicit re-export: `from . import unused as unused`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-08 19:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 19:01</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/pull/11314#discussion_r1594472417 â€” I think we should just not attempt to provide an autofix if there's more than one <code>__all__</code> definition at the top level</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-08 20:04</div>
            <div class="timeline-body"><p>It might take a bit of effort to run the fix manually and generate a more explicit fix title message there. Also, it seems redundant because directly below your comment on the fixture test output is a diff/fix that is doing the thing described. Alternatively, could I suggest that the message could be changed to <strong>not</strong> say the <code>qualified_name</code> and instead say the name of the binding? I.e. In this case for <code>from . import unused</code> the fix title text would become:</p>
<pre><code>help: Use an explicit re-export: `unused`
</code></pre>
<p>As in the case for <code>from . import renamed as bees</code> where the text is already:</p>
<pre><code>help: Use an explicit re-export: `bees`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 20:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 20:05</div>
            <div class="timeline-body"><p>Weird, github didn't show me your comments. I have to shift+f5 github or it doesn't work properly these days. Yeah, I can change it to offer no fix if there's more than one top level <code>__all__</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 20:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 20:13</div>
            <div class="timeline-body"><p>Would it be ok to fall-back to recommending a fix that does an explicit re-export?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-08 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-08 20:28</div>
            <div class="timeline-body"><p>Changed to not offer any fix related to <code>__all__</code> when there's more than one top level <code>__all__</code> binding. Instead, fall back to the redundant-alias path (recommend a fix when the unused import is not renamed).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 11:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 11:18</div>
            <div class="timeline-body"><blockquote>
<p>Would it be ok to fall-back to recommending a fix that does an explicit re-export?</p>
</blockquote>
<p>Yes, I think that's a much safer fix because we don't have to track the &quot;parallel branches&quot; in the same way as we do with the <code>__all__</code> fix. Good call!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 11:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 11:53</div>
            <div class="timeline-body"><blockquote>
<p>it seems redundant because directly below your comment on the fixture test output is a diff/fix that is doing the thing described.</p>
</blockquote>
<p>My worry is that VSCode users, for example, will have this &quot;help&quot; message displayed to them in a message when they hover their mouse over the error in their editor and then click the &quot;Quick fix&quot; button. For example, look at the message next to the lightbulb here:</p>
<p><img src="https://github.com/astral-sh/ruff/assets/66076021/03cd4882-7ac2-4df6-ae73-209b8242b3a9" alt="image" /></p>
<p>The &quot;quick fix&quot; summary message users will see in their editor doesn't show the diff that the autofix would make. It's important that the message provides a succinct and accurate summary of the change the autofix is going to make to the user's code if they double click on that message to apply the &quot;quick fix&quot; in their editor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 13:16</div>
            <div class="timeline-body"><p>It seems weird to offer a redundant alias export when there is an <code>__all__</code> in the file? I would not be happy with that fix as a user, I'd need to change it manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-09 13:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 13:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 13:20</div>
            <div class="timeline-body"><blockquote>
<p>It seems weird to offer a redundant alias export when there is an <code>__all__</code> in the file? I would not be happy with that fix as a user, I'd need to change it manually.</p>
</blockquote>
<p>Yeah that's a good point. Maybe better to just not offer a fix at all if there are multiple <code>__all__</code> definitions, then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:17 on 2024-05-09 14:32</div>
            <div class="timeline-body"><p>I'm not sure there's much value in a fixture like this, as it doesn't seem particularly realistic to me. In real code, you'd only have multiple <code>__all__</code> definitions at the top level if there was some kind of version or platform difference that made an attribute sometimes available, sometimes not (and as soon as you have that kind of branching, attempting an autofix becomes much more complex, as we've discussed!). So I think the example you added in <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_30__all_conditional/__init__.py</code> is much better; I'd remove this example, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 15:44</div>
            <div class="timeline-body"><pre><code>0 __all__ definitions -&gt; convert unused imports to redundant aliases w/fix
1 __all__ definitions -&gt; add unused imports to __all__ w/fix
otherwise -&gt; diagnostic w/o fix
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 15:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:17 on 2024-05-09 15:48</div>
            <div class="timeline-body"><p>Ok, I'll remove it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 16:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 16:18</div>
            <div class="timeline-body"><p>I've made this update. Now I'm wondering if there's a desired change to <a href="https://github.com/astral-sh/ruff/pull/11314/files#diff-a444752923fd8532aa73acfb55601c2ae52153ea4bf396f20d2b8ee088e7faa4">this fixture test</a> in the case where <code>__all__</code> is neither tuple nor list. The current implementation offers a fix to use a redundant alias in that case. Should I change it to conservatively offer no fix and recommend removal, as with the multiple-<code>__all__</code> case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 16:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 16:20</div>
            <div class="timeline-body"><p>Is <code>use an explicit re-export: 'bees'</code> inaccurate or not succinct enough? What is different about this fix on this rule that it requires a diff in its fix title?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-09 16:25</div>
            <div class="timeline-body"><p>Almost there, maybe? @zanieb @AlexWaygood  Two unresolved threads left.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 16:30</div>
            <div class="timeline-body"><p>I don't think the message is clear enough about the change that it's going to make if you double-click on that message in your editor. If you're a Ruff user and you're not familiar with this (slightly weird) convention using redundant aliases that static-analysis tools use to differentiate explicit re-exports from implicit re-exports in modules without <code>__all__</code>, you won't know what's meant by the term &quot;explicit re-export&quot;. (&quot;Redundant alias&quot; is a more descriptive term for the concept, but even more confusing -- why is Ruff suggesting to me to add an alias if it admits that doing so would be redundant?)</p>
<p>So I would prefer that the help message explicitly states what it's going to change your code into if you double-click on it, similar to the SIM108 help message in the screenshot above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 16:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 16:33</div>
            <div class="timeline-body"><p>Ok, there's a bit of code required to produce an actual diff. I wrote some of that over <a href="https://github.com/astral-sh/ruff/pull/11314/files#diff-c93288320b9364fb125a43ff42ff5dc9780a16989eb5f0d1ecf903cd6d9a281cR681-R690">in this test</a>. Would be ok to package something like that up into a helper function in the unused_imports.rs file, and use it to generate the fix-title?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 16:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 16:38</div>
            <div class="timeline-body"><p>If creating the diff is hard, I'd be okay with using pseudo-code that doesn't reference the actual symbols in the user's code, e.g.</p>
<pre><code class="language-suggestion">   = help: Use an explicit re-export (`from module import thing as thing`)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 16:39</div>
            <div class="timeline-body"><p>Whatever the case, <code>.unused</code> is especially confusing, since <code>from . import .unused</code> is invalid syntax, and I feel like that's the natural reading of what the help message is proposing to do to the code :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 16:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 16:48</div>
            <div class="timeline-body"><blockquote>
<p>I've made this update. Now I'm wondering if there's a desired change to <a href="https://github.com/astral-sh/ruff/pull/11314/files#diff-a444752923fd8532aa73acfb55601c2ae52153ea4bf396f20d2b8ee088e7faa4">this fixture test</a> in the case where <code>__all__</code> is neither tuple nor list. The current implementation offers a fix to use a redundant alias in that case. Should I change it to conservatively offer no fix and recommend removal, as with the multiple-<code>__all__</code> case?</p>
</blockquote>
<p>Yeah, offering no fix there makes sense to me there as well...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 16:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 17:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 17:01</div>
            <div class="timeline-body"><p>The use of the qualified name in all the fix messages predates my work on F401. If I change that, we'll have ~25 additional snapshot tests changed in this PR. Before I make that change (to use the binding name, instead of the module qualified name, in fix titles), is that acceptable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 17:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_29__all_pluseq/__init__.py</code>:15 on 2024-05-09 17:07</div>
            <div class="timeline-body"><p>Great. Made this change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-09 17:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-09 17:08</div>
            <div class="timeline-body"><p>I'll try making a pseudocode fix-title and let's see how that looks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-09 17:37</div>
            <div class="timeline-body"><p>I believe that i've resolved the outstanding requests. @AlexWaygood it might make sense to do a pass over the fixture tests now since there has been some churn, to see if you agree with how each case is resolved?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__F401_F401_5.py.snap</code>:30 on 2024-05-10 09:23</div>
            <div class="timeline-body"><p>The change in this PR is a good improvement, so this comment shouldn't block this PR being merged, <em>but</em>... I think what would be even better would be if it said:</p>
<pre><code class="language-suggestion">  = help: Remove unused import: `f as g`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:25 on 2024-05-10 09:24</div>
            <div class="timeline-body"><p>This is so much clearer imo -- thank you for fixing this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_25__all_nonempty____init__.py.snap</code>:25 on 2024-05-10 09:27</div>
            <div class="timeline-body"><p>Hmm, not sure about this one. The help message sounds like it's literally going to add the string <code>&quot;.unused&quot;</code> to <code>__all__</code> -- but it's actually going to add the string <code>&quot;unused&quot;</code> to <code>__all__</code>. I think one of the following two options would be much better:</p>
<pre><code class="language-suggestion">__init__.py:36:15: F401 [*] `.unused` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
   |
36 | from . import unused # F401: add to __all__
   |               ^^^^^^ F401
   |
   = help: Add `unused` to `__all__`
</code></pre>
<p>or</p>
<pre><code class="language-suggestion">__init__.py:36:15: F401 [*] `.unused` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
   |
36 | from . import unused # F401: add to __all__
   |               ^^^^^^ F401
   |
   = help: Add `&quot;unused&quot;` to `__all__`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:193 on 2024-05-10 09:32</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    if let ast::Expr::Tuple(tup) = expr {
        if tup.parenthesized &amp;&amp; export_prefix_length + edits.len() == 1 {
            edits.push(Edit::insertion(&quot;,&quot;.to_string(), insertion_point));
        }
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:176 on 2024-05-10 09:44</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            if !binding.kind.is_export() {
                return None;
            }
            match binding.statement(semantic)? {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:620 on 2024-05-10 09:50</div>
            <div class="timeline-body"><p>nit: using <code>::from</code> in cases like this is usually more readable than using <code>std::convert::Into::into</code></p>
<pre><code class="language-suggestion">            make_redundant_alias([&quot;x&quot;].into_iter().map(Cow::from), stmt),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:446 on 2024-05-10 09:52</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        _ =&gt; bail!(&quot;Cannot offer a fix when there are multiple __all__ definitions&quot;),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-10 09:54</div>
            <div class="timeline-body"><p>Much improved, thanks for your patience! A few more comments below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-13 17:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:176 on 2024-05-13 17:59</div>
            <div class="timeline-body"><p>I think it's clearer to downcast from binding to statement in one statement here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-13 18:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:193 on 2024-05-13 18:00</div>
            <div class="timeline-body"><p>The suggested change splits up a single condition into two separate conditions, which I think is less clear. However, it removes an empty match branch which ppl might not like, so I've committed it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-13 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:620 on 2024-05-13 18:01</div>
            <div class="timeline-body"><p>Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-13 18:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_25__all_nonempty____init__.py.snap</code>:25 on 2024-05-13 18:10</div>
            <div class="timeline-body"><p>I've gone with the following:</p>
<pre><code>   21       â”‚-   = help: Add unused import to __all__: `.unused`
         21 â”‚+   = help: Add unused import `unused` to __all__
</code></pre>
<pre><code>   35       â”‚-   = help: Add unused import to __all__: `bees`
         35 â”‚+   = help: Add unused import `bees` to __all__
</code></pre>
<p>imo, it is important to say /why/ it should be added to <code>__all__</code>. I opted for the binding instead of the quoted-binding because I think it reads easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 18:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_25__all_nonempty____init__.py.snap</code>:25 on 2024-05-13 18:12</div>
            <div class="timeline-body"><p>SGTM</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-13 18:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__F401_F401_5.py.snap</code>:30 on 2024-05-13 18:38</div>
            <div class="timeline-body"><p>I think I can make the code do this by by replacing the <code>UnusedImport.name:String</code> field with <code>UnusedImport.import:&amp;AnyImport&lt;'_&gt;</code>. This frees up the fix-title generating code to choose from more options than just: fully-qualified module path or alias/binding. I'll spend a few minutes to see how hard this will be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-13 18:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__F401_F401_5.py.snap</code>:30 on 2024-05-13 18:48</div>
            <div class="timeline-body"><p>My suggestion above won't work due to the lifetimes involved. It could be implemented by including the appropriate string (for <code>f</code>) as an additional field on <code>UnusedImport</code>. Let's consider it for a future PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @plredmond on 2024-05-13 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-13 18:58</div>
            <div class="timeline-body"><p>This is ready for review again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-05-14 14:33</div>
            <div class="timeline-body"><p>Awesome, this is a huge improvement to this rule ðŸŽ‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-14 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:164 on 2024-05-14 14:44</div>
            <div class="timeline-body"><p>I believe <code>tup.range.end()</code> can just be <code>tup.end()</code>, and <code>elt.range().end()</code> can just be <code>elt.end()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-14 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:161 on 2024-05-14 14:44</div>
            <div class="timeline-body"><p>By the way, I think the <code>ast</code> prefixes here are unnecessary:</p>
<p><img src="https://github.com/astral-sh/ruff/assets/1309177/37c926c3-9e2d-4257-9558-5e9f917db3fa" alt="Screenshot 2024-05-14 at 10 44 17â€¯AM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_26__all_empty/__init__.py</code>:12 on 2024-05-14 14:46</div>
            <div class="timeline-body"><p>Can you remove the trailing newlines here for consistency with the other fixtures? Otherwise, editors that automatically strip trailing newlines will lead to unnecessary edits here in the future. (You can run <code>ruff format</code> over these if it's easier.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-14 14:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 14:47</div>
            <div class="timeline-body"><p>(A few small comments but for clarity no need to wait on my approval to merge.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-14 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:164 on 2024-05-14 17:24</div>
            <div class="timeline-body"><p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-14 17:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:161 on 2024-05-14 17:26</div>
            <div class="timeline-body"><p>Oops, fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-14 17:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/resources/test/fixtures/pyflakes/F401_26__all_empty/__init__.py</code>:12 on 2024-05-14 17:34</div>
            <div class="timeline-body"><p>Yes, sorry, I forgot to <code>ruff format</code> them</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-14 17:35</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/ruff.__all__">CodSpeed Performance Report</a></h2>
<h3>Merging #11314 will <strong>degrade performances by 6.83%</strong></h3>
<p><sub>Comparing <code>ruff.<strong>all</strong></code> (dde9756) with <code>main</code> (96f6288)</sub></p>
<h3>Summary</h3>
<p><code>âŒ 1</code> regressions
<code>âœ… 29</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/ruff.__all__">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>main</code> | <code>ruff.__all__</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| âŒ | <code>linter/default-rules[pydantic/types.py]</code> | 7.5 ms | 8 ms | -6.83% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 17:37</div>
            <div class="timeline-body"><p>I suspect the CodSpeed regression is a false positive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 17:38</div>
            <div class="timeline-body"><p>Maybe it'll re-run after this last pull and resolve (if codespeed updates its comments).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-14 17:39</div>
            <div class="timeline-body"><p>Rebasing or merging in <code>main</code> often gets CodSpeed to change its mind as well</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 17:40</div>
            <div class="timeline-body"><p>Ah, that's a good point. If we're comparing to <code>main</code> the performance could very well be different on an outdated branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 17:43</div>
            <div class="timeline-body"><p>Rebasing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 17:56</div>
            <div class="timeline-body"><p>I've updated the PR description to reflect the diff after all review comments.</p>
<p>Not sure what to do next. CodeSpeed might be a false-positive, but that should have been mitigated by rebasing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-14 18:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:669 on 2024-05-14 18:00</div>
            <div class="timeline-body"><p>What does <code>SUT</code> mean?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 18:01</div>
            <div class="timeline-body"><p>I think it's ok to merge personally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-14 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:669 on 2024-05-14 18:01</div>
            <div class="timeline-body"><p>system under test -- the test is long so i'm marking the bit that's unit tested</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 18:01</div>
            <div class="timeline-body"><p>I'm looking through the changes again just to see if anything sticks out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-14 18:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/fix/edits.rs</code>:669 on 2024-05-14 18:02</div>
            <div class="timeline-body"><p>This acronym was also unfamiliar to me FWIW</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 18:02</div>
            <div class="timeline-body"><p>The only thing that stands out is that we're allocating an additional string for <code>UnusedImport</code> and we increased the size of the struct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 18:06</div>
            <div class="timeline-body"><p>We could consider using <code>binding</code> everywhere for the diagnostic instead of the qualified name, see if that helps? But I think it's fine to merge as-is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:182 on 2024-05-14 18:08</div>
            <div class="timeline-body"><p>Possible optimisation here: if there's more than one <code>__all__</code> definition, we won't do an autofix anyway, so we only need to collect a maximum of two <code>__all__</code> definitions into the <code>Vec</code> being returned</p>
<pre><code class="language-suggestion">        })
        .take(2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-14 18:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-14 18:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:182 on 2024-05-14 18:13</div>
            <div class="timeline-body"><p>I'd probably vote to leave it as-is -- it makes sense (we can avoid some binding lookups), but seems unlikely to matter and creates some implicit coupling between this method and the fix rules that we may forget about in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-14 18:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:182 on 2024-05-14 18:23</div>
            <div class="timeline-body"><p>Whoops. I clicked the button. I'll revert if it's not conclusive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-14 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:182 on 2024-05-14 18:24</div>
            <div class="timeline-body"><p>I defer to you as the author, either is fine :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-14 18:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:182 on 2024-05-14 18:26</div>
            <div class="timeline-body"><p>Interesting. No effect. :)) I'll revert.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-14 18:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:182 on 2024-05-14 18:27</div>
            <div class="timeline-body"><p>Yeah, no difference at all :( Ah, well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 18:35</div>
            <div class="timeline-body"><p>Trying out Charlie's suggestion of using only one string in the violation struct. This caused /a lot/ of fixture changes to have cosmetic changes to help text and rule titles. If it doesn't correct the regression I'll revert.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 20:52</div>
            <div class="timeline-body"><p>Ok, that didn't work so I'm going to revert and then merge once tests pass.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-14 21:47</div>
            <div class="timeline-body"><p>Ok! I've tried (and reverted) both of the suggested performance improvements. Do we want to just merge this? I have no more commits to push.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 22:56</div>
            <div class="timeline-body"><p>Yeah, I'm fine with going ahead and merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @plredmond on 2024-05-15 00:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @plredmond on 2024-05-15 00:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-15 00:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:05:57 UTC
    </footer>
</body>
</html>
