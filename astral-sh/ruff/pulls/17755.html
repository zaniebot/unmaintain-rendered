<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] add fix safety section (`RUF007`) - astral-sh/ruff #17755</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] add fix safety section (<code>RUF007</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17755">#17755</a>
        opened by <a href="https://github.com/VascoSch92">@VascoSch92</a>
        on 2025-05-01 06:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/VascoSch92">@VascoSch92</a></div>
            <div class="timeline-body"><p>The PR add the <code>fix safety</code> section for rule <code>RUF007</code> (#15584 )</p>
<p>It seems that the fix was always marked as unsafe #14401</p>
Unsafety example
<p>This first example is a little extreme. In fact, the class <code>Foo</code> overrides the  <code>__getitem__</code> method but in a very special, way. The difference lies in the fact that <code>zip(letters, letters[1:])</code> call the slice <code>letters[1:]</code> which is behaving weird in this case, while <code>itertools.pairwise(letters)</code> call just <code>__getitem__(0), __getitem__(1), ...</code> and so on.</p>
<p>Note that the diagnostic is emitted: <a href="https://play.ruff.rs">playground</a></p>
<p>I don&#x27;t know if we want to mention this problem, as there is a subtile bug in the python implementation of <code>Foo</code> which make the rule unsafe.</p>
<pre><code>from dataclasses import dataclass
import itertools

@dataclass
class Foo:
    letters: str
    
    def __getitem__(self, index):
        return self.letters[index] + &quot;_foo&quot;


letters = Foo(&quot;ABCD&quot;)
zip_ = zip(letters, letters[1:])
for a, b in zip_:
    print(a, b) # A_foo B, B_foo C, C_foo D, D_foo _
    
pair = itertools.pairwise(letters)
for a, b in pair:
    print(a, b) # A_foo B_foo, B_foo C_foo, C_foo D_foo
</code></pre>
<p>This other example is much probable.
here, <code>itertools.pairwise</code> was shadowed by a costume function <a href="https://play.ruff.rs">(playground)</a></p>
<pre><code>from dataclasses import dataclass
from itertools import pairwise

def pairwise(a):
    return []
    
letters = &quot;ABCD&quot;
zip_ = zip(letters, letters[1:])
print([(a, b) for a, b in zip_]) # [(&#x27;A&#x27;, &#x27;B&#x27;), (&#x27;B&#x27;, &#x27;C&#x27;), (&#x27;C&#x27;, &#x27;D&#x27;)]

pair = pairwise(letters)
print(pair) # []
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-01 06:09</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-01 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-05-04 09:19</div>
            <div class="timeline-body"><p>@dylwil3 Hey ;-) I think it is ready to review</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/zip_instead_of_pairwise.rs</code>:35 on 2025-05-09 20:32</div>
            <div class="timeline-body"><p>If this were the case, it would be a bug, not a reason for unsafety. We usually check if a symbol has the binding we expect, especially for symbols from the standard library.</p>
<p>https://github.com/astral-sh/ruff/pull/12663 was the PR actually adding the unsafe fix, the one in the description just stabilized it (moved it to stable from preview). There&#x27;s no discussion of making it unsafe, so your first example from the PR summary may be the best thing to include here. I think the fix will probably remove comments too, but I haven&#x27;t tested that.</p>
<p>(btw your playground links don&#x27;t include your code, you have to click the <code>Share</code> button to get a link that preserves your input :slightly_smiling_face:)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-05-09 20:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/VascoSch92">@VascoSch92</a> reviewed on 2025-05-10 16:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on <code>crates/ruff_linter/src/rules/ruff/rules/zip_instead_of_pairwise.rs</code>:35 on 2025-05-10 16:49</div>
            <div class="timeline-body"><p>Hey  @ntBre</p>
<p>I re-pasted the example in the playground and it seems that the rule is triggered, but it seems that if I push the share button, the link is not copied :-(</p>
<p>I&#x27;m adding a picture to prove my point :-)</p>
<p><img alt="Screenshot 2025-05-10 at 18 48 08" src="https://github.com/user-attachments/assets/3c1d51e9-39a9-4732-aaf0-cf20120e0fa3"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-05-11 16:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/zip_instead_of_pairwise.rs</code>:35 on 2025-05-11 16:08</div>
            <div class="timeline-body"><p>@VascoSch92 if you click &quot;quick fix&quot; in this example https://play.ruff.rs/231094cf-8f73-4510-b3f0-f9b3d640d0b0 then you will see that Ruff imports <code>itertools</code> and rewrites using <code>itertools.pairwise</code> so there is no conflict.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-05-11 16:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/zip_instead_of_pairwise.rs</code>:35 on 2025-05-11 16:09</div>
            <div class="timeline-body"><p>Moreover, if you <em>do</em> have a conflict - like if you already did <code>from itertools import pairwise</code> and then also shadowed it, then no fix is offered, even though the lint is emitted: https://play.ruff.rs/322a73ac-d1f9-4f47-a3a0-e3b7d541465d</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/VascoSch92">@VascoSch92</a> reviewed on 2025-05-11 20:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on <code>crates/ruff_linter/src/rules/ruff/rules/zip_instead_of_pairwise.rs</code>:35 on 2025-05-11 20:33</div>
            <div class="timeline-body"><p>Ah ok thanks for the explanation. I could reproduce what you are saying in my playground.</p>
<p>So yes... the comments are deleted (I will add in the fix safety section) and I will try to summarise the first example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-05-13 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dylwil3">@dylwil3</a> by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-05-13 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-05-13 20:32</div>
            <div class="timeline-body"><p>@ntBre , @dylwil3 let me know what do you think :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-05-14 15:06</div>
            <div class="timeline-body"><p>Thanks! And nice catch on the slicing behavior. That is very tricky.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 15:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:13:54 UTC
    </footer>
</body>
</html>
