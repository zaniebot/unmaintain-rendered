<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`refurb`] Implement `for-loop-set-mutations` (`FURB142`) - astral-sh/ruff #10583</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>refurb</code>] Implement <code>for-loop-set-mutations</code> (<code>FURB142</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10583">#10583</a>
        opened by <a href="https://github.com/alex-700">@alex-700</a>
        on 2024-03-25 18:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alex-700">@alex-700</a></div>
            <div class="timeline-body">

Summary
<p>Implement <code>manual_set_update</code> (<code>FURB142</code>) lint.
see:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/1348</li>
<li><a href="https://github.com/dosisod/refurb/blob/master/refurb/checks/builtin/no_set_for_loop.py">original FURB142</a></li>
</ul>


Test Plan
<p>cargo test</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-03-25 18:30</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+34 -0 violations, +0 -0 fixes in 5 projects; 39 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+12 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/airflow/providers/amazon/aws/hooks/glue_catalog.py#L124">airflow/providers/amazon/aws/hooks/glue_catalog.py:124:13:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/airflow/providers/amazon/aws/hooks/glue_catalog.py#L82">airflow/providers/amazon/aws/hooks/glue_catalog.py:82:13:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/airflow/utils/dag_edges.py#L74">airflow/utils/dag_edges.py:74:17:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/dev/breeze/src/airflow_breeze/commands/release_management_commands.py#L2052">dev/breeze/src/airflow_breeze/commands/release_management_commands.py:2052:13:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/dev/breeze/src/airflow_breeze/utils/docker_command_utils.py#L522">dev/breeze/src/airflow_breeze/utils/docker_command_utils.py:522:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/dev/breeze/src/airflow_breeze/utils/provider_dependencies.py#L54">dev/breeze/src/airflow_breeze/utils/provider_dependencies.py:54:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L827">dev/breeze/src/airflow_breeze/utils/selective_checks.py:827:17:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/dev/stats/calculate_statistics_provider_testing_issues.py#L110">dev/stats/calculate_statistics_provider_testing_issues.py:110:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/dev/stats/calculate_statistics_provider_testing_issues.py#L117">dev/stats/calculate_statistics_provider_testing_issues.py:117:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/scripts/tools/list-integrations.py#L67">scripts/tools/list-integrations.py:67:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/tests/jobs/test_scheduler_job.py#L3143">tests/jobs/test_scheduler_job.py:3143:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/apache/airflow/blob/714a933479f9dc1c3ef5916e43292efc182a0857/tests/jobs/test_scheduler_job.py#L3157">tests/jobs/test_scheduler_job.py:3157:9:</a> FURB142 [*] Use of `set.add()` in a for loop
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/document/test_models.py#L113">tests/unit/bokeh/document/test_models.py:113:9:</a> FURB142 [*] Use of `set.add()` in a for loop
</pre>

</p>

<a href="https://github.com/rotki/rotki">rotki/rotki</a> (+6 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/rotki/rotki/blob/e483befbaad2133d573d9f818e05601a805266bb/rotkehlchen/accounting/structures/defi.py#L94">rotkehlchen/accounting/structures/defi.py:94:13:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/rotki/rotki/blob/e483befbaad2133d573d9f818e05601a805266bb/rotkehlchen/chain/bitcoin/bch/utils.py#L166">rotkehlchen/chain/bitcoin/bch/utils.py:166:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/rotki/rotki/blob/e483befbaad2133d573d9f818e05601a805266bb/rotkehlchen/chain/evm/decoding/velodrome/velodrome_cache.py#L118">rotkehlchen/chain/evm/decoding/velodrome/velodrome_cache.py:118:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/rotki/rotki/blob/e483befbaad2133d573d9f818e05601a805266bb/rotkehlchen/chain/evm/decoding/velodrome/velodrome_cache.py#L122">rotkehlchen/chain/evm/decoding/velodrome/velodrome_cache.py:122:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/rotki/rotki/blob/e483befbaad2133d573d9f818e05601a805266bb/rotkehlchen/tests/exchanges/test_okx.py#L33">rotkehlchen/tests/exchanges/test_okx.py:33:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/rotki/rotki/blob/e483befbaad2133d573d9f818e05601a805266bb/rotkehlchen/tests/unit/test_data_dir.py#L77">rotkehlchen/tests/unit/test_data_dir.py:77:5:</a> FURB142 [*] Use of `set.add()` in a for loop
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+14 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/corporate/views/support.py#L501">corporate/views/support.py:501:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/corporate/views/support.py#L506">corporate/views/support.py:506:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/corporate/views/support.py#L515">corporate/views/support.py:515:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/corporate/views/support.py#L526">corporate/views/support.py:526:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/data_import/mattermost.py#L221">zerver/data_import/mattermost.py:221:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/data_import/mattermost.py#L224">zerver/data_import/mattermost.py:224:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/data_import/mattermost.py#L260">zerver/data_import/mattermost.py:260:13:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/data_import/rocketchat.py#L256">zerver/data_import/rocketchat.py:256:9:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/lib/bulk_create.py#L250">zerver/lib/bulk_create.py:250:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/lib/display_recipient.py#L157">zerver/lib/display_recipient.py:157:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/lib/server_initialization.py#L84">zerver/lib/server_initialization.py:84:5:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/lib/test_fixtures.py#L357">zerver/lib/test_fixtures.py:357:17:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/tests/test_import_export.py#L1126">zerver/tests/test_import_export.py:1126:21:</a> FURB142 [*] Use of `set.add()` in a for loop
+ <a href="https://github.com/zulip/zulip/blob/38b2988e0fdefbf466c846870606c1a41449e941/zerver/views/message_send.py#L43">zerver/views/message_send.py:43:9:</a> FURB142 [*] Use of `set.add()` in a for loop
</pre>

</p>

<a href="https://github.com/indico/indico">indico/indico</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/indico/indico/blob/bf5e80e457ccad1c037146fcf60d50edf5c6b786/indico/modules/events/abstracts/controllers/reviewing.py#L199">indico/modules/events/abstracts/controllers/reviewing.py:199:13:</a> FURB142 [*] Use of `set.add()` in a for loop
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| FURB142 | 34 | 34 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-26 07:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-03-26 07:58</div>
            <div class="timeline-body"><p>Thanks. This looks good to me. But I want to leave it to @AlexWaygood to also take a look.</p>
<p>My only concern with the rule as is is its name. From reading the rule name (or even the error message), it gives me the impression that I&#x27;m not supposed to update a set &quot;manually&quot; (unclear what that means) at all. Maybe <code>for-set-mutations</code> or <code>for-iterable-set-mutations</code></p>
<p>My reasoning. This is a style rule that guides users towards writing more idiomatic Python.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-26 10:59</div>
            <div class="timeline-body"><blockquote>
<p>My only concern with the rule as is is its name. From reading the rule name (or even the error message), it gives me the impression that I&#x27;m not supposed to update a set &quot;manually&quot; (unclear what that means) at all. Maybe <code>for-set-mutations</code> or <code>for-iterable-set-mutations</code></p>
</blockquote>
<p>I agree with @MichaReiser. The original name that Refurb has seems quite good to me (<a href="https://github.com/dosisod/refurb/blob/master/docs/checks.md#furb142-no-set-for-loop"><code>no-set-for-loop</code></a>), but obviously doesn&#x27;t fit with our naming conventions. Maybe <code>for-loop-set-mutations</code>? In the error message, rather than saying &quot;use of manual set update&quot;, I&#x27;d probably just say &quot;use of <code>set.add</code> in a for loop&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-03-26 11:03</div>
            <div class="timeline-body"><p>Overall really nicely done -- seems like a useful, uncontroversial rule and the autofixes are great. Just need to work on the docs a little bit :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`refurb`] Implement `manual_set_update` (`FURB142`)&quot; to &quot;[`refurb`] Implement `for-loop-set-mutations` (`FURB142`)&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-26 11:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex-700">@alex-700</a> on 2024-03-26 11:32</div>
            <div class="timeline-body"><p>@MichaReiser @AlexWaygood thanks for the review!</p>
<blockquote>
<p>My only concern with the rule as is is its name. From reading the rule name (or even the error message), it gives me the impression that I&#x27;m not supposed to update a set &quot;manually&quot; (unclear what that means) at all. Maybe for-set-mutations or for-iterable-set-mutations</p>
</blockquote>
<p>I&#x27;m fully aggree with the naming concern here, but could not invent something better.
Stick to @AlexWaygood &#x27;s option <code>for-loop-set-mutations</code>, which I really like. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-03-26 11:38</div>
            <div class="timeline-body"><p>LGTM, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-26 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-03-26 11:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/resources/test/fixtures/refurb/FURB142.py</code>:21 on 2024-03-26 11:50</div>
            <div class="timeline-body"><p>Would you mind adding a test case where the value passed to add also depends on other variables other than the loop variable, like https://github.com/apache/airflow/blob/e41b3c58e2d2f5968bd97b8d3b05a16e926be980/airflow/utils/dag_edges.py#L74</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alex-700">@alex-700</a> reviewed on 2024-03-26 12:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/alex-700">@alex-700</a> on <code>crates/ruff_linter/resources/test/fixtures/refurb/FURB142.py</code>:21 on 2024-03-26 12:38</div>
            <div class="timeline-body"><p>Added.
See <a href="https://github.com/astral-sh/ruff/pull/10583/commits/02fa99ebbec92bca7d20be09d95da270baf0e08b">commit</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-03-27 08:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/resources/test/fixtures/refurb/FURB142.py</code>:21 on 2024-03-27 08:25</div>
            <div class="timeline-body"><p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-27 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-27 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-10 20:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:02:34 UTC
    </footer>
</body>
</html>
