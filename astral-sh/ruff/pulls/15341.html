<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add f-string formatting to the docs - astral-sh/ruff #15341</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add f-string formatting to the docs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15341">#15341</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-01-08 09:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>This PR adds a new f-string formatting section to the documentation.</p>
<p>It adds it to the https://docs.astral.sh/ruff/formatter page and provides a backlink in the deviation section as well.</p>
<p>There isn&#x27;t a great place to add this kind of section in our documentation as ideally it would go under &quot;Ruff code style&quot; (similar to <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html">Black code style</a>) section.</p>
Question
<p>I&#x27;ve found having the &quot;Quotes&quot; and &quot;Line breaks&quot; section in structuring the content but I&#x27;m open to removing them. Any opinions are welcome!</p>
<p>There can be more content to it but I&#x27;m not sure if we want to provide a lot of details. For example, we can expand on the &quot;Quotes&quot; section to enumerate all additional cases where we preserve the quote style.</p>
Preview
<p><img alt="Screenshot 2025-01-08 at 9 26 39â€¯PM" src="https://github.com/user-attachments/assets/4c77c012-3a2a-4fc1-92c7-b6e4f1ebad71"></p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 09:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 10:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 10:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 10:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-08 12:49</div>
            <div class="timeline-body"><p>The section does feel a bit out of place. That makes me wonder if we should rename the <em>Black compatibility</em> section to <em>Style guide</em>, rephrase the section to say that we follow Black&#x27;s style guide with a few exceptions and that this section documents where we go beyond what black does?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:230 on 2025-01-08 12:51</div>
            <div class="timeline-body"><pre><code>_Stabilized in Ruff 0.9.0_
</code></pre>
<p>It&#x27;s probably easier for users to know what Ruff version they&#x27;re using.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:233 on 2025-01-08 12:51</div>
            <div class="timeline-body"><p>Nit: By default suggests that there&#x27;s a way to disable the behavior.</p>
<pre><code>Unlike Black, Ruff formats f-string expressions. 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:246 on 2025-01-08 12:57</div>
            <div class="timeline-body"><p>This is one reason. The other is that it tries to minimize escapes, similar to what&#x27;s described here https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#strings</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:240 on 2025-01-08 12:58</div>
            <div class="timeline-body"><p>I&#x27;m leaning toward removing those bullets because they&#x27;re each covered by a sub-heading (except how to skip f-string formatting)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:249 on 2025-01-08 13:02</div>
            <div class="timeline-body"><p>I think this is slightly misleading. Ruff can change the quotes for:</p>
<pre><code>f&#x27;{10 + len(&quot;hello \&quot; &quot;)}&#x27;
</code></pre>
<p>It gets formatted to</p>
<pre><code>f&quot;{10 + len(&#x27;hello &quot; &#x27;)}&quot;
</code></pre>
<p>It can only not change the quotes if they&#x27;re inside a debug expression (or format specifier). Let&#x27;s double check with the implementation if there are other reasons when the preferred quote style can&#x27;t be applied</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 13:03</div>
            <div class="timeline-body"><blockquote>
<p>That makes me wonder if we should rename the <em>Black compatibility</em> section to <em>Style guide</em>, rephrase the section to say that we follow Black&#x27;s style guide with a few exceptions and that this section documents where we go beyond what black does?</p>
</blockquote>
<p>Interesting. This seems like a good idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:260 on 2025-01-08 13:05</div>
            <div class="timeline-body"><pre><code>For nested f-strings, Ruff alternates quote styles, starting with the configured style for the
outermost f-string.
</code></pre>
<p>It wasn&#x27;t clear to me if this now demonstrates a case where Ruff doesn&#x27;t change the quote style because it would result in invalid syntax but I think it doesn&#x27;t. I&#x27;m leaning towards omitting this sentence because it&#x27;s kind of expected that the formatter doesn&#x27;t produce invalid syntax.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:280 on 2025-01-08 13:06</div>
            <div class="timeline-body"><p>I&#x27;m leaning towards motivating this closer to what Prettier wrote</p>
<blockquote>
<p>Template literals can contain interpolations. Deciding whether it&#x27;s appropriate to insert a linebreak within an interpolation unfortunately depends on the semantic content of the template - for example, introducing a linebreak in the middle of a natural-language sentence is usually undesirable. Since Prettier doesn&#x27;t have enough information to make this decision itself, it uses a heuristic similar to that used for objects: it will only split an interpolation expression across multiple lines if there was already a linebreak within that interpolation.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-08 13:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-08 13:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>docs/formatter.md</code>:233 on 2025-01-08 13:09</div>
            <div class="timeline-body"><p>I think also it might be worth making clear exactly what we mean by &quot;f-string expressions&quot;. I.e., I believe black will change <code>f&#x27;{foo()}&#x27;</code> to <code>f&quot;{foo()}&quot;</code> -- it just won&#x27;t format the interpolated expressions inside the braces, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-08 13:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>docs/formatter.md</code>:236 on 2025-01-08 13:09</div>
            <div class="timeline-body"><pre><code>Ruff employs several heuristics to determine how an f-string should be formatted, including:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-08 13:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>docs/formatter.md</code>:233 on 2025-01-08 13:10</div>
            <div class="timeline-body"><p>Yes, that&#x27;s correct. Good point, I&#x27;ll make the change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-08 13:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:233 on 2025-01-08 13:11</div>
            <div class="timeline-body"><p>Yes, kind of, it&#x27;s complicated. Black does change the quotes but only if there are no nested expressions with quotes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-08 13:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>docs/formatter.md</code>:240 on 2025-01-08 13:19</div>
            <div class="timeline-body"><p>Yeah, makes sense. I&#x27;ll add the one for the last bullet point.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-08 13:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>docs/formatter.md</code>:249 on 2025-01-08 13:23</div>
            <div class="timeline-body"><p>Thanks for sharing that although I&#x27;m referring to a self-documenting f-string which shouldn&#x27;t change the quote.</p>
<p>I&#x27;ll add other reasons when we don&#x27;t change the quotes as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-08 13:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:249 on 2025-01-08 13:27</div>
            <div class="timeline-body"><p>oh, I didn&#x27;t notice that (and probably wouldn&#x27;t have understood what it is). It might be worth adding a reference link</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v0.9&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-08 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-01-08 15:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>docs/formatter.md</code>:280 on 2025-01-08 15:37</div>
            <div class="timeline-body"><p>I&#x27;ve provided a link to the relevant section in Prettier which is why I thought not to add the same detail here and keep it short.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 15:58</div>
            <div class="timeline-body"><p>@MichaReiser I&#x27;ve made some changes to introduce a &quot;Style Guide&quot; section. I&#x27;ve removed some content from previous section because it doesn&#x27;t really fit in the new section. Happy to hear any thoughts on it, I can refine the section a bit more and add some more content if it looks good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:410 on 2025-01-08 16:18</div>
            <div class="timeline-body"><pre><code>invalid syntax for the target Python version or requires more backslash escapes
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:280 on 2025-01-08 16:21</div>
            <div class="timeline-body"><p>Including a link to the source of our inspiration is great but I don&#x27;t expect many users to click it and one important aspect of the style guide section is that we motivate our formatting. That&#x27;s why I&#x27;d still prefer at least a few words why we trade consistency with flexibility.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-01-08 16:23</div>
            <div class="timeline-body"><p>Nice. I really like where this is going. We might have to port some more deviations to the style guide section in the future but this is a great start.</p>
<p>One more nit and if we could motivate the line break behavior a bit more would be great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:431 on 2025-01-08 16:51</div>
            <div class="timeline-body"><pre><code>For all target Python versions, when a [self-documenting f-string expression] contains an expression between
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:432 on 2025-01-08 16:53</div>
            <div class="timeline-body"><pre><code>the curly braces (`{...}`) with a format specifier containing the configured quote style:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:490 on 2025-01-08 16:53</div>
            <div class="timeline-body"><pre><code>[self-documenting f-string expression]: https://realpython.com/python-f-strings/#self-documenting-expressions-for-debugging
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:455 on 2025-01-08 16:54</div>
            <div class="timeline-body"><pre><code>Starting with Python 3.12 ([PEP 701](https://peps.python.org/pep-0701/)), the expression parts of an f-string can
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:456 on 2025-01-08 16:55</div>
            <div class="timeline-body"><pre><code>span multiple lines. Ruff adopts a heuristic similar to [Prettier](https://prettier.io/docs/en/next/rationale.html#template-literals)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:458 on 2025-01-08 16:56</div>
            <div class="timeline-body"><pre><code>if there was already a line break within any of the expression parts of the f-string.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> approved on 2025-01-08 16:56</div>
            <div class="timeline-body"><p>Looks great! A few grammatical nits</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-08 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch restored on 2025-01-09 05:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-09 05:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch restored on 2025-01-09 05:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:10:07 UTC
    </footer>
</body>
</html>
