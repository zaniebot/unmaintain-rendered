<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add 'remove unused ignore comment' code action - astral-sh/ruff #21582</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add 'remove unused ignore comment' code action</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21582">#21582</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-11-22 21:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds a code action to remove unused ignore comments.</p>
<p>This PR also includes some infrastructure boilerplate to set up code actions in the editor:</p>
<ul>
<li>Extend <code>snapshot-diagnostics</code> to render fixes</li>
<li>Render fixes when using <code>--output-format=full</code></li>
<li>Hook up edits and the code action request in the LSP</li>
<li>Add the <code>Unnecessary</code> tag to <code>unused-ignore-comment</code> diagnostics</li>
<li>Group multiple unused codes into a single diagnostic</li>
</ul>
<p>The same fix can be used on the CLI once we add <code>ty fix</code></p>
<p>Note: <code>unused-ignore-comment</code> is currently disabled by default.</p>
<p>https://github.com/user-attachments/assets/f9e21087-3513-4156-85d7-a90b1a7a3489</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-11-22 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-11-22 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Add 'remove unused ignore comment' code action"" to "[ty] Add 'remove unused ignore comment' code action" by @MichaReiser on 2025-11-22 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-22 21:44</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-22 21:59</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>âœ… ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-23 10:12</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">pytest-robotframework (https://github.com/detachhead/pytest-robotframework)
- pytest_robotframework/_internal/pytest/plugin.py:127:99: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'unresolved-attribute'
+ pytest_robotframework/_internal/pytest/plugin.py:127:99: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pytest_robotframework/_internal/pytest/plugin.py:197:93: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'unresolved-attribute'
+ pytest_robotframework/_internal/pytest/plugin.py:197:93: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pytest_robotframework/_internal/pytest/plugin.py:235:89: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'non-subscriptable'
+ pytest_robotframework/_internal/pytest/plugin.py:235:89: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pytest_robotframework/_internal/robot/library.py:86:99: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'possibly-missing-attribute'
+ pytest_robotframework/_internal/robot/library.py:86:99: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pytest_robotframework/_internal/robot/listeners_and_suite_visitors.py:455:40: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'missing-typed-dict-key'
- pytest_robotframework/_internal/robot/listeners_and_suite_visitors.py:455:63: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ pytest_robotframework/_internal/robot/listeners_and_suite_visitors.py:455:28: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pytest_robotframework/_internal/robot/listeners_and_suite_visitors.py:472:40: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'missing-typed-dict-key'
- pytest_robotframework/_internal/robot/listeners_and_suite_visitors.py:472:63: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ pytest_robotframework/_internal/robot/listeners_and_suite_visitors.py:472:28: warning[unused-ignore-comment] Unused `ty: ignore` directive
- tests/conftest.py:82:77: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'subclass-of-final-class'
+ tests/conftest.py:82:77: warning[unused-ignore-comment] Unused `ty: ignore` directive
- Found 169 diagnostics
+ Found 167 diagnostics

typeshed-stats (https://github.com/AlexWaygood/typeshed-stats)
- tests/test__cli.py:541:38: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-assignment'
+ tests/test__cli.py:541:38: warning[unused-ignore-comment] Unused `ty: ignore` directive

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
- src/scikit_build_core/build/wheel.py:98:20: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- Found 45 diagnostics
+ Found 44 diagnostics

streamlit (https://github.com/streamlit/streamlit)
- lib/streamlit/config.py:2635:37: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-return-type'
+ lib/streamlit/config.py:2635:37: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/connections/sql_connection.py:221:37: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'redundant-cast'
+ lib/streamlit/connections/sql_connection.py:221:37: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/dataframe_util.py:701:41: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'redundant-cast'
+ lib/streamlit/dataframe_util.py:701:41: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/dataframe_util.py:730:41: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'redundant-cast'
+ lib/streamlit/dataframe_util.py:730:41: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/lib/built_in_chart_utils.py:637:22: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-return-type'
+ lib/streamlit/elements/lib/built_in_chart_utils.py:637:22: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/vega_charts.py:382:33: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'unresolved-attribute'
+ lib/streamlit/elements/vega_charts.py:382:33: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/vega_charts.py:416:30: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-context-manager'
+ lib/streamlit/elements/vega_charts.py:416:30: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/vega_charts.py:418:37: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-context-manager'
+ lib/streamlit/elements/vega_charts.py:418:37: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/widgets/data_editor.py:171:67: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'possibly-missing-attribute'
+ lib/streamlit/elements/widgets/data_editor.py:171:67: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/widgets/slider.py:801:63: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'unsupported-operator'
+ lib/streamlit/elements/widgets/slider.py:801:63: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/elements/widgets/time_widgets.py:167:73: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ lib/streamlit/elements/widgets/time_widgets.py:167:73: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/file_util.py:247:51: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'no-matching-overload'
+ lib/streamlit/file_util.py:247:51: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/runtime/caching/cache_utils.py:128:39: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ lib/streamlit/runtime/caching/cache_utils.py:128:39: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/runtime/caching/cache_utils.py:174:40: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ lib/streamlit/runtime/caching/cache_utils.py:174:40: warning[unused-ignore-comment] Unused `ty: ignore` directive
- lib/streamlit/runtime/caching/cache_utils.py:200:35: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ lib/streamlit/runtime/caching/cache_utils.py:200:35: warning[unused-ignore-comment] Unused `ty: ignore` directive

pandas-stubs (https://github.com/pandas-dev/pandas-stubs)
- pandas-stubs/core/groupby/generic.pyi:215:34: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ pandas-stubs/core/groupby/generic.pyi:215:34: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pandas-stubs/core/groupby/generic.pyi:220:34: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ pandas-stubs/core/groupby/generic.pyi:220:34: warning[unused-ignore-comment] Unused `ty: ignore` directive
- pandas-stubs/core/groupby/generic.pyi:225:34: warning[unused-ignore-comment] Unused `ty: ignore` directive: 'invalid-argument-type'
+ pandas-stubs/core/groupby/generic.pyi:225:34: warning[unused-ignore-comment] Unused `ty: ignore` directive


</code></pre>
</details>

<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-23 11:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/Cargo.toml</code>:16 on 2025-11-23 11:33</div>
            <div class="timeline-body"><p>We should probably fold <code>ruff_diagnostics</code> into <code>ruff_db</code>. There's really not much in there but this seemed unrelated to this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-23 11:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:642 on 2025-11-23 11:40</div>
            <div class="timeline-body"><p>This is now handled by the unused suppression lint itself</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-11-23 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-11-23 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-11-23 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-11-23 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-11-23 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/suppressions/ty_ignore.md</code>:134 on 2025-11-23 16:17</div>
            <div class="timeline-body"><p>the comment here suggests to me that the trailing whitespace might have been intentional :P</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-23 16:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-23 16:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/resources/mdtest/suppressions/ty_ignore.md</code>:134 on 2025-11-23 16:20</div>
            <div class="timeline-body"><p>Thanks, yes they are (which is why I added the comment). It's so annoying that I can't tell my editors: Don't trim trailing whitespaces here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:189 on 2025-11-23 16:21</div>
            <div class="timeline-body"><p>nit: is there a reason to import this locally rather than globally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:339 on 2025-11-23 16:29</div>
            <div class="timeline-body"><p>you can simplify the code by using the <code>DiagnosticGuard::help()</code> method:</p>
<pre><code class="language-diff">diff --git a/crates/ty_python_semantic/src/suppression.rs b/crates/ty_python_semantic/src/suppression.rs
index caa9796295..16db479d13 100644
--- a/crates/ty_python_semantic/src/suppression.rs
+++ b/crates/ty_python_semantic/src/suppression.rs
@@ -3,8 +3,7 @@ use crate::lint::{GetLintError, Level, LintMetadata, LintRegistry, LintStatus};
 use crate::types::TypeCheckDiagnostics;
 use crate::{Db, declare_lint, lint::LintId};
 use ruff_db::diagnostic::{
-    Annotation, Diagnostic, DiagnosticId, IntoDiagnosticMessage, Severity, Span, SubDiagnostic,
-    SubDiagnosticSeverity,
+    Annotation, Diagnostic, DiagnosticId, IntoDiagnosticMessage, Severity, Span,
 };
 use ruff_db::{files::File, parsed::parsed_module, source::source_text};
 use ruff_diagnostics::{Edit, Fix};
@@ -332,17 +331,11 @@ fn check_unused_suppressions(context: &amp;mut CheckSuppressionsContext) {
                         );
                         diag.set_fix(Fix::safe_edit(Edit::range_deletion(fix_range)));
 
-                        if unused_codes.is_empty() {
-                            diag.sub(SubDiagnostic::new(
-                                SubDiagnosticSeverity::Help,
-                                &quot;Remove the unused suppression code&quot;,
-                            ));
+                        diag.help(if unused_codes.is_empty() {
+                            &quot;Remove the unused suppression code&quot;
                         } else {
-                            diag.sub(SubDiagnostic::new(
-                                SubDiagnosticSeverity::Help,
-                                &quot;Remove the unused suppression codes&quot;,
-                            ));
-                        }
+                            &quot;Remove the unused suppression codes&quot;
+                        });
                     }
 
                     continue;
@@ -377,10 +370,7 @@ fn check_unused_suppressions(context: &amp;mut CheckSuppressionsContext) {
             .unwrap()
             .push_tag(ruff_db::diagnostic::DiagnosticTag::Unnecessary);
         diag.set_fix(remove_comment_fix(suppression, &amp;source));
-        diag.sub(SubDiagnostic::new(
-            SubDiagnosticSeverity::Help,
-            &quot;Remove the unused suppression comment&quot;,
-        ));
+        diag.help(&quot;Remove the unused suppression comment&quot;);
     }
 }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:1092 on 2025-11-23 16:30</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            comment_end,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:1112 on 2025-11-23 16:31</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        comment_end,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-23 16:33</div>
            <div class="timeline-body"><p>Very excited to see this happen! A few nits from skimming</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-11-24 22:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @MichaReiser on 2025-11-25 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @MichaReiser on 2025-11-25 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Gankra by @MichaReiser on 2025-11-25 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-25 08:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:189 on 2025-11-25 08:17</div>
            <div class="timeline-body"><p>Mainly laziness. RustRover can't auto import <code>Write</code> and having to scroll to the top and down again breaks my entire flow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:300 on 2025-11-25 11:06</div>
            <div class="timeline-body"><p>you could use early-return style here to reduce the indentation:</p>
<pre><code class="language-diff">diff --git a/crates/ty_python_semantic/src/suppression.rs b/crates/ty_python_semantic/src/suppression.rs
index ab246c1b0a..852fa5e1bd 100644
--- a/crates/ty_python_semantic/src/suppression.rs
+++ b/crates/ty_python_semantic/src/suppression.rs
@@ -294,49 +294,51 @@ fn check_unused_suppressions(context: &amp;mut CheckSuppressionsContext) {
                         let _ = write!(&amp;mut codes, &quot;, '{code}'&quot;, code = code.name());
                     }
 
-                    if let Some(diag) = context.report_unchecked(
+                    let Some(diag) = context.report_unchecked(
                         &amp;UNUSED_IGNORE_COMMENT,
                         TextRange::new(suppression.range.start(), current.range.end()),
-                    ) {
-                        let mut diag = diag.into_diagnostic(format_args!(
-                            &quot;Unused `{kind}` directive: {codes}&quot;,
-                            kind = suppression.kind
-                        ));
-
-                        diag.primary_annotation_mut()
-                            .unwrap()
-                            .push_tag(ruff_db::diagnostic::DiagnosticTag::Unnecessary);
-
-                        // Delete everything up to the start of the next code.
-                        let trailing_len: TextSize = source[current.range.end().to_usize()..]
+                    ) else {
+                        continue;
+                    };
+
+                    let mut diag = diag.into_diagnostic(format_args!(
+                        &quot;Unused `{kind}` directive: {codes}&quot;,
+                        kind = suppression.kind
+                    ));
+
+                    diag.primary_annotation_mut()
+                        .unwrap()
+                        .push_tag(ruff_db::diagnostic::DiagnosticTag::Unnecessary);
+
+                    // Delete everything up to the start of the next code.
+                    let trailing_len: TextSize = source[current.range.end().to_usize()..]
+                        .chars()
+                        .take_while(|c: &amp;char| c.is_whitespace() || *c == ',')
+                        .map(TextLen::text_len)
+                        .sum();
+
+                    // If we delete the last codes before `]`, ensure we delete any trailing comma
+                    let leading_len: TextSize = if includes_last_code {
+                        source[..suppression.range.start().to_usize()]
                             .chars()
+                            .rev()
                             .take_while(|c: &amp;char| c.is_whitespace() || *c == ',')
                             .map(TextLen::text_len)
-                            .sum();
-
-                        // If we delete the last codes before `]`, ensure we delete any trailing comma
-                        let leading_len: TextSize = if includes_last_code {
-                            source[..suppression.range.start().to_usize()]
-                                .chars()
-                                .rev()
-                                .take_while(|c: &amp;char| c.is_whitespace() || *c == ',')
-                                .map(TextLen::text_len)
-                                .sum()
-                        } else {
-                            TextSize::default()
-                        };
-
-                        let fix_range = TextRange::new(
-                            suppression.range.start() - leading_len,
-                            current.range.end() + trailing_len,
-                        );
-                        diag.set_fix(Fix::safe_edit(Edit::range_deletion(fix_range)));
-
-                        if unused_codes.is_empty() {
-                            diag.help(&quot;Remove the unused suppression code&quot;);
-                        } else {
-                            diag.help(&quot;Remove the unused suppression codes&quot;);
-                        }
+                            .sum()
+                    } else {
+                        TextSize::default()
+                    };
+
+                    let fix_range = TextRange::new(
+                        suppression.range.start() - leading_len,
+                        current.range.end() + trailing_len,
+                    );
+                    diag.set_fix(Fix::safe_edit(Edit::range_deletion(fix_range)));
+
+                    if unused_codes.is_empty() {
+                        diag.help(&quot;Remove the unused suppression code&quot;);
+                    } else {
+                        diag.help(&quot;Remove the unused suppression codes&quot;);
                     }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:333 on 2025-11-25 11:09</div>
            <div class="timeline-body"><p><code>type: ignore</code> comments, unlike <code>ty: ignore</code> comments, might have other consumers apart from ty (the user might run multiple type checkers over their codebase, especially if they're maintaining a library). So I'd lean towards marking this an unsafe fix for now.</p>
<p>I know we've discussed that we want better configuration options around whether ty should respect <code>type: ignore</code> comments at all (or only look at <code>ty: ignore</code> comments, and if we had those configuration options I think this could possibly be made a safe fix... but we don't have those configuration options yet ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-25 11:10</div>
            <div class="timeline-body"><p>ðŸš€</p>
<p>(Didn't review the <code>ty_server</code> code in depth)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-25 12:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:333 on 2025-11-25 12:08</div>
            <div class="timeline-body"><p>I'd prefer to solve this as part of adding a new setting or splitting unused ignore comment into multiple rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:300 on 2025-11-25 12:09</div>
            <div class="timeline-body"><p>I prefer how it is now. It makes it clearer that all code paths in this branch ultimately call <code>continue</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-25 12:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-25 12:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:333 on 2025-11-25 12:11</div>
            <div class="timeline-body"><p>I agree we should do that. To me, marking these as unsafe fixes in the meantime seems like the fairer thing to do for our users until we do that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-25 12:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/suppression.rs</code>:333 on 2025-11-25 12:19</div>
            <div class="timeline-body"><p>You can't really enable <code>unused-ignore-comment</code> if you're using another type checker anyway, we don't support a <code>--fix</code> command, nor applicabilities, and triggering it from the IDE is a manual action.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/ty_python_semantic/Cargo.toml</code>:16 on 2025-11-25 13:02</div>
            <div class="timeline-body"><p>I tried this and it ran into circular reference nastiness (stuff depends on <code>ruff_diagnostics</code> that <code>ruff_db</code> in turn depends on, I guess?). I opted to just <code>pub use</code> the relevant items in <code>ruff_db</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-11-25 13:07</div>
            <div class="timeline-body"><p>Rad, yeah this is exactly the minimal version that makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @Gankra on 2025-11-25 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Gankra on 2025-11-25 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-25 13:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:17:29 UTC
    </footer>
</body>
</html>
