```yaml
number: 6752
title: "Avoid `C417` for `lambda` with default and variadic parameters"
type: pull_request
state: merged
author: dhruvmanila
labels: []
assignees: []
merged: true
base: main
head: dhruv/c417
created_at: 2023-08-22T04:21:59Z
updated_at: 2023-08-22T19:15:46Z
url: https://github.com/astral-sh/ruff/pull/6752
synced_at: 2026-01-12T02:45:38Z
```

# Avoid `C417` for `lambda` with default and variadic parameters

---

_Pull request opened by @dhruvmanila on 2023-08-22 04:21_

## Summary

Avoid `C417` for `lambda` with default and variadic parameters.

## Test Plan

`cargo test` and checking if it generates any autofix errors as test cases
for `lambda` with default parameters already exists.

fixes: #6715


---

_Comment by @dhruvmanila on 2023-08-22 04:22_

Current dependencies on/for this PR:
* main
  * **PR #6752** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6752" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6752?utm_source=stack-comment).

---

_@dhruvmanila reviewed on 2023-08-22 04:22_

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:116 on 2023-08-22 04:22_

Would it be useful to have this as a method on `Parameters` node? (`has_defaults`?)

---

_Review requested from @charliermarsh by @dhruvmanila on 2023-08-22 04:23_

---

_Comment by @github-actions[bot] on 2023-08-22 04:36_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      3.7Â±0.13ms    10.9 MB/sec    1.01      3.8Â±0.10ms    10.8 MB/sec
formatter/numpy/ctypeslib.py               1.00   785.3Â±18.37Âµs    21.2 MB/sec    1.01   791.8Â±20.09Âµs    21.0 MB/sec
formatter/numpy/globals.py                 1.00     84.2Â±3.18Âµs    35.0 MB/sec    1.02     85.9Â±3.08Âµs    34.4 MB/sec
formatter/pydantic/types.py                1.00  1532.1Â±54.52Âµs    16.6 MB/sec    1.01  1541.2Â±43.76Âµs    16.5 MB/sec
linter/all-rules/large/dataset.py          1.00     11.1Â±0.22ms     3.7 MB/sec    1.01     11.2Â±0.23ms     3.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      3.1Â±0.07ms     5.3 MB/sec    1.00      3.1Â±0.06ms     5.4 MB/sec
linter/all-rules/numpy/globals.py          1.01   435.5Â±10.76Âµs     6.8 MB/sec    1.00   430.9Â±10.94Âµs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.9Â±0.18ms     4.3 MB/sec    1.03      6.1Â±0.17ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.00      6.1Â±0.15ms     6.7 MB/sec    1.01      6.1Â±0.13ms     6.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1340.7Â±41.72Âµs    12.4 MB/sec    1.01  1351.3Â±30.23Âµs    12.3 MB/sec
linter/default-rules/numpy/globals.py      1.02    157.1Â±3.86Âµs    18.8 MB/sec    1.00    154.3Â±4.06Âµs    19.1 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.8Â±0.07ms     9.2 MB/sec    1.00      2.8Â±0.08ms     9.2 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      3.8Â±0.07ms    10.7 MB/sec    1.03      3.9Â±0.08ms    10.5 MB/sec
formatter/numpy/ctypeslib.py               1.00   767.7Â±19.84Âµs    21.7 MB/sec    1.02   783.7Â±19.09Âµs    21.2 MB/sec
formatter/numpy/globals.py                 1.00     78.8Â±1.49Âµs    37.5 MB/sec    1.05     82.7Â±3.02Âµs    35.7 MB/sec
formatter/pydantic/types.py                1.00  1533.0Â±25.87Âµs    16.6 MB/sec    1.03  1574.3Â±37.07Âµs    16.2 MB/sec
linter/all-rules/large/dataset.py          1.00     13.1Â±0.22ms     3.1 MB/sec    1.01     13.2Â±0.14ms     3.1 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5Â±0.05ms     4.7 MB/sec    1.01      3.6Â±0.05ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    443.8Â±7.18Âµs     6.6 MB/sec    1.00    445.5Â±5.46Âµs     6.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.8Â±0.11ms     3.8 MB/sec    1.03      7.0Â±0.13ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      7.2Â±0.08ms     5.7 MB/sec    1.04      7.5Â±0.09ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1516.6Â±15.92Âµs    11.0 MB/sec    1.04  1578.9Â±36.20Âµs    10.5 MB/sec
linter/default-rules/numpy/globals.py      1.00    175.6Â±3.90Âµs    16.8 MB/sec    1.03    180.1Â±4.17Âµs    16.4 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.2Â±0.04ms     7.9 MB/sec    1.03      3.3Â±0.05ms     7.6 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_@charliermarsh reviewed on 2023-08-22 14:10_

---

_Review comment by @charliermarsh on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:206 on 2023-08-22 14:10_

Should we also avoid starred arguments and kwargs?

---

_@charliermarsh reviewed on 2023-08-22 15:56_

---

_Review comment by @charliermarsh on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:116 on 2023-08-22 15:56_

I think what we have here is reasonable, maybe if we find ourselves doing this in at least one other place.

---

_@dhruvmanila reviewed on 2023-08-22 17:01_

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:206 on 2023-08-22 17:01_

Yeah, we should otherwise the fix isn't correct either:
```python
map(lambda *x: len(x), nums)

# Gets fixed to 
(len(x) for _ in nums)  # where's x?
```

---

_@charliermarsh reviewed on 2023-08-22 17:16_

---

_Review comment by @charliermarsh on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:220 on 2023-08-22 17:16_

I think I'd vote not to flag this at all -- wdyt? Also should simplify the implementation.

---

_@dhruvmanila reviewed on 2023-08-22 17:26_

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:220 on 2023-08-22 17:26_

Interestingly I was just playing around with that asking the same question. Why should we flag it if it isn't fixable (not from an implementation side but from the user side)? 

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:220 on 2023-08-22 17:32_

Yeah, I'd go for the same route of not flagging this in the first place. Also, the fix would not yield the same result:

```python
In [1]: nums = [[0, 1, 2, 3], [4, 5, 6]]

In [2]: list(map(lambda x, *y: y, nums))
Out[2]: [(), ()]

In [3]: [y for x, *y in nums]
Out[3]: [[1, 2, 3], [5, 6]]
```

---

_@dhruvmanila reviewed on 2023-08-22 17:32_

---

_@charliermarsh reviewed on 2023-08-22 17:38_

---

_Review comment by @charliermarsh on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:220 on 2023-08-22 17:38_

(Sorry for not mentioning this on the first review.)

---

_Renamed from "Avoid `C417` autofix for `lambda` with default parameters" to "Avoid `C417` for `lambda` with default and variadic parameters" by @dhruvmanila on 2023-08-22 17:42_

---

_@dhruvmanila reviewed on 2023-08-22 17:43_

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:220 on 2023-08-22 17:43_

No problem at all :)

---

_Review comment by @charliermarsh on `crates/ruff/src/rules/flake8_comprehensions/rules/unnecessary_map.rs`:108 on 2023-08-22 18:17_

Nit: Let's revert to the `is_some_and` pattern, I think we intentionally migrated towards that style?

---

_@charliermarsh approved on 2023-08-22 18:17_

Thx!

---

_Merged by @dhruvmanila on 2023-08-22 19:08_

---

_Closed by @dhruvmanila on 2023-08-22 19:08_

---

_Branch deleted on 2023-08-22 19:08_

---
