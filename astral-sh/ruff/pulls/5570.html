<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement PYI030: Unnecessary literal union - astral-sh/ruff #5570</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement PYI030: Unnecessary literal union</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5570">#5570</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-07-06 19:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Implements PYI030 as part of https://github.com/astral-sh/ruff/issues/848</p>
<blockquote>
<p>Union expressions should never have more than one Literal member, as Literal[1] | Literal[2] is semantically identical to Literal[1, 2].</p>
</blockquote>
<p>Note we differ slightly from the flake8-pyi implementation:</p>
<ul>
<li>We detect cases where there are parentheses or nested unions</li>
<li>We detect cases with mixed <code>Union</code> and <code>|</code> syntax</li>
<li>We use the same error message for all violations; flake8-pyi has two different messages</li>
<li>We retain the user's quoting style when displaying string literals; flake8-pyi uses single quotes</li>
<li>We warn on duplicates of the same literal <code>Literal[1] | Literal[1]</code><ul>
<li>flake8-pyi does not warn on this because it overlaps with PYI016; we can avoid a violation here if we want but then we'll need to track the hashes of all seen literals alongside the vector of literal expressions which I would prefer to keep ordered</li>
</ul>
</li>
</ul>
<pre><code>❯ flake8 --select Y030 crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:9:9: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:12:17: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:17:16: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:22:9: Y030 Multiple Literal members in a union. Combine them into one, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:23:9: Y030 Multiple Literal members in a union. Combine them into one, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:24:9: Y030 Multiple Literal members in a union. Combine them into one, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:25:9: Y030 Multiple Literal members in a union. Combine them into one, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:28:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:35:11: Y030 Multiple Literal members in a union. Combine them into one, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:38:15: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:41:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2, 3]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:42:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2, 3, 4]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:45:10: Y030 Multiple Literal members in a union. Combine them into one, e.g. &quot;Literal[1, 2, 3]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:48:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 'foo', True]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:60:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:64:5: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:71:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2, 3, 4]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:74:23: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:77:10: Y030 Multiple Literal members in a union. Use a single Literal, e.g. &quot;Literal[1, 2]&quot;.
(19 errors)
</code></pre>
<pre><code>❯ ./target/debug/ruff --select PYI030 crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:9:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:12:17: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:17:16: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:22:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:23:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:24:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:25:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:28:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:31:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:34:9: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:35:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:38:15: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:41:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2, 3]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:42:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2, 3, 4]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:45:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2, 3]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:48:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, &quot;foo&quot;, True]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:51:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 1]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:60:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:63:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:71:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2, 3, 4]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:74:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:77:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:80:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi:83:10: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[1, 2]`
Found 24 errors.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Implement PYI0303: Unnecessary literal union" to "Implement PYI030: Unnecessary literal union" by @zanieb on 2023-07-06 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-06 19:13</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+3, -0, 0 error(s))</p>
<details><summary>airflow (+2, -0)</summary>
<p>

<pre><code class="language-diff">+ airflow/cli/commands/task_command.py:72:21: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[False, &quot;db&quot;, &quot;memory&quot;]`
+ airflow/models/mappedoperator.py:80:20: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[&quot;expand&quot;, &quot;partial&quot;]`
</code></pre>
</p>
</details>
<details><summary>bokeh (+1, -0)</summary>
<p>

<pre><code class="language-diff">+ src/bokeh/core/serialization.py:148:25: PYI030 Multiple literal members in a union. Use a single literal, e.g. `Literal[&quot;bool&quot;, &quot;object&quot;]`
</code></pre>
</p>
</details>
Rules changed: 1

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PYI030 | 3 | 3 | 0 |</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.01      9.1±0.37ms     4.5 MB/sec    1.00      9.0±0.45ms     4.5 MB/sec
formatter/numpy/ctypeslib.py               1.00  1960.9±78.37µs     8.5 MB/sec    1.02  1996.2±111.16µs     8.3 MB/sec
formatter/numpy/globals.py                 1.00   228.9±15.92µs    12.9 MB/sec    1.02   232.9±20.43µs    12.7 MB/sec
formatter/pydantic/types.py                1.00      4.3±0.22ms     5.9 MB/sec    1.02      4.4±0.25ms     5.8 MB/sec
linter/all-rules/large/dataset.py          1.02     15.9±0.55ms     2.6 MB/sec    1.00     15.6±0.50ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.03      4.0±0.26ms     4.2 MB/sec    1.00      3.9±0.20ms     4.3 MB/sec
linter/all-rules/numpy/globals.py          1.01   507.1±34.80µs     5.8 MB/sec    1.00   500.2±27.49µs     5.9 MB/sec
linter/all-rules/pydantic/types.py         1.03      7.0±0.34ms     3.6 MB/sec    1.00      6.8±0.28ms     3.8 MB/sec
linter/default-rules/large/dataset.py      1.00      7.6±0.28ms     5.4 MB/sec    1.00      7.6±0.23ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1619.5±67.59µs    10.3 MB/sec    1.02  1645.2±78.43µs    10.1 MB/sec
linter/default-rules/numpy/globals.py      1.00   193.8±12.17µs    15.2 MB/sec    1.03   200.3±14.57µs    14.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.4±0.14ms     7.5 MB/sec    1.04      3.5±0.18ms     7.2 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.9±0.38ms     3.4 MB/sec    1.00     11.9±0.48ms     3.4 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.6±0.12ms     6.4 MB/sec    1.01      2.6±0.10ms     6.4 MB/sec
formatter/numpy/globals.py                 1.00   293.6±19.61µs    10.1 MB/sec    1.01   296.5±18.84µs    10.0 MB/sec
formatter/pydantic/types.py                1.00      5.5±0.26ms     4.6 MB/sec    1.04      5.8±0.28ms     4.4 MB/sec
linter/all-rules/large/dataset.py          1.01     20.5±0.66ms  2031.6 KB/sec    1.00     20.2±0.55ms     2.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.4±0.29ms     3.1 MB/sec    1.00      5.3±0.18ms     3.1 MB/sec
linter/all-rules/numpy/globals.py          1.00   654.2±44.01µs     4.5 MB/sec    1.01   663.5±36.00µs     4.4 MB/sec
linter/all-rules/pydantic/types.py         1.03      9.2±0.39ms     2.8 MB/sec    1.00      8.9±0.31ms     2.9 MB/sec
linter/default-rules/large/dataset.py      1.01     10.4±0.50ms     3.9 MB/sec    1.00     10.3±0.30ms     3.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.2±0.11ms     7.6 MB/sec    1.03      2.3±0.09ms     7.4 MB/sec
linter/default-rules/numpy/globals.py      1.00   253.7±17.24µs    11.6 MB/sec    1.03   261.8±15.93µs    11.3 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.5±0.21ms     5.6 MB/sec    1.02      4.6±0.17ms     5.5 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/unnecessary_literal_union.rs</code>:12 on 2023-07-06 19:40</div>
            <div class="timeline-body"><p>Annoyingly, we try to wrap these at 80 characters so that they stick to that maximum width when rendered in the terminal :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi</code>:73 on 2023-07-06 19:41</div>
            <div class="timeline-body"><p>Nit: extra backtick here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/unnecessary_literal_union.rs</code>:62 on 2023-07-06 19:43</div>
            <div class="timeline-body"><p>Nit: consider renaming <code>m</code> to <code>member</code> here for explicitness? We tend to avoid single-variable names outside of (e.g.) indexes, but it's obviously not a blocker, up to your discretion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/snapshots/ruff__rules__flake8_pyi__tests__PYI030_PYI030.pyi.snap</code>:171 on 2023-07-06 19:45</div>
            <div class="timeline-body"><p>Notice here how we're flagging line 42 three times. I think we need to apply the same guards that we apply to the <code>duplicate_union_member</code> call in <code>ast/mod.rs</code>: if the parent of the current expression is an <code>|</code>, avoid running the rule, since we'll already have analyzed the current expression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-06 19:45</div>
            <div class="timeline-body"><p>Looking good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-07-06 21:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/rules/flake8_pyi/snapshots/ruff__rules__flake8_pyi__tests__PYI030_PYI030.pyi.snap</code>:171 on 2023-07-06 21:06</div>
            <div class="timeline-body"><p>I've just noticed this and was about to do some investigation.</p>
<p>I'm guessing that's the purpose of this uncommented code for the similar rule?</p>
<p>https://github.com/charliermarsh/ruff/blob/9c7194aa83dd8cf6e6dbb59c89f4524f063ba848/crates/ruff/src/checkers/ast/mod.rs#L3144-L3152</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-06 21:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/snapshots/ruff__rules__flake8_pyi__tests__PYI030_PYI030.pyi.snap</code>:171 on 2023-07-06 21:09</div>
            <div class="timeline-body"><p>Yup exactly -- it checks if we're in a child of one of the expressions we <em>presumedly</em> already visited.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-07-06 21:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/unnecessary_literal_union.rs</code>:78 on 2023-07-06 21:37</div>
            <div class="timeline-body"><p>In a follow-up, we can probably use this in PYI016 (https://github.com/astral-sh/ruff/pull/3922) and fix support for <code>typing.Union</code> there</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/rules/flake8_pyi/snapshots/ruff__rules__flake8_pyi__tests__PYI030_PYI030.pyi.snap</code>:154 on 2023-07-06 21:38</div>
            <div class="timeline-body"><p>We should probably avoid emitting this but I'm hesitant to add a hash map alongside the vector used to display items in the correct order.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-07-06 21:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-07-06 21:43</div>
            <div class="timeline-body"><p>Airflow example https://github.com/apache/airflow/blob/358e6e8fa18166084fc17b23e75c6c29a37f245f/airflow/cli/commands/task_command.py#L72</p>
<p>Bokeh example https://github.com/bokeh/bokeh/blob/ee3f7f27fb744860763edd1d44fcac9b797e36b4/src/bokeh/core/serialization.py#L148</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-07-06 22:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/rules/flake8_pyi/snapshots/ruff__rules__flake8_pyi__tests__PYI030_PYI030.pyi.snap</code>:171 on 2023-07-06 22:22</div>
            <div class="timeline-body"><p>Needed https://github.com/astral-sh/ruff/pull/5570/commits/1759d914456b62dfc479518ce8717949935f6c87 as well</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2023-07-06 22:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:3154 on 2023-07-06 22:27</div>
            <div class="timeline-body"><p>We may want to add these (<code>&amp;&amp; self.semantic.in_type_definition()</code>) to the <code>Rule::UnnecessaryLiteralUnion</code> condition too. I can't quite remember why they're necessary here. I'm guessing it's because for <code>|</code>, if it's used outside of a type definition, it's not a union operator (it's a bitwise or, I think).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-06 22:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-06 22:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/unnecessary_literal_union.rs</code>:21 on 2023-07-06 22:27</div>
            <div class="timeline-body"><p>Nit: maybe <code>from typing import Literal</code> on these for completeness in the examples?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-07-06 22:28</div>
            <div class="timeline-body"><p>Note we could implement auto-fix for this but it seems painful given the enumerated edge-cases in the test file. We can pursue it at a later time if requested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-07-06 22:29</div>
            <div class="timeline-body"><p>LGTM! Couple small comments, address at your discretion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:3154 on 2023-07-06 22:31</div>
            <div class="timeline-body"><p>That's true for the <code>DuplicateUnionMember</code> rule where they're checking for <em>any</em> duplicate items in a <code>|</code> but here we know we are constrained to literal types where this does apply.</p>
<p>We test for this at</p>
<p>https://github.com/charliermarsh/ruff/blob/1759d914456b62dfc479518ce8717949935f6c87/crates/ruff/resources/test/fixtures/flake8_pyi/PYI030.pyi#L28</p>
<p>You can see that a bitwise or of literals resolve to a <code>Union</code> outside of an annotation:</p>
<pre><code>In [3]: Literal[1] | Literal[2]
Out[3]: typing.Union[typing.Literal[1], typing.Literal[2]]

In [4]: x = Literal[1] | Literal[2]

In [5]: x
Out[5]: typing.Union[typing.Literal[1], typing.Literal[2]]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-07-06 22:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-07-06 22:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:3154 on 2023-07-06 22:33</div>
            <div class="timeline-body"><p>I guess it's possible that someone has <code>Literal[1] | bar | Literal[2]</code> where <code>bar</code> implements some sort of custom bitwise or behavior and this rule no longer holds but I'm not sure that's worth handling</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:3154 on 2023-07-06 22:34</div>
            <div class="timeline-body"><p>Interesting, that makes sense. Thanks for the thorough follow-up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-06 22:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-07-06 22:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:2201 on 2023-07-07 09:32</div>
            <div class="timeline-body"><p>Nit: I think this may work</p>
<pre><code class="language-suggestion">                    if let Some(Expr::Subscript(ast::ExprSubscript { value, .. })) = self.semantic.expr_parent()
                         !self.semantic.match_typing_expr(value, &quot;Union&quot;)
                    } else {
                   	false
                    } {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:3177 on 2023-07-07 09:33</div>
            <div class="timeline-body"><p>I think you can flatten this by using the <code>matches</code> directly on the <code>expr_parent</code></p>
<pre><code class="language-suggestion">                        &amp;&amp; matches!(self.semantic.expr_parent(), Some(Expr::BinOp(ast::ExprBinOp { op: Operator::BitOr,                                    .. })
</code></pre>
<p>... I've probably messed up the parentheses but you get the idea ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/unnecessary_literal_union.rs</code>:46 on 2023-07-07 09:36</div>
            <div class="timeline-body"><p>We may want to consider using a <code>SmallVec</code> e.g. with a size of <code>1</code> to avoid allocating a <code>Vec</code> on the heap for all <em>proper</em> literal union usages</p>
<p>https://docs.rs/smallvec/latest/smallvec/struct.SmallVec.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-07 09:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2023-07-07 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-07-07 16:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:58:34 UTC
    </footer>
</body>
</html>
