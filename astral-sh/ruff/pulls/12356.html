<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] better docs for type inference - astral-sh/ruff #12356</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] better docs for type inference</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12356">#12356</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2024-07-17 03:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>Add some docs for how type inference works.</p>
<p>Also a couple minor code changes to rearrange or rename for better clarity.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/carljm">@carljm</a> on 2024-07-17 03:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/carljm">@carljm</a> on 2024-07-17 03:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-07-17 03:19</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-17 06:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:5 on 2024-07-17 06:14</div>
            <div class="timeline-body"><p>I&#x27;m not sure if it&#x27;s worth mentioning. I&#x27;ll leave it up to you. But scope level inference is also need for the expression&#x27;s <code>HasTy</code> implementation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:141 on 2024-07-17 06:16</div>
            <div class="timeline-body"><pre><code>/// The `finish` method calls [`infer_region`](TypeInferenceBuilder::infer_region), which delegates to one of `infer_region_scope`,
</code></pre>
<p>Or is this not possible because the method is <code>pub(crate)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:151 on 2024-07-17 06:16</div>
            <div class="timeline-body"><pre><code>/// the semantic index and call the [`infer_definition_types`] query on it, which creates another
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:152 on 2024-07-17 06:17</div>
            <div class="timeline-body"><pre><code>/// [`TypeInferenceBuilder`] just for that definition, and we merge the returned [`TypeInference`]
</code></pre>
<p>Sorry for being pedantic. I don&#x27;t find it that important that these are links. My main motivation is that some IDEs are capable of updating docs when renaming a symbol (and <code>cargo doc</code> will fail if we missed renaming a reference in the documentation)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:164 on 2024-07-17 06:18</div>
            <div class="timeline-body"><pre><code>/// [`Definition`] for that function in the semantic index and calls [`infer_definition_types`] on
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:165 on 2024-07-17 06:19</div>
            <div class="timeline-body"><pre><code>/// it, which will create a new [`TypeInferenceBuilder`] with `InferenceRegion::Definition`, and in
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-07-17 06:19</div>
            <div class="timeline-body"><p>Thanks. That&#x27;s very helpful documentation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-07-17 06:52</div>
            <div class="timeline-body"><p>Thanks, will look at adding these links tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-07-17 18:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:141 on 2024-07-17 18:34</div>
            <div class="timeline-body"><p>Seems to work fine. I learned a bit about rustdoc and discovered that in order to get it to actually render or even validate these docs I need <code>cargo doc -p red_knot_python_semantic --document-private-items</code> (the latter flag needed because this entire <code>infer</code> module is private).</p>
<p>This means that CI currently won&#x27;t catch any warnings in these docs, because it doesn&#x27;t build with <code>--document-private-items</code>. If we are writing these docs mostly for our own maintenance reasons anyway, maybe we should change that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-07-17 19:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:141 on 2024-07-17 19:00</div>
            <div class="timeline-body"><p>I opened <a href="https://github.com/astral-sh/ruff/issues/12372">astral-sh/ruff#12372</a> because it feels odd to be caring about rustdoc syntax in doc comments that our CI currently doesn&#x27;t validate at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-07-17 19:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:151 on 2024-07-17 19:14</div>
            <div class="timeline-body"><p>FWIW rustdoc requires this to be <code>[`infer_definition_types()`]</code> (with the parens), because Salsa&#x27;s macros create both a struct and a function by this name, and the link must disambiguate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-07-17 19:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:152 on 2024-07-17 19:17</div>
            <div class="timeline-body"><blockquote>
<p>cargo doc will fail if we missed renaming a reference in the documentation</p>
</blockquote>
<p>That seems like a good enough motivation to me! But we don&#x27;t get that benefit on any doc comment on a private item (and this entire module is private), unless we fix <a href="https://github.com/astral-sh/ruff/issues/12372">astral-sh/ruff#12372</a> first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/carljm">@carljm</a> on 2024-07-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2024-07-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-17 20:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:05:17 UTC
    </footer>
</body>
</html>
