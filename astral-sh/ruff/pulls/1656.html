<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add proc-macro to derive `CheckCodePrefix` - astral-sh/ruff #1656</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add proc-macro to derive <code>CheckCodePrefix</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1656">#1656</a>
        opened by <a href="https://github.com/messense">@messense</a>
        on 2023-01-05 06:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/messense">@messense</a></div>
            <div class="timeline-body"><p>IMO a derive macro is a natural way to generate new code, and it reduces the chance of merge conflicts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 16:37</div>
            <div class="timeline-body"><p>Yeah this makes a lot of sense, thank you. My main critique of macros like this is that they hurt the IDE experience, since (e.g.) <code>CheckCodePrefix</code> will no longer autocomplete in the editor... But this does seem more natural, and it also solves some of the bootstrapping problems that we have today, whereby we can't reference check code prefixes before generating them, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-05 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-05 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 16:39</div>
            <div class="timeline-body"><p>(Nice work.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-01-05 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-06 05:22</div>
            <div class="timeline-body"><blockquote>
<p>My main critique of macros like this is that they hurt the IDE experience, since (e.g.) CheckCodePrefix will no longer autocomplete in the editor...</p>
</blockquote>
<p>Autocompletion works fine for me using rust-analyzer, which has <a href="https://rust-analyzer.github.io/manual.html#rust-analyzer.procMacro.enable"><code>rust-analyzer.procMacro.enable</code></a> enabled by default. Are you using another language server for rust? I highly recommend rust-analyzer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2023-01-06 05:43</div>
            <div class="timeline-body"><p>I think intellij-rust also works fine with derive macros now: https://github.com/intellij-rust/intellij-rust/issues/6908</p>
<blockquote>
<p><code>org.rust.macros.proc.derive</code> - enables expansion of <a href="https://doc.rust-lang.org/reference/procedural-macros.html#derive-macros">derive</a> procedural macros. Enabled by default</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 12:25</div>
            <div class="timeline-body"><p>I use IntelliJ, for me I still don't see expansion unfortunately:</p>
<img width="758" alt="Screen Shot 2023-01-06 at 7 23 01 AM" src="https://user-images.githubusercontent.com/1309177/211012300-ea6c12e1-0977-4763-aae6-06a6e90d2d49.png">

<img width="235" alt="Screen Shot 2023-01-06 at 7 23 08 AM" src="https://user-images.githubusercontent.com/1309177/211012308-436b08c4-36a6-4580-b6df-43c0d0c9f089.png">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/messense">@messense</a> on 2023-01-06 12:30</div>
            <div class="timeline-body"><p>That's odd, it works for me in CLion, maybe you need to enable the <code>Expand macros</code> option</p>
<img width="790" alt="image" src="https://user-images.githubusercontent.com/1556054/211012936-de5b4695-0bb7-4ddd-a77d-e6f43d77521b.png">

<img width="982" alt="image" src="https://user-images.githubusercontent.com/1556054/211012950-871c6775-2cc5-45f5-9bcc-1f241c947a42.png">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 12:36</div>
            <div class="timeline-body"><p>I think I had to enable some more stuff in &quot;Experimental features&quot; -- looks like it's working now! Amazing! Thanks both!</p>
<img width="595" alt="Screen Shot 2023-01-06 at 7 36 01 AM" src="https://user-images.githubusercontent.com/1309177/211013818-8fea72cd-0b1c-4239-b311-1fcfadd829a0.png">

</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:24 UTC
    </footer>
</body>
</html>
