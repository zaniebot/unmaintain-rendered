<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-simplify`] Correct behavior for `str.split`/`rsplit` with `maxsplit=0` (`SIM905`) - astral-sh/ruff #18075</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-simplify</code>] Correct behavior for <code>str.split</code>/<code>rsplit</code> with <code>maxsplit=0</code> (<code>SIM905</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18075">#18075</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-05-13 18:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/danparizher">@danparizher</a> on 2025-05-13 18:29</div>
            <div class="timeline-body"><p>Fixes #18069</p>
<!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR addresses a bug in the <code>flake8-simplify</code> rule <code>SIM905</code> (split-static-string) where <code>str.split(maxsplit=0)</code> and <code>str.rsplit(maxsplit=0)</code> produced incorrect results for empty strings or strings starting/ending with whitespace. The fix ensures that the linting rule's suggested replacements now align with Python's native behavior for these specific <code>maxsplit=0</code> scenarios.</p>
<h2>Test Plan</h2>
<ol>
<li>Added new test cases to the existing <code>crates/ruff_linter/resources/test/fixtures/flake8_simplify/SIM905.py</code> fixture to cover the scenarios described in issue #18069.</li>
<li>Ran <code>cargo test -p ruff_linter</code>.</li>
<li>Verified and accepted the updated snapshots for <code>SIM905.py</code> using <code>cargo insta review</code>. The new snapshots confirm the corrected behavior for <code>maxsplit=0</code>.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-13 18:35</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-05-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-05-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/split_static_string.rs</code>:195 on 2025-05-14 16:39</div>
            <div class="timeline-body"><p>Can we just use the Rust <code>trim_start</code> and <code>trim_end</code> methods here:</p>
<pre><code class="language-suggestion">                let processed_str = if direction == Direction::Left {                               
                    string_val.trim_start()                                                         
                } else {                                                                            
                    string_val.trim_end()                                                           
                };                                                     
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/split_static_string.rs</code>:176 on 2025-05-14 16:40</div>
            <div class="timeline-body"><p>This is actually the exact implementation of <a href="https://doc.rust-lang.org/src/core/str/mod.rs.html#2125"><code>trim</code></a> ðŸ™‚</p>
<pre><code class="language-suggestion">                .trim()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_simplify/rules/split_static_string.rs</code>:195 on 2025-05-14 16:46</div>
            <div class="timeline-body"><p>With this, I think we can flatten the whole <code>match</code> arm to something like this:</p>
<pre><code class="language-rust">            let processed_str = if direction == Direction::Left {
                string_val.trim_start()
            } else {
                string_val.trim_end()
            };
            let list_items: &amp;[_] = if processed_str.is_empty() {
                &amp;[]
            } else {
                &amp;[processed_str]
            };
            Some(construct_replacement(
                list_items,
                str_value.first_literal_flags(),
            ))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-05-14 16:55</div>
            <div class="timeline-body"><p>Thanks! Just a couple of simplification suggestions, but the logic looks great to me. And thanks for all of the test cases!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danparizher">@danparizher</a> on 2025-05-14 17:55</div>
            <div class="timeline-body"><p>Thanks for the review! This is definitely a lot better. I can also work on the logic for #18101 and include it in this PR as well. Let me know if that makes the most sense!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 18:16</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the review! This is definitely a lot better. I can also work on the logic for #18101 and include it in this PR as well. Let me know if that makes the most sense!</p>
</blockquote>
<p>No problem, thanks for handling the suggestions!</p>
<p>I think we can hold off on #18101 for now. I went ahead and put SIM905 in the title since that's the rule I tested, but I think it's likely more widespread, and we might be able to handle it generally rather than in each individual rule (at least I hope so!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-05-14 18:18</div>
            <div class="timeline-body"><p>Great, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-simplify`]: Correct behavior for str.split/rsplit with maxsplit=0 (`SIM905`)" to "[`flake8-simplify`] Correct behavior for `str.split/rsplit` with `maxsplit=0` (`SIM905`)" by @ntBre on 2025-05-14 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-simplify`] Correct behavior for `str.split/rsplit` with `maxsplit=0` (`SIM905`)" to "[`flake8-simplify`] Correct behavior for `str.split`/`rsplit` with `maxsplit=0` (`SIM905`)" by @ntBre on 2025-05-14 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-05-14 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-05-14 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-14 18:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:51:28 UTC
    </footer>
</body>
</html>
