<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve responsiveness when invoked via Python - astral-sh/ruff #9315</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve responsiveness when invoked via Python</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9315">#9315</a>
        opened by <a href="https://github.com/ofek">@ofek</a>
        on 2023-12-29 20:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ofek">@ofek</a></div>
            <div class="timeline-body"><p>This saves a handful of milliseconds on Windows and even more on other platforms when running <code>python -m ruff</code>. On non-Windows systems the process is replaced directly (impossible on Windows unfortunately).</p>
<pre><code>❯ docker run --rm python:3.11 bash -c &quot;for i in {1..15}; do python -m timeit -n 1 -r 1 &#x27;from pathlib import Path&#x27;; done&quot;
1 loop, best of 1: 25.7 msec per loop
1 loop, best of 1: 3.07 msec per loop
1 loop, best of 1: 3.16 msec per loop
1 loop, best of 1: 3.06 msec per loop
1 loop, best of 1: 3.32 msec per loop
1 loop, best of 1: 3.93 msec per loop
1 loop, best of 1: 3.26 msec per loop
1 loop, best of 1: 3.73 msec per loop
1 loop, best of 1: 3.1 msec per loop
1 loop, best of 1: 3.29 msec per loop
1 loop, best of 1: 3.12 msec per loop
1 loop, best of 1: 3.05 msec per loop
1 loop, best of 1: 3.04 msec per loop
1 loop, best of 1: 3.19 msec per loop
1 loop, best of 1: 3.04 msec per loop

❯ docker run --rm python:3.11 bash -c &quot;for i in {1..15}; do python -m timeit -n 1 -r 1 &#x27;import subprocess&#x27;; done&quot;
1 loop, best of 1: 31.2 msec per loop
1 loop, best of 1: 3.75 msec per loop
1 loop, best of 1: 4.71 msec per loop
1 loop, best of 1: 3.88 msec per loop
1 loop, best of 1: 4.08 msec per loop
1 loop, best of 1: 4.35 msec per loop
1 loop, best of 1: 3.94 msec per loop
1 loop, best of 1: 4.06 msec per loop
1 loop, best of 1: 3.88 msec per loop
1 loop, best of 1: 3.85 msec per loop
1 loop, best of 1: 3.84 msec per loop
1 loop, best of 1: 4.01 msec per loop
1 loop, best of 1: 4.21 msec per loop
1 loop, best of 1: 4.07 msec per loop
1 loop, best of 1: 4.11 msec per loop

❯ python -m timeit -n 1 -r 1 &quot;from pathlib import Path&quot;
1 loop, best of 1: 5.25 msec per loop

❯ python -m timeit -n 1 -r 1 &quot;import subprocess&quot;
1 loop, best of 1: 7.61 msec per loop
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ofek">@ofek</a> reviewed on 2023-12-29 20:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ofek">@ofek</a> on <code>python/ruff/__main__.py</code>:4 on 2023-12-29 20:41</div>
            <div class="timeline-body"><pre><code>

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-12-29 20:42</div>
            <div class="timeline-body"><p>Hey :)</p>
<p>Can you show the performance changes for invoking Ruff itself rather than microbenchmarks of the import? It&#x27;s hard to tell if these changes are worthwhile in our use-case. I generally prefer the readability of undeferred imports and use of <code>Path</code> when it&#x27;s not critical.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2023-12-29 20:47</div>
            <div class="timeline-body"><pre><code>❯ hyperfine -m 10 --warmup 1 &quot;python -m ruff --help&quot;
Benchmark 1: python -m ruff --help
  Time (mean ± σ):      78.3 ms ±   1.8 ms    [User: 0.0 ms, System: 0.0 ms]
  Range (min … max):    75.7 ms …  83.3 ms    34 runs

❯ hyperfine -m 10 --warmup 1 &quot;python -m ruff --help&quot;
Benchmark 1: python -m ruff --help
  Time (mean ± σ):      73.4 ms ±   1.0 ms    [User: 0.0 ms, System: 1.2 ms]
  Range (min … max):    71.7 ms …  75.7 ms    36 runs
</code></pre>
<p>I can&#x27;t easily test right now in Docker, these are on my Windows machine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-12-29 20:57</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-12-29 22:21</div>
            <div class="timeline-body"><p>This seems reasonable to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-29 22:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-31 12:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-31 12:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-31 16:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:00:18 UTC
    </footer>
</body>
</html>
