<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Refresh diagnostics when changing related files - astral-sh/ruff #17350</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Refresh diagnostics when changing related files</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17350">#17350</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-04-11 12:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-11 12:47</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Given:</p>
<p><code>main.py</code>:</p>
<pre><code class="language-py">from foo import Foo
</code></pre>
<p><code>foo.py</code></p>
<pre><code class="language-py">class Fo: ...
</code></pre>
<p>Red Knot reports an unresolved import diagnostic in <code>main.py</code> because <code>foo</code> doesn't export <code>Foo</code>.
Renaming the class <code>Fo</code> in <code>foo.py</code> to <code>Foo</code> should refresh the diagnsotics in <code>main.py</code>.</p>
<p>It turns out, that this is a fairly easy change. All that was necessary is to set <code>inter_file_dependencies</code> in the server registration options to true.</p>
<p>We'll need a different solution for publish diagnostics but Red Knot doesn't yet support publish diagnostics (https://github.com/astral-sh/ty/issues/79)</p>
<h2>Test Plan</h2>
<p>https://github.com/user-attachments/assets/7f54e675-919d-421d-b646-85fc96504ad2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-04-11 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @MichaReiser on 2025-04-11 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @MichaReiser on 2025-04-11 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @MichaReiser on 2025-04-11 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @MichaReiser on 2025-04-11 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @MichaReiser on 2025-04-11 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-11 12:49</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Enable inter-file-dependencies" to "[red-knot] Refresh diagnostics when changing related files" by @MichaReiser on 2025-04-11 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-04-11 13:49</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-04-11 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-04-11 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-11 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-11 13:54</div>
            <div class="timeline-body"><blockquote>
<p>We'll need a different solution for publish diagnostics but Red Knot doesn't yet support publish diagnostics</p>
</blockquote>
<p>Yeah, I think we might need to keep track of the diagnostic dependencies ourselves in that case and if any of the dependent file changes, we'll need to refresh the diagnostics for the parent files. This might also become useful and required for caching diagnostics on the server side.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-11 14:03</div>
            <div class="timeline-body"><blockquote>
<p>Yeah, I think we might need to keep track of the diagnostic dependencies ourselves in that case and if any of the dependent file changes, we'll need to refresh the diagnostics for the parent files. This might also become useful and required for caching diagnostics on the server side.</p>
</blockquote>
<p>Yeah, I'm not sure how that would work because we have no way of asking: What files does file X depend on. Only including its direct dependencies isn't good enough. We might have to publish all diagnostics eagerly. I wanted to look into how r-a does that.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:33:28 UTC
    </footer>
</body>
</html>
