<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Support extending `__all__` from an imported module even when the module is not an `ExprName` node - astral-sh/ruff #17947</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Support extending <code>__all__</code> from an imported module even when the module is not an <code>ExprName</code> node</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17947">#17947</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-05-08 12:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-08 12:14</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This tweaks our <code>__all__</code> resolution logic so that patterns such as <code>__all__.extend(module.sub.sub.__all__)</code> are suppported (where the type of <code>module.sub.sub</code> is resolved as being a <code>ModuleLiteral</code>).</p>
<p>It seems like this doesn't have any impact on any mypy_primer projects, but it simplifies the code, is neutral on the benchmarks, and seems like a pretty reasonable pattern to support.</p>
<h2>Test Plan</h2>
<p>added an mdtest that fails on <code>main</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-05-08 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-08 12:17</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-05-08 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @AlexWaygood on 2025-05-08 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AlexWaygood on 2025-05-08 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-05-08 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-05-08 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-05-08 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Call into type inference more when resolving `__all__` (v2)" to "[ty] Support extending `__all__` from an imported module even when the module is not an `ExprName` node" by @AlexWaygood on 2025-05-08 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/dunder_all.rs</code>:112 on 2025-05-08 16:30</div>
            <div class="timeline-body"><p>This makes me quite nervous about the increased potential for cycles (and performance regression), if we require inferring types for an entire scope in order to resolve <code>__all__</code> in that scope. Would it be possible to instead mark these as standalone expressions in semantic index building, given that the pattern for recognizing these cases is static based on AST shape and doesn't itself require type inference?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-05-08 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-08 21:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/dunder_all.rs</code>:112 on 2025-05-08 21:02</div>
            <div class="timeline-body"><p>SGTM!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-08 21:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/dunder_all.rs</code>:112 on 2025-05-08 21:59</div>
            <div class="timeline-body"><p>Is https://github.com/astral-sh/ruff/pull/17947/commits/f6cb54969a5a13e242d7c2a9757b33caa196db3a what you were thinking of?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-05-08 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:5513 on 2025-05-08 22:47</div>
            <div class="timeline-body"><p>Ah yeah, I hadn't thought of this consequence; but this seems like a pretty good way to handle it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-05-08 22:48</div>
            <div class="timeline-body"><p>Yes, looks good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-05-08 22:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-05-08 22:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-08 22:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:57:30 UTC
    </footer>
</body>
</html>
