<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update `ty version` to use parent Git repository information - astral-sh/ruff #17866</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Update <code>ty version</code> to use parent Git repository information</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17866">#17866</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-05-05 18:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-05 18:01</div>
            <div class="timeline-body"><p>Currently, <code>ty version</code> pulls its information from the Ruff repository — but we want this to pull from the repository in the directory <em>above</em> when Ruff is a submodule.</p>
<p>I tested this in the <code>ty</code> repository after tagging an arbitrary commit:</p>
<pre><code>❯ uv run --refresh-package ty --reinstall-package ty ty version
      Built ty @ file:///Users/zb/workspace/ty
Uninstalled 1 package in 2ms
Installed 1 package in 1ms
ty 0.0.0+3 (34253b1d4 2025-05-05)
</code></pre>
<p>We also use the last Git tag as the source of truth for the version, instead of the crate version. However, we'll need a way to set the version for releases still, as the tag is published <em>after</em> the build. We can either tag early (without pushing the tag to the remote), or add another environment variable. (<strong>Note, this approach is changed in a follow-up. See https://github.com/astral-sh/ruff/pull/17868</strong>)</p>
<p>From this repository, the version will be <code>unknown</code>:</p>
<pre><code>❯ cargo run -q --bin ty -- version
ty unknown
</code></pre>
<p>We could add special handling like... <code>ty unknown (ruff@...)</code> but I see that as a secondary goal.</p>
<p>Closes https://github.com/astral-sh/ty/issues/5</p>
<p>The reviewer situation in this repository is unhinged, cc @Gankra and @MichaReiser for review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @zanieb on 2025-05-05 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-05 18:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ty/build.rs</code>:52 on 2025-05-05 18:05</div>
            <div class="timeline-body"><p>Apparently a bare <code>describe</code> only works for annotated tags? This works for unannotated tags too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2025-05-05 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @zanieb on 2025-05-05 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @zanieb on 2025-05-05 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @zanieb on 2025-05-05 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @zanieb on 2025-05-05 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @zanieb on 2025-05-05 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-05 20:44</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-05-05 21:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @MichaReiser on 2025-05-06 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @MichaReiser on 2025-05-06 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @MichaReiser on 2025-05-06 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @MichaReiser on 2025-05-06 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-05-06 07:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-05-06 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-05-06 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-06 12:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:57:30 UTC
    </footer>
</body>
</html>
