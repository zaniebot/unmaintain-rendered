<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Fix For format --check --slient not respect --silent flag - astral-sh/ruff #17736</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Fix For format --check --slient not respect --silent flag</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17736">#17736</a>
        opened by <a href="https://github.com/Kalmaegi">@Kalmaegi</a>
        on 2025-04-30 11:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-30 11:13</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>FIx for: #17729</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-30 11:19</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-30 11:26</div>
            <div class="timeline-body"><p>I'll fix the formatting later</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-30 12:08</div>
            <div class="timeline-body"><p>Looks good. Could you add a test plan demonstrating that the fix works as expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @ntBre on 2025-04-30 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on 2025-04-30 13:10</div>
            <div class="timeline-body"><blockquote>
<p>Looks good. Could you add a test plan demonstrating that the fix works as expected?</p>
</blockquote>
<p>Sure, I will add test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 06:19</div>
            <div class="timeline-body"><p>We should compare the behavior with <code>ruff check</code> but I think <code>ruff check</code> still writes the diagnostics (the diff) when <code>--quiet</code> is used. I'm not sure what it does for <code>--silent</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-01 06:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-01 07:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 07:01</div>
            <div class="timeline-body"><p>Oh, I didn't notice that. I'll continue to look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-01 15:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 15:25</div>
            <div class="timeline-body"><blockquote>
<p>We should compare the behavior with <code>ruff check</code> but I think <code>ruff check</code> still writes the diagnostics (the diff) when <code>--quiet</code> is used. I'm not sure what it does for <code>--silent</code>.</p>
</blockquote>
<p>@MichaReiser I would like to humbly ask a small question. Currently, when I run both &quot;format check --quiet&quot; and &quot;format check --silent&quot; commands, neither produces any output. Could you kindly clarify what specific scenario you were referring to? As I'm not entirely familiar with this particular issue, thank you very much for your assistance!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-01 16:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 16:07</div>
            <div class="timeline-body"><p>I think that <code>ruff format --check -q</code> should show the diffs. Can you test what <code>ruff check -q</code> does (and silent to that matter)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-01 16:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 16:26</div>
            <div class="timeline-body"><p>Here is the content of my test Python file. I ran the following two commands, and neither of them produced any output. However, I'm not entirely sure if my setup/context is correct XD.</p>
<pre><code class="language-python">def    foo(x):
    return      x

y: int = foo(1)
</code></pre>
<p><img src="https://github.com/user-attachments/assets/3cc33529-04c8-4e57-bbfb-7790290a4bf8" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-01 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 16:28</div>
            <div class="timeline-body"><blockquote>
<p>Here is the content of my test Python file. I ran the following two commands, and neither of them produced any output. However, I'm not entirely sure if my setup/context is correct XD.</p>
<pre><code class="language-python">def    foo(x):
    return      x

y: int = foo(1)
</code></pre>
<p><img src="https://private-user-images.githubusercontent.com/17105034/439653906-3cc33529-04c8-4e57-bbfb-7790290a4bf8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDYxMTcxMzgsIm5iZiI6MTc0NjExNjgzOCwicGF0aCI6Ii8xNzEwNTAzNC80Mzk2NTM5MDYtM2NjMzM1MjktMDRjOC00ZTU3LWJiZmItNzc5MDI5MGE0YmY4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA1MDElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNTAxVDE2MjcxOFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQxMDMwOWFkZDBjMjQ5YTQ1NmRmZjNhNDBiOWUxZWE1OTllYWE3MjJmYjNlYjdhZTI3ZDY1ZjM3YTgyYTgwNGEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.KF-8qIVVvdf3SkAHTCNBl5HEJxjJYRzeRYAQaflpZwM" alt="image" /></p>
</blockquote>
<p>If this is correct, I could add a test case for the &quot;quiet&quot; case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-01 16:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 16:41</div>
            <div class="timeline-body"><p>You need a file that produces at least one error when running <code>ruff check</code> without <code>-q</code>.</p>
<p>For example:</p>
<pre><code class="language-py">import os

# Define a function that takes an integer n and returns the nth number in the Fibonacci
# sequence.
def fibonacci(n):
    &quot;&quot;&quot;Compute the nth number in the Fibonacci sequence.&quot;&quot;&quot;
    x = 1
    if n == 0:
        return 0



        
    elif n == 1:
        return 1
    else:
        return fibonacci(n - 1) + fibonacci(n - 2)

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-01 16:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-01 16:49</div>
            <div class="timeline-body"><p>Thank you so much for your patience! My English is not very good and I‚Äôm still learning, so I often worry that I might misunderstand something. I‚Äôll make sure to review everything again carefully tomorrow. I really appreciate your help!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-02 04:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-02 04:50</div>
            <div class="timeline-body"><p><img src="https://github.com/user-attachments/assets/544a6385-f837-4065-ad39-4dcc9fc7a200" alt="image" />
I tested the code you provided, but it seems to have errors similar to those in my previous code. It needs to be formatted, and I'm not entirely sure if the workflow I followed this time was correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-02 06:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-02 06:10</div>
            <div class="timeline-body"><p>I tested <code>ruff check</code> with the given file and my findings are:</p>
<ul>
<li>The diagnostics are still printed when using <code>-q</code></li>
<li>The diagnostis are omitted when using <code>--silent</code></li>
</ul>
<p>We should do the same for <code>format --check</code></p>
<ul>
<li>Show the diff for <code>-q</code></li>
<li>Hide the diff for <code>--silent</code></li>
</ul>
<pre><code class="language-bash">‚ùØ uvx ruff check --no-cache simple.py -q
simple.py:1:1: I001 [*] Import block is un-sorted or un-formatted
  |
1 | import os
  | ^^^^^^^^^ I001
2 |
3 | # Define a function that takes an integer n and returns the nth number in the Fibonacci
  |
  = help: Organize imports

simple.py:1:8: F401 [*] `os` imported but unused
  |
1 | import os
  |        ^^ F401
2 |
3 | # Define a function that takes an integer n and returns the nth number in the Fibonacci
  |
  = help: Remove unused import: `os`

simple.py:7:5: F841 Local variable `x` is assigned to but never used
  |
5 | def fibonacci(n):
6 |     &quot;&quot;&quot;Compute the nth number in the Fibonacci sequence.&quot;&quot;&quot;
7 |     x = 1
  |     ^ F841
8 |     if n == 0:
9 |         return 0
  |
  = help: Remove assignment to unused variable `x`

simple.py:13:1: W293 [*] Blank line contains whitespace
   |
13 |         
   | ^^^^^^^^ W293
14 |     elif n == 1:
15 |         return 1
   |
   = help: Remove whitespace from blank line

simple.py:14:5: RET505 [*] Unnecessary `elif` after `return` statement
   |
14 |     elif n == 1:
   |     ^^^^ RET505
15 |         return 1
16 |     else:
   |
   = help: Remove unnecessary `elif`


~/astral/test is üì¶ v0.0.1 via Óúò v22.14.0 via üêç v3.13.1 (test) 
‚ùØ uvx ruff check --no-cache simple.py --silent
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-02 06:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-02 06:59</div>
            <div class="timeline-body"><p>It seems I must have made a mistake somewhere. I'll take the time to learn how the check operates and carefully review my logic. Thank you once again for your help and guidance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kalmaegi">@Kalmaegi</a> on <code>crates/ruff/src/commands/format.rs</code>:203 on 2025-05-02 15:09</div>
            <div class="timeline-body"><p>I've identified the logic where check outputs nothing in silent mode, located at:
https://github.com/astral-sh/ruff/blob/ea3f4ac05996a636c8ba778dc96e0aea5deabd96/crates/ruff/src/printer.rs#L239-L241</p>
<p>Currently, we can modify the conditional checks at the following location:</p>
<pre><code class="language-rust">if config_arguments.log_level &gt; LogLevel::Silent{
    match mode {
        FormatMode::Write =&gt; {}
        FormatMode::Check =&gt; {
            results.write_changed(&amp;mut stdout().lock())?;
        }
        FormatMode::Diff =&gt; {
            results.write_diff(&amp;mut stdout().lock())?;
        }
    }
    if mode.is_diff() {
        // Allow piping the diff to e.g. a file by writing the summary to stderr
        results.write_summary(&amp;mut stderr().lock())?;
    } else {
        results.write_summary(&amp;mut stdout().lock())?;
    }
}
</code></pre>
<p>If the -s flag is provided, skip the output.</p>
<p>For the -q flag, our current logic might output messages like <code>Would reformat: xxx.py</code> but does not display the modified content.</p>
<p>I also reviewed the output behavior of <code>check</code>, and its output logic resides at:
https://github.com/astral-sh/ruff/blob/ea3f4ac05996a636c8ba778dc96e0aea5deabd96/crates/ruff/src/printer.rs#L277-L283</p>
<p><code>.with_show_source(self.format == OutputFormat::Full) </code>
However, by default, it outputs the <code>source </code>instead of the <code>diff</code>. For the <code>format check</code>, should we include the diff content in the output, or is it sufficient to retain the<code> Would reformat: xxx.py</code> messages? I‚Äôd appreciate your guidance on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kalmaegi">@Kalmaegi</a> reviewed on 2025-05-02 15:09</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:57:30 UTC
    </footer>
</body>
</html>
