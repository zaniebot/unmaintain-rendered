<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Extract `AIR312` from `AIR302` rules (`AIR302`, `AIR312`) - astral-sh/ruff #17152</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Extract <code>AIR312</code> from <code>AIR302</code> rules (<code>AIR302</code>, <code>AIR312</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17152">#17152</a>
        opened by <a href="https://github.com/Lee-W">@Lee-W</a>
        on 2025-04-02 14:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-02 14:34</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>As discussed in https://github.com/astral-sh/ruff/issues/14626#issuecomment-2766146129, we're to separate suggested changes from required changes.</p>
<p>The following symbols has been moved to AIR312 from AIR302. They still work in Airflow 3.0, but they're suggested to be changed as they're expected to be removed in future version</p>
<pre><code class="language-python">from airflow.hooks.filesystem import FSHook
from airflow.hooks.package_index import PackageIndexHook
from airflow.hooks.subprocess import (SubprocessHook, SubprocessResult, working_directory)
from airflow.operators.bash import BashOperator
from airflow.operators.datetime import BranchDateTimeOperator, target_times_as_dates
from airflow.operators.trigger_dagrun import TriggerDagRunLink, TriggerDagRunOperator
from airflow.operators.empty import EmptyOperator
from airflow.operators.latest_only import LatestOnlyOperator
from airflow.operators.python import (BranchPythonOperator, PythonOperator, PythonVirtualenvOperator, ShortCircuitOperator)
from airflow.operators.weekday import BranchDayOfWeekOperator
from airflow.sensors.date_time import DateTimeSensor, DateTimeSensorAsync
from airflow.sensors.external_task import ExternalTaskMarker, ExternalTaskSensor, ExternalTaskSensorLink
from airflow.sensors.filesystem import FileSensor
from airflow.sensors.time_sensor import TimeSensor, TimeSensorAsync
from airflow.sensors.time_delta import TimeDeltaSensor, TimeDeltaSensorAsync, WaitSensor
from airflow.sensors.weekday import DayOfWeekSensor
from airflow.triggers.external_task import DagStateTrigger, WorkflowTrigger
from airflow.triggers.file import FileTrigger
from airflow.triggers.temporal import DateTimeTrigger, TimeDeltaTrigger
</code></pre>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>The test fixture has been updated acccordingly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ntBre by @ntBre on 2025-04-03 22:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Extract suggested air changes" to "[airflow] Extract AIR312 from AIR302 rules (AIR302, AIR312)" by @Lee-W on 2025-04-08 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Lee-W on 2025-04-08 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-08 14:52</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+13 -6 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+13 -6 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/airflow-core/tests/unit/utils/test_dot_renderer.py#L103'>airflow-core/tests/unit/utils/test_dot_renderer.py:103:22:</a> AIR302 `airflow.operators.python.PythonOperator` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/airflow-core/tests/unit/utils/test_dot_renderer.py#L103'>airflow-core/tests/unit/utils/test_dot_renderer.py:103:22:</a> AIR312 `airflow.operators.python.PythonOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
- <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/airflow-core/tests/unit/utils/test_dot_renderer.py#L83'>airflow-core/tests/unit/utils/test_dot_renderer.py:83:22:</a> AIR302 `airflow.operators.python.PythonOperator` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/airflow-core/tests/unit/utils/test_dot_renderer.py#L83'>airflow-core/tests/unit/utils/test_dot_renderer.py:83:22:</a> AIR312 `airflow.operators.python.PythonOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
- <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/performance/src/performance_dags/performance_dag/performance_dag.py#L111'>performance/src/performance_dags/performance_dag/performance_dag.py:111:13:</a> AIR302 `airflow.operators.python.PythonOperator` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/performance/src/performance_dags/performance_dag/performance_dag.py#L111'>performance/src/performance_dags/performance_dag/performance_dag.py:111:13:</a> AIR312 `airflow.operators.python.PythonOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
- <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/performance/src/performance_dags/performance_dag/performance_dag.py#L95'>performance/src/performance_dags/performance_dag/performance_dag.py:95:13:</a> AIR302 `airflow.operators.bash.BashOperator` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/performance/src/performance_dags/performance_dag/performance_dag.py#L95'>performance/src/performance_dags/performance_dag/performance_dag.py:95:13:</a> AIR312 `airflow.operators.bash.BashOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
- <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/edge/src/airflow/providers/edge/example_dags/integration_test.py#L116'>providers/edge/src/airflow/providers/edge/example_dags/integration_test.py:116:24:</a> AIR302 `airflow.operators.bash.BashOperator` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/edge/src/airflow/providers/edge/example_dags/integration_test.py#L116'>providers/edge/src/airflow/providers/edge/example_dags/integration_test.py:116:24:</a> AIR312 `airflow.operators.bash.BashOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L162'>providers/tests/standard/utils/test_sensor_helper.py:162:17:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L166'>providers/tests/standard/utils/test_sensor_helper.py:166:21:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L194'>providers/tests/standard/utils/test_sensor_helper.py:194:21:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L224'>providers/tests/standard/utils/test_sensor_helper.py:224:13:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L257'>providers/tests/standard/utils/test_sensor_helper.py:257:13:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L313'>providers/tests/standard/utils/test_sensor_helper.py:313:17:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/tests/standard/utils/test_sensor_helper.py#L377'>providers/tests/standard/utils/test_sensor_helper.py:377:21:</a> AIR312 `airflow.operators.empty.EmptyOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
- <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/ydb/tests/system/ydb/example_ydb.py#L111'>providers/ydb/tests/system/ydb/example_ydb.py:111:23:</a> AIR302 `airflow.operators.python.PythonOperator` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/ad2e80d2997dc46ca175a39a0a8b8c216361323f/providers/ydb/tests/system/ydb/example_ydb.py#L111'>providers/ydb/tests/system/ydb/example_ydb.py:111:23:</a> AIR312 `airflow.operators.python.PythonOperator` is deprecated and moved into `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in a future version.
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| AIR312 | 13 | 13 | 0 | 0 | 0 |
| AIR302 | 6 | 0 | 6 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:754 on 2025-04-08 18:39</div>
            <div class="timeline-body"><p>I don't think <code>rustfmt</code> can handle the long <code>match</code> expressions very well, but I <em>think</em> it would usually do something more like this:</p>
<pre><code class="language-rust">[&quot;airflow&quot;, &quot;operators&quot;, &quot;dagrun_operator&quot;, rest @ (
    &quot;TriggerDagRunLink&quot;
    |&quot;TriggerDagRunOperator&quot;
)
</code></pre>
<p>with spaces around the <code>@</code> and the <code>|</code> on the next line.</p>
<p>Again, I'm not too worried about manually fixing all of these since <code>rustfmt</code> is missing them, but if you happen to notice them, it could be nice to fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/suggested_to_move_to_provider_in_3.rs</code>:13 on 2025-04-08 18:41</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// Checks for uses of Airflow functions and values that have been moved to its providers
/// but still have a compatibility layer (e.g., `apache-airflow-providers-standard`).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/suggested_to_move_to_provider_in_3.rs</code>:19 on 2025-04-08 18:43</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// they are expected to be removed in a future version. The user is suggested to install
/// the corresponding provider and replace the original usage with the one in the provider.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/suggested_to_move_to_provider_in_3.rs</code>:56 on 2025-04-08 18:47</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                         It still works in Airflow 3.0 but is expected to be removed in a future version.&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/suggested_to_move_to_provider_in_3.rs</code>:96 on 2025-04-08 18:50</div>
            <div class="timeline-body"><p><code>expr</code> and <code>ranged</code> refer to the same value, so I think you can avoid <code>ranged @</code> and just use <code>expr.range()</code> in the call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR312_AIR312.py.snap</code>:15 on 2025-04-08 18:52</div>
            <div class="timeline-body"><pre><code class="language-suggestion">AIR312.py:33:1: AIR312 `airflow.hooks.package_index.PackageIndexHook` is deprecated and moved into the `standard` provider in Airflow 3.0; It still works in Airflow 3.0 but is expected to be removed in future version.
</code></pre>
<p>I think this sounds better in this case, but it may not work for all of the provider names. Feel free to leave it out if not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-04-08 18:54</div>
            <div class="timeline-body"><p>Thanks! This looks good to me, just a few minor nits, mostly in the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-09 01:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:754 on 2025-04-09 01:53</div>
            <div class="timeline-body"><p>Will do! Thanks üôè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-09 01:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR312_AIR312.py.snap</code>:15 on 2025-04-09 01:55</div>
            <div class="timeline-body"><p>Looks good üôÇ let me update it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-09 02:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:754 on 2025-04-09 02:19</div>
            <div class="timeline-body"><p>just updated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-09 02:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/suggested_to_move_to_provider_in_3.rs</code>:96 on 2025-04-09 02:31</div>
            <div class="timeline-body"><p>Good catch! Just updated!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-04-09 14:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] Extract AIR312 from AIR302 rules (AIR302, AIR312)" to "[`airflow`] Extract `AIR312` from `AIR302` rules (`AIR302`, `AIR312`)" by @ntBre on 2025-04-09 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-04-09 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-04-09 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-04-09 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-04-09 14:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:41:06 UTC
    </footer>
</body>
</html>
