<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix sync-typeshed workflow timeouts - astral-sh/ruff #22090</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix sync-typeshed workflow timeouts</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22090">#22090</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-19 17:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>Our most recent typeshed-sync workflow failed, and failed again when I re-ran it: https://github.com/astral-sh/ruff/actions/runs/20216754532. The cause of the failure was that it took too long to build ty in the last stage, so the job timed out. Because the job timed out rather than an error occurring, there also wasn&#x27;t an issue created telling us that the typeshed sync failed.</p>
<p>This PR fixes the timeout by removing the part where we try to run ty&#x27;s tests from the workflow. This part was added in <a href="https://github.com/astral-sh/ruff/pull/20892">astral-sh/ruff#20892</a>, but it&#x27;s never worked as intended: <a href="https://github.com/astral-sh/ruff/pull/20892">astral-sh/ruff#20892</a>#issuecomment-3536537553. So we may as well remove it.</p>
<p>I also fixed the issue-creation logic so that an issue will be created whenever the outcome <code>!= &#x27;success&#x27;</code>, instead of an issue only being created when the outcome <code>== &#x27;failure&#x27;</code>. According to https://docs.github.com/en/actions/reference/workflows-and-actions/contexts#needs-context, <code>needs.&lt;job_id&gt;.result</code> could be <code>success</code>, <code>failure</code>, <code>cancelled</code>, or <code>skipped</code>.</p>
<p>Fixes <a href="https://github.com/astral-sh/ty/issues/1996">astral-sh/ty#1996</a></p>
Test Plan
<p>I&#x27;ll run the sync-typeshed workflow on this branch to test it: https://github.com/astral-sh/ruff/actions/runs/20378210302</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-12-19 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 18:08</div>
            <div class="timeline-body"><p>It worked: <a href="https://github.com/astral-sh/ruff/pull/22091">astral-sh/ruff#22091</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-19 18:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:21:58 UTC
    </footer>
</body>
</html>
