<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix sync-typeshed workflow timeouts - astral-sh/ruff #22090</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix sync-typeshed workflow timeouts</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22090">#22090</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-19 17:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 17:54</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Our most recent typeshed-sync workflow failed, and failed again when I re-ran it: https://github.com/astral-sh/ruff/actions/runs/20216754532. The cause of the failure was that it took too long to build ty in the last stage, so the job timed out. Because the job timed out rather than an error occurring, there also wasn't an issue created telling us that the typeshed sync failed.</p>
<p>This PR fixes the timeout by removing the part where we try to run ty's tests from the workflow. This part was added in https://github.com/astral-sh/ruff/pull/20892, but it's never worked as intended: https://github.com/astral-sh/ruff/pull/20892#issuecomment-3536537553. So we may as well remove it.</p>
<p>I also fixed the issue-creation logic so that an issue will be created whenever the outcome <code>!= 'success'</code>, instead of an issue only being created when the outcome <code>== 'failure'</code>. According to https://docs.github.com/en/actions/reference/workflows-and-actions/contexts#needs-context, <code>needs.&lt;job_id&gt;.result</code> could be <code>success</code>, <code>failure</code>, <code>cancelled</code>, or <code>skipped</code>.</p>
<p>Fixes https://github.com/astral-sh/ty/issues/1996</p>
<h2>Test Plan</h2>
<p>I'll run the sync-typeshed workflow on this branch to test it: https://github.com/astral-sh/ruff/actions/runs/20378210302</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by @AlexWaygood on 2025-12-19 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-12-19 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-12-19 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AlexWaygood on 2025-12-19 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 18:08</div>
            <div class="timeline-body"><p>It worked: https://github.com/astral-sh/ruff/pull/22091</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-12-19 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-12-19 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-19 18:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:36:42 UTC
    </footer>
</body>
</html>
