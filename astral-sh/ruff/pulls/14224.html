<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Add implementation for `flake8-markupsafe` via `RUF035` - astral-sh/ruff #14224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Add implementation for <code>flake8-markupsafe</code> via <code>RUF035</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14224">#14224</a>
        opened by <a href="https://github.com/Daverball">@Daverball</a>
        on 2024-11-09 12:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a></div>
            <div class="timeline-body"><p>Closes #14124</p>
<h2>Summary</h2>
<p>This adds an implementation for <a href="https://github.com/vmagamedov/flake8-markupsafe">flake8-markupsafe</a>, minus the questionable exception for i18n and mako support, but with the ability to specify further aliases/subclasses/functionally equivalent for <code>markupsafe.Markup</code>. By default <code>flask.Markup</code> is also detected as a commonly used alias.</p>
<h2>Test Plan</h2>
<p><code>cargo nextest run</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-09 12:55</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+51 -0 violations, +0 -0 fixes in 4 projects; 50 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+17 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/app.py#L94'>airflow/www/app.py:94:25:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L383'>airflow/www/utils.py:383:12:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L579'>airflow/www/utils.py:579:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L587'>airflow/www/utils.py:587:20:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L596'>airflow/www/utils.py:596:20:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L600'>airflow/www/utils.py:600:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L611'>airflow/www/utils.py:611:15:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L614'>airflow/www/utils.py:614:15:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L624'>airflow/www/utils.py:624:12:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/utils.py#L923'>airflow/www/utils.py:923:24:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/views.py#L1079'>airflow/www/views.py:1079:21:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/views.py#L1098'>airflow/www/views.py:1098:24:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/views.py#L4337'>airflow/www/views.py:4337:20:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/views.py#L4341'>airflow/www/views.py:4341:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/views.py#L4523'>airflow/www/views.py:4523:20:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/airflow/blob/bec090ceb8547df5564398066e73880875d00569/airflow/www/widgets.py#L50'>airflow/www/widgets.py:50:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
... 1 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+8 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/connectors/sqla/models.py#L1305'>superset/connectors/sqla/models.py:1305:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/models/dashboard.py#L225'>superset/models/dashboard.py:225:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/models/helpers.py#L533'>superset/models/helpers.py:533:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/models/helpers.py#L562'>superset/models/helpers.py:562:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/models/slice.py#L335'>superset/models/slice.py:335:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/models/sql_lab.py#L445'>superset/models/sql_lab.py:445:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/utils/core.py#L483'>superset/utils/core.py:483:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/apache/superset/blob/24b8a94c2ce4d21c65caa076bdc54ba61635be85/superset/views/database/mixins.py#L249'>superset/views/database/mixins.py:249:17:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/b3f18b805d2054a8e4e11f7ec363a7f2367c8c6c/zerver/views/documentation.py#L291'>zerver/views/documentation.py:291:35:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
</pre>

</p>
</details>
<details><summary><a href="https://github.com/indico/indico">indico/indico</a> (+25 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/admin/notices.py#L93'>indico/modules/admin/notices.py:93:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/auth/controllers.py#L351'>indico/modules/auth/controllers.py:351:15:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/bootstrap/controllers.py#L77'>indico/modules/bootstrap/controllers.py:77:15:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/bootstrap/controllers.py#L98'>indico/modules/bootstrap/controllers.py:98:19:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/events/agreements/placeholders.py#L31'>indico/modules/events/agreements/placeholders.py:31:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/events/controllers/creation.py#L151'>indico/modules/events/controllers/creation.py:151:27:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/events/models/events.py#L818'>indico/modules/events/models/events.py:818:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/events/persons/placeholders.py#L71'>indico/modules/events/persons/placeholders.py:71:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/events/registration/placeholders/invitations.py#L50'>indico/modules/events/registration/placeholders/invitations.py:50:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/events/surveys/placeholders.py#L32'>indico/modules/events/surveys/placeholders.py:32:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/legal/forms.py#L47'>indico/modules/legal/forms.py:47:80:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/modules/users/controllers.py#L124'>indico/modules/users/controllers.py:124:31:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/util/placeholders.py#L246'>indico/util/placeholders.py:246:12:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/flask/app.py#L238'>indico/web/flask/app.py:238:39:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/flask/app.py#L251'>indico/web/flask/app.py:251:49:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/flask/templating.py#L214'>indico/web/flask/templating.py:214:21:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/flask/templating.py#L39'>indico/web/flask/templating.py:39:12:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/forms/fields/protection.py#L49'>indico/web/forms/fields/protection.py:49:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/forms/widgets.py#L101'>indico/web/forms/widgets.py:101:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/forms/widgets.py#L37'>indico/web/forms/widgets.py:37:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/forms/widgets.py#L47'>indico/web/forms/widgets.py:47:16:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/menu.py#L180'>indico/web/menu.py:180:12:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/util.py#L33'>indico/web/util.py:33:26:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
+ <a href='https://github.com/indico/indico/blob/1ba036df833737f4facc0a902c219dd474e4dd88/indico/web/util.py#L360'>indico/web/util.py:360:23:</a> RUF035 Unsafe use of `markupsafe.Markup` detected
... 1 additional changes omitted for project
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF035 | 51 | 51 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Daverball on 2024-11-09 13:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:61 on 2024-11-09 13:04</div>
            <div class="timeline-body"><p>To only consider this rule if <code>markupsafe</code> or <code>flask</code> is imported and <code>settings.flake8_markupsafe.extend...</code> is empty:</p>
<pre><code class="language-suggestion">     if !(checker.semantic().seen_module(Modules::MARKUPSAFE)
        || checker.semantic().seen_module(Modules::FLASK))
    {
        return;
    }
    if let Some(name) = checker
</code></pre>
<p>(And add <code>MARKUPSAFE</code> and <code>FLASK</code> to <code>Modules</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:38 on 2024-11-09 13:07</div>
            <div class="timeline-body"><p>Consider adding the <code>## Options</code> section here, example: https://docs.astral.sh/ruff/rules/ambiguous-unicode-character-comment/#options</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-09 13:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:61 on 2024-11-09 13:10</div>
            <div class="timeline-body"><p>This fast-path only works if no additional names have been specified in the options, so at the very least I would have to first check <code>checker.settings.flake8_markupsafe.extend_markup_names.is_empty()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:65 on 2024-11-09 13:14</div>
            <div class="timeline-body"><p>If the <code>call</code> is not unsafe, for instance when the call arguments are empty, then we do not use the qualified name (which I assume requires more computation). We should first check <code>!is_unsafe_call</code> and otherwise set <code>None</code>, if safe, then resolve the qualified name and check the markup call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:10 on 2024-11-09 13:19</div>
            <div class="timeline-body"><p>Could you please add a couple of more test cases?</p>
<p>Examples:</p>
<ul>
<li>f-string formatting</li>
<li>old-style formatting, <code>Markup(&quot;&lt;em&gt;%s&lt;/em&gt; &quot; % (&quot;foo &amp; bar&quot;,))</code></li>
<li>Explicit keyword arguments, e.g. <code>Markup(object=&quot;hello world&quot;)</code></li>
</ul>
<p>https://markupsafe.palletsprojects.com/en/stable/escaping/#markupsafe.Markup</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:61 on 2024-11-09 13:24</div>
            <div class="timeline-body"><p>That's true. Such a guard would be helpful for users that do not work with <code>markupsafe</code> or <code>flask</code> but have this rule, but have it enabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:18 on 2024-11-09 13:29</div>
            <div class="timeline-body"><p>It's probably a good idea to mention the deviations from the upstream rule (mako, i18n)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2024-11-09 13:31</div>
            <div class="timeline-body"><p>Nice contribution, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-09 13:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:10 on 2024-11-09 13:35</div>
            <div class="timeline-body"><p>Detecting keyword arguments would only reliably work for <code>markupsafe.Markup</code> and <code>flask.Markup</code> but not for equivalent classes, so I'm not sure it's worth adding extra complexity until type inference can easily give us the first positional argument regardless of how the function was called. And even then it's somewhat questionable, since code searching for <code>Markup(object=</code> yields zero results, I don't expect anyone to ever call it this way.</p>
<p>On the other hand, it is a security rule, so we could consider emitting an error if there isn't at least one positional argument.</p>
<p>But I knew I forgot about something, and it was old-style formatting, f-strings do already have a test case (the very first one).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-09 13:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:18 on 2024-11-09 13:36</div>
            <div class="timeline-body"><p>Not sure it's worth mentioning mako support, since mako support was not part of flake8, but rather had to be invoked manually by directly calling the mako module within the plugin. But mentioning the i18n deviation makes sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 13:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:10 on 2024-11-09 13:58</div>
            <div class="timeline-body"><blockquote>
<p>Detecting keyword arguments would only reliably work for markupsafe.Markup and flask.Markup but not for equivalent classes, so I'm not sure it's worth adding extra complexity until type inference can easily give us the first positional argument regardless of how the function was called. And even then it's somewhat questionable, since code searching for Markup(object= yields zero results, I don't expect anyone to ever call it this way.</p>
</blockquote>
<p>I was only suggesting to add them as test cases, and agree that we do not have to support. I think it's a good idea to include known syntactially valid negative test cases ahead of time for posterity.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-09 14:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:10 on 2024-11-09 14:00</div>
            <div class="timeline-body"><p>Yeah, that's fair. I did include corresponding test cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 14:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:10 on 2024-11-09 14:00</div>
            <div class="timeline-body"><blockquote>
<p>But I knew I forgot about something, and it was old-style formatting, f-strings do already have a test case (the very first one).</p>
</blockquote>
<p>Overlooked the f-string. For completeness we can consider other valid but less frequent cases, e.g. multi-line strings, implicit string concatenation,  with and without comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 14:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:80 on 2024-11-09 14:11</div>
            <div class="timeline-body"><p>Would something like this work? (equivalent but in the same return-early style for consistency)</p>
<pre><code class="language-rs">
    let Some(qualified_name) = checker
         .semantic()
         .resolve_qualified_name(&amp;call.func) else{
        return;
    };

    if !is_markup_call(&amp;qualified_name, checker.settings) {
        return;
    } 

    checker
        .diagnostics
        .push(Diagnostic::new(UnsafeMarkupUse { qualified_name.to_string() }, call.range()));
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 14:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:13 on 2024-11-09 14:20</div>
            <div class="timeline-body"><p>Found one more example. In the ecosystem results we can find this example:</p>
<pre><code class="language-python">Markup(&quot;*&quot; * 8)
</code></pre>
<p>There is no user input here - essentially it's just string formatting -, so there is no possibility of tampering and we could allow these cases.</p>
<p>https://github.com/apache/airflow/blob/340a70bfe7289e01898ddd75f8edfaf7772e9d09/airflow/www/views.py#L4523</p>
<p>Another example:</p>
<pre><code class="language-python">flask.Markup(&quot;hello {}&quot;.format(&quot;world&quot;))
</code></pre>
<p>Would it make sense to check if any variable is used inside the call?
We then also would have to exclude non-string operations.</p>
<p>Probably it adds too much complexity for now.
When the type inference is available this might become easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-09 14:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:13 on 2024-11-09 14:33</div>
            <div class="timeline-body"><p>I don't think we should go too crazy for the initial implementation with detecting false negatives. It is a security rule, so some false negatives are to be expected.</p>
<p>Detecting constant expressions sounds like something that should live in red-knot. So we can be more accurate here when it does, anything else feels like a bandaid solution to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2024-11-09 14:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_markupsafe/MS001.py</code>:13 on 2024-11-09 14:39</div>
            <div class="timeline-body"><p>I agree, let's add these cases for when red-knot is available.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-11-11 10:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @MichaReiser on 2024-11-11 10:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/codes.rs</code>:1085 on 2024-11-11 11:04</div>
            <div class="timeline-body"><p>I understand that flake8-markup-safe has only a single rule. If that's indeed the case, then I don't think it's worth for us to introduce a new rule group just for that. Instead, we should add it to the <code>RUF</code> group and mentioned it in the documentation that this rule is inherited/inspired by <code>flake8-markup-safe</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:119 on 2024-11-11 11:11</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code class="language-suggestion">	matches!(&amp;*call.arguments.args, [first] if !first.is_string_literal_expr() &amp;&amp; !first.is_bytes_literal_expr())
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-11 11:14</div>
            <div class="timeline-body"><p>This looks good to me. Thank you. The only change I would make is that I don't think it's worth introducing a new rule group for a single rule.</p>
<p>I'd also like to hear @AlexWaygood's opinion on the rule itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-11 11:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/src/codes.rs</code>:1085 on 2024-11-11 11:21</div>
            <div class="timeline-body"><p>That's fair, I brought this up in the original issue as well. I'm fine with whatever you decide on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-11 11:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/codes.rs</code>:1085 on 2024-11-11 11:24</div>
            <div class="timeline-body"><p>Oh sorry that I missed this in the original issue. Let's wait until we hear back from @AlexWaygood before making the change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-11 13:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/codes.rs</code>:1085 on 2024-11-11 13:06</div>
            <div class="timeline-body"><p>Huh. Considering the flake8 plugin was never published to PyPI and we can find no uses of it in the wild, I also think it probably makes more sense to add it to the <code>RUF</code> category rather than add a new category just for this. (If the plugin were more widely used, I think it would be a different question, since we already have several other categories that only have a single rule in them.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:22 on 2024-11-11 13:07</div>
            <div class="timeline-body"><p>You don't say here what you mean by &quot;the original rule&quot;. Many users might read this documentation having not known that this is a reimplementation of a pre-existing flake8 plugin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-11 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-11 13:10</div>
            <div class="timeline-body"><p>I've never used <code>markupsafe</code> but it makes sense to me that this would be an important security consideration. I think it's good for linters to catch this.</p>
<p>Long-term, we should be able to improve the accuracy of rules like this when we switch to using red-knot as a backend (the <code>LiteralString</code> type is explicitly designed for this use case). But I don't think that should stop us from implementing this rule now!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2024-11-11 13:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/src/rules/flake8_markupsafe/rules/unsafe_markup_use.rs</code>:22 on 2024-11-11 13:17</div>
            <div class="timeline-body"><p>Yeah if we move this to the RUF namespace I don't think we need this sentence at all. Just a new one to give credit to the plugin which originally inspired this rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[flake8-markupsafe] Adds Implementation for MS001" to "[flake8-markupsafe] Adds Implementation for MS001 via RUF035" by @Daverball on 2024-11-11 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @Daverball on 2024-11-11 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-11 18:29</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-11-11 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-11-11 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-11 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[flake8-markupsafe] Adds Implementation for MS001 via RUF035" to "[`flake8-markupsafe`] Add implementation for MS001 via RUF035" by @dhruvmanila on 2024-11-15 10:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-markupsafe`] Add implementation for MS001 via RUF035" to "[`ruff`] Add implementation for `flake8-markupsafe` via `RUF035`" by @dhruvmanila on 2024-11-15 10:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:35 UTC
    </footer>
</body>
</html>
