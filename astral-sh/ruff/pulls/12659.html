<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove all `useEffect` usages - astral-sh/ruff #12659</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove all <code>useEffect</code> usages</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12659">#12659</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-08-04 09:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>The primary usage of effects is to interact with an external system. We don&#x27;t have this. That&#x27;s why this PR replaces all
<code>useEffect</code> usages with better suited hooks or removes them alltogether. See https://react.dev/learn/you-might-not-need-an-effect</p>
Test Plan
<ul>
<li>Made changes</li>
<li>Reload the editor</li>
<li>Verified that changes are persisted</li>
<li>Changed the theme to dark mode and reloaded the editor. Theme was persisted</li>
</ul>
<p>I wasn&#x27;t able to test sharing. The wrangler server goes up to 100% CPU usage whenever I hit share with or without my changes...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-04 09:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-04 09:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-05 00:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>playground/.gitignore</code>:132 on 2024-08-05 00:29</div>
            <div class="timeline-body"><p>Extra newline here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-05 00:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 00:30</div>
            <div class="timeline-body"><p>Doesn&#x27;t this mean that nothing on the page will render until after the data fetch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>playground/src/main.tsx</code>:9 on 2024-08-05 03:43</div>
            <div class="timeline-body"><pre><code>import init, { Workspace } from &quot;./pkg/ruff_wasm&quot;;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-05 03:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-08-05 06:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 06:05</div>
            <div class="timeline-body"><p>Yes, that&#x27;s correct. But arguably, this is the more &quot;correct&quot; behavior in the sense that showing anything is kind of meaningless and risks the user starting to change the code only so that it gets overridden once the response comes in.</p>
<p>I think the &quot;proper&quot; solution would be to split our skeleton:</p>
<ul>
<li>The skeleton renders the header, left, and right navigation. It embeds the editor area</li>
<li>Use a context to store the source and revision</li>
<li>Fetch the code in the editor area</li>
<li>Wrap the editor area in a suspense boundary</li>
</ul>
<p>But that&#x27;s a larger refactor than what I want to do right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-05 06:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-05 06:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-05 13:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 13:03</div>
            <div class="timeline-body"><p>But, on main, we don&#x27;t even show the editor pane until the source is loaded, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-08-05 13:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>playground/src/Editor/Editor.tsx</code>:103 on 2024-08-05 13:11</div>
            <div class="timeline-body"><p>@charliermarsh I think we showed an empty editor and the <code>initAsync</code> that loads the wasm and restores the python code raced against the user making any changes :laughing:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-08-05 13:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 13:11</div>
            <div class="timeline-body"><p>We did show the editor. See <a href="https://github.com/astral-sh/ruff/pull/12659">astral-sh/ruff#12659</a>/files#r1704097956</p>
<p>Isn&#x27;t that changing this is your main concern?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-05 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 13:13</div>
            <div class="timeline-body"><p>I thought we showed the chrome (header) but not the editable panes in the editor, just based on reading the code where we have that <code>source ?</code> ternary in the editor body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 13:13</div>
            <div class="timeline-body"><p>I (or someone) should probably test sharing before we merge this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 13:14</div>
            <div class="timeline-body"><p>ah yeah, that&#x27;s correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-08-05 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-05 13:17</div>
            <div class="timeline-body"><p>I do think we should test sharing before merging. I can try later today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-05 13:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 13:18</div>
            <div class="timeline-body"><p>I defer to you, I don&#x27;t want to get in your way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>playground/src/Editor/Chrome.tsx</code>:30 on 2024-08-05 13:59</div>
            <div class="timeline-body"><p>Too bad that <code>React.use</code> is experimental because we could then store the promise and have an inner component that is wrapped in a <code>Suspense</code> boundary and <code>use</code>s the promise. For now, this is a hacky version that doesn&#x27;t show a loading indicator</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>playground/src/main.tsx</code>:23 on 2024-08-05 14:00</div>
            <div class="timeline-body"><p>I extracted a <code>Chrome</code> component. It would have been nice if <a href="https://react.dev/reference/react/use"><code>React.use</code> </a> weren&#x27;t experimental :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-08-05 14:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-06 07:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-08 11:16</div>
            <div class="timeline-body"><p>Okay, I had to accept or decline the telemetry option, then force kill all wrangler process to get it working. But sharing works</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-08 11:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-08 11:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-08 11:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:05:40 UTC
    </footer>
</body>
</html>
