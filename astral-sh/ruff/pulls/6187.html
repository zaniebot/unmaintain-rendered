<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print log when formatter ecosystem checks fail - astral-sh/ruff #6187</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Print log when formatter ecosystem checks fail</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6187">#6187</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-07-31 09:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-07-31 09:23</div>
            <div class="timeline-body"><p><strong>Summary</strong> Print the errors when the formatter ecosystem checks failed. Im not happy that we current collect the log in the first place, but this is the less invasive change and we need it to unblock reviewing #6152.</p>
<p><strong>Test Plan</strong> https://github.com/astral-sh/ruff/actions/runs/5713112075/job/15477879403?pr=6188</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-07-31 09:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2023-07-31 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-07-31 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-31 09:57</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     10.2Â±0.27ms     4.0 MB/sec    1.08     11.0Â±0.45ms     3.7 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.0Â±0.10ms     8.3 MB/sec    1.05      2.1Â±0.09ms     7.8 MB/sec
formatter/numpy/globals.py                 1.00    224.9Â±7.63Âµs    13.1 MB/sec    1.06   237.5Â±13.93Âµs    12.4 MB/sec
formatter/pydantic/types.py                1.00      4.4Â±0.23ms     5.7 MB/sec    1.05      4.7Â±0.20ms     5.5 MB/sec
linter/all-rules/large/dataset.py          1.03     14.4Â±0.73ms     2.8 MB/sec    1.00     14.0Â±0.55ms     2.9 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5Â±0.14ms     4.8 MB/sec    1.01      3.5Â±0.15ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00   477.9Â±19.07Âµs     6.2 MB/sec    1.06   506.3Â±79.82Âµs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1Â±0.18ms     4.2 MB/sec    1.04      6.3Â±0.22ms     4.0 MB/sec
linter/default-rules/large/dataset.py      1.03      7.7Â±0.29ms     5.3 MB/sec    1.00      7.4Â±0.20ms     5.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1562.9Â±68.20Âµs    10.7 MB/sec    1.00  1558.5Â±56.06Âµs    10.7 MB/sec
linter/default-rules/numpy/globals.py      1.03    177.9Â±6.06Âµs    16.6 MB/sec    1.00    173.2Â±6.41Âµs    17.0 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.3Â±0.09ms     7.6 MB/sec    1.00      3.4Â±0.16ms     7.6 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     12.5Â±0.46ms     3.2 MB/sec    1.01     12.7Â±0.46ms     3.2 MB/sec
formatter/numpy/ctypeslib.py               1.03      2.4Â±0.08ms     6.8 MB/sec    1.00      2.4Â±0.10ms     7.0 MB/sec
formatter/numpy/globals.py                 1.00   267.3Â±20.64Âµs    11.0 MB/sec    1.03   275.1Â±19.53Âµs    10.7 MB/sec
formatter/pydantic/types.py                1.00      5.3Â±0.23ms     4.8 MB/sec    1.00      5.3Â±0.19ms     4.8 MB/sec
linter/all-rules/large/dataset.py          1.03     17.2Â±0.46ms     2.4 MB/sec    1.00     16.7Â±0.44ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.4Â±0.22ms     3.7 MB/sec    1.00      4.4Â±0.19ms     3.8 MB/sec
linter/all-rules/numpy/globals.py          1.04   561.3Â±40.88Âµs     5.3 MB/sec    1.00   540.0Â±24.42Âµs     5.5 MB/sec
linter/all-rules/pydantic/types.py         1.01      7.7Â±0.23ms     3.3 MB/sec    1.00      7.6Â±0.24ms     3.4 MB/sec
linter/default-rules/large/dataset.py      1.04      9.4Â±0.32ms     4.3 MB/sec    1.00      9.1Â±0.33ms     4.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01  1895.6Â±61.52Âµs     8.8 MB/sec    1.00  1880.3Â±64.39Âµs     8.9 MB/sec
linter/default-rules/numpy/globals.py      1.00   212.1Â±14.42Âµs    13.9 MB/sec    1.00    211.8Â±8.89Âµs    13.9 MB/sec
linter/default-rules/pydantic/types.py     1.03      4.1Â±0.38ms     6.1 MB/sec    1.00      4.0Â±0.21ms     6.3 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-31 10:38</div>
            <div class="timeline-body"><p>Extending the summary with some details would be helpful to ease reviewing.</p>
<p>It took me a bit of time to understand what I'm reviewing</p>
<ul>
<li>How did you test the change?</li>
<li>we need it to unblock my reviews. What is it and what reviews?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-31 11:17</div>
            <div class="timeline-body"><p>I expected this to fail because it fails for me locally and now i'm confused. See https://github.com/astral-sh/ruff/pull/6188 for a proper failure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-31 12:41</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #6187</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6187" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ<ul>
<li><strong>PR #6193</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6193" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #6194</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6194" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6187?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-31 12:42</div>
            <div class="timeline-body"><p>This failed for me locally because i had <code>target/progress_projects</code> symlinked and apparently <code>ignore::WalkBuilder</code> resolves symlinks in the path, so it only reads <code>ruff/.gitignore</code> if the directory isn't symlinked.</p>
<p>Debugging this spawned #6193.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-31 12:45</div>
            <div class="timeline-body"><p>Updated the summary</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-07-31 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-07-31 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-31 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-31 14:59</div>
            <div class="timeline-body"><p>this is cool. do you think we could get it to print the line containing the syntax error (ideally source + ruff output)? atm i still need to re-run locally to find the actual issue (unless i'm missing a trick here?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-31 17:20</div>
            <div class="timeline-body"><p>Unfortunately this is hard with our parser (it's not really meant for error recovery). I normally take the filename and let <code>ruff_shrinking</code> (documented in the <code>ruff_python_formatter</code> readme) give me a minimized example and then work on that</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:59:05 UTC
    </footer>
</body>
</html>
