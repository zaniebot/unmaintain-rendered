<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] WIP: Disambiguate legacy typevars - astral-sh/ruff #17994</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] WIP: Disambiguate legacy typevars</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17994">#17994</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2025-05-09 19:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a></div>
            <div class="timeline-body"><p>This addresses @carljm&#x27;s comment <a href="https://github.com/astral-sh/ruff/pull/17956">astral-sh/ruff#17956</a>#pullrequestreview-2826559665 about wanting to disambiguate legacy typevars that are used in multiple generic contexts.</p>
<p>WIP, not ready for review yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-09 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-09 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-09 19:18</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>zulip (https://github.com/zulip/zulip)
- zerver/actions/message_send.py:1836:5: error[invalid-assignment] Invalid assignment to data descriptor attribute `type` on type `Message` with custom `__set__` method
- Found 7319 diagnostics
+ Found 7318 diagnostics

</code></pre>


Memory usage changes were detected when running on open source projects

<pre><code>trio (https://github.com/python-trio/trio)
-     memo metadata = ~21MB
+     memo metadata = ~22MB

prefect (https://github.com/PrefectHQ/prefect)
- TOTAL MEMORY USAGE: ~541MB
+ TOTAL MEMORY USAGE: ~568MB
-     struct metadata = ~23MB
+     struct metadata = ~25MB
-     memo metadata = ~73MB
+     memo metadata = ~76MB

</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-05-09 19:20</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/dcreager%2Fdistinct-legacy-typevars?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #17994 will <strong>degrade performances by 6.88%</strong>
<p>Comparing <code>dcreager/distinct-legacy-typevars</code> (f786216) with <code>main</code> (1d21816)</p>
Summary
<p><code>❌ 6</code> regressions<br>
<code>✅ 35</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/dcreager%2Fdistinct-legacy-typevars?runnerMode=Instrumentation">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>ty_check_file[cold]</code> | 116.3 ms | 121.3 ms | -4.07% |
| ❌ | <code>ty_check_file[incremental]</code> | 4.9 ms | 5.3 ms | -6.88% |
| ❌ | <code>ty_micro[many_tuple_assignments]</code> | 116.8 ms | 122 ms | -4.27% |
| ❌ | <code>anyio</code> | 832.8 ms | 882.7 ms | -5.65% |
| ❌ | <code>attrs</code> | 364.8 ms | 383.9 ms | -4.99% |
| ❌ | <code>hydra-zen</code> | 792.1 ms | 834.9 ms | -5.12% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-07-24 16:16</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/dcreager%2Fdistinct-legacy-typevars?runnerMode=WallTime">CodSpeed WallTime Performance Report</a>
Merging #17994 will <strong>degrade performances by 10.88%</strong>
<p>Comparing <code>dcreager/distinct-legacy-typevars</code> (f786216) with <code>main</code> (1d21816)</p>
Summary
<p><code>❌ 7</code> regressions</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/dcreager%2Fdistinct-legacy-typevars?runnerMode=WallTime">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>large[sympy]</code> | 43.4 s | 47 s | -7.63% |
| ❌ | <code>medium[colour-science]</code> | 7.2 s | 8 s | -9.99% |
| ❌ | <code>medium[pandas]</code> | 29.1 s | 31.9 s | -8.63% |
| ❌ | <code>small[altair]</code> | 2.4 s | 2.7 s | -10.88% |
| ❌ | <code>small[freqtrade]</code> | 4.1 s | 4.4 s | -6.65% |
| ❌ | <code>small[pydantic]</code> | 2.3 s | 2.5 s | -10.01% |
| ❌ | <code>small[tanjun]</code> | 1.7 s | 1.8 s | -8.93% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-07-28 21:37</div>
            <div class="timeline-body"><p>superseded by #19604</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dcreager">@dcreager</a> on 2025-07-28 21:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-28 21:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:14:16 UTC
    </footer>
</body>
</html>
