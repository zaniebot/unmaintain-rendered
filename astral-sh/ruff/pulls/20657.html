<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Add support for additional eager conversion patterns (`RUF065`) - astral-sh/ruff #20657</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Add support for additional eager conversion patterns (<code>RUF065</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20657">#20657</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-10-01 00:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a></div>
            <div class="timeline-body">Summary
<p>Fixes #20583</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-01 00:33</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+9 -0 violations, +0 -0 fixes in 2 projects; 53 projects unchanged)</p>
<a href="https://github.com/langchain-ai/langchain">langchain-ai/langchain</a> (+8 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L2427">libs/core/langchain_core/callbacks/manager.py:2427:25:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L289">libs/core/langchain_core/callbacks/manager.py:289:25:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L296">libs/core/langchain_core/callbacks/manager.py:296:21:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L337">libs/core/langchain_core/callbacks/manager.py:337:71:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L349">libs/core/langchain_core/callbacks/manager.py:349:67:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L391">libs/core/langchain_core/callbacks/manager.py:391:17:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/core/langchain_core/callbacks/manager.py#L398">libs/core/langchain_core/callbacks/manager.py:398:13:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
+ <a href="https://github.com/langchain-ai/langchain/blob/d2189367630d9d35b2048dcfc017803ef4635881/libs/langchain/langchain_classic/smith/evaluation/runner_utils.py#L1151">libs/langchain/langchain_classic/smith/evaluation/runner_utils.py:1151:61:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
</pre>

</p>

<a href="https://github.com/python-poetry/poetry">python-poetry/poetry</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/python-poetry/poetry/blob/500a313d68637cbd317171c567280a10eaabae3c/src/poetry/inspection/lazy_wheel.py#L372">src/poetry/inspection/lazy_wheel.py:372:57:</a> RUF065 Unnecessary `repr()` conversion when formatting with `%s`. Use `%r` instead of `%s`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF065 | 9 | 9 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-15 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-15 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/resources/test/fixtures/ruff/RUF065.py</code>:61 on 2025-10-15 20:55</div>
            <div class="timeline-body"><p>I&#x27;m not sure if we should be handling bytes. I might be doing something wrong, but these don&#x27;t appear to work on Python 3.13:</p>
<pre><code>&gt;&gt;&gt; logging.info(&quot;Bytes: %b&quot;, bytes(&quot;Hello&quot;, &quot;utf-8&quot;))
--- Logging error ---
Traceback (most recent call last):
  File &quot;/usr/lib/python3.13/logging/__init__.py&quot;, line 1151, in emit
    msg = self.format(record)
  File &quot;/usr/lib/python3.13/logging/__init__.py&quot;, line 999, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File &quot;/usr/lib/python3.13/logging/__init__.py&quot;, line 712, in format
    record.message = record.getMessage()
                     ~~~~~~~~~~~~~~~~~^^
  File &quot;/usr/lib/python3.13/logging/__init__.py&quot;, line 400, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
ValueError: unsupported format character &#x27;b&#x27; (0x62) at index 8
</code></pre>
<p>This happens even if I make the message a byte string, which otherwise works with <code>%</code> formatting:</p>
<pre><code>&gt;&gt;&gt; logging.info(b&quot;Bytes: %b&quot;, bytes(&quot;Hello&quot;, &quot;utf-8&quot;))
--- Logging error ---
Traceback (most recent call last):
# ...
&gt;&gt;&gt; b&quot;Bytes: %b&quot; % bytes(&quot;Hello&quot;, &quot;utf-8&quot;)
b&#x27;Bytes: Hello&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/logging_eager_conversion.rs</code>:76 on 2025-10-15 20:56</div>
            <div class="timeline-body"><p>Could we break these lines up? We can&#x27;t insert actual newlines since the message needs to remain on a single line, but we can do something like:</p>
<pre><code>            (FormatConversion::Str, Some(&quot;oct&quot;)) =&gt; &quot;Unnecessary `oct()` conversion when formatting with `%s`. \
            Use `%#o` instead of `%s`&quot;.to_string(),
</code></pre>
<p>Alternatively, I think the <code>Use ...</code> parts would fit nicely in the <code>fix_title</code> function, which I think we can include even if we don&#x27;t attach a fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/logging_eager_conversion.rs</code>:65 on 2025-10-15 20:59</div>
            <div class="timeline-body"><p>Does <code>function_name</code> need to be a <code>String</code>? It looks like it&#x27;s only ever set to a <code>&amp;&#x27;static str</code>.</p>
<p>I also think it might make sense to define our own, separate enum here instead of reusing <code>FormatConversion</code>, especially if we don&#x27;t support <code>Bytes</code>, as in my other comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-10-15 21:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/danparizher">@danparizher</a> on 2025-10-15 23:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-10-29 21:39</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>(Just closing and reopening to make sure CI still passes)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-29 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-29 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-29 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-29 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-29 21:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:09 UTC
    </footer>
</body>
</html>
