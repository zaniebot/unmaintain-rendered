<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`DOC201`] Permit explicit `None` in functions that only return `None` - astral-sh/ruff #13064</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>DOC201</code>] Permit explicit <code>None</code> in functions that only return <code>None</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13064">#13064</a>
        opened by <a href="https://github.com/tjkuson">@tjkuson</a>
        on 2024-08-22 22:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tjkuson">@tjkuson</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>No longer reports <a href="https://docs.astral.sh/ruff/rules/docstring-missing-returns/">docstring-missing-returns (DOC201)</a> on explicit returns in functions that only return <code>None</code>.</p>
<p>For example,</p>
<pre><code class="language-python">def foo(obj: object) -&gt; None:
    &quot;&quot;&quot;A very helpful docstring.

    Args:
        obj (object): An object.
    &quot;&quot;&quot;
    if obj is None:
        return
    print(obj)
</code></pre>
<p>no longer reports DOC201.</p>
<p>Closes #13062</p>
<h3>Methodology</h3>
<p>When visiting, count the number of <code>return None</code>s visited in the body. There are then two scenarios under which the diagnostic is skipped:</p>
<ol>
<li>If the return is not annotated and if the number of <code>return None</code> to the total number of returns (that is to say, all the paths return <code>None</code>), skip the diagnostic.</li>
<li>If the return is annotated, and that annotation is <code>None</code>, skip the diagnostic.</li>
</ol>
<h4>Return annotations</h4>
<p>I saw in the ecosystem check that functions that only return <code>None</code> but annotated otherwise were now being ignored. For example,</p>
<pre><code class="language-python">def foo(s: str) -&gt; str | None:
    &quot;&quot;&quot;A very helpful docstring.

    Args:
        s (str): A string.
    &quot;&quot;&quot;
    return None
</code></pre>
<p>would no longer report a diagnostic. I changed this back by always checking the rule if the return annotation is not <code>None</code>: if the return annotation is anything other than <code>None</code>, run the diagnostic.</p>
<p>I think this is more likely to be the expected behaviour, especially due to the functional overlap between docstrings and type annotations. You <em>could</em> argue that checking against the return type annotation should be all this patch does, but that would make the rule quite unhelpful in untyped contexts. For example,</p>
<pre><code class="language-python">def foo(obj):
    &quot;&quot;&quot;A very helpful docstring.

    Args:
        obj (object): An object.
    &quot;&quot;&quot;
    if obj is None:
        return None
    print(obj)

</code></pre>
<p>would still report DOC201.</p>
<h2>Test Plan</h2>
<p><code>cargo nextest run</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @tjkuson on 2024-08-22 22:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`DOC201`] Permit explicit None early returns" to "[`DOC201`] Permit explicit None in functions that only return None" by @tjkuson on 2024-08-22 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`DOC201`] Permit explicit None in functions that only return None" to "[`DOC201`] Permit explicit `None` in functions that only return `None`" by @tjkuson on 2024-08-22 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-22 23:18</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -67 violations, +0 -0 fixes in 4 projects; 50 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -51 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/dag_processing/processor.py#L692'>airflow/dag_processing/processor.py:692:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/io/path.py#L386'>airflow/io/path.py:386:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/datadog_logger.py#L117'>airflow/metrics/datadog_logger.py:117:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/datadog_logger.py#L138'>airflow/metrics/datadog_logger.py:138:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/datadog_logger.py#L76'>airflow/metrics/datadog_logger.py:76:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/datadog_logger.py#L96'>airflow/metrics/datadog_logger.py:96:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/statsd_logger.py#L109'>airflow/metrics/statsd_logger.py:109:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/statsd_logger.py#L125'>airflow/metrics/statsd_logger.py:125:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/statsd_logger.py#L139'>airflow/metrics/statsd_logger.py:139:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/metrics/statsd_logger.py#L94'>airflow/metrics/statsd_logger.py:94:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/models/connection.py#L182'>airflow/models/connection.py:182:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/models/dag.py#L1270'>airflow/models/dag.py:1270:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/models/dag.py#L1275'>airflow/models/dag.py:1275:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/models/dagbag.py#L270'>airflow/models/dagbag.py:270:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/models/variable.py#L332'>airflow/models/variable.py:332:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/airbyte/operators/airbyte.py#L126'>airflow/providers/airbyte/operators/airbyte.py:126:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/airbyte/operators/airbyte.py#L139'>airflow/providers/airbyte/operators/airbyte.py:139:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/airbyte/sensors/airbyte.py#L162'>airflow/providers/airbyte/sensors/airbyte.py:162:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/amazon/aws/hooks/s3.py#L1327'>airflow/providers/amazon/aws/hooks/s3.py:1327:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/amazon/aws/sensors/s3.py#L407'>airflow/providers/amazon/aws/sensors/s3.py:407:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/apache/hive/hooks/hive.py#L431'>airflow/providers/apache/hive/hooks/hive.py:431:13:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/common/compat/openlineage/facet.py#L30'>airflow/providers/common/compat/openlineage/facet.py:30:5:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery.py#L1295'>airflow/providers/google/cloud/hooks/bigquery.py:1295:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery.py#L2600'>airflow/providers/google/cloud/hooks/bigquery.py:2600:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery.py#L2626'>airflow/providers/google/cloud/hooks/bigquery.py:2626:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery.py#L2639'>airflow/providers/google/cloud/hooks/bigquery.py:2639:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery.py#L2744'>airflow/providers/google/cloud/hooks/bigquery.py:2744:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery.py#L2796'>airflow/providers/google/cloud/hooks/bigquery.py:2796:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/bigquery_dts.py#L188'>airflow/providers/google/cloud/hooks/bigquery_dts.py:188:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/life_sciences.py#L164'>airflow/providers/google/cloud/hooks/life_sciences.py:164:17:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/hooks/secret_manager.py#L345'>airflow/providers/google/cloud/hooks/secret_manager.py:345:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/operators/dataplex.py#L1027'>airflow/providers/google/cloud/operators/dataplex.py:1027:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/operators/dataplex.py#L1207'>airflow/providers/google/cloud/operators/dataplex.py:1207:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/operators/dataplex.py#L1594'>airflow/providers/google/cloud/operators/dataplex.py:1594:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/operators/dataplex.py#L1733'>airflow/providers/google/cloud/operators/dataplex.py:1733:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/operators/dataproc.py#L1498'>airflow/providers/google/cloud/operators/dataproc.py:1498:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/operators/dataproc.py#L2647'>airflow/providers/google/cloud/operators/dataproc.py:2647:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/airflow/blob/615cddf427081bdbafc9437569946b16390deddb/airflow/providers/google/cloud/sensors/gcs.py#L551'>airflow/providers/google/cloud/sensors/gcs.py:551:13:</a> DOC201 `return` is not documented in docstring
... 13 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+0 -3 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/superset/blob/fcf04502949b58fbcd7225ec7d10e9c73ae316d5/superset/db_engine_specs/base.py#L1992'>superset/db_engine_specs/base.py:1992:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/superset/blob/fcf04502949b58fbcd7225ec7d10e9c73ae316d5/superset/db_engine_specs/base.py#L2103'>superset/db_engine_specs/base.py:2103:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/apache/superset/blob/fcf04502949b58fbcd7225ec7d10e9c73ae316d5/superset/migrations/versions/2022-04-01_14-38_a9422eeaae74_new_dataset_models_take_2.py#L105'>superset/migrations/versions/2022-04-01_14-38_a9422eeaae74_new_dataset_models_take_2.py:105:5:</a> DOC201 `return` is not documented in docstring
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+0 -11 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/application.py#L234'>src/bokeh/application/application.py:234:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/application.py#L247'>src/bokeh/application/application.py:247:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/directory.py#L254'>src/bokeh/application/handlers/directory.py:254:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/directory.py#L270'>src/bokeh/application/handlers/directory.py:270:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/lifecycle.py#L105'>src/bokeh/application/handlers/lifecycle.py:105:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/lifecycle.py#L115'>src/bokeh/application/handlers/lifecycle.py:115:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/lifecycle.py#L125'>src/bokeh/application/handlers/lifecycle.py:125:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/application/handlers/lifecycle.py#L90'>src/bokeh/application/handlers/lifecycle.py:90:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/websocket.py#L71'>src/bokeh/client/websocket.py:71:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/views/ws.py#L262'>src/bokeh/server/views/ws.py:262:9:</a> DOC201 `return` is not documented in docstring
... 1 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+0 -2 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/zulip/zulip/blob/7424d4e72165b29e25c1873c06a9b45509f68039/zerver/lib/cache.py#L261'>zerver/lib/cache.py:261:9:</a> DOC201 `return` is not documented in docstring
- <a href='https://github.com/zulip/zulip/blob/7424d4e72165b29e25c1873c06a9b45509f68039/zerver/tests/test_openapi.py#L466'>zerver/tests/test_openapi.py:466:13:</a> DOC201 `return` is not documented in docstring
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| DOC201 | 67 | 0 | 67 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-27 15:41</div>
            <div class="timeline-body"><p>There's some situations in the ecosystem check here where the diagnostic is going away and it <em>looks</em> like a false negative is introduced, such as <a href="https://github.com/apache/airflow/blob/6c878866dedc182c55e18e490bff3f3a9e9c5747/airflow/providers/airbyte/operators/airbyte.py#L126">https://github.com/apache/airflow/blob/6c878866dedc182c55e18e490bff3f3a9e9c5747/airflow/providers/airbyte/operators/airbyte.py#L126</a>. The reason there for the error going away is that the function is typed as always returning <code>None</code> -- looking at the function, I think it's pretty clear that it <em>doesn't</em> always return <code>None</code>, but I guess that's a bug in their type annotations rather than a bug in the logic of this PR. I think it's correct for us to believe people's type annotations in this rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-08-27 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-08-27 15:56</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @AlexWaygood on 2024-08-27 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @AlexWaygood on 2024-08-27 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-08-27 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-08-27 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-08-27 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-08-27 16:01</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/tjkuson:doc201-explicit-none">CodSpeed Performance Report</a></h2>
<h3>Merging #13064 will <strong>degrade performances by 9.33%</strong></h3>
<p><sub>Comparing <code>tjkuson:doc201-explicit-none</code> (bb48a09) with <code>main</code> (e6d0c4a)</sub></p>
<h3>Summary</h3>
<p><code>❌ 1</code> regressions
<code>✅ 31</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/tjkuson:doc201-explicit-none">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>main</code> | <code>tjkuson:doc201-explicit-none</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>linter/all-with-preview-rules[numpy/globals.py]</code> | 821 µs | 905.5 µs | -9.33% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-27 16:03</div>
            <div class="timeline-body"><blockquote>
<p>Merging #13064 will <strong>degrade performances by 9.33%</strong></p>
</blockquote>
<p>Looks spurious; it's been very unreliable recently sadly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-27 16:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:06:10 UTC
    </footer>
</body>
</html>
