<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty]: Consider a class with a dynamic element in its MRO assignable to any subtype of `type` - astral-sh/ruff #18205</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty]: Consider a class with a dynamic element in its MRO assignable to any subtype of <code>type</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18205">#18205</a>
        opened by <a href="https://github.com/felixscherz">@felixscherz</a>
        on 2025-05-19 18:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/felixscherz">@felixscherz</a></div>
            <div class="timeline-body">

<p>Hi, this is in regards to <a href="https://github.com/astral-sh/ty/issues/447">astral-sh/ty#447</a>.</p>
Summary
<p>Now checks the MRO for <code>Unknown</code> when checking the assignability between <code>Type::ClassLiteral</code> and <code>Type::SubclassOf</code> since <code>Unknown</code> is assignable to any type.
There are probably more cases where this check would be interesting.</p>
<p>I&#x27;m not entirely sure how to handle the <code>Specialization</code> argument to <code>ClassLiteral::iter_mro</code> and whether it is ok to pass <code>None</code> here.</p>


Test Plan
<p>Added markdown tests.</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/felixscherz">@felixscherz</a> on 2025-05-19 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/felixscherz">@felixscherz</a> on 2025-05-19 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/felixscherz">@felixscherz</a> on 2025-05-19 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/felixscherz">@felixscherz</a> on 2025-05-19 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-19 18:51</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>aioredis (https://github.com/aio-libs/aioredis)
- error[invalid-exception-caught] aioredis/client.py:1105:16: Cannot catch object of type `&lt;class &#x27;TimeoutError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] aioredis/client.py:4047:16: Cannot catch object of type `&lt;class &#x27;TimeoutError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] aioredis/client.py:4452:16: Cannot catch object of type `&lt;class &#x27;TimeoutError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] aioredis/client.py:4648:16: Cannot catch object of type `&lt;class &#x27;TimeoutError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] aioredis/connection.py:826:20: Cannot catch object of type `&lt;class &#x27;TimeoutError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- Found 33 diagnostics
+ Found 28 diagnostics

comtypes (https://github.com/enthought/comtypes)
- error[no-matching-overload] comtypes/test/test_comserver.py:177:16: No overload of function `GetActiveObject` matches arguments
- error[no-matching-overload] comtypes/test/test_comserver.py:206:16: No overload of function `CreateObject` matches arguments
- Found 601 diagnostics
+ Found 599 diagnostics

nox (https://github.com/wntrblm/nox)
- error[invalid-argument-type] nox/logger.py:98:24: Argument to function `setLoggerClass` is incorrect: Expected `type[Logger]`, found `&lt;class &#x27;LoggerWithSuccessAndOutput&#x27;&gt;`
- Found 38 diagnostics
+ Found 37 diagnostics

cki-lib (https://gitlab.com/cki-project/cki-lib)
- error[invalid-exception-caught] cki_lib/yaml.py:222:12: Cannot catch object of type `&lt;class &#x27;ValidationError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- Found 170 diagnostics
+ Found 169 diagnostics

jinja (https://github.com/pallets/jinja)
- error[invalid-return-type] src/jinja2/runtime.py:967:12: Return type does not match returned value: expected `type[Undefined]`, found `&lt;class &#x27;LoggingUndefined&#x27;&gt;`
- Found 235 diagnostics
+ Found 234 diagnostics

scrapy (https://github.com/scrapy/scrapy)
- error[invalid-argument-type] tests/test_spider.py:121:27: Argument to bound method `__init__` is incorrect: Expected `type[Spider]`, found `&lt;class &#x27;TestSpider&#x27;&gt;`
- error[invalid-argument-type] tests/test_spider.py:160:31: Argument to function `get_crawler` is incorrect: Expected `type[Spider] | None`, found `&lt;class &#x27;TestSpider&#x27;&gt;`
- error[invalid-argument-type] tests/test_spider.py:473:31: Argument to function `get_crawler` is incorrect: Expected `type[Spider] | None`, found `&lt;class &#x27;TestSpider&#x27;&gt;`
- error[invalid-argument-type] tests/test_spider.py:800:31: Argument to function `get_crawler` is incorrect: Expected `type[Spider] | None`, found `&lt;class &#x27;TestSpider&#x27;&gt;`
- Found 1307 diagnostics
+ Found 1303 diagnostics

static-frame (https://github.com/static-frame/static-frame)
- error[invalid-argument-type] static_frame/test/property/strategies.py:973:13: Argument to function `get_frame` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/property/test_strategies.py:112:27: Argument to function `get_frame` is incorrect: Expected `type[Index]`, found `&lt;class &#x27;IndexHierarchy&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/property/test_strategies.py:112:53: Argument to function `get_frame` is incorrect: Expected `type[Index]`, found `&lt;class &#x27;IndexHierarchy&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_index_hierarchy.py:51:20: Argument is incorrect: Expected `type[IndexHierarchy]`, found `&lt;class &#x27;IndexHierarchyGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_interface.py:292:69: Argument to bound method `name_obj_iter` is incorrect: Expected `type[ContainerBase]`, found `&lt;class &#x27;Series&#x27;&gt; | &lt;class &#x27;Frame&#x27;&gt; | &lt;class &#x27;FrameGO&#x27;&gt; | &lt;class &#x27;Index&#x27;&gt; | &lt;class &#x27;IndexDate&#x27;&gt; | &lt;class &#x27;IndexDateGO&#x27;&gt; | &lt;class &#x27;IndexHierarchy&#x27;&gt; | &lt;class &#x27;Bus&#x27;&gt; | &lt;class &#x27;Batch&#x27;&gt; | &lt;class &#x27;Yarn&#x27;&gt; | &lt;class &#x27;Quilt&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_interface.py:292:69: Argument to bound method `name_obj_iter` is incorrect: Expected `type[ContainerBase]`, found `&lt;class &#x27;Series&#x27;&gt; | &lt;class &#x27;Frame&#x27;&gt; | &lt;class &#x27;FrameGO&#x27;&gt; | &lt;class &#x27;Index&#x27;&gt; | &lt;class &#x27;IndexDate&#x27;&gt; | &lt;class &#x27;IndexDateGO&#x27;&gt; | &lt;class &#x27;IndexHierarchy&#x27;&gt; | &lt;class &#x27;Bus&#x27;&gt; | &lt;class &#x27;Batch&#x27;&gt; | &lt;class &#x27;Yarn&#x27;&gt; | &lt;class &#x27;Quilt&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_interface.py:292:69: Argument to bound method `name_obj_iter` is incorrect: Expected `type[ContainerBase]`, found `&lt;class &#x27;Series&#x27;&gt; | &lt;class &#x27;Frame&#x27;&gt; | &lt;class &#x27;FrameGO&#x27;&gt; | &lt;class &#x27;Index&#x27;&gt; | &lt;class &#x27;IndexDate&#x27;&gt; | &lt;class &#x27;IndexDateGO&#x27;&gt; | &lt;class &#x27;IndexHierarchy&#x27;&gt; | &lt;class &#x27;Bus&#x27;&gt; | &lt;class &#x27;Batch&#x27;&gt; | &lt;class &#x27;Yarn&#x27;&gt; | &lt;class &#x27;Quilt&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_interface.py:292:69: Argument to bound method `name_obj_iter` is incorrect: Expected `type[ContainerBase]`, found `&lt;class &#x27;Series&#x27;&gt; | &lt;class &#x27;Frame&#x27;&gt; | &lt;class &#x27;FrameGO&#x27;&gt; | &lt;class &#x27;Index&#x27;&gt; | &lt;class &#x27;IndexDate&#x27;&gt; | &lt;class &#x27;IndexDateGO&#x27;&gt; | &lt;class &#x27;IndexHierarchy&#x27;&gt; | &lt;class &#x27;Bus&#x27;&gt; | &lt;class &#x27;Batch&#x27;&gt; | &lt;class &#x27;Yarn&#x27;&gt; | &lt;class &#x27;Quilt&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_store_zip.py:165:35: Argument to function `get_test_framesA` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_store_zip.py:165:35: Argument to function `get_test_framesA` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_store_zip.py:199:39: Argument to function `get_test_framesA` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_store_zip.py:199:39: Argument to function `get_test_framesA` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_store_zip.py:199:39: Argument to function `get_test_framesA` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- error[invalid-argument-type] static_frame/test/unit/test_store_zip.py:199:39: Argument to function `get_test_framesA` is incorrect: Expected `type[Frame]`, found `&lt;class &#x27;FrameGO&#x27;&gt;`
- Found 2077 diagnostics
+ Found 2063 diagnostics

cloud-init (https://github.com/canonical/cloud-init)
- error[invalid-argument-type] cloudinit/templater.py:155:25: Argument to function `__new__` is incorrect: Expected `type[Undefined]`, found `&lt;class &#x27;UndefinedJinjaVariable&#x27;&gt;`
- Found 718 diagnostics
+ Found 717 diagnostics

poetry (https://github.com/python-poetry/poetry)
- error[invalid-exception-caught] src/poetry/console/application.py:261:20: Cannot catch object of type `&lt;class &#x27;PoetryRuntimeError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] src/poetry/console/commands/python/install.py:116:16: Cannot catch object of type `&lt;class &#x27;PoetryRuntimeError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] tests/installation/test_chooser.py:53:12: Cannot catch object of type `&lt;class &#x27;PoetryRuntimeError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- Found 1018 diagnostics
+ Found 1015 diagnostics

sphinx (https://github.com/sphinx-doc/sphinx)
- error[invalid-return-type] sphinx/domains/__init__.py:200:16: Return type does not match returned value: expected `type[Directive] | None`, found `&lt;class &#x27;DirectiveAdapter&#x27;&gt;`
- Found 664 diagnostics
+ Found 663 diagnostics

zulip (https://github.com/zulip/zulip)
- error[invalid-exception-caught] zerver/management/commands/sync_ldap_user_data.py:35:20: Cannot catch object of type `&lt;class &#x27;ZulipLDAPError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] zproject/backends.py:1008:16: Cannot catch object of type `&lt;class &#x27;NoMatchingLDAPUserError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[invalid-exception-caught] zproject/backends.py:1339:16: Cannot catch object of type `&lt;class &#x27;NoMatchingLDAPUserError&#x27;&gt;` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- Found 6905 diagnostics
+ Found 6902 diagnostics

</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:1548 on 2025-05-19 18:54</div>
            <div class="timeline-body"><p>I think we should also view classes that inherit from <code>Any</code> or <code>Todo</code> as assignable to arbitrary <code>type[]</code> types</p>
<pre><code>                    .any(|superclass| superclass.is_dynamic()) =&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-19 18:54</div>
            <div class="timeline-body"><p>Thank you!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/felixscherz">@felixscherz</a> reviewed on 2025-05-19 19:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/felixscherz">@felixscherz</a> on <code>crates/ty_python_semantic/src/types.rs</code>:1548 on 2025-05-19 19:03</div>
            <div class="timeline-body"><p>I added a <code>is_dynamic</code> method to <code>ClassBase</code> and replaced this check using it:)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-19 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-19 19:27</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m not entirely sure how to handle the <code>Specialization</code> argument to <code>ClassLiteral::iter_mro</code> and whether it is ok to pass <code>None</code> here.</p>
</blockquote>
<p>I think this is fine!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;feat: check mro for `Unknown` in `is_assignable_to`&quot; to &quot;[ty]: Consider a class with a dynamic element in its MRO assignable to any subtype of `type`&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-19 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-05-19 19:28</div>
            <div class="timeline-body"><p>Excellent, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-19 19:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-19 19:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:14:45 UTC
    </footer>
</body>
</html>
