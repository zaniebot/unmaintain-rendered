<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expand `RUF015` to include all expression types - astral-sh/ruff #5767</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Expand <code>RUF015</code> to include all expression types</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5767">#5767</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-07-14 23:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>We now allow RUF015 to fix cases like:</p>
<pre><code>list(range(10))[0]
list(x.y)[0]
list(x[&quot;y&quot;])[0]
</code></pre>
<p>Further, we fix generators like:</p>
<pre><code>[i + 1 for i in x][0]
</code></pre>
<p>By rewriting to <code>next(iter(i + 1 for i in x))</code>.</p>
<p>I&#x27;ve retained the special-case that rewrites <code>[i for i in x][0]</code> to <code>next(iter(x))</code>.</p>
<p>Closes <a href="https://github.com/astral-sh/ruff/issues/5764">astral-sh/ruff#5764</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-14 23:56</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+72, -0, 0 error(s))</p>
airflow (+25, -0)
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/airflow/providers/amazon/aws/secrets/secrets_manager.py#L221">airflow/providers/amazon/aws/secrets/secrets_manager.py:221:38:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/airflow/providers/apache/hive/macros/hive.py#L102">airflow/providers/apache/hive/macros/hive.py:102:18:</a> RUF015 [*] Prefer `next(iter(p.values()))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/airflow/providers/cncf/kubernetes/triggers/pod.py#L249">airflow/providers/cncf/kubernetes/triggers/pod.py:249:21:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/airflow/providers/google/cloud/operators/datafusion.py#L47">airflow/providers/google/cloud/operators/datafusion.py:47:22:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/airflow/serialization/serialized_objects.py#L1136">airflow/serialization/serialized_objects.py:1136:47:</a> RUF015 [*] Prefer `next(iter(_operator_links_source.items()))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/dev/perf/scheduler_dag_execution_timing.py#L83">dev/perf/scheduler_dag_execution_timing.py:83:19:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/kubernetes_tests/test_kubernetes_pod_operator.py#L927">kubernetes_tests/test_kubernetes_pod_operator.py:927:22:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/scripts/ci/pre_commit/pre_commit_version_heads_map.py#L39">scripts/ci/pre_commit/pre_commit_version_heads_map.py:39:30:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/decorators/test_python.py#L465">tests/decorators/test_python.py:465:22:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/executors/test_kubernetes_executor.py#L438">tests/executors/test_kubernetes_executor.py:438:20:</a> RUF015 [*] Prefer `next(iter(executor.event_buffer.values()))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/jobs/test_triggerer_job.py#L556">tests/jobs/test_triggerer_job.py:556:35:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/models/test_dagrun.py#L1709">tests/models/test_dagrun.py:1709:11:</a> RUF015 [*] Prefer `next(i for i in tis if i.map_index == 0)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/operators/test_python.py#L1184">tests/operators/test_python.py:1184:32:</a> RUF015 [*] Prefer `next(x for x in tis if x.task_id == &quot;op1&quot;)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/operators/test_python.py#L1215">tests/operators/test_python.py:1215:32:</a> RUF015 [*] Prefer `next(x for x in tis if x.task_id == &quot;op1&quot;)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/operators/test_python.py#L1242">tests/operators/test_python.py:1242:32:</a> RUF015 [*] Prefer `next(x for x in tis if x.task_id == &quot;op1&quot;)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/operators/test_python.py#L1277">tests/operators/test_python.py:1277:32:</a> RUF015 [*] Prefer `next(x for x in tis if x.task_id == &quot;op1&quot;)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/providers/amazon/aws/secrets/test_systems_manager.py#L160">tests/providers/amazon/aws/secrets/test_systems_manager.py:160:27:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/providers/google/cloud/operators/test_bigquery.py#L678">tests/providers/google/cloud/operators/test_bigquery.py:678:27:</a> RUF015 [*] Prefer `next(iter(simple_task.operator_extra_links))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/providers/google/cloud/operators/test_bigquery.py#L716">tests/providers/google/cloud/operators/test_bigquery.py:716:27:</a> RUF015 [*] Prefer `next(iter(simple_task.operator_extra_links))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/providers/qubole/operators/test_qubole.py#L156">tests/providers/qubole/operators/test_qubole.py:156:27:</a> RUF015 [*] Prefer `next(iter(simple_task.operator_extra_links))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/system/providers/amazon/aws/utils/__init__.py#L67">tests/system/providers/amazon/aws/utils/__init__.py:67:26:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/test_utils/providers.py#L56">tests/test_utils/providers.py:56:19:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/www/test_utils.py#L436">tests/www/test_utils.py:436:15:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/www/views/test_views_acl.py#L339">tests/www/views/test_views_acl.py:339:16:</a> RUF015 [*] Prefer `next(iter(resp.json.items()))` over single element slice
+ <a href="https://github.com/apache/airflow/blob/848c69a194c03ed3a5badc909e26b5c1bda03050/tests/www/views/test_views_base.py#L254">tests/www/views/test_views_base.py:254:16:</a> RUF015 [*] Prefer `next(iter(resp.json.items()))` over single element slice
</pre>

</p>

bokeh (+7, -0)
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/src/bokeh/core/enums.py#L362">src/bokeh/core/enums.py:362:41:</a> RUF015 [*] Prefer `next(iter(zip(*_hatch_patterns)))` over single element slice
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/src/bokeh/embed/standalone.py#L125">src/bokeh/embed/standalone.py:125:22:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/src/bokeh/io/notebook.py#L110">src/bokeh/io/notebook.py:110:24:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/src/bokeh/plotting/_legends.py#L55">src/bokeh/plotting/_legends.py:55:20:</a> RUF015 [*] Prefer `next(iter(legend_kwarg.items()))` over single element slice
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/tests/unit/bokeh/embed/test_standalone.py#L412">tests/unit/bokeh/embed/test_standalone.py:412:20:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/tests/unit/bokeh/embed/test_util__embed.py#L512">tests/unit/bokeh/embed/test_util__embed.py:512:15:</a> RUF015 [*] Prefer `next(iter(docs_json.values()))` over single element slice
+ <a href="https://github.com/bokeh/bokeh/blob/5ad0156dc652746e1b971aaab98bceaa32431e3b/tests/unit/bokeh/embed/test_util__embed.py#L524">tests/unit/bokeh/embed/test_util__embed.py:524:15:</a> RUF015 [*] Prefer `next(iter(docs_json.values()))` over single element slice
</pre>

</p>

scikit-build (+4, -0)
<p>

<pre>
+ <a href="https://github.com/scikit-build/scikit-build/blob/bd8802fb7cbf04e354d0c841efed3c0ee6eff448/skbuild/cmaker.py#L753">skbuild/cmaker.py:753:20:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/scikit-build/scikit-build/blob/bd8802fb7cbf04e354d0c841efed3c0ee6eff448/skbuild/command/egg_info.py#L27">skbuild/command/egg_info.py:27:32:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/scikit-build/scikit-build/blob/bd8802fb7cbf04e354d0c841efed3c0ee6eff448/skbuild/command/egg_info.py#L28">skbuild/command/egg_info.py:28:41:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/scikit-build/scikit-build/blob/bd8802fb7cbf04e354d0c841efed3c0ee6eff448/tests/test_setup.py#L778">tests/test_setup.py:778:22:</a> RUF015 [*] Prefer `next(...)` over single element slice
</pre>

</p>

zulip (+36, -0)
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/analytics/management/commands/populate_analytics_db.py#L158">analytics/management/commands/populate_analytics_db.py:158:67:</a> RUF015 [*] Prefer `next(iter(fixture_data.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/corporate/views/portico.py#L136">corporate/views/portico.py:136:37:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/tools/tests/test_zulint_custom_rules.py#L71">tools/tests/test_zulint_custom_rules.py:71:32:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/lib/event_schema.py#L458">zerver/lib/event_schema.py:458:12:</a> RUF015 [*] Prefer `next(iter(event[&quot;presence&quot;].keys()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/lib/event_schema.py#L460">zerver/lib/event_schema.py:460:12:</a> RUF015 [*] Prefer `next(iter(event[&quot;presence&quot;].values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/lib/markdown/__init__.py#L1155">zerver/lib/markdown/__init__.py:1155:26:</a> RUF015 [*] Prefer `next(iter(uncle.iter(tag=&quot;a&quot;)))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/lib/test_classes.py#L1545">zerver/lib/test_classes.py:1545:16:</a> RUF015 [*] Prefer `next(r for r in data if r[&quot;id&quot;] == db_id)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/openapi/python_examples.py#L626">zerver/openapi/python_examples.py:626:25:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/openapi/python_examples.py#L629">zerver/openapi/python_examples.py:629:28:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_auth_backends.py#L3701">zerver/tests/test_auth_backends.py:3701:29:</a> RUF015 [*] Prefer `next(iter(oidc_setting_dict.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_auth_backends.py#L3751">zerver/tests/test_auth_backends.py:3751:27:</a> RUF015 [*] Prefer `next(iter(mock_oidc_setting_dict.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_auth_backends.py#L3766">zerver/tests/test_auth_backends.py:3766:27:</a> RUF015 [*] Prefer `next(iter(mock_oidc_setting_dict.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_event_system.py#L588">zerver/tests/test_event_system.py:588:30:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_event_system.py#L797">zerver/tests/test_event_system.py:797:26:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_event_system.py#L808">zerver/tests/test_event_system.py:808:26:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_events.py#L1083">zerver/tests/test_events.py:1083:26:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_events.py#L1094">zerver/tests/test_events.py:1094:26:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_gitter_importer.py#L103">zerver/tests/test_gitter_importer.py:103:45:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_gitter_importer.py#L98">zerver/tests/test_gitter_importer.py:98:41:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_logging_handlers.py#L69">zerver/tests/test_logging_handlers.py:69:16:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_message_fetch.py#L2811">zerver/tests/test_message_fetch.py:2811:27:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_message_send.py#L2001">zerver/tests/test_message_send.py:2001:31:</a> RUF015 [*] Prefer `next(iter(recent_conversations.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_message_send.py#L590">zerver/tests/test_message_send.py:590:31:</a> RUF015 [*] Prefer `next(iter(recent_conversations.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_message_send.py#L591">zerver/tests/test_message_send.py:591:24:</a> RUF015 [*] Prefer `next(iter(recent_conversations.keys()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_message_send.py#L615">zerver/tests/test_message_send.py:615:31:</a> RUF015 [*] Prefer `next(iter(recent_conversations.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_message_send.py#L616">zerver/tests/test_message_send.py:616:24:</a> RUF015 [*] Prefer `next(iter(recent_conversations.keys()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/tests/test_users.py#L2161">zerver/tests/test_users.py:2161:27:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/realm_emoji.py#L43">zerver/views/realm_emoji.py:43:18:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/realm_icon.py#L22">zerver/views/realm_icon.py:22:17:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/realm_logo.py#L28">zerver/views/realm_logo.py:28:17:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/upload.py#L272">zerver/views/upload.py:272:17:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/user_settings.py#L366">zerver/views/user_settings.py:366:17:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/users.py#L417">zerver/views/users.py:417:21:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zerver/views/users.py#L559">zerver/views/users.py:559:21:</a> RUF015 [*] Prefer `next(iter(request.FILES.values()))` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zproject/backends.py#L2847">zproject/backends.py:2847:40:</a> RUF015 [*] Prefer `next(...)` over single element slice
+ <a href="https://github.com/zulip/zulip/blob/8743602648d8618ff22b5a2686407f531078af5a/zproject/backends.py#L2874">zproject/backends.py:2874:27:</a> RUF015 [*] Prefer `next(...)` over single element slice
</pre>

</p>

Rules changed: 1

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| RUF015 | 72 | 72 | 0 |</p>
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.8±0.03ms     4.2 MB/sec    1.00      9.8±0.02ms     4.2 MB/sec
formatter/numpy/ctypeslib.py               1.00   1899.3±2.51µs     8.8 MB/sec    1.01   1908.9±4.12µs     8.7 MB/sec
formatter/numpy/globals.py                 1.00    206.8±1.70µs    14.3 MB/sec    1.01    208.4±1.99µs    14.2 MB/sec
formatter/pydantic/types.py                1.00      4.2±0.01ms     6.1 MB/sec    1.00      4.2±0.01ms     6.1 MB/sec
linter/all-rules/large/dataset.py          1.00     13.6±0.06ms     3.0 MB/sec    1.01     13.6±0.02ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.4±0.01ms     4.8 MB/sec    1.01      3.5±0.00ms     4.8 MB/sec
linter/all-rules/numpy/globals.py          1.00    371.5±1.32µs     7.9 MB/sec    1.00    371.6±1.25µs     7.9 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1±0.01ms     4.2 MB/sec    1.01      6.2±0.01ms     4.1 MB/sec
linter/default-rules/large/dataset.py      1.00      7.1±0.01ms     5.8 MB/sec    1.01      7.1±0.01ms     5.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1430.5±2.23µs    11.6 MB/sec    1.01   1448.0±1.49µs    11.5 MB/sec
linter/default-rules/numpy/globals.py      1.00    149.9±0.23µs    19.7 MB/sec    1.01    151.2±0.26µs    19.5 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.1±0.00ms     8.1 MB/sec    1.01      3.2±0.00ms     8.1 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.2±0.26ms     3.6 MB/sec    1.03     11.5±0.45ms     3.5 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.2±0.05ms     7.7 MB/sec    1.04      2.2±0.12ms     7.4 MB/sec
formatter/numpy/globals.py                 1.00    242.2±8.51µs    12.2 MB/sec    1.01   245.2±10.61µs    12.0 MB/sec
formatter/pydantic/types.py                1.00      4.8±0.16ms     5.3 MB/sec    1.01      4.9±0.18ms     5.2 MB/sec
linter/all-rules/large/dataset.py          1.00     15.9±0.43ms     2.6 MB/sec    1.00     15.9±0.48ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.1±0.09ms     4.1 MB/sec    1.04      4.2±0.15ms     3.9 MB/sec
linter/all-rules/numpy/globals.py          1.00   505.0±25.17µs     5.8 MB/sec    1.00   505.8±22.29µs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.1±0.21ms     3.6 MB/sec    1.01      7.2±0.22ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.00      8.3±0.19ms     4.9 MB/sec    1.00      8.3±0.25ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1704.3±40.36µs     9.8 MB/sec    1.02  1732.4±59.36µs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    191.1±3.46µs    15.4 MB/sec    1.04   198.4±12.09µs    14.9 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6±0.08ms     7.0 MB/sec    1.02      3.7±0.09ms     6.9 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-15 00:21</div>
            <div class="timeline-body"><p>I need to change the diagnostic to avoid including the entire snippet if it&#x27;s multi-line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-15 00:22</div>
            <div class="timeline-body"><p>It&#x27;s a lot of new violations but they generally look correct to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2023-07-15 13:18</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoxbro">@hoxbro</a> on 2023-07-15 20:52</div>
            <div class="timeline-body"><p>Sorry for the noise, but isn&#x27;t it possible to reduce <code>next(iter(i + 1 for i in x))</code> down to <code>next(i + 1 for i in x)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-15 20:55</div>
            <div class="timeline-body"><p>Good point!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-20 02:07</div>
            <div class="timeline-body"><p>@zanieb - Do you mind taking a look at this one? I&#x27;d love to get more sets of eyes on whether this is a safe / correct refactor from the Python perspective.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/ruff/rules/unnecessary_iterable_allocation_for_first_element.rs</code>:90 on 2023-07-20 06:59</div>
            <div class="timeline-body"><p>What I understand is that this replaces the whole <code>iterable</code> with <code>...</code> . Is this the intended behavior?</p>
<p>Also be aware, you compare against byte length, not character length (or width)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/ruff/rules/unnecessary_iterable_allocation_for_first_element.rs</code>:238 on 2023-07-20 07:02</div>
            <div class="timeline-body"><p>Nit: I personally prefer match statements when handling both the <code>Some</code> and <code>None</code> case (It&#x27;s likely that our clippy pedantic complains that you should use <code>if... else</code>. I strongly disagree with that because I find match easier to read but that works too :wink:</p>
<pre><code>                }) =&gt; match match_simple_comprehension(elt, generators) {
                	Some(range) =&gt;  IterationTarget { range, iterable: false },
                	None =&gt; IterationTarget { range: arg.range(), iterable: true },
              	},
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/ruff/rules/unnecessary_iterable_allocation_for_first_element.rs</code>:281 on 2023-07-20 07:04</div>
            <div class="timeline-body"><p>Nit: This seems to be the only branch that returns <code>None</code>. I then prefer to write:</p>
<pre><code>let result = match arg {
	...
	// Returns no option
	Expr::ListComp(...) =&gt; IterationTarget {... },
	
	_ =&gt; return None;
};

Some(result)
</code></pre>
<p>It safes you from having to write that many <code>Some</code>&#x27;s</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/ruff/rules/unnecessary_iterable_allocation_for_first_element.rs</code>:299 on 2023-07-20 07:06</div>
            <div class="timeline-body"><p>Nit: You can go funky on match statements</p>
<pre><code>fn match_simple_comprehension(elt: &amp;Expr, generators: &amp;[Comprehension]) -&gt; Option&lt;TextRange&gt; {
    let [generator @ Comprehension { is_async: false, ... } ] = generators else {
        return None;
    };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-20 07:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-20 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/ruff/rules/unnecessary_iterable_allocation_for_first_element.rs</code>:90 on 2023-07-20 16:30</div>
            <div class="timeline-body"><p>Yes, it&#x27;s intended. It avoids excessively long diagnostic messages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-07-20 16:35</div>
            <div class="timeline-body"><p>I&#x27;ve given the ecosystem changes a look and thought about the rule a bit. I can&#x27;t really think of any downsides here other than that it&#x27;s a little advanced for most users in comparison with <code>list(...)[0]</code> and the <code>StopIteration</code> error is definitely less than ideal. I think &quot;suggested&quot; is a good applicability for this fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-21 00:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-21 00:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-21 00:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:55:19 UTC
    </footer>
</body>
</html>
