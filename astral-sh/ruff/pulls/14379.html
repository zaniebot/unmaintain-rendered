<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Simplify some traits in `ast_ids.rs` - astral-sh/ruff #14379</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Simplify some traits in <code>ast_ids.rs</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14379">#14379</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-11-16 15:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Another small cleanup I'm splitting out from the branch I have locally working towards https://github.com/astral-sh/ruff/issues/13933. The traits <code>HasScopedUseId</code> and <code>HasScopedAstId</code> don't need to be generic: for both traits, the <code>Id</code> associated type is the same for all implementations of the trait. We can remove some complexity here by removing the associated types and specifying concrete types in the trait definitions rather than associated types.</p>
<h2>Test Plan</h2>
<p><code>cargo test -p red_knot_python_semantic</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @AlexWaygood on 2024-11-16 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2024-11-16 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2024-11-16 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2024-11-16 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2024-11-16 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-16 15:51</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/semantic_index/ast_ids.rs</code>:79 on 2024-11-16 16:37</div>
            <div class="timeline-body"><p>We should rename the trait if we remove the type parameter to <code>HasScopedExpressionId</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/semantic_index/ast_ids.rs</code>:81 on 2024-11-16 16:37</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    fn scoped_expression_id(&amp;self, db: &amp;dyn Db, scope: ScopeId) -&gt; ScopedExpressionId;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-16 16:39</div>
            <div class="timeline-body"><p>The traits were generic because we used to have many different <code>AstIds</code>, more than just use and expressions.</p>
<p>I do think removing the associated types makes sense if we only have two ids. An alternative design would be to unify the two traits instead, and use the associated type to differentiate between the different ids.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-11-16 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-11-16 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-16 17:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:45 UTC
    </footer>
</body>
</html>
