<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server`: Introduce the `ruff.printDebugInformation` command - astral-sh/ruff #11831</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff server</code>: Introduce the <code>ruff.printDebugInformation</code> command</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11831">#11831</a>
        opened by <a href="https://github.com/snowsignal">@snowsignal</a>
        on 2024-06-10 20:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-10 20:56</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Closes #11715.</p>
<p>Introduces a new command, <code>ruff.printDebugInformation</code>. This will print useful information about the status of the server to <code>stderr</code>.</p>
<p>Right now, the information shown by this command includes:</p>
<ul>
<li>The path to the server executable</li>
<li>The version of the executable</li>
<li>The text encoding being used</li>
<li>The number of open documents and workspaces</li>
<li>A list of registered configuration files</li>
<li>The capabilities of the client</li>
</ul>
<h2>Test Plan</h2>
<p>First, checkout and use <a href="https://github.com/astral-sh/ruff-vscode/pull/495">the corresponding <code>ruff-vscode</code> PR</a>.</p>
<p>Running the <code>Print debug information</code> command in VS Code should show something like the following in the Output channel:</p>
<img width="991" alt="Screenshot 2024-06-11 at 11 41 46 AM" src="https://github.com/astral-sh/ruff/assets/19577865/ab93c009-bb7b-4291-b057-d44fdc6f9f86">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @snowsignal on 2024-06-10 20:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @snowsignal on 2024-06-10 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-06-10 21:10</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_server/src/session/index.rs</code>:196 on 2024-06-11 06:26</div>
            <div class="timeline-body"><p>Nit: The method names suggest that the implementation counts the documents and workspaces but that isn't the case, it just takes the len. Maybe <code>num_documents()</code> and <code>num_workspaces</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-06-11 06:26</div>
            <div class="timeline-body"><p>This is excellent! Do we have a place where we could document the new command? Like, have an issue, run this command and create an issue in the RUff repository.</p>
<p>Would it be possible to show the user a message hinting them that they should look at the output panel? It may otherwise not be clear where they can find the debug output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:44 on 2024-06-11 06:33</div>
            <div class="timeline-body"><p>nit: slight preference to just use <code>==</code> instead (<code>if command == Command::Debug</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:50 on 2024-06-11 06:33</div>
            <div class="timeline-body"><p>You might already be aware of this but printing to stderr is always displayed with Error log level in Neovim. We don't need to solve this here but I'm not sure if the server should print anything to stderr.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-06-11 06:35</div>
            <div class="timeline-body"><p>Thank you for doing this! This will be very helpful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-06-11 06:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:172 on 2024-06-11 06:38</div>
            <div class="timeline-body"><p>nit: would &quot;executable&quot; be more useful than &quot;path&quot; as it's a path to the <code>ruff</code> executable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-06-11 06:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:50 on 2024-06-11 06:41</div>
            <div class="timeline-body"><p>Pyright sends this information as a log message at INFO level: https://github.com/microsoft/pyright/blob/2b0a1d92dda37fb80420e80d1d3933d9287be21f/packages/pyright-internal/src/commands/dumpFileDebugInfoCommand.ts#L239-L241</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-06-11 06:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:50 on 2024-06-11 06:44</div>
            <div class="timeline-body"><p>It's a bit unreadable in Neovim unless the user would manually format it.</p>
<pre><code>[ERROR][2024-06-11 12:14:00] .../vim/lsp/rpc.lua:770	&quot;rpc&quot;	&quot;/Users/dhruv/work/astral/ruff/target/debug/ruff&quot;	&quot;stderr&quot;	'Debug information:\npath = /Users/dhruv/work/astral/ruff/target/debug/ruff\nversion = 0.4.8\nencoding = UTF16\nopen_document_count = 1\nactive_workspace_count = 1\nconfiguration_files = [&quot;/Users/dhruv/playground/ruff/pyproject.toml&quot;, &quot;/Users/dhruv/playground/ruff/repro/ruff.toml&quot;]\ncapabilities.code_action_deferred_edit_resolution = true\ncapabilities.apply_edit = true\ncapabilities.document_changes = false\ncapabilities.workspace_refresh = true\ncapabilities.pull_diagnostics = true\n\n    \n'
</code></pre>
<p>Edit: Compared to sending this as a log message (Pyright's output as an example):</p>
<pre><code>2024-05-19 09:37:35 [INFO] * Dump debug info for '/Users/dhruv/playground/ruff/parser/_.py'
* Token info (5 tokens)
[0] '/Users/dhruv/playground/ruff/parser/_.py:1:1' (Identifier, (0,0)-(0,1)) {&quot;start&quot;:0,&quot;length&quot;:1,&quot;type&quot;:7,&quot;value&quot;:&quot;x&quot;}
[1] '/Users/dhruv/playground/ruff/parser/_.py:1:3' (Operator, Assign, (0,2)-(0,3)) {&quot;start&quot;:2,&quot;length&quot;:1,&quot;type&quot;:9,&quot;operatorType&quot;:2}
[2] '/Users/dhruv/playground/ruff/parser/_.py:1:5' (Number, (0,4)-(0,5)) {&quot;start&quot;:4,&quot;length&quot;:1,&quot;type&quot;:6,&quot;isInteger&quot;:true,&quot;isImaginary&quot;:false,&quot;value&quot;:1}
[3] '/Users/dhruv/playground/ruff/parser/_.py:1:6' (NewLine, LineFeed, (0,5)-(1,0)) {&quot;start&quot;:5,&quot;length&quot;:1,&quot;type&quot;:2,&quot;newLineType&quot;:1}
[4] '/Users/dhruv/playground/ruff/parser/_.py:2:1' (EndOfStream, (1,0)-(1,0)) {&quot;start&quot;:6,&quot;length&quot;:0,&quot;type&quot;:1}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-06-11 14:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:44 on 2024-06-11 14:21</div>
            <div class="timeline-body"><p>The advantage of <code>let</code> is that we don't need to add a <code>PartialEq</code> implementation to <code>Command</code> - but that's fine, I'm not that opinionated on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-06-11 14:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:50 on 2024-06-11 14:23</div>
            <div class="timeline-body"><p>Sure, we can make this a log message. This means it won't appear on Helix, but Helix doesn't support LSP commands anyway, so it should be fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @snowsignal on 2024-06-11 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @snowsignal on 2024-06-11 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-11 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rainzee">@rainzee</a> on 2024-06-12 08:46</div>
            <div class="timeline-body"><p>Considering a command that could be added to vsc? Using the C-S-p command center</p>
<p><img src="https://github.com/astral-sh/ruff/assets/4585440/1ea1f771-ca86-44da-8a3b-2f549c8407b1" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-12 08:48</div>
            <div class="timeline-body"><p>@rainzee I think https://github.com/astral-sh/ruff-vscode/pull/495 does that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_server/src/server/api/requests/execute_command.rs</code>:50 on 2024-06-13 03:06</div>
            <div class="timeline-body"><p>Thank you for doing that! Now, it's much better:</p>
<pre><code>2024-06-13 07:58:53 [INFO] executable = /Users/dhruv/work/astral/ruff/target/debug/ruff
version = 0.4.8
encoding = UTF16
open_document_count = 1
active_workspace_count = 1
configuration_files = [&quot;/Users/dhruv/playground/ruff/pyproject.toml&quot;, &quot;/Users/dhruv/playground/ruff/repro/ruff.toml&quot;]
capabilities.code_action_deferred_edit_resolution = true
capabilities.apply_edit = true
capabilities.document_changes = false
capabilities.workspace_refresh = true
capabilities.pull_diagnostics = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-06-13 03:06</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:56:33 UTC
    </footer>
</body>
</html>
