<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add progress bar for `ty check` - astral-sh/ruff #17965</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add progress bar for <code>ty check</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17965">#17965</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2025-05-08 20:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-05-08 20:09</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Adds a simple progress bar for the <code>ty check</code> CLI command. The style is taken from uv, and like uv the bar is always shown - for smaller projects it is fast enough that it isn't noticeable. We could alternatively hide it completely based on some heuristic for the number of files, or only show it after some amount of time.</p>
<p>I also disabled it when <code>--watch</code> is passed, cancelling inflight checks was leading to zombie progress bars. I think we can fix this by using <a href="https://docs.rs/indicatif/latest/indicatif/struct.MultiProgress.html"><code>MultiProgress</code></a> and managing all the bars globally, but I left that out for now.</p>
<p>Resolves https://github.com/astral-sh/ty/issues/98.</p>
<h2>Test Plan</h2>
<p>https://github.com/user-attachments/assets/1e6b76c6-f6cb-4967-8194-e774879b6dd1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @ibraheemdev on 2025-05-08 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-08 20:24</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-08 20:25</div>
            <div class="timeline-body"><p>This looks great.</p>
<p>I'm a bit concerned that this logic is now inside the ty_projects crate.  The crate tries (it doesn't fully succeed) to be mostly CLI independent because it's used from wasm, the lsp and the CLI</p>
<p>Would it be much harder if the progress reporting would be injected from outside so that each implementation can decide on how to report progress?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-05-08 20:28</div>
            <div class="timeline-body"><blockquote>
<p>I'm a bit concerned that this logic is now inside the ty_projects crate. The crate tries (it doesn't fully succeed) to be mostly CLI independent because it's used from wasm, the lsp and the CLI</p>
</blockquote>
<p>Ah I was wondering about that but wasn't fully sure. I can move the logic out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-08 20:30</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/mesonbuild/meson-python">mesonbuild/meson-python</a> (error)</summary>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to read tests/packages/symlinks/baz.py: No such file or directory (os error 2)
error: Failed to read tests/packages/symlinks/qux.py: No such file or directory (os error 2)
</code></pre>
</p>
</details>

<h3>Formatter (preview)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/mesonbuild/meson-python">mesonbuild/meson-python</a> (error)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to read tests/packages/symlinks/baz.py: No such file or directory (os error 2)
error: Failed to read tests/packages/symlinks/qux.py: No such file or directory (os error 2)
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-05-08 23:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-08 23:11</div>
            <div class="timeline-body"><p>This is awesome! I'll prefer to let Micha review the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty/src/main.rs</code>:236 on 2025-05-09 06:27</div>
            <div class="timeline-body"><p>Nit: Should we have a <code>run</code> and a <code>run_with_progress</code> method. It would reduce the amount of changes necessary (and you could implement <code>Reporter</code> for <code>()</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/lib.rs</code>:217 on 2025-05-09 06:28</div>
            <div class="timeline-body"><p>Huh. I didn't know this works, but makes sense!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-05-09 06:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty/src/main.rs</code>:236 on 2025-05-09 15:11</div>
            <div class="timeline-body"><p>I try to avoid implementing traits for <code>()</code>, I find a named unit struct clearer, but I don't feel to strongly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-05-09 15:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-09 15:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty/src/main.rs</code>:236 on 2025-05-09 15:17</div>
            <div class="timeline-body"><p>I also have no strong preferences.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ibraheemdev on 2025-05-09 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2025-05-09 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-09 17:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:57:31 UTC
    </footer>
</body>
</html>
