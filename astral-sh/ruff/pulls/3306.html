<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detect quote style ignoring docstrings - astral-sh/ruff #3306</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Detect quote style ignoring docstrings</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3306">#3306</a>
        opened by <a href="https://github.com/bz2">@bz2</a>
        on 2023-03-02 14:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/bz2">@bz2</a> on 2023-03-02 14:29</div>
            <div class="timeline-body"><p>Currently the quote style of the first string in a file is used for autodetecting what to use when rewriting code for fixes. This is an okay heuristic, but often the first line in a file is a docstring, rather than a string constant, and it's not uncommon for pre-Black code to have different quoting styles for those.</p>
<p>For example, in the Google style guide:
https://google.github.io/styleguide/pyguide.html</p>
<blockquote>
<p>Be consistent with your choice of string quote character within a file. Pick ' or &quot; and stick with it. ... Docstrings must use &quot;&quot;&quot; regardless.</p>
</blockquote>
<p>This branch adjusts the logic to instead skip over any <code>&quot;&quot;&quot;</code> triple doublequote string tokens. The default, if there are no single quoted strings, is still to use double quote as the style.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 04:58</div>
            <div class="timeline-body"><p>This seems like a reasonable change, though I guess it'll still have the potential to get things &quot;wrong&quot;, since you could be using single quotes in your project, but have one file with a top-level docstring and nothing else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 04:59</div>
            <div class="timeline-body"><p>(We could, in addition, let you specify a quote style for fixes. We'll want to do this anyway once we introduce the autoformatter. But what you have here seems like an improvement over the status quo anyway.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-03 04:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-03 04:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bz2">@bz2</a> on 2023-03-03 16:02</div>
            <div class="timeline-body"><p>@charliermarsh Thanks for landing!</p>
<p>Yeah, there are still various ways the heuristic can fail, but need to know more about the formatting to do better. Rules like <code>D300</code> could inform, but there are lots of little edge cases for string literals that aren't amenable to linting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-03-03 16:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:41:41 UTC
    </footer>
</body>
</html>
