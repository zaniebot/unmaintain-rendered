<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] disable division-by-zero by default - astral-sh/ruff #18220</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] disable division-by-zero by default</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18220">#18220</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-05-20 14:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>I think <code>division-by-zero</code> is a low-value diagnostic in general; most real division-by-zero errors (especially those that are less obvious to the human eye) will occur on values typed as <code>int</code>, in which case we don't issue the diagnostic anyway. Mypy and pyright do not emit this diagnostic.</p>
<p>Currently the diagnostic is prone to false positives because a) we do not silence it in unreachable code, and b) we do not implement narrowing of literals from inequality checks. We will probably fix (a) regardless, but (b) is low priority apart from division-by-zero.</p>
<p>I think we have many more important things to do and should not allow false positives on a low-value diagnostic to be a distraction. Not opposed to re-enabling this diagnostic in future when we can prioritize reducing its false positives.</p>
<p>References https://github.com/astral-sh/ty/issues/443</p>
<h2>Test Plan</h2>
<p>Existing tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @carljm on 2025-05-20 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @carljm on 2025-05-20 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @carljm on 2025-05-20 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-20 14:55</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-20 14:59</div>
            <div class="timeline-body"><p>We should re-enable it for mypy primer here https://github.com/astral-sh/ruff/blob/main/.github/mypy-primer-ty.toml</p>
<p>I'm also not sure if we should disable it. I found the feedback around narrowing limitations useful and we'll miss out on that when it's disabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-20 15:09</div>
            <div class="timeline-body"><blockquote>
<p>I'm also not sure if we should disable it. I found the feedback around narrowing limitations useful and we'll miss out on that when it's disabled.</p>
</blockquote>
<p>I feel strongly that we need to improve our focus on the most important issues and avoid (ourselves and our users) being distracted by low-priority issues. If we keep it enabled in the ecosystem, we don't lose this feedback when we choose to make it a priority.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @carljm on 2025-05-20 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-20 15:13</div>
            <div class="timeline-body"><p>You also need to update the CLI tests. It's used a lot in there because it was one of the first rules that triggered (and it doesn't requier a lot of set up code)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "disable division-by-zero by default" to "[ty] disable division-by-zero by default" by @AlexWaygood on 2025-05-20 15:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-05-20 15:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-20 15:39</div>
            <div class="timeline-body"><blockquote>
<p>You also need to update the CLI tests. It's used a lot in there because it was one of the first rules that triggered (and it doesn't requier a lot of set up code)</p>
</blockquote>
<p>Thanks. I was able to update those tests without having to change the code examples -- the same properties of the configuration can be demonstrated by going from &quot;ignored&quot; to &quot;warn&quot; as were previously demonstrated by going from &quot;error&quot; to &quot;warn&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-05-20 16:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @carljm on 2025-05-20 18:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-05-20 18:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-20 18:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 10:51</div>
            <div class="timeline-body"><blockquote>
<p>b) we do not implement narrowing of literals from inequality checks. We will probably fix (a) regardless, but (b) is low priority apart from division-by-zero.</p>
</blockquote>
<p>Small correction: we <em>do</em> narrow literals from (in)equality checks, but we don't yet narrow literals from <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code> or <code>&gt;=</code> checks: https://play.ty.dev/746ed0da-8731-41f4-b77d-c4cfb8eb7eb2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-27 13:07</div>
            <div class="timeline-body"><p>Yes, that's what I meant. I guess there isn't a simple term for just  &quot;greater or less-than checks&quot;!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:12:48 UTC
    </footer>
</body>
</html>
