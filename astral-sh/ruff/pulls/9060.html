<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detect `unused-asyncio-dangling-task` (`RUF006`) on unused assignments - astral-sh/ruff #9060</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Detect <code>unused-asyncio-dangling-task</code> (<code>RUF006</code>) on unused assignments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9060">#9060</a>
        opened by <a href="https://github.com/asafamr-mm">@asafamr-mm</a>
        on 2023-12-08 21:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/asafamr-mm">@asafamr-mm</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes #8863 : Detect asyncio-dangling-task (RUF006) when discarding return value</p>
<h2>Test Plan</h2>
<p>added new two testcases, changed result of an old one that was made more specific</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-12-08 21:25</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-12-08 22:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/statement.rs</code>:1565 on 2023-12-08 22:15</div>
            <div class="timeline-body"><p>Why this change? This doesn't match the pattern we use to add a diagnostic for other rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/statement.rs</code>:1565 on 2023-12-08 22:24</div>
            <div class="timeline-body"><p>Probably because it <em>is</em> the pattern we use for the deferred scopes diagnostics, since they can't take a <code>mut</code> on <code>Checker</code> :)</p>
<p>I'd probably prefer changing the rule to return <code>Option&lt;Diagnostic&gt;</code> though, and then pushing onto the appropriate vector. That should work fine for both call-sites.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-08 22:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-08 22:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/ruff/rules/asyncio_dangling_task.rs</code>:130 on 2023-12-08 22:24</div>
            <div class="timeline-body"><p>Nice job figuring this out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/ruff/rules/asyncio_dangling_task.rs</code>:130 on 2023-12-08 22:27</div>
            <div class="timeline-body"><p>Can you try using <code>typing::analyze::resolve_assignment</code> here instead? It will also handle <code>AnnAssign</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-08 22:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-08 22:27</div>
            <div class="timeline-body"><p>Nice job! A few small comments. Thank you so much for taking this on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-12-09 01:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/statement.rs</code>:1565 on 2023-12-09 01:02</div>
            <div class="timeline-body"><p>:D Don't listen to me listen to Charlie.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/asafamr-mm">@asafamr-mm</a> reviewed on 2023-12-09 20:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/asafamr-mm">@asafamr-mm</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/statement.rs</code>:1565 on 2023-12-09 20:09</div>
            <div class="timeline-body"><p>üëç changed to <code>Option&lt;Diagnostic&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/asafamr-mm">@asafamr-mm</a> reviewed on 2023-12-09 20:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/asafamr-mm">@asafamr-mm</a> on <code>crates/ruff_linter/src/rules/ruff/rules/asyncio_dangling_task.rs</code>:130 on 2023-12-09 20:49</div>
            <div class="timeline-body"><p>Hmm, not sure how to do it without some refactoring.
I currently use assignment value expression which (if I'm not mistaken) is discarded after processing in <code>resolve_assignment</code>?</p>
<p>For now I've extended the pattern match to include AnnAssign as done in <a href="https://github.com/asafamr-mm/ruff/blob/00bcfc87c8b5d1380f4902d4019205b2840caac6/crates/ruff_linter/src/rules/perflint/rules/unnecessary_list_cast.rs#L120">unnecessary_list_cast</a> - but would gladly change it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-12-09 21:05</div>
            <div class="timeline-body"><p>Thanks again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "RUF006 unused asyncio dangling task should trigger " to "Detect `unused-asyncio-dangling-task` (`RUF006`) on unused assignments" by @charliermarsh on 2023-12-09 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-12-09 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-12-09 21:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-09 21:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2023-12-23 17:38</div>
            <div class="timeline-body"><p>I think this PR has caused ruff to start complaining even when assignments are to globals and nonlocals. Is that intentional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-23 18:16</div>
            <div class="timeline-body"><p>@hauntsaninja - probably not ‚Äî if you share an example I‚Äôm happy to ensure it‚Äôs fixed in the next release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2023-12-23 19:04</div>
            <div class="timeline-body"><p>Thanks, filed https://github.com/astral-sh/ruff/issues/9262 !</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:01:46 UTC
    </footer>
</body>
</html>
