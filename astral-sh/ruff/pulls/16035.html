<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix reference definition labels for backtick-quoted shortcut links - astral-sh/ruff #16035</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix reference definition labels for backtick-quoted shortcut links</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16035">#16035</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2025-02-08 01:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body">Summary
<p>Resolves #16010.</p>
<p>The changes boil down to something like this:</p>
<pre><code>-/// The [FastAPI documentation] recommends the use of [`typing.Annotated`]
+/// The [FastAPI documentation] recommends the use of [`typing.Annotated`][typing-annotated]

-/// [typing.Annotated]: https://docs.python.org/3/library/typing.html#typing.Annotated
+/// [typing-annotated]: https://docs.python.org/3/library/typing.html#typing.Annotated
</code></pre>
Test Plan
<p>Mkdocs:</p>
<p><img src="https://github.com/user-attachments/assets/a2e6bf22-56fa-4b2c-9500-1c1256c5a218" alt=""></p>
<p>GitHub:</p>
<blockquote>
Why is this bad?
<p>The <a href="https://fastapi.tiangolo.com/tutorial/query-params-str-validations/?h=annotated#advantages-of-annotated">FastAPI documentation</a> recommends the use of <a href="https://docs.python.org/3/library/typing.html#typing.Annotated"><code>typing.Annotated</code></a></p>
<p>...</p>
</blockquote>
<p><a href="https://spec.commonmark.org/dingus/?text=%23%23%20Why%20is%20this%20bad%3F%0AThe%20%5BFastAPI%20documentation%5D%20recommends%20the%20use%20of%20%5B%60typing.Annotated%60%5D%5Btyping-annotated%5D%0A%0A...%0A%0A%5BFastAPI%20documentation%5D%3A%20https%3A%2F%2Ffastapi.tiangolo.com%2Ftutorial%2Fquery-params-str-validations%2F%3Fh%3Dannotated%23advantages-of-annotated%0A%5Btyping-annotated%5D%3A%20https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Ftyping.html%23typing.Annotated">CommonMark dingus</a>:</p>
<pre><code>&lt;h2&gt;Why is this bad?&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://fastapi.tiangolo.com/tutorial/query-params-str-validations/?h=annotated#advantages-of-annotated&quot;&gt;FastAPI documentation&lt;/a&gt; recommends the use of &lt;a href=&quot;https://docs.python.org/3/library/typing.html#typing.Annotated&quot;&gt;&lt;code&gt;typing.Annotated&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;...&lt;/p&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-02-08 01:36</div>
            <div class="timeline-body"><p>That Mkdocs recognizes links like <code>[`typing.Annotated`]</code> in the first place is probably because it uses <a href="https://github.com/Python-Markdown/markdown">@Python-Markdown/markdown</a>, an implementation of the original Markdown rather than CommonMark or GFM.</p>
<hr>
<p>I <em>think</em> that&#x27;s all of them. More importantly, there should be a test somewhere so that such a link can&#x27;t possibly be accidentally introduced again. Where would I even put that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-08 01:40</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Daverball">@Daverball</a> on 2025-02-08 08:45</div>
            <div class="timeline-body"><blockquote>
<p>I <em>think</em> that&#x27;s all of them. More importantly, there should be a test somewhere so that such a link can&#x27;t possibly be accidentally introduced again. Where would I even put that?</p>
</blockquote>
<p>Possibly here? https://github.com/astral-sh/ruff/blob/main/scripts/check_docs_formatted.py</p>
<p>That&#x27;s where all of the other custom docs checks appear to happen. Although the main purpose appears to be ensuring that the examples are formatted correctly, there are a couple of unrelated checks as well, like ensuring the required sections for rule docs are present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Daverball">@Daverball</a> reviewed on 2025-02-08 09:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Daverball">@Daverball</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unsafe_markup_use.rs</code>:73 on 2025-02-08 09:02</div>
            <div class="timeline-body"><p>This is getting rid of the link in the references section (which is rendered), so I don&#x27;t think we want to remove this. You could omit the explicit url portion of the reference, since it&#x27;s technically redundant, although given that the labels in  the references section are sometimes changed to a more verbose, descriptive, style, I used an explicit link, so changing the label later on is easy. I don&#x27;t think i have seen any shortcut links be used in other references sections.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2025-02-08 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unsafe_markup_use.rs</code>:73 on 2025-02-08 17:15</div>
            <div class="timeline-body"><p>The same link has also been referenced 4 times right above. I suppose I should remove them instead of this one.</p>
<p>See also <a href="https://en.wikipedia.org/wiki/Wikipedia:Manual_of_Style/Linking#Duplicate_and_repeat_links">Wikipedia&#x27;s guide on duplicate links</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-02-08 17:28</div>
            <div class="timeline-body"><blockquote>
<p>Possibly here? https://github.com/astral-sh/ruff/blob/main/scripts/check_docs_formatted.py</p>
</blockquote>
<p>Section headers and code blocks are easy to check for, but inline links aren&#x27;t. I imagine that would take quite some manual parsing/regexes on top of a list of every option known to Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-08 17:50</div>
            <div class="timeline-body"><p>Would you mind updating your test plan and showing the rendered documentation for a page before/after your change (doesn&#x27;t have to be for all of them, just pick one ;))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-08 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-10 08:54</div>
            <div class="timeline-body"><p>It would be great if we&#x27;d have some linting or at least, guidance in the contribution guidelines. I otherwise worry, that we&#x27;ll introduce incompatible links in the future. But that&#x27;s something we can do separately.</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-10 08:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-10 08:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-10 16:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:11:15 UTC
    </footer>
</body>
</html>
