<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Fix false positives and negatives in `RUF010` - astral-sh/ruff #18690</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Fix false positives and negatives in <code>RUF010</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18690">#18690</a>
        opened by <a href="https://github.com/LaBatata101">@LaBatata101</a>
        on 2025-06-15 23:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a></div>
            <div class="timeline-body">

Summary
<p>The fix is suppressed if the f-string has debug text or call expression arguments contains a starred expression, ex:</p>
<pre><code>f&quot;{ascii(1)=}&quot;
f&quot;{ascii(*arg)}&quot;
</code></pre>
<p>Fixes #16325</p>


Test Plan
<p>Add regression tests</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-15 23:26</div>
            <div class="timeline-body"><p>I don&#x27;t get why the rule is not being trigged for the tests I added when ran with <code>cargo test</code>. But it&#x27;s fine in a standalone file.</p>
<pre><code>f&quot;{str({})}&quot;

f&quot;{ascii({} | {})}&quot;

import builtins

f&quot;{builtins.repr(1)}&quot;

f&quot;{ascii(1)=}&quot;

f&quot;{ascii(lambda: 1)}&quot;

f&quot;{ascii(x := 2)}&quot;

</code></pre>
<p>Running with <code>cargo run -p ruff -- check sample.py --preview --no-cache --select RUF010 </code> give me these diagnostics</p>
<pre><code>sample2.py:1:4: RUF010 [*] Use explicit conversion flag
  |
1 | f&quot;{str({})}&quot;
  |    ^^^^^^^ RUF010
2 |
3 | f&quot;{ascii({} | {})}&quot;
  |
  = help: Replace with conversion flag

sample2.py:3:4: RUF010 [*] Use explicit conversion flag
  |
1 | f&quot;{str({})}&quot;
2 |
3 | f&quot;{ascii({} | {})}&quot;
  |    ^^^^^^^^^^^^^^ RUF010
4 |
5 | import builtins
  |
  = help: Replace with conversion flag

sample2.py:7:4: RUF010 [*] Use explicit conversion flag
  |
5 | import builtins
6 |
7 | f&quot;{builtins.repr(1)}&quot;
  |    ^^^^^^^^^^^^^^^^ RUF010
8 |
9 | f&quot;{ascii(1)=}&quot;
  |
  = help: Replace with conversion flag

sample2.py:9:4: RUF010 Use explicit conversion flag
   |
 7 | f&quot;{builtins.repr(1)}&quot;
 8 |
 9 | f&quot;{ascii(1)=}&quot;
   |    ^^^^^^^^ RUF010
10 |
11 | f&quot;{ascii(lambda: 1)}&quot;
   |
   = help: Replace with conversion flag

sample2.py:11:4: RUF010 [*] Use explicit conversion flag
   |
 9 | f&quot;{ascii(1)=}&quot;
10 |
11 | f&quot;{ascii(lambda: 1)}&quot;
   |    ^^^^^^^^^^^^^^^^ RUF010
12 |
13 | f&quot;{ascii(x := 2)}&quot;
   |
   = help: Replace with conversion flag

sample2.py:13:4: RUF010 [*] Use explicit conversion flag
   |
11 | f&quot;{ascii(lambda: 1)}&quot;
12 |
13 | f&quot;{ascii(x := 2)}&quot;
   |    ^^^^^^^^^^^^^ RUF010
   |
   = help: Replace with conversion flag

Found 6 errors.
[*] 5 fixable with the `--fix` option.
</code></pre>
<p>But in the tests it only flags for the <code>f&quot;{str({})}&quot;</code> and <code>f&quot;{builtins.repr(1)}&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-16 08:23</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t get why the rule is not being trigged for the tests I added when ran with <code>cargo test</code>. But it&#x27;s fine in a standalone file.</p>
</blockquote>
<p>i think you forgot to add a new snapshot</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-16 14:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-16 14:13</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-17 05:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:101 on 2025-06-20 07:09</div>
            <div class="timeline-body"><p>I think we should move this right after line 72 or integrate it into the match on line 74 like so:</p>
<pre><code>        let Some(builtin_symbol) = checker.semantic().resolve_builtin_symbol(&amp;call.func) else {
	continue;
}

        let arg = match builtin_symbol {
            // Handles the cases: `f&quot;{str(object=arg)}&quot;` and `f&quot;{str(arg)}&quot;`
            &quot;str&quot; if call.arguments.len() == 1 =&gt; {
                let Some(arg) = call.arguments.find_argument_value(&quot;object&quot;, 0) else {
                    continue;
                };
                arg
            }
            &quot;repr&quot; | &quot;ascii&quot; =&gt; {
                // Can&#x27;t be a conversion otherwise.
                if !call.arguments.keywords.is_empty() {
                    continue;
                }

                // Can&#x27;t be a conversion otherwise.
                let [arg] = call.arguments.args.as_ref() else {
                    continue;
                };
                arg
            },
						_ =&gt; continue,
        };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:131 on 2025-06-20 07:11</div>
            <div class="timeline-body"><p>Can&#x27;t we match on the <code>builtin_symbol</code> here (e.g. by having a <code>Conversion</code> enum that we resolve early on) rather than resolving the caller name again?</p>
<p>That should also remove the unreachable <code>anyhow::bail</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:172 on 2025-06-20 07:13</div>
            <div class="timeline-body"><p>I think this is overly strict. What we want here is to know if the left-most expression has a curly brace. See https://github.com/astral-sh/ruff/blob/45cd117ea4a361db9041304462bca7b8be7a8a80/crates/ruff_python_formatter/src/other/interpolated_string_element.rs#L276</p>
<p>An easier approach here could be to inspect the token stream instead and see if the first token in the expression body is a <code> {</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:118 on 2025-06-20 07:15</div>
            <div class="timeline-body"><p>Can you explain why it&#x27;s necessary to rewrite the entire fix here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-20 07:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-20 14:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:118 on 2025-06-20 14:11</div>
            <div class="timeline-body"><p>With <code>transform_expression</code> I didn&#x27;t have much control of how the f-string output was created. I didn&#x27;t find a way to handle the special cases for curly braces, which we need to prepend a white space, and the lambda/named expressions that needed to be parenthesized.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-20 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-23 08:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:133 on 2025-06-23 08:28</div>
            <div class="timeline-body"><p>I don&#x27;t think this is correct. E.g we don&#x27;t want to add a space for an expression like:</p>
<pre><code>1 if b({ &quot;key&quot;: &quot;test&quot; }) else 10
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-23 08:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:118 on 2025-06-23 08:30</div>
            <div class="timeline-body"><p>Can&#x27;t we do the same as you&#x27;re doing here by:</p>
<ol>
<li>Testing if the expression starts with a <code>{</code></li>
<li>If so, pad the start with a space</li>
</ol>
<p>Another option would be to preserve the whitespace between <code>{</code> and the <code>expression</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-23 14:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:118 on 2025-06-23 14:27</div>
            <div class="timeline-body"><p>It could probably work for the <code>{</code> case, but for the case where we need to parenthesize the <code>lambda</code> and <code>named</code> expression, I think it wouldn&#x27;t work. In the previous implementation of the fix, it would change the node fields to apply the fix and then use the node to generate the string. There is no way -- at least I couldn&#x27;t find it -- to tell the code that is generating the string from the node to parenthesize the <code>lambda</code> /<code>named</code> expression before the conversion flag.</p>
<p>Basically, there&#x27;s no way of telling it to do this part:
https://github.com/astral-sh/ruff/blob/9c2bce2758fb618c0eb4c50fe250b52eccee84c2/crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs#L141-L142</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-23 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:118 on 2025-06-23 14:44</div>
            <div class="timeline-body"><p>Can&#x27;t we do the wrapping on <code>output</code>?</p>
<pre><code>.map(|output| Fix::safe_edit(Edit::range_replacement(format!(&quot; {output}), f_string.range())))
</code></pre>
<p>I wasn&#x27;t aware of the lambda changes (doesn&#x27;t seem to be mentioned in the summary). Could we, once again, try to preserve the parentheses instead of adding special handling?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-23 22:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:118 on 2025-06-23 22:45</div>
            <div class="timeline-body"><blockquote>
<p>doesn&#x27;t seem to be mentioned in the summary</p>
</blockquote>
<p>My bad, sorry.</p>
<p>Ok, so I managed to use the old fix implementation for the changes. But there is still the need for this check:
https://github.com/astral-sh/ruff/blob/568f4f4c3608d8a302235cdc04d0afca1f8b2da8/crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs#L188-L190
because we can&#x27;t use <code>parenthesized_range</code> with the nodes from <code>libcst</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:160 on 2025-06-24 08:32</div>
            <div class="timeline-body"><p>Can we use the <code>conversion</code> that we extracted in the outer call instead of matching on <code>name.value</code>. This would allow us to remove this arm entirely</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-24 08:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-24 08:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:142 on 2025-06-24 08:36</div>
            <div class="timeline-body"><p>I suggest moving this out of <code>convert_call_to_conversion_flag</code> as this is a known limitations that doesn&#x27;t require logging when it fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:110 on 2025-06-24 08:37</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code>        if arg.is_expr_starred() {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:181 on 2025-06-24 08:39</div>
            <div class="timeline-body"><p>This incorrectly returns <code>false</code> for</p>
<pre><code>a = &quot;some string&quot;
f&quot;{repr({a: 1} + b)}&quot;
</code></pre>
<p>We need to look at the left most expression.</p>
<p>I think the easiest is to look at the token stream and see if the first non trivia token is a <code>{</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:175 on 2025-06-24 08:40</div>
            <div class="timeline-body"><p>Can&#x27;t we move this into the <code>map</code> arm and make it based on Ruff&#x27;s input AST?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-24 08:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:175 on 2025-06-24 13:15</div>
            <div class="timeline-body"><p>I think we can&#x27;t do that without reparsing the f-string expression, because in the <code>map</code> arm we only have the generated string of the <code>fstring</code> CST node.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-24 13:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-24 14:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-24 14:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:175 on 2025-06-24 14:29</div>
            <div class="timeline-body"><p>but can&#x27;t we inspect the <code>f_string</code> variable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:175 on 2025-06-25 00:49</div>
            <div class="timeline-body"><p>We can, but I don&#x27;t see how it is going to help. In the <code>map</code> we already have the built fix string, and in this case we don&#x27;t want to parenthesize the entire f-string, just a part of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-25 00:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:185 on 2025-06-25 08:23</div>
            <div class="timeline-body"><p>We should add tests demonstrating this behavior. I think this is also another place where we could use <code>OperatorPrecedence</code> instead of listing all expressions where any precedence lower or equal to lambda require parenthesizing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:175 on 2025-06-25 08:26</div>
            <div class="timeline-body"><p>That&#x27;s what I had in mind:</p>
<pre><code>Subject: [PATCH] Rename `knot_benchmark` to `ty_benchmark`
---
Index: crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs b/crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs
--- a/crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs	(revision 13921af61d95c86f1cddfbad51471c0654b72162)
+++ b/crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs	(date 1750839908748)
@@ -122,7 +122,7 @@
         }
 
         diagnostic.try_set_fix(|| {
-            convert_call_to_conversion_flag(checker, conversion, f_string, index, element)
+            convert_call_to_conversion_flag(checker, conversion, f_string, index, arg)
         });
     }
 }
@@ -133,7 +133,7 @@
     conversion: Conversion,
     f_string: &amp;ast::FString,
     index: usize,
-    element: &amp;InterpolatedStringElement,
+    arg: &amp;Expr,
 ) -&gt; Result&lt;Fix&gt; {
     let source_code = checker.locator().slice(f_string);
     transform_expression(source_code, checker.stylist(), |mut expression| {
@@ -145,7 +145,7 @@
 
         formatted_string_expression.conversion = Some(conversion.as_str());
 
-        if contains_brace(checker, element) {
+        if starts_with_lbrace(checker, arg) {
             formatted_string_expression.whitespace_before_expression = space();
         }
 
@@ -163,26 +163,19 @@
     .map(|output| Fix::safe_edit(Edit::range_replacement(output, f_string.range())))
 }
 
-fn contains_brace(checker: &amp;Checker, element: &amp;InterpolatedStringElement) -&gt; bool {
-    let Some(interpolation) = element.as_interpolation() else {
-        return false;
-    };
-    let Some(call) = interpolation.expression.as_call_expr() else {
-        return false;
-    };
-
+fn starts_with_lbrace(checker: &amp;Checker, arg: &amp;Expr) -&gt; bool {
     checker
         .tokens()
-        .after(call.arguments.start())
+        .in_range(arg.range())
         .iter()
         // Skip the trivia tokens and the `(` from the arguments
         .find(|token| !token.kind().is_trivia() &amp;&amp; token.kind() != TokenKind::Lpar)
         .is_some_and(|token| matches!(token.kind(), TokenKind::Lbrace))
 }
 
-fn needs_paren(expr: &amp;Expression) -&gt; bool {
-    matches!(expr, Expression::Lambda(_) | Expression::NamedExpr(_))
-}
+// fn needs_paren(expr: &amp;Expr) -&gt; bool {
+//     matches!(expr, Expr::Lambda(_) | Expr::Named(_))
+// }
 
 /// Represents the three built-in Python conversion functions that can be replaced
 /// with f-string conversion flags.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-25 08:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-25 21:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:185 on 2025-06-25 21:20</div>
            <div class="timeline-body"><blockquote>
<p>We should add tests demonstrating this behavior.</p>
</blockquote>
<p>We already have it, here:
https://github.com/astral-sh/ruff/blob/13921af61d95c86f1cddfbad51471c0654b72162/crates/ruff_linter/resources/test/fixtures/ruff/RUF010.py#L50-L52</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-06-25 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-26 08:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:185 on 2025-06-26 08:21</div>
            <div class="timeline-body"><p>It might then be unnecessary? Because I don&#x27;t see any failing tests if I change the code to:</p>
<pre><code>        formatted_string_expression.expression =
        // if needs_paren(OperatorPrecedence::from_expr(arg))
        // {
        //     call.args[0]
        //         .value
        //         .clone()
        //         .with_parens(LeftParen::default(), RightParen::default())
        // } else {
            call.args[0].value.clone();
        // };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:174 on 2025-06-26 08:28</div>
            <div class="timeline-body"><p>I don&#x27;t think we still need to skip over lparentheses still because we&#x27;re now only iterating over the <code>arg</code> tokens?</p>
<pre><code>    checker
        .tokens()
        .in_range(arg.range())
        .iter()
        // Skip the trivia tokens and the `(` from the arguments
        .skip_while(|token| token.kind().is_trivia())
        .next()
        .is_some_and(|token| matches!(token.kind(), TokenKind::Lbrace))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-26 08:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-26 14:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:185 on 2025-06-26 14:01</div>
            <div class="timeline-body"><p>Oh, the diagnostic was not triggering for those cases in the test file because the <code>ascii</code> binding is being shadowed. I didn&#x27;t notice that, thanks for pointing that out! Should be fixed now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2025-06-26 14:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_linter/src/rules/ruff/rules/explicit_f_string_type_conversion.rs</code>:174 on 2025-06-26 14:03</div>
            <div class="timeline-body"><p>You&#x27;re right, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-06-26 15:53</div>
            <div class="timeline-body"><p>Thank you. This is great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-26 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-26 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-26 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-26 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-26 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-26 20:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:33 UTC
    </footer>
</body>
</html>
