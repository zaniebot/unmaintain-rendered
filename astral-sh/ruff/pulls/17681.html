<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Check overloads without an implementation - astral-sh/ruff #17681</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Check overloads without an implementation</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17681">#17681</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-04-28 14:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-28 14:08</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>As mentioned in the spec (https://typing.python.org/en/latest/spec/overload.html#invalid-overload-definitions), part of #15383:</p>
<blockquote>
<p>The <code>@overload</code>-decorated definitions must be followed by an overload implementation, which does not include an <code>@overload</code> decorator. Type checkers should report an error or warning if an implementation is missing. Overload definitions within stub files, protocols, and on abstract methods within abstract base classes are exempt from this check.</p>
</blockquote>
<h2>Test Plan</h2>
<p>Remove TODOs from the test; create one diagnostic snapshot.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @dhruvmanila on 2025-04-28 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @dhruvmanila on 2025-04-28 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @dhruvmanila on 2025-04-28 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @dhruvmanila on 2025-04-28 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @dhruvmanila on 2025-04-28 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @dhruvmanila on 2025-04-28 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-28 14:12</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-29 14:33</div>
            <div class="timeline-body"><p>I need to check why this branch is failing on &quot;porcupine&quot; project in mypy-primer.</p>
<p>Edit: https://github.com/astral-sh/ruff/pull/17609#issuecomment-2839445740 for why this failure is happening.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-29 16:17</div>
            <div class="timeline-body"><p>Fixed the failure in <a href="https://github.com/astral-sh/ruff/pull/17609/commits/382b15bb176055486b0780e0ce8f2f2a1d4d8e26"><code>382b15b</code> (#17609)</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/overloads.md</code>:350 on 2025-04-29 21:24</div>
            <div class="timeline-body"><p>Sorry to nit diagnostic messages, but I find this one slightly grammatically confusing, it sounds like it's saying that the implementation has to be outside a stub file. Maybe &quot;Overloaded non-stub function <code>func</code> must have an implementation&quot;? This is shorter. It does depend on an understanding that a &quot;stub function&quot; is either a function in a stub file, or a Protocol, or an abstract method. But I think that's a pretty intuitive definition of &quot;stub function&quot;. (And the current message also fails to mention the Protocol or abstract method possibilities.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-04-29 21:26</div>
            <div class="timeline-body"><p>Looks great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-04-29 21:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/overloads.md</code>:350 on 2025-04-29 21:41</div>
            <div class="timeline-body"><p>No problem!</p>
<blockquote>
<p>Maybe &quot;Overloaded non-stub function <code>func</code> must have an implementation&quot;? This is shorter. It does depend on an understanding that a &quot;stub function&quot; is either a function in a stub file, or a Protocol, or an abstract method. But I think that's a pretty intuitive definition of &quot;stub function&quot;.</p>
</blockquote>
<p>Yeah, I like this. I think we can add, if we want to, some additional &quot;info&quot; for the diagnostics like the ones done in <a href="https://github.com/astral-sh/ruff/blob/f11d9cb509fa823b9c52ff799db7077199472677/crates/red_knot_python_semantic/resources/mdtest/snapshots/for.md_-_For_loops_-_With_non-callable_iterator.snap#L35-L46"><code>not-iterable</code> diagnostics</a>. So, we could provide info on what a &quot;stub function&quot; is.</p>
<blockquote>
<p>(And the current message also fails to mention the Protocol or abstract method possibilities.)</p>
</blockquote>
<p>I thought about protocol and abstract method cases but those will never raise a diagnostic because they don't require an implementation. It's something that we could recommend when we see an overloaded function outside a stub file without an implementation but I'm not sure how useful would that be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-04-29 22:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/overloads.md</code>:350 on 2025-04-29 22:19</div>
            <div class="timeline-body"><p>I think for now just updating to &quot;Overloaded non-stub function <code>func</code> must have an implementation&quot; is fine, we can see later if it seems this needs any more explanation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-04-30 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-04-30 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-30 14:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:03:27 UTC
    </footer>
</body>
</html>
