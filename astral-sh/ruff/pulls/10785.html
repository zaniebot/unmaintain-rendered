<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add tests for type alias statement - astral-sh/ruff #10785</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add tests for type alias statement</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10785">#10785</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-04-05 04:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>This PR adds test cases for a type alias statement.</p>
<p>This doesn&#x27;t really contain a lot of test cases because for most of them the lexer converts the <code>type</code> keyword to a <code>Name</code> token. They can be added when we remove the soft keyword transformer and move that logic in the parser.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-05 04:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-05 04:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-05 04:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:786 on 2024-04-05 04:21</div>
            <div class="timeline-body"><p>The removed logic is basically what <code>parse_name</code> does so let&#x27;s delegate it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-05 04:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-05 04:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-05 04:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2095 on 2024-04-05 04:25</div>
            <div class="timeline-body"><p>What does &quot;the AST can&#x27;t contain it&quot; mean here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-04-05 04:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-05 04:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2095 on 2024-04-05 04:35</div>
            <div class="timeline-body"><p>There&#x27;s no field to store an expression for <code>TypeVarTuple</code>:</p>
<p>https://github.com/astral-sh/ruff/blob/a516f8f1d86cfb49bc3a395cbe8a3af02857adc5/crates/ruff_python_ast/src/nodes.rs#L3156-L3161</p>
<p>while for <code>TypeVar</code> there is:</p>
<p>https://github.com/astral-sh/ruff/blob/a516f8f1d86cfb49bc3a395cbe8a3af02857adc5/crates/ruff_python_ast/src/nodes.rs#L3130-L3135</p>
<p>We&#x27;d need to parse the expression to highlight the correct range. Or, we could just check if there&#x27;s a <code>:</code> token and provide the error message highlighting the <code>:</code> token.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-05 04:57</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:795 on 2024-04-05 06:34</div>
            <div class="timeline-body"><p>Are there other places where we parse a &quot;type&quot; expression? E.g. when parsing type arguments, type annotations etc. If so, I think it would make sense to have a <code>parse_type</code> or <code>parse_type_expression</code> method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-05 06:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2095 on 2024-04-05 06:37</div>
            <div class="timeline-body"><p>I don&#x27;t think I understand the comment. Does it mean we don&#x27;t emit a syntax error or is it that Python emits a more specific syntax error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2130 on 2024-04-05 06:38</div>
            <div class="timeline-body"><p>Are yield, etc expressions allowed in this position?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:805 on 2024-04-05 06:40</div>
            <div class="timeline-body"><p>Could we add some more invalid test cases:</p>
<pre><code>type 
type x
type x = 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2097 on 2024-04-05 06:41</div>
            <div class="timeline-body"><p>Same here. Could we add some more invalid and valid test cases (or did you already do so in another PR)?</p>
<p>For example, the example you mention above would be good (I suspect that fails with a syntax error today)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-05 06:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-05 10:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2095 on 2024-04-05 10:15</div>
            <div class="timeline-body"><p>The latter. We do emit a syntax error. This comment is for a better error message if we want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-05 10:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:805 on 2024-04-05 10:20</div>
            <div class="timeline-body"><p>The problem with some of these cases (the top two in your list) is that the <code>type</code> is not a keyword but a name expression because of the soft keywords transformer. So, the parser never sees this as a type alias statement (at least for the first two statement).</p>
<p>That said, I think it makes sense to still add them either with a comment or as is so that in the future we can improve this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-05 10:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:795 on 2024-04-05 10:26</div>
            <div class="timeline-body"><p>Like for example a function parameter annotation? So, given</p>
<pre><code>def foo(x: int):
	pass

x: int = 1
type x = int
</code></pre>
<p>We parse all of the <code>int</code> expression using <code>parse_type_expression</code> method. Is this just to clarify that the parser is in a type context?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-05 10:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2130 on 2024-04-05 10:27</div>
            <div class="timeline-body"><p>No, I&#x27;ve been holding off on adding those checks everywhere as I want to implement it once. But, it&#x27;s a good idea to still add the test cases to verify the solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-05 10:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-05 10:57</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/dhruv/type-params">CodSpeed Performance Report</a>
Merging #10785 will <strong>not alter performance</strong>
<p>Comparing <code>dhruv/type-params</code> (cf2e597) with <code>dhruv/parser</code> (d8cd78c)</p>
Summary
<p><code>✅ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-05 12:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:795 on 2024-04-05 12:30</div>
            <div class="timeline-body"><p>I think the main value is to have a place where we can reuse some of the expression validation logic and that I as a parse rule author don&#x27;t always have to think about which expressions are valid (I can just call <code>parse_type_expression</code> and I know the parser will disallow expressions that aren&#x27;t valid in a type context)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-06 17:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:795 on 2024-04-06 17:03</div>
            <div class="timeline-body"><p>Right, that makes sense but I think the <code>parse_conditional_expression_or_higher</code> function should, in the future, do these validations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 08:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:795 on 2024-04-09 08:51</div>
            <div class="timeline-body"><blockquote>
<p>Right, that makes sense but I think the <code>parse_conditional_expression_or_higher</code> function should, in the future, do these validations.</p>
</blockquote>
<p>Done in <a href="https://github.com/astral-sh/ruff/pull/10809">astral-sh/ruff#10809</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-09 08:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-09 08:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-09 08:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:03:06 UTC
    </footer>
</body>
</html>
