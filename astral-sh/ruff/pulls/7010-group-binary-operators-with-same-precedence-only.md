```yaml
number: 7010
title: Group binary operators with same precedence only
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: fix-bin-op
created_at: 2023-08-30T16:28:46Z
updated_at: 2023-08-31T07:19:47Z
url: https://github.com/astral-sh/ruff/pull/7010
synced_at: 2026-01-12T02:45:38Z
```

# Group binary operators with same precedence only

---

_Pull request opened by @MichaReiser on 2023-08-30 16:28_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This PR fixes a deviation from Black where Ruff expanded all binary expressions with the same or a higher precedence to the left of a binary expression.

This PR changes the binary expression formatting to only group operators with the same precedence. 

This PR also fixes the priority/precedence of the Comparator operators.

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

See fixed snapshots. 

| project      | similarity index  | total files       | changed files     |
|--------------|------------------:|------------------:|------------------:|
| cpython      |           0.76079 |              1789 |              1634 |
| django       |           0.99948 |              2760 |                85 |
| transformers |           0.99926 |              2587 |               491 |
| twine        |           0.99965 |                33 |                 3 |
| typeshed     |           0.99947 |              3496 |              2173 |
| warehouse    |           0.99659 |               648 |                41 |
| zulip        |           0.99938 |              1437 |                47 |


| project      | similarity index  | total files       | changed files     |
|--------------|------------------:|------------------:|------------------:|
| cpython      |           0.76079 |              1789 |              1634 |
| django       |           0.99948 |              2760 |                85 |
| **transformers** |           0.99927 |              2587 |               487 | 
| twine        |           0.99965 |                33 |                 3 |
| typeshed     |           0.99947 |              3496 |              2173 |
| **warehouse**    |           0.99820 |               648 |                39 |
| zulip        |           0.99938 |              1437 |                47 |




---

_Comment by @MichaReiser on 2023-08-30 16:28_

Current dependencies on/for this PR:
* main
  * **PR #7010** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7010" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7010?utm_source=stack-comment).

---

_Label `formatter` added by @MichaReiser on 2023-08-30 16:39_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-08-30 16:53_

---

_@charliermarsh approved on 2023-08-30 17:37_

---

_Merged by @MichaReiser on 2023-08-31 07:19_

---

_Closed by @MichaReiser on 2023-08-31 07:19_

---

_Branch deleted on 2023-08-31 07:19_

---
