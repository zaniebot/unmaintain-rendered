<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't run ruff-ecosystem on PRs that only touch ruff_benchmark - astral-sh/ruff #22246</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't run ruff-ecosystem on PRs that only touch ruff_benchmark</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22246">#22246</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-29 15:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Currently we run the ruff-ecosystem CI job on any PR that touches the <code>ruff_benchmark</code> crate. This seems a bit silly, since it takes a while for this job to complete, and nowadays most commits touching the <code>ruff_benchmark</code> crate are just bumping assertions regarding the expected number of ty diagnostics.</p>
<p>This PR refines the logic in <code>ci.yaml</code> so that the ruff-ecosystem check only runs if code related to the linter or the formatter is changed. The benchmark job is also updated, so that the Ruff benchmarks run if code relating to the linter/formatter/parser/benchmarks changed, and the ty benchmarks run if code relating to the parser/type-checker/benchmarks changed.</p>
<p>The downside is that <code>ci.yaml</code> becomes even more complicated. We could consider splitting this workflow up into several workflow files to reduce its complexity.</p>
<h2>Test Plan</h2>
<p>No idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by @AlexWaygood on 2025-12-29 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-29 16:08</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:555 on 2025-12-29 16:28</div>
            <div class="timeline-body"><p>We should also run this job when the <code>ci.yaml</code> file changed or any file touching the ecosystem script</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:997 on 2025-12-29 16:29</div>
            <div class="timeline-body"><p>Isn't the parser included in ty's dependencies? If not, we should add it because we definitely want to run mypy primer on parser changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:1083 on 2025-12-29 16:29</div>
            <div class="timeline-body"><p>Same here, I would expect the parser to be in ty's deps</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-29 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-29 17:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:997 on 2025-12-29 17:17</div>
            <div class="timeline-body"><p>It is, yes. I added this condition just for safety, but I can get rid of it again if you find it confusing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-29 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:997 on 2025-12-29 17:20</div>
            <div class="timeline-body"><p>I'd prefer to remove it then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-29 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:555 on 2025-12-29 17:24</div>
            <div class="timeline-body"><p>Both of those are already covered by <code>needs.determine_changes.outputs.linter</code> and <code>needs.determine_changes.outputs.formatter</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-29 17:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:997 on 2025-12-29 17:25</div>
            <div class="timeline-body"><p>done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2025-12-29 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-12-29 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-12-29 17:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-12-29 17:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-29 17:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:18:28 UTC
    </footer>
</body>
</html>
