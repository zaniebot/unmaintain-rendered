<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Also emit `PLR0206` for properties with variadic parameters - astral-sh/ruff #11200</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Also emit <code>PLR0206</code> for properties with variadic parameters</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11200">#11200</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-04-29 11:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-29 11:31</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Currently this rule checks the number of nonvariadic parameters a property has, but doesn't check how many variadic parameters the property has. That makes little sense to me: if a property has variadic non-self parameters, that seems just as invalid as if a property has nonvariadic non-self parameters.</p>
<p>This PR changes the rule so that it checks the total number of parameters the property has, rather than just the number of nonvariadic parameters. Following the new APIs added in https://github.com/astral-sh/ruff/commit/87929ad5f1306cb889cbc85ddfdb9404d9b5c6ad, this has the nice side effect of also simplifying the code slightly.</p>
<p>This means that we diverge from pylint's behaviour a little more in how we implement this rule, but we were already doing something slightly different. It looks like pylint for some reason only checks the number of positional-or-keyword nonvariadic parameters in a property function, and ignores the number of positional-only or keyword-only nonvariadic parameters: <a href="https://github.com/pylint-dev/pylint/blob/524f2561eda21b5593ab1c69963442031817883d/pylint/checkers/classes/class_checker.py#L1414">https://github.com/pylint-dev/pylint/blob/524f2561eda21b5593ab1c69963442031817883d/pylint/checkers/classes/class_checker.py#L1414</a>. I don't understand why they would do that; I think that's buggy behaviour from pylint there.</p>
<h2>Test Plan</h2>
<p><code>cargo test</code>. I added some new fixtures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-04-29 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-04-29 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-29 11:43</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+6 -0 violations, +0 -0 fixes in 1 projects; 43 projects unchanged)</p>
<details><summary><a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+6 -0 violations, +0 -0 fixes)</summary>
<p>

<pre>
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L1114'>pymilvus/orm/collection.py:1114:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L1255'>pymilvus/orm/collection.py:1255:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L237'>pymilvus/orm/collection.py:237:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L259'>pymilvus/orm/collection.py:259:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L266'>pymilvus/orm/collection.py:266:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/partition.py#L112'>pymilvus/orm/partition.py:112:9:</a> PLR0206 Cannot have defined parameters for properties
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLR0206 | 6 | 6 | 0 | 0 | 0 |</p>
</p>
</details>

<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+6 -0 violations, +0 -0 fixes in 1 projects; 43 projects unchanged)</p>
<details><summary><a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+6 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L1114'>pymilvus/orm/collection.py:1114:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L1255'>pymilvus/orm/collection.py:1255:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L237'>pymilvus/orm/collection.py:237:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L259'>pymilvus/orm/collection.py:259:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/collection.py#L266'>pymilvus/orm/collection.py:266:9:</a> PLR0206 Cannot have defined parameters for properties
+ <a href='https://github.com/milvus-io/pymilvus/blob/f2fac2be3922126c7163936757b31153e7773358/pymilvus/orm/partition.py#L112'>pymilvus/orm/partition.py:112:9:</a> PLR0206 Cannot have defined parameters for properties
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLR0206 | 6 | 6 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-29 11:59</div>
            <div class="timeline-body"><blockquote>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+6 -0 violations, +0 -0 fixes in 1 projects; 43 projects unchanged)</p>
</blockquote>
<p>These all look like true positives to me. The affected project defines a bunch of properties with <code>**kwargs</code> variadic parameters, but no arguments are ever passed to those parameters as far as I can see. The property definitions would make more sense without the <code>**kwargs</code> parameters, even if the code works fine today without any exception being raised.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-30 08:17</div>
            <div class="timeline-body"><p>I think these changes are correct but it would be useful to get a second opinion. I'd also look at why Pylint doesn't trigger on them. Is there an issue in Pylint which might give us an insight here?</p>
<p>(Edit: Pyright -&gt; Pylint)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-30 08:22</div>
            <div class="timeline-body"><blockquote>
<p>I'd also look at why Pylint doesn't trigger on them. Is there an issue in Pylint which might give us an insight here?</p>
</blockquote>
<p>Yeah, I'll do some digging and check to see if there's a reason why pylint only checks for the number of positional-or-keyword parameters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-30 08:42</div>
            <div class="timeline-body"><p>The results of digging:</p>
<ul>
<li>The pylint check was originally added in https://github.com/pylint-dev/pylint/commit/a636569b9cc53279b3b5f4d24b58d9bc739b05d3, a commit that was pushed straight to pylint's <code>main</code> branch without a pull request.</li>
<li>The commit closed the pylint issue https://github.com/pylint-dev/pylint/issues/3006. The issue suggests that the check <em>was</em> intended to catch properties with variadic non-<code>self</code> parameters as well as those with nonvariadic non-<code>self</code> parameters, but there's no discussion on the issue.</li>
<li>The only issue regarding pylint's <code>property-with-parameters</code> check in the years since it was added that I can find is https://github.com/pylint-dev/pylint/issues/3600. That issue was fixed by the pylint PR https://github.com/pylint-dev/pylint/pull/3621.</li>
</ul>
<p>I confirmed locally that running pylint on the original motivating example for the pylint check given in https://github.com/pylint-dev/pylint/issues/3006#issue-468017491 does not actually trigger a violation of the pylint rule (because the example has variadic non-<code>self</code> parameters rather than nonvariadic non-<code>self</code> parameters). I checked using <code>pylint==3.1.0</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2024-04-30 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-30 08:43</div>
            <div class="timeline-body"><blockquote>
<p>I think these changes are correct but it would be useful to get a second opinion.</p>
</blockquote>
<p>@carljm, could you possibly take a look?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-30 08:55</div>
            <div class="timeline-body"><p>Thanks for the details. It's good to go from my side üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-30 09:01</div>
            <div class="timeline-body"><p>I opened a pylint issue here to let them know about the bug on their side: https://github.com/pylint-dev/pylint/issues/9584</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-30 10:59</div>
            <div class="timeline-body"><p>The pylint maintainers have added labels to https://github.com/pylint-dev/pylint/issues/9584 which indicate that they agree there's a bug on their side, so I'll merge this now üëç</p>
<p>Thanks for the review @dhruvmanila!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-04-30 10:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-04-30 10:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-30 10:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:37:43 UTC
    </footer>
</body>
</html>
