<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix: avoid flagging unused loop variable (B007) with globals(), vars() or eval() - astral-sh/ruff #2166</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix: avoid flagging unused loop variable (B007) with globals(), vars() or eval()</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2166">#2166</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-01-25 18:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-25 18:56</div>
            <div class="timeline-body"><p>see issue #2161</p>
<p>maybe even the use of <code>exec()</code> could be a case?</p>
<p>and what do you think about:</p>
<pre><code class="language-diff">diff --git src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs
index 7783c7a4..e4a453ab 100644
--- src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs
+++ src/rules/flake8_bugbear/rules/unused_loop_control_variable.rs
@@ -57,10 +57,6 @@ where
 
 /// B007
 pub fn unused_loop_control_variable(checker: &amp;mut Checker, target: &amp;Expr, body: &amp;[Stmt]) {
-    if helpers::uses_magic_variable_access(body) {
-        return;
-    }
-
     let control_names = {
         let mut finder = NameFinder::new();
         finder.visit_expr(target);
@@ -90,7 +86,7 @@ pub fn unused_loop_control_variable(checker: &amp;mut Checker, target: &amp;Expr, body:
             violations::UnusedLoopControlVariable(name.to_string()),
             Range::from_located(expr),
         );
-        if checker.patch(diagnostic.kind.rule()) {
+        if !helpers::uses_magic_variable_access(body) &amp;&amp; checker.patch(diagnostic.kind.rule()) {
             // Prefix the variable name with an underscore.
             diagnostic.amend(Fix::replacement(
                 format!(&quot;_{name}&quot;),
</code></pre>
<p>so that it's still noted but just not fixed (untested)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-25 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-25 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 20:19</div>
            <div class="timeline-body"><p>Sounds good. I went ahead and added <code>exec</code>, and changed the code to lint but not fix if the fix is &quot;unsafe&quot;.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:54:14 UTC
    </footer>
</body>
</html>
