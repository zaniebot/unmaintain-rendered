<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format `PatternMatchClass` - astral-sh/ruff #6860</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format <code>PatternMatchClass</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6860">#6860</a>
        opened by <a href="https://github.com/LaBatata101">@LaBatata101</a>
        on 2023-08-24 20:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2023-08-24 20:28</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Closes #6642</p>
<h2>Test Plan</h2>
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@py_310__pattern_matching_extras.py.snap</code>:212 on 2023-08-24 20:34</div>
            <div class="timeline-body"><p>You'll need to wrap the properties list in an extra group to get this formatting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2023-08-24 20:35</div>
            <div class="timeline-body"><p>I don't know how to solve the conflict for the <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@py_310__pattern_matching_extras.py.snap</code> file</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-24 20:35</div>
            <div class="timeline-body"><p>So many removed lines ☺️</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/pattern/pattern_match_class.rs</code>:39 on 2023-08-24 20:36</div>
            <div class="timeline-body"><p>Try adding an extra group around items</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-24 20:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2023-08-24 20:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_python_formatter/src/pattern/pattern_match_class.rs</code>:39 on 2023-08-24 20:44</div>
            <div class="timeline-body"><p>Would the function <code>group</code> work here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-24 20:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/pattern/pattern_match_class.rs</code>:39 on 2023-08-24 20:48</div>
            <div class="timeline-body"><p>Yes, group(&amp;items) should do the trick if I'm not mistaken</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LaBatata101">@LaBatata101</a> reviewed on 2023-08-24 21:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on <code>crates/ruff_python_formatter/src/pattern/pattern_match_class.rs</code>:39 on 2023-08-24 21:04</div>
            <div class="timeline-body"><p>Nothing changed for this <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@py_310__pattern_matching_extras.py.snap</code> file when using <code>group</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Format PatternMatchClass" to "Format `PatternMatchClass`" by @LaBatata101 on 2023-08-24 23:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @charliermarsh on 2023-08-25 04:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@py_310__pattern_matching_extras.py.snap</code>:213 on 2023-08-25 06:00</div>
            <div class="timeline-body"><p>Okay, the problem here is that <code>PatternMatchMapping</code> isn't yet implemented and the text emitted by the &quot;fake&quot; implementation is much longer than the expected string.</p>
<p>We can ignore this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/pattern/pattern_match_class.rs</code>:39 on 2023-08-25 06:01</div>
            <div class="timeline-body"><p>See my comment below. This is fine, assuming we're talking about the same mismatch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-25 06:06</div>
            <div class="timeline-body"><p>This looks good to me. Thank you.</p>
<p>Could you add one test case to</p>
<p>https://github.com/astral-sh/ruff/blob/main/crates/ruff_python_formatter/resources/test/fixtures/ruff/statement/match.py#L285</p>
<p>that tests for the following weird comment placement</p>
<pre><code class="language-python">match x:
	case (
		Point2D
		# awkward
		(x = 2)
	: ...
</code></pre>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @MichaReiser on 2023-08-25 06:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/pattern/pattern_match_class.rs</code>:28 on 2023-08-25 07:44</div>
            <div class="timeline-body"><p>Do we need the <code>if !kwd_attrs.is_empty()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/resources/test/fixtures/ruff/statement/match.py</code>:452 on 2023-08-25 07:54</div>
            <div class="timeline-body"><p>Could you add something like</p>
<pre><code class="language-python">match a:
    case A(
        b # b
        = # c
        2 # d
        # e
    ):
        pass
</code></pre>
<p>with the left hand side and the right hand side split of the assignment split by comment? I wanted to add an additional comment before the <code>b</code> but that's blocked by https://github.com/astral-sh/ruff/issues/6866</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-08-25 07:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-25 07:57</div>
            <div class="timeline-body"><blockquote>
<p>I don't know how to solve the conflict for the crates/ruff_python_formatter/tests/snapshots/black_compatibility@py_310__pattern_matching_extras.py.snap file</p>
</blockquote>
<p>Just pick anything (it's an autogenerated file) and recreate file, e.g. with <code>INSTA_UPDATE=always cargo test -p ruff_python_formatter</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-25 13:52</div>
            <div class="timeline-body"><p>Will review and merge today. I can also follow-up with new tests once I fix https://github.com/astral-sh/ruff/issues/6866.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-08-25 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-25 18:58</div>
            <div class="timeline-body"><p>Okay, I had to make some changes to the PR to adapt to our parenthesis handling for patterns that changed a bit upstream (mostly, to ensure we handle the single-argument case correctly, like we do for call expressions). We also now handle comments before the arguments, like we do for call expressions.</p>
<p>There are several comment cases that we're still getting wrong (valid syntax, but slightly incorrect placement), but that are really hard to fix without changing the AST. (Namely, we need an <code>Arguments</code> node, and we need a single node for <code>x=1</code> -- we have both of these things for call expressions so we should have them here too.)</p>
<p>I'm going to update the AST, then do another pass on this node.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@statement__match.py.snap</code>:948 on 2023-08-25 19:00</div>
            <div class="timeline-body"><p>This is not quite right, but very tedious to fix without a node for the whole argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-25 19:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-25 19:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@statement__match.py.snap</code>:907 on 2023-08-25 19:01</div>
            <div class="timeline-body"><p>This is not quite right (it should be immediately after the <code>(</code>), but very hard to fix without a node for the arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-08-25 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-25 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-25 19:06</div>
            <div class="timeline-body"><p>Filed here: https://github.com/astral-sh/ruff/issues/6880. I'm on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-25 19:32</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      5.3±0.04ms     7.7 MB/sec    1.00      5.3±0.04ms     7.7 MB/sec
formatter/numpy/ctypeslib.py               1.00   1047.0±4.58µs    15.9 MB/sec    1.00   1046.9±2.82µs    15.9 MB/sec
formatter/numpy/globals.py                 1.00     96.5±0.54µs    30.6 MB/sec    1.03     99.2±0.45µs    29.7 MB/sec
formatter/pydantic/types.py                1.00   1966.4±4.69µs    13.0 MB/sec    1.02  1999.7±11.74µs    12.8 MB/sec
linter/all-rules/large/dataset.py          1.00     12.1±0.09ms     3.4 MB/sec    1.00     12.1±0.06ms     3.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.2±0.01ms     5.2 MB/sec    1.00      3.2±0.02ms     5.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    452.5±1.02µs     6.5 MB/sec    1.02    461.0±4.45µs     6.4 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.3±0.03ms     4.1 MB/sec    1.00      6.3±0.05ms     4.0 MB/sec
linter/default-rules/large/dataset.py      1.00      6.4±0.02ms     6.4 MB/sec    1.00      6.3±0.03ms     6.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1401.3±3.38µs    11.9 MB/sec    1.00  1407.2±16.48µs    11.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    162.3±1.29µs    18.2 MB/sec    1.03    167.2±3.38µs    17.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.9±0.01ms     8.9 MB/sec    1.00      2.9±0.03ms     8.9 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      5.7±0.37ms     7.1 MB/sec    1.03      5.9±0.29ms     6.9 MB/sec
formatter/numpy/ctypeslib.py               1.00  1122.3±64.82µs    14.8 MB/sec    1.01  1135.1±81.47µs    14.7 MB/sec
formatter/numpy/globals.py                 1.00    100.6±6.85µs    29.3 MB/sec    1.10    110.9±9.45µs    26.6 MB/sec
formatter/pydantic/types.py                1.00      2.1±0.13ms    11.9 MB/sec    1.11      2.4±0.11ms    10.8 MB/sec
linter/all-rules/large/dataset.py          1.00     14.1±0.62ms     2.9 MB/sec    1.05     14.7±0.83ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.8±0.18ms     4.4 MB/sec    1.02      3.9±0.24ms     4.3 MB/sec
linter/all-rules/numpy/globals.py          1.07   501.1±39.89µs     5.9 MB/sec    1.00   470.5±23.62µs     6.3 MB/sec
linter/all-rules/pydantic/types.py         1.02      7.4±0.23ms     3.4 MB/sec    1.00      7.3±0.50ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.01      7.8±0.33ms     5.2 MB/sec    1.00      7.7±0.42ms     5.3 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1658.6±90.66µs    10.0 MB/sec    1.06  1756.2±72.91µs     9.5 MB/sec
linter/default-rules/numpy/globals.py      1.02   190.0±12.97µs    15.5 MB/sec    1.00    185.7±9.52µs    15.9 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6±0.14ms     7.1 MB/sec    1.01      3.6±0.14ms     7.0 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-25 20:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:46:15 UTC
    </footer>
</body>
</html>
