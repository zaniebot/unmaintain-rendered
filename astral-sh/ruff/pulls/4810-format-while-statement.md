```yaml
number: 4810
title: "Format `while` Statement"
type: pull_request
state: merged
author: MichaReiser
labels:
  - internal
  - formatter
assignees: []
merged: true
base: main
head: format-while-statement
created_at: 2023-06-02T12:46:02Z
updated_at: 2023-06-05T08:43:11Z
url: https://github.com/astral-sh/ruff/pull/4810
synced_at: 2026-01-12T03:43:29Z
```

# Format `while` Statement

---

_Pull request opened by @MichaReiser on 2023-06-02 12:46_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This PR implements formatting of `while` statements. 

## Test Plan

I reviewed the black changes and added our own tests to verify the correct placement of comments.


---

_Comment by @MichaReiser on 2023-06-02 12:46_

Current dependencies on/for this PR:
* main
  * **PR #4805** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4805" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #4810** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4810" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
      * **PR #4850** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4850" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #4808** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4808" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/charliermarsh/ruff/4810?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-06-02 13:19_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     14.6Â±0.04ms     2.8 MB/sec    1.03     15.1Â±0.13ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5Â±0.00ms     4.7 MB/sec    1.00      3.5Â±0.01ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    360.1Â±1.16Âµs     8.2 MB/sec    1.01    362.0Â±1.62Âµs     8.2 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1Â±0.01ms     4.2 MB/sec    1.00      6.1Â±0.02ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.00      7.3Â±0.01ms     5.6 MB/sec    1.00      7.3Â±0.05ms     5.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1533.1Â±3.63Âµs    10.9 MB/sec    1.00   1533.5Â±3.42Âµs    10.9 MB/sec
linter/default-rules/numpy/globals.py      1.00    164.2Â±0.24Âµs    18.0 MB/sec    1.00    165.0Â±0.23Âµs    17.9 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.3Â±0.00ms     7.8 MB/sec    1.00      3.3Â±0.01ms     7.8 MB/sec
parser/large/dataset.py                    1.00      5.8Â±0.00ms     7.0 MB/sec    1.01      5.9Â±0.01ms     6.9 MB/sec
parser/numpy/ctypeslib.py                  1.00   1126.7Â±0.71Âµs    14.8 MB/sec    1.13   1270.0Â±0.80Âµs    13.1 MB/sec
parser/numpy/globals.py                    1.00    114.2Â±0.28Âµs    25.8 MB/sec    1.04    118.3Â±0.45Âµs    24.9 MB/sec
parser/pydantic/types.py                   1.00      2.5Â±0.00ms    10.3 MB/sec    1.01      2.5Â±0.00ms    10.2 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     15.3Â±0.08ms     2.7 MB/sec    1.00     15.3Â±0.20ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.6Â±0.03ms     4.7 MB/sec    1.00      3.6Â±0.02ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    383.8Â±3.52Âµs     7.7 MB/sec    1.00    384.9Â±2.12Âµs     7.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.2Â±0.04ms     4.1 MB/sec    1.01      6.3Â±0.03ms     4.1 MB/sec
linter/default-rules/large/dataset.py      1.00      7.6Â±0.03ms     5.3 MB/sec    1.00      7.6Â±0.03ms     5.3 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1534.9Â±11.99Âµs    10.8 MB/sec    1.00   1540.7Â±5.83Âµs    10.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    167.2Â±1.28Âµs    17.6 MB/sec    1.00    167.8Â±1.03Âµs    17.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.3Â±0.03ms     7.6 MB/sec    1.00      3.3Â±0.02ms     7.6 MB/sec
parser/large/dataset.py                    1.00      6.1Â±0.03ms     6.6 MB/sec    1.02      6.3Â±0.02ms     6.5 MB/sec
parser/numpy/ctypeslib.py                  1.00   1141.2Â±4.79Âµs    14.6 MB/sec    1.02   1159.0Â±4.66Âµs    14.4 MB/sec
parser/numpy/globals.py                    1.00    116.7Â±0.64Âµs    25.3 MB/sec    1.01    118.4Â±0.68Âµs    24.9 MB/sec
parser/pydantic/types.py                   1.00      2.6Â±0.01ms     9.9 MB/sec    1.02      2.6Â±0.01ms     9.8 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_@zanieb reviewed on 2023-06-03 18:06_

---

_Review comment by @zanieb on `crates/ruff_python_formatter/src/snapshots/ruff_python_formatter__tests__ruff_test__while_py.snap`:54 on 2023-06-03 18:06_

Should this newline be removed?

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/snapshots/ruff_python_formatter__tests__ruff_test__while_py.snap`:54 on 2023-06-03 20:17_

Good catch. No it should not. @konstin is working on keeping the right amount of newlines between top level statements in https://github.com/charliermarsh/ruff/pull/4808 I should probably rebase on top of that. 

---

_@MichaReiser reviewed on 2023-06-03 20:17_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/comments/format.rs`:12 on 2023-06-04 08:52_

I renamed the function because I now needed a way to either format the leading comments of a node OR a specific list of comments.

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/expression/maybe_parenthesize.rs`:40 on 2023-06-04 08:54_

This match is not complete yet because it's impossible to test without having implemented some expression formatting.

We should revisit this later. The important thing is that we have this logic centrelized, so that it should be easy to fix later.

---

_@MichaReiser reviewed on 2023-06-04 08:56_

---

_Label `internal` added by @MichaReiser on 2023-06-04 08:57_

---

_Label `autoformatter` added by @MichaReiser on 2023-06-04 08:57_

---

_Marked ready for review by @MichaReiser on 2023-06-04 08:57_

---

_Review comment by @konstin on `crates/ruff_python_formatter/resources/test/fixtures/ruff/statement/while.py`:14 on 2023-06-04 09:32_

[she took the midnight train going anywhere :notes:](https://youtu.be/1k8craCGpgs?t=76)

---

_Comment by @MichaReiser on 2023-06-04 09:39_

How do I get `pre-commit` to ignore my test files? We already exclude the whole resources directory

---

_Review comment by @konstin on `crates/ruff_python_formatter/src/context.rs`:80 on 2023-06-04 12:24_

From this docstring it's ambiguous where in
```rust
if a:
    b
```
This means `a` or `b`. Also if this applies to `def` and `class` bodies

---

_@konstin approved on 2023-06-05 07:09_

---

_@MichaReiser reviewed on 2023-06-05 07:12_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/context.rs`:80 on 2023-06-05 07:12_

I'll try to improve it. `Function` and `Classes` are compound statements too

```
compound_stmt ::=  [if_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-if_stmt)
                   | [while_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-while_stmt)
                   | [for_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-for_stmt)
                   | [try_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-try_stmt)
                   | [with_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-with_stmt)
                   | [match_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-match_stmt)
                   | [funcdef](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-funcdef)
                   | [classdef](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-classdef)
                   | [async_with_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-async_with_stmt)
                   | [async_for_stmt](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-async_for_stmt)
                   | [async_funcdef](https://docs.python.org/3/reference/compound_stmts.html#grammar-token-python-grammar-async_funcdef)
```

---

_Merged by @MichaReiser on 2023-06-05 08:24_

---

_Closed by @MichaReiser on 2023-06-05 08:24_

---

_Branch deleted on 2023-06-05 08:24_

---
