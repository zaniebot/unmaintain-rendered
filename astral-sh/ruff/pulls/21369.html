<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluent formatting of method chains - astral-sh/ruff #21369</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fluent formatting of method chains</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21369">#21369</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-11-10 21:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>This PR implements a modification (in preview) to fluent formatting for method chains: We break <em>at</em> the first call instead of <em>after</em>.</p>
<p>For example, we have the following diff between <code>main</code> and this PR (with <code>line-length=8</code> so I don't have to stretch out the text):</p>
<pre><code class="language-diff"> x = (
-    df.merge()
+    df
+    .merge()
     .groupby()
     .agg()
     .filter()
 )
</code></pre>
<h2>Explanation of current implementation</h2>
<p>Recall that we traverse the AST to apply formatting. A method chain, while read left-to-right, is stored in the AST &quot;in reverse&quot;. So if we start with something like</p>
<pre><code class="language-python">a.b.c.d().e.f()
</code></pre>
<p>then the first syntax node we meet is essentially <code>.f()</code>. So we have to peek ahead. And we actually <em>already</em> do this in our current fluent formatting logic: we peek ahead to count how many calls we have in the chain to see whether we should be using fluent formatting or now.</p>
<p>In this implementation, we actually <em>record</em> this number inside the enum for <code>CallChainLayout</code>. That is, we make the variant <code>Fluent</code> hold an <code>AttributeState</code>. This state can either be:</p>
<ul>
<li>The number of call-like attributes preceding the current attribute</li>
<li>The state <code>FirstCallOrSubscript</code> which means we are at the first call-like attribute in the chain (reading from left to right)</li>
<li>The state <code>BeforeFirstCallOrSubscript</code> which means we are in the &quot;first group&quot; of attributes, preceding that first call.</li>
</ul>
<p>In our example, here's what it looks like at each attribute:</p>
<pre><code>a.b.c.d().e.f @ Fluent(CallsOrSubscriptsPreceding(1))
a.b.c.d().e @ Fluent(CallsOrSubscriptsPreceding(1))
a.b.c.d @ Fluent(FirstCallOrSubscript)
a.b.c @ Fluent(BeforeFirstCallOrSubscript)
a.b @ Fluent(BeforeFirstCallOrSubscript)
</code></pre>
<p>Now, as we descend down from the parent expression, we pass along this little piece of state and modify it as we go to track where we are. This state doesn't do anything except when we are in <code>FirstCallOrSubscript</code>, in which case we add a soft line break.</p>
<p>Closes #8598</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @dylwil3 on 2025-11-10 21:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-11-10 23:16</div>
            <div class="timeline-body"><p>Not sure why the ecosystem check didn't post, but here it is attached:
<a href="https://github.com/user-attachments/files/23466180/ecosystem-result.md">ecosystem-result.md</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laundmo">@laundmo</a> on 2025-12-04 17:34</div>
            <div class="timeline-body"><p>Wow the implementation for this is astonishingly simple!</p>
<p>Looking through the ecosystem results, I have basically no complaints. The only factor worth considering is if there should be an option/heuristic to skip breaking the first call to a new line for short combinations of name.method(), like pandas <code>pd</code> and similar:</p>
<details><summary>Pandas diff excerpt</summary>
<p>

<p><a href='https://github.com/pandas-dev/pandas/blob/bcd9649419332a2a2c148e8feadff0e3da9f6669/pandas/core/generic.py#L9499'>pandas/core/generic.py~L9499</a></p>
<pre><code class="language-diff"> 
         # reorder axis to keep things organized
         indices = (
-            np.arange(diff.shape[axis])
+            np
+            .arange(diff.shape[axis])
             .reshape([2, diff.shape[axis] // 2])
-            .T.reshape(-1)
+            .T
+            .reshape(-1)
         )
         diff = diff.take(indices, axis=axis)
 
</code></pre>
<p><a href='https://github.com/pandas-dev/pandas/blob/bcd9649419332a2a2c148e8feadff0e3da9f6669/pandas/io/formats/style_render.py#L2553'>pandas/io/formats/style_render.py~L2553</a></p>
<pre><code class="language-diff">         Escaped string
     &quot;&quot;&quot;
     return (
-        s.replace(&quot;\\&quot;, &quot;ab2¬ß=¬ß8yz&quot;)  # rare string for final conversion: avoid \\ clash
+        s
+        .replace(&quot;\\&quot;, &quot;ab2¬ß=¬ß8yz&quot;)  # rare string for final conversion: avoid \\ clash
         .replace(&quot;ab2¬ß=¬ß8yz &quot;, &quot;ab2¬ß=¬ß8yz\\space &quot;)  # since \backslash gobbles spaces
         .replace(&quot;&amp;&quot;, &quot;\\&amp;&quot;)
         .replace(&quot;%&quot;, &quot;\\%&quot;)
</code></pre>
<p><a href='https://github.com/pandas-dev/pandas/blob/bcd9649419332a2a2c148e8feadff0e3da9f6669/pandas/tests/arrays/test_datetimelike.py#L875'>pandas/tests/arrays/test_datetimelike.py~L875</a></p>
<pre><code class="language-diff">         b = pd.date_range(&quot;2000&quot;, periods=2, freq=&quot;h&quot;, tz=&quot;US/Central&quot;, unit=unit)._data
         result = DatetimeArray._concat_same_type([a, b])
         expected = (
-            pd.to_datetime([
+            pd
+            .to_datetime([
                 &quot;2000-01-01 00:00:00&quot;,
                 &quot;2000-01-02 00:00:00&quot;,
                 &quot;2000-01-01 00:00:00&quot;,
</code></pre>
</p>
</details>

<p>If it isn't too configurable, i'm imagining a setting like <code>fluent-keep-first-length = 35</code> which would check if the first line, like <code>pd.to_datetime([</code> is longer than 35 unicode codepoints, and only break then. But i fully understand that might be too configurable for what ruff is trying to be, and i haven't explored the implications of this for various cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-04 19:52</div>
            <div class="timeline-body"><p>Thank you for looking at these! I was about to do the same üòÑ</p>
<p>I'm conflicted about the issue of short identifiers at the start of these chains. Biome and Prettier don't put a break there if the identifier has length smaller than the tab width, but they also <em>indent</em> method chains. I personally like the extra indentation, but it doesn't seem as common in the Python ecosystem so I didn't put it in this PR. Without it, it feels hard to justify this heuristic.</p>
<p>So at the moment I'm sort of leaning towards allowing the break after <code>np</code> and <code>pd</code>, etc. But it wouldn't be difficult to implement this exception if we wanted it. I don't think it should be configurable though (beyond the indirect configuration coming from tab style and line length).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexreinking">@alexreinking</a> on 2025-12-04 21:34</div>
            <div class="timeline-body"><p>@laundmo -- looking at your examples, I think breaking after <code>np.</code> and <code>pd.</code> feels wrong, but breaking after <code>s.</code> seems okay. I think that's because <code>np.</code> and <code>pd.</code> are package names, so it feels like they're part of the function name itself: <code>pd.to_datetime</code> is <em>one thing</em> that shouldn't be split, but <code>s</code> is its own thing and the code is acting on it by calling <code>.replace</code>.</p>
<p>Does ruff do any sort of semantic analysis for formatting? Does it know which names are package names?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-04 21:40</div>
            <div class="timeline-body"><blockquote>
<p>Does ruff do any sort of semantic analysis for formatting? Does it know which names are package names?</p>
</blockquote>
<p>Nope, it doesn't use anything beyond syntactical information. I don't know of a formatter that uses semantic analysis - unless you count import sorting.</p>
<p>(In Rust the syntax itself distinguishes between module member access/static methods (these use <code>::</code>) and methods that take <code>self</code> (uses <code>.</code>), but alas in Python it isn't so).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexreinking">@alexreinking</a> on 2025-12-04 21:52</div>
            <div class="timeline-body"><blockquote>
<p>Nope, it doesn't use anything beyond syntactical information. I don't know of a formatter that uses semantic analysis - unless you count import sorting.</p>
</blockquote>
<p>Well, in that case I'd rather lean towards seeing <code>s.replace</code> than breaking the module name away from its method. In particular, it's useful to <code>grep</code> for usages of things like <code>some_module.method</code> and this formatting rule would break that.</p>
<p>It should be possible to force a line break with a trailing comment, right?</p>
<pre><code class="language-python">return (
    s  # &lt;force line break&gt;
    .replace(...)
    .replace(...)
    .replace(...)
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-04 21:57</div>
            <div class="timeline-body"><blockquote>
<p>Well, in that case I'd rather lean towards seeing <code>s.replace</code> than breaking the module name away from its method. In particular, it's useful to <code>grep</code> for usages of things like <code>some_module.method</code> and this formatting rule would break that.</p>
</blockquote>
<p>If I understand correctly, that's the current behavior. Would you like to weigh in at the <a href="https://github.com/astral-sh/ruff/issues/8598">linked issue</a>? (Not your fault - I forgot to link the issue until now üòÑ )</p>
<p>Also - wouldn't you still be able to <code>grep</code> but just put optional whitespace/multiline in your regex?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laundmo">@laundmo</a> on 2025-12-04 22:03</div>
            <div class="timeline-body"><p>I do think the linked issue has a point, but at the same time i thought it would be useful to consider the nuance here, with a mind to implementation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexreinking">@alexreinking</a> on 2025-12-04 22:07</div>
            <div class="timeline-body"><blockquote>
<p>Also - wouldn't you still be able to <code>grep</code> but just put optional whitespace/multiline in your regex?</p>
</blockquote>
<p>Yes, but as you can see, I'm prone to forgetting to do that üòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhirschfeld">@dhirschfeld</a> on 2025-12-04 22:59</div>
            <div class="timeline-body"><p>I'd prefer to not break <code>np.&lt;name&gt;</code> on the initial line, same goes for any <code>&lt;module&gt;.&lt;name&gt;</code> combo.</p>
<p>Given the lack of semantic information perhaps the best you can do is to say any identifier under 5 characters long on the first line won't be broken up. Importing modules with a 2-char identifier is idiomatic Python, and, for lesser known modules I've seen 3 and 4-char abbreviations.</p>
<p>It wouldn't be perfect, but it would capture most instances where I'd prefer the initial identifier wasn't split. Of course some won't like that - I don't think there's a way to satisfy everyone... unless you make it configurable how many characters are allowed before the first identifier is split on it's own line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-04 23:55</div>
            <div class="timeline-body"><p>I've reviewed the ecosystem changes and here are my thoughts.</p>
<h1>Overall</h1>
<p>I think that in almost all cases the new formatting is better than the old. There is one
situation where I think the new formatting is not quite as good, and the remaining
&quot;ugly&quot; formatting is not new to this PR but we might think about fixing it (unless it
greatly increases complexity) since we are overhauling call chains here anyway.</p>
<p>Finally, as brought up in other comments, there's a question of how we feel about
splitting methods when accessing &quot;short&quot; identifiers or modules.</p>
<p>I personally think it looks okay. I also don't really see a way to avoid it (beyond
<em>maybe</em> adopting the tab-width heuristic, but it feels like it's trying to solve a
different problem.) A heuristic not tied to something like tab-width, but instead to a
sort of arbitrary but fixed constant of &quot;small&quot; seems brittle and possibly confusing to
users. A configuration option doesn't seem correct either - it's the sort of
bikeshedding that a formatter tries to remove.</p>
<p>But again: if we were in an alternative universe where we already had this new
formatting, and someone opened a PR with this universe's stable formatting, and I saw
all these diffs in reverse, I would vote <em>not</em> to accept the &quot;new&quot; style. So I think
that means that I like the style of this PR.</p>
<h2>Handling of intermediate attribute access</h2>
<p>The most egregious example of what I mean is this:</p>
<p><a href='https://github.com/ibis-project/ibis/blob/9126733b38e1c92f6e787f92dc9954e88ab6400d/docs/posts/pydata-performance-part2/polars_native.py#L13'>docs/posts/pydata-performance-part2/polars_native.py~L13</a></p>
<pre><code class="language-diff">     ])
     .with_columns(
         month=pl.col(&quot;uploaded_on&quot;).dt.truncate(&quot;1mo&quot;),
-        ext=pl.col(&quot;path&quot;)
-        .str.extract(pattern=r&quot;\.([a-z0-9]+)$&quot;, group_index=1)
-        .str.replace_all(pattern=r&quot;cxx|cpp|cc|c|hpp|h&quot;, value=&quot;C/C++&quot;)
-        .str.replace_all(pattern=&quot;^f.*$&quot;, value=&quot;Fortran&quot;)
-        .str.replace(&quot;rs&quot;, &quot;Rust&quot;, literal=True)
-        .str.replace(&quot;go&quot;, &quot;Go&quot;, literal=True)
-        .str.replace(&quot;asm&quot;, &quot;Assembly&quot;, literal=True)
+        ext=pl
+        .col(&quot;path&quot;)
+        .str
+        .extract(pattern=r&quot;\.([a-z0-9]+)$&quot;, group_index=1)
+        .str
+        .replace_all(pattern=r&quot;cxx|cpp|cc|c|hpp|h&quot;, value=&quot;C/C++&quot;)
+        .str
+        .replace_all(pattern=&quot;^f.*$&quot;, value=&quot;Fortran&quot;)
+        .str
+        .replace(&quot;rs&quot;, &quot;Rust&quot;, literal=True)
+        .str
+        .replace(&quot;go&quot;, &quot;Go&quot;, literal=True)
+        .str
+        .replace(&quot;asm&quot;, &quot;Assembly&quot;, literal=True)
         .replace({&quot;&quot;: None}),
     )
     .group_by([&quot;month&quot;, &quot;ext&quot;])
</code></pre>
<p>So there is a question of whether a different heuristic should be applied to
&quot;intermediate&quot; attributes within the method chain so that, in this example, the
<code>.str.replace(</code> calls would stay on the same line.</p>
<details><summary>Other examples</summary>

<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/doc_fns/read_fns/excel_reader.py#L133'>crazy_functions/doc_fns/read_fns/excel_reader.py~L133</a></p>
<pre><code class="language-diff">                 return &quot;\n&quot;.join(rows)
             else:
                 flat_values = (
-                    chunk.astype(str)
+                    chunk
+                    .astype(str)
                     .replace({&quot;nan&quot;: &quot;&quot;, &quot;None&quot;: &quot;&quot;, &quot;NaN&quot;: &quot;&quot;})
-                    .values.flatten()
+                    .values
+                    .flatten()
                 )
                 return &quot; &quot;.join(v for v in flat_values if v)

</code></pre>
<p><a href='https://github.com/freedomofpress/securedrop/blob/6e3e49d7775c42698bf6e24843e29e08459d58da/securedrop/tests/functional/app_navigators/journalist_app_nav.py#L287'>securedrop/tests/functional/app_navigators/journalist_app_nav.py~L287</a></p>
<pre><code class="language-diff">         else:
             # We created a totp user
             otp_secret = (
-                self.driver.find_element(By.CSS_SELECTOR, &quot;#shared-secret&quot;)
-                .text.strip()
+                self.driver
+                .find_element(By.CSS_SELECTOR, &quot;#shared-secret&quot;)
+                .text
+                .strip()
                 .replace(&quot; &quot;, &quot;&quot;)
             )
             totp = two_factor.TOTP(otp_secret)
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L1106'>reflex/event.py~L1106</a></p>
<pre><code class="language-diff">     get_element_by_id = FunctionStringVar.create(&quot;document.getElementById&quot;)

     return run_script(
-        get_element_by_id.call(elem_id)
+        get_element_by_id
+        .call(elem_id)
         .to(ObjectVar)
-        .scrollIntoView.to(FunctionVar)
+        .scrollIntoView
+        .to(FunctionVar)
         .call(align_to_top),
     )

</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L1219'>reflex/event.py~L1219</a></p>
<pre><code class="language-diff">     return run_script(
         Var(&quot;navigator&quot;)
         .to(dict)
-        .clipboard.to(dict)
-        .writeText.to(FunctionVar)
+        .clipboard
+        .to(dict)
+        .writeText
+        .to(FunctionVar)
         .call(content)
     )

</code></pre>
</details>

<h2>Calls not aligning with initial identifier</h2>
<p>In certain cases we align the method calls with some piece of text (e.g. a binary
operator, walrus operator, or <code>for</code> statement) that precedes the initial identifier.</p>
<p>I don't think we have to do this to avoid invalid syntax, but I haven't played around
with it yet. If we could avoid it, it would be nice.</p>
<p>In any case - this is an existing issue, so we may not want to deal with it here.</p>
<details><summary>Examples</summary>
<a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/nlu/classifiers/test_diet_classifier.py#L874'>tests/nlu/classifiers/test_diet_classifier.py~L874</a>
```diff
                             # expected to change can be compared directly
                             assert (
                                 feature_signature.units
-                                == old_signature.get(attribute)
+                                == old_signature
+                                .get(attribute)
                                 .get(feature_type)[index]
                                 .units
                             )
```

<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/nlu/selectors/test_selectors.py#L798'>tests/nlu/selectors/test_selectors.py~L798</a></p>
<pre><code class="language-diff">                             # expected to change can be compared directly
                             assert (
                                 feature_signature.units
-                                == old_signature.get(attribute)
+                                == old_signature
+                                .get(attribute)
                                 .get(feature_type)[index]
                                 .units
                             )
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/accounting/test_misc.py#L431'>rotkehlchen/tests/unit/accounting/test_misc.py~L431</a></p>
<pre><code class="language-diff">     assert len(rotki.accountant.pots[0].cost_basis.missing_acquisitions) == 0
     assert (
         len(
-            used_acquisitions := rotki.accountant.pots[0]
-            .cost_basis.get_events(asset=A_ETH)
+            used_acquisitions := rotki.accountant
+            .pots[0]
+            .cost_basis
+            .get_events(asset=A_ETH)
             .used_acquisitions
         )
         == 1
</code></pre>
<p><a href='https://github.com/apache/superset/blob/23b61b080ed9bdb27747bbb4c1d18efec8006808/superset/connectors/sqla/models.py#L257'>superset/connectors/sqla/models.py~L257</a></p>
<pre><code class="language-diff">         # Get all groupable column names for this datasource
         drillable_columns = {
             row[0]
-            for row in db.session.query(TableColumn.column_name)
+            for row in db.session
+            .query(TableColumn.column_name)
             .filter(TableColumn.table_id == self.id)
             .filter(TableColumn.groupby)
             .all()
</code></pre>
<p><a href='https://github.com/apache/superset/blob/23b61b080ed9bdb27747bbb4c1d18efec8006808/superset/security/manager.py#L2451'>superset/security/manager.py~L2451</a></p>
<pre><code class="language-diff">                     form_data
                     and (dashboard_id := form_data.get(&quot;dashboardId&quot;))
                     and (
-                        dashboard_ := self.session.query(Dashboard)
+                        dashboard_ := self.session
+                        .query(Dashboard)
                         .filter(Dashboard.id == dashboard_id)
                         .one_or_none()
                     )
</code></pre>
<p><a href='https://github.com/apache/superset/blob/23b61b080ed9bdb27747bbb4c1d18efec8006808/superset/security/manager.py#L2484'>superset/security/manager.py~L2484</a></p>
<pre><code class="language-diff">                             form_data.get(&quot;type&quot;) != &quot;NATIVE_FILTER&quot;
                             and (slice_id := form_data.get(&quot;slice_id&quot;))
                             and (
-                                slc := self.session.query(Slice)
+                                slc := self.session
+                                .query(Slice)
                                 .filter(Slice.id == slice_id)
                                 .one_or_none()
                             )
</code></pre>
<p><a href='https://github.com/apache/superset/blob/23b61b080ed9bdb27747bbb4c1d18efec8006808/superset/security/manager.py#L2558'>superset/security/manager.py~L2558</a></p>
<pre><code class="language-diff">         need to be scoped
         &quot;&quot;&quot;
         return (
-            self.session.query(self.user_model)
+            self.session
+            .query(self.user_model)
             .filter(self.user_model.username == username)
             .one_or_none()
         )
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-12-04 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dylwil3 on 2025-12-04 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dylwil3 on 2025-12-05 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhirschfeld">@dhirschfeld</a> on 2025-12-05 00:33</div>
            <div class="timeline-body"><p>How about, if it's used as a namespace it doesn't get broken up? That might solve both cases.</p>
<p>A namespace is identified as not being a function call - e.g.</p>
<ul>
<li><code>np.function()</code> doesn't get broken up because <code>np</code> isn't a function call</li>
<li><code>.str.extract(pattern=r&quot;\.([a-z0-9]+)$&quot;, group_index=1)</code> doesn't get split because <code>str</code> is not a function call</li>
<li><code>.dt.truncate(&quot;1mo&quot;)</code> would stay together as <code>dt</code> is used as a namespace</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexreinking">@alexreinking</a> on 2025-12-05 01:00</div>
            <div class="timeline-body"><p>In all the cases you found pathological, a rule where an extra layer of parenthesis are introduced when the separation exceeds a tab width would fix the flow, IMHO.</p>
<details>
<summary>Examples</summary>

<p>Consider:</p>
<pre><code class="language-diff">                             # expected to change can be compared directly
                             assert (
-                                feature_signature.units
-                                == old_signature.get(attribute)
+                                feature_signature.units == (
+                                    old_signature
+                                    .get(attribute)
+                                    .get(feature_type)[index]
+                                    .units
+                                )
                             )
</code></pre>
<p>Or alternatively,</p>
<pre><code class="language-diff">                             form_data.get(&quot;type&quot;) != &quot;NATIVE_FILTER&quot;
                             and (slice_id := form_data.get(&quot;slice_id&quot;))
                             and (
-                                slc := self.session.query(Slice)
+                                slc := (
+                                    self.session
+                                    .query(Slice)
+.                                   .filter(Slice.id == slice_id)
+                                    .one_or_none()
+                                )
                             )
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexreinking">@alexreinking</a> on 2025-12-05 01:04</div>
            <div class="timeline-body"><blockquote>
<p>So there is a question of whether a different heuristic should be applied to &quot;intermediate&quot; attributes within the method chain so that, in this example, the .str.replace( calls would stay on the same line.</p>
</blockquote>
<p>I think it's totally fair to only break after <code>)</code> for the purposes of method chaining... a property access isn't a method, right? Maybe that's the syntactic rule that governs this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 01:26</div>
            <div class="timeline-body"><blockquote>
<p>How about, if it's used as a namespace it doesn't get broken up? That might solve both cases.</p>
<p>A namespace is identified as not being a function call - e.g.</p>
<ul>
<li><code>np.function()</code> doesn't get broken up because <code>np</code> isn't a function call</li>
<li><code>.str.extract(pattern=r&quot;\.([a-z0-9]+)$&quot;, group_index=1)</code> doesn't get split because <code>str</code> is not a function call</li>
<li><code>.dt.truncate(&quot;1mo&quot;)</code> would stay together as <code>dt</code> is used as a namespace</li>
</ul>
</blockquote>
<p>If I understand correctly, this is just what the current, stable behavior is. The point is that we want to break up</p>
<pre><code class="language-python">x = some_object_that_is_not_a_module.does_something().and_another_thing().and_something_else()
</code></pre>
<p>as</p>
<pre><code class="language-python">x = (
    some_object_that_is_not_a_module
    .does_something()
    .and_another_thing()
    .and_something_else()
)
</code></pre>
<p>but currently we do:</p>
<pre><code class="language-python">x = (
    some_object_that_is_not_a_module.does_something()
    .and_another_thing()
    .and_something_else()
)
</code></pre>
<p>Which is not what we want, in most cases. I don't really see a way to syntactically tell when something is a &quot;namespace&quot; or &quot;module&quot; as opposed to an object with some methods. (In Python, there also isn't really a <em>semantic</em> distinction between those things.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laundmo">@laundmo</a> on 2025-12-05 02:10</div>
            <div class="timeline-body"><p>I think throughout this conversation i've become convinced that not breaking short identifiers shorter than tab length would only male sense if subsequent method calls were indented. That's actually something i personally prefer (indented calls) but it definitely doesn't have to be part of this PR if it will ever be added.</p>
<p>I think the main question left is what to do with intermediate attributes, and my personal tendency would be to not break after them. And honestly, if it was up to me, i'd make that dependant on the implementation complexity. If its doable in an hour or 2, do it, otherwise leave it as is. Since i assume this'll be a preview style anyways its not too bad to change it slightly later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-05 07:10</div>
            <div class="timeline-body"><blockquote>
<p>The most egregious example of what I mean is this:</p>
</blockquote>
<p>I think we should fix it because it feels inconsistent that we don't split the attribute on the first line, but do for subsequent calls. I strongly prefer <strong>not-splitting</strong> the attribute access (which is also what Prettier does).:</p>
<pre><code class="language-diff">         # Query for starred sources, along with their unread
         # submission counts.
         starred = (
-            db.session.query(Source, unread_stmt.c.num_unread)
+            db.session
+            .query(Source, unread_stmt.c.num_unread)
             .filter_by(pending=False, deleted_at=None)
             .filter(Source.last_updated.isnot(None))
             .filter(SourceStar.starred.is_(True))
</code></pre>
<p>It also ensures the new formatting is consistent with the (non-method) call-chain layout:</p>
<pre><code>assert (
    get_collection(COLLECTION_NAME)
    .config.params.sparse_vectors[&quot;sparse-text&quot;]
    .modifier.call()
    .other.more.existing
)
</code></pre>
<blockquote>
<p>In certain cases we align the method calls with some piece of text (e.g. a binary
operator, walrus operator, or for statement) that precedes the initial identifier.</p>
</blockquote>
<p>I'm fine with not addressing this in this PR, given that it's a pre-existing issue. I agree it's not great but it's also something that applies to all call-chains, not just method chains (and is related to https://github.com/astral-sh/ruff/issues/12856)</p>
<p>Not very common, but this instance also looks worse to me. We should at least add a test:</p>
<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/b3dfc9961faad853a2cd44d1d728134cd98f0335/tests/app/test_telemetry.py#L52'>tests/app/test_telemetry.py~L52</a></p>
<pre><code class="language-diff">     assert result.exit_code == 0, result.output
     # The method is called with a TelemetryData type, so we cast it to dict for simpler comparison
     usage_command_event = (
-        mock_conn.return_value._telemetry.try_add_log_to_batch.call_args_list[  # noqa: SLF001
+        mock_conn.return_value._telemetry.try_add_log_to_batch
+        .call_args_list[  # noqa: SLF001
             0
         ]
         .args[0]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 12:02</div>
            <div class="timeline-body"><blockquote>
<p>I think we should fix it because it feels inconsistent that we don't split the attribute on the first line, but do for subsequent calls. I strongly prefer <strong>not-splitting</strong> the attribute access (which is also what Prettier does).:</p>
</blockquote>
<p>I agree with your conclusion - that we should fix cases like the &quot;egregious example&quot; - but I'm confused by your comment. The current PR <em>does</em> treat the first line the same as all the rest. The prettier (and Prettier) formatting would treat the first line differently than all the rest because it would not split a call that follows an attribute access.</p>
<p>The rule in this PR (that applies to all lines) is that we keep chains of attribute access on one line, and split right before a call.   So, for example, the following is formatted in this PR:</p>
<pre><code class="language-python">x = (
    some.very.nested.object
    .returns()
    .another.nested.object
    .and_another_thing()
    .and_something_else()
)
</code></pre>
<p>Notice that the same rule applies to the first line of the chain and to the third line of the chain.</p>
<p>On stable that becomes:</p>
<pre><code class="language-python">x = (
    some.very.nested.object.returns()
    .another.nested.object.and_another_thing()
    .and_something_else()
)
</code></pre>
<p>which isn't that bad, but isn't the fluent formatting we're after. I believe we are both saying that we want:</p>
<pre><code class="language-python">x = (
    some.very.nested.object
    .returns()
    .another.nested.object.and_another_thing()
    .and_something_else()
)
</code></pre>
<p>(which is what Prettier does). Notice that this treats the first line of the chain <em>differently</em> than the third.</p>
<p>Anyway I will take a stab at implementing that - converting back to draft!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @dylwil3 on 2025-12-05 12:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 12:07</div>
            <div class="timeline-body"><blockquote>
<p>Not very common, but this instance also looks worse to me. We should at least add a test:</p>
</blockquote>
<p>I agree - but I think it sort of looks bad either way and would be solved by fixing #13761 .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laundmo">@laundmo</a> on 2025-12-05 12:32</div>
            <div class="timeline-body"><p>Hmm, what do you think about this?</p>
<pre><code class="language-py">x = (
    some
    .very.nested.object.returns()
    .another.nested.object.and_another_thing()
    .and_something_else()
)
</code></pre>
<p>It seems somewhat strange at first, but i personally like the consistency between the first and second call.</p>
<p>What i imagine a bad case to look like, splitting like my idea:</p>
<pre><code>x = (
    long_namespace
    .i.method()
    .pop()
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-05 12:33</div>
            <div class="timeline-body"><p>I like this. Feels even more consistent</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 21:33</div>
            <div class="timeline-body"><p>Okey dokey. As explained in the current version of the PR summary, the commit <a href="https://github.com/astral-sh/ruff/commit/4c1f9aaa7f9498f9978aba085b16ea6a1774a866">4c1f9aa</a> introduces two simultaneous changes:</p>
<ol>
<li>We implement the main change, which special cases the first method call in the chain and breaks right before it.</li>
<li>We also change the heuristic for <em>when</em> to use fluent formatting</li>
</ol>
<p>It's a huge ecosystem change, so I thought it would be easier to think about if we compared different versions. The versions in question are:</p>
<ol>
<li><code>main</code></li>
<li><code>just_criterion_change</code>: same as <code>main</code> except we modify the criterion for when to use fluent layout</li>
<li><code>initial_attempt</code>: the first version of this PR, which was sorta okay, where we treated all attributes the same and broke before all calls in the chain</li>
<li><code>just_major_change</code>: Use the same criterion as in <code>main</code> to determine <em>when</em> to use fluent layout, but the fluent layout is the one where we break at the first method call and the rest is the same as in <code>main</code></li>
<li><code>both_changes</code>: Use fluent layout more often, and break at first method call</li>
</ol>
<p>Here are the relevant ecosystem results:</p>
<p><a href="https://github.com/user-attachments/files/23970938/compare_initial_attempt__vs__both_changes.md">compare_initial_attempt__vs__both_changes.md</a>
<a href="https://github.com/user-attachments/files/23970940/compare_initial_attempt__vs__just_major_change.md">compare_initial_attempt__vs__just_major_change.md</a>
<a href="https://github.com/user-attachments/files/23970941/compare_just_criterion_change__vs__both_changes.md">compare_just_criterion_change__vs__both_changes.md</a>
<a href="https://github.com/user-attachments/files/23970942/compare_main__vs__both_changes.md">compare_main__vs__both_changes.md</a>
<a href="https://github.com/user-attachments/files/23970943/compare_main__vs__initial_attempt.md">compare_main__vs__initial_attempt.md</a>
<a href="https://github.com/user-attachments/files/23970944/compare_main__vs__just_criterion_change.md">compare_main__vs__just_criterion_change.md</a>
<a href="https://github.com/user-attachments/files/23970946/compare_main__vs__just_major_change.md">compare_main__vs__just_major_change.md</a></p>
<p>With apologies for the spamming of everyone's inbox, I will also post the smaller of these separately below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 21:34</div>
            <div class="timeline-body"><p>Here is the comparison of the initial attempt and just the major change (see https://github.com/astral-sh/ruff/pull/21369#issuecomment-3618670969)</p>
<p>‚ÑπÔ∏è ecosystem check <strong>detected format changes</strong>. (+26 -52 lines in 16 files in 7 projects; 48 projects unchanged)</p>
<details><summary><a href="https://github.com/binary-husky/gpt_academic">binary-husky/gpt_academic</a> (+1 -2 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/doc_fns/read_fns/excel_reader.py#L136'>crazy_functions/doc_fns/read_fns/excel_reader.py~L136</a></p>
<pre><code class="language-diff">                     chunk
                     .astype(str)
                     .replace({&quot;nan&quot;: &quot;&quot;, &quot;None&quot;: &quot;&quot;, &quot;NaN&quot;: &quot;&quot;})
-                    .values
-                    .flatten()
+                    .values.flatten()
                 )
                 return &quot; &quot;.join(v for v in flat_values if v)
 
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+1 -2 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/freedomofpress/securedrop/blob/abee0e643ea1cb5d434fdd104196d9ab092005be/securedrop/tests/functional/app_navigators/journalist_app_nav.py#L289'>securedrop/tests/functional/app_navigators/journalist_app_nav.py~L289</a></p>
<pre><code class="language-diff">             otp_secret = (
                 self.driver
                 .find_element(By.CSS_SELECTOR, &quot;#shared-secret&quot;)
-                .text
-                .strip()
+                .text.strip()
                 .replace(&quot; &quot;, &quot;&quot;)
             )
             totp = two_factor.TOTP(otp_secret)
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/qdrant/qdrant-client">qdrant/qdrant-client</a> (+2 -4 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/congruence_tests/test_sparse_idf_search.py#L57'>tests/congruence_tests/test_sparse_idf_search.py~L57</a></p>
<pre><code class="language-diff">     assert (
         local_client
         .get_collection(COLLECTION_NAME)
-        .config.params
-        .sparse_vectors[&quot;sparse-text&quot;]
+        .config.params.sparse_vectors[&quot;sparse-text&quot;]
         .modifier
         == models.Modifier.IDF
     )
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/congruence_tests/test_sparse_idf_search.py#L85'>tests/congruence_tests/test_sparse_idf_search.py~L85</a></p>
<pre><code class="language-diff">     assert (
         local_client
         .get_collection(COLLECTION_NAME)
-        .config.params
-        .sparse_vectors[&quot;sparse-text&quot;]
+        .config.params.sparse_vectors[&quot;sparse-text&quot;]
         .modifier
         == models.Modifier.NONE
     )
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/reflex-dev/reflex">reflex-dev/reflex</a> (+3 -6 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L1109'>reflex/event.py~L1109</a></p>
<pre><code class="language-diff">         get_element_by_id
         .call(elem_id)
         .to(ObjectVar)
-        .scrollIntoView
-        .to(FunctionVar)
+        .scrollIntoView.to(FunctionVar)
         .call(align_to_top),
     )
 
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L1221'>reflex/event.py~L1221</a></p>
<pre><code class="language-diff">     return run_script(
         Var(&quot;navigator&quot;)
         .to(dict)
-        .clipboard
-        .to(dict)
-        .writeText
-        .to(FunctionVar)
+        .clipboard.to(dict)
+        .writeText.to(FunctionVar)
         .call(content)
     )
 
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/rotki/rotki">rotki/rotki</a> (+6 -12 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L70'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L70</a></p>
<pre><code class="language-diff">         self.uniswap_factories = {
             chain_id: Inquirer()
             .get_evm_manager(chain_id)
-            .node_inquirer.contracts
-            .contract(UNISWAP_FACTORY_ADDRESSES[version][chain_id])  # noqa: E501
+            .node_inquirer.contracts.contract(UNISWAP_FACTORY_ADDRESSES[version][chain_id])  # noqa: E501
             for chain_id in UNISWAP_SUPPORTED_CHAINS
         }
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L421'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L421</a></p>
<pre><code class="language-diff">             return self.is_before_factory_deployment(
                 block_identifier=Inquirer()
                 .get_evm_manager(token.chain_id)
-                .node_inquirer
-                .get_blocknumber_by_time(timestamp),
+                .node_inquirer.get_blocknumber_by_time(timestamp),
                 chain_id=token.chain_id,
             )
         except RemoteError as e:  # can be raised by get_blocknumber_by_time
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L443'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L443</a></p>
<pre><code class="language-diff">             to_token=to_token,
             block_identifier=Inquirer()
             .get_evm_manager(from_token.chain_id)
-            .node_inquirer
-            .get_blocknumber_by_time(timestamp),
+            .node_inquirer.get_blocknumber_by_time(timestamp),
             timestamp=timestamp,
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L455'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L455</a></p>
<pre><code class="language-diff">         self.uniswap_v3_pool_abi = (
             Inquirer()
             .get_evm_manager(ChainID.ETHEREUM)
-            .node_inquirer.contracts
-            .abi(&quot;UNISWAP_V3_POOL&quot;)
+            .node_inquirer.contracts.abi(&quot;UNISWAP_V3_POOL&quot;)
         )  # noqa: E501
 
     @cache_response_timewise()
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L582'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L582</a></p>
<pre><code class="language-diff">         self.uniswap_v2_lp_abi = (
             Inquirer()
             .get_evm_manager(ChainID.ETHEREUM)
-            .node_inquirer.contracts
-            .abi(&quot;UNISWAP_V2_LP&quot;)
+            .node_inquirer.contracts.abi(&quot;UNISWAP_V2_LP&quot;)
         )  # noqa: E501
 
     @cache_response_timewise()
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/accounting/test_misc.py#L433'>rotkehlchen/tests/unit/accounting/test_misc.py~L433</a></p>
<pre><code class="language-diff">         len(
             used_acquisitions := rotki.accountant
             .pots[0]
-            .cost_basis
-            .get_events(asset=A_ETH)
+            .cost_basis.get_events(asset=A_ETH)
             .used_acquisitions
         )
         == 1
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/zanieb/huggingface-notebooks">zanieb/huggingface-notebooks</a> (+2 -4 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/zanieb/huggingface-notebooks/blob/68cd6fa1a2831c5189f85257c13d691cb76292db/course/fr/chapter9/section4.ipynb#L129'>course/fr/chapter9/section4.ipynb~L129</a></p>
<pre><code class="language-diff">     &quot;    .get(\n&quot;,
     &quot;        \&quot;https://huggingface.co/spaces/course-demos/Sketch-Recognition/raw/main/class_names.txt\&quot;\n&quot;,
     &quot;    )\n&quot;,
-    &quot;    .text\n&quot;,
-    &quot;    .replace(\&quot;\\n\&quot;, \&quot;\&quot;)\n&quot;,
+    &quot;    .text.replace(\&quot;\\n\&quot;, \&quot;\&quot;)\n&quot;,
     &quot;    .split(\&quot;\\r\&quot;)\n&quot;,
     &quot;)\n&quot;,
     &quot;\n&quot;,
</code></pre>
<p><a href='https://github.com/zanieb/huggingface-notebooks/blob/68cd6fa1a2831c5189f85257c13d691cb76292db/diffusers/sd_textual_inversion_training.ipynb#L988'>diffusers/sd_textual_inversion_training.ipynb~L988</a></p>
<pre><code class="language-diff">     &quot;                latents = (\n&quot;,
     &quot;                    vae\n&quot;,
     &quot;                    .encode(batch[\&quot;pixel_values\&quot;].to(dtype=weight_dtype))\n&quot;,
-    &quot;                    .latent_dist\n&quot;,
-    &quot;                    .sample()\n&quot;,
+    &quot;                    .latent_dist.sample()\n&quot;,
     &quot;                    .detach()\n&quot;,
     &quot;                )\n&quot;,
     &quot;                latents = latents * 0.18215\n&quot;,
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (+11 -22 lines across 8 files)</summary>
<p>
<pre>ruff format --no-preview --exclude examples/mcp/databricks_mcp_cookbook.ipynb,examples/chatgpt/gpt_actions_library/gpt_action_google_drive.ipynb,examples/chatgpt/gpt_actions_library/gpt_action_redshift.ipynb,examples/chatgpt/gpt_actions_library/gpt_action_salesforce.ipynb,</pre>
</p>
<p>

<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/Clustering.ipynb#L230'>examples/Clustering.ipynb~L230</a></p>
<pre><code class="language-diff">     &quot;        df[df.Cluster == i]\n&quot;,
     &quot;        .combined.str\n&quot;,
     &quot;        .replace(\&quot;Title: \&quot;, \&quot;\&quot;)\n&quot;,
-    &quot;        .str\n&quot;,
-    &quot;        .replace(\&quot;\\n\\nContent: \&quot;, \&quot;:  \&quot;)\n&quot;,
+    &quot;        .str.replace(\&quot;\\n\\nContent: \&quot;, \&quot;:  \&quot;)\n&quot;,
     &quot;        .sample(rev_per_cluster, random_state=42)\n&quot;,
     &quot;        .values\n&quot;,
     &quot;    )\n&quot;,
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/Clustering_for_transaction_classification.ipynb#L399'>examples/Clustering_for_transaction_classification.ipynb~L399</a></p>
<pre><code class="language-diff">     &quot;        embedding_df[embedding_df.Cluster == i]\n&quot;,
     &quot;        .combined.str\n&quot;,
     &quot;        .replace(\&quot;Supplier: \&quot;, \&quot;\&quot;)\n&quot;,
-    &quot;        .str\n&quot;,
-    &quot;        .replace(\&quot;Description: \&quot;, \&quot;:  \&quot;)\n&quot;,
-    &quot;        .str\n&quot;,
-    &quot;        .replace(\&quot;Value: \&quot;, \&quot;:  \&quot;)\n&quot;,
+    &quot;        .str.replace(\&quot;Description: \&quot;, \&quot;:  \&quot;)\n&quot;,
+    &quot;        .str.replace(\&quot;Value: \&quot;, \&quot;:  \&quot;)\n&quot;,
     &quot;        .sample(transactions_per_cluster, random_state=42)\n&quot;,
     &quot;        .values\n&quot;,
     &quot;    )\n&quot;,
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/Developing_hallucination_guardrails.ipynb#L1044'>examples/Developing_hallucination_guardrails.ipynb~L1044</a></p>
<pre><code class="language-diff">     &quot;        df[\&quot;accurate\&quot;] = (\n&quot;,
     &quot;            df[\&quot;accurate\&quot;]\n&quot;,
     &quot;            .astype(str)\n&quot;,
-    &quot;            .str\n&quot;,
-    &quot;            .strip()\n&quot;,
+    &quot;            .str.strip()\n&quot;,
     &quot;            .map(lambda x: 1 if x in [\&quot;True\&quot;, \&quot;true\&quot;] else 0)\n&quot;,
     &quot;        )\n&quot;,
     &quot;        df[\&quot;hallucination\&quot;] = (\n&quot;,
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/Leveraging_model_distillation_to_fine-tune_a_model.ipynb#L258'>examples/Leveraging_model_distillation_to_fine-tune_a_model.ipynb~L258</a></p>
<pre><code class="language-diff">     &quot;varieties_less_than_five_list = (\n&quot;,
     &quot;    df_france[\&quot;variety\&quot;]\n&quot;,
     &quot;    .value_counts()[df_france[\&quot;variety\&quot;].value_counts() &lt; 5]\n&quot;,
-    &quot;    .index\n&quot;,
-    &quot;    .tolist()\n&quot;,
+    &quot;    .index.tolist()\n&quot;,
     &quot;)\n&quot;,
     &quot;df_france = df_france[~df_france[\&quot;variety\&quot;].isin(varieties_less_than_five_list)]\n&quot;,
     &quot;\n&quot;,
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/Reinforcement_Fine_Tuning.ipynb#L927'>examples/Reinforcement_Fine_Tuning.ipynb~L927</a></p>
<pre><code class="language-diff">     &quot;    df_avg = (\n&quot;,
     &quot;        pd\n&quot;,
     &quot;        .DataFrame(model_metrics_avg)\n&quot;,
-    &quot;        .T\n&quot;,
-    &quot;        .reset_index()\n&quot;,
+    &quot;        .T.reset_index()\n&quot;,
     &quot;        .rename(columns={\&quot;index\&quot;: \&quot;Model\&quot;})\n&quot;,
     &quot;    )\n&quot;,
     &quot;    df_std = (\n&quot;,
     &quot;        pd\n&quot;,
     &quot;        .DataFrame(model_metrics_std)\n&quot;,
-    &quot;        .T\n&quot;,
-    &quot;        .reset_index()\n&quot;,
+    &quot;        .T.reset_index()\n&quot;,
     &quot;        .rename(columns={\&quot;index\&quot;: \&quot;Model\&quot;})\n&quot;,
     &quot;    )\n&quot;,
     &quot;\n&quot;,
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/Semantic_text_search_using_embeddings.ipynb#L69'>examples/Semantic_text_search_using_embeddings.ipynb~L69</a></p>
<pre><code class="language-diff">     &quot;        df\n&quot;,
     &quot;        .sort_values(\&quot;similarity\&quot;, ascending=False)\n&quot;,
     &quot;        .head(n)\n&quot;,
-    &quot;        .combined.str\n&quot;,
-    &quot;        .replace(\&quot;Title: \&quot;, \&quot;\&quot;)\n&quot;,
-    &quot;        .str\n&quot;,
-    &quot;        .replace(\&quot;; Content:\&quot;, \&quot;: \&quot;)\n&quot;,
+    &quot;        .combined.str.replace(\&quot;Title: \&quot;, \&quot;\&quot;)\n&quot;,
+    &quot;        .str.replace(\&quot;; Content:\&quot;, \&quot;: \&quot;)\n&quot;,
     &quot;    )\n&quot;,
     &quot;    if pprint:\n&quot;,
     &quot;        for r in results:\n&quot;,
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/evaluation/How_to_eval_abstractive_summarization.ipynb#L311'>examples/evaluation/How_to_eval_abstractive_summarization.ipynb~L311</a></p>
<pre><code class="language-diff">     &quot;    pd\n&quot;,
     &quot;    .DataFrame(rouge_scores_out)\n&quot;,
     &quot;    .set_index(\&quot;Metric\&quot;)\n&quot;,
-    &quot;    .style\n&quot;,
-    &quot;    .apply(highlight_max, axis=1)\n&quot;,
+    &quot;    .style.apply(highlight_max, axis=1)\n&quot;,
     &quot;)\n&quot;,
     &quot;\n&quot;,
     &quot;rouge_scores_out&quot;
</code></pre>
<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/o1/Using_reasoning_for_data_validation.ipynb#L226'>examples/o1/Using_reasoning_for_data_validation.ipynb~L226</a></p>
<pre><code class="language-diff">     &quot;    response_content = (\n&quot;,
     &quot;        response\n&quot;,
     &quot;        .choices[0]\n&quot;,
-    &quot;        .message.content\n&quot;,
-    &quot;        .replace(\&quot;```json\&quot;, \&quot;\&quot;)\n&quot;,
+    &quot;        .message.content.replace(\&quot;```json\&quot;, \&quot;\&quot;)\n&quot;,
     &quot;        .replace(\&quot;```\&quot;, \&quot;\&quot;)\n&quot;,
     &quot;        .strip()\n&quot;,
     &quot;    )\n&quot;,
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 21:37</div>
            <div class="timeline-body"><p>Here is the comparison of <code>main</code> with just changing the criterion for fluent layout:</p>
<p>‚ÑπÔ∏è ecosystem check <strong>detected format changes</strong>. (+912 -613 lines in 110 files in 15 projects; 40 projects unchanged)</p>
<details><summary><a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+8 -8 lines across 3 files)</summary>
<p>

<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/nlu/classifiers/diet_classifier.py#L358'>rasa/nlu/classifiers/diet_classifier.py~L358</a></p>
<pre><code class="language-diff">                 current_hidden_layer_sizes == first_hidden_layer_sizes
                 for current_hidden_layer_sizes in self.component_config[
                     HIDDEN_LAYERS_SIZES
-                ].values()
+                ]
+                .values()
             )
             if not identical_hidden_layer_sizes:
                 raise ValueError(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/domain.py#L1178'>rasa/shared/core/domain.py~L1178</a></p>
<pre><code class="language-diff">         # tuple because sub_state will be later transformed into a frozenset (so it can
         # be hashed for deduplication).
         entities = tuple(
-            self._get_featurized_entities(latest_message).intersection(
-                set(sub_state.get(ENTITIES, ()))
-            )
+            self._get_featurized_entities(latest_message)
+            .intersection(set(sub_state.get(ENTITIES, ())))
         )
         # Sort entities so that any derived state representation is consistent across
         # runs and invariant to the order in which the entities for an utterance are
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/domain.py#L1312'>rasa/shared/core/domain.py~L1312</a></p>
<pre><code class="language-diff">         # remove active loop which only occur in rules but not in stories
         if (
             rule_only_loops
-            and state.get(rasa.shared.core.constants.ACTIVE_LOOP, {}).get(
-                rasa.shared.core.constants.LOOP_NAME
-            )
+            and state.get(rasa.shared.core.constants.ACTIVE_LOOP, {})
+            .get(rasa.shared.core.constants.LOOP_NAME)
             in rule_only_loops
         ):
             del state[rasa.shared.core.constants.ACTIVE_LOOP]
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/core/policies/test_unexpected_intent_policy.py#L810'>tests/core/policies/test_unexpected_intent_policy.py~L810</a></p>
<pre><code class="language-diff">                     all_label_embeddings[0],
                     all_label_embeddings[0],
                 ]
-            ).reshape((3, 2, 20)),
+            )
+            .reshape((3, 2, 20)),
             dtype=tf.float32,
         )
 
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/binary-husky/gpt_academic">binary-husky/gpt_academic</a> (+17 -10 lines across 4 files)</summary>
<p>

<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/agent_fns/pipe.py#L196'>crazy_functions/agent_fns/pipe.py~L196</a></p>
<pre><code class="language-diff">                     )
                 self.chatbot[-1] = [
                     self.chatbot[-1][0],
-                    self.chatbot[-1][1].replace(
-                        &quot;[GPT-Academic] Á≠âÂæÖ‰∏≠&quot;, &quot;[GPT-Academic] Á≠âÂæÖ‰∏≠.&quot;
-                    ),
+                    self.chatbot[-1][1]
+                    .replace(&quot;[GPT-Academic] Á≠âÂæÖ‰∏≠&quot;, &quot;[GPT-Academic] Á≠âÂæÖ‰∏≠.&quot;),
                 ]
                 yield from update_ui(chatbot=self.chatbot, history=self.history)
                 # if time.time() - begin_waiting_time &gt; patience:
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/crazy_utils.py#L524'>crazy_functions/crazy_utils.py~L524</a></p>
<pre><code class="language-diff">                             &quot;&quot;.join([wtf[&quot;text&quot;] for wtf in l[&quot;spans&quot;]])
                             for l in t[&quot;lines&quot;]
                         ]
-                    ).replace(&quot;- &quot;, &quot;&quot;)
+                    )
+                    .replace(&quot;- &quot;, &quot;&quot;)
                     for t in text_areas[&quot;blocks&quot;]
                     if &quot;lines&quot; in t
                 ]
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/crazy_utils.py#L548'>crazy_functions/crazy_utils.py~L548</a></p>
<pre><code class="language-diff">                             &quot;&quot;.join([wtf[&quot;text&quot;] for wtf in l[&quot;spans&quot;]])
                             for l in t[&quot;lines&quot;]
                         ]
-                    ).replace(&quot;- &quot;, &quot;&quot;)
+                    )
+                    .replace(&quot;- &quot;, &quot;&quot;)
                     for t in text_areas[&quot;blocks&quot;]
                     if &quot;lines&quot; in t
                 ]
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/review_fns/query_analyzer.py#L238'>crazy_functions/review_fns/query_analyzer.py~L238</a></p>
<pre><code class="language-diff">                         for cat in self._extract_tag(
                             extracted_responses[self.ARXIV_CATEGORIES_INDEX],
                             &quot;categories&quot;,
-                        ).split(&quot;,&quot;)
+                        )
+                        .split(&quot;,&quot;)
                     ],
                     &quot;sort_by&quot;: self._extract_tag(
                         extracted_responses[self.ARXIV_SORT_INDEX], &quot;sort_by&quot;
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/review_fns/query_analyzer.py#L276'>crazy_functions/review_fns/query_analyzer.py~L276</a></p>
<pre><code class="language-diff">                         field.strip()
                         for field in self._extract_tag(
                             extracted_responses[self.SEMANTIC_FIELDS_INDEX], &quot;fields&quot;
-                        ).split(&quot;,&quot;)
+                        )
+                        .split(&quot;,&quot;)
                     ],
                     &quot;sort_by&quot;: &quot;relevance&quot;,
                     &quot;limit&quot;: 20,
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/crazy_functions/review_fns/query_analyzer.py#L419'>crazy_functions/review_fns/query_analyzer.py~L419</a></p>
<pre><code class="language-diff">             is_latest_request = (
                 self._extract_tag(
                     extracted_responses[self.ARXIV_LATEST_INDEX], &quot;is_latest_request&quot;
-                ).lower()
+                )
+                .lower()
                 == &quot;true&quot;
             )
 
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/shared_utils/cookie_manager.py#L201'>shared_utils/cookie_manager.py~L201</a></p>
<pre><code class="language-diff">     for name in output_name_list:
         call_args += f&quot;&quot;&quot;Data[&quot;{name}&quot;],&quot;&quot;&quot;
     call_args = call_args.rstrip(&quot;,&quot;)
-    _js_callback = &quot;&quot;&quot;
+    _js_callback = (
+        &quot;&quot;&quot;
         (base64MiddleString)=&gt;{
             console.log('hello')
             const stringData = atob(base64MiddleString);
</code></pre>
<p><a href='https://github.com/binary-husky/gpt_academic/blob/0aa0472da44edc0a888c7f83b564c6d0d1089366/shared_utils/cookie_manager.py#L209'>shared_utils/cookie_manager.py~L209</a></p>
<pre><code class="language-diff">             call = JS_CALLBACK_GEN;
             call(CALL_ARGS);
         }
-    &quot;&quot;&quot;.replace(&quot;JS_CALLBACK_GEN&quot;, js_callback).replace(&quot;CALL_ARGS&quot;, call_args)
+    &quot;&quot;&quot;.replace(&quot;JS_CALLBACK_GEN&quot;, js_callback)
+        .replace(&quot;CALL_ARGS&quot;, call_args)
+    )
 
     btn.click(get_fn_wrap(), input_list, output_list + [middle_ware_component]).then(
         None, [middle_ware_component], None, _js=_js_callback
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/docker/docker-py">docker/docker-py</a> (+44 -30 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L31'>tests/integration/api_build_test.py~L31</a></p>
<pre><code class="language-diff">                     'RUN env | grep &quot;NO_PROXY=d&quot;',
                     'RUN env | grep &quot;no_proxy=d&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         self.client.build(fileobj=script, decode=True)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L54'>tests/integration/api_build_test.py~L54</a></p>
<pre><code class="language-diff">                     'RUN env | grep &quot;NO_PROXY=d&quot;',
                     'RUN env | grep &quot;no_proxy=d&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         self.client.build(
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L73'>tests/integration/api_build_test.py~L73</a></p>
<pre><code class="language-diff">                     &quot;ADD https://dl.dropboxusercontent.com/u/20637798/silence.tar.gz&quot;
                     &quot; /tmp/silence.tar.gz&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
         stream = self.client.build(fileobj=script, decode=True)
         logs = []
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L197'>tests/integration/api_build_test.py~L197</a></p>
<pre><code class="language-diff">                     &quot;FROM scratch&quot;,
                     &quot;CMD sh -c \&quot;echo 'Hello, World!'\&quot;&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         tag = &quot;shmsize&quot;
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L214'>tests/integration/api_build_test.py~L214</a></p>
<pre><code class="language-diff">     @requires_api_version(&quot;1.24&quot;)
     def test_build_isolation(self):
         script = io.BytesIO(
-            &quot;\n&quot;.join(
-                [&quot;FROM scratch&quot;, &quot;CMD sh -c \&quot;echo 'Deaf To All But The Song'&quot;]
-            ).encode(&quot;ascii&quot;)
+            &quot;\n&quot;.join([&quot;FROM scratch&quot;, &quot;CMD sh -c \&quot;echo 'Deaf To All But The Song'&quot;])
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(fileobj=script, tag=&quot;isolation&quot;, isolation=&quot;default&quot;)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L231'>tests/integration/api_build_test.py~L231</a></p>
<pre><code class="language-diff">                 [
                     &quot;FROM scratch&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         labels = {&quot;test&quot;: &quot;OK&quot;}
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L254'>tests/integration/api_build_test.py~L254</a></p>
<pre><code class="language-diff">                     &quot;RUN touch baz&quot;,
                     &quot;RUN touch bax&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(fileobj=script, tag=&quot;build1&quot;)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L294'>tests/integration/api_build_test.py~L294</a></p>
<pre><code class="language-diff">                     &quot;WORKDIR /root/COPY --from=first /tmp/silence.tar.gz .&quot;,
                     'ONBUILD RUN echo &quot;This should not be in the final image&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(fileobj=script, target=&quot;first&quot;, tag=&quot;build1&quot;)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L318'>tests/integration/api_build_test.py~L318</a></p>
<pre><code class="language-diff">         )
 
         script = io.BytesIO(
-            &quot;\n&quot;.join([&quot;FROM busybox&quot;, &quot;RUN ping -c1 pingtarget.docker&quot;]).encode(
-                &quot;ascii&quot;
-            )
+            &quot;\n&quot;.join([&quot;FROM busybox&quot;, &quot;RUN ping -c1 pingtarget.docker&quot;])
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L363'>tests/integration/api_build_test.py~L363</a></p>
<pre><code class="language-diff">                     &quot;RUN ping -c1 extrahost.local.test&quot;,
                     &quot;RUN cp /etc/hosts /hosts-file&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L397'>tests/integration/api_build_test.py~L397</a></p>
<pre><code class="language-diff">                     &quot;RUN echo blahblah &gt; /file_2&quot;,
                     &quot;RUN echo blahblahblah &gt; /file_3&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         def build_squashed(squash):
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L31'>tests/ssh/api_build_test.py~L31</a></p>
<pre><code class="language-diff">                     'RUN env | grep &quot;NO_PROXY=d&quot;',
                     'RUN env | grep &quot;no_proxy=d&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         self.client.build(fileobj=script, decode=True)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L54'>tests/ssh/api_build_test.py~L54</a></p>
<pre><code class="language-diff">                     'RUN env | grep &quot;NO_PROXY=d&quot;',
                     'RUN env | grep &quot;no_proxy=d&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         self.client.build(
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L73'>tests/ssh/api_build_test.py~L73</a></p>
<pre><code class="language-diff">                     &quot;ADD https://dl.dropboxusercontent.com/u/20637798/silence.tar.gz&quot;
                     &quot; /tmp/silence.tar.gz&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
         stream = self.client.build(fileobj=script, decode=True)
         logs = []
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L189'>tests/ssh/api_build_test.py~L189</a></p>
<pre><code class="language-diff">                     &quot;FROM scratch&quot;,
                     &quot;CMD sh -c \&quot;echo 'Hello, World!'\&quot;&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         tag = &quot;shmsize&quot;
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L206'>tests/ssh/api_build_test.py~L206</a></p>
<pre><code class="language-diff">     @requires_api_version(&quot;1.24&quot;)
     def test_build_isolation(self):
         script = io.BytesIO(
-            &quot;\n&quot;.join(
-                [&quot;FROM scratch&quot;, &quot;CMD sh -c \&quot;echo 'Deaf To All But The Song'&quot;]
-            ).encode(&quot;ascii&quot;)
+            &quot;\n&quot;.join([&quot;FROM scratch&quot;, &quot;CMD sh -c \&quot;echo 'Deaf To All But The Song'&quot;])
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(fileobj=script, tag=&quot;isolation&quot;, isolation=&quot;default&quot;)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L223'>tests/ssh/api_build_test.py~L223</a></p>
<pre><code class="language-diff">                 [
                     &quot;FROM scratch&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         labels = {&quot;test&quot;: &quot;OK&quot;}
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L246'>tests/ssh/api_build_test.py~L246</a></p>
<pre><code class="language-diff">                     &quot;RUN touch baz&quot;,
                     &quot;RUN touch bax&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(fileobj=script, tag=&quot;build1&quot;)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L286'>tests/ssh/api_build_test.py~L286</a></p>
<pre><code class="language-diff">                     &quot;WORKDIR /root/COPY --from=first /tmp/silence.tar.gz .&quot;,
                     'ONBUILD RUN echo &quot;This should not be in the final image&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(fileobj=script, target=&quot;first&quot;, tag=&quot;build1&quot;)
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L310'>tests/ssh/api_build_test.py~L310</a></p>
<pre><code class="language-diff">         )
 
         script = io.BytesIO(
-            &quot;\n&quot;.join([&quot;FROM busybox&quot;, &quot;RUN ping -c1 pingtarget.docker&quot;]).encode(
-                &quot;ascii&quot;
-            )
+            &quot;\n&quot;.join([&quot;FROM busybox&quot;, &quot;RUN ping -c1 pingtarget.docker&quot;])
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L355'>tests/ssh/api_build_test.py~L355</a></p>
<pre><code class="language-diff">                     &quot;RUN ping -c1 extrahost.local.test&quot;,
                     &quot;RUN cp /etc/hosts /hosts-file&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         stream = self.client.build(
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/ssh/api_build_test.py#L389'>tests/ssh/api_build_test.py~L389</a></p>
<pre><code class="language-diff">                     &quot;RUN echo blahblah &gt; /file_2&quot;,
                     &quot;RUN echo blahblahblah &gt; /file_3&quot;,
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         def build_squashed(squash):
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/facebookresearch/chameleon">facebookresearch/chameleon</a> (+2 -1 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/facebookresearch/chameleon/blob/dbbe47fdbc7a3cc4982ae931fea75e227262e70a/chameleon/inference/chameleon.py#L131'>chameleon/inference/chameleon.py~L131</a></p>
<pre><code class="language-diff">             [self.vocab.begin_image]
             + self.translation.convert_img2bp2(
                 self.image_tokenizer.img_tokens_from_pil(img)
-            ).tolist()
+            )
+            .tolist()
             + [self.vocab.end_image]
         )
 
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+8 -6 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/freedomofpress/securedrop/blob/abee0e643ea1cb5d434fdd104196d9ab092005be/securedrop/alembic/versions/d9d36b6f4d1e_remove_partial_index_on_valid_until_set_.py#L28'>securedrop/alembic/versions/d9d36b6f4d1e_remove_partial_index_on_valid_until_set_.py~L28</a></p>
<pre><code class="language-diff">     op.execute(
         sa.text(
             &quot;UPDATE OR IGNORE instance_config SET valid_until=:epoch WHERE valid_until IS NULL;&quot;
-        ).bindparams(epoch=datetime.fromtimestamp(0))
+        )
+        .bindparams(epoch=datetime.fromtimestamp(0))
     )
 
     # add new columns with default values
</code></pre>
<p><a href='https://github.com/freedomofpress/securedrop/blob/abee0e643ea1cb5d434fdd104196d9ab092005be/securedrop/alembic/versions/d9d36b6f4d1e_remove_partial_index_on_valid_until_set_.py#L58'>securedrop/alembic/versions/d9d36b6f4d1e_remove_partial_index_on_valid_until_set_.py~L58</a></p>
<pre><code class="language-diff"> 
     # valid_until is nullable again, set entries with unix epoch datetime value to NULL
     op.execute(
-        sa.text(
-            &quot;UPDATE OR IGNORE instance_config SET valid_until = NULL WHERE valid_until=:epoch;&quot;
-        ).bindparams(epoch=datetime.fromtimestamp(0))
+        sa.text(&quot;UPDATE OR IGNORE instance_config SET valid_until = NULL WHERE valid_until=:epoch;&quot;)
+        .bindparams(epoch=datetime.fromtimestamp(0))
     )
 
     # manually restore the partial index
</code></pre>
<p><a href='https://github.com/freedomofpress/securedrop/blob/abee0e643ea1cb5d434fdd104196d9ab092005be/securedrop/source_app/main.py#L273'>securedrop/source_app/main.py~L273</a></p>
<pre><code class="language-diff">         if msg:
             logged_in_source_in_db.interaction_count += 1
             fnames.append(
-                Storage.get_default().save_message_submission(
+                Storage.get_default()
+                .save_message_submission(
                     logged_in_source_in_db.filesystem_id,
                     logged_in_source_in_db.interaction_count,
                     logged_in_source_in_db.journalist_filename,
</code></pre>
<p><a href='https://github.com/freedomofpress/securedrop/blob/abee0e643ea1cb5d434fdd104196d9ab092005be/securedrop/source_app/main.py#L283'>securedrop/source_app/main.py~L283</a></p>
<pre><code class="language-diff">         if fh:
             logged_in_source_in_db.interaction_count += 1
             fnames.append(
-                Storage.get_default().save_file_submission(
+                Storage.get_default()
+                .save_file_submission(
                     logged_in_source_in_db.filesystem_id,
                     logged_in_source_in_db.interaction_count,
                     logged_in_source_in_db.journalist_filename,
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/latchbio/latch">latchbio/latch</a> (+2 -1 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/latchbio/latch/blob/dc91e5b22db76d1dcab1acf91c3afbcc597c0c3a/src/latch_cli/nextflow/config.py#L63'>src/latch_cli/nextflow/config.py~L63</a></p>
<pre><code class="language-diff">         default_value = gpjson.MessageToDict(
             TypeEngine.to_literal(
                 ctx, python_val, python_typ, TypeEngine.to_literal_type(python_typ)
-            ).to_flyte_idl()
+            )
+            .to_flyte_idl()
         )
 
     annotated = Annotated[
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+4 -2 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/milvus-io/pymilvus/blob/f01620ee42018d8d4f39e02ee771a78e8bd6e3d6/examples/bulk_import/bulk_writer_all_types.py#L206'>examples/bulk_import/bulk_writer_all_types.py~L206</a></p>
<pre><code class="language-diff">         &quot;json&quot;: {&quot;dummy&quot;: i},
         &quot;timestamp&quot;: shanghai_tz.localize(
             datetime.datetime(2025, 1, 1, 0, 0, 0) + datetime.timedelta(days=i)
-        ).isoformat(),
+        )
+        .isoformat(),
         &quot;geometry&quot;: f&quot;POINT ({i} {i})&quot;,
         &quot;array_bool&quot;: [True if (i + k) % 2 == 0 else False for k in range(4)],
         &quot;array_int8&quot;: [(i + k) % 128 for k in range(4)],
</code></pre>
<p><a href='https://github.com/milvus-io/pymilvus/blob/f01620ee42018d8d4f39e02ee771a78e8bd6e3d6/examples/timestamptz.py#L49'>examples/timestamptz.py~L49</a></p>
<pre><code class="language-diff">             &quot;id&quot;: i + 1,
             &quot;tsz&quot;: shanghai_tz.localize(
                 datetime.datetime(2025, 1, 1, 0, 0, 0) + datetime.timedelta(days=i)
-            ).isoformat(),
+            )
+            .isoformat(),
             &quot;vec&quot;: [float(i) / 10 for i in range(4)],
         }
         for i in range(data_size)
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/pypa/pip">pypa/pip</a> (+8 -4 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/pypa/pip/blob/db8121d6c3bb1543c6c4fca48de010814d1ddcb2/tests/functional/test_install_reqs.py#L277'>tests/functional/test_install_reqs.py~L277</a></p>
<pre><code class="language-diff">             -e {}@10#egg=INITools
             -r {}-req.txt
         &quot;&quot;&quot;
-        ).format(
+        )
+        .format(
             local_checkout(&quot;svn+http://svn.colorstudy.com/INITools&quot;, tmpdir),
             other_lib_name,
         ),
</code></pre>
<p><a href='https://github.com/pypa/pip/blob/db8121d6c3bb1543c6c4fca48de010814d1ddcb2/tests/functional/test_install_reqs.py#L833'>tests/functional/test_install_reqs.py~L833</a></p>
<pre><code class="language-diff">             &quot;&quot;&quot;\
             {url}; {req}
         &quot;&quot;&quot;
-        ).format(
+        )
+        .format(
             url=&quot;https://github.com/a/b/c/asdf-1.5.2-cp27-none-xyz.whl&quot;,
             req='sys_platform == &quot;xyz&quot;',
         )
</code></pre>
<p><a href='https://github.com/pypa/pip/blob/db8121d6c3bb1543c6c4fca48de010814d1ddcb2/tests/functional/test_uninstall.py#L466'>tests/functional/test_uninstall.py~L466</a></p>
<pre><code class="language-diff">             # and something else to test out:
             PyLogo&lt;0.4
         &quot;&quot;&quot;
-        ).format(url=local_svn_url)
+        )
+        .format(url=local_svn_url)
     )
     result = script.pip(&quot;install&quot;, &quot;-r&quot;, &quot;test-req.txt&quot;)
     script.scratch_path.joinpath(&quot;test-req.txt&quot;).write_text(
</code></pre>
<p><a href='https://github.com/pypa/pip/blob/db8121d6c3bb1543c6c4fca48de010814d1ddcb2/tests/functional/test_uninstall.py#L481'>tests/functional/test_uninstall.py~L481</a></p>
<pre><code class="language-diff">             # and something else to test out:
             PyLogo&lt;0.4
         &quot;&quot;&quot;
-        ).format(url=local_svn_url)
+        )
+        .format(url=local_svn_url)
     )
     result2 = script.pip(&quot;uninstall&quot;, &quot;-r&quot;, &quot;test-req.txt&quot;, &quot;-y&quot;)
     assert_all_changes(
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/qdrant/qdrant-client">qdrant/qdrant-client</a> (+20 -30 lines across 2 files)</summary>
<p>

<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/conversions/test_validate_conversions.py#L43'>tests/conversions/test_validate_conversions.py~L43</a></p>
<pre><code class="language-diff"> 
             try:
                 result = list(
-                    inspect.signature(
-                        grpc_to_rest_convert[convert_function_name]
-                    ).parameters.keys()
+                    inspect.signature(grpc_to_rest_convert[convert_function_name])
+                    .parameters.keys()
                 )
                 if &quot;collection_name&quot; in result:
                     rest_fixture = grpc_to_rest_convert[convert_function_name](
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/conversions/test_validate_conversions.py#L61'>tests/conversions/test_validate_conversions.py~L61</a></p>
<pre><code class="language-diff">                 )
 
                 result = list(
-                    inspect.signature(
-                        rest_to_grpc_convert[back_convert_function_name]
-                    ).parameters.keys()
+                    inspect.signature(rest_to_grpc_convert[back_convert_function_name])
+                    .parameters.keys()
                 )
                 if &quot;collection_name&quot; in result:
                     grpc_fixture = rest_to_grpc_convert[back_convert_function_name](
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L387'>tests/embed_tests/test_local_inference.py~L387</a></p>
<pre><code class="language-diff">     remote_client.upload_points(COLLECTION_NAME, points, wait=True)
     assert remote_client.count(COLLECTION_NAME).count == len(points)
     assert isinstance(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;text&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;text&quot;],
         list,
     )  # assert doc has been substituted with its embedding
 
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L422'>tests/embed_tests/test_local_inference.py~L422</a></p>
<pre><code class="language-diff"> 
     assert remote_client.count(COLLECTION_NAME).count == len(vectors)
     assert isinstance(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;text&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;text&quot;],
         list,
     )  # assert doc has been substituted with its embedding
 
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L435'>tests/embed_tests/test_local_inference.py~L435</a></p>
<pre><code class="language-diff">     )
     assert remote_client.count(COLLECTION_NAME).count == len(points)
     assert isinstance(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;text&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;text&quot;],
         list,
     )  # assert doc has been substituted with its embedding
 
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L449'>tests/embed_tests/test_local_inference.py~L449</a></p>
<pre><code class="language-diff"> 
     assert remote_client.count(COLLECTION_NAME).count == len(vectors)
     assert isinstance(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;text&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;text&quot;],
         list,
     )  # assert doc has been substituted with its embedding
 
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L465'>tests/embed_tests/test_local_inference.py~L465</a></p>
<pre><code class="language-diff"> 
     assert remote_client.count(COLLECTION_NAME).count == len(points)
     assert isinstance(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;text&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;text&quot;],
         list,
     )  # assert doc has been substituted with its embedding
 
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L486'>tests/embed_tests/test_local_inference.py~L486</a></p>
<pre><code class="language-diff"> 
     assert remote_client.count(COLLECTION_NAME).count == len(vectors)
     assert isinstance(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;text&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;text&quot;],
         list,
     )  # assert doc has been substituted with its embedding
 
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L1541'>tests/embed_tests/test_local_inference.py~L1541</a></p>
<pre><code class="language-diff"> 
     assert remote_client.count(COLLECTION_NAME).count == len(points)
     assert np.allclose(
-        remote_client.retrieve(COLLECTION_NAME, ids=[2], with_vectors=True)[0].vector[
-            &quot;plain&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[2], with_vectors=True)[0]
+        .vector[&quot;plain&quot;],
         norm_ref_vector,
     )
     remote_client.delete_collection(COLLECTION_NAME)
</code></pre>
<p><a href='https://github.com/qdrant/qdrant-client/blob/750d735b2917a30b0cbf468ddccbc47d12704e32/tests/embed_tests/test_local_inference.py#L1675'>tests/embed_tests/test_local_inference.py~L1675</a></p>
<pre><code class="language-diff"> 
     assert remote_client.count(COLLECTION_NAME).count == len(vectors)
     assert np.allclose(
-        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0].vector[
-            &quot;plain&quot;
-        ],
+        remote_client.retrieve(COLLECTION_NAME, ids=[1], with_vectors=True)[0]
+        .vector[&quot;plain&quot;],
         norm_ref_vector,
     )
 
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/reflex-dev/reflex">reflex-dev/reflex</a> (+20 -15 lines across 7 files)</summary>
<p>

<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/components/component.py#L1955'>reflex/components/component.py~L1955</a></p>
<pre><code class="language-diff">                 else (
                     annotation_args[1]
                     if get_origin(
-                        annotation := inspect.getfullargspec(component_fn).annotations[
-                            key
-                        ]
+                        annotation := inspect.getfullargspec(component_fn)
+                        .annotations[key]
                     )
                     is typing.Annotated
                     and (annotation_args := get_args(annotation))
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/components/markdown/markdown.py#L290'>reflex/components/markdown/markdown.py~L290</a></p>
<pre><code class="language-diff">             *(
                 [inline_code_var_data.old_school_imports()]
                 if (
-                    inline_code_var_data
-                    := self._get_inline_code_fn_var()._get_all_var_data()
+                    inline_code_var_data := self._get_inline_code_fn_var()
+                    ._get_all_var_data()
                 )
                 is not None
                 else []
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L687'>reflex/event.py~L687</a></p>
<pre><code class="language-diff">                 &quot;meta_key&quot;: e.metaKey,
                 &quot;shift_key&quot;: e.shiftKey,
             },
-        ).to(KeyInputInfo),
+        )
+        .to(KeyInputInfo),
     )
 
 
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L755'>reflex/event.py~L755</a></p>
<pre><code class="language-diff">                 &quot;meta_key&quot;: e.metaKey,
                 &quot;shift_key&quot;: e.shiftKey,
             },
-        ).to(PointerEventInfo),
+        )
+        .to(PointerEventInfo),
     )
 
 
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/experimental/client_state.py#L152'>reflex/experimental/client_state.py~L152</a></p>
<pre><code class="language-diff">                                 f&quot;(value) =&gt; {{ {_client_state_ref(var_name)} = value; }}&quot;
                             )
                         ]
-                    ).to(list),
+                    )
+                    .to(list),
                     ArgsFunctionOperationBuilder.create(
                         args_names=(&quot;setter&quot;,),
                         return_expr=Var(&quot;setter&quot;).to(FunctionVar).call(Var(arg_name)),
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/vars/base.py#L3253'>reflex/vars/base.py~L3253</a></p>
<pre><code class="language-diff">                 _var_type=fn_return_type,
                 _var_data=var_data,
                 _js_expr=field_name,
-            ).guess_type()
+            )
+            .guess_type()
         )
 
         return fn(var)
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/tests/units/components/test_component.py#L1066'>tests/units/components/test_component.py~L1066</a></p>
<pre><code class="language-diff">             component3.create(),
             component4.create(),
             component3.create(),
-        )._get_all_hooks()
+        )
+        ._get_all_hooks()
         == exp_hooks
     )
 
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/tests/units/components/test_component.py#L1961'>tests/units/components/test_component.py~L1961</a></p>
<pre><code class="language-diff">         BaseComponent.create(
             GrandchildComponent1.create(GreatGrandchildComponent2.create()),
             GreatGrandchildComponent1.create(),
-        )._get_all_hooks(),
+        )
+        ._get_all_hooks(),
     ) == [
         &quot;const hook1 = 42&quot;,
         &quot;const hook2 = 43&quot;,
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/tests/units/components/test_component.py#L1974'>tests/units/components/test_component.py~L1974</a></p>
<pre><code class="language-diff">         Fragment.create(
             GreatGrandchildComponent2.create(),
             GreatGrandchildComponent1.create(),
-        )._get_all_hooks()
+        )
+        ._get_all_hooks()
     ) == [
         &quot;const hook5 = 46&quot;,
         &quot;const hook2 = 43&quot;,
</code></pre>
<p><a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/tests/units/test_state.py#L2421'>tests/units/test_state.py~L2421</a></p>
<pre><code class="language-diff"> 
     first_ws_message = emit_mock.mock_calls[0].args[1]  # pyright: ignore [reportAttributeAccessIssue]
     assert (
-        first_ws_message.delta[BackgroundTaskState.get_full_name()].pop(
-            &quot;router&quot; + FIELD_MARKER
-        )
+        first_ws_message.delta[BackgroundTaskState.get_full_name()]
+        .pop(&quot;router&quot; + FIELD_MARKER)
         is not None
     )
     assert first_ws_message == StateUpdate(
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/rotki/rotki">rotki/rotki</a> (+718 -465 lines across 66 files)</summary>
<p>

<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/package.py#L330'>package.py~L330</a></p>
<pre><code class="language-diff">                 'python -c &quot;import os, sys; print(os.path.dirname(sys.executable))&quot;',
                 encoding=&quot;utf8&quot;,
                 shell=True,
-            ).strip(),
+            )
+            .strip(),
         )
 
         if python_dir.name != &quot;Scripts&quot;:
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L1068'>rotkehlchen/api/rest.py~L1068</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM {table} WHERE tx_hash=?&quot;,
                     (event.tx_ref,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 != 0
             ):
                 return None
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L2728'>rotkehlchen/api/rest.py~L2728</a></p>
<pre><code class="language-diff">                 old_endpoint := cursor.execute(
                     &quot;SELECT endpoint FROM rpc_nodes WHERE identifier=?&quot;,
                     (node.identifier,),
-                ).fetchone()
+                )
+                .fetchone()
             ) is None:
                 return api_response(
                     wrap_in_fail_result(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L3430'>rotkehlchen/api/rest.py~L3430</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM blockchain_accounts WHERE blockchain IN ({','.join(['?'] * len(EVM_CHAINS_WITH_TRANSACTIONS))})&quot;,  # noqa: E501
                     [blockchain.value for blockchain in EVM_CHAINS_WITH_TRANSACTIONS],
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0
             )
             exchanges_bindings_with_rotkehlchen = [
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L3440'>rotkehlchen/api/rest.py~L3440</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM user_credentials WHERE location IN ({','.join(['?'] * len(SUPPORTED_EXCHANGES))}) AND name != ?&quot;,  # noqa: E501
                     exchanges_bindings_with_rotkehlchen,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L3475'>rotkehlchen/api/rest.py~L3475</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM blockchain_accounts WHERE blockchain IN ({','.join(['?'] * len(EVM_CHAINS_WITH_TRANSACTIONS))})&quot;,  # noqa: E501
                     [blockchain.value for blockchain in EVM_CHAINS_WITH_TRANSACTIONS],
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L3510'>rotkehlchen/api/rest.py~L3510</a></p>
<pre><code class="language-diff">             if (
                 undecoded_count := cursor.execute(
                     &quot;SELECT COUNT(*) FROM zksynclite_transactions WHERE is_decoded=0&quot;,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
             ) != 0:
                 tx_info[chain_name := SupportedBlockchain.ZKSYNC_LITE.name.lower()][
                     &quot;undecoded&quot;
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L6541'>rotkehlchen/api/rest.py~L6541</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM user_added_solana_tokens WHERE identifier = ?&quot;,
                     (old_asset.identifier,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             ):
                 return wrap_in_fail_result(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest.py#L6592'>rotkehlchen/api/rest.py~L6592</a></p>
<pre><code class="language-diff"> 
             with GlobalDBHandler().conn.write_ctx() as write_cursor:
                 if (
-                    write_cursor.execute(
-                        &quot;SELECT COUNT(*) FROM user_added_solana_tokens&quot;
-                    ).fetchone()[0]
+                    write_cursor.execute(&quot;SELECT COUNT(*) FROM user_added_solana_tokens&quot;)
+                    .fetchone()[0]
                     == 0
                 ):  # noqa: E501
                     write_cursor.execute(&quot;DROP TABLE user_added_solana_tokens&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest_helpers/history_events.py#L35'>rotkehlchen/api/rest_helpers/history_events.py~L35</a></p>
<pre><code class="language-diff">             := write_cursor.execute(  # Get the group_identifier, selecting by the identifier of the first event.  # noqa: E501
                 &quot;SELECT group_identifier FROM history_events WHERE identifier=?&quot;,
                 (events[0].identifier,),
-            ).fetchone()
+            )
+            .fetchone()
         )
         is not None
     ):
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/rest_helpers/history_events.py#L129'>rotkehlchen/api/rest_helpers/history_events.py~L129</a></p>
<pre><code class="language-diff">             write_cursor.execute(  # Check if this event will hit a sequence_index that is already in use.  # noqa: E501
                 &quot;SELECT COUNT(*) FROM history_events WHERE group_identifier=? AND sequence_index=?&quot;,
                 (group_identifier, event.sequence_index),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             != 0
         ):
             raise InputError(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/v1/schemas.py#L1168'>rotkehlchen/api/v1/schemas.py~L1168</a></p>
<pre><code class="language-diff">                     group_identifier=data[&quot;group_identifier&quot;],
                     amount=data[&quot;amount&quot;],
                     extra_data=extra_data,
-                    fee_identifier=CreateHistoryEventSchema.history_event_context.get()[
-                        &quot;schema&quot;
-                    ].get_grouped_event_identifier(
+                    fee_identifier=CreateHistoryEventSchema.history_event_context.get()[&quot;schema&quot;]
+                    .get_grouped_event_identifier(
                         data=data,
                         subtype=HistoryEventSubType.FEE,
                         sequence_index_offset=1,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/api/v1/schemas.py#L4535'>rotkehlchen/api/v1/schemas.py~L4535</a></p>
<pre><code class="language-diff">                     cursor.execute(
                         &quot;SELECT COUNT(*) FROM blockchain_accounts WHERE account=? AND blockchain=?&quot;,
                         (address, (chain := data[&quot;chain&quot;]).value),
-                    ).fetchone()[0]
+                    )
+                    .fetchone()[0]
                     == 0
                 ):
                     raise ValidationError(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/base/modules/basenames/decoder.py#L93'>rotkehlchen/chain/base/modules/basenames/decoder.py~L93</a></p>
<pre><code class="language-diff">         # Call the L2 Resolver contract's name method.
         try:
             if not (
-                name_to_show := self.node_inquirer.contracts.contract(BASENAMES_L2_RESOLVER).call(  # noqa: E501
+                name_to_show := self.node_inquirer.contracts.contract(BASENAMES_L2_RESOLVER)
+                .call(  # noqa: E501
                     node_inquirer=self.node_inquirer,
                     method_name=&quot;name&quot;,
                     arguments=[node],
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L88'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L88</a></p>
<pre><code class="language-diff">                         self.routing_assets[chain_id].append(
                             get_or_create_evm_token(
                                 userdb=(
-                                    node_inquirer := Inquirer()
-                                    .get_evm_manager(chain_id)
-                                    .node_inquirer
+                                    node_inquirer := Inquirer().get_evm_manager(
+                                        chain_id
+                                    ).node_inquirer
                                 ).database,  # noqa: E501
                                 evm_address=string_to_evm_address(asset.identifier.split(&quot;:&quot;)[-1]),
                                 chain_id=chain_id,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/active_management/manager.py#L36'>rotkehlchen/chain/evm/active_management/manager.py~L36</a></p>
<pre><code class="language-diff">             contract.functions.transfer(
                 to_address,
                 asset_raw_value(amount=amount, asset=token),
-            ).build_transaction(
+            )
+            .build_transaction(
                 {
                     &quot;from&quot;: from_address,
                     &quot;nonce&quot;: rpc_client.eth.get_transaction_count(from_address),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/decoding/cowswap/decoder.py#L198'>rotkehlchen/chain/evm/decoding/cowswap/decoder.py~L198</a></p>
<pre><code class="language-diff"> 
             trades.append(
                 CowswapSwapData(
-                    from_asset=self.base.exceptions_mappings.get(
-                        from_asset.identifier, from_asset
-                    ).resolve_to_crypto_asset(),  # noqa: E501
+                    from_asset=self.base.exceptions_mappings.get(from_asset.identifier, from_asset)
+                    .resolve_to_crypto_asset(),  # noqa: E501
                     from_amount=from_amount - fee_amount,  # fee is taken as part of from asset
-                    to_asset=self.base.exceptions_mappings.get(
-                        to_asset.identifier, to_asset
-                    ).resolve_to_crypto_asset(),  # noqa: E501
+                    to_asset=self.base.exceptions_mappings.get(to_asset.identifier, to_asset)
+                    .resolve_to_crypto_asset(),  # noqa: E501
                     to_amount=to_amount,
                     fee_amount=fee_amount,
                     order_uid=order_uid,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/decoding/curve/curve_cache.py#L665'>rotkehlchen/chain/evm/decoding/curve/curve_cache.py~L665</a></p>
<pre><code class="language-diff">             key := cursor.execute(
                 &quot;SELECT key FROM unique_cache WHERE value = ?&quot;,
                 (pool_address,),
-            ).fetchone()
+            )
+            .fetchone()
         ) is not None:
             addresses.add(key[0][-42:])  # 42 is the length of the EVM address
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/decoding/curve/lend/decoder.py#L301'>rotkehlchen/chain/evm/decoding/curve/lend/decoder.py~L301</a></p>
<pre><code class="language-diff">                 key := cursor.execute(
                     &quot;SELECT key FROM unique_cache WHERE value = ?&quot;,
                     (controller_address,),
-                ).fetchone()
+                )
+                .fetchone()
             ) is None:
                 log.error(
                     &quot;Failed to find Curve lending vault address for controller &quot;
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/decoding/efp/decoder.py#L75'>rotkehlchen/chain/evm/decoding/efp/decoder.py~L75</a></p>
<pre><code class="language-diff">         try:
             if (
                 address := to_checksum_address(
-                    self.node_inquirer.contracts.contract(self.list_records_contract).call(  # noqa: E501
+                    self.node_inquirer.contracts.contract(self.list_records_contract)
+                    .call(  # noqa: E501
                         node_inquirer=self.node_inquirer,
                         method_name=&quot;getListUser&quot;,
                         arguments=[slot],
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/decoding/extrafi/balances.py#L97'>rotkehlchen/chain/evm/decoding/extrafi/balances.py~L97</a></p>
<pre><code class="language-diff">                     self.addresses_with_activity(
                         event_types=self.deposit_event_types,
                         assets=(self.extrafi_token,),
-                    ).keys()
+                    )
+                    .keys()
                 )
             )
             != 0
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/decoding/quickswap/utils.py#L95'>rotkehlchen/chain/evm/decoding/quickswap/utils.py~L95</a></p>
<pre><code class="language-diff">                         (token1_address := deserialize_evm_address(position_info[&quot;token1&quot;])),
                     ],
                 )
-            ).hex(),
+            )
+            .hex(),
             init_code=pool_init_code_hash,
             is_init_code_hashed=True,
         )
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/evm/transactions.py#L698'>rotkehlchen/chain/evm/transactions.py~L698</a></p>
<pre><code class="language-diff">             db_id=cursor.execute(
                 &quot;SELECT identifier FROM evm_transactions WHERE tx_hash=? AND chain_id=?&quot;,
                 (tx_hash, transaction.chain_id.serialize_for_db()),
-            ).fetchone()[0],
+            )
+            .fetchone()[0],
             authorization_list=transaction.authorization_list,
         ), tx_receipt  # type: ignore  # tx_receipt can't be None here
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/solana/transactions.py#L219'>rotkehlchen/chain/solana/transactions.py~L219</a></p>
<pre><code class="language-diff">                         &quot;AND block_time &lt;= COALESCE((SELECT MIN(block_time) FROM solana_transactions WHERE block_time &gt; ?), ?) &quot;  # noqa: E501
                         &quot;ORDER BY block_time;&quot;,
                         (address, start_ts, start_ts, end_ts, end_ts),
-                    ).fetchall()
+                    )
+                    .fetchall()
                 )
                 != 0
             ):
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/data_import/importers/binance.py#L393'>rotkehlchen/data_import/importers/binance.py~L393</a></p>
<pre><code class="language-diff">                 &quot;_&quot;.join(
                     hash_binance_csv_row(row)
                     for row in sorted(trade_rows, key=operator.itemgetter(INDEX))
-                ).encode()
+                )
+                .encode()
             ).hexdigest()  # noqa: E501
             swap_events.extend(
                 create_swap_events(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/data_migrations/migrations/migration_20.py#L201'>rotkehlchen/data_migrations/migrations/migration_20.py~L201</a></p>
<pre><code class="language-diff">                 affected_events_count := cursor.execute(
                     f&quot;SELECT COUNT(*) FROM history_events WHERE event_identifier IN ({placeholders})&quot;,
                     location_hashes,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
             ) == 0:
                 log.debug(&quot;no trades affected by v1.39.0 upgrade bug&quot;)
                 return
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/accounting_rules.py#L125'>rotkehlchen/db/accounting_rules.py~L125</a></p>
<pre><code class="language-diff">                             else NO_ACCOUNTING_COUNTERPARTY,
                             *rule.serialize_for_db(),
                         ),
-                    ).fetchone()
+                    )
+                    .fetchone()
                 ) is not None:  # add event IDs to the existing event-specific rule
                     write_cursor.executemany(
                         &quot;INSERT INTO accounting_rule_events(rule_id, event_id) VALUES (?, ?)&quot;,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/accounting_rules.py#L563'>rotkehlchen/db/accounting_rules.py~L563</a></p>
<pre><code class="language-diff">             &quot;JOIN accounting_rule_events ON accounting_rules.identifier = rule_id &quot;
             &quot;WHERE event_id=?&quot;,
             (event.identifier,),
-        ).fetchone()
+        )
+        .fetchone()
     ) is not None:
         cache_identifier = event.get_accounting_rule_key()
     else:  # if no event-specific rule found, try type-based rules
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/addressbook.py#L103'>rotkehlchen/db/addressbook.py~L103</a></p>
<pre><code class="language-diff">                         entry.address,
                         entry.blockchain.value if entry.blockchain else entry.get_ecosystem_key(),
                     ),  # noqa: E501
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 != 0
             ):
                 raise InputError(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/addressbook.py#L263'>rotkehlchen/db/addressbook.py~L263</a></p>
<pre><code class="language-diff">                     names := cursor.execute(
                         &quot;SELECT name FROM address_book WHERE address=?&quot;,
                         (address,),
-                    ).fetchall()
+                    )
+                    .fetchall()
                 )
             ) == 0 or len(set(names)) &gt; 1:
                 return  # If no name, or different names on different chains, leave as is.
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/dbhandler.py#L452'>rotkehlchen/db/dbhandler.py~L452</a></p>
<pre><code class="language-diff">     ) -&gt; int | Timestamp | bool | Asset | list[&quot;ExchangeLocationID&quot;] | str | None:
         deserializer, default_value = self.setting_to_default_type[name]
         if (
-            result := cursor.execute(
-                &quot;SELECT value FROM settings WHERE name=?;&quot;, (name,)
-            ).fetchone()
+            result := cursor.execute(&quot;SELECT value FROM settings WHERE name=?;&quot;, (name,))
+            .fetchone()
         ) is not None:  # noqa: E501
             return deserializer(result[0])  # type: ignore
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/dbhandler.py#L742'>rotkehlchen/db/dbhandler.py~L742</a></p>
<pre><code class="language-diff">             value := cursor.execute(
                 &quot;SELECT value FROM key_value_cache WHERE name=?;&quot;,
                 (name.value,),
-            ).fetchone()
+            )
+            .fetchone()
         ) is None:
             return None
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/solanatx.py#L257'>rotkehlchen/db/solanatx.py~L257</a></p>
<pre><code class="language-diff">                     &quot;WHERE M.address = ? AND M.tx_id NOT IN (&quot;
                     &quot;SELECT tx_id FROM solanatx_address_mappings WHERE address != ?)&quot;,
                     (address, address),
-                ).fetchall()
+                )
+                .fetchall()
             )
             == 0
         ):
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/unresolved_conflicts.py#L98'>rotkehlchen/db/unresolved_conflicts.py~L98</a></p>
<pre><code class="language-diff">                     &quot;taxable&quot;: entry[4],
                     &quot;count_entire_amount_spend&quot;: entry[5],
                     &quot;count_cost_basis_pnl&quot;: entry[6],
-                    &quot;accounting_treatment&quot;: TxAccountingTreatment.deserialize_from_db(
-                        entry[7]
-                    ).serialize()
+                    &quot;accounting_treatment&quot;: TxAccountingTreatment.deserialize_from_db(entry[7])
+                    .serialize()
                     if entry[7] is not None
                     else None,  # noqa: E501
                 }
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/upgrades/v38_v39.py#L269'>rotkehlchen/db/upgrades/v38_v39.py~L269</a></p>
<pre><code class="language-diff">         table_exists = (
             write_cursor.execute(
                 &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='rpc_nodes'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         if table_exists:
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/upgrades/v45_v46.py#L43'>rotkehlchen/db/upgrades/v45_v46.py~L43</a></p>
<pre><code class="language-diff">         if (
             active_modules_result := write_cursor.execute(
                 &quot;SELECT value FROM settings where name='active_modules'&quot;
-            ).fetchone()
+            )
+            .fetchone()
         ) is None:  # noqa: E501
             return None
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/upgrades/v48_v49.py#L31'>rotkehlchen/db/upgrades/v48_v49.py~L31</a></p>
<pre><code class="language-diff">         if (
             write_cursor.execute(
                 &quot;SELECT name FROM sqlite_master WHERE type='table' AND name='zksynclite_swaps'&quot;
-            ).fetchone()
+            )
+            .fetchone()
             is None
         ):  # noqa: E501
             log.debug(&quot;zksynclite_swaps table does not exist, skipping upgrade&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/utils.py#L327'>rotkehlchen/db/utils.py~L327</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name=?&quot;,
             (name,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )
     if exists and schema is not None:
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/exchanges/binance.py#L804'>rotkehlchen/exchanges/binance.py~L804</a></p>
<pre><code class="language-diff">                         continue
 
                     event = HistoryEvent(
-                        group_identifier=hashlib.sha256(
-                            str(entry).encode()
-                        ).hexdigest(),  # entry hash  # noqa: E501
+                        group_identifier=hashlib.sha256(str(entry).encode())
+                        .hexdigest(),  # entry hash  # noqa: E501
                         sequence_index=0,  # since group_identifier is always different
                         timestamp=timestamp,
                         location=self.location,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/exchanges/utils.py#L91'>rotkehlchen/exchanges/utils.py~L91</a></p>
<pre><code class="language-diff">                 self.secret,
                 message,
                 digest_algorithm,
-            ).digest(),
+            )
+            .digest(),
         ).decode(&quot;utf-8&quot;)
 
     def generate_hmac_digest(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/externalapis/defillama.py#L306'>rotkehlchen/externalapis/defillama.py~L306</a></p>
<pre><code class="language-diff">                 coin_id_mapping={coin_id: from_asset},
                 from_assets=[from_asset],
                 to_asset=to_asset,
-            ).get(from_asset, ZERO_PRICE)
+            )
+            .get(from_asset, ZERO_PRICE)
         ) == ZERO_PRICE:
             raise NoPriceForGivenTimestamp(
                 from_asset=from_asset,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/externalapis/opensea.py#L71'>rotkehlchen/externalapis/opensea.py~L71</a></p>
<pre><code class="language-diff">                 continue
 
             with GlobalDBHandler().conn.read_ctx() as cursor:
-                asset_identifier = cursor.execute(  # we consider as correct to query only by address knowing that the same address could exist in different chains until opensea provides the correct chain value in the api  # noqa: E501
-                    &quot;SELECT identifier FROM evm_tokens WHERE address=?&quot;,
-                    (address,),
-                ).fetchone()
+                asset_identifier = (
+                    cursor.execute(  # we consider as correct to query only by address knowing that the same address could exist in different chains until opensea provides the correct chain value in the api  # noqa: E501
+                        &quot;SELECT identifier FROM evm_tokens WHERE address=?&quot;,
+                        (address,),
+                    )
+                    .fetchone()
+                )
                 if asset_identifier is not None:
                     return Asset(asset_identifier[0])
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/asset_updates/manager.py#L80'>rotkehlchen/globaldb/asset_updates/manager.py~L80</a></p>
<pre><code class="language-diff">         (
             result := write_cursor.execute(
                 &quot;SELECT value FROM other_db.settings WHERE name='version';&quot;
-            ).fetchone()
+            )
+            .fetchone()
         )
         is not None  # noqa: E501
         and int(result[0]) &gt;= FIRST_GLOBAL_DB_VERSION_WITH_SOLANA_TOKENS
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/asset_updates/manager.py#L342'>rotkehlchen/globaldb/asset_updates/manager.py~L342</a></p>
<pre><code class="language-diff">                     and cursor.execute(
                         &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                         (remote_asset_data.identifier,),
-                    ).fetchone()[0]
+                    )
+                    .fetchone()[0]
                     == 0
                 ):
                     executeall(cursor, full_insert)  # we apply the full insert query
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/cache.py#L111'>rotkehlchen/globaldb/cache.py~L111</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM general_cache WHERE key=? AND value=?&quot;,
             (compute_cache_key(key_parts), value),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/handler.py#L376'>rotkehlchen/globaldb/handler.py~L376</a></p>
<pre><code class="language-diff">                     data.update(
                         {
                             &quot;protocol&quot;: entry[11],
-                            &quot;token_kind&quot;: TokenKind.deserialize_solana_from_db(
-                                entry[13]
-                            ).serialize(),
+                            &quot;token_kind&quot;: TokenKind.deserialize_solana_from_db(entry[13])
+                            .serialize(),
                             &quot;address&quot;: entry[2],
                             &quot;decimals&quot;: entry[3],
                         }
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/handler.py#L422'>rotkehlchen/globaldb/handler.py~L422</a></p>
<pre><code class="language-diff">                 if assets_info[entry[0]][&quot;underlying_tokens&quot;] is None:
                     assets_info[entry[0]][&quot;underlying_tokens&quot;] = []
                 assets_info[entry[0]][&quot;underlying_tokens&quot;].append(
-                    UnderlyingToken.deserialize_from_db(
-                        (entry[1], entry[2], entry[3])
-                    ).serialize(),  # noqa: E501
+                    UnderlyingToken.deserialize_from_db((entry[1], entry[2], entry[3]))
+                    .serialize(),  # noqa: E501
                 )
 
             # get `entries_found`. In the case of handling the ignored assets we need to manually
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/handler.py#L1634'>rotkehlchen/globaldb/handler.py~L1634</a></p>
<pre><code class="language-diff">             for query_entry, (_, _, queried_timestamp) in zip(querylist, query_data, strict=True):
                 # to the params add the arguments to prioritize manual prices
                 result = (
-                    cursor.execute(
-                        querystr, query_entry + (priority_type, queried_timestamp)
-                    ).fetchone()
+                    cursor.execute(querystr, query_entry + (priority_type, queried_timestamp))
+                    .fetchone()
                 )  # below last index of the result tuple is ignored in deserialize  # noqa: E501
                 if result is None:
                     prices_results.append(None)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/handler.py#L2464'>rotkehlchen/globaldb/handler.py~L2464</a></p>
<pre><code class="language-diff">                 and cursor.execute(
                     &quot;SELECT COUNT(*) FROM location_unsupported_assets WHERE location=? AND exchange_symbol=?&quot;,  # noqa: E501
                     (exchange.serialize_for_db(), symbol),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0
             ):
                 raise UnsupportedAsset(symbol)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/handler.py#L2603'>rotkehlchen/globaldb/handler.py~L2603</a></p>
<pre><code class="language-diff">             and cursor.execute(
                 &quot;SELECT COUNT(*) FROM location_asset_mappings WHERE location IS NULL AND local_id=? AND exchange_symbol=?&quot;,  # noqa: E501
                 entry.serialize_for_db()[:2],  # the asset and the exchange symbol.
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             &gt; 0
         ):
             raise rsqlite.IntegrityError(&quot;Entry already exists in the DB&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/handler.py#L2711'>rotkehlchen/globaldb/handler.py~L2711</a></p>
<pre><code class="language-diff">                     protocol := cursor.execute(
                         &quot;SELECT protocol FROM evm_tokens WHERE identifier=?;&quot;,
                         (asset_identifier,),
-                    ).fetchone()
+                    )
+                    .fetchone()
                 )
                 is not None
                 else None
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/upgrades/v12_v13.py#L92'>rotkehlchen/globaldb/upgrades/v12_v13.py~L92</a></p>
<pre><code class="language-diff">                 user_tokens := write_cursor.execute(
                     &quot;SELECT identifier FROM assets WHERE type = ? AND identifier NOT LIKE ?&quot;,
                     (&quot;Y&quot;, &quot;solana%&quot;),
-                ).fetchall()
+                )
+                .fetchall()
             )
             == 0
         ):
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/globaldb/upgrades/v9_v10.py#L37'>rotkehlchen/globaldb/upgrades/v9_v10.py~L37</a></p>
<pre><code class="language-diff">                         write_cursor.execute(
                             &quot;SELECT MIN(asset) FROM multiasset_mappings WHERE collection_id = ?&quot;,
                             (id_,),
-                        ).fetchone()[0]
+                        )
+                        .fetchone()[0]
                     )
                 )
                 is None
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/inquirer.py#L864'>rotkehlchen/inquirer.py~L864</a></p>
<pre><code class="language-diff">                 to_asset=to_asset,
                 ignore_cache=ignore_cache,
                 skip_onchain=skip_onchain,
-            ).items()
+            )
+            .items()
         }
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/rotkehlchen.py#L621'>rotkehlchen/rotkehlchen.py~L621</a></p>
<pre><code class="language-diff">                 ),
                 extra_check_callback=lambda: cursor.execute(
                     &quot;SELECT COUNT(*) FROM user_added_solana_tokens&quot;
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0,  # noqa: E501
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/blockchain/test_base.py#L1736'>rotkehlchen/tests/api/blockchain/test_base.py~L1736</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM used_query_ranges WHERE name=?&quot;,
                 (f&quot;{BRIDGE_QUERIED_ADDRESS_PREFIX}{gnosis_accounts[0]}&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_accounting_rules.py#L802'>rotkehlchen/tests/api/test_accounting_rules.py~L802</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT * FROM accounting_rules WHERE identifier IN (1, 82);&quot;,
-            ).fetchall()
+            )
+            .fetchall()
             == [
                 (1, &quot;deposit&quot;, &quot;deposit asset&quot;, &quot;aave-v1&quot;, 0, 0, 1, &quot;A&quot;, 0),
                 (82, &quot;deposit&quot;, &quot;fee&quot;, NO_ACCOUNTING_COUNTERPARTY, 1, 0, 1, None, 0),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_assets_updates.py#L112'>rotkehlchen/tests/api/test_assets_updates.py~L112</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT name FROM asset_collections WHERE id=33&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;STASIS EURS&quot;
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multiasset_mappings WHERE collection_id=314 AND &quot;
                 &quot;asset='eip155:10/erc20:0xC52D7F23a2e460248Db6eE192Cb23dD12bDDCbf6'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_assets_updates.py#L278'>rotkehlchen/tests/api/test_assets_updates.py~L278</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM multiasset_mappings WHERE collection_id=314 AND &quot;
                     &quot;asset='eip155:10/erc20:0xC52D7F23a2e460248Db6eE192Cb23dD12bDDCbf6'&quot;,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
             assert (
                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM asset_collections WHERE id=39&quot;,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_assets_updates.py#L548'>rotkehlchen/tests/api/test_assets_updates.py~L548</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) from evm_tokens WHERE address=?&quot;,
                 (&quot;0x6B175474E89094C44Da98b954EedeAC495271d0F&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from assets WHERE identifier=?&quot;,
                 (&quot;eip155:1/erc20:0x6B175474E89094C44Da98b954EedeAC495271d0F&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_assets_updates.py#L572'>rotkehlchen/tests/api/test_assets_updates.py~L572</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from common_asset_details WHERE identifier=?&quot;, (&quot;DASH&quot;,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
-            cursor.execute(&quot;SELECT COUNT(*) from assets WHERE identifier=?&quot;, (&quot;DASH&quot;,)).fetchone()[
-                0
-            ]
+            cursor.execute(&quot;SELECT COUNT(*) from assets WHERE identifier=?&quot;, (&quot;DASH&quot;,))
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_assets_updates.py#L596'>rotkehlchen/tests/api/test_assets_updates.py~L596</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) from common_asset_details WHERE identifier=?&quot;,
                 (&quot;121-ada-FADS-as&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) from assets WHERE identifier=?&quot;, (&quot;121-ada-FADS-as&quot;,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) from assets WHERE identifier=?&quot;, (&quot;121-ada-FADS-as&quot;,))
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_assets_updates.py#L622'>rotkehlchen/tests/api/test_assets_updates.py~L622</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) from evm_tokens WHERE address=?&quot;,
                 (&quot;0x1B175474E89094C44Da98b954EedeAC495271d0F&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from assets WHERE identifier=?&quot;,
                 (&quot;eip155:1/erc20:0x1B175474E89094C44Da98b954EedeAC495271d0F&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_data_purging.py#L369'>rotkehlchen/tests/api/test_data_purging.py~L369</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM key_value_cache WHERE name LIKE ?;&quot;,
                     (f&quot;{cache_key.value[0].format(address='')}%&quot;,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_data_purging.py#L604'>rotkehlchen/tests/api/test_data_purging.py~L604</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM key_value_cache WHERE {' OR '.join(['name LIKE ?'] * len(cache_keys))}&quot;,  # noqa: E501
                     cache_keys,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
             assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_evm_transactions.py#L331'>rotkehlchen/tests/api/test_evm_transactions.py~L331</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM solana_transactions WHERE signature=?&quot;,
                 (deserialize_tx_signature(solana_signature).to_bytes(),),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events WHERE group_identifier=?&quot;, (solana_signature,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 2
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_evmlike.py#L683'>rotkehlchen/tests/api/test_evmlike.py~L683</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM zksynclite_transactions WHERE tx_hash=?&quot;,
                 (deserialize_evm_tx_hash(entry[&quot;tx_ref&quot;]),),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_history_base_entry.py#L314'>rotkehlchen/tests/api/test_history_base_entry.py~L314</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM evm_transactions WHERE tx_hash=?&quot;,
                 (entry.tx_ref,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
     entry.tx_ref = original_tx_hash
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_history_base_entry.py#L1097'>rotkehlchen/tests/api/test_history_base_entry.py~L1097</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT group_identifier FROM history_events WHERE identifier=?&quot;,
                 (entries[0][&quot;identifier&quot;],),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;new_eventid1&quot;
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_migrate_solana_token.py#L130'>rotkehlchen/tests/api/test_migrate_solana_token.py~L130</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier = ?&quot;,
                 (TEST_OLD_ASSET_IDENTIFIER,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (TEST_OLD_ASSET_IDENTIFIER,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # check that the new asset is present.
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_migrate_solana_token.py#L293'>rotkehlchen/tests/api/test_migrate_solana_token.py~L293</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (new_token_identifier,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier = ?&quot;,
                 (new_token_identifier,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # Original token should still exist in global database
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (TEST_OLD_ASSET_IDENTIFIER,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier = ?&quot;,
                 (TEST_OLD_ASSET_IDENTIFIER,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         # Migration table should still contain the old token
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_migrate_solana_token.py#L322'>rotkehlchen/tests/api/test_migrate_solana_token.py~L322</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_added_solana_tokens WHERE identifier = ?&quot;,
                 (TEST_OLD_ASSET_IDENTIFIER,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_migrate_solana_token.py#L334'>rotkehlchen/tests/api/test_migrate_solana_token.py~L334</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM {table} WHERE {column} = ?&quot;,
                     (TEST_OLD_ASSET_IDENTIFIER,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 1
             )  # noqa: E501
             # New asset should not exist
             assert (
                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM {table} WHERE {column} = ?&quot;, (new_token_identifier,)
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_nfts.py#L544'>rotkehlchen/tests/api/test_nfts.py~L544</a></p>
<pre><code class="language-diff">         with db.conn.read_ctx() as cursor:
             assert cursor.execute(&quot;SELECT COUNT(*) FROM nfts&quot;).fetchone()[0] == 1
             assert (
-                cursor.execute(
-                    &quot;SELECT COUNT(*) FROM nfts WHERE owner_address=?&quot;, (TEST_ACC5,)
-                ).fetchone()[0]
+                cursor.execute(&quot;SELECT COUNT(*) FROM nfts WHERE owner_address=?&quot;, (TEST_ACC5,))
+                .fetchone()[0]
                 == 0
             )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_snapshots.py#L741'>rotkehlchen/tests/api/test_snapshots.py~L741</a></p>
<pre><code class="language-diff">     cursor = rotkehlchen_api_server.rest_api.rotkehlchen.data.db.conn.cursor()
     assert (
         len(
-            cursor.execute(
-                &quot;SELECT timestamp FROM timed_balances WHERE timestamp=?&quot;, (ts,)
-            ).fetchall()
+            cursor.execute(&quot;SELECT timestamp FROM timed_balances WHERE timestamp=?&quot;, (ts,))
+            .fetchall()
         )
         == 0
     )  # noqa: E501
     assert (
         len(
-            cursor.execute(
-                &quot;SELECT timestamp FROM timed_location_data WHERE timestamp=?&quot;, (ts,)
-            ).fetchall()
+            cursor.execute(&quot;SELECT timestamp FROM timed_location_data WHERE timestamp=?&quot;, (ts,))
+            .fetchall()
         )
         == 0
     )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L711'>rotkehlchen/tests/api/test_user_assets.py~L711</a></p>
<pre><code class="language-diff">             global_cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_owned_assets WHERE asset_id=?&quot;,
                 (user_asset1_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         # check the user asset is in user db
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L719'>rotkehlchen/tests/api/test_user_assets.py~L719</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                 (user_asset1_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         # Check that the manual balance is returned
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L738'>rotkehlchen/tests/api/test_user_assets.py~L738</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) from manually_tracked_balances WHERE asset=?;&quot;,
                 (user_asset1_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L777'>rotkehlchen/tests/api/test_user_assets.py~L777</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                 (user_asset1_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                 (&quot;ICP&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from manually_tracked_balances WHERE asset=?;&quot;,
                 (user_asset1_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from manually_tracked_balances WHERE asset=?;&quot;,
                 (&quot;ICP&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L807'>rotkehlchen/tests/api/test_user_assets.py~L807</a></p>
<pre><code class="language-diff">         global_cursor.execute(
             &quot;SELECT COUNT(*) FROM user_owned_assets WHERE asset_id=?&quot;,
             (user_asset1_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
     # check the previous asset is not in globaldb
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L815'>rotkehlchen/tests/api/test_user_assets.py~L815</a></p>
<pre><code class="language-diff">         global_cursor.execute(
             &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
             (user_asset1_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L843'>rotkehlchen/tests/api/test_user_assets.py~L843</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
             (unknown_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )
     # Check that the manual balance is there -- can't query normally due to unknown asset
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L851'>rotkehlchen/tests/api/test_user_assets.py~L851</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM manually_tracked_balances WHERE asset=?&quot;,
             (unknown_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L893'>rotkehlchen/tests/api/test_user_assets.py~L893</a></p>
<pre><code class="language-diff">         global_cursor.execute(
             &quot;SELECT COUNT(*) FROM user_owned_assets WHERE asset_id=?&quot;,
             (unknown_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
     # check the previous asset is not in globaldb
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L901'>rotkehlchen/tests/api/test_user_assets.py~L901</a></p>
<pre><code class="language-diff">         global_cursor.execute(
             &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
             (unknown_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
     # check the previous asset is not in userdb anymore
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L909'>rotkehlchen/tests/api/test_user_assets.py~L909</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
             (unknown_id,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_user_assets.py#L983'>rotkehlchen/tests/api/test_user_assets.py~L983</a></p>
<pre><code class="language-diff">             global_cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_owned_assets WHERE asset_id=?&quot;,
                 (glm_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             global_cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE swapped_for=?&quot;,
                 (glm_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                 (glm_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/api/test_users.py#L684'>rotkehlchen/tests/api/test_users.py~L684</a></p>
<pre><code class="language-diff">     assert (
         requests.get(
             api_url_for(rotkehlchen_api_server, &quot;specific_async_tasks_resource&quot;, task_id=task_id),
-        ).json()[&quot;result&quot;][&quot;status&quot;]
+        )
+        .json()[&quot;result&quot;][&quot;status&quot;]
         == &quot;not-found&quot;
     )
     assert Inquirer._uniswapv2 is None
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migration_20.py#L466'>rotkehlchen/tests/data_migrations/test_migration_20.py~L466</a></p>
<pre><code class="language-diff">             cursor.execute(  # the trigger events should be removed
                 &quot;SELECT COUNT(*) FROM history_events WHERE event_identifier = ?&quot;,
                 (hash_id(str(Location.KRAKEN)),),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migration_21.py#L41'>rotkehlchen/tests/data_migrations/test_migration_21.py~L41</a></p>
<pre><code class="language-diff">         rows = list(
             cursor.execute(
                 &quot;SELECT address, blockchain, name FROM address_book ORDER BY blockchain&quot;
-            ).fetchall()
+            )
+            .fetchall()
         )  # noqa: E501
         assert rows == [
             (eth_addr, &quot;ETH&quot;, &quot;yabir.eth&quot;),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L474'>rotkehlchen/tests/data_migrations/test_migrations.py~L474</a></p>
<pre><code class="language-diff">         assert (
             write_cursor.execute(
                 &quot;SELECT COUNT(*) FROM default_rpc_nodes WHERE name='polygon etherscan'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L509'>rotkehlchen/tests/data_migrations/test_migrations.py~L509</a></p>
<pre><code class="language-diff">         GlobalDBHandler().conn.read_ctx() as cursor
     ):  # check the global db for the polygon etherscan node  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM default_rpc_nodes WHERE name='polygon etherscan'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM default_rpc_nodes WHERE name='polygon etherscan'&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM default_rpc_nodes WHERE name='polygon pos etherscan'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
     with (
         rotki.data.db.conn.read_ctx() as cursor
     ):  # check the user db for the polygon etherscan node  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM rpc_nodes WHERE name='polygon etherscan'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM rpc_nodes WHERE name='polygon etherscan'&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L680'>rotkehlchen/tests/data_migrations/test_migrations.py~L680</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT value FROM unique_cache WHERE key=?&quot;,
                 (&quot;YEARN_VAULTS&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;179&quot;
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L738'>rotkehlchen/tests/data_migrations/test_migrations.py~L738</a></p>
<pre><code class="language-diff">         assert json.loads(
             cursor.execute(  # make sure manual oracle is there before the migration
                 &quot;SELECT value from settings where name='current_price_oracles'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         ) == [&quot;coingecko&quot;, &quot;cryptocompare&quot;, &quot;manualcurrent&quot;, &quot;defillama&quot;]
 
     with rotki.data.db.conn.write_ctx() as write_cursor:
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L839'>rotkehlchen/tests/data_migrations/test_migrations.py~L839</a></p>
<pre><code class="language-diff">             cursor.execute(  # now make sure they are no longer ignored
                 &quot;SELECT COUNT(*) FROM multisettings WHERE name='ignored_asset' AND value IN (?, ?, ?, ?)&quot;,  # noqa: E501
                 [token.identifier for token in tokens],
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L847'>rotkehlchen/tests/data_migrations/test_migrations.py~L847</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM evm_tx_mappings WHERE tx_id=?&quot;,
                 (spam_transaction_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert json.loads(
             cursor.execute(  # make sure manual oracle is gone after the migration
                 &quot;SELECT value from settings where name='current_price_oracles'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         ) == [&quot;coingecko&quot;, &quot;cryptocompare&quot;, &quot;defillama&quot;]
 
     for token in tokens:
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/data_migrations/test_migrations.py#L868'>rotkehlchen/tests/data_migrations/test_migrations.py~L868</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT value FROM unique_cache WHERE key=?&quot;,
                 (&quot;YEARN_VAULTS&quot;,),
-            ).fetchall()
+            )
+            .fetchall()
             == []
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L184'>rotkehlchen/tests/db/test_db_upgrades.py~L184</a></p>
<pre><code class="language-diff">     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) from used_query_ranges WHERE name LIKE 'uniswap%';&quot;,
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 2
     )
     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) from used_query_ranges WHERE name LIKE 'balancer%';&quot;,
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 2
     )
     assert cursor.execute(&quot;SELECT COUNT(*) from used_query_ranges;&quot;).fetchone()[0] == 6
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L471'>rotkehlchen/tests/db/test_db_upgrades.py~L471</a></p>
<pre><code class="language-diff">     assert (
         cursor.execute(
             &quot;SELECT address, xpub, derivation_path, account_index, derived_index FROM xpub_mappings;&quot;,
-        ).fetchall()
+        )
+        .fetchall()
         == expected_xpub_mappings
     )
     # Check transactions are migrated and internal ones removed
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L1233'>rotkehlchen/tests/db/test_db_upgrades.py~L1233</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='view' AND name=?&quot;,
                 (&quot;combined_trades_view&quot;,),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L1395'>rotkehlchen/tests/db/test_db_upgrades.py~L1395</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='view' AND name=?&quot;,
                 (&quot;combined_trades_view&quot;,),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2066'>rotkehlchen/tests/db/test_db_upgrades.py~L2066</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name=?&quot;,
             (&quot;eth2_deposits&quot;,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )
     # Check used query ranges
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2150'>rotkehlchen/tests/db/test_db_upgrades.py~L2150</a></p>
<pre><code class="language-diff">     assert (
         cursor.execute(
             &quot;SELECT value FROM settings WHERE name='non_syncing_exchanges'&quot;,
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == '[{&quot;name&quot;: &quot;Kucoin 1&quot;, &quot;location&quot;: &quot;kucoin&quot;}]'
     )
     assert (
         cursor.execute(
             &quot;SELECT value FROM settings WHERE name='ssf_0graph_multiplier'&quot;,
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == &quot;42&quot;
     )
     assert (
         cursor.execute(
             &quot;SELECT value FROM settings WHERE name='ssf_graph_multiplier'&quot;,
-        ).fetchone()
+        )
+        .fetchone()
         is None
     )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2398'>rotkehlchen/tests/db/test_db_upgrades.py~L2398</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name=?&quot;,
             (&quot;eth2_deposits&quot;,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
     assert cursor.execute(&quot;SELECT * FROM used_query_ranges&quot;).fetchall() == [
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2426'>rotkehlchen/tests/db/test_db_upgrades.py~L2426</a></p>
<pre><code class="language-diff">     assert (
         cursor.execute(  # Check that FTX was deleted from non syncing exchanges
             &quot;SELECT value FROM settings WHERE name='non_syncing_exchanges'&quot;,
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == '[{&quot;name&quot;: &quot;Kucoin 1&quot;, &quot;location&quot;: &quot;kucoin&quot;}]'
     )
     assert (
         cursor.execute(  # Check the 0graph multiplier setting got updated properly
             &quot;SELECT value FROM settings WHERE name='ssf_0graph_multiplier'&quot;,
-        ).fetchone()
+        )
+        .fetchone()
         is None
     )
     assert (
         cursor.execute(
             &quot;SELECT value FROM settings WHERE name='ssf_graph_multiplier'&quot;,
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == &quot;42&quot;
     )
     db.logout()
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2460'>rotkehlchen/tests/db/test_db_upgrades.py~L2460</a></p>
<pre><code class="language-diff">     assert cursor.execute(&quot;SELECT COUNT(*) FROM aave_events&quot;).fetchone()[0] == 2
     aave_range_key = &quot;aave_events_0x026045B110b49183E78520460eBEcdC6B4538C85&quot;
     assert (
-        cursor.execute(
-            &quot;SELECT COUNT(*) FROM used_query_ranges WHERE name=?&quot;, (aave_range_key,)
-        ).fetchone()[0]
+        cursor.execute(&quot;SELECT COUNT(*) FROM used_query_ranges WHERE name=?&quot;, (aave_range_key,))
+        .fetchone()[0]
         == 1
     )  # noqa: E501
     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='amm_events';&quot;
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )  # noqa: E501
     nodes_before = cursor.execute(&quot;SELECT * FROM rpc_nodes&quot;).fetchall()
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2691'>rotkehlchen/tests/db/test_db_upgrades.py~L2691</a></p>
<pre><code class="language-diff">         cursor.execute(  # Check that Polygon POS location was added
             &quot;SELECT location FROM location WHERE seq=?&quot;,
             (Location.POLYGON_POS.value,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == Location.POLYGON_POS.serialize_for_db()
     )
     nodes_after = cursor.execute(&quot;SELECT * FROM rpc_nodes&quot;).fetchall()
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2708'>rotkehlchen/tests/db/test_db_upgrades.py~L2708</a></p>
<pre><code class="language-diff">         == expected_internal_txs
     )  # noqa: E501
     assert (
-        cursor.execute(
-            &quot;SELECT COUNT(*) FROM used_query_ranges WHERE name=?&quot;, (aave_range_key,)
-        ).fetchone()[0]
+        cursor.execute(&quot;SELECT COUNT(*) FROM used_query_ranges WHERE name=?&quot;, (aave_range_key,))
+        .fetchone()[0]
         == 0
     )  # noqa: E501
     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='aave_events';&quot;
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )  # noqa: E501
     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='amm_events';&quot;
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )  # noqa: E501
     assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2771'>rotkehlchen/tests/db/test_db_upgrades.py~L2771</a></p>
<pre><code class="language-diff">     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='optimism_transactions';&quot;
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )  # noqa: E501
     withdrawal_events_before = {
         x[0]
         for x in cursor.execute(
             &quot;SELECT identifier FROM history_events WHERE event_identifier LIKE 'eth2_withdrawal_%'&quot;,
-        ).fetchall()
+        )
+        .fetchall()
     }
     block_events_before = {
         x[0]
         for x in cursor.execute(
             &quot;SELECT identifier FROM history_events WHERE event_identifier LIKE 'evm_1_block_%'&quot;,
-        ).fetchall()
+        )
+        .fetchall()
     }
     assert cursor.execute(
         &quot;SELECT event_identifier FROM history_events WHERE event_identifier LIKE 'rotki_events_%'&quot;
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2877'>rotkehlchen/tests/db/test_db_upgrades.py~L2877</a></p>
<pre><code class="language-diff">     assert (
         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='optimism_transactions';&quot;
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )  # noqa: E501
     assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2888'>rotkehlchen/tests/db/test_db_upgrades.py~L2888</a></p>
<pre><code class="language-diff">         x[0]
         for x in cursor.execute(
             &quot;SELECT identifier FROM history_events WHERE event_identifier LIKE 'EW_%'&quot;,
-        ).fetchall()
+        )
+        .fetchall()
     }
     assert withdrawal_events_after == withdrawal_events_before
     block_events_after = {
         x[0]
         for x in cursor.execute(
             &quot;SELECT identifier FROM history_events WHERE event_identifier LIKE 'BP1_%'&quot;,
-        ).fetchall()
+        )
+        .fetchall()
     }
     assert block_events_after == block_events_before
     assert (
         cursor.execute(
             &quot;SELECT event_identifier FROM history_events WHERE event_identifier LIKE 'rotki_events_%'&quot;
-        ).fetchall()
+        )
+        .fetchall()
         == []
     )  # noqa: E501
     assert set(
         cursor.execute(
             &quot;SELECT event_identifier FROM history_events WHERE event_identifier LIKE 'RE%'&quot;
-        ).fetchall()
+        )
+        .fetchall()
     ) == {  # noqa: E501
         (&quot;RE_0x2123&quot;,),
         (&quot;REBTX_0x4123&quot;,),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L2989'>rotkehlchen/tests/db/test_db_upgrades.py~L2989</a></p>
<pre><code class="language-diff">         cursor.execute(  # Check that Arbitrum One location was added
             &quot;SELECT location FROM location WHERE location=?&quot;,
             (Location.ARBITRUM_ONE.serialize_for_db(),),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == Location.ARBITRUM_ONE.serialize_for_db()
     )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3090'>rotkehlchen/tests/db/test_db_upgrades.py~L3090</a></p>
<pre><code class="language-diff">     ]
     # Check that ledger actions settings are there
     assert (
-        cursor.execute(
-            &quot;SELECT COUNT(*) FROM settings WHERE name=?&quot;, (&quot;taxable_ledger_actions&quot;,)
-        ).fetchone()[0]
+        cursor.execute(&quot;SELECT COUNT(*) FROM settings WHERE name=?&quot;, (&quot;taxable_ledger_actions&quot;,))
+        .fetchone()[0]
         == 1
     )  # noqa: E501
     # Check that ignored ledger actions are there
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3282'>rotkehlchen/tests/db/test_db_upgrades.py~L3282</a></p>
<pre><code class="language-diff">     ]
     # Check that ledger actions settings are removed
     assert (
-        cursor.execute(
-            &quot;SELECT COUNT(*) FROM settings WHERE name=?&quot;, (&quot;taxable_ledger_actions&quot;,)
-        ).fetchone()[0]
+        cursor.execute(&quot;SELECT COUNT(*) FROM settings WHERE name=?&quot;, (&quot;taxable_ledger_actions&quot;,))
+        .fetchone()[0]
         == 0
     )  # noqa: E501
     # Check that ignored ledger actions are removed
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3314'>rotkehlchen/tests/db/test_db_upgrades.py~L3314</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
             (&quot;VELO&quot;,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 0
     )
     assert (
         cursor.execute(
             &quot;SELECT asset FROM history_events WHERE identifier IN (?, ?)&quot;,
             (&quot;10000&quot;, &quot;10001&quot;),
-        ).fetchall()
+        )
+        .fetchall()
         == [(bnb_velo_asset_id,)] * 2
     )
     assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3439'>rotkehlchen/tests/db/test_db_upgrades.py~L3439</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_credentials WHERE location=?&quot;,
                 (&quot;D&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM used_query_ranges WHERE name LIKE ? ESCAPE ?;&quot;,
                 (f&quot;{Location.BITTREX!s}\\_%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 3
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3481'>rotkehlchen/tests/db/test_db_upgrades.py~L3481</a></p>
<pre><code class="language-diff">         # verify that the history_events exists before upgrade
         assert cursor.execute(&quot;SELECT COUNT(*) FROM history_events&quot;).fetchone()[0] == 10
         assert (
-            cursor.execute(&quot;SELECT COUNT(*) FROM history_events WHERE location = 'B'&quot;).fetchone()[
-                0
-            ]
+            cursor.execute(&quot;SELECT COUNT(*) FROM history_events WHERE location = 'B'&quot;)
+            .fetchone()[0]
             == 2
         )  # kraken events: one valid and one that needs to be removed # noqa: E501
         assert cursor.execute(&quot;SELECT COUNT(*) FROM evm_events_info&quot;).fetchone()[0] == 8
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3491'>rotkehlchen/tests/db/test_db_upgrades.py~L3491</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events_mappings WHERE name=? AND value=?&quot;,
                 (HISTORY_MAPPING_KEY_STATE, HISTORY_MAPPING_STATE_CUSTOMIZED),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # one event is customized
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3639'>rotkehlchen/tests/db/test_db_upgrades.py~L3639</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_credentials WHERE location=?&quot;,
                 (&quot;D&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM used_query_ranges WHERE name LIKE ? ESCAPE ?;&quot;,
                 (f&quot;{Location.BITTREX!s}\\_%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert json.loads(
             cursor.execute(
                 &quot;SELECT value FROM settings WHERE name=?&quot;,
                 (&quot;non_syncing_exchanges&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         ) == [{&quot;name&quot;: &quot;Kraken 1&quot;, &quot;location&quot;: &quot;kraken&quot;}]
 
         # verify that the new eth2 validators table and data is there
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3673'>rotkehlchen/tests/db/test_db_upgrades.py~L3673</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT validator_index, public_key, ownership_proportion from eth2_validators&quot;
-            ).fetchall()
+            )
+            .fetchall()
             == validators_data
         )  # noqa: E501
         assert cursor.execute(&quot;SELECT * from eth2_daily_staking_details&quot;).fetchall() == daily_stats
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3702'>rotkehlchen/tests/db/test_db_upgrades.py~L3702</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT identifier FROM history_events ORDER BY identifier&quot;,
-            ).fetchall()
+            )
+            .fetchall()
             == expected_events_ids
         )
         assert (
             cursor.execute(
                 &quot;SELECT identifier FROM evm_events_info&quot;,
-            ).fetchall()
+            )
+            .fetchall()
             == expected_events_ids
         )
         assert (
             cursor.execute(
                 &quot;SELECT parent_identifier FROM history_events_mappings&quot;,
-            ).fetchall()
+            )
+            .fetchall()
             == expected_events_ids
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3797'>rotkehlchen/tests/db/test_db_upgrades.py~L3797</a></p>
<pre><code class="language-diff">                 cursor.execute(  # Check that new locations were added
                     &quot;SELECT location FROM location WHERE seq=?&quot;,
                     (new_loc.value,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == new_loc.serialize_for_db()
             )
         raw_list = cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3848'>rotkehlchen/tests/db/test_db_upgrades.py~L3848</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from evm_events_info WHERE counterparty=?&quot;, (&quot;hop-protocol&quot;,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) from evm_events_info WHERE counterparty=?&quot;, (&quot;hop&quot;,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) from evm_events_info WHERE counterparty=?&quot;, (&quot;hop&quot;,))
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3904'>rotkehlchen/tests/db/test_db_upgrades.py~L3904</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from evm_events_info WHERE counterparty=?&quot;, (&quot;hop-protocol&quot;,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) from evm_events_info WHERE counterparty=?&quot;, (&quot;hop&quot;,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) from evm_events_info WHERE counterparty=?&quot;, (&quot;hop&quot;,))
+            .fetchone()[0]
             == 1
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3920'>rotkehlchen/tests/db/test_db_upgrades.py~L3920</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_credentials WHERE location=?&quot;,
                 (Location.COINBASEPRO.serialize_for_db(),),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3980'>rotkehlchen/tests/db/test_db_upgrades.py~L3980</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT * FROM address_book WHERE address IN (?, ?)&quot;,
                 (bad_address, tether_address),
-            ).fetchall()
+            )
+            .fetchall()
         ) == {
             (tether_address, None, &quot;Black Tether&quot;),
             (bad_address, None, &quot;yabirgb.eth&quot;),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L3995'>rotkehlchen/tests/db/test_db_upgrades.py~L3995</a></p>
<pre><code class="language-diff">                     Location.POLKADOT.serialize_for_db(),
                     Location.KUSAMA.serialize_for_db(),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4056'>rotkehlchen/tests/db/test_db_upgrades.py~L4056</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT * FROM address_book WHERE address IN (?, ?)&quot;,
                 (bad_address, tether_address),
-            ).fetchall()
+            )
+            .fetchall()
         ) == {
             (tether_address, &quot;NONE&quot;, &quot;Black Tether&quot;),
             (bad_address, &quot;NONE&quot;, &quot;yabirgb.eth&quot;),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4064'>rotkehlchen/tests/db/test_db_upgrades.py~L4064</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT value FROM settings WHERE name='historical_price_oracles'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == '[&quot;manual&quot;, &quot;cryptocompare&quot;, &quot;coingecko&quot;, &quot;defillama&quot;, &quot;uniswapv3&quot;, &quot;uniswapv2&quot;]'
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT * FROM used_query_ranges WHERE name LIKE 'zksynclitetxs\\_%' ESCAPE '\\'&quot;,
-            ).fetchone()
+            )
+            .fetchone()
             is None
         )
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4082'>rotkehlchen/tests/db/test_db_upgrades.py~L4082</a></p>
<pre><code class="language-diff">                     Location.POLKADOT.serialize_for_db(),
                     Location.KUSAMA.serialize_for_db(),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 4
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4145'>rotkehlchen/tests/db/test_db_upgrades.py~L4145</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM pragma_table_info('history_events') WHERE name='extra_data'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM pragma_table_info('evm_events_info') WHERE name='extra_data'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         existing_evm_event = cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4165'>rotkehlchen/tests/db/test_db_upgrades.py~L4165</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events WHERE event_identifier=?&quot;, (&quot;KRAKEN-XXX&quot;,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 2
         )  # kraken history event that needs to be removed since it will be replaced  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4220'>rotkehlchen/tests/db/test_db_upgrades.py~L4220</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM pragma_table_info('history_events') WHERE name='extra_data'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM pragma_table_info('evm_events_info') WHERE name='extra_data'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4242'>rotkehlchen/tests/db/test_db_upgrades.py~L4242</a></p>
<pre><code class="language-diff">                 &quot;sequence_index=? AND timestamp=? AND location=? AND location_label=? AND asset=? AND &quot;
                 &quot;amount=? AND usd_value=? AND notes=? AND type=? AND subtype=? AND extra_data IS NULL&quot;,
                 history_event_bindings,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4327'>rotkehlchen/tests/db/test_db_upgrades.py~L4327</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events WHERE event_identifier=?&quot;, (&quot;KRAKEN-XXX&quot;,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4337'>rotkehlchen/tests/db/test_db_upgrades.py~L4337</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM settings WHERE name='account_for_assets_movements'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4361'>rotkehlchen/tests/db/test_db_upgrades.py~L4361</a></p>
<pre><code class="language-diff">                 user_db_cursor.execute(
                     f&quot;SELECT COUNT(*) FROM {table} WHERE {column} IN (?, ?)&quot;,
                     (uniswap_erc20_token.identifier, uniswap_erc721_token.identifier),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
                 if expect_removed
                 else count
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4376'>rotkehlchen/tests/db/test_db_upgrades.py~L4376</a></p>
<pre><code class="language-diff">                         uniswap_erc721_token.identifier,
                         basename_token.identifier,
                     ),  # noqa: E501
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
                 if expect_removed
                 else 3
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4385'>rotkehlchen/tests/db/test_db_upgrades.py~L4385</a></p>
<pre><code class="language-diff">                 global_db_cursor.execute(
                     &quot;SELECT COUNT(*) FROM assets WHERE identifier IN (?, ?)&quot;,
                     (erc721_token_with_id.identifier, basename_token_with_id.identifier),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 2
             )  # tokens with collectible ids shouldn't be modified
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4727'>rotkehlchen/tests/db/test_db_upgrades.py~L4727</a></p>
<pre><code class="language-diff">         assert &quot;manual&quot; in json.loads(
             write_cursor.execute(
                 &quot;SELECT value FROM settings WHERE name='historical_price_oracles'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         )  # noqa: E501
 
     with db_v46.conn.read_ctx() as cursor:  # assert block events state before upgrade
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4861'>rotkehlchen/tests/db/test_db_upgrades.py~L4861</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM settings WHERE name='last_data_upload_ts'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert json.loads(
             cursor.execute(
                 &quot;SELECT value FROM settings WHERE name='active_modules'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         ) == [
             &quot;aave&quot;,
             &quot;sushiswap&quot;,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4885'>rotkehlchen/tests/db/test_db_upgrades.py~L4885</a></p>
<pre><code class="language-diff">         assert set(
             cursor.execute(
                 &quot;SELECT * FROM multisettings WHERE name LIKE 'queried\\_address\\_%' ESCAPE '\\'&quot;,
-            ).fetchall()
+            )
+            .fetchall()
         ) == {
             (&quot;queried_address_aave&quot;, &quot;0x2B888954421b424C5D3D9Ce9bB67c9bD47537d12&quot;),
             (&quot;queried_address_aave&quot;, &quot;0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045&quot;),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L4960'>rotkehlchen/tests/db/test_db_upgrades.py~L4960</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multisettings WHERE name='ignored_asset' AND value IN ('BUX', 'TEDDY', 'BIDR')&quot;,  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 3
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multisettings WHERE name='ignored_asset' AND value IN ('eip155:56/erc20:0x211FfbE424b90e25a15531ca322adF1559779E45', 'eip155:43114/erc20:0x094bd7B2D99711A1486FB94d4395801C6d0fdDcC')&quot;,  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(  # this is BIDR's actual evm token. Testing the already exists case for ignore asset  # noqa: E501
                 &quot;SELECT COUNT(*) FROM multisettings WHERE name='ignored_asset' AND value ='eip155:56/erc20:0x9A2f5556e9A637e8fBcE886d8e3cf8b316a1D8a2'&quot;,  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5019'>rotkehlchen/tests/db/test_db_upgrades.py~L5019</a></p>
<pre><code class="language-diff">             cursor.execute(  # events with the correct prefix for bybit, coinbase &amp; gemini removed  # noqa: E501
                 &quot;SELECT COUNT(*) FROM history_events WHERE location IN (?, ?, ?) AND event_identifier LIKE ?&quot;,  # noqa: E501
                 (bybit_location, coinbase_location, gemini_location, f&quot;{CB_EVENTS_PREFIX}%&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5032'>rotkehlchen/tests/db/test_db_upgrades.py~L5032</a></p>
<pre><code class="language-diff">                     f&quot;{ROTKI_EVENT_PREFIX}_GEM_EVENT&quot;,
                     f&quot;{ROTKI_EVENT_PREFIX}_BYBIT_EVENT&quot;,
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 4
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5043'>rotkehlchen/tests/db/test_db_upgrades.py~L5043</a></p>
<pre><code class="language-diff">                     f&quot;{(coinbase_loc := Location.COINBASE.serialize())}_%_last_query_ts&quot;,
                     f&quot;{coinbase_loc}_%_last_query_id&quot;,
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5053'>rotkehlchen/tests/db/test_db_upgrades.py~L5053</a></p>
<pre><code class="language-diff">                     f&quot;{(kraken_loc := Location.KRAKEN.serialize())}_%_last_query_ts&quot;,
                     f&quot;{kraken_loc}_%_last_query_id&quot;,
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             cursor.execute(  # ensure trades with bybit or Coinbase or Gemini location and a link are deleted  # noqa: E501
                 &quot;SELECT COUNT(*) FROM trades WHERE location IN (?, ?, ?) AND link != ?&quot;,
                 (bybit_location, coinbase_location, gemini_location, &quot;&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5080'>rotkehlchen/tests/db/test_db_upgrades.py~L5080</a></p>
<pre><code class="language-diff">                     f&quot;{Location.GEMINI.serialize()}_%&quot;,
                     f&quot;{Location.BYBIT.serialize()}_%&quot;,
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5164'>rotkehlchen/tests/db/test_db_upgrades.py~L5164</a></p>
<pre><code class="language-diff">             cursor.execute(  # verify that all old counterparty specific rules for these types are removed  # noqa: E501
                 &quot;SELECT counterparty FROM accounting_rules WHERE (type=? AND subtype=?) OR (type=? AND subtype=?)&quot;,  # noqa: E501
                 (&quot;deposit&quot;, &quot;deposit asset&quot;, &quot;withdrawal&quot;, &quot;remove asset&quot;),
-            ).fetchall()
+            )
+            .fetchall()
             == [(&quot;NONE&quot;,), (&quot;NONE&quot;,)]
         )  # Keep the rules with null counterparty
 
         # ensure that manual historical price oracle is removed from settings.
         assert &quot;manual&quot; not in json.loads(
-            cursor.execute(
-                &quot;SELECT value FROM settings WHERE name='historical_price_oracles'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT value FROM settings WHERE name='historical_price_oracles'&quot;)
+            .fetchone()[0]
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM settings WHERE name='last_data_upload_ts'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert json.loads(
             cursor.execute(
                 &quot;SELECT value FROM settings WHERE name='active_modules'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         ) == [
             &quot;sushiswap&quot;,
             &quot;uniswap&quot;,
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5197'>rotkehlchen/tests/db/test_db_upgrades.py~L5197</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT * FROM multisettings WHERE name LIKE 'queried\\_address\\_%' ESCAPE '\\'&quot;,
-            ).fetchall()
+            )
+            .fetchall()
             == []
         )
         # After tests for the avalanche/binance tokens deletion
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5261'>rotkehlchen/tests/db/test_db_upgrades.py~L5261</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multisettings WHERE name='ignored_asset' AND value IN ('BUX', 'TEDDY', 'BIDR')&quot;,  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multisettings WHERE name='ignored_asset' AND value IN ('eip155:56/erc20:0x211FfbE424b90e25a15531ca322adF1559779E45', 'eip155:43114/erc20:0x094bd7B2D99711A1486FB94d4395801C6d0fdDcC', 'eip155:56/erc20:0x9A2f5556e9A637e8fBcE886d8e3cf8b316a1D8a2')&quot;,  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 3
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5534'>rotkehlchen/tests/db/test_db_upgrades.py~L5534</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT value FROM settings where name=?&quot;,
                 (&quot;use_unified_etherscan_api&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;True&quot;
         )
         assert not table_exists(cursor, &quot;evm_transactions_authorizations&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5949'>rotkehlchen/tests/db/test_db_upgrades.py~L5949</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) from used_query_ranges WHERE name LIKE ? ESCAPE ?&quot;,
                 (&quot;%\\_trades\\_%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert not table_exists(cursor, &quot;action_type&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5961'>rotkehlchen/tests/db/test_db_upgrades.py~L5961</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT value FROM settings where name=?&quot;,
                 (&quot;use_unified_etherscan_api&quot;,),
-            ).fetchall()
+            )
+            .fetchall()
             == []
         )
         assert table_exists(cursor, &quot;evm_transactions_authorizations&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L5982'>rotkehlchen/tests/db/test_db_upgrades.py~L5982</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events WHERE asset=?&quot;,
                 (A_LTC.identifier,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == ignored_asset_event_count
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events WHERE ignored=1&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == ignored_asset_event_count
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6235'>rotkehlchen/tests/db/test_db_upgrades.py~L6235</a></p>
<pre><code class="language-diff">                 assert db.get_setting(cursor, &quot;ongoing_upgrade_from_version&quot;) is None
                 # Check that the backup was used
                 assert (
-                    cursor.execute(&quot;SELECT value FROM settings WHERE name='is_backup'&quot;).fetchone()[
-                        0
-                    ]
+                    cursor.execute(&quot;SELECT value FROM settings WHERE name='is_backup'&quot;)
+                    .fetchone()[0]
                     == &quot;33&quot;
                 )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6279'>rotkehlchen/tests/db/test_db_upgrades.py~L6279</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('$NAP', 'ACS', 'AI16Z', 'BONK', 'TRISIG', 'HODLSOL')&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 6
         )  # noqa: E501
         tokens_mapping = {  # define before/after mapping for token identifiers
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6306'>rotkehlchen/tests/db/test_db_upgrades.py~L6306</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 'SELECT currency, amount, usd_value FROM timed_balances WHERE currency IN (&quot;$NAP&quot;, &quot;ACS&quot;, &quot;AI16Z&quot;)'
-            ).fetchall()
+            )
+            .fetchall()
             == expected_timed_balances_before
         )  # noqa: E501
         assert (
             cursor.execute(
                 'SELECT asset, amount, type FROM history_events WHERE asset IN (&quot;$NAP&quot;, &quot;ACS&quot;, &quot;HODLSOL&quot;)'
-            ).fetchall()
+            )
+            .fetchall()
             == expected_history_events_before
         )  # noqa: E501
         assert (
             cursor.execute(
                 'SELECT pl_currency, profit_loss FROM margin_positions WHERE pl_currency IN (&quot;AI16Z&quot;, &quot;ACS&quot;)'
-            ).fetchall()
+            )
+            .fetchall()
             == expected_margin_positions_before
         )  # noqa: E501
         # it should not have any CAIPS format assets before upgrade
         assert (
             cursor.execute(
                 'SELECT COUNT(*) FROM assets WHERE identifier LIKE &quot;solana:%&quot; ORDER BY identifier'
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # user notes with empty string for global location
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6337'>rotkehlchen/tests/db/test_db_upgrades.py~L6337</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 solana_query := &quot;SELECT COUNT(*) FROM location WHERE location='w' AND seq=55&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6369'>rotkehlchen/tests/db/test_db_upgrades.py~L6369</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 'SELECT COUNT(*) FROM assets WHERE identifier IN (&quot;$NAP&quot;, &quot;ACS&quot;, &quot;AI16Z&quot;, &quot;BONK&quot;) ORDER BY identifier'
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # verify duplicates were deleted
         assert (
-            cursor.execute(
-                'SELECT COUNT(*) FROM assets WHERE identifier IN (&quot;TRISIG&quot;, &quot;HODLSOL&quot;)'
-            ).fetchone()[0]
+            cursor.execute('SELECT COUNT(*) FROM assets WHERE identifier IN (&quot;TRISIG&quot;, &quot;HODLSOL&quot;)')
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # Check that asset references were updated in other tables
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6437'>rotkehlchen/tests/db/test_db_upgrades.py~L6437</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM history_events_mappings WHERE parent_identifier=? AND name=? AND value=?&quot;,  # noqa: E501
                 (2, HISTORY_MAPPING_KEY_STATE, HISTORY_MAPPING_STATE_CUSTOMIZED),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # TEST_EVENT_2 is customized.
         assert not table_exists(cursor=cursor, name=&quot;accounting_rule_events&quot;)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6455'>rotkehlchen/tests/db/test_db_upgrades.py~L6455</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, ((old_solana_id := &quot;SOL-2&quot;),)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6482'>rotkehlchen/tests/db/test_db_upgrades.py~L6482</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, ((new_solana_id := &quot;SOL&quot;),)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6529'>rotkehlchen/tests/db/test_db_upgrades.py~L6529</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT identifier, event_identifier, location_label FROM history_events WHERE location = 'P'&quot;,  # noqa: E501
-            ).fetchall()
+            )
+            .fetchall()
             == [
                 (1, &quot;TEST_EVENT_1&quot;, &quot;Crypto.com App&quot;),
                 (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6544'>rotkehlchen/tests/db/test_db_upgrades.py~L6544</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT type, subtype, counterparty FROM accounting_rules ORDER BY identifier&quot;
-            ).fetchall()
+            )
+            .fetchall()
             == rules
         )  # noqa: E501
 
         # Check that SOL-2 no longer exists in assets table
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (old_solana_id,))
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # Check that SOL now exists in assets table
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (new_solana_id,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (new_solana_id,))
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM timed_balances WHERE currency = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6576'>rotkehlchen/tests/db/test_db_upgrades.py~L6576</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM manually_tracked_balances WHERE asset = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6587'>rotkehlchen/tests/db/test_db_upgrades.py~L6587</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM margin_positions WHERE pl_currency = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6605'>rotkehlchen/tests/db/test_db_upgrades.py~L6605</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT * FROM external_service_credentials WHERE name IN (?, ?)&quot;,
                 (&quot;monerium&quot;, &quot;gnosis_pay&quot;),
-            ).fetchall()
+            )
+            .fetchall()
             == []
         )  # noqa: E501
         assert cursor.execute(&quot;SELECT * FROM gnosispay_data&quot;).fetchall() == [gnosispay_data[:-1]]
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/db/test_db_upgrades.py#L6663'>rotkehlchen/tests/db/test_db_upgrades.py~L6663</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT identifier, group_identifier, sequence_index, asset FROM history_events ORDER BY identifier&quot;
-            ).fetchall()
+            )
+            .fetchall()
             == result
         )  # noqa: E501
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/exchanges/test_binance.py#L1175'>rotkehlchen/tests/exchanges/test_binance.py~L1175</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     'SELECT COUNT(*) FROM history_events WHERE subtype=&quot;reward&quot; AND location=?;',
                     (location.serialize_for_db(),),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == count
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/exchanges/test_bitfinex.py#L210'>rotkehlchen/tests/exchanges/test_bitfinex.py~L210</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT exchange_symbol, local_id FROM location_asset_mappings WHERE location=?;&quot;,
                 (bitfinex_db_serialized,),
-            ).fetchall()
+            )
+            .fetchall()
         )
 
     mock_bitfinex.first_connection()
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/exchanges/test_bitfinex.py#L220'>rotkehlchen/tests/exchanges/test_bitfinex.py~L220</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT exchange_symbol, local_id FROM location_asset_mappings WHERE location=?;&quot;,
                 (bitfinex_db_serialized,),
-            ).fetchall()
+            )
+            .fetchall()
         )
 
     new_mappings = mappings_after - mappings_before
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/exchanges/test_bitfinex.py#L233'>rotkehlchen/tests/exchanges/test_bitfinex.py~L233</a></p>
<pre><code class="language-diff">                     &quot;SELECT COUNT(*) FROM location_unsupported_assets &quot;
                     &quot;WHERE location=? AND exchange_symbol=?;&quot;,
                     (bitfinex_db_serialized, bfx_symbol),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )  # no new mapping added for unsupported assets
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/decoders/test_ens.py#L1101'>rotkehlchen/tests/unit/decoders/test_ens.py~L1101</a></p>
<pre><code class="language-diff">             assert (
                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE '{cache_key.serialize()}%'&quot;,
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_asset_updates.py#L430'>rotkehlchen/tests/unit/globaldb/test_asset_updates.py~L430</a></p>
<pre><code class="language-diff">             == &quot;Ethereum&quot;
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT symbol FROM common_asset_details WHERE identifier='ETH'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT symbol FROM common_asset_details WHERE identifier='ETH'&quot;)
+            .fetchone()[0]
             == &quot;ETH&quot;
         )  # noqa: E501
         # BTC should have been updated since the insertion were correct
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_asset_updates.py#L441'>rotkehlchen/tests/unit/globaldb/test_asset_updates.py~L441</a></p>
<pre><code class="language-diff">             == &quot;name2&quot;
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT symbol FROM common_asset_details WHERE identifier='BTC'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT symbol FROM common_asset_details WHERE identifier='BTC'&quot;)
+            .fetchone()[0]
             == &quot;symbol2&quot;
         )  # noqa: E501
         # NEW-ASSET-1 should have not been added since the insertions were incorrect
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_asset_updates.py#L459'>rotkehlchen/tests/unit/globaldb/test_asset_updates.py~L459</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT symbol FROM common_asset_details WHERE identifier='NEW-ASSET-2'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;symbol4&quot;
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_asset_updates.py#L601'>rotkehlchen/tests/unit/globaldb/test_asset_updates.py~L601</a></p>
<pre><code class="language-diff">             write_cursor.execute(
                 &quot;SELECT COUNT(*) FROM underlying_tokens_list WHERE parent_token_entry=?;&quot;,
                 (&quot;eip155:42161/erc20:0xA5EDBDD9646f8dFF606d7448e414884C7d905dCA&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             write_cursor.execute(
                 &quot;SELECT COUNT(*) FROM multiasset_mappings WHERE asset=?;&quot;,
                 (&quot;eip155:42161/erc20:0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_asset_updates.py#L676'>rotkehlchen/tests/unit/globaldb/test_asset_updates.py~L676</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM underlying_tokens_list WHERE parent_token_entry=?;&quot;,
                 (&quot;eip155:42161/erc20:0xA5EDBDD9646f8dFF606d7448e414884C7d905dCA&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multiasset_mappings WHERE asset=?;&quot;,
                 (&quot;eip155:42161/erc20:0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_cache.py#L417'>rotkehlchen/tests/unit/globaldb/test_globaldb_cache.py~L417</a></p>
<pre><code class="language-diff">         assert (
             write_cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'CURVE_POOL_ADDRESS100x%'&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             &gt; 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_cache.py#L674'>rotkehlchen/tests/unit/globaldb/test_globaldb_cache.py~L674</a></p>
<pre><code class="language-diff">                         &quot;0xBc2acf5E821c5c9f8667A36bB1131dAd26Ed64F9&quot;
                     ),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_cache.py#L689'>rotkehlchen/tests/unit/globaldb/test_globaldb_cache.py~L689</a></p>
<pre><code class="language-diff"> 
     with GlobalDBHandler().conn.read_ctx() as cursor:
         assert (
-            cursor.execute(
-                &quot;SELECT protocol FROM evm_tokens WHERE address=?&quot;, (pool_address,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT protocol FROM evm_tokens WHERE address=?&quot;, (pool_address,))
+            .fetchone()[0]
             == &quot;balancer-v2&quot;
         )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py#L127'>rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py~L127</a></p>
<pre><code class="language-diff">         # - `apply_pending_compatible_updates` runs during create_globaldb() and pulls all compatible asset updates up to v32 and then v36 (max compatible)  # noqa: E501
         # - At this point we are sure that assets updates up until 36 are applied
         assert (
-            old_globaldb_cursor.execute(
-                &quot;SELECT value FROM settings WHERE name='assets_version'&quot;
-            ).fetchone()[0]
+            old_globaldb_cursor.execute(&quot;SELECT value FROM settings WHERE name='assets_version'&quot;)
+            .fetchone()[0]
             == &quot;36&quot;
         )  # noqa: E501
         assert (
-            packaged_db_cursor.execute(
-                &quot;SELECT value FROM settings WHERE name='assets_version'&quot;
-            ).fetchone()[0]
+            packaged_db_cursor.execute(&quot;SELECT value FROM settings WHERE name='assets_version'&quot;)
+            .fetchone()[0]
             == &quot;38&quot;
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py#L175'>rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py~L175</a></p>
<pre><code class="language-diff">                 f&quot;protocol IN ({','.join(['?'] * len(IGNORED_PROTOCOLS))}) OR &quot;
                 f&quot;address in (SELECT value FROM general_cache)&quot;,
                 list(IGNORED_PROTOCOLS),
-            ).fetchall()
+            )
+            .fetchall()
         }
 
         (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py#L237'>rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py~L237</a></p>
<pre><code class="language-diff">                 },
                 cursor.execute(
                     &quot;SELECT identifier, weight, parent_token_entry FROM underlying_tokens_list&quot;,
-                ).fetchall(),
+                )
+                .fetchall(),
                 {
                     collection_id: (name, symbol)
                     for (collection_id, name, symbol) in cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py#L246'>rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py~L246</a></p>
<pre><code class="language-diff">                 },
                 cursor.execute(
                     &quot;SELECT collection_id, asset FROM multiasset_mappings&quot;,
-                ).fetchall(),
+                )
+                .fetchall(),
             )
             for cursor in (old_db_cursor, packaged_db_cursor)
         )
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py#L628'>rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py~L628</a></p>
<pre><code class="language-diff">                 set(
                     cursor.execute(
                         &quot;SELECT location, exchange_symbol FROM location_unsupported_assets&quot;,
-                    ).fetchall()
+                    )
+                    .fetchall()
                 ),
             )
             for cursor in (old_db_cursor, packaged_db_cursor)
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_migrations.py#L29'>rotkehlchen/tests/unit/globaldb/test_migrations.py~L29</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'MAKERDAO_VAULT_ILK%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_migrations.py#L45'>rotkehlchen/tests/unit/globaldb/test_migrations.py~L45</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'MAKERDAO_VAULT_ILK%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 25
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_migrations.py#L65'>rotkehlchen/tests/unit/globaldb/test_migrations.py~L65</a></p>
<pre><code class="language-diff">     # Check state before migration
     with globaldb.conn.read_ctx() as cursor:
         assert (
-            cursor.execute(
-                &quot;SELECT value FROM unique_cache WHERE key=?&quot;, (&quot;YEARN_VAULTS&quot;,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT value FROM unique_cache WHERE key=?&quot;, (&quot;YEARN_VAULTS&quot;,))
+            .fetchone()[0]
             == &quot;179&quot;
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_migrations.py#L77'>rotkehlchen/tests/unit/globaldb/test_migrations.py~L77</a></p>
<pre><code class="language-diff"> 
     with globaldb.conn.read_ctx() as cursor:
         assert (
-            cursor.execute(
-                &quot;SELECT value FROM unique_cache WHERE key=?&quot;, (&quot;YEARN_VAULTS&quot;,)
-            ).fetchone()
+            cursor.execute(&quot;SELECT value FROM unique_cache WHERE key=?&quot;, (&quot;YEARN_VAULTS&quot;,))
+            .fetchone()
             is None
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_migrations.py#L119'>rotkehlchen/tests/unit/globaldb/test_migrations.py~L119</a></p>
<pre><code class="language-diff">         rows = list(
             cursor.execute(
                 &quot;SELECT address, blockchain, name FROM address_book ORDER BY blockchain&quot;
-            ).fetchall()
+            )
+            .fetchall()
         )  # noqa: E501
         assert rows == [
             (eth_addr, &quot;ETH&quot;, &quot;yabir.eth&quot;),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L318'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L318</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) from contract_abi WHERE name in (?, ?, ?)&quot;,
                 (&quot;ETH_SCAN&quot;, &quot;ETH_MULTICALL&quot;, &quot;ETH_MULTICALL2&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) from contract_data WHERE name in (?, ?, ?)&quot;,
                 (&quot;ETH_SCAN&quot;, &quot;ETH_MULTICALL&quot;, &quot;ETH_MULTICALL2&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L583'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L583</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                 (&quot;VELO&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier=?&quot;,
                 (&quot;VELO&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L681'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L681</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM location_asset_mappings WHERE location IS ?&quot;,
                     (exchange,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == expected_mappings_count
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L703'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L703</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM location_unsupported_assets WHERE location = ?&quot;,
                     (location,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == expected_mappings_count
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L720'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L720</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT protocol from evm_tokens where identifier=?&quot;,
                 (&quot;eip155:1/erc20:0xA0b73E1Ff0B80914AB6fe0444E65848C4C34450b&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;spam&quot;
         )
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L730'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L730</a></p>
<pre><code class="language-diff">                     &quot;SPAM_ASSET_FALSE_POSITIVE&quot;,
                     &quot;eip155:1/erc20:0xA0b73E1Ff0B80914AB6fe0444E65848C4C34450b&quot;,
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM contract_data WHERE address=?&quot;,
                 (&quot;0xAB392016859663Ce1267f8f243f9F2C02d93bad8&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L757'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L757</a></p>
<pre><code class="language-diff">         ).fetchall()
 
         cached_lp_tokens = set(
-            cursor.execute(
-                &quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_LP_TOKENS%'&quot;
-            ).fetchall()
+            cursor.execute(&quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_LP_TOKENS%'&quot;)
+            .fetchall()
         )  # noqa: E501
         cached_pool_tokens = set(
-            cursor.execute(
-                &quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_POOL_TOKENS%'&quot;
-            ).fetchall()
+            cursor.execute(&quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_POOL_TOKENS%'&quot;)
+            .fetchall()
         )  # noqa: E501
         cached_underlying_tokens = set(
             cursor.execute(
                 &quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_POOL_UNDERLYING_TOKENS%'&quot;
-            ).fetchall()
+            )
+            .fetchall()
         )  # noqa: E501
         cached_gauges = set(
-            cursor.execute(
-                &quot;SELECT value FROM unique_cache WHERE key LIKE 'CURVE_GAUGE_ADDRESS%'&quot;
-            ).fetchall()
+            cursor.execute(&quot;SELECT value FROM unique_cache WHERE key LIKE 'CURVE_GAUGE_ADDRESS%'&quot;)
+            .fetchall()
         )  # noqa: E501
         cached_pools = set(
-            cursor.execute(
-                &quot;SELECT value FROM unique_cache WHERE key LIKE 'CURVE_POOL_ADDRESS%'&quot;
-            ).fetchall()
+            cursor.execute(&quot;SELECT value FROM unique_cache WHERE key LIKE 'CURVE_POOL_ADDRESS%'&quot;)
+            .fetchall()
         )  # noqa: E501
 
         assert len(cached_lp_tokens) == 973
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L790'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L790</a></p>
<pre><code class="language-diff"> 
         # cache with new keys doesn't exist yet
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM general_cache WHERE key LIKE 'CURVE_LP_TOKENS1%'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM general_cache WHERE key LIKE 'CURVE_LP_TOKENS1%'&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM general_cache WHERE key LIKE 'CURVE_POOL_TOKENS1%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'CURVE_GAUGE_ADDRESS1%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'CURVE_POOL_ADDRESS1%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L848'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L848</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT protocol from evm_tokens where identifier=?&quot;,
                 (&quot;eip155:1/erc20:0xA0b73E1Ff0B80914AB6fe0444E65848C4C34450b&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             is None
         )
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L858'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L858</a></p>
<pre><code class="language-diff">                     &quot;SPAM_ASSET_FALSE_POSITIVE&quot;,
                     &quot;eip155:1/erc20:0xA0b73E1Ff0B80914AB6fe0444E65848C4C34450b&quot;,
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L890'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L890</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM asset_collections WHERE id=? AND name=? AND symbol=?&quot;,
                     (collection_id, name, symbol),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 1
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L899'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L899</a></p>
<pre><code class="language-diff">             v7_multiasset_mappings
             == cursor.execute(
                 &quot;SELECT rowid, collection_id, asset FROM multiasset_mappings;&quot;,
-            ).fetchall()
+            )
+            .fetchall()
         )
 
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM contract_data WHERE address=?&quot;,
                 (&quot;0xAB392016859663Ce1267f8f243f9F2C02d93bad8&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM contract_data WHERE address=?&quot;,
                 (&quot;0xc97EE9490F4e3A3136A513DB38E3C7b47e69303B&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L921'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L921</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM general_cache WHERE key LIKE 'CURVE_LP_TOKENS0x%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM general_cache WHERE key LIKE 'CURVE_POOL_TOKENS0x%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'CURVE_GAUGE_ADDRESS0x%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE 'CURVE_POOL_ADDRESS0x%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L948'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L948</a></p>
<pre><code class="language-diff">             set(
                 cursor.execute(
                     &quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_LP_TOKENS1%'&quot;
-                ).fetchall()
+                )
+                .fetchall()
             )
             == cached_lp_tokens
         )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L956'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L956</a></p>
<pre><code class="language-diff">             set(
                 cursor.execute(
                     &quot;SELECT value FROM general_cache WHERE key LIKE 'CURVE_POOL_TOKENS1%'&quot;
-                ).fetchall()
+                )
+                .fetchall()
             )
             == cached_pool_tokens
         )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L964'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L964</a></p>
<pre><code class="language-diff">             set(
                 cursor.execute(
                     &quot;SELECT value FROM unique_cache WHERE key LIKE 'CURVE_GAUGE_ADDRESS1%'&quot;
-                ).fetchall()
+                )
+                .fetchall()
             )
             == cached_gauges
         )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L972'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L972</a></p>
<pre><code class="language-diff">             set(
                 cursor.execute(
                     &quot;SELECT value FROM unique_cache WHERE key LIKE 'CURVE_POOL_ADDRESS1%'&quot;
-                ).fetchall()
+                )
+                .fetchall()
             )
             == cached_pools
         )  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L981'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L981</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM general_cache WHERE key LIKE 'CURVE_POOL_UNDERLYING_TOKENS%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1042'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1042</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM underlying_tokens_list WHERE identifier=parent_token_entry&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 2
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1080'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1080</a></p>
<pre><code class="language-diff">             len(
                 cursor.execute(
                     &quot;SELECT * FROM price_history_source_types WHERE type IN ('G', 'H') AND seq IN (7, 8);&quot;,
-                ).fetchall()
+                )
+                .fetchall()
             )
             == 2
         )
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1091'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1091</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(  # Check that the two underlying tokens that havethemselves as underlying have been removed  # noqa: E501
                 &quot;SELECT COUNT(*) FROM underlying_tokens_list&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == underlying_count_before - 2
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM underlying_tokens_list WHERE identifier=parent_token_entry&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1168'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1168</a></p>
<pre><code class="language-diff">             len(
                 cursor.execute(
                     'SELECT name FROM sqlite_master WHERE type=&quot;index&quot; and sql IS NOT NULL',
-                ).fetchall()
+                )
+                .fetchall()
             )
             == 0
         )
         assert (
-            cursor.execute(&quot;SELECT COUNT(*) FROM asset_types WHERE type IN ('S', 'X')&quot;).fetchone()[
-                0
-            ]
+            cursor.execute(&quot;SELECT COUNT(*) FROM asset_types WHERE type IN ('S', 'X')&quot;)
+            .fetchone()[0]
             == 2
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('BIDR', 'TEDDY')&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('BIDR', 'TEDDY')&quot;)
+            .fetchone()[0]
             == 2
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier IN ('BIDR', 'TEDDY')&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 2
         )  # noqa: E501
         # Make sure that non movable binance assets have their type changed
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1197'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1197</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier='eip155:56/erc20:0x0409633A72D846fc5BBe2f98D88564D35987904D'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1230'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1230</a></p>
<pre><code class="language-diff">             (&quot;idx_multiasset_mappings_identifier&quot;,),
         ]
         assert (
-            cursor.execute(&quot;SELECT COUNT(*) FROM asset_types WHERE type IN ('S', 'X')&quot;).fetchone()[
-                0
-            ]
+            cursor.execute(&quot;SELECT COUNT(*) FROM asset_types WHERE type IN ('S', 'X')&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('BIDR', 'TEDDY')&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('BIDR', 'TEDDY')&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier IN ('BIDR', 'TEDDY')&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1253'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1253</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier='eip155:56/erc20:0x0409633A72D846fc5BBe2f98D88564D35987904D'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
-            cursor.execute(
-                &quot;SELECT swapped_for FROM common_asset_details WHERE identifier='PHX'&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT swapped_for FROM common_asset_details WHERE identifier='PHX'&quot;)
+            .fetchone()[0]
             == &quot;eip155:56/erc20:0x0409633A72D846fc5BBe2f98D88564D35987904D&quot;
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1278'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1278</a></p>
<pre><code class="language-diff">                     CacheType.AERODROME_POOL_ADDRESS.serialize(),
                     CacheType.AERODROME_GAUGE_ADDRESS.serialize(),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1914
         )
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1290'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1290</a></p>
<pre><code class="language-diff">                     CacheType.AERODROME_GAUGE_BRIBE_ADDRESS.serialize(),
                     CacheType.AERODROME_GAUGE_FEE_ADDRESS.serialize(),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1301'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1301</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE ? ESCAPE ?&quot;,
                 (&quot;CURVE\\_LENDING\\_VAULT\\_AMM%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 2
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE ? ESCAPE ?&quot;,
                 (&quot;CURVE\\_LENDING\\_VAULT\\_COLLATERAL\\_TOKEN%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 2
         )
         assert table_exists(cursor=cursor, name=&quot;counterparty_asset_mappings&quot;) is False
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1348'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1348</a></p>
<pre><code class="language-diff">                     CacheType.AERODROME_POOL_ADDRESS.serialize(),
                     CacheType.AERODROME_GAUGE_ADDRESS.serialize(),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 4420
         )
         assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1360'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1360</a></p>
<pre><code class="language-diff">                     CacheType.AERODROME_GAUGE_BRIBE_ADDRESS.serialize(),
                     CacheType.AERODROME_GAUGE_FEE_ADDRESS.serialize(),
                 ),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1194
         )
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1371'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1371</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE ? ESCAPE ?&quot;,
                 (&quot;CURVE\\_LENDING\\_VAULT\\_AMM%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE ? ESCAPE ?&quot;,
                 (&quot;CURVE\\_LENDING\\_VAULT\\_COLLATERAL\\_TOKEN%&quot;, &quot;\\&quot;),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert cursor.execute(&quot;SELECT COUNT(*) FROM default_rpc_nodes&quot;).fetchone()[0] == 33
         assert (
             cursor.execute(
                 'SELECT COUNT(*) FROM default_rpc_nodes WHERE endpoint=&quot;&quot;',
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1398'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1398</a></p>
<pre><code class="language-diff">         assert table_exists(cursor=cursor, name=&quot;solana_tokens&quot;) is False
         assert index_exists(cursor=cursor, name=&quot;idx_solana_tokens_identifier&quot;) is False
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM token_kinds WHERE token_kind IN ('D', 'E')&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM token_kinds WHERE token_kind IN ('D', 'E')&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
-            solana_tokens_count := cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE type='Y'&quot;
-            ).fetchone()[0]
+            solana_tokens_count := cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE type='Y'&quot;)
+            .fetchone()[0]
         ) == 432  # noqa: E501
         assert cursor.execute(
             &quot;SELECT identifier, name FROM assets WHERE type='Y' LIMIT 10&quot;
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1504'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1504</a></p>
<pre><code class="language-diff">             protocol_tokens_count := cursor.execute(
                 f&quot;SELECT COUNT(*) FROM evm_tokens WHERE protocol IN ({','.join(['?' for _ in protocol_mapping])})&quot;,  # noqa: E501
                 tuple(protocol_mapping),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
         ) &gt; 0
 
         balancer_cache_mapping = {  # define before/after mapping for cache keys
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1521'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1521</a></p>
<pre><code class="language-diff">             (
                 balancer_gauges := cursor.execute(
                     &quot;SELECT key FROM general_cache WHERE key LIKE 'BALANCER_GAUGES%'&quot;
-                ).fetchall()
+                )
+                .fetchall()
             )
             == [  # noqa: E501
                 (&quot;BALANCER_GAUGES1001&quot;,),
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1571'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1571</a></p>
<pre><code class="language-diff">         assert table_exists(cursor=cursor, name=&quot;solana_tokens&quot;) is True
         assert index_exists(cursor=cursor, name=&quot;idx_solana_tokens_identifier&quot;) is True
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM token_kinds WHERE token_kind IN ('D', 'E')&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM token_kinds WHERE token_kind IN ('D', 'E')&quot;)
+            .fetchone()[0]
             == 2
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1600'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1600</a></p>
<pre><code class="language-diff">             (&quot;solana/token:ATLASXmbPQxBUYbxPsV97usA3fPQYEqzQBUHgiFCUsXx&quot;, &quot;Star Atlas&quot;),
         ]
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('HODLSOL','TRISIG')&quot;
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE identifier IN ('HODLSOL','TRISIG')&quot;)
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # solana_tokens count reduced by 5: 2 duplicates removed + 3 user-added tokens migrated to AssetType.OTHER i.e. 'W'  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1620'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1620</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM solana_tokens s LEFT JOIN assets a ON s.identifier = a.identifier WHERE a.identifier IS NULL&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # Ensure all solana tokens have corresponding entries in the common_asset_details table
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM solana_tokens s LEFT JOIN common_asset_details c ON s.identifier = c.identifier WHERE c.identifier IS NULL&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE type='Y' AND identifier NOT LIKE 'solana%'&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1688'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1688</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE type='Y' AND identifier IN ('HODLER','LAND','LEMON')&quot;
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT identifier, name FROM assets WHERE type='W' AND identifier IN ('HODLER','LAND','LEMON')&quot;
-            ).fetchall()
+            )
+            .fetchall()
             == user_added_tokens_before
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1707'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1707</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     f&quot;SELECT COUNT(*) FROM evm_tokens WHERE protocol IN ({','.join(['?' for _ in protocols])})&quot;,  # noqa: E501
                     tuple(protocols),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == expected_count
             )
 
         # Verify balancer cache migration: old keys gone, new keys exist with same count
         assert (
-            cursor.execute(
-                'SELECT COUNT(*) FROM general_cache WHERE key LIKE &quot;BALANCER_GAUGES%&quot;'
-            ).fetchone()[0]
+            cursor.execute('SELECT COUNT(*) FROM general_cache WHERE key LIKE &quot;BALANCER_GAUGES%&quot;')
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         # `balancer_gauges_count - 1` because a malformed/unexpected balancer gauge cache entry got deleted  # noqa: E501
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1723'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1723</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM general_cache WHERE key IN (?, ?, ?, ?, ?, ?, ?)&quot;,
                 list(balancer_cache_mapping.values()),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == len(balancer_gauges) - 1
         )  # noqa: E501
         # Check that the coinbaseprime mappings have been combined with the coinbase mappings.
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1752'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1752</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM location_asset_mappings WHERE location=?&quot;,
                     (new_location,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == expected_new_count
             )
             assert (
                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM location_asset_mappings WHERE location=?&quot;,
                     (old_location,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1831'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1831</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, ((new_solana_id := &quot;SOL&quot;),)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier = ?&quot;, (new_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1941'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1941</a></p>
<pre><code class="language-diff">     assert globaldb.get_setting_value(&quot;version&quot;, 0) == 14
     with globaldb.conn.read_ctx() as cursor:
         assert (
-            cursor.execute(
-                &quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            cursor.execute(&quot;SELECT COUNT(*) FROM assets WHERE identifier = ?&quot;, (old_solana_id,))
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM common_asset_details WHERE identifier = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1966'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1966</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM location_asset_mappings WHERE local_id = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1980'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1980</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM multiasset_mappings WHERE asset = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L1992'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L1992</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM asset_collections WHERE main_asset = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L2004'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L2004</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_owned_assets WHERE asset_id = ?&quot;, (old_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM user_owned_assets WHERE asset_id = ?&quot;, (new_solana_id,)
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )  # noqa: E501
         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM price_history WHERE from_asset = ? OR to_asset = ?&quot;,
                 (old_solana_id, old_solana_id),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L2031'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L2031</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM binance_pairs WHERE base_asset = ? OR quote_asset = ?&quot;,
                 (old_solana_id, old_solana_id),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L2045'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L2045</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM counterparty_asset_mappings WHERE local_id = ?&quot;,
                 (old_solana_id,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
         assert cursor.execute(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L2117'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L2117</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier IN (?, ?, ?)&quot;,
                 (rocket_pool_asset, compound_usdt_asset, morpho_asset),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/globaldb/test_upgrades.py#L2143'>rotkehlchen/tests/unit/globaldb/test_upgrades.py~L2143</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM assets WHERE identifier IN (?, ?, ?)&quot;,
                 (rocket_pool_asset, compound_usdt_asset, morpho_asset),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 3
         )  # noqa: E501
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_data_updates.py#L769'>rotkehlchen/tests/unit/test_data_updates.py~L769</a></p>
<pre><code class="language-diff">                     Location.deserialize(deletion[&quot;location&quot;]).serialize_for_db(),
                     deletion[&quot;location_symbol&quot;],
                 ),  # noqa: E501
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert not_exists == after_upgrade
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_data_updates.py#L828'>rotkehlchen/tests/unit/test_data_updates.py~L828</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM counterparty_asset_mappings WHERE counterparty IS ? AND symbol IS ?&quot;,  # noqa: E501
                 (deletion[&quot;counterparty&quot;], deletion[&quot;counterparty_symbol&quot;]),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
         assert not_exists == after_upgrade
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_ethereum_airdrops.py#L389'>rotkehlchen/tests/unit/test_ethereum_airdrops.py~L389</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE ?&quot;,
                 (&quot;AIRDROPS_HASH%&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 0
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_ethereum_airdrops.py#L416'>rotkehlchen/tests/unit/test_ethereum_airdrops.py~L416</a></p>
<pre><code class="language-diff">                 cursor.execute(
                     &quot;SELECT COUNT(*) FROM assets WHERE identifier=?&quot;,
                     (new_asset_identifier,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )  # asset not present before
         data = check_airdrops(
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_ethereum_airdrops.py#L438'>rotkehlchen/tests/unit/test_ethereum_airdrops.py~L438</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM unique_cache WHERE key LIKE ?&quot;,
                 (&quot;AIRDROPS_HASH%&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 13
         )
         assert (
             cursor.execute(
                 &quot;SELECT value FROM unique_cache WHERE key=?&quot;,
                 (&quot;AIRDROPS_HASHdiva.parquet&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == MOCK_AIRDROP_INDEX[&quot;airdrops&quot;][&quot;diva&quot;][&quot;file_hash&quot;]
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_ethereum_airdrops.py#L588'>rotkehlchen/tests/unit/test_ethereum_airdrops.py~L588</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT value FROM unique_cache WHERE key=?&quot;,
                 (&quot;AIRDROPS_HASHdiva.parquet&quot;,),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == &quot;updated_hash&quot;
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_tasks_manager.py#L1171'>rotkehlchen/tests/unit/test_tasks_manager.py~L1171</a></p>
<pre><code class="language-diff">                 write_cursor.execute(
                     &quot;SELECT COUNT(*) FROM evm_tokens WHERE protocol = ?;&quot;,
                     (counterparty,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 == 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_tasks_manager.py#L1197'>rotkehlchen/tests/unit/test_tasks_manager.py~L1197</a></p>
<pre><code class="language-diff">                 write_cursor.execute(
                     &quot;SELECT COUNT(*) FROM evm_tokens WHERE protocol = ?;&quot;,
                     (counterparty,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0
             )
             assert (
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_tasks_manager.py#L1205'>rotkehlchen/tests/unit/test_tasks_manager.py~L1205</a></p>
<pre><code class="language-diff">                     &quot;SELECT COUNT(*) FROM underlying_tokens_list WHERE parent_token_entry IN &quot;
                     &quot;(SELECT identifier FROM evm_tokens WHERE protocol = ?);&quot;,
                     (counterparty,),
-                ).fetchone()[0]
+                )
+                .fetchone()[0]
                 &gt; 0
             )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/unit/test_tasks_manager.py#L1354'>rotkehlchen/tests/unit/test_tasks_manager.py~L1354</a></p>
<pre><code class="language-diff">         assert (
             cursor.execute(
                 &quot;SELECT COUNT(*) FROM calendar_reminders WHERE event_id=2&quot;,
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             == 1
         )
 
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/utils/database.py#L236'>rotkehlchen/tests/utils/database.py~L236</a></p>
<pre><code class="language-diff">         cursor.execute(
             &quot;SELECT COUNT(*) FROM sqlite_master WHERE type='index' AND name=?&quot;,
             (name,),
-        ).fetchone()[0]
+        )
+        .fetchone()[0]
         == 1
     )
     if exists and schema is not None:
</code></pre>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/tests/utils/globaldb.py#L164'>rotkehlchen/tests/utils/globaldb.py~L164</a></p>
<pre><code class="language-diff">             cursor.execute(
                 &quot;SELECT COUNT(*) FROM location_unsupported_assets WHERE location=? AND exchange_symbol=?&quot;,  # noqa: E501
                 (location.serialize_for_db(), asset_symbol),
-            ).fetchone()[0]
+            )
+            .fetchone()[0]
             &gt; 0
         )
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/indico/indico">indico/indico</a> (+26 -19 lines across 11 files)</summary>
<p>

<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/events/management/controllers/base.py#L60'>indico/modules/events/management/controllers/base.py~L60</a></p>
<pre><code class="language-diff">         contribution_persons.extend(
             SubContributionPersonLink.query.filter(
                 SubContributionPersonLink.subcontribution.has(SubContribution.contribution.has(self._membership_filter))
-            ).all()
+            )
+            .all()
         )
 
         registered_persons = get_registered_event_persons(self.event)
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/events/models/events.py#L1067'>indico/modules/events/models/events.py~L1067</a></p>
<pre><code class="language-diff">     def session_block_count(self):
         from indico.modules.events.sessions.models.blocks import SessionBlock
 
-        return SessionBlock.query.filter(
-            SessionBlock.session.has(event=self, is_deleted=False), SessionBlock.timetable_entry != None
-        ).count()  # noqa: E711
+        return (
+            SessionBlock.query.filter(
+                SessionBlock.session.has(event=self, is_deleted=False), SessionBlock.timetable_entry != None
+            )  # noqa: E711
+            .count()
+        )
 
     def __repr__(self):
         return format_repr(
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/events/reminders/notifications_test.py#L141'>indico/modules/events/reminders/notifications_test.py~L141</a></p>
<pre><code class="language-diff">             &lt;tr&gt;&lt;td&gt;Kitten&lt;/td&gt;&lt;td&gt;OVER 9000&lt;/td&gt;&lt;/tr&gt;
             &lt;tr&gt;&lt;td&gt;Molerat&lt;/td&gt;&lt;td&gt;WTF&lt;/td&gt;&lt;/tr&gt;
         &lt;/table&gt;
-    &quot;&quot;&quot;).strip()
+    &quot;&quot;&quot;)
+        .strip()
     )
     html_tpl, text_tpl = get_reminder_email_tpl(event, ReminderType.standard, RenderMode.html, False, False, None, note)
     snapshot.snapshot_dir = Path(__file__).parent / 'templates/emails/tests'
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/events/util.py#L756'>indico/modules/events/util.py~L756</a></p>
<pre><code class="language-diff"> def get_all_user_roles(event, user):
     event_roles = set(EventRole.query.with_parent(event).filter(EventRole.members.any(User.id == user.id)))
     category_roles = set(
-        CategoryRole.query.join(event.category.chain_query.subquery()).filter(
-            CategoryRole.members.any(User.id == user.id)
-        )
+        CategoryRole.query.join(event.category.chain_query.subquery())
+        .filter(CategoryRole.members.any(User.id == user.id))
     )
     return event_roles, category_roles
 
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/groups/core.py#L266'>indico/modules/groups/core.py~L266</a></p>
<pre><code class="language-diff">         if not identifiers and not emails:
             return set()
         return set(
-            User.query.outerjoin(Identity).filter(
+            User.query.outerjoin(Identity)
+            .filter(
                 ~User.is_deleted,
                 db.or_(
                     User.all_emails.in_(list(emails)),
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/rb/controllers/backend/bookings.py#L579'>indico/modules/rb/controllers/backend/bookings.py~L579</a></p>
<pre><code class="language-diff">     )
     def _process(self, room_ids, start_date, end_date, format):
         occurrences = (
-            ReservationOccurrence.query.join(ReservationOccurrence.reservation).filter(
+            ReservationOccurrence.query.join(ReservationOccurrence.reservation)
+            .filter(
                 Reservation.room_id.in_(room_ids),
                 ReservationOccurrence.is_valid,
                 db_dates_overlap(
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/rb/models/reservation_occurrences_test.py#L307'>indico/modules/rb/models/reservation_occurrences_test.py~L307</a></p>
<pre><code class="language-diff">         db_occ
         not in ReservationOccurrence.find_overlapping_with(
             room=db_occ.reservation.room, occurrences=[occ], skip_reservation_id=db_occ.reservation.id
-        ).all()
+        )
+        .all()
     )
 
 
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/rb/models/reservations.py#L297'>indico/modules/rb/models/reservations.py~L297</a></p>
<pre><code class="language-diff">         if occurs_on:
             query = query.filter(
                 Reservation.id.in_(
-                    db.session.query(ReservationOccurrence.reservation_id).filter(
-                        ReservationOccurrence.date.in_(occurs_on), ReservationOccurrence.is_valid
-                    )
+                    db.session.query(ReservationOccurrence.reservation_id)
+                    .filter(ReservationOccurrence.date.in_(occurs_on), ReservationOccurrence.is_valid)
                 )
             )
         if limit_per_room and (limit or offset):
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/rb/models/reservations_test.py#L165'>indico/modules/rb/models/reservations_test.py~L165</a></p>
<pre><code class="language-diff">         reservation
         not in Reservation.find_overlapping_with(
             room=reservation.room, occurrences=[occurrence], skip_reservation_id=reservation.id
-        ).all()
+        )
+        .all()
     )
 
 
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/users/controllers.py#L838'>indico/modules/users/controllers.py~L838</a></p>
<pre><code class="language-diff"> 
     def _process(self):
         admins = set(
-            User.query.filter_by(is_admin=True, is_deleted=False).order_by(
-                db.func.lower(User.first_name), db.func.lower(User.last_name)
-            )
+            User.query.filter_by(is_admin=True, is_deleted=False)
+            .order_by(db.func.lower(User.first_name), db.func.lower(User.last_name))
         )
 
         form = AdminsForm(admins=admins)
</code></pre>
<p><a href='https://github.com/indico/indico/blob/ec8a0095f00fa24bdbddd02a95fac4076d238596/indico/modules/users/util.py#L105'>indico/modules/users/util.py~L105</a></p>
<pre><code class="language-diff">                 )
             ),
             ~Category.is_deleted,
-        ).options(undefer('chain_titles'))
+        )
+        .options(undefer('chain_titles'))
     )
     if not detailed:
         return favorites | managed
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/zanieb/huggingface-notebooks">zanieb/huggingface-notebooks</a> (+29 -19 lines across 4 files)</summary>
<p>

<p><a href='https://github.com/zanieb/huggingface-notebooks/blob/68cd6fa1a2831c5189f85257c13d691cb76292db/diffusers/sd_textual_inversion_training.ipynb#L930'>diffusers/sd_textual_inversion_training.ipynb~L930</a></p>
<pre><code class="language-diff">     &quot;\n&quot;,
     &quot;    # Initialize the optimizer\n&quot;,
     &quot;    optimizer = torch.optim.AdamW(\n&quot;,
-    &quot;        text_encoder.get_input_embeddings().parameters(),  # only optimize the embeddings\n&quot;,
+    &quot;        text_encoder.get_input_embeddings()\n&quot;,
+    &quot;        .parameters(),  # only optimize the embeddings\n&quot;,
     &quot;        lr=learning_rate,\n&quot;,
     &quot;    )\n&quot;,
     &quot;\n&quot;,
</code></pre>
<p><a href='https://github.com/zanieb/huggingface-notebooks/blob/68cd6fa1a2831c5189f85257c13d691cb76292db/diffusers_doc/en/custom_pipeline_examples.ipynb#L182'>diffusers_doc/en/custom_pipeline_examples.ipynb~L182</a></p>
<pre><code class="language-diff">     &quot;from diffusers import DiffusionPipeline\n&quot;,
     &quot;import torch\n&quot;,
     &quot;\n&quot;,
-    &quot;pipe = DiffusionPipeline.from_pretrained(\n&quot;,
-    &quot;    \&quot;CompVis/stable-diffusion-v1-4\&quot;,\n&quot;,
-    &quot;    torch_dtype=torch.float16,\n&quot;,
-    &quot;    safety_checker=None,  # Very important for videos...lots of false positives while interpolating\n&quot;,
-    &quot;    custom_pipeline=\&quot;interpolate_stable_diffusion\&quot;,\n&quot;,
-    &quot;).to(\&quot;cuda\&quot;)\n&quot;,
+    &quot;pipe = (\n&quot;,
+    &quot;    DiffusionPipeline.from_pretrained(\n&quot;,
+    &quot;        \&quot;CompVis/stable-diffusion-v1-4\&quot;,\n&quot;,
+    &quot;        torch_dtype=torch.float16,\n&quot;,
+    &quot;        safety_checker=None,  # Very important for videos...lots of false positives while interpolating\n&quot;,
+    &quot;        custom_pipeline=\&quot;interpolate_stable_diffusion\&quot;,\n&quot;,
+    &quot;    )\n&quot;,
+    &quot;    .to(\&quot;cuda\&quot;)\n&quot;,
+    &quot;)\n&quot;,
     &quot;pipe.enable_attention_slicing()\n&quot;,
     &quot;\n&quot;,
     &quot;frame_filepaths = pipe.walk(\n&quot;,
</code></pre>
<p><a href='https://github.com/zanieb/huggingface-notebooks/blob/68cd6fa1a2831c5189f85257c13d691cb76292db/diffusers_doc/en/pytorch/custom_pipeline_examples.ipynb#L182'>diffusers_doc/en/pytorch/custom_pipeline_examples.ipynb~L182</a></p>
<pre><code class="language-diff">     &quot;from diffusers import DiffusionPipeline\n&quot;,
     &quot;import torch\n&quot;,
     &quot;\n&quot;,
-    &quot;pipe = DiffusionPipeline.from_pretrained(\n&quot;,
-    &quot;    \&quot;CompVis/stable-diffusion-v1-4\&quot;,\n&quot;,
-    &quot;    torch_dtype=torch.float16,\n&quot;,
-    &quot;    safety_checker=None,  # Very important for videos...lots of false positives while interpolating\n&quot;,
-    &quot;    custom_pipeline=\&quot;interpolate_stable_diffusion\&quot;,\n&quot;,
-    &quot;).to(\&quot;cuda\&quot;)\n&quot;,
+    &quot;pipe = (\n&quot;,
+    &quot;    DiffusionPipeline.from_pretrained(\n&quot;,
+    &quot;        \&quot;CompVis/stable-diffusion-v1-4\&quot;,\n&quot;,
+    &quot;        torch_dtype=torch.float16,\n&quot;,
+    &quot;        safety_checker=None,  # Very important for videos...lots of false positives while interpolating\n&quot;,
+    &quot;        custom_pipeline=\&quot;interpolate_stable_diffusion\&quot;,\n&quot;,
+    &quot;    )\n&quot;,
+    &quot;    .to(\&quot;cuda\&quot;)\n&quot;,
+    &quot;)\n&quot;,
     &quot;pipe.enable_attention_slicing()\n&quot;,
     &quot;\n&quot;,
     &quot;frame_filepaths = pipe.walk(\n&quot;,
</code></pre>
<p><a href='https://github.com/zanieb/huggingface-notebooks/blob/68cd6fa1a2831c5189f85257c13d691cb76292db/diffusers_doc/en/tensorflow/custom_pipeline_examples.ipynb#L182'>diffusers_doc/en/tensorflow/custom_pipeline_examples.ipynb~L182</a></p>
<pre><code class="language-diff">     &quot;from diffusers import DiffusionPipeline\n&quot;,
     &quot;import torch\n&quot;,
     &quot;\n&quot;,
-    &quot;pipe = DiffusionPipeline.from_pretrained(\n&quot;,
-    &quot;    \&quot;CompVis/stable-diffusion-v1-4\&quot;,\n&quot;,
-    &quot;    torch_dtype=torch.float16,\n&quot;,
-    &quot;    safety_checker=None,  # Very important for videos...lots of false positives while interpolating\n&quot;,
-    &quot;    custom_pipeline=\&quot;interpolate_stable_diffusion\&quot;,\n&quot;,
-    &quot;).to(\&quot;cuda\&quot;)\n&quot;,
+    &quot;pipe = (\n&quot;,
+    &quot;    DiffusionPipeline.from_pretrained(\n&quot;,
+    &quot;        \&quot;CompVis/stable-diffusion-v1-4\&quot;,\n&quot;,
+    &quot;        torch_dtype=torch.float16,\n&quot;,
+    &quot;        safety_checker=None,  # Very important for videos...lots of false positives while interpolating\n&quot;,
+    &quot;        custom_pipeline=\&quot;interpolate_stable_diffusion\&quot;,\n&quot;,
+    &quot;    )\n&quot;,
+    &quot;    .to(\&quot;cuda\&quot;)\n&quot;,
+    &quot;)\n&quot;,
     &quot;pipe.enable_attention_slicing()\n&quot;,
     &quot;\n&quot;,
     &quot;frame_filepaths = pipe.walk(\n&quot;,
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (+2 -1 lines across 1 file)</summary>
<p>
<pre>ruff format --no-preview --exclude examples/mcp/databricks_mcp_cookbook.ipynb,examples/chatgpt/gpt_actions_library/gpt_action_google_drive.ipynb,examples/chatgpt/gpt_actions_library/gpt_action_redshift.ipynb,examples/chatgpt/gpt_actions_library/gpt_action_salesforce.ipynb,</pre>
</p>
<p>

<p><a href='https://github.com/openai/openai-cookbook/blob/134d8a16f1c6b8a58351506e11cb96ada880f6bc/examples/evaluation/use-cases/structured-outputs-evaluation.ipynb#L451'>examples/evaluation/use-cases/structured-outputs-evaluation.ipynb~L451</a></p>
<pre><code class="language-diff">     &quot;                    f.write(\n&quot;,
     &quot;                        client.evals.runs.output_items.list(\n&quot;,
     &quot;                            run_id=run.id, eval_id=eval_id\n&quot;,
-    &quot;                        ).model_dump_json(indent=4)\n&quot;,
+    &quot;                        )\n&quot;,
+    &quot;                        .model_dump_json(indent=4)\n&quot;,
     &quot;                    )\n&quot;,
     &quot;            break\n&quot;,
     &quot;        time.sleep(5)\n&quot;,
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/mesonbuild/meson-python">mesonbuild/meson-python</a> (+4 -2 lines across 2 files)</summary>
<p>
<pre>ruff format --no-preview --exclude tests/packages/symlinks/baz.py,tests/packages/symlinks/qux.py</pre>
</p>
<p>

<p><a href='https://github.com/mesonbuild/meson-python/blob/cfcfb3554800d42c859d04309da2c1973c9f97ce/mesonpy/__init__.py#L570'>mesonpy/<strong>init</strong>.py~L570</a></p>
<pre><code class="language-diff">                        {os.fspath(build_dir)!r},
                        {build_command!r},
                        {verbose!r},
-                   )&quot;&quot;&quot;).encode('utf-8'),
+                   )&quot;&quot;&quot;)
+                .encode('utf-8'),
             )
 
             # install .pth file
</code></pre>
<p><a href='https://github.com/mesonbuild/meson-python/blob/cfcfb3554800d42c859d04309da2c1973c9f97ce/tests/test_wheel.py#L264'>tests/test_wheel.py~L264</a></p>
<pre><code class="language-diff"> 
             [gui_scripts]
             example-gui = example:gui
-        &quot;&quot;&quot;).strip()
+        &quot;&quot;&quot;)
+            .strip()
         )
 
 
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 21:41</div>
            <div class="timeline-body"><p>On the one hand, maybe the change in criterion brings in some things I'd rather it didn't. On the other hand, the current criterion seems very counterintuitive to me - why do we exclude the parent call if there is one?</p>
<p>I mean another possibility is to set the cutoff at 3 instead of 2, which would have the opposite effect of making fluent layout rarer.</p>
<p>I'm torn and open to feedback.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 21:43</div>
            <div class="timeline-body"><p>Also sorry @laundmo I decided, at least now, against this kind of thing:</p>
<pre><code class="language-python">x = (
    some
    .very.nested.object.returns()
    .another.nested.object.and_another_thing()
    .and_something_else()
)
</code></pre>
<p>It feels like it's too different from Prettier, which is more battle-tested for this kind of formatting. I also tend to think of method chains as most often being of the form &quot;perform a sequence of transformations on an object of interest&quot;. So I like to have <code>some.very.nested.object</code> on the first line since it's the &quot;object of interest&quot;, as opposed to the namespace <code>some</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-12-05 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-05 21:46</div>
            <div class="timeline-body"><p>Opening back up for one last review - of design, not implementation - before polishing. This is also the last time I spam your inboxes today, hooray!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-06 13:02</div>
            <div class="timeline-body"><p>I only looked at main vs final proposal because that seems what you want feedback on.</p>
<p>Cases where I think the formatting looks worse:</p>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/nlu/classifiers/diet_classifier.py#L356'>rasa/nlu/classifiers/diet_classifier.py~L356</a></p>
<pre><code class="language-diff">             # check that all hidden layer sizes are the same
             identical_hidden_layer_sizes = all(
                 current_hidden_layer_sizes == first_hidden_layer_sizes
-                for current_hidden_layer_sizes in self.component_config[
-                    HIDDEN_LAYERS_SIZES
-                ].values()
+                for current_hidden_layer_sizes in self
+                .component_config[HIDDEN_LAYERS_SIZES]
+                .values()
             )
             if not identical_hidden_layer_sizes:
                 raise ValueError(
</code></pre>
<p>This is where indenting the method chain would help. It's also surprisingly common. I think method-chaining makes this slightly worse than it is with call-chaining, but it is a pre-existing issue.</p>
<p>The same for</p>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/domain.py#L1178'>rasa/shared/core/domain.py~L1178</a></p>
<pre><code class="language-diff">         # tuple because sub_state will be later transformed into a frozenset (so it can
         # be hashed for deduplication).
         entities = tuple(
-            self._get_featurized_entities(latest_message).intersection(
-                set(sub_state.get(ENTITIES, ()))
-            )
+            self
+            ._get_featurized_entities(latest_message)
+            .intersection(set(sub_state.get(ENTITIES, ())))
         )
         # Sort entities so that any derived state representation is consistent across
         # runs and invariant to the order in which the entities for an utterance are
</code></pre>
<p>Usage in named expressions is very common, and I think I prefer the old formatting. Again, this is a pre-existing issue and the solution is improved nested expression formatting but the new formatting makes this more obvious</p>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/addressbook.py#L260'>rotkehlchen/db/addressbook.py~L260</a></p>
<pre><code class="language-diff">         with self.read_ctx(book_type) as cursor:
             if (
                 entry_count := len(
-                    names := cursor.execute(
+                    names := cursor
+                    .execute(
                         &quot;SELECT name FROM address_book WHERE address=?&quot;,
                         (address,),
-                    ).fetchall()
+                    )
+                    .fetchall()
                 )
             ) == 0 or len(set(names)) &gt; 1:
                 return  # If no name, or different names on different chains, leave as is.
</code></pre>
<p>Another instance</p>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/db/unresolved_conflicts.py#L98'>rotkehlchen/db/unresolved_conflicts.py~L98</a></p>
<pre><code class="language-diff">                     &quot;taxable&quot;: entry[4],
                     &quot;count_entire_amount_spend&quot;: entry[5],
                     &quot;count_cost_basis_pnl&quot;: entry[6],
-                    &quot;accounting_treatment&quot;: TxAccountingTreatment.deserialize_from_db(
-                        entry[7]
-                    ).serialize()
+                    &quot;accounting_treatment&quot;: TxAccountingTreatment
+                    .deserialize_from_db(entry[7])
+                    .serialize()
                     if entry[7] is not None
                     else None,  # noqa: E501
                 }
</code></pre>
<p>It looks a bit funny on literals but I don't think it's worth special casing:</p>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L19'>tests/integration/api_build_test.py~L19</a></p>
<pre><code class="language-diff">         )
 
         script = io.BytesIO(
-            &quot;\n&quot;.join(
+            &quot;\n&quot;
+            .join(
                 [
                     &quot;FROM busybox&quot;,
                     'RUN env | grep &quot;FTP_PROXY=a&quot;',
</code></pre>
<p><a href='https://github.com/docker/docker-py/blob/df3f8e2abc5a03de482e37214dddef9e0cee1bb1/tests/integration/api_build_test.py#L31'>tests/integration/api_build_test.py~L31</a></p>
<pre><code class="language-diff">                     'RUN env | grep &quot;NO_PROXY=d&quot;',
                     'RUN env | grep &quot;no_proxy=d&quot;',
                 ]
-            ).encode(&quot;ascii&quot;)
+            )
+            .encode(&quot;ascii&quot;)
         )
 
         self.client.build(fileobj=script, decode=True)
</code></pre>
<p>Keeping intermediate attribute expressions on a single line instead of putting them on their own line helps reduce the diff size:</p>
<pre><code>&lt;a href='https://github.com/reflex-dev/reflex/blob/e4300adbbec62630cb3ce5c0610400788557e9b9/reflex/event.py#L1106'&gt;reflex/event.py~L1106&lt;/a&gt;
```diff
     get_element_by_id = FunctionStringVar.create(&quot;document.getElementById&quot;)
 
     return run_script(
-        get_element_by_id.call(elem_id)
+        get_element_by_id
+        .call(elem_id)
         .to(ObjectVar)
         .scrollIntoView.to(FunctionVar)
         .call(align_to_top),
</code></pre>
<p>This diff is surprising:</p>
<p><a href='https://github.com/rotki/rotki/blob/060a0009bc337350a2f82395897c0224ea7998c9/rotkehlchen/chain/ethereum/oracles/uniswap.py#L88'>rotkehlchen/chain/ethereum/oracles/uniswap.py~L88</a></p>
<pre><code class="language-diff">                         self.routing_assets[chain_id].append(
                             get_or_create_evm_token(
                                 userdb=(
-                                    node_inquirer := Inquirer()
-                                    .get_evm_manager(chain_id)
-                                    .node_inquirer
+                                    node_inquirer := Inquirer().get_evm_manager(
+                                        chain_id
+                                    ).node_inquirer
                                 ).database,  # noqa: E501
                                 evm_address=string_to_evm_address(asset.identifier.split(&quot;:&quot;)[-1]),
                                 chain_id=chain_id,
</code></pre>
<p>I overall like the changes. My only concern is that it makes the lack for good nested expression formatting more obvious but I don't think this should block landing this in preview (whether we should stabilize the change this year is a different question)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @dylwil3 on 2025-12-06 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexreinking">@alexreinking</a> on 2025-12-06 19:10</div>
            <div class="timeline-body"><p>Yeah, that last diff is pretty gory... I would have much preferred to read</p>
<pre><code class="language-diff">                         self.routing_assets[chain_id].append(
                             get_or_create_evm_token(
                                 userdb=(
-                                    node_inquirer := Inquirer()
-                                    .get_evm_manager(chain_id)
-                                    .node_inquirer
+                                    node_inquirer := (
+                                        Inquirer()
+                                        .get_evm_manager(chain_id)
+                                        .node_inquirer
+                                    )
                                 ).database,  # noqa: E501
                                 evm_address=string_to_evm_address(asset.identifier.split(&quot;:&quot;)[-1]),
                                 chain_id=chain_id,
</code></pre>
<p>But I gather this is a manifestation of #12856? I find it very hard to read call chains where the arguments to function calls or indexing expressions have been chopped down, but the chain components haven't.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-06 20:20</div>
            <div class="timeline-body"><blockquote>
<p>This diff is surprising:</p>
</blockquote>
<p>Hmmm, this is a case where somehow my new logic for when to use fluent layout <em>didn't</em> fire but the old one did. Thanks for catching that!</p>
<p>I thought my criterion was strictly weaker but maybe I did something wrong with whether we count the first call, now? I will look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-08 17:09</div>
            <div class="timeline-body"><p>I found the stable logic for determining when we should use fluent formatting difficult to follow. So before making any of the preview changes in this PR, I am prepending the following patch. Below the patch I record the argument for why this is a pure refactor and has equivalent behavior to <code>main</code>.</p>
<p>This is sort of pedantic but I'm including it because the argument is somewhat subtle - the value of <code>attributes_after_parentheses</code> (defined below) is not the same after the refactor, but the result of the function nevertheless is.</p>
<p>(I have included a larger-than-necessary patch so that you can see the whole function body).</p>
<details><summary>Unfold for the patch...</summary>

<pre><code class="language-diff">diff --git a/crates/ruff_python_formatter/src/expression/mod.rs b/crates/ruff_python_formatter/src/expression/mod.rs
index a320a1edf5..f314856cd0 100644
--- a/crates/ruff_python_formatter/src/expression/mod.rs
+++ b/crates/ruff_python_formatter/src/expression/mod.rs
@@ -895,6 +895,8 @@ impl CallChainLayout {
     pub(crate) fn from_expression(
         mut expr: ExprRef,
         comment_ranges: &amp;CommentRanges,
         source: &amp;str,
     ) -&gt; Self {
+        let mut first_attr_value_parenthesized = false;
+
         let mut attributes_after_parentheses = 0;
         loop {
             match expr {
                 ExprRef::Attribute(ast::ExprAttribute { value, .. }) =&gt; {
                     // ```
                     // f().g
                     // ^^^ value
                     // data[:100].T
                     // ^^^^^^^^^^ value
                     // ```
                     if is_expression_parenthesized(value.into(), comment_ranges, source) {
                         // `(a).b`. We preserve these parentheses so don't recurse
-                        attributes_after_parentheses += 1;
+                        first_attr_value_parenthesized = true;
                         break;
                     } else if matches!(value.as_ref(), Expr::Call(_) | Expr::Subscript(_)) {
                         attributes_after_parentheses += 1;
                     }
 
                     expr = ExprRef::from(value.as_ref());
                 }
                 // ```
                 // f()
                 // ^^^ expr
                 // ^ func
                 // data[:100]
                 // ^^^^^^^^^^ expr
                 // ^^^^ value
                 // ```
                 ExprRef::Call(ast::ExprCall { func: inner, .. })
                 | ExprRef::Subscript(ast::ExprSubscript { value: inner, .. }) =&gt; {
+                    // We preserve these parentheses so don't recurse
+                    // e.g. (a)[0].x().y().z()
+                    //         ^stop here
+                    if is_expression_parenthesized(inner.into(), comment_ranges, source) {
+                        break;
+                    }
+
                     expr = ExprRef::from(inner.as_ref());
                 }
                 _ =&gt; {
-                    // We to format the following in fluent style:
-                    // ```
-                    // f2 = (a).w().t(1,)
-                    //       ^ expr
-                    // ```
-                    if is_expression_parenthesized(expr, comment_ranges, source) {
-                        attributes_after_parentheses += 1;
-                    }
-
                     break;
                 }
             }
-
-            // We preserve these parentheses so don't recurse
-            if is_expression_parenthesized(expr, comment_ranges, source) {
-                break;
-            }
         }
-        if attributes_after_parentheses &lt; 2 {
+
+        if attributes_after_parentheses + u32::from(first_attr_value_parenthesized) &lt; 2 {
             CallChainLayout::NonFluent
         } else {
             CallChainLayout::Fluent
         }
     }
</code></pre>
</details>

<details><summary>Proof that this is a pure refactor</summary>

<p>For brevity, let's pretend that this is just a function of the expression. We will denote the version on stable by <code>stable(expr)</code> and the version after the patch as <code>refactored(expr)</code>. We claim that <code>stable(expr) == refactored(expr)</code> in all cases.</p>
<p>First let's observe that the following preliminary refactor is okay:</p>
<pre><code class="language-diff">diff --git i/crates/ruff_python_formatter/src/expression/mod.rs w/crates/ruff_python_formatter/src/expression/mod.rs
index a320a1edf5..bfd7ac41c0 100644
--- i/crates/ruff_python_formatter/src/expression/mod.rs
+++ w/crates/ruff_python_formatter/src/expression/mod.rs
@@ -895,6 +895,7 @@ impl CallChainLayout {
         comment_ranges: &amp;CommentRanges,
         source: &amp;str,
     ) -&gt; Self {
+        let mut first_attr_value_parenthesized = false;
         let mut attributes_after_parentheses = 0;
         loop {
             match expr {
@@ -907,7 +908,7 @@ impl CallChainLayout {
                     // ```
                     if is_expression_parenthesized(value.into(), comment_ranges, source) {
                         // `(a).b`. We preserve these parentheses so don't recurse
-                        attributes_after_parentheses += 1;
+                        first_attr_value_parenthesized = true;
                         break;
                     } else if matches!(value.as_ref(), Expr::Call(_) | Expr::Subscript(_)) {
                         attributes_after_parentheses += 1;
@@ -946,7 +947,7 @@ impl CallChainLayout {
                 break;
             }
         }
-        if attributes_after_parentheses &lt; 2 {
+        if attributes_after_parentheses + u32::from(first_attr_value_parenthesized) &lt; 2 {
             CallChainLayout::NonFluent
         } else {
             CallChainLayout::Fluent
</code></pre>
<p>Indeed: we break immediately after this accumulation, so we add that <code>1</code> if and only if <code>first_attr_value_parenthesized</code> is true at the end.</p>
<p>Next, consider the clause <em>after</em> the match arm in <code>stable</code> that's given by:</p>
<pre><code class="language-rust">            // We preserve these parentheses so don't recurse
            if is_expression_parenthesized(expr, comment_ranges, source) {
                break;
            }
</code></pre>
<p>I claim that this is only reachable from the <code>Call | Subscript</code> match arm. Indeed: the last match arm breaks at the end, so we must have come from one of the first two arms. But if we came from the first arm, then the <code>expr</code> we are evaluating in that clause is actually the <code>value</code> in an expression of the form <code>value.attr</code>. So our <code>expr</code> is parenthesized if and only if <code>value</code> is parenthesized. But then observe that we would have <em>already</em> broken the loop at this line:</p>
<pre><code class="language-rust">                     if is_expression_parenthesized(value.into(), comment_ranges, source) {
                         // `(a).b`. We preserve these parentheses so don't recurse
                         attributes_after_parentheses += 1;
                         break;
                     }
</code></pre>
<p>It is therefore a pure refactor to move the clause</p>
<pre><code class="language-rust">            // We preserve these parentheses so don't recurse
            if is_expression_parenthesized(expr, comment_ranges, source) {
                break;
            }
</code></pre>
<p>inside the match arm for <code>Call | Subscript</code>.</p>
<p>It remains to show that this deletion is a pure refactor <em>given the previous refactors</em>:</p>
<pre><code class="language-diff">                 _ =&gt; {
-                    // We to format the following in fluent style:
-                    // ```
-                    // f2 = (a).w().t(1,)
-                    //       ^ expr
-                    // ```
-                    if is_expression_parenthesized(expr, comment_ranges, source) {
-                        attributes_after_parentheses += 1;
-                    }
-
                     break;
                 }
             }
</code></pre>
<p>First suppose that <code>expr</code> is not an attribute, not a call, and not a subscript. Then the implementation for <code>stable</code> hits the last match arm, adds at most <code>1</code> to <code>attributes_after_parentheses</code>, and then breaks. So <code>stable(expr)</code> must be <code>NonFluent</code>. On the other hand, <code>refactored</code> immediately breaks with <code>attributes_after_parentheses == 0</code> and we also get <code>NonFluent</code> as the result. (Note that the clause is not actually <em>unreachable</em> here, it's just that it doesn't change the outcome!)</p>
<p>In the remaining cases, we could only be hitting this last match arm <em>after</em> having looped once. Thus the <code>expr</code> being checked for parentheses must be obtained as <code>inner</code> or <code>value</code> from the previous iteration (with notation as in the body of the function). But then, if <code>inner</code>/<code>value</code> has parentheses, we would have <em>already</em> broken the loop by the end of the previous iteration. Thus, in these remaining cases, this clause is actually unreachable and can be deleted.</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-12-08 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-08 19:37</div>
            <div class="timeline-body"><p>Ready for the actual implementation to be reviewed now. I also cleaned up the commit history so you should be able to review commit by commit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:1041 on 2025-12-08 19:38</div>
            <div class="timeline-body"><p>This inefficient break-down of the conditions is just so that it'll be very easy to edit the function when it comes time to stabilize.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-08 19:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-08 19:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>docs/formatter.md</code>:568 on 2025-12-08 19:46</div>
            <div class="timeline-body"><p>This is probably too much detail for user-facing docs? Maybe I can just add this to the PR summary and link to it here instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@parentheses__call_chains.py.snap</code>:620 on 2025-12-08 21:20</div>
            <div class="timeline-body"><p>We should add dedicated tests for this new feature that also capture some of the tricky cases we've seen in the ecosystem results (e.g. the one regression I caught). We should also add tests for different comment placements (are there cases where the new layout should be skipped if comments are present?)</p>
<p>and we should also test <em>Why do we apply fluent formatting in a few more examples?</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/preview.rs</code>:68 on 2025-12-08 21:24</div>
            <div class="timeline-body"><p>I don't think we need two preview toggles unless you see a situation where we only stabilize one but not the other?</p>
<p>However, given the large ecosystem change, I'd find it useful to split <code>is_fluent_layout_more_often_enabled</code> into its own PR so we can review the ecosystem impact separately from method chain formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:924 on 2025-12-08 21:25</div>
            <div class="timeline-body"><p>Can we document what <code>u32</code> stores?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/expr_attribute.rs</code>:202 on 2025-12-09 08:54</div>
            <div class="timeline-body"><p>I think i would change <code>from_expression</code> to take <code>context</code> to reduce the number of arguments. We almost always have access to context, and, if not, it's normally very easy to get access to <code>context</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:894 on 2025-12-09 09:37</div>
            <div class="timeline-body"><p>Very likely a non native speaker issue but summand confused me, given that we aren't adding anything in the example right above this comment. I think we should either repeat the entire example or reduce the comment to only mention that this is the formatted output but expand the comment with what the tracked position is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:934 on 2025-12-09 09:37</div>
            <div class="timeline-body"><p>Nit: From reading the call sites, I didn't expect this function to compute any new state.</p>
<p>Maybe: add_call_like_attribute(self). It might also be worth adding a #[must_use]. Same for after_attribute</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:955 on 2025-12-09 09:38</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code class="language-suggestion">                if let Some(x) = x.checked_sub(1) {
                    Self::Fluent(AttributeState::CallsOrSubscriptsPreceding(x))
                } else {
                    Self::Fluent(AttributeState::FirstCallOrSubscript)
                }
</code></pre>
<p>I don't think I understand why we subtract here. if so, I'd expected we add one. Would you mind adding some documentation explaining the logic here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:997 on 2025-12-09 09:44</div>
            <div class="timeline-body"><p>Why aren't we adding incrementing <code>call_like_count</code> in this branch? It might help to give <code>was_in_call_like</code> a more specific name or document its purpose when declaring the variable.</p>
<p>Is there even an instance where we don't increment <code>call_like_count</code>? To me, it seems we always increment it in the next iteration so that we could move the increment here instead of tracking <code>was_in_call_like</code> because the value only becomes <code>true</code> in this branch, we reset it in all other branches (by setting it to <code>false</code> or <code>break</code>ing), and setting <code>expr</code> to <code>inner</code> guarantees that we always do one additional round around the loop.</p>
<p>The only exception to this seems to be if <code>inner</code> is a <code>Subscript</code> or <code>Call</code> itself, in which case we don't increment. But the logic is easier to follow if we inline this check in this branch and add a comment of why we don't increment in that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:977 on 2025-12-09 09:50</div>
            <div class="timeline-body"><p>I wonder if we could move more logic into the <code>Call</code> / <code>Subscript</code> branch if we instead track <code>after_attribute</code> as a boolean, saying whether we're inspecting an attribute's value (which we always reset except if it is an attribute expression)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:1033 on 2025-12-09 09:55</div>
            <div class="timeline-body"><p>I'd find it useful to have some examples of when we're hitting those branches. What does <code>call_like_count + u32::from(first_attr_value_parenthesized) &lt; 2)</code> mean?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:1041 on 2025-12-09 09:57</div>
            <div class="timeline-body"><p>I think a less awkward way of writing this would be:</p>
<pre><code class="language-rust">let something_something_count = if is_fluent...() { call_like_count } else { attributes_after_parentheses };

if something_something_count + u32::from(first_attr_value_parenthesized) &lt; 2 {
      CallChainLayout::NonFluent
  } else {
	CallChainLayout::Fluent(AttributeState::CallsOrSubscriptsPreceding(call_like_count))
  }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__split_empty_brackets.py.snap</code>:214 on 2025-12-09 09:59</div>
            <div class="timeline-body"><p>This is an instance where the new formatting looks worse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>docs/formatter.md</code>:568 on 2025-12-09 10:00</div>
            <div class="timeline-body"><p>Agree. This might be a better fit for <code>formatter/black.md</code> where we document deviations</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2025-12-09 10:09</div>
            <div class="timeline-body"><p>This is great. Indeed, the change is surprisingly simple. I'm left with some concern that the new formatting makes the lack for better nested expression formatting, specifically in binary expressions, more prevalant, making overall formatting look worse in some instances. Hopefully, we'll get some preview feedback to make up our minds. I think it would also be great to run the new version against pyx and open a PR in that repo to get some dogfooding feedback.</p>
<p>What I miss in this PR and why I'm requesting changes are dedicated tests that document the design decisions (e.g. that we split off <code>np.</code>), test edge cases, and regressions that we found in the ecosystem reports. E.g. how parenthesized expressions are handled, how we split subsequent attribute chains after the first call expression etc.</p>
<blockquote>
<p>The second modification fell out of the implementation, but it appears to fix some counterintuitive behavior present on main. If there is some justification for that choice, I can change it back. We could also make it a separate PR. It has to do with when we decide to use fluent formatting in the first place. A specific example would be this, again with line-length=8:</p>
</blockquote>
<p>Did you mean to write <code>x = a().b().c()</code> because your example requires method-chaining, which isn't enabled on main?</p>
<p>I suggest splitting this change into its own PR because I find it impossible to trace any ecosystem changes back to this particular change, making it difficult for me to judge whether it is an improvement. We should also add dedicated tests for this change, to prevent future regressions (or having to run the ecosystem check to catch the regressions).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-12 15:29</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Formatter (stable)</h3>
<p>‚úÖ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected format changes</strong>. (+2948 -1526 lines in 441 files in 27 projects; 28 projects unchanged)</p>
<details><summary><a href="https://github.com/DisnakeDev/disnake">DisnakeDev/disnake</a> (+2 -1 lines across 1 file)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href='https://github.com/DisnakeDev/disnake/blob/394227ce57cc5245784c2125f5689cdc68a675c1/disnake/http.py#L1924'>disnake/http.py~L1924</a></p>
<pre><code class="language-diff"> 
     def widget_image_url(self, guild_id: Snowflake, *, style: str) -&gt; str:
         return str(
-            yarl.URL(Route.BASE)
+            yarl
+            .URL(Route.BASE)
             .with_path(f&quot;/api/guilds/{guild_id}/widget.png&quot;)
             .with_query(style=style)
         )
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+36 -18 lines across 7 files)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/cli/scaffold.py#L54'>rasa/cli/scaffold.py~L54</a></p>
<pre><code class="language-diff">     print_success(&quot;Finished creating project structure.&quot;)
 
     should_train = (
-        questionary.confirm(&quot;Do you want to train an initial model? üí™üèΩ&quot;)
+        questionary
+        .confirm(&quot;Do you want to train an initial model? üí™üèΩ&quot;)
         .skip_if(args.no_prompt, default=True)
         .ask()
     )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/cli/scaffold.py#L83'>rasa/cli/scaffold.py~L83</a></p>
<pre><code class="language-diff">     import questionary
 
     should_run = (
-        questionary.confirm(
+        questionary
+        .confirm(
             &quot;Do you want to speak to the trained assistant on the command line? ü§ñ&quot;
         )
         .skip_if(args.no_prompt, default=False)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/cli/scaffold.py#L206'>rasa/cli/scaffold.py~L206</a></p>
<pre><code class="language-diff">         path = args.init_dir
     else:
         path = (
-            questionary.text(
+            questionary
+            .text(
                 &quot;Please enter a path where the project will be &quot;
                 &quot;created [default: current directory]&quot;
             )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/test.py#L500'>rasa/core/test.py~L500</a></p>
<pre><code class="language-diff">     # the response selector contains a &quot;default&quot; key
     if RESPONSE_SELECTOR_DEFAULT_INTENT in response_selector:
         full_retrieval_intent = (
-            response_selector.get(RESPONSE_SELECTOR_DEFAULT_INTENT, {})
+            response_selector
+            .get(RESPONSE_SELECTOR_DEFAULT_INTENT, {})
             .get(RESPONSE, {})
             .get(INTENT_RESPONSE_KEY)
         )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/test.py#L508'>rasa/core/test.py~L508</a></p>
<pre><code class="language-diff"> 
     # if specified, the response selector contains the base intent as key
     full_retrieval_intent = (
-        response_selector.get(base_intent, {})
+        response_selector
+        .get(base_intent, {})
         .get(RESPONSE, {})
         .get(INTENT_RESPONSE_KEY)
     )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/tracker_store.py#L1013'>rasa/core/tracker_store.py~L1013</a></p>
<pre><code class="language-diff"> 
     if is_postgresql_url(engine.url):
         query = sa.exists(
-            sa.select([(sa.text(&quot;schema_name&quot;))])
+            sa
+            .select([(sa.text(&quot;schema_name&quot;))])
             .select_from(sa.text(&quot;information_schema.schemata&quot;))
             .where(sa.text(f&quot;schema_name = '{schema_name}'&quot;))
         )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/tracker_store.py#L1199'>rasa/core/tracker_store.py~L1199</a></p>
<pre><code class="language-diff">         conn = engine.connect()
 
         matching_rows = (
-            conn.execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
+            conn
+            .execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
             .execute(
                 sa.text(
                     &quot;SELECT 1 FROM pg_catalog.pg_database &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/core/tracker_store.py#L1298'>rasa/core/tracker_store.py~L1298</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;
         # Subquery to find the timestamp of the latest `SessionStarted` event
         session_start_sub_query = (
-            session.query(sa.func.max(self.SQLEvent.timestamp).label(&quot;session_start&quot;))
+            session
+            .query(sa.func.max(self.SQLEvent.timestamp).label(&quot;session_start&quot;))
             .filter(
                 self.SQLEvent.sender_id == sender_id,
                 self.SQLEvent.type_name == SessionStarted.type_name,
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/utils/io.py#L347'>rasa/shared/utils/io.py~L347</a></p>
<pre><code class="language-diff">     if _is_ascii(content):
         # Required to make sure emojis are correctly parsed
         content = (
-            content.encode(&quot;utf-8&quot;)
+            content
+            .encode(&quot;utf-8&quot;)
             .decode(&quot;raw_unicode_escape&quot;)
             .encode(&quot;utf-16&quot;, &quot;surrogatepass&quot;)
             .decode(&quot;utf-16&quot;)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/integration_tests/core/test_tracker_store.py#L46'>tests/integration_tests/core/test_tracker_store.py~L46</a></p>
<pre><code class="language-diff">     )
 
     matching_rows = (
-        postgres_login_db_connection.execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
+        postgres_login_db_connection
+        .execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
         .execute(
             sa.text(
                 &quot;SELECT 1 FROM pg_catalog.pg_database WHERE datname = :database_name&quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/integration_tests/core/test_tracker_store.py#L80'>tests/integration_tests/core/test_tracker_store.py~L80</a></p>
<pre><code class="language-diff">     )
 
     matching_rows = (
-        postgres_login_db_connection.execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
+        postgres_login_db_connection
+        .execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
         .execute(
             sa.text(
                 &quot;SELECT 1 FROM pg_catalog.pg_database WHERE datname = :database_name&quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/integration_tests/core/test_tracker_store.py#L132'>tests/integration_tests/core/test_tracker_store.py~L132</a></p>
<pre><code class="language-diff">         for record in caplog.records
     ])
     matching_rows = (
-        postgres_login_db_connection.execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
+        postgres_login_db_connection
+        .execution_options(isolation_level=&quot;AUTOCOMMIT&quot;)
         .execute(
             sa.text(
                 &quot;SELECT 1 FROM pg_catalog.pg_database WHERE datname = :database_name&quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/nlu/classifiers/test_diet_classifier.py#L879'>tests/nlu/classifiers/test_diet_classifier.py~L879</a></p>
<pre><code class="language-diff">                             # expected to change can be compared directly
                             assert (
                                 feature_signature.units
-                                == old_signature.get(attribute)
+                                == old_signature
+                                .get(attribute)
                                 .get(feature_type)[index]
                                 .units
                             )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/nlu/selectors/test_selectors.py#L196'>tests/nlu/selectors/test_selectors.py~L196</a></p>
<pre><code class="language-diff">         classified_message.get(&quot;response_selector&quot;).get(&quot;all_retrieval_intents&quot;)
     ) == [&quot;chitchat&quot;]
     assert (
-        classified_message.get(&quot;response_selector&quot;)
+        classified_message
+        .get(&quot;response_selector&quot;)
         .get(&quot;default&quot;)
         .get(&quot;response&quot;)
         .get(&quot;intent_response_key&quot;)
     ) is not None
     assert (
-        classified_message.get(&quot;response_selector&quot;)
+        classified_message
+        .get(&quot;response_selector&quot;)
         .get(&quot;default&quot;)
         .get(&quot;response&quot;)
         .get(&quot;utter_action&quot;)
     ) is not None
     assert (
-        classified_message.get(&quot;response_selector&quot;)
+        classified_message
+        .get(&quot;response_selector&quot;)
         .get(&quot;default&quot;)
         .get(&quot;response&quot;)
         .get(&quot;responses&quot;)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/nlu/selectors/test_selectors.py#L638'>tests/nlu/selectors/test_selectors.py~L638</a></p>
<pre><code class="language-diff">     unfeaturized_message = Message(data={TEXT: message_text})
     classified_message = response_selector.process([unfeaturized_message])[0]
     output = (
-        classified_message.get(RESPONSE_SELECTOR_PROPERTY_NAME)
+        classified_message
+        .get(RESPONSE_SELECTOR_PROPERTY_NAME)
         .get(RESPONSE_SELECTOR_DEFAULT_INTENT)
         .get(RESPONSE_SELECTOR_PREDICTION_KEY)
     )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/tests/nlu/selectors/test_selectors.py#L797'>tests/nlu/selectors/test_selectors.py~L797</a></p>
<pre><code class="language-diff">                             # expected to change can be compared directly
                             assert (
                                 feature_signature.units
-                                == old_signature.get(attribute)
+                                == old_signature
+                                .get(attribute)
                                 .get(feature_type)[index]
                                 .units
                             )
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/Snowflake-Labs/snowcli">Snowflake-Labs/snowcli</a> (+12 -6 lines across 2 files)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/e552f2d07ba4d499e59092608e17e785f2a612a9/tests/app/test_telemetry.py#L52'>tests/app/test_telemetry.py~L52</a></p>
<pre><code class="language-diff">     assert result.exit_code == 0, result.output
     # The method is called with a TelemetryData type, so we cast it to dict for simpler comparison
     usage_command_event = (
-        mock_conn.return_value._telemetry.try_add_log_to_batch.call_args_list[  # noqa: SLF001
+        mock_conn.return_value._telemetry.try_add_log_to_batch
+        .call_args_list[  # noqa: SLF001
             0
         ]
         .args[0]
</code></pre>
<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/e552f2d07ba4d499e59092608e17e785f2a612a9/tests/app/test_telemetry.py#L109'>tests/app/test_telemetry.py~L109</a></p>
<pre><code class="language-diff">     assert result.exit_code == 0, result.output
     # The method is called with a TelemetryData type, so we cast it to dict for simpler comparison
     usage_command_event = (
-        mock_conn.return_value._telemetry.try_add_log_to_batch.call_args_list[  # noqa: SLF001
+        mock_conn.return_value._telemetry.try_add_log_to_batch
+        .call_args_list[  # noqa: SLF001
             0
         ]
         .args[0]
</code></pre>
<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/e552f2d07ba4d499e59092608e17e785f2a612a9/tests/app/test_telemetry.py#L140'>tests/app/test_telemetry.py~L140</a></p>
<pre><code class="language-diff"> 
     # The method is called with a TelemetryData type, so we cast it to dict for simpler comparison
     result_command_event = (
-        mock_conn.return_value._telemetry.try_add_log_to_batch.call_args_list[  # noqa: SLF001
+        mock_conn.return_value._telemetry.try_add_log_to_batch
+        .call_args_list[  # noqa: SLF001
             1
         ]
         .args[0]
</code></pre>
<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/e552f2d07ba4d499e59092608e17e785f2a612a9/tests/app/test_telemetry.py#L181'>tests/app/test_telemetry.py~L181</a></p>
<pre><code class="language-diff"> 
     # The method is called with a TelemetryData type, so we cast it to dict for simpler comparison
     result_command_event = (
-        mock_conn.return_value._telemetry.try_add_log_to_batch.call_args_list[  # noqa: SLF001
+        mock_conn.return_value._telemetry.try_add_log_to_batch
+        .call_args_list[  # noqa: SLF001
             1
         ]
         .args[0]
</code></pre>
<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/e552f2d07ba4d499e59092608e17e785f2a612a9/tests/app/test_telemetry.py#L233'>tests/app/test_telemetry.py~L233</a></p>
<pre><code class="language-diff">     assert result.exit_code == 0, result.output
 
     usage_command_event = (
-        mock_connect.return_value._telemetry.try_add_log_to_batch.call_args_list[  # noqa: SLF001
+        mock_connect.return_value._telemetry.try_add_log_to_batch
+        .call_args_list[  # noqa: SLF001
             0
         ]
         .args[0]
</code></pre>
<p><a href='https://github.com/Snowflake-Labs/snowcli/blob/e552f2d07ba4d499e59092608e17e785f2a612a9/tests_e2e/conftest.py#L44'>tests_e2e/conftest.py~L44</a></p>
<pre><code class="language-diff">         return None
     text = &quot;\n&quot;.join(line.rstrip() for line in text.splitlines())
     return (
-        text.replace(&quot;‚îÇ&quot;, &quot;|&quot;)
+        text
+        .replace(&quot;‚îÇ&quot;, &quot;|&quot;)
         .replace(&quot;‚îÄ&quot;, &quot;-&quot;)
         .replace(&quot;‚ï≠&quot;, &quot;+&quot;)
         .replace(&quot;‚ï∞&quot;, &quot;+&quot;)
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+236 -120 lines across 28 files)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/api_fastapi/core_api/routes/public/xcom.py#L157'>airflow-core/src/airflow/api_fastapi/core_api/routes/public/xcom.py~L157</a></p>
<pre><code class="language-diff">     if dag_id != &quot;~&quot;:
         query = query.where(XComModel.dag_id == dag_id)
     query = (
-        query.join(DR, and_(XComModel.dag_id == DR.dag_id, XComModel.run_id == DR.run_id))
+        query
+        .join(DR, and_(XComModel.dag_id == DR.dag_id, XComModel.run_id == DR.run_id))
         .join(DagModel, DR.dag_id == DagModel.dag_id)
         .options(joinedload(XComModel.task), joinedload(XComModel.dag_run).joinedload(DR.dag_model))
     )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/api_fastapi/core_api/routes/ui/dags.py#L168'>airflow-core/src/airflow/api_fastapi/core_api/routes/ui/dags.py~L168</a></p>
<pre><code class="language-diff">         select(
             DagRun.dag_id,
             DagRun.run_after,
-            func.rank()
+            func
+            .rank()
             .over(
                 partition_by=DagRun.dag_id,
                 order_by=DagRun.run_after.desc(),
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/api_fastapi/core_api/services/public/task_instances.py#L431'>airflow-core/src/airflow/api_fastapi/core_api/services/public/task_instances.py~L431</a></p>
<pre><code class="language-diff"> 
                 for dag_id, run_id, task_id, map_index in matched_task_keys:
                     ti = (
-                        self.session.execute(
+                        self.session
+                        .execute(
                             select(TI).where(
                                 TI.dag_id == dag_id,
                                 TI.run_id == run_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/jobs/scheduler_job_runner.py#L1761'>airflow-core/src/airflow/jobs/scheduler_job_runner.py~L1761</a></p>
<pre><code class="language-diff">         # This list is used to verify if the DagRun already exist so that we don't attempt to create
         # duplicate DagRuns
         existing_dagruns = (
-            session.execute(
+            session
+            .execute(
                 select(DagRun.dag_id, DagRun.logical_date).where(
                     tuple_(DagRun.dag_id, DagRun.logical_date).in_(
                         (dm.dag_id, dm.next_dagrun) for dm in dag_models
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/jobs/scheduler_job_runner.py#L2443'>airflow-core/src/airflow/jobs/scheduler_job_runner.py~L2443</a></p>
<pre><code class="language-diff">     def _emit_ti_metrics(self, session: Session = NEW_SESSION) -&gt; None:
         metric_states = {State.SCHEDULED, State.QUEUED, State.RUNNING, State.DEFERRED}
         all_states_metric = (
-            session.query(
+            session
+            .query(
                 TaskInstance.state,
                 TaskInstance.dag_id,
                 TaskInstance.task_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/jobs/triggerer_job_runner.py#L605'>airflow-core/src/airflow/jobs/triggerer_job_runner.py~L605</a></p>
<pre><code class="language-diff">         render_log_fname = log_filename_template_renderer()
 
         known_trigger_ids = (
-            self.running_triggers.union(x[0] for x in self.events)
+            self.running_triggers
+            .union(x[0] for x in self.events)
             .union(self.cancelling_triggers)
             .union(trigger[0] for trigger in self.failed_triggers)
             .union(trigger.id for trigger in self.creating_triggers)
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/migrations/versions/0092_3_2_0_replace_deadline_inline_callback_with_fkey.py#L105'>airflow-core/src/airflow/migrations/versions/0092_3_2_0_replace_deadline_inline_callback_with_fkey.py~L105</a></p>
<pre><code class="language-diff"> 
         conn.execute(callback_table.insert(), callback_inserts)
         conn.execute(
-            deadline_table.update()
+            deadline_table
+            .update()
             .where(deadline_table.c.id == sa.bindparam(&quot;deadline_id&quot;))
             .values(callback_id=sa.bindparam(&quot;callback_id&quot;), missed=sa.bindparam(&quot;missed&quot;)),
             deadline_updates,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/src/airflow/migrations/versions/0092_3_2_0_replace_deadline_inline_callback_with_fkey.py#L244'>airflow-core/src/airflow/migrations/versions/0092_3_2_0_replace_deadline_inline_callback_with_fkey.py~L244</a></p>
<pre><code class="language-diff">                 raise
 
         conn.execute(
-            deadline_table.update()
+            deadline_table
+            .update()
             .where(deadline_table.c.id == sa.bindparam(&quot;deadline_id&quot;))
             .values(
                 callback=sa.bindparam(&quot;callback&quot;),
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/api_fastapi/core_api/routes/public/test_task_instances.py#L830'>airflow-core/tests/unit/api_fastapi/core_api/routes/public/test_task_instances.py~L830</a></p>
<pre><code class="language-diff">         self, test_client, session, params, expected_map_indexes, one_task_with_many_mapped_tis
     ):
         ti = (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .where(TaskInstance.task_id == &quot;task_2&quot;, TaskInstance.map_index == 0)
             .first()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/api_fastapi/core_api/routes/public/test_task_instances.py#L3461'>airflow-core/tests/unit/api_fastapi/core_api/routes/public/test_task_instances.py~L3461</a></p>
<pre><code class="language-diff">         )
 
         logs = (
-            session.query(Log)
+            session
+            .query(Log)
             .filter(Log.dag_id == dag_id, Log.run_id == dag_run_id, Log.event == event)
             .count()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/dag_processing/test_collection.py#L658'>airflow-core/tests/unit/dag_processing/test_collection.py~L658</a></p>
<pre><code class="language-diff">         )
 
         import_error = (
-            session.query(ParseImportError)
+            session
+            .query(ParseImportError)
             .filter(ParseImportError.filename == filename, ParseImportError.bundle_name == bundle_name)
             .one()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/dag_processing/test_manager.py#L482'>airflow-core/tests/unit/dag_processing/test_manager.py~L482</a></p>
<pre><code class="language-diff">         manager._file_stats[test_dag_path] = stat
 
         active_dag_count = (
-            session.query(func.count(DagModel.dag_id))
+            session
+            .query(func.count(DagModel.dag_id))
             .filter(
                 ~DagModel.is_stale,
                 DagModel.relative_fileloc == str(test_dag_path.rel_path),
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/dag_processing/test_manager.py#L495'>airflow-core/tests/unit/dag_processing/test_manager.py~L495</a></p>
<pre><code class="language-diff">         manager._scan_stale_dags()
 
         active_dag_count = (
-            session.query(func.count(DagModel.dag_id))
+            session
+            .query(func.count(DagModel.dag_id))
             .filter(
                 ~DagModel.is_stale,
                 DagModel.relative_fileloc == str(test_dag_path.rel_path),
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/dag_processing/test_manager.py#L506'>airflow-core/tests/unit/dag_processing/test_manager.py~L506</a></p>
<pre><code class="language-diff">         assert active_dag_count == 0
 
         serialized_dag_count = (
-            session.query(func.count(SerializedDagModel.dag_id))
+            session
+            .query(func.count(SerializedDagModel.dag_id))
             .filter(SerializedDagModel.dag_id == dag.dag_id)
             .scalar()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L1398'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L1398</a></p>
<pre><code class="language-diff">             )
 
         assert (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(TaskInstance.dag_id == dag_id, TaskInstance.state == State.SCHEDULED)
             .count()
             == 1
         )
         assert (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(TaskInstance.dag_id == dag_id, TaskInstance.state == State.QUEUED)
             .count()
             == 1
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3159'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L3159</a></p>
<pre><code class="language-diff">             self.job_runner._do_scheduling(session)
 
         callback = (
-            session.query(DbCallbackRequest)
+            session
+            .query(DbCallbackRequest)
             .order_by(DbCallbackRequest.id.desc())
             .first()
             .get_callback_request()
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3341'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L3341</a></p>
<pre><code class="language-diff"> 
         # Verify the task instance was created
         initial_tis = (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(TaskInstance.dag_id == dag_id, TaskInstance.task_id == &quot;dummy&quot;)
             .all()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3370'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L3370</a></p>
<pre><code class="language-diff"> 
         # Verify no new task instances were created for the removed task in the new dagrun
         new_tis = (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(
                 TaskInstance.dag_id == dag_id,
                 TaskInstance.task_id == &quot;dummy&quot;,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3791'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L3791</a></p>
<pre><code class="language-diff">         assert len(task_instances_list) == 2
 
         ti0 = (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(TaskInstance.task_id == &quot;test_scheduler_verify_priority_and_slots_t0&quot;)
             .first()
         )
         assert ti0.state == State.SCHEDULED
 
         ti1 = (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(TaskInstance.task_id == &quot;test_scheduler_verify_priority_and_slots_t1&quot;)
             .first()
         )
         assert ti1.state == State.QUEUED
 
         ti2 = (
-            session.query(TaskInstance)
+            session
+            .query(TaskInstance)
             .filter(TaskInstance.task_id == &quot;test_scheduler_verify_priority_and_slots_t2&quot;)
             .first()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3843'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L3843</a></p>
<pre><code class="language-diff">         session.flush()
 
         tis_count = (
-            session.query(func.count(TaskInstance.task_id))
+            session
+            .query(func.count(TaskInstance.task_id))
             .filter(
                 TaskInstance.dag_id == dr.dag_id,
                 TaskInstance.logical_date == dr.logical_date,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3913'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L3913</a></p>
<pre><code class="language-diff"> 
         if SQLALCHEMY_V_1_4:
             tis_count = (
-                session.query(func.count(TaskInstance.task_id))
+                session
+                .query(func.count(TaskInstance.task_id))
                 .filter(
                     TaskInstance.dag_id == dr.dag_id,
                     TaskInstance.logical_date == dr.logical_date,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L4012'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L4012</a></p>
<pre><code class="language-diff">         do_schedule()
         with create_session() as session:
             ti = (
-                session.query(TaskInstance)
+                session
+                .query(TaskInstance)
                 .filter(
                     TaskInstance.dag_id == &quot;test_retry_still_in_executor&quot;,
                     TaskInstance.task_id == &quot;test_retry_handling_op&quot;,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5016'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5016</a></p>
<pre><code class="language-diff"> 
         def complete_one_dagrun():
             ti = (
-                session.query(TaskInstance)
+                session
+                .query(TaskInstance)
                 .join(TaskInstance.dag_run)
                 .filter(TaskInstance.state != State.SUCCESS)
                 .order_by(DagRun.logical_date)
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5156'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5156</a></p>
<pre><code class="language-diff">         session.flush()
 
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(DagRun.dag_id == &quot;test_dag1&quot;, DagRun.state == State.RUNNING)
             .scalar()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5199'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5199</a></p>
<pre><code class="language-diff">         session.flush()
 
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(DagRun.dag_id == &quot;test_dag1&quot;, DagRun.state == State.RUNNING)
             .scalar()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5219'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5219</a></p>
<pre><code class="language-diff">             dag_run_conf={},
         )
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(DagRun.dag_id == &quot;test_dag1&quot;, DagRun.state == State.RUNNING)
             .scalar()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5233'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5233</a></p>
<pre><code class="language-diff">         self.job_runner._start_queued_dagruns(session)
         session.flush()
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag1_dag_id,
                 DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5250'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5250</a></p>
<pre><code class="language-diff">         self.job_runner._start_queued_dagruns(session)
         session.flush()
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag1_dag_id,
                 DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5300'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5300</a></p>
<pre><code class="language-diff">         session.flush()
 
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(DagRun.dag_id == &quot;test_dag1&quot;, DagRun.state == State.RUNNING)
             .scalar()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5328'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5328</a></p>
<pre><code class="language-diff">         self.job_runner._start_queued_dagruns(session)
         session.flush()
         dag1_running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag1_dag_id,
                 DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5363'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5363</a></p>
<pre><code class="language-diff"> 
         def _running_counts():
             dag1_non_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5372'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5372</a></p>
<pre><code class="language-diff">                 .scalar()
             )
             dag1_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5479'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5479</a></p>
<pre><code class="language-diff"> 
         def _running_counts():
             dag1_non_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5488'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5488</a></p>
<pre><code class="language-diff">                 .scalar()
             )
             dag1_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5586'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5586</a></p>
<pre><code class="language-diff"> 
         def _running_counts():
             dag1_non_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5595'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5595</a></p>
<pre><code class="language-diff">                 .scalar()
             )
             dag1_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5735'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5735</a></p>
<pre><code class="language-diff"> 
         def _running_counts():
             dag1_non_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5744'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5744</a></p>
<pre><code class="language-diff">                 .scalar()
             )
             dag1_b_running = (
-                session.query(func.count(DagRun.id))
+                session
+                .query(func.count(DagRun.id))
                 .filter(
                     DagRun.dag_id == dag1_dag_id,
                     DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5826'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5826</a></p>
<pre><code class="language-diff">         )
 
         queued_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag_id,
                 DagRun.state == State.QUEUED,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5846'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5846</a></p>
<pre><code class="language-diff"> 
         # No runs should be started because we couldn't acquire the lock
         running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag_id,
                 DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5860'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5860</a></p>
<pre><code class="language-diff">         session.flush()
 
         running_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag_id,
                 DagRun.state == State.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L5870'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L5870</a></p>
<pre><code class="language-diff">         )
         assert running_count == backfill_max_active_runs
         queued_count = (
-            session.query(func.count(DagRun.id))
+            session
+            .query(func.count(DagRun.id))
             .filter(
                 DagRun.dag_id == dag_id,
                 DagRun.state == State.QUEUED,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L6208'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L6208</a></p>
<pre><code class="language-diff">         self.job_runner._create_dag_runs([orm_dag], session)
 
         drs = (
-            session.query(DagRun)
+            session
+            .query(DagRun)
             .options(joinedload(DagRun.task_instances).joinedload(TaskInstance.dag_version))
             .all()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L6732'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L6732</a></p>
<pre><code class="language-diff">         # Check catchup worked correctly by ensuring logical_date is quite new
         # Our dag is a daily dag
         assert (
-            session.query(DagRun.logical_date)
+            session
+            .query(DagRun.logical_date)
             .filter(DagRun.logical_date != DEFAULT_DATE)  # exclude the first run
             .scalar()
         ) &gt; (timezone.utcnow() - timedelta(days=2))
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L7927'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L7927</a></p>
<pre><code class="language-diff"> 
         # Verify we have 1 running and 1 queued
         running_count = (
-            session.query(DagRun)
+            session
+            .query(DagRun)
             .filter(DagRun.dag_id == dag.dag_id, DagRun.state == DagRunState.RUNNING)
             .count()
         )
         queued_count = (
-            session.query(DagRun)
+            session
+            .query(DagRun)
             .filter(DagRun.dag_id == dag.dag_id, DagRun.state == DagRunState.QUEUED)
             .count()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/jobs/test_scheduler_job.py#L7960'>airflow-core/tests/unit/jobs/test_scheduler_job.py~L7960</a></p>
<pre><code class="language-diff"> 
         # Verify we now have 2 running dag runs
         running_count = (
-            session.query(DagRun)
+            session
+            .query(DagRun)
             .filter(DagRun.dag_id == dag.dag_id, DagRun.state == DagRunState.RUNNING)
             .count()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/models/test_dag.py#L701'>airflow-core/tests/unit/models/test_dag.py~L701</a></p>
<pre><code class="language-diff">         assert [x.dag_id for x in asset1_orm.scheduled_dags] == [dag_id1]
         assert [(x.task_id, x.dag_id) for x in asset1_orm.producing_tasks] == [(task_id, dag_id2)]
         assert set(
-            session.query(
+            session
+            .query(
                 TaskOutletAssetReference.task_id,
                 TaskOutletAssetReference.dag_id,
                 TaskOutletAssetReference.asset_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/models/test_dag.py#L731'>airflow-core/tests/unit/models/test_dag.py~L731</a></p>
<pre><code class="language-diff">         asset2_orm = stored_assets[a2.uri]
         assert [x.dag_id for x in asset1_orm.scheduled_dags] == []
         assert set(
-            session.query(
+            session
+            .query(
                 TaskOutletAssetReference.task_id,
                 TaskOutletAssetReference.dag_id,
                 TaskOutletAssetReference.asset_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/models/test_dag.py#L2516'>airflow-core/tests/unit/models/test_dag.py~L2516</a></p>
<pre><code class="language-diff"> 
     def get_ti_from_db(task):
         return (
-            session.query(TI)
+            session
+            .query(TI)
             .filter(
                 TI.dag_id == dag.dag_id,
                 TI.task_id == task.task_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/models/test_dag.py#L2600'>airflow-core/tests/unit/models/test_dag.py~L2600</a></p>
<pre><code class="language-diff">     session.query(TI).filter_by(dag_id=dag.dag_id).update({&quot;state&quot;: TaskInstanceState.FAILED})
 
     ti_query = (
-        session.query(TI.task_id, TI.map_index, TI.run_id, TI.state)
+        session
+        .query(TI.task_id, TI.map_index, TI.run_id, TI.state)
         .filter(TI.dag_id == dag.dag_id, TI.task_id.in_([task_id, &quot;downstream&quot;]))
         .order_by(TI.run_id, TI.task_id, TI.map_index)
     )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/airflow-core/tests/unit/utils/test_log_handlers.py#L774'>airflow-core/tests/unit/utils/test_log_handlers.py~L774</a></p>
<pre><code class="language-diff">         TaskInstanceHistory.record_ti(ti, session=session)
         session.flush()
         tih = (
-            session.query(TaskInstanceHistory)
+            session
+            .query(TaskInstanceHistory)
             .filter_by(
                 dag_id=ti.dag_id,
                 task_id=ti.task_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/dev/breeze/src/airflow_breeze/utils/cdxgen.py#L426'>dev/breeze/src/airflow_breeze/utils/cdxgen.py~L426</a></p>
<pre><code class="language-diff">         )
 
         file_url = (
-            self.get_files_directory(self.application_root_path)
+            self
+            .get_files_directory(self.application_root_path)
             .relative_to(self.application_root_path)
             .as_posix()
         )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/dev/breeze/src/airflow_breeze/utils/constraints_version_check.py#L367'>dev/breeze/src/airflow_breeze/utils/constraints_version_check.py~L367</a></p>
<pre><code class="language-diff">     def get_release_dates(releases: dict, version: str) -&gt; str:
         if releases.get(version):
             return (
-                datetime.fromisoformat(releases[version][0][&quot;upload_time_iso_8601&quot;].replace(&quot;Z&quot;, &quot;+00:00&quot;))
+                datetime
+                .fromisoformat(releases[version][0][&quot;upload_time_iso_8601&quot;].replace(&quot;Z&quot;, &quot;+00:00&quot;))
                 .replace(tzinfo=None)
                 .strftime(&quot;%Y-%m-%d&quot;)
             )
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/devel-common/src/tests_common/test_utils/logs.py#L58'>devel-common/src/tests_common/test_utils/logs.py~L58</a></p>
<pre><code class="language-diff"> 
 def check_last_log(session, dag_id, event, logical_date, expected_extra=None, check_masked=False):
     logs = (
-        session.query(
+        session
+        .query(
             Log.dag_id,
             Log.task_id,
             Log.event,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/amazon/tests/system/amazon/aws/example_sagemaker_endpoint.py#L79'>providers/amazon/tests/system/amazon/aws/example_sagemaker_endpoint.py~L79</a></p>
<pre><code class="language-diff"> @task
 def call_endpoint(endpoint_name):
     response = (
-        boto3.Session()
+        boto3
+        .Session()
         .client(&quot;sagemaker-runtime&quot;)
         .invoke_endpoint(
             EndpointName=endpoint_name,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/amazon/tests/unit/amazon/aws/hooks/test_base_aws.py#L517'>providers/amazon/tests/unit/amazon/aws/hooks/test_base_aws.py~L517</a></p>
<pre><code class="language-diff">             AwsBaseHook(aws_conn_id=aws_conn_id, client_type=&quot;s3&quot;).get_client_type()
             mocked_basic_session.assert_has_calls([
                 mock.call().client(&quot;sts&quot;, config=mock.ANY, endpoint_url=sts_endpoint),
-                mock.call()
+                mock
+                .call()
                 .client()
                 .assume_role(
                     RoleArn=role_arn,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/amazon/tests/unit/amazon/aws/hooks/test_base_aws.py#L712'>providers/amazon/tests/unit/amazon/aws/hooks/test_base_aws.py~L712</a></p>
<pre><code class="language-diff"> 
         mocked_basic_session.assert_has_calls = [
             mock.call().client(&quot;sts&quot;, config=mock.ANY, endpoint_url=sts_endpoint),
-            mock.call()
+            mock
+            .call()
             .client()
             .assume_role_with_saml(
                 DurationSeconds=duration_seconds,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py#L141'>providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py~L141</a></p>
<pre><code class="language-diff"> 
         # Check if job already exists with same dag_id, task_id, run_id, map_index, try_number
         existing_job = (
-            session.query(EdgeJobModel)
+            session
+            .query(EdgeJobModel)
             .filter_by(
                 dag_id=key.dag_id,
                 task_id=key.task_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py#L177'>providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py~L177</a></p>
<pre><code class="language-diff">         changed = False
         heartbeat_interval: int = conf.getint(&quot;edge&quot;, &quot;heartbeat_interval&quot;)
         lifeless_workers: list[EdgeWorkerModel] = (
-            session.query(EdgeWorkerModel)
+            session
+            .query(EdgeWorkerModel)
             .with_for_update(skip_locked=True)
             .filter(
                 EdgeWorkerModel.state.not_in([
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py#L211'>providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py~L211</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Update status ob jobs when workers die and don't update anymore.&quot;&quot;&quot;
         heartbeat_interval: int = conf.getint(&quot;scheduler&quot;, &quot;task_instance_heartbeat_timeout&quot;)
         lifeless_jobs: list[EdgeJobModel] = (
-            session.query(EdgeJobModel)
+            session
+            .query(EdgeJobModel)
             .with_for_update(skip_locked=True)
             .filter(
                 EdgeJobModel.state == TaskInstanceState.RUNNING,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py#L253'>providers/edge3/src/airflow/providers/edge3/executors/edge_executor.py~L253</a></p>
<pre><code class="language-diff">         job_success_purge = conf.getint(&quot;edge&quot;, &quot;job_success_purge&quot;)
         job_fail_purge = conf.getint(&quot;edge&quot;, &quot;job_fail_purge&quot;)
         jobs: list[EdgeJobModel] = (
-            session.query(EdgeJobModel)
+            session
+            .query(EdgeJobModel)
             .with_for_update(skip_locked=True)
             .filter(
                 EdgeJobModel.state.in_([
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/elasticsearch/src/airflow/providers/elasticsearch/log/es_task_handler.py#L100'>providers/elasticsearch/src/airflow/providers/elasticsearch/log/es_task_handler.py~L100</a></p>
<pre><code class="language-diff">     if not isinstance(ti, TaskInstanceKey):
         return ti
     val = (
-        session.query(TaskInstance)
+        session
+        .query(TaskInstance)
         .filter(
             TaskInstance.task_id == ti.task_id,
             TaskInstance.dag_id == ti.dag_id,
</code></pre>
<p><a href='https://github.com/apache/airflow/blob/e1adf0b1eba8fb5e00046cf49f15da3de59ff705/providers/fab/src/airflow/providers/fab/auth_manager/security_manager/override.py#L1343'>providers/fab/src/airflow/providers/fab/auth_manager/security_manager/override.py~L1343</a></p>
<pre><code class="language-diff"> 
     def get_public_role(self):
         return (
-            self.session.scalars(select(self.role_model).filter_by(name=self.auth_role_public))
+            self.session
+            .scalars(select(self.role_model).filter_by(name=self.auth_role_public))
             .unique()
             .one_or_none()
      

... (truncated 16493 lines) ...

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-12 15:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:894 on 2025-12-12 15:51</div>
            <div class="timeline-body"><p>The original example in the doc-comment has a sum of two things. Moved the wording up a bit so that &quot;above example&quot; unambiguously refers to one thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-12 15:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:1033 on 2025-12-12 15:52</div>
            <div class="timeline-body"><p>Long explanation added in doc-comments in function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-12 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_formatter/src/preview.rs</code>:68 on 2025-12-12 15:54</div>
            <div class="timeline-body"><p>I compared the various diffs between toggling different things. Adding &quot;use fluent more often&quot; on top of the stable style looks not great in a lot of examples, I think. I'd rather add <em>just</em> the layout change, since it's a very understandable diff for users: it only changes two lines in every call chain. I think if we later want to &quot;use fluent more often&quot; on top of that, it wouldn't be too bad. But somehow doing it the other order or doing both results in a kind of surprising change in some examples. (It is more likely to highlight our lack of good nested expression formatting for some reason).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @dylwil3 on 2025-12-12 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-12 20:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:955 on 2025-12-12 20:27</div>
            <div class="timeline-body"><p>The refactor is not equivalent, e.g. when x = 2. I added some doc comments - we subtract because we traverse from right to left and the &quot;count&quot; is of &quot;remaining calls/subscripts&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-12 20:31</div>
            <div class="timeline-body"><p>(~~Edit: Hold that thought - didn't expect the ecosystem results to change, maybe I made a mistake in one of the million refactors or merges... sorry, looking into it~~)
(Update: False alarm! Looks like a couple repos were updated and a few things changed from the new lambda formatting. All looks good to me.)</p>
<p>Ok, added lots of doc-comments and some more fixtures.. The logic is still somewhat complex since it has to produce the correct behavior when, e.g., the root of the chain is either parenthesized or a call.</p>
<p>(Actually I had to update the logic to handle correctly the case when the root of the chain is parenthesized but then we have a non-called attribute right after. I missed this before because it doesn't actually happen in the ecosystem or in our tests.)</p>
<p>I removed the &quot;apply fluent more often&quot; preview style - I think we can do a follow-up PR that does that if we want, but it looks strange sometimes when it's applied to the <em>stable</em> fluent layout, so I think it should only be applied once the current PR lands. Also it was responsible for almost all of the examples you pointed to and said &quot;this looks worse&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-12-12 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @dylwil3 on 2025-12-12 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dylwil3 on 2025-12-12 20:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Copilot by @MichaReiser on 2025-12-12 22:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @MichaReiser on 2025-12-12 22:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-12 22:22</div>
            <div class="timeline-body"><p>Oh no, it wasn't my intention to request a copilot review and I don't know how to remove it again. I'm sorry üò™</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:1020 on 2025-12-12 22:26</div>
            <div class="timeline-body"><p>The comment text is incomplete. It says &quot;Similar to the above, but instead looks at all and subscripts&quot; but appears to be missing the word &quot;calls&quot; between &quot;all&quot; and &quot;and subscripts&quot;. The comment should read &quot;Similar to the above, but instead looks at all calls and subscripts rather than looking only at those on <em>attribute values</em>.&quot;</p>
<pre><code class="language-suggestion">        // Similar to the above, but instead looks at all calls
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>crates/ruff_python_formatter/src/preview.rs</code>:64 on 2025-12-12 22:26</div>
            <div class="timeline-body"><p>The link in the doc comment is incomplete. It says <a href=""><code>fluent_layout_split_first_call</code></a> but the parentheses are empty. This should reference a GitHub issue or PR (e.g., <code>https://github.com/astral-sh/ruff/issues/8598</code>) similar to the other preview feature functions in this file.</p>
<pre><code class="language-suggestion">/// [`fluent_layout_split_first_call`](https://github.com/astral-sh/ruff/issues/XXXXX) preview
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/copilot-pull-request-reviewer[bot]">@copilot-pull-request-reviewer[bot]</a> reviewed on 2025-12-12 22:26</div>
            <div class="timeline-body"><h2>Pull request overview</h2>
<p>This PR implements a new preview-mode formatting style for method chains that breaks <em>at</em> the first call or subscript instead of <em>after</em> it. For example, <code>df.filter().agg()</code> now formats as <code>df\n.filter()\n.agg()</code> rather than <code>df.filter()\n.agg()</code> when lines need to be broken. This change applies to fluent-style method chains (those with 2+ called/subscripted attributes).</p>
<p>Key changes:</p>
<ul>
<li>Extended <code>CallChainLayout::Fluent</code> enum to track position within chains via a new <code>AttributeState</code> type</li>
<li>Implemented state transitions to determine where to insert line breaks in preview mode</li>
<li>Added preview feature flag <code>is_fluent_layout_split_first_call_enabled</code></li>
</ul>
<h3>Reviewed changes</h3>
<p>Copilot reviewed 14 out of 14 changed files in this pull request and generated 3 comments.</p>
<details>
<summary>Show a summary per file</summary>

<p>| File | Description |
| ---- | ----------- |
| <code>docs/formatter.md</code> | Adds documentation explaining the new fluent layout preview style with examples |
| <code>crates/ruff_python_formatter/src/preview.rs</code> | Adds feature flag function for the new preview style |
| <code>crates/ruff_python_formatter/src/expression/mod.rs</code> | Core implementation: adds <code>AttributeState</code> enum and state transition logic to <code>CallChainLayout</code> |
| <code>crates/ruff_python_formatter/src/expression/expr_attribute.rs</code> | Updates attribute formatting to use state transitions and insert breaks at first call/subscript |
| <code>crates/ruff_python_formatter/src/expression/expr_call.rs</code> | Updates call expression formatting to decrement call-like count when traversing into attributes |
| <code>crates/ruff_python_formatter/src/expression/expr_subscript.rs</code> | Updates subscript formatting to decrement call-like count when traversing into attributes |
| <code>crates/ruff_python_formatter/src/expression/expr_lambda.rs</code> | Updates lambda formatting to match on new <code>Fluent</code> variant structure |
| <code>crates/ruff_python_formatter/tests/snapshots/format@parentheses__call_chains.py.snap</code> | Test snapshot showing preview formatting differences for method chains |
| <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code> | Test snapshot showing preview changes for call expressions |
| <code>crates/ruff_python_formatter/tests/snapshots/format@expression__await.py.snap</code> | Test snapshot showing preview changes for await expressions |
| <code>crates/ruff_python_formatter/tests/snapshots/format@expression__lambda.py.snap</code> | Test snapshot showing preview changes for lambda expressions with method chains |
| <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@cases__preview_long_dict_values.py.snap</code> | Test snapshot showing preview changes for dict values with method chains |
| <code>crates/ruff_python_formatter/tests/snapshots/format@expression__split_empty_brackets.py.snap</code> | Snapshot metadata update (removes <code>snapshot_kind</code>) |
| <code>crates/ruff_python_formatter/resources/test/fixtures/ruff/parentheses/call_chains.py</code> | Adds test cases for new preview behavior including polars examples and edge cases |</p>
</details>

<hr />
<p>üí° <a href="/astral-sh/ruff/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>crates/ruff_python_formatter/resources/test/fixtures/ruff/parentheses/call_chains.py</code>:266 on 2025-12-12 22:26</div>
            <div class="timeline-body"><p>Variable identical_hidden_layer_sizes is not used.</p>
<pre><code class="language-suggestion">            all(
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:880 on 2025-12-12 23:49</div>
            <div class="timeline-body"><p>My idea in #21903 was to make myself update docs when stabilizing something by breaking my preview links. If you want to do the same, I think you could link this <code>preview</code> to your preview function with something like:</p>
<pre><code class="language-suggestion">/// In [`preview`](crate::preview::is_fluent_layout_split_first_call_enabled), we also track the position of the leftmost call or
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:924 on 2025-12-13 00:38</div>
            <div class="timeline-body"><p>I guess we could use a smaller type here if we wanted to since the file size is bounded by a u32 and it takes a couple of characters to add a call or subscript, but I doubt it matters much either way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-12-13 00:39</div>
            <div class="timeline-body"><p>I think this all makes sense to me, and the ecosystem changes look good! I only had a couple of very minor suggestions, but I'll leave it to Micha to approve.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-12-13 13:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:924 on 2025-12-13 13:23</div>
            <div class="timeline-body"><p>I was wondering that, and probably my math is wrong, but isn't:</p>
<pre><code>a().a().a().... # continue for u32::MAX characters
</code></pre>
<p>still much larger than <code>u16::MAX</code> many calls?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-12-13 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:924 on 2025-12-13 18:11</div>
            <div class="timeline-body"><p>Oof, I was not thinking about this in the right way last night, I think you're right! Sorry for the noise!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:924 on 2025-12-15 07:46</div>
            <div class="timeline-body"><p>I think a <code>u32</code> is perfectly fine. It shouldn't matter much for performance (or storage). We could consider making it a <code>NonZeroU32</code> if it is guaranteed to always be non-zero.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-15 07:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/resources/test/fixtures/ruff/parentheses/call_chains.py</code>:221 on 2025-12-15 07:46</div>
            <div class="timeline-body"><p>It might be worth explaining why we do it regardless. I'm sure it will come up in a future issue and I would much appreciate if I came across a comment in code (or test) explaining why we do split after <code>np</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/expr_attribute.rs</code>:51 on 2025-12-15 07:50</div>
            <div class="timeline-body"><p>Nit: It might be worth introducing a helper</p>
<pre><code class="language-suggestion">            if call_chain_layout.is_fluent() {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:975 on 2025-12-15 07:53</div>
            <div class="timeline-body"><p>Nit: Align the method and variant name (I like <code>call_like</code> but I don't mind much either way)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/mod.rs</code>:995 on 2025-12-15 07:54</div>
            <div class="timeline-body"><p>This comment is very helpful. Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-12-15 07:58</div>
            <div class="timeline-body"><p>Thank you.</p>
<p>The implementation looks good to me, but I think we're still a bit light in terms of tests (especially simple once, your examples are pretty massive :)).</p>
<p>I think it would be good to have a few, very simple method chains that document the intended breaking behavior. It might also be worth adding a few more tests with parenthesized roots (e.g. parenthesize the second element etc), and comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-12-15 15:29</div>
            <div class="timeline-body"><p>Thank you @MichaReiser and @ntBre for the reviews!</p>
<p>And thanks @laundmo , @alexreinking , and @dhirschfeld for the feedback - looking forward to any comments you have for improvement in the next iteration!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2025-12-15 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-12-15 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-19 13:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:17:06 UTC
    </footer>
</body>
</html>
