<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] support PEP 613 type aliases - astral-sh/ruff #20107</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] support PEP 613 type aliases</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20107">#20107</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-08-27 00:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body">Summary
<p>Add support for PEP 613 type aliases (defined by annotating with <code>typing.TypeAlias</code>), including recursive ones.</p>
Test Plan
<p>Added mdtests and updated existing tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/carljm">@carljm</a> on 2025-08-27 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-27 00:35</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-10-16 12:51:07.719997664 +0000
+++ new-output.txt	2025-10-16 12:51:11.082995592 +0000
@@ -1,27 +1,34 @@
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_type_statement.py`: `PEP695TypeAliasType &lt; &#x27;db &gt;::value_type_(Id(d417)): execute: too many cycle iterations`
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(16c43)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_type_statement.py`: `PEP695TypeAlias &lt; &#x27;db &gt;::value_type_(Id(d817)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/ef9f932/src/function/execute.rs:402:17 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(17043)): execute: too many cycle iterations`
 _directives_deprecated_library.py:15:31: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 _directives_deprecated_library.py:30:26: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
 _directives_deprecated_library.py:41:25: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int | float`
 _directives_deprecated_library.py:45:24: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 aliases_explicit.py:41:24: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[str, str]`?
-aliases_explicit.py:45:10: error[invalid-type-form] Variable of type `Literal[&quot;int | str&quot;]` is not allowed in a type expression
-aliases_explicit.py:49:5: error[type-assertion-failure] Argument does not have asserted type `int | str`
-aliases_explicit.py:50:5: error[type-assertion-failure] Argument does not have asserted type `int | None`
-aliases_explicit.py:51:5: error[type-assertion-failure] Argument does not have asserted type `list[int | None]`
 aliases_explicit.py:52:5: error[type-assertion-failure] Argument does not have asserted type `list[int]`
 aliases_explicit.py:53:5: error[type-assertion-failure] Argument does not have asserted type `tuple[str, ...] | list[str]`
 aliases_explicit.py:54:5: error[type-assertion-failure] Argument does not have asserted type `tuple[int, int, int, str]`
-aliases_explicit.py:55:5: error[type-assertion-failure] Argument does not have asserted type `(...) -&gt; int`
 aliases_explicit.py:56:5: error[type-assertion-failure] Argument does not have asserted type `(int, str, /) -&gt; str`
 aliases_explicit.py:57:5: error[type-assertion-failure] Argument does not have asserted type `(int, str, str, /) -&gt; None`
 aliases_explicit.py:59:5: error[type-assertion-failure] Argument does not have asserted type `int | str | None | list[list[int]]`
-aliases_explicit.py:60:5: error[type-assertion-failure] Argument does not have asserted type `(...) -&gt; None`
-aliases_explicit.py:61:5: error[type-assertion-failure] Argument does not have asserted type `int | str`
-aliases_explicit.py:63:5: error[type-assertion-failure] Argument does not have asserted type `Literal[3, 4, 5] | None`
+aliases_explicit.py:79:21: error[invalid-type-form] Function calls are not allowed in type expressions
+aliases_explicit.py:80:21: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[int, str]`?
+aliases_explicit.py:81:21: error[invalid-type-form] Tuple literals are not allowed in this context in a type expression
+aliases_explicit.py:81:22: error[invalid-type-form] Tuple literals are not allowed in this context in a type expression: Did you mean `tuple[int, str]`?
+aliases_explicit.py:82:21: error[invalid-type-form] List comprehensions are not allowed in type expressions
+aliases_explicit.py:83:21: error[invalid-type-form] Dict literals are not allowed in type expressions
+aliases_explicit.py:84:21: error[invalid-type-form] Function calls are not allowed in type expressions
+aliases_explicit.py:85:27: error[invalid-type-form] Int literals are not allowed in this context in a type expression
+aliases_explicit.py:86:21: error[invalid-type-form] `if` expressions are not allowed in type expressions
+aliases_explicit.py:87:21: error[invalid-type-form] Variable of type `Literal[3]` is not allowed in a type expression
+aliases_explicit.py:88:22: error[invalid-type-form] Boolean literals are not allowed in this context in a type expression
+aliases_explicit.py:89:22: error[invalid-type-form] Int literals are not allowed in this context in a type expression
+aliases_explicit.py:90:22: error[invalid-type-form] Boolean operations are not allowed in type expressions
+aliases_explicit.py:91:22: error[invalid-type-form] F-strings are not allowed in type expressions
+aliases_explicit.py:97:17: error[call-non-callable] Object of type `object` is not callable
 aliases_explicit.py:98:1: error[type-assertion-failure] Argument does not have asserted type `list[str]`
-aliases_explicit.py:101:6: error[call-non-callable] Object of type `UnionType` is not callable
+aliases_explicit.py:101:6: error[call-non-callable] Object of type `object` is not callable
 aliases_implicit.py:54:24: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[str, str]`?
 aliases_implicit.py:60:5: error[type-assertion-failure] Argument does not have asserted type `int | str`
 aliases_implicit.py:61:5: error[type-assertion-failure] Argument does not have asserted type `int | None`
@@ -48,10 +55,11 @@
 aliases_implicit.py:133:6: error[call-non-callable] Object of type `UnionType` is not callable
 aliases_newtype.py:15:1: error[type-assertion-failure] Argument does not have asserted type `int`
 aliases_newtype.py:18:1: error[invalid-assignment] Object of type `NewType` is not assignable to `type`
+aliases_newtype.py:23:16: error[invalid-argument-type] Argument to function `isinstance` is incorrect: Expected `type | UnionType | tuple[Unknown, ...]`, found `NewType`
 aliases_newtype.py:26:21: error[invalid-base] Invalid class base with type `NewType`
 aliases_newtype.py:63:43: error[too-many-positional-arguments] Too many positional arguments to bound method `__init__`: expected 3, got 4
-aliases_variance.py:18:24: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassA[typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
-aliases_variance.py:28:16: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassA[typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
+aliases_variance.py:28:16: error[non-subscriptable] Cannot subscript object of type `A_Alias_1` with no `__getitem__` method
+aliases_variance.py:32:16: error[non-subscriptable] Cannot subscript object of type `A_Alias_2` with no `__getitem__` method
 aliases_variance.py:44:16: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassB[typing.TypeVar, typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
 annotations_forward_refs.py:49:10: error[invalid-type-form] Variable of type `Literal[1]` is not allowed in a type expression
 annotations_forward_refs.py:54:11: error[fstring-type-annotation] Type expressions cannot use f-strings
@@ -166,6 +174,7 @@
 classes_classvar.py:71:18: error[invalid-type-form] `ClassVar` annotations are not allowed for non-name targets
 classes_classvar.py:73:26: error[invalid-type-form] `ClassVar` is not allowed in function return type annotations
 classes_classvar.py:77:8: error[invalid-type-form] `ClassVar` annotations are only allowed in class-body scopes
+classes_classvar.py:78:20: error[invalid-type-form] Type qualifier `typing.ClassVar` is not allowed in type expressions (only in annotation expressions)
 classes_classvar.py:111:1: error[invalid-attribute-access] Cannot assign to ClassVar `stats` from an instance of type `Starship`
 classes_classvar.py:140:1: error[invalid-assignment] Object of type `ProtoAImpl` is not assignable to `ProtoA`
 constructors_call_init.py:21:13: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `int`, found `float`
@@ -399,7 +408,7 @@
 generics_defaults_referential.py:95:1: error[type-assertion-failure] Argument does not have asserted type `@Todo(unsupported nested subscript in type[X])`
 generics_defaults_specialization.py:26:5: error[type-assertion-failure] Argument does not have asserted type `SomethingWithNoDefaults[int, str]`
 generics_defaults_specialization.py:27:5: error[type-assertion-failure] Argument does not have asserted type `SomethingWithNoDefaults[int, bool]`
-generics_defaults_specialization.py:30:1: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;SomethingWithNoDefaults[int, typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
+generics_defaults_specialization.py:30:1: error[non-subscriptable] Cannot subscript object of type `MyAlias` with no `__getitem__` method
 generics_defaults_specialization.py:45:1: error[type-assertion-failure] Argument does not have asserted type `@Todo(unsupported nested subscript in type[X])`
 generics_paramspec_basic.py:27:38: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 generics_paramspec_components.py:49:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `tuple[@Todo(Support for `typing.ParamSpec`), ...]`
@@ -799,7 +808,9 @@
 qualifiers_annotated.py:53:18: error[invalid-type-form] Boolean operations are not allowed in type expressions
 qualifiers_annotated.py:54:18: error[fstring-type-annotation] Type expressions cannot use f-strings
 qualifiers_annotated.py:64:8: error[invalid-type-form] Special form `typing.Annotated` expected at least 2 arguments (one type and at least one metadata element)
+qualifiers_annotated.py:77:1: error[invalid-assignment] Object of type `SmallInt` is not assignable to `type[Any]`
 qualifiers_annotated.py:91:1: error[call-non-callable] Object of type `typing.Annotated` is not callable
+qualifiers_annotated.py:93:1: error[call-non-callable] Object of type `object` is not callable
 qualifiers_final_annotation.py:18:7: error[invalid-type-form] Type qualifier `typing.Final` expected exactly 1 argument, got 2
 qualifiers_final_annotation.py:71:1: error[invalid-assignment] Reassignment of `Final` symbol `RATE` is not allowed: Symbol later reassigned here
 qualifiers_final_annotation.py:81:1: error[invalid-assignment] Cannot assign to final attribute `DEFAULT_ID` on type `&lt;class &#x27;ClassB&#x27;&gt;`
@@ -839,12 +850,7 @@
 specialtypes_type.py:120:5: error[unresolved-attribute] Type `type` has no attribute `unknown`
 specialtypes_type.py:127:5: error[type-assertion-failure] Argument does not have asserted type `ProUser`
 specialtypes_type.py:137:5: error[type-assertion-failure] Argument does not have asserted type `type[Any]`
-specialtypes_type.py:138:5: error[type-assertion-failure] Argument does not have asserted type `type[Any]`
 specialtypes_type.py:139:5: error[type-assertion-failure] Argument does not have asserted type `type[Any]`
-specialtypes_type.py:140:5: error[type-assertion-failure] Argument does not have asserted type `type[Any]`
-specialtypes_type.py:143:1: error[unresolved-attribute] Type `typing.Type` has no attribute `unknown`
-specialtypes_type.py:145:1: error[unresolved-attribute] Type `&lt;class &#x27;type&#x27;&gt;` has no attribute `unknown`
-specialtypes_type.py:146:1: error[unresolved-attribute] Type `GenericAlias` has no attribute `unknown`
 specialtypes_type.py:160:1: error[type-assertion-failure] Argument does not have asserted type `int`
 specialtypes_type.py:161:1: error[type-assertion-failure] Argument does not have asserted type `int`
 specialtypes_type.py:169:5: error[invalid-assignment] Object of type `type` is not assignable to `type[int]`
@@ -862,9 +868,7 @@
 tuples_type_compat.py:106:13: error[type-assertion-failure] Argument does not have asserted type `tuple[str, str] | tuple[int, int]`
 tuples_type_compat.py:111:13: error[type-assertion-failure] Argument does not have asserted type `tuple[int, str, int]`
 tuples_type_compat.py:126:13: error[type-assertion-failure] Argument does not have asserted type `tuple[int | str, str]`
-tuples_type_compat.py:127:13: error[type-assertion-failure] Argument does not have asserted type `@Todo(Support for `typing.TypeAlias`)`
 tuples_type_compat.py:129:13: error[type-assertion-failure] Argument does not have asserted type `tuple[int | str, int]`
-tuples_type_compat.py:130:13: error[type-assertion-failure] Argument does not have asserted type `@Todo(Support for `typing.TypeAlias`)`
 tuples_type_compat.py:153:5: error[type-assertion-failure] Argument does not have asserted type `Sequence[Never]`
 tuples_type_compat.py:157:1: error[invalid-assignment] Object of type `tuple[Literal[1], Literal[&quot;&quot;], Literal[&quot;&quot;]]` is not assignable to `tuple[int, str]`
 tuples_type_compat.py:162:1: error[invalid-assignment] Object of type `tuple[Literal[1], Literal[1], Literal[&quot;&quot;]]` is not assignable to `tuple[int, *tuple[str, ...]]`
@@ -898,5 +902,5 @@
 typeddicts_usage.py:28:17: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Invalid key access on TypedDict `Movie`: Unknown key &quot;title&quot;
 typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions. Did you mean to use a concrete TypedDict or `collections.abc.Mapping[str, object]` instead?
-Found 900 diagnostics
+Found 904 diagnostics
 WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-08-27 00:46</div>
            <div class="timeline-body">

<a href="https://codspeed.io/astral-sh/ruff/branches/cjm%2Fpep613alias?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a>
Merging #20107 will <strong>improve performances by 21.89%</strong>
<p>Comparing <code>cjm/pep613alias</code> (79a1305) with <code>main</code> (3db5d59)</p>
Summary
<p><code>‚ö° 1</code> improvement<br>
<code>‚úÖ 12</code> untouched<br>
<code>‚è© 39</code> skipped[^skipped]</p>
Benchmarks breakdown
<p>|     | Mode | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | ---- | --------- | ------ | ------ | ------ |
| ‚ö° | Simulation | <a href="https://codspeed.io/astral-sh/ruff/branches/cjm%2Fpep613alias?uri=crates%2Fruff_benchmark%2Fbenches%2Fty.rs%3A%3Aproject%3A%3Ahydra%3A%3Aproject%3A%3Ahydra-zen&amp;runnerMode=Instrumentation&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>hydra-zen</code></a> | 757.2 ms | 621.3 ms | +21.89% |
[^skipped]: 39 benchmarks were skipped, so the baseline results were used instead. If they were deleted from the codebase, <a href="https://codspeed.io/astral-sh/ruff/branches/cjm%2Fpep613alias?sectionId=benchmark-comparison-section-baseline-result-skipped&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=archive">click here and archive them to remove them from the performance reports</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-08-29 02:47</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/cjm%2Fpep613alias?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #20107 will <strong>degrade performances by 18.89%</strong>
<p>Comparing <code>cjm/pep613alias</code> (e2ea575) with <code>main</code> (a24a4b5)</p>
Summary
<p><code>‚ùå 1</code> regressions<br>
<code>‚úÖ 42</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/cjm%2Fpep613alias?runnerMode=Instrumentation">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ùå | <code>hydra-zen</code> | 714.9 ms | 881.4 ms | -18.89% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-29 20:39</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-16 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:11788 on 2025-10-16 12:51</div>
            <div class="timeline-body"><p>I don&#x27;t understand why the old assertion no longer passes after rebasing this PR on <code>main</code>. (It seemed to pass on earlier versions of this PR, IIRC.) This PR adds new <code>Type</code> variants, but the wrapped data is all Salsa-interned, and (from local experimentation -- I tried adding some more <code>static_assertions::assert_eq_size!()</code> calls on various wrapped structs and ran <code>cargo check -p ty_python_semantic --release</code>) doesn&#x27;t appear particularly large</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-10-16 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types.rs</code>:11788 on 2025-10-16 12:51</div>
            <div class="timeline-body"><p>hmm...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-16 12:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:11788 on 2025-10-16 12:52</div>
            <div class="timeline-body"><p>see <a href="https://github.com/astral-sh/ruff/pull/20107">astral-sh/ruff#20107</a>#discussion_r2435798449</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-16 12:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-16 13:03</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p><strong>Failing projects</strong>:</p>
<p>| Project | Old Status | New Status | Old Return Code | New Return Code |
|---------|------------|------------|-----------------|------------------|
| <code>hydra-zen</code> | success | abnormal exit | <code>1</code> | <code>101</code> |</p>
<p><strong>Diagnostic changes:</strong></p>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 1,300 | 107 | 177 |
| <code>type-assertion-failure</code> | 185 | 256 | 32 |
| <code>call-non-callable</code> | 389 | 0 | 0 |
| <code>no-matching-overload</code> | 296 | 10 | 0 |
| <code>possibly-missing-attribute</code> | 221 | 12 | 63 |
| <code>unused-ignore-comment</code> | 17 | 246 | 0 |
| <code>non-subscriptable</code> | 212 | 38 | 8 |
| <code>unsupported-operator</code> | 60 | 137 | 7 |
| <code>unresolved-attribute</code> | 61 | 90 | 52 |
| <code>invalid-assignment</code> | 67 | 29 | 20 |
| <code>invalid-return-type</code> | 26 | 38 | 25 |
| <code>invalid-type-form</code> | 12 | 51 | 1 |
| <code>not-iterable</code> | 6 | 9 | 7 |
| <code>possibly-unresolved-reference</code> | 0 | 19 | 0 |
| <code>invalid-base</code> | 17 | 0 | 0 |
| <code>invalid-exception-caught</code> | 16 | 0 | 0 |
| <code>invalid-parameter-default</code> | 8 | 0 | 7 |
| <code>unknown-argument</code> | 5 | 7 | 0 |
| <code>invalid-context-manager</code> | 0 | 0 | 10 |
| <code>possibly-missing-implicit-call</code> | 5 | 3 | 0 |
| <code>index-out-of-bounds</code> | 2 | 1 | 3 |
| <code>parameter-already-assigned</code> | 3 | 0 | 0 |
| <code>invalid-raise</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>2,909</strong> | <strong>1,053</strong> | <strong>412</strong> |</p>
<p><strong><a href="https://cjm-pep613alias.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://cjm-pep613alias.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-10-16 13:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types.rs</code>:11788 on 2025-10-16 13:04</div>
            <div class="timeline-body"><p>I&#x27;m not sure what changed but I remember that @ibraheemdev ran into this as well.</p>
<p>it seems that <code>SubclassOfType</code> is 16 bytes and so is <code>KnownInstanceType</code>. But <code>KnownInstanceType</code> was 12 bytes before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-10-16 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types.rs</code>:7497 on 2025-10-16 13:07</div>
            <div class="timeline-body"><p><code>TypeAliasType</code> could be a <code>salsa::Supertype</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-16 13:11</div>
            <div class="timeline-body"><p>hah, I got excited about the Codspeed speedup there for a minute before I remembered that that&#x27;s the project that now panics in mypy_primer ü§£</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-16 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:7497 on 2025-10-16 13:21</div>
            <div class="timeline-body"><p>I tried it locally, it doesn&#x27;t help. <code>Type</code> is still 192 bits on a release build, not 128</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-16 15:01</div>
            <div class="timeline-body"><p>Notes on the ecosystem diagnostics:</p>
<ul>
<li><p>The bokeh ones in <code>src/bokeh/transform.py</code> are really weird, need to look into them more</p>
</li>
<li><p>Lots of true positives from <code>int()</code> calls due to the fact that we didn&#x27;t understand typeshed&#x27;s type alias it used for <code>int.__new__</code> before</p>
</li>
<li><p>Lots of ddtrace hits due to the fact that we now understand the return type of <code>sys.exc_info()</code> properly... the typeshed signature there is accurate (it says this function returns <code>tuple[type[BaseException] | None, BaseException | None, TracebackType | None]</code>, but we could possibly special-case this function to model that it will always return <code>tuple[type[BaseException], BaseException, TracebackType]</code> if you&#x27;re inside an <code>except:</code> block (this is where the hits are coming from)</p>
</li>
<li><p>The new dulwich diagnostics in <code>dulwich/ignore.py</code> (and I think some of the others in that repo too) are false positives that stem from a combination of <a href="https://github.com/astral-sh/ty/issues/1100">astral-sh/ty#1100</a> and some <code>@Todo</code> types that we infer when we see a subscription of an object with an intersection type. Here&#x27;s a minimal repro on this branch:</p>
<pre><code>from typing import TypeVar

AnyStr = TypeVar(&quot;AnyStr&quot;, str, bytes)

def escape(x: AnyStr) -&gt; AnyStr:
    return x

def f(x: bytes):
    if x != b&quot;foo&quot;:
        reveal_type(x)  # bytes &amp; ~Literal[b&quot;foo&quot;]
        reveal_type(x[1:])  # @Todo(Subscript expressions on intersections)
        reveal_type(escape(x[1:]))  # str
</code></pre>
</li>
<li><p>Some diagnostics on <code>graphql</code> that look like this which seem like they&#x27;re technically-speaking true positives (type aliases being used in runtime contexts), but don&#x27;t have very friendly error messages right now:</p>
<pre><code>Invalid class base with type `Unknown | typing.TypeAlias` 
</code></pre>
<p>Edit: or, <em>are</em> these true positives? I guess typeshed does this kind of thing, e.g. in https://github.com/python/typeshed/blob/11c7821a79a8ab7e1982f3ab506db16f1c4a22a9/stdlib/sys/<strong>init</strong>.pyi#L104... I&#x27;m not totally sure whether typeshed is doing the Right Thing there though (hmm, I think it was me who wrote that typeshed type alias üôà)</p>
</li>
<li><p>Also some <code>graphql</code> diagnostics on e.g. <code>src/graphql/language/printer.py</code> that definitely look like false positives, and should be looked into</p>
</li>
<li><p>We seem to infer the type of <code>np.float32</code> as being <code>object</code> on this branch? Seems probably incorrect. Is causing <em>many</em> false-positive diagnostics on jax/pandas/sklearn/scipy -- there are many diagnostics like this:</p>
<pre><code>Object of type `object` is not callable 
</code></pre>
</li>
<li><p>This diagnostic on <code>kornia</code> requires special-casing by ty because it&#x27;s true that you can do <code>isinstance(x, typing.List)</code> at runtime, but that&#x27;s not expressible in typeshed&#x27;s stubs (and typeshed doesn&#x27;t try to capture it):</p>
<pre><code>Argument to function `isinstance` is incorrect: Expected `type | tuple[Unknown, ...]`, found `typing.List`
</code></pre>
<p>This doesn&#x27;t really come up that much, especially now that these legacy <code>typing</code>-module aliases are all deprecated; we could add that special-casing as a followup. There are some similar diagnostics in <code>pip</code> too, though, regarding <code>typing.Callable</code>, and in <code>prefect</code> regarding <code>typing.Dict</code>.</p>
</li>
<li><p>The win32 errors on <code>com/win32comext/shell/demos/walk_shell_folders.py</code> look weird. (Lots of diagnostics like that across the pywin32 project.) Not sure why it thinks that <code>shell.error</code> isn&#x27;t a subclass of <code>Exception</code>, since in typeshed&#x27;s stubs for pywin32 <a href="https://github.com/python/typeshed/blob/11c7821a79a8ab7e1982f3ab506db16f1c4a22a9/stubs/pywin32/win32comext/shell/shell.pyi#L7"><code>error</code></a> is a type alias for <code>com_error</code>, which <a href="https://github.com/python/typeshed/blob/main/stubs/pywin32/win32/lib/pywintypes.pyi#L17">definitely inherits from <code>Exception</code> in typeshed&#x27;s stubs</a>. Maybe this is another example of a type-alias-in-runtime-context issue?</p>
</li>
<li><p>This one on Sphinx is an issue where we need to use type context to avoid promoting literals when solving the type parameters for a <code>set</code> literal (cc. @ibraheemdev):</p>
<pre><code>[error] invalid-argument-type - [:177:50] - Argument to bound method `__init__` is incorrect: Expected `AbstractSet[Literal[&quot;&quot;, &quot;env&quot;, &quot;epub&quot;, &quot;gettext&quot;, &quot;html&quot;, &quot;applehelp&quot;, &quot;devhelp&quot;]]`, found `frozenset[Unknown | str]`
</code></pre>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-20 04:54</div>
            <div class="timeline-body"><p>Closing in favor of #21394</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-11-20 04:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:05 UTC
    </footer>
</body>
</html>
