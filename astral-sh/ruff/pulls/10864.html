<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struct not tuple for compiled per-file ignores - astral-sh/ruff #10864</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Struct not tuple for compiled per-file ignores</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10864">#10864</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2024-04-10 20:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Code cleanup for per-file ignores; use a struct instead of a tuple.</p>
<p>Named the structs for individual ignores and the list of ignores <code>CompiledPerFileIgnore</code> and <code>CompiledPerFileIgnoreList</code>. Name choice is because we already have a <code>PerFileIgnore</code> struct for a pre-compiled-matchers form of the config. Name bikeshedding welcome.</p>
<h2>Test Plan</h2>
<p>Refactor, should not change behavior; existing tests pass.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @carljm on 2024-04-10 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-10 20:44</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @charliermarsh on 2024-04-10 23:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:622 on 2024-04-11 06:19</div>
            <div class="timeline-body"><p>I think we have a custom macro for displaying settings.</p>
<p>https://github.com/astral-sh/ruff/blob/317d2e4c757f175e275eeb077f4d2045c8797956/crates/ruff_workspace/src/settings.rs#L57-L76</p>
<p>@snowsignal should we use the <code>display_settings</code> macro here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-11 06:19</div>
            <div class="timeline-body"><p>I like it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-04-11 11:36</div>
            <div class="timeline-body"><p>LGTM!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-04-11 15:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:622 on 2024-04-11 15:13</div>
            <div class="timeline-body"><p>Yep, this would be a good use case for it üòÑ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-11 17:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:622 on 2024-04-11 17:51</div>
            <div class="timeline-body"><p>Paired with Alex to implement this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-11 17:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:622 on 2024-04-11 17:52</div>
            <div class="timeline-body"><p>It did require adding a new format/type whatever of &quot;globmatcher&quot; to the <code>display_settings!</code> macro.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-04-11 18:23</div>
            <div class="timeline-body"><p>@MichaReiser @snowsignal requesting another review because I would like to make sure that the change we made to <code>display_settings!</code> (to give it capability to display a GlobMatcher reasonably) looks OK.</p>
<p>The previous <code>Display</code> implementation here was actually pretty useless, it used <code>{:#?}</code> for a GlobMatcher which gives a massive output with all the internal structure of the GlobMatcher; suitable for debugging a <code>GlobMatcher</code> but not suitable for <code>Display</code> of the per-file-ignore settings at all. Given that nobody noticed that, I'm guessing we may never really use Display on these anywhere?</p>
<p>But anyway, the new version here is much better / more readable (for Display purposes), it just shows the actual file pattern of the <code>GlobMatcher</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @carljm on 2024-04-11 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @snowsignal by @carljm on 2024-04-11 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_linter/src/settings/mod.rs</code>:134 on 2024-04-11 18:28</div>
            <div class="timeline-body"><p>Nit: I think this fits better with the naming scheme used elsewhere in the macro.</p>
<pre><code class="language-suggestion">    (@field $fmt:ident, $prefix:ident, $settings:ident.$field:ident | glob) =&gt; {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> approved on 2024-04-11 18:29</div>
            <div class="timeline-body"><p>Looks good to me! Thank you üòÅ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff_linter/src/settings/mod.rs</code>:134 on 2024-04-11 19:22</div>
            <div class="timeline-body"><p>Happy to change it, but does it shift your preference at all to note that globset has both <code>GlobMatcher</code> and <code>Glob</code> as distinct types, and this added case only works for a setting that is a <code>GlobMatcher</code>? For a <code>Glob</code> this new case won't work, but you can just use the regular default display with good results. (That's why we named the new case <code>globmatcher</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-11 19:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-04-11 19:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_linter/src/settings/mod.rs</code>:134 on 2024-04-11 19:46</div>
            <div class="timeline-body"><p>Okay, I can see why using the full type name makes sense. I'm not too opinionated on the naming scheme (it's not that consistent to begin with, anyway) so we can keep using that. Thanks for explaining üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @carljm on 2024-04-11 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2024-04-11 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-11 19:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:03:41 UTC
    </footer>
</body>
</html>
