<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Double click to insert inlay hint - astral-sh/ruff #21600</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Double click to insert inlay hint</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21600">#21600</a>
        opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a>
        on 2025-11-24 00:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a></div>
            <div class="timeline-body">

Summary
<p>Resolves <a href="https://github.com/astral-sh/ty/issues/317">astral-sh/ty#317</a>#issuecomment-3567398107.</p>
<p>I can&#x27;t get the auto import working great.</p>
<p>I haven&#x27;t added many places where we specify that the type display is invalid syntax.</p>
Test Plan
<p>Nothing yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-24 00:16</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-24 00:18</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected âœ…</p>
<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:110 on 2025-11-24 00:20</div>
            <div class="timeline-body"><p>This causes issues for some definition kinds, like <code>Unknown</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 00:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Double click to insert inlay hint&quot; to &quot;[ty] Double click to insert inlay hint&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-24 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-24 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-24 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 14:43</div>
            <div class="timeline-body"><p>The parts that aren&#x27;t the auto-import stuff look reasonable to me (just not as familiar with auto-import stuff).</p>
<p>Might make sense to have the auto-import stuff be a follow-up?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 15:25</div>
            <div class="timeline-body"><p>Yes, I agree. Perhaps @BurntSushi would be able to advise or help with the auto import?</p>
<p>I can remove the auto import for now.</p>
<p>Perhaps we can put this behind a experimental flag for now also?</p>
<p>I will also try to add more invalid syntax places.</p>
<p>I also think it would be useful if we had alternative display for types that emit invalid synatx, like I&#x27;d still like to add a function signature with <code>Callable</code> notation.
This also seems like something we can just iterate on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 15:28</div>
            <div class="timeline-body"><blockquote>
<p>Perhaps we can put this behind a experimental flag for now also?</p>
</blockquote>
<p>I&#x27;m on the fence about it because you can just... not double-click (and undo if you do). I think we can land the minimal implementation and then disable/flag it if it&#x27;s a problem for some reason.</p>
<blockquote>
<p>This also seems like something we can just iterate on.</p>
</blockquote>
<p>Yeah agreed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 15:29</div>
            <div class="timeline-body"><p>I don&#x27;t think it&#x27;s strictly a blocker to not catch all the invalid syntax. It&#x27;s something we&#x27;ll probably burn down really fast in followups and the only stakes is a user getting mad that a feature they manually invoked did something useless.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 15:30</div>
            <div class="timeline-body"><p>Actually ok I think it&#x27;s slightly higher stakes -- &quot;user gets very confused&quot; is probably more likely. But still, followups.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 15:31</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m on the fence about it because you can just... not double-click</p>
</blockquote>
<p>true, but at least for now if you double click on some type with a <code>todo</code> type, its looks horribly and not an amazing experience.</p>
<p>Though, we may not get the user feedback about missing invalid syntax types if we hid it.</p>
<p>Happy to keep it open now, and let the issues trickle in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-11-24 15:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:123 on 2025-11-24 15:31</div>
            <div class="timeline-body"><p>What you have here looks reasonable to me. What&#x27;s going wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 15:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:123 on 2025-11-24 15:34</div>
            <div class="timeline-body"><p>I will review more tonight. But off the top of my head.</p>
<pre><code>T[: typing.TypeVar] = TypeVar(&quot;T&quot;)
</code></pre>
<p>the definition name is <code>TypeVar</code> so we <code>from typing import TypeVar</code> for example, but this doesnt help us. as we now have the annotation <code>: typing.TypeVar</code>.</p>
<p>Obviously not a great example because we should not type hint <code>TypeVar</code> (also a good place to not allow insert option`.</p>
<p>But for other types this would cause problems.</p>
<p>So its mostly an issue with the names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 15:40</div>
            <div class="timeline-body"><p>A rough heuristic for invalid syntax that will let you find most things: i believe <code>(</code>, <code>)</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&#x27;</code> are all invalid in type syntax (idk if <code>&#x27;</code> is stricly invalid but anywhere we explicitly emit it we&#x27;re doing type crimes).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 15:44</div>
            <div class="timeline-body"><p>Nice okay, do you think its worth it for us to scan over the label after getting the TypeDetails to check for invalid characters? Or should i just search for them in the display.rs file and manually set them to all be invalid</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 15:47</div>
            <div class="timeline-body"><p>It&#x27;s really tempting to just do the <code>contains</code> but I think it&#x27;s probably best to mark up our code in display.rs yeah.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-11-24 15:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:123 on 2025-11-24 15:55</div>
            <div class="timeline-body"><p>Oh I see. You might need to use <code>ImportAction::symbol_text</code>, since the import might need to be fully qualified for correctness in some cases.</p>
<p>With that said, I think the specific issue you&#x27;re hitting is that you&#x27;re always requesting a <code>from import</code> statement via <code>ImportRequest::import_from</code>. If you want to respect an existing qualified import, then you&#x27;ll want <code>ImportRequest::import</code>. So you&#x27;ll probably need to detect which one you have and then use the right request. (Note though that it is only a <em>request</em>. So you still need to use <code>ImportAction::symbol_text</code>.)</p>
<p>I built the importer API with completions in mind. It might make sense to change <code>ImportAction::symbol_text</code> to return an <code>Edit</code> instead of a <code>&amp;str</code> for your use case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:123 on 2025-11-24 16:23</div>
            <div class="timeline-body"><p>Okay, thanks. I&#x27;ll leave this out for this PR i think, and have a go at it separately.</p>
<p>One thing i am thinking is that I don&#x27;t know how many different formats of types we have like this. If it were just <code>TypeVar</code> and <code>typing.TypeVar</code> I could easily distinguish between them, but I don&#x27;t know other ways this could show.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 16:35</div>
            <div class="timeline-body"><p>Is it ridiculous to try to make some property tests for this?</p>
<p>testing that after the edits have been accepted, that we have valid python syntax? And possibly no diagnostics on the file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 16:37</div>
            <div class="timeline-body"><p>More tests is more better, I would have been lazy and just snapshot-tested like the rest of the IDE stuff ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 16:38</div>
            <div class="timeline-body"><p>I will try it then, see how it goes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 16:44</div>
            <div class="timeline-body"><p>I will say we have a release tomorrow and I&#x27;d love to get some version of this PR in for that release (not a huge deal if not but I think this will really solidify inlay hints as Useful).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 17:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:986 on 2025-11-24 17:47</div>
            <div class="timeline-body"><p>We should not edit here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-24 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-24 18:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:123 on 2025-11-24 18:29</div>
            <div class="timeline-body"><p>FWIW, <code>T: TypeVar = TypeVar(&quot;T&quot;)</code> is an invalid TypeVar declaration that <a href="https://play.ty.dev/a43cc2d3-739f-42a2-a290-d6b9a57b6e6a">ty will complain about</a>, so we maybe shouldn&#x27;t be offering a code action to add that to the user&#x27;s code ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:451 on 2025-11-24 19:01</div>
            <div class="timeline-body"><p>Oh great call on this -- I might also call this <code>is_valid_syntax</code>, since that&#x27;s ultimately the crux?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:5805 on 2025-11-24 19:04</div>
            <div class="timeline-body"><p>(can be a followup) i have a sneaking suspicion this is a fake type</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/ty_python_semantic/src/types/definition.rs</code>:67 on 2025-11-24 19:08</div>
            <div class="timeline-body"><p>Is this code from the auto-import stuff?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-11-24 19:08</div>
            <div class="timeline-body"><p>Rad! Just a few nits.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_python_semantic/src/types/definition.rs</code>:67 on 2025-11-24 19:13</div>
            <div class="timeline-body"><p>yeah, will remove, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 19:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 19:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:5805 on 2025-11-24 19:13</div>
            <div class="timeline-body"><p>yeah this didnt look great</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:451 on 2025-11-24 19:18</div>
            <div class="timeline-body"><p>I guess its &quot;if we add an annotation is it valid syntax&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 19:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:451 on 2025-11-24 19:22</div>
            <div class="timeline-body"><p>But I&#x27;m not sure how to name that, &quot;is_valid_syntax&quot; doesn&#x27;t seem exactly correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-24 19:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/ty_ide/src/inlay_hints.rs</code>:451 on 2025-11-24 19:24</div>
            <div class="timeline-body"><p>annotations_are_valid_syntax?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-11-24 19:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-24 20:01</div>
            <div class="timeline-body"><p>Hell yes hell yeah let&#x27;s kick this things tires</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-27 00:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:59 UTC
    </footer>
</body>
</html>
