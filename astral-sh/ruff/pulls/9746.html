<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix bug where selection included deprecated rules during preview - astral-sh/ruff #9746</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix bug where selection included deprecated rules during preview</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9746">#9746</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-01-31 17:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Cherry-picked from <a href="https://github.com/astral-sh/ruff/pull/9714">astral-sh/ruff#9714</a> which is being abandoned for now because we need to invest more into our redirection infrastructure before it is feasible.</p>
<p>Fixes a bug in the implementation where we improperly included deprecated rules in <code>RuleSelector.rules()</code> when preview is on. Includes some clean-up of error messages and the implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-31 17:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-31 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-01-31 17:55</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>encountered linter errors</strong>. (no lint changes; 1 project error)</p>
<a href="https://github.com/sphinx-doc/sphinx">sphinx-doc/sphinx</a> (error)
<p>

<pre><code>warning: The `show-source` option has been deprecated in favor of `output-format`&#x27;s &quot;full&quot; and &quot;concise&quot; variants. Please update your configuration to use `output-format = &lt;full|concise&gt;` instead.
ruff failed
  Cause: Selection of unstable rules without the `--preview` flag is not allowed. Enable preview or remove selection of:
	- FURB131
	- FURB113
	- FURB132
</code></pre>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -33929 violations, +0 -0 fixes in 4 projects; 2 project errors; 37 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -22899 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/__init__.py#L46">airflow/api/__init__.py:46:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/auth/backend/kerberos_auth.py#L73">airflow/api/auth/backend/kerberos_auth.py:73:18:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L27">airflow/api/client/api_client.py:27:18:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L33">airflow/api/client/api_client.py:33:21:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L45">airflow/api/client/api_client.py:45:20:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L52">airflow/api/client/api_client.py:52:18:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L59">airflow/api/client/api_client.py:59:19:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L63">airflow/api/client/api_client.py:63:21:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L73">airflow/api/client/api_client.py:73:21:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/api_client.py#L80">airflow/api/client/api_client.py:80:21:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/json_client.py#L100">airflow/api/client/json_client.py:100:19:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/json_client.py#L111">airflow/api/client/json_client.py:111:21:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/json_client.py#L132">airflow/api/client/json_client.py:132:21:</a> ANN101 Missing type annotation for `self` in method
... 22043 additional changes omitted for rule ANN101
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/client/local_client.py#L80">airflow/api/client/local_client.py:80:13:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/common/experimental/get_code.py#L41">airflow/api/common/experimental/get_code.py:41:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api/common/experimental/pool.py#L65">airflow/api/common/experimental/pool.py:65:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/connection_endpoint.py#L131">airflow/api_connexion/endpoints/connection_endpoint.py:131:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/connection_endpoint.py#L164">airflow/api_connexion/endpoints/connection_endpoint.py:164:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/connection_endpoint.py#L169">airflow/api_connexion/endpoints/connection_endpoint.py:169:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/connection_endpoint.py#L206">airflow/api_connexion/endpoints/connection_endpoint.py:206:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/dag_endpoint.py#L138">airflow/api_connexion/endpoints/dag_endpoint.py:138:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/dag_endpoint.py#L148">airflow/api_connexion/endpoints/dag_endpoint.py:148:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/dag_endpoint.py#L171">airflow/api_connexion/endpoints/dag_endpoint.py:171:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/api_connexion/endpoints/dag_endpoint.py#L220">airflow/api_connexion/endpoints/dag_endpoint.py:220:9:</a> TRY200 Use `raise from` to specify exception cause
... 351 additional changes omitted for rule TRY200
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/callbacks/callback_requests.py#L57">airflow/callbacks/callback_requests.py:57:19:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/callbacks/callback_requests.py#L95">airflow/callbacks/callback_requests.py:95:19:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/cli/commands/standalone_command.py#L51">airflow/cli/commands/standalone_command.py:51:20:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/dag_processing/manager.py#L496">airflow/dag_processing/manager.py:496:9:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/dag_processing/processor.py#L420">airflow/dag_processing/processor.py:420:21:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/dag_processing/processor.py#L795">airflow/dag_processing/processor.py:795:21:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/exceptions.py#L223">airflow/exceptions.py:223:15:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/executors/base_executor.py#L498">airflow/executors/base_executor.py:498:21:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/apache/airflow/blob/12da83641ca2778ce37fe3e223a3506254c6237a/airflow/executors/executor_loader.py#L121">airflow/executors/executor_loader.py:121:9:</a> ANN102 Missing type annotation for `cls` in classmethod
... 22866 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+0 -4125 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/output/apis/autoload_static.py#L32">examples/output/apis/autoload_static.py:32:20:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/output/apis/autoload_static.py#L34">examples/output/apis/autoload_static.py:34:13:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/output/apis/autoload_static.py#L41">examples/output/apis/autoload_static.py:41:20:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/output/apis/autoload_static.py#L43">examples/output/apis/autoload_static.py:43:13:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/server/api/tornado_embed.py#L15">examples/server/api/tornado_embed.py:15:13:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/server/app/server_auth/auth.py#L27">examples/server/app/server_auth/auth.py:27:13:</a> ANN101 Missing type annotation for `self` in method
... 4003 additional changes omitted for rule ANN101
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/session.py#L524">src/bokeh/client/session.py:524:28:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/color.py#L115">src/bokeh/colors/color.py:115:18:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/color.py#L132">src/bokeh/colors/color.py:132:18:</a> ANN102 Missing type annotation for `cls` in classmethod
- <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/colors/color.py#L245">src/bokeh/colors/color.py:245:18:</a> ANN102 Missing type annotation for `cls` in classmethod
... 4115 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/ibis-project/ibis">ibis-project/ibis</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/ibis-project/ibis/blob/80e13b40496ca70908217383810a43b38f175d96/ibis/common/tests/test_graph.py#L25">ibis/common/tests/test_graph.py:25:22:</a> RUF023 [*] `MyNode.__match_args__` is not sorted
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+0 -6905 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/lib/counts.py#L105">analytics/lib/counts.py:105:9:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/lib/counts.py#L112">analytics/lib/counts.py:112:26:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/lib/counts.py#L49">analytics/lib/counts.py:49:24:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/lib/counts.py#L55">analytics/lib/counts.py:55:9:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/lib/counts.py#L73">analytics/lib/counts.py:73:18:</a> ANN101 Missing type annotation for `self` in method
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/lib/counts.py#L76">analytics/lib/counts.py:76:30:</a> ANN101 Missing type annotation for `self` in method
... 6614 additional changes omitted for rule ANN101
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/analytics/views/stats.py#L156">analytics/views/stats.py:156:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/confirmation/models.py#L102">confirmation/models.py:102:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/corporate/lib/registration.py#L115">corporate/lib/registration.py:115:9:</a> TRY200 Use `raise from` to specify exception cause
- <a href="https://github.com/zulip/zulip/blob/b522ffa3170e7acecd2029a68d9cd331b336f883/corporate/lib/remote_billing_util.py#L124">corporate/lib/remote_billing_util.py:124:9:</a> TRY200 Use `raise from` to specify exception cause
... 6895 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/fronzbot/blinkpy">fronzbot/blinkpy</a> (error)
<p>
<pre>ruff check --no-cache --exit-zero --output-format concise --preview</pre>
</p>
<p>

<pre><code>warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in your configuration:
  - &#x27;ignore&#x27; -&gt; &#x27;lint.ignore&#x27;
  - &#x27;select&#x27; -&gt; &#x27;lint.select&#x27;
  - &#x27;mccabe&#x27; -&gt; &#x27;lint.mccabe&#x27;
  - &#x27;per-file-ignores&#x27; -&gt; &#x27;lint.per-file-ignores&#x27;


ruff failed
  Cause: Selection of deprecated rule `TRY200` is not allowed when preview mode is enabled.
</code></pre>
</p>

<a href="https://github.com/sphinx-doc/sphinx">sphinx-doc/sphinx</a> (error)
<p>
<pre>ruff check --no-cache --exit-zero --output-format concise --preview</pre>
</p>
<p>

<pre><code>warning: The `show-source` option has been deprecated in favor of `output-format`&#x27;s &quot;full&quot; and &quot;concise&quot; variants. Please update your configuration to use `output-format = &lt;full|concise&gt;` instead.
ruff failed
  Cause: Selection of deprecated rule `ANN102` is not allowed when preview mode is enabled.
</code></pre>
</p>

Changes by rule (4 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| ANN101 | 32681 | 0 | 32681 | 0 | 0 |
| TRY200 | 636 | 0 | 636 | 0 | 0 |
| ANN102 | 612 | 0 | 612 | 0 | 0 |
| RUF023 | 1 | 1 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-01 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-01 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-01 14:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:01:18 UTC
    </footer>
</body>
</html>
