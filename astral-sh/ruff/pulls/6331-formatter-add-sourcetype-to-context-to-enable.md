```yaml
number: 6331
title: "Formatter: Add SourceType to context to enable special formatting for stub files"
type: pull_request
state: merged
author: konstin
labels:
  - formatter
assignees: []
merged: true
base: main
head: add-source-type-option
created_at: 2023-08-04T07:37:21Z
updated_at: 2023-08-04T23:28:02Z
url: https://github.com/astral-sh/ruff/pull/6331
synced_at: 2026-01-12T15:55:21Z
```

# Formatter: Add SourceType to context to enable special formatting for stub files

---

_@konstin_

**Summary** This adds the information whether we're in a .py python source file or in a .pyi stub file to enable people working on #5822 and related issues.

I'm not completely happy with `Default` for something that depends on the input.

**Test Plan** None, this is currently unused, i'm leaving this to first implementation of stub file specific formatting.


---

_Comment by @konstin on 2023-08-04 07:37_

Current dependencies on/for this PR:
* main
  * **PR #6330** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6330" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #6331** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6331" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6331?utm_source=stack-comment).

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/options.rs`:29 on 2023-08-04 08:00_

https://github.com/astral-sh/ruff/pull/5552/ introduces a new [`PySourceType`](https://github.com/astral-sh/ruff/blob/dhruv/jupyter-cell-magic/crates/ruff/src/source_kind.rs). What do you think of moving `PySourceType` to `ruff_python_ast` and re-using it here?

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/options.rs`:6 on 2023-08-04 08:01_

```suggestion
#[derive(Copy, Clone, Debug)]
```

---

_@MichaReiser approved on 2023-08-04 08:02_

---

_Label `formatter` added by @MichaReiser on 2023-08-04 08:02_

---

_Comment by @github-actions[bot] on 2023-08-04 08:14_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                    pr
-----                                      ----                                    --
formatter/large/dataset.py                 1.00      9.7Â±0.28ms     4.2 MB/sec     1.03      9.9Â±0.33ms     4.1 MB/sec
formatter/numpy/ctypeslib.py               1.00  1888.7Â±56.00Âµs     8.8 MB/sec     1.03  1951.1Â±96.49Âµs     8.5 MB/sec
formatter/numpy/globals.py                 1.00   215.7Â±11.17Âµs    13.7 MB/sec     1.03   223.1Â±13.87Âµs    13.2 MB/sec
formatter/pydantic/types.py                1.00      4.1Â±0.14ms     6.2 MB/sec     1.02      4.2Â±0.14ms     6.1 MB/sec
linter/all-rules/large/dataset.py          1.00     13.7Â±0.36ms     3.0 MB/sec     1.00     13.7Â±0.36ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      3.4Â±0.09ms     4.9 MB/sec     1.00      3.4Â±0.11ms     4.9 MB/sec
linter/all-rules/numpy/globals.py          1.00   483.2Â±16.57Âµs     6.1 MB/sec     1.00   481.3Â±13.50Âµs     6.1 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.3Â±0.20ms     4.1 MB/sec     1.00      6.3Â±0.43ms     4.1 MB/sec
linter/default-rules/large/dataset.py      1.01      6.6Â±0.18ms     6.2 MB/sec     1.00      6.5Â±0.18ms     6.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01  1409.8Â±119.36Âµs    11.8 MB/sec    1.00  1391.9Â±39.96Âµs    12.0 MB/sec
linter/default-rules/numpy/globals.py      1.00    164.3Â±6.93Âµs    18.0 MB/sec     1.01    165.4Â±7.41Âµs    17.8 MB/sec
linter/default-rules/pydantic/types.py     1.01      2.9Â±0.09ms     8.7 MB/sec     1.00      2.9Â±0.08ms     8.8 MB/sec
```

#### Windows
```
group                                      main                                    pr
-----                                      ----                                    --
formatter/large/dataset.py                 1.00     10.4Â±0.69ms     3.9 MB/sec     1.03     10.7Â±0.59ms     3.8 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.1Â±0.13ms     8.0 MB/sec     1.02      2.1Â±0.15ms     7.9 MB/sec
formatter/numpy/globals.py                 1.00   223.1Â±14.91Âµs    13.2 MB/sec     1.07   239.0Â±16.58Âµs    12.3 MB/sec
formatter/pydantic/types.py                1.00      4.5Â±0.31ms     5.7 MB/sec     1.01      4.5Â±0.28ms     5.6 MB/sec
linter/all-rules/large/dataset.py          1.00     14.4Â±0.55ms     2.8 MB/sec     1.03     14.8Â±0.58ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.9Â±0.18ms     4.3 MB/sec     1.02      4.0Â±0.19ms     4.2 MB/sec
linter/all-rules/numpy/globals.py          1.00   492.5Â±30.87Âµs     6.0 MB/sec     1.03   509.3Â±28.10Âµs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.8Â±0.42ms     3.8 MB/sec     1.01      6.9Â±0.29ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.00      7.4Â±0.32ms     5.5 MB/sec     1.03      7.6Â±0.32ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1577.6Â±102.55Âµs    10.6 MB/sec    1.00  1585.4Â±110.73Âµs    10.5 MB/sec
linter/default-rules/numpy/globals.py      1.00   188.5Â±10.98Âµs    15.7 MB/sec     1.01   189.9Â±10.64Âµs    15.5 MB/sec
linter/default-rules/pydantic/types.py     1.02      3.3Â±0.13ms     7.6 MB/sec     1.00      3.3Â±0.16ms     7.8 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_@konstin reviewed on 2023-08-04 08:48_

---

_Review comment by @konstin on `crates/ruff_python_formatter/src/options.rs`:29 on 2023-08-04 08:48_

-.- i was searching for this and couldn't find it, thanks

---

_Comment by @konstin on 2023-08-04 10:58_

@dhruvmanila I've copied most of `PySourceType` from #5552 to ruff_python_ast, i can rebase #5552 on top of this once merged if you want. 

---

_Renamed from "Formatter: Add SourceType to context" to "Formatter: Add SourceType to context to enable special formatting for stub files" by @konstin on 2023-08-04 11:37_

---

_Merged by @konstin on 2023-08-04 11:52_

---

_Closed by @konstin on 2023-08-04 11:52_

---

_Branch deleted on 2023-08-04 11:52_

---

_Comment by @dhruvmanila on 2023-08-04 23:28_

> @dhruvmanila I've copied most of `PySourceType` from #5552 to ruff_python_ast, i can rebase #5552 on top of this once merged if you want.

Hey, thanks for informing. I'll rebase it, no problem :)

---
