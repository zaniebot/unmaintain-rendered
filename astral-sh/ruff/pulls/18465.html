<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Only calculate information for unresolved-reference subdiagnostic if we know we'll emit the diagnostic - astral-sh/ruff #18465</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Only calculate information for unresolved-reference subdiagnostic if we know we&#x27;ll emit the diagnostic</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18465">#18465</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-06-04 17:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>This optimizes some of the logic added in <a href="https://github.com/astral-sh/ruff/pull/18444">astral-sh/ruff#18444</a>. In general, we only calculate information for subdiagnostics if we know we&#x27;ll actually emit the diagnostic. The check to see whether we&#x27;ll emit the diagnostic is work we&#x27;ll definitely have to do whereas the the work to gather information for a subdiagnostic isn&#x27;t work we necessarily have to do if the diagnostic isn&#x27;t going to be emitted at all.</p>
<p>This PR makes us lazier about gathering the information we need for the subdiagnostic, and moves all the subdiagnostic logic into one function rather than having some <code>unresolved-reference</code> subdiagnostic logic in <code>infer.rs</code> and some in <code>diagnostic.rs</code>.</p>
Test Plan
<p><code>cargo test -p ty_python_semantic</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-04 17:11</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-06-04 19:35</div>
            <div class="timeline-body"><p>~~I don&#x27;t see where this is delaying work compared to the prior version from #18444? It seems like in both the old and new version, all the work is in deciding whether an attribute exists in the first place, and in both old and new, that work is done if we are definitely going to emit a diagnostic, and not otherwise.~~ Edit: ah, never mind, I forgot about the early return if <code>context.report_lint(...)</code> returns <code>None</code>.</p>
<p>But this looks like a nice refactor to collect more of the work in one place, either way!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-04 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-04 19:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:12 UTC
    </footer>
</body>
</html>
