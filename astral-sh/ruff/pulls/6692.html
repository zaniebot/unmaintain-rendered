<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rewrite `yield-in-for-loop` to avoid recursing over body - astral-sh/ruff #6692</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rewrite <code>yield-in-for-loop</code> to avoid recursing over body</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6692">#6692</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-08-19 15:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>This is much simpler and avoids (1) multiple passes over the entire function body, (2) requiring the rule to do its own binding tracking (we can just use the semantic model), and (3) a usage of <code>StatementKey</code>.</p>
<p>In general, where we can, we should try to remove these kinds of custom visitors that track name references, and instead rely on the semantic model.</p>
Test Plan
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Rewrite yield-in-for-loop to avoid recursing over body&quot; to &quot;Rewrite `yield-in-for-loop` to avoid recursing over body&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-19 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-19 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-19 15:25</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>✅ ecosystem check detected no changes.</p>
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      3.3±0.02ms    12.4 MB/sec    1.01      3.3±0.01ms    12.3 MB/sec
formatter/numpy/ctypeslib.py               1.00    689.5±1.56µs    24.1 MB/sec    1.00    690.3±2.26µs    24.1 MB/sec
formatter/numpy/globals.py                 1.00     72.5±0.29µs    40.7 MB/sec    1.00     72.3±0.27µs    40.8 MB/sec
formatter/pydantic/types.py                1.00  1339.0±11.22µs    19.0 MB/sec    1.00  1339.2±30.47µs    19.0 MB/sec
linter/all-rules/large/dataset.py          1.01     10.3±0.04ms     4.0 MB/sec    1.00     10.1±0.06ms     4.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      2.8±0.01ms     6.0 MB/sec    1.00      2.7±0.01ms     6.1 MB/sec
linter/all-rules/numpy/globals.py          1.02    397.2±2.13µs     7.4 MB/sec    1.00    389.1±2.74µs     7.6 MB/sec
linter/all-rules/pydantic/types.py         1.02      5.4±0.09ms     4.7 MB/sec    1.00      5.3±0.03ms     4.8 MB/sec
linter/default-rules/large/dataset.py      1.00      5.5±0.03ms     7.4 MB/sec    1.00      5.5±0.01ms     7.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1210.4±15.91µs    13.8 MB/sec    1.01  1223.3±20.96µs    13.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    143.3±4.10µs    20.6 MB/sec    1.04    148.8±6.92µs    19.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.5±0.03ms    10.3 MB/sec    1.00      2.5±0.02ms    10.3 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.02      3.8±0.07ms    10.6 MB/sec    1.00      3.8±0.07ms    10.8 MB/sec
formatter/numpy/ctypeslib.py               1.00   769.0±13.30µs    21.7 MB/sec    1.01   774.4±17.48µs    21.5 MB/sec
formatter/numpy/globals.py                 1.00     78.8±1.37µs    37.4 MB/sec    1.02     80.4±2.82µs    36.7 MB/sec
formatter/pydantic/types.py                1.00  1540.2±22.59µs    16.6 MB/sec    1.02  1571.4±50.32µs    16.2 MB/sec
linter/all-rules/large/dataset.py          1.02     13.3±0.89ms     3.1 MB/sec    1.00     13.1±0.23ms     3.1 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      3.6±0.05ms     4.7 MB/sec    1.00      3.5±0.05ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    444.1±5.93µs     6.6 MB/sec    1.00    445.2±6.93µs     6.6 MB/sec
linter/all-rules/pydantic/types.py         1.01      6.9±0.11ms     3.7 MB/sec    1.00      6.8±0.16ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.00      7.3±0.10ms     5.6 MB/sec    1.00      7.3±0.16ms     5.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1532.7±17.96µs    10.9 MB/sec    1.01  1550.2±22.99µs    10.7 MB/sec
linter/default-rules/numpy/globals.py      1.00    179.4±6.52µs    16.4 MB/sec    1.00    180.0±3.52µs    16.4 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.2±0.04ms     7.9 MB/sec    1.01      3.3±0.05ms     7.8 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-19 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-19 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-19 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:56:28 UTC
    </footer>
</body>
</html>
