<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document `check`'s JSON output format - astral-sh/ruff #13144</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Document <code>check</code>&#x27;s JSON output format</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13144">#13144</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2024-08-29 00:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body"><p>Sources:</p>
<ul>
<li><code>OneIndexed</code>: <a href="https://github.com/astral-sh/ruff/blob/770ef2ab2719de85c8beec348595f1c74177ce7e/crates/ruff_source_file/src/line_index.rs#L294"><code>line_index.rs</code></a></li>
<li><code>Applicability</code>: <a href="https://github.com/astral-sh/ruff/blob/770ef2ab2719de85c8beec348595f1c74177ce7e/crates/ruff_diagnostics/src/fix.rs#L12-L24"><code>fix.rs</code></a></li>
<li><code>SourceLocation</code>: <a href="https://github.com/astral-sh/ruff/blob/770ef2ab2719de85c8beec348595f1c74177ce7e/crates/ruff_source_file/src/lib.rs#L234-L237"><code>lib.rs</code></a></li>
<li><code>ExpandedEdit</code>: <a href="https://github.com/astral-sh/ruff/blob/770ef2ab2719de85c8beec348595f1c74177ce7e/crates/ruff_linter/src/message/json.rs#L155-L159"><code>json.rs</code></a></li>
<li><code>Fix</code>: <a href="https://github.com/astral-sh/ruff/blob/770ef2ab2719de85c8beec348595f1c74177ce7e/crates/ruff_linter/src/message/json.rs#L56-L60"><code>json.rs</code></a></li>
<li><code>Message</code>: <a href="https://github.com/astral-sh/ruff/blob/770ef2ab2719de85c8beec348595f1c74177ce7e/crates/ruff_linter/src/message/json.rs#L81-L90"><code>json.rs</code></a></li>
</ul>
<p><code>Applicability::DisplayOnly</code> doesn&#x27;t seem to be used anywhere, but I guess its serialized value also follows the lowercase rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-29 10:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-29 10:34</div>
            <div class="timeline-body"><p>Thanks! This all looks correct from what I can tell. I guess my only concern would be whether we can remember to keep it up to date</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-29 10:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-29 11:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>docs/linter.md</code>:379 on 2024-08-29 11:22</div>
            <div class="timeline-body"><p>This might be a nit but I don&#x27;t think this is correct because <code>OneIndexed</code> is a custom type defined at:</p>
<p>https://github.com/astral-sh/ruff/blob/f99af16bdae85829a0fa9b00168e7cad23bd7b00/crates/ruff_source_file/src/line_index.rs#L287-L294</p>
<p>which is a range from 1 to <code>usize::MAX</code> (depends on the platform). So, it wouldn&#x27;t include 0 nor negative integers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-29 11:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>docs/linter.md</code>:379 on 2024-08-29 11:24</div>
            <div class="timeline-body"><p>How would you express this in Python -- via a subclass? <code>class OneIndexed(int): ...</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-29 11:27</div>
            <div class="timeline-body"><p>What&#x27;s the intended use-case for this representation? I&#x27;m not exactly sure if it&#x27;s useful to represent this in terms of a language. Maybe we could use a table with three columns (field name, type, description) to make it language agnostic? I agree that we should have the output format somewhere in the documentation but I&#x27;m not sure what the format should be like. I&#x27;d ideally prefer it to be not tied to a specific language.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-08-29 11:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>docs/linter.md</code>:379 on 2024-08-29 11:29</div>
            <div class="timeline-body"><p>I think I&#x27;m more interested in understanding the use-case of this representation first. I agree that we should have the output format in some form in the documentation but I&#x27;m not sure what the format should be like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2024-08-29 11:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>docs/linter.md</code>:379 on 2024-08-29 11:49</div>
            <div class="timeline-body"><p>I intentionally used a type alias and not a new type/class, since this is not for use in real code but for documentation purposes only. Similar choices were also made by, among others, <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#baseTypes">the Language Server Protocol specification</a>:</p>
<pre><code>/**
 * Defines an integer number in the range of -2^31 to 2^31 - 1.
 */
export type integer = number;
</code></pre>
<p>I understand that this choice might cause some confusion. I could add some descriptions if they are necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-08-29 11:57</div>
            <div class="timeline-body"><p>I need to parse Ruff&#x27;s output programmatically. Since I&#x27;m using a statically typed language, a concrete schema is a must. I picked Python because readers of Ruff&#x27;s documentation are expected to be familiar with it, and TypeScript for its popularity as well as flexibility and relatable syntax. If language-agnosticism is a goal, we could also pick, say, <a href="https://json-schema.org/specification">JSON schema</a>.</p>
<p>I would say tabular formats are nowhere as expressive as code snippets. If a reader cares enough about machine-readable output formats, they must also know what interfaces are, in which case they should be able to understand the snippets (in TS&#x27;s case, even if they don&#x27;t know the language).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-30 08:49</div>
            <div class="timeline-body"><p>As it&#x27;s only for documentation purpose, I think it might be better to use another format as I think, as a user, I would mainly be interested in the fields, their types and what the information is about along with some examples as a reference.</p>
<p>@charliermarsh any thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-02 06:52</div>
            <div class="timeline-body"><p>I&#x27;m worried that this gets outdated very quickly and we currently don&#x27;t have a good infrastructure to generate typescript or python types from source (unlike BiomeJS for JS).</p>
<p>I would prefer if we generated and committed a JSON schema instead, to which we can link, similar to what we do with the configuration schema. We already have the infrastructure for it in place, and it doesn&#x27;t require manual changes to keep it up to date.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-09-02 07:06</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m worried that this gets outdated very quickly</p>
</blockquote>
<p>I doubt that this will happen mainly because the output format doesn&#x27;t really change that often. I think the last time it was changed was for the syntax error in 0.5 and before that was to add the <code>cell</code> field. I agree that there&#x27;s no way to automate this though.</p>
<blockquote>
<p>I would prefer if we generated and committed a JSON schema instead, to which we can link, similar to what we do with the configuration schema. We already have the infrastructure for it in place, and it doesn&#x27;t require manual changes to keep it up to date.</p>
</blockquote>
<p>I think this will require adding a structure for the same as currently the code constructs the string directly:</p>
<p>https://github.com/astral-sh/ruff/blob/c594ebe0e4bd0ca0b33e64f31540407f35c11bb0/crates/ruff_linter/src/message/json.rs#L51-L92</p>
<p>Adding a struct can also be used to generate the user facing documentation like https://docs.astral.sh/ruff/settings/ instead of linking to the JSON schema.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-18 07:26</div>
            <div class="timeline-body"><p>Let me know if you plan to continue working on this and we can re-open the PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-18 07:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-09-18 08:17</div>
            <div class="timeline-body"><p>@MichaReiser I do plan to, but if it&#x27;s preferred that the schema be automatically generated and the logic rewritten to accommodate that, then I&#x27;m fine with this PR being closed.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:06:24 UTC
    </footer>
</body>
</html>
