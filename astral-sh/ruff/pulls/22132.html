<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Make a server snapshot less painful to update - astral-sh/ruff #22132</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Make a server snapshot less painful to update</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22132">#22132</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-21 20:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Currently this snapshot feels like it causes quite a lot of development pain (at least for me), because I never think to run the <code>ty_server</code> tests if all I'm doing is adding a new diagnostic to the <code>ty_python_semantic</code> crate. So I always push my PR and only remember that there's this snapshot that also needs to be updated when CI starts failing on my PR.</p>
<p>This PR adds a new filter to the snapshot so that the snapshot no longer lists every rule that ty has, meaning that the snapshot no longer needs to be updated every time we add a new diagnostic to <code>ty_python_semantic</code>.</p>
<h2>Test Plan</h2>
<p><code>cargo test -p ty_server</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @AlexWaygood on 2025-12-21 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-12-21 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2025-12-21 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-12-21 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-12-21 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-12-21 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/commands.rs</code>:50 on 2025-12-22 08:38</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            (r&quot;rules: \{(.|\n)+?\}\,&quot;,&quot;rules: &lt;RULES&gt;,&quot;),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-12-22 08:39</div>
            <div class="timeline-body"><p>It would be nice to retain at least a few rules to see how the output looks like but that's a bit tricky, I think</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-12-22 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-12-22 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-22 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-22 12:18</div>
            <div class="timeline-body"><blockquote>
<p>It would be nice to retain at least a few rules to see how the output looks like but that's a bit tricky, I think</p>
</blockquote>
<p>I guess a way of doing that would be to have a mock rule registry with a stable list of rules, and snapshot the debug command with that mock? But yeah, sounds nontrivial to setup</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:18:20 UTC
    </footer>
</body>
</html>
