<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Improve several &quot;Did you mean?&quot; suggestions - astral-sh/ruff #21597</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Improve several &quot;Did you mean?&quot; suggestions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21597">#21597</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-11-23 20:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-23 20:21</div>
            <div class="timeline-body"><h2>Summary</h2>
<ul>
<li>Make some diagnostics more concise by moving suggestions from a subdiagnostic to a primary or secondary annotation message</li>
<li>Make some diagnostic summary lines more concise by moving suggestions from the diagnostic summary line to subdiagnostics</li>
<li>Consistently use the <code>help</code> severity for suggestions when they do appear as subdiagnostics, rather than the <code>info</code> severity</li>
</ul>
<h2>Test Plan</h2>
<p>Snapshots</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-11-23 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @AlexWaygood on 2025-11-23 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder/type_expression.rs</code>:159 on 2025-11-23 20:23</div>
            <div class="timeline-body"><p>we don't have any tests for this subdiagnostic and I'm not convinced it's likely to be helpful. If a user has <code>int + str</code> in a type expression, I think it's very unclear what they meant; if they have <code>int - bool</code>, I think it's likely that they were trying to write a negation type rather than a union type; etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-23 20:23</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<details>
<summary>Changes were detected when running ty on typing conformance tests</summary>

<pre><code class="language-diff">--- old-output.txt	2025-11-23 20:23:14.805065538 +0000
+++ new-output.txt	2025-11-23 20:23:18.493085157 +0000
@@ -78,7 +78,7 @@
 annotations_forward_refs.py:47:10: error[invalid-type-form] Invalid subscript of object of type `list[Unknown | &lt;class 'int'&gt;]` in type expression
 annotations_forward_refs.py:49:10: error[invalid-type-form] Variable of type `Literal[1]` is not allowed in a type expression
 annotations_forward_refs.py:54:11: error[fstring-type-annotation] Type expressions cannot use f-strings
-annotations_forward_refs.py:55:11: error[invalid-type-form] Variable of type `&lt;module 'types'&gt;` is not allowed in a type expression
+annotations_forward_refs.py:55:11: error[invalid-type-form] Module `types` is not valid in a type expression
 annotations_forward_refs.py:80:14: error[unresolved-reference] Name `ClassF` used when not defined
 annotations_forward_refs.py:82:11: error[invalid-type-form] Variable of type `Literal[&quot;&quot;]` is not allowed in a type expression
 annotations_forward_refs.py:87:9: error[invalid-type-form] Variable of type `def int(self) -&gt; None` is not allowed in a type expression
@@ -110,7 +110,7 @@
 annotations_typeexpr.py:99:10: error[invalid-type-form] Unary operations are not allowed in type expressions
 annotations_typeexpr.py:100:10: error[invalid-type-form] Boolean operations are not allowed in type expressions
 annotations_typeexpr.py:101:10: error[fstring-type-annotation] Type expressions cannot use f-strings
-annotations_typeexpr.py:102:10: error[invalid-type-form] Variable of type `&lt;module 'types'&gt;` is not allowed in a type expression
+annotations_typeexpr.py:102:10: error[invalid-type-form] Module `types` is not valid in a type expression
 callables_annotation.py:25:5: error[missing-argument] No argument provided for required parameter 2
 callables_annotation.py:26:11: error[invalid-argument-type] Argument is incorrect: Expected `str`, found `Literal[2]`
 callables_annotation.py:27:15: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
@@ -1001,6 +1001,6 @@
 typeddicts_usage.py:24:17: error[invalid-assignment] Invalid assignment to key &quot;year&quot; with declared type `int` on TypedDict `Movie`: value of type `Literal[&quot;1982&quot;]`
 typeddicts_usage.py:28:17: error[missing-typed-dict-key] Missing required key 'name' in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Unknown key &quot;title&quot; for TypedDict `Movie`: Unknown key &quot;title&quot;
-typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions. Did you mean to use a concrete TypedDict or `collections.abc.Mapping[str, object]` instead?
+typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions
 Found 1004 diagnostics
 WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-23 20:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AlexWaygood on 2025-11-23 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-11-23 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-11-23 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-11-23 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-23 20:25</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">rich (https://github.com/Textualize/rich)
- tests/test_console.py:290:35: error[invalid-type-form] Variable of type `&lt;module 'datetime'&gt;` is not allowed in a type expression
+ tests/test_console.py:290:35: error[invalid-type-form] Module `datetime` is not valid in a type expression: Did you mean to use the module's member `datetime.datetime`?

prefect (https://github.com/PrefectHQ/prefect)
- src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:701:24: error[invalid-type-form] Variable of type `&lt;module 'datetime'&gt;` is not allowed in a type expression
- src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:702:10: error[invalid-type-form] Variable of type `&lt;module 'datetime'&gt;` is not allowed in a type expression
- src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:742:63: error[invalid-type-form] Variable of type `&lt;module 'datetime'&gt;` is not allowed in a type expression
- src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:742:76: error[invalid-type-form] Variable of type `&lt;module 'datetime'&gt;` is not allowed in a type expression
+ src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:701:24: error[invalid-type-form] Module `datetime` is not valid in a type expression: Did you mean to use the module's member `datetime.datetime`?
+ src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:702:10: error[invalid-type-form] Module `datetime` is not valid in a type expression: Did you mean to use the module's member `datetime.datetime`?
+ src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:742:63: error[invalid-type-form] Module `datetime` is not valid in a type expression: Did you mean to use the module's member `datetime.datetime`?
+ src/integrations/prefect-snowflake/prefect_snowflake/experimental/workers/spcs.py:742:76: error[invalid-type-form] Module `datetime` is not valid in a type expression: Did you mean to use the module's member `datetime.datetime`?

ibis (https://github.com/ibis-project/ibis)
- ibis/backends/snowflake/tests/test_udf.py:67:22: error[invalid-type-form] Variable of type `&lt;module 'json'&gt;` is not allowed in a type expression
+ ibis/backends/snowflake/tests/test_udf.py:67:22: error[invalid-type-form] Module `json` is not valid in a type expression
- ibis/expr/datatypes/tests/test_core.py:150:8: error[invalid-type-form] Variable of type `&lt;module 'decimal'&gt;` is not allowed in a type expression
+ ibis/expr/datatypes/tests/test_core.py:150:8: error[invalid-type-form] Module `decimal` is not valid in a type expression


</code></pre>
</details>

<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-23 20:27</div>
            <div class="timeline-body"><p>Screenshot of some of the new diagnostics, since snapshots don't have colour:
<img width="1832" height="1324" alt="image" src="https://github.com/user-attachments/assets/f1fc30ec-a288-40b8-8b18-4e9684755d87" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-24 07:42</div>
            <div class="timeline-body"><blockquote>
<p>Make some diagnostics more concise by moving suggestions from a subdiagnostic to a primary or secondary annotation message</p>
</blockquote>
<p>I think I've a preference towards not doing that because it makes the <code>concise</code> output less concise and I also find it a bit confusing that the description of some underlined item is a question.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-24 07:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8643 on 2025-11-24 07:43</div>
            <div class="timeline-body"><p>This should be &quot;easy&quot; once my unused suppression PR lands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-24 07:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/infer/builder/type_expression.rs</code>:159 on 2025-11-24 07:44</div>
            <div class="timeline-body"><p>We could say something about that only <code>|</code> is allowed to define a union.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-24 07:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8650 on 2025-11-24 07:45</div>
            <div class="timeline-body"><p>I think I know what it is but it might not be clear to all users what a concrete <code>TypedDict</code> is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-24 07:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer/builder/type_expression.rs</code>:159 on 2025-11-24 07:46</div>
            <div class="timeline-body"><p>We could, but we already link to the full type expression grammar in a separate subdiagnostic (which covers that), and I think it's very unclear that they were actually trying too define a union at all</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8650 on 2025-11-24 07:53</div>
            <div class="timeline-body"><p>A type that actually is a TypedDict, rather than the special form typing.TypedDict itself.</p>
<pre><code class="language-py">from typing import TypedDict

class MyTypedDict(TypedDict):
    x: int

obj: MyTypedDict
</code></pre>
<p>instead of</p>
<pre><code class="language-py">from typing import TypedDict

obj: TypedDict
</code></pre>
<p>I take your point that this might be unclear to some people, but I'm not sure what clearer wording here might be... &quot;An actual TypedDict&quot; feels just as bad. And I can't put that whole example in the subdiagnostic!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-24 07:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-24 08:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8650 on 2025-11-24 08:07</div>
            <div class="timeline-body"><p>Okay, I actually assumed it's something different ðŸ˜…</p>
<p>But I agree it's tricky. I tried to produce a similar error in TypeScript but they don't have this issue because it doesn't have marker types similar to <code>TypedDict</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-24 08:46</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Make some diagnostics more concise by moving suggestions from a subdiagnostic to a primary or secondary annotation message</p>
</blockquote>
<p>I think I've a preference towards not doing that because it makes the <code>concise</code> output less concise and I also find it a bit confusing that the description of some underlined item is a question.</p>
</blockquote>
<p>If we are confident in our suggestion, I like the change here. I always look at the primary annotation before I even read the main diagnostic message, and if it's directly &quot;actionable&quot;, that's perfect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-24 10:02</div>
            <div class="timeline-body"><p>Yeah, I agree with @sharkdp. If we have a direct suggestion for how to fix the diagnostic, that feels like one of the most important and useful parts of the diagnostic display to me. I think it's really useful to have that highlighted prominently, and I like that with secondary annotations we can clearly indicate that we might only be suggesting to change <em>part</em> of the diagnostic range, not necessarily the whole range.</p>
<blockquote>
<p>it makes the <code>concise</code> output less concise</p>
</blockquote>
<p>That's true of course, but to me it seems like very useful information that I'd want as part of the concise diagnostic. And I don't think the new concise diagnostic messages we see in mypy_primer are <em>that</em> verbose?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-24 10:15</div>
            <div class="timeline-body"><p>I wonder if the solution here really is to just attach a <code>Fix</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-11-24 22:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-25 10:28</div>
            <div class="timeline-body"><p>I'll land this for now as an incremental improvement. It's easy to make further adjustments later and we can easily re-evaluate if and when we add fixes for some or all of these diagnostics</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-11-25 10:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-11-25 10:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-25 10:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:48:27 UTC
    </footer>
</body>
</html>
