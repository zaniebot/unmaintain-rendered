<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autofix for `none-not-at-end-of-union (RUF036)` - astral-sh/ruff #15139</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Autofix for <code>none-not-at-end-of-union (RUF036)</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15139">#15139</a>
        opened by <a href="https://github.com/harupy">@harupy</a>
        on 2024-12-25 03:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/harupy">@harupy</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>Close #15136. Implement autofix for <code>none-not-at-end-of-union (RUF036)</code></p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>Existing and new tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-25 03:42</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -82 violations, +390 -0 fixes in 18 projects; 37 projects unchanged)</p>
<details><summary><a href="https://github.com/DisnakeDev/disnake">DisnakeDev/disnake</a> (+0 -0 violations, +2 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/DisnakeDev/disnake/blob/2867a91ca15f06f6f5387cd74cdb6b72472865d5/tests/test_utils.py#L782'>tests/test_utils.py:782:25:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/DisnakeDev/disnake/blob/2867a91ca15f06f6f5387cd74cdb6b72472865d5/tests/test_utils.py#L782'>tests/test_utils.py:782:25:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+0 -0 violations, +6 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/events.py#L597'>rasa/shared/core/events.py:597:48:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/events.py#L597'>rasa/shared/core/events.py:597:48:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/events.py#L624'>rasa/shared/core/events.py:624:31:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/shared/core/events.py#L624'>rasa/shared/core/events.py:624:31:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/utils/tensorflow/models.py#L247'>rasa/utils/tensorflow/models.py:247:35:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/RasaHQ/rasa/blob/b8de3b231126747ff74b2782cb25cb22d2d898d7/rasa/utils/tensorflow/models.py#L247'>rasa/utils/tensorflow/models.py:247:35:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -0 violations, +242 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/api_fastapi/common/parameters.py#L641'>airflow/api_fastapi/common/parameters.py:641:22:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/api_fastapi/common/parameters.py#L641'>airflow/api_fastapi/common/parameters.py:641:22:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/auth/managers/base_auth_manager.py#L448'>airflow/auth/managers/base_auth_manager.py:448:36:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/auth/managers/base_auth_manager.py#L448'>airflow/auth/managers/base_auth_manager.py:448:36:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/cli/commands/remote_commands/task_command.py#L250'>airflow/cli/commands/remote_commands/task_command.py:250:71:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/cli/commands/remote_commands/task_command.py#L250'>airflow/cli/commands/remote_commands/task_command.py:250:71:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/cli/commands/remote_commands/task_command.py#L336'>airflow/cli/commands/remote_commands/task_command.py:336:46:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/cli/commands/remote_commands/task_command.py#L336'>airflow/cli/commands/remote_commands/task_command.py:336:46:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L117'>airflow/decorators/__init__.pyi:117:23:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L117'>airflow/decorators/__init__.pyi:117:23:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L118'>airflow/decorators/__init__.pyi:118:25:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L118'>airflow/decorators/__init__.pyi:118:25:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L124'>airflow/decorators/__init__.pyi:124:21:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L124'>airflow/decorators/__init__.pyi:124:21:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L125'>airflow/decorators/__init__.pyi:125:26:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L125'>airflow/decorators/__init__.pyi:125:26:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L245'>airflow/decorators/__init__.pyi:245:23:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L245'>airflow/decorators/__init__.pyi:245:23:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L246'>airflow/decorators/__init__.pyi:246:25:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L246'>airflow/decorators/__init__.pyi:246:25:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L252'>airflow/decorators/__init__.pyi:252:21:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L252'>airflow/decorators/__init__.pyi:252:21:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L253'>airflow/decorators/__init__.pyi:253:26:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/decorators/__init__.pyi#L253'>airflow/decorators/__init__.pyi:253:26:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/airflow/blob/23d6d0db70735c8a51981ca4e97bb278eaca446d/airflow/example_dags/plugins/event_listener.py#L93'>airflow/example_dags/plugins/event_listener.py:93:76:</a> RUF036 [*] `None` not at the end of the type annotation.
... 217 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/superset">apache/superset</a> (+0 -0 violations, +10 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/config.py#L1126'>superset/config.py:1126:5:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/config.py#L1126'>superset/config.py:1126:5:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/config.py#L1728'>superset/config.py:1728:43:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/config.py#L1728'>superset/config.py:1728:43:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/config.py#L713'>superset/config.py:713:5:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/config.py#L713'>superset/config.py:713:5:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/db_engine_specs/gsheets.py#L166'>superset/db_engine_specs/gsheets.py:166:26:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/db_engine_specs/gsheets.py#L166'>superset/db_engine_specs/gsheets.py:166:26:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/jinja_context.py#L84'>superset/jinja_context.py:84:16:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/apache/superset/blob/a193d790b23eccd32e843d005d841d6bc590c705/superset/jinja_context.py#L84'>superset/jinja_context.py:84:16:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+0 -0 violations, +6 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/websocket.py#L73'>src/bokeh/client/websocket.py:73:85:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/websocket.py#L73'>src/bokeh/client/websocket.py:73:85:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/embed/standalone.py#L84'>src/bokeh/embed/standalone.py:84:30:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/embed/standalone.py#L84'>src/bokeh/embed/standalone.py:84:30:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/util/tornado.py#L231'>src/bokeh/util/tornado.py:231:26:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/util/tornado.py#L231'>src/bokeh/util/tornado.py:231:26:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/latchbio/latch">latchbio/latch</a> (+0 -0 violations, +14 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch/registry/types.py#L45'>src/latch/registry/types.py:45:5:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch/registry/types.py#L45'>src/latch/registry/types.py:45:5:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch/types/metadata.py#L419'>src/latch/types/metadata.py:419:5:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch/types/metadata.py#L419'>src/latch/types/metadata.py:419:5:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/services/get.py#L38'>src/latch_cli/services/get.py:38:32:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/services/get.py#L38'>src/latch_cli/services/get.py:38:32:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/services/launch.py#L135'>src/latch_cli/services/launch.py:135:46:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/services/launch.py#L135'>src/latch_cli/services/launch.py:135:46:</a> RUF036 `None` not at the end of the type annotation.
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/snakemake/config/utils.py#L12'>src/latch_cli/snakemake/config/utils.py:12:53:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/snakemake/config/utils.py#L12'>src/latch_cli/snakemake/config/utils.py:12:53:</a> RUF036 `None` not at the end of the type annotation.
... 4 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/lnbits/lnbits">lnbits/lnbits</a> (+0 -0 violations, +2 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/lnbits/lnbits/blob/51c9d294cdb40c777b1048bbee267b49cdaf7a34/lnbits/core/views/payment_api.py#L172'>lnbits/core/views/payment_api.py:172:27:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/lnbits/lnbits/blob/51c9d294cdb40c777b1048bbee267b49cdaf7a34/lnbits/core/views/payment_api.py#L172'>lnbits/core/views/payment_api.py:172:27:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+0 -0 violations, +2 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/milvus-io/pymilvus/blob/a6fbc66270b0c8ee74236bde6afdb229ac5ab648/pymilvus/client/abstract.py#L806'>pymilvus/client/abstract.py:806:40:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/milvus-io/pymilvus/blob/a6fbc66270b0c8ee74236bde6afdb229ac5ab648/pymilvus/client/abstract.py#L806'>pymilvus/client/abstract.py:806:40:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+0 -31 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/dtypes/cast.py#L182'>pandas/core/dtypes/cast.py:182:38:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/dtypes/cast.py#L182'>pandas/core/dtypes/cast.py:182:65:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/dtypes/dtypes.py#L1269'>pandas/core/dtypes/dtypes.py:1269:15:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/groupby/groupby.py#L2784'>pandas/core/groupby/groupby.py:2784:24:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/groupby/groupby.py#L4248'>pandas/core/groupby/groupby.py:4248:22:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/reshape/encoding.py#L367'>pandas/core/reshape/encoding.py:367:10:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/core/reshape/encoding.py#L368'>pandas/core/reshape/encoding.py:368:23:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/io/_util.py#L69'>pandas/io/_util.py:69:41:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/io/excel/_util.py#L181'>pandas/io/excel/_util.py:181:6:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/pandas-dev/pandas/blob/8a5344742c5165b2595f7ccca9e17d5eff7f7886/pandas/io/parsers/readers.py#L101'>pandas/io/parsers/readers.py:101:20:</a> RUF036 `None` not at the end of the type annotation.
... 21 additional changes omitted for project
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pypa/cibuildwheel">pypa/cibuildwheel</a> (+0 -0 violations, +2 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pypa/cibuildwheel/blob/148b87f6fedd1efef6c20af1d18736aa7496888e/cibuildwheel/options.py#L753'>cibuildwheel/options.py:753:41:</a> RUF036 [*] `None` not at the end of the type annotation.
- <a href='https://github.com/pypa/cibuildwheel/blob/148b87f6fedd1efef6c20af1d18736aa7496888e/cibuildwheel/options.py#L753'>cibuildwheel/options.py:753:41:</a> RUF036 `None` not at the end of the type annotation.
</pre>

</p>
</details>
<details><summary><a href="https://github.com/python/typeshed">python/typeshed</a> (+0 -51 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select E,F,FA,I,PYI,RUF,UP,W</pre>
</p>
<p>

<pre>
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1726'>stdlib/ast.pyi:1726:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1736'>stdlib/ast.pyi:1736:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1746'>stdlib/ast.pyi:1746:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1756'>stdlib/ast.pyi:1756:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1765'>stdlib/ast.pyi:1765:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1774'>stdlib/ast.pyi:1774:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1783'>stdlib/ast.pyi:1783:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1793'>stdlib/ast.pyi:1793:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1805'>stdlib/ast.pyi:1805:26:</a> RUF036 `None` not at the end of the type annotation.
- <a href='https://github.com/python/typeshed/blob/dee35e22bb86835fb7209f074dc78e26b29c52e5/stdlib/ast.pyi#L1814'>stdlib/ast.pyi:1814:26:</a> RUF036 `None` not at the end of the type annotation.
... 41 additional changes omitted for project
</pre>

</p>
</details>

<p><em>... Truncated remaining completed project reports due to GitHub comment length restrictions</em></p>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF036 | 472 | 0 | 82 | 390 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/harupy">@harupy</a> reviewed on 2024-12-25 07:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/harupy">@harupy</a> on <code>crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs</code>:103 on 2024-12-25 07:47</div>
            <div class="timeline-body"><p>Should we set the fix to all the diagnostics?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2024-12-25 11:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-12-25 14:37</div>
            <div class="timeline-body"><p>Thanks for working on this! Can you add some tests with nested and mixed uses of unions? Like these:</p>
<pre><code class="language-python">def f(x: None | Union[None ,int]): ...

def g(x: int | (str | None) | list): ...

def h(x: Union[int, Union[None, list | set]]: ...
</code></pre>
<p>also the examples from <code>poetry</code> in the ecosystem check like:</p>
<pre><code class="language-python">    def _detect_active_python(io: None | IO = None) -&gt; Path | None: ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-12-25 14:46</div>
            <div class="timeline-body"><p>It looks like in the ecosystem check a bunch of violations were removed with no fix, so I'm wondering if a syntax error was introduced by the fix. Maybe when there is a default argument something goes wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Daverball">@Daverball</a> on 2024-12-25 21:46</div>
            <div class="timeline-body"><blockquote>
<p>It looks like in the ecosystem check a bunch of violations were removed with no fix, so I'm wondering if a syntax error was introduced by the fix. Maybe when there is a default argument something goes wrong?</p>
</blockquote>
<p>I think this happens for projects where the <code>ruff.toml</code> or <code>pyproject.toml</code> contains <code>fix = true</code>. I also got tripped up by this behavior in some of my pull requests. I think it would be a good idea to change the ecosystem script to pass <code>--no-fix</code>, so this doesn't happen, since the output will always be interpreted incorrectly when fixes have been applied (this can also lead to other confusing things like new E501 flags, because the fix caused a line to get too long, or an unrelated unfixable violation getting flagged, because the fix caused the violation to be slightly offset, so you see a +1 -1 for that violation).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-26 09:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs</code>:109 on 2024-12-26 09:33</div>
            <div class="timeline-body"><pre><code class="language-suggestion">						let (range, separator) = if let Expr::Subscript(ast::ExprSubscript { slice, .. }) = union {
							(slice.range(), &quot;, &quot;))
						} else {
							(union.range, &quot; | &quot;)
						}
            
            let applicability = if checker.comment_ranges().intersects(range) {
                Applicability::Unsafe
            } else {
                Applicability::Safe
            };
            let fix = Fix::applicable_edit(
                Edit::range_replacement(elements.join(separator), range),
                applicability,
            )
            diagnostic.set_fix(fix);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-26 09:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs</code>:103 on 2024-12-26 09:33</div>
            <div class="timeline-body"><p>Can you tell me a bit more why you think we should (or shouldn't) set the fix for all violations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/harupy">@harupy</a> reviewed on 2024-12-26 09:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/harupy">@harupy</a> on <code>crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs</code>:103 on 2024-12-26 09:43</div>
            <div class="timeline-body"><p>@MichaReiser For example, this part looks like the same fix is set to all the diagnostics:</p>
<p>https://github.com/astral-sh/ruff/blob/8b9c843c727de463efccafc7e012414b93458dc7/crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs#L126-L129</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @harupy on 2024-12-27 12:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs</code>:103 on 2024-12-30 13:49</div>
            <div class="timeline-body"><p>I'm actually leaning towards only emitting a single diagnostic rather than emitting multiple diagnostics. This should also simplify the code a bit because we can change <code>none_exprs</code> to an <code>Option</code> only tracking the <code>last_none</code> rather than all <code>None</code> values</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/snapshots/ruff_linter__rules__ruff__tests__RUF036_RUF036.py.snap</code>:62 on 2024-12-30 13:50</div>
            <div class="timeline-body"><p>We should avoid removing duplicate <code>None</code> values. While the second <code>None</code> is useless, it's not what the rule is about</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/snapshots/ruff_linter__rules__ruff__tests__RUF036_RUF036.py.snap</code>:208 on 2024-12-30 13:55</div>
            <div class="timeline-body"><p>The fix here looks incorrect. It flattens the nested <code>U</code> types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-12-30 14:00</div>
            <div class="timeline-body"><p>Thanks for working on this.</p>
<p>The fix now seems to remove duplicate <code>None</code> elements and I think it also isn't handling nesting correctly - see the inline comments in the tests.</p>
<p>I tried to implement a fix that does more narrow edits than regenerating the entire union / subscript but the whitespace handling isn't perfect yet and I haven't looked into some edge cases like quoted annotations or parentheses. But maybe it's useful for you</p>
<pre><code class="language-patch">Index: crates/ruff_python_parser/src/lib.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/crates/ruff_python_parser/src/lib.rs b/crates/ruff_python_parser/src/lib.rs
--- a/crates/ruff_python_parser/src/lib.rs	(revision aa1a5cb2c7ef0dc3b38595a92285066721e626c0)
+++ b/crates/ruff_python_parser/src/lib.rs	(date 1735565508471)
@@ -478,6 +478,35 @@
             }
         }
     }
+
+    /// Returns a slice of tokens before the given [`TextSize`] offset.
+    ///
+    /// If the given offset is between two tokens, the returned slice will start from the following
+    /// token. In other words, if the offset is between the end of previous token and start of next
+    /// token, the returned slice will start from the next token.
+    ///
+    /// # Panics
+    ///
+    /// If the given offset is inside a token range.
+    pub fn before(&amp;self, offset: TextSize) -&gt; &amp;[Token] {
+        match self.binary_search_by(|token| token.start().cmp(&amp;offset)) {
+            Ok(idx) =&gt; &amp;self[..idx],
+            Err(idx) =&gt; {
+                if let Some(prev) = self.get(idx.saturating_sub(1)) {
+                    // If it's equal to the end offset, then it's at a token boundary which is
+                    // valid. If it's greater than the end offset, then it's in the gap between
+                    // the tokens which is valid as well.
+                    assert!(
+                        offset &gt;= prev.end(),
+                        &quot;Offset {:?} is inside a token range {:?}&quot;,
+                        offset,
+                        prev.range()
+                    );
+                }
+                &amp;self[..idx]
+            }
+        }
+    }
 }
 
 impl&lt;'a&gt; IntoIterator for &amp;'a Tokens {
Index: crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs b/crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs
--- a/crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs	(revision aa1a5cb2c7ef0dc3b38595a92285066721e626c0)
+++ b/crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs	(date 1735567068721)
@@ -1,13 +1,14 @@
+use crate::checkers::ast::Checker;
 use itertools::{Itertools, Position};
 use ruff_diagnostics::{Applicability, Diagnostic, Edit, Fix, FixAvailability, Violation};
 use ruff_macros::{derive_message_formats, ViolationMetadata};
 use ruff_python_ast::{self as ast, Expr};
+use ruff_python_parser::TokenKind;
 use ruff_python_semantic::analyze::typing::traverse_union;
-use ruff_text_size::Ranged;
+use ruff_python_trivia::{SimpleTokenKind, SimpleTokenizer};
+use ruff_text_size::{Ranged, TextRange, TextSlice};
 use smallvec::SmallVec;
 
-use crate::checkers::ast::Checker;
-
 /// ## What it does
 /// Checks for type annotations where `None` is not at the end of an union.
 ///
@@ -49,15 +50,13 @@
 /// RUF036
 pub(crate) fn none_not_at_end_of_union&lt;'a&gt;(checker: &amp;mut Checker, union: &amp;'a Expr) {
     let semantic = checker.semantic();
-    let mut none_exprs: SmallVec&lt;[&amp;Expr; 1]&gt; = SmallVec::new();
-    let mut non_none_exprs: SmallVec&lt;[&amp;Expr; 1]&gt; = SmallVec::new();
-    let mut last_expr: Option&lt;&amp;Expr&gt; = None;
+    let mut last_none = None;
+    let mut last_expr: Option&lt;&amp;'a Expr&gt; = None;
     let mut find_none = |expr: &amp;'a Expr, _parent: &amp;Expr| {
-        if matches!(expr, Expr::NoneLiteral(_)) {
-            none_exprs.push(expr);
-        } else {
-            non_none_exprs.push(expr);
+        if expr.is_none_literal_expr() {
+            last_none = Some(expr);
         }
+
         last_expr = Some(expr);
     };
 
@@ -69,40 +68,72 @@
     };
 
     // There must be at least one `None` expression.
-    let Some(last_none) = none_exprs.last() else {
+    let Some(last_none) = last_none else {
         return;
     };
 
     // If any of the `None` literals is last we do not emit.
-    if *last_none == last_expr {
+    if last_none == last_expr {
         return;
     }
 
-    for (pos, none_expr) in none_exprs.iter().with_position() {
-        let mut diagnostic = Diagnostic::new(NoneNotAtEndOfUnion, none_expr.range());
-        if matches!(pos, Position::Last | Position::Only) {
-            let mut elements = non_none_exprs
-                .iter()
-                .map(|expr| checker.locator().slice(expr.range()).to_string())
-                .chain(std::iter::once(&quot;None&quot;.to_string()));
-            let (range, separator) =
-                if let Expr::Subscript(ast::ExprSubscript { slice, .. }) = union {
-                    (slice.range(), &quot;, &quot;)
-                } else {
-                    (union.range(), &quot; | &quot;)
-                };
-            let applicability = if checker.comment_ranges().intersects(range) {
-                Applicability::Unsafe
-            } else {
-                Applicability::Safe
-            };
-            let fix = Fix::applicable_edit(
-                Edit::range_replacement(elements.join(separator), range),
-                applicability,
-            );
-            diagnostic.set_fix(fix);
-        }
+    let range = if let Expr::Subscript(ast::ExprSubscript { slice, .. }) = union {
+        slice.range()
+    } else {
+        union.range()
+    };
+
+    let preceding_separator = checker.tokens().before(last_none.start());
+
+    let applicability = if checker.comment_ranges().intersects(range) {
+        Applicability::Unsafe
+    } else {
+        Applicability::Safe
+    };
+
+    // ```python
+    // int | None | str
+    // ```
+    let (insertion, range) = if let Some(last) = preceding_separator
+        .last()
+        .filter(|last| matches!(last.kind(), TokenKind::Comma | TokenKind::Vbar))
+    {
+        let range = TextRange::new(last.start(), last_none.end());
+        (
+            Edit::insertion(checker.source().slice(range).to_string(), last_expr.end()),
+            range,
+        )
+    } else {
+        // ```python
+        // None | int
+        // int | (None | str) | Literal[4]
+        // ```
+        let separator_after = checker
+            .tokens()
+            .after(last_none.end())
+            .first()
+            .filter(|token| matches!(token.kind(), TokenKind::Comma | TokenKind::Vbar))
+            .unwrap();
+        (
+            Edit::insertion(
+                format!(
+                    &quot;{separator} None&quot;,
+                    separator = if separator_after.kind() == TokenKind::Comma {
+                        &quot;,&quot;
+                    } else {
+                        &quot;|&quot;
+                    }
+                ),
+                last_expr.end(),
+            ),
+            TextRange::new(last_none.start(), separator_after.end()),
+        )
+    };
+
+    let fix = Fix::applicable_edits(insertion, [Edit::range_deletion(range)], applicability);
+
+    let mut diagnostic = Diagnostic::new(NoneNotAtEndOfUnion, last_none.range());
+    diagnostic.set_fix(fix);
 
-        checker.diagnostics.push(diagnostic);
-    }
+    checker.diagnostics.push(diagnostic);
 }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-01-02 05:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-01-02 05:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/harupy">@harupy</a> reviewed on 2025-01-05 11:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/harupy">@harupy</a> on <code>crates/ruff_linter/src/rules/ruff/rules/none_not_at_end_of_union.rs</code>:103 on 2025-01-05 11:06</div>
            <div class="timeline-body"><p>A single diagnostic makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/harupy">@harupy</a> reviewed on 2025-01-06 14:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/harupy">@harupy</a> on <code>crates/ruff_linter/src/rules/ruff/snapshots/ruff_linter__rules__ruff__tests__RUF036_RUF036.py.snap</code>:208 on 2025-01-06 14:35</div>
            <div class="timeline-body"><p>@MichaReiser Do we need to fix this case? Can we only generate a fix when the type annotation has a single <code>None</code> and no nested unions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-07 07:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/snapshots/ruff_linter__rules__ruff__tests__RUF036_RUF036.py.snap</code>:208 on 2025-01-07 07:39</div>
            <div class="timeline-body"><p>I don't think we necessarily have to but we at least shouldn't provide a fix for those cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-28 07:05</div>
            <div class="timeline-body"><p>This PR has become stale. I'll close it. Feel free to open a new PR if you are interested in implementing this fix, but take the feedback into acocunt.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-04-28 07:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:08:43 UTC
    </footer>
</body>
</html>
