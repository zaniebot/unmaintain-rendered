<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Improve diagnostics for bad calls to functions - astral-sh/ruff #20022</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Improve diagnostics for bad calls to functions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20022">#20022</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-08-21 13:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>It was annoyingly hard to debug <a href="https://github.com/astral-sh/ty/issues/1076">astral-sh/ty#1076</a>. It wasn&#x27;t clear whether ty was resolving the type definition to a location in pandas or pandas-stubs; and it wasn&#x27;t clear what ty thought the signature of the function <em>was</em> (the diagnostic only said that the user had got the signature wrong).</p>
<p>This PR adds subdiagnostics to our <code>missing-argument</code>, <code>too-many-positional-arguments</code> and <code>unknown-argument</code> error codes, so that these will be easier to debug in the future -- both for users, and for us!</p>
<p>I&#x27;ve taken care not to add the subdiagnostics if it&#x27;s a union of callables being called. We currently emit a separate diagnostic for each element of the union; having a sub-diagnostic for each element would probably be too verbose for it to be worth it, in my opinion.</p>
Test Plan
<p>Snapshots.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 13:12</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 13:14</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:45</div>
            <div class="timeline-body"><p>Not sure why GitHub is repeatedly failing to checkout this branch on Windows, but it doesn&#x27;t seem related to the changes being made here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 20:29</div>
            <div class="timeline-body"><p>oh I put a Bad Windows Character in a generated snapshot path, didn&#x27;t I?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-08-21 20:58</div>
            <div class="timeline-body"><p>Nice!</p>
<p>Not sure I agree about unions -- in every case shown in these snapshot tests (and I think probably in the majority of real-world cases, too), there&#x27;s still just one diagnostic because only one element of the union failed the call, and the union context is just an additional info line or two. In all of those cases, I think the extra subdiagnostic (regarding the one union element that failed the call) would be an improvement and useful in debugging, it wouldn&#x27;t be too much info. It&#x27;s possible that there are cases where many union elements fail the call; those might be cases where it makes sense to skip the sub-diagnostic?</p>
<p>But it looks like that would be an additional feature here, not just removing a restriction; I don&#x27;t think we need to spend more time on it now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-21 21:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:17:55 UTC
    </footer>
</body>
</html>
