<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix `PT014` autofix for last item in list - astral-sh/ruff #10532</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix <code>PT014</code> autofix for last item in list</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10532">#10532</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2024-03-23 04:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This error was found browsing https://github.com/qarmin/Automated-Fuzzer/actions/runs/8396966850. Which failed when trying to autofix the PT014 violation in the following code:</p>
<pre><code class="language-python">@pytest.mark.parametrize('data, spec', [(1.0, 1.0), (1.0, 1.0)])
def test_numbers(data, spec):
    ...
</code></pre>
<p>Investigation revealed that the implementation was not properly tested, when the duplicate value was also the last in the list. In particular the following function, which is in charge of finding the comma following an element to create the suggested fix,
https://github.com/astral-sh/ruff/blob/0a99bd84ce90564b10dbb7c3cf51c70922f4daed/crates/ruff_linter/src/rules/flake8_pytest_style/rules/parametrize.rs#L647-L651
would find the next comma even if it was outside the list itself leading to a lot of code being deleted.</p>
<p>This PR fixes that.</p>
<h2>Test Plan</h2>
<p>Added misbehaving code to the test fixture.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-03-23 04:46</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-23 13:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-03-23 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Fix `PT014` invalid fix" to "Fix `PT014` autofix for last item in list" by @charliermarsh on 2024-03-23 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-03-23 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-23 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-23 15:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:03:14 UTC
    </footer>
</body>
</html>
