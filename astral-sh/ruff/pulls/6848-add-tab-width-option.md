```yaml
number: 6848
title: Add tab width option
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: tab-width-option
created_at: 2023-08-24T10:14:00Z
updated_at: 2023-08-26T10:29:59Z
url: https://github.com/astral-sh/ruff/pull/6848
synced_at: 2026-01-12T02:45:38Z
```

# Add tab width option

---

_Pull request opened by @MichaReiser on 2023-08-24 10:14_

## Summary

This adds a new `tab_width` option that gets passed to the Printer. The `tab_width` option specifies the visual width of a tab character. 

## Test Plan

I added a new test. The fact that I had to add options not to regress tests that assumed a tab width of 8 proves that it works :)


---

_Comment by @MichaReiser on 2023-08-24 10:14_

Current dependencies on/for this PR:
* main
  * **PR #6814** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6814" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #6815** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6815" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #6816** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6816" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #6817** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6817" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a> 
          * **PR #6848** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6848" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
          * **PR #6819** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6819" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6848?utm_source=stack-comment).

---

_Review comment by @konstin on `crates/ruff_formatter/src/lib.rs`:128 on 2023-08-24 10:29_

it's a const method, it will unwrap at compile time
```suggestion
        Self(NonZeroU8::new(2).unwrap())
```

---

_@konstin reviewed on 2023-08-24 10:30_

How does this interact with docstring formatting where we have "pad to the next multiple of 8"  hardcoded?

---

_@MichaReiser reviewed on 2023-08-24 10:37_

---

_Review comment by @MichaReiser on `crates/ruff_formatter/src/lib.rs`:128 on 2023-08-24 10:37_

The constness is unstable but yeah, this is probably not worth it

---

_Comment by @github-actions[bot] on 2023-08-24 10:45_

## PR Check Results
### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      4.1Â±0.03ms    10.0 MB/sec    1.01      4.1Â±0.04ms     9.9 MB/sec
formatter/numpy/ctypeslib.py               1.00    852.0Â±2.84Âµs    19.5 MB/sec    1.01    861.2Â±2.70Âµs    19.3 MB/sec
formatter/numpy/globals.py                 1.00     82.0Â±0.65Âµs    36.0 MB/sec    1.01     83.1Â±0.38Âµs    35.5 MB/sec
formatter/pydantic/types.py                1.00   1673.9Â±9.84Âµs    15.2 MB/sec    1.01   1689.5Â±9.87Âµs    15.1 MB/sec
linter/all-rules/large/dataset.py          1.01     10.3Â±0.11ms     3.9 MB/sec    1.00     10.2Â±0.07ms     4.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      2.7Â±0.01ms     6.1 MB/sec    1.00      2.7Â±0.01ms     6.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    387.0Â±1.15Âµs     7.6 MB/sec    1.01    390.0Â±2.88Âµs     7.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.3Â±0.04ms     4.8 MB/sec    1.00      5.3Â±0.03ms     4.8 MB/sec
linter/default-rules/large/dataset.py      1.00      5.4Â±0.02ms     7.5 MB/sec    1.00      5.4Â±0.03ms     7.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1205.6Â±5.41Âµs    13.8 MB/sec    1.00  1210.3Â±15.90Âµs    13.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    141.1Â±0.33Âµs    20.9 MB/sec    1.00    141.2Â±0.72Âµs    20.9 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.5Â±0.00ms    10.3 MB/sec    1.00      2.5Â±0.02ms    10.3 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      4.6Â±0.07ms     8.9 MB/sec    1.00      4.6Â±0.03ms     8.9 MB/sec
formatter/numpy/ctypeslib.py               1.00    912.4Â±8.05Âµs    18.3 MB/sec    1.02   926.5Â±21.45Âµs    18.0 MB/sec
formatter/numpy/globals.py                 1.00     85.8Â±1.04Âµs    34.4 MB/sec    1.02     87.4Â±1.22Âµs    33.7 MB/sec
formatter/pydantic/types.py                1.00  1864.7Â±22.29Âµs    13.7 MB/sec    1.00  1868.2Â±14.92Âµs    13.7 MB/sec
linter/all-rules/large/dataset.py          1.00     12.5Â±0.09ms     3.3 MB/sec    1.01     12.6Â±0.13ms     3.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5Â±0.02ms     4.7 MB/sec    1.00      3.5Â±0.02ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    361.1Â±4.94Âµs     8.2 MB/sec    1.02    367.0Â±7.12Âµs     8.0 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.5Â±0.06ms     3.9 MB/sec    1.01      6.6Â±0.05ms     3.9 MB/sec
linter/default-rules/large/dataset.py      1.00      7.0Â±0.04ms     5.8 MB/sec    1.01      7.0Â±0.09ms     5.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1457.6Â±14.37Âµs    11.4 MB/sec    1.01  1478.2Â±15.93Âµs    11.3 MB/sec
linter/default-rules/numpy/globals.py      1.00    151.9Â±1.55Âµs    19.4 MB/sec    1.00    152.1Â±1.64Âµs    19.4 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.1Â±0.02ms     8.1 MB/sec    1.00      3.1Â±0.03ms     8.1 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Label `formatter` added by @MichaReiser on 2023-08-24 11:15_

---

_Comment by @MichaReiser on 2023-08-24 11:19_

> How does this interact with docstring formatting where we have "pad to the next multiple of 8" hardcoded?

Thanks for pointing this out. I changed the docstring padding to use the value from the options. Deviating here isn't an issue because a) people chan change the option b) this is only relevant for not blacked projects (adoption)

---

_Marked ready for review by @MichaReiser on 2023-08-24 11:21_

---

_Renamed from "Add tabwidth option" to "Add tab width option" by @MichaReiser on 2023-08-24 12:11_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-08-25 16:03_

---

_Comment by @MichaReiser on 2023-08-26 10:29_

Merging because it is a simple enough change and there's other work that depends on it.

---

_Merged by @MichaReiser on 2023-08-26 10:29_

---

_Closed by @MichaReiser on 2023-08-26 10:29_

---

_Branch deleted on 2023-08-26 10:29_

---
