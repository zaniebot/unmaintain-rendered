<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Add `unnecessary_ellipsis` (`W2301`) - astral-sh/ruff #4726</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Add <code>unnecessary_ellipsis</code> (<code>W2301</code>)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4726">#4726</a>
        opened by <a href="https://github.com/hoel-bagard">@hoel-bagard</a>
        on 2023-05-30 15:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR is part of https://github.com/charliermarsh/ruff/issues/970, it adds the <code>PLW2301</code> warning rule along with its fix.</p>
<h2>Test Plan</h2>
<p>The test fixture uses the one from pylint, whit a few added tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-05-30 15:27</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+27, -0, 0 error(s))</p>
<details><summary>airflow (+20, -0)</summary>
<p>

<pre><code class="language-diff">+ airflow/hooks/base.py:158:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/hooks/base.py:178:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/jobs/scheduler_job_runner.py:1542:13: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/metrics/protocols.py:40:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/metrics/protocols.py:44:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/notifications/basenotifier.py:80:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/batch_client.py:119:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/batch_client.py:131:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/batch_client.py:62:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/batch_client.py:88:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/ecs.py:230:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/ecs.py:234:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/ecs.py:238:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/ecs.py:242:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/ecs.py:246:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/providers/amazon/aws/hooks/ecs.py:250:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/serialization/json_schema.py:43:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/serialization/json_schema.py:47:9: PLW2301 [*] Unnecessary ellipsis constant.
+ airflow/serialization/json_schema.py:51:9: PLW2301 [*] Unnecessary ellipsis constant.
+ docs/exts/substitution_extensions.py:118:9: PLW2301 [*] Unnecessary ellipsis constant.
</code></pre>
</p>
</details>
<details><summary>disnake (+2, -0)</summary>
<p>

<pre><code class="language-diff">+ examples/interactions/injections.py:96:5: PLW2301 [*] Unnecessary ellipsis constant.
+ tests/test_utils.py:66:9: PLW2301 [*] Unnecessary ellipsis constant.
</code></pre>
</p>
</details>
<details><summary>scikit-build-core (+5, -0)</summary>
<p>

<pre><code class="language-diff">+ src/scikit_build_core/settings/sources.py:161:9: PLW2301 [*] Unnecessary ellipsis constant.
+ src/scikit_build_core/settings/sources.py:168:9: PLW2301 [*] Unnecessary ellipsis constant.
+ src/scikit_build_core/settings/sources.py:176:9: PLW2301 [*] Unnecessary ellipsis constant.
+ src/scikit_build_core/settings/sources.py:184:9: PLW2301 [*] Unnecessary ellipsis constant.
+ src/scikit_build_core/settings/sources.py:191:9: PLW2301 [*] Unnecessary ellipsis constant.
</code></pre>
</p>
</details>
Rules changed: 1

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PLW2301 | 27 | 27 | 0 |</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     16.0±0.50ms     2.5 MB/sec    1.04     16.7±0.22ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.8±0.10ms     4.3 MB/sec    1.05      4.0±0.04ms     4.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    498.0±7.89µs     5.9 MB/sec    1.03   515.2±30.74µs     5.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.7±0.26ms     3.8 MB/sec    1.02      6.9±0.22ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.00      7.9±0.18ms     5.2 MB/sec    1.01      7.9±0.23ms     5.1 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1746.9±32.62µs     9.5 MB/sec    1.00  1740.7±35.10µs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    191.2±6.94µs    15.4 MB/sec    1.05    200.8±2.85µs    14.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6±0.11ms     7.2 MB/sec    1.01      3.6±0.05ms     7.1 MB/sec
parser/large/dataset.py                    1.00      5.9±0.18ms     7.0 MB/sec    1.05      6.1±0.10ms     6.6 MB/sec
parser/numpy/ctypeslib.py                  1.01  1194.0±25.92µs    13.9 MB/sec    1.00  1182.9±26.71µs    14.1 MB/sec
parser/numpy/globals.py                    1.00    122.5±2.94µs    24.1 MB/sec    1.02    125.3±1.13µs    23.5 MB/sec
parser/pydantic/types.py                   1.00      2.6±0.05ms     9.8 MB/sec    1.02      2.6±0.02ms     9.7 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     15.0±0.05ms     2.7 MB/sec    1.01     15.2±0.04ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5±0.01ms     4.7 MB/sec    1.00      3.5±0.01ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    390.4±1.44µs     7.6 MB/sec    1.00    390.6±3.66µs     7.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.1±0.02ms     4.2 MB/sec    1.00      6.1±0.05ms     4.1 MB/sec
linter/default-rules/large/dataset.py      1.00      7.6±0.03ms     5.4 MB/sec    1.00      7.6±0.03ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01   1545.4±5.70µs    10.8 MB/sec    1.00   1535.9±5.01µs    10.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    172.0±0.67µs    17.2 MB/sec    1.00    171.9±1.92µs    17.2 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.3±0.01ms     7.7 MB/sec    1.00      3.3±0.01ms     7.6 MB/sec
parser/large/dataset.py                    1.12      7.0±0.02ms     5.8 MB/sec    1.00      6.2±0.03ms     6.5 MB/sec
parser/numpy/ctypeslib.py                  1.11   1277.6±5.90µs    13.0 MB/sec    1.00   1147.9±5.58µs    14.5 MB/sec
parser/numpy/globals.py                    1.09    127.5±0.50µs    23.2 MB/sec    1.00    117.4±0.79µs    25.1 MB/sec
parser/pydantic/types.py                   1.11      2.9±0.01ms     8.9 MB/sec    1.00      2.6±0.01ms     9.9 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs</code>:151 on 2023-05-30 15:56</div>
            <div class="timeline-body"><p>Nit: I think it would be clearer to write this as a <code>match</code> instead. It emphasizes that the branches are mutually exclusive:</p>
<pre><code class="language-suggestion">		match stmt {
			Stmt::FunctionDef(ast::StmtFunctionDef { body, .. })
	        | Stmt::AsyncFunctionDef(ast::StmtAsyncFunctionDef { body, .. })
	        | Stmt::ClassDef(ast::StmtClassDef { body, .. })
	        | Stmt::AsyncFor(ast::StmtAsyncFor { body, .. })
	        | Stmt::While(ast::StmtWhile { body, .. })
	        | Stmt::With(ast::StmtWith { body, .. })
	        | Stmt::AsyncWith(ast::StmtAsyncWith { body, .. })
	        | Stmt::Try(ast::StmtTry { body, .. })
	        | Stmt::TryStar(ast::StmtTryStar { body, .. }) =&gt; process_body(checker, stmt, body, expr),
	        | Stmt::If(ast::StmtIf { body, orelse, .. }) =&gt; {
	        	process_body(checker, stmt, body, expr)
	        	process_body(checker, stmt, orelse, expr);	
	        },
	        Stmt::Match(ast::StmtMatch { cases, .. }) =&gt; {
	            for case in cases {
	                let ast::MatchCase { body, .. } = case;
	                process_body(checker, stmt, body, expr);
	            }
	        },
	        Stmt::Try(ast::StmtTry { body, handlers ..} =&gt; {
	        	process_body(checker, stmt, body, expr)
				for handler in handlers {
	                let Excepthandler::ExceptHandler(ast::ExcepthandlerExceptHandler { body, .. }) =
	                    handler;
	                process_body(checker, stmt, body, expr);
            }
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs</code>:160 on 2023-05-30 15:57</div>
            <div class="timeline-body"><p>Do we need to handle the <code>orelse</code> and <code>finally</code> bodies too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs</code>:120 on 2023-05-30 16:00</div>
            <div class="timeline-body"><p>I wonder how expensive  <code>stmt_parent</code> is when called for every stmt. I rescheduled the benchmarks to see if it is a one-off or is indeed a perf regression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-30 16:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs</code>:151 on 2023-05-30 16:16</div>
            <div class="timeline-body"><p>I've tried replacing with the following <code>match</code>:</p>
<pre><code class="language-rust">        match stmt {
            Stmt::FunctionDef(ast::StmtFunctionDef { body, .. })
            | Stmt::AsyncFunctionDef(ast::StmtAsyncFunctionDef { body, .. })
            | Stmt::ClassDef(ast::StmtClassDef { body, .. })
            | Stmt::AsyncFor(ast::StmtAsyncFor { body, .. })
            | Stmt::While(ast::StmtWhile { body, .. })
            | Stmt::With(ast::StmtWith { body, .. })
            | Stmt::AsyncWith(ast::StmtAsyncWith { body, .. })
            | Stmt::If(ast::StmtIf { body, .. })
            | Stmt::Try(ast::StmtTry { body, .. })
            | Stmt::TryStar(ast::StmtTryStar { body, .. }) =&gt; {
                process_body(checker, stmt, body, expr);
            }
            Stmt::If(ast::StmtIf { orelse, .. }) =&gt; {
                process_body(checker, stmt, orelse, expr);
            }
            Stmt::Match(ast::StmtMatch { cases, .. }) =&gt; {
                for case in cases {
                    let ast::MatchCase { body, .. } = case;
                    process_body(checker, stmt, body, expr);
                }
            }
            Stmt::Try(ast::StmtTry { handlers, .. }) =&gt; {
                for handler in handlers {
                    let Excepthandler::ExceptHandler(ast::ExcepthandlerExceptHandler {
                        body, ..
                    }) = handler;
                    process_body(checker, stmt, body, expr);
                }
            }
            _ =&gt; {}
        }
</code></pre>
<p>However this results in</p>
<pre><code>error: unreachable pattern
   --&gt; crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs:134:13
    |
134 |             Stmt::If(ast::StmtIf { orelse, .. }) =&gt; {
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = note: `-D unreachable-patterns` implied by `-D warnings`

error: unreachable pattern
   --&gt; crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs:143:13
    |
143 |             Stmt::Try(ast::StmtTry { handlers, .. }) =&gt; {
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2023-05-30 16:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2023-05-30 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs</code>:160 on 2023-05-30 16:28</div>
            <div class="timeline-body"><p>Fixed in c8050c2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff/src/rules/pylint/rules/unnecessary_ellipsis.rs</code>:120 on 2023-05-31 13:16</div>
            <div class="timeline-body"><p>@MichaReiser Is it too slow to be merged ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2023-05-31 13:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-02 03:00</div>
            <div class="timeline-body"><p>It looks reasonable though I'm not sure how to deal with the overlap between this rule and <code>rules/flake8_pyi/rules/ellipsis_in_non_empty_class_body.rs</code> (which is similar but slightly different in that it only affects class bodies and only in stub files).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2023-06-02 05:20</div>
            <div class="timeline-body"><p>@charliermarsh It would be great if a single rule could alias multiple more specific rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2023-06-02 06:39</div>
            <div class="timeline-body"><p>~~What about introducing a <code>flake8_pyi</code> rule for unnecessary ellipsis in function, and have <code>W2301</code> be used only for non-stubs files ?  (if that's possible)~~</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2023-06-17 07:46</div>
            <div class="timeline-body"><p>Are there other rules with partial overlap that could be used as reference/precedent ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-30 22:14</div>
            <div class="timeline-body"><p>I think this is superseded by https://github.com/astral-sh/ruff/pull/8641 now. Sorry this one got a little lost :/ let me know if you have any questions or concerns!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-11-30 22:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:57:43 UTC
    </footer>
</body>
</html>
