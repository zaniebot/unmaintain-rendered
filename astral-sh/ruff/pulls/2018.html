<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert rust-toolchain file to rust-toolchain.toml (with nightly) - astral-sh/ruff #2018</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Convert rust-toolchain file to rust-toolchain.toml (with nightly)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2018">#2018</a>
        opened by <a href="https://github.com/akx">@akx</a>
        on 2023-01-20 09:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a></div>
            <div class="timeline-body"><p>This makes IDEA IDEs realize they should use <code>nightly</code> as documented in <code>CONTRIBUTING.md</code>.</p>
<p>This will require rustup 1.23.0+ (which was released in 2020, so likely a non-issue).</p>
<p>Refs https://github.com/intellij-rust/intellij-rust/issues/6228
Refs https://rust-lang.github.io/rustup/overrides.html#the-toolchain-file</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-20 09:49</div>
            <div class="timeline-body"><p>The <code>rust-toolchain</code> file previously contained <code>1.65.0</code> and you changed it to <code>nightly</code> ... this is not the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-20 09:49</div>
            <div class="timeline-body"><p>@not-my-profile I know I did. <code>CONTRIBUTING.md</code> clearly says to use <code>+nightly</code> too (and indeed, one of the <code>rust_dev</code> deps doesn't compile on non-nightly).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-20 09:56</div>
            <div class="timeline-body"><p>Ruff does not depend on a single unstable feature so we should continue to have <code>cargo test</code> use stable Rust. I only use <code>+nigthly</code> for <code>cargo fmt</code> and everything else works fine on stable.</p>
<blockquote>
<p>and indeed, one of the rust_dev deps doesn't compile on non-nightly</p>
</blockquote>
<p><code>rust_dev</code> works fine on stable for me.</p>
<p>In any case I think a config format change and a version change are two separate changes and should certainly be done in separate commits. And a version change should have some convincing reasoning (ideally also explained in the commit message).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-20 10:01</div>
            <div class="timeline-body"><p>@not-my-profile</p>
<blockquote>
<p>we should continue to have <code>cargo test</code> use stable Rust.</p>
</blockquote>
<p>It looks like CI runs tests on nightly, unless I'm mistaken and there's some additional override? https://github.com/charliermarsh/ruff/blob/81db00a3c4519600ee1374eb131a159c384422ea/.github/workflows/ci.yaml#L65-L74</p>
<p>On that note, maybe the <code>&quot;nightly&quot;</code> in this PR should be <code>&quot;nightly-2022-11-01&quot;</code>?</p>
<blockquote>
<p>In any case I think a config format change and a version change are two separate changes and should certainly be done in separate commits. And a version change should have some convincing reasoning (ideally also explained in the commit message).</p>
</blockquote>
<p>Sure, I can separate them, but the end goal here was to make my IDEA IDE (and probably other things?) understand it should use the nightly toolchain, since</p>
<p>https://github.com/charliermarsh/ruff/blob/81db00a3c4519600ee1374eb131a159c384422ea/README.md#L1654</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-20 10:10</div>
            <div class="timeline-body"><p>Right I do not see any reason why we the CI should run <code>cargo test</code> only on nightly ... apparently that was accidentally changed in 79ca66ace5ebba10e94cda9925d19fdfc50ac327 ... I just opened #2019 to change it back.</p>
<p>And I also don't think changing the whole developer toolchain to nightly just because of <code>cargo fmt</code>/clippy makes much sense ... unfortunately there does not appear to be a cross-editor way of configuring just <code>cargo fmt</code> to use nightly ... for rust-analyzer with VSCode you can apparently use <a href="https://github.com/rust-lang/vscode-rust/issues/438#issuecomment-1003671382">this config</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Convert rust-toolchain file to rust-toolchain.toml" to "Convert rust-toolchain file to rust-toolchain.toml (with nightly)" by @akx on 2023-01-20 10:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-20 10:26</div>
            <div class="timeline-body"><p>Okay, I guess this can be closed with #2019 â€“ but I hope you can see why I thought to change to <code>nightly</code> here, given the instructions and CI setup? ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-20 10:36</div>
            <div class="timeline-body"><p>@not-my-profile btw, I get this trying to <code>cargo test</code> without nightly:</p>
<pre><code>error[E0554]: `#![feature]` may not be used on the stable release channel
  --&gt; /Users/akx/.cargo/registry/src/github.com-1ecc6299db9ec823/rustix-0.36.5/src/lib.rs:99:26
   |
99 | #![cfg_attr(rustc_attrs, feature(rustc_attrs))]
   |                          ^^^^^^^^^^^^^^^^^^^^
</code></pre>
<p>Not sure what in particular I'm doing wrong there...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-20 10:38</div>
            <div class="timeline-body"><p>Yes I now understand your reasoning :) The current <code>rust-toolchain</code> is indeed in conflict with the current instructions in the README.</p>
<blockquote>
<p>Not sure what in particular I'm doing wrong there...</p>
</blockquote>
<p>Have you tried a <code>cargo clean</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-20 10:50</div>
            <div class="timeline-body"><p>Closing in favor of #2019.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @akx on 2023-01-20 10:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:38 UTC
    </footer>
</body>
</html>
