<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regenerate expected Black snapshots - astral-sh/ruff #2968</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Regenerate expected Black snapshots</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2968">#2968</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-02-16 19:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>The script I used to generate these wasn't idempotent, and I must've run it twice over the &quot;unused&quot; tests -- so most of them contained the wrong expected result, which quickly became clear as I tried to enable them.</p>
<p>This PR just re-runs the generation process, which (for posterity) leverages this script:</p>
<pre><code class="language-py">import argparse
from pathlib import Path

EMPTY_LINE = &quot;# EMPTY LINE WITH WHITESPACE (this comment will be removed)&quot;


def read_data_from_file(file_name: Path) -&gt; tuple[str, str]:
    with open(file_name, &quot;r&quot;, encoding=&quot;utf8&quot;) as test:
        lines = test.readlines()
    _input: list[str] = []
    _output: list[str] = []
    result = _input
    for line in lines:
        line = line.replace(EMPTY_LINE, &quot;&quot;)
        if line.rstrip() == &quot;# output&quot;:
            result = _output
            continue

        result.append(line)
    if _input and not _output:
        # If there's no output marker, treat the entire file as already pre-formatted.
        _output = _input[:]
    return &quot;&quot;.join(_input).strip() + &quot;\n&quot;, &quot;&quot;.join(_output).strip() + &quot;\n&quot;


def main() -&gt; None:
    parser = argparse.ArgumentParser()
    parser.add_argument(&quot;file&quot;, type=Path)
    args = parser.parse_args()

    file_name: Path = args.file
    (input_content, output_content) = read_data_from_file(file_name)

    with open(file_name, &quot;w+&quot;, encoding=&quot;utf8&quot;) as fp:
        fp.write(input_content)

    relative_name = str(
        file_name.relative_to(&quot;crates/ruff_python_formatter/resources/test/fixtures/black&quot;)
    )
    suffix = relative_name.replace(&quot;/&quot;, &quot;__&quot;)
    snapshot_path = (
        Path(&quot;crates/ruff_python_formatter/src/snapshots/expect&quot;) / f&quot;ruff_python_formatter__tests__{suffix}.snap.expect&quot;
    )
    with open(snapshot_path, &quot;w+&quot;, encoding=&quot;utf8&quot;) as fp:
        fp.write(
            f&quot;&quot;&quot;---
source: src/source_code/mod.rs
assertion_line: 0
expression: formatted
---
{output_content}
&quot;&quot;&quot;
        )


if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autoformatter</span> added by @charliermarsh on 2023-02-16 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-02-16 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-02-16 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-02-16 19:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:16 UTC
    </footer>
</body>
</html>
