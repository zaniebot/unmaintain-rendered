<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Second positional argument to Asset/Dataset should not be a dictionary (`AIR303`) - astral-sh/ruff #22453</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Second positional argument to Asset/Dataset should not be a dictionary (<code>AIR303</code>)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22453">#22453</a>
        opened by <a href="https://github.com/sjyangkevin">@sjyangkevin</a>
        on 2026-01-08 04:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR is related to https://github.com/apache/airflow/issues/48389.</p>
<p>In Airflow 3, the function signature for <code>airflow.Dataset</code>, <code>airflow.datasets.Dataset</code>, and <code>airflow.sdk.Asset</code> has changed. Below is the function signature for <code>airflow.sdk.Asset</code>. The second positional argument is <code>uri</code> which is of type <code>str</code>. In the older version, the second positional argument can be a dictionary which is the <code>extra: 'dict | None' = None</code> argument. Therefore, we need to flag this in Airflow 3.</p>
<pre><code class="language-python">Asset(name: 'str | None' = None, uri: 'str | None' = None, *, group: 'str | None' = None, extra: 'dict | None' = None, watchers: 'list[AssetWatcher | SerializedAssetWatcher] | None' = None) -&gt; 'None'
</code></pre>
<p>As this is a check on constructor call, we need to create a new method <code>check_constructor_arguments</code>, instead of on method call. The new rule check whether the index 1 (the second argument) is a dictionary (either a literal or a <code>dict()</code> call).</p>
<h2>Test Plan</h2>
<p>The <code>AIR303.py</code> test file have been updated with new test cases. The snapshot has been updated and all other test cases passed.</p>
<p>@Lee-W , could you please review it when you have a chance, and let me know if you have further feedback. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-08 04:57</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:150 on 2026-01-08 06:56</div>
            <div class="timeline-body"><p>We could mention it's now <code>Asset(name=..., uri=..., extra=...)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-08 06:57</div>
            <div class="timeline-body"><p>one nit, LGTM!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:150 on 2026-01-08 15:34</div>
            <div class="timeline-body"><p>wondering if this looks better</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-08 15:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Lee-W by @sjyangkevin on 2026-01-08 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @amyreese on 2026-01-08 20:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:150 on 2026-01-09 01:16</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                            message: &quot;Use keyword argument `extra` instead of passing a dict as the second positional argument (e.g., `Asset(name=..., uri=..., extra=...)`)&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-09 01:16</div>
            <div class="timeline-body"><p>LGTM after the last nit üëç Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-09 01:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:150 on 2026-01-09 01:19</div>
            <div class="timeline-body"><p>cool! just pushed the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:1 on 2026-01-09 15:38</div>
            <div class="timeline-body"><p>wonder if we should update the version as 0.14.11 was released.</p>
<pre><code>#[violation_metadata(preview_since = &quot;0.14.11&quot;)]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-09 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @MichaReiser on 2026-01-09 16:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2026-01-10 13:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:1 on 2026-01-10 13:43</div>
            <div class="timeline-body"><p>yep, I think so</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-15 15:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:1 on 2026-01-15 15:09</div>
            <div class="timeline-body"><p>actually, I just checked again on this. As AIR303 is included in the release &quot;0.14.11&quot;. If I understand correctly, the preview version should probably still be &quot;0.14.11&quot; as we first introduce the code/rules in that version. This PR adds one more rule on top of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:1 on 2026-01-15 15:27</div>
            <div class="timeline-body"><p>This should be fine as 0.14.11. This field is for when the rule is first released, so you don't need to update it when modifying an existing rule (until we stabilize the rule) üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2026-01-15 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:161 on 2026-01-15 15:35</div>
            <div class="timeline-body"><p>There are a couple of other ways you could check this, if you want. The simplest is to check for <code>Expr::DictComp</code> (dict comprehension) as well as a dict literal. And then a more invasive check would be <a href="https://github.com/astral-sh/ruff/blob/652783790aea7d8ad7dbd22b6960876f7c699928/crates/ruff_python_semantic/src/analyze/typing.rs#L1035"><code>typing::is_dict</code></a>, which will check if a variable binding can be resolved to a <code>dict</code> based on type annotations.</p>
<p>It's okay with me if you want to restrict the check to dict literals and <code>dict()</code> calls, though. We should just add tests for these other cases if you add additional checks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:143 on 2026-01-15 15:37</div>
            <div class="timeline-body"><p>Is this argument positional-only? I think it could also be passed as a keyword based on the signature in the PR description. We could use <code>find_argument_value</code> if you want to handle the keyword case too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2026-01-15 15:39</div>
            <div class="timeline-body"><p>Thank you! This looks good to me overall, just a couple of minor suggestions about additional cases you could handle, if you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-15 16:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:143 on 2026-01-15 16:57</div>
            <div class="timeline-body"><p>Thanks for the feedback!! If I understand the question correctly, and I think yes, the second argument <code>uri</code> can be passed as keyword based on the current function signature. I think the second positional argument in the old version is used to set the <code>extra</code>, but now it is changed to set the <code>uri</code>. This check then flags this change. Hope this answer the question.</p>
<pre><code class="language-python">Dataset(&quot;ds1&quot;, {&quot;some_extra&quot;: 1})
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:143 on 2026-01-15 20:04</div>
            <div class="timeline-body"><p>Ohhh okay, I think I understand. So you're not worried about a case like:</p>
<pre><code class="language-py">Dataset(&quot;ds1&quot;, uri=&quot;...&quot;)
</code></pre>
<p>because that's still valid in the new API? The problem is specifically when the second positional argument is a dict. I think this is fine as-is then. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2026-01-15 20:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sjyangkevin">@sjyangkevin</a> reviewed on 2026-01-15 22:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sjyangkevin">@sjyangkevin</a> on <code>crates/ruff_linter/src/rules/airflow/rules/function_signature_change_in_3.rs</code>:161 on 2026-01-15 22:47</div>
            <div class="timeline-body"><p>Thanks for pointing this out. I searched through the codebase and find a similar example to perform such test. I've made the update to the check logic, as well as adding test cases for other variants.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @sjyangkevin on 2026-01-15 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Lee-W by @sjyangkevin on 2026-01-15 23:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-15 23:53:40 UTC
    </footer>
</body>
</html>
