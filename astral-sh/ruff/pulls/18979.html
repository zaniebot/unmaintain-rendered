<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add micro-benchmark for #711 - astral-sh/ruff #18979</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add micro-benchmark for #711</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18979">#18979</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-06-27 09:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>Add a benchmark for the problematic case in <a href="https://github.com/astral-sh/ty/issues/711">astral-sh/ty#711</a>, which will potentially be solved in <a href="https://github.com/astral-sh/ruff/pull/18955">astral-sh/ruff#18955</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 09:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 09:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 09:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-27 09:25</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-06-27 09:25</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/david%2Fbenchmark-711?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #18979 will <strong>not alter performance</strong>
<p>Comparing <code>david/benchmark-711</code> (390c45b) with <code>main</code> (e5e3d99)</p>
Summary
<p><code>‚úÖ 37</code> untouched benchmarks<br>
<code>üÜï 2</code> new benchmarks<br>
<code>‚ÅâÔ∏è 1 (üëÅ 1)</code> dropped benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| üÜï | <code>ty_micro[complex_constrained_attributes_1]</code> | N/A | 56.8 ms | N/A |
| üÜï | <code>ty_micro[complex_constrained_attributes_2]</code> | N/A | 6.3 s | N/A |
| üëÅ | <code>ty_micro[many_attribute_assignments]</code> | 56.7 ms | N/A | N/A |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-27 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-27 10:36</div>
            <div class="timeline-body"><p>Oof... I just ran the benchmarks locally to see if a change I was experimenting with had a performance impact, and this new benchmark takes over a minute to run (much longer than any other ty benchmark):</p>
<pre><code>Benchmarking ty_micro[complex_constrained_attributes_2]: Warming up for 3.0000 s
Warning: Unable to complete 100 samples in 5.0s. You may wish to increase target time to 85.2s, or reduce sample count to 10.
ty_micro[complex_constrained_attributes_2]
                        time:   [808.20 ms 808.88 ms 809.60 ms]
Found 1 outliers among 100 measurements (1.00%)
  1 (1.00%) high mild
</code></pre>
<p>The command I ran locally was <code>cargo bench -p ruff_benchmark --bench=ty</code>. For comparison, the next-slowest benchmark was <code>project/anyio</code>, for which the report was:</p>
<pre><code>Benchmarking project/anyio: Warming up for 3.0000 s
Warning: Unable to complete 100 samples in 5.0s. You may wish to increase target time to 14.5s, or reduce sample count to 30.
project/anyio           time:   [131.96 ms 132.08 ms 132.23 ms]
                        change: [‚àí0.9888% ‚àí0.7683% ‚àí0.5652%] (p = 0.00 &lt; 0.05)
                        Change within noise threshold.
Found 4 outliers among 100 measurements (4.00%)
  1 (1.00%) low mild
  1 (1.00%) high mild
  2 (2.00%) high severe
</code></pre>
<p>Can we make this slightly less diabolical for now, so that it&#x27;s possible to run benchmarks locally in a reasonable time?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 11:42</div>
            <div class="timeline-body"><blockquote>
<p>Oof... I just ran the benchmarks locally to see if a change I was experimenting with had a performance impact, and this new benchmark takes over a minute to run (much longer than any other ty benchmark):</p>
</blockquote>
<p>Oh, sorry! Will fix that later. In the meantime, you can use a filter argument or reduce the amount of samples (<code>--sample-size 10</code>), I think. The true fix will be <a href="https://github.com/astral-sh/ruff/pull/18955">astral-sh/ruff#18955</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-27 21:11</div>
            <div class="timeline-body"><blockquote>
<p>Will fix that later</p>
</blockquote>
<p>https://github.com/astral-sh/ruff/pull/19001</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:58 UTC
    </footer>
</body>
</html>
