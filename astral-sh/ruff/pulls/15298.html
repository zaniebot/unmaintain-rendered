<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-return`] Recognize functions returning `Never` as non-returning (`RET503`) - astral-sh/ruff #15298</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-return</code>] Recognize functions returning <code>Never</code> as non-returning (<code>RET503</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15298">#15298</a>
        opened by <a href="https://github.com/viccie30">@viccie30</a>
        on 2025-01-06 09:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/viccie30">@viccie30</a></div>
            <div class="timeline-body">

Summary
<p>This pull request makes <code>flake8-return</code> recognize functions annotated to return <a href="https://docs.python.org/3/library/typing.html#typing.Never"><code>typing.Never</code></a> as non-returning.</p>
Test Plan
<p>I have duplicated the existing tests for functions returning <code>NoReturn</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-06 09:51</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-06 11:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_return/snapshots/ruff_linter__rules__flake8_return__tests__RET503_RET503.py.snap</code>:475 on 2025-01-06 11:40</div>
            <div class="timeline-body"><p>Your code changes look correct, but they seem to have no effect. I&#x27;d expect that the rule wouldn&#x27;t flag this specific line because there&#x27;s no implicit return (it never returns). I added a ton of debug statements to <code>is_noreturn_func</code> and I suspect the problem is that the semantic model hasn&#x27;t seen <code>bar</code> at the moment we try to resolve its name. My suspicious gets confirmed when changing the example to</p>
<pre><code>import typing

def bar() -&gt; typing.Never:
    abort()

def foo(x: int) -&gt; int:
    if x == 5:
        return 5
    bar()
</code></pre>
<p>which raises a violation before your change but now doesn&#x27;t.</p>
<p>I suggest that you change your examples (including the existing <code>NoReturn</code>) to not use a nested function. We can add a dedicated test with a nested function with a doc comment explaining that this is currently not supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-06 11:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/viccie30">@viccie30</a> reviewed on 2025-01-06 15:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/viccie30">@viccie30</a> on <code>crates/ruff_linter/src/rules/flake8_return/snapshots/ruff_linter__rules__flake8_return__tests__RET503_RET503.py.snap</code>:475 on 2025-01-06 15:28</div>
            <div class="timeline-body"><p>I have changed the current tests to no longer use nested functions and have added a currently ignored test checking nested functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-01-07 07:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-07 07:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-07 07:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-07 08:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:10:03 UTC
    </footer>
</body>
</html>
