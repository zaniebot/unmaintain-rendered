<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[airflow] add autofix to AIR302 ProviderName - astral-sh/ruff #17038</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[airflow] add autofix to AIR302 ProviderName</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17038">#17038</a>
        opened by <a href="https://github.com/Lee-W">@Lee-W</a>
        on 2025-03-28 15:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-03-28 15:11</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>Add autofix to AIR303 name moved to provider</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>The existing test fixture reflects the update</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-03-28 15:11</div>
            <div class="timeline-body"><p>this branch based on https://github.com/astral-sh/ruff/pull/16965</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-28 15:18</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-31 20:53</div>
            <div class="timeline-body"><p>(I'll avoid reviewing this PR for now as it's in draft and it's based on a different branch; the diff includes code from both branches. Once the dependent PR is merged, we can move this out of draft and I can review it.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @dhruvmanila on 2025-03-31 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-03-31 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Lee-W on 2025-04-02 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-02 15:48</div>
            <div class="timeline-body"><p>@dhruvmanila This PR is ready now ðŸ™Œ  (after all the merging and rebasing ðŸ’¦)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Lee-W on 2025-04-02 16:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-02 17:17</div>
            <div class="timeline-body"><blockquote>
<p>@dhruvmanila This PR is ready now ðŸ™Œ (after all the merging and rebasing ðŸ’¦)</p>
</blockquote>
<p>You've put this back into draft, is that intentional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-03 02:17</div>
            <div class="timeline-body"><p>Yep, it is. Found an issue after a few more rebasing. Was trying to fix it but couldn't do it on time. ðŸ¥²</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] add autofix to AIR303 ProviderName" to "[airflow] add autofix to AIR302 ProviderName" by @Lee-W on 2025-04-07 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-07 15:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-07 15:24</div>
            <div class="timeline-body"><p>Hey @ntBre, a quick question. I tried to apply autofix to all the similar symbol changes, but only a few of them can be fixed. Do you know what might be missing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-04-07 16:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-07 16:17</div>
            <div class="timeline-body"><p>I might be missing some context here. What kind of autofix were you trying to apply? Or what change were you trying to make?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-08 13:10</div>
            <div class="timeline-body"><p>@ntBre</p>
<p>for example, if the user is using</p>
<pre><code class="language-python">from airflow.operators.google_api_to_s3_transfer import GoogleApiToS3Operator

GoogleApiToS3Operator()
</code></pre>
<p>we want to fix it as</p>
<pre><code class="language-python">from airflow.providers.amazon.aws.transfers.google_api_to_s3 import GoogleApiToS3Operator

GoogleApiToS3Operator()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-08 13:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-04-08 18:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-08 18:27</div>
            <div class="timeline-body"><p>I tried adding an <code>unwrap</code> call instead of <code>?</code> on the <code>get_or_import_symbol</code> call, and I'm seeing this error when running the AIR302 tests:</p>
<pre><code>called `Result::unwrap()` on an `Err` value: ConflictingName(&quot;provide_bucket_name&quot;)
</code></pre>
<p>It looks like you can't overwrite an existing symbol with a different import path, at least through the <code>get_or_import_symbol</code> API.</p>
<p>I don't really have a great suggestion for working around this. You could try a direct text replacement, but I can easily imagine that going wrong if there are multiple imports grouped together or something like that.</p>
<p>Maybe a better alternative would be a custom version of <a href="https://github.com/astral-sh/ruff/blob/7ff8b6b293e3c8812d6bc5cd4416fa585f13196f/crates/ruff_linter/src/importer/mod.rs#L377"><code>Importer::import_symbol</code></a> (inside of a custom <code>get_or_import_symbol</code>) that ignores the <code>ConflictingName</code> error case since you're overwriting it anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-04-08 19:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-08 19:05</div>
            <div class="timeline-body"><p>Ah yes, I think that updating an existing import isn't currently supported and you'd need to add a dedicated edit infrastructure for it. The NumPy deprecation rules doesn't support that either so it should be fine for now unless you'd want to add support for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-04-08 19:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-08 19:07</div>
            <div class="timeline-body"><p>Although this doesn't look too difficult and we could potentially use a text replacement as suggested by Brent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-09 10:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:148 on 2025-04-09 10:27</div>
            <div class="timeline-body"><p>I think that's crucial for us. I'll explore a bit and see how I can achieve it. Before that, I'll apply <code>AutoImport</code> to fixable ones.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ntBre by @ntBre on 2025-04-09 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Lee-W on 2025-04-23 02:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:33:28 UTC
    </footer>
</body>
</html>
