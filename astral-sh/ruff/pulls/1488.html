<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pyupgrade: `import mock` to `from unittest import mock` - astral-sh/ruff #1488</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Pyupgrade: <code>import mock</code> to <code>from unittest import mock</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1488">#1488</a>
        opened by <a href="https://github.com/colin99d">@colin99d</a>
        on 2022-12-30 21:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a></div>
            <div class="timeline-body"><p>This gets us further on #827. I added a lot of tests not included in the original library. Also, the function to create the changes was a little complicated, so I added a BUNCH of comments to it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/plugins/rewrite_mock_import.rs</code>:40 on 2022-12-30 23:22</div>
            <div class="timeline-body"><p>Have you looked into using LibCST at all for these sorts of complicated rewrites? We have a few examples, like in <code>src/flake8_comprehensions/fixes.rs</code>. It gives you a concrete syntax tree (which includes punctuation, whitespace, etc.), which you can then edit, and generate fixed code from the edited tree. It might give us a lot more safety as these transforms are kind of bespoke, and I worry that they might get tripped up since we&#x27;re doing so much exact-string processing.</p>
<p>Are you open to seeing if LibCST would be useable here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-30 23:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-30 23:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/plugins/rewrite_mock_import.rs</code>:59 on 2022-12-30 23:22</div>
            <div class="timeline-body"><p>Could this be <code>contents.lines().count()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-30 23:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/plugins/rewrite_mock_import.rs</code>:41 on 2022-12-30 23:22</div>
            <div class="timeline-body"><p>Can probably be <code>needed_imports: &amp;[&amp;str]</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-30 23:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/plugins/rewrite_mock_import.rs</code>:66 on 2022-12-30 23:23</div>
            <div class="timeline-body"><p>For example, this assumes four-space indent, but LibCST would probably let you preserve whatever indent was already present (unless I&#x27;m misunderstanding this).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-30 23:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>resources/test/fixtures/pyupgrade/UP026.py</code>:29 on 2022-12-30 23:24</div>
            <div class="timeline-body"><p>(It&#x27;s also ok, in my opinion, for fixes like this to make some assumptions (e.g., inject a trailing comma) if it greatly simplifies the code.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>src/pyupgrade/plugins/rewrite_mock_import.rs</code>:66 on 2022-12-31 13:56</div>
            <div class="timeline-body"><p>This adds 4 spaces on top of any indent, so it still works. However I did not know about LibCST, and will definitely try it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2022-12-31 13:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2022-12-31 13:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>resources/test/fixtures/pyupgrade/UP026.py</code>:29 on 2022-12-31 13:58</div>
            <div class="timeline-body"><p>Could this lead to issues in further run throughs? For example if the trailing comma was removed, then the next time the list might be folded into one line. This isnt a HUGE deal, but could be a little frustrating.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/colin99d">@colin99d</a> on <code>resources/test/fixtures/pyupgrade/UP026.py</code>:29 on 2022-12-31 13:59</div>
            <div class="timeline-body"><p>Of course its your project and your decisions. Let me know how you want it handled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colin99d">@colin99d</a> reviewed on 2022-12-31 13:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2022-12-31 14:14</div>
            <div class="timeline-body"><p>One issue I do need to worry about here is <code>asname</code>. Would you like me to preserve them the way they were? The new lib_cst will make that a lot easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-31 18:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/pyupgrade/plugins/rewrite_mock_import.rs</code>:66 on 2022-12-31 18:43</div>
            <div class="timeline-body"><p>Give LibCST a shot for this change and let me know how it goes. I&#x27;m here to answer any questions. There&#x27;s definitely a learning curve (it uses a &quot;concrete syntax tree&quot; so the representation is a bit different and more detailed), but it&#x27;s very powerful and could help make a lot of this stuff &quot;safer&quot; and easier to reason about.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colin99d">@colin99d</a> on 2022-12-31 19:58</div>
            <div class="timeline-body"><p>@charliermarsh definitely a learning curve involved, but I see the value. All the code is updated now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-01 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-01 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-01-01 16:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:41 UTC
    </footer>
</body>
</html>
