<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pyi`] Rename `PYI019` and improve its diagnostic message - astral-sh/ruff #15885</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pyi</code>] Rename <code>PYI019</code> and improve its diagnostic message</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15885">#15885</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-02-02 21:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-02 21:07</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Currently the name of <code>PYI019</code> is <code>custom-type-var-return-type</code> and its diagnostic message is:</p>
<blockquote>
<p>&quot;Methods like <code>{method_name}</code> should return <code>Self</code> instead of a custom <code>TypeVar</code>&quot;</p>
</blockquote>
<p>There are two issues that this PR addresses:</p>
<ul>
<li>Often if you're converting a method to use <code>Self</code> rather than a custom <code>TypeVar</code>, you'll need to change other annotations in the method's non-self parameters, not just the <code>self</code> annotation and the return annotation. Indeed, our preview-mode autofix for stub files will change some of these annotations. But the message and name imply that the rule is just about the return annotation.</li>
<li>It should be pretty obvious which method the diagnostic is complaining about from the diagnostic's range, so I don't think we really need to mention the method name in the diagnostic message. It's more useful to mention the name of the TypeVar that we're suggesting the user should get rid of.</li>
</ul>
<p>I think the changes here should all be backwards-compatible, but we'll need to remember to add a redirect for the documentation after the next release (whether it is a minor release or patch release). In my opinion, the diagnostic's range should also cover the whole of the function's header, but this would be backwards-incompatible, so I'll propose it separately (it will either need to be preview-only or wait until the next minor release).</p>
<h2>Test Plan</h2>
<p><code>cargo test -p ruff_linter --lib</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2025-02-02 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-02 21:14</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-02 21:17</div>
            <div class="timeline-body"><p>Strange, I would have expected some ecosystem hits here...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-03 14:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-03 14:19</div>
            <div class="timeline-body"><p>I assume you meant that we have to set up the redirect with the next release, whether it is a patch or minor release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-03 14:22</div>
            <div class="timeline-body"><blockquote>
<p>I assume you meant that we have to set up the redirect with the next release, whether it is a patch or minor release.</p>
</blockquote>
<p>Correct, thank you! I'll update the PR description (edit: now updated)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-02-03 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-02-03 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-03 14:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:52 UTC
    </footer>
</body>
</html>
