<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `invalid-ignore-comment` rule - astral-sh/ruff #15094</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>invalid-ignore-comment</code> rule</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15094">#15094</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-12-21 17:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Red Knot skips over <code>type: ignore</code> and <code>knot: ignore</code> comments that are syntatically incorrect. This can lead to usless
wana be ignore comments lingering in the code base or confusion when users don't understand why their ignore comment doesn't work.</p>
<p>This PR adds a new <code>invalid-ignore-comment</code> rule that flags ignore comments that are simply incorrect.</p>
<h2>Design questions</h2>
<p>The rule flags invalid <code>type: ignore[code code]</code> comments even though Red Knot itself ignores the code portion of it. I think this is the correct behavior because Red Knot would ignore an invalid <code>type: ignore</code> comment. This way users at least know that Red Knot doesn't understand it. However, there's an argument that we shouldn't be opinionated about ignore comments from other tools.</p>
<p>I think the &quot;right&quot; solution is adding an option to configure whether the <code>unused-ignore-comment</code> and <code>invalid-ignore-comment</code> should ignore <code>type: ignore</code> comments. If this turns out to be a problem in the future.</p>
<h2>Test Plan</h2>
<p>Added mdtests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-12-21 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2024-12-21 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2024-12-21 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2024-12-21 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2024-12-21 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-12-22 16:38</div>
            <div class="timeline-body"><p>Very nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-12-23 10:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-12-23 10:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-23 10:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-23 10:40</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:08:38 UTC
    </footer>
</body>
</html>
