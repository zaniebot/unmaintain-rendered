<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Propagate type context through conditional expressions - astral-sh/ruff #21443</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Propagate type context through conditional expressions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21443">#21443</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2025-11-14 02:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Resolves https://github.com/astral-sh/ty/issues/1543.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @ibraheemdev on 2025-11-14 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @ibraheemdev on 2025-11-14 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @ibraheemdev on 2025-11-14 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @ibraheemdev on 2025-11-14 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @ibraheemdev on 2025-11-14 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @ibraheemdev on 2025-11-14 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 02:14</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 02:15</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">kopf (https://github.com/nolar/kopf)
- kopf/_cogs/clients/creating.py:21:5: error[invalid-assignment] Object of type `(RawBody &amp; ~None) | dict[Unknown, Unknown]` is not assignable to `RawBody | None`
- kopf/_cogs/clients/creating.py:23:9: warning[possibly-missing-attribute] Attribute `setdefault` may be missing on object of type `RawBody | None`
- kopf/_cogs/clients/creating.py:25:9: warning[possibly-missing-attribute] Attribute `setdefault` may be missing on object of type `RawBody | None`
- kopf/_cogs/clients/creating.py:27:44: warning[possibly-missing-attribute] Attribute `get` may be missing on object of type `RawBody | None`
- Found 64 diagnostics
+ Found 60 diagnostics

meson (https://github.com/mesonbuild/meson)
+ mesonbuild/cargo/manifest.py:304:16: error[missing-typed-dict-key] Missing required key 'workspace' in TypedDict `FromWorkspace` constructor
+ mesonbuild/cargo/manifest.py:304:17: error[invalid-key] Invalid key for TypedDict `FromWorkspace`: Unknown key &quot;version&quot;
- Found 1726 diagnostics
+ Found 1728 diagnostics

openlibrary (https://github.com/internetarchive/openlibrary)
+ openlibrary/plugins/worksearch/code.py:446:21: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- Found 944 diagnostics
+ Found 945 diagnostics

hydra-zen (https://github.com/mit-ll-responsible-ai/hydra-zen)
- src/hydra_zen/structured_configs/_implementations.py:3506:9: error[invalid-assignment] Object of type `@Todo | dict[Unknown, Unknown]` is not assignable to `DataclassOptions`
- Found 548 diagnostics
+ Found 547 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
- src/prefect/cli/deploy/_core.py:246:63: error[invalid-argument-type] Argument to function `_generate_actions_for_remote_flow_storage` is incorrect: Expected `list[dict[str, Any]]`, found `(dict[str, Any] &amp; ~AlwaysFalsy) | dict[Unknown, Unknown]`
+ src/prefect/cli/deploy/_core.py:246:63: error[invalid-argument-type] Argument to function `_generate_actions_for_remote_flow_storage` is incorrect: Expected `list[dict[str, Any]]`, found `dict[str, Any]`
- src/prefect/cli/deploy/_core.py:266:13: error[invalid-argument-type] Argument to function `_generate_default_pull_action` is incorrect: Expected `list[dict[str, Any]]`, found `(dict[str, Any] &amp; ~AlwaysFalsy) | dict[Unknown, Unknown] | dict[str, list[dict[str, Any]]]`
+ src/prefect/cli/deploy/_core.py:266:13: error[invalid-argument-type] Argument to function `_generate_default_pull_action` is incorrect: Expected `list[dict[str, Any]]`, found `dict[str, Any] | dict[str, list[dict[str, Any]]]`

altair (https://github.com/vega/altair)
- altair/datasets/_reader.py:177:9: error[invalid-assignment] Object of type `(Metadata &amp; Top[Mapping[Unknown, object]]) | (Path &amp; Top[Mapping[Unknown, object]]) | (str &amp; Top[Mapping[Unknown, object]]) | dict[Unknown | str, Unknown]` is not assignable to `Metadata | Path | str`
- altair/datasets/_reader.py:178:28: error[invalid-argument-type] Argument to bound method `_solve` is incorrect: Expected `Metadata`, found `Metadata | Path | str`
+ altair/datasets/_reader.py:178:28: error[invalid-argument-type] Argument to bound method `_solve` is incorrect: Expected `Metadata`, found `Metadata | (Path &amp; Top[Mapping[Unknown, object]]) | (str &amp; Top[Mapping[Unknown, object]])`
- Found 1020 diagnostics
+ Found 1019 diagnostics

streamlit (https://github.com/streamlit/streamlit)
- lib/streamlit/elements/widgets/data_editor.py:144:9: error[invalid-assignment] Object of type `dict[Unknown | str, Unknown | dict[Unknown, Unknown] | list[Unknown]] | Any` is not assignable to `EditingState`
- Found 138 diagnostics
+ Found 137 diagnostics

bokeh (https://github.com/bokeh/bokeh)
- src/bokeh/resources.py:316:9: error[invalid-assignment] Object of type `list[Literal[&quot;bokeh&quot;, &quot;bokeh-gl&quot;, &quot;bokeh-widgets&quot;, &quot;bokeh-tables&quot;, &quot;bokeh-mathjax&quot;, &quot;bokeh-api&quot;]] | list[str]` is not assignable to attribute `components` of type `list[Literal[&quot;bokeh&quot;, &quot;bokeh-gl&quot;, &quot;bokeh-widgets&quot;, &quot;bokeh-tables&quot;, &quot;bokeh-mathjax&quot;, &quot;bokeh-api&quot;]]`
- Found 645 diagnostics
+ Found 644 diagnostics

rotki (https://github.com/rotki/rotki)
- rotkehlchen/db/upgrades/v45_v46.py:121:25: error[invalid-argument-type] Argument to function `maybe_set_transaction_extra_data` is incorrect: Expected `AssetMovementExtraData | None`, found `dict[Unknown | str, Unknown] | None`
- rotkehlchen/exchanges/coinbase.py:1063:21: error[invalid-argument-type] Argument to function `maybe_set_transaction_extra_data` is incorrect: Expected `AssetMovementExtraData | None`, found `dict[Unknown | str, Unknown] | None`
- Found 2137 diagnostics
+ Found 2135 diagnostics


</code></pre>
</details>

<p>No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 02:20</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 0 | 2 | 3 |
| <code>invalid-assignment</code> | 0 | 5 | 0 |
| <code>possibly-missing-attribute</code> | 0 | 3 | 0 |
| <code>invalid-key</code> | 1 | 0 | 0 |
| <code>missing-typed-dict-key</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>2</strong> | <strong>10</strong> | <strong>3</strong> |</p>
<p><strong><a href="https://ibraheem-conditional-expr-tc.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://ibraheem-conditional-expr-tc.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-14 08:55</div>
            <div class="timeline-body"><p>Lovely</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ibraheemdev on 2025-11-14 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2025-11-14 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-14 20:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:17:15 UTC
    </footer>
</body>
</html>
