<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] narrow tagged unions of `TypedDict` - astral-sh/ruff #22104</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] narrow tagged unions of <code>TypedDict</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22104">#22104</a>
        opened by <a href="https://github.com/oconnor663">@oconnor663</a>
        on 2025-12-20 03:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a></div>
            <div class="timeline-body"><p>Identify and narrow cases like this:</p>
<pre><code>class Foo(TypedDict):
    tag: Literal[&quot;foo&quot;]

class Bar(TypedDict):
    tag: Literal[&quot;bar&quot;]

def _(union: Foo | Bar):
    if union[&quot;tag&quot;] == &quot;foo&quot;:
        reveal_type(union)  # Foo
</code></pre>
<p>Fixes part of <a href="https://github.com/astral-sh/ty/issues/1479">astral-sh/ty#1479</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-20 03:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-20 03:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-20 03:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-20 03:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-20 03:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-20 03:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 03:08</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 03:10</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>pydantic (https://github.com/pydantic/pydantic)
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `StringSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DateSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LiteralSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `EnumSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallableSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ListSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TupleSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `SetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TaggedUnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ChainSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DefinitionReferenceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UuidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ComplexSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IntSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BoolSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `NoneSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `AnySchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `InvalidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:177:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `StringSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DateSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LiteralSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `EnumSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallableSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ListSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TupleSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `SetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TaggedUnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ChainSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `InvalidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DefinitionReferenceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UuidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ComplexSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `AnySchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `NoneSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BoolSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IntSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:179:30: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `StringSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DateSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `InvalidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LiteralSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `EnumSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallableSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ListSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TupleSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `SetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TaggedUnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ChainSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DefinitionReferenceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UuidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ComplexSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IntSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `AnySchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `NoneSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BoolSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:183:50: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `StringSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DateSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LiteralSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `EnumSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `CallableSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ListSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TupleSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `SetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IntSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TaggedUnionSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ChainSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `InvalidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DefinitionReferenceSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `UuidSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `ComplexSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `AnySchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `NoneSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BoolSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:185:33: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DictSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DecimalSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `StringSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `BytesSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DateSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `TimeSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `LiteralSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `EnumSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `CallableSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ListSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `TupleSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `SetSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DictSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `AfterValidatorFunctionSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `BeforeValidatorFunctionSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `WrapValidatorFunctionSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `FloatSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `NullableSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ChainSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `InvalidSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ModelSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DataclassSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `CallSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `CustomErrorSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `JsonSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `UrlSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DefinitionsSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `DefinitionReferenceSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `UuidSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `ComplexSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `IntSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `BoolSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `AnySchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `NoneSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:196:80: error[invalid-key] Unknown key &quot;choices&quot; for TypedDict `WithDefaultSchema`: Unknown key &quot;choices&quot;
- pydantic/_internal/_discriminated_union.py:197:40: error[invalid-argument-type] Argument to bound method `extend` is incorrect: Expected `Iterable[InvalidSchema | AnySchema | NoneSchema | ... omitted 49 union elements]`, found `list[@Todo | InvalidSchema | AnySchema | ... omitted 51 union elements]`
- pydantic/_internal/_discriminated_union.py:223:13: error[invalid-argument-type] Argument to function `tagged_union_schema` is incorrect: Expected `SimpleSerSchema | PlainSerializerFunctionSerSchema | WrapSerializerFunctionSerSchema | ... omitted 4 union elements`, found `SimpleSerSchema | PlainSerializerFunctionSerSchema | WrapSerializerFunctionSerSchema | ... omitted 6 union elements`
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DataclassSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `StringSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DateSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `LiteralSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `EnumSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `CallableSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ListSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TupleSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `SetSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DictSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `AfterValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `BeforeValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `WrapValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `IntSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `WithDefaultSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `NullableSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `UnionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TaggedUnionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ChainSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ModelSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `InvalidSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `CallSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `CustomErrorSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `JsonSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `UrlSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DefinitionsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `UuidSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ComplexSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `AnySchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `NoneSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `BoolSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:238:23: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `IsSubclassSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `StringSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DateSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `LiteralSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `MissingSentinelSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `EnumSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `IsInstanceSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `InvalidSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `CallableSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ListSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TupleSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `SetSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `FrozenSetSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `GeneratorSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DictSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `AfterValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `BeforeValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `WrapValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `IntSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `WithDefaultSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `NullableSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `UnionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TaggedUnionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ChainSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `LaxOrStrictSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `JsonOrPythonSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `TypedDictSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ModelFieldsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ModelSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DataclassSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ArgumentsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ArgumentsV3Schema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `CallSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `CustomErrorSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `JsonSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `UrlSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `MultiHostUrlSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `DefinitionsSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `UuidSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `ComplexSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `BoolSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `AnySchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `NoneSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:239:59: error[invalid-key] Unknown key &quot;schema_ref&quot; for TypedDict `PlainValidatorFunctionSchema`: Unknown key &quot;schema_ref&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DataclassArgsSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `IntSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `FloatSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DecimalSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `StringSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `BytesSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DateSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `DatetimeSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `TimedeltaSchema`: Unknown key &quot;schema&quot;
- pydantic/_internal/_discriminated_union.py:244:40: error[invalid-key] Unknown key &quot;schema&quot; for TypedDict `LiteralSchema`

... (truncated 3110 lines) ...
</code></pre>


<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-20 03:12</div>
            <div class="timeline-body"><p>omg look at those pydantic diagnostics disappear</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-20 03:13</div>
            <div class="timeline-body"><p>Wow!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 03:13</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-key</code> | 0 | 3,124 | 0 |
| <code>invalid-assignment</code> | 0 | 74 | 5 |
| <code>invalid-argument-type</code> | 2 | 19 | 19 |
| <code>invalid-return-type</code> | 2 | 0 | 13 |
| <code>possibly-missing-attribute</code> | 0 | 2 | 0 |
| <code>type-assertion-failure</code> | 0 | 1 | 0 |
| <strong>Total</strong> | <strong>4</strong> | <strong>3,220</strong> | <strong>37</strong> |</p>
<p><strong><a href="https://typeddict-union-narrowing.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://typeddict-union-narrowing.ecosystem-663.pages.dev/timing">timing results</a>)</p>
<p><strong><a href="https://8163c9ad.ty-ecosystem-ext.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://8163c9ad.ty-ecosystem-ext.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 03:25</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-12-20 03:25</div>
            <div class="timeline-body">

<a href="https://codspeed.io/astral-sh/ruff/branches/typeddict_union_narrowing?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a>
Merging #22104 will <strong>not alter performance</strong>
<p>Comparing <code>typeddict_union_narrowing</code> (05184f3) with <code>main</code> (4c175fa)</p>
Summary
<p><code>âœ… 22</code> untouched<br>
<code>â© 30</code> skipped[^skipped]</p>
<p>[^skipped]: 30 benchmarks were skipped, so the baseline results were used instead. If they were deleted from the codebase, <a href="https://codspeed.io/astral-sh/ruff/branches/typeddict_union_narrowing?sectionId=benchmark-comparison-section-baseline-result-skipped&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=archive">click here and archive them to remove them from the performance reports</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-20 03:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:918 on 2025-12-20 03:29</div>
            <div class="timeline-body"><p>I ended up not using synthesized <code>TypedDict</code>s at all in this first iteration. Interested in getting feedback on that point. If we wanted to use them, it would be here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-20 13:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/Cargo.toml</code>:36 on 2025-12-20 13:08</div>
            <div class="timeline-body"><p>nit: I think you could just use <code>itertools::Either</code>, which would mean we wouldn&#x27;t need the additional dependency</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:887 on 2025-12-20 14:05</div>
            <div class="timeline-body"><pre><code>        if matches!(&amp;**ops, [ast::CmpOp::Eq])
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:897 on 2025-12-20 14:06</div>
            <div class="timeline-body"><pre><code>            &amp;&amp; let Type::StringLiteral(key_literal) = inference
                .expression_type(&amp;*subscript.slice)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:911 on 2025-12-20 14:13</div>
            <div class="timeline-body"><p>another important case to handle here is enum-literal types.</p>
<p>However, there&#x27;s some additional complications with enum literals, so I think it might be good to postpone enums to a followup. Namely, an enum literal can&#x27;t be used as a &quot;tag&quot; if the enum class has a custom <code>__eq__</code> method. That&#x27;s true if the enum class inherits from <code>IntEnum</code> or <code>StrEnum</code> (we handle this incorrectly in <a href="https://github.com/astral-sh/ty/issues/1454">some other situations</a> right now).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:918 on 2025-12-20 14:20</div>
            <div class="timeline-body"><p>Using a synthesized supertype might be more efficient for something like this, where multiple <code>TypedDict</code>s in the union have the same tag:</p>
<pre><code>from typing import TypedDict, Literal

class A(TypedDict):
    tag: Literal[&quot;tag1&quot;]
    x: int

class B(TypedDict):
    tag: Literal[&quot;tag1&quot;]
    x: str

class C(TypedDict):
    tag: Literal[&quot;tag1&quot;]
    x: bytes

class D(TypedDict):
    tag: Literal[&quot;tag2&quot;]

def f(td: A | B | C | D):
    if td[&quot;tag&quot;] == &quot;tag2&quot;:
        reveal_type(td)
    else:
        reveal_type(td)
</code></pre>
<p>You&#x27;d only have to create an intersection with one negative element rather than one with three negative elements. But I think it would be fine to land your current implementation and then experiment with whether this is in fact more efficient as a followup. The point about readability seems reasonable!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-20 14:21</div>
            <div class="timeline-body"><p>Nice! It would be great to rebase on <code>main</code> and see what the codspeed report is now <a href="https://github.com/astral-sh/ruff/pull/22102">astral-sh/ruff#22102</a> has landed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-22 17:04</div>
            <div class="timeline-body"><p>Unfortunately merging <code>main</code> takes this from a 0.87x slowdown to a 0.60x slowdown. Looking into it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-23 04:23</div>
            <div class="timeline-body"><p>04ee4dcbd8e34c5e5c35e601897242934726e5cf is a substantial refactoring. After staring at some profiles and adding logs and stuff, I&#x27;m pretty sure the problem is that I&#x27;m taking these unions of ~50 TypedDicts and intersecting them with ~49 negated TypedDicts in a lot of places, and that&#x27;s slow. The new approach is to synthesize a TypedDict with a single field in both cases (the <code>==</code> case and the <code>!=</code> case). To avoid incorrectly intersecting out non-<code>TypedDict</code> types in unions, I always intersect with a <em>negated</em> <code>SynthesizedTypedDict</code>, and the <code>==</code> case ends up as a double negative. Will look at what CodSpeed says later tonight or in the morning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 04:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/resources/mdtest/typed_dict.md</code>:2109 on 2025-12-23 04:41</div>
            <div class="timeline-body"><p>The display here changed from <code>~Bar</code> to <code>~&lt;TypedDict with items &#x27;tag&#x27;&gt;</code>. Probably that&#x27;s fine?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-23 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-23 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 12:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/typed_dict.md</code>:2109 on 2025-12-23 12:34</div>
            <div class="timeline-body"><p>I think that&#x27;s fine. I think the real fix to get rid of this is to implement disjointness between <code>dict</code> and <code>TypedDict</code> types... which theoretically isn&#x27;t too hard, but I&#x27;m a <em>bit</em> worried it might lead to false positives due to missing pieces in our TypedDict/bidirectional-inference logic elsewhere. Best done as a standalone change, anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/typed_dict.md</code>:2124 on 2025-12-23 12:46</div>
            <div class="timeline-body"><p>I guess that means that it <em>would</em> be sound to narrow using <code>not in</code> in some situations...? (But obviously not something for this PR, it can wait for a followup)</p>
<pre><code>from typing import TypedDict

class Foo(TypedDict):
    x: int

class Bar(TypedDict):
    y: int

def f(td: Foo | Bar):
    if &quot;x&quot; not in td:
        reveal_type(td)  # we can safely narrow to `Bar` here,
                         # -- the type cannot be `Foo`, since `x` is a required
                         # key in `Foo`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:913 on 2025-12-23 15:50</div>
            <div class="timeline-body"><pre><code>            let constrain_with_equality = is_positive == (ops[0] == ast::CmpOp);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:946 on 2025-12-23 15:50</div>
            <div class="timeline-body"><pre><code>                // To avoid excluding non-`TypedDict` types, our constraints are always
                // expressed as a negative intersection (i.e. &quot;you&#x27;re *not* this kind of
                // `TypedDict`&quot;). If `constrain_with_equality` is true, the whole constraint
                // is going to be a double negative, i.e. &quot;you&#x27;re *not* a `TypedDict`
                // *without* this literal
                // field&quot;. As the first step of building that, we negate the right hand side.
                let field_type = rhs_type.negate_if(self.db, constrain_with_equality);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:960 on 2025-12-23 16:17</div>
            <div class="timeline-body"><pre><code>                let intersection = Type::TypedDict(synthesized_typeddict).negate(self.db);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:1299 on 2025-12-23 16:18</div>
            <div class="timeline-body"><pre><code>                    Type::Intersection(intersection) =&gt; {
                        intersection.positive(db).iter().any(Type::is_typed_dict)
                    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 16:19</div>
            <div class="timeline-body"><p>Mostly some small simplifications:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:907 on 2025-12-23 17:32</div>
            <div class="timeline-body"><p>is there any reason not to include <code>BytesLiteral</code> types here (and in <code>all_matching_typeddict_fields_have_literal_types</code> lower down)? I guess it&#x27;s unlikely that someone would actually use a <code>BytesLiteral</code> tag, but if someone were to, they should behave just the same way as string-literal and int-literal tags, so I don&#x27;t see any disadvantage to including them here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:1341 on 2025-12-23 17:38</div>
            <div class="timeline-body"><pre><code>        // no matching field to check if the `.get()` call returns `None`
        typeddict.items(db).get(field_name).is_none_or(|field| {
            matches!(
                field.declared_ty,
                Type::StringLiteral(_) | Type::IntLiteral(_),
            )
        })
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 17:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-23 17:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:954 on 2025-12-23 17:40</div>
            <div class="timeline-body"><pre><code>                let schema = TypedDictSchema::from_iter([(field_name, field)]);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-12-23 17:42</div>
            <div class="timeline-body"><p>Awesome work. Thank you!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 18:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:946 on 2025-12-23 18:18</div>
            <div class="timeline-body"><p>Oh that&#x27;s so nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 18:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:913 on 2025-12-23 18:19</div>
            <div class="timeline-body"><p>0dcc064056</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 18:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:1299 on 2025-12-23 18:21</div>
            <div class="timeline-body"><p>Glorious. So many helper functions I haven&#x27;t spotted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 18:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:907 on 2025-12-23 18:31</div>
            <div class="timeline-body"><p>404dfd152e</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 18:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/src/types/narrow.rs</code>:1341 on 2025-12-23 18:33</div>
            <div class="timeline-body"><p>bdf958a547</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oconnor663">@oconnor663</a> reviewed on 2025-12-23 18:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oconnor663">@oconnor663</a> on <code>crates/ty_python_semantic/resources/mdtest/typed_dict.md</code>:2124 on 2025-12-23 18:40</div>
            <div class="timeline-body"><p>Added a TODO: e326492b80091866dba90654e588f1376521e479</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-23 19:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-23 19:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-23 19:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-23 19:37</div>
            <div class="timeline-body"><p>Awesome!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:22:00 UTC
    </footer>
</body>
</html>
