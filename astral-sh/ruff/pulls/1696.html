<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Include error location in GitHub Action diagnostic messages - astral-sh/ruff #1696</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Include error location in GitHub Action diagnostic messages</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1696">#1696</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-01-06 17:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>This ensures that if you look at the GitHub Actions <em>logs</em>, you see the entire message, including the location:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/211091772-df6f1deb-c741-435c-be2e-6ee22347a073.png" alt="Screen Shot 2023-01-06 at 3 08 06 PM"></p>
<p>The downside is that the location gets repeated inline:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/211091800-57020736-95fa-4e41-acb3-eb11c848ba7e.png" alt="Screen Shot 2023-01-06 at 3 08 30 PM"></p>
<p>See: #1693.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saadmk11">@saadmk11</a> reviewed on 2023-01-06 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/saadmk11">@saadmk11</a> on <code>src/printer.rs</code>:230 on 2023-01-06 17:24</div>
            <div class="timeline-body"><p>GitHub Actions Only uses these options for annotation. You probably need to add the file path to the message <code>::({})</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/printer.rs</code>:230 on 2023-01-06 17:26</div>
            <div class="timeline-body"><p>What I&#x27;m trying to resolve is that without this change, in the CI logs, you <em>only</em> see the message:</p>
<img alt="Screen Shot 2023-01-06 at 12 25 36 PM" src="https://user-images.githubusercontent.com/1309177/211064954-f35aaec7-4087-4e03-9919-eb123ff514a5.png">

<p>What I&#x27;d like is to surface the annotations, but also show the correct info in the logs. Any ideas?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-06 17:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saadmk11">@saadmk11</a> reviewed on 2023-01-06 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/saadmk11">@saadmk11</a> on <code>src/printer.rs</code>:230 on 2023-01-06 17:27</div>
            <div class="timeline-body"><p>Ref: https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-a-notice-message</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saadmk11">@saadmk11</a> reviewed on 2023-01-06 17:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/saadmk11">@saadmk11</a> on <code>src/printer.rs</code>:230 on 2023-01-06 17:31</div>
            <div class="timeline-body"><p>Probably replacing <code>message.kind.body(),</code> with  something like this will work: <code>format!(&quot;{}: {}&quot;, relativize_path(Path::new(&amp;message.filename)), message.kind.body())</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saadmk11">@saadmk11</a> reviewed on 2023-01-06 17:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/saadmk11">@saadmk11</a> on <code>src/printer.rs</code>:230 on 2023-01-06 17:34</div>
            <div class="timeline-body"><p>Or separately printing the file names without using the options will work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/saadmk11">@saadmk11</a> on <code>src/printer.rs</code>:251 on 2023-01-06 17:42</div>
            <div class="timeline-body"><p>Does something like this work?</p>
<pre><code>diagnostics.messages.iter().for_each(|message| {
      print!(
          &quot;::error title=Ruff ({}),file={},line={},col={},endLine={},\
           endColumn={}::{}&quot;,
          message.kind.code(),
          relativize_path(Path::new(&amp;message.filename)),
          message.location.row(),
          message.location.column(),
          message.end_location.row(),
          message.end_location.column(),
          message.kind.body(),
      );
      print!(&quot; [{}:{}]&quot;, relativize_path(Path::new(&amp;message.filename)), message.location.row());
  });
</code></pre>
<p>Notice: use of <code>print!</code> macro</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saadmk11">@saadmk11</a> reviewed on 2023-01-06 17:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 20:08</div>
            <div class="timeline-body"><p>A few options...</p>
<p>First, print info like this (too noisy, I think):</p>
<img alt="Screen Shot 2023-01-06 at 12 22 00 PM" src="https://user-images.githubusercontent.com/1309177/211065613-a51a0b26-f8b0-4689-83e5-a446459e4386.png">

<p>Second, interleave the readable and notice info:</p>
<img alt="Screen Shot 2023-01-06 at 12 29 03 PM" src="https://user-images.githubusercontent.com/1309177/211065662-6a5a2686-8a4e-40ea-bf0b-037cff5e59b2.png">

<p>Third, is to print out all the readable messages, then all of the diagnostics for GitHub:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/211078331-d4ea22af-f8f4-440f-84f3-4b867d5cabef.png" alt="Screen Shot 2023-01-06 at 1 45 16 PM"></p>
<p>Fourth would be to print the filenames as part of the message:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/211091199-dda8e97a-119d-49ab-a1c7-8acdf2d6c309.png" alt="Screen Shot 2023-01-06 at 3 08 06 PM"></p>
<p>I think I prefer the last option, but it does mean the filename is repeated in the actual annotation:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/211091264-9aae9e17-97e9-41b8-9f59-6b8e0f31423c.png" alt="Screen Shot 2023-01-06 at 3 08 30 PM"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 20:08</div>
            <div class="timeline-body"><p>\cc @edgarrmondragon - in case you have an opinion here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Debug GitHub Actions reporter&quot; to &quot;Include error location in GitHub Action diagnostic messages&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 20:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-06 20:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-01-06 20:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:46 UTC
    </footer>
</body>
</html>
