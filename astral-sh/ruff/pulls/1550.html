<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add task-tags &amp; ignore-overlong-task-comments settings - astral-sh/ruff #1550</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add task-tags &amp; ignore-overlong-task-comments settings</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1550">#1550</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2023-01-02 09:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a></div>
            <div class="timeline-body"><p>Programmers often leave comments to themselves and others such as:</p>
<pre><code># TODO: Use a faster algorithm?</code></pre>
<p>The keywords used to prefix such comments are just a convention and vary from project to project. Other common keywords include FIXME and HACK.</p>
<p>The keywords in use for the codebase are of interest to ruff because ruff does also lint comments. For example the ERA lint detects commented-out code but ignores comments starting with such a keyword. Previously the ERA lint simply hardcoded the regular expression TODO|FIXME|XXX to achieve that. This commit introduces a new <code>task-tags</code> setting to make this configurable (and to allow other comment lints to recognize the same set of keywords).</p>
<p>The term &quot;task tags&quot; has probably been popularized by the <a href="https://www.eclipse.org/pdt/help/html/task_tags.htm">Eclipse IDE</a>. For Python there has been the proposal <a href="https://peps.python.org/pep-0350/">PEP 350</a>, which referred to such keywords as &quot;codetags&quot;. That proposal however has been rejected. We are choosing the term &quot;task tags&quot; over &quot;code tags&quot; because the former is more descriptive: a task tag describes a task.</p>
<p>While according to the PEP 350 such keywords are also sometimes used for non-tasks e.g. NOBUG to describe a well-known problem that will never be addressed due to design problems or domain limitations, such keywords are so rare that we are neglecting them here in favor of more descriptive terminology. The vast majority of such keywords does describe tasks, so naming the setting &quot;task-tags&quot; is apt.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-02 17:14</div>
            <div class="timeline-body"><p>I don't think we should avoid flagging long-line violations for TODOs by default. If we want to support this for E501, it should be opt-in, in my opinion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-02 17:24</div>
            <div class="timeline-body"><p>Fair enough ... do you have an idea what the flag should be called? How about:</p>
<pre><code class="language-toml">[tool.ruff.pycodestyle]
allow-overlong-lines-for-comment-tags = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-02 18:06</div>
            <div class="timeline-body"><p>That looks reasonable. Or <code>ignore-long-comment-tags</code> as something more succinct? But what you have is more specific.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-02 18:13</div>
            <div class="timeline-body"><p>I think long-comment-tags would be confusing since it's not the comment tags that are long but the text that follows them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> requested changes on 2023-01-02 21:34</div>
            <div class="timeline-body"><p>(Just requesting changes to help with my own task management.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Introduce comment-tags setting (and make E501 skip them)" to "Add comment-tags & allow-overlong-lines-for-comment-tags settings" by @not-my-profile on 2023-01-03 02:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @not-my-profile on 2023-01-03 02:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-03 04:24</div>
            <div class="timeline-body"><p>Will try to get this merged tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>README.md</code>:1760 on 2023-01-03 18:50</div>
            <div class="timeline-body"><p><code>comment-tags</code> feels a bit too generic.</p>
<p>I guess Python almost called these <code>codetags</code> (<a href="https://peps.python.org/pep-0350/">PEP 350</a>).</p>
<p><code>todo-tags</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-03 18:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-03 18:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>README.md</code>:1760 on 2023-01-03 18:51</div>
            <div class="timeline-body"><p>Is &quot;codetags&quot; perhaps the standard terminology for this?</p>
<p>https://marketplace.visualstudio.com/items?itemName=cg-cnu.vscode-codetags
https://trac-hacks.org/wiki/CodeTagsPlugin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>README.md</code>:1760 on 2023-01-03 18:51</div>
            <div class="timeline-body"><p>I guess in Eclipse these are &quot;task tags&quot; (https://stackoverflow.com/questions/9586478/ide-comment-keywords). That feels most appropriate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-03 18:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-03 18:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>README.md</code>:3000 on 2023-01-03 18:52</div>
            <div class="timeline-body"><p>I am a little concerned that this option feels quite niche. Can you lay out the reasoning for including it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-03 21:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>README.md</code>:1760 on 2023-01-03 21:59</div>
            <div class="timeline-body"><p>Thanks for bringing this up! I agree that &quot;comment tags&quot; doesn't sound that great. And nice find with PEP 350 ... I didn't know about that PEP.</p>
<p>I am afraid there is no standard terminology for this. The PEP has been rejected and apparently only called these &quot;codetags&quot; because of the Trac plugin, you linked. That plugin is now also unmaintained. Sidenote ad the codetags VS Code extension: <a href="https://marketplace.visualstudio.com/items?itemName=aaron-bond.better-comments">Better Comments</a> is the much more commonly used extension for this, which calls these just <code>better-comments.tags</code> in the configuration and &quot;(annotation) tags&quot; in the documentation.</p>
<p>I don't like &quot;code tag&quot; since it's very uninformative (you cannot put these tags anywhere in the code; only in comments and the tags also don't describe the code but usually some tasks). &quot;todo tags&quot; is too specific since TODO is just one variant of such tags.</p>
<p>&quot;task tags&quot; is interesting. While I cannot recall hearing that term before, it does make sense and does appear to be somewhat established in academia (<code>task annotation</code> <a href="https://dl.acm.org/doi/10.1145/1368088.1368123">2008</a>, <code>task tag</code> <a href="https://www.cqse.eu/fileadmin/content/news/publications/2013-quality-analysis-of-source-code-comments.pdf">2013</a>, <code>task comment</code> <a href="https://research.ou.nl/ws/portalfiles/portal/46333009/Lung_C_IM9906_SE_AF_scriptie_Pure.pdf">2022</a>).</p>
<p>The only reason I see against &quot;task tags&quot; is that sometimes such tags are also used for non-tasks e.g NOBUG (from the PEP 350) to mark well-known problems that will never be addressed due to design problems or domain limitations. However such tags are really so rare that I think it is fine to go with &quot;task tags&quot;.</p>
<p>With all of this in mind &quot;task tags&quot; certainly seems like the best option :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-03 22:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>README.md</code>:3000 on 2023-01-03 22:08</div>
            <div class="timeline-body"><p>I extensively use such task tags for task management and use e.g. <code>git grep TODO</code> to list all TODO tasks within the repository. To make that convenient I put the task descriptions in a single line so that they are not cut off in the output by <code>git grep</code>.</p>
<p>(Sidenote: <code>git grep</code> does not support multi-line grepping ... while it's certainly possible to use <code>ripgrep</code> to find TODO comments that span multiple lines that does make collaborating with other people more difficult because then they need to install yet another tool to share the workflow).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @not-my-profile on 2023-01-03 22:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add comment-tags & allow-overlong-lines-for-comment-tags settings" to "Add task-tags & ignore-overlong-task-comments settings" by @not-my-profile on 2023-01-03 23:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @not-my-profile on 2023-01-03 23:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-03 23:51</div>
            <div class="timeline-body"><p>I renamed <code>comment-tags</code> to <code>task-tags</code> and <code>allow-overlong-lines-for-comment-tags</code> to <code>ignore-overlong-task-comments</code> as per my reasoning above.</p>
<p>I also split up the PR in three commits with extensive commit messages explaining the reasoning behind the changes. If you merge this, please preserve the individual commits ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @not-my-profile on 2023-01-04 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-04 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-04 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-05 02:47</div>
            <div class="timeline-body"><p>Thanks for merging ... but I am upset that squashed my carefully crafted commits despite me explicitly requesting you to preserve them. :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-05 02:56</div>
            <div class="timeline-body"><p>Maybe you could revert ca48492137d619c2cd25a9df8625464bf4e0a274 with another commit and then apply my commits individually? I wrote these commit messages to be preserved in the main branch ...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 03:14</div>
            <div class="timeline-body"><p>I do apologize. I tried to preserve them in the PR summary (by replacing it with the first commit message), since the project uses a one-commit-per-PR convention and I'm hesitant to deviate. I eventually want to get to a point such that we have clear PR summaries that get committed as part of the log, but we haven't been rigorous about it and so I've just been omitting messages for consistency. The alternative would've been to break each of those commits into its own PR and create a series of stacked diffs, which would've better lended itself to preserving the commit messages.</p>
<p>If you feel strongly in this case, I can go ahead and re-add to the body. Although I'll note that they do continue to exist in the history on GitHub, and any future archaeologists that are interested in these decisions will be able to find them here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-05 03:29</div>
            <div class="timeline-body"><p>I feel strongly about descriptive commits in general not just in this case. I absolutely do not care about GitHub PR descriptions ... they do not show up when doing a <code>git blame</code> or git logging individual files.</p>
<p>I am afraid that this is quite a dealbreaker for me ... I am not interested in contributing elaborate changes if I have to split them up into separate PRs just to have the commits preserved.</p>
<p>Note that this is not just about preserving the commit messages in the git log but also about having smaller commits with more readable diffs with commit messages that explain the reasoning behind the changes contained in the commit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 03:59</div>
            <div class="timeline-body"><p>Look, I don't want to be dogmatic. It's very, very reasonable to have a squash-and-merge policy on a codebase -- I can point to a bunch of projects that do this! It has a ton of benefits! -- but I can rebase-and-merge your PRs in the future given that you feel strongly. If, for whatever reason, you choose not to continue contributing to the project, then I earnestly and sincerely thank you for your contributions.</p>
<p>If you're interested in better understanding my perspective, you could Google around for &quot;stacked diffs&quot; (apologies if you're already familiar with this paradigm). It achieves exactly what you've described (smaller, more readable diffs, with commit messages that explain the reasoning), but at the PR level, rather than the commit level.</p>
<p>Separately: regardless of whether you &quot;care&quot; about GitHub PR descriptions, the truth is there's a ton of context in GitHub that isn't captured in the Git log. Look at all the comments on this PR :) From my experience working consistently in large codebases over many years, there's always context that lives in the tool and not in the log. The log is the starting point, not the end point. But, I don't think I'm going to convince you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-05 04:33</div>
            <div class="timeline-body"><p>Thanks for offering to rebase my PRs. Yes of course there is much context in issues and PRs but commit messages give us the opportunity to summarize that context so that the log is a more helpful starting point ... and you perhaps do not even need to look up the PRs to understand the reasoning behind the changes.</p>
<p>I am not familiar with &quot;stacked diffs&quot; ... I just looked into it and I think you rather mean &quot;stacked PRs&quot;? Does <a href="https://benjamincongdon.me/blog/2022/07/17/In-Praise-of-Stacked-PRs/">this blog post</a> describe what you mean? That blog post does mention some command-line tools for managing stacked PRs ... I am not familiar with them, but I can look into these tools ... can you recommend tools for stacked PRs or do you just manage them manually?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 04:36</div>
            <div class="timeline-body"><p>Heads up: I just reopened the PR as a revert + a cherry-pick of the original commits. I'm happy to avoid squashing your PRs in the future as long as the individual commits remain clear and high-quality as they were in this case. I'm sorry to have gone against your wishes in this case, and I hope we're able to continue working together on Ruff!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 04:40</div>
            <div class="timeline-body"><p>Yes, sorry, &quot;stacked diffs&quot; is a term that comes from a tool called Phabricator, which was a code review tool that spun out of Facebook... But it's analogous to &quot;stacked PRs&quot;.</p>
<p>GitHub admittedly doesn't have great tooling to support them and it's been a big area of complaint for people that are used to a stacked PR / stacked diff workflow. (They actually released some improvements like <a href="https://github.blog/changelog/2020-05-19-pull-request-retargeting/">automated retargeting</a>.)</p>
<p>I typically manage them &quot;manually&quot; by setting the upstream of each PR to the PR that comes before, then iteratively rebasing and pushing to update the chain.</p>
<p>Here are some more resources on the concept that I'm describing:</p>
<ul>
<li>https://matt-rickard.com/stacked-pull-requests</li>
<li>https://jg.gg/2018/09/29/stacked-diffs-versus-pull-requests/</li>
</ul>
<p>It's possible of course that I'm totally wrong and this isn't a good model for an open source project (vs. a corporate codebase, which I'm more used to). But <a href="https://github.com/dagster-io/dagster/commits/master">Dagster</a>, for example, does this -- notice that in the Git history, every commit is a PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2023-01-05 04:50</div>
            <div class="timeline-body"><p>Unfortunately, since GitHub requires the upstream of each PR to be a branch in the target repository, contributors without write access canâ€™t create stacked PRs at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 04:55</div>
            <div class="timeline-body"><p>Wow, that's a bummer! I hadn't even realized that. I'm too used to working within the context of an org.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2023-01-05 04:58</div>
            <div class="timeline-body"><p>Yeahâ€”it seems GitHub <a href="https://github.com/cli/cli/issues/5626#issuecomment-1125037574">hasnâ€™t realized it either</a>, probably for the same reason. ðŸ¤¦</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-05 05:00</div>
            <div class="timeline-body"><p>I have not contributed to projects using Phabricator or Gerrit for code review yet, so I am not familiar with this stacked PR workflow. Thanks Anders for that insight ... in that case I think I'll just continue to create PRs with carefully crafted commits. I don't have anything against squashing by default as a convention ... I'm just glad that you're willing to make an exception for contributors like me who like to craft self-contained and well-described individual commits :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:20 UTC
    </footer>
</body>
</html>
