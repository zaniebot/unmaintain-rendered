<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[syntax-errors] Reimplement PLE0118 - astral-sh/ruff #17135</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[syntax-errors] Reimplement PLE0118</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17135">#17135</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-04-01 21:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body">Summary
<p>This PR reimplements
<a href="https://docs.astral.sh/ruff/rules/load-before-global-declaration/">load-before-global-declaration (PLE0118)</a> as a semantic syntax error.</p>
<p>I added a <code>global</code> method to the <code>SemanticSyntaxContext</code> trait to make this very easy, at least in ruff. Does red-knot have something similar?</p>
<p>If this approach will also work in red-knot, I think some of the other PLE rules are also compile-time errors in CPython, PLE0117 in particular. 0115 and 0116 also mention <code>SyntaxError</code>s in their docs, but I haven&#x27;t confirmed them in the REPL yet.</p>
Test Plan
<p>Existing linter tests for PLE0118. I think this actually can&#x27;t be tested very easily in an inline test because the <code>TestContext</code> doesn&#x27;t have a real way to track globals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-01 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-01 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-01 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-01 21:41</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/semantic_errors.rs</code>:739 on 2025-04-02 07:46</div>
            <div class="timeline-body"><pre><code>    /// Return the [`TextRange`] at which a name is declared as `global` in the current scope.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/semantic_errors.rs</code>:793 on 2025-04-02 07:47</div>
            <div class="timeline-body"><p>Red Knot doesn&#x27;t support globals yet, so it&#x27;s hard to say if this will be supported in Red Knot and how ;)</p>
<p>It does have the downside that this check will not work in the test context. And it also means that it requires one extra traversal of the body to get the globals first but I don&#x27;t see how we can avoid that.</p>
<p>But we (you) can worry about that later ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-04-02 07:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-04-02 12:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_parser/src/semantic_errors.rs</code>:793 on 2025-04-02 12:57</div>
            <div class="timeline-body"><p>Haha sounds good :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-02 13:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-02 13:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-02 13:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:50 UTC
    </footer>
</body>
</html>
