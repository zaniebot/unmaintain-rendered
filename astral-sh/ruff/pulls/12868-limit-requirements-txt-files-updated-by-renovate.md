```yaml
number: 12868
title: "Limit `requirements.txt` files updated by renovate"
type: pull_request
state: merged
author: AlexWaygood
labels:
  - ci
assignees: []
merged: true
base: main
head: renovate-config-fix
created_at: 2024-08-13T16:53:01Z
updated_at: 2024-08-13T17:20:18Z
url: https://github.com/astral-sh/ruff/pull/12868
synced_at: 2026-01-12T15:55:42Z
```

# Limit `requirements.txt` files updated by renovate

---

_@AlexWaygood_

## Summary

Following https://github.com/astral-sh/ruff/commit/50ff5c754421474b353f94edfdc1fed7a8c3b82b, renovate is now filing PRs to update all `requirements.txt` files in Ruff:
- https://github.com/astral-sh/ruff/pull/12829
- https://github.com/astral-sh/ruff/pull/12823

The `requirements.txt` file being updated in ^both of those PRs isn't really appropriate for renovate to update, as it's generated by a `uv pip compile` command, and renovate hasn't implemented support for uv yet.

It turns out that the reason that renovate is doing this is because the `fileMatch` settings is _additive_ -- when you specify a regex under a `fileMatch` key, renovate uses that pattern _in addition_ to its default. (Specifying the pattern doesn't _override_ renovate's default.) To actually exclude files from being updated by renovate, we have to use `ignorePaths`. We haven't come across this before now, because the other package managers we have enabled in our renovate configs all have somewhat conservative defaults that will only update files found at the repository root. Renovate's `pip_requirements` package manager, however, will search for `requirements.txt` files anywhere and everywhere.

## Test Plan

```
~/dev/ruff (renovate-config-fix) % npx --yes --package renovate -- renovate-config-validator --strict    
(node:31231) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 INFO: Validating .github/renovate.json5
 INFO: Config validated successfully
```


---

_Label `ci` added by @AlexWaygood on 2024-08-13 16:53_

---

_Review requested from @dhruvmanila by @AlexWaygood on 2024-08-13 16:53_

---

_Review comment by @dhruvmanila on `.github/renovate.json5`:30 on 2024-08-13 16:57_

I haven't looked at the docs but do you think it's still reasonable to keep the `requirements.*\\.txt` part?

---

_@dhruvmanila approved on 2024-08-13 16:57_

Thanks! This is useful information as well. We should also ignore Cargo updates for `fuzz` crate (not necessarily by you or in this PR).

---

_@dhruvmanila reviewed on 2024-08-13 16:58_

---

_Review comment by @dhruvmanila on `.github/renovate.json5`:30 on 2024-08-13 16:58_

I guess the best way to verify this would be to merge and check the dependency dashboard issue?

---

_@AlexWaygood reviewed on 2024-08-13 17:01_

---

_Review comment by @AlexWaygood on `.github/renovate.json5`:30 on 2024-08-13 17:01_

> I haven't looked at the docs but do you think it's still reasonable to keep the `requirements.*\\.txt` part?

The double negative of "ignoring a negative glob pattern" is kind of melting my brain. But I _think_ that makes sense, yes -- thanks!

---

_@AlexWaygood reviewed on 2024-08-13 17:06_

---

_Review comment by @AlexWaygood on `.github/renovate.json5`:30 on 2024-08-13 17:06_

It's also so strange to me that `fileMatch` needs to be a regex whereas `ignorePaths` needs to be a glob

---

_Merged by @AlexWaygood on 2024-08-13 17:15_

---

_Closed by @AlexWaygood on 2024-08-13 17:15_

---

_Branch deleted on 2024-08-13 17:15_

---

_Comment by @AlexWaygood on 2024-08-13 17:19_

Looks like everything's now working as intended. After merging this PR:
- renovate autoclosed the two bad PRs it had previously opened:
  - https://github.com/astral-sh/ruff/pull/12823#event-13866735546
  - https://github.com/astral-sh/ruff/pull/12829#event-13866735928
- The `docs/*requirements.txt` files dependencies are still listed as renovate-tracked dependencies in the dependency dashboard: https://github.com/astral-sh/ruff/issues/10578

---
