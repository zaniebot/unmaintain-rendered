```yaml
number: 7425
title: "Tokenizer: Emit only a single bogus token"
type: pull_request
state: merged
author: konstin
labels: []
assignees: []
merged: true
base: main
head: tokenizer-a-single-bogus-token
created_at: 2023-09-15T22:02:02Z
updated_at: 2023-09-19T14:06:05Z
url: https://github.com/astral-sh/ruff/pull/7425
synced_at: 2026-01-12T02:39:10Z
```

# Tokenizer: Emit only a single bogus token

---

_Pull request opened by @konstin on 2023-09-15 22:02_

**Summary** Instead of emitting a bogus token per char, we now only emit on single last bogus token. This leads to much more concise output.

**Test Plan** Updated fixtures


---

_Comment by @konstin on 2023-09-15 22:02_

Current dependencies on/for this PR:
* main
  * **PR #7360** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7360" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7425** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7425" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7425?utm_source=stack-comment).

---

_Marked ready for review by @konstin on 2023-09-19 12:44_

---

_Comment by @codspeed-hq[bot] on 2023-09-19 12:53_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/tokenizer-a-single-bogus-token)

### Merging #7425 will **improve performances by 10.81%**

<sub>Comparing <code>tokenizer-a-single-bogus-token</code> (1df196e) with <code>main</code> (2cbe173)</sub>



### Summary

`âš¡ 5` improvements
`âœ… 20` untouched benchmarks




### Benchmarks breakdown

|     | Benchmark | `main` | `tokenizer-a-single-bogus-token` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| âš¡ | `formatter[numpy/globals.py]` | 1.1 ms | 1.1 ms | +2.59% |
| âš¡ | `formatter[large/dataset.py]` | 58.2 ms | 52.5 ms | +10.81% |
| âš¡ | `formatter[numpy/ctypeslib.py]` | 10.8 ms | 9.9 ms | +8.63% |
| âš¡ | `formatter[pydantic/types.py]` | 19.8 ms | 19.2 ms | +3.4% |
| âš¡ | `formatter[unicode/pypinyin.py]` | 3.6 ms | 3.4 ms | +8.03% |


---

_Comment by @konstin on 2023-09-19 13:31_

Reported the incorrect perfomance improvement (the base branch didn't change in codspeed) on their dicsord: https://discord.com/channels/1065233827569598464/1153684558269661285/1153684558269661285

---

_@MichaReiser approved on 2023-09-19 13:34_

---

_Merged by @konstin on 2023-09-19 14:06_

---

_Closed by @konstin on 2023-09-19 14:06_

---

_Branch deleted on 2023-09-19 14:06_

---
