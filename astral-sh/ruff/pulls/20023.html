<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add precise iteration and unpacking inference for string literals and bytes literals - astral-sh/ruff #20023</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add precise iteration and unpacking inference for string literals and bytes literals</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20023">#20023</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-08-21 13:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:38</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Previously we held off from doing this because we weren't sure that it was worth the added complexity cost. But our code has changed in the months since we made that initial decision, and I think the structure of the code is such that it no longer really leads to much added complexity to add precise inference when unpacking a string literal or a bytes literal.</p>
<p>The improved inference we gain from this has real benefits to users (see the mypy_primer report), and this PR doesn't appear to have a performance impact.</p>
<h2>Test plan</h2>
<p>mdtests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-08-21 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 13:40</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 13:42</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">scipy (https://github.com/scipy/scipy)
- scipy/linalg/tests/test_lapack.py:171:41: warning[possibly-unresolved-reference] Name `ref` used when possibly not defined
- Found 6401 diagnostics
+ Found 6400 diagnostics

</code></pre>
</details>
No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 13:48</div>
            <div class="timeline-body"><blockquote>
<pre><code class="language-diff">- scipy/linalg/tests/test_lapack.py:171:41: warning[possibly-unresolved-reference] Name `ref` used when possibly not defined
</code></pre>
</blockquote>
<p>Okay, this one's pretty cool -- ty is now able to infer that all possibilities have been exhaustively covered here, meaning the variable cannot possibly be undefined by the time the code reaches the assertion at the bottom: https://github.com/scipy/scipy/blob/99c0ef6af161a4d8157cae5276a20c30b7677c6f/scipy/linalg/tests/test_lapack.py#L147-L171</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Add precise tuple specs when iterating over other kinds of types" to "[ty] Add precise unpacking support for string literals and bytes literals" by @AlexWaygood on 2025-08-22 11:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Add precise unpacking support for string literals and bytes literals" to "[ty] Add precise iteration and unpacking inference for string literals and bytes literals" by @AlexWaygood on 2025-08-22 11:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AlexWaygood on 2025-08-22 12:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-08-22 12:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-08-22 12:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-08-22 12:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-22 18:22</div>
            <div class="timeline-body"><blockquote>
<p>ty is now able to infer that all possibilities have been exhaustively covered here</p>
</blockquote>
<p>This is a good example of the sort of issue that led us to disable <code>possibly-unresolved-reference</code> by default. Maybe at some point we'll be able to reconsider that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-08-22 18:28</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-08-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-08-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-22 18:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:46:47 UTC
    </footer>
</body>
</html>
