<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Support byte strings (`RUF055`) - astral-sh/ruff #18926</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Support byte strings (<code>RUF055</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18926">#18926</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-06-24 22:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a></div>
            <div class="timeline-body">

Summary


<p>Closes #18739</p>
Test Plan


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-24 22:36</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`RUF055`] could support equivalent cases using byte strings&quot; to &quot;[`RUF055`] Support equivalent cases using byte strings&quot; by <a href="https://github.com/danparizher">@danparizher</a> on 2025-06-24 23:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:103 on 2025-06-25 18:06</div>
            <div class="timeline-body"><p>nit: I slightly preferred the original phrasing, other than adding <code>or bytes</code>, but I&#x27;m a bit biased by having written the original comments. The <code>For now</code> parts are kind of implicit TODOs. We don&#x27;t necessarily have to keep these restrictions in the long term, especially in the case of metacharacters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:113 on 2025-06-25 18:29</div>
            <div class="timeline-body"><p>It feels a bit unfortunate to have to duplicate the list of characters, but I&#x27;m not sure if it&#x27;s bad enough to justify something like this:</p>
<pre><code>    const METACHARACTERS: [char; 12] =
        [&#x27;.&#x27;, &#x27;^&#x27;, &#x27;$&#x27;, &#x27;*&#x27;, &#x27;+&#x27;, &#x27;?&#x27;, &#x27;{&#x27;, &#x27;[&#x27;, &#x27;\\&#x27;, &#x27;|&#x27;, &#x27;(&#x27;, &#x27;)&#x27;];

    // Reject any regex metacharacters. Compare to the complete list
    // from https://docs.python.org/3/howto/regex.html#matching-characters
    let has_metacharacters = match &amp;literal {
        Literal::Str(str_lit) =&gt; str_lit.value.to_str().contains(METACHARACTERS),
        Literal::Bytes(bytes_lit) =&gt; bytes_lit
            .value
            .bytes()
            .any(|b| METACHARACTERS.contains(&amp;(b as char))),
    };
</code></pre>
<p>Unfortunately <code>array::map</code> isn&#x27;t const, so to get a separate, const byte array you have to use something even wilder with a <code>while</code> loop in a const block, as far as I know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:202 on 2025-06-25 18:40</div>
            <div class="timeline-body"><p>I think this check applies to byte strings too. This is the thread that prompted these changes: <a href="https://github.com/astral-sh/ruff/pull/14679">astral-sh/ruff#14679</a>#discussion_r1863802187, and it looks like the escape there also works for byte strings:</p>
<pre><code>&gt;&gt;&gt; import re
&gt;&gt;&gt; re.sub(b&quot;foo&quot;, rb&quot;\g&lt;0&gt;bar&quot;, b&quot;foobar&quot;)
b&#x27;foobarbar&#x27;
</code></pre>
<p>so I don&#x27;t think we can restrict this to the string literal case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:376 on 2025-06-25 18:48</div>
            <div class="timeline-body"><p>tiny nit: I&#x27;d swap the order of <code>resolve_literal</code> and <code>resolve_bytes_literal</code> to keep the general function closer to the top and closer to the enum it generates.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-06-25 19:04</div>
            <div class="timeline-body"><p>Thanks, this looks pretty good overall. I just had a couple of nits and a larger concern about the escapes in byte strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-25 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-25 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a> reviewed on 2025-06-25 21:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/danparizher">@danparizher</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:103 on 2025-06-25 21:11</div>
            <div class="timeline-body"><p>That makes sense, I reverted the phrasing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a> reviewed on 2025-06-25 21:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/danparizher">@danparizher</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:376 on 2025-06-25 21:11</div>
            <div class="timeline-body"><p>Swapped.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a> reviewed on 2025-06-25 21:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/danparizher">@danparizher</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:113 on 2025-06-25 21:12</div>
            <div class="timeline-body"><p>Implemented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a> reviewed on 2025-06-25 21:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/danparizher">@danparizher</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:202 on 2025-06-25 21:15</div>
            <div class="timeline-body"><p>I see what you mean - I updated the logic to handle both <code>str</code> and <code>bytes</code> literals for the replacement argument by using <code>match</code> on the resolved literal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:105 on 2025-07-18 13:15</div>
            <div class="timeline-body"><pre><code>    // For now, reject any regex metacharacters. Compare to the complete list
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:107 on 2025-07-18 13:15</div>
            <div class="timeline-body"><pre><code></code></pre>
<p>(just reverting the minor changes in this area)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:14 on 2025-07-18 13:16</div>
            <div class="timeline-body"><p>nit: I&#x27;d probably just put this next to where it&#x27;s used. It seems kind of confusing to have it up here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:200 on 2025-07-18 13:19</div>
            <div class="timeline-body"><p>I think this comment is slightly outdated now that it doesn&#x27;t contrast with the behavior for byte literals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/ruff/rules/unnecessary_regular_expression.rs</code>:226 on 2025-07-18 13:19</div>
            <div class="timeline-body"><p>This might be a good constant to extract too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-07-18 13:22</div>
            <div class="timeline-body"><p>Thank you! I found a few more very small nits, but this is good to go otherwise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/danparizher">@danparizher</a> on 2025-07-18 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-07-20 21:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`RUF055`] Support equivalent cases using byte strings&quot; to &quot;[`ruff`] Support byte strings (`RUF055`)&quot; by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-20 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-20 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-20 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-20 22:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:15:53 UTC
    </footer>
</body>
</html>
