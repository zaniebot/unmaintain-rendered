<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove workspace support - astral-sh/ruff #15472</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove workspace support</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15472">#15472</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-01-14 11:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-14 11:06</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR removes Red Knot's native support for workspaces. This doesn't mean that Red Knot won't support workspaces long-term, but the goal is to build on uv's workspace structure instead of defining its own. I forsee that Red Knot will need to represent the package structure to resolve the closest configuration. However, I don't think it's worth keeping the existing code around as the uv integration is still rather far out.</p>
<ul>
<li>Renames <code>Workspace</code> to <code>Project</code> (in many places)</li>
<li>Remove <code>Package</code> and the <code>Project::packages</code> field</li>
<li>Removes workspace specific tests.</li>
<li>Rename <code>RootDatabase</code> to <code>ProjectDatabase</code>: It's the database for a single project.</li>
</ul>
<p>I intentionally didn't rename the <code>red_knot_workspace</code> crate as part of this PR to avoid mixing structural and functional changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2025-01-14 11:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-14 11:15</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_workspace/src/project.rs</code>:1 on 2025-01-14 12:27</div>
            <div class="timeline-body"><p>It's unfortunate that git doesn't recognize this as the same file as <code>workspace.rs</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-14 12:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-14 12:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_workspace/src/project/metadata.rs</code>:1 on 2025-01-14 12:47</div>
            <div class="timeline-body"><p>This file is also a trimmed down version of what used to be in <code>workspace/metadata</code> but git doesn't recognize that ;(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-14 12:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_workspace/tests/check.rs</code>:4 on 2025-01-14 12:48</div>
            <div class="timeline-body"><p>The paths here are somewhat funny. <code>red_knot_project::project</code>. I need to think about how I can improve that but I'll leave this to another PR as this is a pre-existing issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-01-14 12:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-01-14 12:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-01-14 12:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-01-14 12:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-14 12:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_workspace/src/project/metadata.rs</code>:60 on 2025-01-14 12:58</div>
            <div class="timeline-body"><p>I know this has come up in the CLI proposal. Skipping over projects without a <code>tool.knot</code> section is sort of important to support projects using uv's workspace layout where you have</p>
<pre><code>root
| - packages
|   | -- a
|   |    | - pyproject.toml
|   |    | - ...
|   | -- a
|   |   | - pyproject.toml
|   |   | - ...
|  - src
|   | - ... 
| - pyproject.toml (with `tool.knot` section)
</code></pre>
<p>In this case, it's important that the entire workspace can be checked as one. That's why running <code>knot</code> in <code>packages/a</code> should also pick up the configuration from the root, unless that one package overrides its own configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_workspace/src/project/metadata.rs</code>:60 on 2025-01-14 18:51</div>
            <div class="timeline-body"><p>I'm still not sure I agree that this is important, or the right behavior, but we can always change it and I think it will be more useful to sort it out later with real use cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-01-14 18:51</div>
            <div class="timeline-body"><p>It's a bit hard to find the meaningful changes in this PR, but I think I found most of them, and it looks good to me, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-15 08:03</div>
            <div class="timeline-body"><blockquote>
<p>It's a bit hard to find the meaningful changes in this PR, but I think I found most of them, and it looks good to me, thank you!</p>
</blockquote>
<p>I'm sorry for that. I only realized when reading your comment that I could have done the rename first and then removed <code>packages</code>. I'll try to consider this next time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-01-15 08:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-01-15 08:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-15 08:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:34:30 UTC
    </footer>
</body>
</html>
