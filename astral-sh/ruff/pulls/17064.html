<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control flow graph: setup - astral-sh/ruff #17064</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Control flow graph: setup</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17064">#17064</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-03-30 21:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>This PR contains the scaffolding for a new control flow graph implementation, along with its application to the <code>unreachable</code> rule. At the moment, the implementation is a maximal over-approximation: no control flow is modeled and all statements are counted as reachable. With each additional statement type we support, this approximation will improve.</p>
<p>So this PR just contains:</p>
<ul>
<li>A <code>ControlFlowGraph</code> struct and builder</li>
<li>Support for printing the flow graph as a Mermaid graph</li>
<li>Snapshot tests for the actual graphs</li>
<li>(a very bad!) reimplementation of <code>unreachable</code> using the new structs</li>
<li>Snapshot tests for <code>unreachable</code></li>
</ul>
<h1>Instructions for Viewing Mermaid snapshots</h1>
<p>Unfortunately I don't know how to convince GitHub to render the Mermaid graphs in the snapshots. However, you can view these locally in VSCode if you install an extension that supports Mermaid graphs in Markdown, and then add this to your <code>settings.json</code>:</p>
<pre><code class="language-json">  &quot;files.associations&quot;: {
&quot;*.md.snap&quot;: &quot;markdown&quot;,
  }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">do-not-merge</span> added by @dylwil3 on 2025-03-30 21:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dylwil3 on 2025-03-30 21:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-30 21:48</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -25 violations, +0 -0 fixes in 8 projects; 47 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -14 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/src/airflow/models/mappedoperator.py#L71'>airflow-core/src/airflow/models/mappedoperator.py:71:9:</a> PLW0101 Unreachable code in `expand_start_from_trigger`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/src/airflow/triggers/base.py#L103'>airflow-core/src/airflow/triggers/base.py:103:9:</a> PLW0101 Unreachable code in `run`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/src/airflow/triggers/testing.py#L52'>airflow-core/src/airflow/triggers/testing.py:52:13:</a> PLW0101 Unreachable code in `run`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_baseoperator.py#L213'>airflow-core/tests/unit/models/test_baseoperator.py:213:21:</a> PLW0101 Unreachable code in `my_work`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L1171'>airflow-core/tests/unit/models/test_mappedoperator.py:1171:17:</a> PLW0101 Unreachable code in `my_work`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L1209'>airflow-core/tests/unit/models/test_mappedoperator.py:1209:25:</a> PLW0101 Unreachable code in `my_work`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L1256'>airflow-core/tests/unit/models/test_mappedoperator.py:1256:25:</a> PLW0101 Unreachable code in `my_work`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L565'>airflow-core/tests/unit/models/test_mappedoperator.py:565:21:</a> PLW0101 Unreachable code in `my_setup`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L636'>airflow-core/tests/unit/models/test_mappedoperator.py:636:21:</a> PLW0101 Unreachable code in `other_setup`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L652'>airflow-core/tests/unit/models/test_mappedoperator.py:652:21:</a> PLW0101 Unreachable code in `my_setup`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L678'>airflow-core/tests/unit/models/test_mappedoperator.py:678:21:</a> PLW0101 Unreachable code in `other_setup`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L851'>airflow-core/tests/unit/models/test_mappedoperator.py:851:21:</a> PLW0101 Unreachable code in `my_work`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_mappedoperator.py#L868'>airflow-core/tests/unit/models/test_mappedoperator.py:868:21:</a> PLW0101 Unreachable code in `my_work`
- <a href='https://github.com/apache/airflow/blob/d346df13639da34e0420cd6d9550d6e41c8cd2c1/airflow-core/tests/unit/models/test_taskinstance.py#L3423'>airflow-core/tests/unit/models/test_taskinstance.py:3423:13:</a> PLW0101 Unreachable code in `on_finish_callable`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+0 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/freedomofpress/securedrop/blob/abbe222dcee90ef2dcc8218a2e151b4ed7935715/admin/securedrop_admin/__init__.py#L78'>admin/securedrop_admin/__init__.py:78:5:</a> PLW0101 Unreachable code in `openssh_version`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/langchain-ai/langchain">langchain-ai/langchain</a> (+0 -3 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/langchain-ai/langchain/blob/ecff055096bc137bc10d7933d71016e2af56c06d/libs/core/langchain_core/runnables/base.py#L5093'>libs/core/langchain_core/runnables/base.py:5093:13:</a> PLW0101 Unreachable code in `astream_events`
- <a href='https://github.com/langchain-ai/langchain/blob/ecff055096bc137bc10d7933d71016e2af56c06d/libs/core/tests/unit_tests/runnables/test_fallbacks.py#L267'>libs/core/tests/unit_tests/runnables/test_fallbacks.py:267:5:</a> PLW0101 Unreachable code in `_generate_immediate_error`
- <a href='https://github.com/langchain-ai/langchain/blob/ecff055096bc137bc10d7933d71016e2af56c06d/libs/core/tests/unit_tests/runnables/test_fallbacks.py#L295'>libs/core/tests/unit_tests/runnables/test_fallbacks.py:295:5:</a> PLW0101 Unreachable code in `_agenerate_immediate_error`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/latchbio/latch">latchbio/latch</a> (+0 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/latchbio/latch/blob/62c4d98a8256e7f179d69632fa00d24aa440bf57/src/latch_cli/snakemake/single_task_snakemake.py#L236'>src/latch_cli/snakemake/single_task_snakemake.py:236:5:</a> PLW0101 Unreachable code in `empty_generator`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+0 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/milvus-io/pymilvus/blob/0f037ba3cb1a23466d4d5ae111240ca85170da57/examples/iterator/iterator.py#L64'>examples/iterator/iterator.py:64:9:</a> PLW0101 Unreachable code in `external_filter_func`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+0 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/pandas-dev/pandas/blob/83979d6a0c5a223bac2af8ef706c5ff8d432bcca/pandas/io/parsers/python_parser.py#L1314'>pandas/io/parsers/python_parser.py:1314:25:</a> PLW0101 Unreachable code in `_get_lines`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pytest-dev/pytest">pytest-dev/pytest</a> (+0 -3 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/pytest-dev/pytest/blob/33e2e262d688ed2951ec5174e51545fda918e6f2/src/_pytest/config/__init__.py#L1870'>src/_pytest/config/__init__.py:1870:9:</a> PLW0101 Unreachable code in `_assertion_supported`
- <a href='https://github.com/pytest-dev/pytest/blob/33e2e262d688ed2951ec5174e51545fda918e6f2/testing/code/test_code.py#L151'>testing/code/test_code.py:151:17:</a> PLW0101 Unreachable code in `test_bad_getsource`
- <a href='https://github.com/pytest-dev/pytest/blob/33e2e262d688ed2951ec5174e51545fda918e6f2/testing/code/test_code.py#L167'>testing/code/test_code.py:167:17:</a> PLW0101 Unreachable code in `test_getsource`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/astropy/astropy">astropy/astropy</a> (+0 -1 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href='https://github.com/astropy/astropy/blob/2382a9912a025c71eb9802c2efe566457b524a7c/astropy/table/tests/test_bst.py#L18'>astropy/table/tests/test_bst.py:18:5:</a> PLW0101 Unreachable code in `tree`
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLW0101 | 25 | 0 | 25 | 0 | 0 |</p>
</p>
</details>

<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-31 10:23</div>
            <div class="timeline-body"><p>I don't think I follow your PR approach. Is the idea that you want to reuse this PR as the target of stacked PRs later on? If so, what's the reason for merging the stacked PRs into this PR over directly merging to main (the <code>unreachable</code> rule has never been shipped)?</p>
<p>To phrase it differently. What prevents us from merging this to main?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/resources/test/fixtures/pylint/unreachable.py</code>:1 on 2025-03-31 10:24</div>
            <div class="timeline-body"><p>Do we want to preserve those test cases somewhere/somehow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:20 on 2025-03-31 10:29</div>
            <div class="timeline-body"><p>Can you explain what <code>empty</code> means (as part of the comment)? Is it that the <code>BlockId</code> is empty or is it that the block is empty?</p>
<p>It might be sufficient to always speak of blocks instead of nodes here (it's clear to me what an empty block is, I don't know what an empty node is)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:116 on 2025-03-31 10:32</div>
            <div class="timeline-body"><p>I think it's worth documenting that <code>conditions</code> and <code>targets</code> must always be the exact same length.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:232 on 2025-03-31 10:35</div>
            <div class="timeline-body"><p>This line isn't clear to me and the comment doesn't add much. What's this line about? Aren't we always setting all statements?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:275 on 2025-03-31 10:36</div>
            <div class="timeline-body"><p>Nit: <code>set_current_block_stmts</code> and <code>set_current_block_edges</code> to make it clear that this only mutates the current block and not the state of the entire builder.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:176 on 2025-03-31 10:38</div>
            <div class="timeline-body"><p>What do you think of always creating an empty block for the start of the CFG. Could this simplify the <code>set_stmts</code> and <code>set_edgs</code> function because we can create a <code>add_block(stmts, edges)</code> function?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/mod.rs</code>:20 on 2025-03-31 10:38</div>
            <div class="timeline-body"><p>Is this the same as?</p>
<pre><code class="language-suggestion">        let path = PathBuf::from(&quot;resources/test/fixtures/cfg&quot;).join(filename);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/mod.rs</code>:31 on 2025-03-31 10:40</div>
            <div class="timeline-body"><p>Should the test fail if the module body contains any non function statements (it might not be obvious that the framework only captures function level statements)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:81 on 2025-03-31 10:45</div>
            <div class="timeline-body"><p>Can you add some documentation what <code>parents</code> are in a basic block context? Is it the incoming basic blocks?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:115 on 2025-03-31 10:46</div>
            <div class="timeline-body"><p>I don't think this has to defer this PR further but I wonder if we could use a structure similar to https://docs.rs/petgraph/latest/petgraph/graph/struct.Graph.html where <code>Node</code> and <code>Edge</code>s avoid allocations by roughly using an arena for nodes and edges and links between nodes and edges (all fixed size, using a fixed array)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:13 on 2025-03-31 10:48</div>
            <div class="timeline-body"><p>It would be great to have some module or struct level documentation explaining what a CFG is, what are basic blocks, how are they connected, and how the data is represented.</p>
<p>You may want to wait with writing this documentation if we end up changing the representation of <code>Nodes</code> (<code>Block</code>) and <code>Edges</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:15 on 2025-03-31 10:49</div>
            <div class="timeline-body"><p>Nit: The all uppercase breaks my mind but I'm not sure why. I'm sort of leaning towards avoiding the <code>cfg</code> abbreviation and just using the full name <code>ControlFlowGraph</code> (also less confusing with rusts <code>cfg!</code> macro</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-03-31 10:50</div>
            <div class="timeline-body"><p>This overall looks good to me. I left a few in detail comments.</p>
<p>The biggest one is whether we want to consider an alternative representation for <code>Block</code> and <code>Edge</code>s that avoids the nested vectors, which is also something we can consider doing as a separate PR (and maybe even better to get an understanding for the performance characteristics)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-31 13:21</div>
            <div class="timeline-body"><blockquote>
<p>I don't think I follow your PR approach. Is the idea that you want to reuse this PR as the target of stacked PRs later on? If so, what's the reason for merging the stacked PRs into this PR over directly merging to main (the <code>unreachable</code> rule has never been shipped)?</p>
<p>To phrase it differently. What prevents us from merging this to main?</p>
</blockquote>
<p>Nothing prevents us from merging into main except that the code would just be sitting there not used for anything for a bit. If it makes things less complicated I'm happy to just do sequential PRs directly into main!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-31 13:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:15 on 2025-03-31 13:22</div>
            <div class="timeline-body"><p>That's fine with me! do you also want me to change the name of the submodule itself to <code>control_flow_graph</code> or <code>control_flow</code> or something instead of <code>cfg</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:15 on 2025-03-31 13:48</div>
            <div class="timeline-body"><p>Ha, I think the module name is fine... I know, I don't make much sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-31 13:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-31 13:49</div>
            <div class="timeline-body"><blockquote>
<p>Nothing prevents us from merging into main except that the code would just be sitting there not used for anything for a bit. If it makes things less complicated I'm happy to just do sequential PRs directly into main!</p>
</blockquote>
<p>That seems not much different from the unreachable code that's already on main. I'm all for merging to main because it makes our live easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-31 13:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:176 on 2025-03-31 13:52</div>
            <div class="timeline-body"><p>I think we could certainly make the initial and final blocks empty. It may also be possible to always arrange that we set statements and edges on a block at the same time - but I'm not sure. I don't think we can call this <code>add_block</code> though because we will often need to create a block (and assign it an index) before we populate it.</p>
<p>I think it may make sense to wait until some or all of the statement kinds have been implemented, and then see if it's possible to do some clean up like this. Does that sound okay?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-31 13:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:13 on 2025-03-31 13:59</div>
            <div class="timeline-body"><p>I agree! I plan on writing detailed documentation of the spec and the implementation, but was deferring it until things were more solidified. A draft of the spec documentation I had in mind is in the tracking issue https://github.com/astral-sh/ruff/issues/17065</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">do-not-merge</span> removed by @dylwil3 on 2025-03-31 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @dylwil3 on 2025-03-31 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_semantic/src/cfg/mod.rs</code>:31 on 2025-04-01 10:37</div>
            <div class="timeline-body"><p>By framework do you mean the framework of the test or of the control flow graph? The control flow graph should work the same for modules as well, it's just the snapshot test that is organized this way so that you can have more than one graph per file.</p>
<p>I've made the test fail as you suggest, but may revert that later if it makes sense to allow, say, import statements for certain examples.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-01 10:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-01 10:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/resources/test/fixtures/pylint/unreachable.py</code>:1 on 2025-04-01 10:38</div>
            <div class="timeline-body"><p>I'll let <code>git</code> do the preserving! I plan to bring them back by the end of the series of PRs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-04-01 10:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_python_semantic/src/cfg/graph.rs</code>:115 on 2025-04-01 10:43</div>
            <div class="timeline-body"><p>This is a very interesting idea! I think for now I will defer this and do some perf experiments in the end. But I will keep this in mind and try to write the implementation in a way that would not make such a refactor too painful.</p>
<p>The previous implementation got around this by keeping their graph bivalent at the cost of having more nodes. Another idea is to make the array sizes used in the <code>SmallVec</code>'s bigger. It's not clear to me (but maybe it is to you!) the relative performance of these three options - and it's even less clear how much of a difference it makes on real world Python code. I think we'd have a better idea once the full implementation is in place and we can do some benchmarking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Reimplement the control flow graph" to "Control flow graph: setup" by @dylwil3 on 2025-04-01 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2025-04-01 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-04-01 10:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:11:05 UTC
    </footer>
</body>
</html>
