<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Add assignability of function literals to callables - astral-sh/ruff #17095</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Add assignability of function literals to callables</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17095">#17095</a>
        opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a>
        on 2025-03-31 14:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Part  of #16953</p>
<h2>Test Plan</h2>
<p>Update is_assignable_to.md</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MatthewMckee4 on 2025-03-31 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MatthewMckee4 on 2025-03-31 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MatthewMckee4 on 2025-03-31 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MatthewMckee4 on 2025-03-31 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-31 15:01</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">pyinstrument (https://github.com/joerick/pyinstrument)
- error[lint:invalid-return-type] /tmp/mypy_primer/projects/pyinstrument/test/util.py:122:12: Object of type `Literal[wrapped]` is not assignable to return type `() -&gt; None`
- error[lint:invalid-argument-type] /tmp/mypy_primer/projects/pyinstrument/test/low_level/test_context.py:48:19: Object of type `Literal[busy_wait]` cannot be assigned to parameter 2 (`callable`) of bound method `run`; expected type `(...) -&gt; Unknown`
- error[lint:invalid-argument-type] /tmp/mypy_primer/projects/pyinstrument/test/low_level/test_context.py:49:19: Object of type `Literal[busy_wait]` cannot be assigned to parameter 2 (`callable`) of bound method `run`; expected type `(...) -&gt; Unknown`
- Found 273 diagnostics
+ Found 270 diagnostics

isort (https://github.com/pycqa/isort)
- error[lint:invalid-return-type] /tmp/mypy_primer/projects/isort/isort/literal.py:84:12: Object of type `Literal[wrap]` is not assignable to return type `((Any, ISortPrettyPrinter, /) -&gt; str, /) -&gt; (Any, ISortPrettyPrinter, /) -&gt; str`
- error[lint:invalid-argument-type] /tmp/mypy_primer/projects/isort/isort/main.py:1126:77: Object of type `Literal[_preconvert]` cannot be assigned to parameter `default` of function `dumps`; expected type `((Any, /) -&gt; Any) | None`
- error[lint:invalid-assignment] /tmp/mypy_primer/projects/isort/isort/settings.py:749:9: Object of type `Literal[from_string]` is not assignable to `((str, /) -&gt; Any) | type[Any]`
- Found 53 diagnostics
+ Found 50 diagnostics

black (https://github.com/psf/black)
- error[lint:invalid-return-type] /tmp/mypy_primer/projects/black/src/black/trans.py:2482:12: Object of type `Literal[insert_str_child]` is not assignable to return type `(@Todo(Inference of subscript on special form), /) -&gt; None`
- Found 212 diagnostics
+ Found 211 diagnostics

rich (https://github.com/Textualize/rich)
- error[lint:invalid-parameter-default] /tmp/mypy_primer/projects/rich/rich/cells.py:51:25: Default value of type `Literal[cached_cell_len]` is not assignable to annotated parameter type `(str, /) -&gt; int`
- error[lint:invalid-assignment] /tmp/mypy_primer/projects/rich/rich/pretty.py:226:9: Object of type `Literal[display_hook]` is not assignable to attribute `displayhook` of type `(object, /) -&gt; Any`
- error[lint:invalid-return-type] /tmp/mypy_primer/projects/rich/rich/console.py:512:16: Object of type `Literal[_replace]` is not assignable to return type `(...) -&gt; Group`
- error[lint:invalid-return-type] /tmp/mypy_primer/projects/rich/rich/console.py:514:12: Object of type `Literal[decorator]` is not assignable to return type `(...) -&gt; (...) -&gt; Group`
- error[lint:invalid-assignment] /tmp/mypy_primer/projects/rich/rich/traceback.py:207:9: Object of type `Literal[excepthook]` is not assignable to attribute `excepthook` of type `(type[BaseException], BaseException, TracebackType | None, /) -&gt; Any`
- Found 583 diagnostics
+ Found 578 diagnostics

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @dhruvmanila on 2025-03-31 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-31 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_assignable_to.md</code>:502 on 2025-03-31 15:19</div>
            <div class="timeline-body"><p>These two code snippets are merged by the test runner because they're under the same heading so we can simplify them by using a single code block (remove the duplicate imports, use different names for both functions).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-31 15:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_assignable_to.md</code>:479 on 2025-03-31 15:34</div>
            <div class="timeline-body"><p>I think I'd name the header as &quot;Function types&quot; as the &quot;Callable&quot; section is mostly for non-static / gradual types because the cases with fully static types are included in <code>is_fully_static</code> test cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_assignable_to.md</code>:490 on 2025-03-31 15:37</div>
            <div class="timeline-body"><p>I don't think this comments adds any additional context so it might be best to remove it</p>
<pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-03-31 15:37</div>
            <div class="timeline-body"><p>Looks good, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2025-03-31 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2025-03-31 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-31 15:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:11:07 UTC
    </footer>
</body>
</html>
