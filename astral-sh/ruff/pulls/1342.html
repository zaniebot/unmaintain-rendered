<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect --force-exclude for files passed via stdin - astral-sh/ruff #1342</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Respect --force-exclude for files passed via stdin</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1342">#1342</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2022-12-22 21:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-22 21:29</div>
            <div class="timeline-body"><p>Resolves #1339.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-22 21:30</div>
            <div class="timeline-body"><p>It turns out that it's very, very hard to use the <code>ignore</code> crate to answer the question, &quot;Is a given path ignored?&quot;, because it doesn't <em>seem</em> to expose the underlying matchers, only the directory walkers. This creates a few problems. I'll just leave this comment here for posterity as I roll back some of the code:</p>
<pre><code>// Step 2: Is the file ignored via a gitignore?
// Note that we can't enforce this behavior for non-existent files, which _could_ come up when
// you pass a file via `--stdin-filename`, and _could_ be considered incorrect. For example,
// if `subdir` is listed in the `gitignore`, and you pass `subdir/non_existent_file.py`, then
// right now, we _wouldn't_ mark that theoretical file as ignored. If the `ignore` crate had
// a public matcher API, we could support that, but right now, we _have_ to look at the
// filesystem to reverse-engineer the gitignore match.
</code></pre>
<pre><code>// TODO(charlie): This isn't right either, because the _parent_ could be the thing that's
// ignored via the `.gitignore`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jhossbach">@jhossbach</a> on 2022-12-22 21:38</div>
            <div class="timeline-body"><p>Seems like I was too slow. Also closes #1343</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-22 21:40</div>
            <div class="timeline-body"><p>Sadly this doesn't respect gitignore rules in those cases (I tried to get this to work for a while, but I don't think it's reliable without changes to the <code>ignore</code> crate), but otherwise seems to work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2022-12-22 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-22 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-12-22 21:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 05:38:27 UTC
    </footer>
</body>
</html>
