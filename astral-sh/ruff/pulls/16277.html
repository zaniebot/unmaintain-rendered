<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Separate `definitions_by_definition` into separate fields - astral-sh/ruff #16277</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Separate <code>definitions_by_definition</code> into separate fields</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16277">#16277</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2025-02-20 14:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a></div>
            <div class="timeline-body"><p>A minor cleanup that breaks up a <code>HashMap</code> of an enum into separate <code>HashMap</code>s for each variant.  (These separate fields were already how this cache was being described in the big comment at the top of the file!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-20 14:39</div>
            <div class="timeline-body"><p>Is there any other motivation other than that this is how it was described in the comment?</p>
<p>I assume the idea of using a single hash map is to reduce the need for allocations (and make the struct slightly smaller). I don&#x27;t know if this is a worthwhile trade-off.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-20 14:39</div>
            <div class="timeline-body"><p>It does seem to make codspeed hapy</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:46</div>
            <div class="timeline-body"><blockquote>
<p>Is there any other motivation other than that this is how it was described in the comment?</p>
<p>I assume the idea of using a single hash map is to reduce the need for allocations (and make the struct slightly smaller). I don&#x27;t know if this is a worthwhile trade-off.</p>
</blockquote>
<p>It was partly that and partly that the code seemed cleaner â€” the enum only existed to be able to fold both cases into a single hashmap, but they really are conceptually different caches that seemed better to store separately.  (I would have considered this worthwhile if performance was a wash, but not if it regressed)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dcreager">@dcreager</a> on 2025-02-20 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-20 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-02-20 18:28</div>
            <div class="timeline-body"><p>Thank you! Yeah I was just trying to reduce the number of hashmaps, but if codspeed is happy with this, it&#x27;s definitely nicer.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:11:38 UTC
    </footer>
</body>
</html>
