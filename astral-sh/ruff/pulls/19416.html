<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pyi`] Skip fix if all `Union` members are `None` (`PYI016`)  - astral-sh/ruff #19416</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pyi</code>] Skip fix if all <code>Union</code> members are <code>None</code> (<code>PYI016</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19416">#19416</a>
        opened by <a href="https://github.com/soundsonacid">@soundsonacid</a>
        on 2025-07-17 23:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/soundsonacid">@soundsonacid</a></div>
            <div class="timeline-body"><p>patches #19403</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @soundsonacid on 2025-07-17 23:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/soundsonacid">@soundsonacid</a> on 2025-07-17 23:27</div>
            <div class="timeline-body"><p>resolving test failures... stand by!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @soundsonacid on 2025-07-17 23:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-18 15:46</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @soundsonacid on 2025-07-18 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[pyi108]: skip if all Union members are None" to "[`flake8-pyi`] Skip fix if all `Union` members are `None` (`PYI016`) " by @ntBre on 2025-07-22 13:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs</code>:114 on 2025-07-22 13:05</div>
            <div class="timeline-body"><p>nit: this comment seems a bit long to me, for what it's explaining. I'd be happy with just the first line, or maybe the first ~3 lines at most.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs</code>:117 on 2025-07-22 13:06</div>
            <div class="timeline-body"><p>I was going to leave a nit about the <code>n</code> variable name, but I think we could replace the whole closure with <code>is_none_literal_expr</code>:</p>
<pre><code class="language-suggestion">        .all(Expr::is_none_literal_expr)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs</code>:123 on 2025-07-22 13:09</div>
            <div class="timeline-body"><p>I think we can just return here without defusing. It's okay to emit the diagnostic because there <em>is</em> a duplicate union member, we just don't want to add an autofix that will cause an error. The diagnostic is still helpful to draw the user's attention to the code. If we go with this, we should also update the test comment since it won't be OK  anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-22 13:11</div>
            <div class="timeline-body"><p>Thank you!  I just had a few small suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-07-22 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-07-22 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2025-07-22 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/soundsonacid">@soundsonacid</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs</code>:117 on 2025-07-22 14:05</div>
            <div class="timeline-body"><p>unfortunately this iterator yields &amp;&amp;Expr so we can't do the nice little inlining function call stuff like that</p>
<p>going to change to <code>|expr| Expr::is_none_literal_expr(expr)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/soundsonacid">@soundsonacid</a> reviewed on 2025-07-22 14:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/soundsonacid">@soundsonacid</a> reviewed on 2025-07-22 14:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/soundsonacid">@soundsonacid</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs</code>:123 on 2025-07-22 14:06</div>
            <div class="timeline-body"><p>ok sounds good i think this makes sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-22 14:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/duplicate_union_member.rs</code>:117 on 2025-07-22 14:17</div>
            <div class="timeline-body"><p>Ah that makes sense. If you'll allow me one more even tinier nit, we could use <code>expr.is_none_literal_expr()</code> instead of the qualified form.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-07-22 14:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-07-22 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-07-22 17:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:14:22 UTC
    </footer>
</body>
</html>
