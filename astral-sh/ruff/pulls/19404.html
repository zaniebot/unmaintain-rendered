<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-use-pathlib`] Add autofix for `PTH101`, `PTH104`, `PTH105`, `PTH121` - astral-sh/ruff #19404</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-use-pathlib</code>] Add autofix for <code>PTH101</code>, <code>PTH104</code>, <code>PTH105</code>, <code>PTH121</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19404">#19404</a>
        opened by <a href="https://github.com/chirizxc">@chirizxc</a>
        on 2025-07-17 16:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a></div>
            <div class="timeline-body">Summary
<p>Part of <a href="https://github.com/astral-sh/ruff/issues/2331">astral-sh/ruff#2331</a></p>
Test Plan
<p><code>cargo nextest run flake8_use_pathlib</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-17 16:16</div>
            <div class="timeline-body"><p>sorry for #19298 üòï</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 16:26</div>
            <div class="timeline-body"><p>Do you know what happened on the other PR? I just saw something similar on <a href="https://github.com/astral-sh/ruff/pull/19338">astral-sh/ruff#19338</a>.</p>
<p>I&#x27;ll try to take a look soon, but it might not be until next week. Thanks for working on these!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-17 16:27</div>
            <div class="timeline-body"><blockquote>
<p>Do you know what happened on the other PR? I just saw something similar on #19338.</p>
<p>I&#x27;ll try to take a look soon, but it might not be until next week. Thanks for working on these!</p>
</blockquote>
<p>it was my mistake</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-17 16:37</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+0 -0 violations, +48 -0 fixes in 3 projects; 52 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+0 -0 violations, +30 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/src/airflow/configuration.py#L2131">airflow-core/src/airflow/configuration.py:2131:9:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/src/airflow/configuration.py#L2131">airflow-core/src/airflow/configuration.py:2131:9:</a> PTH101 `os.chmod()` should be replaced by `Path.chmod()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/src/airflow/dag_processing/bundles/base.py#L391">airflow-core/src/airflow/dag_processing/bundles/base.py:391:13:</a> PTH105 [*] `os.replace()` should be replaced by `Path.replace()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/src/airflow/dag_processing/bundles/base.py#L391">airflow-core/src/airflow/dag_processing/bundles/base.py:391:13:</a> PTH105 `os.replace()` should be replaced by `Path.replace()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/src/airflow/utils/log/file_task_handler.py#L841">airflow-core/src/airflow/utils/log/file_task_handler.py:841:17:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/src/airflow/utils/log/file_task_handler.py#L841">airflow-core/src/airflow/utils/log/file_task_handler.py:841:17:</a> PTH101 `os.chmod()` should be replaced by `Path.chmod()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/tests/unit/core/test_impersonation_tests.py#L71">airflow-core/tests/unit/core/test_impersonation_tests.py:71:17:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/tests/unit/core/test_impersonation_tests.py#L71">airflow-core/tests/unit/core/test_impersonation_tests.py:71:17:</a> PTH101 `os.chmod()` should be replaced by `Path.chmod()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/tests/unit/core/test_impersonation_tests.py#L80">airflow-core/tests/unit/core/test_impersonation_tests.py:80:21:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/tests/unit/core/test_impersonation_tests.py#L80">airflow-core/tests/unit/core/test_impersonation_tests.py:80:21:</a> PTH101 `os.chmod()` should be replaced by `Path.chmod()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/tests/unit/core/test_impersonation_tests.py#L87">airflow-core/tests/unit/core/test_impersonation_tests.py:87:13:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/airflow-core/tests/unit/core/test_impersonation_tests.py#L87">airflow-core/tests/unit/core/test_impersonation_tests.py:87:13:</a> PTH101 `os.chmod()` should be replaced by `Path.chmod()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py#L104">dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py:104:13:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
... 14 additional changes omitted for rule PTH101
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/dev/breeze/src/airflow_breeze/utils/reproducible.py#L144">dev/breeze/src/airflow_breeze/utils/reproducible.py:144:9:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/dev/breeze/src/airflow_breeze/utils/reproducible.py#L144">dev/breeze/src/airflow_breeze/utils/reproducible.py:144:9:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/scripts/in_container/run_migration_reference.py#L212">scripts/in_container/run_migration_reference.py:212:9:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/apache/airflow/blob/5db1b715f7dac87c543865d1aece135a70f1c719/scripts/in_container/run_migration_reference.py#L212">scripts/in_container/run_migration_reference.py:212:9:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
</pre>

</p>

<a href="https://github.com/latchbio/latch">latchbio/latch</a> (+0 -0 violations, +2 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/latchbio/latch/blob/70660e6a10ad548c66a32a09fe2498ebf371f3c1/src/latch_cli/utils/__init__.py#L278">src/latch_cli/utils/__init__.py:278:9:</a> PTH101 [*] `os.chmod()` should be replaced by `Path.chmod()`
- <a href="https://github.com/latchbio/latch/blob/70660e6a10ad548c66a32a09fe2498ebf371f3c1/src/latch_cli/utils/__init__.py#L278">src/latch_cli/utils/__init__.py:278:9:</a> PTH101 `os.chmod()` should be replaced by `Path.chmod()`
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+0 -0 violations, +16 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/scripts/lib/zulip_tools.py#L60">scripts/lib/zulip_tools.py:60:9:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/scripts/lib/zulip_tools.py#L60">scripts/lib/zulip_tools.py:60:9:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/scripts/lib/zulip_tools.py#L730">scripts/lib/zulip_tools.py:730:5:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/scripts/lib/zulip_tools.py#L730">scripts/lib/zulip_tools.py:730:5:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/tools/lib/provision_inner.py#L158">tools/lib/provision_inner.py:158:9:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/tools/lib/provision_inner.py#L158">tools/lib/provision_inner.py:158:9:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/management/commands/export_usermessage_batch.py#L46">zerver/management/commands/export_usermessage_batch.py:46:17:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/management/commands/export_usermessage_batch.py#L46">zerver/management/commands/export_usermessage_batch.py:46:17:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/management/commands/export_usermessage_batch.py#L60">zerver/management/commands/export_usermessage_batch.py:60:17:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/management/commands/export_usermessage_batch.py#L60">zerver/management/commands/export_usermessage_batch.py:60:17:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/management/commands/fetch_tor_exit_nodes.py#L71">zerver/management/commands/fetch_tor_exit_nodes.py:71:9:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/management/commands/fetch_tor_exit_nodes.py#L71">zerver/management/commands/fetch_tor_exit_nodes.py:71:9:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/tornado/event_queue.py#L714">zerver/tornado/event_queue.py:714:9:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/tornado/event_queue.py#L714">zerver/tornado/event_queue.py:714:9:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
+ <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/worker/base.py#L151">zerver/worker/base.py:151:13:</a> PTH104 [*] `os.rename()` should be replaced by `Path.rename()`
- <a href="https://github.com/zulip/zulip/blob/a4d70505ecd253bd79ba4077b3c42e085db006b1/zerver/worker/base.py#L151">zerver/worker/base.py:151:13:</a> PTH104 `os.rename()` should be replaced by `Path.rename()`
</pre>

</p>

Changes by rule (3 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PTH101 | 26 | 0 | 0 | 26 | 0 |
| PTH104 | 20 | 0 | 0 | 20 | 0 |
| PTH105 | 2 | 0 | 0 | 2 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/StDymphna">@StDymphna</a> on 2025-07-18 14:20</div>
            <div class="timeline-body"><p>@chirizxc
Since you&#x27;ve been implementing autofixes for PTH* rules, are you planning on implementing autofixes for FURB101 and FURB103 (which are PTH related)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-18 14:41</div>
            <div class="timeline-body"><blockquote>
<p>@chirizxc
Since you&#x27;ve been implementing autofixes for PTH* rules, are you planning on implementing autofixes for FURB101 and FURB103 (which are PTH related)?</p>
</blockquote>
<p>I think so, but I won&#x27;t promiseüò¥</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-23 06:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/snapshots/ruff_linter__rules__flake8_use_pathlib__tests__full_name.py.snap</code>:1 on 2025-07-23 14:20</div>
            <div class="timeline-body"><p>This is one of the files where it looks like we lost diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> requested changes on 2025-07-23 14:21</div>
            <div class="timeline-body"><p>The implementation looked good to me, but do you know what happened with the missing snapshots? It looks like we lost a bunch of violations even though their Python files aren&#x27;t modified. It might be a minor issue with the <code>is_rule_enabled</code> checks, hopefully.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 14:41</div>
            <div class="timeline-body"><blockquote>
<p>The implementation looked good to me, but do you know what happened with the missing snapshots? It looks like we lost a bunch of violations even though their Python files aren&#x27;t modified. It might be a minor issue with the <code>is_rule_enabled</code> checks, hopefully.</p>
</blockquote>
<p>Initial tests in the files are not correct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 14:43</div>
            <div class="timeline-body"><p>These tests were taken from the original flake8-use-pathlib repository, now if you try to run these tests you will get Missing argument, since they require two arguments in general</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-23 14:44</div>
            <div class="timeline-body"><p>Ohhh, they have the wrong number of arguments? Okay, this is probably good to go then. I&#x27;ll take one more look at the snapshots. Thank you for clarifying and for fixing that pre-existing bug!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-23 14:46</div>
            <div class="timeline-body"><p>Hmm, on second thought, maybe we still want diagnostics in theses cases and just to suppress the fixes. What do you think about that? I think the diagnostics are still useful, but fixing could be dangerous since there&#x27;s another error there already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 14:49</div>
            <div class="timeline-body"><p>I think it&#x27;s a bit weird to suggest diagnostic when the code can&#x27;t run due to an error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 14:59</div>
            <div class="timeline-body"><blockquote>
<p>Hmm, on second thought, maybe we still want diagnostics in theses cases and just to suppress the fixes. What do you think about that? I think the diagnostics are still useful, but fixing could be dangerous since there&#x27;s another error there already.</p>
</blockquote>
<p>in some rules it already works like that, we can just take the behavior from them, if not, then we need to thinkü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-23 15:02</div>
            <div class="timeline-body"><blockquote>
<p>I think it&#x27;s a bit weird to suggest diagnostic when the code can&#x27;t run due to an error</p>
</blockquote>
<p>I can see what you mean, but in general I think we try to show as many diagnostics as possible. The case I usually picture is someone getting a different diagnostic about the wrong number of arguments (maybe from a type checker or LSP), fixing that, and then a new Ruff diagnostic appears. Instead we&#x27;d prefer for the Ruff diagnostic to be there from the start. They <em>are</em> using (or trying to use) an <code>os</code> method replaceable by <code>pathlib</code> too, so I think the diagnostic is still accurate. I momentarily forgot this rule of thumb in my initial comment :sweat_smile:</p>
<p>In this case it also preserves the existing behavior, which is nice since adding an autofix usually shouldn&#x27;t modify the other behavior of the rule.</p>
<blockquote>
<p>in some rules it already works like that, we can just take the behavior from them, if not, then we need to thinkü§î</p>
</blockquote>
<p>Which rules do you mean here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 15:28</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>I think it&#x27;s a bit weird to suggest diagnostic when the code can&#x27;t run due to an error</p>
</blockquote>
<p>I can see what you mean, but in general I think we try to show as many diagnostics as possible. The case I usually picture is someone getting a different diagnostic about the wrong number of arguments (maybe from a type checker or LSP), fixing that, and then a new Ruff diagnostic appears. Instead we&#x27;d prefer for the Ruff diagnostic to be there from the start. They <em>are</em> using (or trying to use) an <code>os</code> method replaceable by <code>pathlib</code> too, so I think the diagnostic is still accurate. I momentarily forgot this rule of thumb in my initial comment üòÖ</p>
<p>In this case it also preserves the existing behavior, which is nice since adding an autofix usually shouldn&#x27;t modify the other behavior of the rule.</p>
<blockquote>
<p>in some rules it already works like that, we can just take the behavior from them, if not, then we need to thinkü§î</p>
</blockquote>
<p>Which rules do you mean here?</p>
</blockquote>
<p>Misspelled, meant IF this behavior is already used in other rules, we should do the same thing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 15:43</div>
            <div class="timeline-body"><p>done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-07-23 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-07-23 16:12</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-23 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-23 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-23 16:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:43 UTC
    </footer>
</body>
</html>
