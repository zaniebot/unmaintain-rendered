<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move lint rules out of `checkers/ast/mod.rs` - astral-sh/ruff #5957</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Move lint rules out of <code>checkers/ast/mod.rs</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5957">#5957</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-07-21 21:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>This PR attempts to draw some basic separation between the <code>Checker</code>&#x27;s traversal responsibilities (traversing the AST, building the semantic model) and its calling-out-to-lint-rule responsibilities. It doesn&#x27;t try to introduce any sophisticated API. Instead, it just moves all of the lint rule calls out of <code>checkers/ast/mod.rs</code> and into methods in a new <code>analyze</code> module. (There are four remaining lint rules in <code>Checker</code>, but I&#x27;ll remove those in future PRs.)</p>
<p>I&#x27;m not trying to &quot;solve&quot; our lint rule API here. Instead, I&#x27;m trying to make two improvements:</p>
<ol>
<li><code>checkers/ast/mod.rs</code> has just gotten way too large, and people work in it all the time. Prior to this PR, it was 5.5k lines, which led to significant lags in my editor and made it really hard to reason about the parts that are <em>actually</em> important. (I like big files, but this one crossed the line for me.) Now, it&#x27;s &lt; 2,000 lines, and the code is much more focused.</li>
<li>I want to avoid accidentally adding lint rules in the &quot;wrong&quot; parts of the traversal. By confining lint rule invocations to these &quot;analyze&quot; calls, we&#x27;ll avoid (e.g.) putting them in the binding phase.</li>
</ol>
<p>If accepted, I&#x27;ll update the docs prior to merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-21 21:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/analyze/arg.rs</code>:27 on 2023-07-21 21:41</div>
            <div class="timeline-body"><p>These are just taking the <code>// Step 1: Analysis</code> blocks from the existing <code>checkers/ast/mod.rs</code> and moving them into a method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-21 21:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/analyze/bindings.rs</code>:7 on 2023-07-21 21:42</div>
            <div class="timeline-body"><p>This is <code>Checker::check_bindings</code>, but moved out of the file (and out of the struct). Arguably it should be an associative function, but it felt weird to put multiple <code>impl</code> blocks for <code>Checker</code> in so many different files. Anyway, IMO this is fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-21 21:43</div>
            <div class="timeline-body"><p>To be clear: no behavioral changes. This PR is mostly grabbing chunks of code from <code>checkers/ast/mod.rs</code>, moving them into methods in the <code>ast::analyze</code> module, and calling those methods instead of inlining the lint rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-21 21:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-21 21:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-21 21:54</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>✅ ecosystem check detected no changes.</p>
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.8±0.49ms     3.5 MB/sec    1.03     12.2±0.36ms     3.3 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.4±0.11ms     6.9 MB/sec    1.00      2.4±0.12ms     6.9 MB/sec
formatter/numpy/globals.py                 1.00   266.9±11.39µs    11.1 MB/sec    1.04   277.1±15.00µs    10.7 MB/sec
formatter/pydantic/types.py                1.00      5.1±0.23ms     5.0 MB/sec    1.06      5.4±0.30ms     4.7 MB/sec
linter/all-rules/large/dataset.py          1.02     18.0±0.57ms     2.3 MB/sec    1.00     17.6±0.58ms     2.3 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      4.5±0.24ms     3.7 MB/sec    1.00      4.4±0.16ms     3.8 MB/sec
linter/all-rules/numpy/globals.py          1.00   581.2±46.45µs     5.1 MB/sec    1.04   606.3±80.78µs     4.9 MB/sec
linter/all-rules/pydantic/types.py         1.01      8.2±0.30ms     3.1 MB/sec    1.00      8.1±0.25ms     3.1 MB/sec
linter/default-rules/large/dataset.py      1.00      9.1±0.29ms     4.5 MB/sec    1.04      9.5±0.36ms     4.3 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1903.4±49.31µs     8.7 MB/sec    1.03  1951.2±55.83µs     8.5 MB/sec
linter/default-rules/numpy/globals.py      1.00    224.1±8.31µs    13.2 MB/sec    1.02    229.2±8.71µs    12.9 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.1±0.14ms     6.2 MB/sec    1.06      4.4±0.40ms     5.9 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     15.2±1.04ms     2.7 MB/sec    1.10     16.7±0.68ms     2.4 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.9±0.18ms     5.7 MB/sec    1.05      3.1±0.15ms     5.4 MB/sec
formatter/numpy/globals.py                 1.00   347.4±23.94µs     8.5 MB/sec    1.02   353.3±26.04µs     8.4 MB/sec
formatter/pydantic/types.py                1.00      6.7±0.36ms     3.8 MB/sec    1.03      7.0±0.32ms     3.7 MB/sec
linter/all-rules/large/dataset.py          1.01     23.3±0.87ms  1788.2 KB/sec    1.00     23.1±0.83ms  1799.7 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.7±0.43ms     2.9 MB/sec    1.06      6.1±0.25ms     2.7 MB/sec
linter/all-rules/numpy/globals.py          1.00   687.4±42.57µs     4.3 MB/sec    1.02   700.4±46.26µs     4.2 MB/sec
linter/all-rules/pydantic/types.py         1.00      9.8±0.53ms     2.6 MB/sec    1.09     10.8±0.41ms     2.4 MB/sec
linter/default-rules/large/dataset.py      1.00     12.6±0.59ms     3.2 MB/sec    1.01     12.8±0.50ms     3.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.4±0.10ms     6.9 MB/sec    1.03      2.5±0.11ms     6.7 MB/sec
linter/default-rules/numpy/globals.py      1.01   297.6±19.87µs     9.9 MB/sec    1.00   294.1±14.01µs    10.0 MB/sec
linter/default-rules/pydantic/types.py     1.00      5.7±0.66ms     4.5 MB/sec    1.03      5.9±0.43ms     4.3 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-22 14:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/analyze/arg.rs</code>:8 on 2023-07-22 14:19</div>
            <div class="timeline-body"><p>What I mostly need feedback on is whether this API and module structure is fine or if we prefer something else. Like we could do something trait-based (but it won&#x27;t work for some of the other methods in this module, like <code>scopes</code>, which checks <em>all</em> the scopes.) Or we could make these methods on <code>Checker</code> but just implement them in separate files for convenience (but then we risk method name clashes across <code>impl</code> blocks).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:1231 on 2023-07-22 18:59</div>
            <div class="timeline-body"><p>Nit: is it possible to move the push of diagnostics inside the rule everywhere? Shortens this file a bit, and might be helpful if later to have the consistency if macros will be used</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:1224 on 2023-07-22 19:00</div>
            <div class="timeline-body"><p>Same as below</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:1242 on 2023-07-22 19:00</div>
            <div class="timeline-body"><p>Ifs can be combined</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:1374 on 2023-07-22 19:02</div>
            <div class="timeline-body"><p>Nit: rules could be grouped/sorted by their arguments (here <code>expr</code>, <code>bool_op</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/scopes.rs</code>:36 on 2023-07-22 19:07</div>
            <div class="timeline-body"><p>Simplify as <code>!checker.is_stub &amp;&amp; ...</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/scopes.rs</code>:47 on 2023-07-22 19:10</div>
            <div class="timeline-body"><p>Combine ifs with <code>||</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/scopes.rs</code>:236 on 2023-07-22 19:12</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/scopes.rs</code>:258 on 2023-07-22 19:16</div>
            <div class="timeline-body"><p>Can this be moved inside the second check below ? Doesn&#x27;t seem to be used in the other rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:38 on 2023-07-22 19:17</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:54 on 2023-07-22 19:18</div>
            <div class="timeline-body"><p>See earlier, move in rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:64 on 2023-07-22 19:18</div>
            <div class="timeline-body"><p>Move in rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:92 on 2023-07-22 19:18</div>
            <div class="timeline-body"><p>Move in rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:100 on 2023-07-22 19:18</div>
            <div class="timeline-body"><p>Move in rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:111 on 2023-07-22 19:19</div>
            <div class="timeline-body"><p>See above</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:124 on 2023-07-22 19:19</div>
            <div class="timeline-body"><p>See above</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:172 on 2023-07-22 19:20</div>
            <div class="timeline-body"><p>Group by arguments required. Suggested:</p>
<pre><code>// Checks that require `args`, `keywords`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:177 on 2023-07-22 19:21</div>
            <div class="timeline-body"><p>Move in check</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:190 on 2023-07-22 19:21</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:195 on 2023-07-22 19:21</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:223 on 2023-07-22 19:21</div>
            <div class="timeline-body"><p>Move in rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:242 on 2023-07-22 19:22</div>
            <div class="timeline-body"><p>Move in rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:251 on 2023-07-22 19:22</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:260 on 2023-07-22 19:22</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:377 on 2023-07-22 19:24</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:384 on 2023-07-22 19:24</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:394 on 2023-07-22 19:25</div>
            <div class="timeline-body"><p>Move in same check below</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:408 on 2023-07-22 19:25</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:422 on 2023-07-22 19:25</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:431 on 2023-07-22 19:25</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:441 on 2023-07-22 19:26</div>
            <div class="timeline-body"><p>Use else</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:530 on 2023-07-22 19:28</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:557 on 2023-07-22 19:29</div>
            <div class="timeline-body"><p>Combine first condition of this loop</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:560 on 2023-07-22 19:29</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:622 on 2023-07-22 19:29</div>
            <div class="timeline-body"><p>Combine with first condition of loop</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:636 on 2023-07-22 19:30</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:718 on 2023-07-22 19:30</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:672 on 2023-07-22 19:31</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:711 on 2023-07-22 19:32</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:728 on 2023-07-22 19:32</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:737 on 2023-07-22 19:33</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:786 on 2023-07-22 19:33</div>
            <div class="timeline-body"><p>Beginning of loop</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:801 on 2023-07-22 19:34</div>
            <div class="timeline-body"><p>Beginning of loop</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:863 on 2023-07-22 19:34</div>
            <div class="timeline-body"><p>Stub already checked above, group conditions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:894 on 2023-07-22 19:40</div>
            <div class="timeline-body"><p>Combine with previous condition</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:903 on 2023-07-22 19:40</div>
            <div class="timeline-body"><p>Combine above</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:908 on 2023-07-22 19:40</div>
            <div class="timeline-body"><p>Combine above</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:923 on 2023-07-22 19:41</div>
            <div class="timeline-body"><p>Combine all some expr</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:942 on 2023-07-22 19:42</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:983 on 2023-07-22 19:43</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1005 on 2023-07-22 19:45</div>
            <div class="timeline-body"><p>Can we combine this if let? It&#x27;s used multiple times</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1039 on 2023-07-22 19:45</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1175 on 2023-07-22 19:46</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1180 on 2023-07-22 19:46</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1266 on 2023-07-22 19:47</div>
            <div class="timeline-body"><p>^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1270 on 2023-07-22 19:48</div>
            <div class="timeline-body"><p>Checker.enabled?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1281 on 2023-07-22 19:48</div>
            <div class="timeline-body"><p>Checker.enabled()</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1294 on 2023-07-22 19:48</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1303 on 2023-07-22 19:49</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:1357 on 2023-07-22 19:49</div>
            <div class="timeline-body"><p>Combine with above</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/arg.rs</code>:10 on 2023-07-22 19:51</div>
            <div class="timeline-body"><p>Move diagnostic push inside rule consistently</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/bindings.rs</code>:20 on 2023-07-22 19:51</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/bindings.rs</code>:21 on 2023-07-22 19:52</div>
            <div class="timeline-body"><p>Move inside rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/bindings.rs</code>:59 on 2023-07-22 19:52</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/definitions.rs</code>:140 on 2023-07-22 19:53</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:155 on 2023-07-22 19:55</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:182 on 2023-07-22 19:56</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:202 on 2023-07-22 19:56</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:447 on 2023-07-22 19:58</div>
            <div class="timeline-body"><p>Combine ifs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-07-22 19:59</div>
            <div class="timeline-body"><p>Going over the complete code reveals some small suggestions for improvements to pave the way for metaprogramming (mostly mechanical refactoring):</p>
<ul>
<li>Sometimes a condition is checked multiple times within the same block (e.g. is_stub)</li>
<li>Sometimes if conditions can be combined. This is equivalent, but is more readable as it removed one level of indentation. Logical operators are short-circuited in Rust, so it doesn&#x27;t come at computational cost.</li>
<li>Grouping/sorting checks by the arguments needed may allow use in the future to automate away the boilerplate (e.g. turning off paths without any active checks), and helps spotting potential errors.</li>
<li>Rules are not consistently returning/adding diagnostics to the checker. Consistency is preferable. Checker is then always the first argument.</li>
</ul>
<p>(I&#x27;ve not got deep enough knowledge of rust design patterns to address the high-level API choices unfortunately)</p>
<p>Open to hear your thoughts, I might be completely off on some points. Happy to contribute.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-23 00:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:1231 on 2023-07-23 00:37</div>
            <div class="timeline-body"><p>(Yes, that&#x27;s my preferred pattern and we should change rule to do so where we can.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-23 10:03</div>
            <div class="timeline-body"><p>i like breaking up the checker!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/analyze/for_loops.rs</code>:8 on 2023-07-24 07:07</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code>pub(crate) fn deferred_for_loops(checker: &amp;mut Checker) {
</code></pre>
<p>I was confused why the function has no node argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/analyze/body.rs</code>:8 on 2023-07-24 07:07</div>
            <div class="timeline-body"><pre><code>pub(crate) fn suite(suite: &amp;[Stmt], checker: &amp;mut Checker) {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/analyze/expr.rs</code>:23 on 2023-07-24 07:08</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code>pub(crate) fn expression(expr: &amp;Expr, checker: &amp;mut Checker) {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/analyze/stmt.rs</code>:22 on 2023-07-24 07:08</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code>pub(crate) fn statement(stmt: &amp;Stmt, checker: &amp;mut Checker) {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-24 07:08</div>
            <div class="timeline-body"><p>I haven&#x27;t reviewed in detail because I assume most of the changes are just moves.</p>
<p>I would probably have preferred to have all rules in a single file because we now have may files that barely contain anything.</p>
<p>Future: Ideally the rules wouldn&#x27;t accept <code>Checker</code> because it means that we have cyclic dependencies:</p>
<ul>
<li>Checker depends on <code>analyze</code> which depends on all rules</li>
<li><code>analyze</code> and all rules depend on <code>Checker</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-24 19:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/analyze/bindings.rs</code>:20 on 2023-07-24 19:07</div>
            <div class="timeline-body"><p>I intentionally like to keep the <code>checker.enabled</code> checks separate from any preconditions for the rule. I find it easier to read, and I have a perhaps-mistaken belief that it might help with future refactors when we make the rule API more declarative.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 19:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 19:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-24 19:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:55:35 UTC
    </footer>
</body>
</html>
