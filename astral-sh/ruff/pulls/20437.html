<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shard instrumented benchmark - astral-sh/ruff #20437</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Shard instrumented benchmark</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20437">#20437</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-09-16 16:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-16 16:28</div>
            <div class="timeline-body"><p>Shard the instrumented benchmarks and only run the ruff/ty benchmarks when there were corresponding code changes.</p>
<p>I tested that the corresponding benchmarks run when making changes to ruff or ty</p>
<ul>
<li>https://github.com/astral-sh/ruff/pull/20450</li>
<li>https://github.com/astral-sh/ruff/pull/20451</li>
</ul>
<p>This PR increases the overall CI time when making changes that apply to both ruff and ty, as it now requires building the shared crates twice. However, it should reduce CI time when only changing code for one project because the benchmark jobs now only build the relevant benchmarks (e.g. ty doesn't need to build <code>ruff_linter</code> and <code>ruff</code>).</p>
<p>Sharding the walltime benchmarks is a bit more involved because codspeed doesn't support filtering the benchmarks by name but this is something they plan to add soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @MichaReiser on 2025-09-16 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-16 16:46</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-09-17 10:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @MichaReiser on 2025-09-17 10:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-09-17 11:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-17 11:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:909 on 2025-09-17 11:24</div>
            <div class="timeline-body"><p>I tried to use a matrix to reduce code duplication but matrix doesn't provide an easy way to conditionally skip an entire job.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-19 08:25</div>
            <div class="timeline-body"><p>Let's give this a try. It's easy enough to revert</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-09-19 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-09-19 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-19 08:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:40:54 UTC
    </footer>
</body>
</html>
