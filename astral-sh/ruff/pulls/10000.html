<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preserve multiline strings in code generator - astral-sh/ruff #10000</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Preserve multiline strings in code generator</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10000">#10000</a>
        opened by <a href="https://github.com/sanxiyn">@sanxiyn</a>
        on 2024-02-15 14:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sanxiyn">@sanxiyn</a></div>
            <div class="timeline-body"><p>This is a draft PR for #7799 posted for discussion. Minimally tested with <code>cargo dev round-trip</code>.</p>
<p>Extending <code>ruff_python_literal</code> to know more about Python string literals (raw, triple, etc.) should be uncontroversial. Changes here are incomplete (no raw, universal newline, bytes...) but completing shouldn't be difficult.</p>
<p>I am less sure about <code>ruff_python_codegen</code> changes. AST doesn't have enough information. Instead of adding needed information (after all, it's AST not CST), in this PR <code>Generator</code> has an optional <code>Locator</code>. When <code>Locator</code> is available, string kind information is taken from original source and passed to <code>ruff_python_literal</code>. Behavior is unchanged if <code>Locator</code> is unavailable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-15 14:52</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-11 18:05</div>
            <div class="timeline-body"><p>@sanxiyn -- in https://github.com/astral-sh/ruff/pull/10298, I modified ruff's AST so that we now track many stylistic details in the AST that were previously not tracked:</p>
<ul>
<li>Whether a string is raw or not</li>
<li>The quoting style (double or single quotes)</li>
<li>Whether a string is triple-quoted or not</li>
</ul>
<p>Would you be interested in updating your PR to use the information newly available in our AST? If not, I can pick this up and list you as a co-author</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-18 10:10</div>
            <div class="timeline-body"><p>Using the <code>Locator</code> in the <code>Generator</code> is clever to avoid tracking additional data in the AST. However, it won't work for AST nodes with no corresponding element in the source (AST nodes that have been built or modified manually). We could dedect such nodes by testing if the range is <code>0..0</code>, but I'm somewhat hesitant about making the Generator depend on the <code>Locator</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 16:45</div>
            <div class="timeline-body"><p>I'm going to close this PR for now as @AlexWaygood is planning to take a different approach by leveraging the augmented AST.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-06 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 16:45</div>
            <div class="timeline-body"><p>Thanks @sanxiyn!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:02:48 UTC
    </footer>
</body>
</html>
