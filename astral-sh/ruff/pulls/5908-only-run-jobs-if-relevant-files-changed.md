```yaml
number: 5908
title: Only run jobs if relevant files changed
type: pull_request
state: merged
author: MichaReiser
labels: []
assignees: []
merged: true
base: main
head: run-jobs-based-on-changed-files
created_at: 2023-07-20T07:53:31Z
updated_at: 2023-07-20T14:45:07Z
url: https://github.com/astral-sh/ruff/pull/5908
synced_at: 2026-01-12T03:30:22Z
```

# Only run jobs if relevant files changed

---

_Pull request opened by @MichaReiser on 2023-07-20 07:53_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

Only run the benchmark, ecosystem, and formatter stability checks when relevant files changed:

* ecosystem: Any rust code, excluding the formatter and dev tools
* formatter stability: Any change to `ruff_python_formatter`, `ruff_formatter`, `ruff_python_ast` or `ruff_python_trivia` or the dependencies
* benchmark: Any rust code change, excluding dev tools

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

* [No code changes](https://github.com/astral-sh/ruff/actions/runs/5609118168?pr=5908)
	* skips formatter stability check
	* Benchmark didn't trigger (I can't link a non existing job :sweat_smile: ) 
	* skips ecosystem check
* [Linter changes](https://github.com/astral-sh/ruff/actions/runs/5609443499?pr=5908)
	* skips formatter stability check
	* runs [Benchmark](https://github.com/astral-sh/ruff/actions/runs/5609443502/jobs/10263167796?pr=5908)
	* runs ecosystem check
* [Formatter change](https://github.com/astral-sh/ruff/actions/runs/5609289445?pr=5908)
	* runs formatter stability check
	* runs [Benchmark](https://github.com/astral-sh/ruff/actions/runs/5609289411?pr=5908)
	* skips ecosystem check


---

_Comment by @MichaReiser on 2023-07-20 07:53_

Current dependencies on/for this PR:
* main
  * **PR #5908** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5908" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5908?utm_source=stack-comment).

---

_Converted to draft by @MichaReiser on 2023-07-20 07:53_

---

_Review comment by @MichaReiser on `.github/workflows/benchmark.yaml`:11 on 2023-07-20 07:54_

This is where it would be useful to have all internal tools in a single (xtask, dev) directory

---

_@MichaReiser reviewed on 2023-07-20 07:54_

---

_@MichaReiser reviewed on 2023-07-20 08:05_

---

_Review comment by @MichaReiser on `.github/workflows/ci.yaml`:164 on 2023-07-20 08:05_

This is silly but GitHub doesn't support early returns. The *proposed* alternative is to have another job but that feels bad in its own way because it pollutes the checks panel with even more output

---

_Comment by @github-actions[bot] on 2023-07-20 08:10_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review comment by @konstin on `.github/workflows/ci.yaml`:158 on 2023-07-20 08:54_

Would a single job that determines if {linter, formatted} changed and triggers downstream accordingly be possible? It would mean an extra job, but we would need only one guard per job and the checks list would show what actually ran

---

_@konstin approved on 2023-07-20 08:54_

---

_@MichaReiser reviewed on 2023-07-20 09:00_

---

_Review comment by @MichaReiser on `.github/workflows/ci.yaml`:158 on 2023-07-20 09:00_

I guess that would be nice... argh, I have to re-do all tests

---

_@konstin reviewed on 2023-07-20 09:04_

---

_Review comment by @konstin on `.github/workflows/ci.yaml`:158 on 2023-07-20 09:04_

Could we do graphite PRs for the different parts on top? I volunteer #5898 as a dev tools PR ;)

---

_Review comment by @MichaReiser on `.github/workflows/ci.yaml`:158 on 2023-07-20 09:13_

How do you mean? I now changed it to a job. But I have to re-do all my testing... which gets funny because I now can't link to jobs that didn't run

---

_@MichaReiser reviewed on 2023-07-20 09:13_

---

_Marked ready for review by @MichaReiser on 2023-07-20 09:53_

---

_@konstin reviewed on 2023-07-20 09:57_

---

_Review comment by @konstin on `.github/workflows/ci.yaml`:158 on 2023-07-20 09:57_

Add PRs on top of this PR that change formatter/linter/dev tools. Graphite can rebase them and you can look at their CI runs

---

_@MichaReiser reviewed on 2023-07-20 09:59_

---

_Review comment by @MichaReiser on `.github/workflows/ci.yaml`:158 on 2023-07-20 09:59_

Oh, that would have been clever. Next time 

---

_Merged by @MichaReiser on 2023-07-20 10:01_

---

_Closed by @MichaReiser on 2023-07-20 10:01_

---

_Branch deleted on 2023-07-20 10:01_

---

_Review comment by @jackton1 on `.github/workflows/ci.yaml`:33 on 2023-07-20 13:22_

Hi @MichaReiser, ðŸ™Œ author of [tj-actions/changed-files](https://github.com/tj-actions/changed-files) here. I just came across your workflow and couldn't help but notice a neat little tweak you could make. We've recently introduced a new `files_yaml` input which supports multiple filters in a single step, while still achieving the same results.

I think you might find it pretty handy! For more details, feel free to have a look at our [documentation](https://github.com/tj-actions/changed-files#using-local-git-history). 

Should you have any questions or need further assistance, please don't hesitate to ask. Have a fantastic rest of your day!

---

_@jackton1 reviewed on 2023-07-20 13:22_

---

_Review comment by @MichaReiser on `.github/workflows/ci.yaml`:33 on 2023-07-20 14:45_

Oh wow, this is first-class user support <3

This is cool. Let me create a quick PR for it

---

_@MichaReiser reviewed on 2023-07-20 14:45_

---
