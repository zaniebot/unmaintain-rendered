<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add fixes to `output-format=sarif` - astral-sh/ruff #20300</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add fixes to <code>output-format=sarif</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20300">#20300</a>
        opened by <a href="https://github.com/njhearp">@njhearp</a>
        on 2025-09-08 03:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/njhearp">@njhearp</a> on 2025-09-08 03:29</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Addresses #19962</p>
<p>This PR extends <code>SarifEmitter</code> to include <code>fixes</code> in the SARIF ouput, if an auto fix is available. Before SARIF output did not include the <code>fixes</code> field. This makes Ruff's SARIF output more compliant with the spec.</p>
<p>Key changes:</p>
<ul>
<li><code>SarifFix</code>, <code>SarifArtifactChange</code>, and related structs to represent fixes in SARIF.</li>
<li><code>fixes</code> is outputted only if an auto fix is available.</li>
</ul>
<h2>Test Plan</h2>
<p>Check for SARIF spec compliance and regressions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-08 03:55</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2025-09-16 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:222 on 2025-09-16 08:00</div>
            <div class="timeline-body"><p>You can use <code>serde(rename_all=&quot;camelCase&quot;)</code> to avoid having to rename every field. See https://serde.rs/container-attrs.html#rename_all</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:175 on 2025-09-16 08:01</div>
            <div class="timeline-body"><p>I'd prefer if the fields use the same names as in the Sarif specification. It makes it easier to match the fields to their output.</p>
<pre><code class="language-suggestion">    #[serde(rename = &quot;artifactLocation&quot;)]
    artifactLocation: SarifArtifactLocation,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:177 on 2025-09-16 08:05</div>
            <div class="timeline-body"><p>Unrelated to your PR: It would be great to include the link to <code>https://docs.oasis-open.org/sarif/sarif/v2.1.0/csprd01/sarif-v2.1.0-csprd01.html#_Toc10541319</code> somewhere in the documentation (on <code>SarifResult</code> or on <code>SarifEmitter</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:167 on 2025-09-16 08:05</div>
            <div class="timeline-body"><pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:195 on 2025-09-16 08:10</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    text: String,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:189 on 2025-09-16 08:13</div>
            <div class="timeline-body"><p>This should be an <code>Option</code> and be omitted when it is <code>None</code> (e.g. for a removal)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:219 on 2025-09-16 08:16</div>
            <div class="timeline-body"><p>Should this be an <code>Url</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:248 on 2025-09-16 08:18</div>
            <div class="timeline-body"><p>A fix is guaranteed (statically) to always have at least one edit</p>
<pre><code class="language-suggestion">                
                artifact_changes.push(SarifArtifactChange {
                    uri: SarifArtifactLocation { uri: uri.clone() },
                    replacements,
                });
                
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:295 on 2025-09-16 08:19</div>
            <div class="timeline-body"><p>Let's extract this into a function to avoid repeating the same code twice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:344 on 2025-09-16 08:20</div>
            <div class="timeline-body"><p>Hmm, interesting. Can't we derive <code>Serialize</code> on <code>SarifResult</code> instead and skip serializing <code>fixes</code> if the container is empty (https://serde.rs/field-attrs.html#skip_serializing_if)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-16 08:21</div>
            <div class="timeline-body"><p>Thank you, this is great. I've a few suggestions on how to improve this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njhearp">@njhearp</a> reviewed on 2025-09-16 18:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/njhearp">@njhearp</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:219 on 2025-09-16 18:22</div>
            <div class="timeline-body"><p>I think the spec says <code>uri</code>. https://docs.oasis-open.org/sarif/sarif/v2.1.0/csprd01/sarif-v2.1.0-csprd01.html#_Toc10540865</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njhearp">@njhearp</a> reviewed on 2025-09-16 18:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/njhearp">@njhearp</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:175 on 2025-09-16 18:23</div>
            <div class="timeline-body"><p>Makes sense. I've changed it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njhearp">@njhearp</a> reviewed on 2025-09-16 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/njhearp">@njhearp</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:222 on 2025-09-16 18:24</div>
            <div class="timeline-body"><p>That's a great suggestion to make it more concise. I've changed this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njhearp">@njhearp</a> reviewed on 2025-09-16 18:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/njhearp">@njhearp</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:189 on 2025-09-16 18:28</div>
            <div class="timeline-body"><p>Thanks. I've updated it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/njhearp">@njhearp</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:344 on 2025-09-17 03:17</div>
            <div class="timeline-body"><p>I had to do some additional changes and I've encountered a merge conflict from main. I'll work on fixing the merge conflict.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njhearp">@njhearp</a> reviewed on 2025-09-17 03:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-17 07:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:259 on 2025-09-17 07:41</div>
            <div class="timeline-body"><p>I think there are two issues with how we map edits:</p>
<ol>
<li><code>inserted_content</code> should be <code>None</code> if <code>edit.content()</code> is <code>None</code>.</li>
<li>We need to use the range from the edit for the deleted range and not the diagnostic range. You can get the range by calling <code>edit.range()</code>. The range is guaranteed to be empty if it is an insertion. It's non empty for replacements or deletions</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @njhearp on 2025-09-17 16:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @njhearp on 2025-09-17 16:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @njhearp on 2025-09-17 16:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @njhearp on 2025-09-17 16:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @njhearp on 2025-09-17 16:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-17 16:50</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @njhearp on 2025-09-17 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-17 16:54</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @MichaReiser on 2025-09-17 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @MichaReiser on 2025-09-17 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @MichaReiser on 2025-09-17 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @MichaReiser on 2025-09-17 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dhruvmanila removed by @MichaReiser on 2025-09-17 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/njhearp">@njhearp</a> on 2025-09-17 16:58</div>
            <div class="timeline-body"><p>Sorry for the noisy update, I accidentally pushed extra commits when merging. I'm going to fix this to remove the noise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njhearp">@njhearp</a> reviewed on 2025-09-18 04:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/njhearp">@njhearp</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:257 on 2025-09-18 04:12</div>
            <div class="timeline-body"><p>I thought I would add error handling if there is a problem with the source file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @njhearp on 2025-09-18 04:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-18 07:04</div>
            <div class="timeline-body"><blockquote>
<p>Sorry for the noisy update, I accidentally pushed extra commits when merging. I'm going to fix this to remove the noise.</p>
</blockquote>
<p>Don't worry. It happened to all of us :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-18 07:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/sarif.rs</code>:257 on 2025-09-18 07:18</div>
            <div class="timeline-body"><p>That makes sense. I changed the error handling to omit the fix when the source file is missing. Emitting a fix with made-up locations seems problematic, as it most likely will result in invalid code when applied.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-09-18 07:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Extended `SarifEmitter` to include `fixes` in the SARIF ouput" to "Include fixes in `output-format=sarif`" by @MichaReiser on 2025-09-18 07:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Include fixes in `output-format=sarif`" to "Add fixes in `output-format=sarif`" by @MichaReiser on 2025-09-18 07:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add fixes in `output-format=sarif`" to "Add fixes to `output-format=sarif`" by @MichaReiser on 2025-09-18 07:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-09-18 07:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-09-18 07:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:40:53 UTC
    </footer>
</body>
</html>
