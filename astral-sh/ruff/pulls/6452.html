<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format docstrings - astral-sh/ruff #6452</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format docstrings</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6452">#6452</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-08-09 17:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-08-09 17:31</div>
            <div class="timeline-body"><p><strong>Summary</strong> Implement docstring formatting</p>
<p><strong>Test Plan</strong> Matches black's <code>docstring.py</code> fixture exactly, added some new cases for what is hard to debug with black and with what black doesn't cover.</p>
<p>similarity index:</p>
<p>main:
zulip: 0.99702
django: 0.99784
warehouse: 0.99585
build: 0.75623
transformers: 0.99469
cpython: 0.75989
typeshed: 0.74853</p>
<p>this branch:</p>
<p>zulip: 0.99702
django: 0.99784
warehouse: 0.99585
build: 0.75623
transformers: 0.99464
cpython: 0.75517
typeshed: 0.74853</p>
<p>The regression in transformers is actually an improvement in a file they don't format with black (they run <code>black examples tests src utils setup.py conftest.py</code>, the difference is in hubconf.py). cpython doesn't use black.</p>
<p>Closes #6196</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-09 17:31</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #6443</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6443" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #6452</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6452" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ<ul>
<li><strong>PR #6477</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6477" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #6507</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6507" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #6561</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6561" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6452?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-09 18:16</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                    pr
-----                                      ----                                    --
formatter/large/dataset.py                 1.07      4.5Â±0.24ms     9.1 MB/sec     1.00      4.2Â±0.28ms     9.7 MB/sec
formatter/numpy/ctypeslib.py               1.00  917.4Â±111.86Âµs    18.2 MB/sec     1.02   934.8Â±50.51Âµs    17.8 MB/sec
formatter/numpy/globals.py                 1.07     94.3Â±8.19Âµs    31.3 MB/sec     1.00     87.8Â±6.88Âµs    33.6 MB/sec
formatter/pydantic/types.py                1.00  1840.5Â±101.76Âµs    13.9 MB/sec    1.01  1858.7Â±122.12Âµs    13.7 MB/sec
linter/all-rules/large/dataset.py          1.15     14.4Â±0.36ms     2.8 MB/sec     1.00     12.6Â±0.59ms     3.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.04      3.7Â±0.09ms     4.6 MB/sec     1.00      3.5Â±0.21ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00   503.5Â±25.79Âµs     5.9 MB/sec     1.02   513.2Â±25.14Âµs     5.7 MB/sec
linter/all-rules/pydantic/types.py         1.10      7.3Â±0.26ms     3.5 MB/sec     1.00      6.6Â±0.46ms     3.9 MB/sec
linter/default-rules/large/dataset.py      1.22      7.9Â±0.64ms     5.2 MB/sec     1.00      6.5Â±0.37ms     6.3 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.11  1560.3Â±91.43Âµs    10.7 MB/sec     1.00  1402.0Â±51.38Âµs    11.9 MB/sec
linter/default-rules/numpy/globals.py      1.06   192.9Â±22.40Âµs    15.3 MB/sec     1.00   182.7Â±11.65Âµs    16.1 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.3Â±0.15ms     7.7 MB/sec     1.01      3.3Â±0.34ms     7.7 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      4.3Â±0.01ms     9.5 MB/sec    1.01      4.3Â±0.03ms     9.4 MB/sec
formatter/numpy/ctypeslib.py               1.00    822.8Â±8.78Âµs    20.2 MB/sec    1.01   831.1Â±10.91Âµs    20.0 MB/sec
formatter/numpy/globals.py                 1.00     85.4Â±0.59Âµs    34.6 MB/sec    1.04     88.9Â±8.72Âµs    33.2 MB/sec
formatter/pydantic/types.py                1.00  1767.3Â±22.52Âµs    14.4 MB/sec    1.01  1787.5Â±22.35Âµs    14.3 MB/sec
linter/all-rules/large/dataset.py          1.00     12.5Â±0.09ms     3.2 MB/sec    1.01     12.7Â±0.07ms     3.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.5Â±0.01ms     4.7 MB/sec    1.01      3.6Â±0.03ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    369.7Â±4.87Âµs     8.0 MB/sec    1.01    373.5Â±5.28Âµs     7.9 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.5Â±0.03ms     3.9 MB/sec    1.01      6.6Â±0.05ms     3.9 MB/sec
linter/default-rules/large/dataset.py      1.00      6.9Â±0.02ms     5.9 MB/sec    1.01      6.9Â±0.05ms     5.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1433.9Â±5.69Âµs    11.6 MB/sec    1.00   1438.8Â±7.70Âµs    11.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    148.4Â±0.83Âµs    19.9 MB/sec    1.01    149.2Â±0.93Âµs    19.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.1Â±0.03ms     8.3 MB/sec    1.00      3.1Â±0.02ms     8.3 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-08-10 09:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-08-10 09:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 09:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@miscellaneous__docstring_no_string_normalization.py.snap</code>:1 on 2023-08-10 09:46</div>
            <div class="timeline-body"><p>This is a no string normalization test case, which we don't support</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-10 10:51</div>
            <div class="timeline-body"><p>It would be helpful for me if you could summarise the key points what &quot;format docstring&quot; includes. Having a basic understanding of the rules and not having to infer them from the code, would help me review the changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-10 11:10</div>
            <div class="timeline-body"><p>I've added a summary to the docstring: https://github.com/astral-sh/ruff/pull/6452/files#diff-9ae227f70699315433485961eb6bbeb9a45487857fbfebe473e926e71bc194f5R677-R760</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/suite.rs</code>:92 on 2023-08-10 14:33</div>
            <div class="timeline-body"><p>Hmm, this will get tricky with suppression comments because I had to move the formatting call out of this match (to avoid having to test whether the expression is suppressed in multiple places)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/suite.rs</code>:117 on 2023-08-10 14:35</div>
            <div class="timeline-body"><p>Calling the expression directly will be problematic when we add <code>fmt: skip</code> support because it now becomes necessary to handle the suppression comments here as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/suite.rs</code>:274 on 2023-08-10 14:35</div>
            <div class="timeline-body"><p>Oh no xD... The speedup potential for adding a <code>implicit_concatenated</code> to <code>String</code> increases day by day</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@miscellaneous__docstring_no_string_normalization.py.snap</code>:1 on 2023-08-10 14:36</div>
            <div class="timeline-body"><p>which one? Do we already track the deviation in an issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:673 on 2023-08-10 14:39</div>
            <div class="timeline-body"><p>Should we use the tab size from the options when <code>IndentStyle::Tab</code> is used (we can fallback to 8 if it is spaces)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:722 on 2023-08-10 14:39</div>
            <div class="timeline-body"><p>Soo pretty</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:695 on 2023-08-10 14:40</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// * Trim leading whitespace on the first line, again except for a chaperone space
</code></pre>
<p>What's a chaperone space? Googling doesn't provide any good results</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:737 on 2023-08-10 14:41</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// Tabs are counted by padding them to the next multiple of 8 according to `str.expandtabs`. When
</code></pre>
<p>Add a link to <code>str_expandtabs</code>. It's otherwise unclear what it refers to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:789 on 2023-08-10 14:44</div>
            <div class="timeline-body"><p>You have to use <code>universal_newlines</code> to properly support <code>\r\n</code> line endings. I see, you rely on the fact that we normalize newlines. Nice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:791 on 2023-08-10 14:45</div>
            <div class="timeline-body"><p>Can we emit the source position before <code>string_part.prefix</code> and the end position at the very end. This will help getting correct source maps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:829 on 2023-08-10 14:46</div>
            <div class="timeline-body"><p>You want to use <code>trim_whitespace_start()</code> and <code>trim_whitespace_end()</code> to only trim valid python whitespace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:874 on 2023-08-10 14:52</div>
            <div class="timeline-body"><p>Can we extract this test into a function if it is the same (and give it a name). That would allow us to document it once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:879 on 2023-08-10 14:52</div>
            <div class="timeline-body"><p>Write the end source position after the preferred quotes for proper source maps</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:923 on 2023-08-10 14:52</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        .take_while(|c| c.is_python_whitespace())
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:950 on 2023-08-10 14:55</div>
            <div class="timeline-body"><p>This repeats itself multiple times. I wonder if it would make sense to implement your type that stores the <code>Cow</code> internally and has a <code>write_slice(range, f)</code> method. It would remove the <code>is_normalized</code> boolean. However, I'm not sure if that plays nicely with <code>lines</code> (or a <code>Slice</code> enum that allows wrapping a &amp;str and `is_normalized).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-08-10 14:58</div>
            <div class="timeline-body"><p>Very impressive! I love it how you managed to implement this without allocating in the common case where docstrings are already formatted.</p>
<p>The main feedback theme is around using <code>is_python_whitespace</code>, <code>trim_whitespace_start</code>, <code>trim_whitespace</code>, and <code>trim_whitespace_end</code> instead of the rust provided <code>trim</code> methods to only trim valid Python whitespace.</p>
<p>The other part is that I don't know how to integrate this into my suppression PR xD But you can let me figure this out</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-10 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:121 on 2023-08-10 15:07</div>
            <div class="timeline-body"><p>Nit: The <code>format_docstring</code> function is the odd one in this file. Most other code uses <code>Format</code> implementations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-10 15:29</div>
            <div class="timeline-body"><p>Can you extend your test plan with the similarity index? The perfect implementation wouldn't change the similarity index, any bugs would show up in a regression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @konstin on 2023-08-10 16:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-08-10 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @konstin on 2023-08-10 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:695 on 2023-08-10 16:29</div>
            <div class="timeline-body"><p>i made this term up from a <a href="https://en.wikipedia.org/wiki/Chaperone_(protein">similar one</a>): it's a space that makes sure that a quote or a backspace inside the string don't get to close to the surrounding quotes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@miscellaneous__docstring_no_string_normalization.py.snap</code>:1 on 2023-08-10 17:30</div>
            <div class="timeline-body"><p>no, we need to decide if we want to support <a href="https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#s-skip-string-normalization">this option</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/statement/suite.rs</code>:117 on 2023-08-10 17:32</div>
            <div class="timeline-body"><p>i'm happy to change to whatever makes it easier with suppression. I initially had a <code>format_docstring</code> call here but thought it would be marginally nicer to at least go through the ExprConstant</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/statement/suite.rs</code>:274 on 2023-08-10 17:32</div>
            <div class="timeline-body"><p>also the confusion for developers would make it worthwhile :bow:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:673 on 2023-08-10 17:37</div>
            <div class="timeline-body"><p>black always uses 8: https://github.com/psf/black/blob/c36e468794f9256d5e922c399240d49782ba04f1/src/black/strings.py#L61 . imo indentation that mixes tabs and space is fundamentally undefined, so i would pick something that's easy and stable or in this case, black compatible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:829 on 2023-08-10 17:45</div>
            <div class="timeline-body"><p>i tried this, but to my surprise black disagrees and trims like rust instead. This is the diffs i get i make that change: https://gist.github.com/konstin/62227a242cea073a0d62efc19448e4fb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:923 on 2023-08-10 17:51</div>
            <div class="timeline-body"><p>same as above, black uses unicode whitesapce</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 17:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:950 on 2023-08-10 17:52</div>
            <div class="timeline-body"><p>i've though about this but docstring formatting is a special case and i wouldn't overengineer it, it already has enough indirection</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-10 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:121 on 2023-08-10 18:01</div>
            <div class="timeline-body"><p>i thought about this too but i didn't find a design that makes this better; i'd rather turn <code>FormatStringContinuation</code> into a function call.</p>
<p>In general, what would you think about going more into the direction of trying to make function calls (or some indirection of them) format-able?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-10 18:04</div>
            <div class="timeline-body"><blockquote>
<p>Can you extend your test plan with the similarity index? The perfect implementation wouldn't change the similarity index, any bugs would show up in a regression.</p>
</blockquote>
<p>good point:</p>
<p>main:
zulip: 0.99702
django: 0.99784
warehouse: 0.99585
build: 0.75623
transformers: 0.99469
cpython: 0.75989
typeshed: 0.74853</p>
<p>this branch:
zulip: 0.99702
django: 0.99783
warehouse: 0.99582
build: 0.75623
transformers: 0.99463
cpython: 0.75516
typeshed: 0.74853</p>
<p>this is a regression, i'll investigate</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-10 18:08</div>
            <div class="timeline-body"><p>It <em>could</em> be related to the fact that we format single-quote docstrings, while Black does not. (You're welcome to change that.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-10 18:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:673 on 2023-08-10 18:35</div>
            <div class="timeline-body"><p>That's correct, but black doesn't support changing the indent style.</p>
<p>I recommend running some doctest with the default options and once with indent style tab(4)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-10 18:48</div>
            <div class="timeline-body"><p>black does format single quote docstrings for me.</p>
<p>The problem was a chaperone space where there shouldn't be one, it's fixed now and the similarity scores match again; i updated the PR description.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-10 18:51</div>
            <div class="timeline-body"><p>Can you document whatever you see around single-quote docstrings in the Black Deviations document, where we claim Black doesn't format them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-10 19:40</div>
            <div class="timeline-body"><p>oh that's a slightly different area, it's about formatting the surroundings of the docstring that happens in <code>FormatSuite</code> rather than the docstring formatting itself:</p>
<pre><code class="language-python">class OracleSpatialRefSys(models.Model, SpatialRefSysMixin):
    &quot;Maps to the Oracle MDSYS.CS_SRS table.&quot;
    cs_name = models.CharField(max_length=68)
</code></pre>
<p>unlike black, we format this to</p>
<pre><code class="language-python">class OracleSpatialRefSys(models.Model, SpatialRefSysMixin):
    &quot;Maps to the Oracle MDSYS.CS_SRS table.&quot;

    cs_name = models.CharField(max_length=68)
</code></pre>
<p>It's code that i only moved around in this PR. I've added a comment but i think it's reasonable for black compatibility to fix that like a compatibility bug later. (From a style perspective, i'd turn single quoted docstrings into triple quoted docstrings)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-10 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:121 on 2023-08-10 20:28</div>
            <div class="timeline-body"><p>You can return a format_with or format_once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-10 20:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:695 on 2023-08-10 20:30</div>
            <div class="timeline-body"><p>Oh okay. We should define it somewhere (if it isn't already the case)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:673 on 2023-08-11 10:36</div>
            <div class="timeline-body"><p>do we actually allow setting the tab width somewhere (or did you mean something else)? <code>IndentStyle</code> is <code>enum IndentStyle { Tab, Space(u8) }</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-11 10:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-11 12:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:673 on 2023-08-11 12:17</div>
            <div class="timeline-body"><p>Oh we don't. Its an option on <code>PrinterOptions</code> but it seems we never initialize it:</p>
<p>https://github.com/astral-sh/ruff/blob/3ef1c2e3030028178c87314d7528ecec074cc840/crates/ruff_formatter/src/printer/printer_options/mod.rs#L6-L7</p>
<p>Anyway. adding a test with indent style tab would be good. We can expose the tab width later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-14 12:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/string.rs</code>:673 on 2023-08-14 12:01</div>
            <div class="timeline-body"><p>added 4 spaces, 2 spaces and tab fixture</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-08-14 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-08-14 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-14 12:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:52:41 UTC
    </footer>
</body>
</html>
