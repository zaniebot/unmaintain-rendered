<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Normalize implicit concatenated f-string quotes per part - astral-sh/ruff #13539</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Normalize implicit concatenated f-string quotes per part</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13539">#13539</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-09-27 15:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>This PR fixes a bug where ruff decided on whether the quotes for an implicit concatenated string can be changed for the entire expression instead of deciding on the part-level.</p>
<p><strong>Input</strong></p>
<pre><code>_ = (
    &#x27;This string should change its quotes to double quotes&#x27;
    f&#x27;This string uses double quotes in an expression {&quot;woah&quot;}&#x27;
    f&#x27;This f-string does not use any quotes.&#x27;
)
</code></pre>
<p><strong>Stable</strong></p>
<pre><code>_ = (
    &#x27;This string should change its quotes to double quotes&#x27;
    f&#x27;This string uses double quotes in an expression {&quot;woah&quot;}&#x27;
    f&#x27;This f-string does not use any quotes.&#x27;
)
</code></pre>
<p>Notice how the formatter doesn&#x27;t change any quotes only because one f-string has an expression containing double quotes.</p>
<p><strong>Preview</strong></p>
<pre><code>_ = (
    &quot;This string should change its quotes to double quotes&quot;
    f&#x27;This string uses double quotes in an expression {&quot;woah&quot;}&#x27;
    f&quot;This f-string does not use any quotes.&quot;
)
</code></pre>
<p>This matches black and how Ruff normalizes quotes for regular string literals (the decision is made per literal and for the entire implicit concatenated string expression)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-27 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-27 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-09-27 15:22</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>ℹ️ ecosystem check <strong>detected format changes</strong>. (+93 -93 lines in 36 files in 3 projects; 51 projects unchanged)</p>
<a href="https://github.com/langchain-ai/langchain">langchain-ai/langchain</a> (+3 -3 lines across 1 file)
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href="https://github.com/langchain-ai/langchain/blob/16f5fdb38b307ee3f3b5065f671b28c90661b698/templates/neo4j-semantic-ollama/neo4j_semantic_ollama/recommendation_tool.py#L77">templates/neo4j-semantic-ollama/neo4j_semantic_ollama/recommendation_tool.py~L77</a></p>
<pre><code>         response = graph.query(recommendation_query_db_history, params)
         try:
             return (
-                &#x27;Recommended movies are: &#x27;
+                &quot;Recommended movies are: &quot;
                 f&#x27;{f&quot;###Movie {nl}&quot;.join([el[&quot;movie&quot;] for el in response])}&#x27;
             )
         except Exception:
</code></pre>
<p><a href="https://github.com/langchain-ai/langchain/blob/16f5fdb38b307ee3f3b5065f671b28c90661b698/templates/neo4j-semantic-ollama/neo4j_semantic_ollama/recommendation_tool.py#L87">templates/neo4j-semantic-ollama/neo4j_semantic_ollama/recommendation_tool.py~L87</a></p>
<pre><code>         response = graph.query(recommendation_query_genre, params)
         try:
             return (
-                &#x27;Recommended movies are: &#x27;
+                &quot;Recommended movies are: &quot;
                 f&#x27;{f&quot;###Movie {nl}&quot;.join([el[&quot;movie&quot;] for el in response])}&#x27;
             )
         except Exception:
</code></pre>
<p><a href="https://github.com/langchain-ai/langchain/blob/16f5fdb38b307ee3f3b5065f671b28c90661b698/templates/neo4j-semantic-ollama/neo4j_semantic_ollama/recommendation_tool.py#L101">templates/neo4j-semantic-ollama/neo4j_semantic_ollama/recommendation_tool.py~L101</a></p>
<pre><code>     response = graph.query(query, params)
     try:
         return (
-            &#x27;Recommended movies are: &#x27;
+            &quot;Recommended movies are: &quot;
             f&#x27;{f&quot;###Movie {nl}&quot;.join([el[&quot;movie&quot;] for el in response])}&#x27;
         )
     except Exception:
</code></pre>
</p>

<a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+1 -1 lines across 1 file)
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href="https://github.com/pandas-dev/pandas/blob/5126dcaf88167ff869db874be40a520bb86a27ed/scripts/validate_docstrings.py#L369">scripts/validate_docstrings.py~L369</a></p>
<pre><code>         for err_code in actual_failures - expected_failures:
             sys.stdout.write(
                 f&#x27;{prefix}{res[&quot;file&quot;]}:{res[&quot;file_line&quot;]}:&#x27;
-                f&#x27;{err_code}:{func_name}:{error_messages[err_code]}\n&#x27;
+                f&quot;{err_code}:{func_name}:{error_messages[err_code]}\n&quot;
             )
             exit_status += 1
         for err_code in ignore_errors.get(func_name, set()) - actual_failures:
</code></pre>
</p>

<a href="https://github.com/rotki/rotki">rotki/rotki</a> (+89 -89 lines across 34 files)
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/rest.py#L445">rotkehlchen/api/rest.py~L445</a></p>
<pre><code>             return
 
         log.error(
-            f&#x27;{task_str} dies with exception: {greenlet.exception}.\n&#x27;
-            f&#x27;Exception Name: {greenlet.exc_info[0]}\n&#x27;
-            f&#x27;Exception Info: {greenlet.exc_info[1]}\n&#x27;
+            f&quot;{task_str} dies with exception: {greenlet.exception}.\n&quot;
+            f&quot;Exception Name: {greenlet.exc_info[0]}\n&quot;
+            f&quot;Exception Info: {greenlet.exc_info[1]}\n&quot;
             f&#x27;Traceback:\n {&quot;&quot;.join(traceback.format_tb(greenlet.exc_info[2]))}&#x27;,
         )
         # also write an error for the task result if it&#x27;s not the main greenlet
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/rest.py#L1479">rotkehlchen/api/rest.py~L1479</a></p>
<pre><code>         if identifiers is not None:
             return api_response(
                 result=wrap_in_fail_result(
-                    f&#x27;Failed to add {asset.asset_type!s} {asset.name} &#x27;
+                    f&quot;Failed to add {asset.asset_type!s} {asset.name} &quot;
                     f&#x27;since it already exists. Existing ids: {&quot;,&quot;.join(identifiers)}&#x27;
                 ),
                 status_code=HTTPStatus.CONFLICT,
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/rest.py#L3231">rotkehlchen/api/rest.py~L3231</a></p>
<pre><code>     ) -&gt; dict[str, Any]:
         &quot;&quot;&quot;Return the current price of the assets in the target asset currency.&quot;&quot;&quot;
         log.debug(
-            f&#x27;Querying the current {target_asset.identifier} price of these assets: &#x27;
+            f&quot;Querying the current {target_asset.identifier} price of these assets: &quot;
             f&#x27;{&quot;, &quot;.join([asset.identifier for asset in assets])}&#x27;,
         )
         # Type is list instead of tuple here because you can&#x27;t serialize a tuple
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/rest.py#L3338">rotkehlchen/api/rest.py~L3338</a></p>
<pre><code>         asset currency.
         &quot;&quot;&quot;
         log.debug(
-            f&#x27;Querying the historical {target_asset.identifier} price of these assets: &#x27;
+            f&quot;Querying the historical {target_asset.identifier} price of these assets: &quot;
             f&#x27;{&quot;, &quot;.join(f&quot;{asset.identifier} at {ts}&quot; for asset, ts in assets_timestamp)}&#x27;,
             assets_timestamp=assets_timestamp,
         )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/fields.py#L532">rotkehlchen/api/v1/fields.py~L532</a></p>
<pre><code> 
         if self.limit_to is not None and chain_id not in self.limit_to:
             raise ValidationError(
-                f&#x27;Given chain_id {value} is not one of &#x27;
+                f&quot;Given chain_id {value} is not one of &quot;
                 f&#x27;{&quot;,&quot;.join([str(x) for x in self.limit_to])} as needed by the endpoint&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/fields.py#L572">rotkehlchen/api/v1/fields.py~L572</a></p>
<pre><code> 
         if self.limit_to is not None and chain not in self.limit_to:
             raise ValidationError(
-                f&#x27;Given chain {value} is not one of &#x27;
+                f&quot;Given chain {value} is not one of &quot;
                 f&#x27;{&quot;,&quot;.join([str(x) for x in self.limit_to])} as needed by the endpoint&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/fields.py#L807">rotkehlchen/api/v1/fields.py~L807</a></p>
<pre><code> 
         if self.limit_to is not None and location not in self.limit_to:
             raise ValidationError(
-                f&#x27;Given location {value} is not one of &#x27;
+                f&quot;Given location {value} is not one of &quot;
                 f&#x27;{&quot;,&quot;.join([str(x) for x in self.limit_to])} as needed by the endpoint&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/fields.py#L929">rotkehlchen/api/v1/fields.py~L929</a></p>
<pre><code>                 and not any(value.filename.endswith(x) for x in self.allowed_extensions)
             ):  # noqa: E501
                 raise ValidationError(
-                    f&#x27;Given file {value.filename} does not end in any of &#x27;
+                    f&quot;Given file {value.filename} does not end in any of &quot;
                     f&#x27;{&quot;,&quot;.join(self.allowed_extensions)}&#x27;,
                 )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/fields.py#L949">rotkehlchen/api/v1/fields.py~L949</a></p>
<pre><code>             path.suffix == x for x in self.allowed_extensions
         ):  # noqa: E501
             raise ValidationError(
-                f&#x27;Given file {path} does not end in any of &#x27;
+                f&quot;Given file {path} does not end in any of &quot;
                 f&#x27;{&quot;,&quot;.join(self.allowed_extensions)}&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L466">rotkehlchen/api/v1/schemas.py~L466</a></p>
<pre><code>             data[&quot;order_by_attributes&quot;]
         ).issubset(valid_ordering_attr):
             error_msg = (
-                f&#x27;order_by_attributes for trades can not be &#x27;
+                f&quot;order_by_attributes for trades can not be &quot;
                 f&#x27;{&quot;,&quot;.join(set(data[&quot;order_by_attributes&quot;]) - valid_ordering_attr)}&#x27;
             )
             raise ValidationError(
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L695">rotkehlchen/api/v1/schemas.py~L695</a></p>
<pre><code>             data[&quot;order_by_attributes&quot;]
         ).issubset(valid_ordering_attr):
             error_msg = (
-                f&#x27;order_by_attributes for history event data can not be &#x27;
+                f&quot;order_by_attributes for history event data can not be &quot;
                 f&#x27;{&quot;,&quot;.join(set(data[&quot;order_by_attributes&quot;]) - valid_ordering_attr)}&#x27;
             )
             raise ValidationError(
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L985">rotkehlchen/api/v1/schemas.py~L985</a></p>
<pre><code>             data[&quot;order_by_attributes&quot;]
         ).issubset(valid_ordering_attr):
             error_msg = (
-                f&#x27;order_by_attributes for asset movements can not be &#x27;
+                f&quot;order_by_attributes for asset movements can not be &quot;
                 f&#x27;{&quot;,&quot;.join(set(data[&quot;order_by_attributes&quot;]) - valid_ordering_attr)}&#x27;
             )
             raise ValidationError(
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L1179">rotkehlchen/api/v1/schemas.py~L1179</a></p>
<pre><code>         raise ValidationError(
             f&#x27;Invalid current price oracles in: {&quot;, &quot;.join(oracle_names)}. &#x27;
             f&#x27;Supported oracles are: {&quot;, &quot;.join(supported_oracle_names)}. &#x27;
-            f&#x27;Check there are no repeated ones.&#x27;,
+            f&quot;Check there are no repeated ones.&quot;,
         )
 
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L1195">rotkehlchen/api/v1/schemas.py~L1195</a></p>
<pre><code>         raise ValidationError(
             f&#x27;Invalid historical price oracles in: {&quot;, &quot;.join(oracle_names)}. &#x27;
             f&#x27;Supported oracles are: {&quot;, &quot;.join(supported_oracle_names)}. &#x27;
-            f&#x27;Check there are no repeated ones.&#x27;,
+            f&quot;Check there are no repeated ones.&quot;,
         )
 
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L1685">rotkehlchen/api/v1/schemas.py~L1685</a></p>
<pre><code>             data[&quot;order_by_attributes&quot;]
         ).issubset(valid_ordering_attr):
             error_msg = (
-                f&#x27;order_by_attributes for accounting report data can not be &#x27;
+                f&quot;order_by_attributes for accounting report data can not be &quot;
                 f&#x27;{&quot;,&quot;.join(set(data[&quot;order_by_attributes&quot;]) - valid_ordering_attr)}&#x27;
             )
             raise ValidationError(
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L2758">rotkehlchen/api/v1/schemas.py~L2758</a></p>
<pre><code>             data[&quot;order_by_attributes&quot;]
         ).issubset(valid_ordering_attr):
             error_msg = (
-                f&#x27;order_by_attributes for eth2 daily stats can not be &#x27;
+                f&quot;order_by_attributes for eth2 daily stats can not be &quot;
                 f&#x27;{&quot;,&quot;.join(set(data[&quot;order_by_attributes&quot;]) - valid_ordering_attr)}&#x27;
             )
             raise ValidationError(
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/api/v1/schemas.py#L3081">rotkehlchen/api/v1/schemas.py~L3081</a></p>
<pre><code>         ):  # noqa: E501
             raise ValidationError(
                 f&#x27;timestamp provided {data[&quot;timestamp&quot;]} is not the same as the &#x27;
-                f&#x27;one for the entries provided.&#x27;,
+                f&quot;one for the entries provided.&quot;,
             )
 
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/chain/aggregator.py#L780">rotkehlchen/chain/aggregator.py~L780</a></p>
<pre><code>         unknown_accounts = set(accounts).difference(self.accounts.get(blockchain))
         if len(unknown_accounts) != 0:
             raise InputError(
-                f&#x27;Tried to remove unknown {blockchain.value} &#x27;
+                f&quot;Tried to remove unknown {blockchain.value} &quot;
                 f&#x27;accounts {&quot;,&quot;.join(unknown_accounts)}&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/chain/ethereum/abi.py#L89">rotkehlchen/chain/ethereum/abi.py~L89</a></p>
<pre><code>     duplicate_names = set(log_topic_names).intersection(log_data_names)
     if duplicate_names:
         raise DeserializationError(
-            f&#x27;The following argument names are duplicated &#x27;
+            f&quot;The following argument names are duplicated &quot;
             f&quot;between event inputs: &#x27;{&#x27;, &#x27;.join(duplicate_names)}&#x27;&quot;,
         )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/chain/ethereum/modules/nft/nfts.py#L293">rotkehlchen/chain/ethereum/modules/nft/nfts.py~L293</a></p>
<pre><code>         with self.db.user_write() as write_cursor:
             # Remove NFTs that the user no longer owns from the DB cache
             write_cursor.execute(
-                f&#x27;DELETE FROM nfts WHERE owner_address IN &#x27;
+                f&quot;DELETE FROM nfts WHERE owner_address IN &quot;
                 f&#x27;({&quot;,&quot;.join(&quot;?&quot; * len(addresses))}) AND identifier NOT IN &#x27;
                 f&#x27;({&quot;,&quot;.join(&quot;?&quot; * len(fresh_nfts_identifiers))})&#x27;,
                 tuple(addresses) + tuple(fresh_nfts_identifiers),
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/chain/evm/decoding/curve/curve_cache.py#L406">rotkehlchen/chain/evm/decoding/curve/curve_cache.py~L406</a></p>
<pre><code>             raise RemoteError(f&quot;Curve pool data {api_pool_data} are missing key {e}&quot;) from e
         except DeserializationError as e:
             log.error(
-                f&#x27;Could not deserialize evm address while decoding curve pool &#x27;
+                f&quot;Could not deserialize evm address while decoding curve pool &quot;
                 f&#x27;{api_pool_data[&quot;address&quot;]} information from curve api: {e}&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/chain/substrate/manager.py#L110">rotkehlchen/chain/substrate/manager.py~L110</a></p>
<pre><code>             return result
 
         raise RemoteError(
-            f&#x27;{manager.chain} request failed after trying the following nodes: &#x27;
+            f&quot;{manager.chain} request failed after trying the following nodes: &quot;
             f&#x27;{&quot;, &quot;.join(requested_nodes)}&#x27;,
         )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/dbhandler.py#L1242">rotkehlchen/db/dbhandler.py~L1242</a></p>
<pre><code>         &quot;&quot;&quot;
         # Assure all are there
         accounts_number = write_cursor.execute(
-            f&#x27;SELECT COUNT(*) from blockchain_accounts WHERE blockchain = ? &#x27;
+            f&quot;SELECT COUNT(*) from blockchain_accounts WHERE blockchain = ? &quot;
             f&#x27;AND account IN ({&quot;,&quot;.join(&quot;?&quot; * len(accounts))})&#x27;,
             (blockchain.value, *accounts),
         ).fetchone()[0]
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/dbhandler.py#L2313">rotkehlchen/db/dbhandler.py~L2313</a></p>
<pre><code>         ]
         for hashes_chunk in get_chunks(hashes_to_remove, n=1000):  # limit num of hashes in a query
             write_cursor.execute(  # delete transactions themselves
-                f&#x27;DELETE FROM zksynclite_transactions WHERE tx_hash IN &#x27;
+                f&quot;DELETE FROM zksynclite_transactions WHERE tx_hash IN &quot;
                 f&#x27;({&quot;,&quot;.join(&quot;?&quot; * len(hashes_chunk))})&#x27;,
                 hashes_chunk,
             )
             write_cursor.execute(
-                f&#x27;DELETE FROM history_events WHERE identifier IN (SELECT H.identifier &#x27;
-                f&#x27;FROM history_events H INNER JOIN evm_events_info E &#x27;
-                f&#x27;ON H.identifier=E.identifier AND E.tx_hash IN &#x27;
+                f&quot;DELETE FROM history_events WHERE identifier IN (SELECT H.identifier &quot;
+                f&quot;FROM history_events H INNER JOIN evm_events_info E &quot;
+                f&quot;ON H.identifier=E.identifier AND E.tx_hash IN &quot;
                 f&#x27;({&quot;, &quot;.join([&quot;?&quot;] * len(hashes_chunk))}) AND H.location=?)&#x27;,
                 hashes_chunk + [Location.ZKSYNC_LITE.serialize_for_db()],
             )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/dbhandler.py#L3152">rotkehlchen/db/dbhandler.py~L3152</a></p>
<pre><code> 
         if len(unknown_tags) != 0:
             raise TagConstraintError(
-                f&#x27;When {action} {data_type}, unknown tags &#x27;
+                f&quot;When {action} {data_type}, unknown tags &quot;
                 f&#x27;{&quot;, &quot;.join(unknown_tags)} were found&#x27;,
             )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/dbhandler.py#L3806">rotkehlchen/db/dbhandler.py~L3806</a></p>
<pre><code>         result = {}
         with self.conn.read_ctx() as cursor:
             cursor.execute(
-                f&#x27;SELECT identifier, name, collection_name, image_url FROM nfts WHERE &#x27;
+                f&quot;SELECT identifier, name, collection_name, image_url FROM nfts WHERE &quot;
                 f&#x27;identifier IN ({&quot;,&quot;.join(&quot;?&quot; * len(identifiers))})&#x27;,
                 identifiers,
             )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/eth2.py#L221">rotkehlchen/db/eth2.py~L221</a></p>
<pre><code>         &quot;&quot;&quot;
         questionmarks = &quot;?&quot; * len(addresses)
         cursor.execute(
-            f&#x27;SELECT S.validator_index FROM eth_staking_events_info S LEFT JOIN &#x27;
-            f&#x27;history_events H on S.identifier=H.identifier WHERE H.location_label IN &#x27;
+            f&quot;SELECT S.validator_index FROM eth_staking_events_info S LEFT JOIN &quot;
+            f&quot;history_events H on S.identifier=H.identifier WHERE H.location_label IN &quot;
             f&#x27;({&quot;,&quot;.join(questionmarks)})&#x27;,
             addresses,
         )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/eth2.py#L353">rotkehlchen/db/eth2.py~L353</a></p>
<pre><code>         with self.db.user_write() as cursor:
             # Delete from the validators table. This should also delete from daily_staking_details
             cursor.execute(
-                f&#x27;DELETE FROM eth2_validators WHERE validator_index IN &#x27;
+                f&quot;DELETE FROM eth2_validators WHERE validator_index IN &quot;
                 f&#x27;({&quot;,&quot;.join(question_marks)})&#x27;,
                 validator_indices,
             )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/eth2.py#L366">rotkehlchen/db/eth2.py~L366</a></p>
<pre><code>             # Delete from the events table, all staking events except for deposits.
             # We keep deposits since they are associated with the address and are EVM transactions
             cursor.execute(
-                f&#x27;DELETE FROM history_events WHERE identifier in (SELECT S.identifier &#x27;
-                f&#x27;FROM eth_staking_events_info S WHERE S.validator_index IN &#x27;
+                f&quot;DELETE FROM history_events WHERE identifier in (SELECT S.identifier &quot;
+                f&quot;FROM eth_staking_events_info S WHERE S.validator_index IN &quot;
                 f&#x27;({&quot;,&quot;.join(question_marks)})) AND entry_type != ?&#x27;,
                 (*validator_indices, HistoryBaseEntryType.ETH_DEPOSIT_EVENT.serialize_for_db()),
             )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/unresolved_conflicts.py#L111">rotkehlchen/db/unresolved_conflicts.py~L111</a></p>
<pre><code> 
             # also query the linked rules information
             cursor.execute(
-                &#x27;SELECT accounting_rule, property_name, setting_name FROM &#x27;
+                &quot;SELECT accounting_rule, property_name, setting_name FROM &quot;
                 f&#x27;linked_rules_properties WHERE accounting_rule IN ({&quot;,&quot;.join(&quot;?&quot; * len(id_to_data))})&#x27;,  # noqa: E501
                 list(id_to_data.keys()),
             )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/updates.py#L277">rotkehlchen/db/updates.py~L277</a></p>
<pre><code>             if single_contract_data[&quot;abi&quot;] not in remote_id_to_local_id:
                 self.msg_aggregator.add_error(
                     f&#x27;ABI with id {single_contract_data[&quot;abi&quot;]} was missing in a contracts &#x27;
-                    f&#x27;update. Please report it to the rotki team.&#x27;,
+                    f&quot;update. Please report it to the rotki team.&quot;,
                 )
                 continue
             new_contracts_data.append((
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/db/updates.py#L310">rotkehlchen/db/updates.py~L310</a></p>
<pre><code>                 self.msg_aggregator.add_error(
                     f&#x27;Could not deserialize address {raw_entry[&quot;address&quot;]} or blockchain &#x27;
                     f&#x27;{raw_entry[&quot;blockchain&quot;]} that was seen in a global addressbook update. &#x27;
-                    f&#x27;Please report it to the rotki team. {e!s}&#x27;,
+                    f&quot;Please report it to the rotki team. {e!s}&quot;,
                 )
                 continue
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/binance.py#L141">rotkehlchen/exchanges/binance.py~L141</a></p>
<pre><code>     rate = deserialize_price(binance_trade[&quot;price&quot;])
     if binance_trade[&quot;symbol&quot;] not in binance_symbols_to_pair:
         raise DeserializationError(
-            f&#x27;Error reading a {location!s} trade. Could not find &#x27;
+            f&quot;Error reading a {location!s} trade. Could not find &quot;
             f&#x27;{binance_trade[&quot;symbol&quot;]} in binance_symbols_to_pair&#x27;,
         )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/binance.py#L524">rotkehlchen/exchanges/binance.py~L524</a></p>
<pre><code>             except DeserializationError:
                 log.error(
                     f&#x27;Found {self.name} asset with non-string type {type(entry[&quot;asset&quot;])}. &#x27;
-                    f&#x27;Ignoring its balance query.&#x27;,
+                    f&quot;Ignoring its balance query.&quot;,
                 )
                 continue
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/binance.py#L959">rotkehlchen/exchanges/binance.py~L959</a></p>
<pre><code>                     continue
                 except DeserializationError:
                     log.error(
-                        f&#x27;Found {self.name} asset with non-string type &#x27;
+                        f&quot;Found {self.name} asset with non-string type &quot;
                         f&#x27;{type(entry[&quot;asset&quot;])}. Ignoring its futures balance query.&#x27;,
                     )
                     continue
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/binance.py#L1039">rotkehlchen/exchanges/binance.py~L1039</a></p>
<pre><code>                     continue
                 except DeserializationError:
                     log.error(
-                        f&#x27;Found {self.name} asset with non-string type &#x27;
+                        f&quot;Found {self.name} asset with non-string type &quot;
                         f&#x27;{type(entry[&quot;asset&quot;])}. Ignoring its margined futures balance query.&#x27;,
                     )
                     continue
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/bitfinex.py#L395">rotkehlchen/exchanges/bitfinex.py~L395</a></p>
<pre><code> 
             if raw_result[timestamp_index] &gt; options[&quot;end&quot;]:
                 log.debug(
-                    f&#x27;Unexpected result requesting {self.name} {case}. &#x27;
-                    f&#x27;Result timestamp {raw_result[timestamp_index]} is greater than &#x27;
+                    f&quot;Unexpected result requesting {self.name} {case}. &quot;
+                    f&quot;Result timestamp {raw_result[timestamp_index]} is greater than &quot;
                     f&#x27;end filter {options[&quot;end&quot;]}. Stop requesting.&#x27;,
                     raw_result=raw_result,
                 )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/bitstamp.py#L474">rotkehlchen/exchanges/bitstamp.py~L474</a></p>
<pre><code>         payload_string = urlencode(call_options)
         content_type = &quot;&quot; if payload_string == &quot;&quot; else &quot;application/x-www-form-urlencoded&quot;
         message = (
-            &#x27;BITSTAMP &#x27;
-            f&#x27;{self.api_key}&#x27;
-            f&#x27;{method.upper()}&#x27;
+            &quot;BITSTAMP &quot;
+            f&quot;{self.api_key}&quot;
+            f&quot;{method.upper()}&quot;
             f&#x27;{request_url.replace(&quot;https://&quot;, &quot;&quot;)}&#x27;
-            f&#x27;{query_params}&#x27;
-            f&#x27;{content_type}&#x27;
-            f&#x27;{nonce}&#x27;
-            f&#x27;{timestamp}&#x27;
-            &#x27;v2&#x27;
-            f&#x27;{payload_string}&#x27;
+            f&quot;{query_params}&quot;
+            f&quot;{content_type}&quot;
+            f&quot;{nonce}&quot;
+            f&quot;{timestamp}&quot;
+            &quot;v2&quot;
+            f&quot;{payload_string}&quot;
         )
         signature = hmac.new(
             self.secret,
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/coinbase.py#L355">rotkehlchen/exchanges/coinbase.py~L355</a></p>
<pre><code> 
             if not isinstance(account_data[&quot;id&quot;], str):
                 log.error(
-                    f&#x27;Found coinbase account entry with a non string id: &#x27;
+                    f&quot;Found coinbase account entry with a non string id: &quot;
                     f&#x27;{account_data[&quot;id&quot;]}. Skipping it. &#x27;,
                 )
                 continue
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/coinbase.py#L933">rotkehlchen/exchanges/coinbase.py~L933</a></p>
<pre><code>                     if asset != asset_from_coinbase(fee_asset, time=timestamp):
                         # If not we set ZERO fee and ignore
                         log.error(
-                            f&#x27;In a coinbase withdrawal of {asset.identifier} the fee&#x27;
+                            f&quot;In a coinbase withdrawal of {asset.identifier} the fee&quot;
                             f&#x27;is denoted in {raw_fee[&quot;currency&quot;]}&#x27;,
                         )
                     else:
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/exchanges/kraken.py#L503">rotkehlchen/exchanges/kraken.py~L503</a></p>
<pre><code> 
             if count != response[&quot;count&quot;]:
                 log.error(
-                    f&#x27;Kraken unexpected response while querying endpoint for period. &#x27;
+                    f&quot;Kraken unexpected response while querying endpoint for period. &quot;
                     f&#x27;Original count was {count} and response returned {response[&quot;count&quot;]}&#x27;,
                 )
                 with_errors = True
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/externalapis/coingecko.py#L840">rotkehlchen/externalapis/coingecko.py~L840</a></p>
<pre><code>                 if entry[&quot;id&quot;] in data:
                     log.warning(
                         f&#x27;Found duplicate coingecko identifier {entry[&quot;id&quot;]} when querying &#x27;
-                        f&#x27;the list of coingecko assets. Ignoring...&#x27;,
+                        f&quot;the list of coingecko assets. Ignoring...&quot;,
                     )
                     continue
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/externalapis/cryptocompare.py#L283">rotkehlchen/externalapis/cryptocompare.py~L283</a></p>
<pre><code>         can_query = got_cached_data or not rate_limited
         log.debug(
             f&#x27;{&quot;Will&quot; if can_query else &quot;Will not&quot;} query &#x27;
-            f&#x27;Cryptocompare history for {from_asset.identifier} -&gt; &#x27;
-            f&#x27;{to_asset.identifier} @ {timestamp}. Cached data: {got_cached_data}&#x27;
-            f&#x27; rate_limited in last {seconds} seconds: {rate_limited}&#x27;,
+            f&quot;Cryptocompare history for {from_asset.identifier} -&gt; &quot;
+            f&quot;{to_asset.identifier} @ {timestamp}. Cached data: {got_cached_data}&quot;
+            f&quot; rate_limited in last {seconds} seconds: {rate_limited}&quot;,
         )
         return can_query
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/externalapis/etherscan.py#L557">rotkehlchen/externalapis/etherscan.py~L557</a></p>
<pre><code>                 except DeserializationError as e:
                     log.error(
                         f&quot;Failed to read transaction timestamp {entry[&#x27;hash&#x27;]} from {self.chain} &quot;
-                        f&#x27;etherscan for {account} in the range {from_ts} to {to_ts}. {e!s}&#x27;,
+                        f&quot;etherscan for {account} in the range {from_ts} to {to_ts}. {e!s}&quot;,
                     )
                     continue
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/externalapis/etherscan.py#L570">rotkehlchen/externalapis/etherscan.py~L570</a></p>
<pre><code>                 except DeserializationError as e:
                     log.error(
                         f&quot;Failed to read transaction hash {entry[&#x27;hash&#x27;]} from {self.chain} &quot;
-                        f&#x27;etherscan for {account} in the range {from_ts} to {to_ts}. {e!s}&#x27;,
+                        f&quot;etherscan for {account} in the range {from_ts} to {to_ts}. {e!s}&quot;,
                     )
                     continue
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/externalapis/gnosispay.py#L225">rotkehlchen/externalapis/gnosispay.py~L225</a></p>
<pre><code>         &quot;&quot;&quot;Return the gnosis pay data matching the given DB data&quot;&quot;&quot;
         with self.database.conn.read_ctx() as cursor:
             cursor.execute(
-                f&#x27;SELECT tx_hash, timestamp, merchant_name, merchant_city, country, mcc, &#x27;
-                f&#x27;transaction_symbol, transaction_amount, billing_symbol, billing_amount, &#x27;
-                f&#x27;reversal_symbol, reversal_amount, reversal_tx_hash &#x27;
+                f&quot;SELECT tx_hash, timestamp, merchant_name, merchant_city, country, mcc, &quot;
+                f&quot;transaction_symbol, transaction_amount, billing_symbol, billing_amount, &quot;
+                f&quot;reversal_symbol, reversal_amount, reversal_tx_hash &quot;
                 f&#x27;{&quot;, identifier &quot; if with_identifier else &quot;&quot;}&#x27;
-                f&#x27;FROM gnosispay_data WHERE {wherestatement}&#x27;,
+                f&quot;FROM gnosispay_data WHERE {wherestatement}&quot;,
                 bindings,
             )
             if (result := cursor.fetchone()) is None:
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/externalapis/opensea.py#L295">rotkehlchen/externalapis/opensea.py~L295</a></p>
<pre><code>                 else:  # should not happen. That means collections endpoint doesnt return anything
                     raise DeserializationError(
                         f&#x27;Could not find collection {entry[&quot;collection&quot;]} in opensea collections &#x27;
-                        f&#x27;endpoint&#x27;,
+                        f&quot;endpoint&quot;,
                     )
 
             last_price_in_usd = last_price_in_eth * eth_usd_price
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/globaldb/assets_management.py#L40">rotkehlchen/globaldb/assets_management.py~L40</a></p>
<pre><code> 
     if int(data[&quot;version&quot;]) not in ASSETS_FILE_IMPORT_ACCEPTED_GLOBALDB_VERSIONS:
         raise InputError(
-            f&#x27;Provided file is for a different version of rotki. GlobalDB File version: &#x27;
+            f&quot;Provided file is for a different version of rotki. GlobalDB File version: &quot;
             f&#x27;{data[&quot;version&quot;]} Accepted GlobalDB version by rotki: {ASSETS_FILE_IMPORT_ACCEPTED_GLOBALDB_VERSIONS}&#x27;,  # noqa: E501
         )
     if data[&quot;assets&quot;] is None:
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/globaldb/handler.py#L445">rotkehlchen/globaldb/handler.py~L445</a></p>
<pre><code>             # results before hand, in the range from 10 to 100 and this guarantees that the size of
             # the query is small.
             underlying_tokens_query = (
-                f&#x27;SELECT parent_token_entry, address, token_kind, weight FROM &#x27;
-                f&#x27;underlying_tokens_list LEFT JOIN evm_tokens ON &#x27;
-                f&#x27;underlying_tokens_list.identifier=evm_tokens.identifier &#x27;
+                f&quot;SELECT parent_token_entry, address, token_kind, weight FROM &quot;
+                f&quot;underlying_tokens_list LEFT JOIN evm_tokens ON &quot;
+                f&quot;underlying_tokens_list.identifier=evm_tokens.identifier &quot;
                 f&#x27;WHERE parent_token_entry IN ({&quot;,&quot;.join([&quot;?&quot;] * len(assets_info))})&#x27;
             )
             # populate all underlying tokens
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/globaldb/handler.py#L1210">rotkehlchen/globaldb/handler.py~L1210</a></p>
<pre><code>                 )
         except sqlite3.IntegrityError as e:
             log.error(
-                f&#x27;One of the following asset ids caused a DB IntegrityError ({e!s}): &#x27;
+                f&quot;One of the following asset ids caused a DB IntegrityError ({e!s}): &quot;
                 f&#x27;{&quot;,&quot;.join([x.identifier for x in assets])}&#x27;,
             )  # should not ever happen but need to handle with informative log if it does
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/globaldb/upgrades/v2_v3.py#L356">rotkehlchen/globaldb/upgrades/v2_v3.py~L356</a></p>
<pre><code>         &quot;KSM&quot;,
     )
     cursor.execute(
-        f&#x27;SELECT from_asset, to_asset, source_type, timestamp, price FROM &#x27;
+        f&quot;SELECT from_asset, to_asset, source_type, timestamp, price FROM &quot;
         f&#x27;price_history WHERE (source_type==&quot;A&quot; OR from_asset IN ({&quot;,&quot;.join([&quot;?&quot;] * len(assets))}))&#x27;,  # noqa: E501
         assets,
     )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/greenlets/manager.py#L76">rotkehlchen/greenlets/manager.py~L76</a></p>
<pre><code>             return
 
         msg = (
-            f&#x27;{first_line}.\n&#x27;
-            f&#x27;Exception Name: {greenlet.exc_info[0]}\nException Info: {greenlet.exc_info[1]}&#x27;
+            f&quot;{first_line}.\n&quot;
+            f&quot;Exception Name: {greenlet.exc_info[0]}\nException Info: {greenlet.exc_info[1]}&quot;
             f&#x27;\nTraceback:\n {&quot;&quot;.join(traceback.format_tb(greenlet.exc_info[2]))}&#x27;
         )
         log.error(msg)
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/history/manager.py#L268">rotkehlchen/history/manager.py~L268</a></p>
<pre><code> 
             if len(exchange_names) != 0:
                 self.msg_aggregator.add_error(
-                    f&#x27;Failed to query some events from {location.name} exchanges &#x27;
+                    f&quot;Failed to query some events from {location.name} exchanges &quot;
                     f&#x27;{&quot;,&quot;.join(exchange_names)}&#x27;,
                 )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/serialization/schemas.py#L230">rotkehlchen/serialization/schemas.py~L230</a></p>
<pre><code>             if weight_sum &gt; ONE:
                 raise ValidationError(
                     f&#x27;The sum of underlying token weights for {data[&quot;address&quot;]} &#x27;
-                    f&#x27;is {weight_sum * 100} and exceeds 100%&#x27;,
+                    f&quot;is {weight_sum * 100} and exceeds 100%&quot;,
                 )
             if weight_sum &lt; ONE:
                 raise ValidationError(
                     f&#x27;The sum of underlying token weights for {data[&quot;address&quot;]} &#x27;
-                    f&#x27;is {weight_sum * 100} and does not add up to 100%&#x27;,
+                    f&quot;is {weight_sum * 100} and does not add up to 100%&quot;,
                 )
 
     @post_load
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tasks/manager.py#L1100">rotkehlchen/tasks/manager.py~L1100</a></p>
<pre><code>         current_greenlets = len(self.greenlet_manager.greenlets) + len(self.api_task_greenlets)
         not_proceed = current_greenlets &gt;= self.max_tasks_num
         log.debug(
-            f&#x27;At task scheduling. Current greenlets: {current_greenlets} &#x27;
-            f&#x27;Max greenlets: {self.max_tasks_num}. &#x27;
+            f&quot;At task scheduling. Current greenlets: {current_greenlets} &quot;
+            f&quot;Max greenlets: {self.max_tasks_num}. &quot;
             f&#x27;{&quot;Will not schedule&quot; if not_proceed else &quot;Will schedule&quot;}.&#x27;,
         )
         if not_proceed:
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tests/exchanges/test_coinbase.py#L1193">rotkehlchen/tests/exchanges/test_coinbase.py~L1193</a></p>
<pre><code>             test_warnings.warn(
                 UserWarning(
                     f&#x27;Found unknown asset {e.identifier} with symbol {coin[&quot;id&quot;]} in Coinbase. &#x27;
-                    f&#x27;Support for it has to be added&#x27;,
+                    f&quot;Support for it has to be added&quot;,
                 )
             )
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py#L148">rotkehlchen/tests/unit/globaldb/test_globaldb_consistency.py~L148</a></p>
<pre><code>             identifiers[0]
             for cursor in (old_db_cursor, packaged_db_cursor)
             for identifiers in cursor.execute(
-                f&#x27;SELECT identifier FROM evm_tokens WHERE &#x27;
+                f&quot;SELECT identifier FROM evm_tokens WHERE &quot;
                 f&#x27;protocol IN ({&quot;,&quot;.join([&quot;?&quot;] * len(IGNORED_PROTOCOLS))}) OR &#x27;
-                f&#x27;address in (SELECT value FROM general_cache)&#x27;,
+                f&quot;address in (SELECT value FROM general_cache)&quot;,
                 list(IGNORED_PROTOCOLS),
             ).fetchall()
         }
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tests/unit/test_data_updates.py#L730">rotkehlchen/tests/unit/test_data_updates.py~L730</a></p>
<pre><code>     ):
         result = cursor.execute(  # additions are not present already
             f&quot;SELECT {&#x27;COUNT(*)&#x27; if after_upgrade is False else &#x27;local_id&#x27;} &quot;
-            &#x27;FROM location_asset_mappings WHERE location IS ? AND exchange_symbol IS ?&#x27;,
+            &quot;FROM location_asset_mappings WHERE location IS ? AND exchange_symbol IS ?&quot;,
             (
                 None
                 if addition[&quot;location&quot;] is None
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tests/utils/ethereum.py#L261">rotkehlchen/tests/utils/ethereum.py~L261</a></p>
<pre><code>         names = [str(x) for idx, x in enumerate(connect_at_start) if not connected[idx]]
         log.warning(
             f&#x27;Did not connect to nodes: {&quot;,&quot;.join(names)} due to &#x27;
-            f&#x27;timeout of {NODE_CONNECTION_TIMEOUT}. Connected to {connected}&#x27;,
+            f&quot;timeout of {NODE_CONNECTION_TIMEOUT}. Connected to {connected}&quot;,
         )
 
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tests/utils/substrate.py#L98">rotkehlchen/tests/utils/substrate.py~L98</a></p>
<pre><code>     not_connected_nodes = set(node_names) - connected_nodes
     if not_connected_nodes:
         log.info(
-            f&#x27;Substrate {chain} tests failed to connect to nodes: &#x27;
+            f&quot;Substrate {chain} tests failed to connect to nodes: &quot;
             f&#x27;{&quot;,&quot;.join([str(node) for node in not_connected_nodes])} &#x27;,
         )
 
</code></pre>
<p><a href="https://github.com/rotki/rotki/blob/e0081893a774795406bac3510ff24a68aded2ea2/rotkehlchen/tests/utils/substrate.py#L124">rotkehlchen/tests/utils/substrate.py~L124</a></p>
<pre><code>     except gevent.Timeout:
         not_connected_nodes = all_nodes - connected
         log.info(
-            f&#x27;{substrate_manager.chain} manager failed to connect to &#x27;
+            f&quot;{substrate_manager.chain} manager failed to connect to &quot;
             f&#x27;nodes: {&quot;,&quot;.join([str(node) for node in not_connected_nodes])} &#x27;
-            f&#x27;due to timeout of {NODE_CONNECTION_TIMEOUT}&#x27;,
+            f&quot;due to timeout of {NODE_CONNECTION_TIMEOUT}&quot;,
         )
</code></pre>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-27 15:36</div>
            <div class="timeline-body"><p>Uff, I might have to gate this behind preview :( I&#x27;m not sure why this isn&#x27;t local to f-string formatting only.</p>
<p>Black uses the same layout as this PR proposes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-27 15:38</div>
            <div class="timeline-body"><p>I believe this is related to <a href="https://github.com/astral-sh/ruff/issues/13237">astral-sh/ruff#13237</a> because the formatter always preserves the quotes if the expression contains a quote anywhere (even inside a string). This seems odd to me</p>
<p>@dhruvmanila could you help me understand why this is in place?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-27 15:49</div>
            <div class="timeline-body"><p>This might actually be a bug in ruff. For example, it fails to normalise the quotes for</p>
<pre><code>&quot;aaaa&quot; f&#x27;bbbbb{&#x27;c&#x27;}b&#x27; 
</code></pre>
<p>Where black handles this successfully.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-01 12:20</div>
            <div class="timeline-body"><p>I&#x27;m looking into this...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-01 12:31</div>
            <div class="timeline-body"><blockquote>
<p>This might actually be a bug in ruff. For example, it fails to normalise the quotes for</p>
</blockquote>
<p>Yeah, this seems like a bug and I think it&#x27;s the same as #13237</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-01 12:41</div>
            <div class="timeline-body"><blockquote>
<p>@dhruvmanila could you help me understand why this is in place?</p>
</blockquote>
<p>Based on the previous comment (<a href="https://github.com/astral-sh/ruff/pull/9058">astral-sh/ruff#9058</a>#discussion_r1425727018), I think it was so that the quoting effect remains same throughout the f-string but I&#x27;m realizing now that it doesn&#x27;t matter. For example, I&#x27;m guessing that my thought process was to keep this formatted as single quote for both string and f-string (<code>&#x27;foo&#x27; f&#x27;bar {&quot;x&quot;}&#x27;</code>) even though we can change the string quotes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;refactor: Remove `StringLiteralKind::InImplicitConcatenatedFString` kind&quot; to &quot;Normalize string literal quotes in implicit concatenated f-strings containing a quote character&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Normalize string literal quotes in implicit concatenated f-strings containing a quote character&quot; to &quot;Normalize implicit concatenated f-string quotes per part&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-10-07 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/preview.rs</code>:23 on 2024-10-07 14:16</div>
            <div class="timeline-body"><p>I created a new preview style for now in case we push out the f-string stabilization. We can merge this change with the f-string preview style if we decide to ship both changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-07 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_formatter/generate.py</code>:38 on 2024-10-08 04:15</div>
            <div class="timeline-body"><p>You might want to update this comment or maybe generalize it to state that formatting for these nodes are handled by another node.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2024-10-08 04:21</div>
            <div class="timeline-body"><p>Looks good, thanks for fixing this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-08 09:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-08 09:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-08 09:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:07:03 UTC
    </footer>
</body>
</html>
