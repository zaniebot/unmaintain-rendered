<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] List available members for a given type - astral-sh/ruff #18251</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] List available members for a given type</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18251">#18251</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-05-22 10:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Provide a new <code>ide_support::all_members</code> function that lists all available attributes for a given type.</p>
<p>To do:</p>
<ul>
<li>[ ] Probably respect <code>__all__</code> when accessing modules?</li>
<li>[ ] Decide if we want to keep <code>ty_extensions.all_members</code> and the new <code>&lt;str_literal&gt; in &lt;tuple&gt;</code> inference support, that is probably only useful for this purpose.</li>
<li>[ ] More tests</li>
</ul>
<h2>Test Plan</h2>
<p>New Markdown tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-05-22 10:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-22 10:59</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-05-22 11:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-22 11:33</div>
            <div class="timeline-body"><p>This might be an interesting correctness-vs-UX tradeoff. When given a <code>obj: str | None</code> object, and tab-completing on <code>obj.&lt;tab&gt;</code>, it's technically correct to only show attributes that are available on <code>str</code> <em>and</em> <code>None</code> (so basically nothing, except for a few special methods on <code>object</code> that nobody wants to call directly).</p>
<p>But the more likely scenario is probably that the developer actually wants to access an attribute on <code>str</code>, and just forgot to eliminate the <code>None</code> possibility. So it might be more useful to show attributes that are available on <code>str</code> <em>or</em> <code>None</code> here instead? Not sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @sharkdp on 2025-05-22 11:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-22 16:35</div>
            <div class="timeline-body"><p>I feel like this is a semantic/definition problem. <code>all_members()</code> is defined as:</p>
<blockquote>
<p>The <code>ty_extensions.all_members</code> function allows access to a list of accessible members/attributes on a given object.</p>
</blockquote>
<p>...and that is exactly what it should do, no special cases allowed.</p>
<p>Cases like <code>str | None</code> demand a different function that would list members that are available on <em>at least one</em> union member.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2025-05-22 16:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-05-22 18:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-22 18:26</div>
            <div class="timeline-body"><p>Well I would change that docstring obviously, <em>if</em> we would decide to deliberate return members that are not available :smile: This function is only here to support that precise use case (providing completion results for the LPS). Making it available via <code>ty_extensions.all_members</code> was just a convenient way for me to test it. I'm not sure if this should really be exposed. Or if we should maybe move it to <code>ty_extensions.internal</code> or similar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-29 12:00</div>
            <div class="timeline-body"><blockquote>
<p>Decide if we want to keep ty_extensions.all_members and the new &lt;str_literal&gt; in <tuple> inference support, that is probably only useful for this purpose.</p>
</blockquote>
<p>I think this seems like the main blocker here for getting this merged. I'd be in favor of moving it to <code>ty_extensions.internal</code>, and if a use case arises to expose it in <code>ty_extensions</code> proper, then we could consider moving it then. Are there any downsides to exposing it in <code>ty_extensions.internal</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-29 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-29 17:18</div>
            <div class="timeline-body"><p>I'm inclined to stick to what you have here for now (preferring correctness), and then loosen it up as use cases arise. Maybe, e.g., it makes sense to only loosen it in certain scenarios.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-29 19:01</div>
            <div class="timeline-body"><blockquote>
<p>Probably respect <code>__all__</code> when accessing modules?</p>
</blockquote>
<p>From what I can tell, it <em>might</em> be undesirable to respect <code>__all__</code>, which I am loosely basing on <a href="https://github.com/microsoft/vscode-python/issues/494#issuecomment-354901034">this comment</a>.</p>
<p>However, we <em>do</em> want to respect it when there's a glob-star import, but ty already does that (and I've added tests for it).</p>
<p>A relayed question here is whether we should respect <code>__dir__</code> when defined on objects. I suspect not, since the cases where it's useful seem likely to be dynamic? Although I haven't done a survey.</p>
<blockquote>
<p>the new <code>&lt;str_literal&gt; in &lt;tuple&gt;</code> inference support, that is probably only useful for this purpose</p>
</blockquote>
<p>This I am not sure about. How do we go about deciding these sorts of questions?</p>
<p>Otherwise, I think a review at this point would be helpful for me, so I'm going to take this out of draft.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @BurntSushi on 2025-05-29 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @BurntSushi on 2025-05-29 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @BurntSushi on 2025-05-29 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @BurntSushi on 2025-05-29 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @BurntSushi on 2025-05-29 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @MichaReiser removed by @BurntSushi on 2025-05-29 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-05-30 04:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-30 04:38</div>
            <div class="timeline-body"><p>For reference, Pyright / Pylance does provide all members of the union type. In the following example, <code>decode</code> is only present on <code>bytes</code> while other methods are present on both:</p>
<p><img width="521" alt="Screenshot 2025-05-30 at 10 06 56" src="https://github.com/user-attachments/assets/386be55e-90c5-4e44-aacb-e55bce7e30a3" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_vendored/ty_extensions/ty_extensions.pyi</code>:55 on 2025-05-30 04:46</div>
            <div class="timeline-body"><p>I'm sure you must've thought about this but in the future it would be useful to provide more information to the client like docstring, item kind, etc. and I'm not exactly sure how this API could help with that. I'm curious to hear your thoughts if any.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:41 on 2025-05-30 04:49</div>
            <div class="timeline-body"><p>Do we need to account for the negative types here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:239 on 2025-05-30 05:11</div>
            <div class="timeline-body"><p>Can we add a test case which populates the negative set in intersection? Like, <code>if not isinstance(...)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:314 on 2025-05-30 05:22</div>
            <div class="timeline-body"><p>I'd argue that this is actually the correct behavior here as during runtime those attributes are available on the module.</p>
<p>But, I think we would need to consider it for stub files because that would provide an accurate picture of what symbols are actually present during runtime. Consider the following sources:</p>
<p><code>module.py</code>:</p>
<pre><code class="language-py">def evaluate(x=None):
    if x is None:
        return 0
    return x
</code></pre>
<p><code>module.pyi</code>:</p>
<pre><code class="language-py">from typing import Optional

__all__ = [&quot;evaluate&quot;]

def evaluate(x: Optional[int] = None) -&gt; int: ...
</code></pre>
<p><code>play.py</code>:</p>
<pre><code class="language-py">import module

# This doesn't exists at runtime
module.Optional
# This exists
module.evaluate
</code></pre>
<p>Currently, it would include <code>Optional</code>:</p>
<pre><code class="language-py">from ty_extensions import all_members

import module

# ty: Revealed type: `tuple[Literal[&quot;Optional&quot;], Literal[&quot;__all__&quot;], ..., Literal[&quot;evaluate&quot;]]` [revealed-type]
reveal_type(all_members(module))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:138 on 2025-05-30 05:40</div>
            <div class="timeline-body"><p>Calling this function for the <code>Type::ModuleLiteral</code> might not provide an accurate picture because this uses <code>symbol_from_declarations</code> and <code>symbol_from_bindings</code> which defaults to not enforcing the re-export convention. This means it could include symbols from the module that aren't present during runtime because they're being implicitly re-exported from the stub file.</p>
<p>For a concrete example, refer to my earlier comment about <code>__all__</code> and remove the <code>__all__</code> declaration from <code>module.pyi</code>. As <code>Optional</code> is not being re-exported explicitly (via <code>from typing import Optional as Optional</code>), it should not be included in the completion.</p>
<p>One way to solve this would be to special case <code>Type::ModuleLiteral</code> and use <code>imported_symbol</code> instead of <code>symbol_from_declarations</code> or <code>symbol_from_bindings</code>, so something like this:</p>
<pre><code class="language-rs">self.extend_with_type(db, KnownClass::ModuleType.to_instance(db));

let Some(file) = literal.module(db).file() else {
    return;
};

let module_scope = global_scope(db, file);
let use_def_map = use_def_map(db, module_scope);
let symbol_table = symbol_table(db, module_scope);

for (symbol_id, _) in use_def_map.all_public_declarations() {
	let symbol_name = symbol_table.symbol(symbol_id).name();
	if imported_symbol(db, file, symbol_name, None) {}
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-05-30 05:40</div>
            <div class="timeline-body"><p>Overall, this looks good.</p>
<p>I've left a few comments stating the relevance of <code>__all__</code> and the re-export conventions for imported symbols but that all can be done in a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-05-30 05:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_vendored/ty_extensions/ty_extensions.pyi</code>:55 on 2025-05-30 05:43</div>
            <div class="timeline-body"><p>We could just return a <code>Vec&lt;Type&lt;'db&gt;&gt;</code> or <code>FxHashSet&lt;Type&lt;'db&gt;&gt;</code> here but then there's also another question of whether to actually store information like docstring on the type itself or whether to store it somewhere else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-30 05:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-30 05:43</div>
            <div class="timeline-body"><p>I suspect that this will require some iteration and/or even configurations. E.g. r-a has an option that allows you to configure if r-a should hide members to which you don't have access to due to visibility constraint. Hiding them is probably the right default when working with third-party code, but for first-party code, I often want to see all members, and I'll then change the visibility of the member.</p>
<p>So I think we should move forward here as we can change this easily in the future</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-05-30 05:51</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>the new <code>&lt;str_literal&gt; in &lt;tuple&gt;</code> inference support, that is probably only useful for this purpose</p>
</blockquote>
</blockquote>
<p>This behavior exists and is valid at runtime so I'm not sure what do you mean by &quot;only useful for this purpose&quot; (cc @sharkdp)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-30 08:19</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<blockquote>
<p>the new <code>&lt;str_literal&gt; in &lt;tuple&gt;</code> inference support, that is probably only useful for this purpose</p>
</blockquote>
</blockquote>
<p>This behavior exists and is valid at runtime so I'm not sure what do you mean by &quot;only useful for this purpose&quot; (cc @sharkdp)</p>
</blockquote>
<p>There's (hopefully) nothing wrong with the precise True/False type inference for these binary expressions. I was merely questioning if we should keep the extra code just for the purpose of writing these mdtests. For users of ty, there's probably not much value in inferring literal True/False over bool for these cases that are unlikely to occur in real world code.</p>
<p>I guess @AlexWaygood could also use a this feature for some protocol tests (instead of always listing all members)? And maybe the <strong>all</strong> tests could also use a similar technique</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6739 on 2025-05-30 12:06</div>
            <div class="timeline-body"><p>if every element in the tuple is not a string literal but <em>is</em> a type disjoint from <code>Literal[&quot;foo&quot;]</code>, I think we could infer <code>Literal[False]</code> for the <code>&quot;foo&quot; in my_tuple</code> check</p>
<pre><code class="language-suggestion">                } else if !literal.is_disjoint_from(*element) {
                    definitely_false = false;
                }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:197 on 2025-05-30 12:51</div>
            <div class="timeline-body"><p>Yeah I think this should be easy to change.</p>
<p>I can imagine wanting configuration for respecting <code>__all__</code> too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 12:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_vendored/ty_extensions/ty_extensions.pyi</code>:55 on 2025-05-30 12:58</div>
            <div class="timeline-body"><p>I 100% agree that we will want more information.</p>
<p>My rough plan here is that completions will use the <code>AllMembers</code> API directly, and I'd like to augment it to return more than just names. I don't know exactly <em>what</em> it should return yet. A <code>Type</code> seems like a good start I think? But that <code>all_members</code> as a <code>ty_extension</code> could still just return a tuple of strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-30 13:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:314 on 2025-05-30 13:07</div>
            <div class="timeline-body"><p>Nice! TIL. I turned your comment into a test and an issue: https://github.com/astral-sh/ty/issues/550</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:138 on 2025-05-30 13:14</div>
            <div class="timeline-body"><p>Hah! Well, that fixes https://github.com/astral-sh/ty/issues/550! I should take a quick scan of all comments next time. :P</p>
<p>Thank you!!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-30 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6720 on 2025-05-30 13:14</div>
            <div class="timeline-body"><p>should we bail out here if it's a pathologically long tuple type, by checking the length of the tuple first and just inferring <code>bool</code> if it's &quot;too long&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-30 13:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6720 on 2025-05-30 13:16</div>
            <div class="timeline-body"><p>Overall the feature here seems reasonable to me! I'm not sure I have an immediate use case for it in <code>Protocol</code> tests, but it's not too much extra code to support it, and precise literal inference is in line with our philosophy elsewhere.</p>
<p>It would be nice to also support other literal types if we're doing this, though -- it feels kinda inconsistent to only support literal strings, and not literal ints or literal bytes? Doesn't need to be tackled in this PR, though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 13:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:239 on 2025-05-30 13:35</div>
            <div class="timeline-body"><p>Done! I added this test:</p>
<pre><code>```py
from ty_extensions import all_members, static_assert

class A:
    on_all: int = 1
    only_on_a: str = &quot;a&quot;
    only_on_ab: str = &quot;a&quot;
    only_on_ac: str = &quot;a&quot;

class B:
    on_all: int = 2
    only_on_b: str = &quot;b&quot;
    only_on_ab: str = &quot;b&quot;
    only_on_bc: str = &quot;b&quot;

class C:
    on_all: int = 3
    only_on_c: str = &quot;c&quot;
    only_on_ac: str = &quot;c&quot;
    only_on_bc: str = &quot;c&quot;


def f(intersection: object):
    if isinstance(intersection, A):
        if isinstance(intersection, B):
            if not isinstance(intersection, C):
                reveal_type(intersection)  # revealed: A &amp; B &amp; ~C
                static_assert(&quot;on_all&quot; in all_members(intersection))
                static_assert(&quot;only_on_a&quot; in all_members(intersection))
                static_assert(&quot;only_on_b&quot; in all_members(intersection))
                static_assert(&quot;only_on_c&quot; not in all_members(intersection))
                static_assert(&quot;only_on_ab&quot; in all_members(intersection))
                static_assert(&quot;only_on_ac&quot; in all_members(intersection))
                static_assert(&quot;only_on_bc&quot; in all_members(intersection))
```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:41 on 2025-05-30 13:39</div>
            <div class="timeline-body"><p>I don't <em>think</em> so. The <a href="https://github.com/astral-sh/ruff/pull/18251#discussion_r2115944532">test case I added</a> seems to work as-is. And thinking about this, shouldn't the attributes available on the intersection type be precisely the attributes available in the union of all types in the intersection? Even if there is overlap between the attributes from the positive and negative types, if it's in a positive type, it should still be available.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 13:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 14:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6739 on 2025-05-30 14:01</div>
            <div class="timeline-body"><p>Oh nice! I added a test case for this (as well as other tests for inference of <code>&quot;foo&quot; in (&quot;bar&quot;, &quot;foo&quot;, &quot;quux&quot;)</code> in isolation of <code>all_members</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 14:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6720 on 2025-05-30 14:03</div>
            <div class="timeline-body"><p>Do y'all have a sense of what &quot;pathological long&quot; means?</p>
<p>I would maybe start at <code>2^24</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-30 14:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6720 on 2025-05-30 14:15</div>
            <div class="timeline-body"><p>Hmm... given that we were questioning whether we needed the feature in the first place, I feel like I'd start off a fair bit lower until someone complains, just to be safe? Maybe 4096? That feels like it's still safely larger than anybody would realistically need in real-world code (or that we'd ever need in our tests), and protects us from large tuples in which multiple elements are pathologically large unions (which might make the disjointness check expensive)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 14:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6720 on 2025-05-30 14:34</div>
            <div class="timeline-body"><p>That's fine with me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-30 15:17</div>
            <div class="timeline-body"><p>I'm going to bring this in, but happy to address any other feedback in a follow-up PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-30 15:17</div>
            <div class="timeline-body"><p>And thank you @sharkdp for doing the lion's share of the work here!!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2025-05-30 15:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-05-30 15:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-30 15:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-05-30 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:41 on 2025-05-30 15:39</div>
            <div class="timeline-body"><p>Ah ofcourse, you're right! Thanks for adding the test case</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/binary/in.md</code>:26 on 2025-05-30 16:12</div>
            <div class="timeline-body"><p>I'm not sure what the &quot;type error&quot; being referred to here is -- the only error I see in this section is <code>static-assert-error</code>? I would expect this header to say something more like &quot;statically unknown returns bool&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/ide_support/all_members.md</code>:7 on 2025-05-30 16:13</div>
            <div class="timeline-body"><p>this calls it a list, but it's a tuple</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-05-30 16:23</div>
            <div class="timeline-body"><p>Looks great! Just a couple minor nits, not worth a separate PR but for consideration if a future PR touches these areas</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/binary/in.md</code>:26 on 2025-05-30 16:28</div>
            <div class="timeline-body"><p>Yeah, I was calling <code>static-assert-error</code> a type error, which I guess is not quite right? Can you say more about &quot;statically unknown returns bool&quot;? ty is still returning an error here when <code>x in y</code> is both unknown and used in a static context. What about, &quot;Statically unknown results in error in static context&quot; instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-05-30 16:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/binary/in.md</code>:26 on 2025-05-30 16:34</div>
            <div class="timeline-body"><p>It seems like you're more commenting on the behavior of <code>static_assert</code> here -- &quot;static context&quot; isn't really a thing otherwise. <code>static_assert</code> is really just a testing tool for us to easily make assertions about things being statically known. It asserts that some expression evaluates to <code>Literal[True]</code> and emits <code>static-assert-error</code> otherwise. But (outside of a different mdtest specifically for that purpose) I don't think mdtests should be commenting on the behavior of <code>static_assert</code>; the focus should be on the type system behavior under test (which in this case is <code>&lt;literal-str&gt; in &lt;tuple&gt;</code>). And the relevant behavior being tested here is that we infer the <code>in</code> expression as <code>bool</code> (not as <code>Literal[True]</code> or <code>Literal[False]</code>) if we can't statically determine the result of the <code>in</code> test.</p>
<p>On second look I think what this really underscores is that <code>static_assert</code> is just the wrong tool for this particular test; it would be clearer here to simply use <code>reveal_type</code> and assert that the revealed type of the expression is <code>bool</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-30 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/binary/in.md</code>:26 on 2025-05-30 17:27</div>
            <div class="timeline-body"><p>Got it! Thank you for talking me through this. I really appreciate it!</p>
<p>I put up a new PR with these fixes: https://github.com/astral-sh/ruff/pull/18388</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:12:51 UTC
    </footer>
</body>
</html>
