<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ruff server] Open new workspace when opening a file outside of current workspace - astral-sh/ruff #22567</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ruff server] Open new workspace when opening a file outside of current workspace</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22567">#22567</a>
        opened by <a href="https://github.com/ZedThree">@ZedThree</a>
        on 2026-01-14 10:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ZedThree">@ZedThree</a></div>
            <div class="timeline-body"><p>Fixes #17944</p>
<h2>Summary</h2>
<p>Here we check if we have settings for the file we're trying to open, as a proxy for checking if it's in an open workspace or not.</p>
<p>Given this filesystem layout:</p>
<pre><code>.
├── dir_0
│   ├── ruff.toml
│   └── test_0.py
└── dir_1
    ├── ruff.toml
    └── test_1.py
</code></pre>
<p>This fixes:</p>
<ul>
<li>cwd at top-level, opening <code>dir_0/test_0.py</code></li>
<li>cwd at top-level, opening <code>dir_0/test_0.py</code>, then <code>../dir_1/test_1.py</code> in same session</li>
<li>cwd in <code>dir_0</code>, opening <code>../dir_1/test_1.py</code></li>
<li>cwd in <code>dir_0</code>, opening <code>test_0.py</code> first, then <code>../dir_1/test_1.py</code> in same session</li>
</ul>
<p>without negatively affecting non-default workspaces (such as opening the folder in VS Code or <code>lsp-mode</code> in Emacs).</p>
<hr />
<p>This doesn't work for the situation where we're opening a file in a nested directory below the default workspace, where we <em>do</em> have a config file:</p>
<pre><code>.
├── subdir
│   ├── ruff.toml
│   └── test_1.py
├── ruff.toml
└── test_0.py
</code></pre>
<p>Opening <code>test_0.py</code> first (in single file mode), and then opening <code>subdir/test_1.py</code> still uses the settings from <code>./ruff.toml</code> instead of <code>subdir/ruff.toml</code></p>
<h2>Test Plan</h2>
<p>Tested using the files described in <a href="https://github.com/astral-sh/ruff/issues/17944#issuecomment-3745670262">this comment</a></p>
<p>I noticed that ty has e2e testing of its lsp server, but this hasn't been implemented for ruff yet. I think this would need something like that to test automatically</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-14 10:09</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2026-01-14 10:09</div>
            <div class="timeline-body"><p>As mentioned <a href="https://github.com/astral-sh/ruff/issues/17944#issuecomment-3748622248">here</a>, I don't think this is the right approach. Adding a workspace folder corresponds to VS Code's &quot;Add folder&quot; functionality and has a lot of implications. We shouldn't just &quot;add&quot; arbitrary folders when a user opens a file, especially not without cleaning them up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2026-01-14 10:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-14 10:36:56 UTC
    </footer>
</body>
</html>
