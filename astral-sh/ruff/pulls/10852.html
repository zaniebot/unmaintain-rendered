<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support negated patterns in [extend-]per-file-ignores - astral-sh/ruff #10852</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support negated patterns in [extend-]per-file-ignores</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10852">#10852</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2024-04-10 01:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>Fixes #3172</p>
Summary
<p>Allow prefixing [extend-]per-file-ignores patterns with <code>!</code> to negate the pattern; listed rules / prefixes will be ignored in all files that don&#x27;t match the pattern.</p>
Test Plan
<p>Added tests for the feature.</p>
<p>Rendered docs and checked rendered output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-10 01:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:314 on 2024-04-10 01:39</div>
            <div class="timeline-body"><p>This might look a little odd, but it&#x27;s zero-allocation, unlike the version using <code>.strip_prefix()</code>.</p>
<p>Perf probably doesn&#x27;t matter much here in config-parsing; if you&#x27;d prefer the version that takes a non-mut String and uses <code>.strip_prefix()</code>, I can switch to that, though the code actually ends up longer than this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-10 01:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:606 on 2024-04-10 01:41</div>
            <div class="timeline-body"><p>I think this should be a named struct (<code>CompiledPerFileIgnore</code>? <code>PerFileIgnoreMatcher</code>?) with named fields rather than a tuple, but for ease of review I didn&#x27;t make that change here; will push it as a separate PR (unless a reviewer suggests I shouldn&#x27;t.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-10 01:52</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/lint.rs</code>:1181 on 2024-04-10 02:06</div>
            <div class="timeline-body"><p>FWIW my preference is to use the test rules instead of real rules, they&#x27;re less likely to change and it avoids mixing concerns — most tests don&#x27;t use them yet because they&#x27;re relatively new. If it&#x27;s a pain this is fine though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-04-10 02:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-10 02:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff/tests/lint.rs</code>:1181 on 2024-04-10 02:15</div>
            <div class="timeline-body"><p>Makes sense, will do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-10 03:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:314 on 2024-04-10 03:25</div>
            <div class="timeline-body"><p>I&#x27;m cool with this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:314 on 2024-04-10 03:26</div>
            <div class="timeline-body"><p>\cc @BurntSushi may have interesting things to say here :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-10 03:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-10 03:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:606 on 2024-04-10 03:26</div>
            <div class="timeline-body"><p>Agreed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-04-10 03:28</div>
            <div class="timeline-body"><p>Looks great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-10 03:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/carljm">@carljm</a> on 2024-04-10 03:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2024-04-10 03:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-10 03:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jamesmyatt">@jamesmyatt</a> reviewed on 2024-04-10 08:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jamesmyatt">@jamesmyatt</a> on <code>crates/ruff_workspace/src/options.rs</code>:918 on 2024-04-10 08:06</div>
            <div class="timeline-body"><p>Is this comment correct? Looks like it ignored F401 not D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff/tests/lint.rs</code>:1250 on 2024-04-10 11:32</div>
            <div class="timeline-body"><p>It might be worth adding some more tests where there are both regular patterns and negated patterns. And in particular, cases where a negated pattern might try to &quot;override&quot; a previous pattern. e.g.,</p>
<pre><code>&quot;*.py&quot; = [&quot;RUF&quot;]
&quot;!foo.py&quot; = [&quot;RUF&quot;]
</code></pre>
<p>Or something like that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_linter/src/settings/types.rs</code>:314 on 2024-04-10 11:35</div>
            <div class="timeline-body"><p>I think this is fine personally. I agree that saving an alloc probably doesn&#x27;t matter here (I assume these ultimately get converted to a glob matcher, and that is an enormous amount of work compared to saving an alloc) so I&#x27;d write whatever is clear. And this seems clear to me. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-04-10 11:36</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-10 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:918 on 2024-04-10 15:10</div>
            <div class="timeline-body"><p>Ah yeah, it should be <code>D</code> below (or the comment should change to <code>F401</code>) \cc @carljm</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-10 16:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff_workspace/src/options.rs</code>:918 on 2024-04-10 16:05</div>
            <div class="timeline-body"><p>Oops, thanks, will fix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-04-10 16:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ruff/tests/lint.rs</code>:1250 on 2024-04-10 16:14</div>
            <div class="timeline-body"><p>Yeah, that&#x27;s a great point, I&#x27;ll put up an update with a test for this case, and probably also more clearly document how this works.</p>
<p>(I don&#x27;t expect to change the implementation as part of this; I think the way it needs to work is how it does now: we go through each pattern, and if the pattern matches (whether that&#x27;s a positive match or a negated non-match), we add the listed rules as ignored; we never un-ignore rules based on failure to match a pattern. I think that would get too complex to understand pretty quickly, and also un-ignoring doesn&#x27;t really make sense for an option named <code>per-file-ignores</code>.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:03:16 UTC
    </footer>
</body>
</html>
