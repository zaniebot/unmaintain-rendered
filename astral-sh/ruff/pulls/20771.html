<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] infer `Self` return type annotation for class methods - astral-sh/ruff #20771</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] infer <code>Self</code> return type annotation for class methods</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20771">#20771</a>
        opened by <a href="https://github.com/Glyphack">@Glyphack</a>
        on 2025-10-08 16:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Glyphack">@Glyphack</a></div>
            <div class="timeline-body">

Summary
<p>Infer annotated <code>Self</code> return type correctly for class methods.</p>
<p>Example:</p>
<pre><code>from typing import Type, Self

class C:
    @classmethod
    def make_instance(cls: Type[Self]) -&gt; Self:
        return cls()

reveal_type(C.make_instance())  # Should be C but is Unknown
reveal_type(C.make_instance)  # revealed: bound method &lt;class &#x27;C&#x27;&gt;.make_instance() -&gt; C
</code></pre>
Test Plan


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;`Self` return type annotation is inferred as unknown for class methods&quot; to &quot;[ty] infer `Self` return type annotation for class methods&quot; by <a href="https://github.com/Glyphack">@Glyphack</a> on 2025-10-08 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-08 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-25 10:57</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-10-25 10:56:01.580589318 +0000
+++ new-output.txt	2025-10-25 10:56:33.722533918 +0000
@@ -1,3 +1,3117901 @@
+DEBUGPRINT[68]: types.rs:5987: specialization=Specialization {
+    generic_context: GenericContext {
+        variables_inner: {
+            BoundTypeVarIdentity {
+                identity: TypeVarIdentity {
+                    name: Name(&quot;T_co&quot;),
+                    definition: Some(
+                        Definition {
+                            [salsa id]: Id(1407),
+                            file: File {
+                                path: System(
+                                    &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                ),
+                                status: Exists,
+                                permissions: Some(
+                                    33188,
+                                ),
+                                revision: FileRevision(
+                                    32491904714820139829054224747,
+                                ),
+                            },
+                            file_scope: FileScopeId(
+                                0,
+                            ),
+                            place: Symbol(
+                                ScopedSymbolId(
+                                    7,
+                                ),
+                            ),
+                            kind: Assignment(
+                                AssignmentDefinitionKind {
+                                    target_kind: Single,
+                                    value: AstNodeRef {
+                                        kind: ExprCall,
+                                        range: 572..603,
+                                    },
+                                    target: AstNodeRef {
+                                        kind: ExprName,
+                                        range: 565..569,
+                                    },
+                                },
+                            ),
+                            is_reexported: true,
+                        },
+                    ),
+                    kind: Legacy,
+                },
+                binding_context: Definition(
+                    Definition {
+                        [salsa id]: Id(140e),
+                        file: File {
+                            path: System(
+                                &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                            ),
+                            status: Exists,
+                            permissions: Some(
+                                33188,
+                            ),
+                            revision: FileRevision(
+                                32491904714820139829054224747,
+                            ),
+                        },
+                        file_scope: FileScopeId(
+                            0,
+                        ),
+                        place: Symbol(
+                            ScopedSymbolId(
+                                9,
+                            ),
+                        ),
+                        kind: Class(
+                            AstNodeRef {
+                                kind: StmtClassDef,
+                                range: 657..814,
+                            },
+                        ),
+                        is_reexported: true,
+                    },
+                ),
+            }: GenericContextTypeVar {
+                bound_typevar: BoundTypeVarInstance {
+                    typevar: TypeVarInstance {
+                        identity: TypeVarIdentity {
+                            name: Name(&quot;T_co&quot;),
+                            definition: Some(
+                                Definition {
+                                    [salsa id]: Id(1407),
+                                    file: File {
+                                        path: System(
+                                            &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                        ),
+                                        status: Exists,
+                                        permissions: Some(
+                                            33188,
+                                        ),
+                                        revision: FileRevision(
+                                            32491904714820139829054224747,
+                                        ),
+                                    },
+                                    file_scope: FileScopeId(
+                                        0,
+                                    ),
+                                    place: Symbol(
+                                        ScopedSymbolId(
+                                            7,
+                                        ),
+                                    ),
+                                    kind: Assignment(
+                                        AssignmentDefinitionKind {
+                                            target_kind: Single,
+                                            value: AstNodeRef {
+                                                kind: ExprCall,
+                                                range: 572..603,
+                                            },
+                                            target: AstNodeRef {
+                                                kind: ExprName,
+                                                range: 565..569,
+                                            },
+                                        },
+                                    ),
+                                    is_reexported: true,
+                                },
+                            ),
+                            kind: Legacy,
+                        },
+                        _bound_or_constraints: None,
+                        explicit_variance: Some(
+                            Covariant,
+                        ),
+                        _default: None,
+                    },
+                    binding_context: Definition(
+                        Definition {
+                            [salsa id]: Id(140e),
+                            file: File {
+                                path: System(
+                                    &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                ),
+                                status: Exists,
+                                permissions: Some(
+                                    33188,
+                                ),
+                                revision: FileRevision(
+                                    32491904714820139829054224747,
+                                ),
+                            },
+                            file_scope: FileScopeId(
+                                0,
+                            ),
+                            place: Symbol(
+                                ScopedSymbolId(
+                                    9,
+                                ),
+                            ),
+                            kind: Class(
+                                AstNodeRef {
+                                    kind: StmtClassDef,
+                                    range: 657..814,
+                                },
+                            ),
+                            is_reexported: true,
+                        },
+                    ),
+                },
+                should_promote_literals: false,
+            },
+        },
+    },
+    types: [
+        TypeVar(
+            BoundTypeVarInstance {
+                typevar: TypeVarInstance {
+                    identity: TypeVarIdentity {
+                        name: Name(&quot;T_co&quot;),
+                        definition: Some(
+                            Definition {
+                                [salsa id]: Id(1407),
+                                file: File {
+                                    path: System(
+                                        &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                    ),
+                                    status: Exists,
+                                    permissions: Some(
+                                        33188,
+                                    ),
+                                    revision: FileRevision(
+                                        32491904714820139829054224747,
+                                    ),
+                                },
+                                file_scope: FileScopeId(
+                                    0,
+                                ),
+                                place: Symbol(
+                                    ScopedSymbolId(
+                                        7,
+                                    ),
+                                ),
+                                kind: Assignment(
+                                    AssignmentDefinitionKind {
+                                        target_kind: Single,
+                                        value: AstNodeRef {
+                                            kind: ExprCall,
+                                            range: 572..603,
+                                        },
+                                        target: AstNodeRef {
+                                            kind: ExprName,
+                                            range: 565..569,
+                                        },
+                                    },
+                                ),
+                                is_reexported: true,
+                            },
+                        ),
+                        kind: Legacy,
+                    },
+                    _bound_or_constraints: None,
+                    explicit_variance: Some(
+                        Covariant,
+                    ),
+                    _default: None,
+                },
+                binding_context: Definition(
+                    Definition {
+                        [salsa id]: Id(140e),
+                        file: File {
+                            path: System(
+                                &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                            ),
+                            status: Exists,
+                            permissions: Some(
+                                33188,
+                            ),
+                            revision: FileRevision(
+                                32491904714820139829054224747,
+                            ),
+                        },
+                        file_scope: FileScopeId(
+                            0,
+                        ),
+                        place: Symbol(
+                            ScopedSymbolId(
+                                9,
+                            ),
+                        ),
+                        kind: Class(
+                            AstNodeRef {
+                                kind: StmtClassDef,
+                                range: 657..814,
+                            },
+                        ),
+                        is_reexported: true,
+                    },
+                ),
+            },
+        ),
+    ],
+    materialization_kind: None,
+    tuple_inner: None,
+}
+DEBUGPRINT[67]: types.rs:5987: self=def __init__[T_co](self, items: Iterable[T_co@ImmutableList]) -&gt; None
+DEBUGPRINT[65]: types.rs:5986: new_specialization=FunctionLiteral(
+    FunctionType {
+        literal: FunctionLiteral {
+            last_definition: OverloadLiteral {
+                name: Name(&quot;__init__&quot;),
+                known: None,
+                body_scope: ScopeId {
+                    [salsa id]: Id(1002),
+                    file: File {
+                        path: System(
+                            &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                        ),
+                        status: Exists,
+                        permissions: Some(
+                            33188,
+                        ),
+                        revision: FileRevision(
+                            32491904714820139829054224747,
+                        ),
+                    },
+                    file_scope_id: FileScopeId(
+                        2,
+                    ),
+                },
+                decorators: FunctionDecorators(
+                    0x0,
+                ),
+                deprecated: None,
+                dataclass_transformer_params: None,
+            },
+        },
+        updated_signature: Some(
+            CallableSignature {
+                overloads: [
+                    Signature {
+                        generic_context: Some(
+                            GenericContext {
+                                variables_inner: {
+                                    BoundTypeVarIdentity {
+                                        identity: TypeVarIdentity {
+                                            name: Name(&quot;Self&quot;),
+                                            definition: Some(
+                                                Definition {
+                                                    [salsa id]: Id(140e),
+                                                    file: File {
+                                                        path: System(
+                                                            &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                        ),
+                                                        status: Exists,
+                                                        permissions: Some(
+                                                            33188,
+                                                        ),
+                                                        revision: FileRevision(
+                                                            32491904714820139829054224747,
+                                                        ),
+                                                    },
+                                                    file_scope: FileScopeId(
+                                                        0,
+                                                    ),
+                                                    place: Symbol(
+                                                        ScopedSymbolId(
+                                                            9,
+                                                        ),
+                                                    ),
+                                                    kind: Class(
+                                                        AstNodeRef {
+                                                            kind: StmtClassDef,
+                                                            range: 657..814,
+                                                        },
+                                                    ),
+                                                    is_reexported: true,
+                                                },
+                                            ),
+                                            kind: TypingSelf,
+                                        },
+                                        binding_context: Definition(
+                                            Definition {
+                                                [salsa id]: Id(140b),
+                                                file: File {
+                                                    path: System(
+                                                        &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                    ),
+                                                    status: Exists,
+                                                    permissions: Some(
+                                                        33188,
+                                                    ),
+                                                    revision: FileRevision(
+                                                        32491904714820139829054224747,
+                                                    ),
+                                                },
+                                                file_scope: FileScopeId(
+                                                    1,
+                                                ),
+                                                place: Symbol(
+                                                    ScopedSymbolId(
+                                                        2,
+                                                    ),
+                                                ),
+                                                kind: Function(
+                                                    AstNodeRef {
+                                                        kind: StmtFunctionDef,
+                                                        range: 697..759,
+                                                    },
+                                                ),
+                                                is_reexported: true,
+                                            },
+                                        ),
+                                    }: GenericContextTypeVar {
+                                        bound_typevar: BoundTypeVarInstance {
+                                            typevar: TypeVarInstance {
+                                                identity: TypeVarIdentity {
+                                                    name: Name(&quot;Self&quot;),
+                                                    definition: Some(
+                                                        Definition {
+                                                            [salsa id]: Id(140e),
+                                                            file: File {
+                                                                path: System(
+                                                                    &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                ),
+                                                                status: Exists,
+                                                                permissions: Some(
+                                                                    33188,
+                                                                ),
+                                                                revision: FileRevision(
+                                                                    32491904714820139829054224747,
+                                                                ),
+                                                            },
+                                                            file_scope: FileScopeId(
+                                                                0,
+                                                            ),
+                                                            place: Symbol(
+                                                                ScopedSymbolId(
+                                                                    9,
+                                                                ),
+                                                            ),
+                                                            kind: Class(
+                                                                AstNodeRef {
+                                                                    kind: StmtClassDef,
+                                                                    range: 657..814,
+                                                                },
+                                                            ),
+                                                            is_reexported: true,
+                                                        },
+                                                    ),
+                                                    kind: TypingSelf,
+                                                },
+                                                _bound_or_constraints: Some(
+                                                    Eager(
+                                                        UpperBound(
+                                                            NominalInstance(
+                                                                NominalInstanceType(
+                                                                    NonTuple(
+                                                                        Generic(
+                                                                            GenericAlias {
+                                                                                origin: ClassLiteral {
+                                                                                    name: Name(&quot;ImmutableList&quot;),
+                                                                                    body_scope: ScopeId {
+                                                                                        [salsa id]: Id(1001),
+                                                                                        file: File {
+                                                                                            path: System(
+                                                                                                &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                            ),
+                                                                                            status: Exists,
+                                                                                            permissions: Some(
+                                                                                                33188,
+                                                                                            ),
+                                                                                            revision: FileRevision(
+                                                                                                32491904714820139829054224747,
+                                                                                            ),
+                                                                                        },
+                                                                                        file_scope_id: FileScopeId(
+                                                                                            1,
+                                                                                        ),
+                                                                                    },
+                                                                                    known: None,
+                                                                                    deprecated: None,
+                                                                                    type_check_only: false,
+                                                                                    dataclass_params: None,
+                                                                                    dataclass_transformer_params: None,
+                                                                                },
+                                                                                specialization: Specialization {
+                                                                                    generic_context: GenericContext {
+                                                                                        variables_inner: {
+                                                                                            BoundTypeVarIdentity {
+                                                                                                identity: TypeVarIdentity {
+                                                                                                    name: Name(&quot;T_co&quot;),
+                                                                                                    definition: Some(
+                                                                                                        Definition {
+                                                                                                            [salsa id]: Id(1407),
+                                                                                                            file: File {
+                                                                                                                path: System(
+                                                                                                                    &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                                                ),
+                                                                                                                status: Exists,
+                                                                                                                permissions: Some(
+                                                                                                                    33188,
+                                                                                                                ),
+                                                                                                                revision: FileRevision(
+                                                                                                                    32491904714820139829054224747,
+                                                                                                                ),
+                                                                                                            },
+                                                                                                            file_scope: FileScopeId(
+                                                                                                                0,
+                                                                                                            ),
+                                                                                                            place: Symbol(
+                                                                                                                ScopedSymbolId(
+                                                                                                                    7,
+                                                                                                                ),
+                                                                                                            ),
+                                                                                                            kind: Assignment(
+                                                                                                                AssignmentDefinitionKind {
+                                                                                                                    target_kind: Single,
+                                                                                                                    value: AstNodeRef {
+                                                                                                                        kind: ExprCall,
+                                                                                                                        range: 572..603,
+                                                                                                                    },
+                                                                                                                    target: AstNodeRef {
+                                                                                                                        kind: ExprName,
+                                                                                                                        range: 565..569,
+                                                                                                                    },
+                                                                                                                },
+                                                                                                            ),
+                                                                                                            is_reexported: true,
+                                                                                                        },
+                                                                                                    ),
+                                                                                                    kind: Legacy,
+                                                                                                },
+                                                                                                binding_context: Definition(
+                                                                                                    Definition {
+                                                                                                        [salsa id]: Id(140e),
+                                                                                                        file: File {
+                                                                                                            path: System(
+                                                                                                                &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                                            ),
+                                                                                                            status: Exists,
+                                                                                                            permissions: Some(
+                                                                                                                33188,
+                                                                                                            ),
+                                                                                                            revision: FileRevision(
+                                                                                                                32491904714820139829054224747,
+                                                                                                            ),
+                                                                                                        },
+                                                                                                        file_scope: FileScopeId(
+                                                                                                            0,
+                                                                                                        ),
+                                                                                                        place: Symbol(
+                                                                                                            ScopedSymbolId(
+                                                                                                                9,
+                                                                                                            ),
+                                                                                                        ),
+                                                                                                        kind: Class(
+                                                                                                            AstNodeRef {
+                                                                                                                kind: StmtClassDef,
+                                                                                                                range: 657..814,
+                                                                                                            },
+                                                                                                        ),
+                                                                                                        is_reexported: true,
+                                                                                                    },
+                                                                                                ),
+                                                                                            }: GenericContextTypeVar {
+                                                                                                bound_typevar: BoundTypeVarInstance {
+                                                                                                    typevar: TypeVarInstance {
+                                                                                                        identity: TypeVarIdentity {
+                                                                                                            name: Name(&quot;T_co&quot;),
+                                                                                                            definition: Some(
+                                                                                                                Definition {
+                                                                                                                    [salsa id]: Id(1407),
+                                                                                                                    file: File {
+                                                                                                                        path: System(
+                                                                                                                            &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                                                        ),
+                                                                                                                        status: Exists,
+                                                                                                                        permissions: Some(
+                                                                                                                            33188,
+                                                                                                                        ),
+                                                                                                                        revision: FileRevision(
+                                                                                                                            32491904714820139829054224747,
+                                                                                                                        ),
+                                                                                                                    },
+                                                                                                                    file_scope: FileScopeId(
+                                                                                                                        0,
+                                                                                                                    ),
+                                                                                                                    place: Symbol(
+                                                                                                                        ScopedSymbolId(
+                                                                                                                            7,
+                                                                                                                        ),
+                                                                                                                    ),
+                                                                                                                    kind: Assignment(
+                                                                                                                        AssignmentDefinitionKind {
+                                                                                                                            target_kind: Single,
+                                                                                                                            value: AstNodeRef {
+                                                                                                                                kind: ExprCall,
+                                                                                                                                range: 572..603,
+                                                                                                                            },
+                                                                                                                            target: AstNodeRef {
+                                                                                                                                kind: ExprName,
+                                                                                                                                range: 565..569,
+                                                                                                                            },
+                                                                                                                        },
+                                                                                                                    ),
+                                                                                                                    is_reexported: true,
+                                                                                                                },
+                                                                                                            ),
+                                                                                                            kind: Legacy,
+                                                                                                        },
+                                                                                                        _bound_or_constraints: None,
+                                                                                                        explicit_variance: Some(
+                                                                                                            Covariant,
+                                                                                                        ),
+                                                                                                        _default: None,
+                                                                                                    },
+                                                                                                    binding_context: Definition(
+                                                                                                        Definition {
+                                                                                                            [salsa id]: Id(140e),
+                                                                                                            file: File {
+                                                                                                                path: System(
+                                                                                                                    &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                                                ),
+                                                                                                                status: Exists,
+                                                                                                                permissions: Some(
+                                                                                                                    33188,
+                                                                                                                ),
+                                                                                                                revision: FileRevision(
+                                                                                                                    32491904714820139829054224747,
+                                                                                                                ),
+                                                                                                            },
+                                                                                                            file_scope: FileScopeId(
+                                                                                                                0,
+                                                                                                            ),
+                                                                                                            place: Symbol(
+                                                                                                                ScopedSymbolId(
+                                                                                                                    9,
+                                                                                                                ),
+                                                                                                            ),
+                                                                                                            kind: Class(
+                                                                                                                AstNodeRef {
+                                                                                                                    kind: StmtClassDef,
+                                                                                                                    range: 657..814,
+                                                                                                                },
+                                                                                                            ),
+                                                                                                            is_reexported: true,
+                                                                                                        },
+                                                                                                    ),
+                                                                                                },
+                                                                                                should_promote_literals: false,
+                                                                                            },
+                                                                                        },
+                                                                                    },
+                                                                                    types: [
+                                                                                        TypeVar(
+                                                                                            BoundTypeVarInstance {
+                                                                                                typevar: TypeVarInstance {
+                                                                                                    identity: TypeVarIdentity {
+                                                                                                        name: Name(&quot;T_co&quot;),
+                                                                                                        definition: Some(
+                                                                                                            Definition {
+                                                                                                                [salsa id]: Id(1407),
+                                                                                                                file: File {
+                                                                                                                    path: System(
+                                                                                                                        &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                                                    ),
+                                                                                                                    status: Exists,
+                                                                                                                    permissions: Some(
+                                                                                                                        33188,
+                                                                                                                    ),
+                                                                                                                    revision: FileRevision(
+                                                                                                                        32491904714820139829054224747,
+                                                                                                                    ),
+                                                                                                                },
+                                                                                                                file_scope: FileScopeId(
+                                                                                                                    0,
+                                                                                                                ),
+                                                                                                                place: Symbol(
+                                                                                                                    ScopedSymbolId(
+                                                                                                                        7,
+                                                                                                                    ),
+                                                                                                                ),
+                                                                                                                kind: Assignment(
+                                                                                                                    AssignmentDefinitionKind {
+                                                                                                                        target_kind: Single,
+                                                                                                                        value: AstNodeRef {
+                                                                                                                            kind: ExprCall,
+                                                                                                                            range: 572..603,
+                                                                                                                        },
+                                                                                                                        target: AstNodeRef {
+                                                                                                                            kind: ExprName,
+                                                                                                                            range: 565..569,
+                                                                                                                        },
+                                                                                                                    },
+                                                                                                                ),
+                                                                                                                is_reexported: true,
+                                                                                                            },
+                                                                                                        ),
+                                                                                                        kind: Legacy,
+                                                                                                    },
+                                                                                                    _bound_or_constraints: None,
+                                                                                                    explicit_variance: Some(
+                                                                                                        Covariant,
+                                                                                                    ),
+                                                                                                    _default: None,
+                                                                                                },
+                                                                                                binding_context: Definition(
+                                                                                                    Definition {
+                                                                                                        [salsa id]: Id(140e),
+                                                                                                        file: File {
+                                                                                                            path: System(
+                                                                                                                &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                                                                            ),
+                                                                                                            status: Exists,
+                                                                                                            permissions: Some(
+                                                                                                                33188,
+                                                                                                            ),
+                                                                                                            revision: FileRevision(
+                                                                                                                32491904714820139829054224747,
+                                                                                                            ),
+                                                                                                        },
+                                                                                                        file_scope: FileScopeId(
+                                                                                                            0,
+                                                                                                        ),
+                                                                                                        place: Symbol(
+                                                                                                            ScopedSymbolId(
+                                                                                                                9,
+                                                                                                            ),
+                                                                                                        ),
+                                                                                                        kind: Class(
+                                                                                                            AstNodeRef {
+                                                                                                                kind: StmtClassDef,
+                                                                                                                range: 657..814,
+                                                                                                            },
+                                                                                                        ),
+                                                                                                        is_reexported: true,
+                                                                                                    },
+                                                                                                ),
+                                                                                            },
+                                                                                        ),
+                                                                                    ],
+                                                                                    materialization_kind: None,
+                                                                                    tuple_inner: None,
+                                                                                },
+                                                                            },
+                                                                        ),
+                                                                    ),
+                                                                ),
+                                                            ),
+                                                        ),
+                                                    ),
+                                                ),
+                                                explicit_variance: Some(
+                                                    Invariant,
+                                                ),
+                                                _default: None,
+                                            },
+                                            binding_context: Definition(
+                                                Definition {
+                                                    [salsa id]: Id(140b),
+                                                    file: File {
+                                                        path: System(
+                                                            &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                        ),
+                                                        status: Exists,
+                                                        permissions: Some(
+                                                            33188,
+                                                        ),
+                                                        revision: FileRevision(
+                                                            32491904714820139829054224747,
+                                                        ),
+                                                    },
+                                                    file_scope: FileScopeId(
+                                                        1,
+                                                    ),
+                                                    place: Symbol(
+                                                        ScopedSymbolId(
+                                                            2,
+                                                        ),
+                                                    ),
+                                                    kind: Function(
+                                                        AstNodeRef {
+                                                            kind: StmtFunctionDef,
+                                                            range: 697..759,
+                                                        },
+                                                    ),
+                                                    is_reexported: true,
+                                                },
+                                            ),
+                                        },
+                                        should_promote_literals: false,
+                                    },
+                                    BoundTypeVarIdentity {
+                                        identity: TypeVarIdentity {
+                                            name: Name(&quot;T_co&quot;),
+                                            definition: Some(
+                                                Definition {
+                                                    [salsa id]: Id(1407),
+                                                    file: File {
+                                                        path: System(
+                                                            &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                        ),
+                                                        status: Exists,
+                                                        permissions: Some(
+                                                            33188,
+                                                        ),
+                                                        revision: FileRevision(
+                                                            32491904714820139829054224747,
+                                                        ),
+                                                    },
+                                                    file_scope: FileScopeId(
+                                                        0,
+                                                    ),
+                                                    place: Symbol(
+                                                        ScopedSymbolId(
+                                                            7,
+                                                        ),
+                                                    ),
+                                                    kind: Assignment(
+                                                        AssignmentDefinitionKind {
+                                                            target_kind: Single,
+                                                            value: AstNodeRef {
+                                                                kind: ExprCall,
+                                                                range: 572..603,
+                                                            },
+                                                            target: AstNodeRef {
+                                                                kind: ExprName,
+                                                                range: 565..569,
+                                                            },
+                                                        },
+                                                    ),
+                                                    is_reexported: true,
+                                                },
+                                            ),
+                                            kind: Legacy,
+                                        },
+                                        binding_context: Definition(
+                                            Definition {
+                                                [salsa id]: Id(140e),
+                                                file: File {
+                                                    path: System(
+                                                        &quot;/home/runner/work/ruff/ruff/typing/conformance/tests/generics_variance.py&quot;,
+                                                    ),
+                                                    status: Exists,
+                                                    permissions: Some(
+                                                        33188,
+                                                    ),
+                                                    revision: FileRevision(
+                                                        32491904714820139829054224747,
+                                                    ),
+                                                },
+                                                file_scope: FileScopeId(
+                                                    0,
+                                                ),
+                                                place: Symbol(
+                                                    ScopedSymbolId(
+                                                        9,
+                                                    ),
+                                                ),
+                                                kind: Class(
+                                                    AstNodeRef {
+                                                        kind: StmtClassDef,
+                                                        range: 657..814,
+                                                    },
+                                                ),
+                                                is_reexported: true,
+                                            },
+                                        ),
+                                    }: GenericContextTypeVar {
+                                        bound_typevar: BoundTypeVarInstance {
+                                            typevar: TypeVarInstance {
+                                                identity: TypeVarIdentity {
+                                                    name: Name(&quot;T_co&quot;),
+                                       ...*[Comment body truncated]*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Glyphack">@Glyphack</a> on 2025-10-25 10:58</div>
            <div class="timeline-body"><p>I thought this was a separate issue than not supporting <code>type[Self]</code> but after playing around with it I realized that&#x27;s the root cause.
I think this playground link shows how:
https://play.ty.dev/55f8e04b-148c-4ea0-8916-e302591678bb</p>
<p>Maybe this PR I can only add the generic context when encountering <code>type[Self]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Glyphack">@Glyphack</a> on 2025-12-09 18:56</div>
            <div class="timeline-body"><p>This is fixed already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Glyphack">@Glyphack</a> on 2025-12-09 18:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:20 UTC
    </footer>
</body>
</html>
