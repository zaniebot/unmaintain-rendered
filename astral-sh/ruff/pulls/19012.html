<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Use python version and path from Python extension - astral-sh/ruff #19012</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Use python version and path from Python extension</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19012">#19012</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-06-28 16:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Uses the python version and environment selected in the Python extension as a fallback if the configuration doesn't specify a version or environment respectively.</p>
<p>Depends on https://github.com/astral-sh/ty-vscode/pull/65</p>
<p>Closes https://github.com/astral-sh/ty-vscode/issues/26</p>
<h2>Test Plan</h2>
<p>https://github.com/user-attachments/assets/b53fa5d3-cd78-41c4-a4e7-4e96a3a8c4ef</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-06-28 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-06-28 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-28 16:30</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-28 16:43</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-07-10 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-07-10 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-07-10 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-07-10 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-07-10 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-07-10 16:00</div>
            <div class="timeline-body"><p>Nice.</p>
<p>If the extension isn't able to give us the Python version but is able to give us the Python executable (for some reason), will we infer the Python version from that executable the same way as we would with a virtual environment that had been activated?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-10 16:01</div>
            <div class="timeline-body"><blockquote>
<p>If the extension isn't able to give us the Python version but is able to give us the Python executable (for some reason), will we infer the Python version from that executable the same way as we would with a virtual environment that had been activated?</p>
</blockquote>
<p>Yes, we would try to infer the version from the environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session.rs</code>:676 on 2025-07-14 04:19</div>
            <div class="timeline-body"><pre><code class="language-suggestion">		// SAFETY: This was initialized by the above `self.get` call
        self.0.get_mut().unwrap()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session.rs</code>:633 on 2025-07-14 04:20</div>
            <div class="timeline-body"><p>Assuming that this <code>url</code> is still the root path, can we document this fact?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session.rs</code>:53 on 2025-07-14 04:37</div>
            <div class="timeline-body"><p>Unrelated to this PR, it would be useful to add some documentation around the default project concept, what's the purpose of it and when it should be used.</p>
<p>As I mentioned earlier, I thought this is to be used for non-project files <em>and</em> virtual files but as you mentioned, and I think that's useful as well, that virtual files do not belong here. Currently, virtual files are being added in the default project but I'm changing that in #19264 from which I'll probably split out the part which just makes this change (store virtual files in non-default project db).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session.rs</code>:224 on 2025-07-14 04:39</div>
            <div class="timeline-body"><p>This doc doesn't seem correct? The default project is the one created for the current working directory.</p>
<p>It might be worth moving the definition of what a default project is to <code>DefaultProject</code> and just provide a reference from these methods like <code>[default project database](DefaultProject)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session.rs</code>:546 on 2025-07-14 04:44</div>
            <div class="timeline-body"><p>Unrelated to this PR, but it might be useful to document the difference between <code>register</code> and <code>initialize</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session/options.rs</code>:160 on 2025-07-14 05:05</div>
            <div class="timeline-body"><p>Why do we need both the <code>executable</code> and the <code>environment</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session/options.rs</code>:120 on 2025-07-14 05:14</div>
            <div class="timeline-body"><p>We could probably shorten these messages like &quot;Fallback Python environment as selected in the VS Code Python extension: {python}&quot; and &quot;Fallback Python version as selected in the VS Code Python extension: {version}&quot; if it's easier for us to tie the &quot;fallback&quot; keyword to these <code>fallback_</code> prefixed overrides.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_project/src/metadata/options.rs</code>:712 on 2025-07-14 05:18</div>
            <div class="timeline-body"><p>If I understand this and other unreachables correctly, we need to decide whether we want to support these overrides (rules, includes, excludes) to be set in the editor settings, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-07-14 05:19</div>
            <div class="timeline-body"><p>Looks great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-07-14 05:20</div>
            <div class="timeline-body"><p>That's a smart way of testing this out!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-07-14 05:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/session/options.rs</code>:160 on 2025-07-14 05:26</div>
            <div class="timeline-body"><p>Oh, this would probably allow us to show some kind of warning if the selected Python version in an editor is different than the configured Python version or even if there's a mismatch in the selected and used virtual environment even though the Python version might be the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-14 09:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/src/session/options.rs</code>:160 on 2025-07-14 09:25</div>
            <div class="timeline-body"><p>I mainly thought that I'm not to picky about what we should send to the server and let the server decide what information it needs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-14 09:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/metadata/options.rs</code>:712 on 2025-07-14 09:26</div>
            <div class="timeline-body"><p>Yes. Once we do, we'd need to implement the match arms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-07-14 09:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-07-14 09:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-14 09:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:47 UTC
    </footer>
</body>
</html>
