<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] C1901: compare-to-empty-string - astral-sh/ruff #3405</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] C1901: compare-to-empty-string</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3405">#3405</a>
        opened by <a href="https://github.com/AreamanM">@AreamanM</a>
        on 2023-03-08 16:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AreamanM">@AreamanM</a> on 2023-03-08 16:19</div>
            <div class="timeline-body"><p>There's a few finishing touches left to make(docs, diagnostic message,  make the logic a little cleaner) and I think this is autofixable, so if the diagnostic impl itself looks good, I'll have a go at autofix for this as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/compare_to_empty_string.rs</code>:35 on 2023-03-08 18:49</div>
            <div class="timeline-body"><p>My recommendation would be to instead <code>match</code> on the <code>value</code>, and check for <code>value.is_empty()</code> in <code>Constant::Str(value)</code>. Would that have any problems? (It could also catch cases in which the string had a prefix, like <code>u</code>, which this would miss.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-08 18:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-08 18:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/compare_to_empty_string.rs</code>:35 on 2023-03-08 18:50</div>
            <div class="timeline-body"><p>Separately: does Pylint catch <code>x == b&quot;&quot;</code>? Or <code>x == f&quot;&quot;</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AreamanM">@AreamanM</a> reviewed on 2023-03-08 21:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AreamanM">@AreamanM</a> on <code>crates/ruff/src/rules/pylint/rules/compare_to_empty_string.rs</code>:35 on 2023-03-08 21:08</div>
            <div class="timeline-body"><p>I think matching on the value definitely makes sense.</p>
<p>I just tested the latest stable release of pylint and it does not catch the b&quot;&quot; or f&quot;&quot; cases, it only shows the lint warning for <code>&quot;&quot;</code> without any specifiers. Pylint also shows the lint warning for <code>x is &quot;&quot;</code> and <code>x is not &quot;&quot;</code> which seems sensible as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-08 22:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/compare_to_empty_string.rs</code>:24 on 2023-03-08 22:59</div>
            <div class="timeline-body"><p>I'd suggest just making a new <code>enum</code> in this file specifically for this violation, to encode this assumption in the types themselves.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AreamanM">@AreamanM</a> on 2023-03-09 00:12</div>
            <div class="timeline-body"><p>I've fixed the diagnostics message and tested the code and it all seems to work, unfortunately I've got a busier week than anticipated so I'll see if I can implement autofix in another PR sometime later</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AreamanM on 2023-03-09 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-09 00:13</div>
            <div class="timeline-body"><p>No prob, thanks for this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-03-09 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Pylint C1901: compare-to-empty-string" to "[`pylint`] C1901: compare-to-empty-string" by @charliermarsh on 2023-03-09 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-09 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-09 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gil-cohen">@gil-cohen</a> on 2023-04-03 11:24</div>
            <div class="timeline-body"><p>hey, i encountered this rule just now and i think its problematic, take the following example:</p>
<pre><code>def foo(a: str | None):
    if a == '':
        print('empty string')
    if a is None:
        print('none')
    if not a:
        print('not a')
        
        
foo('')
foo(None)
</code></pre>
<p>which outputs:</p>
<pre><code>empty string
not a
none
not a
</code></pre>
<p>running <code>ruff --select PL a.py</code> will output:
<code>a.py:2:13: PLC1901 `a == ''` can be simplified to `not a` as an empty string is falsey Found 1 error.</code></p>
<p>so following this suggestion creates code that doesnt differentiate between <code>None</code> and an empty string :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-03 13:55</div>
            <div class="timeline-body"><p>Yeah this is a known limitation of this rule unfortunately -- see, e.g., https://github.com/charliermarsh/ruff/issues/3503. Pylint has the same problem. I've considered removing it for this reason.</p>
<p>You can restructure your code in various ways to ignore the lint, or disable the rule, but the rule itself can't really be improved without being made useless:</p>
<pre><code class="language-py">def foo(a: str | None):
    if a is None:
        print('none')
    if not a:
        print('empty string')
</code></pre>
<p>Or:</p>
<pre><code class="language-py">def foo(a: str | None):
    if not a:
        if isinstance(a, str):
            print('empty string')
        else:
            print('none')
</code></pre>
<p>(I'm not suggesting that these are better in any subjective sense, only that they avoid the issue.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NJindia">@NJindia</a> on 2023-04-24 15:32</div>
            <div class="timeline-body"><p>Going to echo that I think the rule is a bit of an issue. My team prefers to declare falsey values explicitly to avoid being unsure of <code>None</code> vs <code>&quot;&quot;</code> and thus have to ignore this rule, which is fine, but is the functionality to enforce explicit checks of falsey values possible? i.e. finding an error when code <em>passes</em> PLC1901 instead of when it fails.</p>
<p>Thanks</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:29:41 UTC
    </footer>
</body>
</html>
