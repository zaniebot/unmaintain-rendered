<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Improve invalid method calls for unmatched overloads - astral-sh/ruff #18122</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Improve invalid method calls for unmatched overloads</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18122">#18122</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-05-15 14:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This makes an easy tweak to allow our diagnostics for unmatched
overloads to apply to method calls. Previously, they only worked for
function calls.</p>
<p>There is at least one other case worth addressing too, namely, class
literals. e.g., <code>type()</code>. We had a diagnostic snapshot test case to
track it.</p>
<p>Closes astral-sh/ty#274</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @BurntSushi on 2025-05-15 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-15 14:18</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-15 14:20</div>
            <div class="timeline-body"><p>(If we go ahead with this, I'll create a new issue to track further improvements here.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-15 14:24</div>
            <div class="timeline-body"><p>@BurntSushi I sort of like to include the crate (or part) that gets changed in a PR but it does have the downside that the person writing the changelog has to editorialize your PR title. That's why I settled to use <code>[ty]</code> followed by what's changing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ty_python_semantic: improve invalid method calls for unmatched overloads" to "[ty] improve invalid method calls for unmatched overloads" by @BurntSushi on 2025-05-15 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-15 14:25</div>
            <div class="timeline-body"><p>Happy to make changelog editorializing easier!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] improve invalid method calls for unmatched overloads" to "[ty] Improve invalid method calls for unmatched overloads" by @BurntSushi on 2025-05-15 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 14:34</div>
            <div class="timeline-body"><p>nit: I'd sort-of prefer it if we used a custom class with an overloaded constructor method rather than using one from typeshed. Using one from typeshed has the downside that it makes updating our vendored typeshed harder, because the line numbers in the snapshots often change when typeshed changes. E.g. we couldn't just merge https://github.com/astral-sh/ruff/pull/18110 straight away -- Carl had to update a bunch of snapshots due to line numbers changing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-05-15 14:34</div>
            <div class="timeline-body"><p>LGTM! There's lots of cases this doesn't cover, but this will improve the user experience a lot, so it's definitely worth it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-05-15 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @MichaReiser on 2025-05-15 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-05-15 14:54</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-15 15:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 15:27</div>
            <div class="timeline-body"><p>Can you help with this? I've tried a bunch of things and I can't seem to re-create effect of getting a <code>Type(ClassLiteral(...))</code> that you get with <code>type()</code> or even <code>str()</code>. One thing I tried:</p>
<pre><code class="language-python">from typing import Any, overload

class Foo:
    @overload
    def __new__(self, x: str): ...
    @overload
    def __new__(self, x: int): ...
    def __new__(self, x: str | int): ...

foo = Foo(b&quot;wat&quot;)
</code></pre>
<p>Gets:</p>
<pre><code>error[no-matching-overload]: No overload of function `__new__` matches arguments
  --&gt; main.py:12:7
   |
10 |     def __new__(self, x: str | int): ...
11 |
12 | foo = Foo(b&quot;wat&quot;)
   |       ^^^^^^^^^^^
   |
info: First overload defined here
 --&gt; main.py:7:9
  |
5 | class Foo:
6 |     @overload
7 |     def __new__(self, x: str): ...
  |         ^^^^^^^^^^^^^^^^^^^^^
8 |     @overload
9 |     def __new__(self, x: int): ...
  |
info: Possible overloads for function `__new__`:
info:   (self, x: str) -&gt; Unknown
info:   (self, x: int) -&gt; Unknown
info: Overload implementation defined here
  --&gt; main.py:10:9
   |
 8 |     @overload
 9 |     def __new__(self, x: int): ...
10 |     def __new__(self, x: str | int): ...
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 |
12 | foo = Foo(b&quot;wat&quot;)
   |
info: rule `no-matching-overload` is enabled by default

Found 1 diagnostic
</code></pre>
<p>I also tried pulling from parts of <a href="https://github.com/python/typeshed/blob/337fd828e819988af2d3600283d8068bbbab7f50/stdlib/builtins.pyi#L445"><code>str</code></a> and <a href="https://github.com/python/typeshed/blob/337fd828e819988af2d3600283d8068bbbab7f50/stdlib/builtins.pyi#L174"><code>type</code></a> from typeshed, but no such luck.</p>
<p>Moreover, it seems that <em>all</em> instances of <code>no-matching-overload</code> for a <code>ClassLiteral</code> in mdtest as it stands today are using either <code>type</code> or <code>str</code> builtins.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-15 15:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 15:31</div>
            <div class="timeline-body"><p>Ah! I totally forgot that we currently heavily special-case <code>str</code> and <code>type</code> currently. In that case, it's fine to just keep what you have for now -- sorry!!</p>
<p>We assign these overloads manually to the class for <code>str</code> and <code>type</code> -- I can't remember exactly why, but it probably makes up for some missing features elsewhere: https://github.com/astral-sh/ruff/blob/c066bf0127482fc18c1337b50502cc63bdf805b5/crates/ty_python_semantic/src/types.rs#L3865-L3908</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-15 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 15:38</div>
            <div class="timeline-body"><p>Ah okay phew. I thought I was losing my mind. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 15:38</div>
            <div class="timeline-body"><p>(My next step was to trace through ty and figure out where and how <code>type()</code> was getting typed as <code>Type(ClassLiteral(..))</code>. So I guess I probably would have eventually found that. Thank you for pointing it out!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-15 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2025-05-15 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-05-15 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-15 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-15 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 15:39</div>
            <div class="timeline-body"><blockquote>
<p>Ah okay phew. I thought I was losing my mind. :-)</p>
</blockquote>
<p>Sorry again!! Another argument for keeping special-casing to a minimum: preserving @BurntSushi's sanity ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-15 15:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/resources/mdtest/diagnostics/no_matching_overload.md</code>:306 on 2025-05-15 15:46</div>
            <div class="timeline-body"><p>Yes sanity is important! lol</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:12:36 UTC
    </footer>
</body>
</html>
