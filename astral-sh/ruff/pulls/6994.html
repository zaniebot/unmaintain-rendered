<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`perflint`] Expand `PERF401` and `PERF402` with type checks - astral-sh/ruff #6994</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>perflint</code>] Expand <code>PERF401</code> and <code>PERF402</code> with type checks</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6994">#6994</a>
        opened by <a href="https://github.com/qdegraaf">@qdegraaf</a>
        on 2023-08-29 19:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-08-29 19:43</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Attempt at a small improvement to two <code>perflint</code> rules using the new type inference capabilities to only flag <code>PERF401</code> and <code>PERF402</code> for values we infer to be lists. This makes the rule more conservative, as it only flags values that we <em>know</em> to be lists, but it's overall a desirable change, as it favors false negatives over false positives for a &quot;nice-to-have&quot; rule.</p>
<p>Closes https://github.com/astral-sh/ruff/issues/6995.</p>
<h2>Test Plan</h2>
<p>Add non-list value cases and make sure all old cases are still caught.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-29 21:29</div>
            <div class="timeline-body"><p>I think the <code>id</code> variable is just being overridden unintentionally. I'll push an update.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-29 21:31</div>
            <div class="timeline-body"><p>I think this is a desirable change. These rules are nice-to-haves and so I'd really like to avoid false negatives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-08-29 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2023-08-29 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-29 21:40</div>
            <div class="timeline-body"><p>I wonder why the ecosystem check isn't running on this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-29 21:44</div>
            <div class="timeline-body"><p>Oh, it's running now -- nevermind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-29 21:50</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+0, -19, 0 error(s))</p>
<details><summary>airflow (+0, -16)</summary>
<p>

<pre>
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/cli/commands/standalone_command.py#L300'>airflow/cli/commands/standalone_command.py:300:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/decorators/base.py#L241'>airflow/decorators/base.py:241:17:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/decorators/base.py#L260'>airflow/decorators/base.py:260:21:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/jobs/triggerer_job_runner.py#L691'>airflow/jobs/triggerer_job_runner.py:691:13:</a> PERF402 Use `list` or `list.copy` to create a copy of a list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/kubernetes/pre_7_4_0_compatibility/pod_generator_deprecated.py#L180'>airflow/kubernetes/pre_7_4_0_compatibility/pod_generator_deprecated.py:180:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/kubernetes/pre_7_4_0_compatibility/pod_generator_deprecated.py#L213'>airflow/kubernetes/pre_7_4_0_compatibility/pod_generator_deprecated.py:213:17:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/providers/cncf/kubernetes/pod_generator_deprecated.py#L181'>airflow/providers/cncf/kubernetes/pod_generator_deprecated.py:181:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/providers/cncf/kubernetes/pod_generator_deprecated.py#L214'>airflow/providers/cncf/kubernetes/pod_generator_deprecated.py:214:17:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/airflow/www/extensions/init_appbuilder.py#L658'>airflow/www/extensions/init_appbuilder.py:658:25:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/docs/conf.py#L263'>docs/conf.py:263:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/docs/conf.py#L267'>docs/conf.py:267:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/tests/providers/amazon/aws/transfers/test_dynamodb_to_s3.py#L57'>tests/providers/amazon/aws/transfers/test_dynamodb_to_s3.py:57:17:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/tests/providers/cncf/kubernetes/utils/test_pod_manager.py#L500'>tests/providers/cncf/kubernetes/utils/test_pod_manager.py:500:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/tests/providers/cncf/kubernetes/utils/test_pod_manager.py#L502'>tests/providers/cncf/kubernetes/utils/test_pod_manager.py:502:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/tests/providers/cncf/kubernetes/utils/test_pod_manager.py#L735'>tests/providers/cncf/kubernetes/utils/test_pod_manager.py:735:13:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/apache/airflow/blob/f9e92223c29141733d64c91e6566f97fc4bcfc7a/tests/providers/cncf/kubernetes/utils/test_pod_manager.py#L737'>tests/providers/cncf/kubernetes/utils/test_pod_manager.py:737:13:</a> PERF401 Use a list comprehension to create a transformed list
</pre>

</p>
</details>
<details><summary>bokeh (+0, -3)</summary>
<p>

<pre>
- <a href='https://github.com/bokeh/bokeh/blob/b93b1f75387d41fb39e19e9f77849caa010c7218/src/bokeh/layouts.py#L486'>src/bokeh/layouts.py:486:25:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/bokeh/bokeh/blob/b93b1f75387d41fb39e19e9f77849caa010c7218/src/bokeh/sphinxext/bokeh_plot.py#L272'>src/bokeh/sphinxext/bokeh_plot.py:272:21:</a> PERF401 Use a list comprehension to create a transformed list
- <a href='https://github.com/bokeh/bokeh/blob/b93b1f75387d41fb39e19e9f77849caa010c7218/tests/unit/bokeh/protocol/messages/test_patch_doc.py#L103'>tests/unit/bokeh/protocol/messages/test_patch_doc.py:103:13:</a> PERF401 Use a list comprehension to create a transformed list
</pre>

</p>
</details>
Rules changed: 2

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PERF401 | 18 | 0 | 18 |
| PERF402 | 1 | 0 | 1 |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-08-29 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-29 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-07 07:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:46:15 UTC
    </footer>
</body>
</html>
