<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruff_python_formatter: add docstring-code-line-width internal setting - astral-sh/ruff #9055</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ruff_python_formatter: add docstring-code-line-width internal setting</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9055">#9055</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2023-12-08 18:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This does the light plumbing necessary to add a new internal option that permits setting the line width of code examples in docstrings. The plan is to add the corresponding user facing knob in #8854.</p>
<p>Note that this effectively removes the <code>same-as-global</code> configuration style discussed <a href="https://github.com/astral-sh/ruff/issues/8855#issuecomment-1847230440">in this comment</a>. It replaces it with the <code>{integer}</code> configuration style only.</p>
<p>There are a lot of commits here, but they are each tiny to make review easier because of the changes to snapshots.</p>
<h2>Test Plan</h2>
<p>I added a new docstring test configuration that sets <code>docstring-code-line-width = 60</code> and examined the differences.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @BurntSushi on 2023-12-08 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @BurntSushi on 2023-12-08 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @BurntSushi on 2023-12-08 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @BurntSushi on 2023-12-08 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @BurntSushi on 2023-12-08 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-12-08 19:14</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/src/options.rs</code>:56 on 2023-12-08 22:29</div>
            <div class="timeline-body"><p>I'd expect this to default to the formatter's line-length, but I <em>think</em> that happens at a level above, when we create the <code>Settings</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-08 22:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-12-08 22:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-12-10 23:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/options.rs</code>:56 on 2023-12-10 23:38</div>
            <div class="timeline-body"><p>Good point. I don't know if serde supports defaults that depend on another field's value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-12-10 23:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2023-12-11 13:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_python_formatter/src/options.rs</code>:56 on 2023-12-11 13:20</div>
            <div class="timeline-body"><p>I specifically didn't attempt this, because this would imply a <code>same-as-global</code> setting which is distinct from a specific fixed integer. I think that if we do want that mode, then we ought to make it an explicit setting so that users can specifically opt into it in other contexts. So for example, instead of using <code>LineWidth</code> here, I'd do:</p>
<pre><code class="language-rust">enum DocstringCodeLineWidth {
    SameAsGlobal,
    Fixed(LineWidth),
}
</code></pre>
<p>And then hopefully we'll add <code>Dynamic</code> (pending my experimentation today).</p>
<p>But we can also hash this out a bit more when I add the user-facing version of this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2023-12-11 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2023-12-11 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-11 13:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:01:46 UTC
    </footer>
</body>
</html>
