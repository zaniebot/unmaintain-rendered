<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't process files with CR line endings - astral-sh/ruff #1698</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't process files with CR line endings</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1698">#1698</a>
        opened by <a href="https://github.com/squiddy">@squiddy</a>
        on 2023-01-06 20:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a></div>
            <div class="timeline-body"><p>Returning an error in <code>check_path</code> is currently mapped to an IOError, which doesn't seem fitting. Open to suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/linter.rs</code>:77 on 2023-01-06 23:55</div>
            <div class="timeline-body"><p>Is there any way to do this lazily? Like, detect when it would become a problem, and fail in that case? (Not asking you to make that change.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-06 23:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-06 23:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/linter.rs</code>:77 on 2023-01-06 23:55</div>
            <div class="timeline-body"><p>Actually, I guess it's fine, this should be quite cheap...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-07 00:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/source_code_style.rs</code>:184 on 2023-01-07 00:19</div>
            <div class="timeline-body"><p>Would it be faster to check for the first <code>\n</code>, then check if it's preceded by a <code>\r</code>, and only check for a <code>\r</code> if we don't find <em>any</em> <code>\n</code>?</p>
<p>As-is, we have to traverse the entire string for the <code>\n</code> case, to learn that there's no <code>\r</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-07 00:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/source_code_style.rs</code>:178 on 2023-01-07 00:37</div>
            <div class="timeline-body"><p>Oh, in Cargo.toml, we should also disable the <code>cr_lines</code> feature on Ropey, I think? Or, actually, we could keep it on and consider using <code>Ropey</code> to find the first line ending quickly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a> reviewed on 2023-01-07 16:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/squiddy">@squiddy</a> on <code>src/source_code_style.rs</code>:178 on 2023-01-07 16:08</div>
            <div class="timeline-body"><p>I completely missed that <code>ropey</code> seems to have proper support for <code>CR</code> line endings. Perhaps we can support them after all.. I'll check that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-07 16:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/source_code_style.rs</code>:178 on 2023-01-07 16:24</div>
            <div class="timeline-body"><p>But I think things like <code>.lines()</code> still won't work, right? Per your original note in the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-29 18:30</div>
            <div class="timeline-body"><p>Closing for now, but we should re-visit at some point.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-29 18:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:25 UTC
    </footer>
</body>
</html>
