5940-port-over-some-fixes-from-3747.md