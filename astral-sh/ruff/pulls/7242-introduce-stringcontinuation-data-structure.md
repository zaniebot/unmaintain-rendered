```yaml
number: 7242
title: "Introduce `StringContinuation` data structure"
type: pull_request
state: closed
author: MichaReiser
labels: []
assignees: []
draft: true
base: main
head: create-string-continuation
created_at: 2023-09-08T10:43:53Z
updated_at: 2024-01-16T10:04:00Z
url: https://github.com/astral-sh/ruff/pull/7242
synced_at: 2026-01-10T22:57:09Z
```

# Introduce `StringContinuation` data structure

---

_Pull request opened by @MichaReiser on 2023-09-08 10:43_


## Summary

Similar to the preceding PR. It extracts a `StringContinuation` data structure that allows inspection. 
Being able to access the continuation parts quickly is important to implement Black's string preview style where we need create three different variations for each implicit concatenated string.

## Test Plan

`cargo test`

<!-- How was it tested? -->


---

_Comment by @MichaReiser on 2023-09-08 10:44_

Current dependencies on/for this PR:
* main
  * **PR #7145** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7145" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7193** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7193" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #7215** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7215" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #7217** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7217" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
          * **PR #7219** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7219" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
            * **PR #7242** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7242" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  üëà
              * **PR #7567** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7567" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7242?utm_source=stack-comment).

---

_Converted to draft by @MichaReiser on 2023-09-08 10:44_

---

_Comment by @codspeed-hq[bot] on 2023-09-21 10:48_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/create-string-continuation)

### Merging #7242 will **degrade performances by 5.44%**

<sub>Comparing <code>create-string-continuation</code> (272306b) with <code>main</code> (0a07a2c)</sub>



### Summary

`‚ö° 6` improvements
`‚ùå 5` regressions
`‚úÖ 14` untouched benchmarks



> :warning: _Please fix the performance issues or [acknowledge them on CodSpeed](https://codspeed.io/astral-sh/ruff/branches/create-string-continuation)._

### Benchmarks breakdown

|     | Benchmark | `main` | `create-string-continuation` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ö° | `formatter[pydantic/types.py]` | 19.9 ms | 19.1 ms | +4.27% |
| ‚ùå | `linter/all-rules[numpy/globals.py]` | 4 ms | 4.1 ms | -2.77% |
| ‚ö° | `formatter[large/dataset.py]` | 57.7 ms | 52.3 ms | +10.29% |
| ‚ùå | `linter/all-rules[unicode/pypinyin.py]` | 15.4 ms | 15.7 ms | -2.22% |
| ‚ö° | `formatter[unicode/pypinyin.py]` | 3.6 ms | 3.4 ms | +7.85% |
| ‚ö° | `formatter[numpy/ctypeslib.py]` | 10.9 ms | 9.9 ms | +9.29% |
| ‚ùå | `linter/all-rules[pydantic/types.py]` | 70 ms | 72.9 ms | -4.04% |
| ‚ö° | `lexer[large/dataset.py]` | 10.1 ms | 9.8 ms | +3.25% |
| ‚ùå | `linter/all-rules[numpy/ctypeslib.py]` | 33.2 ms | 34.2 ms | -3.01% |
| ‚ö° | `formatter[numpy/globals.py]` | 1.1 ms | 1.1 ms | +2.35% |
| ‚ùå | `linter/all-rules[large/dataset.py]` | 155.1 ms | 164 ms | -5.44% |


---

_Closed by @MichaReiser on 2023-10-27 15:13_

---

_Branch deleted on 2024-01-16 10:04_

---
