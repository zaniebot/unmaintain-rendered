<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add test cases for `try` statement - astral-sh/ruff #10815</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add test cases for <code>try</code> statement</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10815">#10815</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-04-07 15:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds test cases for the <code>try</code> statement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by @dhruvmanila on 2024-04-07 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @dhruvmanila on 2024-04-07 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2024-04-07 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-07 16:05</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:1314 on 2024-04-08 08:40</div>
            <div class="timeline-body"><p>Nit: As a user it wouldn't be clear what symbol refers to. The documentation refers to the part after <code>as</code> as the target, but I think that might still be hard to understand. Maybe just use <code>Expected name after as</code> or <code>Expected variable name after </code>as`?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/tests/snapshots/invalid_syntax@except_stmt_missing_exception.py.snap</code>:121 on 2024-04-08 08:42</div>
            <div class="timeline-body"><p>Nit: What happens if you have <code>except as:</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/tests/snapshots/invalid_syntax@try_stmt_invalid_order.py.snap</code>:48 on 2024-04-08 08:43</div>
            <div class="timeline-body"><p>Do I understand this correctly that the <code>else</code> gets dropped as part of the statement error recovery code?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/tests/snapshots/invalid_syntax@try_stmt_missing_except_finally.py.snap</code>:47 on 2024-04-08 08:44</div>
            <div class="timeline-body"><p>I don't think this is the intended error message. Any chance that the second <code>try:</code> clause is unintentional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-08 08:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 09:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/tests/snapshots/invalid_syntax@except_stmt_missing_exception.py.snap</code>:121 on 2024-04-09 09:07</div>
            <div class="timeline-body"><p>Two error messages as expected. I'll add this case, thanks!</p>
<pre><code>Errors:
-------
Syntax Error: Expected one or more exception types at byte range 21..23
  |
1 | try:
2 |     pass
3 | except as:
  |        ^^ Syntax Error: Expected one or more exception types
4 |     pass
  |


Syntax Error: Expected name after `as` at byte range 23..24
  |
1 | try:
2 |     pass
3 | except as:
  |          ^ Syntax Error: Expected name after `as`
4 |     pass
  |

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 09:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/tests/snapshots/invalid_syntax@try_stmt_invalid_order.py.snap</code>:48 on 2024-04-09 09:11</div>
            <div class="timeline-body"><p>Hmm, it won't be dropped but there will be additional error as then it's outside the <code>try</code> statement. So, the statements in the <code>else</code> body will be parsed as if it's outside the <code>try</code> statement. I think it should be trivial to recover from this by parsing it again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 09:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/tests/snapshots/invalid_syntax@try_stmt_missing_except_finally.py.snap</code>:47 on 2024-04-09 09:12</div>
            <div class="timeline-body"><p>Yeah, that was unintentional. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-04-09 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-04-09 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-09 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-09 13:51</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/dhruv/try-stmt">CodSpeed Performance Report</a></h2>
<h3>Merging #10815 will <strong>degrade performances by 7.01%</strong></h3>
<p><sub>Comparing <code>dhruv/try-stmt</code> (c7429b8) with <code>dhruv/parser</code> (22d70b0)</sub></p>
<h3>Summary</h3>
<p><code>⚡ 1</code> improvements
<code>❌ 1</code> regressions
<code>✅ 28</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/dhruv/try-stmt">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>dhruv/parser</code> | <code>dhruv/try-stmt</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>parser[large/dataset.py]</code> | 26.5 ms | 28.5 ms | -7.01% |
| ⚡ | <code>parser[unicode/pypinyin.py]</code> | 1.7 ms | 1.6 ms | +5.63% |</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:03:36 UTC
    </footer>
</body>
</html>
