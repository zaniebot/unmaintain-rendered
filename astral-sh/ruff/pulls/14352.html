<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use CWD to resolve settings from `ruff.configuration` - astral-sh/ruff #14352</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use CWD to resolve settings from <code>ruff.configuration</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14352">#14352</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-11-15 05:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>This PR fixes a bug in the Ruff language server where the editor-specified configuration was resolved relative to the configuration directory and not the current working directory.</p>
<p>The existing behavior is confusing given that this config file is specified by the user and is not <em>discovered</em> by Ruff itself. The behavior of resolving this configuration file should be similar to that of the <code>--config</code> flag on the command-line which uses the current working directory: https://github.com/astral-sh/ruff/blob/3210f1a23bfe42c5d58c609b602861062eeed2ad/crates/ruff/src/resolve.rs#L34-L48</p>
<p>This creates problems where certain configuration options doesn&#x27;t work because the paths resolved in that case are relative to the configuration directory and not the current working directory in which the editor is expected to be in. For example, the <code>lint.per-file-ignores</code> doesn&#x27;t work as mentioned in the linked issue along with <code>exclude</code>, <code>extend-exclude</code>, etc.</p>
<p>fixes: #14282</p>
Test Plan
<p>Using the following directory tree structure:</p>
<pre><code>.
├── .config
│   └── ruff.toml
└── src
    └── migrations
        └── versions
            └── a.py
</code></pre>
<p>where, the <code>ruff.toml</code> is:</p>
<pre><code># 1. Comment this out to test `per-file-ignores`
extend-exclude = [&quot;**/versions/*.py&quot;]

[lint]
select = [&quot;D&quot;]

# 2. Comment this out to test `extend-exclude`
[lint.per-file-ignores]
&quot;**/versions/*.py&quot; = [&quot;D&quot;]

# 3. Comment both `per-file-ignores` and `extend-exclude` to test selection works
</code></pre>
<p>And, the content of <code>a.py</code>:</p>
<pre><code>&quot;&quot;&quot;Test&quot;&quot;&quot;
</code></pre>
<p>And, the VS Code settings:</p>
<pre><code>{
  &quot;ruff.nativeServer&quot;: &quot;on&quot;,
  &quot;ruff.path&quot;: [&quot;/Users/dhruv/work/astral/ruff/target/debug/ruff&quot;],
  // For single-file mode where current working directory is `/`
  // &quot;ruff.configuration&quot;: &quot;/tmp/ruff-repro/.config/ruff.toml&quot;,
  // When a workspace is opened containing this path
  &quot;ruff.configuration&quot;: &quot;./.config/ruff.toml&quot;,
  &quot;ruff.trace.server&quot;: &quot;messages&quot;,
  &quot;ruff.logLevel&quot;: &quot;trace&quot;
}
</code></pre>
<p>I also tested out just opening the file in single-file mode where the current working directory is <code>/</code> in VS Code. Here, the <code>ruff.configuration</code> needs to be updated to use absolute path as shown in the above VS Code settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-15 05:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-15 05:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-15 05:26</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-15 06:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-11-15 06:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-15 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-15 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-15 08:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:08:29 UTC
    </footer>
</body>
</html>
