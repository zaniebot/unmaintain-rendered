<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-bugbear`] `itertools.batched()` without explicit `strict` (`B911`) - astral-sh/ruff #14408</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-bugbear</code>] <code>itertools.batched()</code> without explicit <code>strict</code> (<code>B911</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14408">#14408</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2024-11-18 00:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Resolves #14387.</p>
<h2>Test Plan</h2>
<p><code>cargo nextest run</code> and <code>cargo insta test</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-18 00:47</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2024-11-18 06:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2024-11-18 06:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-18 07:26</div>
            <div class="timeline-body"><p>I think I prefer to wait with adding this rule and see if it gets accepted upstream to avoid having to re-code in a few days/weeks. See https://github.com/PyCQA/flake8-bugbear/issues/498</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-11-19 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @InSyncWithFoo on 2024-11-20 03:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-20 03:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch restored on 2024-11-20 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @InSyncWithFoo on 2024-11-20 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2024-12-08 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`ruff`] `itertools.batched()` without explicit `strict` (`RUF054`)" to "[`flake8-bugbear`] `itertools.batched()` without explicit `strict` (`B911`)" by @InSyncWithFoo on 2024-12-08 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 08:40</div>
            <div class="timeline-body"><p>I think we should not provide a fix if the call already has a <code>kwarg</code> argument or mark it as a manual fix. I'm even leaning towards not raising the diagnostic in that case because we can't know if <code>strict</code> is set or not. What do you think? (@AlexWaygood ?)</p>
<p>The fix should be unsafe nonetheless because adding <code>strict</code> changes the runtime semantic and the right fix might be to add <code>strict=False</code> after all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:67 on 2024-12-09 08:42</div>
            <div class="timeline-body"><p>I understand that this is a deviation from the upstream rule. We should document it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:63 on 2024-12-09 08:43</div>
            <div class="timeline-body"><p>It seems we need to be careful around starred expressions</p>
<pre><code class="language-suggestion">    let first_positional = arguments.find_positional(0);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-12-09 08:45</div>
            <div class="timeline-body"><p>This is great.</p>
<p>We have to decide on the fix safety and polish the documentation a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2024-12-09 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-09 15:54</div>
            <div class="timeline-body"><p>@AlexWaygood requesting review from you regarding the open question around fix safety (and whether we should raise a diagnostic). I already reviewed the code changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-09 16:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 16:49</div>
            <div class="timeline-body"><p>I strongly agree that we should always mark the fix as unsafe; <code>strict=True</code> might not be appropriate for all applications (https://github.com/PyCQA/flake8-bugbear/issues/498#issuecomment-2481323632).</p>
<p>I also agree that we shouldn't offer a fix (or it should be display-only) if there's <code>kwargs</code> since there's this risk:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; kwargs = {&quot;strict&quot;: True}
&gt;&gt;&gt; import itertools
&gt;&gt;&gt; itertools.batched([], strict=True, **kwargs)
Traceback (most recent call last):
  File &quot;&lt;python-input-2&gt;&quot;, line 1, in &lt;module&gt;
    itertools.batched([], strict=True, **kwargs)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: itertools.batched() got multiple values for keyword argument 'strict'
</code></pre>
<p>However, I'd lean towards still emitting the diagnostic if there's kwargs. In most cases, they can probably explicitly pass in <code>strict=True</code> or <code>strict=False</code>. In the very rare situations where they really need dynamic keyword arguments, I think they can just <code># noqa</code> the rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2024-12-09 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2024-12-09 17:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 17:10</div>
            <div class="timeline-body"><p>Just to be clear, the fix should be marked as unsafe even if it doesn't change runtime behaviour? Currently, it just adds <code>strict=False</code>, but <code>False</code> is already the default value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-09 17:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 17:14</div>
            <div class="timeline-body"><p>Oh, the fix just adds <code>strict=False</code>? I'm not sure that's a very useful autofix TBH. Maybe we should just not offer a fix for this rule? The point of the rule is that you should think about your <code>itertools.batched()</code> calls and be explicit about whether or not you want the strict behaviour. But you can only tell which is appropriate by doing a manual audit. If Ruff auto-adds <code>strict=False</code> everywhere, you haven't really gained anything from the rule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 17:15</div>
            <div class="timeline-body"><p>(Sorry for not checking what the fix actually did...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-09 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> reviewed on 2024-12-09 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 17:18</div>
            <div class="timeline-body"><p>I think I copied this from <a href="https://docs.astral.sh/ruff/rules/zip-without-explicit-strict/#fix-safety"><code>B905</code></a>. Its fix is safe by default and only unsafe when <code>**kwargs</code> is present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-12-09 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-09 17:19</div>
            <div class="timeline-body"><p>I don't really find <code>B905</code>'s fix particularly useful either, so I'm not sure it's a great precedent to follow ðŸ˜† but interested to hear @MichaReiser's thoughts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-10 08:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_bugbear/rules/batched_without_explicit_strict.rs</code>:33 on 2024-12-10 08:33</div>
            <div class="timeline-body"><p>I agree that the fix has limited use here and it somewhat defeats the purpose of: Think about what you want.</p>
<p>Because of that, I went ahead and removed it. It simplifies the implementation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-12-10 08:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-12-10 08:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-11 13:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:47 UTC
    </footer>
</body>
</html>
