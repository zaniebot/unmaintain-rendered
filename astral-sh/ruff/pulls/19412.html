<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] More fully support 'if typing.TYPE_CHECKING' - astral-sh/ruff #19412</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] More fully support &#x27;if typing.TYPE_CHECKING&#x27;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19412">#19412</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-07-17 20:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body">Summary
<p>#19372 added support for detecting whether a function is defined inside an <code>if TYPE_CHECKING</code> block, and if so, allowing it to be a &quot;stub&quot; function (empty body, even with non-None return type).</p>
<p>This PR improves that support by also supporting it for <code>if typing.TYPE_CHECKING</code> as well as <code>if TYPE_CHECKING</code>. In order to do so, it changes our basic approach to <code>TYPE_CHECKING</code> support. Rather than inferring a type of <code>Literal[True]</code> for all symbols named <code>TYPE_CHECKING</code>, instead we specially handle <code>if</code> conditions with purely syntactic matching (on any <code>Name</code> matching <code>TYPE_CHECKING</code> or any attribute expression with attribute <code>TYPE_CHECKING</code>). This means we no longer recognize aliasing of <code>TYPE_CHECKING</code> (e.g. <code>from typing import TYPE_CHECKING as TC</code>), and we&#x27;ll recognize <code>foo.TYPE_CHECKING</code> no matter what <code>foo</code> is. (In both cases this matches the behavior of all other existing type checkers.) Arguably it&#x27;s better to not support aliasing <code>TYPE_CHECKING</code>, given its unusual behavior of matching any variable named <code>TYPE_CHECKING</code>.</p>
<p>We currently don&#x27;t handle conditions like <code>if TYPE_CHECKING or get_bool()</code> (other type checkers do). If this proves to be relevant, we can add it.</p>
<p>I think it would also be possible to remove the extra boolean flag on scopes and in SemanticIndexBuilder, and rely instead on reachability constraints (which we already track on scopes) for detecting when a scope is defined inside <code>if TYPE_CHECKING</code>. This would require adding new terminal reachability constraints for <code>TYPE_CHECKING</code> and probably <code>NOT_TYPE_CHECKING</code> as well, which would behave like <code>ALWAYS_TRUE</code> and <code>ALWAYS_FALSE</code>, but would also allow detecting that a reachability constraint is dependent on <code>TYPE_CHECKING</code>. I didn&#x27;t choose to do that here, but it&#x27;s a possible future improvement.</p>
<p>Another alternative to this entire PR would be to instead double down on our handling of <code>TYPE_CHECKING</code> in type inference rather than syntactically, add a new <code>SpecialForm</code> for &quot;the type of <code>TYPE_CHECKING</code>&quot;, and then we could evaluate reachability constraints under &quot;consider <code>TYPE_CHECKING</code> False&quot; conditions in order to detect code that is only reachable due to <code>TYPE_CHECKING</code>.</p>
Test Plan
<p>mdtests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/carljm">@carljm</a> on 2025-07-17 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/carljm">@carljm</a> on 2025-07-17 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/carljm">@carljm</a> on 2025-07-17 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/carljm">@carljm</a> on 2025-07-17 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-17 20:36</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>bidict (https://github.com/jab/bidict)
- error[invalid-return-type] bidict/_bidict.py:41:30: Function always implicitly returns `None`, which is not assignable to return type `MutableBidict[VT, KT]`
- error[invalid-return-type] bidict/_bidict.py:44:26: Function always implicitly returns `None`, which is not assignable to return type `MutableBidict[VT, KT]`
- error[invalid-return-type] bidict/_bidict.py:185:30: Function always implicitly returns `None`, which is not assignable to return type `bidict[VT, KT]`
- error[invalid-return-type] bidict/_bidict.py:188:26: Function always implicitly returns `None`, which is not assignable to return type `bidict[VT, KT]`
- error[invalid-return-type] bidict/_frozen.py:34:30: Function always implicitly returns `None`, which is not assignable to return type `frozenbidict[VT, KT]`
- error[invalid-return-type] bidict/_frozen.py:37:26: Function always implicitly returns `None`, which is not assignable to return type `frozenbidict[VT, KT]`
- error[invalid-return-type] bidict/_orderedbase.py:138:30: Function always implicitly returns `None`, which is not assignable to return type `OrderedBidictBase[VT, KT]`
- error[invalid-return-type] bidict/_orderedbase.py:141:26: Function always implicitly returns `None`, which is not assignable to return type `OrderedBidictBase[VT, KT]`
- error[invalid-return-type] bidict/_orderedbidict.py:39:30: Function always implicitly returns `None`, which is not assignable to return type `OrderedBidict[VT, KT]`
- error[invalid-return-type] bidict/_orderedbidict.py:42:26: Function always implicitly returns `None`, which is not assignable to return type `OrderedBidict[VT, KT]`
- Found 14 diagnostics
+ Found 4 diagnostics

trio (https://github.com/python-trio/trio)
+ error[unresolved-attribute] src/trio/_core/_generated_io_kqueue.py:35:25: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kqueue`
+ error[unresolved-attribute] src/trio/_core/_generated_io_kqueue.py:41:16: Type `EpollIOManager` has no attribute `current_kqueue`
+ error[unresolved-attribute] src/trio/_core/_generated_io_kqueue.py:49:50: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_generated_io_kqueue.py:55:16: Type `EpollIOManager` has no attribute `monitor_kevent`
+ error[unresolved-attribute] src/trio/_core/_generated_io_kqueue.py:69:22: Type `EpollIOManager` has no attribute `wait_kevent`
+ error[unresolved-attribute] src/trio/_core/_generated_io_windows.py:125:16: Type `EpollIOManager` has no attribute `register_with_iocp`
+ error[unresolved-attribute] src/trio/_core/_generated_io_windows.py:138:22: Type `EpollIOManager` has no attribute `wait_overlapped`
+ error[unresolved-attribute] src/trio/_core/_generated_io_windows.py:155:22: Type `EpollIOManager` has no attribute `write_overlapped`
+ error[unresolved-attribute] src/trio/_core/_generated_io_windows.py:172:22: Type `EpollIOManager` has no attribute `readinto_overlapped`
+ error[unresolved-attribute] src/trio/_core/_generated_io_windows.py:187:16: Type `EpollIOManager` has no attribute `current_iocp`
+ error[unresolved-attribute] src/trio/_core/_generated_io_windows.py:202:16: Type `EpollIOManager` has no attribute `monitor_completion_key`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:38:14: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kqueue`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:38:44: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kqueue`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:40:62: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:47:30: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:49:13: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_READ`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:50:13: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_ADD`
+ error[invalid-type-form] src/trio/_core/_io_kqueue.py:72:45: Variable of type `Literal[&quot;list[select.kevent]&quot;]` is not allowed in a type expression
+ error[invalid-type-form] src/trio/_core/_io_kqueue.py:89:38: Variable of type `Literal[&quot;list[select.kevent]&quot;]` is not allowed in a type expression
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:96:30: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_ONESHOT`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:115:33: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kqueue`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:128:40: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:138:34: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:179:17: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_ADD`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:179:36: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_ONESHOT`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:180:17: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:184:21: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:184:47: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_DELETE`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:230:37: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_READ`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:245:37: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_WRITE`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:276:25: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_READ`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:276:48: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_WRITE`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:284:25: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_core/_io_kqueue.py:284:52: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_DELETE`
+ error[unresolved-attribute] src/trio/_core/_io_windows.py:368:16: Type `OSError` has no attribute `winerror`
+ error[unresolved-attribute] src/trio/_core/_io_windows.py:557:16: Type `OSError` has no attribute `winerror`
+ error[invalid-argument-type] src/trio/_core/_io_windows.py:598:48: Argument is incorrect: Expected `bool`, found `CompletionKeyEventInfo`
+ error[unresolved-attribute] src/trio/_core/_io_windows.py:677:20: Type `OSError` has no attribute `winerror`
+ error[unresolved-attribute] src/trio/_core/_io_windows.py:726:20: Type `OSError` has no attribute `winerror`
+ error[unresolved-attribute] src/trio/_core/_io_windows.py:875:20: Type `OSError` has no attribute `winerror`
+ error[unresolved-attribute] src/trio/_core/_io_windows.py:945:16: Type `OSError` has no attribute `winerror`
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:45:28: Attribute `getwinerror` on type `Unknown | FFI` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:96:42: Attribute `current_iocp` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:104:10: Attribute `monitor_completion_key` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:152:27: Attribute `readinto_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:158:17: Attribute `register_with_iocp` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:166:27: Attribute `readinto_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ error[unresolved-import] src/trio/_core/_tests/test_windows.py:174:39: Module `asyncio.windows_utils` has no member `pipe`
+ error[unresolved-attribute] src/trio/_core/_tests/test_windows.py:178:20: Type `&lt;module &#x27;msvcrt&#x27;&gt;` has no attribute `open_osfhandle`
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:198:25: Attribute `readinto_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:227:9: Attribute `register_with_iocp` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:231:32: Attribute `readinto_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_core/_tests/test_windows.py:247:22: Attribute `readinto_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ error[unresolved-attribute] src/trio/_socket.py:330:35: Type `&lt;module &#x27;socket&#x27;&gt;` has no attribute `fromshare`
+ warning[possibly-unbound-attribute] src/trio/_subprocess_platform/kqueue.py:13:14: Attribute `current_kqueue` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ error[unresolved-import] src/trio/_subprocess_platform/kqueue.py:15:28: Module `select` has no member `KQ_NOTE_EXIT`
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:22:35: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:23:16: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `kevent`
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:25:20: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_PROC`
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:31:36: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_ADD`
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:31:55: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_ONESHOT`
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:45:36: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_EV_DELETE`
+ warning[possibly-unbound-attribute] src/trio/_subprocess_platform/kqueue.py:48:11: Attribute `wait_kevent` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ error[unresolved-attribute] src/trio/_subprocess_platform/kqueue.py:48:42: Type `&lt;module &#x27;select&#x27;&gt;` has no attribute `KQ_FILTER_PROC`
+ warning[possibly-unbound-attribute] src/trio/_tests/test_socket.py:354:14: Attribute `fromshare` on type `&lt;module &#x27;src.trio.socket&#x27;&gt;` is possibly unbound
+ error[invalid-argument-type] src/trio/_tests/test_unix_pipes.py:105:18: Argument to bound method `__init__` is incorrect: Expected `int`, found `None`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:122:12: Type `BaseException` has no attribute `errno`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:126:12: Type `BaseException` has no attribute `errno`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:139:12: Type `BaseException` has no attribute `errno`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:143:12: Type `BaseException` has no attribute `errno`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:198:26: Type `&lt;module &#x27;src.trio._core&#x27;&gt;` has no attribute `_run`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:201:15: Type `&lt;module &#x27;src.trio._core&#x27;&gt;` has no attribute `_run`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:207:25: Type `&lt;module &#x27;src.trio._core&#x27;&gt;` has no attribute `_run`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:229:26: Type `&lt;module &#x27;src.trio._core&#x27;&gt;` has no attribute `_run`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:232:15: Type `&lt;module &#x27;src.trio._core&#x27;&gt;` has no attribute `_run`
+ error[unresolved-attribute] src/trio/_tests/test_unix_pipes.py:238:25: Type `&lt;module &#x27;src.trio._core&#x27;&gt;` has no attribute `_run`
+ error[invalid-type-form] src/trio/_tests/test_windows_pipes.py:25:32: Variable of type `Never` is not allowed in a type expression
+ error[invalid-type-form] src/trio/_tests/test_windows_pipes.py:25:48: Variable of type `Never` is not allowed in a type expression
+ warning[possibly-unbound-attribute] src/trio/_windows_pipes.py:25:9: Attribute `register_with_iocp` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_windows_pipes.py:65:33: Attribute `write_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-attribute] src/trio/_windows_pipes.py:114:30: Attribute `readinto_overlapped` on type `&lt;module &#x27;src.trio._core&#x27;&gt;` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:67:9: Member `current_iocp` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:68:9: Member `monitor_completion_key` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:69:9: Member `readinto_overlapped` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:70:9: Member `register_with_iocp` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:71:9: Member `wait_overlapped` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:72:9: Member `write_overlapped` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:90:13: Member `current_kqueue` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:91:13: Member `monitor_kevent` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/lowlevel.py:92:13: Member `wait_kevent` of module `src.trio._core` is possibly unbound
+ warning[possibly-unbound-import] src/trio/socket.py:55:30: Member `fromshare` of module `src.trio._socket` is possibly unbound
- Found 746 diagnostics
+ Found 837 diagnostics

pydantic (https://github.com/pydantic/pydantic)
- error[invalid-return-type] pydantic/_internal/_utils.py:307:70: Function always implicitly returns `None`, which is not assignable to return type `T`
- Found 747 diagnostics
+ Found 746 diagnostics

jinja (https://github.com/pallets/jinja)
- error[invalid-return-type] src/jinja2/ext.py:34:59: Function always implicitly returns `None`, which is not assignable to return type `str`
- error[invalid-return-type] src/jinja2/ext.py:38:14: Function always implicitly returns `None`, which is not assignable to return type `str`
- Found 196 diagnostics
+ Found 194 diagnostics

typeshed-stats (https://github.com/AlexWaygood/typeshed-stats)
+ error[missing-argument] src/typeshed_stats/gather.py:645:20: No argument provided for required parameter `url` of function `get`
+ error[missing-argument] src/typeshed_stats/gather.py:645:20: No argument provided for required parameter `url` of function `get`
- Found 24 diagnostics
+ Found 26 diagnostics

pytest (https://github.com/pytest-dev/pytest)
- error[invalid-return-type] src/_pytest/capture.py:968:16: Return type does not match returned value: expected `CaptureResult[AnyStr]`, found `CaptureResult[str]`
+ warning[unused-ignore-comment] src/_pytest/capture.py:709:41: Unused blanket `type: ignore` directive

sphinx (https://github.com/sphinx-doc/sphinx)
+ warning[unused-ignore-comment] sphinx/ext/autodoc/importer.py:202:43: Unused blanket `type: ignore` directive
- Found 531 diagnostics
+ Found 532 diagnostics

meson (https://github.com/mesonbuild/meson)
- error[invalid-return-type] mesonbuild/compilers/d.py:110:44: Function always implicitly returns `None`, which is not assignable to return type `list[str]`
- error[invalid-return-type] mesonbuild/linkers/linkers.py:625:68: Function always implicitly returns `None`, which is not assignable to return type `list[str]`
- error[invalid-return-type] mesonbuild/linkers/linkers.py:1334:68: Function always implicitly returns `None`, which is not assignable to return type `list[str]`
- error[invalid-return-type] mesonbuild/options.py:401:36: Function always implicitly returns `None`, which is not assignable to return type `int`
- Found 903 diagnostics
+ Found 899 diagnostics

</code></pre>

No memory usage changes detected âœ…

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/carljm">@carljm</a> on 2025-07-17 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-07-17 20:39</div>
            <div class="timeline-body"><p>Primer results suggest there&#x27;s something necessary missing in the new version of our TYPE_CHECKING support here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-07-17 21:01</div>
            <div class="timeline-body"><p>The diff from <code>https://github.com/python-trio/trio</code> is very interesting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-21 13:39</div>
            <div class="timeline-body"><p>it appears as though we&#x27;re no longer viewing the remainder of the module as unreachable code (in which most diagnostics should be suppressed) following this <code>assert not TYPE_CHECKING</code> line here: https://github.com/python-trio/trio/blob/3326972d70569b5867773c5fbd79223708e0f59d/src/trio/_core/_generated_io_kqueue.py#L21. That and similar assertions in trio appear to be causing the new diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-14 13:12</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/pull/21449 looks like it got rid of the same set of false positives without adding any of the new false positives. Is this PR still needed, do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-14 17:23</div>
            <div class="timeline-body"><p>No, I think we can close this. There are some remaining inconsistencies in our support for <code>TYPE_CHECKING</code> (we recognize it when aliased in some circumstances but not in others) but I think any further work there should be driven by actual user reports. Thanks for following up on this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-11-14 17:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:44 UTC
    </footer>
</body>
</html>
