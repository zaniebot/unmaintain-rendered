<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move grouped rendering to `ruff_db` - astral-sh/ruff #19377</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Move grouped rendering to <code>ruff_db</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19377">#19377</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-07-15 21:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-15 21:28</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a pretty large refactor. The <code>grouped</code> output format depends on code from the more general <code>TextEmitter</code>, so in addition to moving over the <code>grouped</code> module itself, I also copied the necessary supporting code from <code>ruff_linter::message::text</code> and <code>ruff_linter::message::diff</code>. The <code>text</code> module also depended on the <code>ruff_linter::line_width</code> module, so I moved that to <code>ruff_db</code> too. Similarly, I moved <code>Locator::ceil_char_boundary</code> to a free function in <code>ruff_db</code>, along with a TODO to make it private once the <code>text</code> module is moved over.</p>
<h2>Test Plan</h2>
<p>Existing tests ported to <code>ruff_db</code>, plus a new test to see what a missing file looks like in this format</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @ntBre on 2025-07-15 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @ntBre on 2025-07-15 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Move grouped rendering to ruff_db" to "Move grouped rendering to `ruff_db`" by @ntBre on 2025-07-15 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-15 21:32</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-15 21:56</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/mcp/databricks_mcp_cookbook.ipynb:12:1:8: Simple statements must be separated by newlines or semicolons
</code></pre>
</p>
</details>

<h3>Formatter (preview)</h3>
<p>ℹ️ ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/mcp/databricks_mcp_cookbook.ipynb:12:1:8: Simple statements must be separated by newlines or semicolons
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/Cargo.toml</code>:29 on 2025-07-16 08:09</div>
            <div class="timeline-body"><p>Can we use <code>anstyle</code> instead of <code>colored</code>? both crates do the same</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:878 on 2025-07-16 08:12</div>
            <div class="timeline-body"><p>Having this type in <code>render</code> feels wrong to me. It is very specific to ruff's linter and may not apply to ty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-16 08:16</div>
            <div class="timeline-body"><p>Looking at this. It's not clear to me what the benefit is of using this type to <code>ruff_db</code>.</p>
<p>That's probably a question I should have asked earlier but what's the motivation for moving all rendering code to <code>ruff_db</code>?</p>
<p>IMO, the only reason for moving any rendering code to <code>ruff_db</code> is if it allows reuse between ruff and ty and we should, therefore, only move output formats that we intend on sharing between ruff and ty to <code>ruff_db</code>. All other output formats can remain in ruff.</p>
<p>I think for now, the focus should be on whether we can reuse concise and full in Ruff because it would allow us to share more code between the two crates (and diagnostics rendering is fairly involved). Moving all other output formats seems less of a priority to me unless we want to use them in ty.</p>
<p>That's why I think we shouldn't move grouped just yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-24 13:31</div>
            <div class="timeline-body"><p>Closing this for now, it would be totally different after working on <code>concise</code> and <code>full</code>, if we even decide to move it over.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-07-24 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-24 13:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:58:39 UTC
    </footer>
</body>
</html>
