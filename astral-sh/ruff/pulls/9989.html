<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indent nested binary expressions - astral-sh/ruff #9989</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Indent nested binary expressions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9989">#9989</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-02-14 17:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This isn't it yet... and in no way what we recommend going forward. This PR is just me playing around with some different formatting and to see what works and what doesn't.</p>
<p>The formatting of very long binary expression improves but there are now many cases
where the indent feels too deep and breaking before the <code>+</code> operator feels wrong.
We probably need to become clever of when and when not to insert the line break when indenting as well</p>
<p>This is a good ecosystem stress test :laughing: This also raises the question if something as fundamental as binary expression formatting can still be changed...</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-14 18:05</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Formatter (stable)</h3>
<p>ℹ️ ecosystem check <strong>detected format changes</strong>. (+6766 -6660 lines in 1009 files in 29 projects; 14 projects unchanged)</p>
<details><summary><a href="https://github.com/DisnakeDev/disnake">DisnakeDev/disnake</a> (+35 -35 lines across 8 files)</summary>
<p>

<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/audit_logs.py#L601'>disnake/audit_logs.py~L601</a></p>
<pre><code class="language-diff">                 self.extra = type(&quot;_AuditLogProxy&quot;, (), elems)()
             elif (
                 self.action is enums.AuditLogAction.member_move
-                or self.action is enums.AuditLogAction.message_delete
+                    or self.action is enums.AuditLogAction.message_delete
             ):
                 elems = {
                     &quot;count&quot;: int(extra[&quot;count&quot;]),
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/audit_logs.py#L844'>disnake/audit_logs.py~L844</a></p>
<pre><code class="language-diff">     ) -&gt; Union[GuildScheduledEvent, Object]:
         return (
             self.guild.get_scheduled_event(target_id)
-            or self._guild_scheduled_events.get(target_id)
-            or Object(id=target_id)
+                or self._guild_scheduled_events.get(target_id)
+                or Object(id=target_id)
         )
 
     def _convert_target_application_command_or_integration(
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/audit_logs.py#L854'>disnake/audit_logs.py~L854</a></p>
<pre><code class="language-diff">         # try application command
         if target := (
             self._state._get_guild_application_command(self.guild.id, target_id)
-            or self._state._get_global_application_command(target_id)
-            or self._application_commands.get(target_id)
+                or self._state._get_global_application_command(target_id)
+                or self._application_commands.get(target_id)
         ):
             return target
 
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/channel.py#L1999'>disnake/channel.py~L1999</a></p>
<pre><code class="language-diff">             member
             for member in self.members
             if member.voice
-            and not member.voice.suppress
-            and member.voice.requested_to_speak_at is None
+                and not member.voice.suppress
+                and member.voice.requested_to_speak_at is None
         ]
 
     @property
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/core.py#L552'>disnake/ext/commands/core.py~L552</a></p>
<pre><code class="language-diff">             except ArgumentParsingError:
                 if (
                     self._is_typing_optional(param.annotation)
-                    and not param.kind == param.VAR_POSITIONAL
+                        and not param.kind == param.VAR_POSITIONAL
                 ):
                     view.index = previous
                     return None
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/core.py#L2490'>disnake/ext/commands/core.py~L2490</a></p>
<pre><code class="language-diff">                     disnake.StageChannel,
                 ),
             )
-            and ch.is_nsfw()
+                and ch.is_nsfw()
         ):
             return True
         raise NSFWChannelRequired(ch)  # type: ignore
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/interaction_bot_base.py#L160'>disnake/ext/commands/interaction_bot_base.py~L160</a></p>
<pre><code class="language-diff"> 
         if command_sync_flags is not None and (
             sync_commands is not MISSING
-            or sync_commands_debug is not MISSING
-            or sync_commands_on_cog_unload is not MISSING
+                or sync_commands_debug is not MISSING
+                or sync_commands_on_cog_unload is not MISSING
         ):
             raise TypeError(
                 &quot;cannot set 'command_sync_flags' and any of 'sync_commands', 'sync_commands_debug', 'sync_commands_on_cog_unload' at the same time.&quot;
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/interaction_bot_base.py#L891'>disnake/ext/commands/interaction_bot_base.py~L891</a></p>
<pre><code class="language-diff"> 
         if (
             not self._command_sync_flags._sync_enabled
-            or self._sync_queued.locked()
-            or not self.is_ready()
-            or self._is_closed
-            or self.loop.is_closed()
+                or self._sync_queued.locked()
+                or not self.is_ready()
+                or self._is_closed
+                or self.loop.is_closed()
         ):
             return
         # We don't do this task on login or in parallel with a similar task
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/interaction_bot_base.py#L1314'>disnake/ext/commands/interaction_bot_base.py~L1314</a></p>
<pre><code class="language-diff">             # if we're not currently syncing,
             not self._sync_queued.locked()
             # and we're instructed to sync guild commands
-            and self._command_sync_flags.sync_guild_commands
-            # and the current command was registered to a guild
-            and interaction.data.get(&quot;guild_id&quot;)
-            # and we don't know the command
-            and not self.get_guild_command(interaction.guild_id, interaction.data.id)  # type: ignore
+                and self._command_sync_flags.sync_guild_commands
+                # and the current command was registered to a guild
+                and interaction.data.get(&quot;guild_id&quot;)
+                # and we don't know the command
+                and not self.get_guild_command(interaction.guild_id, interaction.data.id)  # type: ignore
         ):
             # don't do anything if we aren't allowed to disable them
             if self._command_sync_flags.allow_command_deletion:
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/params.py#L643'>disnake/ext/commands/params.py~L643</a></p>
<pre><code class="language-diff">         # If we received a `User` but didn't expect one, raise.
         if (
             isinstance(argument, disnake.User)
-            and issubclass_(self.type, disnake.Member)
-            and not issubclass_(self.type, disnake.User)
+                and issubclass_(self.type, disnake.Member)
+                and not issubclass_(self.type, disnake.User)
         ):
             raise errors.MemberNotFound(str(argument.id))
 
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/params.py#L703'>disnake/ext/commands/params.py~L703</a></p>
<pre><code class="language-diff">         if not converter_mode:
             self.converter = (
                 self.converter
-                or getattr(annotation, &quot;__discord_converter__&quot;, None)
-                or self._registered_converters.get(annotation)
+                    or getattr(annotation, &quot;__discord_converter__&quot;, None)
+                    or self._registered_converters.get(annotation)
             )
             if self.converter:
                 self.parse_converter_annotation(self.converter, annotation)
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/ext/commands/params.py#L735'>disnake/ext/commands/params.py~L735</a></p>
<pre><code class="language-diff">             self.type = annotation
         elif (
             isinstance(annotation, (EnumMeta, disnake.enums.EnumMeta))
-            or get_origin(annotation) is Literal
+                or get_origin(annotation) is Literal
         ):
             self._parse_enum(annotation)
         elif get_origin(annotation) in (Union, UnionType):
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/guild.py#L2278'>disnake/guild.py~L2278</a></p>
<pre><code class="language-diff"> 
         if (
             community is not MISSING
-            or invites_disabled is not MISSING
-            or raid_alerts_disabled is not MISSING
+                or invites_disabled is not MISSING
+                or raid_alerts_disabled is not MISSING
         ):
             # If we don't have complete feature information for the guild,
             # it is possible to disable or enable other features that we didn't intend to touch.
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/invite.py#L440'>disnake/invite.py~L440</a></p>
<pre><code class="language-diff">         # if it was stored on the Guild object, we would be throwing away this data from the api request
         if (
             self.guild is not None
-            and (guild_data := data.get(&quot;guild&quot;))
-            and &quot;welcome_screen&quot; in guild_data
+                and (guild_data := data.get(&quot;guild&quot;))
+                and &quot;welcome_screen&quot; in guild_data
         ):
             self.guild_welcome_screen: Optional[WelcomeScreen] = WelcomeScreen(
                 state=self._state,
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/state.py#L585'>disnake/state.py~L585</a></p>
<pre><code class="language-diff">         # If presences are enabled then we get back the old guild.large behaviour
         return (
             self._chunk_guilds
-            and not guild.chunked
-            and not (self._intents.presences and not guild.large)
+                and not guild.chunked
+                and not (self._intents.presences and not guild.large)
         )
 
     def _get_guild_channel(
</code></pre>
<p><a href='https://github.com/DisnakeDev/disnake/blob/47022234738cc34a70ac3b53bc8df54b1593bc76/disnake/state.py#L767'>disnake/state.py~L767</a></p>
<pre><code class="language-diff">             # This mirrors the current client and API behavior.
             if channel.__class__ is Thread and not (
                 message.type is MessageType.thread_starter_message
-                or (
-                    type(channel.parent) in (ForumChannel, MediaChannel)  # type: ignore
-                    and channel.id == message.id
-                )
+                    or (
+                        type(channel.parent) in (ForumChannel, MediaChannel)  # type: ignore
+                            and channel.id == message.id
+                    )
             ):
                 channel.total_message_sent += 1  # type: ignore
                 channel.message_count += 1  # type: ignore
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/PostHog/HouseWatch">PostHog/HouseWatch</a> (+3 -1 lines across 1 file)</summary>
<p>

<p><a href='https://github.com/PostHog/HouseWatch/blob/c8962f5464839fbbc0a60f398aa765d4bc8437b6/housewatch/clickhouse/table.py#L5'>housewatch/clickhouse/table.py~L5</a></p>
<pre><code class="language-diff">     QUERY = &quot;&quot;&quot;SELECT engine FROM system.tables WHERE database = '%(database)s' AND name = '%(table)s'&quot;&quot;&quot;
     return (
         &quot;replicated&quot;
-        in run_query(QUERY, {&quot;database&quot;: database, &quot;table&quot;: table})[0][&quot;engine&quot;].lower()
+            in run_query(QUERY, {&quot;database&quot;: database, &quot;table&quot;: table})[0][
+                &quot;engine&quot;
+            ].lower()
     )
 
 
</code></pre>
</p>
</details>
<details><summary><a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+475 -470 lines across 68 files)</summary>
<p>

<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/cli/export.py#L134'>rasa/cli/export.py~L134</a></p>
<pre><code class="language-diff"> 
     if (
         min_timestamp is not None
-        and max_timestamp is not None
-        and max_timestamp &lt; min_timestamp
+            and max_timestamp is not None
+            and max_timestamp &lt; min_timestamp
     ):
         rasa.shared.utils.cli.print_error_and_exit(
             f&quot;Maximum timestamp '{max_timestamp}' is smaller than minimum &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L184'>rasa/core/actions/action.py~L184</a></p>
<pre><code class="language-diff"> 
     if (
         action_name_or_text in defaults
-        and action_name_or_text not in domain.user_actions_and_forms
+            and action_name_or_text not in domain.user_actions_and_forms
     ):
         return defaults[action_name_or_text]
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L428'>rasa/core/actions/action.py~L428</a></p>
<pre><code class="language-diff"> 
         if (
             self.intent_name_from_action(self.action_name)
-            in response_selector_properties
+                in response_selector_properties
         ):
             query_key = self.intent_name_from_action(self.action_name)
         elif RESPONSE_SELECTOR_DEFAULT_INTENT in response_selector_properties:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L462'>rasa/core/actions/action.py~L462</a></p>
<pre><code class="language-diff"> 
         if (
             self.intent_name_from_action(self.action_name)
-            in response_selector_properties
+                in response_selector_properties
         ):
             query_key = self.intent_name_from_action(self.action_name)
         elif RESPONSE_SELECTOR_DEFAULT_INTENT in response_selector_properties:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L680'>rasa/core/actions/action.py~L680</a></p>
<pre><code class="language-diff"> 
         if (
             not self._is_selective_domain_enabled()
-            or domain.does_custom_action_explicitly_need_domain(self.name())
+                or domain.does_custom_action_explicitly_need_domain(self.name())
         ):
             result[&quot;domain&quot;] = domain.as_dict()
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L1022'>rasa/core/actions/action.py~L1022</a></p>
<pre><code class="language-diff">         )
         if (
             intent_to_affirm == DEFAULT_NLU_FALLBACK_INTENT_NAME
-            and len(intent_ranking) &gt; 1
+                and len(intent_ranking) &gt; 1
         ):
             intent_to_affirm = intent_ranking[1][INTENT_NAME_KEY]  # type: ignore[literal-required] # noqa: E501
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L1101'>rasa/core/actions/action.py~L1101</a></p>
<pre><code class="language-diff"> 
         if (
             tracker.is_active_loop_rejected
-            and tracker.get_slot(REQUESTED_SLOT) == slot_name
+                and tracker.get_slot(REQUESTED_SLOT) == slot_name
         ):
             return False
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L1364'>rasa/core/actions/action.py~L1364</a></p>
<pre><code class="language-diff"> 
     should_fill_entity_slot = (
         mapping_type == SlotMappingType.FROM_ENTITY
-        and SlotMapping.entity_is_desired(mapping, tracker)
+            and SlotMapping.entity_is_desired(mapping, tracker)
     )
 
     should_fill_intent_slot = mapping_type == SlotMappingType.FROM_INTENT
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/action.py#L1382'>rasa/core/actions/action.py~L1382</a></p>
<pre><code class="language-diff">         trigger_mapping_condition_met = False
     elif (
         active_loops_in_mapping_conditions
-        and tracker.active_loop_name is not None
-        and (tracker.active_loop_name not in active_loops_in_mapping_conditions)
+            and tracker.active_loop_name is not None
+            and (tracker.active_loop_name not in active_loops_in_mapping_conditions)
     ):
         trigger_mapping_condition_met = False
 
     should_fill_trigger_slot = (
         mapping_type == SlotMappingType.FROM_TRIGGER_INTENT
-        and trigger_mapping_condition_met
+            and trigger_mapping_condition_met
     )
 
     value: List[Any] = []
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/forms.py#L114'>rasa/core/actions/forms.py~L114</a></p>
<pre><code class="language-diff">         for requested_slot_mapping in requested_slot_mappings:
             if (
                 not isinstance(requested_slot_mapping, dict)
-                or requested_slot_mapping.get(&quot;type&quot;) is None
+                    or requested_slot_mapping.get(&quot;type&quot;) is None
             ):
                 raise TypeError(&quot;Provided incompatible slot mapping&quot;)
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/forms.py#L290'>rasa/core/actions/forms.py~L290</a></p>
<pre><code class="language-diff">             current_tracker.sender_id,
             current_tracker.events_after_latest_restart()
             # Insert SlotSet event to make sure REQUESTED_SLOT belongs to active form.
-            + [SlotSet(REQUESTED_SLOT, self.get_slot_to_fill(current_tracker))]
-            # Insert form execution event so that it's clearly distinguishable which
-            # events were newly added.
-            + [ActionExecuted(self.name())]
-            + additional_events,
+                + [SlotSet(REQUESTED_SLOT, self.get_slot_to_fill(current_tracker))]
+                # Insert form execution event so that it's clearly distinguishable which
+                # events were newly added.
+                + [ActionExecuted(self.name())]
+                + additional_events,
             slots=domain.slots,
         )
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/forms.py#L413'>rasa/core/actions/forms.py~L413</a></p>
<pre><code class="language-diff"> 
         if (
             slot_to_fill
-            and not extracted_slot_values
-            and not some_slots_were_validated
-            and not self._user_rejected_manually(validation_events)
+                and not extracted_slot_values
+                and not some_slots_were_validated
+                and not self._user_rejected_manually(validation_events)
         ):
             # reject to execute the form action
             # if some slot was requested but nothing was extracted
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/actions/forms.py#L540'>rasa/core/actions/forms.py~L540</a></p>
<pre><code class="language-diff">         # no active_loop means that it is called during activation
         needs_validation = not tracker.active_loop or (
             tracker.latest_action_name == ACTION_LISTEN_NAME
-            and not tracker.is_active_loop_interrupted
+                and not tracker.is_active_loop_interrupted
         )
 
         if needs_validation:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/facebook.py#L45'>rasa/core/channels/facebook.py~L45</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Check if the users message is a recorded voice message.&quot;&quot;&quot;
         return (
             &quot;message&quot; in message
-            and &quot;attachments&quot; in message[&quot;message&quot;]
-            and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;audio&quot;
+                and &quot;attachments&quot; in message[&quot;message&quot;]
+                and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;audio&quot;
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/facebook.py#L54'>rasa/core/channels/facebook.py~L54</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Check if the users message is an image.&quot;&quot;&quot;
         return (
             &quot;message&quot; in message
-            and &quot;attachments&quot; in message[&quot;message&quot;]
-            and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;image&quot;
+                and &quot;attachments&quot; in message[&quot;message&quot;]
+                and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;image&quot;
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/facebook.py#L63'>rasa/core/channels/facebook.py~L63</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Check if the users message is a video.&quot;&quot;&quot;
         return (
             &quot;message&quot; in message
-            and &quot;attachments&quot; in message[&quot;message&quot;]
-            and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;video&quot;
+                and &quot;attachments&quot; in message[&quot;message&quot;]
+                and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;video&quot;
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/facebook.py#L72'>rasa/core/channels/facebook.py~L72</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Check if the users message is a file.&quot;&quot;&quot;
         return (
             &quot;message&quot; in message
-            and &quot;attachments&quot; in message[&quot;message&quot;]
-            and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;file&quot;
+                and &quot;attachments&quot; in message[&quot;message&quot;]
+                and message[&quot;message&quot;][&quot;attachments&quot;][0][&quot;type&quot;] == &quot;file&quot;
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/facebook.py#L81'>rasa/core/channels/facebook.py~L81</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Check if the message is a message from the user.&quot;&quot;&quot;
         return (
             &quot;message&quot; in message
-            and &quot;text&quot; in message[&quot;message&quot;]
-            and not message[&quot;message&quot;].get(&quot;is_echo&quot;)
+                and &quot;text&quot; in message[&quot;message&quot;]
+                and not message[&quot;message&quot;].get(&quot;is_echo&quot;)
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/facebook.py#L90'>rasa/core/channels/facebook.py~L90</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Check if the message is a quick reply message.&quot;&quot;&quot;
         return (
             message.get(&quot;message&quot;) is not None
-            and message[&quot;message&quot;].get(&quot;quick_reply&quot;) is not None
-            and message[&quot;message&quot;][&quot;quick_reply&quot;].get(&quot;payload&quot;)
+                and message[&quot;message&quot;].get(&quot;quick_reply&quot;) is not None
+                and message[&quot;message&quot;][&quot;quick_reply&quot;].get(&quot;payload&quot;)
         )
 
     async def handle(self, payload: Dict, metadata: Optional[Dict[Text, Any]]) -&gt; None:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/channels/hangouts.py#L247'>rasa/core/channels/hangouts.py~L247</a></p>
<pre><code class="language-diff"> 
         elif (
             req.json[&quot;type&quot;] == &quot;REMOVED_FROM_SPACE&quot;
-            and self.hangouts_user_added_intent_name
+                and self.hangouts_user_added_intent_name
         ):
             message = self.hangouts_user_added_intent_name
         else:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/evaluation/marker_base.py#L342'>rasa/core/evaluation/marker_base.py~L342</a></p>
<pre><code class="language-diff">             idx
             for idx, event in enumerate(events)
             if isinstance(event, ActionExecuted)
-            and event.action_name
-            == rasa.shared.core.constants.ACTION_SESSION_START_NAME
+                and event.action_name
+                    == rasa.shared.core.constants.ACTION_SESSION_START_NAME
         ]
         if len(session_start_indices) == 0:
             return [(events, 0)]
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/featurizers/single_state_featurizer.py#L302'>rasa/core/featurizers/single_state_featurizer.py~L302</a></p>
<pre><code class="language-diff">         #  distinguish between entities and roles/groups right now.
         if (
             not entity_data
-            or not self.entity_tag_specs
-            or self.entity_tag_specs[0].num_tags &lt; 2
+                or not self.entity_tag_specs
+                or self.entity_tag_specs[0].num_tags &lt; 2
         ):
             # we cannot build a classifier with fewer than 2 classes
             return {}
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/featurizers/tracker_featurizers.py#L504'>rasa/core/featurizers/tracker_featurizers.py~L504</a></p>
<pre><code class="language-diff">             for event in events
             if (
                 not isinstance(event, ActionExecuted)
-                or event.action_name != ACTION_UNLIKELY_INTENT_NAME
+                    or event.action_name != ACTION_UNLIKELY_INTENT_NAME
             )
         ]
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/featurizers/tracker_featurizers.py#L1007'>rasa/core/featurizers/tracker_featurizers.py~L1007</a></p>
<pre><code class="language-diff">                 # Only add unique example states unless `remove_duplicates` is `False`.
                 if (
                     not self.remove_duplicates
-                    or state_hash not in state_hash_to_label_set
+                        or state_hash not in state_hash_to_label_set
                 ):
                     example_states.append(states)
                     example_entities.append(entities)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/lock_store.py#L306'>rasa/core/lock_store.py~L306</a></p>
<pre><code class="language-diff">     &quot;&quot;&quot;Given an endpoint configuration, create a proper `LockStore` object.&quot;&quot;&quot;
     if (
         endpoint_config is None
-        or endpoint_config.type is None
-        or endpoint_config.type == &quot;in_memory&quot;
+            or endpoint_config.type is None
+            or endpoint_config.type == &quot;in_memory&quot;
     ):
         # this is the default type if no lock store type is set
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/migrate.py#L350'>rasa/core/migrate.py~L350</a></p>
<pre><code class="language-diff"> 
         if (
             file_dict.get(KEY_TRAINING_DATA_FORMAT_VERSION)
-            == LATEST_TRAINING_DATA_FORMAT_VERSION
+                == LATEST_TRAINING_DATA_FORMAT_VERSION
         ):
             migrated_files.append(file)
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/policy.py#L168'>rasa/core/policies/policy.py~L168</a></p>
<pre><code class="language-diff">         featurizer = featurizer_func(**featurizer_config)
         if (
             isinstance(featurizer, MaxHistoryTrackerFeaturizer)
-            and POLICY_MAX_HISTORY in policy_config
-            and POLICY_MAX_HISTORY not in featurizer_config
+                and POLICY_MAX_HISTORY in policy_config
+                and POLICY_MAX_HISTORY not in featurizer_config
         ):
             featurizer.max_history = policy_config[POLICY_MAX_HISTORY]
         return featurizer
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/policy.py#L244'>rasa/core/policies/policy.py~L244</a></p>
<pre><code class="language-diff">             precomputations=precomputations,
             bilou_tagging=bilou_tagging,
             ignore_action_unlikely_intent=self.supported_data()
-            == SupportedData.ML_DATA,
+                == SupportedData.ML_DATA,
         )
 
         max_training_samples = kwargs.get(&quot;max_training_samples&quot;)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/policy.py#L287'>rasa/core/policies/policy.py~L287</a></p>
<pre><code class="language-diff">             ignore_rule_only_turns=self.supported_data() == SupportedData.ML_DATA,
             rule_only_data=rule_only_data,
             ignore_action_unlikely_intent=self.supported_data()
-            == SupportedData.ML_DATA,
+                == SupportedData.ML_DATA,
         )[0]
 
     def _featurize_for_prediction(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/policy.py#L327'>rasa/core/policies/policy.py~L327</a></p>
<pre><code class="language-diff">             ignore_rule_only_turns=self.supported_data() == SupportedData.ML_DATA,
             rule_only_data=rule_only_data,
             ignore_action_unlikely_intent=self.supported_data()
-            == SupportedData.ML_DATA,
+                == SupportedData.ML_DATA,
         )
 
     @abc.abstractmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/policy.py#L582'>rasa/core/policies/policy.py~L582</a></p>
<pre><code class="language-diff"> 
         return (
             self.probabilities == other.probabilities
-            and self.policy_name == other.policy_name
-            and self.policy_priority == other.policy_priority
-            and self.events == other.events
-            and self.optional_events == other.optional_events
-            and self.is_end_to_end_prediction == other.is_end_to_end_prediction
-            and self.is_no_user_prediction == other.is_no_user_prediction
-            and self.hide_rule_turn == other.hide_rule_turn
-            and self.action_metadata == other.action_metadata
+                and self.policy_name == other.policy_name
+                and self.policy_priority == other.policy_priority
+                and self.events == other.events
+                and self.optional_events == other.optional_events
+                and self.is_end_to_end_prediction == other.is_end_to_end_prediction
+                and self.is_no_user_prediction == other.is_no_user_prediction
+                and self.hide_rule_turn == other.hide_rule_turn
+                and self.action_metadata == other.action_metadata
             # We do not compare `diagnostic_data`, because it has no effect on the
             # action prediction.
         )
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L180'>rasa/core/policies/rule_policy.py~L180</a></p>
<pre><code class="language-diff">         fallback_action_name = config.get(&quot;core_fallback_action_name&quot;, None)
         if (
             fallback_action_name
-            and fallback_action_name not in domain.action_names_or_texts
+                and fallback_action_name not in domain.action_names_or_texts
         ):
             raise InvalidDomain(
                 f&quot;The fallback action '{fallback_action_name}' which was &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L382'>rasa/core/policies/rule_policy.py~L382</a></p>
<pre><code class="language-diff">                 fingerprint = rule_fingerprints.get(previous_action_name)
                 if (
                     not previous_action_name
-                    or not fingerprint
-                    or action_name == RULE_SNIPPET_ACTION_NAME
-                    or previous_action_name == RULE_SNIPPET_ACTION_NAME
+                        or not fingerprint
+                        or action_name == RULE_SNIPPET_ACTION_NAME
+                        or previous_action_name == RULE_SNIPPET_ACTION_NAME
                 ):
                     # do not check fingerprints for rule snippet action
                     # and don't raise if fingerprints are not satisfied
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L462'>rasa/core/policies/rule_policy.py~L462</a></p>
<pre><code class="language-diff">         predicted_action_name = None
         if (
             probabilities != self._default_predictions(domain)
-            or tracker.is_rule_tracker
+                or tracker.is_rule_tracker
         ):
             predicted_action_name = domain.action_names_or_texts[
                 np.argmax(probabilities)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L481'>rasa/core/policies/rule_policy.py~L481</a></p>
<pre><code class="language-diff">         # but inside loop unhappy path there might be another action
         if (
             tracker.active_loop_name
-            and predicted_action_name != gold_action_name
-            and predicted_action_name == tracker.active_loop_name
+                and predicted_action_name != gold_action_name
+                and predicted_action_name == tracker.active_loop_name
         ):
             rasa.core.test.emulate_loop_rejection(tracker)
             predicted_action_name, prediction_source = self._predict_next_action(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L504'>rasa/core/policies/rule_policy.py~L504</a></p>
<pre><code class="language-diff"> 
         if prediction_source is not None and (
             prediction_source.startswith(DEFAULT_RULES)
-            or prediction_source.startswith(LOOP_RULES)
+                or prediction_source.startswith(LOOP_RULES)
         ):
             # the real gold action contradict the one in the rules in this case
             gold_action_name = predicted_action_name
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L548'>rasa/core/policies/rule_policy.py~L548</a></p>
<pre><code class="language-diff">             # only apply to contradicting story, not rule
             tracker.is_rule_tracker
             # only apply for prediction after unpredictable action
-            or prediction_source.count(PREVIOUS_ACTION) &gt; 1
-            # only apply for prediction of action_listen
-            or predicted_action_name != ACTION_LISTEN_NAME
+                or prediction_source.count(PREVIOUS_ACTION) &gt; 1
+                # only apply for prediction of action_listen
+                or predicted_action_name != ACTION_LISTEN_NAME
         ):
             return False
         for source in self.lookup[RULES]:
             # remove rule only if another action is predicted after action_listen
             if (
                 source.startswith(prediction_source[:-2])
-                and not prediction_source == source
+                    and not prediction_source == source
             ):
                 return True
         return False
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L574'>rasa/core/policies/rule_policy.py~L574</a></p>
<pre><code class="language-diff">         # by better typing in this class, but requires some refactoring
         if (
             not predicted_action_name
-            or not prediction_source
-            or predicted_action_name == gold_action_name
+                or not prediction_source
+                or predicted_action_name == gold_action_name
         ):
             return []
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L661'>rasa/core/policies/rule_policy.py~L661</a></p>
<pre><code class="language-diff">                     # we need to know which rules were used in ML trackers
                     if (
                         not tracker.is_rule_tracker
-                        and predicted_action_name == gold_action_name
+                            and predicted_action_name == gold_action_name
                     ):
                         rules_used_in_stories.add(prediction_source)
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L732'>rasa/core/policies/rule_policy.py~L732</a></p>
<pre><code class="language-diff">         logger.debug(&quot;Found no contradicting rules.&quot;)
         all_rules = (
             set(self._rules_sources.keys())
-            | self._default_sources()
-            | self._handling_loop_sources(domain)
+                | self._default_sources()
+                | self._handling_loop_sources(domain)
         )
         # set is not json serializable, so convert to list
         return list(all_rules - rules_used_in_stories)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L841'>rasa/core/policies/rule_policy.py~L841</a></p>
<pre><code class="language-diff">                     # value should be set, therefore
                     # check whether it is the same as in the state
                     value_from_rules
-                    and value_from_rules != SHOULD_NOT_BE_SET
-                    and value_from_conversation != value_from_rules
+                        and value_from_rules != SHOULD_NOT_BE_SET
+                        and value_from_conversation != value_from_rules
                 ) or (
                     # value shouldn't be set, therefore
                     # it should be None or non existent in the state
                     value_from_rules == SHOULD_NOT_BE_SET
-                    and value_from_conversation
-                    # during training `SHOULD_NOT_BE_SET` is provided. Hence, we also
-                    # have to check for the value of the slot state
-                    and value_from_conversation != SHOULD_NOT_BE_SET
+                        and value_from_conversation
+                        # during training `SHOULD_NOT_BE_SET` is provided. Hence, we also
+                        # have to check for the value of the slot state
+                        and value_from_conversation != SHOULD_NOT_BE_SET
                 ):
                     return False
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L927'>rasa/core/policies/rule_policy.py~L927</a></p>
<pre><code class="language-diff">     ) -&gt; Tuple[Optional[Text], Optional[Text]]:
         if (
             not tracker.latest_action_name == ACTION_LISTEN_NAME
-            or not tracker.latest_message
+                or not tracker.latest_message
         ):
             return None, None
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L958'>rasa/core/policies/rule_policy.py~L958</a></p>
<pre><code class="language-diff">         active_loop_rejected = tracker.is_active_loop_rejected
         should_predict_loop = (
             not active_loop_rejected
-            and tracker.latest_action
-            and tracker.latest_action.get(ACTION_NAME) != active_loop_name
+                and tracker.latest_action
+                and tracker.latest_action.get(ACTION_NAME) != active_loop_name
         )
         should_predict_listen = (
             not active_loop_rejected and tracker.latest_action_name == active_loop_name
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L1005'>rasa/core/policies/rule_policy.py~L1005</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;
         if (
             use_text_for_last_user_input
-            and not tracker.latest_action_name == ACTION_LISTEN_NAME
+                and not tracker.latest_action_name == ACTION_LISTEN_NAME
         ):
             # make text prediction only directly after user utterance
             # because we've otherwise already decided whether to use
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L1058'>rasa/core/policies/rule_policy.py~L1058</a></p>
<pre><code class="language-diff">             # Hence, we have to take care of that.
             predicted_listen_from_general_rule = (
                 predicted_action_name == ACTION_LISTEN_NAME
-                and not get_active_loop_name(self._rule_key_to_state(best_rule_key)[-1])
+                    and not get_active_loop_name(
+                        self._rule_key_to_state(best_rule_key)[-1]
+                    )
             )
             if predicted_listen_from_general_rule:
                 if DO_NOT_PREDICT_LOOP_ACTION not in unhappy_path_conditions:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/rule_policy.py#L1199'>rasa/core/policies/rule_policy.py~L1199</a></p>
<pre><code class="language-diff">                     # returning_from_unhappy_path is a negative condition,
                     # so `or` should be applied
                     returning_from_unhappy_path_from_text
-                    or returning_from_unhappy_path_from_intent
+                        or returning_from_unhappy_path_from_intent
                 ),
                 is_end_to_end_prediction=False,
             ),
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L760'>rasa/core/policies/ted_policy.py~L760</a></p>
<pre><code class="language-diff">         # the second - text, but only after user utterance and if not only e2e
         if (
             tracker.latest_action_name == ACTION_LISTEN_NAME
-            and TEXT in self.fake_features
-            and not self.only_e2e
+                and TEXT in self.fake_features
+                and not self.only_e2e
         ):
             tracker_state_features += self._featurize_for_prediction(
                 tracker,
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L796'>rasa/core/policies/ted_policy.py~L796</a></p>
<pre><code class="language-diff">             logger.debug(f&quot;User text lead to '{e2e_action_name}'.&quot;)
             if (
                 np.max(confidences[1]) &gt; self.config[E2E_CONFIDENCE_THRESHOLD]
-                # TODO maybe compare confidences is better
-                and np.max(similarities[1]) &gt; np.max(similarities[0])
+                    # TODO maybe compare confidences is better
+                    and np.max(similarities[1]) &gt; np.max(similarities[0])
             ):
                 logger.debug(f&quot;TED predicted '{e2e_action_name}' based on user text.&quot;)
                 return confidences[1], True
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L854'>rasa/core/policies/ted_policy.py~L854</a></p>
<pre><code class="language-diff">         if 0 &lt; ranking_length &lt; len(confidence):
             renormalize = (
                 self.config[RENORMALIZE_CONFIDENCES]
-                and self.config[MODEL_CONFIDENCE] == SOFTMAX
+                    and self.config[MODEL_CONFIDENCE] == SOFTMAX
             )
             _, confidence = train_utils.rank_and_mask(
                 confidence, ranking_length=ranking_length, renormalize=renormalize
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L1339'>rasa/core/policies/ted_policy.py~L1339</a></p>
<pre><code class="language-diff">         # check that there are SENTENCE features for the attribute name in data
         if (
             name in SENTENCE_FEATURES_TO_ENCODE
-            and FEATURE_TYPE_SENTENCE not in self.data_signature[name]
+                and FEATURE_TYPE_SENTENCE not in self.data_signature[name]
         ):
             return
         #  same for label_data
         if (
             name in LABEL_FEATURES_TO_ENCODE
-            and FEATURE_TYPE_SENTENCE not in self.label_signature[name]
+                and FEATURE_TYPE_SENTENCE not in self.label_signature[name]
         ):
             return
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L1797'>rasa/core/policies/ted_policy.py~L1797</a></p>
<pre><code class="language-diff"> 
         if (
             batch_encoded.get(ACTION_TEXT) is not None
-            and batch_encoded.get(ACTION_NAME) is not None
+                and batch_encoded.get(ACTION_NAME) is not None
         ):
             batch_action = batch_encoded.pop(ACTION_TEXT) + batch_encoded.pop(
                 ACTION_NAME
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L1809'>rasa/core/policies/ted_policy.py~L1809</a></p>
<pre><code class="language-diff">         # same for user input
         if (
             batch_encoded.get(INTENT) is not None
-            and batch_encoded.get(TEXT) is not None
+                and batch_encoded.get(TEXT) is not None
         ):
             batch_user = batch_encoded.pop(INTENT) + batch_encoded.pop(TEXT)
         elif batch_encoded.get(TEXT) is not None:
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L2009'>rasa/core/policies/ted_policy.py~L2009</a></p>
<pre><code class="language-diff"> 
         if (
             self.config[ENTITY_RECOGNITION]
-            and text_output is not None
-            and text_sequence_lengths is not None
+                and text_output is not None
+                and text_sequence_lengths is not None
         ):
             losses.append(
                 self._batch_loss_entities(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/ted_policy.py#L2080'>rasa/core/policies/ted_policy.py~L2080</a></p>
<pre><code class="language-diff"> 
         if (
             self.config[ENTITY_RECOGNITION]
-            and text_output is not None
-            and text_sequence_lengths is not None
+                and text_output is not None
+                and text_sequence_lengths is not None
         ):
             pred_ids, confidences = self._batch_predict_entities(
                 tf_batch_data,
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/policies/unexpected_intent_policy.py#L756'>rasa/core/policies/unexpected_intent_policy.py~L756</a></p>
<pre><code class="language-diff">         # the query intent is not the top likely intent
         if (
             query_intent_similarity &lt; self.label_thresholds[query_intent_id]
-            and query_intent_id != highest_likely_intent_id
+                and query_intent_id != highest_likely_intent_id
         ):
             logger.debug(
                 f&quot;Intent `{query_intent}-{query_intent_id}` unlikely to occur here.&quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/processor.py#L585'>rasa/core/processor.py~L585</a></p>
<pre><code class="language-diff"> 
             if (
                 reminder_event.kill_on_user_message
-                and self._has_message_after_reminder(tracker, reminder_event)
-                or not self._is_reminder_still_valid(tracker, reminder_event)
+                    and self._has_message_after_reminder(tracker, reminder_event)
+                    or not self._is_reminder_still_valid(tracker, reminder_event)
             ):
                 logger.debug(
                     f&quot;Canceled reminder because it is outdated ({reminder_event}).&quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/processor.py#L816'>rasa/core/processor.py~L816</a></p>
<pre><code class="language-diff">     def _should_handle_message(tracker: DialogueStateTracker) -&gt; bool:
         return not tracker.is_paused() or (
             tracker.latest_message is not None
-            and tracker.latest_message.intent.get(INTENT_NAME_KEY)
-            == USER_INTENT_RESTART
+                and tracker.latest_message.intent.get(INTENT_NAME_KEY)
+                    == USER_INTENT_RESTART
         )
 
     def is_action_limit_reached(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/processor.py#L844'>rasa/core/processor.py~L844</a></p>
<pre><code class="language-diff"> 
         return (
             num_predicted_actions &gt;= self.max_number_of_predictions
-            and should_predict_another_action
+                and should_predict_another_action
         )
 
     async def _run_prediction_loop(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/processor.py#L1081'>rasa/core/processor.py~L1081</a></p>
<pre><code class="language-diff">         time_delta_in_seconds = time.time() - user_uttered_event.timestamp
         has_expired = (
             time_delta_in_seconds / 60
-            &gt; self.domain.session_config.session_expiration_time
+                &gt; self.domain.session_config.session_expiration_time
         )
         if has_expired:
             logger.debug(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L236'>rasa/core/test.py~L236</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;Checks if intent, entity or action predictions don't match expected ones.&quot;&quot;&quot;
         return (
             self.intent_predictions != self.intent_targets
-            or self._check_entity_prediction_target_mismatch()
-            or self.action_predictions != self.action_targets
+                or self._check_entity_prediction_target_mismatch()
+                or self.action_predictions != self.action_targets
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L285'>rasa/core/test.py~L285</a></p>
<pre><code class="language-diff">         texts = sorted(
             set(
                 [str(e.get(&quot;text&quot;, &quot;&quot;)) for e in self.entity_targets]
-                + [str(e.get(&quot;text&quot;, &quot;&quot;)) for e in self.entity_predictions]
+                    + [str(e.get(&quot;text&quot;, &quot;&quot;)) for e in self.entity_predictions]
             )
         )
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L340'>rasa/core/test.py~L340</a></p>
<pre><code class="language-diff"> 
         predictions = (
             self.action_predictions
-            + self.intent_predictions
-            + aligned_entity_predictions
+                + self.intent_predictions
+                + aligned_entity_predictions
         )
         return targets, predictions
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L648'>rasa/core/test.py~L648</a></p>
<pre><code class="language-diff">     &quot;&quot;&quot;
     if (
         isinstance(predicted_action, ActionRetrieveResponse)
-        and expected_action_name != predicted_action.name()
+            and expected_action_name != predicted_action.name()
     ):
         full_retrieval_name = predicted_action.get_full_retrieval_name(partial_tracker)
         predicted_action_name = (
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L674'>rasa/core/test.py~L674</a></p>
<pre><code class="language-diff">     )
     if (
         prediction.policy_name
-        and predicted_action != expected_action
-        and _form_might_have_been_rejected(
-            processor.domain, partial_tracker, predicted_action
-        )
+            and predicted_action != expected_action
+            and _form_might_have_been_rejected(
+                processor.domain, partial_tracker, predicted_action
+            )
     ):
         # Wrong action was predicted,
         # but it might be Ok if form action is rejected.
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L767'>rasa/core/test.py~L767</a></p>
<pre><code class="language-diff">         )
         if (
             fail_on_prediction_errors
-            and predicted_action != ACTION_UNLIKELY_INTENT_NAME
-            and predicted_action != expected_action
+                and predicted_action != ACTION_UNLIKELY_INTENT_NAME
+                and predicted_action != expected_action
         ):
             story_dump = YAMLStoryWriter().dumps(partial_tracker.as_story().story_steps)
             error_msg = (
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L805'>rasa/core/test.py~L805</a></p>
<pre><code class="language-diff"> ) -&gt; bool:
     return (
         tracker.active_loop_name == predicted_action_name
-        and predicted_action_name in domain.form_names
+            and predicted_action_name in domain.form_names
     )
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L898'>rasa/core/test.py~L898</a></p>
<pre><code class="language-diff">         a[&quot;action&quot;]
         for a in action_list
         if a[&quot;policy&quot;]
-        and not rasa.core.policies.ensemble.is_not_in_training_data(a[&quot;policy&quot;])
+            and not rasa.core.policies.ensemble.is_not_in_training_data(a[&quot;policy&quot;])
     ]
 
     return len(in_training_data) / len(action_list) if action_list else 0
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L924'>rasa/core/test.py~L924</a></p>
<pre><code class="language-diff">         for event in tracker.applied_events():
             if (
                 isinstance(event, WronglyPredictedAction)
-                and event.action_name_prediction == ACTION_UNLIKELY_INTENT_NAME
+                    and event.action_name_prediction == ACTION_UNLIKELY_INTENT_NAME
             ):
                 max_severity = max(
                     max_severity,
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L990'>rasa/core/test.py~L990</a></p>
<pre><code class="language-diff"> 
             if any(
                 isinstance(event, WronglyPredictedAction)
-                and event.action_name_prediction == ACTION_UNLIKELY_INTENT_NAME
+                    and event.action_name_prediction == ACTION_UNLIKELY_INTENT_NAME
                 for event in predicted_tracker.events
             ):
                 stories_with_warnings.append(predicted_tracker)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/test.py#L1027'>rasa/core/test.py~L1027</a></p>
<pre><code class="language-diff">     for event in step.events:
         if (
             isinstance(event, WronglyPredictedAction)
-            and event.action_name
-            == event.action_name_prediction
-            == ACTION_UNLIKELY_INTENT_NAME
+                and event.action_name
+                    == event.action_name_prediction
+                    == ACTION_UNLIKELY_INTENT_NAME
         ):
             continue
         events.append(event)
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L555'>rasa/core/training/interactive.py~L555</a></p>
<pre><code class="language-diff">         if isinstance(event, ActionExecuted):
             if (
                 event.action_name == ACTION_UNLIKELY_INTENT_NAME
-                and event.confidence == 0
+                    and event.confidence == 0
             ):
                 continue
             bot_column.append(colored(str(event), &quot;autocyan&quot;))
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L842'>rasa/core/training/interactive.py~L842</a></p>
<pre><code class="language-diff">                 interactive_story_counter += 1
                 f.write(
                     &quot;\n&quot;
-                    + tracker.export_stories(
-                        writer=writer,
-                        should_append_stories=should_append_stories,
-                        e2e=SAVE_IN_E2E,
-                    )
+                        + tracker.export_stories(
+                            writer=writer,
+                            should_append_stories=should_append_stories,
+                            e2e=SAVE_IN_E2E,
+                        )
                 )
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L928'>rasa/core/training/interactive.py~L928</a></p>
<pre><code class="language-diff">             e[&quot;name&quot;]
             for e in actions
             if e[&quot;name&quot;] not in rasa.shared.core.constants.DEFAULT_ACTION_NAMES
-            and e[&quot;name&quot;] not in old_domain.form_names
+                and e[&quot;name&quot;] not in old_domain.form_names
         }
     )
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L1055'>rasa/core/training/interactive.py~L1055</a></p>
<pre><code class="language-diff">     &quot;&quot;&quot;Check if the form got rejected with the most recent action name.&quot;&quot;&quot;
     return (
         tracker.get(ACTIVE_LOOP, {}).get(LOOP_NAME)
-        and action_name != tracker[ACTIVE_LOOP][LOOP_NAME]
-        and action_name != ACTION_LISTEN_NAME
+            and action_name != tracker[ACTIVE_LOOP][LOOP_NAME]
+            and action_name != ACTION_LISTEN_NAME
     )
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L1064'>rasa/core/training/interactive.py~L1064</a></p>
<pre><code class="language-diff">     &quot;&quot;&quot;Check whether the form is called again after it was rejected.&quot;&quot;&quot;
     return (
         tracker.get(ACTIVE_LOOP, {}).get(LOOP_REJECTED)
-        and tracker.get(&quot;latest_action_name&quot;) == ACTION_LISTEN_NAME
-        and action_name == tracker.get(ACTIVE_LOOP, {}).get(LOOP_NAME)
+            and tracker.get(&quot;latest_action_name&quot;) == ACTION_LISTEN_NAME
+            and action_name == tracker.get(ACTIVE_LOOP, {}).get(LOOP_NAME)
     )
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L1326'>rasa/core/training/interactive.py~L1326</a></p>
<pre><code class="language-diff"> def _is_same_entity_annotation(entity: Dict[Text, Any], other: Dict[Text, Any]) -&gt; bool:
     return (
         entity[&quot;value&quot;] == other[&quot;value&quot;]
-        and entity[&quot;entity&quot;] == other[&quot;entity&quot;]
-        and entity.get(&quot;group&quot;) == other.get(&quot;group&quot;)
-        and entity.get(&quot;role&quot;) == other.get(&quot;group&quot;)
+            and entity[&quot;entity&quot;] == other[&quot;entity&quot;]
+            and entity.get(&quot;group&quot;) == other.get(&quot;group&quot;)
+            and entity.get(&quot;role&quot;) == other.get(&quot;group&quot;)
     )
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/training/interactive.py#L1731'>rasa/core/training/interactive.py~L1731</a></p>
<pre><code class="language-diff">         if all(
             [
                 terminaltables.width_and_alignment.visible_width(line)
-                &lt;= monospace_wrapping_width
+                    &lt;= monospace_wrapping_width
                 for line in lines
             ]
         ):
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/core/utils.py#L293'>rasa/core/utils.py~L293</a></p>
<pre><code class="language-diff">     # `lock_store` is `None` or `EndpointConfig`
     return (
         lock_store is not None
-        and isinstance(lock_store, EndpointConfig)
-        and lock_store.type != &quot;in_memory&quot;
+            and isinstance(lock_store, EndpointConfig)
+            and lock_store.type != &quot;in_memory&quot;
     )
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/caching.py#L234'>rasa/engine/caching.py~L234</a></p>
<pre><code class="language-diff">             entry
             for entry in all_entries
             if version.parse(MINIMUM_COMPATIBLE_VERSION)
-            &gt; version.parse(entry.rasa_version)
+                &gt; version.parse(entry.rasa_version)
         ]
 
     def _delete_incompatible_entries_from_cache(
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/caching.py#L337'>rasa/engine/caching.py~L337</a></p>
<pre><code class="language-diff">                     self._cache_location,
                     filenames_to_exclude=[self._cache_database_name],
                 )
-                + output_size
-                &gt; self._max_cache_size
+                    + output_size
+                    &gt; self._max_cache_size
             ):
                 self._drop_least_recently_used_item()
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/recipes/default_recipe.py#L207'>rasa/engine/recipes/default_recipe.py~L207</a></p>
<pre><code class="language-diff"> 
         self._use_end_to_end = (
             self._use_nlu
-            and self._use_core
-            and training_type == TrainingType.END_TO_END
+                and self._use_core
+                and training_type == TrainingType.END_TO_END
         )
 
         self._is_finetuning = is_finetuning
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/recipes/default_recipe.py#L312'>rasa/engine/recipes/default_recipe.py~L312</a></p>
<pre><code class="language-diff"> 
             if (
                 self.ComponentType.POLICY_WITHOUT_END_TO_END_SUPPORT in component.types
-                or self.ComponentType.POLICY_WITH_END_TO_END_SUPPORT in component.types
+                    or self.ComponentType.POLICY_WITH_END_TO_END_SUPPORT
+                        in component.types
             ):
                 raise InvalidConfigException(
                     f&quot;Found policy '{component_name}' in NLU pipeline. Policies should &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/recipes/default_recipe.py#L464'>rasa/engine/recipes/default_recipe.py~L464</a></p>
<pre><code class="language-diff"> 
         if (
             self._is_finetuning
-            and &quot;finetuning_epoch_fraction&quot; in cli_parameters
-            and EPOCHS in component.get_default_config()
+                and &quot;finetuning_epoch_fraction&quot; in cli_parameters
+                and EPOCHS in component.get_default_config()
         ):
             old_number_epochs = component_config.get(
                 EPOCHS, component.get_default_config()[EPOCHS]
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/recipes/default_recipe.py#L866'>rasa/engine/recipes/default_recipe.py~L866</a></p>
<pre><code class="language-diff">             )
             if (
                 self.ComponentType.POLICY_WITH_END_TO_END_SUPPORT in component.types
-                and node_with_e2e_features
+                    and node_with_e2e_features
             ):
                 needs[&quot;precomputations&quot;] = node_with_e2e_features
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/recipes/default_recipe.py#L1105'>rasa/engine/recipes/default_recipe.py~L1105</a></p>
<pre><code class="language-diff"> 
         return (
             bool(content)
-            and missing_keys
-            == DefaultV1Recipe._get_missing_config_keys(content, training_type)
-            and auto_configured_keys
-            == DefaultV1Recipe._get_unspecified_autoconfigurable_keys(
-                content, training_type
-            )
+                and missing_keys
+                    == DefaultV1Recipe._get_missing_config_keys(content, training_type)
+                and auto_configured_keys
+                    == DefaultV1Recipe._get_unspecified_autoconfigurable_keys(
+                        content, training_type
+                    )
         )
 
     @staticmethod
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/validation.py#L211'>rasa/engine/validation.py~L211</a></p>
<pre><code class="language-diff"> 
     if (
         language
-        and supported_languages is not None
-        and language not in supported_languages
+            and supported_languages is not None
+            and language not in supported_languages
     ):
         raise GraphSchemaValidationException(
             f&quot;The component '{node.uses.__name__}' does not support the currently &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/validation.py#L221'>rasa/engine/validation.py~L221</a></p>
<pre><code class="language-diff"> 
     if (
         language
-        and not_supported_languages is not None
-        and language in not_supported_languages
+            and not_supported_languages is not None
+            and language in not_supported_languages
     ):
         raise GraphSchemaValidationException(
             f&quot;The component '{node.uses.__name__}' does not support the currently &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/validation.py#L263'>rasa/engine/validation.py~L263</a></p>
<pre><code class="language-diff">         type_info[param_name] = ParameterInfo(
             type_annotation=type_annotation,
             is_variable_length_keyword_arg=inspect_info.kind
-            == inspect.Parameter.VAR_KEYWORD,
+                == inspect.Parameter.VAR_KEYWORD,
             has_default=inspect_info.default != inspect.Parameter.empty,
         )
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/engine/validation.py#L334'>rasa/engine/validation.py~L334</a></p>
<pre><code class="language-diff">         param_name
         for param_name, param in fn_params.items()
         if not param.has_default
-        and not param.is_variable_length_keyword_arg
-        and param_name not in keywords
+            and not param.is_variable_length_keyword_arg
+            and param_name not in keywords
     }
 
 
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/graph_components/validators/default_recipe_validator.py#L133'>rasa/graph_components/validators/default_recipe_validator.py~L133</a></p>
<pre><code class="language-diff">         &quot;&quot;&quot;
         if (
             training_data.response_examples
-            and ResponseSelector not in self._component_types
+                and ResponseSelector not in self._component_types
         ):
             rasa.shared.utils.io.raise_warning(
                 f&quot;You have defined training data with examples for training a response &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/graph_components/validators/default_recipe_validator.py#L242'>rasa/graph_components/validators/default_recipe_validator.py~L242</a></p>
<pre><code class="language-diff"> 
         if (
             training_data.entity_synonyms
-            and EntitySynonymMapper not in self._component_types
+                and EntitySynonymMapper not in self._component_types
         ):
             rasa.shared.utils.io.raise_warning(
                 f&quot;You have defined synonyms in your training data, but &quot;
</code></pre>
<p><a href='https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/rasa/graph_components/validators/default_recipe_validator.py#L357'>rasa/graph_components/validators/default_recipe_validator.py~L357</a></p>
<pre><code class="language-diff">             if issubclass(node.uses, Featurizer)
             # Featurizers are split in `train` and `process_training_data` -
             # we only need to look at the node...*[Comment body truncated]*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-04-08 07:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:02:47 UTC
    </footer>
</body>
</html>
