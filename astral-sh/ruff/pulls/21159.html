<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix generic inference for non-dataclass inheriting from generic dataclass - astral-sh/ruff #21159</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix generic inference for non-dataclass inheriting from generic dataclass</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21159">#21159</a>
        opened by <a href="https://github.com/saada">@saada</a>
        on 2025-10-31 03:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/saada">@saada</a> on 2025-10-31 03:26</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes https://github.com/astral-sh/ty/issues/1427</p>
<p>This PR fixes a regression introduced in alpha.24 where non-dataclass children of generic dataclasses lost generic type parameter information during <code>__init__</code> synthesis.</p>
<p>The issue occurred because when looking up inherited members in the MRO, the child class's <code>inherited_generic_context</code> was correctly passed down, but <code>own_synthesized_member()</code> (which synthesizes dataclass <code>__init__</code> methods) didn't accept this parameter. It only used <code>self.inherited_generic_context(db)</code>, which returned the parent's context instead of the child's.</p>
<p>The fix threads the child's generic context through to the synthesis logic, allowing proper generic type inference for inherited dataclass constructors.</p>
<h2>Test Plan</h2>
<ul>
<li>Added regression test for non-dataclass inheriting from generic dataclass</li>
<li>Verified the exact repro case from the issue now works</li>
<li>All 277 mdtest tests passing</li>
<li>Clippy clean</li>
<li>Manually verified with Python runtime, mypy, and pyright - all accept this code pattern</li>
</ul>
<h2>Verification</h2>
<p>Tested against multiple type checkers:</p>
<ul>
<li>✅ Python runtime: Code works correctly</li>
<li>✅ mypy: No issues found</li>
<li>✅ pyright: 0 errors, 0 warnings</li>
<li>✅ ty alpha.23: Worked (before regression)</li>
<li>❌ ty alpha.24: Regression</li>
<li>✅ ty with this fix: Works correctly</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @saada on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @saada on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @saada on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @saada on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-31 10:21</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-31 10:22</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-10-31 10:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-31 10:57</div>
            <div class="timeline-body"><p>Thank you for working on this. It looks like mdformat broke the Markdown tests. This can happen if the line becomes too long. You can put the <code># revealed: …</code> assertion in a separate line above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-31 12:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/dataclasses/dataclasses.md</code>:861 on 2025-10-31 12:54</div>
            <div class="timeline-body"><p>Thank you for highlighting this. I opened https://github.com/astral-sh/ty/issues/1461 to track this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2025-10-31 12:55</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-10-31 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-10-31 12:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:00:13 UTC
    </footer>
</body>
</html>
