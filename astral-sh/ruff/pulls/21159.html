<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix generic inference for non-dataclass inheriting from generic dataclass - astral-sh/ruff #21159</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix generic inference for non-dataclass inheriting from generic dataclass</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21159">#21159</a>
        opened by <a href="https://github.com/saada">@saada</a>
        on 2025-10-31 03:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/saada">@saada</a></div>
            <div class="timeline-body">Summary
<p>Fixes <a href="https://github.com/astral-sh/ty/issues/1427">astral-sh/ty#1427</a></p>
<p>This PR fixes a regression introduced in alpha.24 where non-dataclass children of generic dataclasses lost generic type parameter information during <code>__init__</code> synthesis.</p>
<p>The issue occurred because when looking up inherited members in the MRO, the child class&#x27;s <code>inherited_generic_context</code> was correctly passed down, but <code>own_synthesized_member()</code> (which synthesizes dataclass <code>__init__</code> methods) didn&#x27;t accept this parameter. It only used <code>self.inherited_generic_context(db)</code>, which returned the parent&#x27;s context instead of the child&#x27;s.</p>
<p>The fix threads the child&#x27;s generic context through to the synthesis logic, allowing proper generic type inference for inherited dataclass constructors.</p>
Test Plan
<ul>
<li>Added regression test for non-dataclass inheriting from generic dataclass</li>
<li>Verified the exact repro case from the issue now works</li>
<li>All 277 mdtest tests passing</li>
<li>Clippy clean</li>
<li>Manually verified with Python runtime, mypy, and pyright - all accept this code pattern</li>
</ul>
Verification
<p>Tested against multiple type checkers:</p>
<ul>
<li>✅ Python runtime: Code works correctly</li>
<li>✅ mypy: No issues found</li>
<li>✅ pyright: 0 errors, 0 warnings</li>
<li>✅ ty alpha.23: Worked (before regression)</li>
<li>❌ ty alpha.24: Regression</li>
<li>✅ ty with this fix: Works correctly</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/saada">@saada</a> on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/saada">@saada</a> on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/saada">@saada</a> on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/saada">@saada</a> on 2025-10-31 03:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-31 10:21</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-31 10:22</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-31 10:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-31 10:57</div>
            <div class="timeline-body"><p>Thank you for working on this. It looks like mdformat broke the Markdown tests. This can happen if the line becomes too long. You can put the <code># revealed: …</code> assertion in a separate line above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-31 12:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/dataclasses/dataclasses.md</code>:861 on 2025-10-31 12:54</div>
            <div class="timeline-body"><p>Thank you for highlighting this. I opened <a href="https://github.com/astral-sh/ty/issues/1461">astral-sh/ty#1461</a> to track this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2025-10-31 12:55</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-31 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-31 12:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:02 UTC
    </footer>
</body>
</html>
