<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>red-knot: move symbol lookups in `symbol.rs` - astral-sh/ruff #16152</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>red-knot: move symbol lookups in <code>symbol.rs</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16152">#16152</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-02-14 03:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>This PR does the following:</p>
<ul>
<li>Moves the following from <code>types.rs</code> in <code>symbol.rs</code>:<ul>
<li><code>symbol</code></li>
<li><code>global_symbol</code></li>
<li><code>imported_symbol</code></li>
<li><code>symbol_from_bindings</code></li>
<li><code>symbol_from_declarations</code></li>
<li><code>SymbolAndQualifiers</code></li>
<li><code>SymbolFromDeclarationsResult</code></li>
</ul>
</li>
<li>Moves the following from <code>stdlib.rs</code> in <code>symbol.rs</code> and removes <code>stdlib.rs</code>:<ul>
<li><code>known_module_symbol</code></li>
<li><code>builtins_symbol</code></li>
<li><code>typing_symbol</code> (only for tests)</li>
<li><code>typing_extensions_symbol</code></li>
<li><code>builtins_module_scope</code></li>
<li><code>core_module_scope</code></li>
</ul>
</li>
<li>Add <code>symbol_from_bindings_impl</code> and <code>symbol_from_declarations_impl</code> to keep <code>RequiresExplicitReExport</code> an implementation detail</li>
<li>Make <code>declaration_type</code> a <code>pub(crate)</code> as it&#x27;s required in <code>symbol_from_declarations</code> (<code>binding_type</code> is already <code>pub(crate)</code></li>
</ul>
<p>The main motivation is to keep the implementation details private and only expose an ergonomic API which uses sane defaults for various scenario to avoid any mistakes from the caller. Refer to <a href="https://github.com/astral-sh/ruff/pull/16133">astral-sh/ruff#16133</a>#discussion_r1955262772, <a href="https://github.com/astral-sh/ruff/pull/16133">astral-sh/ruff#16133</a>#issue-2850146612 for details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-14 03:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-14 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-14 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-14 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-14 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-14 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-02-14 13:48</div>
            <div class="timeline-body"><p>Nice! It&#x27;s great to move these out of <code>types.rs</code>.</p>
<p>Bikeshedding: I&#x27;m wondering if we should put these in a new submodule (<code>lookup.rs</code>?) rather than <code>symbol.rs</code>. The APIs in <code>symbol.rs</code> are currently quite abstract and don&#x27;t have much to do with the business of implementing Python&#x27;s lookup semantics correctly; these APIs we&#x27;re moving here feel a little different from that. I don&#x27;t have a strong opinion, however; I&#x27;m happy to go with this</p>
<p>We could also add some more doc-comments to the <code>module_type_symbol</code> function, as I mentioned in <a href="https://github.com/astral-sh/ruff/pull/16133">astral-sh/ruff#16133</a>#discussion_r1956160477</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-02-14 21:51</div>
            <div class="timeline-body"><p>Looks good to me! I agree with all of Alex&#x27;s comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-17 10:46</div>
            <div class="timeline-body"><blockquote>
<p>Bikeshedding: I&#x27;m wondering if we should put these in a new submodule (<code>lookup.rs</code>?) rather than <code>symbol.rs</code>. The APIs in <code>symbol.rs</code> are currently quite abstract and don&#x27;t have much to do with the business of implementing Python&#x27;s lookup semantics correctly; these APIs we&#x27;re moving here feel a little different from that. I don&#x27;t have a strong opinion, however; I&#x27;m happy to go with this</p>
</blockquote>
<p>We added a <code>LookupResult</code> in <code>symbol.rs</code> in <a href="https://github.com/astral-sh/ruff/pull/16160">astral-sh/ruff#16160</a> which makes me wonder if we should rename <code>symbol.rs</code> to <code>lookup.rs</code> instead.</p>
<p>But, I also see this comment on <code>LookupResult</code>:</p>
<p>https://github.com/astral-sh/ruff/blob/89cefbec07e39df143e2cbdc22cf5a5a7266cca3/crates/red_knot_python_semantic/src/symbol.rs#L176-L177</p>
<p>which makes me hesitant to do it now and can be done easily in the future as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-17 12:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-17 12:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-17 12:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:11:26 UTC
    </footer>
</body>
</html>
