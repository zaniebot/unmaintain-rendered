<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-use-pathlib`] Extend check for invalid path suffix to include the case `&quot;.&quot;` (`PTH210`) - astral-sh/ruff #14902</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-use-pathlib</code>] Extend check for invalid path suffix to include the case <code>&quot;.&quot;</code> (<code>PTH210</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14902">#14902</a>
        opened by <a href="https://github.com/TheBits">@TheBits</a>
        on 2024-12-10 23:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/TheBits">@TheBits</a> on 2024-12-10 23:33</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Hi!</p>
<p>Thank you @InSyncWithFoo for the your contribution #14779!</p>
<p>I suggest adding a test that makes use of the <code>suffix='.'</code>. It must fail. Right now, ruff doesn't show any errors in this test.</p>
<h2>Test Plan</h2>
<p>Tests fails</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dylwil3 on 2024-12-10 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dylwil3 on 2024-12-10 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dylwil3 on 2024-12-10 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-12-10 23:43</div>
            <div class="timeline-body"><p>Thanks for suggesting this test and pointing out the bug! Of course, since it fails we can't merge it in without also having the fix ðŸ˜„ Would you be interested in taking a look and fleshing out your PR? I believe this early return needs to be modified:</p>
<p>https://github.com/astral-sh/ruff/blob/d4126f6049721d3c78591b6a1c1a78f4b4081329/crates/ruff_linter/src/rules/flake8_use_pathlib/rules/dotless_pathlib_with_suffix.rs#L78-L80</p>
<p>Edit: Actually the change will be a <em>little</em> more involved because I don't think it makes sense to offer a fix in this case, so you'll have to change the rule to be only <em>sometimes</em> fixable. Let me know if you're interested and/or need any pointers navigating that change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-11 01:59</div>
            <div class="timeline-body"><p>The rule, which is currently called <code><em>dotless</em>-pathlib-with-suffix</code>, might also need to be renamed. Its documentation requires an update as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @TheBits on 2024-12-11 02:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @TheBits on 2024-12-11 02:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-11 02:18</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheBits">@TheBits</a> on 2024-12-11 02:20</div>
            <div class="timeline-body"><p>@dylwil3 Yes, I need help. I tried to figure it out and fix the <code>dotless_pathlib_with_suffix</code>. Have I made the appropriate corrections?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-11 07:41</div>
            <div class="timeline-body"><blockquote>
<p>The rule, which is currently called <code>_dotless_-pathlib-with-suffix</code>, might also need to be renamed. Its documentation requires an update as well.</p>
</blockquote>
<p>Agree, we should probably rename it to <code>invalid-pathlib-with-suffix</code> or similar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-11 07:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/dotless_pathlib_with_suffix.rs</code>:59 on 2024-12-11 07:42</div>
            <div class="timeline-body"><p>We need to update the fix title for the <code>.</code> case because the fix is always shown as help text and <em>add a leading dot</em> is misleading for <code>.</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-12-11 07:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/dotless_pathlib_with_suffix.rs</code>:102 on 2024-12-11 07:44</div>
            <div class="timeline-body"><p>I'd prefer avoiding <code>try_set_fix</code> when the check when to set a diagnostic is fairly trivial:</p>
<pre><code class="language-suggestion">		if string_value != &quot;.&quot; {
      let after_leading_quote = string.start() + first_part.flags.opener_len();
	    diagnostic.set_fix(Fix::unsafe_edit(Edit::insertion(&quot;.&quot;.to_string(), after_leading_quote)));
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> requested changes on 2024-12-11 12:38</div>
            <div class="timeline-body"><p>Looking good! In addition to Micha's suggestions, could you update the documentation comment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-12-11 12:47</div>
            <div class="timeline-body"><p>We may want to add a TODO comment for when Python 3.14 is released/supported by Ruff. The rule should revert to the original behavior in that case since <a href="https://docs.python.org/3.14/library/pathlib.html#pathlib.PurePath.suffix"><code>&quot;.&quot;</code> is a valid suffix in 3.14</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheBits">@TheBits</a> on 2024-12-11 13:31</div>
            <div class="timeline-body"><blockquote>
<p>Looking good! In addition to Micha's suggestions, could you update the documentation comment?</p>
</blockquote>
<p>Thanks! I will try to update documentation comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TheBits">@TheBits</a> reviewed on 2024-12-11 13:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/TheBits">@TheBits</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/dotless_pathlib_with_suffix.rs</code>:102 on 2024-12-11 13:50</div>
            <div class="timeline-body"><p>Thank you. This is helpful.</p>
<p>Yesterday I spent time to write this part of the function in rust. I had not understood the semantic of <code>try_to_fix</code>. I thought it was necessary to specify an <code>Err</code> if there is no fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @TheBits on 2024-12-11 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @TheBits on 2024-12-11 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @TheBits on 2024-12-11 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @AlexWaygood on 2024-12-11 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @AlexWaygood on 2024-12-11 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2024-12-11 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dhruvmanila removed by @AlexWaygood on 2024-12-11 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dylwil3 by @TheBits on 2024-12-11 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @TheBits on 2024-12-11 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:54 on 2024-12-11 19:24</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    // TODO: Since &quot;.&quot; is a correct suffix in Python 3.14,
    // we will need to update this rule and documentation
    // once Ruff supports Python 3.14.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:68 on 2024-12-11 19:27</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            &quot;Remove \&quot;.\&quot; or extend to valid suffix&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:63 on 2024-12-11 19:31</div>
            <div class="timeline-body"><p>The original message is more helpful in the majority of cases.</p>
<pre><code class="language-suggestion">        if !self.single_dot {&quot;Dotless suffix passed to `.with_suffix()`&quot;.to_string()} else {
            &quot;Invalid suffix passed to `.with_suffix()`&quot;.to_string()
         }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:41 on 2024-12-11 19:34</div>
            <div class="timeline-body"><p>I think you can just move this inside the explanation of fix safety (maybe at the end), and say</p>
<pre><code class="language-rust">/// No fix is offered if the suffix `&quot;.&quot;` is given, since the intent is unclear.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> requested changes on 2024-12-11 19:37</div>
            <div class="timeline-body"><p>Few more nits - almost there!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TheBits">@TheBits</a> reviewed on 2024-12-12 12:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/TheBits">@TheBits</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:54 on 2024-12-12 12:01</div>
            <div class="timeline-body"><p>Is there a way to get the target-version settings inside a rule handler?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TheBits">@TheBits</a> reviewed on 2024-12-12 12:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/TheBits">@TheBits</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:68 on 2024-12-12 12:07</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dylwil3 by @MichaReiser on 2024-12-12 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_use_pathlib/rules/invalid_pathlib_with_suffix.rs</code>:54 on 2024-12-12 19:15</div>
            <div class="timeline-body"><p>Yep, you'd use <code>checker.settings.target_version</code>, which spits out a <code>PythonVersion</code> enum member. But that enum doesn't yet contain <code>Py314</code>.</p>
<p>If you wanted you could use the condition <code>if checker.settings.target_version &gt; PythonVersion::Py313</code> and write the code now, but I'd rather leave this as a TODO since who knows what other changes might be made (or reverted) by the time 3.14 is released.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2024-12-12 19:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> approved on 2024-12-12 19:21</div>
            <div class="timeline-body"><p>LGTM! Thanks so much for your patience, and for the great contribution!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-use-pathlib`] The Path.with_suffix('.') test should fail (`PTH210`)" to "[`flake8-use-pathlib`] Extend check for invalid path suffix to include the case `"."` (`PTH210`)" by @dylwil3 on 2024-12-12 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2024-12-12 19:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2024-12-12 19:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:42:56 UTC
    </footer>
</body>
</html>
