<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revert &quot;Upgrade to Rust 1.82 toolchain&quot; - astral-sh/ruff #13810</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Revert &quot;Upgrade to Rust 1.82 toolchain&quot;</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13810">#13810</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-10-18 12:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Reverts astral-sh/ruff#13808</p>
<p>There&#x27;s a huge perf regression. Let&#x27;s revert this for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-18 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-18 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-18 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-18 12:16</div>
            <div class="timeline-body"><p>We should try to see if we can minimize a repro of the perf regression to &quot;just the toolchain upgrade&quot;, without any of the linter-suggested changes. (But best to do that separately; a clean revert seems like a good course of action for now.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-18 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-18 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-18 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-10-18 12:19</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/revert-13808-micha/rust-1.82">CodSpeed Performance Report</a>
Merging #13810 will <strong>improve performances by 16.31%</strong>
<p>Comparing <code>revert-13808-micha/rust-1.82</code> (bfa74ba) with <code>main</code> (ff72055)</p>
Summary
<p><code>⚡ 7</code> improvements
<code>✅ 25</code> untouched benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>revert-13808-micha/rust-1.82</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ⚡ | <code>lexer[large/dataset.py]</code> | 1.2 ms | 1.1 ms | +16.31% |
| ⚡ | <code>lexer[numpy/ctypeslib.py]</code> | 244.8 µs | 216.5 µs | +13.07% |
| ⚡ | <code>lexer[numpy/globals.py]</code> | 32.5 µs | 30.1 µs | +8.12% |
| ⚡ | <code>lexer[pydantic/types.py]</code> | 541.1 µs | 481.9 µs | +12.3% |
| ⚡ | <code>lexer[unicode/pypinyin.py]</code> | 82.4 µs | 74.1 µs | +11.21% |
| ⚡ | <code>parser[large/dataset.py]</code> | 5.1 ms | 4.8 ms | +5.41% |
| ⚡ | <code>parser[numpy/ctypeslib.py]</code> | 973.1 µs | 935.2 µs | +4.05% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-18 12:33</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-18 12:34</div>
            <div class="timeline-body"><blockquote>
<p>We should try to see if we can minimize a repro of the perf regression to &quot;just the toolchain upgrade&quot;, without any of the linter-suggested changes. (But best to do that separately; a clean revert seems like a good course of action for now.)</p>
</blockquote>
<p>There were no linter changes in the parser or lexer. So we can consider them to be isolated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-18 12:37</div>
            <div class="timeline-body"><p>I was wondering if any of the macros that changed were used by the parser or lexer. But looking again, I see that all of them except <code>cache_key</code> seem to be linter-specific macros, not ones that would be used by the parser or lexer. And even <code>cache_key</code> does not itself appear to be used in the parser or lexer.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:07:33 UTC
    </footer>
</body>
</html>
