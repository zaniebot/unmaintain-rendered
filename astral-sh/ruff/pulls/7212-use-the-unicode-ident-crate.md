```yaml
number: 7212
title: Use the unicode-ident crate
type: pull_request
state: merged
author: MichaReiser
labels:
  - breaking
  - parser
assignees: []
merged: true
base: main
head: use-unicode-ident
created_at: 2023-09-07T08:06:38Z
updated_at: 2023-09-07T08:25:33Z
url: https://github.com/astral-sh/ruff/pull/7212
synced_at: 2026-01-12T02:45:38Z
```

# Use the unicode-ident crate

---

_Pull request opened by @MichaReiser on 2023-09-07 08:06_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This PR replaces the `unic-ucd-ident` with the much faster and smaller `unicode-ident` crate. 

I don't expect this PR to improve performance in our benchmarks because

a) We have no test files with unicode identifiers
b) Our lexer has a fast path that bypasses the `is_identifier_start` for ascii characters. 

This PR further removes the emoji identifier support which is not part of [Python's identifier specification](https://docs.python.org/3/reference/lexical_analysis.html#identifiers)

## Test Plan

`cargo test`

Wait for the ecosystem check

## Performance

I extended the `unicode-ident` 's benchmark to also include `unic-ucd-ident` . `unicode-ident` outperforms it significantly

```
Running benches/ident.rs (target/release/deps/ident-ad9d9d2d593f7661)
Gnuplot not found, using plotters backend
0%-nonascii/baseline    time:   [217.56 Âµs 217.84 Âµs 218.14 Âµs]
0%-nonascii/unicode-ident
                        time:   [417.51 Âµs 418.02 Âµs 418.55 Âµs]
Found 2 outliers among 100 measurements (2.00%)
  1 (1.00%) high mild
  1 (1.00%) high severe
0%-nonascii/unicode-xid time:   [1.5056 ms 1.5061 ms 1.5066 ms]
Found 2 outliers among 100 measurements (2.00%)
  1 (1.00%) high mild
  1 (1.00%) high severe
0%-nonascii/unic-ucd-ident
                        time:   [9.8530 ms 9.8653 ms 9.8804 ms]
Found 7 outliers among 100 measurements (7.00%)
  3 (3.00%) high mild
  4 (4.00%) high severe

1%-nonascii/baseline    time:   [239.63 Âµs 240.05 Âµs 240.60 Âµs]
1%-nonascii/unicode-ident
                        time:   [442.01 Âµs 443.87 Âµs 446.10 Âµs]
1%-nonascii/unicode-xid time:   [1.5937 ms 1.5941 ms 1.5946 ms]
Found 5 outliers among 100 measurements (5.00%)
  3 (3.00%) high mild
  2 (2.00%) high severe
1%-nonascii/unic-ucd-ident
                        time:   [10.102 ms 10.145 ms 10.187 ms]

10%-nonascii/baseline   time:   [493.61 Âµs 493.94 Âµs 494.35 Âµs]
Found 14 outliers among 100 measurements (14.00%)
  1 (1.00%) low mild
  9 (9.00%) high mild
  4 (4.00%) high severe
10%-nonascii/unicode-ident
                        time:   [671.83 Âµs 672.38 Âµs 673.02 Âµs]
Found 5 outliers among 100 measurements (5.00%)
  3 (3.00%) high mild
  2 (2.00%) high severe
Benchmarking 10%-nonascii/unicode-xid: Warming up for 3.0000 s
Warning: Unable to complete 100 samples in 10.0s. You may wish to increase target time to 13.7s, enable flat sampling, or reduce sample count to 60.
10%-nonascii/unicode-xid
                        time:   [2.6001 ms 2.6043 ms 2.6094 ms]
10%-nonascii/unic-ucd-ident
                        time:   [10.434 ms 10.448 ms 10.460 ms]
Found 7 outliers among 100 measurements (7.00%)
  4 (4.00%) low severe
  1 (1.00%) high mild
  2 (2.00%) high severe

100%-nonascii/baseline  time:   [609.36 Âµs 611.90 Âµs 614.95 Âµs]
Found 25 outliers among 100 measurements (25.00%)
  25 (25.00%) low mild
100%-nonascii/unicode-ident
                        time:   [1.4087 ms 1.4127 ms 1.4161 ms]
Found 14 outliers among 100 measurements (14.00%)
  12 (12.00%) low severe
  2 (2.00%) low mild
100%-nonascii/unicode-xid
                        time:   [11.733 ms 11.742 ms 11.754 ms]
Found 6 outliers among 100 measurements (6.00%)
  3 (3.00%) high mild
  3 (3.00%) high severe
100%-nonascii/unic-ucd-ident
                        time:   [10.895 ms 10.897 ms 10.900 ms]
Found 2 outliers among 100 measurements (2.00%)
  2 (2.00%) low mild
```


---

_Comment by @MichaReiser on 2023-09-07 08:06_

Current dependencies on/for this PR:
* main
  * **PR #7212** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7212" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7212?utm_source=stack-comment).

---

_Label `breaking` added by @MichaReiser on 2023-09-07 08:08_

---

_Label `parser` added by @MichaReiser on 2023-09-07 08:08_

---

_@konstin approved on 2023-09-07 08:12_

---

_Comment by @konstin on 2023-09-07 08:13_

> This PR further removes the emoji identifier support which is not part of [Python's identifier specification](https://docs.python.org/3/reference/lexical_analysis.html#identifiers)

A test for that would be good

---

_Merged by @MichaReiser on 2023-09-07 08:19_

---

_Closed by @MichaReiser on 2023-09-07 08:19_

---

_Branch deleted on 2023-09-07 08:19_

---

_Comment by @github-actions[bot] on 2023-09-07 08:25_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---
