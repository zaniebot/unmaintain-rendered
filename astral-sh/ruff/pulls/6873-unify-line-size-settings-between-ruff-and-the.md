```yaml
number: 6873
title: Unify line size settings between ruff and the formatter
type: pull_request
state: merged
author: konstin
labels:
  - breaking
  - formatter
assignees: []
merged: true
base: main
head: merge-line-sizings
created_at: 2023-08-25T13:27:04Z
updated_at: 2023-08-28T06:45:09Z
url: https://github.com/astral-sh/ruff/pull/6873
synced_at: 2026-01-12T15:55:22Z
```

# Unify line size settings between ruff and the formatter

---

_@konstin_

**Summary** Previuosly, there had been `LineLength` in ruff and `LineWidth` in the formatter. `LineLength` was a lenient usize wrapper, while `LineWidth` was a strict u16. With the formatter moving into the ruff cli, we need to unify the two types. This PR makes both crates share a new `LineLength` type based on the previous ruff formatter type. It currently lives in `ruff_python_trivia` but i'm happy to move it wherever. 

This is technically a breaking change because the line limit afterwards has a limit of 320 that it didn't have before.

**Test Plan** No functional changes.


---

_Comment by @konstin on 2023-08-25 13:27_

Current dependencies on/for this PR:
* main
  * **PR #6871** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6871" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #6873** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6873" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6873?utm_source=stack-comment).

---

_Label `formatter` added by @konstin on 2023-08-25 13:38_

---

_Label `breaking` added by @konstin on 2023-08-25 13:38_

---

_Comment by @github-actions[bot] on 2023-08-25 14:06_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Marked ready for review by @konstin on 2023-08-25 15:22_

---

_@konstin reviewed on 2023-08-25 15:25_

---

_Review comment by @konstin on `scripts/add_rule.py`:143 on 2023-08-25 15:25_

that's the deviation from black we're introducing, i'm using it to confirm that it actually formats

---

_Assigned to @MichaReiser by @MichaReiser on 2023-08-25 15:28_

---

_@MichaReiser reviewed on 2023-08-25 15:59_

---

_Review comment by @MichaReiser on `crates/ruff_python_trivia/src/line_width.rs`:14 on 2023-08-25 15:59_

My preference is to keep them separate. The `LineLength` in the settings builds our API to users (and the configuration), the one in the formatter doesn't need to have the same constraints. The way I would avoid too much duplicate code is to only implement the parsing on the `LineLength` in the settings crate (and remove it from `ruff_formatter`). It is no longer needed on the formatter because we can directly convert between the two without needing any parsing.

Edit: To extend on this. We'll likely need multiple types in the future to avoid otherwise unnecessary dependencies between crates. What I envision is that our settings represent the tool agnostic configuration (and can depend on all tools). However, what we pass to individual tools is only the resolved configuration relevant for that tool. This will lead to some code duplication but most of it are simple structs with very little behavior (cheap to maintain)

---

_@MichaReiser reviewed on 2023-08-25 16:21_

---

_Review comment by @MichaReiser on `crates/ruff_python_trivia/src/line_width.rs`:14 on 2023-08-25 16:21_

I can make that change on Monday

---

_Review comment by @MichaReiser on `crates/ruff_cli/src/commands/format.rs`:54 on 2023-08-26 15:51_

It's unfortunate that `LineLength` cannot implement `Into<LineWidth>` because it doesn't depend on `ruff_formatter` but this isn't too bad. 

We probably want to have an independent `LineLength` inside of ruff too, so that settings no longer need to depend on `ruff`.

---

_@MichaReiser reviewed on 2023-08-26 15:51_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-08-27 08:58_

---

_Renamed from "Unify line size settings between ruff and the formatter" to "Unify line size settings between ruff and the formatter" by @MichaReiser on 2023-08-28 06:28_

---

_Merged by @MichaReiser on 2023-08-28 06:44_

---

_Closed by @MichaReiser on 2023-08-28 06:44_

---

_Branch deleted on 2023-08-28 06:44_

---
