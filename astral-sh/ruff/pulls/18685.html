<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Anchor all exclude patterns - astral-sh/ruff #18685</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Anchor all exclude patterns</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18685">#18685</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-06-15 13:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-15 13:44</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>As <a href="https://github.com/astral-sh/ruff/pull/18648#discussion_r2145230097">discussed</a>, this PR changes the semantics of exclude globs to be anchored. That means, <code>src</code> now only matches <code>&lt;project_root&gt;/src</code> but no longer <code>&lt;project_root&gt;/build/src</code>. Or <code>*.py</code> now only matches python files directly inside the project root but no longer matches any file with a <code>py</code> extension.</p>
<p>The motivation for this change is to make the behavior consistent with <code>incldue</code> where anchoring is desired to allow eagerly skipping over directories that are known not to be included.</p>
<p>Just for reference:</p>
<ul>
<li>This will make ty's exclude handling slightly more incosistento to uv's build backend exclude globs. The two already differed before in that uv anchors no exclude patterns at all whereas, before this PR, ty only anchored paths containing a <code>/</code> (same as gitignore).</li>
<li>This deviats from gitignore which only anchors paths that contain a <code>/</code> (a path separator)</li>
</ul>
<h2>Test Plan</h2>
<p>Update tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-06-15 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-06-15 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-15 13:47</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-06-15 13:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/glob/portable.rs</code>:35 on 2025-06-15 13:49</div>
            <div class="timeline-body"><p>Sorry, I couldn't help myself but this small refactor allows removing a fair chunk of code and makes the API more explicit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-06-15 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-06-15 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-06-15 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-06-15 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-06-15 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-06-17 01:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @MichaReiser on 2025-06-17 06:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_project/src/glob/exclude.rs</code>:104 on 2025-06-17 12:32</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// The differences with the ignore's crate version are:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-06-17 12:34</div>
            <div class="timeline-body"><p>Nice, this seems nicer to me. :-) Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-06-18 08:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-06-18 08:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-18 08:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:39:35 UTC
    </footer>
</body>
</html>
