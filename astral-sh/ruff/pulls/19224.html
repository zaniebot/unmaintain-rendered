<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pydoclint`] Fix DOC501 false negative for relative import exceptions - astral-sh/ruff #19224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pydoclint</code>] Fix DOC501 false negative for relative import exceptions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19224">#19224</a>
        opened by <a href="https://github.com/danparizher">@danparizher</a>
        on 2025-07-09 02:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danparizher">@danparizher</a></div>
            <div class="timeline-body">Summary
<p>Fixes #19219</p>
<p>The problem occurred because the semantic model&#x27;s <code>resolve_qualified_name</code> method would fail completely when trying to resolve relative imports in standalone files where the full module path context is unavailable. The fix adds a fallback mechanism that extracts just the imported member name when full path resolution fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-09 02:26</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-07-09 02:45</div>
            <div class="timeline-body"><p>Two things I wonder:
Does this make undefined names trigger the lint, or do they still pass?
What about if the name is a builtin, like would <code>from . import NotImplementedError</code> cause the lint to not fire since it would be seen as the same as the builtin, or is there an additional mechanism that distinguishes them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danparizher">@danparizher</a> on 2025-07-09 03:38</div>
            <div class="timeline-body"><p>Good points â€” I tested out both scenarios.</p>
<ol>
<li>I&#x27;m making it such that undefined names fail at the semantic analysis stage, so <code>resolve_qualified_name</code> returns <code>None</code></li>
<li>When you do <code>from . import NotImplementedError</code>, you&#x27;re importing a local module&#x27;s <code>NotImplementedError</code>, not the builtin. My fallback mechanism treats this as a distinct qualified name from <code>builtins.NotImplementedError</code></li>
</ol>
<pre><code># Case 1: Builtin (always worked)
def test_builtin():
    &quot;&quot;&quot;Missing NotImplementedError.&quot;&quot;&quot;  # DOC501 triggers
    raise NotImplementedError

# Case 2: Relative import (now works) 
from . import NotImplementedError
def test_relative():
    &quot;&quot;&quot;Missing NotImplementedError.&quot;&quot;&quot;  # DOC501 now triggers correctly
    raise NotImplementedError
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-07-09 04:48</div>
            <div class="timeline-body"><p>I think this has introduced a false positive then, since a body of just <code>raise NotImplementedError</code> where <code>NotImplementedError</code> is the builtin shouldn&#x27;t raise <code>DOC501</code>: https://play.ruff.rs/dd531598-eaa9-4891-bbf9-5d3f745c0b23</p>
<p>From <a href="https://docs.astral.sh/ruff/rules/docstring-missing-exception/#docstring-missing-exception-doc501">docstring-missing-exception (DOC501)</a>:</p>
<blockquote>
<p>This rule is not enforced for abstract methods. It is also ignored for &quot;stub functions&quot;: functions where the body only consists of <code>pass</code>, <code>...</code>, <code>raise NotImplementedError</code>, or similar.</p>
</blockquote>
<p>And it doesn&#x27;t look like those cases were ever added to the test file either, so the change didn&#x27;t show up there either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danparizher">@danparizher</a> on 2025-07-09 21:59</div>
            <div class="timeline-body"><p>That makes sense; I messed up the implementation on the first passthrough by modifying the core <code>resolve_qualified_name</code>, which broke the stub function detection, so it might make more sense to target the fallback inside DOC501 itself. Would that make sense? Not sure if there are other edge cases or an entirely different approach that would be more effective</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-07-09 22:08</div>
            <div class="timeline-body"><p>That was my initial idea, but I&#x27;m not sure what the output of <code>resolve_qualified_name</code> / all of that part of the semantic model looks like, so I&#x27;m not sure.</p>
<p>It also looks like you might have leftover 1 line changes from the old change in <code>crates/ruff_python_semantic/src/model.rs</code> / <code>crates/ruff_linter/src/rules/pyupgrade/snapshots/ruff_linter__rules__pyupgrade__tests__UP024_0.py.snap</code>? Unsure on the snap since the test passes, but not sure why your change still affects that one snap.</p>
<p>It also would be a good idea to add at least the <code>raise NotImplementedError</code> case as a test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danparizher">@danparizher</a> on 2025-07-09 22:39</div>
            <div class="timeline-body"><p>That&#x27;s true... I&#x27;m not too sure why those <code>pyupgrade</code> tests would be passingâ€”this is where my knowledge plateaus ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-11 16:25</div>
            <div class="timeline-body"><p>I&#x27;m not sure if fixing this for this rule only is the right fix. I think we should look into why the semantic model can&#x27;t resolve the relative import and see if we can fix that instead. That would benefit all rules instead of just the one rule here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-18 07:37</div>
            <div class="timeline-body"><p>@danparizher do you plan to come back to this PR or should we close it for now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danparizher">@danparizher</a> on 2025-08-18 07:40</div>
            <div class="timeline-body"><p>@MichaReiser I&#x27;ll take another look at it this week</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/danparizher">@danparizher</a> on 2025-08-20 20:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:25 UTC
    </footer>
</body>
</html>
