<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove dependency on `ruff_rowan` - astral-sh/ruff #2875</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove dependency on <code>ruff_rowan</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2875">#2875</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-02-13 23:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>This PR removes the dependency on <code>ruff_rowan</code> (i.e., Rome&#x27;s fork of rust-analyzer&#x27;s <code>rowan</code>), and in turn, trims out a lot of code in <code>ruff_formatter</code> that isn&#x27;t necessary (or isn&#x27;t <em>yet</em> necessary) to power the autoformatter.</p>
<p>We may end up pulling some of this back in -- TBD. For example, the autoformatter has its own comment representation right now, but we may eventually want to use the <code>comments.rs</code> data structures defined in <code>rome_formatter</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autoformatter</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-13 23:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-13 23:37</div>
            <div class="timeline-body"><p>\cc @MichaReiser</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_formatter/src/format_extensions.rs</code>:71 on 2023-02-14 08:50</div>
            <div class="timeline-body"><p>You probably want to keep this around. Memoization is essential to get good formatting performance when using the <code>BestFitting</code> IR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_formatter/src/lib.rs</code>:229 on 2023-02-14 08:52</div>
            <div class="timeline-body"><p>We may need source maps in the long term to enable range formatting (formatting the selected text) or to suppress formatting of specific nodes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_formatter/src/token/number.rs</code>:9 on 2023-02-14 08:54</div>
            <div class="timeline-body"><p>We may use some of this (together with <code>string</code>) to normalize the string/number content. But we can pull this in when needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_formatter/Cargo.toml</code>:11 on 2023-02-14 08:55</div>
            <div class="timeline-body"><p>Did you verify if all these dependencies are still needed? https://github.com/est31/cargo-udeps</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-02-14 08:55</div>
            <div class="timeline-body"><p>LGTM</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-02-15 03:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_formatter/src/token/number.rs</code>:9 on 2023-02-15 03:37</div>
            <div class="timeline-body"><p>Yeah we&#x27;ll absolutely need this kind of logic. But does it belong here, or in <code>ruff_python_formatter</code>? Black has rules around this stuff, but some of it is Python-specific (e.g., for complex numbers).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-02-15 03:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_formatter/Cargo.toml</code>:11 on 2023-02-15 03:42</div>
            <div class="timeline-body"><p>Was able to remove a handful of them -- good call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 03:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-15 03:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-02-15 03:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:52:16 UTC
    </footer>
</body>
</html>
