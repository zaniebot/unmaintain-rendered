<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make RET504 also work with StmtAugAssign and StmtAnnAssign AST nodes - astral-sh/ruff #9348</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make RET504 also work with StmtAugAssign and StmtAnnAssign AST nodes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9348">#9348</a>
        opened by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a>
        on 2024-01-01 16:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/evanrittenhouse">@evanrittenhouse</a></div>
            <div class="timeline-body">

Summary


<p>Closes #9327</p>
Test Plan


<p>Unit tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2024-01-01 17:27</div>
            <div class="timeline-body"><p>This feels like it should be controlled by a rule level setting as this return statement has slightly different semantics if it&#x27;s a list / mutable type. Perhaps the additional constraint that this only be applied if the object is an immutable type should be applied?</p>
<pre><code>a = [1]
def f(c):
    c += [2]
    return c

assert a is f(a)

c = [1]

def g(c):
    return c + [2]

assert c is g(c)
</code></pre>
<p>the top assertion will pass while the 2nd assertion will fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2024-01-01 17:39</div>
            <div class="timeline-body"><blockquote>
<p>Perhaps the additional constraint that this only be applied if the object is an immutable type should be applied?</p>
</blockquote>
<p>AFAIK Ruff doesn&#x27;t know how to check static types (maybe something&#x27;s changed since I was last around). I&#x27;m happy to remove the <code>Name</code> clause in the match statement and leave it as only making the change if we see a <code>NumberLiteral</code> though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-01-01 17:53</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+58 -0 violations, +0 -0 fixes in 5 projects; 36 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+28 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/example_dags/example_bash_decorator.py#L106">airflow/example_dags/example_bash_decorator.py:106:16:</a> RET504 Unnecessary assignment to `cmd` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/amazon/aws/hooks/redshift_cluster.py#L193">airflow/providers/amazon/aws/hooks/redshift_cluster.py:193:20:</a> RET504 Unnecessary assignment to `snapshot_status` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/cncf/kubernetes/hooks/kubernetes.py#L570">airflow/providers/cncf/kubernetes/hooks/kubernetes.py:570:16:</a> RET504 Unnecessary assignment to `pod` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/cncf/kubernetes/operators/pod.py#L800">airflow/providers/cncf/kubernetes/operators/pod.py:800:16:</a> RET504 Unnecessary assignment to `labels_value` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/common/sql/hooks/sql.py#L511">airflow/providers/common/sql/hooks/sql.py:511:16:</a> RET504 Unnecessary assignment to `sql` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/dbt/cloud/hooks/dbt.py#L260">airflow/providers/dbt/cloud/hooks/dbt.py:260:16:</a> RET504 Unnecessary assignment to `job_run_status` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/hooks/dataflow.py#L1355">airflow/providers/google/cloud/hooks/dataflow.py:1355:16:</a> RET504 Unnecessary assignment to `page_result` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/hooks/kubernetes_engine.py#L490">airflow/providers/google/cloud/hooks/kubernetes_engine.py:490:20:</a> RET504 Unnecessary assignment to `pod` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/operators/bigquery.py#L1001">airflow/providers/google/cloud/operators/bigquery.py:1001:16:</a> RET504 Unnecessary assignment to `query` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/operators/mlengine.py#L78">airflow/providers/google/cloud/operators/mlengine.py:78:12:</a> RET504 Unnecessary assignment to `cleansed_job_id` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/microsoft/azure/hooks/data_factory.py#L1204">airflow/providers/microsoft/azure/hooks/data_factory.py:1204:16:</a> RET504 Unnecessary assignment to `status` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/openai/hooks/openai.py#L93">airflow/providers/openai/hooks/openai.py:93:16:</a> RET504 Unnecessary assignment to `embeddings` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/weaviate/hooks/weaviate.py#L514">airflow/providers/weaviate/hooks/weaviate.py:514:16:</a> RET504 Unnecessary assignment to `results` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/weaviate/hooks/weaviate.py#L533">airflow/providers/weaviate/hooks/weaviate.py:533:16:</a> RET504 Unnecessary assignment to `results` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/serialization/serde.py#L313">airflow/serialization/serde.py:313:12:</a> RET504 Unnecessary assignment to `s` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/assign_cherry_picked_prs_with_milestone.py#L168">dev/assign_cherry_picked_prs_with_milestone.py:168:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/cdxgen.py#L127">dev/breeze/src/airflow_breeze/utils/cdxgen.py:127:12:</a> RET504 Unnecessary assignment to `port_map` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/packages.py#L599">dev/breeze/src/airflow_breeze/utils/packages.py:599:12:</a> RET504 Unnecessary assignment to `context` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/packages.py#L631">dev/breeze/src/airflow_breeze/utils/packages.py:631:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/parallel.py#L193">dev/breeze/src/airflow_breeze/utils/parallel.py:193:24:</a> RET504 Unnecessary assignment to `list_to_return` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/run_utils.py#L195">dev/breeze/src/airflow_breeze/utils/run_utils.py:195:12:</a> RET504 Unnecessary assignment to `env_to_print` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/prepare_bulk_issues.py#L105">dev/prepare_bulk_issues.py:105:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/prepare_bulk_issues.py#L79">dev/prepare_bulk_issues.py:79:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/prepare_release_issue.py#L200">dev/prepare_release_issue.py:200:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
... 4 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/io/webdriver.py#L129">src/bokeh/io/webdriver.py:129:12:</a> RET504 Unnecessary assignment to `device_pixel_ratio` before `return` statement
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/model/docs.py#L86">src/bokeh/model/docs.py:86:12:</a> RET504 Unnecessary assignment to `html` before `return` statement
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/protocol/message.py#L327">src/bokeh/protocol/message.py:327:20:</a> RET504 Unnecessary assignment to `sent` before `return` statement
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/sphinxext/bokeh_sampledata_xref.py#L219">src/bokeh/sphinxext/bokeh_sampledata_xref.py:219:12:</a> RET504 Unnecessary assignment to `line` before `return` statement
</pre>

</p>

<a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+1 -0 violations, +0 -0 fixes)
<p>

<pre>
+ <a href="https://github.com/freedomofpress/securedrop/blob/531d08696a145b26dd918abbbc68b19d4ce505c0/securedrop/pretty_bad_protocol/_parsers.py#L155">securedrop/pretty_bad_protocol/_parsers.py:155:12:</a> RET504 Unnecessary assignment to `ret` before `return` statement
</pre>

</p>

<a href="https://github.com/scikit-build/scikit-build-core">scikit-build/scikit-build-core</a> (+1 -0 violations, +0 -0 fixes)
<p>

<pre>
+ <a href="https://github.com/scikit-build/scikit-build-core/blob/38421ab55c51f989afe98ebd0276528833e6f868/src/scikit_build_core/build/_editable.py#L52">src/scikit_build_core/build/_editable.py:52:12:</a> RET504 Unnecessary assignment to `editable_txt` before `return` statement
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+24 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/tools/lib/provision_inner.py#L78">tools/lib/provision_inner.py:78:12:</a> RET504 Unnecessary assignment to `paths` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/tools/lib/provision_inner.py#L85">tools/lib/provision_inner.py:85:12:</a> RET504 Unnecessary assignment to `paths` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/tools/lib/test_script.py#L31">tools/lib/test_script.py:31:12:</a> RET504 Unnecessary assignment to `text` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/actions/invites.py#L423">zerver/actions/invites.py:423:12:</a> RET504 Unnecessary assignment to `confirmations` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/ccache.py#L197">zerver/lib/ccache.py:197:12:</a> RET504 Unnecessary assignment to `out` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/ccache.py#L214">zerver/lib/ccache.py:214:12:</a> RET504 Unnecessary assignment to `out` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/display_recipient.py#L126">zerver/lib/display_recipient.py:126:12:</a> RET504 Unnecessary assignment to `stream_display_recipients` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/message.py#L1365">zerver/lib/message.py:1365:12:</a> RET504 Unnecessary assignment to `result` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/scheduled_messages.py#L36">zerver/lib/scheduled_messages.py:36:12:</a> RET504 Unnecessary assignment to `scheduled_message_dicts` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/migrations/0383_revoke_invitations_from_deactivated_users.py#L45">zerver/migrations/0383_revoke_invitations_from_deactivated_users.py:45:16:</a> RET504 Unnecessary assignment to `confirmation_ids` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/tests/test_auth_backends.py#L2076">zerver/tests/test_auth_backends.py:2076:16:</a> RET504 Unnecessary assignment to `saml_response` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/tests/test_auth_backends.py#L2089">zerver/tests/test_auth_backends.py:2089:16:</a> RET504 Unnecessary assignment to `logout_request` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/views/message_fetch.py#L66">zerver/views/message_fetch.py:66:12:</a> RET504 Unnecessary assignment to `result` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/github/view.py#L344">zerver/webhooks/github/view.py:344:12:</a> RET504 Unnecessary assignment to `action` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/librato/view.py#L131">zerver/webhooks/librato/view.py:131:16:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/librato/view.py#L158">zerver/webhooks/librato/view.py:158:16:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/linear/view.py#L55">zerver/webhooks/linear/view.py:55:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/linear/view.py#L75">zerver/webhooks/linear/view.py:75:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/raygun/view.py#L144">zerver/webhooks/raygun/view.py:144:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/raygun/view.py#L202">zerver/webhooks/raygun/view.py:202:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
... 4 additional changes omitted for project
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RET504 | 58 | 58 | 0 | 0 | 0 |</p>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+54 -0 violations, +0 -0 fixes in 5 projects; 36 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+26 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/example_dags/example_bash_decorator.py#L106">airflow/example_dags/example_bash_decorator.py:106:16:</a> RET504 Unnecessary assignment to `cmd` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/amazon/aws/hooks/redshift_cluster.py#L193">airflow/providers/amazon/aws/hooks/redshift_cluster.py:193:20:</a> RET504 Unnecessary assignment to `snapshot_status` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/cncf/kubernetes/hooks/kubernetes.py#L570">airflow/providers/cncf/kubernetes/hooks/kubernetes.py:570:16:</a> RET504 Unnecessary assignment to `pod` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/cncf/kubernetes/operators/pod.py#L800">airflow/providers/cncf/kubernetes/operators/pod.py:800:16:</a> RET504 Unnecessary assignment to `labels_value` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/common/sql/hooks/sql.py#L511">airflow/providers/common/sql/hooks/sql.py:511:16:</a> RET504 Unnecessary assignment to `sql` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/dbt/cloud/hooks/dbt.py#L260">airflow/providers/dbt/cloud/hooks/dbt.py:260:16:</a> RET504 Unnecessary assignment to `job_run_status` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/hooks/dataflow.py#L1355">airflow/providers/google/cloud/hooks/dataflow.py:1355:16:</a> RET504 Unnecessary assignment to `page_result` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/hooks/kubernetes_engine.py#L490">airflow/providers/google/cloud/hooks/kubernetes_engine.py:490:20:</a> RET504 Unnecessary assignment to `pod` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/operators/mlengine.py#L78">airflow/providers/google/cloud/operators/mlengine.py:78:12:</a> RET504 Unnecessary assignment to `cleansed_job_id` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/microsoft/azure/hooks/data_factory.py#L1204">airflow/providers/microsoft/azure/hooks/data_factory.py:1204:16:</a> RET504 Unnecessary assignment to `status` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/openai/hooks/openai.py#L93">airflow/providers/openai/hooks/openai.py:93:16:</a> RET504 Unnecessary assignment to `embeddings` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/weaviate/hooks/weaviate.py#L514">airflow/providers/weaviate/hooks/weaviate.py:514:16:</a> RET504 Unnecessary assignment to `results` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/weaviate/hooks/weaviate.py#L533">airflow/providers/weaviate/hooks/weaviate.py:533:16:</a> RET504 Unnecessary assignment to `results` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/serialization/serde.py#L313">airflow/serialization/serde.py:313:12:</a> RET504 Unnecessary assignment to `s` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/assign_cherry_picked_prs_with_milestone.py#L168">dev/assign_cherry_picked_prs_with_milestone.py:168:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/cdxgen.py#L127">dev/breeze/src/airflow_breeze/utils/cdxgen.py:127:12:</a> RET504 Unnecessary assignment to `port_map` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/packages.py#L599">dev/breeze/src/airflow_breeze/utils/packages.py:599:12:</a> RET504 Unnecessary assignment to `context` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/packages.py#L631">dev/breeze/src/airflow_breeze/utils/packages.py:631:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/breeze/src/airflow_breeze/utils/parallel.py#L193">dev/breeze/src/airflow_breeze/utils/parallel.py:193:24:</a> RET504 Unnecessary assignment to `list_to_return` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/prepare_bulk_issues.py#L105">dev/prepare_bulk_issues.py:105:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/prepare_bulk_issues.py#L79">dev/prepare_bulk_issues.py:79:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/dev/prepare_release_issue.py#L200">dev/prepare_release_issue.py:200:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/scripts/ci/pre_commit/pre_commit_check_pre_commit_hooks.py#L124">scripts/ci/pre_commit/pre_commit_check_pre_commit_hooks.py:124:12:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/scripts/in_container/run_provider_yaml_files_check.py#L133">scripts/in_container/run_provider_yaml_files_check.py:133:12:</a> RET504 Unnecessary assignment to `all_integrations` before `return` statement
... 2 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/io/webdriver.py#L129">src/bokeh/io/webdriver.py:129:12:</a> RET504 Unnecessary assignment to `device_pixel_ratio` before `return` statement
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/model/docs.py#L86">src/bokeh/model/docs.py:86:12:</a> RET504 Unnecessary assignment to `html` before `return` statement
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/protocol/message.py#L327">src/bokeh/protocol/message.py:327:20:</a> RET504 Unnecessary assignment to `sent` before `return` statement
+ <a href="https://github.com/bokeh/bokeh/blob/929ee8ab38207eca08d1601a0164952fb21c9c6a/src/bokeh/sphinxext/bokeh_sampledata_xref.py#L219">src/bokeh/sphinxext/bokeh_sampledata_xref.py:219:12:</a> RET504 Unnecessary assignment to `line` before `return` statement
</pre>

</p>

<a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/freedomofpress/securedrop/blob/531d08696a145b26dd918abbbc68b19d4ce505c0/securedrop/pretty_bad_protocol/_parsers.py#L155">securedrop/pretty_bad_protocol/_parsers.py:155:12:</a> RET504 Unnecessary assignment to `ret` before `return` statement
</pre>

</p>

<a href="https://github.com/scikit-build/scikit-build-core">scikit-build/scikit-build-core</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/scikit-build/scikit-build-core/blob/38421ab55c51f989afe98ebd0276528833e6f868/src/scikit_build_core/build/_editable.py#L52">src/scikit_build_core/build/_editable.py:52:12:</a> RET504 Unnecessary assignment to `editable_txt` before `return` statement
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+22 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/tools/lib/test_script.py#L31">tools/lib/test_script.py:31:12:</a> RET504 Unnecessary assignment to `text` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/actions/invites.py#L423">zerver/actions/invites.py:423:12:</a> RET504 Unnecessary assignment to `confirmations` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/ccache.py#L197">zerver/lib/ccache.py:197:12:</a> RET504 Unnecessary assignment to `out` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/ccache.py#L214">zerver/lib/ccache.py:214:12:</a> RET504 Unnecessary assignment to `out` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/display_recipient.py#L126">zerver/lib/display_recipient.py:126:12:</a> RET504 Unnecessary assignment to `stream_display_recipients` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/message.py#L1365">zerver/lib/message.py:1365:12:</a> RET504 Unnecessary assignment to `result` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/lib/scheduled_messages.py#L36">zerver/lib/scheduled_messages.py:36:12:</a> RET504 Unnecessary assignment to `scheduled_message_dicts` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/migrations/0383_revoke_invitations_from_deactivated_users.py#L45">zerver/migrations/0383_revoke_invitations_from_deactivated_users.py:45:16:</a> RET504 Unnecessary assignment to `confirmation_ids` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/tests/test_auth_backends.py#L2076">zerver/tests/test_auth_backends.py:2076:16:</a> RET504 Unnecessary assignment to `saml_response` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/tests/test_auth_backends.py#L2089">zerver/tests/test_auth_backends.py:2089:16:</a> RET504 Unnecessary assignment to `logout_request` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/views/message_fetch.py#L66">zerver/views/message_fetch.py:66:12:</a> RET504 Unnecessary assignment to `result` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/github/view.py#L344">zerver/webhooks/github/view.py:344:12:</a> RET504 Unnecessary assignment to `action` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/librato/view.py#L131">zerver/webhooks/librato/view.py:131:16:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/librato/view.py#L158">zerver/webhooks/librato/view.py:158:16:</a> RET504 Unnecessary assignment to `content` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/linear/view.py#L55">zerver/webhooks/linear/view.py:55:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/linear/view.py#L75">zerver/webhooks/linear/view.py:75:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/raygun/view.py#L144">zerver/webhooks/raygun/view.py:144:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/raygun/view.py#L202">zerver/webhooks/raygun/view.py:202:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/raygun/view.py#L261">zerver/webhooks/raygun/view.py:261:12:</a> RET504 Unnecessary assignment to `message` before `return` statement
+ <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/zerver/webhooks/sonarqube/view.py#L108">zerver/webhooks/sonarqube/view.py:108:12:</a> RET504 Unnecessary assignment to `msg` before `return` statement
... 2 additional changes omitted for project
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RET504 | 54 | 54 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Skylion007">@Skylion007</a> on 2024-01-01 17:58</div>
            <div class="timeline-body"><p>@evanrittenhouse I am pretty sure RUFF has very limited static type checking (basically only if the variable is initialized inside of the function). We could use that to only flag ints, floats, and other builtin immutable types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2024-01-01 19:34</div>
            <div class="timeline-body"><p>We may just want to leave it as <code>NumberLiteral</code>s/string literals only, actually - we seemingly can&#x27;t tell, based on the AST only, if a <code>ExprName</code> refers to something immutable or not. There&#x27;s the <code>is_mutable_expr</code> helper function which we can use to check, but again, <code>ExprName</code> would be considered &quot;immutable&quot; there, and something like:</p>
<pre><code>b = []
a = [1]
b += a
return b
</code></pre>
<p>would succeed and still be &quot;unsafe&quot;.</p>
<p>So the best way forward may just be to only call this on strings/numbers. Thoughts @zanieb ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-07 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2024-01-29 23:38</div>
            <div class="timeline-body"><p>Cc @zanieb @charliermarsh wdyt of adding this as a 0.2.0 milestone? It seems to be pretty close</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-02 14:59</div>
            <div class="timeline-body"><p>Sorry about the delay here! I&#x27;ve somehow gotten to the point where GitHub mentions get buried :&#x27;(</p>
<p>I think the first thing to do is to gate the behavior with preview mode — then we can stabilize the behavior later once we&#x27;re confident it&#x27;s correct.</p>
<p>We can also consider the fix safe or unsafe depending on our ability to determine the type? I think applying this fix to the following makes sense for:</p>
<ul>
<li>A binding that is local to the function with any type</li>
<li>An external binding with a known immutable type</li>
</ul>
<p>For example, in the ecosystem checks we have <a href="https://github.com/zulip/zulip/blob/9f009a2e638220ad4aaa791407e28d4f8dad9922/tools/lib/provision_inner.py#L75-L78">this violation</a> where a mutable local variable has an augmented assignment. I guess looking at that code, I&#x27;m wondering if this change would actually be more readable? I clicked on <a href="https://github.com/apache/airflow/blob/9f90a655e884be0a99ee80564c41190260fa9ba1/airflow/providers/google/cloud/operators/mlengine.py#L69-L78">another random violation</a> and don&#x27;t see what value it would provide to collapse onto the <code>return</code> statement.</p>
<p>What do you think? @charliermarsh might have more concrete advice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-08 06:59</div>
            <div class="timeline-body"><p>I&#x27;ll close this PR because it has gone stale. Feel free to reopen it if you&#x27;re interested in moving the PR forward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-08 06:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:00:22 UTC
    </footer>
</body>
</html>
