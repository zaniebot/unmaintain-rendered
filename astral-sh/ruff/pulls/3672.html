<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add dedicated structs for `BindingKind` variants - astral-sh/ruff #3672</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add dedicated structs for <code>BindingKind</code> variants</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3672">#3672</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-03-22 19:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a non-behavior-changing refactor to move the <code>BindingKind</code> variants to use dedicated structs.</p>
<h2>Test Plan</h2>
<p>Verify that all automated checks pass as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @charliermarsh on 2023-03-22 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2023-03-22 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_ast/src/scope.rs</code>:433 on 2023-03-22 19:01</div>
            <div class="timeline-body"><p>I think we can improve some of these abstractions (better names, shared traits). This PR doesn't attempt to improve the object hierarchy at all -- it's just a &quot;straight&quot; migration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-22 19:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-22 19:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_ast/src/scope.rs</code>:453 on 2023-03-22 19:02</div>
            <div class="timeline-body"><p>Learning opportunity for me: when would we want to <code>Box</code> these?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-22 19:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff_python_ast/src/scope.rs</code>:453 on 2023-03-22 19:37</div>
            <div class="timeline-body"><p>When we want the enum to have the size of a box instead of the biggest struct, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-03-22 19:45</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.01     13.8Â±0.07ms     2.9 MB/sec    1.00     13.6Â±0.06ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.6Â±0.01ms     4.7 MB/sec    1.00      3.6Â±0.01ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    492.1Â±0.98Âµs     6.0 MB/sec    1.01    495.1Â±1.76Âµs     6.0 MB/sec
linter/all-rules/pydantic/types.py         1.01      6.0Â±0.03ms     4.2 MB/sec    1.00      6.0Â±0.02ms     4.3 MB/sec
linter/default-rules/large/dataset.py      1.02      7.3Â±0.02ms     5.5 MB/sec    1.00      7.2Â±0.03ms     5.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1638.6Â±2.45Âµs    10.2 MB/sec    1.00   1631.5Â±8.71Âµs    10.2 MB/sec
linter/default-rules/numpy/globals.py      1.00    179.1Â±0.44Âµs    16.5 MB/sec    1.03    183.7Â±4.14Âµs    16.1 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.4Â±0.02ms     7.5 MB/sec    1.00      3.4Â±0.01ms     7.5 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.01     21.2Â±1.01ms  1966.1 KB/sec    1.00     20.9Â±0.80ms  1992.2 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.5Â±0.25ms     3.0 MB/sec    1.00      5.5Â±0.35ms     3.0 MB/sec
linter/all-rules/numpy/globals.py          1.03   719.5Â±57.55Âµs     4.1 MB/sec    1.00   700.8Â±62.16Âµs     4.2 MB/sec
linter/all-rules/pydantic/types.py         1.01      9.1Â±0.39ms     2.8 MB/sec    1.00      9.0Â±0.38ms     2.8 MB/sec
linter/default-rules/large/dataset.py      1.00     10.2Â±0.69ms     4.0 MB/sec    1.15     11.7Â±0.80ms     3.5 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.03      2.5Â±0.20ms     6.7 MB/sec    1.00      2.4Â±0.10ms     6.9 MB/sec
linter/default-rules/numpy/globals.py      1.00   279.7Â±20.23Âµs    10.5 MB/sec    1.02   284.0Â±16.68Âµs    10.4 MB/sec
linter/default-rules/pydantic/types.py     1.00      5.1Â±0.25ms     5.0 MB/sec    1.06      5.3Â±0.40ms     4.8 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:4948 on 2023-03-22 22:39</div>
            <div class="timeline-body"><p>Nit. This could be moved to a 'full_name' method on BindingKind to avoid repetition</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/scope.rs</code>:390 on 2023-03-22 22:41</div>
            <div class="timeline-body"><p>Thanks for commenting the fields.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/scope.rs</code>:433 on 2023-03-22 22:47</div>
            <div class="timeline-body"><p>Sounds good. I hoped to find a name in the python specification but didn't find any other than dotted name. What came to my mind is that this is the path but there's no precedence for this term</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/scope.rs</code>:453 on 2023-03-22 22:49</div>
            <div class="timeline-body"><p>Boxing a variant reduces the size of that variant to a single pointer instead of the size of the inner struct + padding.</p>
<p>I recommend boxing when one variant is significantly larger than all other variants.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-03-22 22:50</div>
            <div class="timeline-body"><p>ðŸŽ¸ðŸŽ¸</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-22 23:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:4948 on 2023-03-22 23:05</div>
            <div class="timeline-body"><p>It doesn't exist on all variants though -- so would it return <code>Option&lt;&amp;str&gt;</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-22 23:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-22 23:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-03-22 23:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:4948 on 2023-03-23 06:06</div>
            <div class="timeline-body"><p>Yeah, it would have to return an Option</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-03-23 06:06</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:46 UTC
    </footer>
</body>
</html>
