<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Allow module-resolution options to be specified via the CLI - astral-sh/ruff #12246</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Allow module-resolution options to be specified via the CLI</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12246">#12246</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-07-08 16:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>This allows us to pass arguments such as <code>--custom-typeshed-dir</code> and <code>--target-version</code> directly to the red-knot CLI, for easier experimentation and validation locally.</p>
<p>(The PR is stacked on top of <a href="https://github.com/astral-sh/ruff/pull/12215">astral-sh/ruff#12215</a>)</p>
Test Plan
<p>Lots of manual testing, for example:</p>

Screenshots

<p><img src="https://github.com/astral-sh/ruff/assets/66076021/184fd733-7faa-4df9-9362-d9c4f1756fb2" alt="image"></p>
<hr>
<p><img src="https://github.com/astral-sh/ruff/assets/66076021/ec8da209-8a91-4bec-8ba2-9e2174cb0298" alt="image"></p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-08 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-08 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-08 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_module_resolver/Cargo.toml</code>:17 on 2024-07-08 16:50</div>
            <div class="timeline-body"><p>Hmm, this is the part that annoys me about clap. It shouldn&#x27;t be necessary to have a cli dependency (and such a heavy one) on non cli crates.</p>
<p>Ideally we have the same enum in red knot (we&#x27;ll need it for other things as well). Alternatively, add a clap feature and make it an optional dependency</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-08 16:50</div>
            <div class="timeline-body"><p>The summary is half honest haha. The biggest change is that this is pr migrates to Clap ðŸ˜‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/main.rs</code>:36 on 2024-07-08 16:51</div>
            <div class="timeline-body"><p>Do we need the environment variable? I would prefer to start with the absolute minimum</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/main.rs</code>:66 on 2024-07-08 16:53</div>
            <div class="timeline-body"><p>This trace feels a bit extra verbose. I would remove it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-07-08 16:54</div>
            <div class="timeline-body"><p>Migrating to clap was something on my todo list. Thanks for doing for me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/main.rs</code>:66 on 2024-07-08 16:57</div>
            <div class="timeline-body"><p>Just this line, or the other <code>tracing::trace!()</code> lines I added as well?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-08 16:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-07-08 16:58</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-08 16:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/main.rs</code>:36 on 2024-07-08 16:58</div>
            <div class="timeline-body"><p>no, we can leave this for now. though I expect we will want to let users specify it via environment variable as well at some point</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-08 16:59</div>
            <div class="timeline-body"><blockquote>
<p>The summary is half honest haha. The biggest change is that this is pr migrates to Clap</p>
</blockquote>
<p>just a means to an end ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-07-08 17:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/main.rs</code>:66 on 2024-07-08 17:03</div>
            <div class="timeline-body"><p>Mainly that one. We probably want to move the others further down but I think they&#x27;re fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot/src/target_version.rs</code>:7 on 2024-07-08 19:18</div>
            <div class="timeline-body"><p>Why do we need this defined both here and in <code>red_knot_module_resolver</code> crate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-07-08 19:18</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-08 19:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot/src/target_version.rs</code>:7 on 2024-07-08 19:22</div>
            <div class="timeline-body"><p>I originally just imported it from <code>red_knot_module_resolver</code>, but Micha suggested duplicating it here so that we can avoid having <code>clap</code> as a dependency in <code>red_knot_module_resolver</code>: <a href="https://github.com/astral-sh/ruff/pull/12246">astral-sh/ruff#12246</a>#discussion_r1668970240. For the version of the enum that&#x27;s used as a <code>clap</code> argument, it needs to have <code>ValueEnum</code> derived on it, which means that the crate in which it&#x27;s defined needs to have <code>clap</code> as a dependency</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-09 09:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-09 09:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-09 09:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:05:08 UTC
    </footer>
</body>
</html>
