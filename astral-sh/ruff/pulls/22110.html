<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add autocomplete suggestions for class arguments - astral-sh/ruff #22110</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add autocomplete suggestions for class arguments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22110">#22110</a>
        opened by <a href="https://github.com/RasmusNygren">@RasmusNygren</a>
        on 2025-12-20 12:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on 2025-12-20 12:46</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This adds autocomplete suggestions for class
arguments that we know are valid.
Specifically this adds the <code>metaclass</code> keyword
suggestion for all class definitions and
<code>typing.TypedDict</code> specific keywords whenever
a TypedDict class is constructed.</p>
<p>Fixes https://github.com/astral-sh/ty/issues/1886, fixes https://github.com/astral-sh/ty/issues/2264
Basically fixes https://github.com/astral-sh/ty/issues/1775, this currently only supports the <code>total</code> keyword, not the <code>closed</code> or <code>extra_items</code> keywords that are added in <a href="https://peps.python.org/pep-0728/">PEP 728</a> (that doesn't land until 3.15).
Once we add support for PEP 728, I'm not sure if we only want to gate this on python &gt;= 3.15 or if we should also consider if TypedDict is imported from <code>typing_extensions</code> and add special handling for that?</p>
<h2>Test Plan</h2>
<p>New tests and validating in the playground.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @RasmusNygren on 2025-12-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @RasmusNygren on 2025-12-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @RasmusNygren on 2025-12-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @RasmusNygren on 2025-12-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @RasmusNygren on 2025-12-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 12:48</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-20 12:49</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">pydantic (https://github.com/pydantic/pydantic)
- pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:943:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:983:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:1026:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:1066:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:1109:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:1148:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`
+ pydantic/fields.py:1188:5: error[invalid-parameter-default] Default value of type `PydanticUndefinedType` is not assignable to annotated parameter type `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`
- pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, Divergent] | ((dict[str, Divergent], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, Divergent], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`
+ pydantic/fields.py:1567:13: error[invalid-argument-type] Argument is incorrect: Expected `dict[str, int | float | str | ... omitted 3 union elements] | ((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) | None`, found `Top[dict[Unknown, Unknown]] | (((dict[str, int | float | str | ... omitted 3 union elements], /) -&gt; None) &amp; ~Top[dict[Unknown, Unknown]]) | None`

prefect (https://github.com/PrefectHQ/prefect)
- src/prefect/deployments/runner.py:795:70: warning[possibly-missing-attribute] Attribute `__name__` may be missing on object of type `Unknown | (((...) -&gt; Any) &amp; ((*args: object, **kwargs: object) -&gt; object))`
+ src/prefect/deployments/runner.py:795:70: warning[possibly-missing-attribute] Attribute `__name__` may be missing on object of type `Unknown | ((...) -&gt; Any)`
+ src/prefect/flow_engine.py:812:32: error[invalid-await] `Unknown | R@FlowRunEngine | Coroutine[Any, Any, R@FlowRunEngine]` is not awaitable
+ src/prefect/flow_engine.py:1401:24: error[invalid-await] `Unknown | R@AsyncFlowRunEngine | Coroutine[Any, Any, R@AsyncFlowRunEngine]` is not awaitable
+ src/prefect/flow_engine.py:1482:43: error[invalid-argument-type] Argument to function `next` is incorrect: Expected `SupportsNext[Unknown]`, found `Unknown | R@run_generator_flow_sync`
+ src/prefect/flow_engine.py:1490:21: warning[possibly-missing-attribute] Attribute `throw` may be missing on object of type `Unknown | R@run_generator_flow_sync`
+ src/prefect/flow_engine.py:1524:44: warning[possibly-missing-attribute] Attribute `__anext__` may be missing on object of type `Unknown | R@run_generator_flow_async`
+ src/prefect/flow_engine.py:1531:25: warning[possibly-missing-attribute] Attribute `throw` may be missing on object of type `Unknown | R@run_generator_flow_async`
- src/prefect/flows.py:286:34: error[unresolved-attribute] Object of type `((**P@Flow) -&gt; R@Flow) &amp; ((*args: object, **kwargs: object) -&gt; object)` has no attribute `__name__`
+ src/prefect/flows.py:286:34: error[unresolved-attribute] Object of type `(**P@Flow) -&gt; R@Flow` has no attribute `__name__`
- src/prefect/flows.py:404:68: error[unresolved-attribute] Object of type `((**P@Flow) -&gt; R@Flow) &amp; ((*args: object, **kwargs: object) -&gt; object)` has no attribute `__name__`
+ src/prefect/flows.py:404:68: error[unresolved-attribute] Object of type `(**P@Flow) -&gt; R@Flow` has no attribute `__name__`
- src/prefect/flows.py:1750:53: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 5544 diagnostics
+ Found 5549 diagnostics

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
- src/scikit_build_core/build/wheel.py:98:20: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- Found 48 diagnostics
+ Found 47 diagnostics

xarray (https://github.com/pydata/xarray)
- xarray/core/dataarray.py:5757:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `DataArray | Dataset`
+ xarray/core/dataarray.py:5757:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `T_Xarray@map_blocks | DataArray | Dataset`
- xarray/core/dataset.py:8873:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `DataArray | Dataset`
+ xarray/core/dataset.py:8873:16: error[invalid-return-type] Return type does not match returned value: expected `T_Xarray@map_blocks`, found `T_Xarray@map_blocks | DataArray | Dataset`

scikit-learn (https://github.com/scikit-learn/scikit-learn)
- sklearn/externals/array_api_extra/_lib/_at.py:300:17: warning[possibly-missing-attribute] Attribute `dtype` may be missing on object of type `int | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...] | slice[Any, Any, Any] | EllipsisType`
+ sklearn/externals/array_api_extra/_lib/_at.py:300:17: warning[possibly-missing-attribute] Attribute `dtype` may be missing on object of type `int | slice[Any, Any, Any] | EllipsisType | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...]`
- sklearn/externals/array_api_extra/_lib/_at.py:301:17: warning[possibly-missing-attribute] Attribute `shape` may be missing on object of type `int | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...] | slice[Any, Any, Any] | EllipsisType`
+ sklearn/externals/array_api_extra/_lib/_at.py:301:17: warning[possibly-missing-attribute] Attribute `shape` may be missing on object of type `int | slice[Any, Any, Any] | EllipsisType | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...]`
- sklearn/externals/array_api_extra/_lib/_at.py:308:25: error[invalid-argument-type] Argument to function `apply_where` is incorrect: Expected `Array`, found `int | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...] | slice[Any, Any, Any] | EllipsisType`
+ sklearn/externals/array_api_extra/_lib/_at.py:308:25: error[invalid-argument-type] Argument to function `apply_where` is incorrect: Expected `Array`, found `int | slice[Any, Any, Any] | EllipsisType | Array | tuple[int | slice[Any, Any, Any] | EllipsisType | Array, ...]`

static-frame (https://github.com/static-frame/static-frame)
- static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Top[Bus[Any]] | TypeBlocks | Batch | ... omitted 6 union elements, object_]`
+ static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Top[Index[Any]] | Top[Series[Any, Any]] | TypeBlocks | ... omitted 6 union elements, object_]`
- static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 6 union elements, generic[object]]`
+ static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any] | TypeBlocks | Batch | ... omitted 6 union elements, generic[object]]`
- static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Top[Index[Any]] | TypeBlocks | Top[Bus[Any]] | ... omitted 7 union elements, generic[object]]`
+ static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Bottom[Series[Any, Any]] | TypeBlocks | Batch | ... omitted 7 union elements, generic[object]]`

pandas-stubs (https://github.com/pandas-dev/pandas-stubs)
- pandas-stubs/_typing.pyi:1228:16: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 5151 diagnostics
+ Found 5150 diagnostics

core (https://github.com/home-assistant/core)
+ homeassistant/util/variance.py:47:12: error[invalid-return-type] Return type does not match returned value: expected `(**_P@ignore_variance) -&gt; _R@ignore_variance`, found `_Wrapped[_P@ignore_variance, _R@ignore_variance | int | float | datetime, _P@ignore_variance, _R@ignore_variance | int | float | datetime]`
- Found 14452 diagnostics
+ Found 14453 diagnostics


</code></pre>
</details>

<p>No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:423 on 2025-12-20 12:49</div>
            <div class="timeline-body"><p>nit</p>
<pre><code class="language-suggestion">        let documentation = documentation.clone().map(Docstring::new);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:1145 on 2025-12-20 12:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// Some arguments we know are always valid and thus they are easy
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:1162 on 2025-12-20 12:53</div>
            <div class="timeline-body"><p>While this is an accurate type, I think we can be more specific: the object passed to the <code>metaclass=</code> keyword not only needs to be an instance of <code>type</code>, it also needs to be a <em>subclass</em> of <code>type</code> (it must inhabit the type <code>type[type]</code>):</p>
<pre><code class="language-suggestion">        let ty = Some(KnownClass::Type.to_subclass_of(model.db()));
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-20 13:06</div>
            <div class="timeline-body"><p>Thank you, this looks excellent!!</p>
<p>Some more tests you could possibly add:</p>
<ul>
<li><p><code>metaclass=</code> keyword completion for a generic class:</p>
<pre><code class="language-py">class Foo[T](meta&lt;CURSOR&gt;)
</code></pre>
</li>
<li><p><code>total=</code> keyword completion for a class that is a <code>TypedDict</code> because it has <code>TypedDict</code> somewhere in its MRO (but does not directly inherit from <code>TypedDict</code>):</p>
<pre><code class="language-py">from typing import TypedDict

class Foo(TypedDict):
    x: int

class Bar(Foo, to&lt;CURSOR&gt;)
</code></pre>
</li>
<li><p><code>total=</code> keyword completion for new-style generic <code>TypedDict</code>s:</p>
<pre><code class="language-py">from typing import TypedDict

class Foo[T](TypedDict, to&lt;CURSOR&gt;)
</code></pre>
</li>
<li><p><code>total=</code> keyword completions for old-style generic TypedDicts:</p>
<pre><code class="language-py">from typing import Generic, TypeVar, TypedDict

T = TypeVar(&quot;T&quot;)

class Foo(TypedDict, Generic[T], to&lt;CURSOR&gt;)
</code></pre>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-12-20 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-12-20 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @AlexWaygood on 2025-12-20 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-20 13:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:423 on 2025-12-20 13:41</div>
            <div class="timeline-body"><p><code>Docstring::new</code> expects String specifically so I don't think that would work unless the function signature is changed as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-20 13:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:1162 on 2025-12-20 13:49</div>
            <div class="timeline-body"><p>Yep that makes a lot of sense, fixed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on 2025-12-20 13:52</div>
            <div class="timeline-body"><blockquote>
<p>Thank you, this looks excellent!!</p>
<p>Some more tests you could possibly add:</p>
<pre><code>* `metaclass=` keyword completion for a generic class:
  ```python
  class Foo[T](meta&lt;CURSOR&gt;)
  ```

* `total=` keyword completion for a class that is a `TypedDict` because it has `TypedDict` somewhere in its MRO (but does not directly inherit from `TypedDict`):
  ```python
  from typing import TypedDict
  
  class Foo(TypedDict):
      x: int
  
  class Bar(Foo, to&lt;CURSOR&gt;)
  ```

* `total=` keyword completion for new-style generic `TypedDict`s:
  ```python
  from typing import TypedDict
  
  class Foo[T](TypedDict, to&lt;CURSOR&gt;)
  ```

* `total=` keyword completions for old-style generic TypedDicts:
  ```python
  from typing import Generic, TypeVar, TypedDict
  
  T = TypeVar(&quot;T&quot;)
  
  class Foo(TypedDict, Generic[T], to&lt;CURSOR&gt;)
  ```</code></pre>
</blockquote>
<p>Very reasonable, and thank you for the examples, I just added them as is :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:423 on 2025-12-20 13:53</div>
            <div class="timeline-body"><p>Ah right, yeah, my bad</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-12-20 13:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-12-20 13:56</div>
            <div class="timeline-body"><p>LGTM (but will wait until @BurntSushi's had a chance to take a look).</p>
<blockquote>
<p>Once we add support for PEP 728, I'm not sure if we only want to gate this on python &gt;= 3.15 or if we should also consider if TypedDict is imported from typing_extensions and add special handling for that?</p>
</blockquote>
<p>Yeah, our <code>SpecialFormType::TypedDict</code> variant currently covers both <code>typing.TypedDict</code> and <code>typing_extensions.TypedDict</code>. We'll probably want to split it into two variants when we add support for PEP 728, so we can distinguish between classes that inherit from <code>typing_extensions.TypedDict</code> (and can therefore use PEP 728 on older versions), and those that inherit from <code>typing.TypedDict</code> (and can therefore only use PEP 728 on very new versions of Python).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:78 on 2025-12-22 09:48</div>
            <div class="timeline-body"><p>I don't think it really makes sense here to pass <code>db</code>, <code>file</code> and <code>model</code> because <code>model</code> is just a thin wrapper around <code>db</code> + <code>file</code>. If we need model, then I suggest removing <code>db</code> and <code>file</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:1091 on 2025-12-22 09:58</div>
            <div class="timeline-body"><p>I wonder if we should store the <code>CoveringNode</code> in <code>ScopedTarget</code> target to avoid re-traversing the AST multiple times to get the covering node</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:1138 on 2025-12-22 10:01</div>
            <div class="timeline-body"><p>I think we should always exit after reaching a call or class def statement</p>
<pre><code class="language-suggestion">            ast::AnyNodeRef::ExprCall(call)=&gt;
            {
                if call.arguments.range().contains_range(cursor.range) {
	                add_function_arg_completions(db, file, cursor, completions);
                }
                return;
            }
            ast::AnyNodeRef::StmtClassDef(class_def) {
            	if let Some(arguments) = class_def.arguments.as_ref() &amp;&amp;
            		arguments.range().contains_range(cursor.range)) {
	                add_class_arg_completions(model, class_def, completions);
            		}
  
                return;
            }
            node =&gt; {
            	if node.is_statement() {
            		return;
          		}
            }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:1125 on 2025-12-22 10:03</div>
            <div class="timeline-body"><p>Would it make sense to pass <code>arguments</code> here to avoid having to handle the case where <code>class_def.arguments</code> is <code>None</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:448 on 2025-12-22 10:04</div>
            <div class="timeline-body"><p>This feels slightly too specific to me to have in <code>ide_support</code>. I'd inline this function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-22 10:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-22 12:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:78 on 2025-12-22 12:44</div>
            <div class="timeline-body"><p>While I do agree, I'm not sure it's that small of a change because I believe that means that <code>add_function_arg_completions</code> would have to take a <code>ty_python_semantic::Db</code> causing type issues down the call-chain.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-22 12:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:448 on 2025-12-22 12:46</div>
            <div class="timeline-body"><p>Ye, that's fair, it does mean that we need to raise the visibility of <code>is_typed_dict</code> but I guess that's fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-22 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:1125 on 2025-12-22 12:51</div>
            <div class="timeline-body"><p>It probably makes sense. In some way however I think I like that you explicitly have to pass the class_def as it sort of self-documents that you must already have identified a StmtClassDef node before calling the function, but maybe that's dumb reasoning :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-22 12:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:1138 on 2025-12-22 12:53</div>
            <div class="timeline-body"><p>Yeah, that's a very fair point</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-22 13:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:1091 on 2025-12-22 13:08</div>
            <div class="timeline-body"><p>I don't necessarily think that we need to fix that right now but at some point I think that is probably the way to go as it's already being called in a few places. It might not even be insane to store the <code>CoveringNode</code> directly on the context?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-22 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:78 on 2025-12-22 17:18</div>
            <div class="timeline-body"><p>Hmm yeah, this is a bit annoying. We could stop passing <code>file</code> and retrieved that from <code>model</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RasmusNygren">@RasmusNygren</a> reviewed on 2025-12-22 21:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on <code>crates/ty_ide/src/completion.rs</code>:78 on 2025-12-22 21:19</div>
            <div class="timeline-body"><p>Yep I agree, that's what I went for in the end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-12-23 01:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-30 13:10</div>
            <div class="timeline-body"><p>I'm going to land this because I keep finding issues where this PR fixes the behaviour ðŸ˜† I literally have another issue written up in another tab right now, and my mouse is ready to hit the &quot;submit&quot; button... but there's no point, because this PR seems to fix it ðŸ˜†</p>
<p>I'm sure @BurntSushi won't mind posting post-merge review comments if there's anything he spots when he's back from his Christmas break!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-12-30 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-12-30 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2026-01-06 14:36</div>
            <div class="timeline-body"><p>This looks great to me! Awesome work!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:30:52 UTC
    </footer>
</body>
</html>
