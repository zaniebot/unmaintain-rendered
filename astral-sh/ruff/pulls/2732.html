<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pytest-style`] autofix for composite-assertion (PT018) - astral-sh/ruff #2732</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pytest-style</code>] autofix for composite-assertion (PT018)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2732">#2732</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2023-02-10 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a></div>
            <div class="timeline-body"><p>Autofix for composite assertion/PT018</p>
<p>Made some choices to keep it simple, see the test file for details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-10 21:16</div>
            <div class="timeline-body"><p>C417 doesn&#x27;t detect all cases anymore.
It fixes:</p>
<pre><code>-        assert all(map(lambda v: isinstance(v, dict), iterator))
+        assert all((isinstance(v, dict) for v in iterator))
</code></pre>
<p>better would be:</p>
<pre><code>-        assert all(map(lambda v: isinstance(v, dict), iterator))
+        assert all(isinstance(v, dict) for v in iterator)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-10 21:19</div>
            <div class="timeline-body"><p>btw - replacing <code>filter()</code> in the same manner would also be helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-10 21:31</div>
            <div class="timeline-body"><p>with the MR the following is not detected anymore as C417: <code>bitstring = &#x27;&#x27;.join(map(lambda x: x in logontimes and &#x27;1&#x27; or &#x27;0&#x27;, range(168)))</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-02-10 21:59</div>
            <div class="timeline-body"><p>Thanks, will look at them (in <a href="https://github.com/charliermarsh/ruff/pull/2693">charliermarsh/ruff#2693</a>, this PR was intended for PT018)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-10 22:02</div>
            <div class="timeline-body"><p>I found out why I have so many differences in the detection of that code:</p>
<p>Prior each finding emitted two violations:</p>
<pre><code>C417 Unnecessary `map` usage (rewrite using a `list` comprehension)
C417 Unnecessary `map` usage (rewrite using a generator expression)
</code></pre>
<p>Now only one is detected:</p>
<pre><code>C417 Unnecessary `map` usage (rewrite using a `list` comprehension)
</code></pre>
<p>â†’ I think this is ok.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-02-10 22:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Autofix composite-assertion&quot; to &quot;[`flake8-pytest-style`] autofix for composite-assertion (PT018)&quot; by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-02-11 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-02-15 15:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>crates/ruff/resources/test/fixtures/flake8_pytest_style/PT018.py</code>:26 on 2023-02-15 15:37</div>
            <div class="timeline-body"><p>Alternative: repeat message for each subcondition</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>docs/rules/composite-assertion.md</code>:1 on 2023-02-15 15:38</div>
            <div class="timeline-body"><p>Needs to be excluded after refactor</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-02-15 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-02-16 00:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/resources/test/fixtures/flake8_pytest_style/PT018.py</code>:26 on 2023-02-16 00:08</div>
            <div class="timeline-body"><p>I think this is the right call (not to fix these cases).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 00:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-16 00:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:52:10 UTC
    </footer>
</body>
</html>
