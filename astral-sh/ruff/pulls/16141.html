<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[flake8-pyi] Avoid flagging `custom-typevar-for-self` on metaclass methods (PYI019) - astral-sh/ruff #16141</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[flake8-pyi] Avoid flagging <code>custom-typevar-for-self</code> on metaclass methods (PYI019)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16141">#16141</a>
        opened by <a href="https://github.com/vladNed">@vladNed</a>
        on 2025-02-13 17:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vladNed">@vladNed</a></div>
            <div class="timeline-body">

Summary
<p>Function <code>custom_type_var_instead_of_self</code> handling PYI019 was modifying return type to <code>Self</code> for metaclasses as the <code>is_metaclass</code> check was missing form implementation.</p>
<p>As discussed in #16127, this is a behavior not accepted by PEP 673</p>
Test Plan


<ul>
<li>Tested with a metaclass in order to check that the type is not an issue</li>
<li>Tested with a normal class to check that <code>Self</code> is indeed outlined when checking with ruff</li>
<li>Added a metaclass to resources py files and made a new snapshot</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/vladNed">@vladNed</a> on 2025-02-13 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-13 17:39</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -1 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<a href="https://github.com/rotki/rotki">rotki/rotki</a> (+0 -1 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href="https://github.com/rotki/rotki/blob/b0b92e309bb8082871d3af569ae6c6786cafa02a/rotkehlchen/utils/mixins/enums.py#L12">rotkehlchen/utils/mixins/enums.py:12:16:</a> PYI019 [*] Use `Self` instead of custom TypeVar `T`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PYI019 | 1 | 0 | 1 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-13 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-13 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-02-13 18:42</div>
            <div class="timeline-body"><p>Thank you! I pushed a very minor simplification, but this is great</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[flake8-pyi] Avoid flagging on metaclasses (PYI019)&quot; to &quot;[flake8-pyi] Avoid flagging `custom-typevar-for-self` on metaclass methods (PYI019)&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-13 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-13 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-13 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-14 05:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:11:26 UTC
    </footer>
</body>
</html>
