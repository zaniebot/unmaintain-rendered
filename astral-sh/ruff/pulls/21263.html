<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Allow values of type `None` in type expressions - astral-sh/ruff #21263</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Allow values of type <code>None</code> in type expressions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21263">#21263</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-11-03 20:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>Allow values of type <code>None</code> in type expressions. The <a href="https://typing.python.org/en/latest/spec/annotations.html#type-and-annotation-expressions">typing spec</a> could be more explicit on whether this is actually allowed or not, but it seems relatively harmless and does help in some use cases like:</p>
<pre><code>try:
    from module import MyClass
except ImportError:
    MyClass = None  # ty: ignore


def f(m: MyClass):
    pass
</code></pre>
Test Plan
<p>Updated tests, ecosystem check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-03 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-11-03 20:57</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-11-03 20:59</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>kopf (https://github.com/nolar/kopf)
- kopf/_cogs/helpers/thirdparty.py:41:36: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- kopf/_cogs/helpers/thirdparty.py:45:36: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- Found 47 diagnostics
+ Found 45 diagnostics

mypy (https://github.com/python/mypy)
- mypy/typeshed/stdlib/tty.pyi:25:43: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- mypy/typeshed/stdlib/tty.pyi:26:46: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- Found 1839 diagnostics
+ Found 1837 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
+ src/integrations/prefect-dbt/prefect_dbt/cli/credentials.py:166:42: warning[possibly-missing-attribute] Attribute `get_configs` may be missing on object of type `Unknown | None`
- src/integrations/prefect-dbt/prefect_dbt/cli/credentials.py:133:23: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- src/integrations/prefect-dbt/prefect_dbt/cli/credentials.py:134:23: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- src/integrations/prefect-dbt/prefect_dbt/cli/credentials.py:135:23: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- Found 3308 diagnostics
+ Found 3306 diagnostics

aiohttp (https://github.com/aio-libs/aiohttp)
- aiohttp/client_exceptions.py:161:28: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- Found 161 diagnostics
+ Found 160 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ ddtrace/internal/ci_visibility/coverage.py:105:12: warning[possibly-missing-attribute] Attribute `_collector` may be missing on object of type `Unknown | None`
+ ddtrace/internal/ci_visibility/coverage.py:105:44: warning[possibly-missing-attribute] Attribute `_collector` may be missing on object of type `Unknown | None`
+ ddtrace/internal/ci_visibility/coverage.py:127:9: warning[possibly-missing-attribute] Attribute `switch_context` may be missing on object of type `Unknown | None`
- ddtrace/internal/ci_visibility/coverage.py:104:45: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- ddtrace/internal/ci_visibility/coverage.py:113:20: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- ddtrace/internal/ci_visibility/coverage.py:125:44: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- ddtrace/internal/ci_visibility/coverage.py:134:20: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
- ddtrace/internal/ci_visibility/coverage.py:163:44: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- ddtrace/internal/ci_visibility/coverage.py:178:22: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
+ ddtrace/internal/ci_visibility/coverage.py:179:12: warning[possibly-missing-attribute] Attribute `_collector` may be missing on object of type `Unknown | None`
+ ddtrace/internal/ci_visibility/coverage.py:179:39: warning[possibly-missing-attribute] Attribute `_collector` may be missing on object of type `Unknown | None`
- ddtrace/internal/ci_visibility/coverage.py:188:29: error[invalid-type-form] Variable of type `None` is not allowed in a type expression
+ ddtrace/internal/ci_visibility/coverage.py:184:26: warning[possibly-missing-attribute] Attribute `_collector` may be missing on object of type `Unknown | None`
- Found 8156 diagnostics
+ Found 8155 diagnostics

</code></pre>

No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Allow values of type None in type expressions&quot; to &quot;[ty] Allow values of type `None` in type expressions&quot; by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-03 21:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-03 21:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-11-03 21:25</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-type-form</code> | 0 | 13 | 0 |
| <code>possibly-missing-attribute</code> | 7 | 0 | 0 |
| <code>unused-ignore-comment</code> | 0 | 2 | 0 |
| <strong>Total</strong> | <strong>7</strong> | <strong>15</strong> | <strong>0</strong> |</p>
<p><strong><a href="https://david-allow-none-in-type-exp.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://david-allow-none-in-type-exp.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-04 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-04 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-04 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-04 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-04 14:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-04 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-04 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-04 15:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:15 UTC
    </footer>
</body>
</html>
