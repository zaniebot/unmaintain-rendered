<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement flake8-i18n - astral-sh/ruff #3741</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement flake8-i18n</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3741">#3741</a>
        opened by <a href="https://github.com/leiserfg">@leiserfg</a>
        on 2023-03-26 15:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a></div>
            <div class="timeline-body"><ul>
<li>Add skelleton code</li>
<li>Add fixtures for flake8_i18n</li>
<li>Add tests</li>
<li>Add implementation and insta snapshots</li>
<li>Add license entry</li>
</ul>
<p>Closes https://github.com/charliermarsh/ruff/issues/3294.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-03-26 15:19</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+1, -0, 0 error(s))</p>
<details><summary>zulip (+1, -0)</summary>
<p>

<pre><code class="language-diff">+ corporate/lib/stripe.py:1010:17: INT001 f-string is resolved before function call; consider `_(&quot;string %s&quot;) % arg`
</code></pre>
</p>
</details>

<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     14.5±0.08ms     2.8 MB/sec    1.00     14.5±0.06ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.8±0.03ms     4.4 MB/sec    1.00      3.8±0.02ms     4.4 MB/sec
linter/all-rules/numpy/globals.py          1.01    435.3±1.56µs     6.8 MB/sec    1.00    433.0±1.58µs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.4±0.02ms     4.0 MB/sec    1.02      6.5±0.05ms     3.9 MB/sec
linter/default-rules/large/dataset.py      1.01      7.9±0.06ms     5.2 MB/sec    1.00      7.8±0.04ms     5.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01   1712.6±9.61µs     9.7 MB/sec    1.00   1694.7±2.78µs     9.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    175.8±0.89µs    16.8 MB/sec    1.01    177.0±0.44µs    16.7 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.7±0.01ms     6.9 MB/sec    1.00      3.6±0.01ms     7.0 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     15.5±0.13ms     2.6 MB/sec    1.00     15.6±0.15ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.2±0.06ms     4.0 MB/sec    1.00      4.2±0.05ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.01    463.1±7.69µs     6.4 MB/sec    1.00    458.3±8.02µs     6.4 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.9±0.08ms     3.7 MB/sec    1.00      6.9±0.10ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.00      8.3±0.06ms     4.9 MB/sec    1.00      8.3±0.06ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1785.6±17.06µs     9.3 MB/sec    1.01  1794.8±17.34µs     9.3 MB/sec
linter/default-rules/numpy/globals.py      1.00    185.5±2.06µs    15.9 MB/sec    1.00    185.5±6.65µs    15.9 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.9±0.03ms     6.6 MB/sec    1.00      3.9±0.03ms     6.6 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:2917 on 2023-03-27 07:16</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code class="language-suggestion">						self.diagnostics.extend(flake8_i18n::rules::f_string_in_i18n_func_call(args))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_i18n/settings.rs</code>:40 on 2023-03-27 07:19</div>
            <div class="timeline-body"><p>Can we use <code>Vec&lt;String&gt;</code> directly or is it important to know whether the settings where empty vs <code>None</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-03-27 07:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leiserfg">@leiserfg</a> on <code>crates/ruff/src/rules/flake8_i18n/settings.rs</code>:40 on 2023-03-27 07:50</div>
            <div class="timeline-body"><p>True, it's fine to use a regular <code>Vec</code> here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a> reviewed on 2023-03-27 07:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a> reviewed on 2023-03-27 08:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leiserfg">@leiserfg</a> on <code>crates/ruff/src/rules/flake8_i18n/settings.rs</code>:40 on 2023-03-27 08:39</div>
            <div class="timeline-body"><p>After this change tests are failing in CI but no idea why, 'cause they pass locally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mvaled">@mvaled</a> on <code>crates/ruff/resources/test/fixtures/flake8_i18n/INT001.py</code>:1 on 2023-03-27 08:50</div>
            <div class="timeline-body"><p><code>f&quot;{'value'}&quot;</code> is just the string &quot;value&quot;.  I'm not sure if the AST will pick up that.  In general, any f-string inside a i18n function might be problematic.</p>
<pre><code class="language-suggestion">_(f&quot;{value}&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mvaled">@mvaled</a> reviewed on 2023-03-27 08:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a> reviewed on 2023-03-27 08:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leiserfg">@leiserfg</a> on <code>crates/ruff/resources/test/fixtures/flake8_i18n/INT001.py</code>:1 on 2023-03-27 08:52</div>
            <div class="timeline-body"><p>Yes, it will, any f-string is a JoinedString for the parser.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a> reviewed on 2023-03-27 08:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leiserfg">@leiserfg</a> on <code>crates/ruff/src/rules/flake8_i18n/settings.rs</code>:40 on 2023-03-27 08:53</div>
            <div class="timeline-body"><p>I see, some changes in main, I will rebase to fix them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-03-27 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-27 17:45</div>
            <div class="timeline-body"><p>Nice work here. I made a few minor but otherwise merging as-is. Thanks for getting involved :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-27 17:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_i18n/settings.rs</code>:61 on 2023-03-27 17:49</div>
            <div class="timeline-body"><p>I changed this to use an iterator.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-27 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-27 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AA-Turner">@AA-Turner</a> reviewed on 2023-03-27 20:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AA-Turner">@AA-Turner</a> on <code>LICENSE</code>:198 on 2023-03-27 20:37</div>
            <div class="timeline-body"><p>@charliermarsh -- I'm not certain on this but wanted to ask the question -- does including a GPL tool in Ruff mean that (all/part of) Ruff would be considered a derivative work for the purposes of GPL, and therefore that Ruff would need to be re-licenced (or this PR reverted or etc)? This is the first GPL tool to be integrated, and I wanted to flag the concern as early as possible. Thanks, Adam</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-27 20:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>LICENSE</code>:198 on 2023-03-27 20:43</div>
            <div class="timeline-body"><p>Lemme look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a> reviewed on 2023-03-27 20:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/leiserfg">@leiserfg</a> on <code>LICENSE</code>:198 on 2023-03-27 20:49</div>
            <div class="timeline-body"><p>There are already other parts including GPL3 (flake8-django for instance).</p>
<ul>
<li>edit: well only that one, but I think GPL3 is even more infectious than GPL2.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-27 20:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>LICENSE</code>:198 on 2023-03-27 20:57</div>
            <div class="timeline-body"><p>I'll have to get some more informed opinions on this, I'm not sure myself on whether these constitute derivative works.</p>
<p>If they do, and we'd have to re-license under GPL, then I'd err on the side of removing them, or going back to the authors and asking if they'd consider re-licensing under MIT or a dual license.</p>
<p><code>flake8-django</code> is confusing because on PyPI it appears dual-licensed, and it includes the MIT trove classifiers:</p>
<p><img src="https://user-images.githubusercontent.com/1309177/228064736-bfddd03b-9cee-4047-b4f4-8624716fba08.png" alt="Screen Shot 2023-03-27 at 4 54 36 PM" />
<img src="https://user-images.githubusercontent.com/1309177/228064738-3c54e798-6c2e-437a-ac26-32fada358e54.png" alt="Screen Shot 2023-03-27 at 4 55 30 PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leiserfg">@leiserfg</a> on 2023-03-27 21:04</div>
            <div class="timeline-body"><p>@charliermarsh  should I talk to @vharitonsky to see if he can change the license for us or will you do it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-27 21:05</div>
            <div class="timeline-body"><p>@leiserfg - If you're willing to that'd be great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AA-Turner">@AA-Turner</a> reviewed on 2023-03-27 21:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AA-Turner">@AA-Turner</a> on <code>LICENSE</code>:198 on 2023-03-27 21:30</div>
            <div class="timeline-body"><blockquote>
<p>I'll have to get some more informed opinions on this, I'm not sure myself on whether these constitute derivative works.</p>
</blockquote>
<p>Sorry to cause the trouble and thank you both for looking in to this.</p>
<blockquote>
<p><code>flake8-django</code> is confusing because on PyPI it appears dual-licensed, and it includes the MIT trove classifiers:</p>
</blockquote>
<p>It seems this has been noted already: https://github.com/rocioar/flake8-django/issues/101 and https://github.com/rocioar/flake8-django/pull/102. Sorry not to have flagged this at the time for <code>flake8-django</code>, but it seems the <code>MIT</code> trove classifier may have been a mistake when that project <a href="https://github.com/rocioar/flake8-django/commit/bb9dcc881c36d47db932f91993015fe15c447ff3#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711">adopted Poetry</a>.</p>
<p>A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-27 21:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>LICENSE</code>:198 on 2023-03-27 21:39</div>
            <div class="timeline-body"><p>No, thank <em>you</em> for calling this out! It's important to get right. I'll try to reach out to the <code>flake8-django</code> maintainer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leiserfg">@leiserfg</a> on 2023-03-28 07:01</div>
            <div class="timeline-body"><p>To be honest, I don't think this can be considered derivative work as we barely used some of their ideas, and ideas can be patented but not copyrighted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mvaled">@mvaled</a> reviewed on 2023-03-28 07:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mvaled">@mvaled</a> on <code>LICENSE</code>:198 on 2023-03-28 07:02</div>
            <div class="timeline-body"><p>Hum... This is such a common &quot;idea&quot;, I've <a href="https://gitlab.merchise.org/merchise/merchise.lint/-/blob/master/merchise/lint/checkers/odoo_i18n.py">done it before</a> without even knowing about flake8-i18n.   We were working in a project and switched to Python 3.6 and many members of a the team started to use f-strings inside <code>_</code>.  I became such a common mistake we had to &quot;invent&quot; our checker.</p>
<p>I'm not a lawyer, but I don't think this can be gathered as derivative work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leiserfg">@leiserfg</a> on 2023-03-28 19:24</div>
            <div class="timeline-body"><p>@charliermarsh  I found another <a href="https://github.com/cielavenir/flake8_gettext">implementation</a> that does basically the same and is licensed under BSD, is it fine if we reference that one instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-28 19:58</div>
            <div class="timeline-body"><p>@leiserfg - Yeah that looks fine to me. I do think we could in theory include these rules without referencing <code>flake8-i18n</code>, especially since the issue that was raised on Ruff pre-dated any knowledge of that plugin. But it seems most straightforward to base it on <code>flake8-gettext</code>. Want to put up a PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-28 19:59</div>
            <div class="timeline-body"><p>Let's continue to use the <code>INT</code> codes (which I think differs from either of those plugins).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leiserfg">@leiserfg</a> on 2023-03-28 21:06</div>
            <div class="timeline-body"><p>https://github.com/charliermarsh/ruff/pull/3785</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-28 21:44</div>
            <div class="timeline-body"><p>Thx!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:49 UTC
    </footer>
</body>
</html>
