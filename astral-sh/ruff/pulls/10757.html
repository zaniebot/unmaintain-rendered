<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add tests for string and f-string literals - astral-sh/ruff #10757</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add tests for string and f-string literals</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10757">#10757</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-04-03 12:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-03 12:26</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR provides additional test cases for string and f-string parsing.</p>
<p>There are a few things the parser does for strings which isn't really ideal for error recovery. This PR adds test cases to showcase them (along with TODO comments) which will be helpful when working on error recovery. This requires some changes on the lexer side especially w.r.t. unterminated strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by @dhruvmanila on 2024-04-03 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @dhruvmanila on 2024-04-03 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-03 12:31</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/dhruv/string-expr">CodSpeed Performance Report</a></h2>
<h3>Merging #10757 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>dhruv/string-expr</code> (885f65e) with <code>dhruv/parser</code> (faae192)</sub></p>
<h3>Summary</h3>
<p><code>✅ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-03 12:46</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-03 12:52</div>
            <div class="timeline-body"><p>(I need to rebase the parser stack for the ecosystem check to be in sync, I'll do it later.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dhruvmanila on 2024-04-03 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2024-04-03 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/expression.rs</code>:1189 on 2024-04-04 07:59</div>
            <div class="timeline-body"><p>I think this is only true in debug mode. Should we change the assertion to <code>assert</code> (should be pretty cheap)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/expression.rs</code>:1248 on 2024-04-04 08:02</div>
            <div class="timeline-body"><p>Github doesn't allow me to comment on the relevant line:</p>
<pre><code class="language-rust">                    for string in strings {
                        values.push(match string {
                            StringType::Bytes(value) =&gt; value,
                            _ =&gt; ast::BytesLiteral::invalid(string.range()),
                        });
                    }
</code></pre>
<p>For the above code, isn't it impossible to have an element that isn't <code>StringType::Bytes</code>, given that <code>bytes_literal_count == strings.len()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/expression.rs</code>:1221 on 2024-04-04 08:05</div>
            <div class="timeline-body"><p>Yeah. We probably want to convert the node to a string and mark it as &quot;errornous&quot;. We might also need to be slightly more clever by either marking the string or byte literals as errors, depending on which nodes are fewer. But that's something we can do later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-04 08:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-04 09:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/expression.rs</code>:1248 on 2024-04-04 09:47</div>
            <div class="timeline-body"><p>Yeah, that's correct. I'll change it. Thanks for noticing!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/expression.rs</code>:1221 on 2024-04-04 09:48</div>
            <div class="timeline-body"><p>Yeah, I had a similar idea. I'll add this to the TODO comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-04 09:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-04-04 09:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-04-04 09:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-04 09:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:48:14 UTC
    </footer>
</body>
</html>
