<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add --config-file CLI arg - astral-sh/ruff #18083</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add --config-file CLI arg</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18083">#18083</a>
        opened by <a href="https://github.com/thejchap">@thejchap</a>
        on 2025-05-14 01:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a></div>
            <div class="timeline-body">Summary
<p>https://github.com/astral-sh/ty/issues/217</p>
<ul>
<li>Adds a <code>--config-file</code> CLI option which overrides discovered configuration files</li>
<li>Introduces <code>MetaOptions</code> (not very sold on the name...) that encapsulates both options passed by the CLI, as well as the config file override, which influences how <code>ProjectMetadata</code> gets discovered/created (which the CLI options then get applied to).</li>
<li>Ensure the config file passed by this arg is watched for changes</li>
</ul>
Test Plan
<ul>
<li>Snapshot test</li>
<li>Updated file watching tests to accept <code>MetaOptions</code> and tested watching for changes on the provided config file override</li>
<li>Manual e2e testing</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-05-14 01:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty/tests/cli.rs</code>:1460 on 2025-05-14 01:58</div>
            <div class="timeline-body"><p>unrelated rename in an old test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-14 02:02</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-14 03:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-14 03:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-14 06:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/sharkdp">@sharkdp</a> removed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-14 06:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-05-17 00:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_project/src/metadata.rs</code>:308 on 2025-05-17 00:08</div>
            <div class="timeline-body"><p>renamed to be more generic - includes errors encountered during discovery + errors when discovery is skipped and it&#x27;s loaded from a specific config file</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Add --config-file&quot; to &quot;[ty] Add --config-file CLI arg&quot; by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
            <div class="timeline-body"><p>@MichaReiser still needs tests but ready for some feedback on the direction</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-17 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/metadata.rs</code>:31 on 2025-05-17 15:27</div>
            <div class="timeline-body"><p>I&#x27;m not sure about this, but we could consider combining it with <code>extra_configuration_paths</code>, considering that they&#x27;re exclusive to each other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-17 15:28</div>
            <div class="timeline-body"><p>The direction looks great to me and it&#x27;s a nice scoped change. This is turning out great</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/AlexWaygood">@AlexWaygood</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-17 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/carljm">@carljm</a> on 2025-05-18 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-18 18:20</div>
            <div class="timeline-body"><p>@thejchap let me know when this is ready for review (a bit hard to tell because it was already ready for review).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-18 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-18 18:29</div>
            <div class="timeline-body"><p>@MichaReiser converted back to draft, sorry about that - will mark ready for review once i get tests in</p>
<p>for the future - what&#x27;s the preferred workflow for this type of situation? (ie. looking for feedback on in-progress pr, but pr isn&#x27;t quite &quot;merge ready&quot;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-18 18:59</div>
            <div class="timeline-body"><p>No worries. The way you asked for early feedback was great</p>
<blockquote>
<p>for the future - what&#x27;s the preferred workflow for this type of situation? (ie. looking for feedback on in-progress pr, but pr isn&#x27;t quite &quot;merge ready&quot;)</p>
</blockquote>
<p>I tend to only look at PRs that are ready for review unless I get tagged. What I find most useful is if the PRs is put back into draft mode if you plan on making more changes before getting a review. This makes it very clear to me that the PR is ready for review when you change its status again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-23 05:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thejchap">@thejchap</a> on 2025-05-23 05:42</div>
            <div class="timeline-body"><p>@MichaReiser ready for review</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/sharkdp">@sharkdp</a> removed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-23 07:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty/src/args.rs</code>:115 on 2025-05-23 13:25</div>
            <div class="timeline-body"><p>This is probably a bit more detailed than necessary for most users. We can adopt uv&#x27;s documentation</p>
<pre><code>The path to a `uv.toml` file to use for configuration.
While uv configuration can be included in a `pyproject.toml` file, it is not allowed in this context.
</code></pre>
<p>UV also has a <code>TY_CONFIG_FILE</code> environment variable. I&#x27;d be open to support this too (as simple as telling clap to respect the env variable)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty/src/lib.rs</code>:111 on 2025-05-23 13:27</div>
            <div class="timeline-body"><p>Can we use <code>system.current_directory</code> instead of passing <code>cwd</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty/tests/file_watching.rs</code>:1839 on 2025-05-23 13:30</div>
            <div class="timeline-body"><pre><code>    // Enable division-by-zero in the explicitly specified configuration with warning severity
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/db/changes.rs</code>:53 on 2025-05-23 13:31</div>
            <div class="timeline-body"><p>Is it necessary that we canonicalize the path here or could we avoid it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/metadata/options.rs</code>:582 on 2025-05-23 13:33</div>
            <div class="timeline-body"><p>I agree, this name isn&#x27;t great :)</p>
<p>How about:</p>
<ul>
<li><code>ConfigurationOverrides</code></li>
<li><code>OptionOverrides</code></li>
<li><code>ProjectOptionsOverrides</code>. I think I like this best because these options override the project&#x27;s options.</li>
</ul>
<p>We could then rename <code>cli_options</code> to just <code>options</code> because I forsee that we&#x27;ll need this for the LSP too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-05-23 13:34</div>
            <div class="timeline-body"><p>This is excellent work. Thank you! I&#x27;ve a few small nit comments but this is otherwise good to go)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-26 16:25</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-05-26 16:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_project/src/db/changes.rs</code>:53 on 2025-05-26 16:44</div>
            <div class="timeline-body"><p>@MichaReiser in testing it seemed like <code>ChangeEvent::system_path</code> (<a href="https://github.com/thejchap/ruff/blob/555ce858403a04a13747074cc43a8c902784faca/crates/ty_project/src/watch.rs#L75">here</a>) was returning an absolute path, whereas the <code>config_file</code> arg from clap was a relative path, breaking the comparison</p>
<p>open to doing this elsewhere - perhaps once when <code>ProjectOptionsOverrides</code> gets instantiated so this work doesn&#x27;t get done on every change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-05-26 16:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/db/changes.rs</code>:53 on 2025-05-26 16:49</div>
            <div class="timeline-body"><p>It probably makes sense to create an absolute path when constructing the <code>config_file_onverride</code>. Not because I&#x27;m concerned of the cost, more because it&#x27;s probably what I would expect (we overall try to convert relative paths to absolute paths at the &quot;boundaries&quot;). If it&#x27;s only about constructing an absolute path (and not resolving symlinks), then use <code>SystemPath::absolute</code> instead of <code>system.canonicalize</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thejchap">@thejchap</a> reviewed on 2025-05-27 02:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/thejchap">@thejchap</a> on <code>crates/ty_project/src/db/changes.rs</code>:53 on 2025-05-27 02:21</div>
            <div class="timeline-body"><p>@MichaReiser makes sense - thanks! this is ready for review</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-05-27 06:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-27 06:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-27 06:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:14:29 UTC
    </footer>
</body>
</html>
