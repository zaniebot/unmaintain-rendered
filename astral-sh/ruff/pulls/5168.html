<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format `assert` statement - astral-sh/ruff #5168</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format <code>assert</code> statement</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5168">#5168</a>
        opened by <a href="https://github.com/cnpryer">@cnpryer</a>
        on 2023-06-17 22:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a></div>
            <div class="timeline-body">Summary
<p>Format <code>assert</code> statement with <code>Parenthesize::IfBreaks</code> for test and message expressions.</p>
Test Plan
<p>Add ruff fixture with comments.</p>
<p>There&#x27;s some coverage already as well including:</p>
<ul>
<li><code>assert left &gt; right</code></li>
<li><code>assert test, msg</code></li>
</ul>
<p>I&#x27;ll try to leave the <em>good first issue</em> ones alone now :)</p>
<p>This looks really good btw.</p>
<hr>
<p>TODO (required):</p>
<ul>
<li>[x] Ruff fixture</li>
<li>[x] Formatting <a href="https://github.com/astral-sh/ruff/pull/5168#issuecomment-1631148612"><code>test</code>&#x27;s value</a></li>
<li>[ ] Formatting <a href="https://github.com/astral-sh/ruff/pull/5168#issuecomment-1630767421"><code>msg</code> long strings</a> UPDATE: <a href="https://github.com/astral-sh/ruff/pull/5168#discussion_r1262709467">comment</a></li>
<li>[x] Updated snapshots</li>
</ul>
<p>TODO (extra):</p>
<ul>
<li>[ ] Handling <a href="https://github.com/astral-sh/ruff/pull/5168#issuecomment-1630767421">misplaced trailing own-line comments</a> UPDATE: <a href="https://github.com/astral-sh/ruff/pull/5168#discussion_r1262740871">comment</a></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-06-17 22:20</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>âœ… ecosystem check detected no changes.</p>
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.8Â±0.29ms     4.2 MB/sec    1.17     11.5Â±0.40ms     3.5 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.2Â±0.10ms     7.5 MB/sec    1.05      2.3Â±0.12ms     7.2 MB/sec
formatter/numpy/globals.py                 1.00   252.9Â±19.15Âµs    11.7 MB/sec    1.03   259.4Â±21.49Âµs    11.4 MB/sec
formatter/pydantic/types.py                1.00      4.9Â±0.22ms     5.2 MB/sec    1.02      5.0Â±0.24ms     5.1 MB/sec
linter/all-rules/large/dataset.py          1.00     17.2Â±0.47ms     2.4 MB/sec    1.00     17.1Â±0.50ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.3Â±0.17ms     3.9 MB/sec    1.00      4.3Â±0.17ms     3.9 MB/sec
linter/all-rules/numpy/globals.py          1.00   566.5Â±38.74Âµs     5.2 MB/sec    1.03   582.7Â±38.43Âµs     5.1 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.7Â±0.23ms     3.3 MB/sec    1.01      7.7Â±0.26ms     3.3 MB/sec
linter/default-rules/large/dataset.py      1.04      8.6Â±0.25ms     4.7 MB/sec    1.00      8.3Â±0.25ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02  1826.7Â±67.86Âµs     9.1 MB/sec    1.00  1791.5Â±74.12Âµs     9.3 MB/sec
linter/default-rules/numpy/globals.py      1.00   217.0Â±12.09Âµs    13.6 MB/sec    1.00    216.2Â±8.04Âµs    13.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.8Â±0.13ms     6.7 MB/sec    1.00      3.8Â±0.14ms     6.7 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.8Â±0.49ms     3.4 MB/sec    1.18     13.9Â±0.61ms     2.9 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.7Â±0.18ms     6.2 MB/sec    1.01      2.7Â±0.16ms     6.1 MB/sec
formatter/numpy/globals.py                 1.00   306.9Â±37.56Âµs     9.6 MB/sec    1.04   320.2Â±25.27Âµs     9.2 MB/sec
formatter/pydantic/types.py                1.00      5.9Â±0.33ms     4.3 MB/sec    1.00      5.9Â±0.26ms     4.3 MB/sec
linter/all-rules/large/dataset.py          1.00     20.2Â±0.71ms     2.0 MB/sec    1.01     20.3Â±0.74ms     2.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      5.4Â±0.33ms     3.1 MB/sec    1.00      5.2Â±0.23ms     3.2 MB/sec
linter/all-rules/numpy/globals.py          1.01   628.9Â±42.79Âµs     4.7 MB/sec    1.00   624.2Â±27.82Âµs     4.7 MB/sec
linter/all-rules/pydantic/types.py         1.02      9.2Â±0.41ms     2.8 MB/sec    1.00      9.0Â±0.40ms     2.8 MB/sec
linter/default-rules/large/dataset.py      1.01     10.2Â±0.36ms     4.0 MB/sec    1.00     10.1Â±0.43ms     4.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.2Â±0.10ms     7.7 MB/sec    1.02      2.2Â±0.11ms     7.6 MB/sec
linter/default-rules/numpy/globals.py      1.02   255.9Â±15.95Âµs    11.5 MB/sec    1.00   250.2Â±15.34Âµs    11.8 MB/sec
linter/default-rules/pydantic/types.py     1.02      4.5Â±0.25ms     5.6 MB/sec    1.00      4.5Â±0.17ms     5.7 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-06-18 02:05</div>
            <div class="timeline-body"><p>Hmm maybe there&#x27;s more here. This isn&#x27;t formatting the same as black.</p>
<pre><code>assert (
    # Some comment
    True  # Some comment
    # Some comment
), &quot;Some string&quot;  # Some comment
# Some comment
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-06-18 02:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/resources/test/fixtures/black/simple_cases/assert.py</code>:1 on 2023-06-18 11:26</div>
            <div class="timeline-body"><p>these test cases are copied from black, please add new test cases to <code>crates/ruff_python_formatter/resources/test/fixtures/ruff</code> instead</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-18 11:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/konstin">@konstin</a> on 2023-06-18 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-06-18 15:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/resources/test/fixtures/black/simple_cases/assert.py</code>:1 on 2023-06-18 15:23</div>
            <div class="timeline-body"><p>d780f2f8fa6dba9234e9b9301e1eae2fddddf5cd</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-06-21 12:15</div>
            <div class="timeline-body"><p>Also note if you format this with black <code># First inner comment</code> is lost</p>
<pre><code># Some assert
assert (
    # First inner comment
    (1 + 1)  # Test&#x27;s trailing comment 
    # Below the expression
    # Last inner comment
), &quot;Some string&quot;  # Message&#x27;s trailing comment
# Below the assert
</code></pre>
<p>I reported this <a href="https://github.com/psf/black/issues/638#issuecomment-1597665572">here</a> for now. Probably should be a new issue if that one it&#x27;s mentioned in is not updated. I&#x27;ll get back to this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-09 19:56</div>
            <div class="timeline-body"><p>I find this snapshot result odd, but it could just be my inexperience with <code>insta</code>.</p>
<pre><code>Reviewing [1/11] ruff_python_formatter@0.0.0:
Snapshot file: crates/ruff_python_formatter/tests/snapshots/black_compatibility@simple_cases__expression.py.snap
Snapshot: expression
Source: crates/ruff_python_formatter/tests/fixtures.rs:86
Input file: crates/ruff_python_formatter/resources/test/fixtures/black/simple_cases/expression.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-old snapshot
+new results
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  391   391 â”‚ -    str,
  392   392 â”‚ -    int,
  393   393 â”‚ -    float,
  394   394 â”‚ -    dict[str, int],
        395 â”‚+-]
        396 â”‚+-very_long_variable_name_filters: t.List[
        397 â”‚+-    t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  395   398 â”‚ +    (
  396   399 â”‚ +        str,
  397   400 â”‚ +        int,
  398   401 â”‚ +        float,
  399   402 â”‚ +        dict[str, int],
  400   403 â”‚ +    )
  401   404 â”‚  ]
  402       â”‚--very_long_variable_name_filters: t.List[
  403       â”‚--    t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  404       â”‚--]
  405   405 â”‚ -xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
  406   406 â”‚ -    sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
  407   407 â”‚ -)
  408   408 â”‚ -xxxx_xxx_xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-10 08:04</div>
            <div class="timeline-body"><blockquote>
<p>I find this snapshot result odd, but it could just be my inexperience with <code>insta</code>.</p>
<pre><code>Reviewing [1/11] ruff_python_formatter@0.0.0:
Snapshot file: crates/ruff_python_formatter/tests/snapshots/black_compatibility@simple_cases__expression.py.snap
Snapshot: expression
Source: crates/ruff_python_formatter/tests/fixtures.rs:86
Input file: crates/ruff_python_formatter/resources/test/fixtures/black/simple_cases/expression.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-old snapshot
+new results
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  391   391 â”‚ -    str,
  392   392 â”‚ -    int,
  393   393 â”‚ -    float,
  394   394 â”‚ -    dict[str, int],
        395 â”‚+-]
        396 â”‚+-very_long_variable_name_filters: t.List[
        397 â”‚+-    t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  395   398 â”‚ +    (
  396   399 â”‚ +        str,
  397   400 â”‚ +        int,
  398   401 â”‚ +        float,
  399   402 â”‚ +        dict[str, int],
  400   403 â”‚ +    )
  401   404 â”‚  ]
  402       â”‚--very_long_variable_name_filters: t.List[
  403       â”‚--    t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  404       â”‚--]
  405   405 â”‚ -xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
  406   406 â”‚ -    sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
  407   407 â”‚ -)
  408   408 â”‚ -xxxx_xxx_xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
</code></pre>
</blockquote>
<p>The snapshots can be hard to read because it shows a diff of the new to old snapshot containing a diff with the black/ruff formatter differences.</p>
<p>Overall:</p>
<ul>
<li>Red lines / Lines gone -&gt; Good (not very intuitive)</li>
<li>More lines with a single <code>+</code> or <code>-</code> -&gt; Good. It means the output of black and ruff are the same</li>
<li>New lines with <code>++</code> or <code>+-</code>: Potentially a regression, but may be fine. Check out the section below that show the black and ruff output on their own and compare it manually.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-10 23:12</div>
            <div class="timeline-body"><p>Thanks for the explanation. Yea I that&#x27;s tough to understand. Manually reviewing it that result looks fine. Intuitively I would have expected no change in the diff here, but I&#x27;m sure I&#x27;m just missing something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-10 23:43</div>
            <div class="timeline-body"><p>This is maybe a better example of what&#x27;s tripping me up. Manually reviewing the new snapshot ruff and black outputs, and comparing them with the original snapshot, I&#x27;d expect there to be no new results displayed during the <code>insta</code> review because everything seems to be fine. Instead I get:</p>
<pre><code>black_compatibility@simple_cases__fmtonoff2.py.snap
   71    71 â”‚      pass
   72    72 â”‚  
   73    73 â”‚ +
   74    74 â”‚  def check_fader(test):
   75       â”‚-+    pass
         75 â”‚+-
         76 â”‚+     pass
   76    77 â”‚  
   77       â”‚--    pass
   78       â”‚- 
         78 â”‚++
</code></pre>
<p>IIUC this result is displaying the same diff just in a different way.</p>
<p>Originally</p>
<pre><code>+
 def check_fader(test):
+    pass
 
-    pass
</code></pre>
<p>And in this result</p>
<pre><code>+
 def check_fader(test):
-
     pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-11 06:30</div>
            <div class="timeline-body"><blockquote>
<p>This is maybe a better example of what&#x27;s tripping me up. Manually reviewing the new snapshot ruff and black outputs, and comparing them with the original snapshot, I&#x27;d expect there to be no new results displayed during the <code>insta</code> review because everything seems to be fine. Instead I get:</p>
<pre><code>black_compatibility@simple_cases__fmtonoff2.py.snap
   71    71 â”‚      pass
   72    72 â”‚  
   73    73 â”‚ +
   74    74 â”‚  def check_fader(test):
   75       â”‚-+    pass
         75 â”‚+-
         76 â”‚+     pass
   76    77 â”‚  
   77       â”‚--    pass
   78       â”‚- 
         78 â”‚++
</code></pre>
<p>IIUC this result is displaying the same diff just in a different way.</p>
<p>Originally</p>
<pre><code>+
 def check_fader(test):
+    pass
 
-    pass
</code></pre>
<p>And in this result</p>
<pre><code>+
 def check_fader(test):
-
     pass
</code></pre>
</blockquote>
<p>Yeah this is a bit annoying and something that I noticed too. The diff algorithm sometimes gets dripped up and produces changes even if there are non (to this particular section). We could explore if other diffing algorithm help but ultimately the best is to have higher compatibility, which will make the diff algorithm&#x27;s job easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-11 06:32</div>
            <div class="timeline-body"><p>Nit: I prefer to keep the shared logic outside of the <code>if..else</code> branches. It avoids that the reader has to parse both branches of the if statement to identify what&#x27;s difference between them</p>
<pre><code>		write!(f, [
			text(&quot;assert&quot;),
            space(),
            test.format().with_options(Parenthesize::IfBreaks),
        ])?;
                    
        if let Some(msg) = msg {
            write!(
                f,
                [       
                    text(&quot;,&quot;),
                    space(),
                    msg.format().with_options(Parenthesize::IfBreaks)
                ]
            )
        }
        
        Ok(())
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-11 06:33</div>
            <div class="timeline-body"><p>This looks ready to merge for me. Is there something that you want to look into before merging?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-11 12:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-11 12:36</div>
            <div class="timeline-body"><p>For sure!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-11 12:48</div>
            <div class="timeline-body"><blockquote>
<p>This looks ready to merge for me. Is there something that you want to look into before merging?</p>
</blockquote>
<p>Yea a couple of things, but one we can probably follow up on if you want to just get this merged.</p>
<p>First, the <code>msg</code> of the <code>assert</code> isn&#x27;t there yet. Here&#x27;s a related result:</p>
<pre><code>   77       â”‚--assert xxxxxxxxx.xxxxxxxxx.xxxxxxxxx(
   78       â”‚--    xxxxxxxxx
         71 â”‚+ assert xxxxxxxxx.xxxxxxxxx.xxxxxxxxx(
         72 â”‚+     xxxxxxxxx
   79    73 â”‚ -).xxxxxxxxxxxxxxxxxx(), (
   80    74 â”‚ -    &quot;xxx {xxxxxxxxx} xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
   81    75 â”‚ -)
   82       â”‚-+NOT_YET_IMPLEMENTED_StmtAssert
         76 â”‚++).xxxxxxxxxxxxxxxxxx(), &quot;xxx {xxxxxxxxx} xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
</code></pre>
<p>Basically just need long strings causing line-width violation to wrap with parentheses.</p>
<p>The second one is one I personally was looking forward to tackling, but it&#x27;s probably something I could follow up with after this pass is merged. A trailing own-line comment for the <code>assert</code>&#x27;s <code>test</code> value is assigned as a leading comment for the <code>msg</code>. I&#x27;d like to handle its placement. So</p>
<pre><code># Comment
assert (
    # Leading
    True  # Trailing same-line
    # Trailing own-line
), &quot;msg&quot;  # Comment
# Comment
</code></pre>
<p>currently becomes</p>
<pre><code># Comment
assert (
    # Leading
    True  # Trailing same-line
), (
    # Trailing own-line
    &quot;msg&quot;
)  # Comment
# Comment
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-11 13:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-11 13:36</div>
            <div class="timeline-body"><p>aaffdac1224d3217bc40371832f0a174e0d2a447</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-11 13:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-11 13:39</div>
            <div class="timeline-body"><p>Tbh I don&#x27;t even see this as a nit lol.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-11 16:40</div>
            <div class="timeline-body"><p>Hmm there&#x27;s more to this than what I mentioned. I added <code>optional_parentheses</code> for the formatted <code>msg</code>, but what I really need to do is consider the entire statement, formatting <code>test</code>&#x27;s value first prior to having the <code>msg</code> break with parentheses.</p>
<pre><code>black_compatibility@simple_cases__expression.py.snap
        488 â”‚+-assert this is ComplexTest and not requirements.fit_in_a_single_line(
        489 â”‚+-    force=False
        490 â”‚+-), &quot;Short message&quot;
        491 â”‚++assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), (
        492 â”‚++    &quot;Short message&quot;
        493 â”‚++)
        494 â”‚+ assert parens is TooMany
        495 â”‚+ for (x,) in (1,), (2,), (3,):
</code></pre>
<p><code>black</code> would format <code>fit_in_a_single_line</code>, making it unnecessary to futher format the <code>msg</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-12 01:59</div>
            <div class="timeline-body"><p>I ended up adding a <code>group</code>, so I&#x27;ve deviated from your suggestion. I&#x27;m still finding my feet with some of this stuff, so feel free to tell me to stop over-implementing this.</p>
<p>I&#x27;d want to format this next</p>
<pre><code># Regression test for <a href="https://github.com/psf/black/issues/3414">psf/black#3414</a>.
assert xxxxxxxxx.xxxxxxxxx.xxxxxxxxx(
    xxxxxxxxx
).xxxxxxxxxxxxxxxxxx(), (
    &quot;xxx {xxxxxxxxx} xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
)
</code></pre>
<p>And then finally figure out comment placement, but I can rip out the fixture I&#x27;ve added for that and follow up after this is merged.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-12 01:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-12 10:03</div>
            <div class="timeline-body"><p>I don&#x27;t have a good answer for you yet but am looking into a similar problem with <code>with</code> statements (the optional parentheses there are tricky).</p>
<p>My understanding from <a href="https://github.com/psf/black/blob/d1248ca9beaf0ba526d265f4108836d89cf551b7/src/black/linegen.py#L484-L499">Black&#x27;s code</a> is that <code>assert</code> should work the same as for <code>if</code> headers. Now, if our formatting of the if header is correct is another question... It may also be that e.g. this is caused by incorrect formatting of <code>string</code> (I&#x27;m also looking into that)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-12 10:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:29 on 2023-07-12 10:06</div>
            <div class="timeline-body"><p>Is the formatting different from <code>msg.format().with_options(Parenthesize::IfBreaks)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-12 13:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:29 on 2023-07-12 13:26</div>
            <div class="timeline-body"><p>Yea I&#x27;m definitely not satisfied with it yet.</p>
<p>Without my &quot;hack&quot; here I would get</p>
<pre><code>black_compatibility@simple_cases__composition_no_trailing_comma.py.snap
  349       â”‚-        } == expected, (
  350       â”‚-            &quot;Not what we expected and the message is too long to fit in one line&quot;
  351       â”‚-        )
        360 â”‚+        } == expected, &quot;Not what we expected and the message is too long to fit in one line&quot;
</code></pre>
<p><code>black</code> will wrap the <code>msg</code> (lines 349-351). So IIUC <code>Parenthesize::IfBreaks</code> wouldn&#x27;t give me that alone since the <code>msg</code> doesn&#x27;t break as a long string like that.</p>
<blockquote>
<p>It may also be that e.g. this is caused by incorrect formatting of string</p>
</blockquote>
<p>I don&#x27;t know enough yet but maybe this is possible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-12 13:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:29 on 2023-07-12 13:26</div>
            <div class="timeline-body"><blockquote>
<p>My understanding from <a href="https://github.com/psf/black/blob/d1248ca9beaf0ba526d265f4108836d89cf551b7/src/black/linegen.py#L484-L499">Black&#x27;s code</a> is that assert should work the same as for if headers</p>
</blockquote>
<p>This could be helpful. I&#x27;ll check it out. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:29 on 2023-07-12 13:56</div>
            <div class="timeline-body"><p>Let&#x27;s see if <a href="https://github.com/astral-sh/ruff/pull/5708">astral-sh/ruff#5708</a> helps. It changed the logic that decides when a string needs optional parentheses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-12 13:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-13 15:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:29 on 2023-07-13 15:12</div>
            <div class="timeline-body"><p>I spent some more time reading black&#x27;s source code and what I think we miss is that strings have a higher split priority than any math operator. I&#x27;m not sure how we want to model this yet but I suggest to not block this PR because of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-13 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:29 on 2023-07-13 15:38</div>
            <div class="timeline-body"><p>Noice. Perfect timing. I just sat down for lunch. Was just about to get back in here.</p>
<p>If you&#x27;re okay with it, I&#x27;d also like to get this merged without the extra comment placement. I think I can follow up on that since I don&#x27;t think it warrants blocking this either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-13 15:55</div>
            <div class="timeline-body"><p>Did a skim of the updated snapshots. I can check more thoroughly after work, but for now I&#x27;ll mark this as ready for a review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-13 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-13 15:56</div>
            <div class="timeline-body"><p>Hmm. Scratch that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-13 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@statement__assert.py.snap</code>:73 on 2023-07-13 16:03</div>
            <div class="timeline-body"><p>I thought it&#x27;d be better to leave this here instead of ripping it out entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-13 16:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-13 16:09</div>
            <div class="timeline-body"><p>Got it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-13 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cnpryer">@cnpryer</a> reviewed on 2023-07-13 16:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cnpryer">@cnpryer</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-13 16:12</div>
            <div class="timeline-body"><p>ðŸŽ‰ 709c4a70f6d4ba6ce91d12a71cde94dee34789a9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-14 06:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assert.rs</code>:38 on 2023-07-14 06:57</div>
            <div class="timeline-body"><p>Nice. Yeah, it can sometimes be very subtle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@miscellaneous__long_strings_flag_disabled.py.snap</code>:326 on 2023-07-14 07:00</div>
            <div class="timeline-body"><p>Ehh, this is interesting. It seems black happily wraps identifiers in parentheses in <em>some</em> positions but not all. This is fine for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-14 07:01</div>
            <div class="timeline-body"><p>Perfect! Thank you so much. This will increase our coverage significantly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-14 07:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-14 07:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-14 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-14 07:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@miscellaneous__long_strings_flag_disabled.py.snap</code>:326 on 2023-07-14 07:47</div>
            <div class="timeline-body"><p>i wonder if that&#x27;s because assert is somewhat unusual in that one must not wrap the entire rhs in parens, i.e.</p>
<p><code>assert foo, &quot;msg&quot;</code> very much != <code>assert (foo, &quot;msg&quot;)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-14 08:00</div>
            <div class="timeline-body"><p>To add some numbers to &quot;increases coverage&quot;, the similarity index (percentage of lines we format like black) went from 80.3% to 92.8% for <a href="https://github.com/pypi/warehouse">warehouse</a>, the software powering pypi</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:54:36 UTC
    </footer>
</body>
</html>
