<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] `ClassLiteral(&lt;T&gt;)` is not a disjoint type from `Instance(&lt;metaclass of T&gt;)` - astral-sh/ruff #14970</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] <code>ClassLiteral(&lt;T&gt;)</code> is not a disjoint type from <code>Instance(&lt;metaclass of T&gt;)</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14970">#14970</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-12-14 15:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>A class is an instance of its metaclass, so <code>ClassLiteral(&quot;ABC&quot;)</code> is not disjoint from <code>Instance(&quot;ABCMeta&quot;)</code>. However, we erroneously consider the two types disjoint on the <code>main</code> branch. This PR fixes that.</p>
<p>This bug was uncovered by adding some more core types to the property tests that provide coverage for classes that have custom metaclasses. The additions to the property tests are included in this PR.</p>
<h2>Test Plan</h2>
<p>New unit tests and property tests added. Tested with:</p>
<ul>
<li><code>cargo test -p red_knot_python_semantic</code></li>
<li><code>QUICKCHECK_TESTS=100000 cargo test -p red_knot_python_semantic -- --ignored types::property_tests::stable</code></li>
</ul>
<p>The assignability property test fails on this branch, but that's a known issue that exists on <code>main</code>, due to https://github.com/astral-sh/ruff/issues/14899.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2024-12-14 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2024-12-14 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2024-12-14 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2024-12-14 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-12-14 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-14 15:50</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-12-14 19:27</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @carljm on 2024-12-14 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2024-12-14 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-14 19:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:08:29 UTC
    </footer>
</body>
</html>
