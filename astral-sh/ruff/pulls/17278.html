<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Expand module path check to individual symbols (`AIR302`) - astral-sh/ruff #17278</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Expand module path check to individual symbols (<code>AIR302</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17278">#17278</a>
        opened by <a href="https://github.com/Lee-W">@Lee-W</a>
        on 2025-04-07 15:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-07 15:01</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<h3>Improvement</h3>
<p>Expand the following moved module into individual symbols.</p>
<ul>
<li>airflow.triggers.temporal</li>
<li>airflow.triggers.file</li>
<li>airflow.triggers.external_task</li>
<li>airflow.hooks.subprocess</li>
<li>airflow.hooks.package_index</li>
<li>airflow.hooks.filesystem</li>
<li>airflow.sensors.weekday</li>
<li>airflow.sensors.time_delta</li>
<li>airflow.sensors.time_sensor</li>
<li>airflow.sensors.date_time</li>
<li>airflow.operators.weekday</li>
<li>airflow.operators.datetime</li>
<li>airflow.operators.bash</li>
</ul>
<p>This removes <code>Replacement::ImportPathMoved</code>.</p>
<h2>Fix</h2>
<p>During the expansion, the following paths were also fixed</p>
<ul>
<li>airflow.sensors.s3_key_sensor.S3KeySensor ‚Üí airflow.providers.amazon.aws.sensors.S3KeySensor</li>
<li>airflow.operators.sql.SQLThresholdCheckOperator ‚Üí airflow.providers.common.sql.operators.sql.SQLThresholdCheckOperator</li>
<li>airflow.hooks.druid_hook.DruidDbApiHook ‚Üí airflow.providers.apache.druid.hooks.druid.DruidDbApiHook</li>
<li>airflow.hooks.druid_hook.DruidHook ‚Üí airflow.providers.apache.druid.hooks.druid.DruidHook</li>
<li>airflow.kubernetes.pod_generator.extend_object_field ‚Üí airflow.providers.cncf.kubernetes.pod_generator.extend_object_field</li>
<li>airflow.kubernetes.pod_launcher.PodLauncher ‚Üí airflow.providers.cncf.kubernetes.pod_launcher_deprecated.PodLauncher</li>
<li>airflow.kubernetes.pod_launcher.PodStatus ‚Üí airflow.providers.cncf.kubernetes.pod_launcher_deprecated.PodStatus</li>
<li>airflow.kubernetes.pod_generator.PodDefaults ‚Üí airflow.providers.cncf.kubernetes.pod_generator.PodDefaults</li>
<li>airflow.kubernetes.pod_launcher_deprecated.PodDefaults ‚Üí airflow.providers.cncf.kubernetes.pod_launcher_deprecated.PodDefaults</li>
</ul>
<h3>Refactor</h3>
<p>As many symbols are moved into the same module, <code>SourceModuleMovedToProvider</code> is introduced for grouping similar logic</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Skylion007">@Skylion007</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR302.py</code>:201 on 2025-04-07 15:04</div>
            <div class="timeline-body"><p>Merge conflict! Do we not have any merge conflict checks in our pre-commit hook? There should be a builtin one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Skylion007">@Skylion007</a> reviewed on 2025-04-07 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-07 15:08</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+2 -2 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+2 -2 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
- <a href='https://github.com/apache/airflow/blob/0b375e08a023263e95e80f720afa49d40da2e88f/performance/src/performance_dags/performance_dag/performance_dag.py#L95'>performance/src/performance_dags/performance_dag/performance_dag.py:95:13:</a> AIR302 Import path `airflow.operators.bash` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/0b375e08a023263e95e80f720afa49d40da2e88f/performance/src/performance_dags/performance_dag/performance_dag.py#L95'>performance/src/performance_dags/performance_dag/performance_dag.py:95:13:</a> AIR302 `airflow.operators.bash.BashOperator` is moved into `standard` provider in Airflow 3.0;
- <a href='https://github.com/apache/airflow/blob/0b375e08a023263e95e80f720afa49d40da2e88f/providers/edge/src/airflow/providers/edge/example_dags/integration_test.py#L116'>providers/edge/src/airflow/providers/edge/example_dags/integration_test.py:116:24:</a> AIR302 Import path `airflow.operators.bash` is moved into `standard` provider in Airflow 3.0;
+ <a href='https://github.com/apache/airflow/blob/0b375e08a023263e95e80f720afa49d40da2e88f/providers/edge/src/airflow/providers/edge/example_dags/integration_test.py#L116'>providers/edge/src/airflow/providers/edge/example_dags/integration_test.py:116:24:</a> AIR302 `airflow.operators.bash.BashOperator` is moved into `standard` provider in Airflow 3.0;
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| AIR302 | 4 | 2 | 2 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-07 15:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR302.py</code>:201 on 2025-04-07 15:08</div>
            <div class="timeline-body"><p>I just checked. it doesn't seem to be used ü§î</p>
<hr />
<p>Hmmm... I checked during the 20 commits' rebasing, and it's still missing. üò≠ Let me check it again</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Lee-W on 2025-04-07 15:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-07 15:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR302.py</code>:201 on 2025-04-07 15:11</div>
            <div class="timeline-body"><p>ah... it's the last one... just got it resolved. Thanks for reminder!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Get rid of import path moved" to "[airflow] Expand module path check to individual symbols (AIR302)" by @Lee-W on 2025-04-07 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Lee-W on 2025-04-07 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-07 15:22</div>
            <div class="timeline-body"><p>@ntBre Hey, it would be nice if we could get this one reviewed. üôè The amount of change is enormous, but I tried to split the PR into 20 separate commits, so I hope it will be easier to review that way</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-04-07 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-04-07 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:130 on 2025-04-07 21:03</div>
            <div class="timeline-body"><p>We <em>could</em> merge these nested <code>match</code>es with something like this, but you have to parenthesized the last part of the pattern to bind to <code>rest</code>. The main advantage would be getting rid of extra <code>_ =&gt; return</code> cases, but I don't think it looks <em>that</em> much better (and it would be a lot more changes), so I'm also happy with the current version.</p>
<pre><code class="language-suggestion">        [&quot;airflow&quot;, &quot;hooks&quot;, &quot;S3_hook&quot;, rest @ (&quot;S3Hook&quot; | &quot;provide_bucket_name&quot;)] =&gt; 
            Replacement::SourceModuleMovedToProvider {
                name: (*rest).to_string(),
                module: &quot;airflow.providers.amazon.aws.hooks.s3&quot;,
                provider: &quot;amazon&quot;,
                version: &quot;1.0.0&quot;
            },
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-04-07 21:04</div>
            <div class="timeline-body"><p>Thanks! This was easy to review commit-by-commit. I had one suggestion, but I'm happy enough with the current version if you are.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-08 03:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/rules/moved_to_provider_in_3.rs</code>:130 on 2025-04-08 03:21</div>
            <div class="timeline-body"><p>This is super nice! Just refactor it a bit. To unify the <code>|</code> usage, I add break lines to them, which might make it easier to extent in the future</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-04-08 13:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] Expand module path check to individual symbols (AIR302)" to "[`airflow`] Expand module path check to individual symbols (`AIR302`)" by @ntBre on 2025-04-08 13:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-04-08 13:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-04-08 13:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:41:06 UTC
    </footer>
</body>
</html>
