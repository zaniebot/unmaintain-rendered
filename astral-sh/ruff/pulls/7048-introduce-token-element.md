```yaml
number: 7048
title: Introduce Token element
type: pull_request
state: merged
author: MichaReiser
labels:
  - performance
  - formatter
assignees: []
merged: true
base: main
head: token-element
created_at: 2023-09-01T16:30:56Z
updated_at: 2023-09-22T21:01:24Z
url: https://github.com/astral-sh/ruff/pull/7048
synced_at: 2026-01-12T15:55:23Z
```

# Introduce Token element

---

_@MichaReiser_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This PR replaces `StaticText` with a stricter `Token` element

* ASCII only
* No newlines
* No tab characters

This proves to be sufficient for the `text` usages in Ruff's formatter today (and probably all code formatters) and has the advantage that the formatter can take shortcuts for these strings.

I thought about introducing a new `Token` element instead of replacing `Text`. But we don't really have any use case for it other than doctests, which doesn't justify adding a new format element. 

**Feedback welcome on**

Should we rename `dynamic_text` to `text`?

## Test Plan

`cargo test`

## Performance

This improves [performance between 2-3%](https://codspeed.io/astral-sh/ruff/branches/token-element)


---

_Comment by @MichaReiser on 2023-09-01 16:31_

Current dependencies on/for this PR:
* main
  * **PR #7048** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7048" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #6552** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6552" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #7037** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7037" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7048?utm_source=stack-comment).

---

_Label `formatter` added by @MichaReiser on 2023-09-01 16:31_

---

_@MichaReiser reviewed on 2023-09-01 16:48_

---

_Review comment by @MichaReiser on `crates/ruff_formatter/src/builders.rs`:847 on 2023-09-01 16:48_

This is arguably worse because these aren't really tokens but having a `text` builder just for the examples feels overkill (and the examples don't violate any constraint)

---

_Label `performance` added by @MichaReiser on 2023-09-01 16:53_

---

_Marked ready for review by @MichaReiser on 2023-09-01 17:01_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-09-01 17:04_

---

_Review comment by @charliermarsh on `crates/ruff_formatter/src/builders.rs`:269 on 2023-09-01 18:13_

Should `StaticText` be renamed to match (`Token`)?

---

_Comment by @zanieb on 2023-09-01 18:51_

Cool! I like the rename of dynamic_text to text as well

---

_@charliermarsh approved on 2023-09-01 19:02_

I support changing `DynamicText` to `text`.

---

_Merged by @MichaReiser on 2023-09-02 08:05_

---

_Closed by @MichaReiser on 2023-09-02 08:05_

---

_Branch deleted on 2023-09-02 08:05_

---

_@denbezrukov reviewed on 2023-09-22 19:49_

---

_Review comment by @denbezrukov on `crates/ruff_formatter/src/format_element.rs`:75 on 2023-09-22 19:49_

I guess that `DynamicText` -> `Text`.

---

_@MichaReiser reviewed on 2023-09-22 21:01_

---

_Review comment by @MichaReiser on `crates/ruff_formatter/src/format_element.rs`:75 on 2023-09-22 21:01_

Yes, that's correct 

---
