<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Implement `invalid-assert-message-literal-argument` (`RUF040`) - astral-sh/ruff #14488</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Implement <code>invalid-assert-message-literal-argument</code> (<code>RUF040</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14488">#14488</a>
        opened by <a href="https://github.com/Lokejoke">@Lokejoke</a>
        on 2024-11-20 13:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lokejoke">@Lokejoke</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR implements new rule discussed <a href="https://github.com/astral-sh/ruff/discussions/14449">here</a>.
In short, it searches for assert messages which were unintentionally used as a expression to be matched against.</p>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<p><code>cargo test</code> and review of <code>ruff-ecosystem</code></p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Lokejoke on 2024-11-20 14:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`ruff`] Implement `non-string-literal-as-assert-message` (`RUF035`)" to "[`ruff`] Implement `non-string-literal-as-assert-message` (`RUF040`)" by @Lokejoke on 2024-11-20 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-20 14:45</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+11 -0 violations, +0 -0 fixes in 4 projects; 51 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+8 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/providers/tests/amazon/aws/hooks/test_base_aws.py#L1077'>providers/tests/amazon/aws/hooks/test_base_aws.py:1077:24:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/providers/tests/edge/worker_api/routes/test_rpc_api.py#L219'>providers/tests/edge/worker_api/routes/test_rpc_api.py:219:35:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/providers/tests/google/cloud/sensors/test_gcs.py#L201'>providers/tests/google/cloud/sensors/test_gcs.py:201:30:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/providers/tests/google/cloud/sensors/test_gcs.py#L86'>providers/tests/google/cloud/sensors/test_gcs.py:86:30:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/providers/tests/google/common/hooks/test_base_google.py#L84'>providers/tests/google/common/hooks/test_base_google.py:84:24:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/tests/api_connexion/endpoints/test_task_instance_endpoint.py#L1370'>tests/api_connexion/endpoints/test_task_instance_endpoint.py:1370:38:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/tests/api_fastapi/core_api/routes/public/test_task_instances.py#L1973'>tests/api_fastapi/core_api/routes/public/test_task_instances.py:1973:38:</a> RUF040 Non-string literal used as assert message
+ <a href='https://github.com/apache/airflow/blob/1351b08d86fe70127cd24623a0dd8efc99fd25bd/tests/api_internal/endpoints/test_rpc_api_endpoint.py#L173'>tests/api_internal/endpoints/test_rpc_api_endpoint.py:173:31:</a> RUF040 Non-string literal used as assert message
</pre>

</p>
</details>
<details><summary><a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/io/test_state.py#L47'>tests/unit/bokeh/io/test_state.py:47:43:</a> RUF040 Non-string literal used as assert message
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pandas-dev/pandas/blob/ee0902a832b7fa3e5821ada176566301791e09ec/pandas/tests/series/accessors/test_cat_accessor.py#L43'>pandas/tests/series/accessors/test_cat_accessor.py:43:37:</a> RUF040 Non-string literal used as assert message
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pytest-dev/pytest">pytest-dev/pytest</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pytest-dev/pytest/blob/2157caf87960d904c8547c9168c94a7d535f21e0/testing/_py/test_local.py#L218'>testing/_py/test_local.py:218:26:</a> RUF040 Non-string literal used as assert message
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF040 | 11 | 11 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Lokejoke on 2024-11-20 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:14 on 2024-11-23 07:55</div>
            <div class="timeline-body"><p>I'm not sure we can speculate quite that much about the cause üòÑ
How about just:</p>
<pre><code class="language-rust">/// An assert message which is a non-string literal was likely intended
/// to be used in a comparison assertion, rather than as a message.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:9 on 2024-11-23 07:58</div>
            <div class="timeline-body"><pre><code class="language-diff">- /// Checks for uses of non-string literal as assert message.
+ /// Checks for the use of a non-string literal as an assert message.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:30 on 2024-11-23 08:01</div>
            <div class="timeline-body"><p>It's a little confusing that <code>NonStringLiteral</code> can be parsed as either:</p>
<ul>
<li>non-string literal, or</li>
<li>non - (string-literal)</li>
</ul>
<p>the former means &quot;a literal that is not a string literal&quot; the latter would include like... arbitrary expressions.</p>
<p>Can we rename the rule to <code>literal-besides-string-as-assert-message</code> or <code>literal-other-than-string-as-assert-message</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:50 on 2024-11-23 08:03</div>
            <div class="timeline-body"><p>Are we skipping bytes literals on purpose? I think that's okay, but maybe it should be documented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> requested changes on 2024-11-23 08:07</div>
            <div class="timeline-body"><p>This is a really clever rule idea, and the ecosystem checks all look like genuine bugs - great job! (May be worth filing some issues in those repos, actually üòÑ )</p>
<p>I just have a quibble with the name of the rule (see the comment below), and a question about bytes literals, but otherwise this looks awesome. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-11-25 09:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @MichaReiser on 2024-11-25 09:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lokejoke">@Lokejoke</a> reviewed on 2024-11-25 12:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lokejoke">@Lokejoke</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:50 on 2024-11-25 12:17</div>
            <div class="timeline-body"><p>Bytes literals look like legitimate messages, but I‚Äôm unsure of their purpose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lokejoke">@Lokejoke</a> reviewed on 2024-11-25 12:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lokejoke">@Lokejoke</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:30 on 2024-11-25 12:21</div>
            <div class="timeline-body"><p>literal-other-than-string-as-assert-message sounds ok</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-25 12:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:30 on 2024-11-25 12:37</div>
            <div class="timeline-body"><p>sorry for joining the bikeshedding: How about <code>invalid-assert-message-literal-argument</code></p>
<p>It's less specific because it doesn't mention string literals but I think that's a benefit if we decide to allow byte literals (although it's not clear to me why we should allow them because why? You'll have a bad time reading that message)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`ruff`] Implement `non-string-literal-as-assert-message` (`RUF040`)" to "[`ruff`] Implement `invalid-assert-message-literal-argument` (`RUF040`)" by @Lokejoke on 2024-11-25 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dylwil3 by @MichaReiser on 2024-11-25 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lokejoke">@Lokejoke</a> reviewed on 2024-11-25 17:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lokejoke">@Lokejoke</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:50 on 2024-11-25 17:54</div>
            <div class="timeline-body"><p>I‚Äôve changed my mind. After reviewing the <code>ecosystem</code> output, I‚Äôve noticed that byte literals are also being misused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2024-11-25 23:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/ruff/rules/non_string_literal_as_assert_message.rs</code>:30 on 2024-11-25 23:38</div>
            <div class="timeline-body"><p>I accept this bike shed color begrudgingly since &quot;invalid&quot; seems a bit strong - but let's keep it for now, changing the human-readable names can be done at any time since it's not a breaking change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> approved on 2024-11-25 23:39</div>
            <div class="timeline-body"><p>LGTM, thanks for the great contribution!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dylwil3 on 2024-11-25 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2024-11-25 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lokejoke">@Lokejoke</a> on 2024-11-26 09:53</div>
            <div class="timeline-body"><p>Thank you for your guidance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2024-11-28 18:09</div>
            <div class="timeline-body"><p>Very helpful - thanks for the heads up @Lokejoke and team :D  https://github.com/apache/airflow/pull/44460 is coming  in Airflow.</p>
<p>BTW, Some of them were not really &quot;bugs&quot; (i.e. when we had both assert with == and literal added after , but it was good to fix those anyway (True as message printed when assert fails is rather useless hint).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:53 UTC
    </footer>
</body>
</html>
