<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Handle tagged errors in conformance - astral-sh/ruff #22746</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Handle tagged errors in conformance</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22746">#22746</a>
        opened by <a href="https://github.com/WillDuke">@WillDuke</a>
        on 2026-01-19 21:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/WillDuke">@WillDuke</a></div>
            <div class="timeline-body">

Summary


<p>I&#x27;ve added a second grouping step that handles tagged errors in the conformance suite. I decided to change the &quot;unit&quot; of a true positive or false positive to be a test case that is either a single error or a collection of tagged errors. Along with being more similar (I think) to the implementation in the typing repository, this approach also makes it easy to report all of the errors for a tag when e.g. there are two many for a tags requirements. The downside is that the statistics become a little more confusing.</p>
Test Plan
<p>I ran the following locally:</p>
<pre><code>uv run --no-project --with rich scripts/conformance.py --tests-path ../typing/conformance/ --old-ty uvx ty@0.0.6
</code></pre>


<a href="https://github.com/python/typing/blob/main/conformance/">Typing conformance results</a> improved üéâ
<p>The percentage of diagnostics emitted that were expected errors increased from 74.16% to 76.75%. The percentage of expected errors that received a diagnostic increased from 61.57% to 64.25%.</p>
Summary
<p>| Metric | Old | New | Diff | Outcome |
|--------|-----|-----|------|---------|
| True Positives  | 620 | 647 | +27 | ‚è´ (‚úÖ) |
| False Positives | 216 | 196 | -20 | ‚è¨ (‚úÖ) |
| False Negatives | 387 | 360 | -27 | ‚è¨ (‚úÖ) |
| Total Diagnostics | 910 | 920 | +10 | ‚è´ |
| Precision | 74.16% | 76.75% | +2.59% | ‚è´ (‚úÖ) |
| Recall | 61.57% | 64.25% | +2.68% | ‚è´ (‚úÖ) |</p>
True positives added


<p>| Location | Name | Message |
|----------|------|---------|
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L16">namedtuples_define_functional.py:16:8</a> | missing-argument | No argument provided for required parameter <code>y</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L21">namedtuples_define_functional.py:21:8</a> | missing-argument | No arguments provided for required parameters <code>x</code>, <code>y</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L26">namedtuples_define_functional.py:26:21</a> | too-many-positional-arguments | Too many positional arguments: expected 3, got 4 |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L31">namedtuples_define_functional.py:31:8</a><br><a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L31">namedtuples_define_functional.py:31:18</a> | missing-argument<br>unknown-argument | No argument provided for required parameter <code>y</code><br>Argument <code>z</code> does not match any known parameter |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L36">namedtuples_define_functional.py:36:18</a> | invalid-argument-type | Argument is incorrect: Expected <code>int</code>, found <code>Literal[&quot;1&quot;]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L37">namedtuples_define_functional.py:37:21</a> | too-many-positional-arguments | Too many positional arguments: expected 3, got 4 |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L42">namedtuples_define_functional.py:42:18</a> | invalid-argument-type | Argument is incorrect: Expected <code>int</code>, found <code>Literal[&quot;1&quot;]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L43">namedtuples_define_functional.py:43:15</a> | invalid-argument-type | Argument is incorrect: Expected <code>int</code>, found <code>float</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L69">namedtuples_define_functional.py:69:1</a> | missing-argument | No argument provided for required parameter <code>a</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_usage.py#L43">namedtuples_usage.py:43:5</a> | not-subscriptable | Cannot delete subscript on object of type <code>Point</code> with no <code>__delitem__</code> method |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L102">narrowing_typeguard.py:102:23</a> | invalid-type-guard-definition | <code>TypeGuard</code> function must have a parameter to narrow |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L107">narrowing_typeguard.py:107:22</a> | invalid-type-guard-definition | <code>TypeGuard</code> function must have a parameter to narrow |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L128">narrowing_typeguard.py:128:20</a> | invalid-argument-type | Argument to function <code>takes_callable_str</code> is incorrect: Expected <code>(object, /) -&gt; str</code>, found <code>def simple_typeguard(val: object) -&gt; TypeGuard[int]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L148">narrowing_typeguard.py:148:26</a> | invalid-argument-type | Argument to function <code>takes_callable_str_proto</code> is incorrect: Expected <code>CallableStrProto</code>, found <code>def simple_typeguard(val: object) -&gt; TypeGuard[int]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L105">narrowing_typeis.py:105:23</a> | invalid-type-guard-definition | <code>TypeIs</code> function must have a parameter to narrow |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L110">narrowing_typeis.py:110:22</a> | invalid-type-guard-definition | <code>TypeIs</code> function must have a parameter to narrow |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L169">narrowing_typeis.py:169:17</a> | invalid-argument-type | Argument to function <code>takes_typeguard</code> is incorrect: Expected <code>(object, /) -&gt; TypeGuard[int]</code>, found <code>def is_int_typeis(val: object) -&gt; TypeIs[int]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L170">narrowing_typeis.py:170:14</a> | invalid-argument-type | Argument to function <code>takes_typeis</code> is incorrect: Expected <code>(object, /) -&gt; TypeIs[int]</code>, found <code>def is_int_typeguard(val: object) -&gt; TypeGuard[int]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L195">narrowing_typeis.py:195:27</a> | invalid-type-guard-definition | Narrowed type <code>str</code> is not assignable to the declared parameter type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L199">narrowing_typeis.py:199:45</a> | invalid-type-guard-definition | Narrowed type <code>list[int]</code> is not assignable to the declared parameter type <code>list[object]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/qualifiers_final_annotation.py#L134">qualifiers_final_annotation.py:134:1</a><br><a href="https://github.com/python/typing/blob/main/conformance/tests/qualifiers_final_annotation.py#L134">qualifiers_final_annotation.py:134:3</a> | missing-argument<br>unknown-argument | No arguments provided for required parameters <code>x</code>, <code>y</code><br>Argument <code>a</code> does not match any known parameter |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/qualifiers_final_annotation.py#L135">qualifiers_final_annotation.py:135:3</a><br><a href="https://github.com/python/typing/blob/main/conformance/tests/qualifiers_final_annotation.py#L135">qualifiers_final_annotation.py:135:9</a> | invalid-argument-type<br>invalid-argument-type | Argument is incorrect: Expected <code>int</code>, found <code>Literal[&quot;&quot;]</code><br>Argument is incorrect: Expected <code>int</code>, found <code>Literal[&quot;&quot;]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/typeddicts_class_syntax.py#L29">typeddicts_class_syntax.py:29:5</a> | invalid-typed-dict-statement | TypedDict class cannot have methods |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/typeddicts_extra_items.py#L128">typeddicts_extra_items.py:128:15</a> | invalid-argument-type | Cannot delete required key &quot;name&quot; from TypedDict <code>MovieEI</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/typeddicts_operations.py#L49">typeddicts_operations.py:49:11</a> | invalid-argument-type | Cannot delete required key &quot;name&quot; from TypedDict <code>Movie</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/typeddicts_class_syntax.py#L33">typeddicts_class_syntax.py:33:5</a> | invalid-typed-dict-statement | TypedDict class cannot have methods |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/typeddicts_class_syntax.py#L38">typeddicts_class_syntax.py:38:5</a> | invalid-typed-dict-statement | TypedDict class cannot have methods |</p>


False positives removed


<p>| Location | Name | Message |
|----------|------|---------|
| <a href="https://github.com/python/typing/blob/main/conformance/tests/constructors_call_init.py#L25">constructors_call_init.py:25:1</a> | type-assertion-failure | Argument does not have asserted type <code>Class1[int \| float]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/constructors_call_init.py#L75">constructors_call_init.py:75:1</a> | type-assertion-failure | Argument does not have asserted type <code>Class5[int \| float]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/constructors_call_new.py#L24">constructors_call_new.py:24:1</a> | type-assertion-failure | Argument does not have asserted type <code>Class1[int \| float]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_class.py#L121">namedtuples_define_class.py:121:1</a> | type-assertion-failure | Argument does not have asserted type <code>Property[int \| float]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_class.py#L122">namedtuples_define_class.py:122:1</a> | type-assertion-failure | Argument does not have asserted type <code>int \| float</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_class.py#L123">namedtuples_define_class.py:123:1</a> | type-assertion-failure | Argument does not have asserted type <code>int \| float</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L17">narrowing_typeguard.py:17:9</a> | type-assertion-failure | Argument does not have asserted type <code>tuple[str, str]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L32">narrowing_typeguard.py:32:9</a> | type-assertion-failure | Argument does not have asserted type <code>set[int]</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L69">narrowing_typeguard.py:69:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L73">narrowing_typeguard.py:73:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L77">narrowing_typeguard.py:77:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L81">narrowing_typeguard.py:81:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L85">narrowing_typeguard.py:85:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L89">narrowing_typeguard.py:89:9</a> | type-assertion-failure | Argument does not have asserted type <code>B</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeguard.py#L93">narrowing_typeguard.py:93:9</a> | type-assertion-failure | Argument does not have asserted type <code>B</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L72">narrowing_typeis.py:72:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L76">narrowing_typeis.py:76:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L80">narrowing_typeis.py:80:9</a> | type-assertion-failure | Argument does not have asserted type <code>int</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L92">narrowing_typeis.py:92:9</a> | type-assertion-failure | Argument does not have asserted type <code>B</code> |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/narrowing_typeis.py#L96">narrowing_typeis.py:96:9</a> | type-assertion-failure | Argument does not have asserted type <code>B</code> |</p>


Optional Diagnostics Added


<p>| Location | Name | Message |
|----------|------|---------|
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L52">namedtuples_define_functional.py:52:25</a> | invalid-named-tuple | Duplicate field name <code>a</code> in <code>namedtuple()</code>: Field <code>a</code> already defined; will raise <code>ValueError</code> at runtime |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L53">namedtuples_define_functional.py:53:25</a> | invalid-named-tuple | Field name <code>def</code> in <code>namedtuple()</code> cannot be a Python keyword: Will raise <code>ValueError</code> at runtime |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L54">namedtuples_define_functional.py:54:25</a> | invalid-named-tuple | Field name <code>def</code> in <code>namedtuple()</code> cannot be a Python keyword: Will raise <code>ValueError</code> at runtime |
| <a href="https://github.com/python/typing/blob/main/conformance/tests/namedtuples_define_functional.py#L55">namedtuples_define_functional.py:55:25</a> | invalid-named-tuple | Field name <code>_d</code> in <code>namedtuple()</code> cannot start with an underscore: Will raise <code>ValueError</code> at runtime |</p>





</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-19 21:40</div>
            <div class="timeline-body">

<a href="https://github.com/python/typing/blob/dece44f2922ca390fe314145d09939514a21e76e/conformance/">Typing conformance results</a>
<p>No changes detected ‚úÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-19 21:50</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-19 22:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-19 22:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/MichaReiser">@MichaReiser</a> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-20 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/WillDuke">@WillDuke</a> on 2026-01-20 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/WillDuke">@WillDuke</a> on 2026-01-21 09:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 10:04:14 UTC
    </footer>
</body>
</html>
