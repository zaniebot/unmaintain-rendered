<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use Rust 1.75 toolchain - astral-sh/ruff #9437</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use Rust 1.75 toolchain</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9437">#9437</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-01-08 11:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>Upgrade the rust toolchain from version 1.74 to 1.75.</p>
<p>This does not change the minimal required Rust version to compile Ruff. It only upgrades Clippy, Rustfmt, Rustc etc used locally and in CI</p>
Test Plan
<p>cargo test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 11:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-01-08 11:20</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/rust-1.75">CodSpeed Performance Report</a>
Merging #9437 will <strong>degrade performances by 5.36%</strong>
<p>Comparing <code>rust-1.75</code> (721f3d5) with <code>main</code> (ba71772)</p>
Summary
<p><code>‚ö° 12</code> improvements
<code>‚ùå 4 (üëÅ 4)</code> regressions
<code>‚úÖ 14</code> untouched benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>rust-1.75</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ö° | <code>parser[numpy/ctypeslib.py]</code> | 12.1 ms | 11.6 ms | +4.4% |
| ‚ö° | <code>parser[large/dataset.py]</code> | 70.5 ms | 67.4 ms | +4.58% |
| üëÅ | <code>lexer[unicode/pypinyin.py]</code> | 545.7 ¬µs | 574.7 ¬µs | -5.04% |
| üëÅ | <code>lexer[pydantic/types.py]</code> | 3.7 ms | 3.9 ms | -5.28% |
| ‚ö° | <code>parser[pydantic/types.py]</code> | 26.9 ms | 25.7 ms | +4.65% |
| üëÅ | <code>lexer[numpy/ctypeslib.py]</code> | 1.8 ms | 1.9 ms | -4.62% |
| ‚ö° | <code>linter/all-rules[numpy/ctypeslib.py]</code> | 23.5 ms | 22.3 ms | +5.28% |
| ‚ö° | <code>linter/all-with-preview-rules[numpy/ctypeslib.py]</code> | 26.9 ms | 25.6 ms | +5.1% |
| üëÅ | <code>lexer[large/dataset.py]</code> | 8.4 ms | 8.9 ms | -5.36% |
| ‚ö° | <code>linter/all-with-preview-rules[pydantic/types.py]</code> | 56.9 ms | 53.9 ms | +5.74% |
| ‚ö° | <code>linter/all-with-preview-rules[large/dataset.py]</code> | 124.6 ms | 118.1 ms | +5.49% |
| ‚ö° | <code>parser[unicode/pypinyin.py]</code> | 4.2 ms | 4 ms | +4.39% |
| ‚ö° | <code>linter/all-rules[numpy/globals.py]</code> | 3 ms | 2.9 ms | +4.84% |
| ‚ö° | <code>linter/all-rules[pydantic/types.py]</code> | 47.8 ms | 45 ms | +6.27% |
| ‚ö° | <code>linter/all-with-preview-rules[numpy/globals.py]</code> | 3.4 ms | 3.2 ms | +4.66% |
| ‚ö° | <code>linter/all-rules[large/dataset.py]</code> | 102.8 ms | 96.6 ms | +6.43% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-01-08 11:32</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-01-08 13:50</div>
            <div class="timeline-body"><p>The code looks good, the perf diff is massive though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-08 14:27</div>
            <div class="timeline-body"><p>Interesting. Note that the parser benchmark is a superset of the lexer benchmark... So if the parser is improving, it seems like a net win?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-08 14:46</div>
            <div class="timeline-body"><p>Looking at the flamegraphs, it seems that lexer became slower because <code>MultiPeek</code> isn&#x27;t inlined anymore, but the parser speedup is due to <code>check_tokens</code> which also has new functions in the flamegraph, so maybe it&#x27;s both the same inlining changes? Anyway i&#x27;m happy if the parser improves.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 16:00</div>
            <div class="timeline-body"><p>Agree, I think it&#x27;s both because of the changed heuristic of when to inline functions. I can try to fix some of the regression by adding <code>inline</code>s but I&#x27;m not sure if it is worth it, especially considering that the parser performance improves</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-08 17:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:00:31 UTC
    </footer>
</body>
</html>
