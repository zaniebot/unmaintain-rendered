<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format StmtAssign, badly - astral-sh/ruff #4877</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format StmtAssign, badly</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4877">#4877</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-06-05 20:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-06-05 20:48</div>
            <div class="timeline-body"><p>This is a near-verbatim formatting of assignment statements so we can see the effect of formatting the right hand side. It lacks the wrapping rules for the left hand side and will put the entire left hand side on one line.</p>
<p>On the snapshots this has mostly the effect of normalizing the whitespace around equals sign, but more importantly it will surface all changes to expressions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-05 20:48</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #4876</strong> <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4876" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #4877</strong> <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4877" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ<ul>
<li><strong>PR #4878</strong> <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4878" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4877?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autoformatter</span> added by @konstin on 2023-06-05 20:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2023-06-05 20:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:54 on 2023-06-05 20:58</div>
            <div class="timeline-body"><p>Nit: use the space element for adding whitespace</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:41 on 2023-06-05 20:59</div>
            <div class="timeline-body"><p>You mean equal?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:22 on 2023-06-05 21:00</div>
            <div class="timeline-body"><p>Should this use value.format().with_options(Parenthesize::IfBreaks) to only add parentheses if necessary? Or what's black's behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-06-05 21:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-06-05 21:16</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      5.5Â±0.01ms     7.4 MB/sec    1.00      5.5Â±0.01ms     7.4 MB/sec
formatter/numpy/ctypeslib.py               1.00   1073.5Â±1.58Âµs    15.5 MB/sec    1.02   1099.3Â±1.10Âµs    15.1 MB/sec
formatter/numpy/globals.py                 1.00    119.8Â±0.57Âµs    24.6 MB/sec    1.08    128.9Â±0.51Âµs    22.9 MB/sec
formatter/pydantic/types.py                1.00      2.4Â±0.00ms    10.7 MB/sec    1.04      2.5Â±0.03ms    10.3 MB/sec
linter/all-rules/large/dataset.py          1.00     13.8Â±0.07ms     2.9 MB/sec    1.00     13.8Â±0.08ms     2.9 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.3Â±0.01ms     5.0 MB/sec    1.00      3.3Â±0.01ms     5.0 MB/sec
linter/all-rules/numpy/globals.py          1.00    408.0Â±0.45Âµs     7.2 MB/sec    1.00    407.9Â±0.43Âµs     7.2 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.8Â±0.01ms     4.4 MB/sec    1.00      5.8Â±0.03ms     4.4 MB/sec
linter/default-rules/large/dataset.py      1.00      6.6Â±0.01ms     6.1 MB/sec    1.00      6.6Â±0.01ms     6.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1426.8Â±7.53Âµs    11.7 MB/sec    1.00   1421.7Â±2.71Âµs    11.7 MB/sec
linter/default-rules/numpy/globals.py      1.00    156.6Â±0.25Âµs    18.8 MB/sec    1.00    157.3Â±2.54Âµs    18.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.0Â±0.01ms     8.6 MB/sec    1.00      3.0Â±0.00ms     8.6 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      6.9Â±0.03ms     5.9 MB/sec    1.00      6.9Â±0.04ms     5.9 MB/sec
formatter/numpy/ctypeslib.py               1.00   1305.8Â±9.09Âµs    12.8 MB/sec    1.02   1327.1Â±9.39Âµs    12.5 MB/sec
formatter/numpy/globals.py                 1.00    148.4Â±2.08Âµs    19.9 MB/sec    1.05    155.4Â±2.52Âµs    19.0 MB/sec
formatter/pydantic/types.py                1.00      3.0Â±0.04ms     8.6 MB/sec    1.03      3.0Â±0.02ms     8.4 MB/sec
linter/all-rules/large/dataset.py          1.00     16.6Â±0.12ms     2.4 MB/sec    1.01     16.7Â±0.15ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.3Â±0.09ms     3.9 MB/sec    1.00      4.3Â±0.02ms     3.9 MB/sec
linter/all-rules/numpy/globals.py          1.00    429.1Â±5.31Âµs     6.9 MB/sec    1.01    433.2Â±7.36Âµs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.2Â±0.05ms     3.6 MB/sec    1.00      7.1Â±0.03ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.4Â±0.09ms     4.9 MB/sec    1.00      8.4Â±0.04ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1736.5Â±9.65Âµs     9.6 MB/sec    1.00  1736.9Â±10.38Âµs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    187.7Â±2.35Âµs    15.7 MB/sec    1.00    186.9Â±1.75Âµs    15.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.8Â±0.02ms     6.8 MB/sec    1.01      3.8Â±0.02ms     6.7 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:22 on 2023-06-06 06:36</div>
            <div class="timeline-body"><p>I couldn't find a symbol like <code>Parenthesize::IfBreaks</code>, i now added a group and if_group_breaks which doesn't do the same as black but still at least keeps the line length constraint</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-06 06:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-06-06 07:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:22 on 2023-06-06 07:46</div>
            <div class="timeline-body"><p>Yeah, this is in the binary expression formatting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-06 07:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:22 on 2023-06-06 07:48</div>
            <div class="timeline-body"><p>i realized i can change both PRs significantly with the new utils</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-06-06 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-06 12:33</div>
            <div class="timeline-body"><p>tests are passing locally -.-</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-06 15:15</div>
            <div class="timeline-body"><blockquote>
<p>tests are passing locally -.-</p>
</blockquote>
<p>Can you try a cargo clean and then re-run the tests. It could be that cargo isn't picking up the new file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:36 on 2023-06-06 15:16</div>
            <div class="timeline-body"><p>NIt</p>
<pre><code class="language-suggestion">        write!(
            f,
            [
                LhsAssignList::new(targets),
                space(),
                text(&quot;=&quot;),
                space(),
                value.format().with_options(Parenthesize::IfBreaks)
            ]
        )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:56 on 2023-06-06 15:17</div>
            <div class="timeline-body"><p>Nit: But it seems you use this style intentionally (which is fine with me)</p>
<pre><code class="language-suggestion">            return single_entry.format().fmt(f);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:80 on 2023-06-06 15:18</div>
            <div class="timeline-body"><p>What do you mean by 84 chars on top level? Can you add an example?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:86 on 2023-06-06 15:19</div>
            <div class="timeline-body"><p>Nit: You only need <code>format_args</code> if you want to format more than one element</p>
<pre><code class="language-suggestion">                [group(&amp;current
                    .format()
                    .with_options(Parenthesize::IfBreaks))]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/statement/stmt_assign.rs</code>:101 on 2023-06-06 15:20</div>
            <div class="timeline-body"><p>This will create nested groups. The example I shared didn't require nested groups. Do you know if the nested groups are necessary? If not, then this could be simplified to simply wrap every expression in a group (without using recursion)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-06-06 15:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-07 10:09</div>
            <div class="timeline-body"><p>The solution was the <code>--delete-unreferenced-snapshots</code> in <code>cargo insta test --all --all-features --delete-unreferenced-snapshots</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">blocked</span> added by @konstin on 2023-06-07 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-07 15:44</div>
            <div class="timeline-body"><p>This is block on Expr not working with formatting twice because the dummies are all constants and have different spacing rules from what they represent</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @konstin on 2023-06-07 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-08 10:01</div>
            <div class="timeline-body"><p>Closing in favor of #4938</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-06-08 10:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-06-12 12:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:44:08 UTC
    </footer>
</body>
</html>
