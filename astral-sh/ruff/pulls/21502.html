<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add hyperlinks to rule codes in CLI - astral-sh/ruff #21502</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add hyperlinks to rule codes in CLI</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21502">#21502</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-11-17 18:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>This PR adds hyperlink rendering to our diagnostics so that users can jump to the rule documentation by clicking on the diagnostic id.</p>
<p>My first implementation added an optional <code>url_resolver: &amp;dyn Fn(&amp;DiagnosticId) -&gt; Option&lt;String&gt;</code> argument to the full and concise rendering. The main idea was to avoid constructing the URLs unnecessarily when the output format doesn&#x27;t need the URL.</p>
<p>However, I then realised that the LSP always uses the URL and we have other output formats (ruff only for now) that construct the URL too, namely the JSON and rdjson output formats. The overhead also seems negligible compared to that we always construct the full diagnostic, even when only using the <code>concise</code> output format. That&#x27;s why I opted to store the URL as an optional field on the diagnostic instead. Not only did it simplify the implementation, it also reduced some code duplication.</p>
<p>The main advantage of this approach is that it requires some amount of code duplication to set the URL on the diagnostic.</p>
<p>It should be very easy to leverage this functionality in Ruff too (@ntBre if you&#x27;re interested).</p>
Test Plan
<p>https://github.com/user-attachments/assets/9855ca70-f92d-4299-b847-360be8ea1f89</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-17 18:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-17 18:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-17 18:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_annotate_snippets/src/snippet.rs</code>:16 on 2025-11-17 18:42</div>
            <div class="timeline-body"><p>This type is inspired by the new annotate snippet that also has an <code>Id</code> type</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-17 18:43</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-17 18:53</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/dcreager">@dcreager</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/AlexWaygood">@AlexWaygood</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-18 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-18 08:41</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>No diagnostic changes detected âœ…
<strong><a href="https://micha-error-links.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://micha-error-links.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Render links for rule codes&quot; to &quot;[ty] Add hyperlinks to rule codes in CLI&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-18 08:50</div>
            <div class="timeline-body"><p>Interesting that mypy_primer timed out but ecosystem-analyzer didn&#x27;t find any changes to report (primer timeouts usually occur because it took too long trying to compute the diff between the two runs)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 09:15</div>
            <div class="timeline-body"><p>mypy primer timing out makes sense, given that it forces color output (every diagnostic has now a different output)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 09:34</div>
            <div class="timeline-body"><p>There&#x27;s an argument that it&#x27;s hard to notice that the id is clickable. We could decide to underline the id or add the URL as a note (similar to what we do with the rule status). This would have the benefit that we could render the URL as a string and it&#x27;s up to the CLI to add the hyperlink. The downside of this is that it only works for the <code>full</code> output and not concise.</p>
<p>I&#x27;m also not a 100% sure if we need to restrict the hyperlink rendering to more cases, e.g. by using https://docs.rs/supports-hyperlinks/latest/src/supports_hyperlinks/lib.rs.html#12-53</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-11-18 13:44</div>
            <div class="timeline-body"><p>Love it! Nice work. This all LGTM. I agree that the overhead here is likely negligible, and so preferring API simplicity is the right call.</p>
<blockquote>
<p>There&#x27;s an argument that it&#x27;s hard to notice that the id is clickable. We could decide to underline the id or add the URL as a note (similar to what we do with the rule status). This would have the benefit that we could render the URL as a string and it&#x27;s up to the CLI to add the hyperlink. The downside of this is that it only works for the full output and not concise.</p>
</blockquote>
<p>I like the underline.</p>
<blockquote>
<p>I&#x27;m also not a 100% sure if we need to restrict the hyperlink rendering to more cases, e.g. by using https://docs.rs/supports-hyperlinks/latest/src/supports_hyperlinks/lib.rs.html#12-53</p>
</blockquote>
<p>I&#x27;d be fine with doing this reactively, i.e., in response to user feedback.</p>
<p>We could also choose to add a note containing the actual URL if and only if we decide not to render the hyperlink (based on <code>supports-hyperlink</code>).</p>
<p>But I&#x27;m fine shipping this as-is and iterating. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-18 13:59</div>
            <div class="timeline-body"><p>CMD+clicking on the rule code works on this branch for me in a terminal inside VSCode, but not in the Terminal app on my macbook -- any idea why? (Is this just a case of &quot;Alex, start using iTerm2 or something instead of the default Terminal app that your macbook came with&quot;?)</p>
<p>Adding the full URL as a note might resolve this, since I&#x27;m definitely able to CMD+click on full URL in a terminal (I do this all the time to open local playground deploys in a browser straight from my terminal, obviously ðŸ˜„)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 15:06</div>
            <div class="timeline-body"><blockquote>
<p>CMD+clicking on the rule code works on this branch for me in a terminal inside VSCode, but not in the Terminal app on my macbook -- any idea why? (Is this just a case of &quot;Alex, start using iTerm2 or something instead of the default Terminal app that your macbook came with&quot;?)</p>
</blockquote>
<p>I couldn&#x27;t find a reference but yes, this is the behavior of terminals supporting the ANSI escape but not supporting the hyperlink feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 15:36</div>
            <div class="timeline-body"><p>I actually like the current behavior where Ghostty only renders the underline when I hit Cmd and hover the id. This makes it behave the same as other clickable links</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-18 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-18 15:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:46 UTC
    </footer>
</body>
</html>
