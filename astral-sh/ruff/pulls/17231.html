<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pytest-style`] Avoid false positive for legacy form of `pytest.raises` (`PT011`) - astral-sh/ruff #17231</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pytest-style</code>] Avoid false positive for legacy form of <code>pytest.raises</code> (<code>PT011</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17231">#17231</a>
        opened by <a href="https://github.com/twentyone212121">@twentyone212121</a>
        on 2025-04-06 14:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/twentyone212121">@twentyone212121</a> on 2025-04-06 14:38</div>
            <div class="timeline-body"><p>This fix closes #17026</p>
<h2>Summary</h2>
<p>The check for the <code>PytestRaisesTooBroad</code> rule is now skipped if there is a second positional argument present, which means <code>pytest.raises</code> is used as a function.</p>
<h2>Test Plan</h2>
<p>Tested on the example from the issue, which now passes the check.</p>
<pre><code class="language-Python3">pytest.raises(Exception, func, *func_args, **func_kwargs).match(&quot;error message&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-04-07 06:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-07 06:43</div>
            <div class="timeline-body"><p>Thanks. Could you add a test example to https://github.com/astral-sh/ruff/blob/2b6d66b793adc9e0cc50817b59187b41f39f7691/crates/ruff_linter/resources/test/fixtures/flake8_pytest_style/PT011.py#L1-L0 with your example from the test plan</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/twentyone212121">@twentyone212121</a> on 2025-04-07 09:18</div>
            <div class="timeline-body"><p>I added an ok test example. The diff in snapshots is big because error tests are moved by 7 lines</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-07 21:19</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Copilot by @MichaReiser on 2025-04-08 06:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/copilot-pull-request-reviewer[bot]">@copilot-pull-request-reviewer[bot]</a> reviewed on 2025-04-08 06:58</div>
            <div class="timeline-body"><p>Copilot reviewed 2 out of 6 changed files in this pull request and generated no comments.</p>
<details>
<summary>Files not reviewed (4)</summary>

<ul>
<li><strong>crates/ruff_linter/src/rules/flake8_pytest_style/snapshots/ruff_linter__rules__flake8_pytest_style__tests__PT011_default.snap</strong>: Language not supported</li>
<li><strong>crates/ruff_linter/src/rules/flake8_pytest_style/snapshots/ruff_linter__rules__flake8_pytest_style__tests__PT011_extend_broad_exceptions.snap</strong>: Language not supported</li>
<li><strong>crates/ruff_linter/src/rules/flake8_pytest_style/snapshots/ruff_linter__rules__flake8_pytest_style__tests__PT011_glob_all.snap</strong>: Language not supported</li>
<li><strong>crates/ruff_linter/src/rules/flake8_pytest_style/snapshots/ruff_linter__rules__flake8_pytest_style__tests__PT011_glob_prefix.snap</strong>: Language not supported</details>

</li>
</ul>
<details>
<summary>Comments suppressed due to low confidence (1)</summary>

<p><strong>crates/ruff_linter/src/rules/flake8_pytest_style/rules/raises.rs:192</strong></p>
<ul>
<li>[nitpick] Using the string literal &quot;func&quot; with a hard-coded index (1) may reduce readability. Consider defining a constant for this argument name and index to clarify its purpose when detecting the second overload.</li>
</ul>
<pre><code>if call.arguments.find_argument(&quot;func&quot;, 1).is_none() {
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-04-08 07:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-04-08 07:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:41:06 UTC
    </footer>
</body>
</html>
