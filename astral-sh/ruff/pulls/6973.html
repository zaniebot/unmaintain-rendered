<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid parenthesizing multiline strings in binary expressions - astral-sh/ruff #6973</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid parenthesizing multiline strings in binary expressions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6973">#6973</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-08-29 11:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Avoid parenthesizing binary expressions that have a left multiline string and a parenthesized right side because the multiline string is guarnateed not to fit.</p>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<p>Added unit tests.</p>
<p>The similarity index for django increases from 0.99948 to 0.99957 (one file less with changes). This change does not impact the other projects.</p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-08-29 11:37</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #6973</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6973" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6973?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-08-29 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-29 16:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/src/expression/expr_bin_op.rs</code>:278 on 2023-08-29 16:05</div>
            <div class="timeline-body"><p>What if the left or right has comments, but is itself parenthesized and thus doesn't require these outer parentheses, like:</p>
<pre><code class="language-python">expected_content = (
    &quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;sitemapindex xmlns=&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;
&lt;sitemap&gt;&lt;loc&gt;%s/simple/sitemap-simple.xml&lt;/loc&gt;&lt;lastmod&gt;%s&lt;/lastmod&gt;
&lt;/sitemap&gt;
&lt;/sitemapindex&gt;
&quot;&quot;&quot;
    %
    (
        # Doesnt need parentheses
        self.base_url
    )
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-08-30 08:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/expr_bin_op.rs</code>:278 on 2023-08-30 08:23</div>
            <div class="timeline-body"><p>I added a test for parenthesized right sides but decided to keep the formatting as is if the right side contains any leading comments because our current binary expression formatting would format the above as</p>
<pre><code class="language-python">expected_content = 
    &quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;sitemapindex xmlns=&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;
&lt;sitemap&gt;&lt;loc&gt;%s/simple/sitemap-simple.xml&lt;/loc&gt;&lt;lastmod&gt;%s&lt;/lastmod&gt;
&lt;/sitemap&gt;
&lt;/sitemapindex&gt;
&quot;&quot;&quot;
%
(
      # Doesnt need parentheses
      self.base_url
)
</code></pre>
<p>Which results in a syntax error. I haven't seen this in any real project yet and don't think it justifies implementing an entire new binary expression layout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-08-30 13:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-08-30 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-08-30 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-30 14:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:59:54 UTC
    </footer>
</body>
</html>
