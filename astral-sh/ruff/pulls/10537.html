<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix `PD002` autofix for chained calls - astral-sh/ruff #10537</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix <code>PD002</code> autofix for chained calls</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10537">#10537</a>
        opened by <a href="https://github.com/augustelalande">@augustelalande</a>
        on 2024-03-23 17:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/augustelalande">@augustelalande</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This error was found browsing https://github.com/qarmin/Automated-Fuzzer/actions/runs/8396966850. Which failed when trying to autofix the PD002 violation in the following code:</p>
<pre><code class="language-python">x.reorder_levels().sort_index(inplace=True)
</code></pre>
<p>the autofix transformed the code to</p>
<pre><code class="language-python">x.reorder_levels() = x.reorder_levels().sort_index()
</code></pre>
<p>to address this I implemented a function to iterate down the list of chain calls and find the first attribute which is not a call and use that as the target. I'm guessing this is probably already implemented somewhere but I couldn't find it.</p>
<p>The new autofix is:</p>
<pre><code class="language-python">x = x.reorder_levels().sort_index()
</code></pre>
<h2>Test Plan</h2>
<p>Added misbehaving code to the test fixture.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-03-23 18:02</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/augustelalande:pd002-fix-bug">CodSpeed Performance Report</a></h2>
<h3>Merging #10537 will <strong>degrade performances by 5.29%</strong></h3>
<p><sub>Comparing <code>augustelalande:pd002-fix-bug</code> (8683a98) with <code>main</code> (895d9df)</sub></p>
<h3>Summary</h3>
<p><code>❌ 2</code> regressions
<code>✅ 28</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/augustelalande:pd002-fix-bug">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>main</code> | <code>augustelalande:pd002-fix-bug</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>linter/default-rules[large/dataset.py]</code> | 19.2 ms | 20.3 ms | -5.29% |
| ❌ | <code>linter/default-rules[unicode/pypinyin.py]</code> | 1.5 ms | 1.6 ms | -4.59% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/augustelalande">@augustelalande</a> on 2024-03-23 18:03</div>
            <div class="timeline-body"><p>Actually thinking about it now (after I wrote the fix lol). The example code doesn't make sense unless the chained calls are also inplace calls, since otherwise the result is not assigned to anything and gets lost. But then if it's a chain of inplace operations it also doesn't make sense since inplace calls return <code>None</code> and so don't allow chaining.</p>
<p>The only reason you would have a call chain ending in an inplace call, is if the other calls are also inplace, but also return the modified object, which I don't think exist in pandas.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @augustelalande on 2024-03-23 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-31 15:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:03:15 UTC
    </footer>
</body>
</html>
