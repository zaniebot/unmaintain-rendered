<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isort: Add support for the ``from-first`` setting - astral-sh/ruff #8663</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>isort: Add support for the <code>from-first</code> setting</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8663">#8663</a>
        opened by <a href="https://github.com/jelmer">@jelmer</a>
        on 2023-11-13 19:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jelmer">@jelmer</a></div>
            <div class="timeline-body">Summary
<p>This setting behaves similarly to the <code>from_first</code> setting in isort upstream, and sorts &quot;from X import Y&quot; type imports before straight imports.</p>
<p>Like the other PR I added, happy to refactor if this is better in another form.</p>
<p>Fixes #8662</p>
Test plan
<p>I&#x27;ve added a unit test, and ran this on a large codebase that relies on this setting in isort to verify it doesn&#x27;t have unexpected side effects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-11-13 20:00</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-13 20:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-14 00:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-14 18:12</div>
            <div class="timeline-body"><p>Could we instead explore incorporating this into <code>ModuleKey</code> and <code>MemberKey</code>? We carved those out recently to make the sorting easier to modify.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-14 20:31</div>
            <div class="timeline-body"><blockquote>
<p>Could we instead explore incorporating this into <code>ModuleKey</code> and <code>MemberKey</code>? We carved those out recently to make the sorting easier to modify.</p>
</blockquote>
<p>How to do that doesn&#x27;t seem obvious to me - I&#x27;d be grateful for some feedback.</p>
<p>from_first applies in isort even if force_within_sections is not enabled; see https://github.com/PyCQA/isort/blob/c574c4c190ceddb66b10330ae811a95306f07b74/isort/output.py#L90</p>
<p>I could add something like ModuleKey, e.g. ImportTypeKey?</p>
<p>Alternatively perhaps a <code>preferred_import_type: Option&lt;bool&gt;</code> (set to Some(true) for ImportFrom when first_from is enabled, and Some(true) for Imports if it is not enabled) to ModuleKey, and make <code>from_first</code> imply <code>force_sort_within_sections</code>. That&#x27;s diverging slightly from isort, but I&#x27;m not sure if that&#x27;s a big deal?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-14 21:32</div>
            <div class="timeline-body"><p>@bluthej - Curious if you have any thoughts on how <code>from-first</code> could be rolled into the new sort key design?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-14 21:53</div>
            <div class="timeline-body"><p>I guess I would have done something along those lines, the only thing is I don&#x27;t see why we need a <code>Box</code> in there... I&#x27;ll take a closer look when I get a chance!</p>
<p>The alternative would be to add an item in <code>ModuleKey</code> that should be positioned appropriately to either have straight and from imports one way, the other way or mixed (with <code>force-sort-within-sections</code>).</p>
<p>FWI I just submitted a quick PR that moves some of this logic into <code>order.rd</code>. This was only a small refactor to make things a bit more tidy but I thought I&#x27;d mention it just in case :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-14 22:17</div>
            <div class="timeline-body"><blockquote>
<p>I guess I would have done something along those lines, the only thing is I don&#x27;t see why we need a <code>Box</code> in there... I&#x27;ll take a closer look when I get a chance!</p>
<p>The alternative would be to add an item in <code>ModuleKey</code> that should be positioned appropriately to either have straight and from imports one way, the other way or mixed (with <code>force-sort-within-sections</code>).</p>
<p>FWI I just submitted a quick PR that moves some of this logic into <code>order.rd</code>. This was only a small refactor to make things a bit more tidy but I thought I&#x27;d mention it just in case :)</p>
</blockquote>
<p>I had trouble coercing rust into thinking that the two iterators were the same type - the only way I managed to was with a box. That&#x27;s probably just my ignorance on the rust side..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-16 11:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-16 11:13</div>
            <div class="timeline-body"><p>@charliermarsh PTAL; now updated after the recent refactoring. It no longer uses box, and mimicks the behaviour in isort.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-18 13:53</div>
            <div class="timeline-body"><p>@charliermarsh I had a closer look at the changes (sorry for the delay, I&#x27;ve been kind of swamped). I personally think this implementation is the way to go. In my mind, the items in <code>ModuleKey</code> are useful for when we really have to do the comparison on a per import basis, whereas here we are ordering two broad classes of imports (namely straight and from imports). We would be doing way more comparisons than by just doing one <code>if</code> statement to order the blocks, as proposed here. Plus it&#x27;s not like there&#x27;s a &quot;dynamic range&quot; of import types for this setting, there&#x27;s just straight and from imports.</p>
<p>@jelmer I had a feeling <code>collect</code> would help get rid of the <code>Box</code>es ;)</p>
<p>My only comment is that there does not seem to be any interaction between this setting and <code>force-sort-within-sections</code>. When <code>force-sort-within-sections = true</code> I don&#x27;t think we should be placing blank lines between straight and from imports. Plus I just tested it on the latest Ruff release and setting both options currently has an odd behavior, namely it will only place a blank line before the first from import that appears after a straight import!
If you both agree, I think it would be nice to fix it in this PR, but I&#x27;d be happy to submit a separate PR after this one if you prefer :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-18 23:13</div>
            <div class="timeline-body"><blockquote>
<p>If you both agree, I think it would be nice to fix it in this PR, but I&#x27;d be happy to submit a separate PR after this one if you prefer :)</p>
</blockquote>
<p>I agree. Do you have a sense of how to make that change? It may just be easier to put up a separate PR on top of this one and I can merge them in order.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-19 09:32</div>
            <div class="timeline-body"><p>The most straightforward way to fix it would be to add <code>&amp;&amp; !settings.force_sort_within_sections</code> in the if statements that add the lines. Of course there should be a test for that!
@jelmer would you like to take care of it or should I make a PR on top of yours?</p>
<p>But I don&#x27;t know what the general policy is regarding incompatible settings in Ruff, do you usually make one setting silently override the other or do you throw an error and notify the user that their config is inconsistent?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-20 09:56</div>
            <div class="timeline-body"><p>@bluthej My setup actually relies on both <code>force-sort-within-sections</code> and <code>from-first</code> together in our isort config, with only a single empty line appearing before the first from import - although it might only make sense if you only use no_sections.</p>
<p>The <code>force_alphabetical_sort</code> setting in isort specifically sets these options together:</p>
<p>https://github.com/PyCQA/isort/blob/b67a6a595803710f6af52865d82d996f264224c6/isort/settings.py#L278</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-20 18:56</div>
            <div class="timeline-body"><p>@jelmer I&#x27;m sorry my message was totally confusing, what I really meant to say was that there does not seem to be any interaction between <code>force_sort_within_sections</code> and <code>lines_between_types</code>, which is loosely related to <code>from_first</code> because you had to handle the insertion of blank lines. That&#x27;s something I hadn&#x27;t noticed prior to looking at your PR, that&#x27;s why I was mentioning it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-20 18:58</div>
            <div class="timeline-body"><p>But that makes me think this PR is fine, I&#x27;ll open a separate issue for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelmer">@jelmer</a> on 2023-11-21 11:19</div>
            <div class="timeline-body"><blockquote>
<p>@jelmer I&#x27;m sorry my message was totally confusing, what I really meant to say was that there does not seem to be any interaction between <code>force_sort_within_sections</code> and <code>lines_between_types</code>, which is loosely related to <code>from_first</code> because you had to handle the insertion of blank lines. That&#x27;s something I hadn&#x27;t noticed prior to looking at your PR, that&#x27;s why I was mentioning it.</p>
</blockquote>
<p>Ah, sorry, I did indeed misunderstand. That makes sense to me though - both your comments on force_sort_within_sections and lines_between_types interactions, and doing that as a separate change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-11-21 23:31</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-21 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-21 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-27 15:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:59:21 UTC
    </footer>
</body>
</html>
