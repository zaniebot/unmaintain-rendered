<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider submodule imports to detect unused imports - astral-sh/ruff #5011</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider submodule imports to detect unused imports</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5011">#5011</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-06-11 02:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-11 02:28</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Take the below code as an example:</p>
<pre><code class="language-python">import foo.bar
import foo.some
</code></pre>
<p>Here, a single binding is created (<code>foo</code>) for both imports and the binding created for <code>foo.bar</code> will shadow the one created for <code>foo.some</code>. Now, if the binding <code>foo</code> is unused, then it means all of the bindings shadowing this is unused as well.</p>
<p>There's a conflict which I've commented down below. This is resulting in 2 test failures.</p>
<h2>Test Plan</h2>
<p><code>cargo test</code></p>
<p>fixes: #60
fixes: #4655</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-11 02:28</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #5011</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5011" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ğŸ‘ˆ</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5011?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-06-11 12:04</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      8.4Â±0.03ms     4.9 MB/sec    1.00      8.4Â±0.03ms     4.9 MB/sec
formatter/numpy/ctypeslib.py               1.00   1875.6Â±3.24Âµs     8.9 MB/sec    1.00   1876.4Â±7.05Âµs     8.9 MB/sec
formatter/numpy/globals.py                 1.00    203.5Â±0.32Âµs    14.5 MB/sec    1.01    204.5Â±1.50Âµs    14.4 MB/sec
formatter/pydantic/types.py                1.00      4.2Â±0.01ms     6.1 MB/sec    1.00      4.1Â±0.01ms     6.2 MB/sec
linter/all-rules/large/dataset.py          1.00     14.3Â±0.05ms     2.9 MB/sec    1.01     14.5Â±0.08ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.6Â±0.01ms     4.7 MB/sec    1.00      3.6Â±0.01ms     4.7 MB/sec
linter/all-rules/numpy/globals.py          1.00    382.5Â±1.54Âµs     7.7 MB/sec    1.04    396.5Â±1.06Âµs     7.4 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.4Â±0.04ms     4.0 MB/sec    1.01      6.4Â±0.04ms     4.0 MB/sec
linter/default-rules/large/dataset.py      1.00      7.2Â±0.03ms     5.7 MB/sec    1.02      7.3Â±0.05ms     5.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1471.4Â±2.89Âµs    11.3 MB/sec    1.02   1504.0Â±2.00Âµs    11.1 MB/sec
linter/default-rules/numpy/globals.py      1.00    157.3Â±0.25Âµs    18.8 MB/sec    1.06    167.4Â±0.29Âµs    17.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.2Â±0.01ms     8.0 MB/sec    1.01      3.2Â±0.01ms     7.9 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.03     13.7Â±0.51ms     3.0 MB/sec    1.00     13.3Â±0.54ms     3.1 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.8Â±0.10ms     5.9 MB/sec    1.04      2.9Â±0.14ms     5.7 MB/sec
formatter/numpy/globals.py                 1.00   322.4Â±14.10Âµs     9.2 MB/sec    1.06   342.1Â±29.46Âµs     8.6 MB/sec
formatter/pydantic/types.py                1.01      6.4Â±0.29ms     4.0 MB/sec    1.00      6.3Â±0.23ms     4.1 MB/sec
linter/all-rules/large/dataset.py          1.02     23.0Â±0.38ms  1807.6 KB/sec    1.00     22.6Â±0.64ms  1843.7 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.7Â±0.15ms     2.9 MB/sec    1.07      6.1Â±0.22ms     2.7 MB/sec
linter/all-rules/numpy/globals.py          1.00   677.1Â±28.07Âµs     4.4 MB/sec    1.03   699.2Â±21.19Âµs     4.2 MB/sec
linter/all-rules/pydantic/types.py         1.03     10.7Â±0.46ms     2.4 MB/sec    1.00     10.4Â±0.32ms     2.4 MB/sec
linter/default-rules/large/dataset.py      1.03     12.9Â±0.36ms     3.2 MB/sec    1.00     12.5Â±0.47ms     3.3 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.10      2.6Â±0.08ms     6.4 MB/sec    1.00      2.4Â±0.17ms     7.0 MB/sec
linter/default-rules/numpy/globals.py      1.00   296.1Â±11.08Âµs    10.0 MB/sec    1.00   296.4Â±11.23Âµs    10.0 MB/sec
linter/default-rules/pydantic/types.py     1.11      5.5Â±0.18ms     4.6 MB/sec    1.00      5.0Â±0.17ms     5.1 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-11 12:05</div>
            <div class="timeline-body"><p>So, it seems that there are some conflicting behavior between <code>flake8</code> and <code>pylint</code> (we've adopted <code>flake8</code> behvaior):</p>
<pre><code class="language-python">import foo
import foo.bar
</code></pre>
<p><code>flake8</code> will only trigger a violation of unused import on line 2 while <code>pylint</code> triggers for both lines. It's the same for the below code as well:</p>
<pre><code class="language-python">import foo
import bar as foo
</code></pre>
<p>I would argue to actually mark both as unused import similar to <code>pylint</code>. When called with the <code>--fix</code> flag, both these imports are removed even though the diagnostics suggest that the first import <em>isn't</em> unused:</p>
<pre><code class="language-console">$ ruff check --no-cache --isolated --select=F401,F811 src/F401.py
src/F401.py:2:8: F811 Redefinition of unused `foo` from line 15
src/F401.py:2:8: F401 [*] `foo` imported but unused
Found 2 errors.
[*] 1 potentially fixable with the --fix option.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dhruvmanila on 2023-06-11 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @dhruvmanila on 2023-06-11 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-29 00:13</div>
            <div class="timeline-body"><p>Hmm, I'm not totally certain on the right behavior here. Given the example from #60</p>
<pre><code class="language-python">import multiprocessing.pool
import multiprocessing.process

z = multiprocessing.pool.ThreadPool()
</code></pre>
<p>Wouldn't we end up flagging <code>multiprocessing.pool</code> as unused? It feels unintuitive, though may be correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-13 14:24</div>
            <div class="timeline-body"><blockquote>
<p>Wouldn't we end up flagging <code>multiprocessing.pool</code> as unused?</p>
</blockquote>
<p>@charliermarsh Do you mean <code>multiprocessing.process</code> as <code>multiprocessing.pool</code> is being used in your code.</p>
<p>But to answer your question, no it won't flag them. I've added a test case for the mentioned case: https://github.com/astral-sh/ruff/pull/5011/files#diff-cdbee39a5dfd985e12efeff0edaae1b8f79c8fdc2655e64ad12160cf84659930</p>
<p>(Sorry for the delay, I missed this in the notifications)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_semantic/src/scope.rs</code>:32 on 2023-07-14 06:07</div>
            <div class="timeline-body"><p>Hash maps are kind of expensive (48 bytes or something in size and require an allocation per scope). Could we instead move the name to <code>Binding</code>, recompute it on demand (implement a helper on <code>binding</code> that uses <code>BindingId</code> to extract the name, I would prefer this approach), or store it as a another <code>IndexVec&lt;BindingId, &amp;'str&gt;</code> on the semantic model (since we need an entry for <strong>every</strong> name).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-14 06:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-18 17:31</div>
            <div class="timeline-body"><p>@charliermarsh Any thoughts on how to proceed here? I'm totally fine with rejecting this solution altogether :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @charliermarsh removed by @dhruvmanila on 2023-07-18 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @dhruvmanila on 2023-07-18 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-20 22:49</div>
            <div class="timeline-body"><p>@dhruvmanila - Sorry for the delay (again), but let's close this out for now. I appreciate the work but submodule imports are complicated and I'm having trouble reasoning about the change, whether it's correct, and how it should be reflected in other rules (no fault of yours -- it just requires some investigation on my part, and I don't feel it's worth investing time in right now).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-20 22:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-21 01:46</div>
            <div class="timeline-body"><p>Hey, I totally understand ğŸ‘</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:31:00 UTC
    </footer>
</body>
</html>
