<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignore PERF203 if `try` contains loop control flow statements - astral-sh/ruff #6536</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignore PERF203 if <code>try</code> contains loop control flow statements</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6536">#6536</a>
        opened by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a>
        on 2023-08-13 14:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/evanrittenhouse">@evanrittenhouse</a></div>
            <div class="timeline-body">

Summary
<p>Fixes #6535</p>
Test Plan
<p><code>cargo t</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-13 14:43</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+0, -19, 0 error(s))</p>
airflow (+0, -13)
<p>

<pre>
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/models/variable.py#L280">airflow/models/variable.py:280:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/amazon/aws/log/s3_task_handler.py#L221">airflow/providers/amazon/aws/log/s3_task_handler.py:221:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/amazon/aws/operators/redshift_cluster.py#L499">airflow/providers/amazon/aws/operators/redshift_cluster.py:499:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/amazon/aws/operators/redshift_cluster.py#L587">airflow/providers/amazon/aws/operators/redshift_cluster.py:587:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/amazon/aws/operators/redshift_cluster.py#L680">airflow/providers/amazon/aws/operators/redshift_cluster.py:680:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/amazon/aws/triggers/emr.py#L85">airflow/providers/amazon/aws/triggers/emr.py:85:21:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/google/cloud/hooks/compute_ssh.py#L260">airflow/providers/google/cloud/hooks/compute_ssh.py:260:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers/google/cloud/hooks/datafusion.py#L375">airflow/providers/google/cloud/hooks/datafusion.py:375:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/providers_manager.py#L640">airflow/providers_manager.py:640:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/airflow/utils/file.py#L323">airflow/utils/file.py:323:9:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/dev/breeze/src/airflow_breeze/utils/confirm.py#L90">dev/breeze/src/airflow_breeze/utils/confirm.py:90:9:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py#L99">dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py:99:9:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/apache/airflow/blob/08565dcb8b296609a22955e79291ae9dfb51b5bb/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L210">dev/breeze/src/airflow_breeze/utils/selective_checks.py:210:9:</a> PERF203 `try`-`except` within a loop incurs performance overhead
</pre>

</p>

bokeh (+0, -1)
<p>

<pre>
- <a href="https://github.com/bokeh/bokeh/blob/88109a2966ed0ab146fe46c0cf0dde025fa37099/tests/support/plugins/file_server.py#L89">tests/support/plugins/file_server.py:89:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
</pre>

</p>

zulip (+0, -5)
<p>

<pre>
- <a href="https://github.com/zulip/zulip/blob/570ff08fdedbf5d541c85915f9bef9201e85478e/scripts/lib/supervisor.py#L17">scripts/lib/supervisor.py:17:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/zulip/zulip/blob/570ff08fdedbf5d541c85915f9bef9201e85478e/scripts/lib/zulip_tools.py#L224">scripts/lib/zulip_tools.py:224:9:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/zulip/zulip/blob/570ff08fdedbf5d541c85915f9bef9201e85478e/zerver/lib/rate_limiter.py#L462">zerver/lib/rate_limiter.py:462:17:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/zulip/zulip/blob/570ff08fdedbf5d541c85915f9bef9201e85478e/zerver/migrations/0037_disallow_null_string_id.py#L23">zerver/migrations/0037_disallow_null_string_id.py:23:17:</a> PERF203 `try`-`except` within a loop incurs performance overhead
- <a href="https://github.com/zulip/zulip/blob/570ff08fdedbf5d541c85915f9bef9201e85478e/zerver/worker/queue_processors.py#L664">zerver/worker/queue_processors.py:664:13:</a> PERF203 `try`-`except` within a loop incurs performance overhead
</pre>

</p>

Rules changed: 1

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PERF203 | 19 | 0 | 19 |</p>
Benchmark
Linux
<pre><code>group                                      main                                    pr
-----                                      ----                                    --
formatter/large/dataset.py                 1.00      3.8±0.22ms    10.7 MB/sec     2.26      8.6±0.46ms     4.7 MB/sec
formatter/numpy/ctypeslib.py               1.00   770.1±45.46µs    21.6 MB/sec     2.16  1660.8±82.57µs    10.0 MB/sec
formatter/numpy/globals.py                 1.00     76.9±6.14µs    38.4 MB/sec     2.49    191.4±8.47µs    15.4 MB/sec
formatter/pydantic/types.py                1.00  1530.3±100.55µs    16.7 MB/sec    2.44      3.7±0.34ms     6.8 MB/sec
linter/all-rules/large/dataset.py          1.00     11.6±0.49ms     3.5 MB/sec     1.03     11.9±0.49ms     3.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.0±0.13ms     5.5 MB/sec     1.05      3.2±0.17ms     5.2 MB/sec
linter/all-rules/numpy/globals.py          1.00   435.1±32.98µs     6.8 MB/sec     1.02   446.0±24.02µs     6.6 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.8±0.20ms     4.4 MB/sec     1.07      6.2±0.25ms     4.1 MB/sec
linter/default-rules/large/dataset.py      1.00      5.8±0.24ms     7.0 MB/sec     1.09      6.3±0.21ms     6.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1311.6±90.21µs    12.7 MB/sec     1.03  1354.4±65.29µs    12.3 MB/sec
linter/default-rules/numpy/globals.py      1.00    156.1±8.23µs    18.9 MB/sec     1.03    161.6±8.19µs    18.3 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.7±0.14ms     9.5 MB/sec     1.04      2.8±0.14ms     9.1 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      5.5±0.36ms     7.4 MB/sec    2.49     13.7±0.72ms     3.0 MB/sec
formatter/numpy/ctypeslib.py               1.00  1017.8±71.03µs    16.4 MB/sec    2.63      2.7±0.15ms     6.2 MB/sec
formatter/numpy/globals.py                 1.00    101.8±7.03µs    29.0 MB/sec    2.88   293.4±16.75µs    10.1 MB/sec
formatter/pydantic/types.py                1.00      2.1±0.12ms    11.9 MB/sec    2.70      5.8±0.28ms     4.4 MB/sec
linter/all-rules/large/dataset.py          1.00     17.7±0.74ms     2.3 MB/sec    1.02     18.0±0.90ms     2.3 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      4.9±0.17ms     3.4 MB/sec    1.00      4.8±0.25ms     3.5 MB/sec
linter/all-rules/numpy/globals.py          1.05  625.3±101.85µs     4.7 MB/sec    1.00   598.2±29.46µs     4.9 MB/sec
linter/all-rules/pydantic/types.py         1.01      9.1±0.39ms     2.8 MB/sec    1.00      9.0±0.53ms     2.8 MB/sec
linter/default-rules/large/dataset.py      1.00      9.7±0.37ms     4.2 MB/sec    1.00      9.7±0.48ms     4.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.0±0.11ms     8.2 MB/sec    1.00      2.0±0.07ms     8.2 MB/sec
linter/default-rules/numpy/globals.py      1.01   259.6±18.82µs    11.4 MB/sec    1.00   256.5±17.30µs    11.5 MB/sec
linter/default-rules/pydantic/types.py     1.03      4.5±0.18ms     5.7 MB/sec    1.00      4.3±0.22ms     5.9 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-14 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-14 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-14 23:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2023-08-14 23:27</div>
            <div class="timeline-body"><p>@charliermarsh Just wondering - why implement a <code>Visitor</code> here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-14 23:30</div>
            <div class="timeline-body"><p>@evanrittenhouse - Good q. We need to recurse through the body -- as-is, we were only looking at top-level statements, so it&#x27;d miss cases like:</p>
<pre><code>try:
  x = 1
  if True:
    break
except:
  pass
</code></pre>
<p>The alternative was to use <code>any_over_body</code>, but we actually <em>don&#x27;t</em> want to recurse into functions within the <code>try</code> body, so a custom visitor seemed simplest.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:56:17 UTC
    </footer>
</body>
</html>
