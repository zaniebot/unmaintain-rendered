<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pyupgrade`] Replace str,Enum with StrEnum `UP042` - astral-sh/ruff #10713</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pyupgrade</code>] Replace str,Enum with StrEnum <code>UP042</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10713">#10713</a>
        opened by <a href="https://github.com/Warchant">@Warchant</a>
        on 2024-04-01 15:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Warchant">@Warchant</a></div>
            <div class="timeline-body"><p>Disclaimer: I am first time contributor to Ruff, relatively new to Rust. Doing this to learn the language, study how ruff project is structured and to pay back for using my favourite python tool :)</p>
Summary
<p>Add new rule <code>pyupgrade - UP042</code> (I picked next available number).
Closes https://github.com/astral-sh/ruff/discussions/3867
Closes <a href="https://github.com/astral-sh/ruff/issues/9569">astral-sh/ruff#9569</a></p>
<p>It should warn + provide a fix <code>class A(str, Enum)</code> -&gt; <code>class A(StrEnum)</code> for py311+.</p>
Test Plan
<p>Added UP042.py test.</p>
Notes
<p>I did not find a way to call <code>remove_argument</code> 2 times consecutively, so the automatic fixing works only for classes that inherit exactly <code>str, Enum</code> (regardless of the order).</p>
<p>I also plan to extend this rule to support IntEnum in next PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-01 15:22</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/Warchant:main">CodSpeed Performance Report</a>
Merging #10713 will <strong>not alter performance</strong>
<p>Comparing <code>Warchant:main</code> (d677f25) with <code>main</code> (323264d)</p>
Summary
<p><code>✅ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/Warchant">@Warchant</a> on 2024-04-01 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-01 20:54</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+0 -1 violations, +0 -0 fixes in 1 projects; 43 projects unchanged)</p>
<a href="https://github.com/indico/indico">indico/indico</a> (+0 -1 violations, +0 -0 fixes)
<p>

<pre>
- <a href="https://github.com/indico/indico/blob/367d9abbec32c3aba1d13901ac67b04923d21144/indico/modules/admin/notices.py#L40">indico/modules/admin/notices.py:40:1:</a> UP042 Class NoticeSeverity inherits from both `str` and `enum.Enum`. Prefer `enum.StrEnum` instead.
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| UP042 | 1 | 0 | 1 | 0 | 0 |</p>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -1 violations, +0 -0 fixes in 1 projects; 43 projects unchanged)</p>
<a href="https://github.com/indico/indico">indico/indico</a> (+1 -1 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
- <a href="https://github.com/indico/indico/blob/367d9abbec32c3aba1d13901ac67b04923d21144/indico/modules/admin/notices.py#L40">indico/modules/admin/notices.py:40:1:</a> UP042 Class NoticeSeverity inherits from both `str` and `enum.Enum`. Prefer `enum.StrEnum` instead.
+ <a href="https://github.com/indico/indico/blob/367d9abbec32c3aba1d13901ac67b04923d21144/indico/modules/admin/notices.py#L40">indico/modules/admin/notices.py:40:7:</a> UP042 Class NoticeSeverity inherits from both `str` and `enum.Enum`
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| UP042 | 2 | 1 | 1 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-02 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Warchant">@Warchant</a> on 2024-04-05 20:42</div>
            <div class="timeline-body"><p>Anyone?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 20:57</div>
            <div class="timeline-body"><p>I’ll take a look today :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-04-06 01:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 01:43</div>
            <div class="timeline-body"><p>This is great! I made some changes to the documentation and rule messages just to better align with our style elsewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-06 01:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/replace_str_enum.rs</code>:113 on 2024-04-06 01:43</div>
            <div class="timeline-body"><p>I changed this to a <code>match</code> over the segments, rather than an <code>if</code>-<code>else</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-06 01:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/replace_str_enum.rs</code>:93 on 2024-04-06 01:43</div>
            <div class="timeline-body"><p>We prefer to omit the <em>fix</em> in the rule message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-06 01:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/replace_str_enum.rs</code>:135 on 2024-04-06 01:44</div>
            <div class="timeline-body"><p>The use of <code>.identifier()</code> here is nice because it confines the range of the diagnostic to the class name, rather than the <em>entire</em> class definition (which would include the class body).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-04-06 01:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/resources/test/fixtures/pyupgrade/UP042.py</code>:13 on 2024-04-06 01:44</div>
            <div class="timeline-body"><p>(I ran <code>ruff format</code> over the fixture. It&#x27;s not a hard rule, since fixtures are often intentionally unformatted, but it&#x27;s nice when we don&#x27;t rely on the formatting anywhere.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 01:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 01:47</div>
            <div class="timeline-body"><p>Left a few clarifying comments on changes that I made, but please ask questions if you&#x27;d like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 01:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-06 01:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:02:57 UTC
    </footer>
</body>
</html>
