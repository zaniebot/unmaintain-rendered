<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementing TRY400 - astral-sh/ruff #2115</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implementing TRY400</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2115">#2115</a>
        opened by <a href="https://github.com/Flowake">@Flowake</a>
        on 2023-01-23 22:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Flowake">@Flowake</a> on 2023-01-23 22:57</div>
            <div class="timeline-body"><p>Currently implementing TRY400 (#2056)</p>
<p>I cannot find the documentation for the ast parser used by ruff, where could I find it ? That would make my life easier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-24 00:04</div>
            <div class="timeline-body"><p>We use the RustPython AST, defined here: https://github.com/RustPython/RustPython/blob/main/compiler/ast/src/ast_gen.rs</p>
<p>It's actually generated by reading from the Python ASDL files, so it's pretty similar to the CPython AST.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Flowake">@Flowake</a> on 2023-01-24 22:57</div>
            <div class="timeline-body"><p>I have translated the raw python logic from the tryceratops library and I copied other rules to handle the reporting.</p>
<p>I think the violation might be triggered for any method &quot;error&quot; used in the except block. I would need to ensure that the object that the method is called on is a logger, but I'm not sure about how to do that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 00:44</div>
            <div class="timeline-body"><p>Yeah, we don't have any way to know for sure that the object is a logger. Like the original plugin, this will raise on any <code>.error(...)</code> call. The best we can do, probably, is trade false negatives for false positives by flagging specific cases, like <code>logging.error(...)</code> or <code>logger.error(...)</code> (that is, literally match on the names <code>logging</code> and <code>logger</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 00:44</div>
            <div class="timeline-body"><p>(Or we just accept this limitation, given that it exists &quot;upstream&quot;.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Flowake">@Flowake</a> on 2023-01-25 07:20</div>
            <div class="timeline-body"><p>I think sticking to the &quot;upstream&quot; plugin when there are no clear better alternatives for the implementation is preferable.</p>
<p>If you're ok with the code I can make this PR ready for review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Flowake on 2023-01-25 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Flowake">@Flowake</a> on 2023-01-25 19:24</div>
            <div class="timeline-body"><p>I fixed the last issue, it's ready for review !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 19:37</div>
            <div class="timeline-body"><p>Sounds good. I'll give this a look today and merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Flowake">@Flowake</a> on 2023-01-25 22:56</div>
            <div class="timeline-body"><p>I was reading about other rules and their auto fixing part and was wondering what is the approach in this case: we know that the rule will have false negatives, which an autofix would definitely break.</p>
<p>If we want to auto fix this rule, we might actually switch to checking specific cases (like logging and logger) to ensure we only have false positives and then autofix it by changing <code>.error</code> to <code>.exception</code>. But if there was a custom object called <code>logger</code> with an <code>error</code> method and no <code>exception</code> method, it would also produce broken code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-25 23:00</div>
            <div class="timeline-body"><p>I think this one is too uncertain to allow an autofix. The one case we <em>could</em> fix is, if the call is <code>import logging; logging.error</code>, then we have the ability to verify that call path and fix it. But any other case is likely too dangerous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-26 00:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/tryceratops/mod.rs</code>:23 on 2023-01-26 00:41</div>
            <div class="timeline-body"><p>Quick tip for the future: in order to get the fixture to run on CI etc., we need to add a test case here via this macro.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/tryceratops/rules/error_instead_of_exception.rs</code>:26 on 2023-01-26 00:42</div>
            <div class="timeline-body"><p>I decided to make this a bit stricter. I'm just erring on the side of false negatives these days a little bit, especially for checks like this that lack strong static verifiability. Sorry for the last minute change!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-26 00:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-26 00:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-26 00:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:54:13 UTC
    </footer>
</body>
</html>
