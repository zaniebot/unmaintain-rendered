<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format function argument separator comments - astral-sh/ruff #5211</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format function argument separator comments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5211">#5211</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-06-20 15:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-06-20 15:14</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a complete rewrite of the handling of <code>/</code> and <code>*</code> comment handling in function signatures. The key problem is that slash and star don't have a note. We now parse out the positions of slash and star and their respective preceding and following note. I've left code comments for each possible case of function signature structure and comment placement</p>
<h2>Test Plan</h2>
<p>I extended the function statement fixtures with cases that i found. If you have more weird edge cases your input would be appreciated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-20 15:14</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #5209</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5209" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #5210</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5210" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #5211</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5211" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5211?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-06-20 15:53</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      6.9Â±0.02ms     5.9 MB/sec    1.02      7.0Â±0.03ms     5.8 MB/sec
formatter/numpy/ctypeslib.py               1.00   1372.4Â±2.71Âµs    12.1 MB/sec    1.01   1388.3Â±2.43Âµs    12.0 MB/sec
formatter/numpy/globals.py                 1.00    132.4Â±0.26Âµs    22.3 MB/sec    1.01    133.2Â±0.62Âµs    22.2 MB/sec
formatter/pydantic/types.py                1.00      2.8Â±0.02ms     9.0 MB/sec    1.02      2.9Â±0.03ms     8.8 MB/sec
linter/all-rules/large/dataset.py          1.01     13.7Â±0.11ms     3.0 MB/sec    1.00     13.6Â±0.03ms     3.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.4Â±0.00ms     4.8 MB/sec    1.00      3.4Â±0.01ms     4.8 MB/sec
linter/all-rules/numpy/globals.py          1.00    358.8Â±1.71Âµs     8.2 MB/sec    1.00    358.9Â±1.82Âµs     8.2 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.0Â±0.01ms     4.2 MB/sec    1.00      6.0Â±0.01ms     4.2 MB/sec
linter/default-rules/large/dataset.py      1.00      7.0Â±0.01ms     5.8 MB/sec    1.00      7.0Â±0.02ms     5.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1463.7Â±4.83Âµs    11.4 MB/sec    1.00   1461.8Â±3.24Âµs    11.4 MB/sec
linter/default-rules/numpy/globals.py      1.00    154.5Â±0.30Âµs    19.1 MB/sec    1.00    154.7Â±0.19Âµs    19.1 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.2Â±0.01ms     8.1 MB/sec    1.00      3.2Â±0.01ms     8.1 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      7.9Â±0.16ms     5.2 MB/sec    1.08      8.5Â±0.11ms     4.8 MB/sec
formatter/numpy/ctypeslib.py               1.00  1598.8Â±47.53Âµs    10.4 MB/sec    1.06  1692.9Â±30.68Âµs     9.8 MB/sec
formatter/numpy/globals.py                 1.00    157.4Â±4.71Âµs    18.7 MB/sec    1.06    166.5Â±5.38Âµs    17.7 MB/sec
formatter/pydantic/types.py                1.00      3.3Â±0.06ms     7.8 MB/sec    1.08      3.5Â±0.06ms     7.2 MB/sec
linter/all-rules/large/dataset.py          1.00     15.8Â±0.24ms     2.6 MB/sec    1.01     15.9Â±0.29ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.2Â±0.07ms     4.0 MB/sec    1.00      4.2Â±0.07ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00   512.6Â±12.19Âµs     5.8 MB/sec    1.00   511.7Â±15.62Âµs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.01      7.2Â±0.14ms     3.6 MB/sec    1.00      7.1Â±0.13ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.2Â±0.11ms     5.0 MB/sec    1.00      8.1Â±0.12ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1735.6Â±27.66Âµs     9.6 MB/sec    1.00  1739.7Â±27.39Âµs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    202.9Â±7.80Âµs    14.5 MB/sec    1.00    203.1Â±7.58Âµs    14.5 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.7Â±0.07ms     6.9 MB/sec    1.00      3.7Â±0.05ms     6.9 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-06-21 09:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-06-21 10:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:649 on 2023-06-21 11:06</div>
            <div class="timeline-body"><p>Nit: Should we pass <code>slash_and_star</code> by reference here. It would reduce the number of arguments. We could even implement this method on <code>slash_and_star</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:270 on 2023-06-21 11:08</div>
            <div class="timeline-body"><p>Can we remove this branch? The <code>else</code> branch returns <code>None</code> and the <code>else if</code> can never be <code>true</code> if <code>posonlyargs</code> is empty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:295 on 2023-06-21 11:46</div>
            <div class="timeline-body"><p>Nit: <code>arguments.kewonlyargs.is_empty</code> is already handled by the <code>else</code> branch (the only case where <code>.first()</code> returns <code>None</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:454 on 2023-06-21 11:49</div>
            <div class="timeline-body"><p>Nit: Define a struct with named fields. It's hard to guess the meaning of the text positions and range.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:483 on 2023-06-21 11:50</div>
            <div class="timeline-body"><p>Nit: <code>TextRange::new(preceding_end, slash.start).contains(comment_range.start())</code> Not saying it is better. Just an alternative ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-06-21 11:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:649 on 2023-06-21 17:36</div>
            <div class="timeline-body"><p>i split slash and star into objects, both passed by reference</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-21 17:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-21 17:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:270 on 2023-06-21 17:37</div>
            <div class="timeline-body"><p>good catch, this was remnant of the defaults list time</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-21 17:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:454 on 2023-06-21 17:38</div>
            <div class="timeline-body"><p>refactored the entire code</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-06-21 17:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/other/arguments.rs</code>:483 on 2023-06-21 17:40</div>
            <div class="timeline-body"><p>hmm either works, but i'll keep it as is</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-06-21 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-06-21 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-06-21 17:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:37:34 UTC
    </footer>
</body>
</html>
