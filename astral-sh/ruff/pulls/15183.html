<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Introduce type parameters for InstanceType - astral-sh/ruff #15183</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Introduce type parameters for InstanceType</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15183">#15183</a>
        opened by <a href="https://github.com/pcmoritz">@pcmoritz</a>
        on 2024-12-30 00:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/pcmoritz">@pcmoritz</a> on 2024-12-30 00:33</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR introduces type parameters to InstanceType, so an instance of type like <code>dict[str, str]</code> can be represented.</p>
<p>I'm curious for feedback if this is the right way to do it or if there is a better way!</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @pcmoritz on 2024-12-30 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @pcmoritz on 2024-12-30 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @pcmoritz on 2024-12-30 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @pcmoritz on 2024-12-30 00:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-12-30 00:40</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-12-30 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-05 17:23</div>
            <div class="timeline-body"><p>Hey, thanks for this PR! Sorry for the delay in getting back to you on this -- several people on the team were on holiday between Christmas and new year's day :-)</p>
<p>Unfortunately, how best to represent generic type parameters and generic type arguments is quite a big topic that requires a certain amount of care. @carljm has written up a plan for how to do this which has been shared and discussed internally, and it will require a fair amount of refactoring to get all the details right. This is because we need to make sure that e.g. an error is emitted if a user uses <code>dict[str, int, bytes]</code> in an annotation (<code>dict</code> requires exactly two type arguments).</p>
<p>Additionally, it's quite hard for us to test our implementation of generics until we properly implement attribute access on <code>Type::Instance</code> types. This is another huge topic, and one that @sharkdp is planning on tackling -- but it probably needs to be done before generics, unfortunately!</p>
<p>All in all, I think it's probably unlikely that we'll merge this, sadly. It's not a <em>great</em> task for a contributor at the end of the day -- but we have lots of red-knot issues with the &quot;help wanted&quot; label open at the moment; I'd encourage you to take a look at those and see if any take your fancy!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-01-05 19:32</div>
            <div class="timeline-body"><p>Thanks for your work on this! As @AlexWaygood suggests, this isn't quite the direction we'll want to take. Specifically, we'll want to represent a &quot;specialized&quot; generic class (that is, a generic class with its type parameters filled in with type arguments) at a layer below this: roughly, a new layer of struct wrapping <code>Class</code> and wrapped by <code>InstanceType</code>. This is because a specialized generic class can also occur in other places where we currently have a <code>Class</code>: not only <code>InstanceType</code>, but also <code>SubclassOfType</code>, <code>ClassBase::Class</code>, and maybe others I'm forgetting at the moment.</p>
<p>Although this isn't the topic I'd have suggested for a first contribution to red-knot (because it will be an invasive change), it's promising that you carried this initial approach this far successfully! If you're highly motivated to work on this contribution, and willing to likely go through several review iterations to get there, I'd be open to sharing the internal design doc with you (which fleshes out the above sketch with specific struct names and more details) and working with you on it as reviewer. Let me know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-26 14:36</div>
            <div class="timeline-body"><p>@pcmoritz, I'm going to close this for now to keep our list of open PRs relatively tidy, since (for the reasons discussed above) I think this probably isn't the way we want to go exactly, and since there are now heavy merge conflicts here anyway. But please do say if you'd still like to help out with adding support for generics! It would be great to have you on board, and we'd be very happy to share our internal design proposal with you :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-01-26 14:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:51 UTC
    </footer>
</body>
</html>
