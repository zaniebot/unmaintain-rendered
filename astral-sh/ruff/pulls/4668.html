<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement Pylint's `yield-inside-async-function` rule (`PLE1700`)  - astral-sh/ruff #4668</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement Pylint&#x27;s <code>yield-inside-async-function</code> rule (<code>PLE1700</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4668">#4668</a>
        opened by <a href="https://github.com/chanman3388">@chanman3388</a>
        on 2023-05-26 09:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chanman3388">@chanman3388</a></div>
            <div class="timeline-body">

Summary
<p>Implement pylint&#x27;s <code>yield-inside-async-function</code> rule <a href="https://pylint.pycqa.org/en/latest/user_guide/messages/error/yield-inside-async-function.html">E1700</a>
I believe since 3.6, <code>yield</code> is allowed inside an async function, but <code>yield from</code> is still not allowed hence I decided to rename it.
It should be possible to provide an autofix in <em>some</em> situations, but I haven&#x27;t looked into it yet.</p>
Test Plan
<p>Made a noddy example to have a <code>yield</code> inside of a an async function, and a <code>yield from</code> inside an async function. Tested against pylint&#x27;s behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-05-26 09:39</div>
            <div class="timeline-body">PR Check Results
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     15.0±0.07ms     2.7 MB/sec    1.01     15.2±0.08ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.6±0.01ms     4.6 MB/sec    1.01      3.7±0.02ms     4.5 MB/sec
linter/all-rules/numpy/globals.py          1.00    378.9±2.56µs     7.8 MB/sec    1.00    377.6±2.84µs     7.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.3±0.01ms     4.1 MB/sec    1.01      6.3±0.02ms     4.0 MB/sec
linter/default-rules/large/dataset.py      1.00      7.4±0.01ms     5.5 MB/sec    1.01      7.5±0.03ms     5.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1596.1±3.15µs    10.4 MB/sec    1.01   1611.2±7.63µs    10.3 MB/sec
linter/default-rules/numpy/globals.py      1.00    175.5±0.28µs    16.8 MB/sec    1.02    178.8±0.49µs    16.5 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.4±0.01ms     7.6 MB/sec    1.02      3.4±0.03ms     7.4 MB/sec
parser/large/dataset.py                    1.00      5.7±0.01ms     7.1 MB/sec    1.00      5.7±0.01ms     7.1 MB/sec
parser/numpy/ctypeslib.py                  1.00   1122.1±0.51µs    14.8 MB/sec    1.00   1124.6±8.85µs    14.8 MB/sec
parser/numpy/globals.py                    1.00    114.3±0.23µs    25.8 MB/sec    1.00    114.1±0.27µs    25.9 MB/sec
parser/pydantic/types.py                   1.00      2.5±0.00ms    10.4 MB/sec    1.00      2.5±0.00ms    10.4 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     20.9±0.72ms  1996.9 KB/sec    1.01     21.1±0.72ms  1970.7 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.2±0.20ms     3.2 MB/sec    1.00      5.2±0.18ms     3.2 MB/sec
linter/all-rules/numpy/globals.py          1.02   640.1±32.87µs     4.6 MB/sec    1.00   629.2±32.47µs     4.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      8.8±0.34ms     2.9 MB/sec    1.01      8.9±0.34ms     2.9 MB/sec
linter/default-rules/large/dataset.py      1.02     10.4±0.46ms     3.9 MB/sec    1.00     10.2±0.30ms     4.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02      2.2±0.10ms     7.5 MB/sec    1.00      2.2±0.08ms     7.6 MB/sec
linter/default-rules/numpy/globals.py      1.04   260.6±15.01µs    11.3 MB/sec    1.00    251.7±9.81µs    11.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      4.7±0.16ms     5.4 MB/sec    1.00      4.7±0.28ms     5.4 MB/sec
parser/large/dataset.py                    1.00      8.0±0.21ms     5.1 MB/sec    1.02      8.1±0.21ms     5.0 MB/sec
parser/numpy/ctypeslib.py                  1.02  1555.1±85.57µs    10.7 MB/sec    1.00  1526.4±59.69µs    10.9 MB/sec
parser/numpy/globals.py                    1.02   160.3±12.00µs    18.4 MB/sec    1.00    156.4±7.14µs    18.9 MB/sec
parser/pydantic/types.py                   1.00      3.4±0.13ms     7.4 MB/sec    1.01      3.5±0.11ms     7.3 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:3088 on 2023-05-26 12:16</div>
            <div class="timeline-body"><p>I was confused about why the rule does not check whether <code>expr</code> is a <code>YieldFrom</code> expression. I think we can make this clearer by only accepting a <code>ExprYieldFrom</code> in <code>yield_from_in_async_function</code> and passing the <code>yield_from</code> expression here.</p>
<ol>
<li>Change the match arm to <code>Expr::YieldFrom(yield_from) =&gt; {</code></li>
</ol>
<pre><code>                    pylint::rules::yield_from_in_async_function(self, yield_from);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-05-26 12:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-27 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-27 01:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-27 01:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:53:59 UTC
    </footer>
</body>
</html>
