<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Implement diagnostic caching - astral-sh/ruff #19605</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Implement diagnostic caching</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19605">#19605</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-07-28 19:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>This PR adds support for caching workspace diagnostics.</p>
<p>For each file, ty now sends a <code>resultId</code> that is the hash of all diagnostics for that file. The client sends the <code>resultId</code>s from the previous workspace diagnostic requests as part of the next request payload. This allows ty to determine if the diagnostics of a file changed and only send a full diagnostic report for those files (and send unchanged for all other files).</p>
<p>I hoped that this would fix the observed lag for home assistant when workspace diagnostics are enabled. Unfortunately, this isn&#x27;t the case. It reduces the lag, but it doesn&#x27;t fix it entirely</p>
Test Plan
<p>https://github.com/user-attachments/assets/3b0d1a3d-21cd-49a3-8c43-7b2781b1c02f</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-28 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-28 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-28 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-28 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-28 19:57</div>
            <div class="timeline-body">

Diagnostic diff on typing conformance tests

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-07-30 09:58:15.659765386 +0000
+++ new-output.txt	2025-07-30 09:58:15.723765355 +0000
@@ -87,6 +87,7 @@
 aliases_variance.py:18:24: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassA[T_co]&#x27;&gt;` with no `__class_getitem__` method
 aliases_variance.py:28:16: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassA[T_co]&#x27;&gt;` with no `__class_getitem__` method
 aliases_variance.py:44:16: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassB[T_co, T_contra]&#x27;&gt;` with no `__class_getitem__` method
+annotations_coroutines.py:27:5: error[type-assertion-failure] Argument does not have asserted type `str`
 annotations_forward_refs.py:22:7: error[unresolved-reference] Name `ClassA` used when not defined
 annotations_forward_refs.py:23:12: error[unresolved-reference] Name `ClassA` used when not defined
 annotations_forward_refs.py:49:10: error[invalid-type-form] Variable of type `Literal[1]` is not allowed in a type expression
@@ -101,6 +102,8 @@
 annotations_forward_refs.py:96:1: error[type-assertion-failure] Argument does not have asserted type `int`
 annotations_generators.py:86:21: error[invalid-return-type] Return type does not match returned value: expected `int`, found `types.GeneratorType`
 annotations_generators.py:91:27: error[invalid-return-type] Return type does not match returned value: expected `int`, found `types.AsyncGeneratorType`
+annotations_generators.py:167:5: error[type-assertion-failure] Argument does not have asserted type `AsyncGenerator[str, None]`
+annotations_generators.py:174:5: error[type-assertion-failure] Argument does not have asserted type `AsyncGenerator[str, None]`
 annotations_generators.py:193:1: error[type-assertion-failure] Argument does not have asserted type `() -&gt; AsyncIterator[int]`
 annotations_methods.py:31:1: error[type-assertion-failure] Argument does not have asserted type `A`
 annotations_methods.py:36:1: error[type-assertion-failure] Argument does not have asserted type `B`
@@ -889,4 +892,4 @@
 tuples_type_form.py:36:1: error[invalid-assignment] Object of type `tuple[Literal[1], Literal[2], Literal[3], Literal[&quot;&quot;]]` is not assignable to `tuple[int, ...]`
 typeddicts_operations.py:60:1: error[type-assertion-failure] Argument does not have asserted type `str | None`
 typeddicts_type_consistency.py:101:1: error[invalid-assignment] Object of type `Unknown | None` is not assignable to `str`
-Found 890 diagnostics
+Found 893 diagnostics
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-28 19:59</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-28 20:07</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/dcreager">@dcreager</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/sharkdp">@sharkdp</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/AlexWaygood">@AlexWaygood</a> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-07-29 16:24</div>
            <div class="timeline-body"><p>(I plan to review this first thing tomorrow morning)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/server/api/requests/workspace_diagnostic.rs</code>:38 on 2025-07-30 03:16</div>
            <div class="timeline-body"><p>nit: we could probably remove this comment now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/src/server/api/requests/workspace_diagnostic.rs</code>:117 on 2025-07-30 03:24</div>
            <div class="timeline-body"><p>nit: we could probably consume <code>previous_results</code> (via <code>.into_iter()</code>) to avoid the clone on <code>previous_url</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:39 on 2025-07-30 03:26</div>
            <div class="timeline-body"><p>Should this be applied globally in <code>TextContext::new</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:222 on 2025-07-30 03:35</div>
            <div class="timeline-body"><p>I wonder if this should actually be fixed in the test server instead to mimic what a client would do. This is because, I think, it&#x27;s VS Code that does this part or more specifically the ty VS Code extension that creates the workspace and global settings and sends it via the initialization options.</p>
<p>The extension would construct workspace settings by asking VS Code the values for each setting which would automatically fallback to the global value. This means the server doesn&#x27;t need to do any resolution between workspace and global values. This is what Ruff (and ty) does currently.</p>
<p>https://github.com/astral-sh/ty-vscode/blob/641781c780fad4d575c3ee715e2a6f70e5e29a8c/src/common/settings.ts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:233 on 2025-07-30 03:36</div>
            <div class="timeline-body"><p>Is this required for workspace diagnostics to work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:237 on 2025-07-30 03:36</div>
            <div class="timeline-body"><p>A follow-up (good help wanted task) would be to render these diagnostics similar to the ones in server unit tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:120 on 2025-07-30 03:37</div>
            <div class="timeline-body"><p>Should we <code>panic!</code> here similar to <code>WorkspaceDiagnosticReportResult::Partial</code> branch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:134 on 2025-07-30 03:39</div>
            <div class="timeline-body"><p>Should we close these files after making these changes? We could have a helper method on <code>TestServer</code> that does this for us but it also isn&#x27;t too verbose here either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:317 on 2025-07-30 03:40</div>
            <div class="timeline-body"><p>Should we add a test case where the diagnostic content didn&#x27;t change but the range did? Like, new content got added to the file but the new content doesn&#x27;t produce the diagnostics so the existing diagnostic just got moved further down.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/main.rs</code>:767 on 2025-07-30 03:41</div>
            <div class="timeline-body"><p>I think we should use <code>initialization_options</code> instead of <code>global_options</code> which is what this is from a client&#x27;s perspective.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-07-30 03:43</div>
            <div class="timeline-body"><p>Thank you!</p>
<p>This looks relatively straightforward. Do you know how much of a performance improvement does this make?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-07-30 03:48</div>
            <div class="timeline-body"><p>Another follow-up would be to add this to document diagnostic as well (<code>textDocument/diagnostic</code>) but I&#x27;m not sure if it&#x27;s beneficial in that request because that request would be sent every time the file got changed and whenever a user is typing, the change would usually produce a syntax error initially before the code gets in a stable state. One scenario where it would be useful is when copy pasting a code snippet which doesn&#x27;t produce any diagnostic and the locations of existing diagnostics didn&#x27;t change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-30 06:38</div>
            <div class="timeline-body"><blockquote>
<p>This looks relatively straightforward. Do you know how much of a performance improvement does this make?</p>
</blockquote>
<p>I don&#x27;t know how I&#x27;d measure this. I&#x27;d need to plug into VS code&#x27;s rendering performance (it&#x27;s re-rendering the problems list that is slow)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 06:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:39 on 2025-07-30 06:39</div>
            <div class="timeline-body"><p>I don&#x27;t think we should because the filter isn&#x27;t very specific. It replaces all 16 digit numbers with <code>RESULT_ID</code>. I&#x27;d be worried that it replaces some other random numbers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 06:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:222 on 2025-07-30 06:43</div>
            <div class="timeline-body"><p>Ideally, we&#x27;d fix this in the server itself, but it feels out of scope for this PR. I&#x27;m not entirely sure how I would model this but the server should prefer the option specified in the global option over a value provided in the workspace configuration. In fact, it should only use the workspace level option if it wasn&#x27;t provided globally. But I&#x27;d prefer not to make changes to settings while you&#x27;re also doing a refactor. That&#x27;s why I&#x27;d prefer to leave this as is for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 06:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:233 on 2025-07-30 06:43</div>
            <div class="timeline-body"><p>It&#x27;s not. It just feels more realistic to have at least one file open :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 06:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:237 on 2025-07-30 06:45</div>
            <div class="timeline-body"><p>I&#x27;m not sure if this is worth it here, given that we don&#x27;t really care about the diagnostic content. The only part we&#x27;re interested in is if they&#x27;re full results or unchanged. I think I rather redact the diagnostic content in snapshots than render them in a fancy way to make the test less prone to changes in ty&#x27;s core.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 06:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:134 on 2025-07-30 06:47</div>
            <div class="timeline-body"><p>I think that makes sense for a test, testing the workspace diagnostic mode. I don&#x27;t think it&#x27;s necessary here and it only complicates the test (it&#x27;s also sort of tested already by the fact that the initial run only opens 1 file)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 06:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/main.rs</code>:767 on 2025-07-30 06:49</div>
            <div class="timeline-body"><p>Would that require that the test specify the entire <code>initialization_options</code>? Like, with <code>{ &quot;settings&quot;: global_options }</code>?</p>
<p>I&#x27;d prefer if we can avoid this. It took me longer than it should have to figure out the right structure of our <code>initialization_options</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-07-30 08:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:237 on 2025-07-30 08:01</div>
            <div class="timeline-body"><p>Ah yeah, I think that makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-07-30 08:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/main.rs</code>:767 on 2025-07-30 08:04</div>
            <div class="timeline-body"><blockquote>
<p>Would that require that the test specify the entire <code>initialization_options</code>? Like, with <code>{ &quot;settings&quot;: global_options }</code>?</p>
</blockquote>
<p>No, I just want to indicate that these are the initialization options because I&#x27;d find global options a bit confusing from a client perspective.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-07-30 08:04</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t know how I&#x27;d measure this. I&#x27;d need to plug into VS code&#x27;s rendering performance (it&#x27;s re-rendering the problems list that is slow)</p>
</blockquote>
<p>A quick way would be to get the numbers that the server logs? I think it logs how long it took a request at the debug or trace level.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-07-30 08:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_server/tests/e2e/pull_diagnostics.rs</code>:222 on 2025-07-30 08:06</div>
            <div class="timeline-body"><p>That sounds reasonable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 08:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/tests/e2e/main.rs</code>:767 on 2025-07-30 08:50</div>
            <div class="timeline-body"><p>I can rename it and I just saw that this will take <code>InitializationOptions</code> in your settings pr</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 08:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/src/server/api/requests/workspace_diagnostic.rs</code>:38 on 2025-07-30 08:51</div>
            <div class="timeline-body"><p>Yes, while it is still true, we shouldn&#x27;t hit this log as frequently anymore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-30 08:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_server/src/server/api/requests/workspace_diagnostic.rs</code>:117 on 2025-07-30 08:56</div>
            <div class="timeline-body"><p>It already uses <code>into_iter</code> implicitly. The reason we need to clone the <code>url</code> is because <code>key</code> requires an owned <code>Url</code> and we also need the URL for the <code>FullDiagnosticReportItem</code>. It might be possible to avoid the URL clone by getting the <code>url</code> from the <code>DocumentRef</code> (adding an <code>into_url</code> method or similar) but it complicates the code a fair amount which I don&#x27;t think is justified</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-30 09:00</div>
            <div class="timeline-body"><blockquote>
<p>A quick way would be to get the numbers that the server logs? I think it logs how long it took a request at the debug or trace level.</p>
</blockquote>
<p>I don&#x27;t think this number will be very meaningful. The issue isn&#x27;t that the request takes too long. It&#x27;s that VS code dies diffing the diagnostics and rendering the new diagnostics</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-30 10:00</div>
            <div class="timeline-body"><blockquote>
<p>Another follow-up would be to add this to document diagnostic as well (textDocument/diagnostic) but I&#x27;m not sure if it&#x27;s beneficial in that request because that request would be sent every time the file got changed and whenever a user is typing, the change would usually produce a syntax error initially before the code gets in a stable state. One scenario where it would be useful is when copy pasting a code snippet which doesn&#x27;t produce any diagnostic and the locations of existing diagnostics didn&#x27;t change.</p>
</blockquote>
<p>Done. I think it&#x27;s still useful because an editor might send <code>pullDiagnostic</code> requests for multiple files and the diagnostics won&#x27;t change for all of them</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Cache workspace diagnostics&quot; to &quot;[ty] Implement diagnostic caching&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-30 10:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-30 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-30 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-30 10:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:17:07 UTC
    </footer>
</body>
</html>
