```yaml
number: 7264
title: Use snapshots for remaining lexer tests
type: pull_request
state: merged
author: dhruvmanila
labels:
  - internal
assignees: []
merged: true
base: main
head: dhruv/lexer-test-1
created_at: 2023-09-11T08:18:38Z
updated_at: 2023-09-11T18:46:40Z
url: https://github.com/astral-sh/ruff/pull/7264
synced_at: 2026-01-12T02:45:38Z
```

# Use snapshots for remaining lexer tests

---

_Pull request opened by @dhruvmanila on 2023-09-11 08:18_

## Summary

This PR updates the remaining lexer test cases to use the snapshots. This is
mainly a mechanical refactor.

## Motivation

The main motivation is so that when we add the token range values to the test
case output, it's easier to update the test cases.

The reason they were not using the snapshots before was because of the usage of
`test_case` macro. The macros is mainly used for different EOL test cases. If we
just generate the snapshots directly, then the snapshot name would be suffixed
with `-1`, `-2`, etc. as the test function is still the same. So, we'll create
the snapshot ourselves with the platform name for the respective EOL test cases.

## Test Plan

`cargo test`


---

_Comment by @dhruvmanila on 2023-09-11 08:18_

Current dependencies on/for this PR:
* main
  * **PR #7264** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7264" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
    * **PR #7265** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7265" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7264?utm_source=stack-comment).

---

_Label `internal` added by @dhruvmanila on 2023-09-11 08:19_

---

_Review requested from @MichaReiser by @dhruvmanila on 2023-09-11 08:29_

---

_Comment by @github-actions[bot] on 2023-09-11 08:34_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Review comment by @MichaReiser on `crates/ruff_python_parser/src/lexer.rs`:1307 on 2023-09-11 14:38_

Nit: I prefer to avoid `test_case` and other macros except if necessary. I think I would have created a helper function here instead

```rust
fn iptyon_escape_command_line_continuation_with_eol(eol: &str) -> Vec<Token> {
	let source = format!("%matplotlib \\{eol}");
	lex_jupyter_source(&source)
}

#[test]
fn ipython_escape_command_line_continuation_with_ln() {
	assert_debug_snapshot(ipython_escape_command_line_continuation_with_eol("\n"))
}
```

It's slightly more code but requires no knowledge about any macros.

---

_@MichaReiser approved on 2023-09-11 14:38_

---

_Closed by @dhruvmanila on 2023-09-11 17:57_

---

_Reopened by @dhruvmanila on 2023-09-11 17:57_

---

_Merged by @dhruvmanila on 2023-09-11 18:46_

---

_Closed by @dhruvmanila on 2023-09-11 18:46_

---

_Branch deleted on 2023-09-11 18:46_

---
