<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Render Azure, JSON, and JSON lines output with the new diagnostics - astral-sh/ruff #19133</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Render Azure, JSON, and JSON lines output with the new diagnostics</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19133">#19133</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-07-03 22:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-03 22:02</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This was originally stacked on #19129, but some of the changes I made for JSON also impacted the Azure format, so I went ahead and combined them. The main changes here are:</p>
<ul>
<li>Implementing <code>FileResolver</code> for Ruff's <code>EmitterContext</code></li>
<li>Adding <code>FileResolver::notebook_index</code> and <code>FileResolver::is_notebook</code> methods</li>
<li>Adding a <code>DisplayDiagnostics</code> (with an &quot;s&quot;) type for rendering a group of diagnostics at once</li>
<li>Adding <code>Azure</code>, <code>Json</code>, and <code>JsonLines</code> as new <code>DiagnosticFormat</code>s</li>
</ul>
<p>I tried a couple of alternatives to the <code>FileResolver::notebook</code> methods like passing down the <code>NotebookIndex</code> separately and trying to reparse a <code>Notebook</code> from Ruff's <code>SourceFile</code>. The latter seemed promising, but the <code>SourceFile</code> only stores the concatenated plain text of the notebook, not the re-parsable JSON. I guess the current version is just a variation on passing the <code>NotebookIndex</code>,  but at least we can reuse the existing <code>resolver</code> argument. I think a lot of this can be cleaned up once Ruff has its own actual file resolver.</p>
<p>As suggested, I also tried deleting the corresponding <code>Emitter</code> files in <code>ruff_linter</code>, but it doesn't look like git was able to follow this as a rename. It did, however, track that the tests were moved, so the snapshots should be easy to review.</p>
<h2>Test Plan</h2>
<p>Existing Ruff tests ported to tests in <code>ruff_db</code>. I think some other existing ruff tests also cover parts of this refactor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @ntBre on 2025-07-03 22:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @ntBre on 2025-07-03 22:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-03 22:05</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-03 22:21</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[WIP] Render JSON output with the new diagnostics" to "Render Azure, JSON, and JSON lines output with the new diagnostics" by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @ntBre on 2025-07-04 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @ntBre on 2025-07-04 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @ntBre on 2025-07-04 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @ntBre on 2025-07-04 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @ntBre on 2025-07-04 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @ntBre on 2025-07-04 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:24 on 2025-07-07 10:07</div>
            <div class="timeline-body"><p>We should update the naming here to not use <code>message</code> anymore (the concept no longer exists and is now only confusing)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-07 10:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:77 on 2025-07-07 10:15</div>
            <div class="timeline-body"><p>Keeping the existing JSON output as is does make sense for ruff but I don't think we should use it for ty:</p>
<ul>
<li>The <code>code</code> should be the diagnostic id (and we may want to align the field name)</li>
<li>The output lacks the severity</li>
<li><code>noqa_row</code> isn't used by ty</li>
<li>ty has many diagnostics without a file or range and we can't just omit those</li>
</ul>
<p>This JSON output also only supports a subset of what the new diagnostic system supports. E.g. the following information gets lost:</p>
<ul>
<li>All sub diagnostics get lost</li>
<li>All, except the primary, annotation get lost</li>
</ul>
<p>I think the right approach here is to add this legacy JSON output as is for now but only expose it in Ruff. We can design a new JSON output format (which is closer to our internal model) in a seperate PR and use that in ty and think about how we want to transition Ruff to the new format.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:406 on 2025-07-07 10:16</div>
            <div class="timeline-body"><p>This feels hacky. Can't we customize this by using the <code>DisplaySettings</code> (by either providing a base URL or have a documentation provider.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1260 on 2025-07-07 10:19</div>
            <div class="timeline-body"><p>It would be great to include the references mentioned in https://github.com/astral-sh/ruff/pull/5048</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1261 on 2025-07-07 10:20</div>
            <div class="timeline-body"><p>I'm sort of inlined not to support JsonLines in ty until it comes up as a feature request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:111 on 2025-07-07 10:23</div>
            <div class="timeline-body"><p>It would be great to have some tests demonstrating these new output formats. I know we have some tests in the old message based renderers but we'll loose them long term if we delete the message based rendering infrastructure (which is the end-goal?).</p>
<p>I'm also inclined to have a module for each output format</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:113 on 2025-07-07 10:26</div>
            <div class="timeline-body"><p>Hmm, mapping <code>info</code> to warning<code>seems a bit odd. But I'm not entirely sure what to do about info messages instead. Unless we use a different output (maybe</code>debug`?)</p>
<pre><code>##[debug]Debug text
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:150 on 2025-07-07 10:27</div>
            <div class="timeline-body"><p>We should log every diagnostic. We can't just skip some diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/Cargo.toml</code>:41 on 2025-07-07 10:30</div>
            <div class="timeline-body"><p>Hmm, I don't like how we're pulling in more and more dependencies for the diagnostic rendering into <code>ruff_db</code>. I think we might have reached the point where we should split out the diagnostic code or, at least, the rendering. @BurntSushi what were the options that you considered for this in the past?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/json.rs</code>:1 on 2025-07-07 10:32</div>
            <div class="timeline-body"><p>It might make sense to delete those files entirely. Git might then even be able to pick up that the <code>render/json</code> file is the same as this file, which would help to preserve the history</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:144 on 2025-07-07 10:37</div>
            <div class="timeline-body"><p>Same as for JSON. We can't use the <code>secondary_code</code> for ty. Instead, it should be the <code>id</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2025-07-07 10:40</div>
            <div class="timeline-body"><p>I think this needs some more design on the output formats: what fields and content should they contain for ruff/ty, how can we make some of the behavior configurable (secondary code vs id), don't skip over diagnostics.</p>
<p>I'd also suggest to not mix refactoring the existing emitters and adding the output formats to ty because that extends the design scope (I don't think the existing JSON output makes sense for ty, it only is the way it is for historic reasons)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @ntBre on 2025-07-07 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-07 12:23</div>
            <div class="timeline-body"><p>Sorry I got ahead of myself with the ty integration. I'll put this back in draft while I clean it up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> removed by @ntBre on 2025-07-07 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @ntBre on 2025-07-07 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-07 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1260 on 2025-07-07 16:23</div>
            <div class="timeline-body"><p>Added a link to jsonlines.org! The second link in the PR seems to have been taken over by someone else and was also in Korean.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-07 16:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:113 on 2025-07-07 16:25</div>
            <div class="timeline-body"><p>From my reading of the <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/scripts/logging-commands?view=azure-devops&amp;tabs=bash#properties">docs</a>, I thought this could only be <code>warning</code> or <code>error</code> but happy to change it if <code>debug</code> or another tag would work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:113 on 2025-07-07 16:30</div>
            <div class="timeline-body"><p>It also supports <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/scripts/logging-commands?view=azure-devops&amp;tabs=bash#formatting-commands">formatting commands</a> but I don't fully understand the difference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-07 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-07 19:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:111 on 2025-07-07 19:37</div>
            <div class="timeline-body"><p>I ported over the diagnostic-generating test functions from <code>ruff_linter</code> and then deleted the <code>azure</code> module. It seems git wasn't smart enough to see that the module moved, but it did detect that the snapshots moved, which is helpful at least. I'll do the same for the JSON tests and modules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-07 20:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:24 on 2025-07-07 20:50</div>
            <div class="timeline-body"><p>I guess I should update the <code>message</code> module too. Maybe in a separate PR since I think it will create a pretty big diff, if that's okay.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-07 20:53</div>
            <div class="timeline-body"><p>I think the most glaring issues should now be resolved. I reverted the ty-facing changes, ported over the tests from <code>ruff_linter</code>, gave each output format its own module, and made sure not to drop diagnostics just because we failed to convert all of their fields to JSON.</p>
<p>I still need to do something about the <code>to_url</code> method, the Azure <code>info</code> severity, and possibly divide the crate or otherwise handle the <code>serde</code> dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-08 06:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:24 on 2025-07-08 06:31</div>
            <div class="timeline-body"><p>I think it's sightly less important in the modules that we plan to delete but we should avoid using <code>message</code> in new code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-08 06:32</div>
            <div class="timeline-body"><blockquote>
<p>I still need to do something about the to_url method, the Azure info severity, and possibly divide the crate or otherwise handle the serde dependency.</p>
</blockquote>
<p>This is also something we can follow up <em>after</em> this PR. It's definetely not something we should do as part of this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 15:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:406 on 2025-07-08 15:26</div>
            <div class="timeline-body"><p>I think I'll just revert this for now and add a <code>ruff</code> prefix to the method since we're not exposing the output formats that use it to ty.</p>
<p>I think configuring it through the diagnostic config makes sense long-term, though. If we dropped <code>/ruff</code> from our <code>homepage</code> in the main <code>Cargo.toml</code> we could also reuse it for ty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 15:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:144 on 2025-07-08 15:35</div>
            <div class="timeline-body"><p>(marking these as resolved since I ripped out the ty integration for now)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:77 on 2025-07-08 15:38</div>
            <div class="timeline-body"><p>This makes sense to me. I think we'll also have a bit more freedom in the JSON output for ruff once ruff-lsp is fully unsupported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:113 on 2025-07-08 16:06</div>
            <div class="timeline-body"><p>I didn't find this in the docs, but I asked <a href="https://chatgpt.com/share/686d4086-64a8-8006-8965-fbddd989cf6c">ChatGPT</a>, and it suggested a couple of options:</p>
<ul>
<li>logging without a special <code>##</code> command prefix, which should show up as normal text without an icon</li>
<li>using <code>##[debug]</code> as you said, but it thinks that will only be visible when <code>system.debug=true</code> is set</li>
</ul>
<p>Do either of those sound preferable to you? I'm also kind of tempted to defer this for now since Ruff doesn't use the <code>info</code> severity anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 16:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-08 20:57</div>
            <div class="timeline-body"><p>I think this is ready for another look, at least from @MichaReiser, to make sure I'm on the right track with his suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 20:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:117 on 2025-07-08 20:59</div>
            <div class="timeline-body"><p>What kind of API were you picturing for each output format submodule? I kind of like the way the Azure one looks here and could do something similar for JSON and JSON lines.</p>
<p>I can move the <code>Concise</code> and <code>Full</code> formats to their own modules too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 21:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json_lines__tests__notebook_output.snap</code>:1 on 2025-07-08 21:05</div>
            <div class="timeline-body"><p>The diff here is just the filename (<code>.py</code> vs <code>.ipynb</code> as mentioned in the code comments). I guess that broke git's rename detection with the long lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-08 21:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:2546 on 2025-07-08 21:07</div>
            <div class="timeline-body"><p>These functions are all adapted from the ones with the same names in <code>ruff_linter::message::mod.rs</code>:</p>
<p>https://github.com/astral-sh/ruff/blob/05139a323bb827f7273551c2b54d87e6f356bae0/crates/ruff_linter/src/message/mod.rs#L188-L190</p>
<p>I think we should be able to delete those once all the output formats are moved over.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-09 06:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/Cargo.toml</code>:41 on 2025-07-09 06:27</div>
            <div class="timeline-body"><p>A quick-fix for now would be to keep the <code>serde</code> feature and gate the <code>JSON</code> display formats behind that feature too. But then. It probably doesn't matter that much because all our top level crates use it anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/Cargo.toml</code>:60 on 2025-07-09 06:29</div>
            <div class="timeline-body"><p>We should remove the feature entirely and always enable the <code>camino/serde1</code> feature if we make the <code>serde</code> dependency non-optional.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1255 on 2025-07-09 06:33</div>
            <div class="timeline-body"><p>For ty's JSON output, I suggest you take a look at https://doc.rust-lang.org/cargo/commands/cargo-check.html</p>
<p>We could also consider naming this variant <code>JsonConcise</code> because it only contains the concise message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:117 on 2025-07-09 06:38</div>
            <div class="timeline-body"><p>I'm not sure if all formats need to have a shared API but if I would do it I'd probably do something similar to the <code>DiagnosticFormat::Full</code> format where each format has its own <code>Renderer</code> struct. This has the advantage that they could store (e.g. cache) additional data that's specific to their format.</p>
<pre><code class="language-rust">AzureRenderer::default().render(f, diagnostic)
</code></pre>
<p>Let's move <code>Concise</code> and <code>Full</code> in its own PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:123 on 2025-07-09 06:42</div>
            <div class="timeline-body"><p>It seems silly that we create the <code>annotated_renderer</code> even if the diagnostic then only gets rendered with <code>JSON</code>. Can't we construct the renderer in the <code>Full</code> branch instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:190 on 2025-07-09 06:43</div>
            <div class="timeline-body"><p>I wonder if we should make <code>Diagnostic::display</code> to call <code>DisplayDiagnostics</code> instead. This would allow us to use the same <code>annotated_renderer</code> for all diagnostics instead of having to create a new one for every single diagnostic.</p>
<p><code>Diagnostic::display</code> would then call <code>DisplayDiagnostics::new(std::slice::from_ref(self), config, resolver).fmt(f)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:2238 on 2025-07-09 06:46</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    pub(super) struct TestEnvironment {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/azure.rs</code>:1 on 2025-07-09 06:48</div>
            <div class="timeline-body"><p>I assuem git doesn't regonize the move of this file because the deletion of the old file and the creation of the new file aren't in the same commit. You could try squashing all your commits into a single commit to see if git then recognize that the file was moved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:77 on 2025-07-09 06:51</div>
            <div class="timeline-body"><p>Making <code>location</code> and <code>end_location</code> <code>Option</code> is a breaking change. It's a bit hard to tell if you made other breaking changes to the schema. Please double check that you didn't.</p>
<p>I think the change I would make here is to default to <code>TextRange::default</code> if the range is missing and preview mode is disabled (we can use an <code>Option</code> in preview mode).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:13 on 2025-07-09 06:53</div>
            <div class="timeline-body"><p>What's the reason for the changed extension?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>ty.schema.json</code>:1 on 2025-07-09 06:54</div>
            <div class="timeline-body"><p>This should be reverted</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-09 06:54</div>
            <div class="timeline-body"><p>Thanks. We need to be careful not to make any breaking changes to the existing schemas (at least, if preview is disabled)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 11:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>ty.schema.json</code>:1 on 2025-07-09 11:29</div>
            <div class="timeline-body"><p>I might be missing something obvious here, but I tried to revert this with the other ty changes, and then the tests failed until I ran <code>cargo dev generate-all</code> again, which brought this back. Is it because <code>DiagnosticFormat</code> derives <code>JsonSchema</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-09 11:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>ty.schema.json</code>:1 on 2025-07-09 11:38</div>
            <div class="timeline-body"><p>The schema changes here suggest that the configuration now accepts a JSON option for output format, which it shouldn't. We shouldn't see any changes to the schema until we intentionally expose the new output formats in ty</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 11:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:13 on 2025-07-09 11:38</div>
            <div class="timeline-body"><p>I think the <code>TestEnvironment</code> tries to parse the input as a real notebook if I use <code>.ipynb</code>, but I had the source as plain text from the <code>ruff_linter</code> test. I guess it's still a bit hacky, but I could use something like <code>ipyn</code> instead of <code>py</code> to make it slightly more clear. Or I could just make a real notebook.</p>
<p>https://github.com/astral-sh/ruff/blob/cc5a1525ca289d73bf660fc7628017ba061a9aae/crates/ruff_db/src/diagnostic/render.rs#L2666-L2668</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 11:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/azure.rs</code>:1 on 2025-07-09 11:45</div>
            <div class="timeline-body"><p>It was a good idea, but no luck.  It still showed a new file and a deletion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 11:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>ty.schema.json</code>:1 on 2025-07-09 11:51</div>
            <div class="timeline-body"><p>It looks like I can use <code>#[schemars(skip)]</code> to omit them for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-09 12:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>ty.schema.json</code>:1 on 2025-07-09 12:16</div>
            <div class="timeline-body"><p>I think the proper solution is that <code>TerminalOptions</code> uses its own enum that's distinct from <code>DiagnosticFormat</code> in <code>ruff_db</code> because they otherwise still can still be serialized into by serde.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 13:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:77 on 2025-07-09 13:04</div>
            <div class="timeline-body"><p>Good catch. I went through all of the fields passed to <code>json!</code> calls, and the only field besides the locations was the filename. I added a <code>preview</code> field to <code>DisplayDiagnosticConfig</code> to pass it down and <code>unwrap_or_default</code> the options when it's disabled.</p>
<p>I also tried a separate branch where I used real structs instead of <code>json!</code> to be sure what all the types were, but the order of fields changed in the derived <code>Serialize</code> implementations, changing snapshots. And I figured that would be kind of awkward for the preview behavior anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>ty.schema.json</code>:1 on 2025-07-09 13:13</div>
            <div class="timeline-body"><p>There's already a very similar <code>OutputFormat</code> enum used for the CLI arguments. Could we reuse that, or is it better to add another one in <code>ty_project</code> next to <code>TerminalOptions</code>?</p>
<p>I guess we probably don't want to have to propagate a <code>clap</code> feature to <code>ty_project</code>, so I'll go with a separate one for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/Cargo.toml</code>:41 on 2025-07-09 13:30</div>
            <div class="timeline-body"><p>I brought back the <code>serde</code> feature for now, happy to revert if we decide it doesn't matter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-09 14:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:190 on 2025-07-09 14:26</div>
            <div class="timeline-body"><p>Nice, I like how this looks, especially combined with the <code>AzureRenderer</code> idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-09 14:46</div>
            <div class="timeline-body"><p>I think I've addressed all of the feedback, pending our discussion about serde on Discord, and with the exception of a possible <code>JsonConcise</code> rename. I also didn't change anything about the <code>.py</code> &quot;notebook&quot; extension yet, but I'm happy to do something there if you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ntBre on 2025-07-10 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>ty.schema.json</code>:68 on 2025-07-10 15:00</div>
            <div class="timeline-body"><p>It looks like the documentation is now missing. There should be no schema changes in this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:100 on 2025-07-10 15:14</div>
            <div class="timeline-body"><p>Let's create an issue that changes the format in the upcoming minor</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1201 on 2025-07-10 15:20</div>
            <div class="timeline-body"><p>I don't think we need to gate the <code>preview</code> flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render.rs</code>:2677 on 2025-07-10 15:23</div>
            <div class="timeline-body"><p>I'm inclined to create an actual notebook here. It demnonstrates the end-to-end flow better. It also allows you to delete a lot of the custom behavior you added to <code>TestEnvironment</code>, which brings us closer to the actual implementation (ensures that we test what runs in production)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/Cargo.toml</code>:16 on 2025-07-10 15:24</div>
            <div class="timeline-body"><p>With the approach you've taken now, the correct gating here is to make the <code>ruff_diagnostic/serde</code> feature dependent on whether the <code>serde</code> feature is enabled for <code>ruff_db</code> (similar to what we do with camino)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty/src/args.rs</code>:326 on 2025-07-10 15:25</div>
            <div class="timeline-body"><p>We can delete the implementation on line 326. It should now be unused</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_project/src/metadata/options.rs</code>:292 on 2025-07-10 15:26</div>
            <div class="timeline-body"><p>We should change <code>TerminalSettings</code> to use the ty specific <code>DiagnosticFormat</code>. It's otherwise confusing (and easy to get wrong) why it allows more variants.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-07-10 15:32</div>
            <div class="timeline-body"><p>This looks good now, minor a few smaller changes. We do need to fix the schema change before landing this PR.</p>
<p>I suggest that you change the notebook diagnostic test to use an actual notebook source. This should reduce the amount of code that we need to mock out for testing.</p>
<p>I also think it would be a good idea to test the output formats on the CLI (unless there are integration tests covering those output formats) because all tests now use the <code>ty</code> <code>FileResolver</code> (the ruff case is untested).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-10 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:100 on 2025-07-10 15:54</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/issues/19263</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-10 15:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>ty.schema.json</code>:1 on 2025-07-10 15:56</div>
            <div class="timeline-body"><p>Yes, they're intentionally separate because the one in the CLI crate depends on clap. But you can use the one you use for the <code>TerminalOptions</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-10 16:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:1201 on 2025-07-10 16:03</div>
            <div class="timeline-body"><p>I get warnings about the field and <code>TestEnvironment::preview</code> method being unused without this when running <code>cargo test -p ruff_db</code> because they're only used for JSON. I'll change this to <code>#[allow(dead_code)]</code> for now since this will be used soon by other formats anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-10 16:15</div>
            <div class="timeline-body"><p>I introduced some intentional typos to see if any integration tests fail, and we have one for JSON (<code>ruff::integration_test::stdin_json</code>) but not for JSON lines or Azure. I'll write some CLI tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:125 on 2025-07-10 18:28</div>
            <div class="timeline-body"><p>Out of curiosity, how come the <code>json!</code> macro instead of types? I'd imagine <code>json!</code> to be slower since it has to shove everything into the <code>serde_json::Value</code> type, but I guess I'd also imagine it probably doesn't matter here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:215 on 2025-07-10 18:39</div>
            <div class="timeline-body"><p>I feel like if you're using the <code>json!</code> macro everywhere already, it's probably not worth a hand-impl of the <code>Serialize</code> trait? There's a bit more ceremony with it compared to just building a <code>Value::Array(Vec&lt;Value&gt;)</code> directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-07-10 18:49</div>
            <div class="timeline-body"><p>Nice! Feel free to ignore/disagree with my nits about <code>json!</code>. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-10 19:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:125 on 2025-07-10 19:13</div>
            <div class="timeline-body"><p>I just pulled these over from the current Ruff version, so I'm not too sure. @MichaReiser might know, it looks like there were types deriving <code>Serialize</code> before https://github.com/astral-sh/ruff/pull/3895.</p>
<p><code>json!</code> is kind of handy here for the <code>preview</code> behavior, but otherwise I'd lean toward types too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-10 20:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:125 on 2025-07-10 20:18</div>
            <div class="timeline-body"><p>I don't. Wasn't it already like this before my PR and all I did was splitting the code into different modules.</p>
<p>I'm generally in favor of structs. It makes accidental schema changes easier to spot</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-07-10 22:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:125 on 2025-07-10 22:23</div>
            <div class="timeline-body"><p>Ah yeah sorry, I didn't realize this was copied code. I thought it was newly written.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-10 23:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:125 on 2025-07-10 23:01</div>
            <div class="timeline-body"><p>No worries, I should have pointed it out to help with the review. I opened #19270 to explore using structs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:126 on 2025-07-11 15:21</div>
            <div class="timeline-body"><p>This feels a bit silly, but callers of this function expect a <code>Display</code> type. This avoids having to update the callers to use <code>serde_json::to_writer</code>, which in turn avoids updating their arguments from <code>std::fmt::Formatter</code>s to something implementing <code>std::io::Write</code> and their return types to something that can accommodate a <code>serde_json::Error</code> instead of a <code>std::fmt::Error</code>.</p>
<p>We could also just call <code>serde_json::to_value</code> and unwrap it here or in the callers, which is all this macro expands into.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-11 15:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-11 15:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/snapshots/ruff_db__diagnostic__render__json__tests__notebook_output.snap</code>:87 on 2025-07-11 15:30</div>
            <div class="timeline-body"><p>This is actually correct based on testing a released version of Ruff against the real notebook. I think the manual notebook cell index was outdated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-11 15:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:247 on 2025-07-11 15:42</div>
            <div class="timeline-body"><p>Using an <code>enum</code> here strikes me a bit weird. I would either use two separate structs or just ignore the <code>old</code> entirely and ensure that the values are all <code>Some</code> where the change isn't backwards compatible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-07-11 15:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:126 on 2025-07-11 15:50</div>
            <div class="timeline-body"><p>I would probably move the <code>json!</code> call to where you need the <code>Display</code> implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-07-11 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_db/src/diagnostic/render/json.rs</code>:247 on 2025-07-11 15:54</div>
            <div class="timeline-body"><p>Oh, for some reason just wrapping the <code>unwrap_or_default</code> calls in <code>Some</code> didn't occur to me. That makes a lot more sense. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-11 18:50</div>
            <div class="timeline-body"><p>I'm going to merge this and start working on more output formats, happy to follow up if I missed anything. Thanks for the reviews!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-07-11 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-07-11 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-11 19:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:33:38 UTC
    </footer>
</body>
</html>
