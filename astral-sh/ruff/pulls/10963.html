<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Implement `invalid-length-returned` (`E0303`) - astral-sh/ruff #10963</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Implement <code>invalid-length-returned</code> (<code>E0303</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10963">#10963</a>
        opened by <a href="https://github.com/tibor-reiss">@tibor-reiss</a>
        on 2024-04-15 20:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/tibor-reiss">@tibor-reiss</a> on 2024-04-15 20:39</div>
            <div class="timeline-body"><p>Add pylint rule invalid-length-returned (PLE0303)</p>
<p>See https://github.com/astral-sh/ruff/issues/970 for rules</p>
<p>Test Plan: <code>cargo test</code></p>
<p>TBD: from the description: &quot;Strictly speaking <code>bool</code> is a subclass of <code>int</code>, thus returning <code>True</code>/<code>False</code> is valid. To be consistent with other rules (e.g. <a href="https://github.com/astral-sh/ruff/pull/10962">PLE0305</a> invalid-index-returned), ruff will raise, compared to pylint which will not raise.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tibor-reiss">@tibor-reiss</a> on 2024-04-15 20:48</div>
            <div class="timeline-body"><p>The tests run locally fine when using commit 670d66f as rebase, but there are failures when using the next commit, c221035. Was there some limit reached (rule is u16 in rule_set.rs / contains()) maybe?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-15 20:58</div>
            <div class="timeline-body"><p>Try bumping the value in <code>const RULESET_SIZE: usize = 13;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-15 21:41</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/tibor-reiss:add-E0303-invalid-length-returned">CodSpeed Performance Report</a></h2>
<h3>Merging #10963 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>tibor-reiss:add-E0303-invalid-length-returned</code> (b09ac0b) with <code>main</code> (b23414e)</sub></p>
<h3>Summary</h3>
<p><code>✅ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-15 22:31</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -0 violations, +0 -0 fixes in 1 projects; 43 projects unchanged)</p>
<details><summary><a href="https://github.com/python/typeshed">python/typeshed</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --no-preview --select E,F,FA,I,PYI,RUF,UP,W</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/python/typeshed/blob/12b9e48324df292379db3eca4e3c54175e5f374e/stdlib/typing.pyi#L330'>stdlib/typing.pyi:330:10:</a> PYI001 Name of private `TypeVar` must start with `_`
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PYI001 | 1 | 1 | 0 | 0 | 0 |</p>
</p>
</details>

<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+4 -0 violations, +0 -0 fixes in 3 projects; 41 projects unchanged)</p>
<details><summary><a href="https://github.com/ibis-project/ibis">ibis-project/ibis</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/ibis-project/ibis/blob/98ef69ce096b72c1deaa3abe217b458ea17139c8/ibis/expr/types/relations.py#L831'>ibis/expr/types/relations.py:831:9:</a> PLE0303 `__len__` does not return a non-negative integer
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+2 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pandas-dev/pandas/blob/a99fb7d054ee0831f1c00d8bea1b54e383185802/pandas/core/arrays/base.py#L483'>pandas/core/arrays/base.py:483:9:</a> PLE0303 `__len__` does not return a non-negative integer
+ <a href='https://github.com/pandas-dev/pandas/blob/a99fb7d054ee0831f1c00d8bea1b54e383185802/pandas/core/base.py#L349'>pandas/core/base.py:349:9:</a> PLE0303 `__len__` does not return a non-negative integer
</pre>

</p>
</details>
<details><summary><a href="https://github.com/python/typeshed">python/typeshed</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select E,F,FA,I,PYI,RUF,UP,W</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/python/typeshed/blob/12b9e48324df292379db3eca4e3c54175e5f374e/stdlib/typing.pyi#L330'>stdlib/typing.pyi:330:10:</a> PYI001 Name of private `TypeVar` must start with `_`
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLE0303 | 3 | 3 | 0 | 0 | 0 |
| PYI001 | 1 | 1 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tibor-reiss">@tibor-reiss</a> on 2024-04-16 05:36</div>
            <div class="timeline-body"><blockquote>
<p>Try bumping the value in <code>const RULESET_SIZE: usize = 13;</code></p>
</blockquote>
<p>@charliermarsh Is the performance drop of 4% also related to this please? The newly introduced rule is quite lightweight.</p>
<p>Solved, thanks @MichaReiser</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-04-16 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/statement.rs</code>:101 on 2024-04-16 06:33</div>
            <div class="timeline-body"><p>Nit: You can pass the entire function definition instead of just passing the name and body</p>
<pre><code class="language-suggestion">                pylint::rules::invalid_length_return(checker, function_def);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/invalid_length_return.rs</code>:88 on 2024-04-16 06:40</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code class="language-suggestion">        matches!(
        value,
        Expr::UnaryOp(ast::ExprUnaryOp {
            op: ast::UnaryOp::USub,
            ..
        })
    )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pylint/rules/invalid_length_return.rs</code>:78 on 2024-04-16 06:41</div>
            <div class="timeline-body"><p>It could make sense to change the order of the checks because <code>is_negative_integer</code> is relatively simple compared to <code>ResolvedPythonType::from</code></p>
<pre><code class="language-suggestion">            if is_negative_integer(value) ||
             !matches!(
                ResolvedPythonType::from(value),
                ResolvedPythonType::Unknown
                    | ResolvedPythonType::Atom(PythonType::Number(NumberLike::Integer))
            )
            {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-16 06:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-16 12:22</div>
            <div class="timeline-body"><p>@tibor-reiss I bumped the index (and fixed the perf regression). You can rebase and we should then see the impact of your rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tibor-reiss">@tibor-reiss</a> reviewed on 2024-04-16 18:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tibor-reiss">@tibor-reiss</a> on <code>crates/ruff_linter/src/checkers/ast/analyze/statement.rs</code>:101 on 2024-04-16 18:14</div>
            <div class="timeline-body"><p>I took the current bool and str cases as a blueprint, which passed also name and body. What would be the advantage of passing the function_def please? I would still need to reference name and body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tibor-reiss">@tibor-reiss</a> reviewed on 2024-04-16 18:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tibor-reiss">@tibor-reiss</a> on <code>crates/ruff_linter/src/rules/pylint/rules/invalid_length_return.rs</code>:88 on 2024-04-16 18:15</div>
            <div class="timeline-body"><p>Thanks, done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tibor-reiss">@tibor-reiss</a> reviewed on 2024-04-16 18:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tibor-reiss">@tibor-reiss</a> on <code>crates/ruff_linter/src/rules/pylint/rules/invalid_length_return.rs</code>:78 on 2024-04-16 18:16</div>
            <div class="timeline-body"><p>TLDR: changed.
I was not sure about which should be first because I would expect that there are more cases where the return type is wrong, compared to where the type is ok (int) but the sign not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[pylint] Implement invalid-length-returned (PLE0303)" to "[`pylint`] Implement `invalid-length-returned` (`E0303`)" by @charliermarsh on 2024-04-18 01:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-04-18 01:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-04-18 01:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-18 01:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:37:36 UTC
    </footer>
</body>
</html>
