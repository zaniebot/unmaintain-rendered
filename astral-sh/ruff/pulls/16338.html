<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Salsa - astral-sh/ruff #16338</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Update Salsa</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16338">#16338</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-02-24 08:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-24 08:04</div>
            <div class="timeline-body"><p>Update Salsa to fix stale query results for multi-argument queries where one argument is a tracked struct.</p>
<p>The performance regression isn't unexpected. https://github.com/astral-sh/ruff/pull/15763 introduced coarse grained dependencies and the version used in that branch removed adding dependencies for any tracked fields (not even to the tracked struct itself). It turned out, that this was incorrect in the case where tracked structs (and there IDs) get reused. The upstream fix now records a dependency on the tracked struct. This is still better than without coarse grained dependencies where salsa recorded a dependency for each tracked field but it isn't free (but required for correctness).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @MichaReiser on 2025-02-24 08:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-02-24 08:09</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fupdate-salsa">CodSpeed Performance Report</a></h2>
<h3>Merging #16338 will <strong>degrade performances by 5.29%</strong></h3>
<p><sub>Comparing <code>micha/update-salsa</code> (5295d99) with <code>main</code> (5eaf225)</sub></p>
<h3>Summary</h3>
<p><code>âŒ 1 (ğŸ‘ 1)</code> regressions<br />
<code>âœ… 31</code> untouched benchmarks</p>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ğŸ‘ | <code>red_knot_check_file[incremental]</code> | 5.5 ms | 5.8 ms | -5.29% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2025-02-24 08:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-24 08:13</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>âœ… ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-02-24 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-02-24 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-02-24 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-24 08:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:49:31 UTC
    </footer>
</body>
</html>
