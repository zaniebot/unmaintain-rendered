```yaml
number: 4961
title: "Format `if` statements"
type: pull_request
state: merged
author: MichaReiser
labels:
  - internal
  - formatter
assignees: []
merged: true
base: main
head: format-if-statement
created_at: 2023-06-08T13:44:55Z
updated_at: 2023-06-09T09:15:55Z
url: https://github.com/astral-sh/ruff/pull/4961
synced_at: 2026-01-12T03:43:29Z
```

# Format `if` statements

---

_Pull request opened by @MichaReiser on 2023-06-08 13:44_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

This PR implements the formatting of `if` statements. I haven't verified if it covers all edge cases because
that will be easier once we have better coverage (you can simply go througth the black differences), but I believe it covers most reasonable uses pretty well. 

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

A few own unit tests and reviewed (as best as I can) the black differences

<!-- How was it tested? -->


---

_Comment by @MichaReiser on 2023-06-08 13:45_

Current dependencies on/for this PR:
* main
  * **PR #4954** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4954" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #4921** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4921" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #4922** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4922" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #4951** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4951" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
          * **PR #4961** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4961" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
            * **PR #4964** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4964" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
              * **PR #4979** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4979" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
              * **PR #4978** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/4978" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/4961?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-06-08 14:15_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      6.8Â±0.01ms     6.0 MB/sec    1.01      6.9Â±0.01ms     5.9 MB/sec
formatter/numpy/ctypeslib.py               1.00   1382.1Â±3.95Âµs    12.0 MB/sec    1.01   1390.5Â±3.18Âµs    12.0 MB/sec
formatter/numpy/globals.py                 1.00    138.3Â±0.21Âµs    21.3 MB/sec    1.01    139.1Â±0.87Âµs    21.2 MB/sec
formatter/pydantic/types.py                1.00      2.8Â±0.01ms     9.2 MB/sec    1.01      2.8Â±0.01ms     9.1 MB/sec
linter/all-rules/large/dataset.py          1.02     15.1Â±0.06ms     2.7 MB/sec    1.00     14.8Â±0.02ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      3.6Â±0.00ms     4.6 MB/sec    1.00      3.6Â±0.00ms     4.6 MB/sec
linter/all-rules/numpy/globals.py          1.01    369.8Â±1.42Âµs     8.0 MB/sec    1.00    367.0Â±1.74Âµs     8.0 MB/sec
linter/all-rules/pydantic/types.py         1.01      6.3Â±0.01ms     4.1 MB/sec    1.00      6.2Â±0.01ms     4.1 MB/sec
linter/default-rules/large/dataset.py      1.03      7.5Â±0.01ms     5.4 MB/sec    1.00      7.3Â±0.02ms     5.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02   1568.8Â±5.41Âµs    10.6 MB/sec    1.00   1531.1Â±3.97Âµs    10.9 MB/sec
linter/default-rules/numpy/globals.py      1.02    167.7Â±0.98Âµs    17.6 MB/sec    1.00    164.0Â±0.30Âµs    18.0 MB/sec
linter/default-rules/pydantic/types.py     1.03      3.4Â±0.01ms     7.6 MB/sec    1.00      3.3Â±0.00ms     7.8 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      7.8Â±0.02ms     5.2 MB/sec    1.05      8.2Â±0.04ms     5.0 MB/sec
formatter/numpy/ctypeslib.py               1.00  1573.3Â±15.51Âµs    10.6 MB/sec    1.04  1639.9Â±21.41Âµs    10.2 MB/sec
formatter/numpy/globals.py                 1.00    156.3Â±1.60Âµs    18.9 MB/sec    1.03    161.1Â±2.81Âµs    18.3 MB/sec
formatter/pydantic/types.py                1.00      3.2Â±0.02ms     7.9 MB/sec    1.04      3.3Â±0.03ms     7.6 MB/sec
linter/all-rules/large/dataset.py          1.00     16.8Â±0.15ms     2.4 MB/sec    1.01     17.0Â±0.12ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.3Â±0.03ms     3.9 MB/sec    1.00      4.3Â±0.02ms     3.9 MB/sec
linter/all-rules/numpy/globals.py          1.01    434.8Â±5.22Âµs     6.8 MB/sec    1.00    430.2Â±5.98Âµs     6.9 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.2Â±0.04ms     3.6 MB/sec    1.00      7.2Â±0.05ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.4Â±0.04ms     4.8 MB/sec    1.00      8.4Â±0.03ms     4.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1750.3Â±8.60Âµs     9.5 MB/sec    1.00  1756.1Â±11.41Âµs     9.5 MB/sec
linter/default-rules/numpy/globals.py      1.00    187.9Â±1.56Âµs    15.7 MB/sec    1.00    188.3Â±1.48Âµs    15.7 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.8Â±0.03ms     6.6 MB/sec    1.00      3.8Â±0.03ms     6.7 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review requested from @konstin by @MichaReiser on 2023-06-08 16:10_

---

_Label `internal` added by @MichaReiser on 2023-06-08 16:10_

---

_Label `autoformatter` added by @MichaReiser on 2023-06-08 16:10_

---

_Review comment by @konstin on `crates/ruff_python_formatter/src/lib.rs`:444 on 2023-06-09 07:08_

```suggestion
```

---

_Review comment by @konstin on `crates/ruff_python_formatter/src/statement/stmt_if.rs`:61 on 2023-06-09 07:29_

it's confusing that those are set in every iteration, maybe a comment would be good

---

_Review comment by @konstin on `crates/ruff_python_formatter/src/statement/stmt_if.rs`:64 on 2023-06-09 07:34_

Does this mean there's no elif node, just if?

---

_@konstin approved on 2023-06-09 07:34_

---

_@MichaReiser reviewed on 2023-06-09 08:39_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/statement/stmt_if.rs`:64 on 2023-06-09 08:39_

Yep. `elif` is represented as an `else` body that contains a single `if` statement. Rome (and Roslyn) model this very similarly where the `alternate` (else) is either an `if` statement (in which it is an `else if`) or a block (an else).

---

_@MichaReiser reviewed on 2023-06-09 08:40_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/src/lib.rs`:444 on 2023-06-09 08:40_

I would prefer not removing the code. I keep typing this every now and then when debugging comments

---

_Merged by @MichaReiser on 2023-06-09 08:55_

---

_Closed by @MichaReiser on 2023-06-09 08:55_

---

_Branch deleted on 2023-06-09 08:55_

---
