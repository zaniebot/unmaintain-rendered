<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make semantic model aware of docstring - astral-sh/ruff #9960</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make semantic model aware of docstring</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9960">#9960</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-02-12 19:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-12 19:09</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR introduces a new semantic model flag <code>DOCSTRING</code> which suggests that the model is currently in a module / class / function docstring. This is the first step in eliminating the docstring detection state machine which is prone to bugs as stated in #7595.</p>
<h2>Test Plan</h2>
<p>~TODO: Is there a way to add a test case for this?~</p>
<p>I tested this using the following code snippet and adding a print statement in the <code>string_like</code> analyzer to print if we're currently in a docstring or not.</p>
<details><summary>Test code snippet:</summary>
<p>

<pre><code class="language-python">&quot;Docstring&quot; &quot;, still a docstring&quot;
&quot;Not a docstring&quot;


def foo():
    &quot;Docstring&quot;
    &quot;Not a docstring&quot;
    if foo:
        &quot;Not a docstring&quot;
        pass


class Foo:
    &quot;Docstring&quot;
    &quot;Not a docstring&quot;

    foo: int
    &quot;Unofficial variable docstring&quot;

    def method():
        &quot;Docstring&quot;
        &quot;Not a docstring&quot;
        pass


def bar():
    &quot;Not a docstring&quot;.strip()


def baz():
    _something_else = 1
    &quot;&quot;&quot;Not a docstring&quot;&quot;&quot;
</code></pre>
</p>
</details> 

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @dhruvmanila on 2024-02-12 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Rename semantic model flag to MODULE_DOCSTRING_BOUNDARY" to "Make semantic model aware of docstring" by @dhruvmanila on 2024-02-12 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-12 19:31</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @MichaReiser on 2024-02-12 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-13 00:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/checkers/ast/mod.rs</code>:393 on 2024-02-13 00:25</div>
            <div class="timeline-body"><p>I think we have an <code>is_docstring_stmt</code> helper in <code>ruff_python_ast</code> for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-13 00:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-02-13 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-02-13 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-13 04:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:58:18 UTC
    </footer>
</body>
</html>
