<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace `--show-source` and `--no-show-source` with `--output_format=&lt;full|concise&gt;` - astral-sh/ruff #9687</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Replace <code>--show-source</code> and <code>--no-show-source</code> with <code>--output_format=&lt;full|concise&gt;</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9687">#9687</a>
        opened by <a href="https://github.com/snowsignal">@snowsignal</a>
        on 2024-01-29 19:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-01-29 19:21</div>
            <div class="timeline-body"><p>Fixes #7350</p>
<h2>Summary</h2>
<ul>
<li><code>--show-source</code> and <code>--no-show-source</code> are now deprecated.</li>
<li><code>output-format</code> supports two new variants, <code>full</code> and <code>concise</code>. <code>text</code> is now a deprecated variant, and any use of it is treated as the default serialization format.</li>
<li><code>--output-format</code> now default to <code>concise</code></li>
<li>In preview mode, <code>--output-format</code> defaults to <code>full</code></li>
<li><code>--show-source</code> will still set <code>--output-format</code> to <code>full</code> if the output format is not otherwise specified.</li>
<li>likewise, <code>--no-show-source</code> can override an output format that was set in a file-based configuration, though it will also be overridden by <code>--output-format</code></li>
</ul>
<h2>Test Plan</h2>
<p>A lot of tests were updated to use <code>--output-format=full</code>. Additional tests were added to ensure the correct deprecation warnings appeared, and that deprecated options behaved as intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @snowsignal on 2024-01-29 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @snowsignal on 2024-01-29 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @snowsignal on 2024-01-29 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Replace `--show-source` and `--no-show-source` with `output_format=<full|concise>`" to "Replace `--show-source` and `--no-show-source` with `--output_format=<full|concise>`" by @snowsignal on 2024-01-29 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-29 19:24</div>
            <div class="timeline-body"><p>Woo! Maybe we should merge this into <code>release/0.2.0</code> instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-29 19:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/printer.rs</code>:274 on 2024-01-29 19:29</div>
            <div class="timeline-body"><p>Is it feasible to warn during CLI parsing instead of during display? I'm not sure if that's much better but then we can easily do things like throw an error if preview mode is enabled (instead of warning).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-29 19:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/args.rs</code>:600 on 2024-01-29 19:30</div>
            <div class="timeline-body"><p>Seems safe to call this something simpler like <code>resolve_output_format</code> instead</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-29 19:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/configuration.md</code>:533 on 2024-01-29 19:31</div>
            <div class="timeline-body"><p>Can we include the default format here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/args.rs</code>:607 on 2024-01-29 19:44</div>
            <div class="timeline-body"><p>Nit: consider inlining the <code>o</code> into the format string? Assuming the macro supports it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/args.rs</code>:638 on 2024-01-29 19:45</div>
            <div class="timeline-body"><p>This is very nicely done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/printer.rs</code>:276 on 2024-01-29 19:46</div>
            <div class="timeline-body"><p>I'm wondering if we should get rid of this flag, and instead match against <code>SerializationFormat::Full</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>docs/configuration.md</code>:533 on 2024-01-29 19:47</div>
            <div class="timeline-body"><p>I wish Clap would do this but I think we have to use an <code>Option</code> here to detect whether it was provided at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-29 19:48</div>
            <div class="timeline-body"><p>This is great work -- really thorough and well-done. My only concern is: should we merge with <code>concise</code> as the default for now, so that it's not a change in behavior and just a deprecation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-01-29 19:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>docs/configuration.md</code>:533 on 2024-01-29 19:55</div>
            <div class="timeline-body"><p>I can include the default format as part of the description string for <code>CheckCommand::output_format</code>, if that works ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-01-29 19:59</div>
            <div class="timeline-body"><blockquote>
<p>My only concern is: should we merge with <code>concise</code> as the default for now, so that it's not a change in behavior and just a deprecation?</p>
</blockquote>
<p>That's a good question! I thought it would be useful to solve two issues at once, but if it's too big of a change I'd be OK with splitting the changes into a separate PR. I'm curious to know your thoughts on this @zanieb.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-29 21:29</div>
            <div class="timeline-body"><p>So I feel like the concern is that someone doesn't like the new output then is upset that the flag to toggle it back is deprecated? Perhaps it's just that there are too many changes in a single release?</p>
<p>My suggestion would be to gate the default with preview if feasible e.g. if <code>--preview</code> is passed then use <code>--output-format=full</code> and if not then use <code>--output-format=concise</code>. This would allow us to roll out the change in default separately in <code>0.3.0</code> instead.</p>
<p>Curious for @charliermarsh's thoughts though before we go changing things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-01-29 22:00</div>
            <div class="timeline-body"><p>I added a new bundle of tests that ensure the deprecated options behave as expected.</p>
<blockquote>
<p>So I feel like the concern is that someone doesn't like the new output then is upset that the flag to toggle it back is deprecated? Perhaps it's just that there are too many changes in a single release?</p>
</blockquote>
<p>I understand that concern, but doesn't <code>--output-format=concise</code> solve that for them? Anyone using the deprecated flags will ideally get pointed in the right direction with the warning messages.</p>
<p>That being said, I'm not against gating this behind <code>preview</code> (though it would mean more work to split up these changes)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @snowsignal on 2024-01-29 22:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-29 22:22</div>
            <div class="timeline-body"><p>Hmm yeah, introspecting a bit, I think my concern is that I wanted more user feedback before deciding that the <code>full</code> output format should be the default (which is a change from main, though was intended to be a settled decision per the relevant issue). So I was hoping to ship it to preview first to give us a chance to react to user feedback on the change. But I'm willing to give up on that, perhaps I'm being too cautious?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-29 23:07</div>
            <div class="timeline-body"><p>I think we're pretty settled on wanting to move that direction as our default output because we can build a lot on top of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-01-29 23:27</div>
            <div class="timeline-body"><p>I've reverted us back to using <code>concise</code> as a default value. I'm fine with gating this behind <code>preview</code> until <code>0.3.0</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @snowsignal on 2024-01-29 23:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-01-29 23:55</div>
            <div class="timeline-body"><p>Excellent! I'm still open to changing the default in v0.2.0, but we don't have to decide that to merge this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-29 23:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/args.rs</code>:135 on 2024-01-29 23:55</div>
            <div class="timeline-body"><p>Nit: should we document the preview difference? (Up to you, not a strong opinion.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-29 23:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/printer.rs</code>:437 on 2024-01-29 23:56</div>
            <div class="timeline-body"><p>Should this now vary on preview?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-01-30 00:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff/src/printer.rs</code>:437 on 2024-01-30 00:02</div>
            <div class="timeline-body"><p>It should, good catch!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @snowsignal on 2024-01-30 00:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @snowsignal on 2024-01-30 00:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-30 00:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-01-30 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-02-01 20:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff/src/lib.rs</code>:324 on 2024-02-01 20:10</div>
            <div class="timeline-body"><p>Does this respect <code>preview = true</code> in configuration files? I <em>think</em> this might only respect <code>--preview</code> when it's set on the command line -- is that deliberate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-02-01 20:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff/src/lib.rs</code>:324 on 2024-02-01 20:15</div>
            <div class="timeline-body"><p>No that was not deliberate, good catch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-02-01 20:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff/src/lib.rs</code>:324 on 2024-02-01 20:17</div>
            <div class="timeline-body"><p>No worries! Was trying to pin down the build failures on #9599 after merging in <code>main</code>, and spotted this :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:58:09 UTC
    </footer>
</body>
</html>
