<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Added support for &quot;document highlights&quot; language server feature. - astral-sh/ruff #19515</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Added support for &quot;document highlights&quot; language server feature.</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19515">#19515</a>
        opened by <a href="https://github.com/UnboundVariable">@UnboundVariable</a>
        on 2025-07-23 19:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/UnboundVariable">@UnboundVariable</a> on 2025-07-23 19:45</div>
            <div class="timeline-body"><p>This PR adds support for the &quot;document highlights&quot; language server feature.</p>
<p>This feature allows a client to highlight all instances of a selected name within a document. Without this feature, editors perform highlighting based on a simple text match. This adds semantic knowledge.</p>
<p>The implementation of this feature largely overlaps that of the recently-added &quot;references&quot; feature. This PR refactors the existing &quot;references.rs&quot; module, separating out the functionality and tests that are specific to the other language feature into a &quot;goto_references.rs&quot; module. The &quot;references.rs&quot; module now contains the functionality that is common to &quot;goto references&quot;, &quot;document highlights&quot; and &quot;rename&quot; (which is not yet implemented).</p>
<p>As part of this PR, I also created a new <code>ReferenceTarget</code> type which is similar to the existing <code>NavigationTarget</code> type but better suited for references. This idea was suggested by @MichaReiser in <a href="https://github.com/astral-sh/ruff/pull/19475#discussion_r2224061006">this code review feedback</a> from a previous PR. Notably, this new type contains a field that specifies the &quot;kind&quot; of the reference (read, write or other). This &quot;kind&quot; is needed for the document highlights feature.</p>
<p>Before: all textual instances of <code>foo</code> are highlighted
<img width="156" height="126" alt="Screenshot 2025-07-23 at 12 51 09 PM" src="https://github.com/user-attachments/assets/37ccdb2f-d48a-473d-89d5-8e89cb6c394e" /></p>
<p>After: only semantic matches are highlighted
<img width="164" height="157" alt="Screenshot 2025-07-23 at 12 52 05 PM" src="https://github.com/user-attachments/assets/2efadadd-4691-4815-af04-b031e74c81b7" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @UnboundVariable on 2025-07-23 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @UnboundVariable on 2025-07-23 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @UnboundVariable on 2025-07-23 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @UnboundVariable on 2025-07-23 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @UnboundVariable on 2025-07-23 19:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-23 19:49</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-07-24 05:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-07-24 05:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/doc_highlights.rs</code>:134 on 2025-07-24 07:20</div>
            <div class="timeline-body"><p>Nit: You could create a single diagnostic instead of multiple once by adding multiple annotations to the same diagnostic. This would help reduce the size of the snapshot (because it skips the header)</p>
<p>You can add multiple annotations by calling <code>diagnostic.annotate</code> multiple times</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2025-07-24 07:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/lib.rs</code>:135 on 2025-07-24 08:37</div>
            <div class="timeline-body"><p>Nit: Could we use <code>FileRange</code> here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-07-24 08:37</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/UnboundVariable">@UnboundVariable</a> reviewed on 2025-07-24 19:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/UnboundVariable">@UnboundVariable</a> on <code>crates/ty_ide/src/doc_highlights.rs</code>:134 on 2025-07-24 19:34</div>
            <div class="timeline-body"><p>The problem I see with that approach is that it doesn't allow us to include the &quot;kind&quot; (&quot;Read&quot;, &quot;Write&quot;, &quot;Other&quot;) for each reference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @UnboundVariable on 2025-07-24 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @UnboundVariable on 2025-07-24 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-24 20:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:58:39 UTC
    </footer>
</body>
</html>
