<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isort: support forced_separate - astral-sh/ruff #2268</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>isort: support forced_separate</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2268">#2268</a>
        opened by <a href="https://github.com/akx">@akx</a>
        on 2023-01-27 17:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a></div>
            <div class="timeline-body"><p>Support for <a href="https://pycqa.github.io/isort/docs/configuration/options.html#forced-separate"><code>forced_separate</code></a>:</p>
<blockquote>
<p>Force certain sub modules to show separately</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/akx">@akx</a> on 2023-01-27 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scop">@scop</a> on 2023-01-27 18:52</div>
            <div class="timeline-body"><p>Ah, cool to see you beat me to this. To be able to drop isort in Home Assistant, by chance? ;)</p>
<p>I hadn&#x27;t thought of this much, but skimming quickly here, noticed one thing I actually had: this implementation appears to treat <code>forced_separate</code> as just list of strings, i.e. literal package names. The isort docs aren&#x27;t that clear about it, but they&#x27;re actually globs over there: https://github.com/PyCQA/isort/blob/0c8a8b8d12a16bc54a7fe053eaf52fcbf5e15e35/isort/place.py#L39</p>
<p>My vague overall thought was that I&#x27;d simply <a href="https://docs.rs/globset/latest/globset/#example-match-multiple-globs-at-once">assemble a <code>globset::GlobSet</code></a> out of these, then modify the existing code without refactoring, matching across all sections, inserting newlines when matching imports occur (avoiding inserting too many), and be done with it. Don&#x27;t know if that would have cut it, but thought I&#x27;d mention it just in case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-28 09:44</div>
            <div class="timeline-body"><blockquote>
<p>To be able to drop isort in Home Assistant, by chance? ;)</p>
</blockquote>
<p>You guessed it!</p>
<blockquote>
<p>I hadn&#x27;t thought of this much, but skimming quickly here, noticed one thing I actually had: this implementation appears to treat <code>forced_separate</code> as just list of strings, i.e. literal package names.</p>
</blockquote>
<p>Yep, afaics nothing in the ruff isort world deals with globs at all, just package basenames - I figured this implementation could be refined if there&#x27;s a real-world user who needs a glob.</p>
<blockquote>
<p>matching across all sections, inserting newlines when matching imports occur (avoiding inserting too many), and be done with it. Don&#x27;t know if that would have cut it, but thought I&#x27;d mention it just in case.</p>
</blockquote>
<p>Yeah, I took a look at the isort source for this, and was quite surprised to see it actually deals with <code>forced_separate</code>s as an entirely different block of imports, not separating them within the category sections, so I don&#x27;t think this would&#x27;ve cut it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/akx">@akx</a> on 2023-01-28 09:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-28 16:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/isort/split.rs</code>:17 on 2023-01-28 16:44</div>
            <div class="timeline-body"><p>Hmm, is this not being called? Can&#x27;t find the reference. Maybe I&#x27;m just tired!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-28 16:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/isort/split.rs</code>:17 on 2023-01-28 16:46</div>
            <div class="timeline-body"><p>It&#x27;s over here -- Github just &quot;helpfully&quot; collapses the big mod.rs diff if you&#x27;re not looking at each commit separately:</p>
<p>https://github.com/charliermarsh/ruff/pull/2268/files#diff-d896c56e3618229a80f0311bdd754bc1a0c033e5c9a08f99cce34fafeda51b60R139</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/isort/split.rs</code>:38 on 2023-01-28 16:46</div>
            <div class="timeline-body"><p>If you had this:</p>
<pre><code>import os
import foo
import bar
import typing
</code></pre>
<p>And <code>foo</code> and <code>typing</code> were in <code>forced_separate</code>, what&#x27;s the right behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-28 16:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-28 16:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/isort/split.rs</code>:38 on 2023-01-28 16:48</div>
            <div class="timeline-body"><p>As in: what does <code>isort</code> do, and are we consistent?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-28 16:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/isort/split.rs</code>:17 on 2023-01-28 16:48</div>
            <div class="timeline-body"><p>D&#x27;oh, thank you...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/isort/split.rs</code>:38 on 2023-01-28 17:05</div>
            <div class="timeline-body"><p>Ah, duh... Actually, based on <a href="https://github.com/PyCQA/isort/blob/82569d97210a487786cab5dae9e5ce0c0c9af82f/tests/unit/test_isort.py#L1039-L1099">the test in <code>isort</code></a> we should partition the blocks <em>separately</em> for each entry in <code>forced_separate</code>, and take the order of <code>forced_separate</code> into account too.</p>
<p>Back to the drawing board... :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-28 17:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/akx">@akx</a> on 2023-01-28 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-02-01 11:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/isort/split.rs</code>:38 on 2023-02-01 11:14</div>
            <div class="timeline-body"><p>Okay, rewrote the splitting to partition into any number of separate blocks based on the order of <code>forced_separate</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/akx">@akx</a> on 2023-02-01 11:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-02-01 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/isort/split.rs</code>:55 on 2023-02-01 14:42</div>
            <div class="timeline-body"><p>One thing I&#x27;m a bit concerned about here is that if more things are added into <code>ImportBlock</code>, this will quietly leave them untouched in the <code>blocks</code>. Since <code>forced_separate</code> isn&#x27;t a very mainstream configuration, that&#x27;d be easy to overlook... Any ideas?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/akx">@akx</a> on 2023-02-01 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-01 15:06</div>
            <div class="timeline-body"><p>I&#x27;m not sure why the new Windows snapshots are failing -- I saw this in a separate PR. Maybe it&#x27;s related to the <code>insta</code> upgrade in #2185.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-02-02 01:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/isort/mod.rs</code>:144 on 2023-02-02 01:08</div>
            <div class="timeline-body"><p>How does this work in the event that we have a forced-separate entry that doesn&#x27;t end up matching any imports? I think that would return a <code>Block::default()</code> corresponding to entry. Do we need to skip empty blocks? Or do they get materialized to the empty string?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-02-02 01:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/isort/split.rs</code>:30 on 2023-02-02 01:09</div>
            <div class="timeline-body"><p>Could you destructure <code>block</code>? Like:</p>
<pre><code>let Block { import, import_from, import_from_as, import_from_star } = block;
</code></pre>
<p>Then the destructure will fail if we add a new property.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-02-02 09:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/isort/mod.rs</code>:144 on 2023-02-02 09:20</div>
            <div class="timeline-body"><p>They get materialized to the empty string ‚Äì added a configuration to the test that verifies this üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-02 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-02 13:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:59 UTC
    </footer>
</body>
</html>
