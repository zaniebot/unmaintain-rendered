<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect `#(deprecated)` attribute in configuration options - astral-sh/ruff #8035</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Respect <code>#(deprecated)</code> attribute in configuration options</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8035">#8035</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-10-18 03:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>This PR extends the <code>OptionsMetadata</code> derive macro to respect the <code>deprecated</code> attribute.</p>
<p>Adding the <code>deprecated</code> attribute to an option does:</p>
<ul>
<li>Mark the option as deprecated in the json schema (handled by schemars)</li>
<li>Adds a <code>deprecated</code> message to the documentation</li>
<li>Shows a <code>(deprecated)</code> label when listing the configurations with <code>ruff config</code></li>
<li>Shows the deprecation message when showing an option with <code>ruff config &lt;name&gt;</code></li>
</ul>
<p><code>deprecated</code> is not yet supported for groups.</p>
Test Plan
<pre><code> cargo run --bin ruff -q -- config extend-ignore
A list of rule codes or prefixes to ignore, in addition to those
specified by `ignore`.

Default value: []
Type: list[RuleSelector]
Deprecated: This option has been **deprecated** in favor of `ignore` since its usage is now interchangeable with `ignore`.
Example usage:
..
</code></pre>
<pre><code>cargo run --bin ruff -q -- config 
cache-dir
extend
...
extend-ignore (deprecated)
</code></pre>
<img alt="Screenshot 2023-10-19 at 09 57 21" src="https://github.com/astral-sh/ruff/assets/1203881/bb86744c-42c1-4bf9-aa7d-27cdb571b9bd">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 03:13</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #8000</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8000"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a><ul>
<li><strong>PR #8002</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8002"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a><ul>
<li><strong>PR #8032</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8032"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a></li>
<li><strong>PR #8006</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8006"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a><ul>
<li><strong>PR #8035</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8035"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a>  ðŸ‘ˆ<ul>
<li><strong>PR #8010</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8010"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a>
* <strong>PR #8082</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8082"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a>
* <strong>PR #8088</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8088"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a>
* <strong>PR #8039</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8039"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a></li>
</ul>
</li>
<li><strong>PR #8031</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8031"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite"></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8035?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 03:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 03:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-18 03:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_macros/src/config.rs</code>:217 on 2023-10-18 03:45</div>
            <div class="timeline-body"><p>The old logic relied on the specific order. The new logic allows arbitrary ordering and is in line with that serde and other crates use for parsing attribute fields.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-18 03:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>ruff.schema.json</code>:1698 on 2023-10-18 03:48</div>
            <div class="timeline-body"><p>We shouldn&#x27;t remove deprecated options from the schema to avoid existing configurations failing the schema validation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Respect `deprecated` attribute in configuration options&quot; to &quot;Respect `#(deprecated)` attribute in configuration options&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 06:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 06:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 06:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-18 06:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_dev/src/generate_options.rs</code>:123 on 2023-10-18 13:52</div>
            <div class="timeline-body"><p>Can we remove this or otherwise modify the deprecation message? Right now, it reads &quot;This option is deprecated: This option has been deprecated ...&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-10-18 13:53</div>
            <div class="timeline-body"><p>When we rename an option, will we leave the deprecated variant and mark it as deprecated? I assume both will then show up in the documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-10-19 00:05</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-19 00:05</div>
            <div class="timeline-body"><blockquote>
<p>When we rename an option, will we leave the deprecated variant and mark it as deprecated? I assume both will then show up in the documentation.</p>
</blockquote>
<p>Yes, marking an option as deprecated has the result that both, the new and the deprecated, options show up in the documentation. We can customize the layout for deprecated options if we want.</p>
<p>I considered alternatives for the special case of renaming options but they all require more tooling support which I&#x27;m not sure is worth building. What I want is that:</p>
<ul>
<li>Both the new and deprecated options are in the json schema. The deprecated option must be marked as deprecated in the schema.</li>
<li>Ideally: The deprecated name is listed next to the new configuration name.</li>
</ul>
<p>The challenge is that we need two fields to know if the user used the deprecated field (we could create a custom deserializer and emit the warning in the deserializer but it will be challenging to ever return this warning as a diagnostic in the future). Also, <code>schemars</code> needs two fields to have both show up in the schema.</p>
<p>We could remove the <code>option</code> attribute from the deprecated option and add a <code>deprecated_alias</code> field to the <code>option</code> attribute. But it felt like too much complexity for the few deprecated options that we have today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-19 00:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_dev/src/generate_options.rs</code>:123 on 2023-10-19 00:33</div>
            <div class="timeline-body"><p>I updated the messaging of the deprecated note and the formatting in the documentation generation. I hope you like this better.
<img alt="Screenshot 2023-10-19 at 09 32 38" src="https://github.com/astral-sh/ruff/assets/1203881/e4234485-47a1-4066-851f-182e5a131f43"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-19 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-19 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-10-19 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-10-19 21:31</div>
            <div class="timeline-body"><p>Curious to see how SchemaStore (and other validators, like fastjsonschema) handle this - might need to be added to the ignored keyword list in their internal validator (which is easy to do per schema). Technically, it was added in draft 2019, which pretty much nothing seems to officially support. But like other features, I don&#x27;t think extra keywords are disallowed, and validators may start picking up on this (besides schemas, I know there&#x27;s discussion on making jsonschema in Python support it).</p>
<p>(This is my favorite 2019 feature, though, and I&#x27;d love to see it added everywhere)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-19 22:09</div>
            <div class="timeline-body"><p>Thanks for the notes! We&#x27;ll see at <a href="https://github.com/SchemaStore/schemastore/pull/3332">SchemaStore/schemastore#3332</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-19 23:05</div>
            <div class="timeline-body"><p>Interesting, I assumed that this is well supported, considering that 2020-12 is the <a href="https://json-schema.org/specification">most recent json schema specification</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-10-19 23:08</div>
            <div class="timeline-body"><p>It would be nice if the description in JSONSchema would include the deprecation reason. I wasnâ€™t aware that <code>extend-ignore</code> was deprecated and the schema didnâ€™t say why.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-10-19 23:11</div>
            <div class="timeline-body"><p>Most tools seem to have frozen at draft 7. Fastjsonschema (used by validate-pyproject) requires 7. Even schemastore requires 7: https://github.com/SchemaStore/schemastore/blob/master/CONTRIBUTING.md#best-practices</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-19 23:36</div>
            <div class="timeline-body"><blockquote>
<p>It would be nice if the description in JSONSchema would include the deprecation reason. I wasnâ€™t aware that <code>extend-ignore</code> was deprecated and the schema didnâ€™t say why.</p>
</blockquote>
<p>Yeah. I haven&#x27;t figured out a good (technical) solution to this yet which doesn&#x27;t require us to re-implement schemar&#x27;s derive macro other than copying the deprecation message into the description. It&#x27;s a pity that the json schema <code>deprecated</code> field is a boolean and doesn&#x27;t allow specifying a message</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:58:26 UTC
    </footer>
</body>
</html>
