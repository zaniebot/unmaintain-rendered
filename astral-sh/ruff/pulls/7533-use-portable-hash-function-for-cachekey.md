```yaml
number: 7533
title: "Use portable hash function for `CacheKey`"
type: pull_request
state: merged
author: MichaReiser
labels:
  - internal
assignees: []
merged: true
base: main
head: cache-stable-hasing
created_at: 2023-09-20T07:58:11Z
updated_at: 2023-09-20T13:20:00Z
url: https://github.com/astral-sh/ruff/pull/7533
synced_at: 2026-01-12T02:39:10Z
```

# Use portable hash function for `CacheKey`

---

_Pull request opened by @MichaReiser on 2023-09-20 07:58_

## Summary
Use [seahash](https://docs.rs/seahash/4.1.0/seahash/) as stable and portable cache key function. 

This doesn't give us a portable cache yet because:

* The `Path` cache key implementation is most certainly platform dependent
* `Settings` stores the absolute paths which means the derived `CacheKey` changes when you move a project.


## Test Plan

Seahash is about 4% slower than the default hasher


---

_Comment by @MichaReiser on 2023-09-20 07:58_

Current dependencies on/for this PR:
* main
  * **PR #7533** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7533" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7533?utm_source=stack-comment).

---

_Label `internal` added by @MichaReiser on 2023-09-20 07:59_

---

_@MichaReiser reviewed on 2023-09-20 08:00_

---

_Review comment by @MichaReiser on `crates/ruff_cache/src/cache_key.rs`:380 on 2023-09-20 08:00_

I replaced the `Deref` implementation with implementing `Hasher` directly to avoid changing the hasher to be a breaking API change.

---

_Review requested from @charliermarsh by @MichaReiser on 2023-09-20 08:01_

---

_Renamed from "Use stable hash function for `CacheKey`" to "Use portable hash function for `CacheKey`" by @MichaReiser on 2023-09-20 08:03_

---

_Comment by @github-actions[bot] on 2023-09-20 08:47_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_@charliermarsh approved on 2023-09-20 13:10_

Micha adding a dependency? This is highly irregular.

---

_Comment by @MichaReiser on 2023-09-20 13:19_

> Micha adding a dependency? This is highly irregular.

Should I fork it instead ;) Writing my hash functions is out of reach for me..

---

_Merged by @MichaReiser on 2023-09-20 13:19_

---

_Closed by @MichaReiser on 2023-09-20 13:20_

---

_Branch deleted on 2023-09-20 13:20_

---
