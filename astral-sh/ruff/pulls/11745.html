<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server`: Formatting a document with syntax problems no longer spams a visible error popup - astral-sh/ruff #11745</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff server</code>: Formatting a document with syntax problems no longer spams a visible error popup</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11745">#11745</a>
        opened by <a href="https://github.com/snowsignal">@snowsignal</a>
        on 2024-06-04 22:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a></div>
            <div class="timeline-body">Summary
<p>Fixes <a href="https://github.com/astral-sh/ruff-vscode/issues/482">astral-sh/ruff-vscode#482</a>.</p>
<p>I&#x27;ve made adjustments to <code>format</code> and <code>format_range</code> that handle parsing errors before they become server errors. We&#x27;ll still log this as a problem, but there will no longer be a visible popup.</p>
Test Plan
<p>Instead of seeing a visible error when formatting a document with syntax issues, you should see this warning in the LSP logs:</p>
<img alt="Screenshot 2024-06-04 at 3 38 23‚ÄØPM" src="https://github.com/astral-sh/ruff/assets/19577865/9d68947d-6462-4ca6-ab5a-65e573c91db6">

<p>Similarly, if you try to format a range with syntax issues, you should see this warning in the LSP logs instead of a visible error popup:</p>
<img alt="Screenshot 2024-06-04 at 3 39 10‚ÄØPM" src="https://github.com/astral-sh/ruff/assets/19577865/99fff098-798d-406a-976e-81ead0da0352">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-04 22:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-06-04 22:45</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/jane/server/error-spam">CodSpeed Performance Report</a>
Merging #11745 will <strong>not alter performance</strong>
<p>Comparing <code>jane/server/error-spam</code> (9293364) with <code>main</code> (d056d09)</p>
Summary
<p><code>‚úÖ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-06-04 22:54</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-04 23:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_server/src/format.rs</code>:18 on 2024-06-04 23:25</div>
            <div class="timeline-body"><p>Nit: reword for clarity?</p>
<pre><code>        // Special case - syntax/parse errors are be handled here instead of
        // being propagated as visible server errors.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-04 23:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_server/src/format.rs</code>:41 on 2024-06-04 23:30</div>
            <div class="timeline-body"><p>Should we just return <code>Ok(None)</code> here, so that we avoid cloning the source text and applying a full no-op edit?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowsignal">@snowsignal</a> reviewed on 2024-06-04 23:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/snowsignal">@snowsignal</a> on <code>crates/ruff_server/src/format.rs</code>:41 on 2024-06-04 23:32</div>
            <div class="timeline-body"><p>Sure, I can re-work the return type to be optional üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-04 23:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_server/src/format.rs</code>:37 on 2024-06-04 23:33</div>
            <div class="timeline-body"><p>Just fyi I only commented on one instance of this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-04 23:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-04 23:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-06-05 00:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-05 00:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-06-05 00:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-05 00:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:04:27 UTC
    </footer>
</body>
</html>
