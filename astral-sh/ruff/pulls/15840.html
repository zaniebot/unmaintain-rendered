<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pyupgrade`] Reuse replacement logic from `UP046` and `UP047` (`UP040`) - astral-sh/ruff #15840</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pyupgrade</code>] Reuse replacement logic from <code>UP046</code> and <code>UP047</code> (<code>UP040</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15840">#15840</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-01-30 22:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-01-30 22:54</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is a follow-up to #15565, tracked in #15642, to reuse the string replacement logic from the other PEP 695 rules instead of the <code>Generator</code>, which has the benefit of preserving more comments. However, comments in some places are still dropped, so I added a check for this and update the fix safety accordingly. I also added a <code>## Fix safety</code> section to the docs to reflect this and the existing <code>isinstance</code> caveat.</p>
<h2>Test Plan</h2>
<p>Existing UP040 tests, plus some new cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-30 23:01</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-01-30 23:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/pep695/non_pep695_type_alias.rs</code>:225 on 2025-01-30 23:01</div>
            <div class="timeline-body"><p>This is unrelated to my changes here, but I think this TODO is actually done? All of the TODO test cases added in #6314 were fixed in #6749, but maybe there are more types of generics that are still not handled.</p>
<p>https://github.com/astral-sh/ruff/blob/4f2aea8d5088c3ba2f7857540bca97784b1f6ff1/crates/ruff_linter/src/rules/pyupgrade/rules/pep695/non_pep695_type_alias.rs#L187-L188</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-01-30 23:03</div>
            <div class="timeline-body"><p>Fantastic! Simplifies the code, improves the quality of the fix, improves the rule's docs and improves our test coverage ðŸš€</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-30 23:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/pep695/non_pep695_type_alias.rs</code>:225 on 2025-01-30 23:04</div>
            <div class="timeline-body"><p>Ooh interesting, this might well be done now. I can check in the morning. Doesn't need to hold up this PR though, I don't think!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2025-01-30 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-31 11:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/pep695/non_pep695_type_alias.rs</code>:225 on 2025-01-31 11:23</div>
            <div class="timeline-body"><p>Yeah, this TODO seems done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-01-31 12:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/rules/pyupgrade/rules/pep695/non_pep695_type_alias.rs</code>:225 on 2025-01-31 12:49</div>
            <div class="timeline-body"><p>Awesome! I'll delete it and then get ready to merge. Thanks again for the review and for checking this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-01-31 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-01-31 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-31 13:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:52 UTC
    </footer>
</body>
</html>
