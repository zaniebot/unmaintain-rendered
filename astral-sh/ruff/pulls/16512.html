<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Add `__init__` arguments check when doing `try_call` on a class literal - astral-sh/ruff #16512</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Add <code>__init__</code> arguments check when doing <code>try_call</code> on a class literal</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16512">#16512</a>
        opened by <a href="https://github.com/mishamsk">@mishamsk</a>
        on 2025-03-05 03:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-05 03:19</div>
            <div class="timeline-body"><h2>Summary</h2>
<ul>
<li>Addresses astral-sh/ty#186 for simple cases where only <code>__init__</code> method is bound on class or doesn't exist at all.</li>
<li>fixes a bug with argument counting in bound method diagnostics</li>
</ul>
<p>Caveats:</p>
<ul>
<li>No handling of <code>__new__</code> or modified <code>__call__</code> on metaclass.</li>
<li>This leads to a couple of false positive errors in tests</li>
</ul>
<h2>Test Plan</h2>
<ul>
<li>A couple new cases in mdtests</li>
<li>cargo nextest run -p red_knot_python_semantic --no-fail-fast</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-05 03:30</div>
            <div class="timeline-body"><p>This is still a draft, as I wanted to discuss a couple of things first.</p>
<p>First of all, @sharkdp did all the hard work and it seems almost too easy now. However, there are a couple of caveats.</p>
<ul>
<li>If I follow the current <code>CallOutcome</code> setup and how other dunder calls are done - incorrect call signature causes the resulting type to become <code>Unknown</code>. I think this is not every helpful as it would cause all kinds of missed downstream diagnostics. You can see this happening in <a href="https://github.com/astral-sh/ruff/actions/runs/13667755980/job/38212285823?pr=16512#step:8:4221">this test</a> - I haven't fixed it intentionally.<ul>
<li>I would suggest that for <code>__init__</code> call, the diagnostics are added to <code>CallOutcome</code> but an instance type is returned even if error occurs. This is not possible now, because <code>official</code> API that creates <code>CallOutcome</code> is <code>bind_call</code> which will emit argument mismatch second time (following whatever <code>try_call_dunder</code> returns). The only other way to create <code>CallOutcome</code> - <code>from_return_type</code> is marked as deprecated. @carljm any objections to creating a <code>CallOutcome ::new</code> method for this case?</li>
</ul>
</li>
<li>I have two concerns with the current diagnostics like <code>[too-many-positional-arguments] &quot;Too many positional arguments to bound method ``__init__``: expected 1, got 2&quot;</code><ul>
<li>Maybe it is worth special casing <code>__init__</code> and avoiding the <code>bound method</code> portion?</li>
<li>Not strictly related to this PR, but for bound methods expected/actual number of arguments should not count the first one. So if there are no arguments to <code>__init__</code> the diagnostic should be <code>expected 0, got 1</code> instead of the current <code>expected 1, got 2</code></li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-03-05 03:57</div>
            <div class="timeline-body"><blockquote>
<ul>
<li>Maybe it is worth special casing <code>__init__</code> and avoiding the <code>bound method</code> portion?</li>
</ul>
</blockquote>
<p>I'm not convinced. <code>__init__</code> is a bound method. What's the harm in saying so?</p>
<blockquote>
<ul>
<li>if there are no arguments to <code>__init__</code> the diagnostic should be <code>expected 0, got 1</code> instead of the current <code>expected 1, got 2</code></li>
</ul>
</blockquote>
<p>Agreed, should be a pretty easy change I think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-03-05 04:18</div>
            <div class="timeline-body"><p>I'm not sure I understand your first point. It's both possible and common to have a <code>CallOutcome</code> that both includes binding errors and has a return type -- in fact that's what we generally do for function calls, as this test will show:</p>
<pre><code class="language-py">def f() -&gt; int:
    return 1

x = f(1)  # error: [too-many-positional-arguments]

reveal_type(x)  # revealed: int
</code></pre>
<p>What's unusual about <code>__init__</code> is that it returns <code>None</code>, so our usual return-type handling won't work here. This gets into what I mentioned in Discord about modeling both <code>__new__</code> and <code>__init__</code>. The proper modeling here is that we call <code>__new__</code>, which returns an instance of the type (in order to do this <em>properly</em> based on the typeshed definition of <code>object.__new__</code>, we would need to support <code>typing.Self</code> -- but it may not be hard to add a hacky version of support for <code>Self</code>), and then we call <code>__init__</code> on that instance, and we don't care about the return type of <code>__init__</code>. (We don't have to model things totally correctly on the first PR, but we'll want to have TODO comments for the correct modeling, and we shouldn't put too much work into workarounds to model things wrongly, if we can avoid it.)</p>
<p>Those are just some general comments, haven't looked at the code in the PR yet, will do that tomorrow!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-05 08:44</div>
            <div class="timeline-body"><blockquote>
<p>and then we call <code>__init__</code> on that instance, and we don't care about the return type of <code>__init__</code></p>
</blockquote>
<p>Maybe this is what you meant by <em>&quot;We don't have to model things totally correctly&quot;</em>, but I guess we should (eventually) emit a diagnostic if <code>__init__</code> does not return <code>None</code>, since the runtime <a href="https://github.com/python/cpython/blob/ffef9b0440e4391cbad69dbb11716f54cb8539ab/Objects/typeobject.c#L9810-L9816">throws a <code>TypeError</code> in case it doesn't</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2025-03-05 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-05 13:30</div>
            <div class="timeline-body"><blockquote>
<p>I'm not sure I understand your first point</p>
</blockquote>
<p>First, I realized I confused everyone by saying <code>CallOutcome</code> doesn't have the right API's, but that was supposed to be <code>CallBinding</code> of course. Let me break it down step by step.</p>
<ul>
<li>I must call <code>try_call_dunder</code> to trigger descriptor protocol and see what <code>__init__</code> call yields</li>
<li>The call returns <code>Result&lt;CallOutcome&lt;'db&gt;, CallDunderError&lt;'db&gt;&gt;</code>. In case of errors I'll get <code>CallDunderError</code></li>
<li>I then map <code>CallDunderError</code> to <code>CallError</code>. So far so good</li>
<li>Now, I need to return something like <code>Ok(CallOutcome::Single(CallBinding { ..., errors: vec![error_from_dunder_call] }))</code>. However, there is only one public API that creates it <code>bind_call</code> which does the full type checking logic and inserts its own errors. There is no API to create a <code>CallBinding</code> by supplying types &amp; errors directly</li>
</ul>
<p>Hence, I suggest adding a method of a function in <code>bind.rs</code> for this case.</p>
<p>Any objections?</p>
<blockquote>
<p>Agreed, should be a pretty easy change I think?</p>
</blockquote>
<p>I haven't looked yet, I'll apply the change since everyone is fine. But this means that more tests will change in this PR than just those related to <code>__init__</code>. Or I can make it a separate PR too...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-03-06 06:18</div>
            <div class="timeline-body"><p>(Didn't get to this today, sorry; will come back to it tomorrow.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 18:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:30 on 2025-03-06 18:52</div>
            <div class="timeline-body"><p>Could we also add <code>reveal_type(…)</code>s here, to see what type we infer for those incorrect <code>Foo(…)</code> calls? I think ideally, we would still infer <code>Foo</code> in all cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 19:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:6 on 2025-03-06 19:00</div>
            <div class="timeline-body"><p>The reason that this works at all is that we fall back to calling <code>__init__</code> on <code>object</code>, correct?</p>
<p><code>builtins.pyi</code>:</p>
<pre><code class="language-pyi">class object:
    # …
    def __init__(self) -&gt; None: ...
</code></pre>
<p>So maybe we can rephrase this a bit?</p>
<pre><code class="language-suggestion">Every class has `object` in it's MRO, so if no `__init__` method is provided, we fall back to
`object.__init__`, which can only be called with zero arguments:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2246 on 2025-03-06 20:05</div>
            <div class="timeline-body"><p>Mainly curious: How can this code path be triggered? (assuming nobody has tampered with <code>typeshed</code>)</p>
<p>If <code>__init__</code> is defined on <code>object</code>, can it ever be possibly unbound? If there is a way to trigger it, can we add a test for it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 20:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2246 on 2025-03-06 20:06</div>
            <div class="timeline-body"><p>Similar question for the <code>CallDunderError::MethodNotAvailable</code> path below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 20:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2227 on 2025-03-06 20:12</div>
            <div class="timeline-body"><p>Could/should this <code>Some(_)</code> path be merged with the <code>None</code> path below, i.e. couldn't we rely on typeshed stubs to give us the right <code>__init__</code> signature for these classes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-06 21:27</div>
            <div class="timeline-body"><blockquote>
<p>Maybe this is what you meant by <em>&quot;We don't have to model things totally correctly&quot;</em>, but I guess we should (eventually) emit a diagnostic if <code>__init__</code> does not return <code>None</code>, since the runtime <a href="https://github.com/python/cpython/blob/ffef9b0440e4391cbad69dbb11716f54cb8539ab/Objects/typeobject.c#L9810-L9816">throws a <code>TypeError</code> in case it doesn't</a>.</p>
</blockquote>
<p>@sharkdp agree. but IMHO the diagnostic should be emitted when traversing the <code>__init__</code> definition, not at call site. So it should be tackled separately and won't affect this code at all. Unless I am missing something</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2246 on 2025-03-06 21:29</div>
            <div class="timeline-body"><p>great question. I haven't checked the typeshed for <code>object</code> and actually dropped the ball here a bit. I stopped working on this PR as soon as I hit the wall with the lack of necessary API on <code>CallBinding</code>. Hence it is still in draft &amp; far from finished.</p>
<p>Hopefully, I'll find some time today to move forever regardless of <code>CallBinding</code> decision. Thanks for pointing this out!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-06 21:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-06 21:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:30 on 2025-03-06 21:31</div>
            <div class="timeline-body"><p>will do! and yes, that's exactly what I mentioned in my comment about <code>CallBinding</code> API's. I also think that we should emit diagnostic but still infer as if the call was correct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-06 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2227 on 2025-03-06 21:33</div>
            <div class="timeline-body"><p>doesn't look like so. E.g. the tests that involved <code>int</code> failed without this branch, which means typeshed lacks the proper signature or something else going on.</p>
<p>I intended to close this PR without touching known classes and then do a separate one where I'll figure out how to handle their signatures. May be an issue with vendors typeshed, may be something else. I haven't checked yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 21:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2227 on 2025-03-06 21:54</div>
            <div class="timeline-body"><blockquote>
<p>doesn't look like so. E.g. the tests that involved <code>int</code> failed without this branch, which means typeshed lacks the proper signature or something else going on.</p>
</blockquote>
<p>You're right, I guess we can only do that once we also check the <code>__new__</code> calls (and understand overloads)</p>
<p>https://github.com/astral-sh/ruff/blob/b3c884f4f33a81cd08e9ebc13fd0d5a538c8afc7/crates/red_knot_vendored/vendor/typeshed/stdlib/builtins.pyi#L235-L239</p>
<blockquote>
<p>I intended to close this PR without touching known classes</p>
</blockquote>
<p>Sounds good to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-06 21:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2246 on 2025-03-06 21:55</div>
            <div class="timeline-body"><blockquote>
<p>Hence it is still in draft &amp; far from finished.</p>
</blockquote>
<p>FWIW, I think what you have here looks great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2246 on 2025-03-07 02:59</div>
            <div class="timeline-body"><p>confirmed that object should always be in the mro &amp; thus <code>__init__</code> method defined via typeshed. joined the arms and marked unreachable. again, thanks for the heads up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-07 02:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @mishamsk on 2025-03-07 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @mishamsk on 2025-03-07 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @mishamsk on 2025-03-07 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @mishamsk on 2025-03-07 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-07 04:28</div>
            <div class="timeline-body"><p>@carljm never mind my previous comments, I found an API I needed. I think this is ready for review.</p>
<p>I had to temporarily add 3 false positive errors in two unrelated mdtest<code>s due to lack of </code><strong>new</strong>` handling. I will follow with a PR for that and they'll go away.</p>
<p>I also fixed the argument counting in the diagnostics when calling bound methods</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @mishamsk on 2025-03-07 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-07 04:48</div>
            <div class="timeline-body"><p>bummer... bench is failing due to tomlib using a lot of <code>int(..)</code> calls which emit false positives for now (cause we do not check <code>__new__</code> yet and there is no temporary special case check of <code>KnownClass::int</code>).</p>
<p>I'd rather do a bandaid - add a hard-coded handler for <code>int</code>, just like <code>bool</code>, <code>str</code> currently and tackle <code>__new__</code> in a separate PR. Hope no objections to this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2277 on 2025-03-07 09:24</div>
            <div class="timeline-body"><p>Should we add a <code>set_return_type</code> method on <code>CallError</code> instead. It would have the advantage that we can mutate the error in place (we own <code>error</code> here)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2280 on 2025-03-07 09:25</div>
            <div class="timeline-body"><p>I prefer to only use <code>unreachable</code> for code that is unreachable because of how we structure our code. This feels more like a general assertion and we should probably also not panic in that case and instead gracefully fallback (but maybe log a warning?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-07 09:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-07 22:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2277 on 2025-03-07 22:58</div>
            <div class="timeline-body"><p>yeah, that made it more ergonomic. Not only on <code>CallError</code> but also on <code>CallOutcome</code>. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-07 22:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2280 on 2025-03-07 22:59</div>
            <div class="timeline-body"><p>added tracing with warning level. I haven't touched tracing/logging before, but hope that matches the intent!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-07 23:03</div>
            <div class="timeline-body"><p>copy pasting from discord.</p>
<p>Looks like I will not be able to get away with a two PR approach for <code>__init__</code> &amp; <code>__new__</code> signature checking.</p>
<p>Many builtin types &amp; stdlib (e.g. <code>int</code>, <code>datetime.time</code>) only define <code>__new__</code>, not <code>__Init__</code>. Which is perfectly fine at runtime, since <code>object.__init__</code> would take any amount of arguments without raising an error when custom <code>__new__</code> is present. It only raises <code>TypeError</code> for extra arguments without custom <code>__new__</code>.</p>
<p>At the same time, both <code>object.__init__</code> and <code>object.__new__</code> are defined as argument-less in typeshed. This works well for classes without <code>__new__</code> &amp; <code>__init__</code>, only <code>__new__</code> or when both <code>__new__</code> &amp; <code>__init__</code> are defined. Not so much for the ones with only <code>__new__</code>. I could have ignored <code>__init__</code> entirely if no <code>__new__</code> is defined. But it is always defined curtesy of object...</p>
<p>So in order for me to avoid false positives on the benchmark, I would still need to at least check if <code>__new__</code> is defined anywhere in MRO except object. But that seems like unnecessary temporary workaround. If I am checking for the existence of <code>__new__</code> I may as well try calling it...</p>
<p>Which also brings another necessity - I'll need to extend class_member API with an optional argument to stop checking MRO before object... Luckily this API is only used in 2 places now, so doesn't seem like a big deal.</p>
<h2>In short, two options here</h2>
<ul>
<li>add quite a lot of false positive diagnostics on tomllib to the bench and merge in current state</li>
<li>or, apply class_member API changes, add at least basic handling of <code>__new__</code> (e.g. ignore return type, which is usually Self in typeshed and not supported by knot)</li>
</ul>
<p>team, leaning on to you for decision here. Normally I'd prefer more smaller PR's, but this may not be the right time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-03-08 01:35</div>
            <div class="timeline-body"><p>Thanks for digging into this! Given those choices, I think we may as well just add <code>__new__</code> support? The initial version can ignore the return type of <code>__new__</code>.</p>
<p>If even that turns out to be harder than expected, we can also just check for if <code>__new__</code> is defined (barring <code>object.__new__</code>) and not do any constructor checks at all for such types.</p>
<p>I think you are right that we will need the ability to query for a member while ignoring its definition on the <code>object</code> base. (Or possibly we can just hardcode this behavior for <code>__init__</code> and <code>__new__</code> lookups and avoid needing to pass in an external flag?)</p>
<p>(For future reference, another wrinkle we should add a TODO for is if the class' metaclass defines <code>__call__</code> -- if so that takes priority over <code>__new__</code> and <code>__init__</code>. EDIT -- looks like we already have that mentioned in a TODO comment.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:72 on 2025-03-08 01:47</div>
            <div class="timeline-body"><p>This import seems unused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:80 on 2025-03-08 01:47</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        return SomeCallable()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:230 on 2025-03-08 01:49</div>
            <div class="timeline-body"><p>TIL that a) it's even possible to make <code>__init__</code> a descriptor, and b) doing so apparently bypasses the runtime check that <code>__init__</code> returns <code>None</code>:</p>
<pre><code>&gt;&gt;&gt; class C:
...     def __init__(self):
...         return &quot;a&quot;
...
&gt;&gt;&gt; c = C()
Traceback (most recent call last):
  File &quot;&lt;python-input-6&gt;&quot;, line 1, in &lt;module&gt;
    c = C()
TypeError: __init__() should return None, not 'str'
</code></pre>
<p>but no error here:</p>
<pre><code>&gt;&gt;&gt; class SomeCallable:
...     def __call__(self, x: int) -&gt; str:
...         return &quot;a&quot;
...
... class Descriptor:
...     def __get__(self, instance, owner) -&gt; SomeCallable:
...         return SomeCallable()
...
... class Foo:
...     __init__: Descriptor = Descriptor()
...
&gt;&gt;&gt; Foo(1)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2674 on 2025-03-08 01:54</div>
            <div class="timeline-body"><p>This comment doesn't seem to describe what the code does?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2672 on 2025-03-08 02:05</div>
            <div class="timeline-body"><p>This case would not happen due to possibly unbound <code>__init__</code> -- that would trigger <code>CallDunderError::PossiblyUnbound</code> (which is handled below.) This case here, one layer deeper, would be triggered if, for example, we have an object set as <code>__init__</code> which has a possibly-unbound <code>__call__</code> method. This can happen without a broken typeshed, so I think in this case we should <code>set_return_type</code> and return <code>Err(error)</code> just like in the next case, so that we emit a diagnostic. (And add a test for this scenario.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-08 02:08</div>
            <div class="timeline-body"><p>@carljm</p>
<blockquote>
<p>For future reference, another wrinkle we should add a TODO for is if the class' metaclass defines <strong>call</strong> -- if so that takes priority over <strong>new</strong> and <strong>init</strong></p>
</blockquote>
<p>Yes, it was already there and was step 3 in my initial plan. will be step 2 (hopefully, I'll manage to get away without).</p>
<p>Will work on <code>__new__</code> as soon as I have time. thx. have a great weekend!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2696 on 2025-03-08 02:14</div>
            <div class="timeline-body"><p>I have a mild preference for not even emitting these warnings. Having a custom typeshed without <code>object.__init__</code> is really a harmless situation that we can easily fall back from, so why create extra noise?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2740 on 2025-03-08 02:16</div>
            <div class="timeline-body"><p>Technically we <em>could</em> explicitly also check against a single argument call here, and union the outcome with the other outcome, which would make this fallback &quot;perfect&quot;. But that also seems like a hassle to implement for a case that will hardly ever occur. I'd also be fine saying if you are missing <code>object.__init__</code> in typeshed you just don't get your calls checked against it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/call.rs</code>:178 on 2025-03-08 02:19</div>
            <div class="timeline-body"><p>This is a little ugly, and feels like throwing away information. I'd almost rather just have an optional <code>override_return_ty</code> field.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/call/bind.rs</code>:136 on 2025-03-08 02:20</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-03-08 02:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-03-08 02:20</div>
            <div class="timeline-body"><blockquote>
<p>Yes, it was already there and was step 3 in my initial plan. will be step 2 (hopefully, I'll manage to get away without).</p>
<p>Will work on <code>__new__</code> as soon as I have time. thx. have a great weekend!</p>
</blockquote>
<p>Awesome, thank you; you too!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-08 12:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:230 on 2025-03-08 12:31</div>
            <div class="timeline-body"><p>Ha. I checked that descriptor works before even starting working on pr. But I've used other code, this one was copied from another test. Hence the &quot;error&quot; with a non-None return type.</p>
<p>I suggest we keep the test and later emit error diagnostics for non None return even though it works in runtime. I will just add a comment that knot is stricter / deviates from runtime. If we ever see such code it is most probably an error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2672 on 2025-03-11 03:31</div>
            <div class="timeline-body"><p>merged with the following arm and added a test for this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2696 on 2025-03-11 03:32</div>
            <div class="timeline-body"><p>ok. since Micha wasn't too keen on warnings, I removed them. I do not have a strong preference, although I would personally keep them. If I am mingling with typeshed, I would appreciate additional logs...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2740 on 2025-03-11 03:32</div>
            <div class="timeline-body"><p>yeah, seems excessive to support this. so left as is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:72 on 2025-03-11 03:36</div>
            <div class="timeline-body"><p>indeed. left from earlier version. thanks for spotting!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:80 on 2025-03-11 03:36</div>
            <div class="timeline-body"><p>thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:230 on 2025-03-11 03:36</div>
            <div class="timeline-body"><p>added a todo comment in the test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2674 on 2025-03-11 03:36</div>
            <div class="timeline-body"><p>another artifact from earlier version. thanks for spotting!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types/call.rs</code>:178 on 2025-03-11 03:41</div>
            <div class="timeline-body"><p>I am hesitant to add a field for this rare case. A couple of reasons:</p>
<ul>
<li>we increase structure size just to handle a rare edge case</li>
<li>there are quite a lot of places where structure is constructed, so changing it will cause a lot of changes unrelated to the core of this PR...</li>
<li>I do not see a big difference between losing return type information on bindings/call outcomes, and on errors. If the calling code has a reason to override the return type, there is probably little need for the original one</li>
</ul>
<p>FWIW I think this change may be done when/if we'll hit an explicit need to know both the original and overriden return type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-11 05:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-11 05:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:66 on 2025-03-11 05:29</div>
            <div class="timeline-body"><p>@sharkdp I tried to figure the following out myself, but haven't finished. Maybe you can help me out here.</p>
<p><code>__new__</code> should be treated as a classmethod, looked up on the class itself (not meta class) but still go through descriptor protocol. I was trying to find the easiest and non-hacky way to special case it. Currently, it would search <code>__new__</code> on meta-type, always find <code>type.__new__</code> (defined in typeshed) and hence this and other tests related to <code>__new__</code> fail - they do not report errors even though they should...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-11 05:30</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">itsdangerous (https://github.com/pallets/itsdangerous)
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_url_safe.py:14:24: Object of type `Literal[URLSafeSerializer]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_url_safe.py:24:24: Object of type `Literal[URLSafeTimedSerializer]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_signer.py:21:24: Object of type `Literal[Signer]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_timed.py:32:24: Object of type `Literal[TimestampSigner]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_timed.py:99:24: Object of type `Literal[TimedSerializer]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_serializer.py:37:49: Object of type `Literal[Serializer]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/itsdangerous/tests/test_itsdangerous/test_serializer.py:188:23: Object of type `Literal[Serializer]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
- Found 30 diagnostics
+ Found 37 diagnostics

packaging (https://github.com/pypa/packaging)
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_tokenizer.py:133:37: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/version.py:206:13: Argument `epoch` does not match any known parameter of function `__new__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/version.py:207:13: Argument `release` does not match any known parameter of function `__new__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/version.py:208:13: Argument `pre` does not match any known parameter of function `__new__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/version.py:209:13: Argument `post` does not match any known parameter of function `__new__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/version.py:212:13: Argument `dev` does not match any known parameter of function `__new__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/version.py:213:13: Argument `local` does not match any known parameter of function `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/src/packaging/specifiers.py:804:21: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/src/packaging/specifiers.py:804:21: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/src/packaging/specifiers.py:808:21: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/src/packaging/specifiers.py:808:21: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/src/packaging/specifiers.py:844:21: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/src/packaging/specifiers.py:844:21: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_parser.py:83:36: Too many positional arguments to function `__new__`: expected 1, got 5
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:40:9: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:40:9: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:88:13: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:88:13: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:205:13: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:205:13: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:223:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:223:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:230:21: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:230:21: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:230:51: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:230:51: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:246:19: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:246:19: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:246:36: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:246:36: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:247:25: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:247:25: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:248:19: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:248:19: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:252:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:252:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:252:35: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:252:35: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:253:24: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:253:24: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:254:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:254:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:270:23: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:270:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:270:40: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:270:40: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:271:29: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:271:29: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:272:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:272:23: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:275:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:275:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:276:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:276:20: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:277:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:277:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:278:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:278:20: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:478:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:478:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:508:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:508:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:537:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:537:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:550:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:550:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:575:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:575:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:598:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:598:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:617:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:617:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:624:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:624:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:638:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:638:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:643:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:643:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:643:41: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:643:41: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:646:21: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:646:21: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:646:52: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:646:52: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:652:16: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:652:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:661:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:661:18: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:662:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:662:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:666:16: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:666:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:675:16: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:675:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:684:16: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:684:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:694:16: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:694:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:699:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:699:16: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:705:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:705:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:709:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:709:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:738:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:738:20: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:740:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:740:20: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:765:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:765:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:772:21: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:772:21: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:772:54: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:772:54: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:778:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:778:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:778:39: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:778:39: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:779:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:779:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:781:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:781:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:782:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:782:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:784:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:784:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:784:57: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:784:57: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:785:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:785:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:788:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:788:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:788:58: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:788:58: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:789:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:789:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:792:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:792:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:792:39: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:792:39: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:793:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:793:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:796:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:796:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:796:39: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:796:39: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:797:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:797:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:800:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:800:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:800:57: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:800:57: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:803:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:803:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:806:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:806:18: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:806:58: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:806:58: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:809:26: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:809:26: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:813:22: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:813:22: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:813:61: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:813:61: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:818:22: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:818:22: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:818:62: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:818:62: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:824:13: No arguments provided for required parameters `bases`, `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:824:13: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:840:19: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:840:19: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:840:39: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:840:39: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:841:19: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:841:19: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:841:39: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:841:39: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:842:19: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:842:19: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:842:36: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:842:36: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:843:25: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:843:25: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:844:19: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:844:19: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:860:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:860:23: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:860:43: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:860:43: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:861:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:861:23: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:861:43: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:861:43: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:862:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:862:23: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:862:40: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:862:40: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:863:29: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:863:29: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:864:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:864:23: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:868:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:868:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:868:38: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:868:38: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:869:24: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:869:24: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:870:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:870:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:873:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:873:16: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:874:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:874:20: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:888:37: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:888:37: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:891:23: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:891:23: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:891:50: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_specifiers.py:891:50: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/src/packaging/markers.py:179:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/src/packaging/markers.py:179:16: Object of type `Literal[Specifier]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_musllinux.py:38:38: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_musllinux.py:39:37: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_musllinux.py:40:40: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_musllinux.py:55:55: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_musllinux.py:56:52: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_musllinux.py:57:58: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/src/packaging/requirements.py:43:40: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/src/packaging/requirements.py:43:40: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/_musllinux.py:30:25: Argument `major` does not match any known parameter of function `__new__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/packaging/src/packaging/_musllinux.py:30:48: Argument `minor` does not match any known parameter of function `__new__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tasks/licenses.py:51:10: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tasks/licenses.py:51:10: Object of type `Literal[closing]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/src/packaging/metadata.py:629:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/src/packaging/metadata.py:629:20: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_metadata.py:530:20: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/packaging/tests/test_metadata.py:530:20: Object of type `Literal[SpecifierSet]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:195:36: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:198:36: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:201:36: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:231:39: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:234:43: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:245:58: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/src/packaging/_manylinux.py:254:64: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:89:16: No arguments provided for required parameters `interpreter`, `abi`, `platform` of bound method `__init__`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:89:35: No arguments provided for required parameters `interpreter`, `abi`, `platform` of bound method `__init__`
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:493:72: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:563:72: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:642:50: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:643:51: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:644:46: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:645:48: Too many positional arguments to function `__new__`: expected 1, got 2
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/packaging/tests/test_tags.py:682:72: Too many positional arguments to function `__new__`: expected 1, got 2
- Found 95 diagnostics
+ Found 349 diagnostics

pyinstrument (https://github.com/joerick/pyinstrument)
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/speedscope.py:169:34: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/speedscope.py:176:38: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/speedscope.py:204:39: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/speedscope.py:216:31: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/speedscope.py:225:42: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/pyinstrument/test/test_processors.py:336:9: Object of type `Session` cannot be assigned to parameter `context` of bound method `__init__`; expected type `FrameContext | None`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/base.py:97:22: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/base.py:97:22: Object of type `Literal[suppress]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/base.py:102:18: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/pyinstrument/pyinstrument/renderers/base.py:102:18: Object of type `Literal[suppress]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:136:17: Object of type `&lt;bound method `long_method` of `ClassWithMethods`&gt;` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:247:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:252:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:257:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:262:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:267:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:272:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:277:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:282:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:287:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
+ error[lint:too-many-positional-arguments] /tmp/mypy_primer/projects/pyinstrument/test/test_profiler.py:292:13: Too many positional arguments to bound method `__init__`: expected 0, got 3
- Found 272 diagnostics
+ Found 293 diagnostics

bidict (https://github.com/jab/bidict)
+ error[lint:missing-argument] /tmp/mypy_primer/projects/bidict/bidict/__init__.py:96:10: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/bidict/bidict/__init__.py:96:10: Object of type `Literal[suppress]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/bidict/bidict/_orderedbidict.py:100:16: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/bidict/bidict/_orderedbidict.py:100:16: Object of type `Literal[_OrderedBidictKeysView]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/bidict/tests/microbenchmarks.py:25:26: Object of type `Literal[deque]` cannot be assigned to parameter 2 (`func`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/bidict/tests/test_bidict.py:88:25: Object of type `Literal[OnDup]` cannot be assigned to parameter 2 (`function`) of function `__new__`; expected type `(...) -&gt; Unknown | @Todo(Support for `typing.TypeVar` instances in type expressions)`
+ error[lint:missing-argument] /tmp/mypy_primer/projects/bidict/bidict/_base.py:253:53: No argument provided for required parameter `namespace` of bound method `__new__`
+ error[lint:invalid-argument-type] /tmp/mypy_primer/projects/bidict/bidict/_base.py:253:53: Object of type `Literal[BidictKeysView]` cannot be assigned to parameter 2 (`name`) of bound method `__new__`; expected type `str`
- Found 79 diagnostics
+ Found 87 diagnostics

mypy_primer (https://github.com/hauntsaninja/mypy_primer)
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:76:13: Argument `location` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:77:13: Argument `mypy_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:78:13: Argument `pyright_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:79:13: Argument `deps` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:80:13: Argument `expected_mypy_success` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:81:13: Argument `cost` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:84:13: Argument `location` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:85:13: Argument `mypy_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:86:13: Argument `pyright_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:87:13: Argument `expected_mypy_success` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:90:13: Argument `location` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:91:13: Argument `mypy_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:92:13: Argument `pyright_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:93:13: Argument `deps` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:94:13: Argument `expected_mypy_success` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:97:13: Argument `location` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:98:13: Argument `mypy_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:99:13: Argument `pyright_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:100:13: Argument `expected_mypy_success` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:103:13: Argument `location` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:104:13: Argument `mypy_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:105:13: Argument `pyright_cmd` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:106:13: Argument `deps` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_primer/projects/mypy_primer/mypy_primer/projects.py:107:13: Argument `expected_mypy_success` does not match any known parameter of bound method `__init__`
+ error[lint:unknown-argument] /tmp/mypy_prim...*[Comment body truncated]*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:66 on 2025-03-11 09:31</div>
            <div class="timeline-body"><blockquote>
<p><code>__new__</code> should be treated as a classmethod</p>
</blockquote>
<p>I think it's technically a static method that just happens to take <code>cls</code> as a first argument (<a href="https://docs.python.org/3.8/reference/datamodel.html#object.__new__">ref</a>).</p>
<blockquote>
<p>looked up on the class itself (not meta class)</p>
</blockquote>
<p>I am not sure that is true? <code>__new__</code> seems to be <a href="https://github.com/python/cpython/blob/69309a55bcb5381a9a218edc910da135f4d67479/Objects/typeobject.c#L10329">looked up using <code>PyObject_GetAttr</code></a> on the class object in <code>slot_tp_new</code>, which invokes the descriptor protocol <em>for class objects</em> just as usual.</p>
<blockquote>
<p>Currently, it would search <code>__new__</code> on meta-type, always find <code>type.__new__</code> (defined in typeshed)</p>
</blockquote>
<p>Yes, this is as expected. It <em>should</em> find <code>__new__</code> on the meta class. But note that this doesn't mean that it takes precedence. It would only take precedence if it were a <em>data</em> descriptor (i.e. if it had a <code>__set__</code> or <code>__delete__</code> method).</p>
<p>Since <code>type.__new__</code> is not a data descriptor, it should fall back to <code>__new__</code> on the class itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-11 09:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-11 11:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:66 on 2025-03-11 11:49</div>
            <div class="timeline-body"><p>thanks for digging into CPYthon source code, that’s definitely easier than reverse-engineering the behavior. It was well past 1am yesterday when I was testing this, and I only managed to muster strength to run some code tests ;-)</p>
<p>anyways, as mypy_prymer results shows, as well mdtest, it doesn’t look like descriptor protocol behaves here as expected. It seems to select up <code>type.__new__</code> for one reason or another… I’ll continue tracing why.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-11 16:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:66 on 2025-03-11 16:11</div>
            <div class="timeline-body"><blockquote>
<p>It seems to select up <code>type.__new__</code> for one reason or another… I’ll continue tracing why.</p>
</blockquote>
<p>One thing that might be required is to special case <code>type.__new__</code> for the moment. We do not understand overloads yet, so if we generate a <code>@Todo</code> type for <code>type.__new__</code>, we may end up thinking that it is a data descriptor (because a dynamic type has every attribute, and so it also has a <code>__set__</code> attribute), and call that instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-11 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2709 on 2025-03-11 16:23</div>
            <div class="timeline-body"><p>Don't we need to call <code>__new__</code> with <code>&amp;CallArguments::positional([self])</code>? I would expect that we can always call <code>__new__</code> using <code>self.try_call_dunder(db, &quot;__new__&quot;, &amp;CallArguments::positional([self])</code>, but then we probably need some special casing for <code>object.__new__</code>, because we don't understand <code>Self</code> yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-13 02:39</div>
            <div class="timeline-body"><p>if someone will land here wondering if something is happening - it does. After rebasing on the new main I started getting a lot of errors which I still can't understand. WIP</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-14 02:20</div>
            <div class="timeline-body"><p>Oook, I've fixed it. I am not super happy with the code, there are ugly corners everywhere. E.g. I had to inline partial <code>try_call_dunder</code> -&gt; <code>member_lookup_with_policy</code> call chain to handle the special way <code>__new__</code> have to be handled. But hey, it works.</p>
<p>Also, some of the ugliness will go away with astral-sh/ruff#16716</p>
<p>@carljm @sharkdp &amp; @dcreager would be cool if you'll check this out.</p>
<p>I am really really out and not planning on carrying laptop with me, so I won't be able to fix comments until Monday, Mar 24th. I will be able to comment though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @mishamsk on 2025-03-14 02:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @mishamsk on 2025-03-14 02:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-03-14 02:22</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/mishamsk%3Aadd-class-init-argument-checks">CodSpeed Performance Report</a></h2>
<h3>Merging astral-sh/ruff#16512 will <strong>degrade performances by 6.48%</strong></h3>
<p><sub>Comparing <code>mishamsk:add-class-init-argument-checks</code> (580d723) with <code>main</code> (b662c3f)</sub></p>
<h3>Summary</h3>
<p><code>❌ 2</code> regressions<br />
<code>✅ 30</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/mishamsk%3Aadd-class-init-argument-checks">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>red_knot_check_file[cold]</code> | 92.8 ms | 97.1 ms | -4.44% |
| ❌ | <code>red_knot_check_file[incremental]</code> | 5 ms | 5.3 ms | -6.48% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2865 on 2025-03-14 07:36</div>
            <div class="timeline-body"><p>Can you explain what the reason is that <code>from_overloads</code> is in a salsa query? Is there a performance benefit or is it to avoid the salsa cycle?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-14 07:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-03-14 09:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2865 on 2025-03-14 09:16</div>
            <div class="timeline-body"><p>Great question! I was focused on making this all work yesterday, so I just copied from other KnownClasses arms above that @dcreager created. I saw it was a query, but I didn't give it much thought. I just assumed this has some perf benefit. I will have to look into perf regressions anyway, and will make sure to check if there is any real point to do so. Probably not</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2865 on 2025-03-14 09:25</div>
            <div class="timeline-body"><p>Thanks for explaining. I noticed when reviewing @dcreager's https://github.com/astral-sh/ruff/pull/16716 PR that he moved the query to a different method and I left a comment there. I think we can ignore this concern for this PR and come to a conclusion on https://github.com/astral-sh/ruff/pull/16716</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-14 09:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-14 14:06</div>
            <div class="timeline-body"><blockquote>
<p>E.g. I had to inline partial <code>try_call_dunder</code> -&gt; <code>member_lookup_with_policy</code> call chain to handle the special way <code>__new__</code> have to be handled.</p>
</blockquote>
<p>If you are talking about skipping lookup of symbols on <code>object</code>, I think we'll need something similar for https://github.com/astral-sh/ruff/pull/16748</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-14 14:26</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>E.g. I had to inline partial <code>try_call_dunder</code> -&gt; <code>member_lookup_with_policy</code> call chain to handle the special way <code>__new__</code> have to be handled.</p>
</blockquote>
<p>If you are talking about skipping lookup of symbols on <code>object</code>, I think we'll need something similar for https://github.com/astral-sh/ruff/pull/16748</p>
</blockquote>
<p>Yes. That was the primary reason, I decided against threading the flag through all API. But if it's a common need we might as well do it.</p>
<p>The other is more performance related. When calling from the specific Type variant, we kinda already know which path we should take, so all the matches inside those general API's are pure overhead. But I would vote for convenience and shared API in this case. If try_call_dunder will support this use case, then we should definitely use it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:19 on 2025-03-14 23:57</div>
            <div class="timeline-body"><p>We should also add some tests for cases where <code>__new__</code> and <code>__init__</code> are both defined. We need to check the provided constructor args against both, because things like this are allowed:</p>
<pre><code class="language-py">class C:
    def __new__(cls, *args, **kwargs):
        return object.__new__(cls)
    def __init__(self, x, y):
        self.x = x
        self.y = y
</code></pre>
<p>That is, it's permissible for them to have different signatures, as long as the arguments given work with both signatures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:104 on 2025-03-14 23:58</div>
            <div class="timeline-body"><p>Should also test here what happens when two integer arguments are provided</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:83 on 2025-03-15 00:00</div>
            <div class="timeline-body"><p>Not much point in having this in an mdtest?</p>
<pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:216 on 2025-03-15 00:03</div>
            <div class="timeline-body"><p>Same as above, test with two int args provided</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/subclass_of.md</code>:27 on 2025-03-15 00:03</div>
            <div class="timeline-body"><p>🎉</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/class.rs</code>:97 on 2025-03-15 00:05</div>
            <div class="timeline-body"><p>nit: <code>object</code> isn't really a &quot;fallback&quot;, it's just part of the MRO. So I would probably name these <code>ExcludeObject</code> and <code>Default</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/class.rs</code>:429 on 2025-03-15 00:09</div>
            <div class="timeline-body"><p>It seems like we don't have any tests that fail if we remove the <code>!self.is_known(db, KnownClass::Object)</code> check? (That is, tests directly looking up an attribute on <code>object</code>.)</p>
<p>Hmm, you do have an <code>object.__new__(cls)</code> in the tests you added; why doesn't that fail?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:5596 on 2025-03-15 00:10</div>
            <div class="timeline-body"><p>This should use <code>try_call_dunder_get</code> instead -- can we add a TODO for that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2851 on 2025-03-15 00:12</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            // TODO: currently we can't use typeshed to infer calls using generic
            // logic below due to a salsa query cycle. When this is fixed, we should
            // remove this arm and avoid special casing `TypeVar`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2914 on 2025-03-15 00:13</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            // TODO: currently we can't use typeshed to infer calls using generic
            // logic below due to a salsa query cycle. When this is fixed, we should
            // remove this arm and aboid special casing `Object`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2950 on 2025-03-15 00:18</div>
            <div class="timeline-body"><p>I realized this isn't right, as mentioned in a comment above. We can't really check <code>__init__</code> vs <code>__new__</code> compat at class definition, because they are allowed to differ; the effective constructor signature is the intersection of the two (whatever calls satisfy both signatures.)</p>
<p>I think if <code>__new__</code> exists and binding to it fails, it's fine to stop there. If you have a similar <code>__new__</code> and <code>__init__</code> signature, and you just pass the wrong arguments, we don't want two diagnostics about it. But if <code>__new__</code> exists and binding to it succeeds, we need to go ahead and try <code>__init__</code> as well and make sure that succeeds too.</p>
<p>Sorry I led you in the wrong direction here earlier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-03-15 00:20</div>
            <div class="timeline-body"><p>This is looking really good! Still a few things to address, and I apologize in advance for the rebase on top of https://github.com/astral-sh/ruff/pull/16716, but the tests and the general approach should still translate fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-03-24 12:23</div>
            <div class="timeline-body"><p>@carljm just a quick heads up - I am back and plan on getting back to this ASAP</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @mishamsk on 2025-04-06 05:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-04-06 20:32</div>
            <div class="timeline-body"><p>@carljm @sharkdp it is ready! I've addressed and closed all old discussions. I had to add more special cases, like <code>type.GenericAlias.__getattr__</code> handling, but hope this is good to be merged.</p>
<p>Pretty sure it will yield performance regression, but that should be expected. On the flip side, I think most of the manual signatures for known classes can be removed, which would also avoid the need to <code>Bindings.evaluate_known_cases</code> that @dcreager mentioned</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:5596 on 2025-04-07 10:39</div>
            <div class="timeline-body"><p>we already have an issue open for it here FWIW https://github.com/astral-sh/ruff/issues/16371</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-04-07 10:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-04-07 14:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:5596 on 2025-04-07 14:07</div>
            <div class="timeline-body"><p>@AlexWaygood actually a great point. In my last commit I've added yet another place where I manually pull a symbol for <code>__new__</code> and do almost, but not exactly what <code>try_call_dunder</code> does. The reason being that I need to apply my new policy (avoid object &amp; type during lookup) which is not part of <code>try_call_dunder</code> API.</p>
<p>I think #16731 should be done after this PR is merged, and <code>try_call_dunder</code> should take in the new policy flags struct as input, then all calls can use the single API and avoid unnecessary &quot;just check if exists&quot; symbol lookups before that</p>
<p>@sharkdp FYI 👆</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:2601 on 2025-04-07 18:54</div>
            <div class="timeline-body"><p>This doesn't seem necessary; all tests pass without it. It seems to me it shouldn't be necessary unless we have a bug somewhere else; we shouldn't look up <code>__mro__</code> with this flag in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:3230 on 2025-04-07 18:59</div>
            <div class="timeline-body"><p>This is no longer needed on current main, with fixpoint iteration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:3265 on 2025-04-07 19:03</div>
            <div class="timeline-body"><p>This is no longer needed to avoid a cycle, so I'll remove this comment. There is a test that fails without it, and I think this is a reasonable one to special-case rather than relying on fixpoint iteration, so I'll leave the arm here for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:3639 on 2025-04-07 20:05</div>
            <div class="timeline-body"><p>This bit about <code>type.__new__</code> is interesting. I wonder if an alternative approach here could be to not skip <code>object.__new__</code> but instead mark it in a way that makes it easy to check if that's the one we found. Then we wouldn't have the side effect of unhiding <code>type.__new__</code>, meaning we need two lookup flags.</p>
<p>Not going to look into that now, but might add a comment about it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-04-07 21:04</div>
            <div class="timeline-body"><p>Looks great, thank you for all your work on this!</p>
<p>I've pushed some changes. The most significant one is to add <code>find_name_in_mro_with_policy</code> and <code>class_member_with_policy</code>, to mirror the existing <code>member_lookup_with_policy</code>, and have the <code>find_name_in_mro</code> and <code>class_member</code> methods be thin wrappers that just use the default policy. This arguably makes writing internal Type code a bit more error-prone, as it means we can more easily accidentally drop a policy we should have propagated. But I think it's worth it because it removes so much <code>MemberLookupPolicy::default()</code> noise all over the place.</p>
<p>Since I've made significant changes, I won't merge this right away but will leave it overnight in case you or anyone else has comments on the changes I've made; otherwise I'll merge it first thing in the morning my time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-04-07 21:07</div>
            <div class="timeline-body"><p>Actually I might try a few things to see if we can bring down the perf regression before merging this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-04-07 21:28</div>
            <div class="timeline-body"><p>Looking at the mypy-primer results, there are a lot of new false positives related to dataclass <code>__init__</code> methods, as expected.</p>
<p>Some other false positives appear to be because we lack handling of assignability/subtyping of a class literal or subclass-of type to a <code>Callable</code> type. I think the proper handling here (barring metaclass <code>__call__</code> handling) would consider the class to be an intersection of its <code>__init__</code> and <code>__new__</code> signatures. But we could also do a temporary version that just uses the current <code>Type::signatures()</code> implementation as forgiving gradual callable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-04-07 22:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:3265 on 2025-04-07 22:04</div>
            <div class="timeline-body"><p>LGTM. especially since it doesn't have a corresponding code in <code>bind</code>, so not as painful as other cases which must be kept in sync with a completely different module</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-04-07 22:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:3230 on 2025-04-07 22:08</div>
            <div class="timeline-body"><p>awesome. I think it was still failing when I added it, but great that it is already unnecessary</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-04-07 22:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:3639 on 2025-04-07 22:12</div>
            <div class="timeline-body"><p>Thanks for the idea. I'll look into it when I do a follow up for <code>__call__</code> handling. Or it may retackled separately in <code>try_call_dunder</code> unification #16371 - because this essentially about trying to create a unified API that everyone can call without too much thinking how the lookups should behave.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-04-07 22:14</div>
            <div class="timeline-body"><blockquote>
<p>Some other false positives appear to be because we lack handling of assignability/subtyping of a class literal or subclass-of type to a Callable type. I think the proper handling here (barring metaclass <strong>call</strong> handling) would consider the class to be an intersection of its <strong>init</strong> and <strong>new</strong> signatures. But we could also do a temporary version that just uses the current Type::signatures() implementation as forgiving gradual callable.</p>
</blockquote>
<p>sounds like another follow-up candidate to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/constructor.md</code>:13 on 2025-04-08 07:06</div>
            <div class="timeline-body"><p>Minor nitpick:</p>
<pre><code class="language-suggestion">`__init__` has no special handling, it is fetched as bound method and is called just like any other
dunder method.
</code></pre>
<p>(Normal methods would also be looked up on the instance dictionary)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3983 on 2025-04-08 07:26</div>
            <div class="timeline-body"><p>It feels to me like some of this logic here should ideally be moved to <code>types.rs</code>? I think it's slightly unfortunate that we list special cases here in <code>infer.rs</code>. But even if we agree on this, I don't see any reason to block this PR because of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2025-04-08 07:27</div>
            <div class="timeline-body"><p>This is really great, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mishamsk">@mishamsk</a> reviewed on 2025-04-08 11:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mishamsk">@mishamsk</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3983 on 2025-04-08 11:37</div>
            <div class="timeline-body"><p>Absolutely. Car left a similar comment but in a different place, that the entire class/subclass call logic with all special cases can/should be incapsulated in the new <code>try..</code> call. I plan on doing follow-ups and will try to remember to apply the change. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @carljm on 2025-04-08 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-04-08 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-09 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mishamsk">@mishamsk</a> on 2025-04-09 01:09</div>
            <div class="timeline-body"><p>thanks everyone for patiently waiting on this one! 🚀</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-04-09 01:48</div>
            <div class="timeline-body"><p>Thanks for the PR!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:57:29 UTC
    </footer>
</body>
</html>
