<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stabilize quote-style `preserve` - astral-sh/ruff #9922</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Stabilize quote-style <code>preserve</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9922">#9922</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-02-10 06:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>This PR removes the <code>--preview</code> requirement for <code>quote-style: preserve</code> and changes the semantics of
the style to apply to all strings (including triple quoted and doc-strings).</p>
<p>The motivation for changing the semantic to apply to all strings is:</p>
<ul>
<li>The option is intended as a replacement for black's <code>--skip-string-normalization</code> that applies to all strings</li>
<li>The option is intended for projects that can't enforce a consistent quote style. These are mainly projects that want to use a formatter but can't agree on a single quote style or changing all strings leads to too large diffs. Allowing these users to use a formatter is more important than being opinionated on the quote style</li>
<li>We received reports that users were surprised that <code>preserve</code> didn't apply to all strings.</li>
</ul>
<p>Fixes https://github.com/astral-sh/ruff/issues/9185</p>
<h2>Test Plan</h2>
<p><code>cargo test</code>. Reviewed the snapshot changes. Tested the CLI that using <code>quote-style: preserve</code> without the preview flag no longer aborts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2024-02-10 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2024-02-10 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @MichaReiser on 2024-02-10 06:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-10 06:47</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-10 15:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:2968 on 2024-02-10 15:16</div>
            <div class="timeline-body"><p>I'd probably omit this last sentence (it's implied in the previous sentences that this is intended for existing projects). (If it stays, &quot;project&quot; should be &quot;projects&quot;.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-10 15:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-10 15:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_workspace/src/options.rs</code>:2951 on 2024-02-10 15:20</div>
            <div class="timeline-body"><p>&quot;regardless of the configured quote style&quot; has the potential to confuse since it's no longer true of <code>preserve</code>, maybe... &quot;regardless of whether <code>single</code> or <code>double</code> is selected.&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-10 15:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2024-02-12 00:29</div>
            <div class="timeline-body"><p>is this PR is going to merge for next patch release?
it is unknown in versioning policy how config options changes should be applied.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-12 08:30</div>
            <div class="timeline-body"><blockquote>
<p>is this PR is going to merge for next patch release? it is unknown in versioning policy how config options changes should be applied.</p>
</blockquote>
<p>Yes, this will ship as part of the next patch release. Changing the semantic is is in line with our versioning policy because <code>quote-style: preserve</code> is in preview:</p>
<blockquote>
<p>The preview mode is not intended to gate access to work that is incomplete or features that we are likely to remove. However, we reserve the right to make changes to any behavior gated by the mode including the removal of preview features or rules. <a href="https://docs.astral.sh/ruff/versioning/#preview-mode">source</a></p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-02-12 09:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-12 09:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-12 09:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:02:44 UTC
    </footer>
</body>
</html>
