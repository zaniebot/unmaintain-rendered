<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement `PLR0133` (`ComparisonOfConstants`) - astral-sh/ruff #1841</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement <code>PLR0133</code> (<code>ComparisonOfConstants</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1841">#1841</a>
        opened by <a href="https://github.com/max0x53">@max0x53</a>
        on 2023-01-13 01:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/max0x53">@max0x53</a></div>
            <div class="timeline-body"><p>This PR adds <a href="https://pylint.pycqa.org/en/latest/user_guide/messages/refactor/comparison-of-constants.html">Pylint <code>R0133</code></a></p>
<p>Feel free to suggest changes and additions, I have tried to maintain parity with the Pylint implementation <a href="https://github.com/PyCQA/pylint/blob/main/pylint/checkers/base/comparison_checker.py#L247"><code>comparison_checker.py</code></a></p>
<p><code>pylint</code> output:</p>
<pre><code class="language-bash">$ pylint  ../ruff/resources/test/fixtures/pylint/constant_comparison.py | grep R0133
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:3:3: R0133: Comparison between constants: '100 == 100' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:6:3: R0133: Comparison between constants: '1 == 3' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:9:3: R0133: Comparison between constants: '1 != 3' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:13:3: R0133: Comparison between constants: '4 == 3' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:23:3: R0133: Comparison between constants: '1 &gt; 0' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:29:3: R0133: Comparison between constants: '1 &gt;= 0' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:35:3: R0133: Comparison between constants: '1 &lt; 0' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:41:3: R0133: Comparison between constants: '1 &lt;= 0' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:51:3: R0133: Comparison between constants: 'hello == ' has a constant value (comparison-of-constants)
&lt;PATH&gt;/ruff/resources/test/fixtures/pylint/constant_comparison.py:58:3: R0133: Comparison between constants: 'True == False' has a constant value (comparison-of-constants)
</code></pre>
<p><code>ruff</code> output:</p>
<pre><code class="language-bash">resources/test/fixtures/pylint/constant_comparison.py:3:4: PLR0133 Two constants compared in a comparison, consider replacing `100 == 100`
resources/test/fixtures/pylint/constant_comparison.py:6:4: PLR0133 Two constants compared in a comparison, consider replacing `1 == 3`
resources/test/fixtures/pylint/constant_comparison.py:9:4: PLR0133 Two constants compared in a comparison, consider replacing `1 != 3`
resources/test/fixtures/pylint/constant_comparison.py:13:4: PLR0133 Two constants compared in a comparison, consider replacing `4 == 3`
resources/test/fixtures/pylint/constant_comparison.py:23:4: PLR0133 Two constants compared in a comparison, consider replacing `1 &gt; 0`
resources/test/fixtures/pylint/constant_comparison.py:29:4: PLR0133 Two constants compared in a comparison, consider replacing `1 &gt;= 0`
resources/test/fixtures/pylint/constant_comparison.py:35:4: PLR0133 Two constants compared in a comparison, consider replacing `1 &lt; 0`
resources/test/fixtures/pylint/constant_comparison.py:41:4: PLR0133 Two constants compared in a comparison, consider replacing `1 &lt;= 0`
resources/test/fixtures/pylint/constant_comparison.py:51:4: PLR0133 Two constants compared in a comparison, consider replacing `'hello' == ''`
resources/test/fixtures/pylint/constant_comparison.py:58:4: PLR0133 Two constants compared in a comparison, consider replacing `True == False`
</code></pre>
<p>I have separated the change into 2 commits, the first commit combines the EqComp and IsComp wrappers within <code>violations.rs</code> into a single wrapper. Otherwise I would have to have had added a 3rd wrapper to handle this case which is in the 2nd commit.</p>
<p>See #970</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:823 on 2023-01-13 06:24</div>
            <div class="timeline-body"><p>I think you should rather implement a 3rd wrapper. I think merging enums like this is a bad idea because it looses compile-time safety, as evidenced by the <code>unreachable!()</code> statements that you had to add. Potential runtime panics are bad and it's better if the compiler can check that the match blocks cover all cases.</p>
<p>Furthermore we want to split up this file in the future (moving the struct definitions to the respective rule files) which also is easier if we don't artificially merge unrelated enums.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-13 06:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/max0x53">@max0x53</a> reviewed on 2023-01-13 10:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/max0x53">@max0x53</a> on <code>src/violations.rs</code>:823 on 2023-01-13 10:24</div>
            <div class="timeline-body"><p>Updated to be a 3rd wrapper, I was coming at the problem from the point of view of side stepping the <code>Serialize + Deserialize + Eq</code> requirements that are not found on <code>Cmpop</code>. However, as you point out the wrappers are also used for type safety in other cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-13 11:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:1210 on 2023-01-13 11:02</div>
            <div class="timeline-body"><p>I know that most violation structs currently use tuple structs but we actually want to change all these to field structs in the future whenever the types don't clearly identify the purpose of the field. So in this case I think the following would be preferable:</p>
<pre><code class="language-rs">pub struct ConstantComparison {
    pub left_const: String,
    pub op: ViolationsCmpop,
    pub right_const: String,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-13 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-13 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/violations.rs</code>:1226 on 2023-01-13 17:17</div>
            <div class="timeline-body"><p>If you're interested, this is autofixable. You could look at <code>impl AlwaysAutofixableViolation for IsLiteral</code> for an example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-13 17:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-01-13 19:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:31 UTC
    </footer>
</body>
</html>
