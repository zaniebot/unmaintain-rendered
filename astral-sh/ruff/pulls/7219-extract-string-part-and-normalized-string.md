```yaml
number: 7219
title: Extract string part and normalized string
type: pull_request
state: merged
author: MichaReiser
labels:
  - internal
  - formatter
assignees: []
merged: true
base: main
head: extract-string-part
created_at: 2023-09-07T11:57:59Z
updated_at: 2023-09-21T10:38:48Z
url: https://github.com/astral-sh/ruff/pull/7219
synced_at: 2026-01-12T02:39:09Z
```

# Extract string part and normalized string

---

_Pull request opened by @MichaReiser on 2023-09-07 11:57_

## Summary

This is a small refactor that extracts a `NormalizedString` data structure rather than just doing normalization during formatting. 

Having a dedicated data structure that caches the normalized strings is important for implementing Black's preview style string formatting where it is necessary
to format the normalized string multiple times:

1. Join all parts together
2. Using the same separation as in the source
3. Try to fit as many words as possible 


## Test Plan

`cargo test`


---

_Comment by @MichaReiser on 2023-09-07 11:58_

Current dependencies on/for this PR:
* main
  * **PR #7145** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7145" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7193** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7193" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #7215** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7215" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #7217** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7217" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
          * **PR #7219** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7219" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
            * **PR #7242** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7242" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
              * **PR #7567** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7567" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7219?utm_source=stack-comment).

---

_Label `internal` added by @MichaReiser on 2023-09-07 11:58_

---

_Label `formatter` added by @MichaReiser on 2023-09-07 11:58_

---

_Review requested from @konstin by @MichaReiser on 2023-09-08 06:39_

---

_@konstin approved on 2023-09-08 08:56_

---

_Merged by @MichaReiser on 2023-09-08 10:56_

---

_Closed by @MichaReiser on 2023-09-08 10:56_

---

_Branch deleted on 2023-09-08 10:56_

---
