<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Support `typing.TypeAliasType` - astral-sh/ruff #18156</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Support <code>typing.TypeAliasType</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18156">#18156</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-05-17 20:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>Support direct uses of <code>typing.TypeAliasType</code>, as in:</p>
<pre><code>from typing import TypeAliasType

IntOrStr = TypeAliasType(&quot;IntOrStr&quot;, int | str)

def f(x: IntOrStr) -&gt; None:
    reveal_type(x)  # revealed: int | str
</code></pre>
<p>closes <a href="https://github.com/astral-sh/ty/issues/392">astral-sh/ty#392</a></p>
Ecosystem
<p>The new false positive here:</p>
<pre><code>+ error[invalid-type-form] altair/utils/core.py:49:53: The first argument to `Callable` must be either a list of types, ParamSpec, Concatenate, or `...`
</code></pre>
<p>comes from the fact that we infer the second argument as a type expression now. We silence false positives for PEP695 <code>ParamSpec</code>s, but not for <code>P = ParamSpec(&quot;P&quot;)</code> inside <code>Callable[P, ...]</code>.</p>
Test Plan
<p>New Markdown tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-17 20:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-17 20:14</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>altair (https://github.com/vega/altair)
+ error[invalid-type-form] altair/utils/core.py:49:53: The first argument to `Callable` must be either a list of types, ParamSpec, Concatenate, or `...`
- error[invalid-argument-type] altair/utils/core.py:48:58: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[typing.TypeVar]`
- error[invalid-argument-type] altair/utils/core.py:49:60: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[ParamSpec, typing.TypeVar]`
- error[invalid-argument-type] altair/utils/core.py:53:56: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[typing.TypeVar, typing.TypeVar]`
- error[invalid-argument-type] altair/utils/core.py:56:54: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[typing.TypeVar, ParamSpec, typing.TypeVar]`
- error[invalid-argument-type] altair/utils/plugin_registry.py:25:52: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[typing.TypeVar]`
- error[invalid-argument-type] altair/utils/schemapi.py:903:56: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[typing.TypeVar]`
- error[invalid-argument-type] altair/vegalite/v5/schema/_typing.py:105:61: Argument to bound method `__init__` is incorrect: Expected `tuple[TypeVar | ParamSpec | TypeVarTuple, ...]`, found `tuple[typing.TypeVar]`
- error[invalid-context-manager] tests/vegalite/v5/test_api.py:1409:10: Object of type `Unknown | PluginEnabler[@Todo(unknown type subscript), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
+ error[invalid-context-manager] tests/vegalite/v5/test_api.py:1409:10: Object of type `Unknown | PluginEnabler[@Todo(Generic PEP-695 type alias), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
- error[invalid-context-manager] tests/vegalite/v5/test_api.py:1414:10: Object of type `Unknown | PluginEnabler[@Todo(unknown type subscript), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
+ error[invalid-context-manager] tests/vegalite/v5/test_api.py:1414:10: Object of type `Unknown | PluginEnabler[@Todo(Generic PEP-695 type alias), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
- error[invalid-context-manager] tests/vegalite/v5/test_api.py:1420:10: Object of type `Unknown | PluginEnabler[@Todo(unknown type subscript), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
+ error[invalid-context-manager] tests/vegalite/v5/test_api.py:1420:10: Object of type `Unknown | PluginEnabler[@Todo(Generic PEP-695 type alias), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
- error[invalid-context-manager] tests/vegalite/v5/test_theme.py:48:14: Object of type `Unknown | PluginEnabler[@Todo(unknown type subscript), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
+ error[invalid-context-manager] tests/vegalite/v5/test_theme.py:48:14: Object of type `Unknown | PluginEnabler[@Todo(Generic PEP-695 type alias), ThemeConfig]` cannot be used with `with` because it does not correctly implement `__exit__`
- Found 1349 diagnostics
+ Found 1343 diagnostics

</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:7558 on 2025-05-17 20:16</div>
            <div class="timeline-body"><p>This is used for go-to-type-definition. It seems more involved to provide the original definition here, as we would need to keep track of it through various <code>Type</code> operations and the calling machinery.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-05-17 20:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-17 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-05-17 20:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_project/tests/check.rs</code>:300 on 2025-05-17 20:39</div>
            <div class="timeline-body"><p>This is unfortunate, but that file could just as easily have been written using PEP 695 type aliases …</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-17 21:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:7537 on 2025-05-17 21:09</div>
            <div class="timeline-body"><p>nit: I think <code>ast::name::Name</code> would probably be slightly more efficient, as <code>Name</code> wraps a <code>CompactString</code>, and the names of type aliases are likely to nearly always be pretty small strings</p>
<pre><code>    pub name: ast::name::Name,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:923 on 2025-05-18 14:07</div>
            <div class="timeline-body"><p>If you move this construction logic into <code>infer.rs</code>, like we do for legacy typevars, you&#x27;ll be able to get the <code>Definition</code> of the assignment statement, at least for the case where a call to the <code>TypeAliasType</code> constructor is being immediately assigned to a variable. That will let you return a non-<code>None</code> result for <code>definition</code> up above for bare type aliases too.</p>
<p>https://github.com/astral-sh/ruff/blob/dd04ca7f5885b7bc96303dbb5ce7635a039d2f93/crates/ty_python_semantic/src/types/infer.rs#L5197-L5199</p>
<p>(Moving the construction logic also made it easier to emit diagnostics for legacy typevar construction, which might help you discharge the TODO comment)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-05-18 14:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-05-19 07:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:923 on 2025-05-19 07:39</div>
            <div class="timeline-body"><p>Thank you — I didn&#x27;t realize we had call-related code in <code>infer.rs</code>, too. That was really helpful. TODO comment is also resolved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-05-19 07:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/diagnostic.rs</code>:607 on 2025-05-19 07:41</div>
            <div class="timeline-body"><p>I wasn&#x27;t sure if we should have the same strict requirements here as for legacy <code>TypeVar</code> constructions. I couldn&#x27;t find anything in the spec, but pyright also emits diagnostics, if a <code>TypeAliasType</code> is not immediately assigned to a variable, for example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty/docs/rules.md</code>:53 on 2025-05-19 14:30</div>
            <div class="timeline-body"><p>~Did you have to update these manually?~</p>
<p>Whew, you did not! Looks like this was auto-generated from <code>diagnostic.rs</code></p>
<p>[Not for this PR] We might consider marking this as a generated file in <code>.gitattributes</code> to hide them in PR diffs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/diagnostic.rs</code>:607 on 2025-05-19 14:34</div>
            <div class="timeline-body"><p>Works for me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> approved on 2025-05-19 14:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-19 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-19 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-19 14:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:14:37 UTC
    </footer>
</body>
</html>
