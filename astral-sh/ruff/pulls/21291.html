<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] provide `import` completion when in `from &lt;name&gt; &lt;name&gt;` statement - astral-sh/ruff #21291</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] provide <code>import</code> completion when in <code>from &lt;name&gt; &lt;name&gt;</code> statement</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21291">#21291</a>
        opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a>
        on 2025-11-06 12:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-06 12:09</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Resolves https://github.com/astral-sh/ty/issues/1494</p>
<h2>Test Plan</h2>
<p>Add a test showing if we are in <code>from &lt;name&gt; &lt;name&gt; </code> we provide the keyword completion &quot;import&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MatthewMckee4 on 2025-11-06 12:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @MatthewMckee4 on 2025-11-06 12:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MatthewMckee4 on 2025-11-06 12:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MatthewMckee4 on 2025-11-06 12:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MatthewMckee4 on 2025-11-06 12:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Don't provide completions when in 'from <name> i' statement" to "[ty] Don't provide completions when in 'from <name> <name>' statement" by @MatthewMckee4 on 2025-11-06 12:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Don't provide completions when in 'from <name> <name>' statement" to "[ty] Don't provide completions when in `from <name> <name>` statement" by @MatthewMckee4 on 2025-11-06 12:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-11-06 12:12</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-11-06 12:13</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @MatthewMckee4 on 2025-11-06 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Don't provide completions when in `from <name> <name>` statement" to "[ty] Don't `import` completion when in `from <name> <name>` statement" by @MatthewMckee4 on 2025-11-06 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MatthewMckee4 on 2025-11-06 12:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Don't `import` completion when in `from <name> <name>` statement" to "[ty] provide `import` completion when in `from <name> <name>` statement" by @MatthewMckee4 on 2025-11-06 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @AlexWaygood on 2025-11-06 12:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-11-06 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-11-06 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @dcreager removed by @MichaReiser on 2025-11-06 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @MichaReiser on 2025-11-06 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @sharkdp removed by @MichaReiser on 2025-11-06 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @MichaReiser on 2025-11-06 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-11-06 13:18</div>
            <div class="timeline-body"><p>Only showing <code>import</code> in a <code>from &lt;NAME&gt; &lt;NAME2&gt;</code> position does make sense to me. I was surprised to see that Pylance shows all completions, but gives <code>import</code> a higher ranking</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-06 13:38</div>
            <div class="timeline-body"><p>For some reason i dont get completions in playground locally for <code>import</code> when i have just <code>a</code>
<img width="498" height="201" alt="image" src="https://github.com/user-attachments/assets/03ea3633-ddbd-4312-9896-9973da7de274" /></p>
<p>This could be a playground thing though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-06 13:54</div>
            <div class="timeline-body"><p>I just checked out this PR and built the playground and this works as expected when you have <code>from types i</code> but it doesn't work when you have <code>from types aa</code>.</p>
<p>This could either be because the playground applies its own filtering (not sure if there's a way for us to disable it, do you want to take a look) or because our own &quot;text prefix matching&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-11-06 14:21</div>
            <div class="timeline-body"><p>Yeah we may not be able to fully control whether <code>import</code> is shown for <code>from module import aa&lt;CURSOR&gt;</code>. LSP clients can and will do their own filtering AIUI. I'm not sure if there is a foolproof way to override that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:908 on 2025-11-06 14:43</div>
            <div class="timeline-body"><p>this works well for the simple case of <code>from &lt;NAME&gt; &lt;CURSOR&gt;</code>, but doesn't work for:</p>
<ul>
<li><code>from &lt;NAME&gt;.&lt;NAME&gt; &lt;CURSOR&gt;</code></li>
<li><code>from .&lt;NAME&gt; &lt;CURSOR&gt;</code></li>
<li><code>from ...&lt;NAME&gt;.&lt;NAME&gt; &lt;CURSOR&gt;</code></li>
</ul>
<p>etc.</p>
<p><img width="1498" height="364" alt="image" src="https://github.com/user-attachments/assets/b2e52aef-104e-4b35-88b7-261ea7fb6170" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:237 on 2025-11-06 14:45</div>
            <div class="timeline-body"><p>I don't think it's true in the long term that all locations where we might want to offer a keyword completion are places where we definitely won't want to offer any non-keyword completions. For example <code>pass</code> (a keyword) and <code>print</code> (a non-keyword) should both be included in our completion suggestions in this example:</p>
<pre><code class="language-py">match x:
    case int():
        p&lt;CURSOR&gt;
</code></pre>
<p>so the semantics you're adding in this PR are totally correct, but that might imply a different code structure here that would be more extensible in the future</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-06 14:45</div>
            <div class="timeline-body"><p>Nice, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-06 14:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:908 on 2025-11-06 14:57</div>
            <div class="timeline-body"><p>the full grammar for import statements given at https://docs.python.org/3/reference/grammar.html is:</p>
<pre><code>import_stmt:
    | import_name
    | import_from

# Import statements
# -----------------

import_name: 'import' dotted_as_names 
# note below: the ('.' | '...') is necessary because '...' is tokenized as ELLIPSIS
import_from:
    | 'from' ('.' | '...')* dotted_name 'import' import_from_targets 
    | 'from' ('.' | '...')+ 'import' import_from_targets 
import_from_targets:
    | '(' import_from_as_names [','] ')' 
    | import_from_as_names !','
    | '*' 
import_from_as_names:
    | ','.import_from_as_name+ 
import_from_as_name:
    | NAME ['as' NAME ] 

dotted_as_names:
    | ','.dotted_as_name+ 
dotted_as_name:
    | dotted_name ['as' NAME ] 

dotted_name:
    | dotted_name '.' NAME 
    | NAME
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-06 14:59</div>
            <div class="timeline-body"><p>Thank you, I will revisit this in a few days, when I am back home.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-06 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:237 on 2025-11-06 15:10</div>
            <div class="timeline-body"><p>Good point, it seems we need some indication of when keywords are the only completions we should provide.</p>
<p>I will think more about this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:237 on 2025-11-06 15:15</div>
            <div class="timeline-body"><p>Right. What we'll want it some way to identify something about the context in which completions are being offered. There are other considerations in play here, like <code>raise &lt;CURSOR&gt;</code> should have the suggestions altered to things that are appropriate for <code>raise</code>. There are likely other examples.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-11-06 15:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:908 on 2025-11-06 15:17</div>
            <div class="timeline-body"><p>You might be able to copy this routine and tweak it a bit:</p>
<p>https://github.com/astral-sh/ruff/blob/0c7b93363e6b5b43b8f36adbd6e3adf1a13374c2/crates/ty_ide/src/completion.rs#L667-L670</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-11-06 15:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-11-06 15:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:4360 on 2025-11-06 15:18</div>
            <div class="timeline-body"><p>Can you add a comment noting that this might not work the same way in real LSP clients (since they might do their own filtering based on what has been typed)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-10 00:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:237 on 2025-11-10 00:03</div>
            <div class="timeline-body"><p>I can implement something like this in another PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-10 00:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:908 on 2025-11-10 00:03</div>
            <div class="timeline-body"><p>I have done my best to mirror this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-10 00:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:4445 on 2025-11-10 00:26</div>
            <div class="timeline-body"><p>A version of this test with <em>three</em> preceding dots doesn't pass. The reason is that <code>from ...foo</code> doesn't parse as <code>[&lt;FROM&gt;, &lt;DOT&gt;, &lt;DOT&gt;, &lt;DOT&gt;, &lt;NAME(&quot;foo&quot;)&gt;]</code>, it parses as <code>[&lt;FROM&gt;, &lt;ELLIPSIS&gt;, &lt;NAME(&quot;foo&quot;)&gt;]</code>.</p>
<p>You want to make this change:</p>
<pre><code class="language-diff">diff --git a/crates/ty_ide/src/completion.rs b/crates/ty_ide/src/completion.rs
index d6896f3804..adf107d7c4 100644
--- a/crates/ty_ide/src/completion.rs
+++ b/crates/ty_ide/src/completion.rs
@@ -919,7 +919,8 @@ fn from_import_statement_keyword_completions&lt;'db&gt;(tokens: &amp;[Token]) -&gt; Option&lt;Co
     // Skip over '('.' | '...')*'
     let dots_count = tokens_after_from
         .iter()
-        .take_while(|t| t.kind() == TokenKind::Dot)
+        .map(Token::kind)
+        .take_while(|t| matches!(t, TokenKind::Dot | TokenKind::Ellipsis))
         .count();
 
     let tokens_after_dots = &amp;tokens_after_from[dots_count..];
@@ -4391,6 +4392,23 @@ type &lt;CURSOR&gt;
         assert!(completions.len() == 1);
     }
 
+    #[test]
+    fn from_import_nested_very_dotted_name_relative_import_suggests_import() {
+        let builder = CursorTest::builder()
+            // N.B. the `...` tokenizes as `TokenKind::Ellipsis`
+            .source(&quot;src/main.py&quot;, &quot;from ...foo i&lt;CURSOR&gt;&quot;)
+            .source(&quot;foo.py&quot;, &quot;&quot;)
+            .completion_test_builder();
+
+        let completions_test = builder.build();
+
+        completions_test.contains(&quot;import&quot;);
+
+        let completions = completions_test.completions();
+
+        assert!(completions.len() == 1);
+    }
+
     /// A way to create a simple single-file (named `main.py`) completion test
     /// builder.
     ///
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:4445 on 2025-11-10 00:30</div>
            <div class="timeline-body"><p>Ah, thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-10 00:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-10 00:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:959 on 2025-11-10 00:38</div>
            <div class="timeline-body"><p>I find this a bit easier to understand:</p>
<pre><code class="language-suggestion">fn is_dotted_name(tokens: &amp;[Token]) -&gt; bool {
    match tokens {
        [] | [_, _] =&gt; false,
        [tok] =&gt; tok.kind() == TokenKind::Name,
        [dotted_name @ .., penultimate, last] =&gt; {
            last.kind() == TokenKind::Name
                &amp;&amp; penultimate.kind() == TokenKind::Dot
                &amp;&amp; is_dotted_name(dotted_name)
        }
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-10 00:40</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-10 00:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:959 on 2025-11-10 00:41</div>
            <div class="timeline-body"><p>Very nice, my functional programming class clearly hasn't sunk in enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @AlexWaygood on 2025-11-10 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:911 on 2025-11-10 09:11</div>
            <div class="timeline-body"><p>The search here seems to be too permissive to me. What's preventing it from going across logical lines?</p>
<p>Can you add some tests with multiple statements? I suspect that we now incorrectly match on import completions if there's <strong>any</strong> import statement before <code>&lt;CURSOR&gt;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 09:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-10 10:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:911 on 2025-11-10 10:16</div>
            <div class="timeline-body"><p>Good point, will add that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 10:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:911 on 2025-11-10 10:29</div>
            <div class="timeline-body"><p>I still think this is incorrect as it cross logical line boundaries. E.g. what if</p>
<pre><code class="language-py">from module impo

a&lt;CURSOR&gt;
</code></pre>
<p>We would want to show completions for <code>a</code> and not suggest <code>import</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-11-10 10:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/ty_ide/src/completion.rs</code>:911 on 2025-11-10 10:32</div>
            <div class="timeline-body"><p>I am maybe misunderstanding you. we do still provide completions for <code>a</code> here.
<img width="590" height="214" alt="image" src="https://github.com/user-attachments/assets/1e4b7676-766a-4c5e-9016-5cc89d4ba19c" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/completion.rs</code>:911 on 2025-11-10 12:07</div>
            <div class="timeline-body"><p>I haven't checked out the PR. What I'm concerned with the current approach is that <code>tokens</code> is anything before <code>&lt;CURSOR&gt;</code> (unless this isn't the case?). That means, it's possible for <code>tokens.iter().rposition()</code> to find the <code>from</code> even though it belongs to an entirely different statement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:934 on 2025-11-10 13:01</div>
            <div class="timeline-body"><p>Can you make sure comments are wrapped to 99 columns (inclusive) please? There are some other comments below that need to be wrapped too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:943 on 2025-11-10 13:05</div>
            <div class="timeline-body"><p>I think this routine should be modeled on this existing function:</p>
<p>https://github.com/astral-sh/ruff/blob/f44598dc113a7380ca52d6c969431ca929a93473/crates/ty_ide/src/completion.rs#L667-L756</p>
<p>Maybe there is a way to factor out the common logic, but even if there isn't, just copying the <em>approach</em> seems like the right move here. I agree with @MichaReiser above. And notice that the function above is careful to not do too much look-behind on the token sequence. It also handles things like ellipsis, non-logical newlines and so on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:4318 on 2025-11-10 13:07</div>
            <div class="timeline-body"><p>For something really short, I'm fine with the <code>\n</code> here. But this starts to make very long lines. I'd rather see this written out using actual new lines:</p>
<pre><code>        let builder = completion_test_builder(
            &quot;from collections.abc import Sequence
             from typing i&lt;CURSOR&gt;&quot;
        );
</code></pre>
<p>The test code should automatically handle dedenting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2025-11-10 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-11-10 14:14</div>
            <div class="timeline-body"><p>@MatthewMckee4 I'm going to take over this PR since we'd like to get this fixed. And I'm planning to work on more stuff around keyword completions this week, which will really want to build on top of this PR. Thank you. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-11-10 14:23</div>
            <div class="timeline-body"><p>Cool, apologies for the delays, I've been a little busy. Thank you for the feedback too!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-10 14:26</div>
            <div class="timeline-body"><blockquote>
<p>Cool, apologies for the delays, I've been a little busy.</p>
</blockquote>
<p>never feel like you need to apologise for unpaid volunteer work :-) we really appreciate the contribution!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-11-10 16:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2025-11-10 16:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-11-10 16:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-27 00:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:36:41 UTC
    </footer>
</body>
</html>
