<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[FIX] PYI011: recognize `Bool` / `Float` / `Complex` numbers as simple defaults - astral-sh/ruff #3459</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[FIX] PYI011: recognize <code>Bool</code> / <code>Float</code> / <code>Complex</code> numbers as simple defaults</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3459">#3459</a>
        opened by <a href="https://github.com/XuehaiPan">@XuehaiPan</a>
        on 2023-03-12 11:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/XuehaiPan">@XuehaiPan</a> on 2023-03-12 11:47</div>
            <div class="timeline-body"><p>In https://github.com/PyCQA/flake8-pyi/blob/40d547e9624a50f06f0a8369cb2787addabf9ce8/pyi.py#L733-L738</p>
<pre><code class="language-python">    def _is_valid_Num(node: ast.expr) -&gt; TypeGuard[ast.Num]:
        # The maximum character limit is arbitrary, but here's what it's based on:
        # Hex representation of 32-bit integers tend to be 10 chars.
        # So is the decimal representation of the maximum positive signed 32-bit integer.
        # 0xFFFFFFFF --&gt; 4294967295
        return isinstance(node, ast.Num) and len(str(node.n)) &lt;= 10
</code></pre>
<p>constant numbers its representation of fewer than 10 characters are considered simple defaults. The definition of <code>ast.Num</code> is:</p>
<pre><code class="language-python">class Num(Constant, metaclass=...):
    value: int | float | complex
</code></pre>
<p>Currently, <code>ruff</code> only considers <code>int</code>s are simple defaults. Constant numbers of:</p>
<ul>
<li><code>bool</code>: <code>True</code> / <code>False</code></li>
<li><code>float</code>: <code>3.14</code>, <code>2.0</code>, <code>0.5</code></li>
<li><code>complex</code>: <code>2j</code>, <code>-3.14j</code></li>
</ul>
<p>are not.</p>
<p>Ref:</p>
<ul>
<li>#3238</li>
</ul>
<hr />
<p>In Python, <code>bool</code> is a subclass of <code>int</code>, which has only two instances <code>True</code> and <code>False</code>.</p>
<p><code>True</code> and <code>False</code> should be considered simple defaults and should be allowed in <code>.pyi</code>.</p>
<pre><code class="language-python"># test.pyi
def func(flag: bool = False) -&gt; None: ...
</code></pre>
<p>Output:</p>
<pre><code class="language-console">$ ruff --version
ruff 0.0.254

$ ruff check --select=PYI test.pyi
test.pyi:2:23: PYI011 Only simple default values allowed for typed arguments
Found 1 error.
</code></pre>
<pre><code class="language-console">$ pip3 install -U flake8 flake8-pyi

$ flake8 --select=Y test.pyi
.. # empty output and no violation
</code></pre>
<p>I think this should be considered a bug in <code>rustpython_parser::ast::Constant</code>. It does not recognize <code>True</code> / <code>False</code> also to be a <code>Constain::Int(..)</code> (note that <code>bool</code> is a subclass of <code>int</code>).</p>
<pre><code class="language-python">&gt;&gt;&gt; bool.mro()
[bool, int, object]

&gt;&gt;&gt; isinstance(True, int)
True

&gt;&gt;&gt; isinstance(False, int)
True

&gt;&gt;&gt; True == 1
True
&gt;&gt;&gt; hash(True) == hash(1)
True
&gt;&gt;&gt; len({True, 1})
1
&gt;&gt;&gt; False == 0
True
&gt;&gt;&gt; hash(False) == hash(0)
True
&gt;&gt;&gt; len({False, 0})
1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[FIX] PYI011: recognize `True` and `False` as simple defaults" to "[FIX] PYI011: recognize `Constant::Bool` and `Constant::Float` as simple defaults" by @XuehaiPan on 2023-03-12 11:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-03-12 11:59</div>
            <div class="timeline-body"><p>âœ… ecosystem check detected no changes.</p>
<!-- thollander/actions-comment-pull-request "ecosystem-results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[FIX] PYI011: recognize `Constant::Bool` and `Constant::Float` as simple defaults" to "[FIX] PYI011: recognize `Bool` / `Float` / `Complex` numbers as simple defaults" by @XuehaiPan on 2023-03-12 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-12 17:18</div>
            <div class="timeline-body"><p>Thanks! This looks right to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-03-12 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-12 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-12 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-03-12 17:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:41:44 UTC
    </footer>
</body>
</html>
