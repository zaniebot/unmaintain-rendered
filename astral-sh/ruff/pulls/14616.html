<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[airflow] rule for deprecated task_concurrency parameter (AIR303) - astral-sh/ruff #14616</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[airflow] rule for deprecated task_concurrency parameter (AIR303)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14616">#14616</a>
        opened by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a>
        on 2024-11-26 17:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> on 2024-11-26 17:48</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Airflow 3.0 renames the <code>task_concurrency</code> parameter to <code>max_active_tis_per_dag</code> across all operators. The old parameter will no longer have any effect in 3.0. This rule detects usage of the deprecated parameter to help users migrate their DAGs to the new concurrency control pattern.</p>
<p>Ref: #14626</p>
<h2>Test Plan</h2>
<p>A test fixture has been included for the rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-26 17:52</div>
            <div class="timeline-body"><p>So many airflow rules :)</p>
<p>Are you working/coordinating with @uranusjr ? I just want to ensure we have &quot;one&quot; authority that has a big picture in mind for all tne new airflow rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-11-26 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @MichaReiser on 2024-11-26 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-26 17:56</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> on 2024-11-26 17:58</div>
            <div class="timeline-body"><p>Yes and a whole lot more coming.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @abhishekbhakat on 2024-11-26 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @abhishekbhakat on 2024-11-26 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @abhishekbhakat on 2024-11-26 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "rule for deprecated task_concurrency parameter" to "[airflow] rule for deprecated task_concurrency parameter (AIR303)" by @abhishekbhakat on 2024-11-26 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @abhishekbhakat on 2024-11-26 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @abhishekbhakat on 2024-11-27 05:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @abhishekbhakat on 2024-11-27 05:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-11-27 06:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/rules/task_concurrency.rs</code>:63 on 2024-11-27 06:03</div>
            <div class="timeline-body"><p>As https://github.com/astral-sh/ruff/pull/14581 is merged we should update this to use the <code>seen_module</code> at the top of the rule function:</p>
<pre><code class="language-rs">    if !checker.semantic().seen_module(Modules::AIRFLOW) {
        return;
    }
</code></pre>
<p>The semantic model caches common module lookups and exposes a method to allow us to query it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-27 06:13</div>
            <div class="timeline-body"><p>Are there other parameters that have been deprecated? I wonder if we should club them under a single rule similar to the NumPy 2.0 deprecations where one rule would look at the imports and the other would look at function parameters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> on 2024-11-27 06:19</div>
            <div class="timeline-body"><p>There are a lot of breaking changes in Airflow 3 coming from Airflow 2.
Here is an exhaustive list https://github.com/apache/airflow/issues/41641
We are picking one by one. Will try to club them wherever possible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> reviewed on 2024-11-27 06:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> on <code>crates/ruff_linter/src/rules/airflow/rules/task_concurrency.rs</code>:63 on 2024-11-27 06:50</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-27 08:16</div>
            <div class="timeline-body"><p>Oh wow, that's a very long list. I didn't expect there to be that many changes.</p>
<p>I think it would be great to write up a short proposal on what rules you plan on adding and how you want to group the deprecations. We want to avoid having 50ish airflow deprecation rules. For example: Can we have one rule for:</p>
<ul>
<li>removals (with a possible fix suggesting the new name)</li>
<li>deprecations</li>
<li>new defaults (or similar)</li>
</ul>
<p>We can incrementally add to those rules.</p>
<p>I think a good place to discuss the new rules is https://github.com/astral-sh/ruff/issues/14626</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kaxil">@kaxil</a> on <code>crates/ruff_linter/resources/test/fixtures/airflow/AIR303.py</code>:7 on 2024-11-27 11:35</div>
            <div class="timeline-body"><p>@abhishekbhakat We should raise a deprecation error in Airflow 2.2+ too: https://github.com/apache/airflow/pull/17708 (that was when we had original deprecation)</p>
<p>In Airflow 3, it is &quot;removed&quot; entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kaxil">@kaxil</a> reviewed on 2024-11-27 11:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-09 16:00</div>
            <div class="timeline-body"><p>What's the status of this rule? Is it still needed according to the new categorization?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> on 2024-12-09 16:25</div>
            <div class="timeline-body"><p>I'll put this as a draft PR. We are working on the consolidated rules. We'll revisit this after that is ready.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @abhishekbhakat on 2024-12-09 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/uranusjr">@uranusjr</a> on 2025-05-05 10:20</div>
            <div class="timeline-body"><p>Do we still need this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abhishekbhakat">@abhishekbhakat</a> on 2025-05-05 15:38</div>
            <div class="timeline-body"><p>Didn't kept a track of what has been merged yet. But then again we can revisit it in future if needed. Closing this PR for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @abhishekbhakat on 2025-05-05 15:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:57:29 UTC
    </footer>
</body>
</html>
