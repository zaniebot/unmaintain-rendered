<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add flake-pyi PYI033 &quot;Do not use type comments in stubs&quot; - astral-sh/ruff #3302</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add flake-pyi PYI033 &quot;Do not use type comments in stubs&quot;</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3302">#3302</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-03-02 12:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>I think this is also a case where people like want this for .py files, too, at least on 3.7+ (https://docs.python.org/3/whatsnew/3.7.html#pep-563-postponed-evaluation-of-annotations)</p>
<p>On that note, does none of the tools upgrade all type comments to type annotations automatically? I looked in pyupgrade and googled and was surprised i couldn't find anything</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2023-03-02 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/configuration.md</code>:209 on 2023-03-02 14:40</div>
            <div class="timeline-body"><p>not sure how this got in here, should this be here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-02 14:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/twoertwein">@twoertwein</a> reviewed on 2023-03-02 14:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/twoertwein">@twoertwein</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 14:53</div>
            <div class="timeline-body"><p>Would this also be true for <code># type: ignore</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-02 14:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 14:56</div>
            <div class="timeline-body"><p>currently yes; are there any cases where you need <code># type: ignore</code> in a .pyi file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/twoertwein">@twoertwein</a> reviewed on 2023-03-02 15:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/twoertwein">@twoertwein</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 15:05</div>
            <div class="timeline-body"><p>I wish ignore comments wouldn't be needed in stubs but they are used. Here is an example from typeshed https://github.com/python/typeshed/blob/45f0a5e7e47a23d6be67cfce429c4f2c0de62a29/stdlib/builtins.pyi#L565</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 15:12</div>
            <div class="timeline-body"><p>thanks for the example! i'll except those then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-02 15:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2023-03-02 15:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 15:43</div>
            <div class="timeline-body"><p>All our flake8-pyi tests for this rule are in this file FYI, if that helps :)</p>
<p>https://github.com/PyCQA/flake8-pyi/blob/main/tests/type_comments.pyi</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 15:44</div>
            <div class="timeline-body"><p>It might be worth looking at the <code>flake8-pyi</code> source and seeing how they handle this?</p>
<p>In particular, they have this regex, which omits <code>ignore</code> comments:</p>
<p>https://github.com/PyCQA/flake8-pyi/blob/66f28a4407af2156f95d370941fae4dd98280740/pyi.py#L1877</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-02 15:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-02 15:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 15:47</div>
            <div class="timeline-body"><p>oops thanks i somehow used them for Y006 but then forgot that those also exist for Y033.</p>
<p>thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-02 15:51</div>
            <div class="timeline-body"><blockquote>
<p>On that note, does none of the tools upgrade all type comments to type annotations automatically? I looked in pyupgrade and googled and was surprised i couldn't find anything</p>
</blockquote>
<p>There's a tool called <a href="https://github.com/ilevkivskyi/com2ann">com2ann</a> which seems popular for this use-case. It's come up in Ruff before, though I've tried to cut scope at &quot;tools that support one-time 2-to-3 conversion&quot; :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-02 16:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>docs/configuration.md</code>:209 on 2023-03-02 16:09</div>
            <div class="timeline-body"><p>Oh strange. Builds should fail if <code>cargo dev generate-all</code> produces any changed files. Lemme look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-02 16:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 16:41</div>
            <div class="timeline-body"><p>fwiw i had to do two regexes since rust regex doesn't support look around</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-02 16:49</div>
            <div class="timeline-body"><p>Maybe <code>com2ann</code> should be mentioned in the rule explanation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:16 on 2023-03-02 17:55</div>
            <div class="timeline-body"><p>I think this paragraph would make sense in the <code>## Why is it bad?</code> section, since <code>## What it does?</code> tends to be a description of what it's checking rather than alternatives etc. So e.g.:</p>
<pre><code class="language-rs">/// ## What it does
/// Checks for the use of type comments (e.g., `x = 1  # type: int`) in stub
/// files.
///
/// ## Why is this bad?
/// Stub (`.pyi`) files should always use type annotations directly, rather
/// than type comments, even if they're intended to support Python 2, since
/// stub files are not executed at runtime.
///
/// ## Example
/// ```python
/// x = 1 # type: int
/// ```
///
/// Use instead:
/// ```python
/// x: int = 1
/// ```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-03-02 17:55</div>
            <div class="timeline-body"><p>LGTM! One suggestion on the docstring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-03-02 17:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:46 on 2023-03-02 17:55</div>
            <div class="timeline-body"><p>Thanks @AlexWaygood for the helpful comment :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-03 10:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:16 on 2023-03-03 10:11</div>
            <div class="timeline-body"><p>thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-03-03 10:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_pyi/rules/type_comment_in_stub.rs</code>:16 on 2023-03-03 10:11</div>
            <div class="timeline-body"><p>i've also added the <code># type: ignore</code> exception</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-03-03 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-03 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-03-03 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-03-03 15:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:56:29 UTC
    </footer>
</body>
</html>
