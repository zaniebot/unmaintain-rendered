<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] allow any string `Literal` type expression as a key when constructing a `TypedDict` - astral-sh/ruff #20792</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] allow any string <code>Literal</code> type expression as a key when constructing a <code>TypedDict</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20792">#20792</a>
        opened by <a href="https://github.com/mtshiba">@mtshiba</a>
        on 2025-10-09 17:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mtshiba">@mtshiba</a></div>
            <div class="timeline-body">Summary
<p>This PR allows any string <code>Literal</code> type expression to be used as a key when constructing a <code>TypedDict</code>.</p>
<p>The pattern of reusing constant key strings when constructing a <code>TypedDict</code> seems to be common in several libraries (e.g., <a href="https://github.com/home-assistant/core/blob/f6fb4c8d5a26d496ca0ebe790776bc208386e83d/homeassistant/components/environment_canada/weather.py#L227C1-L241C14">home-assistant/core</a>).
Currently, we only accept string literal keys when constructing a <code>TypedDict</code>, but any expression that can be inferred to be of type string <code>Literal</code> is also acceptable. In fact, <a href="https://typing.python.org/en/latest/spec/typeddict.html#use-of-final-values-and-literal-types">the spec</a> explicitly states that <code>Literal</code> type expressions and <code>Final</code> names ​​should be allowed.</p>
Test Plan
<p>New tests in <code>typed_dict.md</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-09 17:54</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-09 17:56</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>core (https://github.com/home-assistant/core)
- homeassistant/components/dhcp/__init__.py:228:33: error[missing-typed-dict-key] Missing required key &#x27;hostname&#x27; in TypedDict `DHCPAddressData` constructor
- homeassistant/components/dhcp/__init__.py:228:33: error[missing-typed-dict-key] Missing required key &#x27;ip&#x27; in TypedDict `DHCPAddressData` constructor
- homeassistant/components/meteo_france/weather.py:194:21: error[missing-typed-dict-key] Missing required key &#x27;datetime&#x27; in TypedDict `Forecast` constructor
- homeassistant/components/meteo_france/weather.py:216:21: error[missing-typed-dict-key] Missing required key &#x27;datetime&#x27; in TypedDict `Forecast` constructor
- homeassistant/components/nws/weather.py:250:30: error[missing-typed-dict-key] Missing required key &#x27;datetime&#x27; in TypedDict `Forecast` constructor
- homeassistant/components/nws/weather.py:306:35: error[missing-typed-dict-key] Missing required key &#x27;datetime&#x27; in TypedDict `ExtraForecast` constructor
- homeassistant/components/p1_monitor/coordinator.py:73:31: error[missing-typed-dict-key] Missing required key &#x27;smartmeter&#x27; in TypedDict `P1MonitorData` constructor
- homeassistant/components/p1_monitor/coordinator.py:73:31: error[missing-typed-dict-key] Missing required key &#x27;phases&#x27; in TypedDict `P1MonitorData` constructor
- homeassistant/components/p1_monitor/coordinator.py:73:31: error[missing-typed-dict-key] Missing required key &#x27;settings&#x27; in TypedDict `P1MonitorData` constructor
- homeassistant/components/p1_monitor/coordinator.py:73:31: error[missing-typed-dict-key] Missing required key &#x27;watermeter&#x27; in TypedDict `P1MonitorData` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;host&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;port&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;timeout&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;payload&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;unit_of_measurement&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;value_template&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;value_on&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;buffer_size&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;ssl&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/tcp/entity.py:40:41: error[missing-typed-dict-key] Missing required key &#x27;verify_ssl&#x27; in TypedDict `TcpSensorConfig` constructor
- homeassistant/components/todoist/calendar.py:130:37: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `ProjectData` constructor
- homeassistant/components/todoist/calendar.py:130:37: error[missing-typed-dict-key] Missing required key &#x27;id&#x27; in TypedDict `ProjectData` constructor
- homeassistant/components/todoist/calendar.py:170:37: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `ProjectData` constructor
- homeassistant/components/todoist/calendar.py:170:37: error[missing-typed-dict-key] Missing required key &#x27;id&#x27; in TypedDict `ProjectData` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;all_day&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;completed&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;description&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;due_today&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;end&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;labels&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;overdue&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;priority&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;start&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:528:30: error[missing-typed-dict-key] Missing required key &#x27;summary&#x27; in TypedDict `TodoistEvent` constructor
- homeassistant/components/todoist/calendar.py:552:21: error[unsupported-operator] Operator `in` is not supported for types `Unknown` and `bool`, in comparing `Unknown` with `Unknown | bool | str | ... omitted 3 union elements`
- homeassistant/components/todoist/calendar.py:570:21: error[unsupported-operator] Operator `&gt;` is not supported for types `bool` and `datetime`, in comparing `Unknown | bool | str | ... omitted 3 union elements` with `datetime`
+ homeassistant/components/todoist/calendar.py:570:21: error[unsupported-operator] Operator `&gt;` is not supported for types `None` and `datetime`, in comparing `datetime | None` with `datetime`
- homeassistant/components/todoist/calendar.py:576:35: warning[possibly-missing-attribute] Attribute `date` on type `Unknown | bool | str | ... omitted 3 union elements` may be missing
+ homeassistant/components/todoist/calendar.py:576:35: warning[possibly-missing-attribute] Attribute `date` on type `datetime | None` may be missing
+ homeassistant/components/todoist/calendar.py:579:20: error[unsupported-operator] Operator `&lt;=` is not supported for types `None` and `datetime`, in comparing `datetime | None` with `datetime`
- homeassistant/components/todoist/calendar.py:579:20: error[unsupported-operator] Operator `&lt;=` is not supported for types `bool` and `str`, in comparing `Unknown | bool | str | ... omitted 3 union elements` with `Unknown | bool | str | ... omitted 3 union elements`
- homeassistant/components/todoist/calendar.py:584:33: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | bool | str | ... omitted 3 union elements` and `timedelta`
- homeassistant/core.py:1965:45: error[missing-typed-dict-key] Missing required key &#x27;s&#x27; in TypedDict `CompressedState` constructor
- homeassistant/core.py:1965:45: error[missing-typed-dict-key] Missing required key &#x27;a&#x27; in TypedDict `CompressedState` constructor
- homeassistant/core.py:1965:45: error[missing-typed-dict-key] Missing required key &#x27;c&#x27; in TypedDict `CompressedState` constructor
- homeassistant/core.py:1965:45: error[missing-typed-dict-key] Missing required key &#x27;lc&#x27; in TypedDict `CompressedState` constructor
- Found 13736 diagnostics
+ Found 13695 diagnostics

</code></pre>

No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-09 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-10-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-10-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-10-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-10-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-10-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-10-09 18:19</div>
            <div class="timeline-body"><p>Great -- thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-09 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-09 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-09 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-10-09 21:30</div>
            <div class="timeline-body"><blockquote>
<p>In fact, <a href="https://typing.python.org/en/latest/spec/typeddict.html#use-of-final-values-and-literal-types">the spec</a> explicitly states that Literal type expressions and Final names ​​should be allowed.</p>
</blockquote>
<p>FWIW I think the spec only states this for <code>TypedDict</code> <em>operations</em>, not definitions, but I agree that we should support this anyways as it&#x27;s common in the ecosystem.</p>
<p>I think we can also update our bidirectional inference code, <a href="https://github.com/astral-sh/ruff/blob/main/crates/ty_python_semantic/src/types/infer/builder.rs#L5860">which makes the same assumption</a>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:23 UTC
    </footer>
</body>
</html>
