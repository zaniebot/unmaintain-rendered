```yaml
number: 6870
title: Use ruff line-length in format_dev
type: pull_request
state: merged
author: konstin
labels:
  - formatter
assignees: []
merged: true
base: main
head: line-length-in-format-dev
created_at: 2023-08-25T11:58:59Z
updated_at: 2023-09-05T14:19:18Z
url: https://github.com/astral-sh/ruff/pull/6870
synced_at: 2026-01-12T02:45:38Z
```

# Use ruff line-length in format_dev

---

_Pull request opened by @konstin on 2023-08-25 11:58_

**Summary** Use the `[ruff]` config line length setting in format_dev. This aligns it with `ruff format` (originally, this was the prototype for `ruff format`, but now `ruff format` works and we instead need to keep `format_dev` consistent).



---

_Comment by @konstin on 2023-08-25 11:59_

Current dependencies on/for this PR:
* main
  * **PR #6870** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6870" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6870?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-08-25 12:40_

## PR Check Results
### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      4.1Â±0.02ms    10.0 MB/sec    1.00      4.1Â±0.01ms    10.0 MB/sec
formatter/numpy/ctypeslib.py               1.00    854.0Â±2.40Âµs    19.5 MB/sec    1.00    854.3Â±2.49Âµs    19.5 MB/sec
formatter/numpy/globals.py                 1.00     84.1Â±0.34Âµs    35.1 MB/sec    1.01     84.5Â±0.37Âµs    34.9 MB/sec
formatter/pydantic/types.py                1.01   1684.9Â±8.49Âµs    15.1 MB/sec    1.00   1671.8Â±7.57Âµs    15.3 MB/sec
linter/all-rules/large/dataset.py          1.00     10.0Â±0.04ms     4.1 MB/sec    1.01     10.1Â±0.06ms     4.0 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      2.7Â±0.00ms     6.2 MB/sec    1.00      2.7Â±0.01ms     6.2 MB/sec
linter/all-rules/numpy/globals.py          1.00    377.7Â±0.54Âµs     7.8 MB/sec    1.00    376.5Â±0.52Âµs     7.8 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.2Â±0.03ms     4.9 MB/sec    1.00      5.2Â±0.04ms     4.9 MB/sec
linter/default-rules/large/dataset.py      1.01      5.3Â±0.01ms     7.6 MB/sec    1.00      5.3Â±0.01ms     7.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1178.6Â±17.92Âµs    14.1 MB/sec    1.00   1175.7Â±8.25Âµs    14.2 MB/sec
linter/default-rules/numpy/globals.py      1.01    139.5Â±4.90Âµs    21.1 MB/sec    1.00    137.7Â±1.86Âµs    21.4 MB/sec
linter/default-rules/pydantic/types.py     1.00      2.4Â±0.01ms    10.6 MB/sec    1.00      2.4Â±0.03ms    10.6 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      5.5Â±0.17ms     7.4 MB/sec    1.04      5.7Â±0.20ms     7.1 MB/sec
formatter/numpy/ctypeslib.py               1.00  1120.0Â±47.17Âµs    14.9 MB/sec    1.04  1169.5Â±30.49Âµs    14.2 MB/sec
formatter/numpy/globals.py                 1.00   112.2Â±10.25Âµs    26.3 MB/sec    1.02    114.7Â±5.31Âµs    25.7 MB/sec
formatter/pydantic/types.py                1.00      2.3Â±0.12ms    11.2 MB/sec    1.03      2.4Â±0.07ms    10.8 MB/sec
linter/all-rules/large/dataset.py          1.03     15.3Â±0.48ms     2.7 MB/sec    1.00     14.9Â±0.39ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.1Â±0.11ms     4.0 MB/sec    1.00      4.1Â±0.09ms     4.1 MB/sec
linter/all-rules/numpy/globals.py          1.02   525.4Â±25.44Âµs     5.6 MB/sec    1.00   512.9Â±12.32Âµs     5.8 MB/sec
linter/all-rules/pydantic/types.py         1.01      7.8Â±0.22ms     3.3 MB/sec    1.00      7.7Â±0.16ms     3.3 MB/sec
linter/default-rules/large/dataset.py      1.04      8.5Â±0.52ms     4.8 MB/sec    1.00      8.2Â±0.11ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1775.3Â±50.53Âµs     9.4 MB/sec    1.00  1783.1Â±45.47Âµs     9.3 MB/sec
linter/default-rules/numpy/globals.py      1.00   205.5Â±10.57Âµs    14.4 MB/sec    1.02    210.0Â±5.39Âµs    14.1 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.7Â±0.10ms     6.9 MB/sec    1.01      3.7Â±0.07ms     6.9 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_@konstin reviewed on 2023-08-25 13:28_

---

_Review comment by @konstin on `crates/ruff_dev/src/format_dev.rs`:545 on 2023-08-25 13:28_

#6873 fixes this

---

_@konstin reviewed on 2023-08-25 13:31_

---

_Review comment by @konstin on `crates/ruff_python_formatter/src/lib.rs`:355 on 2023-08-25 13:31_

adapted the test for the new defaults

---

_@konstin reviewed on 2023-08-25 13:32_

---

_Review comment by @konstin on `crates/ruff_formatter/src/lib.rs`:131 on 2023-08-25 13:32_

i think it makes sense to use the correct default here already

---

_Marked ready for review by @konstin on 2023-08-25 13:32_

---

_Label `formatter` added by @konstin on 2023-08-25 13:38_

---

_Review comment by @charliermarsh on `crates/ruff_dev/src/format_dev.rs`:553 on 2023-08-25 13:46_

Is this because you're trying to see if it's not the default? Why can't we just use `settings.line_length`? Because it will be wrong for projects in the formatter CI that use Black but not Ruff?

---

_@charliermarsh reviewed on 2023-08-25 13:46_

---

_@konstin reviewed on 2023-08-25 15:02_

---

_Review comment by @konstin on `crates/ruff_dev/src/format_dev.rs`:553 on 2023-08-25 15:02_

yes, this only exists to have a (dummy) usage for the line length without breaking the formatter ecosystem checks

---

_Review requested from @MichaReiser by @konstin on 2023-08-25 15:40_

---

_@MichaReiser reviewed on 2023-08-25 16:26_

---

_Review comment by @MichaReiser on `crates/ruff_formatter/src/lib.rs`:131 on 2023-08-25 16:26_

I would prefer keeping 80, although it's hard reasoning for it if it complicates the implementation. 
The reason I prefer 80 is because `ruff_formatter` is language agnostic and 88 is a very python specific line width. 

Most other languages prefer to default to 80. 

What makes this change necessary? What I understand is that you use `LineLength` above (and not `LineWiddth`).

---

_@MichaReiser reviewed on 2023-08-25 16:28_

---

_Review comment by @MichaReiser on `crates/ruff_dev/src/format_dev.rs`:553 on 2023-08-25 16:28_

Should `Settings.line_length` be an `Option<LineLength>` if that's something we want to distinguish? 

---

_Review request for @MichaReiser removed by @konstin on 2023-09-05 12:25_

---

_Review requested from @MichaReiser by @konstin on 2023-09-05 12:25_

---

_Comment by @konstin on 2023-09-05 12:27_

Please give this another look, this now only changes what's really needed for `format_dev`.

---

_@konstin reviewed on 2023-09-05 12:28_

---

_Review comment by @konstin on `crates/ruff_dev/src/format_dev.rs`:555 on 2023-09-05 12:28_



i still don't like this divergence


---

_Review comment by @MichaReiser on `crates/ruff_dev/src/format_dev.rs`:555 on 2023-09-05 13:52_

You can do `LineWidth::from(NonZeroU16::from(line_length)))`

---

_@MichaReiser approved on 2023-09-05 13:52_

---

_Merged by @konstin on 2023-09-05 14:19_

---

_Closed by @konstin on 2023-09-05 14:19_

---

_Branch deleted on 2023-09-05 14:19_

---
