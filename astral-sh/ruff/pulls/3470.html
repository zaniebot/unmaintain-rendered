<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infer target-version from project metadata - astral-sh/ruff #3470</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Infer target-version from project metadata</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3470">#3470</a>
        opened by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a>
        on 2023-03-12 19:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-12 19:28</div>
            <div class="timeline-body"><ul>
<li>Related to #2039</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-03-12 19:44</div>
            <div class="timeline-body"><p>âœ… ecosystem check detected no changes.</p>
<!-- thollander/actions-comment-pull-request "ecosystem-results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-12 21:38</div>
            <div class="timeline-body"><p>To clarify, this implements inference in <code>flake8-to-ruff</code>, but IIUC #2039 should remain open until Ruff is able to pick up the version from the <code>pyproject.toml</code> file at runtime -- is that right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-12 21:43</div>
            <div class="timeline-body"><blockquote>
<p>To clarify, this implements inference in <code>flake8-to-ruff</code>, but IIUC #2039 should remain open until Ruff is able to pick up the version from the <code>pyproject.toml</code> file at runtime -- is that right?</p>
</blockquote>
<p>I did not implement it as I did not find how Ruff picks up <code>line-length</code> from Black or <code>isort</code> configuration at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-12 21:57</div>
            <div class="timeline-body"><p>We don't! Those are only picked up in <code>flake8-to-ruff</code> :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-12 22:40</div>
            <div class="timeline-body"><p>I propose to merge this PRÂ as is.
I could make a following PR to pick up Black, isort, and <code>requires-python</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andersk">@andersk</a> reviewed on 2023-03-12 23:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/andersk">@andersk</a> on <code>crates/ruff/src/settings/types.rs</code>:91 on 2023-03-12 23:00</div>
            <div class="timeline-body"><p>Is this going to do the right thing if <code>pyproject.toml</code> specifies a patch release like <code>requires-python = &quot;&gt;= 3.8.16&quot;</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-12 23:10</div>
            <div class="timeline-body"><p>@konstin - Do you mind taking a look at this one given your experience with <code>requires-python</code>? :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-12 23:10</div>
            <div class="timeline-body"><p>(I think it would be reasonable to merge this as a <code>flake8-to-ruff</code> improvement, then look towards doing it at runtime in Ruff. I don't want Ruff to be looking for Black or isort settings at runtime though, I'd prefer to leave those in <code>flake8-to-ruff</code>. <code>requires-python</code> is different to me since it's part of a tool-agnostic standard.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-12 23:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/types.rs</code>:91 on 2023-03-12 23:33</div>
            <div class="timeline-body"><p>No, it will return <code>py39</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-13 00:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/pyproject.rs</code>:135 on 2023-03-13 00:19</div>
            <div class="timeline-body"><p>It will not load <code>requires-python</code> if <code>ruff.toml</code>is used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-13 00:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/types.rs</code>:91 on 2023-03-13 00:21</div>
            <div class="timeline-body"><p>This is fixed, I hard coded the patch number to 100 to avoid special casing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @MichaReiser on 2023-03-13 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/settings/types.rs</code>:287 on 2023-03-13 08:02</div>
            <div class="timeline-body"><p>Is it possible to make the inner <code>Vec</code> private (are there any reads-writes outside of this module)?</p>
<p>If not, can we use accessors to make it private, e.g. implement <code>Deref</code> with <code>Target =[VersionSpecifier]</code> or <code>IntoIter</code> on <code>&amp;RequiresVersion</code>?</p>
<p>Doing so has the benefit of not exposing the used type to store the <code>VersionSpecifier</code>. E.g. we could consider using a <code>SmallVec</code> in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-03-13 08:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/settings/types.rs</code>:289 on 2023-03-13 09:25</div>
            <div class="timeline-body"><p>This is great, i've stolen this to integrate it into pep440-rs itself: https://github.com/konstin/pep440-rs/commit/0d15f41b5b5c76c58278575b815d5cfe0bb54787</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/settings/types.rs</code>:91 on 2023-03-13 09:26</div>
            <div class="timeline-body"><p>i tried to come up with something better but i agree a really high patch number is the really the best we can do here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/settings/pyproject.rs</code>:135 on 2023-03-13 09:29</div>
            <div class="timeline-body"><p>could you add a <code>debug!</code> for that? my idea is that when someone goes &quot;why is ruff not picking this up?&quot; they can run <code>RUST_LOG=ruff=debug</code> and get the answer</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/settings/types.rs</code>:287 on 2023-03-13 09:32</div>
            <div class="timeline-body"><p>good point, i've also taken this in https://github.com/konstin/pep440-rs/commit/08f3e6b2d91fa1d257cbb2675e0fc22645b2701c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-03-13 09:33</div>
            <div class="timeline-body"><p>neat!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/types.rs</code>:71 on 2023-03-13 13:13</div>
            <div class="timeline-body"><p>@konstin, do you have a more elegant way to do this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-13 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/types.rs</code>:71 on 2023-03-13 13:23</div>
            <div class="timeline-body"><p>Never mind, I forgot to check your previous comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-13 13:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/types.rs</code>:287 on 2023-03-13 13:34</div>
            <div class="timeline-body"><p>I replaced <code>RequiresVersion</code> with <code>VersionSpecifiers</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-13 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2023-03-13 13:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>crates/ruff/src/settings/types.rs</code>:289 on 2023-03-13 13:36</div>
            <div class="timeline-body"><p>Thanks, I pulled the new version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-13 14:02</div>
            <div class="timeline-body"><ul>
<li>Only missing konstin/pep440-rs#6, though this is optional.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-03-13 17:15</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-03-13 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-03-13 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-03-13 17:57</div>
            <div class="timeline-body"><p>You are welcome! ðŸ¤—</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-03-13 17:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2023-03-13 21:21</div>
            <div class="timeline-body"><p>Thanks for this patch !
@charliermarsh, shouldn't this be in the &quot;settings&quot; section of the release notes rather than in &quot;bug fixes&quot; ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-13 21:22</div>
            <div class="timeline-body"><p>Yes, thank you, I just updated them!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:47:32 UTC
    </footer>
</body>
</html>
