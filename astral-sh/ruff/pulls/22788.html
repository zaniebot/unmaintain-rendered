<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix: Fix false negative when sequence is an attribute - astral-sh/ruff #22788</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix: Fix false negative when sequence is an attribute</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22788">#22788</a>
        opened by <a href="https://github.com/leandrodamascena">@leandrodamascena</a>
        on 2026-01-21 14:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leandrodamascena">@leandrodamascena</a></div>
            <div class="timeline-body">

Summary
<p>Fixes #22780</p>
<p>PLC1802 was not triggering when the sequence passed to len() was an attribute like <code>self.fruits</code>, for example. I had the similar issue in my code.</p>
<p>I extended <code>is_indirect_sequence</code> to handle Expr::Attribute in addition to Expr::Name.</p>
<p>This is my first contribution here, so, happy to make any change.</p>
Test Plan
<p>Added test cases to <code>len_as_condition.py </code>and updated the snapshot. And I ran the exact example from the issue:</p>
<pre><code>$ echo &#x27;class Fruits:
    fruits: list[str]

    def __init__(self):
        self.fruits = [&quot;apple&quot;, &quot;orange&quot;]

        if len(self.fruits):
            ...

fruits = [&quot;apple&quot;, &quot;orange&quot;]
if len(fruits):
    ...&#x27; | cargo run -p ruff -- check --select PLC1802 -
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2026-01-21 14:40</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+2 -0 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+2 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --no-preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/a47b69e6c06ba906fb481d799089b59f5f09926d/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3220">airflow-core/tests/unit/jobs/test_scheduler_job.py:3220:16:</a> PLC1802 [*] `len(dag_listener.success)` used as condition without comparison
+ <a href="https://github.com/apache/airflow/blob/a47b69e6c06ba906fb481d799089b59f5f09926d/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3220">airflow-core/tests/unit/jobs/test_scheduler_job.py:3220:45:</a> PLC1802 [*] `len(dag_listener.failure)` used as condition without comparison
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLC1802 | 2 | 2 | 0 | 0 | 0 |</p>
</p>


Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+2 -0 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+2 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/a47b69e6c06ba906fb481d799089b59f5f09926d/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3220">airflow-core/tests/unit/jobs/test_scheduler_job.py:3220:16:</a> PLC1802 [*] `len(dag_listener.success)` used as condition without comparison
+ <a href="https://github.com/apache/airflow/blob/a47b69e6c06ba906fb481d799089b59f5f09926d/airflow-core/tests/unit/jobs/test_scheduler_job.py#L3220">airflow-core/tests/unit/jobs/test_scheduler_job.py:3220:45:</a> PLC1802 [*] `len(dag_listener.failure)` used as condition without comparison
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLC1802 | 2 | 2 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-21 14:54</div>
            <div class="timeline-body"><p>Thanks for working on this!</p>
<p>I commented something similar on the issue, but I&#x27;m a bit skeptical about making this change. I believe the proposed changes will only catch a very specific instance of this problem and could also result in new false positives. For example, how do your changes handle cases like:</p>
<pre><code># Redefinition in a method
class C:
	def foo(self):
		self.field = []
		self.update_field()
		if len(self.field): ...

	def update_field(self):
		self.field = None

# Conditional definition
class C:
	def foo(self, field: SomethingElse | None = None):
		if self.field is None:
			self.field = []
		if len(self.field): ...
</code></pre>
<p>I don&#x27;t think it&#x27;s worth the added complexity in the rule code to handle such a small subset of attribute assignments. I also think we&#x27;ll inherit ty&#x27;s improved capabilities around resolving attributes in the future, so I&#x27;d be inclined to wait for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leandrodamascena">@leandrodamascena</a> on 2026-01-21 14:58</div>
            <div class="timeline-body"><p>I went and tested both cases:</p>
<p>Case 1 (redefinition): My implementation triggers a false positive here - it sees self.field = [] and flags len(self.field), but doesn&#x27;t account for update_field() potentially changing it to None.</p>
<p>Case 2 (conditional): Doesn&#x27;t trigger (good), but only by accident since the assignment is inside an if block.</p>
<p>I didn&#x27;t think about this in the beginner and probably the added complexity isn&#x27;t worth it for such a narrow fix that can still produce false positives.</p>
<p>I think makes sense to wait for ty&#x27;s improved attribute resolution.</p>
<p>Do you want me to close this PR?</p>
<p>BTW, do you have any other easy/medium complexity issues to work? I&#x27;d like to contribute with the project oftern :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-21 15:48</div>
            <div class="timeline-body"><p>Thanks for taking a look at the test cases and again for working on this! Yeah let&#x27;s go ahead and close this for now, but I&#x27;m open to other opinions if others support this change :) @amyreese triaged the issue, so she may want to weigh in.</p>
<blockquote>
<p>BTW, do you have any other easy/medium complexity issues to work? I&#x27;d like to contribute with the project oftern :)</p>
</blockquote>
<p>Anything with the <a href="https://github.com/astral-sh/ruff/issues?q=sort%3Aupdated-desc%20is%3Aissue%20is%3Aopen%20label%3A%22help%20wanted%22">help wanted</a> or <a href="https://github.com/astral-sh/ruff/issues?q=sort%3Aupdated-desc%20is%3Aissue%20is%3Aopen%20label%3A%22good%20first%20issue%22">good first issue</a> labels without someone assigned or an open PR is a good place to start, although we may be a bit light on those at the moment. The <a href="https://github.com/astral-sh/ruff/issues?q=sort%3Aupdated-desc%20is%3Aissue%20is%3Aopen%20label%3Abug">bug</a> label would be the next best place to look, avoiding any with <code>type-inference</code> or <code>needs-decision</code> labels.</p>
<p>I&#x27;m a bit biased, but there are two tracking issues that I&#x27;d be glad to review PRs for too: <a href="https://github.com/astral-sh/ruff/issues/15642">astral-sh/ruff#15642</a> and <a href="https://github.com/astral-sh/ruff/issues/17203">astral-sh/ruff#17203</a>. Feel free to ping me on any issues that look interesting, if you need advice on where to start.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-21 15:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 16:07:29 UTC
    </footer>
</body>
</html>
