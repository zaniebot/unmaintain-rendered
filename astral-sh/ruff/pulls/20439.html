<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add imports when an unimported completion is selected - astral-sh/ruff #20439</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add imports when an unimported completion is selected</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20439">#20439</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-09-16 17:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This PR does the work necessary to make the &quot;import&quot;
part of &quot;auto-import&quot; work. That is, when an unimported
completion is found, it is now returned with an LSP text
edit for inserting an import that should bring that symbol
into scope.</p>
<p>The diffstat here is quite large, but a bulk of that are
tests. And this PR should be reviewed commit-by-commit.
Many of the commits are somewhat smaller refactorings.
The last commit is where the new <code>Importer</code> abstraction is
introduced, and it&#x27;s where (arguably) most of the weeds are.</p>
<p>For now, I&#x27;ve not concerned myself with performance in order
to avoid getting distracted by it. In particular, every
unimported completion gets an edit generated for it. This
strikes me as sub-optimal, and indeed, it looks like the
LSP protocol has support for running &quot;commands&quot; in response
to a completion being selected. Future work might involve
taking advantage of that, but it&#x27;s not clear to me yet how
expensive (relatively speaking) generating these edits
actually is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/dcreager">@dcreager</a> removed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 17:45</div>
            <div class="timeline-body"><p>Demo:</p>
<p>https://github.com/user-attachments/assets/e381082a-bc82-4f7e-b21b-e9f4a094a3cc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-16 17:46</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-16 17:49</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅
No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-16 17:58</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-16 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-09-16 18:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_python_importer/src/insertion.rs</code>:180 on 2025-09-16 18:37</div>
            <div class="timeline-body"><p>This is how I avoided using <code>libcst</code>. I believe this is the only use of libcst in ruff&#x27;s existing importer abstraction: https://github.com/astral-sh/ruff/blob/aa63c24b8f4a82f5f54dc90c4e6b5adadbf3e1b2/crates/ruff_linter/src/importer/mod.rs#L470-L488</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_diagnostics/src/edit.rs</code>:69 on 2025-09-17 08:01</div>
            <div class="timeline-body"><p>Is this only so that you don&#x27;t need to import <code>Ranged</code> to call <code>Range</code> because <code>Edit</code> implements <code>Ranged</code> (and, therefore, has a <code>edit.range</code> method)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_source_file/src/locator.rs</code>:16 on 2025-09-17 08:08</div>
            <div class="timeline-body"><p>Hmm, I was hoping we could eventually remove <code>Locator</code>. What I dislike about the type is that its lazy computation of the index is a bit of a footgun (which is why all those methods are marked as deprecated).</p>
<p>But <code>Locator</code> isn&#x27;t much more than a <code>&amp;str</code> if you remove all methods that don&#x27;t use a <code>LineIndex</code> (<code>&amp;str</code> also implements <code>LineRanges</code>). The only difference are the helper methods like <code>after</code>, <code>before</code> that work with <code>TextRanges</code>.</p>
<p>I don&#x27;t think it&#x27;s worth spending too much time but is there maybe a way we could decouple <code>Importer</code> from <code>Locator</code> (e.g. by just using a <code>&amp;str</code> and exposing some of those helper methods with a different trait on <code>&amp;str</code> which I think could be useful in other places too)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:15 on 2025-09-17 08:12</div>
            <div class="timeline-body"><p>The <code>convert_edit</code> calls confused me a fair bit because I didn&#x27;t realize that there are now two <code>Edit</code> types.</p>
<p>Given that <code>ruff_diagnostics</code> has very few dependencies, could we just reuse that type instead of duplicating its definition?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/stylist.rs</code>:44 on 2025-09-17 08:21</div>
            <div class="timeline-body"><p>Neat!</p>
<p>But I&#x27;m not sure if this is actually needed, given that we only need <code>into_owned</code> in tests and only in tests that call <code>import</code> (or <code>import_from</code>) of which, I think, most tests only contain exactly one call.</p>
<p>I&#x27;m leaning towards creating the <code>Stylist</code> ad-hoc on demand. The only downside is that we compute the <code>line_ending</code> a few more times than necessary but that should be neglectable, given that most test files have very short lines (it only searches for the first line ending)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_importer/src/insertion.rs</code>:180 on 2025-09-17 08:25</div>
            <div class="timeline-body"><p>I&#x27;m only mid-through reviewing this PR and I&#x27;m going commit-by-commit as suggested so I don&#x27;t know if you did this in a later commit.</p>
<p>I suggest adding extensive testing for this function, specifically in the presence of comments.</p>
<pre><code>from collections import (
	Collector # comment
)

from collections import (
	Collector, # comment
)

from collections import (
	Collector # comment
    ,
)

from collections import (
	Collector
    # comment
    ,
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:62 on 2025-09-17 08:30</div>
            <div class="timeline-body"><p>@sharkdp do you see any issues with this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/all_symbols.rs</code>:68 on 2025-09-17 08:35</div>
            <div class="timeline-body"><p>Given that this invariant exists, should we remove file and instead use <code>module.file(db)</code> to get the file or do we want to keep <code>file</code> because it is guaranteed that <code>Module</code> is never a <code>NamespacePackage</code>?</p>
<p>Another alternative would be to use <code>file_to_module(db, file)</code>, but I guess this has the same downside that it requires you to handle the <code>None</code> case</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_wasm/src/lib.rs</code>:428 on 2025-09-17 08:41</div>
            <div class="timeline-body"><p>Would you mind adding the new fields here too (and wire them up in the playground?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:15 on 2025-09-17 08:43</div>
            <div class="timeline-body"><p>We should consider this very carefully, given that the <code>SemanticIndex</code> is constructed for every file but adding imports is only used very rarely. I think re-walking the tree here is perfectly fine (and should be very fast too).</p>
<p>An alternative is to introduce a <code>top_level_imports</code> query that caches the result but I don&#x27;t think that&#x27;s worth it because it needs to re-run on every AST change anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:67 on 2025-09-17 08:44</div>
            <div class="timeline-body"><p>Didn&#x27;t you abstract away the only libcst usage (which would be great, because libcst is pretty large and chunky to build)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:142 on 2025-09-17 08:47</div>
            <div class="timeline-body"><p>Should this documentation be moved to <code>members.at</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:232 on 2025-09-17 08:49</div>
            <div class="timeline-body"><pre><code>            // sorted by their start location in the source.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:239 on 2025-09-17 08:49</div>
            <div class="timeline-body"><pre><code>                if choice
                    .is_none_or(|c| !c.kind.is_prioritized_over(&amp;response.kind))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:726 on 2025-09-17 09:00</div>
            <div class="timeline-body"><p>I think we&#x27;ll want to support those for type-checking only imports. I think it&#x27;s totally fine that this PR ignores those, but we should think about when we should add support for them.</p>
<p>Unlike Rust, importing a module has a runtime cost. Because of that, Python supports type-checking only imports, to avoid importing modules that are only needed to type some API.</p>
<p>The way type-checking only imports work in Python is that the imports are gated by an <code>if TYPE_CHECKING</code> guard (it&#x27;s a well-known constant by type checkers or it can be imported from the typing module):</p>
<pre><code>from typing import TYPE_CHECKING

if TYPE_CHECKING:
    import foo
</code></pre>
<p>Now, symbols imported in a <code>TYPE_CHECKING</code> block aren&#x27;t available at runtime. That means, they should only be suggested when in a type position (and e.g. not in the condition of an <code>if</code> statement).</p>
<p>It&#x27;s also preferred to add the imports to an <code>if TYPE_CHECKING</code> block if the import is only used for type checking.</p>
<p>I don&#x27;t know how far existing LSPs go here but Ruff has a few rules to help with this: https://docs.astral.sh/ruff/rules/#flake8-type-checking-tc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:711 on 2025-09-17 09:02</div>
            <div class="timeline-body"><p>You could consider implementing <code>SourceOrderVisitor</code> instead to remove the need to sort the import statements after visiting because the ordering is already guaranteed by the visitor.</p>
<p>The only drawback is that there&#x27;s no statements only equivalent of it but it should be relatively easy to skip unnecessary nodes by overriding <code>enter_node</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_ide/src/importer.rs</code>:1356 on 2025-09-17 09:05</div>
            <div class="timeline-body"><p>I think there&#x27;s a third option to alias the import. That&#x27;s probably what I would expect but I also think it&#x27;s fine to leave this as is for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:247 on 2025-09-17 09:07</div>
            <div class="timeline-body"><p>Can we remove the TODO here, considering that it&#x27;s repeated in <code>scope</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-09-17 09:09</div>
            <div class="timeline-body"><p>This is great!</p>
<p>I think it would be nice to make use of the LSPs lazy resolution of completion metadata (e.g. lazily resolve the <code>Type</code> of a `Completion) but I agree with your scoping that we should leave this to a separate improvement.</p>
<p>We probably also want some more advanced sorting of completion items to e.g. use the closest (and most high-level) re-export of a symbol over importing it from a very deeply nested submodule (or from a test!). But again, these are incremental improvements that we can make later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:2 on 2025-09-17 09:37</div>
            <div class="timeline-body"><pre><code>Low-level helpers for manipulating Python import statements.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:73 on 2025-09-17 09:38</div>
            <div class="timeline-body"><pre><code>    /// Returns `None` if this edit is a deletion.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:7 on 2025-09-17 09:42</div>
            <div class="timeline-body"><pre><code>Both of them use the lower-level `ruff_python_importer::{Edit, Insertion}`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:10 on 2025-09-17 09:42</div>
            <div class="timeline-body"><pre><code>1. This works with ty&#x27;s semantic model instead of ruff&#x27;s.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:15 on 2025-09-17 09:42</div>
            <div class="timeline-body"><pre><code>   `Importer` into ty&#x27;s `SemanticIndex`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:150 on 2025-09-17 09:49</div>
            <div class="timeline-body"><pre><code>    /// request&#x27;s `member`, it can be different. For example, there
    /// might be an alias, or the corresponding module might already
    /// be imported in a qualified way.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:172 on 2025-09-17 09:49</div>
            <div class="timeline-body"><pre><code>                // As long as it&#x27;s not a wildcard import, we use whatever name
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:260 on 2025-09-17 09:51</div>
            <div class="timeline-body"><pre><code>/// [`Importer::members_in_scope_at`] in order to use the [`Importer::import`] API.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:526 on 2025-09-17 09:54</div>
            <div class="timeline-body"><pre><code>                // ...unless the symbol we want is already
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:530 on 2025-09-17 09:55</div>
            <div class="timeline-body"><pre><code>            // ...unless the module symbol we found here is
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:547 on 2025-09-17 09:55</div>
            <div class="timeline-body"><pre><code>            // symbol is definitely in scope, we attempt a
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:598 on 2025-09-17 10:02</div>
            <div class="timeline-body"><pre><code>/// statement satisfy an [`ImportRequest`]? This encodes the different
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:632 on 2025-09-17 10:08</div>
            <div class="timeline-body"><pre><code>    /// It is guaranteed that this never contains a wildcard import
    /// (otherwise, this import wouldn&#x27;t be partial).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:1019 on 2025-09-17 10:33</div>
            <div class="timeline-body"><p>the motivation there is almost certainly so that a snapshot that includes paths in some ways will pass on both Unix and Windows systems. But it feels like we probably shouldn&#x27;t have that filter enabled on this snapshot assertion?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:1240 on 2025-09-17 10:34</div>
            <div class="timeline-body"><pre><code>        // we add another import at the top level
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:1266 on 2025-09-17 10:35</div>
            <div class="timeline-body"><pre><code>        // we add another import at the top level
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:1369 on 2025-09-17 10:36</div>
            <div class="timeline-body"><pre><code>    /// prompt the user for what they want to do. But I think
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/lib.rs</code>:358 on 2025-09-17 10:37</div>
            <div class="timeline-body"><pre><code>    /// The file, and the offset into that file where the `&lt;CURSOR&gt;` marker is located.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:277 on 2025-09-17 10:39</div>
            <div class="timeline-body"><p>As @carljm said in <a href="https://github.com/astral-sh/ruff/pull/18455">astral-sh/ruff#18455</a>#discussion_r2126833137, I think we should just remove this TODO. Using a non-panicking method here seems better in the long term; I don&#x27;t think we should ever change this.</p>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/insertion.rs</code>:154 on 2025-09-17 10:41</div>
            <div class="timeline-body"><pre><code>    /// newline terminator. Callers can then call [`Insertion::into_edit`]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/insertion.rs</code>:166 on 2025-09-17 10:41</div>
            <div class="timeline-body"><pre><code>        // ...however, unless we can be certain that
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:35 on 2025-09-17 10:42</div>
            <div class="timeline-body"><pre><code>    /// [`Edit::deletion`] with the given range.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:51 on 2025-09-17 10:42</div>
            <div class="timeline-body"><pre><code>    /// [`Edit::deletion`] with the given range.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:81 on 2025-09-17 10:43</div>
            <div class="timeline-body"><p>Or you could implement <code>Ranged</code> for <code>Edit</code>? Then you&#x27;d also get <code>start()</code> and <code>end()</code> methods for free</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:47 on 2025-09-17 10:44</div>
            <div class="timeline-body"><pre><code>    /// may be cheaper to compute at scale (e.g., for
    /// unimported symbol completions).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:49 on 2025-09-17 10:44</div>
            <div class="timeline-body"><pre><code>    /// Callers should use [`Completion::kind`] to get the
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:66 on 2025-09-17 10:47</div>
            <div class="timeline-body"><p>Just to double-check: you&#x27;re using &quot;builtins&quot; here to refer to the <code>builtins</code> module/namespace in the stdlib rather than &quot;any stdlib module from our vendored typeshed&quot;, right?</p>
<p>(If so, you&#x27;re using the term correctly, but I&#x27;ve seen it used incorrectly in some places in ty, so I&#x27;m just double-checking ;) )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:165 on 2025-09-17 10:48</div>
            <div class="timeline-body"><pre><code>/// The idea here is that [`Completion::kind`] defines the mapping to this from
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:278 on 2025-09-17 10:49</div>
            <div class="timeline-body"><pre><code>        // FIXME: `all_symbols` doesn&#x27;t account for wildcard imports. Since
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:57 on 2025-09-17 10:50</div>
            <div class="timeline-body"><pre><code>    /// The [`Stylist`] dictates the code formatting options of any code
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:63 on 2025-09-17 10:50</div>
            <div class="timeline-body"><pre><code>    /// The [`Locator`] is used to get access to the original source
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:101 on 2025-09-17 10:50</div>
            <div class="timeline-body"><pre><code>    /// [`ruff_text_size::Ranged`] trait). However, in some cases, identifying
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:376 on 2025-09-17 10:51</div>
            <div class="timeline-body"><pre><code>    /// [`ImportRequest`], but this may sometimes be fully qualified based on
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/module_name.rs</code>:279 on 2025-09-17 10:53</div>
            <div class="timeline-body"><pre><code>    /// `importing_file` must be the [`File`] that contains the import
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-09-17 10:55</div>
            <div class="timeline-body"><p>This looks very exciting!!</p>
<p>The documentation you&#x27;ve added is (as usual) fantastic. I did spot a few typos reading through the comments, so I ended up doing a docs-only review pass (sorry if some comments here are a bit nitpicky!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_diagnostics/src/edit.rs</code>:69 on 2025-09-17 14:01</div>
            <div class="timeline-body"><p>Nope, just completely missed the <code>Ranged</code> impl. :P</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_source_file/src/locator.rs</code>:16 on 2025-09-17 14:06</div>
            <div class="timeline-body"><p>Yeah I noticed this. <code>Locator</code> struck me as odd for the reasons you cite. But I was trying to find a balance between &quot;make progress&quot; and &quot;refactor.&quot; :P</p>
<p>The only reason I&#x27;m using it is because <code>Insertion</code> uses it.</p>
<p>But I think you&#x27;re right. It looks like <code>Insertion</code> isn&#x27;t using any of the methods that use the <code>LineIndex</code>. If not, I can refactor that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_source_file/src/locator.rs</code>:16 on 2025-09-17 14:45</div>
            <div class="timeline-body"><p>Done! I also moved <code>Locator</code> back into <code>ruff_linter</code>. <em>And</em> I removed <code>Locator</code> from <code>ruff_linter</code>&#x27;s <code>Importer</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:15 on 2025-09-17 14:50</div>
            <div class="timeline-body"><p>I guess that&#x27;s fine with me. I was trying to avoid bringing <code>ruff_diagnostics</code> into the ty world. And the type is very simple, so I don&#x27;t think duplicating it is terrible. Moreover, I feel like <code>ruff_python_importer</code> should probably own the types that it returns, but that&#x27;s a vague API design nit. But this is done now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_python_codegen/src/stylist.rs</code>:44 on 2025-09-17 15:01</div>
            <div class="timeline-body"><p>It&#x27;s a little more subtle than that. An <code>Importer</code> wants a <code>&amp;Stylist</code>. So if we create a <code>Stylist</code> on-demand, it can&#x27;t be tied to the stack frame that creates an <code>Importer</code> <em>and</em> returns that importer.</p>
<p>There are a lot of different ways around this. A <code>Stylist</code> could always own its source for example. Or the tests could always be required to create an <code>Importer</code> in the same stack frame (or above) as where it&#x27;s used.</p>
<p>But I found this to be simple and it follows a standard API pattern in Rust libraries for creating borrowed/owned versions of the same type. And I don&#x27;t think the cost here is that big.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/all_symbols.rs</code>:68 on 2025-09-17 15:04</div>
            <div class="timeline-body"><p>Yeah I kept both to avoid the unwraps and because I perceived there to be little-to-no cost in doing so. And if and when we ever refactor this to use namespace packages, the types will help a bit more I think since it will force us to confront the fact that a <code>File</code> may be missing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_wasm/src/lib.rs</code>:428 on 2025-09-17 15:16</div>
            <div class="timeline-body"><p>Yes! Done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:15 on 2025-09-17 15:19</div>
            <div class="timeline-body"><p>Yeah that is actually the same instinct that led me to <em>not</em> try to add it to the semantic index. Here, I was only talking about doing so <em>if</em> for some reason this was needed more broadly. But yeah, I can&#x27;t think of why we would need it more broadly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:67 on 2025-09-17 15:19</div>
            <div class="timeline-body"><p>Yeah I wrote this comment when I thought I wouldn&#x27;t be able to do that. Fixed now. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:142 on 2025-09-17 15:20</div>
            <div class="timeline-body"><p>Yup, done. It was already moved (with some edits), but I forgot to delete it here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:239 on 2025-09-17 15:22</div>
            <div class="timeline-body"><p>Blech. Done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:726 on 2025-09-17 15:24</div>
            <div class="timeline-body"><p>Yeah good call out! I thought about this when working on the importer, but the &quot;how do you know when it should go into a <code>TYPE_CHECKING</code> block&quot; seemed like it was big enough to be worth punting on for now. I&#x27;ve added this to my notes for completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:711 on 2025-09-17 15:30</div>
            <div class="timeline-body"><p>All righty. Seems sensible. Done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:1356 on 2025-09-17 15:31</div>
            <div class="timeline-body"><p>Yeah I was talking about that with Zanie. It&#x27;s definitely not clear to me that aliasing would be better... But we can wait for user feedback on this one. Either way, I think if we did want to go the alias route, it wouldn&#x27;t be hard to bolt that on to what I have here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:247 on 2025-09-17 15:32</div>
            <div class="timeline-body"><p>Sure, done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:526 on 2025-09-17 15:37</div>
            <div class="timeline-body"><p>Hmmm I prefer the space after the <code>...</code> here. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:547 on 2025-09-17 15:38</div>
            <div class="timeline-body"><p>I meant &quot;definitively&quot; here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:1019 on 2025-09-17 15:42</div>
            <div class="timeline-body"><p>Hmmm. The filter here is</p>
<pre><code>insta_settings.add_filter(r#&quot;\\(\w\w|\s|\.|&quot;)&quot;#, &quot;/$1&quot;);
</code></pre>
<p>That <code>\s</code> is what threw me off here, since I don&#x27;t think that usually helps with file paths. I&#x27;d guess that was probably copied from elsewhere.</p>
<p>In any case, just removing the <code>\s</code> alternation fixed things and makes this snapshot read better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/importer.rs</code>:1240 on 2025-09-17 15:44</div>
            <div class="timeline-body"><p>I think if <code>low-level</code> is supposed to be hyphenated then <code>top-level</code> ought to be as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/semantic_model.rs</code>:277 on 2025-09-17 15:47</div>
            <div class="timeline-body"><p>Fair. Done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_python_importer/src/lib.rs</code>:81 on 2025-09-17 15:48</div>
            <div class="timeline-body"><p>Yeah I ended up just deleting this type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_ide/src/completion.rs</code>:66 on 2025-09-17 15:50</div>
            <div class="timeline-body"><p>I believe so, yes. Specifically, however ty uses &quot;builtin.&quot; <code>builtin</code> here is <code>true</code> when <code>module.is_known(self.db, KnownModule::Builtins)</code> is <code>true</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_python_importer/src/insertion.rs</code>:180 on 2025-09-17 17:07</div>
            <div class="timeline-body"><p>Done! I figured I was forgetting something obvious. Perhaps surprising, my implementation passes all the tests. (In the sense that it still generates valid Python source, although I wouldn&#x27;t call the formatting ideal. Although perhaps some of your examples don&#x27;t have ideal formatting in the first place.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-09-17 17:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-17 17:59</div>
            <div class="timeline-body"><p>Going to bring this in, but I&#x27;m happy to address additional feedback in follow-ups. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-17 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-17 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-17 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-09-17 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/importer.rs</code>:1240 on 2025-09-17 18:11</div>
            <div class="timeline-body"><p>Unfortunately whether either &quot;top-level&quot; or &quot;low-level&quot; should be hyphenated or not depends on the context of whether it&#x27;s being used as a compound adjective (but this is definitely not worth worrying about :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-09-18 07:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:62 on 2025-09-18 07:08</div>
            <div class="timeline-body"><p>I only added the <code>single_declaration</code> field in the return type of <code>place_from_declarations</code> recently. We could probably do something similar and add a <code>single_binding</code> or <code>single_definition</code> field in the return type of <code>place_from_bindings</code>, so as to avoid the additional traversal here?</p>
<p>A case where this (and the <code>single_declaration</code> / <code>single_binding</code> fields) would fail to return a single definition would be:</p>
<pre><code>if flag:
    x = 1
else:
    x = 2

# there are two live bindings of `x` at the end of the scope here, each with its own definition
</code></pre>
<p>I haven&#x27;t thought through the implications here (I don&#x27;t know what we use the definition field for, downstream), but it&#x27;s maybe worth at least adding some tests for?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-09-18 07:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:62 on 2025-09-18 07:09</div>
            <div class="timeline-body"><p><em>Somewhat</em> related discussion that describes another shortcoming of our <code>place_from_{declarations,bindings}</code> API: <a href="https://github.com/astral-sh/ty/issues/1051">astral-sh/ty#1051</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ty_python_semantic/src/types/ide_support.rs</code>:62 on 2025-09-18 13:12</div>
            <div class="timeline-body"><p>Yeah <a href="https://github.com/astral-sh/ty/issues/1051">astral-sh/ty#1051</a> looks very wise here.</p>
<p>I explored this a bit by adding several test cases in this PR: <a href="https://github.com/astral-sh/ruff/pull/20467">astral-sh/ruff#20467</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-09-18 13:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushter">@rushter</a> on 2025-09-19 20:15</div>
            <div class="timeline-body"><blockquote>
<p>Demo:</p>
<p>even-slicker-import-demo.mp4</p>
</blockquote>
<p>What lsp feature displays the import path (green text)?</p>
<p>In helix, I just see suggested names without imports. They are from different modules and there is no way to tell which is correct.</p>
<p><img alt="image" src="https://github.com/user-attachments/assets/6f15f27d-1e0a-4544-b1fc-8bd15568e6eb"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-19 20:28</div>
            <div class="timeline-body"><p>We put it in <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#completionItemLabelDetails"><code>CompletionItemLabelDetails.detail</code></a>. It does require LSP 3.17 though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushter">@rushter</a> on 2025-09-19 20:40</div>
            <div class="timeline-body"><blockquote>
<p>We put it in <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#completionItemLabelDetails"><code>CompletionItemLabelDetails.detail</code></a>. It does require LSP 3.17 though.</p>
</blockquote>
<p>Weird, I think they do support it. I tested ty on <code>0.0.1-alpha.21</code>, not from GitHub branch.</p>
<p>https://github.com/helix-editor/helix/blob/0ae37dc52ba715100893c327414bcb1a1924a4c3/helix-lsp-types/src/completion.rs#L559</p>
<p>I can see them in other LSPs.</p>
<p><img alt="image" src="https://github.com/user-attachments/assets/db795ccc-da43-4b85-b830-3b68b358d99b"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushter">@rushter</a> on 2025-09-19 20:48</div>
            <div class="timeline-body"><p>I&#x27;m getting the same behavior in Zed as well. Will test it more tomorrow.</p>
<p><img alt="image" src="https://github.com/user-attachments/assets/54d2ae9e-374e-4b89-9252-aee6cb300f8d"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-19 20:55</div>
            <div class="timeline-body"><blockquote>
<p>Weird, I think they do support it. I tested ty on <code>0.0.1-alpha.21</code>, not from GitHub branch.</p>
</blockquote>
<p>Hmmm, <a href="https://github.com/astral-sh/ruff/pull/20466">this</a> might be related and I don&#x27;t think made it into <code>0.0.1-alpha.21</code>? Although that shouldn&#x27;t prevent it from showing up at all.</p>
<blockquote>
<p>Will test it more tomorrow.</p>
</blockquote>
<p>Thank you!!! &lt;3</p>
<blockquote>
<p>I can see them in other LSPs.</p>
</blockquote>
<p>Hmmm that&#x27;s not showing the import path though as far as I can see. It&#x27;s just showing the kind. Although ty should be including the kind too, and that doesn&#x27;t seem to be showing up for you either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushter">@rushter</a> on 2025-09-19 21:44</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Weird, I think they do support it. I tested ty on <code>0.0.1-alpha.21</code>, not from GitHub branch.</p>
</blockquote>
<p>Hmmm, <a href="https://github.com/astral-sh/ruff/pull/20466">this</a> might be related and I don&#x27;t think made it into <code>0.0.1-alpha.21</code>? Although that shouldn&#x27;t prevent it from showing up at all.</p>
<blockquote>
<p>Will test it more tomorrow.</p>
</blockquote>
<p>Thank you!!! &lt;3</p>
<blockquote>
<p>I can see them in other LSPs.</p>
</blockquote>
<p>Hmmm that&#x27;s not showing the import path though as far as I can see. It&#x27;s just showing the kind. Although ty should be including the kind too, and that doesn&#x27;t seem to be showing up for you either.</p>
</blockquote>
<p>Installed from the main branch. Here is what I see in LSP logs of helix:</p>
<pre><code> {
      &quot;additionalTextEdits&quot;: [
        {
          &quot;newText&quot;: &quot;from selectolax.parser import HTMLParser\n&quot;,
          &quot;range&quot;: { &quot;end&quot;: { &quot;character&quot;: 0, &quot;line&quot;: 7 }, &quot;start&quot;: { &quot;character&quot;: 0, &quot;line&quot;: 7 } }
        }
      ],
      &quot;insertText&quot;: &quot;HTMLParser&quot;,
      &quot;kind&quot;: 7,
      &quot;label&quot;: &quot;HTMLParser&quot;,
      &quot;labelDetails&quot;: { &quot;detail&quot;: &quot; (import selectolax.parser)&quot; },
      &quot;sortText&quot;: &quot; 56&quot;
    },
    {
      &quot;additionalTextEdits&quot;: [
        {
          &quot;newText&quot;: &quot;from html.parser import HTMLParser\n&quot;,
          &quot;range&quot;: { &quot;end&quot;: { &quot;character&quot;: 0, &quot;line&quot;: 7 }, &quot;start&quot;: { &quot;character&quot;: 0, &quot;line&quot;: 7 } }
        }
      ],
      &quot;insertText&quot;: &quot;HTMLParser&quot;,
      &quot;kind&quot;: 7,
      &quot;label&quot;: &quot;HTMLParser&quot;,
      &quot;labelDetails&quot;: { &quot;detail&quot;: &quot; (import html.parser)&quot; },
      &quot;sortText&quot;: &quot; 57&quot;
    },
</code></pre>
<p>So I guess label details are not fully supported. Not sure why kind does not work though...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushter">@rushter</a> on 2025-09-20 10:00</div>
            <div class="timeline-body"><p>Checked how it&#x27;s done in other LSP.s
Rust analyzer just appends it to label:</p>
<pre><code>        &quot;label&quot;: &quot;PatternMatchAs(use ruff_python_ast::PatternMatchAs)&quot;,
</code></pre>
<p>gopls puts it in the description (if it&#x27;s a module import).:</p>
<pre><code>&quot;label&quot;: &quot;unsafeheader&quot;,
&quot;kind&quot;: 9,
 &quot;detail&quot;: &quot;\&quot;internal/unsafeheader\&quot;&quot;,
</code></pre>
<p>It looks like even Zed does not support labelDetails yet, so perhaps it&#x27;s better to put it somewhere else for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-20 13:37</div>
            <div class="timeline-body"><p>Oh nice find! I missed that in r-a. I think you&#x27;re right that stuffing it somewhere else if the LSP doesn&#x27;t support <code>labelDetails</code> would be wise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-10-28 15:35</div>
            <div class="timeline-body"><p>@rushter I didn&#x27;t forget about your bug! It should be fixed in <a href="https://github.com/astral-sh/ruff/pull/21109">astral-sh/ruff#21109</a> :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushter">@rushter</a> on 2025-10-28 15:57</div>
            <div class="timeline-body"><blockquote>
<p>@rushter I didn&#x27;t forget about your bug! It should be fixed in #21109 :-)</p>
</blockquote>
<p>Thanks! I was checking the recent ty changes yesterday for autocomplete improvements :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:43 UTC
    </footer>
</body>
</html>
