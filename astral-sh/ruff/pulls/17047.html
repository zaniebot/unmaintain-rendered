<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Allow `CallableTypeFromFunction` to display the signatures of callable types that are not function literals - astral-sh/ruff #17047</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Allow <code>CallableTypeFromFunction</code> to display the signatures of callable types that are not function literals</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17047">#17047</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-03-28 19:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><p>I found this helpful for understanding some of the stuff that was going on in <a href="https://github.com/astral-sh/ruff/pull/17005">astral-sh/ruff#17005</a>. It means the name of the special form is perhaps no longer ideal; I could possibly rename it if we agree that this is a useful feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-28 19:31</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ‚úÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-03-28 19:42</div>
            <div class="timeline-body"><p>This looks good to me! I would probably rename to <code>CallableTypeOf</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 20:20</div>
            <div class="timeline-body"><p>Renamed it to <code>CallableTypeOf</code>!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-28 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-28 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-28 20:32</div>
            <div class="timeline-body"><p>Looks good üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> reviewed on 2025-03-29 13:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_api.md</code>:457 on 2025-03-29 13:02</div>
            <div class="timeline-body"><p>Should c5 be stored as <code>(x: int) -&gt; str</code>, or stored as <code>(self, x: int) -&gt; str</code> and treated like <code>(x: int) -&gt; str</code>?</p>
<p>@AlexWaygood @carljm</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-03-30 18:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_api.md</code>:457 on 2025-03-30 18:04</div>
            <div class="timeline-body"><p>Not entirely sure! I think this requires deeper exploration. Today we do the latter. There are a couple interesting questions that it connects to:</p>
<ol>
<li><p>How do we handle equivalent callable types? If we aim for &quot;equivalent callable types are always the same Salsa ID&quot; then it should actually be stored as <code>(x: int) -&gt; str</code>. But I don&#x27;t think it&#x27;s totally clear yet if that will be feasible.</p>
</li>
<li><p>When do we issue an error on calling a bound method with an annotation on the <code>self</code> argument that doesn&#x27;t match the instance we accessed it from? Does it happen when accessing the bound method, or when calling it? The latter seems better (matches runtime better), but requires storing the bound self type and the full signature.</p>
</li>
</ol>
<p>It seems likely that we need to support both representations and understand their equivalence. (But maybe our &quot;general callable type&quot; uses only the simpler representation?)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:40 UTC
    </footer>
</body>
</html>
