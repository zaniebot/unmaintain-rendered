<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Add support for generic PEP695 type aliases - astral-sh/ruff #20219</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Add support for generic PEP695 type aliases</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20219">#20219</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2025-09-03 21:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a></div>
            <div class="timeline-body">Summary
<p>Adds support for generic PEP695 type aliases, e.g.,</p>
<pre><code>type A[T] = T
reveal_type(A[int]) # A[int]
</code></pre>
<p>Resolves <a href="https://github.com/astral-sh/ty/issues/677">astral-sh/ty#677</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typing</span> added by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-03 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-03 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-03 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-03 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-03 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-03 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-09-03 21:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/src/types.rs</code>:1307 on 2025-09-03 21:09</div>
            <div class="timeline-body"><p>For example, I&#x27;m not sure if delegating to <code>value_type</code> here is correct, because <code>value_type</code> returns a <code>Type::NominalInstance</code> for the RHS of the alias. I&#x27;m not very familiar with the typing hierarchy, but that doesn&#x27;t seem correct to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-09-03 21:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:482 on 2025-09-03 21:10</div>
            <div class="timeline-body"><p>Quite an unfortunate name here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-03 21:20</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-09-08 20:03:49.611822703 +0000
+++ new-output.txt	2025-09-08 20:03:52.598894420 +0000
@@ -1,5 +1,6 @@
 WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(1227a)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_type_statement.py`: `PEP695TypeAliasType &lt; &#x27;db &gt;::value_type_(Id(b416)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(1267a)): execute: too many cycle iterations`
 _directives_deprecated_library.py:15:31: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 _directives_deprecated_library.py:30:26: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
@@ -50,25 +51,6 @@
 aliases_newtype.py:18:1: error[invalid-assignment] Object of type `NewType` is not assignable to `type`
 aliases_newtype.py:26:21: error[invalid-base] Invalid class base with type `NewType`
 aliases_newtype.py:63:43: error[too-many-positional-arguments] Too many positional arguments to bound method `__init__`: expected 3, got 4
-aliases_type_statement.py:17:1: error[unresolved-attribute] Type `typing.TypeAliasType` has no attribute `bit_count`
-aliases_type_statement.py:19:1: error[call-non-callable] Object of type `TypeAliasType` is not callable
-aliases_type_statement.py:23:7: error[unresolved-attribute] Type `typing.TypeAliasType` has no attribute `other_attrib`
-aliases_type_statement.py:26:18: error[invalid-base] Invalid class base with type `typing.TypeAliasType`
-aliases_type_statement.py:37:22: error[invalid-type-form] Function calls are not allowed in type expressions
-aliases_type_statement.py:38:22: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[int, str]`?
-aliases_type_statement.py:39:22: error[invalid-type-form] Tuple literals are not allowed in this context in a type expression
-aliases_type_statement.py:39:23: error[invalid-type-form] Tuple literals are not allowed in this context in a type expression: Did you mean `tuple[int, str]`?
-aliases_type_statement.py:40:22: error[invalid-type-form] List comprehensions are not allowed in type expressions
-aliases_type_statement.py:41:22: error[invalid-type-form] Dict literals are not allowed in type expressions
-aliases_type_statement.py:42:22: error[invalid-type-form] Function calls are not allowed in type expressions
-aliases_type_statement.py:43:28: error[invalid-type-form] Int literals are not allowed in this context in a type expression
-aliases_type_statement.py:44:22: error[invalid-type-form] `if` expressions are not allowed in type expressions
-aliases_type_statement.py:45:22: error[invalid-type-form] Variable of type `Literal[1]` is not allowed in a type expression
-aliases_type_statement.py:46:23: error[invalid-type-form] Boolean literals are not allowed in this context in a type expression
-aliases_type_statement.py:47:23: error[invalid-type-form] Int literals are not allowed in this context in a type expression
-aliases_type_statement.py:48:23: error[invalid-type-form] Boolean operations are not allowed in type expressions
-aliases_type_statement.py:49:23: error[fstring-type-annotation] Type expressions cannot use f-strings
-aliases_type_statement.py:80:37: error[invalid-type-form] List literals are not allowed in this context in a type expression: Did you mean `tuple[int, str]`?
 aliases_variance.py:18:24: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassA[typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
 aliases_variance.py:28:16: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassA[typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
 aliases_variance.py:44:16: error[non-subscriptable] Cannot subscript object of type `&lt;class &#x27;ClassB[typing.TypeVar, typing.TypeVar]&#x27;&gt;` with no `__class_getitem__` method
@@ -866,5 +848,5 @@
 typeddicts_usage.py:28:1: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Invalid key access on TypedDict `Movie`: Unknown key &quot;title&quot;
 typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions. Did you mean to use a concrete TypedDict or `collections.abc.Mapping[str, object]` instead?
-Found 867 diagnostics
+Found 849 diagnostics
 WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-03 21:23</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>async-utils (https://github.com/mikeshardmind/async-utils)
+ src/async_utils/corofunc_cache.py:44:39: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:44:61: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:48:36: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:48:58: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:109:31: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:109:53: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:188:31: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/corofunc_cache.py:188:53: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/gen_transform.py:60:53: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/gen_transform.py:106:8: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:30:29: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:30:46: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:45:39: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:45:65: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:49:36: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:49:62: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:81:27: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:81:50: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:169:31: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:169:57: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:255:31: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ src/async_utils/task_cache.py:255:57: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
- Found 7 diagnostics
+ Found 29 diagnostics

artigraph (https://github.com/artigraph/artigraph)
+ tests/arti/internal/test_mappings.py:142:5: error[invalid-assignment] Object of type `Coord` is not assignable to attribute `z` on type `Unknown | int | Coord | TypedBox[Coord]`
+ tests/arti/internal/test_mappings.py:160:9: warning[possibly-unbound-attribute] Attribute `_dne` on type `Coord | TypedBox[Coord]` is possibly unbound
+ tests/arti/internal/test_mappings.py:162:9: error[invalid-assignment] Object of type `Unknown | Coord` is not assignable to attribute `_dne` on type `Coord | TypedBox[Coord]`
+ tests/arti/internal/test_mappings.py:172:5: error[invalid-assignment] Object of type `Unknown | Coord` is not assignable to attribute `coord` on type `Coord | TypedBox[Coord]`
+ tests/arti/internal/test_mappings.py:172:5: warning[possibly-unbound-attribute] Attribute `attribute` on type `Coord | TypedBox[Coord]` is possibly unbound
+ tests/arti/internal/test_mappings.py:172:5: warning[possibly-unbound-attribute] Attribute `child` on type `Coord | TypedBox[Coord]` is possibly unbound
- Found 133 diagnostics
+ Found 139 diagnostics

core (https://github.com/home-assistant/core)
+ homeassistant/components/androidtv/entity.py:46:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/androidtv/entity.py:46:49: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/androidtv/entity.py:54:15: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/androidtv/entity.py:55:10: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/cast/media_player.py:94:11: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/cast/media_player.py:95:6: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/hassio/addon_manager.py:37:6: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/hassio/addon_manager.py:37:42: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/hassio/addon_manager.py:43:15: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/hassio/addon_manager.py:44:10: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/heos/media_player.py:144:16: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/heos/media_player.py:144:36: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/heos/media_player.py:147:25: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/heos/media_player.py:147:47: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/http/decorators.py:33:6: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:34:5: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:44:12: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:45:6: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:53:12: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:59:10: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:60:9: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:62:7: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:67:15: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/http/decorators.py:68:10: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/husqvarna_automower/entity.py:53:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/husqvarna_automower/entity.py:53:46: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/husqvarna_automower/entity.py:56:25: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/husqvarna_automower/entity.py:56:57: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/izone/climate.py:122:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/izone/climate.py:122:46: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/izone/climate.py:123:20: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/izone/climate.py:123:52: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/openhome/media_player.py:71:6: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/openhome/media_player.py:71:44: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/openhome/media_player.py:76:15: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/openhome/media_player.py:77:10: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:607:16: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:607:38: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:613:24: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:613:48: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:621:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:621:45: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:627:24: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:627:55: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:634:10: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:635:6: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:663:16: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:663:36: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:673:14: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:674:10: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:684:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:684:43: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:694:14: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:695:10: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/recorder/util.py:704:10: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/recorder/util.py:708:6: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/roku/helpers.py:31:16: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/roku/helpers.py:31:46: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/roku/helpers.py:35:15: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/roku/helpers.py:36:10: error[too-many-positional-arguments] Too many positional arguments: expected 1, got 2
+ homeassistant/components/sonos/helpers.py:46:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:46:40: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:52:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:52:40: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:57:16: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:57:40: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:60:26: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/components/sonos/helpers.py:60:52: error[too-many-positional-arguments] Too many positional arguments: expected 2, got 3
+ homeassistant/helpers/dispatcher.py:72:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 1
+ homeassistant/helpers/dispatcher.py:119:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 1
+ homeassistant/helpers/dispatcher.py:234:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 1
+ homeassistant/helpers/singleton.py:68:32: error[invalid-await] `_Coro | _U@singleton` is not awaitable
+ homeassistant/helpers/singleton.py:83:12: error[invalid-return-type] Return type does not match returned value: expected `(_FuncType, /) -&gt; _FuncType`, found `Overload[(func: (HomeAssistant, /) -&gt; Coroutine[Any, Any, _T@singleton]) -&gt; (HomeAssistant, /) -&gt; Coroutine[Any, Any, _T@singleton], (func: (HomeAssistant, /) -&gt; _U@singleton) -&gt; (HomeAssistant, /) -&gt; _U@singleton]`
- homeassistant/helpers/singleton.py:102:5: error[type-assertion-failure] Argument does not have asserted type `int`
- homeassistant/helpers/singleton.py:103:5: error[type-assertion-failure] Argument does not have asserted type `int`
- homeassistant/helpers/singleton.py:106:35: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 13345 diagnostics
+ Found 13415 diagnostics

</code></pre>

No memory usage changes detected âœ…

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-04 11:30</div>
            <div class="timeline-body"><p>Not a full review, but the new <code>too-many-positional-arguments</code> diagnostics in the ecosystem diff indicate that there is some problem with <code>ParamSpec</code>s. For example:</p>
<pre><code>from typing import Callable

type ReturnsInt[**P] = Callable[P, int]

def call[**P](callable: ReturnsInt[P]) -&gt; None:  # ty: too-many-positional-arguments
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-09-04 11:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:1 on 2025-09-04 11:33</div>
            <div class="timeline-body"><p>We also have <code>resources/mdtest/pep695_type_aliases.md</code>. Should these two files be merged?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:246 on 2025-09-04 18:27</div>
            <div class="timeline-body"><p>Did you consider keeping this a struct, and making just the <code>origin</code> field be an enum? Even if we need to add additional variants in the future, I can&#x27;t imagine a generic alias not having a specialization, and it looks like a lot of the copied logic below is actually shared.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/class_base.rs</code>:88 on 2025-09-04 18:30</div>
            <div class="timeline-body"><p>You can fold these match statements together like you do below in <code>display.rs</code>:</p>
<pre><code>            Type::GenericAlias(GenericAlias::ClassLiteral(generic)) =&gt; {
                Some(Self::Class(ClassType::Generic(generic)))
            }
            Type::GenericAlias(GenericAlias::TypeAlias(_)) =&gt; None,
</code></pre>
<p>(Though if you revert <code>GenericAlias</code> back to being a struct per above, then you will need to keep this as two separate matches)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:1739 on 2025-09-04 18:32</div>
            <div class="timeline-body"><p>Is this spurious? I don&#x27;t see any other changes to this method or the type being matched on that would require this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:8825 on 2025-09-04 18:33</div>
            <div class="timeline-body"><p>I&#x27;d suggest adding a <code>TODO</code> comment that the limitation to PEP 695 type aliases is temporary, and only because that&#x27;s the only kind of type alias that we&#x27;ve attached a generic context to yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:8889 on 2025-09-04 18:38</div>
            <div class="timeline-body"><p>I think the &quot;keep <code>GenericAlias</code> as a struct&quot; suggestion would simplify this a bit, too. You&#x27;d end up with a <code>GenericAliasOrigin</code> enum, which wraps either a class literal or a type alias, and you could update <code>infer_explicit_class_specialization</code> to take in that instead of a <code>ClassLiteral</code>. That would eliminate the need for this callback (and the two new methods here), since the two callbacks would be combined into a new <code>GenericAliasOrigin::apply_specialization</code> method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-04 18:46</div>
            <div class="timeline-body"><p>@sharkdp I believe that&#x27;s <a href="https://github.com/astral-sh/ty/issues/157">astral-sh/ty#157</a>. All the generics infrastructure in this PR is reused from generic classes, which emit a similar error:</p>
<pre><code>class ReturnsInt[**P]:
    x: Callable[P, int]

def call[**P](callable: ReturnsInt[P]) -&gt; None:  # ty: too-many-positional-arguments
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-04 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-09-04 18:58</div>
            <div class="timeline-body"><p>Looking at how pyright <a href="https://pyright-play.net/?enableExperimentalFeatures=true&amp;code=MYGwhgzhAEDCDaAVAugLmgOiwKGwEwFMAzaAfSWQAph0EUBKVbaF6AJwIDcCwRSAXAJ4AHAtXq4O3XgJFjYEqTz5DRlBAEsAdv2QTcqgtAAaFaAF44FbIegBNC9Aj82uQiXIpKAD3SmGTKzsXMqyat767mSUguh2jMysSjKGMfrJKnKUxoohKVmm2rq50plq8UA">handles this</a>, there might a simpler way to do this that punts on several of the questions we&#x27;ve had.</p>
<pre><code>class C[T]: ...

def _[T](c: C[T]):
    reveal_type(c)  # revealed: C[T@_]

reveal_type(C)  # revealed: type[C[Unknown]]
reveal_type(C[int])  # revealed: type[C[int]]


type X[T] = C[T]
type Y = str

def _[T](x: X[T]):
    reveal_type(x)  # revealed: C[T@_]

def _(y: Y):
    reveal_type(y)  # revealed: str

reveal_type(X)  # revealed: TypeAliasType
reveal_type(X[int])  # revealed: TypeAliasType
reveal_type(Y)  # revealed: TypeAliasType
</code></pre>
<p>Note that in the last two function bodies, the revealed type does not mention the type alias at all. So in ty terms, <code>NominalInstance</code> does not need to wrap the (specialized) type alias.</p>
<p>Similarly, the revealed type of <code>X[int]</code> is <code>TypeAliasType</code>, and so <code>GenericAlias</code> doesn&#x27;t need to wrap the type alias either.</p>
<p>This suggests that we can roll back all of the changes to <code>GenericAlias</code> and <code>NominalInstance</code>, and just make sure that <code>in_type_expression</code> propagates the generic context through when it resolves a type alias into its value type.</p>
<hr>
<p>[I made several comments below about the current implementation, which might become moot given the above, but I&#x27;m keeping them here in case my analysis is wrong and we do need to keep those changes]</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-09-04 19:02</div>
            <div class="timeline-body"><blockquote>
<p>and so <code>GenericAlias</code> doesn&#x27;t need to wrap the type alias either</p>
</blockquote>
<p>And in particular, this reminds me of an earlier draft of this that you had shown me, where <code>PEP695TypeAlias</code> had an <code>Option&lt;Specialization&gt;</code> field, since we do need <em>some</em> way to distinguish <code>X</code> from <code>X[int]</code> in my example. And then <code>in_type_expression</code> would check if the type alias is generic, and if it is, fall back on the default specialization if that field is <code>None</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-09-06 01:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:1 on 2025-09-06 01:08</div>
            <div class="timeline-body"><p>Possibly, although this file is specific to generic PEP 695 aliases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_ide/src/hover.rs</code>:1592 on 2025-09-06 01:09</div>
            <div class="timeline-body"><p>This comment should be removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:47 on 2025-09-06 01:16</div>
            <div class="timeline-body"><p>I don&#x27;t think this example should be an error. In this case the name <code>int</code>, within the scope of this alias, is bound to a typevar, shadowing the global name <code>int</code>.</p>
<p>The names in brackets here are not references, they are targets to which a (typevar) value will be bound in this scope.</p>
<p>This shadowing is unnecessarily confusing, but it&#x27;s not an error.</p>
<p>Here&#x27;s this example <a href="https://pyright-play.net/?code=C4TwDgpgBA4g2gSwHbALpQLxQDYIM7CIqoCwAUOQCYQBmUA%2BgBQDmAXLHAQE6oCUr5KEKhcIANwgBDbPVCQWvIA">working in pyright</a>.</p>
<p>I think this test can just be removed? Any identifier is valid here, and anything invalid will be a syntax error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3605 on 2025-09-06 01:20</div>
            <div class="timeline-body"><p>We could implement <code>Default</code> for <code>TryBoolVisitor</code> to avoid repeating this a few places.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:5598 on 2025-09-06 01:27</div>
            <div class="timeline-body"><p>Is there a reason we need to eagerly unpack specialized aliases when they appear in type expressions, where we don&#x27;t for non-generic aliases (see below, we wrap them in a lazy <code>Type::TypeAlias</code> instead).</p>
<p>I think this eager unpacking will result in Salsa query cycles for an example like <code>type Rec[T] = T | list[Rec[T]]</code>, because we will eagerly unpack the alias, recursively, and type inference of the RHS will diverge.</p>
<p>It looks to me like we can just delete this new arm entirely and just let the below arm do its thing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:43 on 2025-09-06 01:34</div>
            <div class="timeline-body"><p>What about when we use a generic type alias in a type expression without an explicit specialization? This should result in implicitly specializing to <code>Unknown</code>:</p>
<pre><code>type G[T] = list[T]

def _(g: G):
    reveal_type(g)  # should reveal `list[Unknown]`
</code></pre>
<p>But I don&#x27;t see any tests for it, and I don&#x27;t think the PR currently handles it correctly; instead we just fail to specialize at all, and allow a typevar to leak out, revealing <code>list[T@G]</code> above.</p>
<p>We should also have a test like the above but with a typevar default (<code>type G[T = int] = list[T]</code>) -- in this case we should specialize to <code>list[int]</code> when no explicit specialization is given.</p>
<p>(We already have code for creating the <code>default_specialization</code> for a generic context, so we shouldn&#x27;t need to write new code to handle typevar defaults vs Unknown -- but we should have tests for both cases.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:5598 on 2025-09-06 01:36</div>
            <div class="timeline-body"><p>We might, though, need some additional handling here in case of a type alias with a generic context but without a specialization. Such an alias, if used in a type expression, should be implicitly &quot;default specialized&quot; (that is, specialized to the default for each typevar, or <code>Unknown</code> for typevars with no default.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:6900 on 2025-09-06 01:40</div>
            <div class="timeline-body"><p>This is fine for now, but ultimately we will need to support all kinds of generic type aliases, so it might be a bit more forward-thinking to provide generalized API on <code>TypeAliasType</code> that matches variants internally, and avoid matching specifically on <code>TypeAliasType::PEP695</code> externally? But it&#x27;s not a big deal, can always be changed later when we add support for other kinds of generic type aliases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:8823 on 2025-09-06 01:44</div>
            <div class="timeline-body"><p>Similar to my comment above, weak preference here to keep this TODO internal, not match here on specific kinds of aliases, and expose general API on <code>TypeAliasType</code> itself that we can use here without worrying about the details of which kinds of generic aliases are actually supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-09-06 01:46</div>
            <div class="timeline-body"><p>Looking great! A few comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-09-08 18:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:47 on 2025-09-08 18:18</div>
            <div class="timeline-body"><p>I took this from <a href="https://github.com/astral-sh/ruff/blob/main/crates/ty_python_semantic/resources/mdtest/generics/pep695/classes.md?plain=1#L43">the test in <code>generics/classes.md</code></a>. Is this different, or should that be removed as well?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-09-08 18:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3605 on 2025-09-08 18:20</div>
            <div class="timeline-body"><p>I wanted to avoid implementing <code>Default</code> for <code>Truthiness</code> because that felt like a potential footgun (and <code>TryBoolVisitor</code> is just a type alias so can&#x27;t implement <code>Default</code> directly).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-09-08 18:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:1 on 2025-09-08 18:47</div>
            <div class="timeline-body"><p>Yes. And I don&#x27;t care too much about the structure/layout of the tests. Just wanted do let you know that there are some generics-related tests in that other file as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-09-08 19:16</div>
            <div class="timeline-body"><p>The typing conformance suite is now panicking with <code>value_type(_): too many cycle iterations</code> on <code>aliases_type_statement.md</code> because of:</p>
<pre><code>type RecursiveTypeAlias1[T] = T | list[RecursiveTypeAlias1[T]]
r1_1: RecursiveTypeAlias1[int] = 1
</code></pre>
<p>This looks like <a href="https://github.com/astral-sh/ty/issues/256">astral-sh/ty#256</a>, which I believe is unrelated to this PR. The ecosystem failures also all seem to be cases where recognizing generic type aliases leads to more detailed diagnostics for underlying semantics that we do not support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-09-08 19:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:47 on 2025-09-08 19:28</div>
            <div class="timeline-body"><p>No, that test is similarly bogus and should be removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3605 on 2025-09-08 19:36</div>
            <div class="timeline-body"><p>I don&#x27;t think you need to implement <code>Default</code> for <code>Truthiness</code> in order to implement it for <code>CycleDetector&lt;TryBool, Type&lt;&#x27;db&gt;, Result&lt;Truthiness, BoolError&lt;&#x27;db&gt;&gt;&gt;</code> (and you can <code>impl Default for TryBoolVisitor</code> as a shortcut for the latter). I could be missing something but I&#x27;m pretty sure I&#x27;ve done this before, see e.g. https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=8123cdc184c2e6a38c393f541dfbd151 (<code>V</code> doesn&#x27;t implement <code>Default</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-09-08 19:42</div>
            <div class="timeline-body"><blockquote>
<p>The typing conformance suite is now panicking with <code>value_type(_): too many cycle iterations</code> on <code>aliases_type_statement.md</code></p>
</blockquote>
<p>Let me look at this. We avoid this already for PEP 695 aliases in general by creating a type alias type for the assignment without resolving the RHS, and deferring resolution of the RHS as part of <code>value_type</code> on the alias. It seems like something in this PR must be breaking this (i.e., resolving the RHS too eagerly) for generic aliases. If necessary we can fix it in a separate follow-up, but it is something that I would expect to work at this point, it&#x27;s not an expected failure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-09-08 19:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3605 on 2025-09-08 20:00</div>
            <div class="timeline-body"><p>You run into the orphan rule because <code>CycleDetector&lt;_, _, R: Default&gt;</code> implements <code>Default</code>, and <code>R</code> here is an external type (<code>Result&lt;_, _&gt;</code>). I don&#x27;t think it&#x27;s a huge deal but I&#x27;m happy to implement <code>Default</code> for <code>Truthiness</code> if you think that&#x27;s better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-09-08 20:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-09-08 20:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3605 on 2025-09-08 20:06</div>
            <div class="timeline-body"><p>Ah makes sense! No I think it&#x27;s fine as-is, just wanted to understand :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-09-08 20:14</div>
            <div class="timeline-body"><p>Hmm I see the issue -- it&#x27;s not that we resolve the RHS too eagerly in general, it&#x27;s that when subscripting we resolve the value-type of the alias at that point to apply the specialization. We may need to allow <code>Type::TypeAlias</code> to carry a lazy specialization with it in order to support this. In any case, having looked at it I agree this isn&#x27;t an issue we should try to solve in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/generics/pep695/aliases.md</code>:1 on 2025-09-08 20:19</div>
            <div class="timeline-body"><p>Good point. I think we can look at this as a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-09-08 20:26</div>
            <div class="timeline-body"><p>Looks great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/carljm">@carljm</a> on 2025-09-08 20:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-09-08 20:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-09-08 20:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:17 UTC
    </footer>
</body>
</html>
