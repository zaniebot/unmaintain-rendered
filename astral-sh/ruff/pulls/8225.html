<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimize workflow run - astral-sh/ruff #8225</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Optimize workflow run</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8225">#8225</a>
        opened by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a>
        on 2023-10-25 19:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a></div>
            <div class="timeline-body">Summary
<ul>
<li>Don&#x27;t run jobs that are not affected</li>
<li>Replace <code>scripts/*</code> with <code>scripts/**</code></li>
</ul>
Test Plan
<p>This PR changes ci.yaml, so it will trigger all jobs.  there is no good way to test if something is skipped before merging this to the main and creating other PRs.</p>
<p>I am not familiar with the project well, so might miss some configs that are important.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-25 19:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/ci.yaml</code>:28 on 2023-10-25 19:52</div>
            <div class="timeline-body"><pre><code>      code: ${{ steps.changed.outputs.code_any_changed }}
</code></pre>
<p>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:70 on 2023-10-26 00:04</div>
            <div class="timeline-body"><pre><code>              - pyproject.toml
              - rust-toolchain.toml
              - fuzz/**
</code></pre>
<p>Does the plugin support a way to say: Only run when e.g. all changed files are markdown files? It would reduce that we missed adding an entry. I rather have the job runs too often that miss out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:64 on 2023-10-26 00:05</div>
            <div class="timeline-body"><pre><code>              - crates/**
              - scripts/**
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-10-26 00:08</div>
            <div class="timeline-body"><p>Thanks for improving our pipeline.</p>
<p>I like the idea of running fewer jobs but I&#x27;m unsure if the added complexity is worth it, considering that most jobs include code changes. It&#x27;s also very easy to forget files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on <code>.github/workflows/ci.yaml</code>:70 on 2023-10-29 12:51</div>
            <div class="timeline-body"><p>As I see no, it could not.</p>
<p>But it could be addressed by running them on master, after the merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> reviewed on 2023-10-29 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> reviewed on 2023-10-29 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on <code>.github/workflows/ci.yaml</code>:64 on 2023-10-29 12:51</div>
            <div class="timeline-body"><p>Nice catch, I have copypasted this form existing code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-10-29 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-10-29 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-10-29 13:17</div>
            <div class="timeline-body"><p>Force pushed changes, after rebasing on top of the main</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 20:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/ci.yaml</code>:70 on 2023-11-01 20:38</div>
            <div class="timeline-body"><p>Why not with something like</p>
<pre><code>- **/*
- !**/*.md
</code></pre>
<p>I would be surprised if this was not feasible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> requested changes on 2023-11-01 20:39</div>
            <div class="timeline-body"><p>I don&#x27;t think we want to maintain this list of files. I&#x27;d prefer the &quot;negated&quot; style that @MichaReiser requested as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-11-04 13:45</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-11-04 13:48</div>
            <div class="timeline-body"><p>The first implementation with negation.</p>
<p>code and formatter sections are the same, probably some exclusions should be added to formatted. I don&#x27;t have expertise in the project to do it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2023-11-27 23:12</div>
            <div class="timeline-body"><p>The formatter now runs on all linter changes because it doesn&#x27;t exclude the linter specific crates (or development-only crates).</p>
<p>I&#x27;m okay merging this but I would prefer reverting the changes to the linter/formatter filesets to keep the changes isolated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cjkjvfnby">@Cjkjvfnby</a> on 2023-11-29 20:38</div>
            <div class="timeline-body"><blockquote>
<p>The formatter now runs on all linter changes because it doesn&#x27;t exclude the linter specific crates (or development-only crates).</p>
</blockquote>
<p>I don&#x27;t know Rust, so could not do it myself.</p>
<blockquote>
<p>I&#x27;m okay merging this but I would prefer reverting the changes to the linter/formatter filesets to keep the changes isolated.</p>
</blockquote>
<p>Done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2023-11-29 20:51</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/Cjkjvfnby:sa/optimize-workflow-run">CodSpeed Performance Report</a>
Merging #8225 will <strong>improve performances by 11.42%</strong>
<p>Comparing <code>Cjkjvfnby:sa/optimize-workflow-run</code> (8ad224b) with <code>main</code> (5d554ed)</p>
Summary
<p><code>âš¡ 5</code> improvements
<code>âœ… 20</code> untouched benchmarks</p>
<p><code>ðŸ†• 5</code> new benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>Cjkjvfnby:sa/optimize-workflow-run</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| âš¡ | <code>linter/all-rules[unicode/pypinyin.py]</code> | 17.2 ms | 16.2 ms | +6.03% |
| âš¡ | <code>linter/all-rules[numpy/globals.py]</code> | 4.2 ms | 3.9 ms | +6.42% |
| âš¡ | <code>linter/all-rules[pydantic/types.py]</code> | 80.3 ms | 72.2 ms | +11.18% |
| ðŸ†• | <code>linter/all-with-preview-rules[unicode/pypinyin.py]</code> | N/A | 17.2 ms | N/A |
| ðŸ†• | <code>linter/all-with-preview-rules[numpy/globals.py]</code> | N/A | 4.2 ms | N/A |
| ðŸ†• | <code>linter/all-with-preview-rules[large/dataset.py]</code> | N/A | 185.6 ms | N/A |
| ðŸ†• | <code>linter/all-with-preview-rules[numpy/ctypeslib.py]</code> | N/A | 37.1 ms | N/A |
| âš¡ | <code>linter/all-rules[numpy/ctypeslib.py]</code> | 36.8 ms | 33.9 ms | +8.58% |
| âš¡ | <code>linter/all-rules[large/dataset.py]</code> | 186.2 ms | 167.1 ms | +11.42% |
| ðŸ†• | <code>linter/all-with-preview-rules[pydantic/types.py]</code> | N/A | 79.9 ms | N/A |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-11-30 00:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-30 00:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-30 00:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:58:45 UTC
    </footer>
</body>
</html>
