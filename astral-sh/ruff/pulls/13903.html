<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Type inference for comparisons between arbitrary instances - astral-sh/ruff #13903</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Type inference for comparisons between arbitrary instances</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13903">#13903</a>
        opened by <a href="https://github.com/cake-monotone">@cake-monotone</a>
        on 2024-10-24 10:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-10-24 10:04</div>
            <div class="timeline-body"><h1>Summary</h1>
<ul>
<li>Implemented &quot;rich comparison&quot; for instance comparisons.</li>
<li>Implemented &quot;membership test&quot; for instance comparisons.</li>
</ul>
<p>Closes astral-sh/ruff#13872</p>
<h1>Test Plan</h1>
<p>mdtest included!</p>
<ul>
<li><code>comparisons/instances/rich_comparison.md</code></li>
<li><code>comparisons/instances/membership_test.md</code></li>
<li>(Resolved some TODO in other md tests)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @cake-monotone on 2024-10-24 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @cake-monotone on 2024-10-24 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @cake-monotone on 2024-10-24 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @cake-monotone on 2024-10-24 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-10-24 10:14</div>
            <div class="timeline-body"><p>Next task topics?</p>
<ul>
<li>We should infer Never from the membership test for some special cases.</li>
</ul>
<p>from the old-style iteration protocol <a href="https://docs.python.org/3/reference/expressions.html#membership-test-details">doc</a></p>
<pre><code class="language-py">class A:
    def __getitem__(self, key: str) -&gt; str:
        return key

reveal_type(&quot;never&quot; in A())  # revealed: Never
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-24 10:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3841 on 2024-10-24 10:16</div>
            <div class="timeline-body"><p>can some of this be simplified by using our pre-existing <code>Type::iterate()</code> method?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-10-24 10:16</div>
            <div class="timeline-body"><p>Overall this looks fantastic; you're definitely on the right track. Thanks!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-24 10:18</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances.md</code>:42 on 2024-10-24 18:34</div>
            <div class="timeline-body"><p>Commenting our tests is useful to future readers.</p>
<pre><code class="language-suggestion">### Wrong Return Type

Python coerces the results of containment checks to bool, even if `__contains__` returns a non-bool:

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances.md</code>:8 on 2024-10-24 18:40</div>
            <div class="timeline-body"><p>I think we could have a more informative test name here :)</p>
<p>And some prose documentation of the behavior we are testing can really help future readers also.</p>
<p>I would split this into three separate &quot;tests&quot; each with their own separate code block. The first test could be named &quot;Implements <strong>contains</strong>&quot; with the prose text:</p>
<blockquote>
<p>Classes can support membership tests by implementing the <code>__contains__</code> method:</p>
</blockquote>
<p>And then the second test can be named &quot;Implements <strong>iter</strong>&quot; with the prose:</p>
<blockquote>
<p>Classes that don't implement <code>__contains__</code>, but do implement <code>__iter__</code>, also support containment checks; the needle will be sought in their iterated items:</p>
</blockquote>
<p>And the third test can be named &quot;Implements <strong>getitem</strong>&quot; with the text</p>
<blockquote>
<p>The final fallback is to implement <code>__getitem__</code> for integer keys: Python will call it with 0, 1, 2... until it either finds the needle (returning <code>True</code> for the membership test) or <code>__getitem__</code> raises <code>IndexError</code>, which is silenced and returns <code>False</code> for the membership test.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances.md</code>:53 on 2024-10-24 18:42</div>
            <div class="timeline-body"><pre><code class="language-suggestion">### Wrong Fallback

If `__contains__` is implemented, checking membership of a type it doesn't accept is an error; it doesn't result in a fallback to `__iter__` or `__getitem__`:

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances.md</code>:91 on 2024-10-24 18:44</div>
            <div class="timeline-body"><pre><code class="language-suggestion">### Old protocol Unsupported

If `__getitem__` is implemented but does not accept integer arguments, then membership test is not supported.

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances.md</code>:1 on 2024-10-24 18:46</div>
            <div class="timeline-body"><p>It looks like you also added an empty file <code>instances/membership_test.md</code> in this PR; did you intend to move these tests to that file? I think that would make sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:20 on 2024-10-24 18:48</div>
            <div class="timeline-body"><p>This test could also help verify the right dunder is being used for each type, if each dunder method returned a different type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:71 on 2024-10-24 18:51</div>
            <div class="timeline-body"><p>Again here, returning different types could help verify we are using the right reflected method for each comparison.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:80 on 2024-10-24 18:57</div>
            <div class="timeline-body"><p>And similar here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3822 on 2024-10-24 19:14</div>
            <div class="timeline-body"><p>I think we need some tests with <code>__contains__</code> methods returning e.g. <code>Literal[True]</code> or <code>Literal[False]</code> to show this logic is correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/tests/mdtest.rs</code>:8 on 2024-10-24 19:15</div>
            <div class="timeline-body"><p>This doesn't look like a change we want to land :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> requested changes on 2024-10-24 19:15</div>
            <div class="timeline-body"><p>Thank you, this is excellent!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-10-24 19:16</div>
            <div class="timeline-body"><p>Oh sorry for requesting changes, I somehow failed to notice this PR was still in draft state</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-10-25 09:55</div>
            <div class="timeline-body"><p>Although this is a draft, the reviews have been helpful! Thank you!!
Next time, I'll make sure to clearly label the title with WIP. ðŸ¥²ðŸ¥²</p>
<p>And, Iâ€™ve separated the commits so that you can compare them with the initial draft version :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cake-monotone">@cake-monotone</a> reviewed on 2024-10-25 10:03</div>
            <div class="timeline-body"><p>It seems that inferring Literal types based on only rich comparison and typeshed may not be feasible.</p>
<p>The <code>__eq__</code> method in both builtin.str and builtin.int has an argument type of object.</p>
<p>https://github.com/astral-sh/ruff/blob/main/crates/red_knot_vendored/vendor/typeshed/stdlib/builtins.pyi#L590
https://github.com/astral-sh/ruff/blob/main/crates/red_knot_vendored/vendor/typeshed/stdlib/builtins.pyi#L319</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:95 on 2024-10-25 10:04</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/pull/13903/files#diff-eff9f162b9d83ddfe43d3f6b28ed022767bc58d12d7ccb0c95d985e827471362R91-R95</p>
<p>It seems that inferring Literal types based on only rich comparison and typeshed may not be feasible.</p>
<p>The <code>__eq__</code> method in both builtin.str and builtin.int has an argument type of object.</p>
<p>https://github.com/astral-sh/ruff/blob/main/crates/red_knot_vendored/vendor/typeshed/stdlib/builtins.pyi#L590
https://github.com/astral-sh/ruff/blob/main/crates/red_knot_vendored/vendor/typeshed/stdlib/builtins.pyi#L319</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cake-monotone">@cake-monotone</a> reviewed on 2024-10-25 10:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cake-monotone">@cake-monotone</a> reviewed on 2024-10-25 10:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:197 on 2024-10-25 10:08</div>
            <div class="timeline-body"><p>Same issue as mentioned in the previous comment</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @cake-monotone on 2024-10-25 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @cake-monotone on 2024-10-25 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @cake-monotone on 2024-10-25 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-25 10:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:95 on 2024-10-25 10:17</div>
            <div class="timeline-body"><blockquote>
<p>The <code>__eq__</code> method in both builtin.str and builtin.int has an argument type of object.</p>
</blockquote>
<p>Right. The convention when it comes to annotating parameters on <code>__eq__</code> and <code>__ne__</code> is different from the other four rich-comparison methods. As far as I'm aware, this is unspecified.</p>
<p>The convention for nearly all rich-comparison and binary-arithmetic dunders is to annotate them in such a way that any call that would result in <code>NotImplemented</code> being returned would lead to the type checker emitting an error. So although this &quot;works&quot; at runtime (no error is raised, just <code>NotImplemented</code> returned), <a href="https://github.com/python/typeshed/blob/b954cd705cb5af5a96bcbf439e2268d52da47b48/stdlib/builtins.pyi#L325">typeshed's annotations disallow it</a>:</p>
<pre><code class="language-py">&gt;&gt;&gt; (2).__lt__(2.0)
NotImplemented
</code></pre>
<p>But for <code>__eq__</code> and <code>__ne__</code>, the convention is to annotate parameters such that any calls that would succeed at runtime are allowed, even if those successful calls would return <code>NotImplemented</code>. I can think of two good reasons for this:</p>
<ol>
<li><code>__eq__</code> and <code>__ne__</code> really are different from all the others: unlike the other rich-comparison operators and the binary-arithmetic operators, <code>x == y</code> will always result in a <code>bool</code> (never <code>TypeError</code>), even if <code>type(x).__eq__(y)</code> returns <code>NotImplemented</code> <em>and</em> <code>type(y).__eq__(x)</code> returns <code>NotImplemented</code>.</li>
<li>It's useful for type checkers to enforce the Liskov Substitution Principle for equality. If a class raises an exception during an equality check, that seriously violates some assumptions that are baked in across the language, standard library, and many third-party libraries. It's useful to be able to distinguish &quot;this <code>__eq__</code> method returns <code>NotImplemented</code> if you pass it a <code>float</code>&quot; and &quot;this <code>__eq__</code> method raises <code>TypeError</code> or <code>AttributeError</code> if you pass it a <code>float</code>&quot;, because the first is fine but the second is very bad indeed. With the current convention, type checkers will warn you if you say that an <code>__eq__</code> method has to accept a non-<code>object</code> type, because that's an incompatible override of <code>object.__eq__</code> (they're able to detect the Liskov violation).</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:16 on 2024-10-25 11:03</div>
            <div class="timeline-body"><p>I think in general, we should actually return the thing we say we're returning in our <code>mdtest</code> snippets. This will make us robust to future improvements in our inference and checking: at some point, we'll want to start complaining if a method says it returns <code>bool</code> but actually returns <code>None</code>; tests like this will break if the body of the method is just <code>...</code>:</p>
<pre><code class="language-suggestion">class A:
    def __contains__(self, item: str) -&gt; bool:
        return True
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:31 on 2024-10-25 11:04</div>
            <div class="timeline-body"><p><code>Iterator</code> is undefined here. Also, we don't understand generic types yet, so we can't use <code>Iterator</code> yet ðŸ˜†</p>
<p>You'll want to do something like:</p>
<pre><code class="language-suggestion">class StringIterator:
    def __next__(self) -&gt; str:
        return &quot;foo&quot;

class A:
    def __iter__(self) -&gt; StringIterator:
        return StringIterator()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:45 on 2024-10-25 11:05</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __getitem__(self, key: int) -&gt; str:
        return &quot;foo&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:59 on 2024-10-25 11:05</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __contains__(self, item: str) -&gt; str:
        return &quot;foo&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:74 on 2024-10-25 11:06</div>
            <div class="timeline-body"><pre><code class="language-suggestion">from typing import Literal

class AlwaysTrue:
    def __contains__(self, item: int) -&gt; Literal[1]:
        return 1

class AlwaysFalse:
    def __contains__(self, item: int) -&gt; Literal[&quot;&quot;]:
        return &quot;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:97 on 2024-10-25 11:06</div>
            <div class="timeline-body"><ul>
<li><code>Iterator</code> is undefined here</li>
<li>Please add bodies to these methods</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:107 on 2024-10-25 11:13</div>
            <div class="timeline-body"><ul>
<li><code>Iterator</code> is not defined here</li>
<li>Please fill in the bodies of these methods</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:120 on 2024-10-25 11:13</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __getitem__(self, key: str) -&gt; str:
        return &quot;foo&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:22 on 2024-10-25 11:15</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: A) -&gt; int:
        return 42

    def __ne__(self, other: A) -&gt; float:
        return 42.0

    def __lt__(self, other: A) -&gt; str:
        return &quot;42&quot;

    def __le__(self, other: A) -&gt; bytes:
        return b&quot;42&quot;

    def __gt__(self, other: A) -&gt; list:
        return [42]

    def __ge__(self, other: A) -&gt; set:
        return {42}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:43 on 2024-10-25 11:15</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: B) -&gt; int:
        return 42

    def __ne__(self, other: B) -&gt; float:
        return 42.0

    def __lt__(self, other: B) -&gt; str:
        return &quot;42&quot;

    def __le__(self, other: B) -&gt; bytes:
        return b&quot;42&quot;

    def __gt__(self, other: B) -&gt; list:
        return [42]

    def __ge__(self, other: B) -&gt; set:
        return {42}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:67 on 2024-10-25 11:16</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: A) -&gt; int:
        return 42

    def __ne__(self, other: A) -&gt; float:
        return 42.0

    def __lt__(self, other: A) -&gt; str:
        return &quot;42&quot;

    def __le__(self, other: A) -&gt; bytes:
        return b&quot;42&quot;

    def __gt__(self, other: A) -&gt; list:
        return [42]

    def __ge__(self, other: A) -&gt; set:
        return {42}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:72 on 2024-10-25 11:16</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: str) -&gt; B:
        return B()

    def __ne__(self, other: str) -&gt; B:
        return B()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:86 on 2024-10-25 11:16</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __gt__(self, other: C) -&gt; int:
        return 42

    def __ge__(self, other: C) -&gt; float:
        return 42.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:103 on 2024-10-25 11:17</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: A) -&gt; A:
        return A()

    def __ne__(self, other: A) -&gt; A:
        return A()

    def __lt__(self, other: A) -&gt; A:
        return A()

    def __le__(self, other: A) -&gt; A:
        return A()
 
    def __gt__(self, other: A) -&gt; A:
        return A()
 
    def __ge__(self, other: A) -&gt; A:
        return A()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:111 on 2024-10-25 11:18</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: A) -&gt; int:
        return 42

    def __ne__(self, other: A) -&gt; float:
        return 42.0

    def __lt__(self, other: A) -&gt; str:
        return &quot;42&quot;

    def __le__(self, other: A) -&gt; bytes:
        return b&quot;42&quot;

    def __gt__(self, other: A) -&gt; list:
        return [42]

    def __ge__(self, other: A) -&gt; set:
        return {42}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:134 on 2024-10-25 11:18</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __lt__(self, other: A) -&gt; A:
        return A()

    def __gt__(self, other: A) -&gt; A:
        return A()

class B(A):
    def __lt__(self, other: int) -&gt; B:
        return B()

    def __gt__(self, other: int) -&gt; B:
        return B()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:179 on 2024-10-25 11:19</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    def __eq__(self, other: int) -&gt; A:
        return A()

    def __ne__(self, other: int) -&gt; A:
        return A()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:221 on 2024-10-25 12:04</div>
            <div class="timeline-body"><pre><code class="language-suggestion">def bool_instance() -&gt; bool:
    return True

def int_instance() -&gt; int:
    return 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> requested changes on 2024-10-25 12:04</div>
            <div class="timeline-body"><p>Thanks! This review only reviews your tests ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-10-25 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cake-monotone">@cake-monotone</a> reviewed on 2024-10-25 15:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:16 on 2024-10-25 15:24</div>
            <div class="timeline-body"><p>Thank you so much for taking the time to make all these detailed adjustmentsâ€”it must have been quite a task!</p>
<p>I have a follow-up question regarding the points you mentioned. Should we also add <code>from __future__ import annotations</code>?</p>
<pre><code class="language-py">from __future__ import annotations  #required?!

class A:
    def foo(self, o: A) -&gt; A:
        return A()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2024-10-25 15:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:16 on 2024-10-25 15:29</div>
            <div class="timeline-body"><p>Yes, we should probably add <code>from __future__ import annotations</code> where we are relying on these self-annotations. We actually understand them even without it, because we don't currently model the fact that the class body scope runs immediately at class definition time, but probably we should model that correctly in future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cake-monotone">@cake-monotone</a> reviewed on 2024-10-25 15:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3822 on 2024-10-25 15:58</div>
            <div class="timeline-body"><p>I missed commenting earlier! sorry ðŸ˜¢</p>
<p>I think the <a href="https://github.com/astral-sh/ruff/pull/13903/files#diff-93415f322d4e43d79a593ad9befefe07cf5c53ee929363403cb17f740f5df341R73-R95">new test here</a> should cover the scenario you mentioned!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @cake-monotone on 2024-10-25 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:147 on 2024-10-25 21:36</div>
            <div class="timeline-body"><p>This should also emit an unsupported-operator diagnostic, which we should mention in the TODO</p>
<pre><code class="language-suggestion"># TODO should emit a diagnostic
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:21 on 2024-10-25 21:38</div>
            <div class="timeline-body"><p>After thinking it through (and writing up my thoughts at https://github.com/astral-sh/ruff/issues/13932) I think that we should just always infer <code>bool</code> for membership tests, even if we emit a diagnostic because the membership test is invalid. The reasoning is that membership tests in Python <em>always</em> evaluate to <code>bool</code> at runtime, so we can have very high confidence that <code>bool</code> is the right type here, presuming the membership test itself will be fixed.</p>
<pre><code class="language-suggestion"># TODO: should emit diagnostic, need to check arg type, will fail
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:122 on 2024-10-25 21:44</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should emit diagnostic, need to check arg type, should not fall back to __iter__ or __getitem__
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:134 on 2024-10-25 21:51</div>
            <div class="timeline-body"><p>I think this comment is correct, but it could be clearer. If we are talking about equality comparison, all Python objects are comparable, in that equality comparison is not supposed to raise, it should just return <code>False</code> for unrelated objects.</p>
<p>Checking e.g. <code>42 in F()</code> where <code>F()</code> is a container of strings is not an error at runtime; it's just <code>False</code>. (Maybe you'd want a type-aware linter to emit a lint diagnostic on this as an always-false test, but I don't think it's a type error.)</p>
<p>This is consistent with the behavior tested above, where e.g. we test that <code>42 in A()</code> is <code>bool</code> where <code>A</code> defines <code>__getitem__</code> to return <code>str</code>, with no TODO for emitting a diagnostic.</p>
<p>So I think the comment here should clarify this a bit better:</p>
<pre><code class="language-suggestion"># Always use `__iter__`, regardless of iterated type; there's no NotImplemented
# in this case, so there's no fallback to `__getitem__`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:140 on 2024-10-25 21:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">If `__getitem__` is implemented but does not accept integer arguments, then membership test is not supported and should emit a diagnostic.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:3 on 2024-10-25 21:53</div>
            <div class="timeline-body"><p>General note throughout the mdtests -- our current practice is to hard-wrap these at 80 columns. If your editor doesn't make that easy, or you don't want to do it, it's fine, I can do it before merging as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:114 on 2024-10-25 22:19</div>
            <div class="timeline-body"><p>These overrides themselves should emit a diagnostic for invalid override of the <code>object</code> methods, because they violate Liskov Substitution Principle by accepting only a narrower type than <code>object</code>. And according to @AlexWaygood , for this reason these two methods typically are never annotated to accept a narrower type. Which means that equality and inequality comparisons would actually never fall back to RHS in a type checker, even though they could at runtime.</p>
<p>But I still think (with the TODO for the invalid-override diagnostic), it makes sense that we should still implement the same fallback logic for <code>__eq__</code> and <code>__ne__</code>, in case someone does override them in this way?</p>
<pre><code class="language-suggestion">    # To override builtins.object.__eq__ and builtins.object.__ne__
    # TODO these should emit an invalid override diagnostic
    def __eq__(self, other: str) -&gt; B:
        return B()

    def __ne__(self, other: str) -&gt; B:
        return B()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:116 on 2024-10-25 22:21</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should be `int` and `float`, need to check arg type and fall back to `rhs.__eq__` and `rhs.__ne__`. Because `object.__eq__` and `object.__ne__` accept `object` in typeshed, this can only happen with an invalid override of these methods, but we still support it.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:194 on 2024-10-25 22:24</div>
            <div class="timeline-body"><pre><code class="language-suggestion">In the case of a subclass, the right-hand side has priority. However, if the overridden dunder method has an mismatched type to operand, the comparison will fall back to the left-hand side.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:281 on 2024-10-25 22:27</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    # TODO both these overrides should emit invalid-override diagnostic
    def __eq__(self, other: int) -&gt; A:
        return A()

    def __ne__(self, other: int) -&gt; A:
        return A()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:285 on 2024-10-25 22:27</div>
            <div class="timeline-body"><p>This is another odd case, in that I think it's only possible via an invalid override. But I guess it still doesn't hurt to support it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:280 on 2024-10-25 22:29</div>
            <div class="timeline-body"><p>I think this deserves to be its own separate test, and should cover all four inequality operators.</p>
<p>Also, let's assert on the error code (<code>[unsupported-operator]</code>) as well as message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:296 on 2024-10-25 22:31</div>
            <div class="timeline-body"><p>In this case I think the type should in fact be <code>Unknown</code>, since comparisons can return any type at runtime, not just <code>bool</code>. But let's also note here that there should be a diagnostic.</p>
<pre><code class="language-suggestion"># TODO: should be Unknown and emit diagnostic, need to check arg type and should be failed
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/integers.md</code>:15 on 2024-10-25 22:31</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should be Unknown, and emit diagnostic, once we check call argument types
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/integers.md</code>:26 on 2024-10-25 22:32</div>
            <div class="timeline-body"><p>ðŸŽ‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:95 on 2024-10-25 22:34</div>
            <div class="timeline-body"><p>In this particular case, I think we should be able to infer Literal False and True, without ever falling back to typeshed, because we should explicitly implement equality comparison for mismatched Literal types to return <code>Literal[False]</code>. (Currently we just don't have a match arm for that case, so we fall back to the typeshed definitions instead.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:91 on 2024-10-25 22:34</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should be Literal[False], once we implement (in)equality for mismatched literals
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:94 on 2024-10-25 22:35</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should be Literal[True], once we implement (in)equality for mismatched literals
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:102 on 2024-10-25 22:36</div>
            <div class="timeline-body"><p>And we can also error on these cases, once we implement ordering comparisons on mismatched literals to always be an error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:197 on 2024-10-25 22:37</div>
            <div class="timeline-body"><p>Here too I think all we need is the explicit handling of mismatched literals case, this should never fallback to <code>Type::Instance</code> and typeshed at all, because the types are totally literal -- we just don't have the required cases in the match statement yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/tuples.md</code>:190 on 2024-10-25 22:38</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO should be Literal[False] once we implement comparison of mismatched literal types
reveal_type(a is b)  # revealed: bool
# TODO should be Literal[True] once we implement comparison of mismatched literal types
reveal_type(a is not b)  # revealed: bool
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/unsupported.md</code>:10 on 2024-10-25 22:39</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should error, once operand type check is implemented
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/unsupported.md</code>:16 on 2024-10-25 22:39</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should error, once operand type check is implemented
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3785 on 2024-10-25 22:41</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// Performs a membership test (`in` and `not in`) between two instances and returns the resulting type, or `None` if the test is unsupported.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> requested changes on 2024-10-25 22:42</div>
            <div class="timeline-body"><p>Code here looks great to me!! Thank you for following up with all the review comments.</p>
<p>I do have a bunch more review comments, but they are all about tests and mostly about TODOs :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cake-monotone">@cake-monotone</a> reviewed on 2024-10-26 17:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:3 on 2024-10-26 17:21</div>
            <div class="timeline-body"><p>Thanks for catching that! I've formatted it with an 80-character limit ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cake-monotone">@cake-monotone</a> on 2024-10-26 17:40</div>
            <div class="timeline-body"><p>Thanks so much for the super detailed and helpful review..!! Iâ€™ve already made updates based on your reviews.</p>
<p>Since the codeâ€™s mostly complete and I think Iâ€™ll be in a place where itâ€™ll be hard to make code changes for a while ðŸ˜¢ðŸ˜¢ðŸ˜¢, feel free to commit any needed fixes directly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:5 on 2024-10-26 17:44</div>
            <div class="timeline-body"><pre><code class="language-suggestion">In Python, the term &quot;membership test operators&quot; refers to the operators
`in` and `not in`. To customize their behavior, classes can implement one of
the special methods `__contains__`, `__iter__`, or `__getitem__`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:10 on 2024-10-26 17:45</div>
            <div class="timeline-body"><pre><code class="language-suggestion">- &lt;https://docs.python.org/3/reference/datamodel.html#object.__contains__&gt;
- &lt;https://snarky.ca/unravelling-membership-testing/&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:53 on 2024-10-26 17:49</div>
            <div class="timeline-body"><pre><code class="language-suggestion">The final fallback is to implement `__getitem__` for integer keys. Python will
call `__getitem__` with `0`, `1`, `2`... until either the needle is found
(leading the membership test to evaluate to `True`) or `__getitem__` raises
`IndexError` (the raised exception is swallowed, but results in the membership
test evaluating to `False`).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:68 on 2024-10-26 17:49</div>
            <div class="timeline-body"><pre><code class="language-suggestion">Python coerces the results of containment checks to `bool`, even if `__contains__`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:152 on 2024-10-26 17:50</div>
            <div class="timeline-body"><pre><code class="language-suggestion">the membership test is not supported and should trigger a diagnostic.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:12 on 2024-10-26 17:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">## Rich Comparison Dunder Implementations For Same Class
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:48 on 2024-10-26 17:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">## Rich Comparison Dunder Implementations for Other Class
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:89 on 2024-10-26 17:52</div>
            <div class="timeline-body"><pre><code class="language-suggestion">side does not define them. Note: class `B` has its own `__eq__` and `__ne__`
methods to override those of `object`, but these methods will be ignored here
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:122 on 2024-10-26 17:53</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should be `int` and `float`.
# Need to check arg type and fall back to `rhs.__eq__` and `rhs.__ne__`.
#
# Because `object.__eq__` and `object.__ne__` accept `object` in typeshed,
# this can only happen with an invalid override of these methods,
# but we still support it.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:147 on 2024-10-26 17:53</div>
            <div class="timeline-body"><pre><code class="language-suggestion">precedence over those in the parent class. Class `B` inherits from `A` and
redefines comparison methods to return types other than `A`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:285 on 2024-10-26 17:55</div>
            <div class="timeline-body"><p>Yes, just because we should emit a diagnostic telling the user off doesn't mean we should ignore what the annotation says! So this looks correct to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-10-26 17:57</div>
            <div class="timeline-body"><p>Some more docs nitpicks. I don't think any are controversial, so I'll just push them to your branch :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-10-26 18:04</div>
            <div class="timeline-body"><p>This looks ready to land to me! @AlexWaygood since you just reviewed as well, I'll assume you're good with it? I'll go ahead and enable auto-merge. Feel free to cancel if there's more you want to look at first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/membership_test.md</code>:134 on 2024-10-26 18:07</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should emit diagnostic, need to check arg type,
# should not fall back to __iter__ or __getitem__
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/instances/rich_comparison.md</code>:316 on 2024-10-26 18:08</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># TODO: should be Unknown and emit diagnostic,
# need to check arg type and should be failed
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/unsupported.md</code>:14 on 2024-10-26 18:10</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># (&quot;Operator `&lt;` is not supported for types `object` and `int`&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comparison/unsupported.md</code>:20 on 2024-10-26 18:10</div>
            <div class="timeline-body"><pre><code class="language-suggestion"># (&quot;Operator `&lt;` is not supported for types `int` and `object`&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3637 on 2024-10-26 18:11</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    #[must_use]
    const fn dunder(self) -&gt; &amp;'static str {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types/infer.rs</code>:3649 on 2024-10-26 18:11</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    #[must_use]
    const fn reflect(self) -&gt; Self {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-26 18:14</div>
            <div class="timeline-body"><p>Fantastic work. Thanks @cake-monotone!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Compare expression inference - Instance" to "[red-knot] Type inference for comparisons between arbitrary instances" by @AlexWaygood on 2024-10-26 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-10-26 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-10-26 18:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:00:09 UTC
    </footer>
</body>
</html>
