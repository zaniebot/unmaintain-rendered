<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-return`] Exempt cached properties and other property-like decorators from explicit return rule (`RET501`) - astral-sh/ruff #12563</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-return</code>] Exempt cached properties and other property-like decorators from explicit return rule (<code>RET501</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12563">#12563</a>
        opened by <a href="https://github.com/epenet">@epenet</a>
        on 2024-07-29 06:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epenet">@epenet</a></div>
            <div class="timeline-body">

Summary


<p>Follow-up to #12243, in which regular properties were exempted but not cached properties.</p>
<p>Still linked to <a href="https://github.com/home-assistant/core/pull/115031">home-assistant/core#115031</a></p>
Test Plan


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/epenet">@epenet</a> on 2024-07-29 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-07-29 06:41</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/epenet:20240729-0822">CodSpeed Performance Report</a>
Merging #12563 will <strong>not alter performance</strong>
<p>Comparing <code>epenet:20240729-0822</code> (c2c96bc) with <code>epenet:20240729-0822</code> (f452453)</p>
Summary
<p><code>✅ 33</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/epenet">@epenet</a> on 2024-07-29 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-07-29 07:15</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-07-30 06:43</div>
            <div class="timeline-body"><p>LGTM. Thank you. I let @AlexWaygood merge to get the blessing of someone who actually understands Python ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-30 06:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-07-30 10:32</div>
            <div class="timeline-body"><p>LGTM. I added support for other stdlib property-like decorators as well, such as <code>@abc.abstractproperty</code>, <code>@enum.property</code>, and <code>@types.DynamicClassAttribute</code>. I think the same rationale applies for special-casing these decorators as it does for special-casing <code>@functools.cached_property</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epenet">@epenet</a> reviewed on 2024-07-30 10:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epenet">@epenet</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_return/RET501.py</code>:36 on 2024-07-30 10:34</div>
            <div class="timeline-body"><p>Note: single line functions are ignored anyway.
So the print is needed for sensible testing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-30 10:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_return/rules/function.rs</code>:400 on 2024-07-30 10:35</div>
            <div class="timeline-body"><p>@epenet -- you had <code>semantic.resolve_qualified_name(map_callable(&amp;decorator.expression))</code> here. I think using <code>map_callable</code> would be incorrect in this instance. <code>map_callable()</code> is a convenience function for when we don&#x27;t care whether e.g. a function is decorated with <code>@functools.lru_cache</code> or <code>@functools.lru_cache()</code> (whether the decorator is a call-expression or not is irrelevant). But for all of these <code>property</code>-like decorators, you can only use them as <code>@property</code>; it&#x27;s invalid to use them as <code>@property()</code>. So for these decorators, we just want to call <code>resolve_qualified_name</code> directly on the expression, instead of passing it through <code>map_callable</code> first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-30 10:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_return/RET501.py</code>:36 on 2024-07-30 10:35</div>
            <div class="timeline-body"><p>Ah, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`flake8-return`] Exempt cached properties from explicit return rule (`RET501`)&quot; to &quot;[`flake8-return`] Exempt cached properties and other property-like decorators from explicit return rule (`RET501`)&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-30 10:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epenet">@epenet</a> reviewed on 2024-07-30 10:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epenet">@epenet</a> on <code>crates/ruff_linter/src/rules/flake8_return/rules/function.rs</code>:400 on 2024-07-30 10:43</div>
            <div class="timeline-body"><p>I copied it from elsewhere in the code base.
I wonder if this applies there as well...
And would it make sense to move this function to a shared location?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-30 10:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_return/rules/function.rs</code>:400 on 2024-07-30 10:48</div>
            <div class="timeline-body"><blockquote>
<p>I copied it from elsewhere in the code base.
I wonder if this applies there as well...</p>
</blockquote>
<p>It&#x27;s hard to say in general. For a lot of decorators (like <code>@lru_cache</code>), you really don&#x27;t care about whether it&#x27;s been decorated with <code>@lru_cache</code> or <code>@lru_cache()</code>. So while there may be other places in the codebase where it&#x27;s being used incorrectly, I&#x27;m pretty confident they&#x27;re not <em>all</em> incorrect ;-)</p>
<blockquote>
<p>And would it make sense to move this function to a shared location?</p>
</blockquote>
<p>Possibly...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_return/rules/function.rs</code>:400 on 2024-07-30 10:53</div>
            <div class="timeline-body"><p>Good that you asked. It seems we already have a general-purpose function for this:</p>
<p>https://github.com/astral-sh/ruff/blob/aaa56eb0bd7f2740c83587d03198bc12c8e69648/crates/ruff_python_semantic/src/analyze/visibility.rs#L63-L83</p>
<p>We should just use that for now. I&#x27;ll apply some fixes to it in a followup PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-30 10:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-30 11:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-30 11:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-30 11:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epenet">@epenet</a> reviewed on 2024-07-30 11:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epenet">@epenet</a> on <code>crates/ruff_linter/src/rules/flake8_return/rules/function.rs</code>:400 on 2024-07-30 11:31</div>
            <div class="timeline-body"><p>For reference, I wonder if it might make sense to look at <code>rules/pydoclint/rules/check_docstring.rs</code> also:
https://github.com/astral-sh/ruff/blob/459c85ba273ae347402b1759cacd1e7740cef121/crates/ruff_linter/src/rules/pydoclint/rules/check_docstring.rs#L442-L461</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-07-30 11:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_return/rules/function.rs</code>:400 on 2024-07-30 11:45</div>
            <div class="timeline-body"><p>nice, thanks</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:05:33 UTC
    </footer>
</body>
</html>
