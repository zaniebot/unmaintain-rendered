<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add AIR001: task variable name should be same as task_id arg - astral-sh/ruff #4687</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add AIR001: task variable name should be same as task_id arg</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4687">#4687</a>
        opened by <a href="https://github.com/jlaneve">@jlaneve</a>
        on 2023-05-27 20:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jlaneve">@jlaneve</a></div>
            <div class="timeline-body">

Summary


<p>This PR adds the first Ruff Airflow rule: AIR001. Related to #4421.</p>
<p>AIR001: An Airflow task&#x27;s Python variable name should be the same as the <code>task_id</code> arg you give it. This follows https://github.com/BasPH/pylint-airflow C8300.</p>
<p>This PR also adds the groundwork for adding new Airflow-related rules!</p>
Test Plan


<p>Unit tests included in the PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jlaneve">@jlaneve</a> reviewed on 2023-05-27 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jlaneve">@jlaneve</a> on <code>crates/ruff/src/rules/airflow/mod.rs</code>:51 on 2023-05-27 20:05</div>
            <div class="timeline-body"><p>I copied this from https://github.com/charliermarsh/ruff/blob/main/crates/ruff/src/rules/pandas_vet/mod.rs#L23-L55 - makes me wonder if this was the correct way of doing things, and if so, if there&#x27;s a nicer way of abstracting these unit tests to keep things in sync. I imagine the general pattern of &quot;this code should raise these linting diagnostics&quot; is quite common.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jlaneve">@jlaneve</a> reviewed on 2023-05-27 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jlaneve">@jlaneve</a> on <code>crates/ruff/src/rules/airflow/rules/tasks.rs</code>:73 on 2023-05-27 20:07</div>
            <div class="timeline-body"><p>in theory this should only be run if the class being called inherits from <code>airflow.models.baseoperator.BaseOperator</code>, but I wanted to get something up to at least start a discussion. Also worth noting that I tried <code>checker.ctx.resolve_call_path</code> but couldn&#x27;t get it to work... could certainly be user error though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-05-27 20:37</div>
            <div class="timeline-body">PR Check Results
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.06     14.9Â±0.04ms     2.7 MB/sec    1.00     14.1Â±0.05ms     2.9 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.03      3.5Â±0.00ms     4.7 MB/sec    1.00      3.4Â±0.00ms     4.9 MB/sec
linter/all-rules/numpy/globals.py          1.01    430.8Â±0.39Âµs     6.8 MB/sec    1.00    425.4Â±0.77Âµs     6.9 MB/sec
linter/all-rules/pydantic/types.py         1.05      6.1Â±0.01ms     4.2 MB/sec    1.00      5.8Â±0.01ms     4.4 MB/sec
linter/default-rules/large/dataset.py      1.09      7.5Â±0.02ms     5.4 MB/sec    1.00      6.9Â±0.01ms     5.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.05   1603.0Â±1.95Âµs    10.4 MB/sec    1.00   1522.9Â±3.15Âµs    10.9 MB/sec
linter/default-rules/numpy/globals.py      1.02    176.3Â±0.20Âµs    16.7 MB/sec    1.00    172.2Â±0.22Âµs    17.1 MB/sec
linter/default-rules/pydantic/types.py     1.07      3.3Â±0.01ms     7.6 MB/sec    1.00      3.1Â±0.01ms     8.2 MB/sec
parser/large/dataset.py                    1.00      5.2Â±0.00ms     7.9 MB/sec    1.00      5.1Â±0.00ms     7.9 MB/sec
parser/numpy/ctypeslib.py                  1.00   1021.1Â±2.41Âµs    16.3 MB/sec    1.00   1022.0Â±0.40Âµs    16.3 MB/sec
parser/numpy/globals.py                    1.00    105.9Â±0.20Âµs    27.9 MB/sec    1.00    105.5Â±0.34Âµs    28.0 MB/sec
parser/pydantic/types.py                   1.00      2.2Â±0.00ms    11.5 MB/sec    1.00      2.2Â±0.00ms    11.4 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     16.6Â±0.19ms     2.5 MB/sec    1.00     16.6Â±0.16ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.2Â±0.05ms     4.0 MB/sec    1.00      4.2Â±0.05ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00    498.7Â±5.34Âµs     5.9 MB/sec    1.01   503.2Â±13.33Âµs     5.9 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.0Â±0.07ms     3.6 MB/sec    1.01      7.0Â±0.09ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.1Â±0.07ms     5.0 MB/sec    1.01      8.2Â±0.04ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1752.8Â±19.64Âµs     9.5 MB/sec    1.01  1771.5Â±18.23Âµs     9.4 MB/sec
linter/default-rules/numpy/globals.py      1.00    202.1Â±2.77Âµs    14.6 MB/sec    1.03    207.5Â±4.94Âµs    14.2 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.7Â±0.04ms     6.9 MB/sec    1.01      3.7Â±0.05ms     6.8 MB/sec
parser/large/dataset.py                    1.15      7.4Â±0.04ms     5.5 MB/sec    1.00      6.5Â±0.04ms     6.3 MB/sec
parser/numpy/ctypeslib.py                  1.12  1374.7Â±15.24Âµs    12.1 MB/sec    1.00  1231.7Â±11.18Âµs    13.5 MB/sec
parser/numpy/globals.py                    1.08    136.1Â±1.68Âµs    21.7 MB/sec    1.00    125.8Â±2.02Âµs    23.5 MB/sec
parser/pydantic/types.py                   1.12      3.1Â±0.02ms     8.2 MB/sec    1.00      2.8Â±0.02ms     9.2 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jlaneve">@jlaneve</a> on 2023-05-27 21:07</div>
            <div class="timeline-body"><p>@charliermarsh any chance you can help with the CI issues? Not too sure whatâ€™s going on, this works fine locally and the code looks consistent with what I see elsewhere.</p>
<p>Feel free to push changes directly to this branch if itâ€™s easier than adding comments inline!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-27 21:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/airflow/mod.rs</code>:51 on 2023-05-27 21:16</div>
            <div class="timeline-body"><p>We tend to do this a bit less than might be expected. More commonly, we put the test fixtures in Python files (e.g., <code>crates/ruff/resources/test/fixtures/flake8_2020</code>), and then we have a <code>test_path</code> utility that runs over files + generates a snapshot. (You could see <code>rules/flake8_2020/mod.rs</code> as an example.)</p>
<p>I think this kind of inline testing is fine for simple snippets, if you prefer it. We could DRY up this <code>rule_code</code> utility as a TODO for later (and perhaps change it to use snapshots rather than encoding the expected violations).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-27 21:19</div>
            <div class="timeline-body"><p>Not sure what that failure was -- we replaced <code>.ctx</code> with <code>.semantic_model()</code>, but your branch was also passing for me locally (since that change was past your branch&#x27;s upstream). Maybe some kind of weird Cargo caching failure on CI? Regardless, I merged in <code>main</code> + changed the reference, so hopefully it passes now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jlaneve">@jlaneve</a> reviewed on 2023-05-27 22:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jlaneve">@jlaneve</a> on <code>crates/ruff/src/rules/airflow/mod.rs</code>:51 on 2023-05-27 22:29</div>
            <div class="timeline-body"><p>Nice, thanks for that info - planning to open up a follow-on PR documenting how the snapshots work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/jlaneve">@jlaneve</a> on 2023-05-27 22:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-29 03:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:1673 on 2023-05-29 03:18</div>
            <div class="timeline-body"><p>(Unrelated, but the newlines here felt inconsistent, so just removed.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/airflow/rules/task_variable_name.rs</code>:39 on 2023-05-29 03:19</div>
            <div class="timeline-body"><p>I renamed this to prefix with &quot;Airflow&quot; to match the &quot;Django&quot; and &quot;NumPy&quot; conventions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/airflow/rules/task_variable_name.rs</code>:43 on 2023-05-29 03:19</div>
            <div class="timeline-body"><p>(Added the <code>task_id</code> itself to the message.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/airflow/rules/task_variable_name.rs</code>:72 on 2023-05-29 03:21</div>
            <div class="timeline-body"><p>Modified this to use <code>resolve_call_path</code>, which will resolve to the fully qualified path -- so it&#x27;ll do the right thing in cases like:</p>
<pre><code>import airflow

foo = airflow.PythonOperator(...)

import airflow as Foo

foo = Foo.PythonOperator(...)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/airflow/rules/task_variable_name.rs</code>:80 on 2023-05-29 03:21</div>
            <div class="timeline-body"><p>Can use <code>?</code> to tighten this up a little.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>README.md</code>:294 on 2023-05-29 03:22</div>
            <div class="timeline-body"><p>I decided to link to the Pylint plugin, since this list refers to tools we&#x27;ve reimplemented, and it felt more appropriate than &quot;Airflow&quot; -- wdyt?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-29 03:23</div>
            <div class="timeline-body"><p>Looks great @jlaneve! I went ahead and pushed some changes, but commenting on them here for clarity + transparency -- let me know if any of them are incorrect, confusing, etc. Thanks for getting this started!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-29 03:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-29 03:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jlaneve">@jlaneve</a> on <code>README.md</code>:294 on 2023-05-29 18:54</div>
            <div class="timeline-body"><p>yeah this makes sense to me! hopefully we get to a point where we&#x27;re linting for more than just pylint-airflow though ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jlaneve">@jlaneve</a> reviewed on 2023-05-29 18:54</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:54:01 UTC
    </footer>
</body>
</html>
