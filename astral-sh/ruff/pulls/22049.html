<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Skip literal branches in union builder if it contains no literals - astral-sh/ruff #22049</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Skip literal branches in union builder if it contains no literals</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22049">#22049</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-12-18 08:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2025-12-18 08:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-18 08:35</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-12-18 09:00</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a></h2>
<h3>Merging #22049 will <strong>degrade performances by 59.81%</strong></h3>
<p><sub>Comparing <code>micha/union-builder-literal</code> (2f6b96f) with <code>micha/union-builder-simplify</code> (eecc160)</sub></p>
<h3>Summary</h3>
<p><code>❌ 6</code> regressions<br />
<code>✅ 16</code> untouched<br />
<code>⏩ 30</code> skipped[^skipped]</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?utm_source=github&amp;utm_medium=comment&amp;utm_content=acknowledge">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Mode | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | ---- | --------- | ------ | ------ | ------ |
| ❌ | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Amedium%5Bpandas%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>medium[pandas]</code></a> | 62.3 s | 79.1 s | -21.27% |
| ❌ | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Amultithreaded%5Baltair%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>multithreaded[altair]</code></a> | 1.4 s | 3.4 s | -59.81% |
| ❌ | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Asmall%5Baltair%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>small[altair]</code></a> | 5.2 s | 7.9 s | -34.98% |
| ❌ | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Asmall%5Bfreqtrade%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>small[freqtrade]</code></a> | 7.8 s | 9.4 s | -16.7% |
| ❌ | WallTime | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?uri=crates%2Fruff_benchmark%2Fbenches%2Fty_walltime.rs%3A%3Alarge%5Bsympy%5D&amp;runnerMode=WallTime&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>large[sympy]</code></a> | 49.4 s | 83.5 s | -40.89% |
| ❌ | Simulation | <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?uri=crates%2Fruff_benchmark%2Fbenches%2Fty.rs%3A%3Aproject%3A%3Aanyio%3A%3Aproject%3A%3Aanyio&amp;runnerMode=Instrumentation&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=benchmark"><code>anyio</code></a> | 1.3 s | 1.5 s | -8.73% |
[^skipped]: 30 benchmarks were skipped, so the baseline results were used instead. If they were deleted from the codebase, <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Funion-builder-literal?sectionId=benchmark-comparison-section-baseline-result-skipped&amp;utm_source=github&amp;utm_medium=comment&amp;utm_content=archive">click here and archive them to remove them from the performance reports</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-18 09:01</div>
            <div class="timeline-body"><p>Haha, that's not the result I expected. I must be overlooking something why it is that we always want to iterate over <code>elements</code> even if there are no existing literals in the union</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-12-18 09:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:18:11 UTC
    </footer>
</body>
</html>
