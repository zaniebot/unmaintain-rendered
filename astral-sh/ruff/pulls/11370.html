<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix(F822): Enable F822 in __init__.py files by default - astral-sh/ruff #11370</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix(F822): Enable F822 in <strong>init</strong>.py files by default</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11370">#11370</a>
        opened by <a href="https://github.com/hassec">@hassec</a>
        on 2024-05-11 17:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hassec">@hassec</a></div>
            <div class="timeline-body"><p><strong>NOTE</strong>
The actual implementation of this PR changed during review, the below description is outdated.</p>
<h2>Summary</h2>
<p>This PR aims to close #10095 by adding an option <code>init-allow-undef-export</code> to the <code>pyflakes</code> settings. This option is currently set to <code>true</code> such that behavior is kept identical.
But setting this option to <code>false</code> will lead to <code>F822</code> warnings to be shown in all files, <strong>including</strong> <code>__init__.py</code> files.</p>
<p>As I've mentioned on #10095, I think <code>init-allow-undef-export=false</code> would be the more user-friendly default option, as it creates fewer surprises. @charliermarsh what do you think about making that the default?</p>
<p>With this option in place, it's a single line fix for people that rely on the old behavior.</p>
<p>And thinking longer term, for future major releases, one could probably consider deprecating the option and eventually having people just <code>noqa</code> these warnings if they are not wanted.</p>
<h2>Test Plan</h2>
<p>I've added a <code>test_init_f822_enabled</code> test which repeats the test that is done in the <code>init</code> test but this time with <code>init-allow-undef-export=false</code> and the snap file correctly shows that ruff will then trigger the otherwise suppressed F822 warning.</p>
<p>closes #10095</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-05-11 17:45</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+12 -0 violations, +0 -0 fixes in 5 projects; 45 projects unchanged)</p>
<details><summary><a href="https://github.com/PostHog/HouseWatch">PostHog/HouseWatch</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/PostHog/HouseWatch/blob/849261caaa4ac78aeddb64c4bcae23088efb6181/housewatch/tasks/__init__.py#L5'>housewatch/tasks/__init__.py:5:43:</a> F822 Undefined name `customer_report` in `__all__`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+2 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/0b9232e54d61357930c71737fb51657c834fc6d7/airflow/providers/cncf/kubernetes/utils/__init__.py#L19'>airflow/providers/cncf/kubernetes/utils/__init__.py:19:12:</a> F822 Undefined name `xcom_sidecar` in `__all__`
+ <a href='https://github.com/apache/airflow/blob/0b9232e54d61357930c71737fb51657c834fc6d7/airflow/providers/cncf/kubernetes/utils/__init__.py#L19'>airflow/providers/cncf/kubernetes/utils/__init__.py:19:28:</a> F822 Undefined name `pod_manager` in `__all__`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/mlflow/mlflow">mlflow/mlflow</a> (+4 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/mlflow/mlflow/blob/89c44d9e2468cc083a7fd6b3cb6d9921982fd6aa/mlflow/metrics/__init__.py#L444'>mlflow/metrics/__init__.py:444:5:</a> F822 Undefined name `accuracy` in `__all__`
+ <a href='https://github.com/mlflow/mlflow/blob/89c44d9e2468cc083a7fd6b3cb6d9921982fd6aa/mlflow/metrics/__init__.py#L456'>mlflow/metrics/__init__.py:456:5:</a> F822 Undefined name `binary_recall` in `__all__`
+ <a href='https://github.com/mlflow/mlflow/blob/89c44d9e2468cc083a7fd6b3cb6d9921982fd6aa/mlflow/metrics/__init__.py#L457'>mlflow/metrics/__init__.py:457:5:</a> F822 Undefined name `binary_precision` in `__all__`
+ <a href='https://github.com/mlflow/mlflow/blob/89c44d9e2468cc083a7fd6b3cb6d9921982fd6aa/mlflow/metrics/__init__.py#L458'>mlflow/metrics/__init__.py:458:5:</a> F822 Undefined name `binary_f1_score` in `__all__`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/prefecthq/prefect">prefecthq/prefect</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/prefecthq/prefect/blob/0b359a7a03daab3021402869c2cd7dc79049f5d5/src/prefect/blocks/__init__.py#L7'>src/prefect/blocks/__init__.py:7:12:</a> F822 Undefined name `notifications` in `__all__`
+ <a href='https://github.com/prefecthq/prefect/blob/0b359a7a03daab3021402869c2cd7dc79049f5d5/src/prefect/blocks/__init__.py#L7'>src/prefect/blocks/__init__.py:7:29:</a> F822 Undefined name `system` in `__all__`
+ <a href='https://github.com/prefecthq/prefect/blob/0b359a7a03daab3021402869c2cd7dc79049f5d5/src/prefect/blocks/__init__.py#L7'>src/prefect/blocks/__init__.py:7:39:</a> F822 Undefined name `webhook` in `__all__`
</pre>

</p>
</details>
<details><summary><a href="https://github.com/indico/indico">indico/indico</a> (+2 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/indico/indico/blob/105617f251881a9b1a139cc260e26df12f264b34/indico/modules/api/__init__.py#L20'>indico/modules/api/__init__.py:20:12:</a> F822 Undefined name `settings` in `__all__`
+ <a href='https://github.com/indico/indico/blob/105617f251881a9b1a139cc260e26df12f264b34/indico/modules/logs/__init__.py#L19'>indico/modules/logs/__init__.py:19:60:</a> F822 Undefined name `CategoryLogRealm` in `__all__`
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| F822 | 12 | 12 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-16 02:11</div>
            <div class="timeline-body"><p>I'm wondering if we should instead always enable this, and ask users to add <code>F822</code> to <code>per-file-ignores</code> if they want it disabled in that context. Could you try always enabling this, and see if the ecosystem checks surface any violations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-16 02:12</div>
            <div class="timeline-body"><p>I.e., if we think tis should be the default, maybe we just make it the default and use the existing <code>per-file-ignores</code> mechanism for those that need to turn it off?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hassec">@hassec</a> on 2024-05-16 02:32</div>
            <div class="timeline-body"><p>Thanks for taking a look at this @charliermarsh.
I like your suggestion, I'd be happy to have this be the default :blush:</p>
<p>I've changed the PR to simply remove the special handling of F822 warnings from <code>__init__.py</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hassec">@hassec</a> on 2024-05-26 00:53</div>
            <div class="timeline-body"><p>@charliermarsh just a gentle reminder üòä
To me, the ecosystem checks actually show that it would be beneficial to make this the default, and I bet most people assume that their <code>__init__.py</code> files are getting checked already.
And I like your suggestion of just having people use <code>per-file-ignore</code> for the few cases where it would be a false positive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-26 14:46</div>
            <div class="timeline-body"><p>Could you make this change only apply when preview mode is enabled so we don't increase the scope of the rule without a stabilization period? I think it'd be <code>checker.settings.preview.is_enabled()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hassec">@hassec</a> on 2024-05-30 00:15</div>
            <div class="timeline-body"><p>@zanieb apologies for the slow reply, it's been a busy work week so far.</p>
<p>I've made the suggested change and added a test for the preview to make sure the preview enabled scenario is tested too.</p>
<p>How long do changes like this usually have to be in preview, before they can become stable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-30 00:52</div>
            <div class="timeline-body"><p>Thanks @hassec. Will take a look shortly. We tend to leave a change in preview for one minor release (so this would be elevated in v0.6.0, since v0.5.0 will go out in the next few weeks).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-05-30 03:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-05-30 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-30 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-30 03:16</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/hassec:enable_f822_in_init">CodSpeed Performance Report</a></h2>
<h3>Merging #11370 will <strong>improve performances by 7.9%</strong></h3>
<p><sub>Comparing <code>hassec:enable_f822_in_init</code> (164d4cf) with <code>hassec:enable_f822_in_init</code> (686ef15)</sub></p>
<h3>Summary</h3>
<p><code>‚ö° 1</code> improvements
<code>‚úÖ 29</code> untouched benchmarks</p>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>hassec:enable_f822_in_init</code> | <code>hassec:enable_f822_in_init</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ö° | <code>parser[numpy/ctypeslib.py]</code> | 1.2 ms | 1.1 ms | +7.9% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-06-01 17:46</div>
            <div class="timeline-body"><p>Hey thanks for the change! Just a nitpick as a user about the changelog entry, it says</p>
<blockquote>
<p>[pyflakes] Add option to enable F822 in <strong>init</strong>.py files (https://github.com/astral-sh/ruff/pull/11370)</p>
</blockquote>
<p>So I went looking for the new option, even reading this PR's description and looking for <code>init-allow-undef-export</code>, but turns out this is just enabled by default, with an appropriate <code>lint.per-file-ignores</code> recommendation to disable ^^&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-01 18:04</div>
            <div class="timeline-body"><p>Thanks, good call!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "fix(F822): add option to enable F822 in __init__.py files" to "fix(F822): Enable F822 in __init__.py files by default" by @hassec on 2024-06-03 12:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:04:17 UTC
    </footer>
</body>
</html>
