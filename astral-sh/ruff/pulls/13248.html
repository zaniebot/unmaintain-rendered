<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] consolidate diagnostic and inference tests - astral-sh/ruff #13248</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] consolidate diagnostic and inference tests</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13248">#13248</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2024-09-04 22:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>Pull the tests from <code>types.rs</code> into <code>infer.rs</code>.</p>
<p>All of these are integration tests with the same basic form: create a code sample, run type inference or check on it, and make some assertions about types and/or diagnostics. These are the sort of tests we will want to move into a test framework with a low-boilerplate custom textual format. In the meantime, having them together (and more importantly, their helper utilities together) means that it&#x27;s easy to keep tests for related language features together (iterable tests with other iterable tests, callable tests with other callable tests), without an artificial split based on tests which test diagnostics vs tests which test inference. And it allows a single test to more easily test both diagnostics and inference. (Ultimately in the test framework, they will likely all test diagnostics, just in some cases the diagnostics will come from <code>reveal_type()</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/carljm">@carljm</a> on 2024-09-04 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/carljm">@carljm</a> on 2024-09-04 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/carljm">@carljm</a> on 2024-09-04 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-09-04 22:18</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-09-05 06:28</div>
            <div class="timeline-body"><p>I would be more leaning towards moving the tests in the other direction, considering that <code>types</code> is the API but whatever. Let&#x27;s build a testing framework instead to solve this for good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-09-05 10:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-09-05 15:57</div>
            <div class="timeline-body"><p>Yeah we could just as well put them in <code>types.rs</code>. It&#x27;s not hard to do, I can push that change. But I agree, hopefully they don&#x27;t stay in either of these files for too much longer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-09-05 15:58</div>
            <div class="timeline-body"><p>Actually I&#x27;m not going to push that change because it will cause too much pain in rebasing my WIP on declared types, where I add a bunch of new tests :) We&#x27;ll just leave them in <code>infer.rs</code> for now until they get moved into a testing framework.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-05 16:00</div>
            <div class="timeline-body"><blockquote>
<p>Yeah we could just as well put them in <code>types.rs</code>. It&#x27;s not hard to do, I can push that change. But I agree, hopefully they don&#x27;t stay in either of these files for too much longer.</p>
</blockquote>
<p>I&#x27;m fine either way. I prefer what ever takes the least of your time (which is what you have now)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/carljm">@carljm</a> on 2024-09-05 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2024-09-05 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-05 16:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:06:35 UTC
    </footer>
</body>
</html>
