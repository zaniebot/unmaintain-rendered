<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Use `Unknown | T_inferred` for undeclared public symbols - astral-sh/ruff #15674</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Use <code>Unknown | T_inferred</code> for undeclared public symbols</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15674">#15674</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-01-22 15:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-01-22 15:39</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Use <code>Unknown | T_inferred</code> as the type for <em>undeclared</em> public symbols.</p>
<h2>Test Plan</h2>
<ul>
<li>Updated existing tests</li>
<li>New test for external <code>__slots__</code> modifications.</li>
<li>New tests for external modifications of public symbols.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @sharkdp on 2025-01-22 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-22 15:45</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/unary/not.md</code>:144 on 2025-01-22 15:48</div>
            <div class="timeline-body"><p>This is currently a workaround to avoid running into https://github.com/astral-sh/ruff/issues/15672</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 15:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/attributes.md</code>:256 on 2025-01-22 15:49</div>
            <div class="timeline-body"><p>This is the actual TODO I attempted to resolve!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 15:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/instances.md</code>:266 on 2025-01-22 15:52</div>
            <div class="timeline-body"><p>This is one example of a particularly annoying case that also comes up with <code>__iter__ = â€¦</code>, <code>__bool__ = â€¦</code>, <code>__enter__ = â€¦</code>, <code>__exit__ = â€¦</code>, etc.</p>
<p>The symbol <code>__add__</code> is not declared here, so we end up inferring <code>Unknown | A</code> for it, which results in <code>Unknown | int</code> when <code>call</code>ed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 15:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/callable_instance.md</code>:55 on 2025-01-22 15:53</div>
            <div class="timeline-body"><p>Another instance of the callable problem. Notice how the usefulness of the error message degrades.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/expression/boolean.md</code>:58 on 2025-01-22 15:55</div>
            <div class="timeline-body"><p>This whole test feels somewhat contrived, but it's maybe a symptom of a larger problem in which we don't understand re-exports of symbols that are not also re<em>declared</em>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 15:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/narrow/type.md</code>:102 on 2025-01-22 15:57</div>
            <div class="timeline-body"><p>I can not annotate this alias as <code>Literal[type]</code>, as that can't be spelled (except using <code>knot_extensions.TypeOf</code>, which I didn't want to use here).</p>
<p><code>type[type]</code> is too broad for the current narrowing code which pattern-matches on <code>ClassLiteral(&quot;type&quot;)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4146 on 2025-01-22 16:00</div>
            <div class="timeline-body"><p>TODO for me: special casing for <code>Final</code> symbols (etc) should also be done here (just like in <code>symbol</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 16:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/booleans.md</code>:54 on 2025-01-22 16:23</div>
            <div class="timeline-body"><p>another way of fixing this test would have been to just do this, correct?</p>
<pre><code class="language-diff">- a = True
- b = False
+ a: bool = True
+ b: bool = False
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/instances.md</code>:266 on 2025-01-22 16:55</div>
            <div class="timeline-body"><p>Not too worried about this, because almost always these will be normal methods defined within the class (which is a declaration), not assigned like this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/boundness_declaredness/public.md</code>:164 on 2025-01-22 16:57</div>
            <div class="timeline-body"><pre><code class="language-suggestion">We use the union of `Unknown` with the inferred type as the public type, if a symbol has no declared
type.

If there is no declaration, then the symbol can be reassigned to any type from another scope; the union
with `Unknown` reflects that its type must at least be as large as the type of the assigned value, but 
could be arbitrarily larger.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/call/callable_instance.md</code>:55 on 2025-01-22 16:59</div>
            <div class="timeline-body"><p>Yes, this is really begging for nested diagnostics (so you get both &quot;Object of type <code>NonCallable</code> is not callable&quot; and nested details explaining why.)</p>
<p>We could easily adjust the handling so you still get &quot;Object of type <code>NonCallable</code> is not callable&quot; here, but then you lose the details of <em>which</em> union element failed callability.</p>
<p>Even without nested diagnostics we <em>could</em> still provide all of the information here in a new error, it just requires more and more bespoke error-cases handling in the <code>__call__</code> lookup code. (We would need to match on the case that callability of <code>__call__</code> failed due to a union, and then write a new custom error message for that case which mentions both the outer <code>NonCallable</code> type and the details of why its <code>__call__</code> isn't callable.) Nested diagnostics would just let us handle this kind of situation more generically, with less special casing.</p>
<p>cc @BurntSushi @MichaReiser re diagnostics considerations</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/expression/boolean.md</code>:58 on 2025-01-22 17:18</div>
            <div class="timeline-body"><p>It's not that we don't understand them, it's that we now accurately reflect the fact that they could be reassigned to something else.</p>
<p>We do consider imports to be declarations, so the common case of re-exporting (that uses an import, not an assignment) wouldn't be subject to this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/instances.md</code>:266 on 2025-01-22 17:23</div>
            <div class="timeline-body"><p>it would be nice if there was an <code>Infer</code> annotation we could use for &quot;just infer the type for me and use it as the public type&quot; :/ <code>Callable</code> annotations in Python are, um, not ergonomic :(</p>
<p>However, realistically: it's very unusual to use non-function instances as methods like this. This kind of thing is quite common:</p>
<pre><code class="language-py">class Foo:
    def __or__(self, other) -&gt; int:
        return 42

    __ror__ = __or__
</code></pre>
<p>But I <em>think</em> that will still be fine with this change, since functions have the same declared type as their inferred type?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/expression/len.md</code>:178 on 2025-01-22 17:29</div>
            <div class="timeline-body"><p>wow, um... it's not your fault, but I think this test should definitely have some comments next to it saying how we don't really support enums at all yet ðŸ˜„ I think I can see why the result changes here, but it seems incorrect that we allow <code>Literal[SomeEnum.INT]</code> at all as an annotation given that we don't yet infer the correct type for <code>SomeEnum.INT</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-01-22 17:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-22 17:40</div>
            <div class="timeline-body"><p>Thank you for this! This makes it clear what the impact of this change would be. I agree that the most unintuitive thing is that we'd infer <code>Unknown</code> unions when local scopes reference types from enclosing scopes:</p>
<pre><code class="language-py">X = 1

def foo():
    reveal_type(X)  # Unknown | Literal[1]  :(
</code></pre>
<p>This <em>is</em> probably more correct, though? Because <code>X</code> might be mutated by other modules &quot;monkey-patching&quot; this module's globals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-01-22 17:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/instances.md</code>:266 on 2025-01-22 17:50</div>
            <div class="timeline-body"><p>No, I think we'd have a problem with <code>__ror__</code> in that example, because it's not declared (<code>__or__</code> is).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 18:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/booleans.md</code>:54 on 2025-01-22 18:03</div>
            <div class="timeline-body"><p>Yes. That's what I did at first. Then I noticed that <code>b</code> is not used anywhere. And then I changed it to the current version, because â€¦ I'd rather not change it again if we change our type inference for public symbols.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-22 18:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/booleans.md</code>:54 on 2025-01-22 18:04</div>
            <div class="timeline-body"><p>makes sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 18:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/expression/len.md</code>:178 on 2025-01-22 18:05</div>
            <div class="timeline-body"><p>Yes, I also seem to remember that we said in the original PR that those test cases are not particularly important, so I didn't bother to fix them / add a TODO. Let me know if you think otherwise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-22 18:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/instances.md</code>:266 on 2025-01-22 18:08</div>
            <div class="timeline-body"><blockquote>
<p>No, I think we'd have a problem with <code>__ror__</code> in that example, because it's not declared (<code>__or__</code> is).</p>
</blockquote>
<p>Yes. It would be the exact same case as with <code>__add__</code> here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-22 18:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/binary/instances.md</code>:266 on 2025-01-22 18:10</div>
            <div class="timeline-body"><p>Yeah, I see, thanks. This seems bad :( I just don't know how we'd explain this to users</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comprehensions/basic.md</code>:47 on 2025-01-23 14:10</div>
            <div class="timeline-body"><p>every comprehension has its own scope, so we also look up <code>y</code> as a public symbol :face_with_diagonal_mouth:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-23 14:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-01-23 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @sharkdp on 2025-01-23 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-23 15:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:97 on 2025-01-23 15:13</div>
            <div class="timeline-body"><p>This is probably a questionable choice. I don't know what else to do though. The problem appears with <code>typing.Any</code>, <code>typing.List</code>, <code>typing.Union</code>, â€¦, <code>knot_extensions.Unknown</code>, <code>knot_extensions.AlwaysTrue</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-23 15:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comprehensions/basic.md</code>:47 on 2025-01-23 15:30</div>
            <div class="timeline-body"><p>I believe this is something @AlexWaygood wanted to look into, if I'm not mistaken (after outcome)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-23 20:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/boundness_declaredness/public.md</code>:114 on 2025-01-23 20:46</div>
            <div class="timeline-body"><p>We should probably cancel one of the dynamic types here? We might have a ticket for that. I'll note it down as a follow up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-23 21:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/resources/mdtest/boundness_declaredness/public.md</code>:114 on 2025-01-23 21:17</div>
            <div class="timeline-body"><p>I think we have a TODO in <code>Type::is_gradual_equivalent_to</code> pointing out that not doing this causes problems... but I don't know that we have a ticket</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/assignment/augmented.md</code>:99 on 2025-01-23 21:32</div>
            <div class="timeline-body"><p>I'm not sure I understand where the new <code>Unknown</code> is coming from here? We are revealing the type of <code>f</code> locally within the scope, so it shouldn't be due to modifiability of <code>f</code>. And both <code>__add__</code> and <code>__iadd__</code> are declared in the body of <code>Foo</code> (because function definition statements are declarations), so I don't think either of those should be unioned with <code>Unknown</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/assignment/augmented.md</code>:119 on 2025-01-23 21:32</div>
            <div class="timeline-body"><p>Same question; why does <code>Unknown</code> show up here now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/assignment/augmented.md</code>:163 on 2025-01-23 21:33</div>
            <div class="timeline-body"><p>And same question here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/boundness_declaredness/public.md</code>:114 on 2025-01-23 21:38</div>
            <div class="timeline-body"><p>I agree that we should do that, but it will also make this test less clearly testing what it is supposed to test. The reason we use <code>x: Any</code> here is that it a) doesn't disappear in union with <code>Literal[1]</code> but b) also doesn't cause an invalid-declaration diagnostic.</p>
<p>But we can discuss how to handle this in the follow up PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/comprehensions/basic.md</code>:47 on 2025-01-23 21:42</div>
            <div class="timeline-body"><p>Yes, for nested scopes that are known to execute eagerly (list/set/dict comprehensions, class bodies), and for ones that probably execute eagerly (generator expressions), we should model the name lookup as a &quot;use&quot; in the outer scope, at that point in control flow of the outer scope, rather than as a public type lookup. Alex has WIP on this, and it should fix this TODO and the one below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/unary/not.md</code>:144 on 2025-01-23 21:45</div>
            <div class="timeline-body"><p>Maybe that information could be recorded in a TODO comment here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-01-23 21:48</div>
            <div class="timeline-body"><p>Thank you!</p>
<p>I would like to understand where <code>Unknown</code> is coming from in the cases I commented inline; otherwise this looks good to go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/assignment/augmented.md</code>:99 on 2025-01-23 21:55</div>
            <div class="timeline-body"><p><code>__iadd__</code> is possibly undeclared.</p>
<p>I'm not 100% clear on the semantics of <code>__add__</code> and <code>__iadd__</code>, so I suspect that you think that this possibly-undeclaredness should be absorbed by the definite-declaredness of <code>__add__</code>?</p>
<p>I'll look into that tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-23 21:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-01-23 21:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/assignment/augmented.md</code>:99 on 2025-01-23 21:58</div>
            <div class="timeline-body"><p>Hmm. I said off the top of my head that we should add <code>Unknown</code> to the union for possibly-undeclared, because the &quot;declared type&quot; in the undeclared path is <code>Unknown</code>. But now I'm wondering if that's just wrong. An external assignment that violates the possibly-declared type would effectively be creating a conflicting-declarations situation, and we currently error on conflicting declarations, so it seems like we should also error on that assignment. Which we would do, if we didn't union with <code>Unknown</code> for possibly-undeclared.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-24 10:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_python_semantic/resources/mdtest/assignment/augmented.md</code>:99 on 2025-01-24 10:42</div>
            <div class="timeline-body"><p>That makes sense to me. To make it more concrete, my understanding is that we would always want to show an error in the last line here, because it is possible that <code>flag</code> is <code>True</code>, and in this case, we would violate the declaration.</p>
<pre><code class="language-py">def _(flag: bool):
    class C:
        if flag:
            var: int

        var = 1

    C.var = &quot;a&quot;
</code></pre>
<p>we would always want to show an error in the last line.</p>
<p>I'll revert f4ca4b88c1530eae60df633d6d41a866e1f97d4b and add a new test.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-01-24 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-01-24 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-24 11:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:51 UTC
    </footer>
</body>
</html>
