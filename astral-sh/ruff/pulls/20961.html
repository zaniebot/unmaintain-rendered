<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] `dataclass_transform`: Support for fields with an `alias` - astral-sh/ruff #20961</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] <code>dataclass_transform</code>: Support for fields with an <code>alias</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20961">#20961</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-10-18 17:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>closes <a href="https://github.com/astral-sh/ty/issues/1385">astral-sh/ty#1385</a></p>
Conformance tests
<p>Two false positives removed, as expected.</p>
Test Plan
<p>New Markdown tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] `dataclass_tranform`: Support for fields with an `alias`&quot; to &quot;[ty] `dataclass_transform`: Support for fields with an `alias`&quot; by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-18 17:31</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-10-18 18:18:00.160030501 +0000
+++ new-output.txt	2025-10-18 18:18:03.582057401 +0000
@@ -244,7 +244,6 @@
 dataclasses_postinit.py:29:7: error[unresolved-attribute] Type `DC1` has no attribute `y`
 dataclasses_slots.py:66:1: error[unresolved-attribute] Type `&lt;class &#x27;DC6&#x27;&gt;` has no attribute `__slots__`
 dataclasses_slots.py:69:1: error[unresolved-attribute] Type `DC6` has no attribute `__slots__`
-dataclasses_transform_class.py:60:36: error[unknown-argument] Argument `other_name` does not match any known parameter
 dataclasses_transform_class.py:66:8: error[missing-argument] No arguments provided for required parameters `id`, `name`
 dataclasses_transform_class.py:66:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 2
 dataclasses_transform_class.py:72:6: error[unsupported-operator] Operator `&lt;` is not supported for types `Customer1` and `Customer1`
@@ -296,7 +295,6 @@
 dataclasses_transform_func.py:71:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 2
 dataclasses_transform_func.py:77:36: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `T@create_model_frozen`
 dataclasses_transform_func.py:97:1: error[invalid-assignment] Property `id` defined in `Customer3` is read-only
-dataclasses_transform_meta.py:60:36: error[unknown-argument] Argument `other_name` does not match any known parameter
 dataclasses_transform_meta.py:66:8: error[missing-argument] No arguments provided for required parameters `id`, `name`
 dataclasses_transform_meta.py:66:18: error[too-many-positional-arguments] Too many positional arguments: expected 0, got 2
 dataclasses_transform_meta.py:73:6: error[unsupported-operator] Operator `&lt;` is not supported for types `Customer1` and `Customer1`
@@ -917,5 +915,5 @@
 typeddicts_usage.py:28:17: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Invalid key access on TypedDict `Movie`: Unknown key &quot;title&quot;
 typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions. Did you mean to use a concrete TypedDict or `collections.abc.Mapping[str, object]` instead?
-Found 919 diagnostics
+Found 917 diagnostics
 WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-18 17:32</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>Tanjun (https://github.com/FasterSpeeding/Tanjun)
- tanjun/commands/menu.py:608:19: error[missing-argument] No arguments provided for required parameters `_name`, `_type`
- tanjun/commands/menu.py:609:13: error[unknown-argument] Argument `type` does not match any known parameter
- tanjun/commands/menu.py:610:13: error[unknown-argument] Argument `name` does not match any known parameter
- tanjun/commands/menu.py:611:13: error[unknown-argument] Argument `name_localizations` does not match any known parameter
- tanjun/commands/menu.py:612:13: error[unknown-argument] Argument `is_nsfw` does not match any known parameter
- tanjun/context/autocomplete.py:236:13: error[missing-argument] No arguments provided for required parameters `_name`, `_value`
- tanjun/context/autocomplete.py:236:51: error[unknown-argument] Argument `name` does not match any known parameter
- tanjun/context/autocomplete.py:236:62: error[unknown-argument] Argument `value` does not match any known parameter
- tanjun/context/slash.py:647:17: error[unknown-argument] Argument `attachments` does not match any known parameter
- tanjun/context/slash.py:648:17: error[unknown-argument] Argument `components` does not match any known parameter
- tanjun/context/slash.py:649:17: error[unknown-argument] Argument `embeds` does not match any known parameter
- tanjun/context/slash.py:650:17: error[unknown-argument] Argument `flags` does not match any known parameter
- tanjun/context/slash.py:651:17: error[unknown-argument] Argument `is_tts` does not match any known parameter
- tanjun/context/slash.py:652:17: error[unknown-argument] Argument `mentions_everyone` does not match any known parameter
- tanjun/context/slash.py:653:17: error[unknown-argument] Argument `user_mentions` does not match any known parameter
- tanjun/context/slash.py:654:17: error[unknown-argument] Argument `role_mentions` does not match any known parameter
- Found 115 diagnostics
+ Found 99 diagnostics

trio (https://github.com/python-trio/trio)
- src/trio/_core/_asyncgens.py:232:36: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_core/_run.py:628:35: error[missing-argument] No argument provided for required parameter `_scope`
- src/trio/_core/_run.py:628:48: error[unknown-argument] Argument `scope` does not match any known parameter
- src/trio/_core/_run.py:628:60: error[unknown-argument] Argument `parent` does not match any known parameter
- src/trio/_core/_run.py:3046:26: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_cancelled.py:80:27: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_local.py:12:31: error[unknown-argument] Argument `default` does not match any known parameter
- src/trio/_core/_tests/test_local.py:41:31: error[unknown-argument] Argument `default` does not match any known parameter
- src/trio/_core/_tests/test_run.py:350:28: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:380:27: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:380:39: error[unknown-argument] Argument `relative_deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:383:27: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:385:27: error[unknown-argument] Argument `relative_deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:388:27: error[unknown-argument] Argument `relative_deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:485:44: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_core/_tests/test_run.py:603:36: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_core/_tests/test_run.py:622:28: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:762:31: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:1188:28: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:1821:28: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:1822:32: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_core/_tests/test_run.py:3004:32: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_file_io.py:295:31: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_subprocess.py:759:35: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_subprocess.py:760:50: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_sync.py:865:35: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_tests/test_threads.py:384:32: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_tests/test_threads.py:879:36: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_timeouts.py:28:29: error[unknown-argument] Argument `deadline` does not match any known parameter
- src/trio/_timeouts.py:28:48: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_timeouts.py:56:9: error[unknown-argument] Argument `shield` does not match any known parameter
- src/trio/_timeouts.py:57:9: error[unknown-argument] Argument `relative_deadline` does not match any known parameter
- Found 612 diagnostics
+ Found 580 diagnostics

</code></pre>

No memory usage changes detected âœ…

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-18 17:35</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>unknown-argument</code> | 0 | 45 | 0 |
| <code>missing-argument</code> | 0 | 3 | 0 |
| <strong>Total</strong> | <strong>0</strong> | <strong>48</strong> | <strong>0</strong> |</p>
<p><strong><a href="https://david-dataclass-transform-al.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://david-dataclass-transform-al.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:02</div>
            <div class="timeline-body"><p>I noticed that <a href="https://github.com/astral-sh/ty/issues/1159">astral-sh/ty#1159</a> is still not fixed after this PR (only one of the two errors goes away). But I don&#x27;t think anything is wrong with <code>dataclass_transform</code> or <code>field_specifiers</code>. There&#x27;s something wrong with overload resolution or generics, which causes us to infer unknown for calls to Pydantics <code>Field</code> if <code>default</code> and <code>alias</code> are both passed as keyword arguments. Everything works fine if <code>default</code> is passed positional-only or not at all. Will address/report this separately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8005 on 2025-10-18 18:04</div>
            <div class="timeline-body"><p>It&#x27;s possible using <code>Option&lt;Name&gt;</code> might lead to fewer allocations here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:662 on 2025-10-18 18:09</div>
            <div class="timeline-body"><pre><code>                        let alias = alias
                            .and_then(Type::as_string_literal)
                            .map(|literal| Box::from(literal.value(db)));
</code></pre>
<p>(though this would need to be revised slightly if you do refactor to use <code>Option&lt;Name&gt;</code> instead of <code>Option&lt;Box&lt;str&gt;&gt;</code> ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-10-18 18:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-18 18:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:8005 on 2025-10-18 18:13</div>
            <div class="timeline-body"><p>Yes, but then <code>FieldInstance</code> itself will be larger for <em>every</em> field, not just those that use <code>alias</code>. I haven&#x27;t measured it but I&#x27;d rather go with the more memory-conservative option here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/dataclasses/dataclass_transform.md</code>:568 on 2025-10-18 18:19</div>
            <div class="timeline-body"><p>It looks like we just ignore the <code>alias</code> argument if you try to pass a value for <code>alias</code> that&#x27;s an instance of <code>str</code>, but isn&#x27;t a string literal. We should probably emit a diagnostic for that, to warn the user that we can&#x27;t figure out what they&#x27;re trying to do? Though it&#x27;s admittedly a bit of an edge case. E.g.</p>
<pre><code>from typing_extensions import dataclass_transform, Any

def field_with_alias(*, alias: str | None = None, kw_only: bool = False) -&gt; Any: ...
@dataclass_transform(field_specifiers=(field_with_alias,))
def model[T](cls: type[T]) -&gt; type[T]:
    return cls

def _(alias: str):
    @model
    class Person:
        internal_name: str = field_with_alias(alias=alias)
        internal_age: int = field_with_alias(alias=alias, kw_only=True)
    
    reveal_type(Person.__init__)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-18 18:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-18 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-18 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-18 18:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/dataclasses/dataclass_transform.md</code>:568 on 2025-10-18 18:34</div>
            <div class="timeline-body"><p>Right. Will write this down.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:19:41 UTC
    </footer>
</body>
</html>
