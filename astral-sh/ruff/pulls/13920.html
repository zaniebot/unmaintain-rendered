<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable nursery rules: 'redundant_clone', 'debug_assert_with_mut_call', and 'unused_peekable' - astral-sh/ruff #13920</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable nursery rules: &#x27;redundant_clone&#x27;, &#x27;debug_assert_with_mut_call&#x27;, and &#x27;unused_peekable&#x27;</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13920">#13920</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-10-25 07:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>This PR makes clippy more pedantic ;)</p>
<p>It enables three more clippy rules that capture code patterns that caused bugs in the past or that I noticed during code reviews:</p>
<ul>
<li><code>redundant_clone</code>: It&#x27;s easy to needlessly clone a value and this has come up in reviews.</li>
<li><code>debug_assert_with_mut_call</code>: A first version of red knot contained debug asserts with mut calls and it broke downstream packaging because some of them ran our tests in release mode. This has also come up in contributions where it was unclear why the benchmark failed but all tests pass.</li>
<li><code>unused_peekable</code>: It&#x27;s so easy to forget removing the <code>.peekable</code> call</li>
</ul>
Test Plan
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-25 07:27</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/util/subscript.rs</code>:21 on 2024-10-25 07:41</div>
            <div class="timeline-body"><p>Why are we allowing it for this module? Could you possibly add a comment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-25 07:42</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-10-25 07:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/util/subscript.rs</code>:21 on 2024-10-25 07:46</div>
            <div class="timeline-body"><p>It&#x27;s just tests and removing the clone would make adding a new case more verbose. I think it&#x27;s very self-explanatory if you remove the allow, and I don&#x27;t mind if someone&#x27;s eager to fix the unnecessary calls. It just didn&#x27;t felt worth my time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 07:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-25 07:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:07:47 UTC
    </footer>
</body>
</html>
