<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pycodestyle`] Add blank line(s) rules (`E301`, `E302`, `E303`, `E304`, `E305`, `E306`) - astral-sh/ruff #9266</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pycodestyle</code>] Add blank line(s) rules (<code>E301</code>, <code>E302</code>, <code>E303</code>, <code>E304</code>, <code>E305</code>, <code>E306</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9266">#9266</a>
        opened by <a href="https://github.com/hoel-bagard">@hoel-bagard</a>
        on 2023-12-24 13:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a></div>
            <div class="timeline-body">Summary
<p>This PR is part of <a href="https://github.com/charliermarsh/ruff/issues/2402">charliermarsh/ruff#2402</a>, it adds the <code>E301</code>, <code>E302</code>, <code>E303</code>, <code>E304</code>, <code>E305</code>, <code>E306</code> error rules along with their fixes.</p>
<p>This PR is based on <a href="https://github.com/astral-sh/ruff/pull/8720">astral-sh/ruff#8720</a>, but does not use logical lines and instead works directly on tokens.</p>
Test Plan
<p>The test fixture uses <a href="https://github.com/PyCQA/pycodestyle/blob/main/testsuite/E30.py">the one from pycodestyle</a> with a some added tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2023-12-24 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2023-12-24 13:56</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/hoel-bagard:blank_lines_non_logical">CodSpeed Performance Report</a>
Merging #9266 will <strong>degrade performances by 4.52%</strong>
<p>Comparing <code>hoel-bagard:blank_lines_non_logical</code> (aea3493) with <code>main</code> (fdb5eef)</p>
Summary
<p><code>‚ö° 8</code> improvements
<code>‚ùå 1</code> regressions
<code>‚úÖ 21</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/hoel-bagard:blank_lines_non_logical">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>hoel-bagard:blank_lines_non_logical</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ‚ö° | <code>lexer[unicode/pypinyin.py]</code> | 571.5 ¬µs | 545.2 ¬µs | +4.84% |
| ‚ö° | <code>lexer[numpy/globals.py]</code> | 223.5 ¬µs | 159.9 ¬µs | +39.75% |
| ‚ö° | <code>parser[numpy/globals.py]</code> | 1,117.5 ¬µs | 982 ¬µs | +13.8% |
| ‚ö° | <code>parser[large/dataset.py]</code> | 69.1 ms | 63.9 ms | +8.17% |
| ‚ö° | <code>lexer[numpy/ctypeslib.py]</code> | 1.8 ms | 1.7 ms | +11.36% |
| ‚ùå | <code>linter/all-with-preview-rules[numpy/ctypeslib.py]</code> | 21.6 ms | 22.7 ms | -4.52% |
| ‚ö° | <code>parser[unicode/pypinyin.py]</code> | 4.3 ms | 4 ms | +8.26% |
| ‚ö° | <code>parser[pydantic/types.py]</code> | 26.4 ms | 24.5 ms | +7.71% |
| ‚ö° | <code>parser[numpy/ctypeslib.py]</code> | 11.8 ms | 10.8 ms | +9.47% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-12-24 14:37</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚ÑπÔ∏è ecosystem check <strong>detected linter changes</strong>. (+3951 -26 violations, +0 -0 fixes in 11 projects; 32 projects unchanged)</p>
<a href="https://github.com/RasaHQ/rasa">RasaHQ/rasa</a> (+8 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/data/test_classes/nlu_component_skeleton.py#L11">data/test_classes/nlu_component_skeleton.py:11:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/scripts/evaluate_release_tag.py#L41">scripts/evaluate_release_tag.py:41:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/stubs/aio_pika/robust_channel.pyi#L10">stubs/aio_pika/robust_channel.pyi:10:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/stubs/sanic.pyi#L23">stubs/sanic.pyi:23:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/stubs/sanic.pyi#L25">stubs/sanic.pyi:25:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/stubs/sanic.pyi#L27">stubs/sanic.pyi:27:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/stubs/sanic.pyi#L30">stubs/sanic.pyi:30:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/RasaHQ/rasa/blob/cca30d4e06af5aba177e916d64c60313fc537005/stubs/socketio.pyi#L49">stubs/socketio.pyi:49:1:</a> E302 [*] Expected 2 blank lines, found 1
... 1 additional changes omitted for rule E302
</pre>

</p>

<a href="https://github.com/apache/airflow">apache/airflow</a> (+12 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/compat/functools.pyi#L27">airflow/compat/functools.pyi:27:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/decorators/__init__.pyi#L160">airflow/decorators/__init__.pyi:160:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/decorators/__init__.pyi#L318">airflow/decorators/__init__.pyi:318:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/decorators/__init__.pyi#L63">airflow/decorators/__init__.pyi:63:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/decorators/__init__.pyi#L723">airflow/decorators/__init__.pyi:723:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/utils/context.pyi#L106">airflow/utils/context.pyi:106:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/utils/context.pyi#L108">airflow/utils/context.pyi:108:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/utils/context.pyi#L47">airflow/utils/context.pyi:47:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/utils/context.pyi#L51">airflow/utils/context.pyi:51:1:</a> E302 [*] Expected 2 blank lines, found 1
... 3 additional changes omitted for rule E302
+ <a href="https://github.com/apache/airflow/blob/c297f55d7aa39fda69530887f1dcfcea8a951463/airflow/utils/context.pyi#L53">airflow/utils/context.pyi:53:5:</a> E301 [*] Expected 1 blank line, found 0
... 2 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/aws/aws-sam-cli">aws/aws-sam-cli</a> (+106 -25 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/buildcmd/Provided/main.py#L3">tests/integration/testdata/buildcmd/Provided/main.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/buildcmd/custom_root_dir/main.py#L3">tests/integration/testdata/buildcmd/custom_root_dir/main.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/buildcmd/custom_root_dir_and_custom_makefile/custom_src_code/main.py#L3">tests/integration/testdata/buildcmd/custom_root_dir_and_custom_makefile/custom_src_code/main.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/buildcmd/custom_root_dir_custom_makefile_and_custom_working_dir/working_dir/main.py#L3">tests/integration/testdata/buildcmd/custom_root_dir_custom_makefile_and_custom_working_dir/working_dir/main.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/buildcmd/custom_working_dir_src_code/working_dir/main.py#L3">tests/integration/testdata/buildcmd/custom_working_dir_src_code/working_dir/main.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/buildcmd/provided_src_code_without_makefile/main.py#L3">tests/integration/testdata/buildcmd/provided_src_code_without_makefile/main.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
... 101 additional changes omitted for rule E302
- <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/start_api/lambda_authorizers/app.py#L122">tests/integration/testdata/start_api/lambda_authorizers/app.py:122:17:</a> E203 [*] Whitespace before &#x27;:&#x27;
- <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/start_api/lambda_authorizers/app.py#L123">tests/integration/testdata/start_api/lambda_authorizers/app.py:123:15:</a> E203 [*] Whitespace before &#x27;:&#x27;
- <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/start_api/lambda_authorizers/app.py#L131">tests/integration/testdata/start_api/lambda_authorizers/app.py:131:8:</a> E221 [*] Multiple spaces before operator
- <a href="https://github.com/aws/aws-sam-cli/blob/fefee10b10563d5e1e42dbec5d01597b8a04f3fa/tests/integration/testdata/start_api/lambda_authorizers/app.py#L132">tests/integration/testdata/start_api/lambda_authorizers/app.py:132:9:</a> E221 [*] Multiple spaces before operator
... 121 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+3280 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/docs/bokeh/source/conf.py#L230">docs/bokeh/source/conf.py:230:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/gears/gears.py#L102">examples/advanced/extensions/gears/gears.py:102:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/gears/gears.py#L13">examples/advanced/extensions/gears/gears.py:13:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/gears/gears.py#L16">examples/advanced/extensions/gears/gears.py:16:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/gears/gears.py#L21">examples/advanced/extensions/gears/gears.py:21:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/gears/gears.py#L34">examples/advanced/extensions/gears/gears.py:34:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/gears/gears.py#L62">examples/advanced/extensions/gears/gears.py:62:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/parallel_plot/parallel_plot.py#L109">examples/advanced/extensions/parallel_plot/parallel_plot.py:109:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/putting_together.py#L85">examples/advanced/extensions/putting_together.py:85:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/putting_together.py#L93">examples/advanced/extensions/putting_together.py:93:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/tool.py#L74">examples/advanced/extensions/tool.py:74:1:</a> E302 [*] Expected 2 blank lines, found 1
... 2442 additional changes omitted for rule E302
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/tool.py#L78">examples/advanced/extensions/tool.py:78:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/advanced/extensions/widget.py#L52">examples/advanced/extensions/widget.py:52:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/basic/annotations/colorbar_log.py#L19">examples/basic/annotations/colorbar_log.py:19:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
... 324 additional changes omitted for rule E305
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/output/apis/autoload_static.py#L34">examples/output/apis/autoload_static.py:34:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/output/apis/autoload_static.py#L43">examples/output/apis/autoload_static.py:43:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/examples/server/app/clustering/main.py#L25">examples/server/app/clustering/main.py:25:1:</a> E303 [*] Too many blank lines (3)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/release/deploy.py#L55">release/deploy.py:55:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/connection.py#L366">src/bokeh/client/connection.py:366:9:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/connection.py#L366">src/bokeh/client/connection.py:366:9:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/client/states.py#L110">src/bokeh/client/states.py:110:5:</a> E303 [*] Too many blank lines (2)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/document/events.py#L234">src/bokeh/document/events.py:234:5:</a> E303 [*] Too many blank lines (2)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/document/events.py#L518">src/bokeh/document/events.py:518:9:</a> E303 [*] Too many blank lines (2)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/driving.py#L114">src/bokeh/driving.py:114:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/driving.py#L170">src/bokeh/driving.py:170:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/driving.py#L189">src/bokeh/driving.py:189:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/driving.py#L91">src/bokeh/driving.py:91:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/embed/__init__.py#L54">src/bokeh/embed/__init__.py:54:1:</a> E303 [*] Too many blank lines (3)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/layouts.py#L323">src/bokeh/layouts.py:323:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
... 186 additional changes omitted for rule E306
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/model/model.py#L559">src/bokeh/model/model.py:559:13:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/model/model.py#L79">src/bokeh/model/model.py:79:5:</a> E303 [*] Too many blank lines (2)
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/models/plots.py#L907">src/bokeh/models/plots.py:907:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/models/ui/dialogs.py#L58">src/bokeh/models/ui/dialogs.py:58:5:</a> E303 [*] Too many blank lines (2)
... 37 additional changes omitted for rule E303
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/server.py#L283">src/bokeh/server/server.py:283:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/server/session.py#L231">src/bokeh/server/session.py:231:9:</a> E301 [*] Expected 1 blank line, found 0
... 260 additional changes omitted for rule E301
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/tests/unit/bokeh/server/test_server__server.py#L469">tests/unit/bokeh/server/test_server__server.py:469:1:</a> E304 [*] Blank lines found after function decorator (1)
... 3244 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/commaai/openpilot">commaai/openpilot</a> (+458 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/.github/build.py#L30">.github/build.py:30:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/.github/build.py#L9">.github/build.py:9:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/api/__init__.py#L10">common/api/__init__.py:10:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/conversions.py#L3">common/conversions.py:3:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/gpio.py#L12">common/gpio.py:12:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/gpio.py#L19">common/gpio.py:19:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/gpio.py#L29">common/gpio.py:29:1:</a> E302 [*] Expected 2 blank lines, found 1
... 349 additional changes omitted for rule E302
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/logging_extra.py#L216">common/logging_extra.py:216:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/tests/test_params.py#L87">common/tests/test_params.py:87:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/commaai/openpilot/blob/ec9f3dcef367e6c29756ededa7e83783ef280cfa/common/tests/test_params.py#L87">common/tests/test_params.py:87:5:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
... 448 additional changes omitted for project
</pre>

</p>

<a href="https://github.com/freedomofpress/securedrop">freedomofpress/securedrop</a> (+2 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/freedomofpress/securedrop/blob/d19958c1b62937ad06b07f083fd1ca84a5970acb/molecule/testinfra/app/test_tor_hidden_services.py#L11">molecule/testinfra/app/test_tor_hidden_services.py:11:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/freedomofpress/securedrop/blob/d19958c1b62937ad06b07f083fd1ca84a5970acb/redwood/redwood/__init__.pyi#L6">redwood/redwood/__init__.pyi:6:1:</a> E302 [*] Expected 2 blank lines, found 1
</pre>

</p>

<a href="https://github.com/fronzbot/blinkpy">fronzbot/blinkpy</a> (+4 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/fronzbot/blinkpy/blob/0ec0346f776952f7abe5b9feb53200e60e488bf6/blinksync/forms.py#L56">blinksync/forms.py:56:5:</a> E301 [*] Expected 1 blank line, found 0
+ <a href="https://github.com/fronzbot/blinkpy/blob/0ec0346f776952f7abe5b9feb53200e60e488bf6/blinksync/forms.py#L71">blinksync/forms.py:71:5:</a> E303 [*] Too many blank lines (2)
+ <a href="https://github.com/fronzbot/blinkpy/blob/0ec0346f776952f7abe5b9feb53200e60e488bf6/blinksync/forms.py#L77">blinksync/forms.py:77:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/fronzbot/blinkpy/blob/0ec0346f776952f7abe5b9feb53200e60e488bf6/blinksync/forms.py#L9">blinksync/forms.py:9:1:</a> E302 [*] Expected 2 blank lines, found 1
</pre>

</p>

<a href="https://github.com/milvus-io/pymilvus">milvus-io/pymilvus</a> (+56 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/_version_helper.py#L51">_version_helper.py:51:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/_version_helper.py#L53">_version_helper.py:53:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/bfloat16_example.py#L17">examples/bfloat16_example.py:17:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/bfloat16_example.py#L28">examples/bfloat16_example.py:28:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/bfloat16_example.py#L71">examples/bfloat16_example.py:71:1:</a> E305 [*] Expected 2 blank lines after class or function definition, found (1)
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/binary_example.py#L16">examples/binary_example.py:16:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/example_bulkinsert_json.py#L116">examples/example_bulkinsert_json.py:116:1:</a> E302 [*] Expected 2 blank lines, found 1
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/example_bulkinsert_json.py#L131">examples/example_bulkinsert_json.py:131:1:</a> E302 [*] Expected 2 blank lines, found 1
... 40 additional changes omitted for rule E302
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/example_bulkinsert_json.py#L339">examples/example_bulkinsert_json.py:339:9:</a> E306 [*] Expected 1 blank line before a nested definition, found 0
+ <a href="https://github.com/milvus-io/pymilvus/blob/24558a34fab812cc742b7885ed3296caa2c25ca3/examples/example_bulkinsert_json.py#L378">examples/example_bulkinsert_json.py:378:5:</a> E303 [*] Too many blank lines (2)
... 46 additional changes omitted for project
</pre>

</p>


<p><em>... Truncated remaining completed project reports due to GitHub comment length restrictions</em></p>
Changes by rule (11 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| E302 | 2985 | 2985 | 0 | 0 | 0 |
| E305 | 402 | 402 | 0 | 0 | 0 |
| E301 | 278 | 278 | 0 | 0 | 0 |
| E306 | 202 | 202 | 0 | 0 | 0 |
| E303 | 82 | 82 | 0 | 0 | 0 |
| E203 | 16 | 0 | 16 | 0 | 0 |
| E221 | 7 | 0 | 7 | 0 | 0 |
| PLR0917 | 2 | 1 | 1 | 0 | 0 |
| E304 | 1 | 1 | 0 | 0 | 0 |
| I001 | 1 | 0 | 1 | 0 | 0 |
| PLR6301 | 1 | 0 | 1 | 0 | 0 |</p>
</p>


Formatter (stable)
<p>‚úÖ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>‚úÖ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2023-12-29 04:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2024-01-05 09:18</div>
            <div class="timeline-body"><p>Pinging @MichaReiser since you&#x27;d reviewed the earlier version #8720 previously üòÑ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 06:49</div>
            <div class="timeline-body"><p>Hey @hoel-bagard</p>
<p>Sorry for the delay. I&#x27;ve been on PTO for the last two weeks but moving this PR forward is one of my goals for this week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:325 on 2024-01-10 07:18</div>
            <div class="timeline-body"><p>This comment is misleading. It returns <code>true</code> when the token is <code>class</code> or <code>def</code> and not <code>Async</code></p>
<p>I recommend removing the comment and replace it with an explanation why testing for <code>Class</code> and <code>Def</code> is sufficient to know if we&#x27;re at a top level.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-01-10 07:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:346 on 2024-01-10 07:22</div>
            <div class="timeline-body"><p><code>TextSize</code> is commonly used to represent a byte offset or byte count, but not a character length or count. I recommend renaming the field if the unit is in bytes or changing the type to <code>usize</code> if the unit is characters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-01-10 07:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:337 on 2024-01-10 07:25</div>
            <div class="timeline-body"><p>We can speed up the implementation by changing the type here (and for <code>last_token</code>) to <code>TokenKind</code>. <code>TokenKind</code> is a smaller type than <code>Token</code> that only represents the kind of the token, without its data. I did a quick check and only knowning the type seems sufficient.</p>
<p>Using the <code>TokenKind</code> has the added advantage that it implements <code>Copy</code> and doesn&#x27;t require allocating/deallocating (cloning)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:390 on 2024-01-10 07:32</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code>            if !token.is_newline() {
</code></pre>
<p>The same applies for other places where you match for a single token kind.</p>
<p>Alternatively. You can perform an early conversion of <code>token</code> to <code>TokenKind</code> and then use <code>==</code> comparison (or the is methods as well).</p>
<pre><code>            let kind = TokenKind::from_token(token);

            if token != TokenKind::Newline {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:382 on 2024-01-10 07:36</div>
            <div class="timeline-body"><p>We should change <code>first_token</code> and <code>last_token</code> to <code>TokenKind</code> to remove the need for <code>cloning</code> the tokens (will help to speed up the implementation)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:381 on 2024-01-10 07:38</div>
            <div class="timeline-body"><p>Can there be situation where <code>first_token</code> or <code>first_token_range</code> are not both either <code>None</code> or <code>Some</code>? E.g. can it happen that <code>first_token</code> is <code>Some</code> but <code>first_token_range</code> is None or the other way? If not, then I recommend changing <code>first_token</code> to <code>Option&lt;(TokenKind, TextRange)&gt;</code> to encode this constraint in your types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:403 on 2024-01-10 07:49</div>
            <div class="timeline-body"><p>I think it would help readability if we can reduce the nesting here. One way to accomplish this is by using <code>TokenKind::is_trivia</code> which returns <code>true</code> for tokens that are no actual content (comments, newlines, indent, dedent etc).</p>
<p>That allows us to move setting <code>line_is_comment_only</code> out of the nested loop</p>
<pre><code>if !kind.is_trivia() {
    line_is_comment_only = false;
}
</code></pre>
<p>We may want to rename <code>line_is_comment_only</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:432 on 2024-01-10 08:02</div>
            <div class="timeline-body"><p>I think the <code>first_token</code> == <code>Indent</code> branch is dead because we always skip over indents and dedents.</p>
<pre><code>                    let range = 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:472 on 2024-01-10 08:19</div>
            <div class="timeline-body"><p>I restructured the code here by pulling out the empty line case. It allows us to use local variables for <code>current_blank_lines</code> and <code>current_blank_characters</code> which, in my view, helps readability</p>
<pre><code>        // Number of consecutive blank lines.
        let mut current_blank_lines = 0u32;
        // Number of blank characters in the blank lines (\n vs \r\n for example).
        let mut current_blank_characters = TextSize::default();
        let mut first_token: Option&lt;Tok&gt; = None;
        let mut first_token_range: Option&lt;TextRange&gt; = None;
        let mut last_token: Option&lt;Tok&gt; = None;
        let mut parens = 0u32;

        while let Some((token, range)) = self.tokens.next() {
            if matches!(token, Tok::Indent | Tok::Dedent) {
                continue;
            }

            let kind = TokenKind::from_token(token);

            // At the start of the line...
            if first_token.is_none() {
                // An empty line
                if kind == TokenKind::NonLogicalNewline {
                    current_blank_lines += 1;
                    current_blank_characters += range.len();
                    continue;
                }

                if !kind.is_newline() {
                    // Ideally, we would like to have a &quot;async def&quot; token since we care about the &quot;def&quot; part.
                    // As a work around, we ignore the first token if it is &quot;async&quot;.
                    if kind != TokenKind::Async {
                        first_token = Some(token.clone());
                    }

                    if first_token_range.is_none() {
                        first_token_range = Some(*range);
                    }
                }
            }

            if !kind.is_trivia() {
                line_is_comment_only = false;
            }

            if !kind.is_newline() &amp;&amp; !matches!(token, Tok::String { .. } | Tok::Comment(_)) {
                is_docstring = false;
            }

            match token {
                Tok::Lbrace | Tok::Lpar | Tok::Lsqb =&gt; {
                    parens = parens.saturating_add(1);
                }
                Tok::Rbrace | Tok::Rpar | Tok::Rsqb =&gt; {
                    parens = parens.saturating_sub(1);
                }
                Tok::Newline | Tok::NonLogicalNewline if parens == 0 =&gt; {
                    let last_token_range = *range;

                    if !matches!(first_token, Some(Tok::String { .. })) {
                        is_docstring = false;
                    }

                    let first_range = first_token_range.unwrap();

                    let range = TextRange::new(
                        self.locator.line_start(first_range.start()),
                        first_range.start(),
                    );
                    let indent_level = expand_indent(self.locator.slice(range));

                    if self.previous_blank_lines &lt; current_blank_lines {
                        self.previous_blank_lines = current_blank_lines;
                    }

                    let logical_line = LogicalLineInfo {
                        first_token: first_token.clone().unwrap(),
                        first_token_range: first_range,
                        last_token: last_token.unwrap(),
                        last_token_range,
                        is_comment_only: line_is_comment_only,
                        is_docstring,
                        indent_level,
                        blank_lines: current_blank_lines,
                        preceding_blank_lines: self.previous_blank_lines,
                        preceding_blank_characters: current_blank_characters,
                    };

                    if !line_is_comment_only {
                        self.previous_blank_lines = 0;
                    }

                    return Some(logical_line);
                }
                _ =&gt; {}
            }

            last_token = Some(token.clone());
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:89 on 2024-01-10 08:23</div>
            <div class="timeline-body"><p>Nit:</p>
<p>We can make the field private.</p>
<p>I think it would help readability if we named the field. I otherwise need to look at the usages to understand what the <code>u32</code> represents</p>
<pre><code>pub struct BlankLineBetweenMethods {
    actual_blank_lines: u32
}
</code></pre>
<p>The same applies to the other violation types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:450 on 2024-01-10 08:25</div>
            <div class="timeline-body"><p>Would you mind adding a comment explaining why <code>previous_blank_lines</code> is set to <code>current_blank_lines</code> but only when <code>current_blank_lines</code> is larger? I don&#x27;t understand the reason and find it confusing, because it means that <code>previous</code> and <code>current_blank_lines</code> have the same value if the condition is true.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:408 on 2024-01-10 08:29</div>
            <div class="timeline-body"><p>It&#x27;s unclear to me how this check ensures that we allow comments to follow a docstring.</p>
<p>I would expect the check to be something along</p>
<pre><code>if first_token != Some(TokenKind::String) &amp;&amp; token != TokenKind::Comment {
    is_docstring = false
}
</code></pre>
<p>Which, I think, should remove the need for the check on line 423.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:428 on 2024-01-10 08:31</div>
            <div class="timeline-body"><p>It would be helpful to add a comment here describing why unwrapping <code>first_token_range</code> (and further below <code>first_token</code>) is safe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:483 on 2024-01-10 08:32</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code>    pub(crate) fn check_lines(
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:33 on 2024-01-10 08:33</div>
            <div class="timeline-body"><p>Nit: Let&#x27;s move <code>BlankLinesChecker</code> (together with <code>Follows</code> and <code>Status</code>) closer to its implementation block. It reduces the amount of scrolling necessary when reading the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:22 on 2024-01-10 08:37</div>
            <div class="timeline-body"><p>This <code>allow</code> seems unnecessary</p>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:482 on 2024-01-10 08:38</div>
            <div class="timeline-body"><p>It seems that this <code>allow</code> isn&#x27;t needed (clippy seems happy without it)</p>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:32 on 2024-01-10 08:39</div>
            <div class="timeline-body"><p>Let&#x27;s use <code>TokenKind</code> for <code>previous_unindented_token</code> to avoid cloning (and speed up the rule)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:536 on 2024-01-10 08:45</div>
            <div class="timeline-body"><p>How does this handle nested classes and functions? Like, how does it remember the indent level of nested classes and functions?</p>
<pre><code>class Test:
    def test():
        class Inner:
            def inner():
                pass
    def no_spacing():
        pass    
    
</code></pre>
<p>I fear that we need to keep a stack where each <code>Stack</code> entry is either a <code>Function</code> or <code>Class</code>, with the current indent level.</p>
<p>The advantage of using a Stack is that it probably helps to remove some of the duplication (we now have code that handles the class and almost the same code that handles the function cases)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:555 on 2024-01-10 08:51</div>
            <div class="timeline-body"><p>IMO, it helps readability if we match on Status first. It makes it clear, that these two blocks handle two different statuses (I first worried that the <code>!line.is_comment_only</code> path might override some of the changes made above, but that&#x27;s not the case)</p>
<pre><code>        match self.class_status {
            Status::Inside(nesting_indent) =&gt; {
                if line.indent_level &lt; nesting_indent {
                    if line.is_comment_only {
                        self.class_status = Status::CommentAfter(nesting_indent);
                    } else {
                        self.class_status = Status::Outside;
                    }
                }
            }
            Status::CommentAfter(indent) =&gt; {
                if !line.is_comment_only {
                    if line.indent_level &gt;= indent {
                        self.class_status = Status::Inside(indent);
                    }
                    self.class_status = Status::Outside;
                }
            }
            Status::Outside =&gt; {
                // Nothing to do
            }
        }

        if let Status::Inside(nesting_indent) = self.fn_status {
            if line.indent_level &lt; nesting_indent {
                if line.is_comment_only {
                    self.fn_status = Status::CommentAfter(nesting_indent);
                } else {
                    self.fn_status = Status::Outside;
                }
            }
        }

        // A comment can be de-indented while still being in a class/function, in that case
        // we need to revert the variables.
        if !line.is_comment_only {
            if let Status::CommentAfter(indent) = self.fn_status {
                if line.indent_level &gt;= indent {
                    self.fn_status = Status::Inside(indent);
                }
                self.fn_status = Status::Outside;
            }
        }

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:545 on 2024-01-10 08:52</div>
            <div class="timeline-body"><p>Should this line be inside an <code>else</code> branch? It otherwise always overrides the status set inside the <code>if line.indent_level &gt;= indent</code> branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:344 on 2024-01-10 08:54</div>
            <div class="timeline-body"><p>Would you mind adding a comment explaining the difference between <code>blank_lines</code> and <code>preceding_blank_lines</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:602 on 2024-01-10 08:56</div>
            <div class="timeline-body"><p>What happens if there are more blank lines than <code>BLANK_LINES_TOP_LEVEL</code>? Will there be no fix? How do we ensure the subtraction doesn&#x27;t underflow in this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:704 on 2024-01-10 09:07</div>
            <div class="timeline-body"><p>As far as I understand it&#x27;s impossible for <code>first_token</code> to be the <code>Async</code> token because we explicitly skip it in the <code>LinePreprocessor</code>.</p>
<pre><code>            Tok::Def =&gt; {
</code></pre>
<p>It could make sense to have a custom <code>FirstToken</code> enum that only has the variants that we care about in the <code>BlankLines</code> implementation (could it be the same as <code>Follows</code>?). It would move the detection of the supported kinds into the <code>LinePreprocessor</code> and make it easier to reason about if all relevant tokens have been handled in the <code>check_line</code> function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:393 on 2024-01-10 09:08</div>
            <div class="timeline-body"><p>If we don&#x27;t have it already. Can we add a test for <code>async with </code> to verify that async with statements aren&#x27;t incorrectly detected as async function definitions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:719 on 2024-01-10 09:13</div>
            <div class="timeline-body"><p>Setting a boolean is fairly cheap. We can just always set it (branching may easily be more expensive when the branch predictor fails to predict the right branch. That&#x27;s why writing the boolean is probably always faster and it&#x27;s less code)</p>
<pre><code>            self.is_not_first_logical_line = true;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:723 on 2024-01-10 09:15</div>
            <div class="timeline-body"><p>Nit: We can move this out of the <code>!line.is_comment_only</code> block to reduce some nesting (which is safe, because <code>is_docstring</code> can never be true for <code>is_comment_only</code>)</p>
<pre><code>if line.is_docstring {
    self.follows = Follows::Docstring
}

if !line.is_comment_only {
    ...
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:340 on 2024-01-10 09:16</div>
            <div class="timeline-body"><p>It seems to be sufficient to only store the end offset of the last token.</p>
<pre><code>    last_token_end: TextSize,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:727 on 2024-01-10 09:21</div>
            <div class="timeline-body"><p>Testing for comments here seems unnecessary because a logical line starting with a comment is guaranteed to be a comment only line</p>
<pre><code>            if line.indent_level == 0 {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:343 on 2024-01-10 09:24</div>
            <div class="timeline-body"><p>Calling this field <code>indent_level</code> can be misleading because, from what I understand from the code, it stores the indentation length in columns.</p>
<p>To explain the difference, let&#x27;s take a look at the following example:</p>
<pre><code>def test(a):
    if a == 1:
        pass
</code></pre>
<p>The indentation of <code>pass</code> is 8 spaces but the indent-level is 2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:438 on 2024-01-10 09:25</div>
            <div class="timeline-body"><p>I just noticed that <code>expand_indent</code> hardcodes the size of tabs to 8, which is incorrect. It should respect the <code>LinterSettings::tab_size</code> setting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:687 on 2024-01-10 09:30</div>
            <div class="timeline-body"><p>Simply adding <code>indent_size</code> (which is always 4) won&#x27;t produce the right result if a user uses e.g. 2 spaces indentation.</p>
<p>I recommend changing <code>Inside</code> to store the indentation of the Class rather than the indentation of its body (removing the need to add <code>indent_size</code>).</p>
<p>We know we&#x27;re outside of the class if the <code>actual_indent &lt;= class_indent</code>.</p>
<p>Let&#x27;s also add some tests with an indent other than 4 (2 spaces, tabs, mixed spaces and tabs)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:660 on 2024-01-10 09:32</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code>                &amp;&amp; line.first_token == Tok::Def
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:589 on 2024-01-10 09:32</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code>                // Only apply to functions or classes.
                &amp;&amp; is_top_level_token_or_decorator(&amp;line.first_token)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-01-10 09:36</div>
            <div class="timeline-body"><p>Thank you for reworking your implementation and extracting it from logical lines. I like the outcome and don&#x27;t mind that it duplicates some of the logical line detection (which isn&#x27;t much).</p>
<p>There are a few improvements/clarifications that we should follow up before I do a second review.</p>
<p>There&#x27;s an opportunity to speed up the implementation by using <code>TokenKind</code> over <code>Tok</code>.</p>
<p>It&#x27;s unclear to me if nested classes and functions are handled correctly. I would appreciate you having a second look and/or an explanation why it works as expected</p>
<p>I haven&#x27;t reviewed the fix logic in detail yet. I&#x27;ll do that once I have a better understanding for the code, thanks to your explanations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/checkers/logical_lines.rs</code>:41 on 2024-01-10 09:37</div>
            <div class="timeline-body"><p>Would you mind reverting this unrelated change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-01-10 09:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-10 09:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 11:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:390 on 2024-01-10 11:48</div>
            <div class="timeline-body"><p>I&#x27;ve done the changes in f3305841b.
Is it faster to do a <code>==</code> comparison than a <code>matches!</code> ? Or is it for readability reasons ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 11:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:381 on 2024-01-10 11:52</div>
            <div class="timeline-body"><p>This can happen yes. I want <code>first_token_range</code> to be the start of the line, however <code>first_token</code> is not necessarily the first token of the line, it is the first token that I care about later on (for example indents or <code>async</code> are ignored). So it can happen that <code>first_token_range</code> is <code>Some</code> while <code>first_token</code> is <code>None</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 12:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:403 on 2024-01-10 12:01</div>
            <div class="timeline-body"><p>I could rename <code>line_is_comment_only</code> to <code>line_is_trivia</code>. However, since new lines and indents are skipped, a line can have <code>line_is_comment_only</code> set to <code>true</code> if and only if it contains a comment. Therefore I think it is more helpful to have <code>line_is_comment_only</code> as the variable name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 12:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:450 on 2024-01-10 12:37</div>
            <div class="timeline-body"><p>To be honest I remember being extremely confused too, and only briefly understood this. This exists to match the pycodestyle results (especially when it comes to comments iirc).</p>
<p>I&#x27;ll try to understand this again and write it down this time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:408 on 2024-01-10 13:01</div>
            <div class="timeline-body"><p>I&#x27;ve tried to modify/explain this part in 22cd072df.</p>
<p>~~The check (that used to be, is now below) on line 423 could be removed if we allow a comment only line to be considered a docstring line. It does not break anything, but it feels like it could lead to confusion later on.~~
Edit: it would break things.</p>
<pre><code>                    // For a line to be a docstring, the first token must be a string (since indents are ignored)
                    if first_token != Some(TokenKind::String) {
                        is_docstring = false;
                    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:428 on 2024-01-10 13:11</div>
            <div class="timeline-body"><p>Done in 3f3ccfa8f.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:483 on 2024-01-10 13:12</div>
            <div class="timeline-body"><p>Done in 12d80ed6b.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:33 on 2024-01-10 13:15</div>
            <div class="timeline-body"><p>Done in 86c473cbf</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:22 on 2024-01-10 13:18</div>
            <div class="timeline-body"><p>Done in c347761ef</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:482 on 2024-01-10 13:24</div>
            <div class="timeline-body"><p>Yes, sorry. That was a left-over from an earlier version.</p>
<p>Removed in 3df1f1b01</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:32 on 2024-01-10 13:25</div>
            <div class="timeline-body"><p>Done in ede587a.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:536 on 2024-01-10 13:32</div>
            <div class="timeline-body"><p>It only keeps track of the first one (be it a <code>Class</code> of a <code>Def</code>), since we only care about whether we are indented or not (see snippet below).</p>
<pre><code>
        match line.first_token {
            TokenKind::Class =&gt; {
                if matches!(self.class_status, Status::Outside) {
                    self.class_status = Status::Inside(line.indent_level + indent_size);
                }
                self.follows = Follows::Other;
            }
            TokenKind::At =&gt; {
                self.follows = Follows::Decorator;
            }
            TokenKind::Def | TokenKind::Async =&gt; {
                if matches!(self.fn_status, Status::Outside) {
                    self.fn_status = Status::Inside(line.indent_level + indent_size);
                }
                self.follows = Follows::Def;
            }
            TokenKind::Comment =&gt; {}
            _ =&gt; {
                self.follows = Follows::Other;
            }
        }
</code></pre>
<p>Following <a href="https://github.com/astral-sh/ruff/pull/8720#issuecomment-1821046269">this comment</a>, it might even be possible to ignore classes and functions entirely, and only look at the indentation. However some rule descriptions talk about classes and functions, so I kept the inside/outside statuses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:343 on 2024-01-10 13:42</div>
            <div class="timeline-body"><p>I looked at the <code>indent_level</code> used when instantiating  the <code>LogicalLineInfo</code>, and it is 8 for <code>pass</code>. Where is it 2 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:438 on 2024-01-10 13:44</div>
            <div class="timeline-body"><p>This isn&#x27;t something I added in this PR, so I will open another PR for this if that&#x27;s ok.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:660 on 2024-01-10 13:48</div>
            <div class="timeline-body"><p>I assumed you meant that the visual indent was wrong and fixed it in 3941e8f99.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:589 on 2024-01-10 13:51</div>
            <div class="timeline-body"><p>I also assumed this was about visual indentation, since the suggestion doesn&#x27;t make sense (I think ?)</p>
<p>1831879a2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 13:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/checkers/logical_lines.rs</code>:41 on 2024-01-10 13:54</div>
            <div class="timeline-body"><p>This happened because at some point I tracked previous lines (including comments) in this file, sorry for the left-over.</p>
<p>Done in 52589e433.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:687 on 2024-01-10 14:22</div>
            <div class="timeline-body"><p>I&#x27;ve removed the hard coded indent size in 94c9babff.</p>
<p>I&#x27;ve added a few tests in 4f2c318a7, but they all passed from the start so that might not be enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:545 on 2024-01-10 14:24</div>
            <div class="timeline-body"><p>Fixed in da11f0284</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:602 on 2024-01-10 14:29</div>
            <div class="timeline-body"><blockquote>
<p>What happens if there are more blank lines than BLANK_LINES_TOP_LEVEL?</p>
</blockquote>
<p>There is a if before that line that includes <code>line.preceding_blank_lines &lt; BLANK_LINES_TOP_LEVEL</code> as a condition, so this cannot happen.</p>
<blockquote>
<p>Will there be no fix?</p>
</blockquote>
<p><code>E303</code> (a different violation) is in charge of handling too many blank lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:704 on 2024-01-10 14:36</div>
            <div class="timeline-body"><p>I&#x27;ve removed the <code>Async</code> in 531ce0ed5. It&#x27;s a left-over from before I realized that <code>with async</code> would cause trouble and started to ignore asyncs.</p>
<blockquote>
<p>It could make sense to have a custom FirstToken enum that only has the variants that we care about in the BlankLines implementation (could it be the same as Follows?). It would move the detection of the supported kinds into the LinePreprocessor and make it easier to reason about if all relevant tokens have been handled in the check_line function</p>
</blockquote>
<p>I don&#x27;t think it would make <code>check_line</code> easier to reason about since it checks the violations one by one instead of matching on the <code>TokenKind</code> (that&#x27;s probably not optimal in terms of speed, but it makes it much, much easier to see what leads to a given violation being raised).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:719 on 2024-01-10 14:38</div>
            <div class="timeline-body"><p>Fixed in cc81cc361</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:393 on 2024-01-10 14:41</div>
            <div class="timeline-body"><p>There is already one, I noticed it thanks to the <code>ruff-ecosystem</code> results (this github action proved really useful to find all kinds of false positives).
The <code>Async</code> tokens are ignored precisely in order to not incorrectly detect <code>async with</code>  as <code>async def</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-01-10 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/checkers/logical_lines.rs</code>:41 on 2024-01-10 14:43</div>
            <div class="timeline-body"><p>No worries, all good :) Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:723 on 2024-01-10 14:43</div>
            <div class="timeline-body"><p>Done in bdfb1e3ac</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:727 on 2024-01-10 14:46</div>
            <div class="timeline-body"><p>Done in 894bc21ef</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:340 on 2024-01-10 14:48</div>
            <div class="timeline-body"><p>Done in 0f659b965.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 14:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:382 on 2024-01-10 14:50</div>
            <div class="timeline-body"><p>Done in <a href="https://github.com/astral-sh/ruff/pull/9266/commits/ede587a6c14a8e1d8172579aadc8cfce598d387c">ede587a</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-01-10 14:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:343 on 2024-01-10 14:50</div>
            <div class="timeline-body"><p>The level is two because:</p>
<pre><code>def test(a):  # Level 0, no indentation 
    if a == 1:  # Level 1, the if statement is indented
        pass	 # Level 2, one level deeper than the if statement
</code></pre>
<p>So the level is only concern with how nested the statement is, not with the length of the indentation.</p>
<p>It&#x27;s probably a very poor analogy: Assume you use an elevator to get to level 3. The button is labeled 3 and does not go to 20 meters above ground level.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-10 15:06</div>
            <div class="timeline-body"><p>@MichaReiser Thank you for your review.</p>
<p>I&#x27;ve started by replacing <code>Tok</code> by <code>TokenKind</code>, which made applying most suggestions directly from GitHub impossible. I&#x27;ll finish doing them by hand later this week.</p>
<blockquote>
<p>It&#x27;s unclear to me if nested classes and functions are handled correctly. I would appreciate you having a second look and/or an explanation why it works as expected</p>
</blockquote>
<p>Based on comparison with pycodestyle and looking at the <code>ruff-ecosystem</code> results it looks fine.
The handling is fairly simple since we only care about whether we are inside a class or function, not how deeply nested  we are, so keeping track of the first indentation is enough. The one tricky part is handling poorly indented comments, <code>Status::CommentAfter</code> exists to handle this case.</p>
<blockquote>
<p>I haven&#x27;t reviewed the fix logic in detail yet. I&#x27;ll do that once I have a better understanding for the code, thanks to your explanations.</p>
</blockquote>
<p>I&#x27;ll do my best to explain things, but I must admit that things got quite convoluted when I tried to match the pycodestyle results instead of just implementing the rules as they were written. The comments handling lead to especially convoluted code (iirc that&#x27;s why <code>current_blank_lines</code> and <code>previous_blank_lines</code> exist).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-10 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:343 on 2024-01-10 15:10</div>
            <div class="timeline-body"><p>Thank you for the explanation, I first thought that the value was wrong :man_facepalming:</p>
<p>Fixed in 0d3644445.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-11 07:34</div>
            <div class="timeline-body"><p>Thank you for all your work your putting in this.</p>
<p>I&#x27;m a bit disappointed that changing to <code>TokenKind</code> didn&#x27;t improve performance more. I&#x27;ll have to look at the codspeed benchmarks when I have time to see where we spend the time. I hope that we can improve it a little more.</p>
<p>Edit: I just saw that the benchmarks didn&#x27;t run. There&#x27;s still hope :laughing:</p>
<blockquote>
<p>which made applying most suggestions directly from GitHub impossible.</p>
</blockquote>
<p>Oh I&#x27;m sorry for this.</p>
<blockquote>
<p>Based on comparison with pycodestyle and looking at the ruff-ecosystem results it looks fine.</p>
</blockquote>
<p>Thanks for explaining. I&#x27;ll have a second look. Most importantly, we have tests for it, showing how we expect it to work. That will help future us when making changes, to ensure we don&#x27;t break it accidentally.</p>
<p>Would you mind requesting re-review when you think it&#x27;s ready? It would help me to know when I should have another look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-13 12:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:472 on 2024-01-13 12:46</div>
            <div class="timeline-body"><p>Done in 605470728</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-13 12:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:438 on 2024-01-13 12:59</div>
            <div class="timeline-body"><p>PR opened: <a href="https://github.com/astral-sh/ruff/pull/9506">astral-sh/ruff#9506</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-13 13:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:344 on 2024-01-13 13:10</div>
            <div class="timeline-body"><p>Done in 4c54d05a9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:450 on 2024-01-13 13:24</div>
            <div class="timeline-body"><p>Done in c07ccdf9f</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-13 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-13 13:45</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;ll have to look at the codspeed benchmarks when I have time to see where we spend the time. I hope that we can improve it a little more.</p>
</blockquote>
<p>The result from codespeed was fine until this commit <a href="https://github.com/astral-sh/ruff/pull/9266/commits/b7727c5e73c646637883e8e24a3802575d09a9e8">b7727c5</a>, but when I tried to get the changes from master it wasn&#x27;t fine anymore. I wonder what changed.</p>
<blockquote>
<p>Thanks for explaining. I&#x27;ll have a second look. Most importantly, we have tests for it, showing how we expect it to work. That will help future us when making changes, to ensure we don&#x27;t break it accidentally.</p>
</blockquote>
<p>We have all the tests from pycodestyle, plus I went through the ruff-ecosystem results a few times and every time I found a false-positive I added a test for it. I sadly can&#x27;t guarantee that the two perfectly matches, but if there are discrepancies it should only be in corner cases. If this is merged and any issue arises later on, I would gladly fix it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-13 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-01-15 09:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:390 on 2024-01-15 09:58</div>
            <div class="timeline-body"><p>It&#x27;s mostly for readability. I find <code>matches!</code> rather verbose to read, and negating matches always breaks my flow (because there are two <code>!</code>, one because it is a macro, and the other for negating.</p>
<p>One difference between <code>==</code> and <code>matches!</code> is that <code>matches!</code> works in <code>const</code> context whereas <code>==</code> does not because it calls the implementation of the non const <code>Eq::eq</code> function.</p>
<p>The alternative is to create <code>is_*</code> methods on <code>TokenKind</code> and use <code>matches!</code> internally. That&#x27;s a bit of boilerplate but I often find it worth adding to improve readability.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:401 on 2024-01-15 10:03</div>
            <div class="timeline-body"><pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:381 on 2024-01-15 10:04</div>
            <div class="timeline-body"><p>Nit: We use <code>range.len()</code>, suggesting that the unit is in bytes and not in characters (this happens to be the same for all python whitespace characters but I still recomment renaming it to <code>current_blank_len</code> and using <code>TextSize</code> to make it clear that the unit is bytes)</p>
<pre><code>        let mut current_blank_characters: usize = 0;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:452 on 2024-01-15 10:10</div>
            <div class="timeline-body"><p>You mentioned in <a href="https://github.com/astral-sh/ruff/pull/9266">astral-sh/ruff#9266</a>#discussion_r1447356252 that changing the <code>is_docstring</code> check would break things but I&#x27;m unable to reproduce when running the test set locally.</p>
<p>Please add a test that demonstrates why refactoring the code to the following implementation breaks the rule.</p>
<pre><code>            // A docstring line is composed only of the docstring (TokenKind::String) and trivia tokens.
            // (If a comment follows a docstring, we still count the line as a docstring)
            if first_token != Some(TokenKind::String) &amp;&amp; token_kind != TokenKind::Comment {
                is_docstring = false
            }

            match token_kind {
                TokenKind::Lbrace | TokenKind::Lpar | TokenKind::Lsqb =&gt; {
                    parens = parens.saturating_add(1);
                }
                TokenKind::Rbrace | TokenKind::Rpar | TokenKind::Rsqb =&gt; {
                    parens = parens.saturating_sub(1);
                }
                TokenKind::Newline | TokenKind::NonLogicalNewline if parens == 0 =&gt; {
                    let last_token_end = range.end();

                    let first_range = first_token_range
                        .expect(&quot;that Newline cannot be the first token of a line (there is at least a NonLogicalNewline token)&quot;);

                    let range = TextRange::new(
                        self.locator.line_start(first_range.start()),
                        first_range.start(),
                    );

                    let indent_length = expand_indent(self.locator.slice(range), self.indent_width);
</code></pre>
<p>Your check is accurate but I think we can improve readability a bit by:</p>
<ol>
<li>Initialize <code>is_docstring</code> with <code>false</code></li>
<li>Inside of <code>if first_token.is_none()</code> assign <code>is_docstring = token_kind == TokenKind::String;</code></li>
<li>Remove the <code>if first_token != Some(...)</code> in the newline | <code>NonLogicalLine</code> handling.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:461 on 2024-01-15 10:46</div>
            <div class="timeline-body"><p>This panics for a line that only contains the <code>async</code> keyword because it gets skipped. Would it complicate the logic a lot if we wouldn&#x27;t skip <code>async</code> here and instead handle it downstream the same as <code>def</code>?</p>
<pre><code>class Test:
    async

    def a(self): pass

</code></pre>
<p>This is not valid python code but it&#x27;s a valid token stream</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:459 on 2024-01-15 10:51</div>
            <div class="timeline-body"><p>The expect messages is inaccurate. We never initialize <code>first_token</code> with <code>NonLogicalNewline</code>. But we shouldn&#x27;t make it hear if that&#x27;s happening.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-15 12:52</div>
            <div class="timeline-body"><p>pycodestyle seems to drip over this example:</p>
<pre><code>class Test:
    def another(self):
        pass

    # comment


    # another comment
    def test(self):
        pass
</code></pre>
<p>It reports that there&#x27;s a missing empty line:</p>
<pre><code>/home/micha/.config/JetBrains/RustRover2023.3/scratches/scratch_5.py:8:5: E303 too many blank lines (2)
/home/micha/.config/JetBrains/RustRover2023.3/scratches/scratch_5.py:9:5: E301 expected 1 blank line, found 0
</code></pre>
<p>Removing the two empty lines between the comments make it pass..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/snapshots/ruff_linter__rules__pycodestyle__tests__E305_E30.py.snap</code>:4 on 2024-01-15 13:22</div>
            <div class="timeline-body"><p><code>pycodestyle</code> found(1)</p>
<pre><code>E30.py:621:1: E305 [*] expected 2 blank lines after class or function definition, found (1)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/snapshots/ruff_linter__rules__pycodestyle__tests__E305_E30.py.snap</code>:23 on 2024-01-15 13:23</div>
            <div class="timeline-body"><p>pycodestyle emits: <code>found(1)</code></p>
<pre><code>E30.py:632:1: E305 [*] expected 2 blank lines after class or function definition, found (1)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-15 13:24</div>
            <div class="timeline-body"><p>@MichaReiser Matching pycodestyle as best as possible was one of the pain points in this PR...</p>
<p>If we follow the rules, I think pycodestyle is wrong on this example. But pycodestyle is the reference, so should ruff match the pycodestyle behavior on this example too ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:470 on 2024-01-15 13:27</div>
            <div class="timeline-body"><p><code>preceding_blank_characters</code> is confusing because it stores the blank characters of the current new line. The variable should either be renamed (to <code>current_blank_len</code>) OR store the length of the preceding blank lines.</p>
<p>If it stores the <code>preceding_blank_lines</code>, than setting <code>self.preceding_blank_lines = current_blank_lines</code> is problematic because the length of the blank lines isn&#x27;t updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:677 on 2024-01-15 13:34</div>
            <div class="timeline-body"><p>Subtracting BLANK_LINEs_METHOD_LEVEL from the blank lines count isn&#x27;t safe on windows where new line characters use 2 bytes: <code>\r\n</code>.</p>
<p>The safe fix here is to replace all blank lines and insert the right amount of newlines.</p>
<p>I think the safe thing here would be to track the range of the blank lines and replace the entire range with the right amount of newlines. This requires tracking the range of the blank lines.</p>
<p>I started adding a helper struct for it</p>
<pre><code>
#[derive(Clone, Debug)]
enum BlankLines {
    /// No blank lines
    Zero,

    /// One or more blank lines
    Many { count: NonZeroU32, range: TextRange },
}

impl Default for BlankLines {
    fn default() -&gt; Self {
        BlankLines::Zero
    }
}

impl BlankLines {
    fn add(&amp;mut self, line_range: TextRange) {
        match self {
            BlankLines::Zero =&gt; {
                *self = BlankLines::Many {
                    count: NonZeroU32::MIN,
                    range: line_range,
                }
            }
            BlankLines::Many { count, range } =&gt; {
                assert_eq!(range.end(), line_range.start());
                *count = count.saturating_add(1);
                *range = TextRange::new(range.start(), line_range.end());
            }
        }
    }

    fn count(&amp;self) -&gt; u32 {
        match self {
            BlankLines::Zero =&gt; 0,
            BlankLines::Many { count, .. } =&gt; count.get(),
        }
    }
}

</code></pre>
<p>Where you can write</p>
<pre><code>if let BlankLines::Many { count: blank_lines, range: blank_lines_range } = line.blank_lines {
    // add check here
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:694 on 2024-01-15 13:44</div>
            <div class="timeline-body"><p><code>preceding_blank_characters</code> seems to be the length of <code>blank_lines</code>, subtracting it here is, therefore, not safe (you may start slicing arbitrary content.). Should this be using <code>blank_lines</code> too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:687 on 2024-01-15 13:54</div>
            <div class="timeline-body"><p>Let&#x27;s add a test with a comment. Pycodestyle seems to accept this but I think it is incorrect</p>
<pre><code>@decorator

# comment
def function():
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> requested changes on 2024-01-15 14:06</div>
            <div class="timeline-body"><p>We don&#x27;t need to match pycodestyle exactly if we have a good reason for it.</p>
<p>I did another pass and made a few changes myself. I hope I didn&#x27;t introduce any regressions.</p>
<p>I found many cases where the conditions are testing <code>blank_lines</code> and the code fix / diagnostic than reference <code>preceding_blank_lines</code> or the other way round. I don&#x27;t think that&#x27;s intentional. We should review the diagnostics to ensure we use the right blank lines variable consistently.</p>
<p>Related, some fixes use <code>blank_lines_len</code> (I renamed <code>preceding_blank_lines_characters</code> because it isn&#x27;t the length of the preceding blank lines) but the rule tests for <code>preceding_blank_lines</code> which feels incorrect.</p>
<p>There are also tests where <code>pycodestyle</code> gives me different results than what we see in the snapshot.</p>
<p>that&#x27;s why I think we need to do another pass on this PR and I recommend starting with the tests:</p>
<ul>
<li>Run each sample with pycodestyle and ensure our snapshots report the same errors as pycodestyle</li>
<li>Carefully consider why some rules use <code>blank_lines</code> and other use <code>preceding_blank_lines</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sihil">@sihil</a> on 2024-01-17 14:51</div>
            <div class="timeline-body"><p>I&#x27;m very cheekily adding a comment here to see if there is interest in mopping up W391 (blank line at end of file) in this as it&#x27;s so closely related. üòá</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-17 15:43</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m very cheekily adding a comment here to see if there is interest in mopping up W391 (blank line at end of file) in this as it&#x27;s so closely related. üòá</p>
</blockquote>
<p>I recommend not increasing scope for now. The PR is already massive and it would be nice to get it merged.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-19 14:12</div>
            <div class="timeline-body"><p>Thank you for the review, I&#x27;ll start by re-checking the tests.</p>
<p>As a first note, the following test (mixing spaces and tabs) causes pycodestyle to crash/exit, so the results can&#x27;t be compared.</p>
<pre><code>async def function1():
	await function2()
    async with function3():
    	pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-19 14:20</div>
            <div class="timeline-body"><blockquote>
<p>Thank you for the review, I&#x27;ll start by re-checking the tests.</p>
<p>As a first note, the following test (mixing spaces and tabs) causes pycodestyle to crash/exit, so the results can&#x27;t be compared.</p>
<pre><code>async def function1():
  await function2()
    async with function3():
    	pass
</code></pre>
</blockquote>
<p>Oh interesting. Maybe split this test (or all messed up indent tests) into their own file to?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-19 14:34</div>
            <div class="timeline-body"><p>I&#x27;ve compared the ruff and pycodestyle results and I found only one mismatch/error in terms of errors raised (I haven&#x27;t checked the amount of lines detected yet). In the sample below, E304 was detected on both the comment and the def. I&#x27;ll make it so that it&#x27;s not detected on the comment.</p>
<pre><code>@decorator

# comment
def function():
    pass
</code></pre>
<p>Edit: the auto-fix requires a bit more changes to work, especially in order to support code like this:</p>
<pre><code>@decorator

# comment

# a second comment
def function():
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-19 14:35</div>
            <div class="timeline-body"><blockquote>
<p>Maybe split this test (or all messed up indent tests) into their own file to?</p>
</blockquote>
<p>What do you mean ? Making a PR to pycodestyle to add this test to their tests ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-19 14:47</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Maybe split this test (or all messed up indent tests) into their own file to?</p>
</blockquote>
<p>What do you mean ? Making a PR to pycodestyle to add this test to their tests ?</p>
</blockquote>
<p>Sorry no. I mean that you could split the problematic tests into a separate test file (in our repository). There&#x27;s no rule enforcing that each rule only has one test file. We can have many test files per rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-19 14:56</div>
            <div class="timeline-body"><p>@MichaReiser
When comparing the number of lines detected, there are 3 differences with pycodestyle:</p>
<table>
<tr>
<td> Snipet </td> <td> Ruff </td> <td> Pycodestyle </td>
</tr>

<tr>
<td>

<pre><code># E305:7:1
def fn():
    print()

    # comment

    # another comment
fn()
# end
</code></pre>
</td>
<td> E305 expected 2 blank lines after class or function definition, found (0) </td>
<td> E305 expected 2 blank lines after class or function definition, found (1) </td>
</tr>

<tr>
<td>

<pre><code># E305
class Class():
    pass

    # comment

    # another comment
a = 1
# end
</code></pre>
</td>
<td> E305 expected 2 blank lines after class or function definition, found (0) </td>
<td> E305 expected 2 blank lines after class or function definition, found (1) </td>
</tr>

<tr>
<td>

<pre><code># E305:5:1
def a():
    print

# Two spaces before comments, too.
if a():
    a()
# end
</code></pre>
</td>
<td> E305 expected 2 blank lines after class or function definition, found (0) </td>
<td> E305 expected 2 blank lines after class or function definition, found (1) </td>
</tr>

</table>

<p>Matching pycodestyle is very easy, we just need to use <code>preceding_blank_lines</code> instead of <code>blank_lines</code> when creating the error message, so I did that for now.</p>
<p>Ideally I would have liked to have the ruff output for the first two, and the pycodestyle output for the last one. But I think that would require tracking additional variables.</p>
<p>I thought about having the error on the comment line, but that would not match pycodestyle, and handling cases such as the one below would be quite annoying.</p>
<pre><code>def fn():
    pass
# wrongly indented comment

    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-19 15:02</div>
            <div class="timeline-body"><blockquote>
<p>Sorry no. I mean that you could split the problematic tests into a separate test file (in our repository). There&#x27;s no rule enforcing that each rule only has one test file. We can have many test files per rule.</p>
</blockquote>
<p>There&#x27;s only one example that pycodestyle cannot handle, so I removed it from the test file while comparing  the outputs. Having a second test file just for that example seems a bit too much to me, especially since we won&#x27;t compare the outputs with pycodestyle once the ruff test fixtures become the reference.
I can split the test file if you think it&#x27;s a better idea though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-19 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:687 on 2024-01-19 15:04</div>
            <div class="timeline-body"><p>Done in <a href="https://github.com/astral-sh/ruff/pull/9266">astral-sh/ruff#9266</a>/commits/e739a445c89e884b07da6ac3330948c7e63c0088</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-20 03:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:677 on 2024-01-20 03:52</div>
            <div class="timeline-body"><p>Thank you for providing the enum and its <code>impl</code>.</p>
<p>I&#x27;ve made the changes in 2c08381d9 and fddc74013.  There were some snapshot changes, but they looked good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-20 05:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:694 on 2024-01-20 05:42</div>
            <div class="timeline-body"><p>I&#x27;ve tried to improve this in 7ee8946ad (also allowing to fix the test below).</p>
<pre><code>@decorator

# comment    E304 not expected


# comment    E304 not expected
def function():
    pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:470 on 2024-01-20 05:46</div>
            <div class="timeline-body"><p>Fixed in e739a445c89e884b07da6ac3330948c7e63c0088</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-20 05:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-20 05:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/snapshots/ruff_linter__rules__pycodestyle__tests__E305_E30.py.snap</code>:4 on 2024-01-20 05:47</div>
            <div class="timeline-body"><p>See <a href="https://github.com/astral-sh/ruff/pull/9266">astral-sh/ruff#9266</a>#issuecomment-1900573236</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-01-20 05:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/snapshots/ruff_linter__rules__pycodestyle__tests__E305_E30.py.snap</code>:23 on 2024-01-20 05:47</div>
            <div class="timeline-body"><p>See <a href="https://github.com/astral-sh/ruff/pull/9266">astral-sh/ruff#9266</a>#issuecomment-1900573236</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-22 08:10</div>
            <div class="timeline-body"><p>@hoel-bagard I agree that what you&#x27;re proposing would be ideal (diverting for 1 and 2, matching pycodestyle for 3) and also agree that matching pycodestyle is probably the best for now (we can experiment with an improved detection in a follow up PR).</p>
<p>Let me know when this is ready for re-review or if you need any more help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-22 08:41</div>
            <div class="timeline-body"><p>@MichaReiser I will add comments to explain why <code>blank_lines</code>/<code>preceding_blank_lines</code> is used for each rule, then the PR should be ready for re-review. I think I&#x27;ll be able to do it today.</p>
<p>EDIT: since the explanation was essentially the same for every rule, I added a single comment in the struct definition.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-01-22 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-05 12:43</div>
            <div class="timeline-body"><p>@hoel-bagard is this PR ready for review or have you planned to make more changes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-02-05 12:51</div>
            <div class="timeline-body"><p>@MichaReiser It&#x27;s ready for review. I think I applied all the suggestions you made.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-05 13:00</div>
            <div class="timeline-body"><blockquote>
<p>@MichaReiser It&#x27;s ready for review. I think I applied all the suggestions you made.</p>
</blockquote>
<p>Ah perfect. Sorry for the long wait. I thought you wanted to make more changes. I&#x27;ll have a look this week!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:628 on 2024-02-05 22:35</div>
            <div class="timeline-body"><p>This seems incorrect: It always overrides <code>self.class_status</code> with <code>Status::Outside</code> even when <code>line.indent_length &gt; indent</code></p>
<p>Should this be in an else branch? Can we add tests exercising this branch</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:625 on 2024-02-05 22:36</div>
            <div class="timeline-body"><p>Should this be <code>&gt;=</code> to continue <code>Inside</code> a class if the <code>indent</code> remains unchanged. Do we have tests covering this branch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:778 on 2024-02-05 23:00</div>
            <div class="timeline-body"><p>I don&#x27;t think using <code>stylist.line_ending().text_len()</code> is safe in case the file uses mixed newlines because the first newline could be <code>\n</code> but the newline after the decorator might be <code>\r\n</code> (the problem we had with other blank line replacement bugs as well)</p>
<p>What are we trying to do here?</p>
<p>Shouldn&#x27;t <code>self.last_non_comment_line_end</code> already give you the end position of the decorator line?</p>
<p>What seems to be the easiest fix is to use</p>
<pre><code>               diagnostic.set_fix(Fix::safe_edit(Edit::range_deletion(
                    without_blank_lines.to_string(),
                    TextRange::new(
                        self.last_non_comment_line_end,
                        line.first_token_range.start(),
                    ),
                )));
</code></pre>
<p>but it doesn&#x27;t handle the case where you have a comment in the range between (which the old implementation handles). However, the old implementation only handles <code>\n</code> but not <code>\r</code> or <code>\r\n</code>.
We would need to adopt your fix to handle any possible empty line sequence and replace it with <code>stylist.newline</code> (and not <code>\n</code>)</p>
<p>To help future readers understand this code better, it might help to add a example code snipped to the outer if branch: like</p>
<pre><code>// Removes unnecessary empty lines between the decorator and a function or class definition
// ```python
// @decorator
// 
// def test(): pass
// ```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-05 23:23</div>
            <div class="timeline-body"><p>This is looking good. We&#x27;re very close.</p>
<p>There&#x27;s one fix that we need to look into to properly support different line endings.</p>
<p>The other nice addition would be if you could add some documentation with code snippets on top of the large fix-branches. It could help future reader better understand what&#x27;s happening</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-06 01:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:778 on 2024-02-06 01:24</div>
            <div class="timeline-body"><p>Okay. I pushed a version that addresses the line ending issue. A few inline documentation blocks examples with examples might still be useful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-02-06 01:26</div>
            <div class="timeline-body"><p>I pushed a change that avoids hardcoding the newline in the remaining fix and this now looks good to me. I&#x27;ve a few small questions about the correctness that I would be thankful if you could take a look and this is then ready to merge.</p>
<p>I&#x27;ll ask @charliermarsh to take a look at the rule, in case he wants to make any changes to the documentation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-02-06 10:32</div>
            <div class="timeline-body"><p>@MichaReiser</p>
<blockquote>
<p>The other nice addition would be if you could add some documentation with code snippets on top of the large fix-branches.</p>
</blockquote>
<p>By &quot;large fix-branches&quot;, do you mean each <code>E30X</code> branch ? Wouldn&#x27;t that be handled by the docstring of each error ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 10:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:628 on 2024-02-06 10:39</div>
            <div class="timeline-body"><p>Else branch added in 8392f204ccd1bd0b8ed5d870fdf406f8f47f1487. 2 tests added in 6820cbeb5.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:625 on 2024-02-06 11:21</div>
            <div class="timeline-body"><p>Because we only enter <code>Status::CommentAfter</code> when encountering a comment that is &quot;outside&quot; the indented block,  <code>&gt;</code> is correct. On the contrary, using <code>&gt;=</code> will cause E306 false positives.</p>
<p>We have tests like the one below.</p>
<pre><code># E301
class Class:

    def fn1():
        pass
    # comment
    def fn2():
        pass
# end
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 11:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-06 14:12</div>
            <div class="timeline-body"><p>@hoel-bagard I didn&#x27;t notice that each branch has its own diagnostic. I agree, that that&#x27;s sufficient.</p>
<p>So this is ready to merge. Congrats on the work, your endurance, and your patience with us. This is excellent. I&#x27;ll give @zanieb and @charliermarsh a day or two. They are the masters of our documentation.</p>
<p>@zanieb @charliermarsh The implementation looks good on my end. You don&#x27;t have to review its code, except if the preview gating is correct. I&#x27;m mainly interested to get a second opinion on the rule description</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-06 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-06 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-06 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-02-06 19:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:35 on 2024-02-06 19:23</div>
            <div class="timeline-body"><p>Why do we mention the recommended spacing between functions and classes if this rule is just for methods of a class? It might make sense to just say &quot;PEP 8 recommends exactly one blank line between methods of a class&quot;. We should also not specify &quot;missing&quot; if this will also trigger for &quot;too many&quot; blank lines, instead we should say &quot;Checks for the correct number of blank lines between methods of a class.</p>
<p>We could move all of this into &quot;What it does&quot; and have &quot;Why is this bad&quot; focus on consistency with PEP 8? I don&#x27;t have strong feelings about that though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-02-06 19:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:84 on 2024-02-06 19:24</div>
            <div class="timeline-body"><p>Same as <a href="https://github.com/astral-sh/ruff/pull/9266">astral-sh/ruff#9266</a>/files#r1480433058</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-02-06 19:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:74 on 2024-02-06 19:25</div>
            <div class="timeline-body"><p>Isn&#x27;t this always going to be a single blank line (for this rule)? Can&#x27;t this suggest removing blank lines too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:179 on 2024-02-06 19:26</div>
            <div class="timeline-body"><p>Isn&#x27;t this for extra blank lines after function decorators?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-02-06 19:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:214 on 2024-02-06 19:27</div>
            <div class="timeline-body"><p>We should capitalize these for consistency with the rest</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-02-06 19:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 23:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:35 on 2024-02-06 23:39</div>
            <div class="timeline-body"><blockquote>
<p>Why do we mention the recommended spacing between functions and classes if this rule is just for methods of a class? It might make sense to just say &quot;PEP 8 recommends exactly one blank line between methods of a class&quot;.</p>
</blockquote>
<p>Done in 3d5cc8455</p>
<blockquote>
<p>We should also not specify &quot;missing&quot; if this will also trigger for &quot;too many&quot; blank lines, instead we should say &quot;Checks for the correct number of blank lines between methods of a class.</p>
</blockquote>
<p>This rule does not trigger for too many blank lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 23:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:84 on 2024-02-06 23:43</div>
            <div class="timeline-body"><p>Fixed in 0596eda06.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:74 on 2024-02-06 23:45</div>
            <div class="timeline-body"><blockquote>
<p>Isn&#x27;t this always going to be a single blank line (for this rule)?</p>
</blockquote>
<p>Yes, I&#x27;ve fixed this in d188e200e.</p>
<blockquote>
<p>Can&#x27;t this suggest removing blank lines too?</p>
</blockquote>
<p>This is handled by a different rule (<code>E303</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 23:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 23:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:179 on 2024-02-06 23:49</div>
            <div class="timeline-body"><p>Yes, fixed in e89c20f86.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 23:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:214 on 2024-02-06 23:50</div>
            <div class="timeline-body"><p>Done in fdf603542</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hoel-bagard">@hoel-bagard</a> reviewed on 2024-02-06 23:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on <code>crates/ruff_linter/src/rules/pycodestyle/rules/blank_lines.rs</code>:35 on 2024-02-06 23:55</div>
            <div class="timeline-body"><blockquote>
<p>We could move all of this into &quot;What it does&quot; and have &quot;Why is this bad&quot; focus on consistency with PEP 8? I don&#x27;t have strong feelings about that though.</p>
</blockquote>
<p>I don&#x27;t have strong feelings about this either, I can try to change it if you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-02-07 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-08 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-08 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2024-02-09 07:40</div>
            <div class="timeline-body"><p>Merged?! Yay! Thanks for the hard work @hoel-bagard!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-09 08:12</div>
            <div class="timeline-body"><p>Thanks for addressing my feedback!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2024-02-18 10:23</div>
            <div class="timeline-body"><p>I upgraded to ruff 0.2.2, where this is included. But it&#x27;s still hidden behind some compiler flag? I can&#x27;t test it without compiling ruff on my own?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoel-bagard">@hoel-bagard</a> on 2024-02-18 10:27</div>
            <div class="timeline-body"><p>@spaceone You need to enable the preview mode, see <a href="https://docs.astral.sh/ruff/preview/#enabling-preview-mode">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Sam1320">@Sam1320</a> on 2024-02-21 16:52</div>
            <div class="timeline-body"><p>Great work @hoel-bagard ! I come from this <a href="https://stackoverflow.com/questions/76885582/setting-up-ruff-python-linter">SO comment</a>  I followed all the previous PRs related to this without much hope. Amazing that I would have been blocked if I checked this only 2 weeks ago.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:00:14 UTC
    </footer>
</body>
</html>
