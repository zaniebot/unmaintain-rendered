```yaml
number: 4007
title: "JSON Emitter: Use one indexed column numbers for edits"
type: pull_request
state: merged
author: MichaReiser
labels:
  - breaking
assignees: []
merged: true
base: main
head: JSON_Emitter_Use_one-indexed_column_numbers_for_edits
created_at: 2023-04-18T06:44:21Z
updated_at: 2023-05-10T15:21:03Z
url: https://github.com/astral-sh/ruff/pull/4007
synced_at: 2026-01-12T03:56:38Z
```

# JSON Emitter: Use one indexed column numbers for edits

---

_Pull request opened by @MichaReiser on 2023-04-18 06:44_

 I noticed in the byte-offsets refactor that the `JsonEmitter` uses one indexed column numbers for the diagnostic start and end locations but not for `edits`.

This PR changes the `JsonEmitter` to emit one-indexed column numbers for edits, as we already do for `Message::location` and `Message::end_location`.

## Open questions

~We'll need to change the LSP to subtract 1 from the columns in `_parse_fix`~

https://github.com/charliermarsh/ruff-lsp/blob/6e44fadf8a5954adaf3c21af196fa195708ff912/ruff_lsp/server.py#L129-L150

~@charliermarsh is there a way to get the ruff version in that method? If not, then I recommend adding a `version` that we increment whenever we make incompatible changes to the serialized message. We can then use it in the LSP to correctly compute the column offset.~

I'll use the presence of the `Fix::applicability` field to detect if the Ruff version uses one or zero-based column indices.

See https://github.com/charliermarsh/ruff-lsp/pull/103

---

_Comment by @MichaReiser on 2023-04-18 06:44_

Current dependencies on/for this PR:
* main
  * **PR #4341** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4341" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #4007** <a href="https://app.graphite.dev/github/pr/charliermarsh/ruff/4007" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/charliermarsh/ruff/4007?utm_source=stack-comment).

---

_Label `breaking` added by @MichaReiser on 2023-04-18 06:45_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-04-18 06:45_

---

_Comment by @github-actions[bot] on 2023-04-18 06:54_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Comment by @charliermarsh on 2023-04-18 23:17_

@MichaReiser - Yeah we do have a method to extract it from the executable (https://github.com/charliermarsh/ruff-lsp/blob/6e44fadf8a5954adaf3c21af196fa195708ff912/ruff_lsp/server.py#L903). I think what you're describing sounds preferable, though. I'd vote to go ahead and introduce that in the same release as this change.

(Relatedly, can we hold off on merging this until after the next release -- probably tomorrow?)


---

_@charliermarsh approved on 2023-04-18 23:17_

---

_Comment by @MichaReiser on 2023-04-19 07:15_

> (Relatedly, can we hold off on merging this until after the next release -- probably tomorrow?)

Sure

>  I think what you're describing sounds preferable, though. I'd vote to go ahead and introduce that in the same release as this change.

By this you mean introducing a `version` field? I reviewed the format of some other linters, and none seem to have a `version` field. There's also the complication that our top level node is an array, meaning we either:

* have to attach the version to every message which results in a lot of redundancy and, in some situation, makes it more difficult to check the version
* change the root to an object with, for now, two fields: `results`, and `version`. 

Do you have a preference?

> **Note**: I expect the JSON output to change significantly if we decide to rework our diagnostics. Having a version can then come in handy

---

_Merged by @MichaReiser on 2023-05-10 15:21_

---

_Closed by @MichaReiser on 2023-05-10 15:21_

---

_Branch deleted on 2023-05-10 15:21_

---
