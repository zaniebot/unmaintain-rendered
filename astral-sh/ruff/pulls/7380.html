<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix: Don't omit optional parentheses for subscripts - astral-sh/ruff #7380</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix: Don't omit optional parentheses for subscripts</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7380">#7380</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-09-14 08:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Closes https://github.com/astral-sh/ruff/issues/7319</p>
<p>Ruff formatted</p>
<pre><code class="language-python">def f():
    return (
        package_version is not None
        and package_version.split(&quot;.&quot;)[:2] == package_info.version.split(&quot;.&quot;)[:2]
    )
</code></pre>
<p>as</p>
<pre><code class="language-python">def f():
    return package_version is not None and package_version.split(&quot;.&quot;)[
        :2
    ] == package_info.version.split(&quot;.&quot;)[:2]
</code></pre>
<p>Because our <code>can_omit_parentheses</code> returned <code>true</code> when an expression starts or ends with a subscript whereas Black's does not.</p>
<p>https://github.com/psf/black/blob/c160e4b7ce30c661ac4f2dfa5038becf1b8c5c33/src/black/lines.py#L969-L973</p>
<p>This PR excludes Subscript from <code>can_omit_parentheses</code>.</p>
<h2>Test Plan</h2>
<p>Added test plan</p>
<p><strong>Base</strong>
| project      | similarity index  | total files       | changed files     |
|--------------|------------------:|------------------:|------------------:|
| cpython      |           0.76083 |              1789 |              1632 |
| django       |           0.99981 |              2760 |                40 |
| transformers |           0.99944 |              2587 |               413 |
| twine        |           1.00000 |                33 |                 0 |
| typeshed     |           0.99983 |              3496 |                18 |
| warehouse    |           0.99834 |               648 |                20 |
| zulip        |           0.99956 |              1437 |                23 |</p>
<p><strong>This PR</strong>
| project      | similarity index  | total files       | changed files     |
|--------------|------------------:|------------------:|------------------:|
| cpython      |           0.76083 |              1789 |              1632 |
| <strong>django</strong>       |           0.99981 |              2760 |                39 |
| <strong>transformers</strong> |           0.99952 |              2587 |               408 |
| twine        |           1.00000 |                33 |                 0 |
| typeshed     |           0.99983 |              3496 |                18 |
| <strong>warehouse</strong>    |           0.99923 |               648 |                18 |
| zulip        |           0.99956 |              1437 |                23 |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-14 08:34</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #7380</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7380" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7380?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-09-14 08:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2023-09-14 08:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-09-14 08:41</div>
            <div class="timeline-body"><p>this looks much better! i wonder if this still holds up with really complex subscripts that you sometimes have have with numpy/pandas? Intuitively, only breaking when <code>()</code>/<code>[]</code>,<code>{}</code> have sufficiently complex content would make sense, but i don't want to start trying to determine what content is complex enough</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-14 08:43</div>
            <div class="timeline-body"><blockquote>
<p>this looks much better! i wonder if this still holds up with really complex subscripts that you sometimes have have with numpy/pandas? Intuitively, only breaking when <code>()</code>/<code>[]</code>,<code>{}</code> have sufficiently complex content would make sense, but i don't want to start trying to determine what content is complex enough</p>
</blockquote>
<p>I prefer just to add the parentheses, especially if parts of the expression are complicated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-09-14 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-09-14 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-14 08:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:15 UTC
    </footer>
</body>
</html>
