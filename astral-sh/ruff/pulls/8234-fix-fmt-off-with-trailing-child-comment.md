```yaml
number: 8234
title: "Fix `fmt:off` with trailing child comment"
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: fix-fmt-off-trailing-child-comment
created_at: 2023-10-26T00:47:50Z
updated_at: 2023-10-26T01:03:36Z
url: https://github.com/astral-sh/ruff/pull/8234
synced_at: 2026-01-12T02:32:42Z
```

# Fix `fmt:off` with trailing child comment

---

_Pull request opened by @MichaReiser on 2023-10-26 00:47_

## Summary

This PR fixes the issue where Ruff dropped the trailing comment of the last child when using a `fmt: off` without a matching `fmt: on`.

```python
# fmt: off
from dataclasses import dataclass

@dataclass
class A:
    x: int # Optional[int]
```

Got formatted to 

```python
# fmt: off
from dataclasses import dataclass

@dataclass
class A:
    x: int
``` 

The source of this was once again, that the class range does not include the range of nested comments. 

Closes https://github.com/astral-sh/ruff/issues/8211

## Test Plan

Added tests. The similarity index is unchanged.


---

_Comment by @MichaReiser on 2023-10-26 00:48_

Current dependencies on/for this PR:
* main
  * **PR #8234** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8234" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/8234?utm_source=stack-comment).

---

_Marked ready for review by @MichaReiser on 2023-10-26 00:55_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-10-26 00:55_

---

_@charliermarsh approved on 2023-10-26 00:56_

You love this behavior

---

_Label `formatter` added by @MichaReiser on 2023-10-26 00:57_

---

_Merged by @MichaReiser on 2023-10-26 01:03_

---

_Closed by @MichaReiser on 2023-10-26 01:03_

---

_Branch deleted on 2023-10-26 01:03_

---
