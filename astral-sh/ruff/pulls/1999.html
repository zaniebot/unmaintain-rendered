<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Port pydocstyle code 401 (ImperativeMood) - astral-sh/ruff #1999</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Port pydocstyle code 401 (ImperativeMood)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1999">#1999</a>
        opened by <a href="https://github.com/akx">@akx</a>
        on 2023-01-19 15:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/akx">@akx</a> on 2023-01-19 15:35</div>
            <div class="timeline-body"><p>This adds support for pydocstyle code D401 using the <code>imperative</code> crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @akx on 2023-01-19 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-19 17:14</div>
            <div class="timeline-body"><p>Looks neat! Some thoughts:</p>
<ul>
<li>I assume that this only supports English? I think we're quite likely to end up with multiple language-specific lints (e.g. spell checking has already been requested #1628), so at some point we should probably introduce some <code>language</code> setting to better support non-English code bases (akin to our current <code>convention</code> setting, setting e.g. <code>language = &quot;es&quot;</code> would disable all language-specific lints that don't support Spanish).</li>
<li>This introduces a new dependency for a single rule ... I think this would be a good candidate for a <a href="https://doc.rust-lang.org/cargo/reference/features.html">feature gate</a>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:3526 on 2023-01-19 17:16</div>
            <div class="timeline-body"><p>The violations are only all defined in <code>violations.rs</code> for historical reasons. We actually want to move these next to the rule implementations in <code>rules::</code>. Also you'll need to remove the placeholder and add <code>#[derive_message_formats]</code> to the <code>message</code> function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/rules/pydocstyle/rules.rs</code>:816 on 2023-01-19 17:17</div>
            <div class="timeline-body"><p>I think it would make sense to move this new code (along with the violation defintion) to a new file <code>pydocstyle/non_imperative_mood.rs</code> since we actually want to break up such <code>rules.rs</code> files into smaller files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:4257 on 2023-01-19 17:19</div>
            <div class="timeline-body"><p>I think this violation should rather be named NonImperativeMood, see 5bf6da0db7ef76fd81f2932eac4a18d99e380789 for the reasoning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:3524 on 2023-01-19 17:20</div>
            <div class="timeline-body"><p>I think using a raw string literal <code>r#&quot; ... &quot;#</code> is nicer when the string contains double quotes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>resources/test/fixtures/pydocstyle/D401.py</code>:11 on 2023-01-19 17:22</div>
            <div class="timeline-body"><p>nit: but maybe choose some less distracting method names</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 17:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/violations.rs</code>:4257 on 2023-01-19 17:36</div>
            <div class="timeline-body"><p>I would kind of love that the name of the violation is also in imperative mood üòÅ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/pydocstyle/rules.rs</code>:816 on 2023-01-19 17:36</div>
            <div class="timeline-body"><p>Should I maybe make a separate PR that breaks up <code>pydocstyle/rules.rs</code> to begin with?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 17:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 17:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/violations.rs</code>:3526 on 2023-01-19 17:38</div>
            <div class="timeline-body"><p>Okay, sure ‚Äì maybe <code>CONTRIBUTING.md</code> should be updated to instruct a non-historic method? üòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/rules/pydocstyle/rules.rs</code>:816 on 2023-01-19 17:44</div>
            <div class="timeline-body"><p>You don't need to break up all of <code>pydocstyle/rules.rs</code> to introduce a new pydocstyle rule but yes if you want to break that file up you could do so in a separate PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:4257 on 2023-01-19 17:45</div>
            <div class="timeline-body"><p>Well the idea is that you can have <code>Allow &lt;violation-name&gt;</code> which is imperative mood :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-19 17:49</div>
            <div class="timeline-body"><blockquote>
<ul>
<li>This introduces a new dependency for a single rule ... I think this would be a good candidate for a <a href="https://doc.rust-lang.org/cargo/reference/features.html">feature gate</a>.</li>
</ul>
</blockquote>
<p>I'm not sure how we'd ship <code>ruff</code> to PyPI with optional features since you can't just <code>pip install ruff[language]</code> them in... The dependency is pretty small, though; a release build grows 0,575¬†% with this feature:</p>
<pre><code>$ gdu -b ruff-*
11223080	ruff-imp
11168864	ruff-main
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 17:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:3526 on 2023-01-19 17:49</div>
            <div class="timeline-body"><p>Yeah I agree that updating <code>CONTRIBUTING.md</code> would make sense ... however I am currently actively figuring out a better structure for ruff rules (moving away from the upstream-centric architecture since many rules are implemented by several linters), so the recommended structure will probably change again in the near future ... at which point I'll certainly make an effort to properly document it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>resources/test/fixtures/pydocstyle/D401.py</code>:11 on 2023-01-19 17:50</div>
            <div class="timeline-body"><p>Ported from https://github.com/PyCQA/pydocstyle/blob/master/src/tests/test_cases/test.py#L353-L368</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 17:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 17:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/violations.rs</code>:3526 on 2023-01-19 17:52</div>
            <div class="timeline-body"><p>Sure, I get that ruff is a very fast-moving target :)</p>
<p>It's just that that's where new contributors (yours truly) look for instructions, and getting contradicting information in a PR review (especially with a &quot;you'll need to&quot; (though maybe it wasn't meant that way)) is a bit unfortunate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-19 17:54</div>
            <div class="timeline-body"><p>Right the optional feature could be enabled by default. We are planning on publishing the <code>ruff</code> library on crates.io and for ruff as a library it probably makes sense to feature gate such optional dependencies ... however I just realized that <code>#[cfg(feature = &quot;whatever&quot;)]</code> probably doesn't work within the <code>define_rule_mapping!</code> macro ... so I guess you can just forget about that for now.^^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 18:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/pydocstyle/rules.rs</code>:816 on 2023-01-19 18:13</div>
            <div class="timeline-body"><p>@not-my-profile üëç  Done in https://github.com/charliermarsh/ruff/pull/2003.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 18:16</div>
            <div class="timeline-body"><p>(Yeah, conceptually it makes sense for us to use <code>features</code> in some places, but you're right that whatever we ship to PyPI probably has to use all default features with no configurability.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 19:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/violations.rs</code>:4257 on 2023-01-19 19:15</div>
            <div class="timeline-body"><p>Will change to <code>ImperativeMood</code>, c.f. <code>FirstLineCapitalized</code>, <code>EndsInPunctuation</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-19 19:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/violations.rs</code>:3524 on 2023-01-19 19:27</div>
            <div class="timeline-body"><p>I followed the style used elsewhere in the file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Port pydocstyle code 401 (UseImperativeMood)" to "Port pydocstyle code 401 (ImperativeMood)" by @akx on 2023-01-19 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @not-my-profile by @akx on 2023-01-19 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:4257 on 2023-01-19 20:00</div>
            <div class="timeline-body"><p>The violation structs currently aren't named consistently so referencing two others doesn't really make sense. I think the <code>Allow &lt;violation-name&gt;</code> convention from Rust makes sense which would mean we'd have to always name the negative case ... which actually does makes sense as well for violations since &quot;imperative mood&quot; isn't a violation but what's expected .... &quot;non-imperative mood&quot; would be the violation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 20:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 20:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>resources/test/fixtures/pydocstyle/D401.py</code>:11 on 2023-01-19 20:02</div>
            <div class="timeline-body"><p>Yes I don't think somebody smashing their keyboard is something we should port.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-19 20:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>src/violations.rs</code>:3526 on 2023-01-19 20:06</div>
            <div class="timeline-body"><p>Right I get what you mean :)</p>
<p>Now that you have an <code>imperative_mood.rs</code> file you could also move the violation definition there like I suggested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pydocstyle/rules/imperative_mood.rs</code>:17 on 2023-01-20 00:29</div>
            <div class="timeline-body"><p>Unfortunately I think this is the index of the <em>last</em> physical line in the logical line. So, like, if the &quot;first logical line&quot; extends beyond a single physical line, like:</p>
<pre><code>&quot;&quot;&quot;Here's a logical line that
extends to two physical lines.
&quot;&quot;&quot;
</code></pre>
<p>Then the index would be 1 instead of 0.</p>
<p>We can either modify <code>logical_line</code> to return the (start, end) indices. <em>Or</em>, you could just do <code>body.trim().split_whitespace().next()</code>? You just want the very first word after all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-20 00:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/pydocstyle/rules/imperative_mood.rs</code>:17 on 2023-01-20 00:30</div>
            <div class="timeline-body"><p>(Otherwise, LGTM.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-20 00:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> requested changes on 2023-01-20 01:44</div>
            <div class="timeline-body"><p>As I said in the comments you now marked as resolved, I think it would be better if the violation struct was named NonImperativeMood and if it was defined in <code>non_imperative_mood.rs</code> (as opposed to <code>violations.rs</code>.).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 01:49</div>
            <div class="timeline-body"><p>Ah, yeah, sorry -- those are two conventions we're trying to adopt: moving the violations into the rule files, and naming rules such that &quot;Allow X&quot; is descriptive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2023-01-20 09:26</div>
            <div class="timeline-body"><blockquote>
<p>if it was defined in <code>non_imperative_mood.rs</code> (as opposed to <code>violations.rs</code>.).</p>
</blockquote>
<p>Oops, my bad ‚Äì that broke in rebase.</p>
<blockquote>
<p>and naming rules such that &quot;Allow X&quot; is descriptive.</p>
</blockquote>
<p>Okiedoke.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/akx">@akx</a> reviewed on 2023-01-20 10:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/akx">@akx</a> on <code>src/rules/pydocstyle/rules/imperative_mood.rs</code>:17 on 2023-01-20 10:52</div>
            <div class="timeline-body"><p>Changed to trim the docstring, then get the first line, and the first word off there ‚Äì the error message looks better when it has the context of the full first line üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @akx on 2023-01-20 11:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-01-20 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-20 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 12:18</div>
            <div class="timeline-body"><p>Thank you so much!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 04:54:10 UTC
    </footer>
</body>
</html>
