<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider all `TYPE_CHECKING` symbols for type-checking blocks - astral-sh/ruff #16669</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider all <code>TYPE_CHECKING</code> symbols for type-checking blocks</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16669">#16669</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-03-12 11:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR stabilizes the preview behavior introduced in https://github.com/astral-sh/ruff/pull/15719 to recognize all symbols named <code>TYPE_CHECKING</code> as type-checking
checks in <code>if TYPE_CHECKING</code> conditions. This ensures compatibility with mypy and pyright.</p>
<p>This PR also stabilizes the new behavior that removes <code>if 0:</code> and <code>if False</code> to be no longer considered type checking blocks.
Since then, this syntax has been removed from the typing spec and was only used for Python modules that don't have a <code>typing</code> module (<a href="https://github.com/astral-sh/ruff/pull/15719#issuecomment-2612787793">comment</a>).</p>
<p>The preview behavior was first released with Ruff 0.9.5 (6th of February), which was about a month ago. There are no open issues or PRs for the changed behavior</p>
<h2>Test Plan</h2>
<p>The snapshots for <code>SIM108</code> change because <code>SIM108</code> ignored type checking blocks but it can no
simplify <code>if 0</code> or <code>if False</code> blocks again because they're no longer considered type checking blocks.</p>
<p>The changes in the <code>TC005</code> snapshot or only due to that <code>if 0</code> and <code>if False</code> are no longer recognized as type checking blocks</p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @MichaReiser on 2025-03-12 11:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-03-12 11:57</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fnon-typing-type-checking">CodSpeed Performance Report</a></h2>
<h3>Merging #16669 will <strong>degrade performances by 10.62%</strong></h3>
<p><sub>Comparing <code>micha/non-typing-type-checking</code> (233ddc1) with <code>micha/ruff-0.10</code> (948435d)</sub></p>
<h3>Summary</h3>
<p><code>❌ 1</code> regressions<br />
<code>✅ 31</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/micha%2Fnon-typing-type-checking">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>red_knot_check_file[incremental]</code> | 4.9 ms | 5.5 ms | -10.62% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-12 11:57</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -0 violations, +0 -0 fixes in 1 projects; 54 projects unchanged)</p>
<details><summary><a href="https://github.com/scikit-build/scikit-build-core">scikit-build/scikit-build-core</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>

<pre>
+ <a href='https://github.com/scikit-build/scikit-build-core/blob/d1aaf2dbd3ad07cbe2f07b91f7653b2446546ea3/src/scikit_build_core/resources/_editable_redirect.py#L11'>src/scikit_build_core/resources/_editable_redirect.py:11:12:</a> TC004 Move import `importlib.machinery` out of type-checking block. Import is used for more than type hinting.
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| TC004 | 1 | 1 | 0 | 0 | 0 |</p>
</p>
</details>

<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-12 12:01</div>
            <div class="timeline-body"><p>The ecosystem change is a false positive but this is an issue with the corresponding rules and not specific to the change itself. See https://github.com/astral-sh/ruff/pull/15719#issuecomment-2612876491 for an in-depth explanation. There's also an open PR to fix this, but I haven't found the time yet to review it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.10" by @MichaReiser on 2025-03-12 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @MichaReiser on 2025-03-12 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-03-12 18:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-03-13 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-03-13 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-13 07:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:10:42 UTC
    </footer>
</body>
</html>
