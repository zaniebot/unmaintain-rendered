<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-logging-format`] handles grouping parens and preserves r-prefix/quotes - astral-sh/ruff #20224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-logging-format</code>] handles grouping parens and preserves r-prefix/quotes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20224">#20224</a>
        opened by <a href="https://github.com/TaKO8Ki">@TaKO8Ki</a>
        on 2025-09-04 08:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TaKO8Ki">@TaKO8Ki</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>Fixes some parts of #20151</p>
<p>Handles grouping parens and preserves r-prefix/quotes</p>
<ul>
<li>Iterate over <code>FStringPart</code> to build the format string, handling implicit string literal concatenation.</li>
<li>Preserve the original quote style and <code>r</code> prefix in the generated message string.</li>
<li>Replace over the expression’s parenthesized range to avoid tuple args, e.g. <code>logging.warning((f&quot;{Ellipsis}&quot;))</code> -&gt; <code>logging.warning(&quot;%s&quot;, Ellipsis)</code>.</li>
<li>Update tests and snapshots for nested parentheses and backslash escape case.</li>
</ul>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>I have updated <code>crates/ruff_linter/resources/test/fixtures/flake8_logging_format/G004.py</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-04 08:34</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dylwil3 by @dylwil3 on 2025-09-09 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-logging-format`] fix handles grouping parens and preserves r-prefix/quotes" to "[`flake8-logging-format`] handles grouping parens and preserves r-prefix/quotes" by @TaKO8Ki on 2025-09-10 16:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TaKO8Ki">@TaKO8Ki</a> on 2025-09-30 02:16</div>
            <div class="timeline-body"><p>@dylwil3 I have resolve the conflicts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TaKO8Ki">@TaKO8Ki</a> on 2025-10-17 18:49</div>
            <div class="timeline-body"><p>@dylwil3 @ntBre Gentle reminder: Could someone review this pull request?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/rules/flake8_logging_format/rules/logging_call.rs</code>:42 on 2025-10-18 21:00</div>
            <div class="timeline-body"><p>Is this right? What if, in an implicitly concatenated string, the first part is not raw but later parts are? Should we be keeping the string implicitly concatenated?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/resources/test/fixtures/flake8_logging_format/G004.py</code>:71 on 2025-10-18 21:08</div>
            <div class="timeline-body"><p>Can we add some more exotic tests? e.g. ones where...</p>
<ol>
<li>The raw prefix is on a different implicitly concatenated part?</li>
<li>Some of the weird behavior we're checking for lie in a different concatenated part?</li>
<li>There are more grouping parentheses</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> requested changes on 2025-10-18 21:09</div>
            <div class="timeline-body"><p>Thanks for working on this and apologies for the delay! I'd like to see a little more test coverage and I'm not confident we've solved the puzzle of implicitly concatenated strings correctly yet. If it becomes too complicated, another option would be to not offer the fix in the presence of implicit concatenation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-21 07:57</div>
            <div class="timeline-body"><p>@TaKO8Ki I just wanted to check in with you if you plan on revisiting this PR. Please don't feel pressured to do so, I'm only asking to understand what the next steps are on this PR.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:15:30 UTC
    </footer>
</body>
</html>
