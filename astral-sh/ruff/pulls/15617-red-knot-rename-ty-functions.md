```yaml
number: 15617
title: "[red-knot] Rename *_ty functions"
type: pull_request
state: merged
author: sharkdp
labels:
  - internal
  - ty
assignees: []
merged: true
base: main
head: david/ty-renaming
created_at: 2025-01-20T13:44:28Z
updated_at: 2025-01-22T08:06:58Z
url: https://github.com/astral-sh/ruff/pull/15617
synced_at: 2026-01-10T20:05:43Z
```

# [red-knot] Rename *_ty functions

---

_Pull request opened by @sharkdp on 2025-01-20 13:44_

## Summary

General rules:

* Change the `_ty` suffix of all functions to `_type`.
* `_type_and_qualifiers` suffixes seem too long, so we ignore the existence of qualifiers and still speak of "types"
* Functions only have a `_type` suffix if they return either `Type`, `Option<Type>`, or `TypeAndQualifiers`

Free functions:

* `binding_ty` => `binding_type`
* `declaration_ty` => `declaration_type`
* `definition_expression_ty` => `definition_expression_type`

Methods:

* `CallDunderResult::return_ty` => `return_type`
* `NotCallableError::return_ty` => `return_type`
* `NotCallableError::called_ty` => `called_type`
* `TypeAndQualifiers::inner_ty` => `inner_type`
* `TypeAliasType::value_ty` => `value_type`
* `TypeInference::expression_ty` => `expression_type`
* `TypeInference::try_expression_ty` => `try_expression_type`
* `TypeInference::binding_ty` => `binding_type`
* `TypeInference::declaration_ty` => `declaration_type` 
* `TypeInferenceBuilder::expression_ty` => `expression_type`
* `TypeInferenceBuilder::file_expression_ty` => `file_expression_type`
* `TypeInferenceBuilder::module_ty_from_name` => `module_type_from_name`
* `ClassBase::try_from_ty` => `try_from_type`
* `Parameter::annotated_ty` => `annotated_type`
* `Parameter::default_ty` => `default_type`
* `CallOutcome::return_ty` => `return_type`
* `CallOutcome::return_ty_result` => `return_type_result`
* `CallBinding::from_return_ty` => `from_return_type`
* `CallBinding::set_return_ty` => `set_return_type`
* `CallBinding::return_ty` => `return_type`
* `CallBinding::parameter_tys` => `parameter_types`
* `CallBinding::one_parameter_ty` => `one_parameter_type`
* `CallBinding::two_parameter_tys` => `two_parameter_types`
* `Unpacker::tuple_ty_elements` => `tuple_type_elements`
* `StringPartsCollector::ty` => `string_type`

Traits

* `HasTy` => `HasType`
* `HasTy::ty` => `inferred_type`

Test functions:

* `assert_public_ty` => `assert_public_type`
* `assert_scope_ty` => `assert_scope_type`

closes #15569

## Test Plan

—

---

_Label `internal` added by @sharkdp on 2025-01-20 13:44_

---

_Label `red-knot` added by @sharkdp on 2025-01-20 13:44_

---

_Comment by @github-actions[bot] on 2025-01-20 13:53_

<!-- generated-comment ecosystem -->
## `ruff-ecosystem` results
### Linter (stable)
✅ ecosystem check detected no linter changes.

### Linter (preview)
✅ ecosystem check detected no linter changes.




---

_@MichaReiser reviewed on 2025-01-20 13:59_

---

_Review comment by @MichaReiser on `crates/red_knot_project/tests/check.rs`:201 on 2025-01-20 13:59_

Getters are rather unidiomatic in the rust ecosystem. I think I prefer keeping `ty` here (`r#type` is too annoying to type). 

Or possibly `infer_type`?

---

_@MichaReiser approved on 2025-01-20 14:01_

---

_@MichaReiser reviewed on 2025-01-20 14:23_

---

_Review comment by @MichaReiser on `crates/red_knot_project/tests/check.rs`:200 on 2025-01-20 14:23_

We may want to wait for @carljm's feedback. I could see how he objects to `inferred_type` because it does return the declared type for classes or when the expression is in an annotation position... 

---

_@sharkdp reviewed on 2025-01-20 14:27_

---

_Review comment by @sharkdp on `crates/red_knot_project/tests/check.rs`:200 on 2025-01-20 14:27_

If so, then we should probably also change the documentation of the trait (*"Returns the inferred type of `self`"*):
```rs
pub trait HasType {
    /// Returns the inferred type of `self`.
    ///
    /// ## Panics
    /// May panic if `self` is from another file than `model`.
    fn inferred_type<'db>(&self, model: &SemanticModel<'db>) -> Type<'db>;
}
```
I would think that maybe here in `semantic_model.rs`, we may not want to distinguish between declared/inferred type. They're all types that are generated by "Type inference".

But yes, I'll leave this open for further discussion.

---

_@carljm reviewed on 2025-01-22 00:05_

---

_Review comment by @carljm on `crates/red_knot_project/tests/check.rs`:200 on 2025-01-22 00:05_

> I would think that maybe here in `semantic_model.rs`, we may not want to distinguish between declared/inferred type. They're all types that are generated by "Type inference".

Yes, I agree with this and I'm fine with the name changes in this PR.

---

_Marked ready for review by @sharkdp on 2025-01-22 07:42_

---

_Review requested from @AlexWaygood by @sharkdp on 2025-01-22 07:42_

---

_Merged by @sharkdp on 2025-01-22 08:06_

---

_Closed by @sharkdp on 2025-01-22 08:06_

---

_Branch deleted on 2025-01-22 08:06_

---
