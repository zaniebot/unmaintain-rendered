<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] add fix safety section (`PLR1722`) - astral-sh/ruff #17826</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] add fix safety section (<code>PLR1722</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17826">#17826</a>
        opened by <a href="https://github.com/yunchipang">@yunchipang</a>
        on 2025-05-04 04:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/yunchipang">@yunchipang</a> on 2025-05-04 04:16</div>
            <div class="timeline-body"><p>parent: #15584
fix introduced at: #816</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @AlexWaygood on 2025-05-04 09:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-04 10:05</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-05-04 18:25</div>
            <div class="timeline-body"><p>I think the fix is always unsafe...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yunchipang">@yunchipang</a> on 2025-05-04 23:56</div>
            <div class="timeline-body"><p>@VascoSch92 Thanks for the input! I’m new to the project—could you elaborate a bit? I was referencing this:
https://github.com/astral-sh/ruff/blob/e95130ad8062f64a11247d51a72f62bb735ddd19/crates/ruff_linter/src/rules/pylint/rules/sys_exit_alias.rs#L44</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-05 14:09</div>
            <div class="timeline-body"><p>Fix availability is separate from fix safety. In some cases we might offer a diagnostic without a fix at all, regardless of safety. For this rule, that can happen if we fail to generate the new import edit, for example.</p>
<p>There's not really a centralized safety marker, you generally just have to search for <code>Fix::</code> or <code>safe</code>/<code>unsafe</code> in the file (at least that's what I do). If all of the places where a <code>Fix</code> is constructed use something like <code>Fix::unsafe_edit</code>, then you know it's always unsafe.</p>
<p>Thanks for working on this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> requested changes on 2025-05-05 14:12</div>
            <div class="timeline-body"><p>Related to my other comment, this is more of a description of the fix's availability rather than its safety. It's not immediately clear to me why this  fix is unsafe, which is one of the challenging parts of these cases. You may need to look back at the original PR adding the rule for more discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-05-05 15:13</div>
            <div class="timeline-body"><p>The rule description says “<code>exit</code> and <code>quit</code> come from the <code>site</code> module, which is typically imported automatically during startup. However, it is not <em>guaranteed</em> to be imported”. If it’s not imported, the fix can change behavior.</p>
<pre><code class="language-console">$ cat &gt;plr1722_1.py &lt;&lt;'# EOF'
exit(2)
# EOF

$ python -S plr1722_1.py; echo $?
Traceback (most recent call last):
  File &quot;plr1722_1.py&quot;, line 1, in &lt;module&gt;
    exit()
    ^^^^
NameError: name 'exit' is not defined
1

$ ruff --isolated check plr1722_1.py --select PLR1722 --unsafe-fixes --fix
Found 1 error (1 fixed, 0 remaining).

$ python -S plr1722_1.py; echo $?
2
</code></pre>
<p>Another difference between <code>site.exit</code> and <code>sys.exit</code> is how they treat 0- and 1-element tuples. (This is undocumented and is arguably a bug in <code>sys.exit</code>.)</p>
<pre><code class="language-console">$ cat &gt;plr1722_2.py &lt;&lt;'# EOF'
exit(())
# EOF

$ cat &gt;plr1722_3.py &lt;&lt;'# EOF'
exit((2,))
# EOF

$ python plr1722_2.py; echo $?
()
1

$ python plr1722_3.py; echo $?
(2,)
1

$ ruff --isolated check plr1722_{2,3}.py --select PLR1722 --unsafe-fixes --fix
Found 2 errors (2 fixed, 0 remaining).

$ python plr1722_2.py; echo $?
0

$ python plr1722_3.py; echo $?
2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yunchipang">@yunchipang</a> reviewed on 2025-05-05 18:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yunchipang">@yunchipang</a> on <code>crates/ruff_linter/src/rules/pylint/rules/sys_exit_alias.rs</code>:24 on 2025-05-05 18:05</div>
            <div class="timeline-body"><p>@ntBre @dscorbett thanks you for the context! the reviews helped a lot.
I have pushed the changes, please let me know if it's clearer this time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ntBre by @yunchipang on 2025-05-05 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-05-05 18:37</div>
            <div class="timeline-body"><p>Thanks! This looks good to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-05-05 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-05-05 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-07 01:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 18:45:31 UTC
    </footer>
</body>
</html>
