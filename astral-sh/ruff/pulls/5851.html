<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove exception-handler lexing from `unused-bound-exception` fix - astral-sh/ruff #5851</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove exception-handler lexing from <code>unused-bound-exception</code> fix</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5851">#5851</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-07-18 01:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-18 01:45</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>The motivation here is that it will make this rule easier to rewrite as a deferred check. Right now, we can't run this rule in the deferred phase, because it depends on the <code>except_handler</code> to power its autofix. Instead of lexing the <code>except_handler</code>, we can use the <code>SimpleTokenizer</code> from the formatter, and just lex forwards and backwards.</p>
<p>For context, this rule detects the unused <code>e</code> in:</p>
<pre><code class="language-python">try:
  pass
except ValueError as e:
  pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @charliermarsh on 2023-07-18 01:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-18 01:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/src/trivia.rs</code>:138 on 2023-07-18 01:45</div>
            <div class="timeline-body"><p>I decided to move this to the shared <code>ruff_python_whitespace</code> crate, whose name is getting less and less appropriate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-18 02:34</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>✅ ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      9.3±0.02ms     4.4 MB/sec    1.00      9.3±0.03ms     4.4 MB/sec
formatter/numpy/ctypeslib.py               1.00   1855.4±1.46µs     9.0 MB/sec    1.00   1859.9±3.14µs     9.0 MB/sec
formatter/numpy/globals.py                 1.00    207.8±3.01µs    14.2 MB/sec    1.01    209.1±1.56µs    14.1 MB/sec
formatter/pydantic/types.py                1.00      4.0±0.01ms     6.4 MB/sec    1.00      4.0±0.01ms     6.4 MB/sec
linter/all-rules/large/dataset.py          1.00     12.8±0.02ms     3.2 MB/sec    1.00     12.8±0.11ms     3.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.3±0.01ms     5.0 MB/sec    1.00      3.3±0.00ms     5.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    435.2±0.67µs     6.8 MB/sec    1.00    435.1±0.65µs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.02      6.0±0.01ms     4.3 MB/sec    1.00      5.8±0.01ms     4.4 MB/sec
linter/default-rules/large/dataset.py      1.00      6.6±0.02ms     6.2 MB/sec    1.00      6.5±0.01ms     6.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00   1409.1±1.46µs    11.8 MB/sec    1.00   1409.4±3.74µs    11.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    155.3±0.24µs    19.0 MB/sec    1.00    155.3±0.33µs    19.0 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.0±0.01ms     8.6 MB/sec    1.00      3.0±0.01ms     8.6 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     15.0±0.41ms     2.7 MB/sec    1.01     15.2±0.36ms     2.7 MB/sec
formatter/numpy/ctypeslib.py               1.01      2.9±0.08ms     5.7 MB/sec    1.00      2.9±0.09ms     5.8 MB/sec
formatter/numpy/globals.py                 1.00   333.2±16.41µs     8.9 MB/sec    1.02   340.4±17.51µs     8.7 MB/sec
formatter/pydantic/types.py                1.00      6.3±0.21ms     4.1 MB/sec    1.02      6.4±0.24ms     4.0 MB/sec
linter/all-rules/large/dataset.py          1.00     21.5±0.51ms  1938.7 KB/sec    1.01     21.7±0.48ms  1922.3 KB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      5.7±0.20ms     2.9 MB/sec    1.00      5.6±0.13ms     3.0 MB/sec
linter/all-rules/numpy/globals.py          1.01   671.1±30.63µs     4.4 MB/sec    1.00   666.6±26.80µs     4.4 MB/sec
linter/all-rules/pydantic/types.py         1.00      9.8±0.27ms     2.6 MB/sec    1.00      9.8±0.28ms     2.6 MB/sec
linter/default-rules/large/dataset.py      1.00     11.8±0.31ms     3.5 MB/sec    1.01     11.9±0.28ms     3.4 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.4±0.07ms     7.0 MB/sec    1.00      2.4±0.07ms     7.0 MB/sec
linter/default-rules/numpy/globals.py      1.01   280.2±12.73µs    10.5 MB/sec    1.00   278.5±11.92µs    10.6 MB/sec
linter/default-rules/pydantic/types.py     1.00      5.1±0.15ms     5.0 MB/sec    1.00      5.1±0.14ms     5.0 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyflakes/fixes.rs</code>:93 on 2023-07-18 06:12</div>
            <div class="timeline-body"><p>Nit: Can we give this range a more specific name: E.g. <code>except_handler_range</code>? I think it's also fine to pass in the except handler even if we only use its range. It acts as &quot;parameter documentation&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyflakes/fixes.rs</code>:97 on 2023-07-18 06:14</div>
            <div class="timeline-body"><p>#5825 adds a new <code>up_to_no_back_comments</code> constructor function that is significantly faster when we know, that the end position's line contains no comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyflakes/fixes.rs</code>:109 on 2023-07-18 06:16</div>
            <div class="timeline-body"><p>What are the valid tokens for the exception value? The simple tokenizer (intentionally) only supports a very limited set of tokens. E.g. strings no strings or identifiers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/trivia.rs</code>:4 on 2023-07-18 06:16</div>
            <div class="timeline-body"><p>Hmm. Why does git not recognize that this file was moved? It will make merging my PRs rather painful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-18 06:18</div>
            <div class="timeline-body"><p>Can you take a look at why git doesn't recognize the move of the <code>tokenizer</code>.</p>
<p><code>ruff_python_trivia</code> might be a better name now. But renaming is probably worth its own PR.</p>
<p>One thing that now might be confusing to users is that we have two conflicting <code>TokenKind</code> definitions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-18 15:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/src/trivia.rs</code>:4 on 2023-07-18 15:32</div>
            <div class="timeline-body"><p>Will resolve, but also happy to just wait for you to merge and handle the rebase on my end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-18 15:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pyflakes/fixes.rs</code>:109 on 2023-07-18 15:33</div>
            <div class="timeline-body"><p>We just want <em>anything</em> that isn't a continuation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-18 15:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pyflakes/fixes.rs</code>:109 on 2023-07-18 15:33</div>
            <div class="timeline-body"><p>It's basically <code>X as Y</code>, and we're starting at <code>Y</code>. The only thing you can have between <code>X</code> and <code>as</code>, and between <code>as</code> and <code>Y</code>, is whitespace and continuation (backslash).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/trivia.rs</code>:4 on 2023-07-18 15:53</div>
            <div class="timeline-body"><p>Getting git to recognize the move would also be good to preserve the history. I otherwise don't mind merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-18 15:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-07-18 15:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_formatter/src/trivia.rs</code>:4 on 2023-07-18 15:56</div>
            <div class="timeline-body"><p>The problem could be that I didn't move the whole file, I left behind some of the utility methods... But I can just move them all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-07-18 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-18 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-18 18:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:31:00 UTC
    </footer>
</body>
</html>
