<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement a fixer for E402 - astral-sh/ruff #22212</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement a fixer for E402</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22212">#22212</a>
        opened by <a href="https://github.com/PeterJCLaw">@PeterJCLaw</a>
        on 2025-12-26 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/PeterJCLaw">@PeterJCLaw</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This implements a fixer for E402, as suggested at https://github.com/astral-sh/ruff/issues/6514.</p>
<p>This enables users to move imports up to the top of the file when they are found lower down. This is similar to isort's <code>float-to-top</code> logic, though not quite the same. As suggested by @ntBre on that issue, the expected path here is for people to enable unsafe-fixes to access this feature, potentially marking this fix &quot;safe&quot; in their config, rather than to implement an <code>float-to-top</code> option in the isort config.</p>
<p>Internally this means that there are separate fix edits for each import found to be out of place rather than a single one (the latter being how isort tends to work).</p>
<p>The current state of this is a <em>first draft</em>. It's working, I've done some manual testing and I have copied over a lot of the handling from the isort-like <code>organize_imports</code> function, though I may have missed things.</p>
<p>I'm also fairly new to rust and to this project so e.g: I don't know if e.g: the code is the best way to spell some of the concepts. I'm very happy to refactor things if there's better ways, including if e.g: we want to share more code between this and the isort crate -- I've deliberately not done that so far (purely to get to something which works).</p>
<p>This remains a bit work-in-progress, so I've included a test project I'm using for testing against though obviously that would be removed before this gets anywhere near merging. (I might also tidy the history a bit too)</p>
<p>Fixes https://github.com/astral-sh/ruff/issues/6514</p>
<h2>Test Plan</h2>
<p>Manual testing so far, see various demo files currently committed. I'd like to add some tests and will look into that next. It looks like it's mostly snapshot based testing. Do we just add a new test function in <code>crates/ruff_linter/src/rules/pycodestyle/mod.rs</code>?</p>
<p>Noting them down so they're written, test cases:</p>
<ul>
<li>interaction with editor organise-imports logic -- with and without the E402 fix being accepted as safe</li>
<li>variations on import spelling</li>
<li>variations of other statements near the import, including on the same line (e.g: peruse the isort tests and pick relevant looking ones)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-26 19:14</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:18:25 UTC
    </footer>
</body>
</html>
