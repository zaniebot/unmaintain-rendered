<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preserve generator parentheses in single argument call expressions - astral-sh/ruff #7226</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Preserve generator parentheses in single argument call expressions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7226">#7226</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-09-07 17:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR fixes an issue discovered in our dogfooding session where Ruff removes the generator parentheses but black preserves them.</p>
<p>Ruff has special handling for formatting generators when they are they only argument in a call expression. However, the existing implementation always removed the parentheses rather than preserving them.</p>
<p>This PR changes the logic to only omit the parentheses if they aren't present in the source.</p>
<h2>Test Plan</h2>
<p>Added tests</p>
<p>The similarity index for <code>transformers</code> improves from 0.99928 -&gt; 0.99929</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-07 17:12</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #7226</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7226" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7226?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-09-07 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:389 on 2023-09-07 17:16</div>
            <div class="timeline-body"><p>this looks worse to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:392 on 2023-09-07 17:16</div>
            <div class="timeline-body"><p>when it breaks this looks fine, but i kinda prefer no parentheses for consistency</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__generator_exp.py.snap</code>:74 on 2023-09-07 17:17</div>
            <div class="timeline-body"><p>i agree with this one</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-09-07 17:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-07 17:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:389 on 2023-09-07 17:22</div>
            <div class="timeline-body"><p>My reasoning here is that Black (and ruff) preserve parentheses of nested expressions. Not doing so violates that principle and it is not that Ruff introduces the parentheses if the user wrote the generator without.</p>
<p>So I think this comes down to the question of whether Ruff/Black should normalize all parenthesized expressions. The current philosophy is to preserve them. That's why I'm leaning toward changing it.</p>
<p>CC: @zanieb who discovered this during dogfooding</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-07 18:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:389 on 2023-09-07 18:09</div>
            <div class="timeline-body"><p>I think I would be leaning towards removing them if there's precedence for e.g. tuples but black preserve tuple parentheses too:</p>
<pre><code class="language-python">a = (1, 2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:389 on 2023-09-08 08:26</div>
            <div class="timeline-body"><p>i'm fine with merging this! It's a the clear compatibility problem, i just don't like the decision to have double parentheses <code>((...))</code> (without or without whitespace in between)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-09-08 08:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap</code>:389 on 2023-09-08 08:31</div>
            <div class="timeline-body"><p>I agree, in which case we should change <code>call((1, 2))</code> too (or even <code>call((1))</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-09-08 08:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-09-08 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-09-08 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-08 08:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:07 UTC
    </footer>
</body>
</html>
