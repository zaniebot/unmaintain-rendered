<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 - update documentation and deprecate `ignore_init_module_imports` - astral-sh/ruff #11436</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 - update documentation and deprecate <code>ignore_init_module_imports</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11436">#11436</a>
        opened by <a href="https://github.com/plredmond">@plredmond</a>
        on 2024-05-15 18:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a></div>
            <div class="timeline-body">Summary
<ul>
<li>Update documentation for F401 following recent PRs<ul>
<li>#11168</li>
<li>#11314</li>
</ul>
</li>
<li>Deprecate <code>ignore_init_module_imports</code><ul>
<li>Add a deprecation pragma to the option and a &quot;warn user once&quot; message when the option is used.</li>
</ul>
</li>
<li>Restore the old behavior for stable (non-preview) mode:<ul>
<li>When <code>ignore_init_module_imports</code> is set to <code>true</code> (default) there are no <code>__init_.py</code> fixes (but we get nice fix titles!).</li>
<li>When <code>ignore_init_module_imports</code> is set to <code>false</code> there are unsafe <code>__init__.py</code> fixes to remove unused imports.</li>
<li>When preview mode is enabled, it overrides <code>ignore_init_module_imports</code>.</li>
</ul>
</li>
<li>Fixed a bug in fix titles where <code>import foo as bar</code> would recommend reexporting <code>bar as bar</code>. It now says to reexport <code>foo as foo</code>. (In this case we don&#x27;t issue a fix, fwiw; it was just a fix title bug.)</li>
</ul>
Test plan
<p>Added new fixture tests that reuse the existing fixtures for <code>__init__.py</code> files. Each of the three situations listed above has fixture tests. The F401 &quot;stable&quot; tests cover:</p>
<blockquote>
<ul>
<li>When <code>ignore_init_module_imports</code> is set to <code>true</code> (default) there are no <code>__init_.py</code> fixes (but we get nice fix titles!).</li>
</ul>
</blockquote>
<p>The F401 &quot;deprecated option&quot; tests cover:</p>
<blockquote>
<ul>
<li>When <code>ignore_init_module_imports</code> is set to <code>false</code> there are unsafe <code>__init__.py</code> fixes to remove unused imports.</li>
</ul>
</blockquote>
<p>These complement existing &quot;preview&quot; tests that show the new behavior which recommends fixes in <code>__init__.py</code> according to whether the import is 1st party and other circumstances (for more on that behavior see: #11314).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-15 19:00</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/ruff/branches/ruff.__all__">CodSpeed Performance Report</a>
Merging #11436 will <strong>not alter performance</strong>
<p>Comparing <code>ruff.<strong>all</strong></code> (6028415) with <code>main</code> (403f0dc)</p>
Summary
<p><code>✅ 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-05-15 19:09</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-15 19:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:38 on 2024-05-15 19:27</div>
            <div class="timeline-body"><p>I don&#x27;t think you need to specify the <code>__init__.py</code> part, you can follow the above style.</p>
<blockquote>
<p>Alternatively, you can use <code>__all__</code> to declare a symbol as part of the module&#x27;s public interface,
as in:</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-15 19:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:51 on 2024-05-15 19:30</div>
            <div class="timeline-body"><p>I&#x27;d say something like</p>
<blockquote>
<p>Applying fixes to <code>__init__.py</code> files is currently in preview.</p>
</blockquote>
<p>Maybe you can just move this to the start of the next paragraph instead of saying &quot;In preview mode...&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-15 19:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:57 on 2024-05-15 19:34</div>
            <div class="timeline-body"><p>I&#x27;d say something more like:</p>
<blockquote>
<p>Applying fixes to <code>__init__.py</code> files is currently in preview. The fix differs based on the type of the unused import. Ruff will suggest a safe fix to export first-party imports with either a redundant alias or, if already present in the file, an <code>__all__</code> entry. If multiple <code>__all_</code> declarations are present, Ruff will not offer a fix. Ruff will suggest an unsafe fix to remove third-party and standard library imports — the fix is unsafe because the module&#x27;s interface changes.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-15 19:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:47 on 2024-05-15 19:36</div>
            <div class="timeline-body"><p>Just realized I was commenting on a test snapshot :) changes refer to this file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:47 on 2024-05-15 20:36</div>
            <div class="timeline-body"><p>No worries :) Thanks for your suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-15 20:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-15 20:36</div>
            <div class="timeline-body"><p>@zanieb thoughts on how to gracefully deprecate <code>lint.ignore_init_module_imports</code>? I can just grep for it and remove it, but that seems like it would break people who have the option in their config files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-18 17:19</div>
            <div class="timeline-body"><p>Here&#x27;s an example of a deprecated setting:</p>
<p>https://github.com/astral-sh/ruff/blob/a73b8c82a83336d76e69ee779d1f0648d1fdc667/crates/ruff_workspace/src/options.rs#L428-L432</p>
<p>which has a warning at</p>
<p>https://github.com/astral-sh/ruff/blob/6ed2482e27ec27fa9a6a812cff52efa1c360aded/crates/ruff_workspace/src/configuration.rs#L423-L430</p>
<p>I believe this one was deprecated in <a href="https://github.com/astral-sh/ruff/pull/8082">astral-sh/ruff#8082</a> if that&#x27;s helpful. I&#x27;m actually not entirely sure why we define a message for the deprecation <em>and</em> manually include a separate warning. Perhaps because it was renamed? I&#x27;d have to play with this a bit to find the right usage.</p>
<p>I think we should still respect the setting on stable but you can ignore it in preview. In both cases, we should display a warning. In the future, we can make using the setting an error during configuration loading.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-20 23:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:271 on 2024-05-20 23:18</div>
            <div class="timeline-body"><p>These three lines look fishy because I&#x27;d originally replaced this</p>
<pre><code>    let fix_init = !checker.settings.ignore_init_module_imports;
</code></pre>
<p>with</p>
<pre><code>    let fix_init = checker.settings.preview.is_enabled();
</code></pre>
<p>which was perhaps lazy. In this PR I&#x27;m restoring the old behavior, and so gave <code>checker.settings.preview.is_enabled();</code> its own name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-20 23:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:27 on 2024-05-20 23:22</div>
            <div class="timeline-body"><p>This field is required to make fix titles follow the &quot;old&quot; behavior in <code>__init__.py</code> files. When we finally remove the option <code>ignore_init_module_imports</code> then this field <code>ignore_init_module_imports</code> can be deleted too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/rules/unused_import.rs</code>:295 on 2024-05-20 23:23</div>
            <div class="timeline-body"><p>This section looks like a large change but isn&#x27;t. I only added <code>preview_mode</code> to the disjunction. Turn on <code>-w</code> to see the diff w/o whitespace changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-20 23:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-20 23:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_linter/src/rules/pyflakes/snapshots/ruff_linter__rules__pyflakes__tests__preview__F401_F401_24____init__.py.snap</code>:42 on 2024-05-20 23:25</div>
            <div class="timeline-body"><p>This is the only change in to an existing snapshot in the whole diff. It was a bug where the fix title contained the binding, instead of the module.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-20 23:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-20 23:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-20 23:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:88 on 2024-05-20 23:57</div>
            <div class="timeline-body"><p>I think these options might get dynamically turned into links during documentation generation, not sure if this will work. I&#x27;d just leave it as-is probably.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-21 00:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:665 on 2024-05-21 00:16</div>
            <div class="timeline-body"><p>I think I&#x27;d phrase like...</p>
<blockquote>
<p>The <code>ignore-init-module-imports</code> option is deprecated and will be removed in a future release. Ruff&#x27;s handling of imports in <code>__init__.py</code> files has been improved (in preview) and unused imports will always be flagged.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-21 00:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:664 on 2024-05-21 00:22</div>
            <div class="timeline-body"><p>I think we should warn regardless of the value if we&#x27;re going to remove the setting, right? I guess it depends if preview is enabled but is that feasible to check here? i.e. if preview is disabled and this is false the suggestion is to try preview mode instead but not everyone can do that since it&#x27;s a global toggle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-05-21 00:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-21 03:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:88 on 2024-05-21 03:48</div>
            <div class="timeline-body"><p>Willfix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-21 03:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:665 on 2024-05-21 03:49</div>
            <div class="timeline-body"><p>Willfix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/plredmond">@plredmond</a> reviewed on 2024-05-21 03:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/plredmond">@plredmond</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:664 on 2024-05-21 03:49</div>
            <div class="timeline-body"><p>Oops! Yes :100: thank you for catching this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-21 11:54</div>
            <div class="timeline-body"><p>Deferring to @zanieb, feel free to merge when approved!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Hnasar">@Hnasar</a> reviewed on 2024-05-21 13:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Hnasar">@Hnasar</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:56 on 2024-05-21 13:56</div>
            <div class="timeline-body"><p>I think it&#x27;s good that ruff has different handling of first vs third party imports, but changing behavior based on the name of the module (containing the import) I find unintuitive and I argue is unpythonic.</p>
<p>By that, I mean: if I have <code>mod/__init__.py</code>, is the fix any more or less safe than if I instead named it <code>mod.py</code>? No — the <code>__init__.py</code> is just an implementation detail and in either case, the module&#x27;s interface changes with <em>any</em> import changes.</p>
<p>It&#x27;s not a universally-accepted convention that <code>__init__.py</code> should store your entire public API.
For example, it&#x27;s hinders import times for users of a large package, if the entire public API is placed in <code>__init__.py</code>, because then any import of a <em>submodule</em> will trigger an import <code>__init__.py</code> and thus an import of <em>every</em> module, if <em>everything</em> is reexported.</p>
<p>At most, we have the typing docs (<a href="https://typing.readthedocs.io/en/latest/source/libraries.html#library-interface-public-and-private-symbols">Typing documentation: interface conventions</a>) because there&#x27;s nothing I can find on python.org that discusses this. But given the typing docs guidance, I would find it slightly easier to teach that:</p>
<ul>
<li>third party imports: <em>always</em> safe to remove</li>
<li>first party imports: <em>unsafe</em> to remove if contained within the same package (similar to relative import convention from typing spec). Safe otherwise.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Hnasar">@Hnasar</a> reviewed on 2024-05-21 13:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Hnasar">@Hnasar</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:56 on 2024-05-21 13:58</div>
            <div class="timeline-body"><p>Also for mono-repos, there may be dozens or hundreds of <em>first party</em> top-level packages. Therefore this rule should base its decisions on whether an import is intra-package (e.g. a relative import) rather than first vs third party packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-21 15:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/snapshots/integration_test__rule_f401.snap</code>:56 on 2024-05-21 15:01</div>
            <div class="timeline-body"><p>Thanks for your feedback @Hnasar — would you mind opening a new issue to discuss this preview behavior? I don&#x27;t think this pull request is a great place for it since it&#x27;s just updating the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-21 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/plredmond">@plredmond</a> on 2024-05-21 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-21 16:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:04:06 UTC
    </footer>
</body>
</html>
