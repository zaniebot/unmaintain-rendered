<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove unused flags and functions from the semantic model - astral-sh/ruff #14318</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove unused flags and functions from the semantic model</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14318">#14318</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-11-13 12:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-13 12:55</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>I noticed while reviewing https://github.com/astral-sh/ruff/pull/14311 that some of the functions publicly exposed by the semantic model are never used anywhere, and some of the semantic-model flags set by the AST visitor but never read.</p>
<p>I'm not sure if this PR is really a good idea or not... some of these flags and functions are not used right now, but there's a chance we might use them in the future? Not sure.</p>
<p>I feel most confident about the changes in <code>crates/ruff_python_semantic/src/reference.rs</code>, <code>crates/ruff_linter/src/rules/flake8_type_checking/helpers.rs</code> and <code>crates/ruff_linter/src/rules/pylint/rules/import_private_name.rs</code>, since the <code>ResolvedReference</code> struct already only exposes a subset of the interface exposed by the <code>SemanticModel</code>. It doesn't seem like we're trying with that struct to publicly expose information regarding all flags the <code>SemanticModel</code> stores internally.</p>
<h2>Test Plan</h2>
<ul>
<li><code>cargo test -p ruff_linter</code></li>
<li><code>cargo test -p ruff_python_semantic</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @AlexWaygood on 2024-11-13 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">linter</span> added by @AlexWaygood on 2024-11-13 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-13 13:09</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/helpers.rs</code>:27 on 2024-11-13 16:42</div>
            <div class="timeline-body"><p>What's the reason for removing <code>in_complex_string_type_definition</code>. Is it because the flag was never set? Or is it because you merged the simple and complex flags?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-13 16:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-11-13 16:51</div>
            <div class="timeline-body"><p>I find this PR somewhat difficult to review because it scrambles together multiple changes that have very little in common, other than that they unused.</p>
<p>I don't mind approving because I'm in favor of removing unused methods together with unnecessarily tracked data (but we shouldn't remove the methods but still keep tracking the data). However, I don't feel like I can give you a proper review without some added explanation or splitting the change into a smaller PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-11-13 17:15</div>
            <div class="timeline-body"><p>This is good IMO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-13 17:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_semantic/src/model.rs</code>:1756 on 2024-11-13 17:17</div>
            <div class="timeline-body"><p>I think we should leave this as-is for any flags that still exist. It's nice to have a consistent interface even if unused. (But of course we can remove for any flags that we've removed.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-13 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_python_semantic/src/model.rs</code>:2231 on 2024-11-13 17:20</div>
            <div class="timeline-body"><p>I think we should leave this, actually. It was added in https://github.com/astral-sh/ruff/pull/11315 though I don't think it was &quot;finished&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-13 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/helpers.rs</code>:27 on 2024-11-13 17:20</div>
            <div class="timeline-body"><p>I removed the <code>ResolvedReference:in_simple_string_type_definition()</code> and <code>ResolvedReference::in_complex_string_type_definition()</code> methods in favour of a single <code>ResolvedReference::in_string_type_definition()</code> method. None of our rules need to distinguish (at least not currently) between resolved read references that occur within string type definitions that use concatenated strings and resolved read references that occur within string type definitions that do not use concatenated strings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-13 17:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/checkers/ast/mod.rs</code>:1797 on 2024-11-13 17:21</div>
            <div class="timeline-body"><p>Good to remove, looks like we got rid of this <code>BindingKind</code> at some point: https://github.com/astral-sh/ruff/pull/9967</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_semantic/src/model.rs</code>:2231 on 2024-11-13 17:22</div>
            <div class="timeline-body"><p>Oh, good point -- https://github.com/astral-sh/ruff/issues/10347 is still open</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-13 17:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-13 17:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/helpers.rs</code>:27 on 2024-11-13 17:23</div>
            <div class="timeline-body"><p>Yeah this seems ok. It looks like <code>in_complex_string_type_definition</code> on <code>SemanticModel</code> remains and <em>is</em> necessary though, is that right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-13 17:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/flake8_type_checking/helpers.rs</code>:27 on 2024-11-13 17:23</div>
            <div class="timeline-body"><blockquote>
<p>It looks like <code>in_complex_string_type_definition</code> on <code>SemanticModel</code> remains and <em>is</em> necessary though, is that right?</p>
</blockquote>
<p>correct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-13 17:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_semantic/src/model.rs</code>:2231 on 2024-11-13 17:31</div>
            <div class="timeline-body"><p>added it back</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-13 17:32</div>
            <div class="timeline-body"><p>thanks @charliermarsh!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-11-13 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-11-13 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-13 17:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:51:28 UTC
    </footer>
</body>
</html>
