<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Sync vendored typeshed stubs - astral-sh/ruff #20083</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Sync vendored typeshed stubs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20083">#20083</a>
        opened by <a href="https://github.com/github-actions">@github-actions</a>
        on 2025-08-25 16:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/github-actions">@github-actions</a></div>
            <div class="timeline-body"><p>Close and reopen this PR to trigger CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-25 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:22</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-08-25 16:59:43.673986846 +0000
+++ new-output.txt	2025-08-25 16:59:46.223021395 +0000
@@ -1,5 +1,5 @@
 WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(bcb1)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(b8e9)): execute: too many cycle iterations`
 _directives_deprecated_library.py:15:31: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 _directives_deprecated_library.py:30:26: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:11763 on 2025-08-25 16:35</div>
            <div class="timeline-body"><p>not sure how stable the ID is here -- would it be better to do some fuzzy matching?</p>
<p>The assertion on <code>main</code> no longer passes because I had to add some more cycle handling in <a href="https://github.com/astral-sh/ruff/pull/20083/commits/dc095c125929e1f5b7d6d9c32d5efba315cf3214">this commit</a> to cope with typeshed&#x27;s latest changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-25 16:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 16:37</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ‚úÖ
No memory usage changes detected ‚úÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:11763 on 2025-08-25 16:42</div>
            <div class="timeline-body"><p>More stable than some, because <code>module_type_symbols</code> has no arguments, so there&#x27;s only ever one instance of that query (thus the <code>00</code> part -- there&#x27;ll never be a <code>01</code> etc). But still not very stable, because adding a new query in ty could easily change the <code>50</code> part anytime.</p>
<p>I think the best solution here would be to first (with the same db) check some other innocuous file that triggers execution of <code>module_type_symbols</code>, then clear salsa events and check <code>a.py</code>. Then in the checking of <code>a.py</code> we should already have a cached value for <code>module_type_symbols</code>, so it won&#x27;t iterate a cycle. (There should also of course be a comment explaining why we&#x27;re doing this.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-08-25 16:44</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/typeshedbot%2Fsync-typeshed?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #20083 will <strong>degrade performances by 9.58%</strong>
<p>Comparing <code>typeshedbot/sync-typeshed</code> (cc46a24) with <code>main</code> (db423ee)</p>
Summary
<p><code>‚ùå 1 (üëÅ 1)</code> regressions<br>
<code>‚úÖ 41</code> untouched benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| üëÅ | <code>ty_micro[many_tuple_assignments]</code> | 57.2 ms | 63.2 ms | -9.58% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-08-25 16:46</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-25 16:50</div>
            <div class="timeline-body"><blockquote>
<p>Merging #20083 will <strong>degrade performances by 9.58%</strong></p>
</blockquote>
<p>...I thought that might happen if I added cycle handling to <code>module_type_symbols</code> üôÉ</p>
<p>The good news is that the regression only appears to be <em>severe</em> on our microbenchmarks. The real-world projects are only showing slowdowns of &lt;=1% on our instrumented benchmarks, and some of the walltime benchmarks are even showing a tiny speedup (though I expect that&#x27;s just noise). So this may just be something we have to live with, due to the new cycle between <code>types.pyi</code> and <code>typing_extensions.pyi</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-25 16:53</div>
            <div class="timeline-body"><p>The walltime results make me feel pretty OK about this not being an issue in real usage; the cycle should only ever occur once. It still might make a big difference for a very small benchmark, but it&#x27;s not a cost that will scale with large projects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-25 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-25 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-25 17:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:02 UTC
    </footer>
</body>
</html>
