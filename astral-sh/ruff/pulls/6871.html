<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add prototype of `ruff format` for projects - astral-sh/ruff #6871</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add prototype of <code>ruff format</code> for projects</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6871">#6871</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-08-25 11:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-08-25 11:59</div>
            <div class="timeline-body"><p><strong>Summary</strong> Add recursive formatting based on <code>ruff check</code> file discovery for <code>ruff format</code>, as a prototype for the formatter alpha. This allows e.g. <code>format ../projects/django/</code>. It's still lacking support for any settings except line length.</p>
<p>Note just like the existing <code>ruff format</code> this will become part of the production build, i.e. you'll be able to use it - hidden by default and with a prominent warning - with <code>ruff format .</code> after the next release.</p>
<p>Error handling works in my manual tests (the colors do also work):</p>
<pre><code>$  target/debug/ruff format scripts/
warning: `ruff format` is a work-in-progress, subject to change at any time, and intended for internal use only.
</code></pre>
<p>(the above changes <code>add_rule.py</code> where we have the wrong bin op breaking)</p>
<pre><code>$ target/debug/ruff format ../projects/django/
warning: `ruff format` is a work-in-progress, subject to change at any time, and intended for internal use only.
Failed to format /home/konsti/projects/django/tests/test_runner_apps/tagged/tests_syntax_error.py: source contains syntax errors: ParseError { error: UnrecognizedToken(Name { name: &quot;syntax_error&quot; }, None), offset: 131, source_path: &quot;&lt;filename&gt;&quot; }
</code></pre>
<pre><code>$ target/debug/ruff format a
warning: `ruff format` is a work-in-progress, subject to change at any time, and intended for internal use only.
Failed to read /home/konsti/ruff/a/d.py: Permission denied (os error 13)
</code></pre>
<p><strong>Test Plan</strong> Missing! I'm not sure if it's worth building tests at this stage or how they should look like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-08-25 11:59</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #6871</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6871" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ<ul>
<li><strong>PR #6873</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6873" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6871?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-08-25 12:15</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 13:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:59 on 2023-08-25 13:33</div>
            <div class="timeline-body"><p>Fixed by #6873</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:94 on 2023-08-25 13:34</div>
            <div class="timeline-body"><p>we get tracing :) it's not configured though so it does nothing here yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 13:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/lib.rs</code>:177 on 2023-08-25 13:35</div>
            <div class="timeline-body"><p>i'd only do this after we know how the cli will look like</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 13:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/lib.rs</code>:104 on 2023-08-25 13:35</div>
            <div class="timeline-body"><p>these were redundant since the debug representation prints the kind anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-25 13:38</div>
            <div class="timeline-body"><p>Just chatted with @konstin - I'll review this today and then take over getting it merged while he's out next week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-08-25 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:44 on 2023-08-25 13:41</div>
            <div class="timeline-body"><p>I would suggest omitting this, and then in the <code>map</code> below, can we use <code>PySourceType::from(path)</code> and only run on Python files?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-25 13:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-25 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:82 on 2023-08-25 13:42</div>
            <div class="timeline-body"><p>Can we do this more like in <code>run</code> where the error handling is inside the <code>map</code> above?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-08-25 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_cli/src/lib.rs</code>:177 on 2023-08-25 13:42</div>
            <div class="timeline-body"><p>I think for the alpha it could be worth supporting <code>--verbose</code>, <code>--dry-run</code>, and <code>--stdin-filename</code> (for the LSP). What do you think? Yes no? Anything else?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:44 on 2023-08-25 15:03</div>
            <div class="timeline-body"><p><code>PySourceType</code> doesn't handle toml so it's now a strange mixture</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 15:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-08-25 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-08-25 15:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/src/commands/format.rs</code>:82 on 2023-08-25 15:15</div>
            <div class="timeline-body"><p>moved it into the map, i hope that's what you were aiming for</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @konstin on 2023-08-25 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-27 18:55</div>
            <div class="timeline-body"><p>Gonna merge this, and then make a few small follow-up changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-08-27 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-27 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-08-27 19:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:46:15 UTC
    </footer>
</body>
</html>
