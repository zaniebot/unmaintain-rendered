```yaml
number: 7542
title: "Extract `ResolverSettings`"
type: pull_request
state: merged
author: MichaReiser
labels:
  - internal
assignees: []
merged: true
base: main
head: resolver-settings
created_at: 2023-09-20T12:23:04Z
updated_at: 2023-09-20T16:04:54Z
url: https://github.com/astral-sh/ruff/pull/7542
synced_at: 2026-01-12T02:39:10Z
```

# Extract `ResolverSettings`

---

_Pull request opened by @MichaReiser on 2023-09-20 12:23_

## Stack Summary

This stack splits `Settings` into `FormatterSettings` and `LinterSettings` and moves it into `ruff_workspace`. This change is necessary to add the `FormatterSettings` to `Settings` without adding `ruff_python_formatter` as a dependency to `ruff_linter` (and the linter should not contain the formatter settings). 

A quick overview of our settings struct at play:

* `Options`: 1:1 representation of the options in the `pyproject.toml` or `ruff.toml`.  Used for deserialization.
* `Configuration`: Resolved `Options`, potentially merged from multiple configurations (when using `extend`). The representation is very close if not identical to the `Options`.
* `Settings`: The resolved configuration that uses a data format optimized for reading. Optional fields are initialized with their default values. Initialized by `Configuration::into_settings` .

The goal of this stack is to split `Settings` into tool-specific resolved `Settings` that are independent of each other. This comes at the advantage that the individual crates don't need to know anything about the other tools. The downside is that information gets duplicated between `Settings`. Right now the duplication is minimal (`line-length`, `tab-width`) but we may need to come up with a solution if more expensive data needs sharing.

This stack focuses on `Settings`. Splitting `Configuration` into some smaller structs is something I'll follow up on later. 

## PR Summary

This PR extracts a `ResolverSettings` struct that holds all the resolver-relevant fields (uninteresting for the `Formatter` or `Linter`). This will allow us to move the `ResolverSettings` out of `ruff_linter` further up in the stack.


## Test Plan

`cargo test`

(I'll to more extensive testing at the top of this stack)


---

_Comment by @MichaReiser on 2023-09-20 12:23_

Current dependencies on/for this PR:
* main
  * **PR #7532** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7532" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7542** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7542" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
      * **PR #7543** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7543" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #7544** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7544" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
          * **PR #7545** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7545" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
            * **PR #7548** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7548" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
              * **PR #7549** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7549" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7536** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7536" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7542?utm_source=stack-comment).

---

_Comment by @github-actions[bot] on 2023-09-20 12:43_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Review requested from @charliermarsh by @MichaReiser on 2023-09-20 12:56_

---

_Label `internal` added by @MichaReiser on 2023-09-20 12:56_

---

_Marked ready for review by @MichaReiser on 2023-09-20 12:56_

---

_Review comment by @charliermarsh on `crates/ruff_linter/src/settings/mod.rs`:86 on 2023-09-20 13:08_

Should this be like... `FileResolverSettings`? Based on this name, I initially thought these might be the import / package / module resolver settings, like `src`. Don't feel strongly though, defer to you.

---

_@charliermarsh approved on 2023-09-20 13:09_

This is great.

---

_@MichaReiser reviewed on 2023-09-20 13:23_

---

_Review comment by @MichaReiser on `crates/ruff_linter/src/settings/mod.rs`:86 on 2023-09-20 13:23_

Makes sense. I haven't thought about it much. I just saw the `// Resolver settings` comment somewhere and went with that name.

---

_Renamed from "Extract resolver settings" to "Extract `ResolverSettings`" by @MichaReiser on 2023-09-20 14:00_

---

_Merged by @MichaReiser on 2023-09-20 14:37_

---

_Closed by @MichaReiser on 2023-09-20 14:37_

---

_Branch deleted on 2023-09-20 14:37_

---

_Comment by @MichaReiser on 2023-09-20 14:37_

### Merge Activity

* **Sep 20, 10:37 AM**: @MichaReiser merged this pull request with [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7542).


---
