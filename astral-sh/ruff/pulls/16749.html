<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] add support for `--output-format={full,concise}` - astral-sh/ruff #16749</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] add support for <code>--output-format={full,concise}</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16749">#16749</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-03-14 15:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This does pretty much what it says on the tin.</p>
<p>The concise format used in this PR was partially resurrected from
the diagnostic rendering used before #15856 landed. Specifically,
the concise format guarantees that every diagnostic uses exactly one
line of output. (This guarantee isn&#x27;t technically enforced in every
conceivable way. For example, there&#x27;s nothing stopping a diagnostic
message from containing multiple lines, but this seems like a bad idea
in general anyway.)</p>
<p>The motivation for this functionality is to provide a way to get
succinct diagnostics for whenever that is useful. For <a href="https://github.com/astral-sh/ruff/issues/15697#issuecomment-2706477278">example</a>.</p>
<p>Many thanks to @MichaReiser for giving me the play-by-play on
how to plumb a new CLI option. Saved me a lot of time. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-14 15:14</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-03-14 15:18</div>
            <div class="timeline-body"><p>This works great, thank you. One minor thing I noticed is that VS code has problems detecting the <code>path/to/file.py:&lt;row&gt;:&lt;column&gt;</code> pattern (for ctrl+click from the terminal). That seems to be caused by the colons right in front of and right behind the path/row/column triple:</p>
<pre><code>warning[lint:unresolved-reference]:/home/shark/black/black/src/black/linegen.py:1284:19:Name `current_line` used when not defined
</code></pre>
<p>If we would split on a different character, that might work better? (I only tried space)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:21</div>
            <div class="timeline-body"><p>I was unwise to not remember the lesson of Chesterton&#x27;s fence. So that&#x27;s why the original output used spaces. I replaced spaces with colons thinking it looked nicer and was more consistent with a grep-like format.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-14 15:23</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:26</div>
            <div class="timeline-body"><p>@sharkdp All righty, that should be fixed now, by using spaces.</p>
<p>(An alternative would be to use hyperlinks. Then we could use whatever <em>visual</em> format we wanted while retaining conveniences like VS Code handling it correctly. But IDK if that&#x27;s worth it and I think out of scope for this PR.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/src/args.rs</code>:230 on 2025-03-14 15:29</div>
            <div class="timeline-body"><p>I&#x27;d remove the mention of <code>color</code>. We&#x27;ll use a separate flag <code>color</code> (auto, always, never) to control the color behavior</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/old.rs</code>:87 on 2025-03-14 15:31</div>
            <div class="timeline-body"><p>Not related to this PR, just something I noted and I probably never mentioned before. We should print paths that are relative to <code>db.system().current_directory()</code> (or <code>db.project().root()</code> but I think current directory is more correct)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/tests/cli.rs</code>:985 on 2025-03-14 15:33</div>
            <div class="timeline-body"><p>Nit: Should we use a colon between the path and the message?</p>
<pre><code>    error[lint:non-subscriptable] &lt;temp_dir&gt;/test.py:3:7: Cannot subscript object of type `Literal[4]` with no `__getitem__` method
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-03-14 15:33</div>
            <div class="timeline-body"><p>Nice. This is great.</p>
<p>I&#x27;d recommend removing the mentions of <code>color</code> from <code>OutputFormat</code>. The plan is to add a <code>color</code> option to <code>TerminalOptions</code> that controls coloring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-14 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-14 15:37</div>
            <div class="timeline-body"><blockquote>
<p>So that&#x27;s why the original output used spaces. I replaced spaces with colons thinking it looked nicer and was more consistent with a grep-like format.</p>
</blockquote>
<p>I sympathize with the grep-ability/good-CLI-citizen argument, but <code>:</code> is probably not ideal there anyway since we also use colons for the <code>lint:unresolved-reference</code> split, so if you would e.g. use <code>cut -d&#x27;:&#x27; -f…</code>, the first field would be <code>warning[lint</code>.</p>
<p>In terms of human readability, I&#x27;m not sure I agree colons-everywhere looks nicer :smile:.</p>
<blockquote>
<p>(An alternative would be to use hyperlinks. Then we could use whatever <em>visual</em> format we wanted while retaining conveniences like VS Code handling it correctly. But IDK if that&#x27;s worth it and I think out of scope for this PR.)</p>
</blockquote>
<p>Yes :+1:. Unfortunately, I think it&#x27;s hard to get <code>file://</code> links working cross-tool correctly (I think you are aware, I vaguely remember following some discussion on the ripgrep issue tracker). So then you also need a way for users to customize those OSC 8 links to e.g. <code>vscode://</code> or similar, and at that point it seems easier to just use a different separation character, I think.</p>
<p>But hyperlinks are still an interesting idea for our diagnostics in general, I believe. For example, we could make the line numbers in a multi-line diagnostic message hyperlinks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-03-14 15:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/red_knot/tests/cli.rs</code>:985 on 2025-03-14 15:49</div>
            <div class="timeline-body"><p>I don&#x27;t think that&#x27;s what was there before: <a href="https://github.com/astral-sh/ruff/pull/15856">astral-sh/ruff#15856</a>/files#diff-dbafb0caf34282c9452acb4c5f0cd3b5c3e6f0070a66069e5762046142d7879bL235</p>
<p>I&#x27;m not sure if adding it will break links? I&#x27;m also not sure I like the way it looks. :P</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 15:51</div>
            <div class="timeline-body"><p>Yeah terminal hyperlinks are minefield of terrors. But users love them. And yes, I did indeed go through that process with ripgrep, and actually, I haven&#x27;t had many complaints or bug reports. So either I got it right, or nobody is using them haha. So if we do want to do hyperlinks for diagnostics, I do at least have some helpful domain knowledge there.</p>
<p>(But you&#x27;re absolutely right that the specific hyperlink format needs to be configurable in some way, and I don&#x27;t think there is any standard way of auto-detecting it. So it&#x27;s kind of a huge bummer.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-03-14 15:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/red_knot/src/args.rs</code>:230 on 2025-03-14 15:52</div>
            <div class="timeline-body"><p>Fair enough, done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-14 15:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot/tests/cli.rs</code>:985 on 2025-03-14 15:52</div>
            <div class="timeline-body"><p>I guess my main feedback is: I find it hard to see where the message starts.</p>
<p>This is what ruff uses today</p>
<pre><code>crates/ruff_python_resolver/resources/test/airflow/airflow/api/common/mark_tasks.py:1:1: I002 [*] Missing required import: `from __future__ import annotations`
</code></pre>
<p>The colon after the line number doesn&#x27;t seem to break VS code</p>
<p>I won&#x27;t argue with preferences and I&#x27;m also fine iterating on this later ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-03-14 15:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_db/src/diagnostic/old.rs</code>:87 on 2025-03-14 15:52</div>
            <div class="timeline-body"><p>Just to be clear, what I have here is fine for now and you&#x27;re noting something for the future?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-03-14 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_db/src/diagnostic/old.rs</code>:87 on 2025-03-14 15:54</div>
            <div class="timeline-body"><p>Yes. What you have is fine. We&#x27;ll have to change this for both output formats. Sorry for not stating this more clearly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-03-14 18:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/red_knot/tests/cli.rs</code>:985 on 2025-03-14 18:31</div>
            <div class="timeline-body"><p>I don&#x27;t have a strong preference. My main concern was definitely about breaking VS Code clicking.</p>
<p>Since it doesn&#x27;t break thing, my main concern is resolved. So I added in the <code>:</code> here. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 18:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-03-14 18:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-14 18:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:21 UTC
    </footer>
</body>
</html>
