<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactor `StmtIf`: Linter - astral-sh/ruff #5460</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Refactor <code>StmtIf</code>: Linter</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5460">#5460</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-07-01 20:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/ruff/pull/5458 for detailed information</p>
<p>I've tried to split this into commits for individual rules as much as feasible and left a bunch of TODO where i'm not sure about the rules</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-01 20:24</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #5459</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5459" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #5460</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5460" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5460?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2023-07-01 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-01 20:53</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.01     10.5Â±0.24ms     3.9 MB/sec    1.00     10.4Â±0.25ms     3.9 MB/sec
formatter/numpy/ctypeslib.py               1.06      2.4Â±0.09ms     7.0 MB/sec    1.00      2.3Â±0.06ms     7.4 MB/sec
formatter/numpy/globals.py                 1.06   272.8Â±12.71Âµs    10.8 MB/sec    1.00   258.5Â±10.26Âµs    11.4 MB/sec
formatter/pydantic/types.py                1.02      5.2Â±0.19ms     4.9 MB/sec    1.00      5.1Â±0.17ms     5.0 MB/sec
linter/all-rules/large/dataset.py          1.02     18.8Â±0.46ms     2.2 MB/sec    1.00     18.5Â±0.62ms     2.2 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.4Â±0.22ms     3.8 MB/sec    1.02      4.5Â±0.12ms     3.7 MB/sec
linter/all-rules/numpy/globals.py          1.00   559.3Â±20.78Âµs     5.3 MB/sec    1.04   579.0Â±28.10Âµs     5.1 MB/sec
linter/all-rules/pydantic/types.py         1.01      8.2Â±0.24ms     3.1 MB/sec    1.00      8.1Â±0.22ms     3.1 MB/sec
linter/default-rules/large/dataset.py      1.00      8.8Â±0.26ms     4.6 MB/sec    1.01      8.9Â±0.18ms     4.6 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1905.6Â±43.60Âµs     8.7 MB/sec    1.01  1916.1Â±61.57Âµs     8.7 MB/sec
linter/default-rules/numpy/globals.py      1.03   230.5Â±20.45Âµs    12.8 MB/sec    1.00   224.8Â±10.64Âµs    13.1 MB/sec
linter/default-rules/pydantic/types.py     1.02      4.1Â±0.23ms     6.2 MB/sec    1.00      4.0Â±0.12ms     6.3 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.02      9.5Â±0.10ms     4.3 MB/sec    1.00      9.3Â±0.08ms     4.4 MB/sec
formatter/numpy/ctypeslib.py               1.06      2.1Â±0.04ms     7.9 MB/sec    1.00  1995.6Â±37.84Âµs     8.3 MB/sec
formatter/numpy/globals.py                 1.04    229.7Â±4.11Âµs    12.8 MB/sec    1.00   221.4Â±14.35Âµs    13.3 MB/sec
formatter/pydantic/types.py                1.05      4.7Â±0.08ms     5.4 MB/sec    1.00      4.5Â±0.14ms     5.6 MB/sec
linter/all-rules/large/dataset.py          1.00     15.7Â±0.12ms     2.6 MB/sec    1.01     15.9Â±0.17ms     2.6 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.2Â±0.03ms     4.0 MB/sec    1.00      4.1Â±0.05ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00    434.3Â±9.61Âµs     6.8 MB/sec    1.00    433.7Â±9.81Âµs     6.8 MB/sec
linter/all-rules/pydantic/types.py         1.03      7.2Â±0.07ms     3.6 MB/sec    1.00      7.0Â±0.06ms     3.7 MB/sec
linter/default-rules/large/dataset.py      1.00      8.1Â±0.04ms     5.0 MB/sec    1.01      8.2Â±0.09ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1673.6Â±18.27Âµs     9.9 MB/sec    1.00  1672.1Â±21.69Âµs    10.0 MB/sec
linter/default-rules/numpy/globals.py      1.00    181.9Â±3.30Âµs    16.2 MB/sec    1.00    181.5Â±2.85Âµs    16.3 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6Â±0.04ms     7.0 MB/sec    1.01      3.7Â±0.03ms     6.9 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:1313 on 2023-07-03 06:41</div>
            <div class="timeline-body"><p>Nit: We now also have the option to pass the whole if statement by binding it on line 1298 (<code>if_stmt @ ast::StmtIf {...}</code>). But I can see how this was the more lightweight refactor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:2032 on 2023-07-03 06:46</div>
            <div class="timeline-body"><p>Our current visitor has a <code>visit_*</code> method for every node type (or the union the node type belongs). That's why I think we should instead, for consistency, add a <code>visit_elif_else_clause</code> to visitor and (pre-order visitor) and call that function here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_bugbear/rules/reuse_of_groupby_generator.rs</code>:153 on 2023-07-03 06:50</div>
            <div class="timeline-body"><p>Nit: We can avoid the <code>unwrap</code> call here. I find this easier to read because I don't have to reason about why <code>unwrap</code> is safe</p>
<pre><code class="language-suggestion">				let mut if_stack = Vec::with_capacity(1 + elif_else_clauses.len());
                // Initialize the vector with the count for the if branch.
				if_stack.push(0);
                self.counter_stack.push(if_stack);
</code></pre>
<p>Would it even be safe to use the <code>if_stack</code> on lines 157..171 instead of calling <code>self.counter_stack.last_mut</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_bugbear/rules/reuse_of_groupby_generator.rs</code>:162 on 2023-07-03 06:51</div>
            <div class="timeline-body"><pre><code class="language-suggestion">					self.visit_elif_else_clause(&amp;clause)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_return/visitor.rs</code>:135 on 2023-07-03 06:58</div>
            <div class="timeline-body"><p>Isn't this always <code>false</code> for <code>if</code> statements since we no longer represent <code>elif</code>s as <code>body: [if_stmt]</code> but instead as an <code>ElifElseClause</code> (meaning, an <code>IfStmt</code> can never be an elif`)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:309 on 2023-07-03 06:59</div>
            <div class="timeline-body"><p>Nit: I prefer <code>nested_if_statements</code> over <code>is_*</code> because the function returns the nested if statement and not a boolean.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:312 on 2023-07-03 07:00</div>
            <div class="timeline-body"><p>Nit: Pass the whole <code>if_stmt</code></p>
<pre><code class="language-suggestion">    if_stmt: &amp;StmtIf,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/fix_if.rs</code>:36 on 2023-07-03 07:04</div>
            <div class="timeline-body"><p>Nit: Can we use a more specific name than <code>range</code>. What range do I need to pass here? Is any range fine or does it have to be a statement range? I personally prefer passing a <code>Stmt</code> if we have it at hand because it is more explicit about what we're expecting here, even if we don't use all its fields.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/fix_if.rs</code>:48 on 2023-07-03 07:05</div>
            <div class="timeline-body"><p>Why is it no longer necessary to remove the <code>whitespace</code>? <code>lines</code> returns the text from the beginning to the end of the line(s), including indentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/isort/block.rs</code>:241 on 2023-07-03 07:10</div>
            <div class="timeline-body"><p>Nit: <code>walk_elif_else_clause(self, clause)</code> and override <code>visit_elif_else_clause</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/collapsible_else_if.rs</code>:56 on 2023-07-03 07:15</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    let [ElifElseClause { body, test: None, ..}] = elif_else_clauses else {
        return None;
    };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/collapsible_else_if.rs</code>:57 on 2023-07-03 07:16</div>
            <div class="timeline-body"><p>Unrelated to this PR: It would probably be good to highlight the test-condition range instead of the whole if statement</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/too_many_branches.rs</code>:208 on 2023-07-03 07:19</div>
            <div class="timeline-body"><p>4 seems to be correct at first look but I think the reasoning is:</p>
<ul>
<li><code>if</code></li>
<li><code>if -&gt; else -&gt; if</code></li>
<li><code>if -&gt; else -&gt; else</code></li>
</ul>
<p>Which is also the reason why you can collapse this into an <code>if .. elif... else</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pylint/rules/too_many_statements.rs</code>:210 on 2023-07-03 07:23</div>
            <div class="timeline-body"><p>CC: @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:133 on 2023-07-03 07:24</div>
            <div class="timeline-body"><p>Is the <code>BranchKind</code> necessary here, considering that only an <code>if</code> statement can have <code>elif_else_clauses</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:146 on 2023-07-03 07:27</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            Some(ElifElseClause { test: Some(_), range, .. }) =&gt; {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:146 on 2023-07-03 07:28</div>
            <div class="timeline-body"><p>Nit: It could make sense to add <code>is_elif</code> and <code>is_else</code> on <code>ElifElseClause</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:155 on 2023-07-03 07:29</div>
            <div class="timeline-body"><p>Nit: If you want to be explicit about it and not rely the preceding match patterns</p>
<pre><code class="language-suggestion">            Some(ElifElseClause { body, test: None.. }) =&gt; {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:134 on 2023-07-03 07:30</div>
            <div class="timeline-body"><p>Nit: Can we use a more explicit name than <code>range</code>. What kind of range is it. Is it the range of the <code>stmt</code> (if so, use stmt.range). If it is either the <code>If</code> or <code>ElifElseClause</code> range, maybe add it to <code>BranchKind</code> or change <code>BranchKind</code> to <code>Branch</code> which stores a reference to either the <code>IfStmt</code> or <code>ElifElseClause</code>. This would also remove the need for the 4 value tuple in <code>outdated_version_block</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:132 on 2023-07-03 07:35</div>
            <div class="timeline-body"><p>Nit: Pass the whole <code>if_stmt</code> instead of the individual fields. I think it would have helped me understand the logic easier because I assumed that there's a relation between the <code>elif_else_clause</code> and the <code>branch_kind</code> which isn't the case. It may even make sense to change the ordering of the arguments: The most important argument is the <code>BranchKind</code> with the <code>range</code>, because that's what the method operates on. All other arguments are only necessary to get the job done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:285 on 2023-07-03 07:35</div>
            <div class="timeline-body"><p>Nit: Pass the whole if statement instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:304 on 2023-07-03 07:37</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            continue;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/tryceratops/rules/type_check_without_type_error.rs</code>:172 on 2023-07-03 07:38</div>
            <div class="timeline-body"><p>Nit: Pass the whole if_statement instead of the individual fields (fewer arguments, less data to be copied)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:297 on 2023-07-03 07:49</div>
            <div class="timeline-body"><p>GitHub doesn't allow me to comment on the correct line. The documentation confuses me. It mention that it returns the <strong>first</strong> statement but it returns <code>inner_body.last()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:360 on 2023-07-03 07:53</div>
            <div class="timeline-body"><p>Nit: Pass the whole <code>if_stmt</code> instead of the individual fields (results in passing a single 8 byte reference instead of four 8 byte references)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:310 on 2023-07-03 07:57</div>
            <div class="timeline-body"><p>Nit: Make the function private</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:319 on 2023-07-03 07:59</div>
            <div class="timeline-body"><p>It seems that being able to either refer to th <code>If</code> statement or the <code>Elif</code> clause is a recurring pattern. Consider introducing a union in <code>ruff_python_ast</code> that represents either (implements <code>Ranged</code>, <code>From&lt;&amp;StmtIf&gt;</code>, <code>From&lt;&amp;ElifElseClause&gt;</code>, provides methods to get the <code>condition</code> and the <code>body</code>, etc.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:391 on 2023-07-03 08:01</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        colon.map_or(
            || range,
            |colon| TextRange::new(range.start(), colon.end()),
        ),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:567 on 2023-07-03 08:05</div>
            <div class="timeline-body"><p>Nit: I think @charliermarsh started to move <code>semantic</code> to the back because it is only an <em>auxilary</em> argument, necessary to perform the job. The important arguments that this function is operating on are the <code>expr</code> and the <code>targets</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:691 on 2023-07-03 08:07</div>
            <div class="timeline-body"><p>Nit</p>
<pre><code class="language-suggestion">                .filter_map(|clause| clause.test.is_some().then_some(clause.start(), clause.body.as_slice()))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:693 on 2023-07-03 08:10</div>
            <div class="timeline-body"><p>Using <code>peekable</code> here is probably more expensive (next takes the value from peek in every iteration, just so that we can write it in the immediately followed peek) than keeping track of the last branch in a stack variable</p>
<pre><code>let mut Some(last) = branches_iter.next() else {
    return;
}

for (current_start, current_body) in branches_iter {
    ...
    
    last = (current_start, current_body);
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:721 on 2023-07-03 08:12</div>
            <div class="timeline-body"><p>You can add a helper method to <code>CommentRanges</code> that performs a binary search using the start position, then checks if the range is included)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:732 on 2023-07-03 08:13</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    if_stmt: &amp;StmtIf,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:778 on 2023-07-03 08:15</div>
            <div class="timeline-body"><p>Nit: I don't know how expensive the <code>contains_effect</code> and <code>is_builtin</code> calls are but it could make sense to make this the very last check (testing if it is an elif or comparing the <code>id</code> and ops are relatively cheap)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:819 on 2023-07-03 08:15</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    if_stmt: &amp;StmtIf,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-03 08:16</div>
            <div class="timeline-body"><p>This is awesome. So many TODOs and manual string inspections that are just gone :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 10:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/checkers/ast/mod.rs</code>:1313 on 2023-07-03 10:47</div>
            <div class="timeline-body"><p>much cleaner, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_bugbear/rules/reuse_of_groupby_generator.rs</code>:153 on 2023-07-03 11:03</div>
            <div class="timeline-body"><p>i don't think so, but i wouldn't want to refactor that in this Pr anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 11:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_return/visitor.rs</code>:135 on 2023-07-03 11:58</div>
            <div class="timeline-body"><p>it's not the same but it removes a false negative, so i take it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 11:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 11:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:309 on 2023-07-03 11:59</div>
            <div class="timeline-body"><p><code>nested_if_body</code>, since <code>nested_if_statements</code> is the name of rule already</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/fix_if.rs</code>:48 on 2023-07-03 12:02</div>
            <div class="timeline-body"><p>we have the correct range starting with the <code>elif</code> token now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pylint/rules/collapsible_else_if.rs</code>:57 on 2023-07-03 12:05</div>
            <div class="timeline-body"><p>i forward this question to charlie ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:133 on 2023-07-03 12:07</div>
            <div class="timeline-body"><p>the <code>elif_else_clauses</code> clauses are those of the entire <code>if</code> statement, we use them to find the start of the following branch in <code>BranchKind::Elif</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:133 on 2023-07-03 12:08</div>
            <div class="timeline-body"><p>i thought about making this a bool but kept it like the original implementation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:146 on 2023-07-03 12:09</div>
            <div class="timeline-body"><p>i though about adding more abstractions but the cases are to different and we're normally matching anyway to extract the fields</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/pyupgrade/rules/outdated_version_block.rs</code>:304 on 2023-07-03 12:12</div>
            <div class="timeline-body"><p>i've applied nightly rustfmt</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:297 on 2023-07-03 12:15</div>
            <div class="timeline-body"><p>good point, seems to have been wrong since the original PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:319 on 2023-07-03 12:21</div>
            <div class="timeline-body"><p>i though about it but the actual cases we have (yet) are too different to effectively unify them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:691 on 2023-07-03 12:26</div>
            <div class="timeline-body"><p>i find it easier to read the current way</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 12:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:693 on 2023-07-03 12:27</div>
            <div class="timeline-body"><p>don't we lose the first value in this model?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-03 14:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:693 on 2023-07-03 14:11</div>
            <div class="timeline-body"><p>We can track the next one too ;)</p>
<pre><code class="language-rust">let mut Some((first_start, first_body)) = branches_iter.next() else {
	return;
}

let mut next = branches_iter.next();

while let Some((second_start, second_body)) = next.take() {
	...
	
	(first_start, first_body) = (second_start, second_body);
	next = branches_iter.next()
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:693 on 2023-07-03 14:32</div>
            <div class="timeline-body"><p>but that would compile down to the same thing as the peekable, wouldn't it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-03 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-03 14:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/rules/flake8_simplify/rules/ast_if.rs</code>:693 on 2023-07-03 14:38</div>
            <div class="timeline-body"><p>That depends on whether the compiler can infer that the <code>peeked</code> field on the peekable iterator is always initialized when calling <code>Iterator</code> and, thus, can simplify</p>
<pre><code>   #[inline]
    fn next(&amp;mut self) -&gt; Option&lt;I::Item&gt; {
        match self.peeked.take() {
            Some(v) =&gt; v,
            None =&gt; self.iter.next(),
        }
    }
    ```

to a simple `self.peeked.take()`. It might, it might not. Anwyay, I should have marked this as a Nit. Keep it as you prefer, I don't expect it to change performance significantly (it's not a hot loop, the eliminated code is minimal)  
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-05 08:57</div>
            <div class="timeline-body"><p>I think i've handled all review comments now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-07-05 11:40</div>
            <div class="timeline-body"><p>@MichaReiser could you have a look at the unreachable code analysis? I failed to port the StmtIf logic and i think you're quicker than me with the block logic</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-05 13:34</div>
            <div class="timeline-body"><blockquote>
<p>@MichaReiser could you have a look at the unreachable code analysis? I failed to port the StmtIf logic and i think you're quicker than me with the block logic</p>
</blockquote>
<p>Done. The ordering of some blocks changed and the source span for <code>elif</code> branches now use the span of the enclosing <code>if</code>. I didn't spend much time trying to create the blocks in the exact same order as before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/resources/test/fixtures/pyupgrade/UP036_4.py</code>:10 on 2023-07-11 14:47</div>
            <div class="timeline-body"><p>Why this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/autofix/edits.rs</code>:198 on 2023-07-11 14:47</div>
            <div class="timeline-body"><p>Nit: extra newline here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/collapsible_else_if.rs</code>:57 on 2023-07-11 14:49</div>
            <div class="timeline-body"><p>I'm cool w/ that change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/too_many_statements.rs</code>:210 on 2023-07-11 14:52</div>
            <div class="timeline-body"><p>I'm guessing it thought this was equivalent to:</p>
<pre><code class="language-python">def f():
    if a:
        print()
    elif a:
        print()
</code></pre>
<p>Which it wanted to treat as equivalent to:</p>
<pre><code class="language-python">def f():
    if a:
        print()
    else:
        print()
</code></pre>
<p>I think 6 is better, feel free to remove this TODO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-07-11 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff/resources/test/fixtures/pyupgrade/UP036_4.py</code>:10 on 2023-07-11 14:56</div>
            <div class="timeline-body"><p>i had trouble telling apart the <code>pass</code> that were in the input and the <code>pass</code> that we insert for removing the last statement in body</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-11 14:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-07-11 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-07-11 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-07-11 14:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:58:29 UTC
    </footer>
</body>
</html>
