<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] handle unions on the LHS of is_subtype_of - astral-sh/ruff #13857</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] handle unions on the LHS of is_subtype_of</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13857">#13857</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2024-10-21 11:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Just a drive-by change that occurred to me while I was looking at <code>Type::is_subtype_of</code>: the existing pattern for unions on the <em>right hand side</em>:</p>
<pre><code class="language-rs">            (ty, Type::Union(union)) =&gt; union
                .elements(db)
                .iter()
                .any(|&amp;elem_ty| ty.is_subtype_of(db, elem_ty)),
</code></pre>
<p>is not (generally) correct if the <em>left hand side</em> is a union.</p>
<h2>Test Plan</h2>
<p>Added new test cases for <code>is_subtype_of</code> and <code>!is_subtype_of</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @sharkdp on 2024-10-21 11:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @sharkdp on 2024-10-21 11:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2024-10-21 11:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] handle unions on the LHS of is_subscript_of" to "[red-knot] handle unions on the LHS of is_subtype_of" by @sharkdp on 2024-10-21 11:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-10-21 12:10</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2024-10-21 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:1846 on 2024-10-21 14:29</div>
            <div class="timeline-body"><p>Unit tests for this are good, because this is a complex method, and it's good to have confidence that this specific part of the code is all working according to how we'd like it to work. I would like us to <em>also</em> add inference tests using mdtest where possible, though, so that if we do a large refactor in the future and remove this method (and the tests for the method) entirely we'll be able to have confidence that we still retain the more sophisticated understanding of subtyping that this PR gives us.</p>
<p>I can see that adding inference tests using mdtest might be tricky for this <em>specific</em> thing right now, though! So this is just a general point, not something that demands action on this PR specifically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-10-21 14:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2024-10-21 18:10</div>
            <div class="timeline-body"><p>Lovely, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2024-10-21 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2024-10-21 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-21 18:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:07:09 UTC
    </footer>
</body>
</html>
