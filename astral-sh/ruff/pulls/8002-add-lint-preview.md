```yaml
number: 8002
title: "Add `lint.preview`"
type: pull_request
state: merged
author: MichaReiser
labels:
  - configuration
  - cli
assignees: []
merged: true
base: main
head: lint-preview-option
created_at: 2023-10-17T06:48:32Z
updated_at: 2024-01-16T10:03:15Z
url: https://github.com/astral-sh/ruff/pull/8002
synced_at: 2026-01-12T15:55:25Z
```

# Add `lint.preview`

---

_@MichaReiser_

## Summary

This PR adds a new `lint.preview` option similar to `format.preview` that controls whether preview mode is enabled for the linter. 

Closes https://github.com/astral-sh/ruff/issues/7649

## Test Plan

I wrapped the `into_settings` of the formatter and linter in `dbg` expressions and verified that:

* `lint.preview = true` -> Preview mode is enabled for the linter only
* `format.preview = true` -> Preview mode is enabled for the formatter only
* `preview = true` -> Preview mode is enabled for both the linter and the formatter. 
* `--preview` overrides the `preview`, `lint.preview`, and `format.preview` option
* `preview = true` and `lint.preview = false` enables preview for the formatter only (same test for the linter)


---

_Comment by @MichaReiser on 2023-10-17 06:48_

Current dependencies on/for this PR:
* main
  * **PR #8000** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8000" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #8002** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8002" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
      * **PR #8032** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8032" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #8006** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8006" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #8035** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8035" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
          * **PR #8010** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8010" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
            * **PR #8082** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8082" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
              * **PR #8088** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8088" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
            * **PR #8039** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8039" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #8031** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/8031" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/8002?utm_source=stack-comment).

---

_Review requested from @zanieb by @MichaReiser on 2023-10-17 06:49_

---

_Label `configuration` added by @MichaReiser on 2023-10-17 06:50_

---

_Label `cli` added by @MichaReiser on 2023-10-17 06:50_

---

_Comment by @github-actions[bot] on 2023-10-17 07:04_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Comment by @konstin on 2023-10-17 09:37_

Is it intentional that we have `tool.ruff.format.preview` but no `ruff format --preview`? Otherwise i would implement the latter because i need it for the ecosystem check with preview style.

---

_@konstin approved on 2023-10-17 09:37_

---

_Comment by @MichaReiser on 2023-10-17 09:40_

> Is it intentional that we have `tool.ruff.format.preview` but no `ruff format --preview`? Otherwise i would implement the latter because i need it for the ecosystem check with preview style.

No. I can add it as part of this or another PR or you can add it. Let me know what you prefer

---

_Renamed from "Add `lint.preview` option" to "Add `lint.preview` and `format --preview` options" by @MichaReiser on 2023-10-17 10:20_

---

_Renamed from "Add `lint.preview` and `format --preview` options" to "Add `lint.preview`" by @MichaReiser on 2023-10-17 10:23_

---

_Comment by @MichaReiser on 2023-10-17 10:23_

> > Is it intentional that we have `tool.ruff.format.preview` but no `ruff format --preview`? Otherwise i would implement the latter because i need it for the ecosystem check with preview style.
> 
> No. I can add it as part of this or another PR or you can add it. Let me know what you prefer

Actually, the CLI options are already supported. It's just that they were hidden until now (because we didn't support any preview styles)

---

_Comment by @konstin on 2023-10-17 10:54_

> Actually, the CLI options are already supported. It's just that they were hidden until now (because we didn't support any preview styles)

:facepalm: should have checked, thanks

---

_Comment by @zanieb on 2023-10-17 13:46_

Can you update the docs in `preview.md` or would you prefer that I did?

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/args.rs`:402 on 2023-10-17 15:04_

I think the `--no-preview` variant should retain `hide = true`, like the other `--no-X` variants above.

---

_Review comment by @charliermarsh on `crates/ruff_cli/src/args.rs`:398 on 2023-10-17 15:06_

Perhaps: `/// Enable preview mode, to opt-in to unstable lint rules and formatting.`?

---

_@charliermarsh approved on 2023-10-17 15:07_

---

_@zanieb reviewed on 2023-10-17 15:42_

---

_Review comment by @zanieb on `crates/ruff_cli/src/args.rs`:398 on 2023-10-17 15:42_

This is within the `format` command so it's a subset

---

_Comment by @MichaReiser on 2023-10-18 01:19_

> Can you update the docs in `preview.md` or would you prefer that I did?

I created https://github.com/astral-sh/ruff/pull/8032 for updating the documentation to unblock the code changes and get review feedback on the documentation.

---

_Merged by @MichaReiser on 2023-10-18 01:26_

---

_Closed by @MichaReiser on 2023-10-18 01:26_

---

_Branch deleted on 2023-10-18 01:26_

---

_Branch restored on 2023-10-18 01:34_

---

_Branch deleted on 2024-01-16 10:03_

---
