```yaml
number: 19180
title: "[ty] Add an instance of an `Any` subclass to the property tests"
type: pull_request
state: merged
author: AlexWaygood
labels:
  - testing
  - ty
assignees: []
merged: true
base: main
head: alex/property-test-mock
created_at: 2025-07-07T14:31:15Z
updated_at: 2025-07-08T09:53:52Z
url: https://github.com/astral-sh/ruff/pull/19180
synced_at: 2026-01-12T15:56:33Z
```

# [ty] Add an instance of an `Any` subclass to the property tests

---

_@AlexWaygood_

## Summary

Nominal instance types where the class has `Any` in its MRO "break the normal rules" of normal instance-type subtyping in lots of interesting ways. The most recent example of where this has caused an issue is https://github.com/astral-sh/ty/issues/764. To help protect against issues like that, this PR adds the type `unittest.mock.Mock` (which has `Any` in its MRO) from the stdlib to the types generated by our property tests.

## Test Plan

`QUICKCHECK_TESTS=100000 cargo test --release -p ty_python_semantic -- --ignored types::property_tests::stable`


---

_Label `testing` added by @AlexWaygood on 2025-07-07 14:31_

---

_Review requested from @carljm by @AlexWaygood on 2025-07-07 14:31_

---

_Label `ty` added by @AlexWaygood on 2025-07-07 14:31_

---

_Review requested from @sharkdp by @AlexWaygood on 2025-07-07 14:31_

---

_Review requested from @dcreager by @AlexWaygood on 2025-07-07 14:31_

---

_Comment by @github-actions[bot] on 2025-07-07 14:35_

<!-- generated-comment mypy_primer -->
## `mypy_primer` results
<details>
<summary>Changes were detected when running on open source projects</summary>

```diff
async-utils (https://github.com/mikeshardmind/async-utils)
- TOTAL MEMORY USAGE: ~45MB
+ TOTAL MEMORY USAGE: ~49MB

bidict (https://github.com/jab/bidict)
-     memo fields = ~17MB
+     memo fields = ~15MB

beartype (https://github.com/beartype/beartype)
- TOTAL MEMORY USAGE: ~97MB
+ TOTAL MEMORY USAGE: ~88MB

Expression (https://github.com/cognitedata/Expression)
-     memo fields = ~49MB
+     memo fields = ~54MB

discord.py (https://github.com/Rapptz/discord.py)
-     memo fields = ~189MB
+     memo fields = ~207MB

ignite (https://github.com/pytorch/ignite)
-     memo fields = ~171MB
+     memo fields = ~189MB

isort (https://github.com/pycqa/isort)
- TOTAL MEMORY USAGE: ~88MB
+ TOTAL MEMORY USAGE: ~97MB

scrapy (https://github.com/scrapy/scrapy)
-     memo fields = ~207MB
+     memo fields = ~189MB

pytest (https://github.com/pytest-dev/pytest)
- TOTAL MEMORY USAGE: ~251MB
+ TOTAL MEMORY USAGE: ~276MB

scikit-learn (https://github.com/scikit-learn/scikit-learn)
-     memo fields = ~593MB
+     memo fields = ~539MB

```
</details>


---

_Comment by @codspeed-hq[bot] on 2025-07-07 14:53_

<!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->
<!-- __CODSPEED_WALLTIME_PERFORMANCE_REPORT_COMMENT__ -->

## [CodSpeed WallTime Performance Report](https://codspeed.io/astral-sh/ruff/branches/alex%2Fproperty-test-mock?runnerMode=WallTime)

### Merging #19180 will **not alter performance**

<sub>Comparing <code>alex/property-test-mock</code> (329acac) with <code>main</code> (56258bb)</sub>



### Summary

`✅ 7` untouched benchmarks  





---

_@sharkdp approved on 2025-07-08 08:54_

Good idea — Thank you!

---

_Merged by @AlexWaygood on 2025-07-08 09:53_

---

_Closed by @AlexWaygood on 2025-07-08 09:53_

---

_Branch deleted on 2025-07-08 09:53_

---
