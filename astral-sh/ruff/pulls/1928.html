<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cli: Catch panics to tell the user to report them - astral-sh/ruff #1928</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>cli: Catch panics to tell the user to report them</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1928">#1928</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2023-01-17 03:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a></div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-17 12:34</div>
            <div class="timeline-body"><p>Were you running into a panic somewhere specific?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-17 12:44</div>
            <div class="timeline-body"><p>No this is just a precaution seeing issues like #1845.</p>
<p>Users might not know what to do when they ruff panics, so I think it makes sense to ask them to report panics to us when they occur. Since I think we should treat any panic that occurs during normal operation as a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/messense">@messense</a> on <code>ruff_cli/src/main.rs</code>:95 on 2023-01-17 13:45</div>
            <div class="timeline-body"><p>I think you meant to use <a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html"><code>std::panic::set_hook</code></a>? Maybe also tell user to report the backtrace by re-run with <code>RUST_BACKTRACE=1</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/messense">@messense</a> reviewed on 2023-01-17 13:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-17 13:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>ruff_cli/src/main.rs</code>:95 on 2023-01-17 13:56</div>
            <div class="timeline-body"><p>I meant to use <code>catch_unwind</code> because it does not replace the default panic output it just gets invoked before it so the regular output telling the user to re-run with RUST_BACKTRACE=1 is still printed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/messense">@messense</a> on <code>ruff_cli/src/main.rs</code>:95 on 2023-01-17 14:00</div>
            <div class="timeline-body"><p>But this currently always print the message?</p>
<pre><code>cargo run -- --no-cache scripts/add_plugin.py
    Finished dev [unoptimized + debuginfo] target(s) in 0.11s
     Running `target/debug/ruff --no-cache scripts/add_plugin.py`
ruff crashed ... this should not be happening :/
Please report it on GitHub: https://github.com/charliermarsh/ruff/issues/new?title=Panic+when+%2E%2E%2E
scripts/add_plugin.py:105:89: E501 Line too long (111 &gt; 88 characters)
Found 1 error(s).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/messense">@messense</a> reviewed on 2023-01-17 14:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on <code>ruff_cli/src/main.rs</code>:95 on 2023-01-17 17:21</div>
            <div class="timeline-body"><p>Ah yes, thanks! Good catch :) I have updated it to use <code>set_hook</code> as you suggested and now it only prints when it actually panics. I am still invoking the default hook for the RUST_BACKTRACE=1 message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a> reviewed on 2023-01-17 17:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-17 22:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-17 22:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:51:51 UTC
    </footer>
</body>
</html>
