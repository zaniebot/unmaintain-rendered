<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix last example of flake8-bugbear rule `B023` &quot;function uses loop variable&quot; - astral-sh/ruff #10913</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix last example of flake8-bugbear rule <code>B023</code> &quot;function uses loop variable&quot;</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10913">#10913</a>
        opened by <a href="https://github.com/hartwork">@hartwork</a>
        on 2024-04-12 19:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hartwork">@hartwork</a></div>
            <div class="timeline-body">

Summary
<p>Hi! :wave:</p>
<p>Thanks for sharing ruff as software libre — it helps me keep Python code quality up with pre-commit, both locally and in CI :pray:</p>
<p>While studying the examples at https://docs.astral.sh/ruff/rules/function-uses-loop-variable/#example I noticed that the last of the examples had a bug: prior to this fix, <code>ì</code> was passed to the lambda for <code>x</code> rather than for <code>i</code> — the two are mixed-up. The reason it&#x27;s easy to overlook is because addition is an commutative operation and so <code>x + i</code> and <code>i + x</code> give the same result (and least with integers), despite the mix-up. For proof, let me demo the relevant part with before and after:</p>
<pre><code>In [1]: from functools import partial

In [2]: [partial(lambda x, i: (x, i), i)(123) for i in range(3)]
Out[2]: [(0, 123), (1, 123), (2, 123)]

In [3]: [partial(lambda x, i: (x, i), i=i)(123) for i in range(3)]
Out[3]: [(123, 0), (123, 1), (123, 2)]
</code></pre>
<p>Does that make sense?</p>
Test Plan


<p>Was manually tested using IPython.</p>
<p>CC @r4f @grandchild</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-04-12 20:03</div>
            <div class="timeline-body"><p>Thanks, this makes sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-12 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-12 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-12 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-04-12 20:12</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:03:22 UTC
    </footer>
</body>
</html>
