<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate JSON schema for Ruff options - astral-sh/ruff #1329</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Generate JSON schema for Ruff options</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/1329">#1329</a>
        opened by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a>
        on 2022-12-22 06:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/edgarrmondragon">@edgarrmondragon</a></div>
            <div class="timeline-body"><p>See https://github.com/charliermarsh/ruff/issues/1217</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @edgarrmondragon on 2022-12-22 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a> reviewed on 2022-12-22 06:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/squiddy">@squiddy</a> on <code>src/settings/options.rs</code>:260 on 2022-12-22 06:54</div>
            <div class="timeline-body"><p>I think it's unfortunate if we have to repeat ourselves here. I would look into whether we can adjust the <code>option</code> macro to attach the <code>doc</code> attribute to the field (would probably be nice during development as well), or whether we can make use of the generated <code>ConfigurationOptions</code> struct that exposes all that information.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/squiddy">@squiddy</a> on <code>src/pyupgrade/settings.rs</code>:11 on 2022-12-22 06:55</div>
            <div class="timeline-body"><p>According to the docs, this would also be an option.</p>
<pre><code class="language-rust">#[serde(deny_unknown_fields, rename_all = &quot;kebab-case&quot;, rename = &quot;PyUpgradeOptions&quot;)]
pub struct Options {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a> reviewed on 2022-12-22 06:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> reviewed on 2022-12-22 07:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> on <code>src/settings/options.rs</code>:260 on 2022-12-22 07:30</div>
            <div class="timeline-body"><p>I agree. I'll look into it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/squiddy">@squiddy</a> on 2022-12-22 10:32</div>
            <div class="timeline-body"><p>This is nice. I'm keeping an eye on this, because having a schema could come in handy for the wasm playground, where I currently export some custom schema to have this options sidebar. If there was a way for this schema to also have the default values in there, I could use just this. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/squiddy">@squiddy</a> on <code>src/settings/options.rs</code>:260 on 2022-12-22 10:35</div>
            <div class="timeline-body"><p>We can also explore turning this around: see how far we can get with JSON schema &amp; schemars, and perhaps we can build on that as a base for the [option] macros.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a> reviewed on 2022-12-22 10:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-22 15:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/settings/options.rs</code>:260 on 2022-12-22 15:58</div>
            <div class="timeline-body"><p>Repeating ourselves here isn't the end of the world (it's nice to have these as rust docs too, I guess?) though agree it'd be nice to reuse if there's a straightforward path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-22 15:58</div>
            <div class="timeline-body"><p>This is awesome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> reviewed on 2022-12-23 04:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> on <code>src/settings/options.rs</code>:260 on 2022-12-23 04:07</div>
            <div class="timeline-body"><p>Yeah, there's a bit of overlap between the two traits so at some point (not necessarily in this PR) a single source of truth should be in place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @edgarrmondragon on 2022-12-23 04:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-23 05:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff.schema.json</code>:6 on 2022-12-23 05:07</div>
            <div class="timeline-body"><p>Are these missing descriptions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/settings/options.rs</code>:260 on 2022-12-24 04:59</div>
            <div class="timeline-body"><p>Okay, I think I have this working in the other direction?</p>
<p>Like we can do this:</p>
<pre><code class="language-rust">#[option(
    default = r#&quot;[]&quot;#,
    value_type = &quot;Vec&lt;char&gt;&quot;,
    example = r#&quot;
        # Allow minus-sign (U+2212), greek-small-letter-rho (U+03C1), and the asterisk-operator (U+2217),
        # which could be confused for &quot;-&quot;, &quot;p&quot;, and &quot;*&quot;, respectively.
        allowed-confusables = [&quot;−&quot;, &quot;ρ&quot;, &quot;∗&quot;]
    &quot;#
)]
/// A list of allowed &quot;confusable&quot; Unicode characters to ignore when enforcing `RUF001`,
/// `RUF002`, and `RUF003`.
pub allowed_confusables: Option&lt;Vec&lt;char&gt;&gt;,
...
</code></pre>
<p>...and have it generate the schema, and the documentation, and it works in the IDE.</p>
<p>What do you think @squiddy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-24 04:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-24 05:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/settings/options.rs</code>:260 on 2022-12-24 05:00</div>
            <div class="timeline-body"><p>(It's probably possible to generate the rustdoc from the proc macro, but I'm not that strong on macros (and I don't know how that would ever work with the IDE).)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/squiddy">@squiddy</a> reviewed on 2022-12-24 05:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/squiddy">@squiddy</a> on <code>src/settings/options.rs</code>:260 on 2022-12-24 05:30</div>
            <div class="timeline-body"><p>Yes, looks good to me! As you said, that fit's more into standard rust and how IDEs work. I found some hints on how to generate rustdoc from the macro, but than I ran into macro errors that I couldn't resolve.. probably for the best.</p>
<p>(On that topic, I wonder if we can just move everything into rustdoc and have the macro parse that text up into <code>default</code> / <code>value_type</code> and <code>example</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> reviewed on 2022-12-24 05:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> on <code>ruff.schema.json</code>:6 on 2022-12-24 05:51</div>
            <div class="timeline-body"><p>Yes, there are a bunch of missing descriptions. I can add them :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-24 05:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff.schema.json</code>:6 on 2022-12-24 05:56</div>
            <div class="timeline-body"><p>It’s ok, I think I can update the macro to read from rustdoc, and then these comments can just be taking the “doc” piece from above and moving them into comments verbatim.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2022-12-24 05:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff.schema.json</code>:6 on 2022-12-24 05:58</div>
            <div class="timeline-body"><p>The most helpful thing, in that light, would just be to take the existing doc= text from above and copying it as // docs for each attribute. But I can also do it, either way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2022-12-24 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-24 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-24 19:10</div>
            <div class="timeline-body"><p>Thanks @edgarrmondragon as always!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-12-24 23:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:13 UTC
    </footer>
</body>
</html>
