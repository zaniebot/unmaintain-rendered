<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`perflint`] Add `PERF403` - astral-sh/ruff #6132</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>perflint</code>] Add <code>PERF403</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/6132">#6132</a>
        opened by <a href="https://github.com/qdegraaf">@qdegraaf</a>
        on 2023-07-27 16:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-07-27 16:13</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Reopening of https://github.com/astral-sh/ruff/pull/5313</p>
<p>One open question as described in https://github.com/astral-sh/ruff/pull/5313#issuecomment-1645113101</p>
<p>FYI previous reviewers: @MichaReiser @dhruvmanila @charliermarsh</p>
<h1>Old Description</h1>
<h2>Summary</h2>
<p>Adds <code>PERF403</code> mirroring <code>W8403</code> from https://github.com/tonybaloney/perflint</p>
<h2>Test Plan</h2>
<p>Fixtures were added based on perflint tests</p>
<h2>Issue Links</h2>
<p>Refers: https://github.com/astral-sh/ruff/issues/4789</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-27 16:47</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>ℹ️ ecosystem check <strong>detected changes</strong>. (+22, -0, 0 error(s))</p>
<details><summary>airflow (+5, -0)</summary>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/8ecd576de1043dbea40e5e16b5dc34859cc41725/airflow/providers/cncf/kubernetes/executors/kubernetes_executor_utils.py#L163'>airflow/providers/cncf/kubernetes/executors/kubernetes_executor_utils.py:163:17:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/apache/airflow/blob/8ecd576de1043dbea40e5e16b5dc34859cc41725/airflow/providers/exasol/hooks/exasol.py#L68'>airflow/providers/exasol/hooks/exasol.py:68:17:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/apache/airflow/blob/8ecd576de1043dbea40e5e16b5dc34859cc41725/airflow/providers/mysql/hooks/mysql.py#L170'>airflow/providers/mysql/hooks/mysql.py:170:17:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/apache/airflow/blob/8ecd576de1043dbea40e5e16b5dc34859cc41725/airflow/providers/postgres/hooks/postgres.py#L153'>airflow/providers/postgres/hooks/postgres.py:153:17:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/apache/airflow/blob/8ecd576de1043dbea40e5e16b5dc34859cc41725/tests/providers/apache/spark/hooks/test_spark_submit.py#L72'>tests/providers/apache/spark/hooks/test_spark_submit.py:72:17:</a> PERF403 Use a dictionary comprehension instead of a for-loop
</pre>

</p>
</details>
<details><summary>rotki (+3, -0)</summary>
<p>

<pre>
+ <a href='https://github.com/rotki/rotki/blob/4aa415223dd9530d3e1aff76861a17add07aee13/rotkehlchen/api/rest.py#L506'>rotkehlchen/api/rest.py:506:13:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/rotki/rotki/blob/4aa415223dd9530d3e1aff76861a17add07aee13/rotkehlchen/globaldb/handler.py#L899'>rotkehlchen/globaldb/handler.py:899:17:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/rotki/rotki/blob/4aa415223dd9530d3e1aff76861a17add07aee13/rotkehlchen/tests/utils/database.py#L104'>rotkehlchen/tests/utils/database.py:104:13:</a> PERF403 Use a dictionary comprehension instead of a for-loop
</pre>

</p>
</details>
<details><summary>sphinx (+13, -0)</summary>
<p>

<pre>
+ 
+    |
+    |             ^^^^^^^^^^^^ PERF403
+ 28 |     for info in reversed(list(request.node.iter_markers("apidoc"))):
+ 29 |         for i, a in enumerate(info.args):
+ 30 |             pargs[i] = a
+ 31 |         kwargs.update(info.kwargs)
+ 76 |     for info in reversed(list(request.node.iter_markers("sphinx"))):
+ 77 |         for i, a in enumerate(info.args):
+ 78 |             pargs[i] = a
+ 79 |         kwargs.update(info.kwargs)
+ <a href='https://github.com/sphinx-doc/sphinx/blob/f0c25a0adafe36eb987bae6ea13ed4a57d1c3bf0/sphinx/testing/fixtures.py#L78'>sphinx/testing/fixtures.py:78:13:</a> PERF403 Use a dictionary comprehension instead of a for-loop
+ <a href='https://github.com/sphinx-doc/sphinx/blob/f0c25a0adafe36eb987bae6ea13ed4a57d1c3bf0/tests/test_ext_apidoc.py#L30'>tests/test_ext_apidoc.py:30:13:</a> PERF403 Use a dictionary comprehension instead of a for-loop
</pre>

</p>
</details>
<details><summary>zulip (+1, -0)</summary>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/db8229ae32475ec9d114d04a35a50c5096d27f2e/analytics/views/stats.py#L456'>analytics/views/stats.py:456:9:</a> PERF403 Use a dictionary comprehension instead of a for-loop
</pre>

</p>
</details>
Rules changed: 1

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PERF403 | 11 | 11 | 0 |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @qdegraaf on 2023-07-27 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-29 16:49</div>
            <div class="timeline-body"><p>We can probably implement this more confidently now by leveraging some of the basic type inference stuff added in the <code>refurb</code> module.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-08-29 17:42</div>
            <div class="timeline-body"><p>Awesome! I'll see if I can find some time next week to look at that and implement it in this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-29 18:09</div>
            <div class="timeline-body"><p>Sounds good! We'll need to pull the stuff out of <code>refurb/helpers.rs</code> into (probably) <code>ruff_python_semantic::analyzers::typing</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-08-29 18:18</div>
            <div class="timeline-body"><p>Is that just a simple copy paste to <code>ruff_python_semantic</code> and reimport in the refurb module? If so I'll open a separate PR for that and then rebase this one. That will unblock other people from picking this up if they beat me to it and/or any other PRs where I'm sure basic type inference will be very useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-08-29 19:05</div>
            <div class="timeline-body"><p>I've added the dict check and also excluded if/elif/else comprehensions from the check. Upstream plugin does this as well (I misread the tests upon first implementation). Still need to find some time to implement the heuristic for checking if the dict is empty before the loop.</p>
<p>@charliermarsh For the if/elif/else check I misread upstream for PERF401 as well. Will open a small PR to fix that, can see if adding the type inference there (and PERF402 as well) has added value too.</p>
<p>EDIT: Someone beat me to it,. the fixtures were just still flagged wrong.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-08-30 04:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2023-08-30 04:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-09-15 01:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-15 01:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-09-15 15:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:39:46 UTC
    </footer>
</body>
</html>
