<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`refurb`] Implement `readlines_in_for` lint (FURB129) - astral-sh/ruff #9880</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>refurb</code>] Implement <code>readlines_in_for</code> lint (FURB129)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/9880">#9880</a>
        opened by <a href="https://github.com/alex-700">@alex-700</a>
        on 2024-02-07 21:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alex-700">@alex-700</a></div>
            <div class="timeline-body">

Summary
<p>Implement <a href="https://github.com/dosisod/refurb/blob/master/refurb/checks/iterable/implicit_readlines.py">implicit readlines (FURB129)</a> lint.</p>
Notes
<p>I need a help/an opinion about suggested implementations.</p>
<p>This implementation differs from the original one from <code>refurb</code> in the following way. This implementation checks syntactically the call of the method with the name <code>readlines()</code> inside <code>for</code> {loop|generator expression}. The implementation from refurb also <a href="https://github.com/dosisod/refurb/blob/master/refurb/checks/iterable/implicit_readlines.py#L43">checks</a> that callee is a variable with a type <code>io.TextIOWrapper</code> or <code>io.BufferedReader</code>.</p>
<ul>
<li>I do not see a simple way to implement the same logic.</li>
<li>The best I can have is something like</li>
</ul>
<pre><code>checker.semantic().binding(checker.semantic().resolve_name(attr_expr.value.as_name_expr()?)?).statement(checker.semantic())
</code></pre>
<p>and analyze cases. But this will be not about types, but about guessing the type by assignment (or with) expression.</p>
<ul>
<li>Also this logic has several false negatives, when the callee is not a variable, but the result of function call (e.g. <code>open(...)</code>).</li>
<li>On the other side, maybe it is good to lint this on other things, where this suggestion is not safe, and push the developers to change their interfaces to be less surprising, comparing with the standard library.</li>
<li>Anyway while the current implementation has false-positives (I mentioned some of them in the test) I marked the fixes to be unsafe.</li>
</ul>


Test Plan
<p>cargo test</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-02-07 21:30</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+7 -0 violations, +0 -0 fixes in 3 projects; 40 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+5 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/6754e9d83b89e9701c1b96bdc807a14e8c826d72/dev/breeze/src/airflow_breeze/global_constants.py#L361">dev/breeze/src/airflow_breeze/global_constants.py:361:21:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
+ <a href="https://github.com/apache/airflow/blob/6754e9d83b89e9701c1b96bdc807a14e8c826d72/dev/perf/sql_queries.py#L143">dev/perf/sql_queries.py:143:41:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
+ <a href="https://github.com/apache/airflow/blob/6754e9d83b89e9701c1b96bdc807a14e8c826d72/docs/exts/redirects.py#L43">docs/exts/redirects.py:43:21:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
+ <a href="https://github.com/apache/airflow/blob/6754e9d83b89e9701c1b96bdc807a14e8c826d72/scripts/ci/pre_commit/pre_commit_newsfragments.py#L35">scripts/ci/pre_commit/pre_commit_newsfragments.py:35:43:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
+ <a href="https://github.com/apache/airflow/blob/6754e9d83b89e9701c1b96bdc807a14e8c826d72/tests/system/providers/google/cloud/gcs/resources/transform_script.py#L26">tests/system/providers/google/cloud/gcs/resources/transform_script.py:26:39:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
</pre>

</p>

<a href="https://github.com/zulip/zulip">zulip/zulip</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/zulip/zulip/blob/35098f49597895718343091881fbd6198bd2022d/tools/lib/provision_inner.py#L101">tools/lib/provision_inner.py:101:51:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
</pre>

</p>

<a href="https://github.com/indico/indico">indico/indico</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/indico/indico/blob/b43fa662c2dbdf8e400563dbaa792476aeffc4a4/setup.py#L18">setup.py:18:30:</a> FURB129 Instead of calling `readlines()`, iterate over file object directly
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| FURB129 | 7 | 7 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-13 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-13 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-13 03:09</div>
            <div class="timeline-body"><p>Thanks! I added some extensions to our (basic) type inference system to support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-13 03:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-13 03:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-13 09:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:01:30 UTC
    </footer>
</body>
</html>
