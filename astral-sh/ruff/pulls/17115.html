<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`airflow`] Add missing `AIR302` attribute check - astral-sh/ruff #17115</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>airflow</code>] Add missing <code>AIR302</code> attribute check</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17115">#17115</a>
        opened by <a href="https://github.com/Lee-W">@Lee-W</a>
        on 2025-04-01 11:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>attribute check was missing in the previous implementation</p>
<p>e.g.</p>
<pre><code class="language-python">from airflow.api.auth.backend import basic_auth

basic_auth.auth_current_user
</code></pre>
<p>This PR adds this kind of check.</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>The test case has been added to the button of the existing test fixtures, confirmed to be correct and later reorgnaized</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-01 11:28</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sunank200">@sunank200</a> reviewed on 2025-04-02 06:27</div>
            <div class="timeline-body"><p>LGTM</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-04-02 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-04-02 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 15:12</div>
            <div class="timeline-body"><p>This seems to be creating two diagnostics that are same for the two parts of the attribute node. Can you look into it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> requested changes on 2025-04-02 15:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-02 15:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 15:17</div>
            <div class="timeline-body"><p>I think it's expected for <code>&quot;airflow&quot;, &quot;api&quot;, &quot;auth&quot;, &quot;backend&quot;, &quot;basic_auth&quot;, ..</code>. <code>...basic_auth</code> or anything under <code>basic_auth</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-02 15:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 15:18</div>
            <div class="timeline-body"><p>to reduce this kind of confusion. We're also going to remove <code>Replacement::ImportPathMoved</code> and expand them to individual <code>Replacement::ProviderName</code> instead.</p>
<p>But I think the logic in this PR is still required</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-04-02 15:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 15:25</div>
            <div class="timeline-body"><p>I'm not sure I follow here. There are two duplicate diagnostics for separate symbol:</p>
<ul>
<li><code>basic_auth</code></li>
<li><code>auth_current_user</code></li>
</ul>
<p>They both say:</p>
<pre><code>Import path `airflow.api.auth.backend.basic_auth` is moved into `fab` provider in Airflow 3.0;
</code></pre>
<p>But, we should avoid the duplicate diagnostic and only highlight it once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 15:32</div>
            <div class="timeline-body"><p>I think <code>basic_auth</code> was check when it is passed into as a Name and <code>auth_current_user</code> is checked when it's an attribute under <code>basic_auth</code> (because of <code>[&quot;airflow&quot;, &quot;api&quot;, &quot;auth&quot;, &quot;backend&quot;, &quot;basic_auth&quot;, ..]</code>)</p>
<p>The issue occurs because we implemented the path check only instead of checking the exact name. This is antoher issue (which will be addressed when we replace all the path check with exact name check)</p>
<hr />
<p>This PR intends to solve the following issue. (I'll update the test fixture)</p>
<pre><code class="language-python">from airflow.operators import python

python.PythonOperator()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-02 15:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-04-02 15:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 15:59</div>
            <div class="timeline-body"><p>I understand that part, but I think the bug related to duplicate diagnostic would still exists and we should address that. I'm not exactly sure how as I'd need to look at the code first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-02 16:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 16:05</div>
            <div class="timeline-body"><p>I just updated the test fixture to the issue we have.</p>
<p>Yep, we'll address that issue as well. but that would take sometime to replace <code>Replacement::ImportPath</code> as <code>Replacement::Provider</code>. @sunank200 and I already sync up and we're thinking of making them another PR. WDYT?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-02 16:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 16:05</div>
            <div class="timeline-body"><p>It's also ok if we want it to be in this PR üôÇ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-04-02 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-02 17:18</div>
            <div class="timeline-body"><p>We want to do a release this week and I'm worried that this might not be fixed until then. I'd prefer that we do it in this PR itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-03 02:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-03 02:18</div>
            <div class="timeline-body"><p>Got it. Sounds good</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Lee-W on 2025-04-03 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] Add misssing AIR303 attribute check" to "[airflow] Add misssing AIR302 attribute check" by @Lee-W on 2025-04-03 03:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Lee-W">@Lee-W</a> reviewed on 2025-04-08 03:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Lee-W">@Lee-W</a> on <code>crates/ruff_linter/src/rules/airflow/snapshots/ruff_linter__rules__airflow__tests__AIR303_AIR303.py.snap</code>:892 on 2025-04-08 03:32</div>
            <div class="timeline-body"><p>It's fixed in https://github.com/astral-sh/ruff/pull/17278</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-08 03:33</div>
            <div class="timeline-body"><p>This PR is now based on https://github.com/astral-sh/ruff/pull/17278</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Lee-W on 2025-04-08 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-08 13:12</div>
            <div class="timeline-body"><p>Thanks @ntBre, for merging #17278! This one is ready as well</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-08 13:13</div>
            <div class="timeline-body"><p>I guess we might need @dhruvmanila to confirm as well?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] Add misssing AIR302 attribute check" to "[airflow] Add missing AIR302 attribute check" by @Lee-W on 2025-04-08 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-09 14:48</div>
            <div class="timeline-body"><p>I can override Dhruv's review if needed :wink: Can you fix the merge conflicts? Then I'll try to review today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lee-W">@Lee-W</a> on 2025-04-09 15:10</div>
            <div class="timeline-body"><p>Just updated! üôè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ntBre by @ntBre on 2025-04-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-04-09 17:44</div>
            <div class="timeline-body"><p>This looks good to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[airflow] Add missing AIR302 attribute check" to "[`airflow`] Add missing `AIR302` attribute check" by @ntBre on 2025-04-09 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ntBre on 2025-04-09 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-04-09 17:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:11:08 UTC
    </footer>
</body>
</html>
