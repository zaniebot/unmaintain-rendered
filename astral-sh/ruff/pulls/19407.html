<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canonicalize path before filtering - astral-sh/ruff #19407</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Canonicalize path before filtering</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19407">#19407</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-07-17 17:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body">Summary
<p>This came up on <a href="https://discord.com/channels/1039017663004942429/1343692072921731082/1395447082520678440">Discord</a> and also in #19387, but on macOS the tmp directory is a symlink to <code>/private/tmp</code>, which breaks this filter. I&#x27;m still not quite sure why only these tests are affected when we use the <code>tempdir_filter</code> elsewhere, but hopefully this fixes the immediate issue. Just <code>tempdir.path().canonicalize()</code> also worked, but I used <code>dunce</code> since that&#x27;s what I saw in other tests (I guess it&#x27;s not <em>just</em> these tests).</p>
<p>Some related links from uv:</p>
<ul>
<li>https://github.com/astral-sh/uv/blob/1b2f212e8b2f91069b858cb7f5905589c9d15add/crates/uv/tests/it/common/mod.rs#L1161-L1178</li>
<li>https://github.com/astral-sh/uv/blob/1b2f212e8b2f91069b858cb7f5905589c9d15add/crates/uv/tests/it/common/mod.rs#L424-L438</li>
<li>https://github.com/astral-sh/uv/pull/14290</li>
</ul>
<p>Thanks to @zanieb for those!</p>
Test Plan
<p>I tested the <code>main</code> branch on my MacBook and reproduced the test failure, then confirmed that the tests pass after the change. Now to make sure it passes on Windows, which caused most of the trouble in the first PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-07-17 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 17:43</div>
            <div class="timeline-body"><p>Yeah this is basically what I was afraid of with Windows. I&#x27;ll try just including both filters and then bust out the Windows VM too if I have to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-17 17:57</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-17 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-17 18:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:16:43 UTC
    </footer>
</body>
</html>
