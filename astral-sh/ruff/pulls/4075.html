<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Implement PLE0302 `unexpected-special-method-signature` - astral-sh/ruff #4075</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Implement PLE0302 <code>unexpected-special-method-signature</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4075">#4075</a>
        opened by <a href="https://github.com/mccullocht">@mccullocht</a>
        on 2023-04-24 04:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mccullocht">@mccullocht</a></div>
            <div class="timeline-body"><p>Implement pylint <a href="https://pylint.readthedocs.io/en/latest/user_guide/messages/error/unexpected-special-method-signature.html"><code>unexpected-special-method-signature</code></a></p>
<p>This is part of issue <a href="https://github.com/charliermarsh/ruff/issues/970">charliermarsh/ruff#970</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-24 05:04</div>
            <div class="timeline-body"><p>Nice, thanks for the PR! Look forward to reviewing :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-04-24 05:07</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>✅ ecosystem check detected no changes.</p>
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.02     15.4±0.04ms     2.6 MB/sec    1.00     15.1±0.02ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      3.9±0.01ms     4.3 MB/sec    1.00      3.8±0.01ms     4.4 MB/sec
linter/all-rules/numpy/globals.py          1.03    431.4±5.62µs     6.8 MB/sec    1.00    418.3±2.56µs     7.1 MB/sec
linter/all-rules/pydantic/types.py         1.02      6.6±0.02ms     3.9 MB/sec    1.00      6.5±0.01ms     3.9 MB/sec
linter/default-rules/large/dataset.py      1.04      8.1±0.02ms     5.0 MB/sec    1.00      7.8±0.01ms     5.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02   1775.7±5.29µs     9.4 MB/sec    1.00   1742.1±3.33µs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.01    185.4±0.51µs    15.9 MB/sec    1.00    183.5±0.85µs    16.1 MB/sec
linter/default-rules/pydantic/types.py     1.03      3.7±0.01ms     6.8 MB/sec    1.00      3.6±0.01ms     7.0 MB/sec
parser/large/dataset.py                    1.04      6.5±0.00ms     6.3 MB/sec    1.00      6.2±0.01ms     6.5 MB/sec
parser/numpy/ctypeslib.py                  1.02   1273.9±1.44µs    13.1 MB/sec    1.00   1248.1±2.03µs    13.3 MB/sec
parser/numpy/globals.py                    1.01    127.4±0.23µs    23.2 MB/sec    1.00    125.9±0.55µs    23.4 MB/sec
parser/pydantic/types.py                   1.02      2.8±0.00ms     9.2 MB/sec    1.00      2.7±0.00ms     9.4 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.02     17.3±0.20ms     2.3 MB/sec    1.00     17.0±0.16ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.01      4.4±0.04ms     3.8 MB/sec    1.00      4.4±0.04ms     3.8 MB/sec
linter/all-rules/numpy/globals.py          1.02   542.7±13.75µs     5.4 MB/sec    1.00    534.1±5.64µs     5.5 MB/sec
linter/all-rules/pydantic/types.py         1.01      7.3±0.09ms     3.5 MB/sec    1.00      7.3±0.13ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.03      8.9±0.07ms     4.6 MB/sec    1.00      8.7±0.10ms     4.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02  1938.6±17.24µs     8.6 MB/sec    1.00  1906.0±24.51µs     8.7 MB/sec
linter/default-rules/numpy/globals.py      1.01    217.8±3.32µs    13.5 MB/sec    1.00    216.3±7.11µs    13.6 MB/sec
linter/default-rules/pydantic/types.py     1.01      4.0±0.04ms     6.3 MB/sec    1.00      4.0±0.05ms     6.4 MB/sec
parser/large/dataset.py                    1.00      6.9±0.05ms     5.9 MB/sec    1.00      6.8±0.04ms     5.9 MB/sec
parser/numpy/ctypeslib.py                  1.00  1313.2±13.86µs    12.7 MB/sec    1.00  1308.4±13.68µs    12.7 MB/sec
parser/numpy/globals.py                    1.00    131.4±2.79µs    22.5 MB/sec    1.02    133.9±2.63µs    22.0 MB/sec
parser/pydantic/types.py                   1.01      2.9±0.03ms     8.6 MB/sec    1.00      2.9±0.03ms     8.7 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-24 05:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:121 on 2023-04-24 05:28</div>
            <div class="timeline-body"><p>Does this need to take into account positional-only and/or keyword-only arguments? (Elsewhere, we have logic like <code>let defaults_start = args.posonlyargs.len() + args.args.len() - args.defaults.len();</code> and <code>let defaults_start = args.kwonlyargs.len() - args.kw_defaults.len();</code> to infer some similar information from function signatures.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:50 on 2023-04-24 05:31</div>
            <div class="timeline-body"><p>Rather than modeling each case as <code>RangeInclusive</code>, and using <code>self.expected_params.end() - self.expected_params.start() &gt; 1</code>-like checks to determine whether a branch should be treated as a range or not, what if we introduced an enum here to represent the two cases? E.g.:</p>
<pre><code>enum ExpectedParameters {
  Fixed(usize),
  // Or RangeInclusive&lt;usize&gt;
  Range(usize, usize),
}
</code></pre>
<p>(Names etc. are of course flexible, just illustrating the concept.)</p>
<p>I think that would make some of the case-handling below a bit clearer by way of being more explicit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:40 on 2023-04-24 05:32</div>
            <div class="timeline-body"><p>Nit: consider using either <code>parameter</code> or <code>parameters</code> based on <code>self.expected_params.start()</code>, rather than <code>param(s)</code>? It&#x27;s a little more code (one more case) but we tend to do it elsewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:81 on 2023-04-24 05:33</div>
            <div class="timeline-body"><p>(This could even be an associated function on <code>ExpectedParameters</code>, to increment the count.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:108 on 2023-04-24 05:33</div>
            <div class="timeline-body"><p>(Nit: you could choose to use <code>let-else</code> here to avoid the nesting, but totally up to you.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-04-24 05:33</div>
            <div class="timeline-body"><p>Nice PR! Thanks for getting involved. One question below and a couple small comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mccullocht">@mccullocht</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:108 on 2023-04-24 18:40</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mccullocht">@mccullocht</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:121 on 2023-04-24 18:43</div>
            <div class="timeline-body"><p>I patterned off of the <a href="https://github.com/pylint-dev/pylint/blob/bc9c5c6610cce2a068eabce598200399b9d002f2/pylint/checkers/classes/special_methods_checker.py#L197">pylint check</a> which did not take posonly/kwonly args into account, but I can investigate further if you&#x27;d like. I don&#x27;t think we need to consider kw-only arguments as it doesn&#x27;t seem that any special methods have them according to the <a href="https://docs.python.org/2/reference/datamodel.html#special-method-names">documentation</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mccullocht">@mccullocht</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:50 on 2023-04-24 19:13</div>
            <div class="timeline-body"><p>Done.</p>
<p>I used the new enum in the violation so it has to be public :/. If you have a preference <code>expected_params</code> can be rendered into a string for formatting before creating the violation, which would allow <code>ExpectedParams</code> to be private again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mccullocht">@mccullocht</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:40 on 2023-04-24 19:13</div>
            <div class="timeline-body"><p>Done.</p>
<p>I was using the copy from pylint as a starting point but this is clearer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mccullocht">@mccullocht</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:81 on 2023-04-24 19:14</div>
            <div class="timeline-body"><p><code>ExpectedParams::from_method()</code> takes an <code>is_staticmethod</code> bool and applies this internally on construction, but I got rid of the <code>map()</code> call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mccullocht">@mccullocht</a> reviewed on 2023-04-24 19:22</div>
            <div class="timeline-body"><p>Thank you for the prompt review!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/mccullocht">@mccullocht</a> on 2023-04-24 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-04-25 04:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:121 on 2023-04-25 04:47</div>
            <div class="timeline-body"><p>Perhaps we want to extend the check with a custom message when posonly/kwonly args are included, since that itself deviates from the expected signature, albeit in a different way?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/rules/pylint/rules/unexpected_special_method_signature.rs</code>:50 on 2023-04-25 04:47</div>
            <div class="timeline-body"><p>All good, we follow this pattern after and the enums end up public. No worries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-04-25 04:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-25 04:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-25 04:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-25 04:52</div>
            <div class="timeline-body"><p>Thanks so much for the contribution!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:53:22 UTC
    </footer>
</body>
</html>
