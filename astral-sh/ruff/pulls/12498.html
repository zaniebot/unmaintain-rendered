<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preserve trailing inline comments on import-from statements - astral-sh/ruff #12498</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Preserve trailing inline comments on import-from statements</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12498">#12498</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-07-24 22:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-24 22:05</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Right now, in the isort comment model, there's nowhere for trailing comments on the <em>statement</em> to go, as in:</p>
<pre><code class="language-python">from mylib import (
    MyClient,
    MyMgmtClient,
)  # some comment
</code></pre>
<p>If the comment is on the <em>alias</em>, we do preserve it, because we attach it to the alias, as in:</p>
<pre><code class="language-python">from mylib import (
    MyClient,
    MyMgmtClient,  # some comment
)
</code></pre>
<p>Similarly, if the comment is trailing on an import statement (non-<code>from</code>), we again attach it to the alias, because it can't be parenthesized, as in:</p>
<pre><code class="language-python">import foo  # some comment
</code></pre>
<p>This PR adds logic to track and preserve those trailing comments.</p>
<p>We also no longer drop several other comments, like:</p>
<pre><code class="language-python">from mylib import (
    # some comment
    MyClient
)
</code></pre>
<p>Closes https://github.com/astral-sh/ruff/issues/12487.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-07-24 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @charliermarsh on 2024-07-24 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-07-24 22:24</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+8 -9 violations, +0 -0 fixes in 2 projects; 52 projects unchanged)</p>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+8 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L3468'>pandas/core/generic.py:3468:13:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L3629'>pandas/core/generic.py:3629:9:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L7992'>pandas/core/generic.py:7992:17:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L7995'>pandas/core/generic.py:7995:17:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L7998'>pandas/core/generic.py:7998:17:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L9235'>pandas/core/generic.py:9235:13:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L9242'>pandas/core/generic.py:9242:17:</a> PLW0642 Invalid assignment to `self` argument in instance method
+ <a href='https://github.com/pandas-dev/pandas/blob/d6c9941b730855aaa03fd38f0d1216140f90e1ec/pandas/core/generic.py#L9245'>pandas/core/generic.py:9245:17:</a> PLW0642 Invalid assignment to `self` argument in instance method
</pre>

</p>
</details>
<details><summary><a href="https://github.com/python/typeshed">python/typeshed</a> (+0 -9 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select E,F,FA,I,PYI,RUF,UP,W</pre>
</p>
<p>

<pre>
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L17'>stdlib/pstats.pyi:17:13:</a> PYI052 Need type annotation for `CALLS`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L18'>stdlib/pstats.pyi:18:18:</a> PYI052 Need type annotation for `CUMULATIVE`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L19'>stdlib/pstats.pyi:19:16:</a> PYI052 Need type annotation for `FILENAME`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L20'>stdlib/pstats.pyi:20:12:</a> PYI052 Need type annotation for `LINE`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L21'>stdlib/pstats.pyi:21:12:</a> PYI052 Need type annotation for `NAME`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L22'>stdlib/pstats.pyi:22:11:</a> PYI052 Need type annotation for `NFL`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L23'>stdlib/pstats.pyi:23:14:</a> PYI052 Need type annotation for `PCALLS`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L24'>stdlib/pstats.pyi:24:15:</a> PYI052 Need type annotation for `STDNAME`
- <a href='https://github.com/python/typeshed/blob/9eae1ae1a5b47745c7d289bb2092f2b4340e7622/stdlib/pstats.pyi#L25'>stdlib/pstats.pyi:25:12:</a> PYI052 Need type annotation for `TIME`
</pre>

</p>
</details>
<details><summary>Changes by rule (2 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PYI052 | 9 | 0 | 9 | 0 | 0 |
| PLW0642 | 8 | 8 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/isort/annotate.rs</code>:143 on 2024-07-25 06:28</div>
            <div class="timeline-body"><p>Shouldn't all remaining comments be guaranteed to start after (or at) <code>import.end</code>?</p>
<pre><code class="language-suggestion">                    while let Some(comment) = comments_iter.next_if(|comment| {
                        comment.start() &lt; import_line_end
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-07-25 06:28</div>
            <div class="timeline-body"><p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-25 13:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/isort/annotate.rs</code>:143 on 2024-07-25 13:54</div>
            <div class="timeline-body"><p>Good call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/isort/snapshots/ruff_linter__rules__isort__tests__trailing_comment.py.snap</code>:58 on 2024-07-25 13:57</div>
            <div class="timeline-body"><p>Gonna fix this before merging (the comment should stay on its own line).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-25 13:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-07-25 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-25 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-25 21:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:47:34 UTC
    </footer>
</body>
</html>
