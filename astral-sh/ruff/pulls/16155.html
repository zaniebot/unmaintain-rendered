<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[refurb] Check for subclasses includes subscript expressions (FURB189) - astral-sh/ruff #16155</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[refurb] Check for subclasses includes subscript expressions (FURB189)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16155">#16155</a>
        opened by <a href="https://github.com/vladNed">@vladNed</a>
        on 2025-02-14 08:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vladNed">@vladNed</a></div>
            <div class="timeline-body">

Summary
<p>Added checks for subscript expressions on builtin classes as in FURB189.
The object is changed to use the collections objects and the types from the subscript are kept.</p>
<p>Resolves #16130</p>
<blockquote>
<p>Note: Added some comments in the code explaining why</p>
Test Plan
</blockquote>


<ul>
<li>Added a subscript dict and list class to the test file.</li>
<li>Tested locally to check that the symbols are changed and the types are kept.</li>
<li>No modifications changed on optional <code>str</code> values.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-14 08:20</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+8 -0 violations, +0 -0 fixes in 6 projects; 49 projects unchanged)</p>
<a href="https://github.com/apache/airflow">apache/airflow</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/airflow/blob/8f63b828ace09b1095229f22b0c6d1f0f85ea81a/dev/breeze/src/airflow_breeze/utils/selective_checks.py#L136">dev/breeze/src/airflow_breeze/utils/selective_checks.py:136:20:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
</pre>

</p>

<a href="https://github.com/apache/superset">apache/superset</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/apache/superset/blob/ffe9244458d03995b760638e9bb5b347c0cc68d6/superset/db_engine_specs/trino.py#L407">superset/db_engine_specs/trino.py:407:30:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
</pre>

</p>

<a href="https://github.com/bokeh/bokeh">bokeh/bokeh</a> (+2 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/bokeh/util/compiler.py#L73">src/bokeh/util/compiler.py:73:16:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
+ <a href="https://github.com/bokeh/bokeh/blob/829b2a75c402d0d0abd7e37ff201fbdfd949d857/src/typings/bs4.pyi#L12">src/typings/bs4.pyi:12:17:</a> FURB189 Subclassing `list` can be error prone, use `collections.UserList` instead
</pre>

</p>

<a href="https://github.com/langchain-ai/langchain">langchain-ai/langchain</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/langchain-ai/langchain/blob/3dffee3d0b037db1b380370e58aa08898baaf761/libs/core/langchain_core/runnables/utils.py#L465">libs/core/langchain_core/runnables/utils.py:465:19:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
</pre>

</p>

<a href="https://github.com/reflex-dev/reflex">reflex-dev/reflex</a> (+2 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/reflex-dev/reflex/blob/10bae9577c0f898f7ae9b2d540336058bda53837/tests/units/utils/test_types.py#L50">tests/units/utils/test_types.py:50:18:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
+ <a href="https://github.com/reflex-dev/reflex/blob/10bae9577c0f898f7ae9b2d540336058bda53837/tests/units/vars/test_base.py#L9">tests/units/vars/test_base.py:9:18:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
</pre>

</p>

<a href="https://github.com/python-trio/trio">python-trio/trio</a> (+1 -0 violations, +0 -0 fixes)
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --no-fix --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href="https://github.com/python-trio/trio/blob/5eb5afbcfb42661a43a90c199c0e82a78d1f97fa/src/trio/_core/_instrumentation.py#L24">src/trio/_core/_instrumentation.py:24:19:</a> FURB189 Subclassing `dict` can be error prone, use `collections.UserDict` instead
</pre>

</p>

Changes by rule (1 rules affected)
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| FURB189 | 8 | 8 | 0 | 0 | 0 |</p>
</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-02-14 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/rules/refurb/rules/subclass_builtin.rs</code>:82 on 2025-02-14 15:57</div>
            <div class="timeline-body"><p>I think we could use <code>map_subscript</code> here, similar to e.g.</p>
<p>https://github.com/astral-sh/ruff/blob/46fe17767d3d5cf7b1f7729b024fca7821d19264/crates/ruff_linter/src/rules/flake8_bugbear/rules/mutable_contextvar_default.rs#L98-L100</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-14 15:58</div>
            <div class="timeline-body"><p>Nice. I&#x27;ve a small nit comment but that otherwise looks good to go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-14 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-14 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/vladNed">@vladNed</a> on <code>crates/ruff_linter/src/rules/refurb/rules/subclass_builtin.rs</code>:82 on 2025-02-14 18:08</div>
            <div class="timeline-body"><p>didn&#x27;t know about the <code>map_subscript</code> function. Just modified the logic to use it, seems a lot more clean.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vladNed">@vladNed</a> reviewed on 2025-02-14 18:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/vladNed">@vladNed</a> on 2025-02-14 18:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-14 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-14 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-15 03:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:11:27 UTC
    </footer>
</body>
</html>
