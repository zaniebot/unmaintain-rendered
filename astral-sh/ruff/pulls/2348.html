<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-use-pathlib`] autofix and new rules - astral-sh/ruff #2348</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-use-pathlib</code>] autofix and new rules</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/2348">#2348</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2023-01-30 11:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a></div>
            <div class="timeline-body"><p>See also #2331 and #2090</p>
<p>Kick-off pathlib autofix. The others could mostly be implemented in the same logic, but perhaps good to test with only this small subset to see what occurs in the wild.</p>
<p>PTH201-205:</p>
<ul>
<li>~~Simplify path constructor <code>Path(&quot;.&quot;)</code> to <code>Path()</code>~~</li>
<li>~~Replace <code>os.path.getsize</code> with <code>Path.stat()</code>~~</li>
<li>~~Using PTH2XX rather than FURBXXX (rules originate from <a href="https://github.com/charliermarsh/ruff/issues/1348"><code>refurb</code></a>) to keep all <code>pathlib</code> logic together~~</li>
</ul>
<p>Autofix for:</p>
<ul>
<li>~~PTH201: <code>Path(&quot;.&quot;)</code> to <code>Path()</code>~~</li>
<li>PTH109: <code>os.path.getcwd(x)</code> to <code>Path(x).cwd()</code></li>
</ul>
<p>Nested calls are unwrapped:</p>
<ul>
<li><code>Path(os.path.getcwd(x))</code> =&gt; <code>Path(x).cwd()</code></li>
</ul>
<p>Promote <code>get_member_import_name_alias</code> from <code>pylint</code> to <code>ast.helpers</code></p>
<p>Follow-up work items:</p>
<ul>
<li>Add (<code>from pathlib import Path</code>) or remove (<code>os</code>/<code>os.path</code>) imports (tracked by https://github.com/charliermarsh/ruff/issues/835)</li>
<li>Check if the input type for <code>os.path.stats</code> is not <code>int</code> (<a href="https://docs.python.org/3/library/os.html#os.stat">open file descriptors</a> are not supported in the pathlib version). My guess is that this feature is probably not widely used, and people could use <code>os.path.lstat</code> to prevent lints (next to #noqa).</li>
<li>Alias PTH2XX with their corresponding FURB codes (after mapping is merged: https://github.com/charliermarsh/ruff/pull/2517)</li>
<li>~~Naming convention: rename from pathlib-* to os(-path)-*~~</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-30 22:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_use_pathlib/fixes.rs</code>:17 on 2023-01-30 22:24</div>
            <div class="timeline-body"><p>I think we should guard all of these to only autofix if <code>Path</code> is imported and available as <code>Path</code>. (Are we already doing that? I admittedly haven't read the PR through fully.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Kilo59">@Kilo59</a> reviewed on 2023-01-31 03:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Kilo59">@Kilo59</a> on <code>src/rules/flake8_use_pathlib/fixes.rs</code>:17 on 2023-01-31 03:36</div>
            <div class="timeline-body"><p>Just my 2 cents.
I think <code>Path</code> could be somewhat ambiguous.
I tend always to use the fully qualified <code>pathlib.Path</code> version.</p>
<p>I've been bitten at least once before by seeing a <code>Path</code> object, assuming it's a <code>pathlib.Path</code> object only to find out it's something like a <code>glom.Path</code>.
https://glom.readthedocs.io/en/latest/api.html#glom.Path
There's a least one other popular library that uses a <code>Path</code> object but I'm having trouble remembering it. üòÖ</p>
<p>Very excited about these auto-fixes BTW üöÄ ‚ù§Ô∏è</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-31 03:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_use_pathlib/fixes.rs</code>:17 on 2023-01-31 03:54</div>
            <div class="timeline-body"><p>Yeah we have the ability to ensure that whatever's referenced is indeed <code>pathlib.Path</code>, even in the following cases:</p>
<pre><code class="language-py">import pathlib
pathlib.Path  # OK!

from pathlib import Path
Path  # OK!

from pathlib import Path as P
P  # OK!

Path = 1 + 2
Path  # Not OK!
</code></pre>
<p>So we <em>should</em> be able to support and preserve whatever import style is used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-01-31 10:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/flake8_use_pathlib/fixes.rs</code>:17 on 2023-01-31 10:13</div>
            <div class="timeline-body"><p>Will introduce the guarding, great suggestion. Thank you. Same for the testing for import (we already check if the fully qualified name is pathlib.Path), the replacement should now also take that into account.</p>
<p>Related, but could also open a dedicated issue for them:</p>
<ul>
<li><p>How is the user notified of this behaviour? I suggest expanding the autofix documentation to include these kinds of directions.</p>
</li>
<li><p>Say the user would like to autofix the code base, should they first do a manual pass through the code to add all imports? This seems suboptimal from a user perspective. There is a similar challenge with future annotations, with the difference that they become obsolete when the python target increases.</p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>src/rules/flake8_use_pathlib/fixes.rs</code>:17 on 2023-01-31 13:00</div>
            <div class="timeline-body"><p>(We have some logic for this in <code>src/rules/pylint/rules/use_sys_exit.rs</code>, hopefully it can be generalized.)</p>
<p>Hmm. I'm not sure I have great answers. The best long-term solution, probably, would be to fix #835 so we <em>can</em> add the import as part of the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-01-31 13:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-02-10 04:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sbrugman">@sbrugman</a> on <code>src/rules/flake8_use_pathlib/fixes.rs</code>:17 on 2023-02-11 00:55</div>
            <div class="timeline-body"><p>(Still working on this btw)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a> reviewed on 2023-02-11 00:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @sbrugman on 2023-02-11 10:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "flake8-use-pathlib autofix and new rules" to "[`flake8-use-pathlib`] autofix and new rules" by @sbrugman on 2023-02-11 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-30 02:12</div>
            <div class="timeline-body"><p>We should finally be able to support this once #3787 lands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aqeelat">@aqeelat</a> on 2023-06-06 09:15</div>
            <div class="timeline-body"><p>@sbrugman just to remind you that #3787 was merged and I think you can get the ball rolling again on this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-06-06 09:23</div>
            <div class="timeline-body"><p>Anyone interested, feel free to pick up where this PR left off (@aqeelat perhaps?). I'd like to work on it, but do not expect it to fit soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aqeelat">@aqeelat</a> on 2023-06-26 16:55</div>
            <div class="timeline-body"><blockquote>
<p>Anyone interested, feel free to pick up where this PR left off (@aqeelat perhaps?). I'd like to work on it, but do not expect it to fit soon.</p>
</blockquote>
<p>I honestly have 0 rust experience and I'm not comfortable taking over.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-21 03:26</div>
            <div class="timeline-body"><p>@sbrugman - Should we close this out given that it's being ported over in chunks to new PRs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sbrugman on 2023-07-21 03:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-10 21:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:55:53 UTC
    </footer>
</body>
</html>
