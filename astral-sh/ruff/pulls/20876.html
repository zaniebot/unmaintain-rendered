<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Sync vendored typeshed stubs - astral-sh/ruff #20876</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Sync vendored typeshed stubs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20876">#20876</a>
        opened by <a href="https://github.com/github-actions">@github-actions</a>
        on 2025-10-15 00:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/github-actions">@github-actions</a> on 2025-10-15 00:40</div>
            <div class="timeline-body"><p>Close and reopen this PR to trigger CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @github-actions[bot] on 2025-10-15 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-10-15 05:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @sharkdp on 2025-10-15 05:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-15 05:12</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<details>
<summary>Changes were detected when running ty on typing conformance tests</summary>

<pre><code class="language-diff">--- old-output.txt	2025-10-15 08:46:46.391831607 +0000
+++ new-output.txt	2025-10-15 08:46:49.708854720 +0000
@@ -1,5 +1,5 @@
 fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/29ab321/src/function/execute.rs:217:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_type_statement.py`: `PEP695TypeAliasType &lt; 'db &gt;::value_type_(Id(d017)): execute: too many cycle iterations`
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/29ab321/src/function/execute.rs:217:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(1643f)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/29ab321/src/function/execute.rs:217:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(16443)): execute: too many cycle iterations`
 _directives_deprecated_library.py:15:31: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 _directives_deprecated_library.py:30:26: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-15 05:13</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">setuptools (https://github.com/pypa/setuptools)
+ setuptools/_vendor/inflect/__init__.py:2279:49: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ setuptools/_vendor/inflect/__init__.py:2283:54: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 799 diagnostics
+ Found 801 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
- scripts/contrib-patch-tests.py:34:69: error[unresolved-attribute] Type `expr` has no attribute `id`
- Found 7578 diagnostics
+ Found 7577 diagnostics

</code></pre>
</details>
No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-15 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-15 07:17</div>
            <div class="timeline-body"><!-- generated-comment ty ecosystem-analyzer -->

<h2><code>ecosystem-analyzer</code> results</h2>
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>unused-ignore-comment</code> | 2 | 0 | 0 |
| <code>unresolved-attribute</code> | 0 | 1 | 0 |
| <strong>Total</strong> | <strong>2</strong> | <strong>1</strong> | <strong>0</strong> |</p>
<p><strong><a href="https://typeshedbot-sync-typeshed.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://typeshedbot-sync-typeshed.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 07:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/union.md</code>:87 on 2025-10-15 07:49</div>
            <div class="timeline-body"><p>This is due to https://github.com/python/typeshed/pull/14813. It's not technically incorrect, but breaks in cases that previously relied on the <code>@Todo</code> type to shadow false positives. We may need to special-case <code>type.__or__</code>'s return type (for now)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 07:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_ide/src/completion.rs</code>:977 on 2025-10-15 07:52</div>
            <div class="timeline-body"><p>This also &quot;breaks&quot; because we previously inferred a <code>@Todo</code> type, and <code>@Todo</code> types are generally hidden ... (why?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-15 07:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:977 on 2025-10-15 07:59</div>
            <div class="timeline-body"><p>Only specifically TypeAlias-related TODOs are suppressed from autocompletions: https://github.com/astral-sh/ruff/blob/4fc7dd300c493fc16ea279928a2ad353e070c92e/crates/ty_python_semantic/src/types/ide_support.rs#L272</p>
<p>We never want private type aliases appearing in autocompletions. The special Todo variant was the best way I could think of doing this without PEP-613 support</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-15 08:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_ide/src/completion.rs</code>:977 on 2025-10-15 08:01</div>
            <div class="timeline-body"><p>Instances of UnionType are also suppressed, because they're almost certainly implicit type aliases, and we don't support them yet either, but we never want private type aliases from stubs appearing in autocompletions because they don't exist at runtime: https://github.com/astral-sh/ruff/blob/4fc7dd300c493fc16ea279928a2ad353e070c92e/crates/ty_python_semantic/src/types/ide_support.rs#L262</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-10-15 08:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/union.md</code>:87 on 2025-10-15 08:09</div>
            <div class="timeline-body"><blockquote>
<p>We may need to special-case <code>type.__or__</code>'s return type (for now)?</p>
</blockquote>
<p>That sounds reasonable. Sorry I didn't give any warning that this was coming — completely forgot about all the special casing we have for PEP-604 unions and type aliases when I merged that typeshed PR :-(</p>
<p>It might be easiest to work in the special case at a higher level, in inference of <code>|</code> operations in <code>infer/builder.rs</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 08:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_ide/src/completion.rs</code>:977 on 2025-10-15 08:21</div>
            <div class="timeline-body"><blockquote>
<p>Instances of UnionType are also suppressed</p>
</blockquote>
<p>This is why it breaks, because now it's <code>UnionType | &lt;class 'int'&gt;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by @sharkdp on 2025-10-15 08:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by @sharkdp on 2025-10-15 08:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-10-15 08:51</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-10-15 08:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/union.md</code>:87 on 2025-10-15 08:53</div>
            <div class="timeline-body"><blockquote>
<p>Sorry I didn't give any warning that this was coming — completely forgot about all the special casing we have for PEP-604 unions and type aliases when I merged that typeshed PR :-(</p>
</blockquote>
<p>We certainly didn't expect you to. This also looks innocent enough :smiley:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-10-15 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-10-15 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-15 09:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:35:00 UTC
    </footer>
</body>
</html>
