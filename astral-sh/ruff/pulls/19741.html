<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Infer `type[tuple[int, str]]` as the meta-type of `tuple[int, str]` - astral-sh/ruff #19741</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Infer <code>type[tuple[int, str]]</code> as the meta-type of <code>tuple[int, str]</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19741">#19741</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-08-04 11:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-04 11:26</div>
            <div class="timeline-body"><p>This PR is based on top of #19735; review that one first!</p>
<h2>Summary</h2>
<p>The type <code>tuple[str, int]</code> does not only have exact instances of <code>tuple</code> as its inhabitants: its inhabitants also include any instances of subclasses of <code>tuple[str, int]</code>. As such, the meta-type of <code>tuple[str, int]</code> should be <code>type[tuple[str, int]]</code> rather than <code>&lt;class 'tuple[str, int]'&gt;</code>. The former accurately reflects the fact that given an instance of <code>tuple[str, int]</code>, we do not know exactly what the <code>__class__</code> of that instance will be: we only know that it will be a subclass of <code>tuple[str, int]</code>. The latter (what we currently infer) is incorrectly precise: it implies that all instances of <code>tuple[str, int]</code> have the runtime object <code>tuple</code> as their <code>__class__</code>, which isn't true.</p>
<h2>Test Plan</h2>
<p>Mdtests updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-08-04 11:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-04 11:27</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on typing conformance tests</h2>
<p>No changes detected when running ty on typing conformance tests âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-04 11:30</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…
No memory usage changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AlexWaygood on 2025-08-04 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-08-04 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-08-04 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-08-04 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2025-08-04 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6091 on 2025-08-04 12:58</div>
            <div class="timeline-body"><p>Would it be sufficient to just call <code>class.is_not_generic()</code> here? I think that will handle all three cases (class literal, generic alias, subclass-of) correctly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6091 on 2025-08-04 12:59</div>
            <div class="timeline-body"><p>Does this comment no longer apply? It doesn't look like this PR changes the logic that this refers to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> approved on 2025-08-04 13:00</div>
            <div class="timeline-body"><p>couple of nits, otherwise looks good</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6091 on 2025-08-04 13:02</div>
            <div class="timeline-body"><p>oops, didn't mean to delete that! Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-04 13:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-04 13:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6091 on 2025-08-04 13:05</div>
            <div class="timeline-body"><p>ðŸ¤¦ that's so much simpler; not sure why I didn't think of that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-04 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6091 on 2025-08-04 13:07</div>
            <div class="timeline-body"><p>added it back</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-08-04 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-08-04 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-04 13:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:52:43 UTC
    </footer>
</body>
</html>
