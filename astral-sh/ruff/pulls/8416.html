<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add new ecosystem comparison modes for the formatter - astral-sh/ruff #8416</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add new ecosystem comparison modes for the formatter</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8416">#8416</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-11-01 18:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-01 18:07</div>
            <div class="timeline-body"><p>Previously, the ecosystem checks formatted with the baseline then formatted again with <code>--diff</code> to get the changed files.</p>
<p>Now, the ecosystem checks support a new mode where we:</p>
<ul>
<li>Format with the baseline</li>
<li>Commit the changes</li>
<li>Reset to the target ref</li>
<li>Format again</li>
<li>Check the diff from the baseline commit</li>
</ul>
<p>This effectively tests Ruff changes on unformatted code rather than changes in previously formatted code (unless, of course, the project is already using Ruff).</p>
<p>While this mode is the new default, I've retained the old one for local checks. The mode can be toggled with <code>--format-comparison &lt;type&gt;</code>.</p>
<p>Includes some more aggressive resetting of the GitHub repositories when cached.</p>
<p>Here, I've also stubbed comparison modes in which <code>black</code> is used as the baseline. While these do nothing here, #8419 adds support.</p>
<p>I tested this with the commit from #8216 and ecosystem changes appear https://gist.github.com/zanieb/a982ec8c392939043613267474471a6e</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2023-11-01 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2023-11-01 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @zanieb on 2023-11-01 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @zanieb on 2023-11-01 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-11-01 19:31</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>python/ruff-ecosystem/ruff_ecosystem/format.py</code>:138 on 2023-11-02 00:57</div>
            <div class="timeline-body"><p>Oh that's cool</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>python/ruff-ecosystem/ruff_ecosystem/format.py</code>:240 on 2023-11-02 00:57</div>
            <div class="timeline-body"><p>Python noob question: What's the reason for using inline comments here instead of docstrings?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-11-02 00:58</div>
            <div class="timeline-body"><p>Thank you. I love the different modes for running it locally</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>python/ruff-ecosystem/ruff_ecosystem/format.py</code>:240 on 2023-11-02 01:05</div>
            <div class="timeline-body"><p>I don't think there's a formalized way to document class attributes individually. Generally what you do is create a class docstring and then document the members using an 'Attributes' section, but that felt like more work than I wanted to do here ðŸ˜¬</p>
<p>tldr a docstring for the class is proper but I was lazy. I wish we had tooling to generate the scaffold.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-02 01:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-02 01:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>python/ruff-ecosystem/ruff_ecosystem/format.py</code>:240 on 2023-11-02 01:09</div>
            <div class="timeline-body"><p>I even just wrote it out and it feels awkward; I guess I write Rust now</p>
<pre><code class="language-python">class FormatComparison(Enum):
    &quot;&quot;&quot;
    The type of format comparison to use.

    Attributes:
        ruff_then_ruff: Run Ruff baseline then Ruff comparison; checks for changes in
            behavior when formatting previously &quot;formatted&quot; code
        ruff_and_ruff: Run Ruff baseline then reset and run Ruff comparison; checks
            changes in behavior when formatting &quot;unformatted&quot; code
        black_then_ruff: Run Black baseline then Ruff comparison; checks for changes in
            behavior when formatting previously &quot;formatted&quot; code
        black_and_ruff: Run Black baseline then reset and run Ruff comparison; checks
            changes in behavior when formatting &quot;unformatted&quot; code
    &quot;&quot;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-02 01:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>python/ruff-ecosystem/ruff_ecosystem/format.py</code>:240 on 2023-11-02 01:12</div>
            <div class="timeline-body"><p>Some additional resources:</p>
<ul>
<li>https://peps.python.org/pep-0258/#attribute-docstrings</li>
<li>https://github.com/microsoft/pylance-release/issues/1576</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>python/ruff-ecosystem/ruff_ecosystem/format.py</code>:240 on 2023-11-02 01:14</div>
            <div class="timeline-body"><p>Since you nudged, I switched to individual attribute docstrings â€” while the PEP is rejected, VSCode supports it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-02 01:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2023-11-02 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-11-02 01:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-02 01:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:13:16 UTC
    </footer>
</body>
</html>
