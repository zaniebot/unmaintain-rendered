<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Rename *_ty functions - astral-sh/ruff #15617</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Rename *_ty functions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15617">#15617</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-01-20 13:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-01-20 13:44</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>General rules:</p>
<ul>
<li>Change the <code>_ty</code> suffix of all functions to <code>_type</code>.</li>
<li><code>_type_and_qualifiers</code> suffixes seem too long, so we ignore the existence of qualifiers and still speak of &quot;types&quot;</li>
<li>Functions only have a <code>_type</code> suffix if they return either <code>Type</code>, <code>Option&lt;Type&gt;</code>, or <code>TypeAndQualifiers</code></li>
</ul>
<p>Free functions:</p>
<ul>
<li><code>binding_ty</code> =&gt; <code>binding_type</code></li>
<li><code>declaration_ty</code> =&gt; <code>declaration_type</code></li>
<li><code>definition_expression_ty</code> =&gt; <code>definition_expression_type</code></li>
</ul>
<p>Methods:</p>
<ul>
<li><code>CallDunderResult::return_ty</code> =&gt; <code>return_type</code></li>
<li><code>NotCallableError::return_ty</code> =&gt; <code>return_type</code></li>
<li><code>NotCallableError::called_ty</code> =&gt; <code>called_type</code></li>
<li><code>TypeAndQualifiers::inner_ty</code> =&gt; <code>inner_type</code></li>
<li><code>TypeAliasType::value_ty</code> =&gt; <code>value_type</code></li>
<li><code>TypeInference::expression_ty</code> =&gt; <code>expression_type</code></li>
<li><code>TypeInference::try_expression_ty</code> =&gt; <code>try_expression_type</code></li>
<li><code>TypeInference::binding_ty</code> =&gt; <code>binding_type</code></li>
<li><code>TypeInference::declaration_ty</code> =&gt; <code>declaration_type</code></li>
<li><code>TypeInferenceBuilder::expression_ty</code> =&gt; <code>expression_type</code></li>
<li><code>TypeInferenceBuilder::file_expression_ty</code> =&gt; <code>file_expression_type</code></li>
<li><code>TypeInferenceBuilder::module_ty_from_name</code> =&gt; <code>module_type_from_name</code></li>
<li><code>ClassBase::try_from_ty</code> =&gt; <code>try_from_type</code></li>
<li><code>Parameter::annotated_ty</code> =&gt; <code>annotated_type</code></li>
<li><code>Parameter::default_ty</code> =&gt; <code>default_type</code></li>
<li><code>CallOutcome::return_ty</code> =&gt; <code>return_type</code></li>
<li><code>CallOutcome::return_ty_result</code> =&gt; <code>return_type_result</code></li>
<li><code>CallBinding::from_return_ty</code> =&gt; <code>from_return_type</code></li>
<li><code>CallBinding::set_return_ty</code> =&gt; <code>set_return_type</code></li>
<li><code>CallBinding::return_ty</code> =&gt; <code>return_type</code></li>
<li><code>CallBinding::parameter_tys</code> =&gt; <code>parameter_types</code></li>
<li><code>CallBinding::one_parameter_ty</code> =&gt; <code>one_parameter_type</code></li>
<li><code>CallBinding::two_parameter_tys</code> =&gt; <code>two_parameter_types</code></li>
<li><code>Unpacker::tuple_ty_elements</code> =&gt; <code>tuple_type_elements</code></li>
<li><code>StringPartsCollector::ty</code> =&gt; <code>string_type</code></li>
</ul>
<p>Traits</p>
<ul>
<li><code>HasTy</code> =&gt; <code>HasType</code></li>
<li><code>HasTy::ty</code> =&gt; <code>inferred_type</code></li>
</ul>
<p>Test functions:</p>
<ul>
<li><code>assert_public_ty</code> =&gt; <code>assert_public_type</code></li>
<li><code>assert_scope_ty</code> =&gt; <code>assert_scope_type</code></li>
</ul>
<p>closes #15569</p>
<h2>Test Plan</h2>
<p>—</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @sharkdp on 2025-01-20 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @sharkdp on 2025-01-20 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-20 13:53</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-20 13:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_project/tests/check.rs</code>:201 on 2025-01-20 13:59</div>
            <div class="timeline-body"><p>Getters are rather unidiomatic in the rust ecosystem. I think I prefer keeping <code>ty</code> here (<code>r#type</code> is too annoying to type).</p>
<p>Or possibly <code>infer_type</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-01-20 14:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-20 14:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_project/tests/check.rs</code>:200 on 2025-01-20 14:23</div>
            <div class="timeline-body"><p>We may want to wait for @carljm's feedback. I could see how he objects to <code>inferred_type</code> because it does return the declared type for classes or when the expression is in an annotation position...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-01-20 14:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/red_knot_project/tests/check.rs</code>:200 on 2025-01-20 14:27</div>
            <div class="timeline-body"><p>If so, then we should probably also change the documentation of the trait (<em>&quot;Returns the inferred type of <code>self</code>&quot;</em>):</p>
<pre><code class="language-rs">pub trait HasType {
    /// Returns the inferred type of `self`.
    ///
    /// ## Panics
    /// May panic if `self` is from another file than `model`.
    fn inferred_type&lt;'db&gt;(&amp;self, model: &amp;SemanticModel&lt;'db&gt;) -&gt; Type&lt;'db&gt;;
}
</code></pre>
<p>I would think that maybe here in <code>semantic_model.rs</code>, we may not want to distinguish between declared/inferred type. They're all types that are generated by &quot;Type inference&quot;.</p>
<p>But yes, I'll leave this open for further discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-01-22 00:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_project/tests/check.rs</code>:200 on 2025-01-22 00:05</div>
            <div class="timeline-body"><blockquote>
<p>I would think that maybe here in <code>semantic_model.rs</code>, we may not want to distinguish between declared/inferred type. They're all types that are generated by &quot;Type inference&quot;.</p>
</blockquote>
<p>Yes, I agree with this and I'm fine with the name changes in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @sharkdp on 2025-01-22 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @sharkdp on 2025-01-22 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @sharkdp on 2025-01-22 08:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-01-22 08:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-22 08:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 20:06:11 UTC
    </footer>
</body>
</html>
