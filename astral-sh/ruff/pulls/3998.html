<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use musl in ecosystem docker - astral-sh/ruff #3998</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use musl in ecosystem docker</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/3998">#3998</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-04-17 16:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>This prevents errors when the host glibc is newer than the one in the docker container</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/konstin">@konstin</a> on 2023-04-17 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/konstin">@konstin</a> on 2023-04-17 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-17 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/Cargo.toml</code>:68 on 2023-04-17 16:23</div>
            <div class="timeline-body"><p>Saw the deprecation warning when i looked at the release ci job</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-04-17 16:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:24</div>
            <div class="timeline-body"><p>I feel like this was necessary for some reason.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:25</div>
            <div class="timeline-body"><p>yes, but it&#x27;s now moved to pyproject.toml: https://github.com/PyO3/maturin/blob/main/Changelog.md#01416---2023-03-26</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-17 16:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-04-17 16:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:25</div>
            <div class="timeline-body"><p>Mmm, maybe not?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Skylion007">@Skylion007</a> reviewed on 2023-04-17 16:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Skylion007">@Skylion007</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:26</div>
            <div class="timeline-body"><p>Can confirm, saw this warning when building locally with pip too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Skylion007">@Skylion007</a> reviewed on 2023-04-17 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Skylion007">@Skylion007</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:28</div>
            <div class="timeline-body"><p>@konstin Don&#x27;t we need to update the <code>maturin</code> version in the <code>[build-system] requires</code> section of the pyproject for pip building though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-17 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:28</div>
            <div class="timeline-body"><p>wdym? the deprecation warning comes from https://github.com/charliermarsh/ruff/actions/runs/4614388337/jobs/8157296671#step:5:531 and i&#x27;ve built the wheel and it looks correct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-04-17 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-17 16:29</div>
            <div class="timeline-body"><p>Nice... do we need to disable jemalloc because I run into:</p>
<p>error: failed to run custom build command for <code>tikv-jemalloc-sys v0.5.3+5.3.0-patched</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Skylion007">@Skylion007</a> reviewed on 2023-04-17 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Skylion007">@Skylion007</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:29</div>
            <div class="timeline-body"><p>@konstin Referring to this line: https://github.com/charliermarsh/ruff/blob/280dffb5e161acb9deab97c9a2158055e4174d66/pyproject.toml#L2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Skylion007">@Skylion007</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:30</div>
            <div class="timeline-body"><p>It needs to be bumped to <code>0.14.16</code> at least, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Skylion007">@Skylion007</a> reviewed on 2023-04-17 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-17 16:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:34</div>
            <div class="timeline-body"><p>hmm i actually always get the correct wheel with just <code>maturin build</code> and no name explicitly set now, but that also seems correct since we&#x27;re not shipping a python package but only a script which already has the correct name set: https://github.com/charliermarsh/ruff/blob/07759652c68a85efa9eebdff600c34a5d72fa588/crates/ruff_cli/Cargo.toml#L15-L16</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-17 16:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-17 16:34</div>
            <div class="timeline-body"><p>huh what os are you building on?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-17 16:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_cli/Cargo.toml</code>:69 on 2023-04-17 16:35</div>
            <div class="timeline-body"><p>i&#x27;ve bumped it to 0.14.17 now, just to avoid testing different combinations of versions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-04-17 16:35</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>✅ ecosystem check detected no changes.</p>
Benchmark
Linux
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     15.1±0.03ms     2.7 MB/sec    1.00     15.0±0.02ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.8±0.00ms     4.4 MB/sec    1.00      3.8±0.01ms     4.4 MB/sec
linter/all-rules/numpy/globals.py          1.00    416.3±1.11µs     7.1 MB/sec    1.00    414.8±1.87µs     7.1 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.5±0.01ms     3.9 MB/sec    1.00      6.4±0.01ms     4.0 MB/sec
linter/default-rules/large/dataset.py      1.00      7.8±0.01ms     5.2 MB/sec    1.00      7.8±0.01ms     5.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01   1746.4±2.35µs     9.5 MB/sec    1.00   1727.7±2.43µs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.00    180.7±0.41µs    16.3 MB/sec    1.00    180.7±0.51µs    16.3 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.6±0.00ms     7.0 MB/sec    1.00      3.6±0.00ms     7.1 MB/sec
parser/large/dataset.py                    1.00      6.2±0.00ms     6.5 MB/sec    1.00      6.3±0.01ms     6.5 MB/sec
parser/numpy/ctypeslib.py                  1.00   1232.5±1.40µs    13.5 MB/sec    1.01   1240.9±1.03µs    13.4 MB/sec
parser/numpy/globals.py                    1.00    124.1±0.44µs    23.8 MB/sec    1.01    125.3±0.49µs    23.5 MB/sec
parser/pydantic/types.py                   1.00      2.7±0.00ms     9.4 MB/sec    1.00      2.7±0.00ms     9.4 MB/sec
</code></pre>
Windows
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     16.3±0.22ms     2.5 MB/sec    1.01     16.4±0.23ms     2.5 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.3±0.13ms     3.9 MB/sec    1.00      4.3±0.10ms     3.9 MB/sec
linter/all-rules/numpy/globals.py          1.00   439.1±12.36µs     6.7 MB/sec    1.01   442.0±10.75µs     6.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.0±0.09ms     3.7 MB/sec    1.01      7.0±0.16ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.2±0.07ms     5.0 MB/sec    1.02      8.3±0.13ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1787.9±25.84µs     9.3 MB/sec    1.01  1802.2±29.30µs     9.2 MB/sec
linter/default-rules/numpy/globals.py      1.00    186.6±4.95µs    15.8 MB/sec    1.01    187.9±4.48µs    15.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.8±0.05ms     6.8 MB/sec    1.01      3.8±0.05ms     6.7 MB/sec
parser/large/dataset.py                    1.01      6.7±0.12ms     6.1 MB/sec    1.00      6.6±0.07ms     6.1 MB/sec
parser/numpy/ctypeslib.py                  1.00  1270.4±16.20µs    13.1 MB/sec    1.01  1277.1±23.52µs    13.0 MB/sec
parser/numpy/globals.py                    1.00    127.6±1.50µs    23.1 MB/sec    1.00    128.0±2.62µs    23.0 MB/sec
parser/pydantic/types.py                   1.00      2.8±0.05ms     9.0 MB/sec    1.00      2.8±0.05ms     9.0 MB/sec
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-04-17 16:46</div>
            <div class="timeline-body"><p>I&#x27;ve removed the maturin changes here and opened #3999 separately</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-04-18 08:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-18 08:39</div>
            <div class="timeline-body"><p>Manjaro (arch) x86....</p>
<p>It seems that some files are missing</p>
<pre><code>  --- stderr
  running &quot;musl-gcc&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-m64&quot; &quot;-I&quot; &quot;include&quot; &quot;-Wall&quot; &quot;-Wextra&quot; &quot;-pedantic&quot; &quot;-pedantic-errors&quot; &quot;-Wall&quot; &quot;-Wextra&quot; &quot;-Wcast-align&quot; &quot;-Wcast-qual&quot; &quot;-Wconversion&quot; &quot;-Wenum-compare&quot; &quot;-Wfloat-equal&quot; &quot;-Wformat=2&quot; &quot;-Winline&quot; &quot;-Winvalid-pch&quot; &quot;-Wmissing-field-initializers&quot; &quot;-Wmissing-include-dirs&quot; &quot;-Wredundant-decls&quot; &quot;-Wshadow&quot; &quot;-Wsign-compare&quot; &quot;-Wsign-conversion&quot; &quot;-Wundef&quot; &quot;-Wuninitialized&quot; &quot;-Wwrite-strings&quot; &quot;-fno-strict-aliasing&quot; &quot;-fvisibility=hidden&quot; &quot;-fstack-protector&quot; &quot;-g3&quot; &quot;-U_FORTIFY_SOURCE&quot; &quot;-DNDEBUG&quot; &quot;-c&quot; &quot;-o/home/micha/astral/ruff/target/x86_64-unknown-linux-musl/release/build/ring-6202016dbf886143/out/aesni-x86_64-elf.o&quot; &quot;/home/micha/.cargo/registry/src/github.com-1ecc6299db9ec823/ring-0.16.20/pregenerated/aesni-x86_64-elf.S&quot;
  thread &#x27;main&#x27; panicked at &#x27;failed to execute [&quot;musl-gcc&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-m64&quot; &quot;-I&quot; &quot;include&quot; &quot;-Wall&quot; &quot;-Wextra&quot; &quot;-pedantic&quot; &quot;-pedantic-errors&quot; &quot;-Wall&quot; &quot;-Wextra&quot; &quot;-Wcast-align&quot; &quot;-Wcast-qual&quot; &quot;-Wconversion&quot; &quot;-Wenum-compare&quot; &quot;-Wfloat-equal&quot; &quot;-Wformat=2&quot; &quot;-Winline&quot; &quot;-Winvalid-pch&quot; &quot;-Wmissing-field-initializers&quot; &quot;-Wmissing-include-dirs&quot; &quot;-Wredundant-decls&quot; &quot;-Wshadow&quot; &quot;-Wsign-compare&quot; &quot;-Wsign-conversion&quot; &quot;-Wundef&quot; &quot;-Wuninitialized&quot; &quot;-Wwrite-strings&quot; &quot;-fno-strict-aliasing&quot; &quot;-fvisibility=hidden&quot; &quot;-fstack-protector&quot; &quot;-g3&quot; &quot;-U_FORTIFY_SOURCE&quot; &quot;-DNDEBUG&quot; &quot;-c&quot; &quot;-o/home/micha/astral/ruff/target/x86_64-unknown-linux-musl/release/build/ring-6202016dbf886143/out/aesni-x86_64-elf.o&quot; &quot;/home/micha/.cargo/registry/src/github.com-1ecc6299db9ec823/ring-0.16.20/pregenerated/aesni-x86_64-elf.S&quot;]: No such file or directory (os error 2)&#x27;, /home/micha/.cargo/registry/src/github.com-1ecc6299db9ec823/ring-0.16.20/build.rs:653:9
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

</code></pre>
<p>Running <code>cargo clean</code> nor building with <code>--release</code> helped</p>
<p>Edit: <a href="https://github.com/briansmith/ring/issues/1414">briansmith/ring#1414</a>#issuecomment-1055177218</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-04-18 08:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-18 08:42</div>
            <div class="timeline-body"><p>Solution:</p>
<p>I had to install <code>musl</code> (<code>yay musl</code>). For debian <code>apt-get install musl-tools</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-04-18 08:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-18 08:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-18 08:47</div>
            <div class="timeline-body"><p>how does this compare to the experience with zig? i&#x27;m trying to figure out which one to recommend</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-04-18 08:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-18 08:58</div>
            <div class="timeline-body"><p>It&#x27;s very similar. With Zig, I had to install <code>zig</code> and I had to install <code>musl</code> with this approach.</p>
<p>I&#x27;m a complete docker noob but is there an image (even if slightly larger in size) that uses a more recent <code>glibc</code> version to avoid cross-compiling?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-04-18 09:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/Dockerfile.ecosystem</code>:12 on 2023-04-18 09:12</div>
            <div class="timeline-body"><p>thanks, added it to the documentation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2023-04-26 03:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2023-04-26 03:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-04-26 03:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:53:17 UTC
    </footer>
</body>
</html>
