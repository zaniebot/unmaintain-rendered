<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add tests for `match` statement - astral-sh/ruff #10831</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add tests for <code>match</code> statement</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/10831">#10831</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-04-08 05:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-08 05:52</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds test cases for the <code>match</code> statement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by @dhruvmanila on 2024-04-08 05:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @dhruvmanila on 2024-04-08 05:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-08 05:57</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/dhruv/match-stmt">CodSpeed Performance Report</a></h2>
<h3>Merging #10831 will <strong>degrade performances by 8.2%</strong></h3>
<p><sub>Comparing <code>dhruv/match-stmt</code> (7cfc054) with <code>dhruv/parser</code> (5cfeaa9)</sub></p>
<h3>Summary</h3>
<p><code>⚡ 1</code> improvements
<code>❌ 2</code> regressions
<code>✅ 27</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/dhruv/match-stmt">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>dhruv/parser</code> | <code>dhruv/match-stmt</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>parser[large/dataset.py]</code> | 26.5 ms | 28.7 ms | -7.72% |
| ❌ | <code>parser[pydantic/types.py]</code> | 10.8 ms | 11.8 ms | -8.2% |
| ⚡ | <code>parser[unicode/pypinyin.py]</code> | 1.7 ms | 1.6 ms | +5.38% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @dhruvmanila on 2024-04-08 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @dhruvmanila on 2024-04-08 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2183 on 2024-04-09 08:40</div>
            <div class="timeline-body"><p>Should this be <code>expect</code> because the <code>Dedent</code> is required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-09 08:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 08:42</div>
            <div class="timeline-body"><p>Should this use the list parsing infrastructure to ensure that the statement recovery correctly recovers when seeing a <code>case</code> keyword:</p>
<pre><code>match x:
    case &quot;test&quot;:
        async
                
    case &quot;b&quot;: # The statement recovery should not eat over the `case` keyword
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-04-09 08:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 16:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 16:21</div>
            <div class="timeline-body"><p>I'm not sure which is why I didn't change. Can you give an example of where this would be useful? The provided one parses both <code>case</code> blocks as expected. We could probably use <code>parse_clauses</code> but that doesn't perform error recovery.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @dhruvmanila on 2024-04-09 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-04-09 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-04-09 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 16:25</div>
            <div class="timeline-body"><p>I don't have a specific example but something where the expression parsing goes into recovery. It then skips over all tokens that aren't the start of a statement or expression, which is why I would expect that it skips over the <code>case</code> keyword.</p>
<p>Or does that not happen today because the <code>case</code> keyword is parsed as a <code>Name</code> rather than the <code>case</code> keyword because the soft keyword tokenizer gets confused?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-09 16:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 16:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 16:27</div>
            <div class="timeline-body"><p>I think it should be ok because of the <code>Dedent</code> token? I'll need to think about this but I do understand what you're trying to say.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-09 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 16:28</div>
            <div class="timeline-body"><blockquote>
<p>but I do understand what you're trying to say.</p>
</blockquote>
<p>That's good haha</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2024-04-09 16:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 16:30</div>
            <div class="timeline-body"><p>Just to be clear, in case of any error in any of the case block, the parser should continue parsing the remaining case blocks as is, right? That is, it shouldn't consume the <code>case</code> keyword or name for the error recovery in previous case block.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-04-09 16:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_parser/src/parser/statement.rs</code>:2233 on 2024-04-09 16:32</div>
            <div class="timeline-body"><p>Yes, it shouldn't consume the <code>case</code> because it's a valid recovery point.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 22:37:33 UTC
    </footer>
</body>
</html>
