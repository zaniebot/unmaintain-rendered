<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Move, rename and make public the `PyVersion` type - astral-sh/ruff #12782</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Move, rename and make public the <code>PyVersion</code> type</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12782">#12782</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-08-09 12:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-09 12:16</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Working on https://github.com/astral-sh/ruff/pull/12759 has revealed that we need a general-purpose type that represents an arbitrary Python version (not necessarily one that we <em>support</em>), as well as a closed enumeration of supported Python versions. We actually already have a type like that -- but it's currently buried in <code>red_knot_python_semantic::module_resolver::typeshed::versions</code>. This PR publicly exposes that type, and moves both that type and the <code>TargetVersion</code> enum into a new <code>red_knot_python_semantic::python_version</code> submodule. This will allow the type to be used in https://github.com/astral-sh/ruff/pull/12759, and possibly elsewhere in the future as well.</p>
<h2>Test Plan</h2>
<p><code>cargo test -p red_knot_python_semantic</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2024-08-09 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2024-08-09 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2024-08-09 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-09 12:29</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/python_version.rs</code>:5 on 2024-08-09 15:41</div>
            <div class="timeline-body"><p>Should this be <code>TargetVersion</code>?</p>
<pre><code class="language-suggestion">/// TODO: unify with the `TargetVersion` enum in the linter/formatter crates?
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/red_knot_python_semantic/src/python_version.rs</code>:57 on 2024-08-09 15:44</div>
            <div class="timeline-body"><p>We don't need to make this change in this PR but I think it's now a bit confusing when to use <code>TargetVersion</code> vs <code>PythonVersion</code>? Shouldn't all (or at least most) our code be open for new Python versions? Or to phrase it differently, what's the benefit of limiting <code>TargetVersion</code> to a fixed set?</p>
<p>To me, the main reason why <code>TargetVersion</code> is an enum is just that it was easier to reference specific versions. But I think that can also be accomplished by <code>PythonVersion</code>, we can define constants for the versions that we care about (and we can implement <code>Default</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2024-08-09 15:44</div>
            <div class="timeline-body"><p>Merge conflicts ahead :laughing:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-09 15:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/python_version.rs</code>:5 on 2024-08-09 15:47</div>
            <div class="timeline-body"><p>The equivalent enum in the linter/formatter crates is called <code>PythonVersion</code>, e.g. https://github.com/astral-sh/ruff/blob/b595346213c5343c27fc8ff152f15b85c7b7d44d/crates/ruff_linter/src/settings/types.rs#L45, and that's what this comment is referring to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-09 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/red_knot_python_semantic/src/python_version.rs</code>:57 on 2024-08-09 15:48</div>
            <div class="timeline-body"><p>Hmm, maybe. Having it as an enum is also useful for command-line parsing. But you might be right that we could just use the <code>PythonVersion</code> type everywhere. Not sure; worth experimenting with as a followup, anyway!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Move `red_knot_python_semantic::module_resolver::typeshed::versions::PyVersion`, and make it public" to "[red-knot] Move, rename and make public the `PyVersion` type" by @AlexWaygood on 2024-08-09 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-08-09 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-08-09 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-09 15:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:39:01 UTC
    </footer>
</body>
</html>
