<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rebuild ruff binary instead of sharing it across jobs - astral-sh/ruff #21361</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rebuild ruff binary instead of sharing it across jobs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21361">#21361</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-11-10 10:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body">Summary
<p>Similar to ty&#x27;s ecosystem check, build ruff from source during the ecosytem check intsead of downloading the binary from the <code>test</code> job.</p>
<p>Building ruff from source is relatively fast and waiting for the test job before starting the ecosystem check also only delays it unnecessarily and has the downside that the job fails if <code>main</code> hasn&#x27;t uploaded the <code>ruff</code> binary yet (because the test job is still running or failed).</p>
<p>This also simplifies the CI pipeline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-10 10:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-10 10:35</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-10 12:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-10 12:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-10 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:484 on 2025-11-10 12:32</div>
            <div class="timeline-body"><p>if you run the script without the <code>--test-executable</code> flag set, it defaults to building a binary itself using <code>cargo build --profile=profiling</code>. So you could possibly simplify this job even more by omitting this flag, and not even building Ruff as a separate step.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:534 on 2025-11-10 12:33</div>
            <div class="timeline-body"><p>Is this checkout for the baseline version? For mypy_primer, the typing conformance suite diff, and the ty fuzzer we checkout the baseline version using this logic:</p>
<p>https://github.com/astral-sh/ruff/blob/ada3208de50d3dce3aacb393ea23b35416bed593/.github/workflows/ci.yaml#L660-L661</p>
<p>Not sure if there&#x27;s any difference between the two, but I have a lot of confidence in the logic we&#x27;re using elsewhere because we&#x27;ve been using it for a while and I haven&#x27;t observed any problems with it ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-11-10 12:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:534 on 2025-11-10 12:53</div>
            <div class="timeline-body"><p>Possibly, The idea was to migrate the workflow while keeping the same semantics. However, using <code>MERGE_BASE</code> would fix the issue where someone merges changes to main when your PR isn&#x27;t updated yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:534 on 2025-11-10 12:54</div>
            <div class="timeline-body"><p>I&#x27;ll leave this for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-10 12:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:470 on 2025-11-10 12:55</div>
            <div class="timeline-body"><p>now that the script is doing the build itself (and using <code>--profile=profiling</code> internally), the debug build won&#x27;t be a good cache key anymore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:470 on 2025-11-10 12:59</div>
            <div class="timeline-body"><p>Yeah, I just wanted to say that I revert this change as it also switches to profiling builds</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 12:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-11-10 13:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>.github/workflows/ci.yaml</code>:470 on 2025-11-10 13:00</div>
            <div class="timeline-body"><p>sounds good</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-11-10 13:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>.github/workflows/ci.yaml</code>:484 on 2025-11-10 13:00</div>
            <div class="timeline-body"><p>I won&#x27;t make this change because it also results in switching from debug to profiling builds. The idea of this PR is to not change behavior other than switching to freshly built ruff binaries over downloading them</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-10 13:01</div>
            <div class="timeline-body"><p>Cool that the ecosystem check now completes before some of the tests ðŸ˜ƒ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-10 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-10 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-10 13:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:22 UTC
    </footer>
</body>
</html>
