<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`flake8-pytest-style`] Fix defaults when `lint.flake8-pytest-style` config section is empty (`PT001`, `PT023`) - astral-sh/ruff #13292</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>flake8-pytest-style</code>] Fix defaults when <code>lint.flake8-pytest-style</code> config section is empty (<code>PT001</code>, <code>PT023</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13292">#13292</a>
        opened by <a href="https://github.com/dizzy57">@dizzy57</a>
        on 2024-09-09 13:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dizzy57">@dizzy57</a> on 2024-09-09 13:59</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>The documentation states that <code>lint.flake8-pytest-style.*-parentheses</code> options default to <code>false</code>, but if the user provides an empty <code>[lint.flake8-pytest-style]</code> config section, those options are suddenly set to <code>true</code>.</p>
<p>This is a bug. After #12838 changed the defaults, <code>Flake8PytestStyleOptions::try_into_settings</code> wasn't updated and still relies on the preview mode to set the defaults.</p>
<h2>Reproduction</h2>
<pre><code>% ruff --version
ruff 0.6.4

% cat example.py
import pytest


@pytest.fixture()
def parentheses(): ...


@pytest.fixture
def no_parentheses(): ...

% ruff check --select PT001 --output-format concise example.py
example.py:4:1: PT001 [*] Use `@pytest.fixture` over `@pytest.fixture()`
Found 1 error.
[*] 1 fixable with the `--fix` option.

% echo '[lint.flake8-pytest-style]' &gt; ruff.toml

% ruff check --select PT001 --output-format concise example.py
example.py:8:1: PT001 [*] Use `@pytest.fixture()` over `@pytest.fixture`
Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<h2>Test Plan</h2>
<p>Manual testing, see reproduction section.</p>
<pre><code>% ./target/debug/ruff check --select PT001 --output-format concise example.py
warning: Detected debug build without --no-cache.
example.py:4:1: PT001 [*] Use `@pytest.fixture` over `@pytest.fixture()`
Found 1 error.
[*] 1 fixable with the `--fix` option.

% echo '[lint.flake8-pytest-style]' &gt; ruff.toml

% ./target/debug/ruff check --select PT001 --output-format concise example.py
warning: Detected debug build without --no-cache.
example.py:4:1: PT001 [*] Use `@pytest.fixture` over `@pytest.fixture()`
Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>Given the fact that this was the only reference to <code>ruff_linter::settings::types::PreviewMode</code> in <code>crates/ruff_workspace/src/options.rs</code>, looks like no other settings depend on the preview mode, and it doesn't make much sense to me to write any additional tests that verify there's no interaction between preview mode and other default values.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[`flake8-pytest-style`] Fix defaults for missing `lint.flake8-pytest-style.*-parentheses` configs (`PT001`, `PT023`)" to "[`flake8-pytest-style`] Fix defaults when `lint.flake8-pytest-style` config section is empty (`PT001`, `PT023`)" by @dizzy57 on 2024-09-09 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-09-09 14:14</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-09-09 20:53</div>
            <div class="timeline-body"><p>LGTM! Sorry we didn't catch this, that's on us :-(</p>
<p>Unfortunately, however, this is will be a breaking change for some users, so we'll have to merge this as part of the 0.7 release. That should come at some point in the next few weeks, though; shouldn't be too long to wait :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.7" by @AlexWaygood on 2024-09-09 20:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @MichaReiser on 2024-09-09 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2024-09-09 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-10-08 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-10-08 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-08 17:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:00:06 UTC
    </footer>
</body>
</html>
