<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standardise ruff config - astral-sh/ruff #15558</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Standardise ruff config</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15558">#15558</a>
        opened by <a href="https://github.com/calumy">@calumy</a>
        on 2025-01-17 21:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a></div>
            <div class="timeline-body">

Summary
<p>Follow up to #15544 and <a href="https://github.com/astral-sh/ruff/pull/15544">astral-sh/ruff#15544</a>#pullrequestreview-2559748582 to move the Ruff config used in scripts into the <code>pyproject.toml</code> in the root directory now that Python scripts are being added outwith the scripts directory.</p>
<p>Only changes required relate to line length. I have updated to split at 88 characters; however, if a <code>noqa</code> would be better in this instance, please let me know, and I can update.</p>
Test Plan
<ul>
<li>Pre-commit ci stage to ensure that all changes identified by the new config are caught.</li>
<li>The new ci step added in #15544 (https://github.com/astral-sh/ruff/blob/main/.github/workflows/ci.yaml#L389-L393) to ensure that the updated line lengths don&#x27;t produce an incorrect result.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/calumy">@calumy</a> on 2025-01-17 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/calumy">@calumy</a> on 2025-01-17 21:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2025-01-17 21:28</div>
            <div class="timeline-body"><p>The test failure appears to be from the <code>display_default_settings</code> test relying on the <code>pyproject.toml</code> config in the root directory for its default values. I think there are a couple of ways to fix this (potentially more):</p>
<ul>
<li>Update the <code>display_default_settings</code> snapshot to include the now updated settings</li>
<li>Update the test to continue to use the default settings by updating the <code>pyproject.toml</code> file used in the test</li>
</ul>
<p>I would appreciate some guidance on how best to approach a fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-17 21:52</div>
            <div class="timeline-body"><blockquote>
<ul>
<li>Update the <code>display_default_settings</code> snapshot to include the now updated settings</li>
</ul>
</blockquote>
<p>This is what we&#x27;ve done in the past whenever we&#x27;ve updated the pyproject.toml settings :-) it&#x27;s a bit silly but it&#x27;s easy</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>pyproject.toml</code>:90 on 2025-01-17 21:53</div>
            <div class="timeline-body"><p>I think this no longer conflicts with the formatter now we have the 2025 style! We can probably remove this exclusion now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>pyproject.toml</code>:92 on 2025-01-17 21:54</div>
            <div class="timeline-body"><pre><code>  # which seems unlikely for any of the scripts in this repo
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>pyproject.toml</code>:61 on 2025-01-17 21:54</div>
            <div class="timeline-body"><p>Some of our scripts require newer Python versions than this, but this seems fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-01-17 21:55</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-17 21:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a> reviewed on 2025-01-17 22:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/calumy">@calumy</a> on <code>pyproject.toml</code>:61 on 2025-01-17 22:07</div>
            <div class="timeline-body"><p>Most scripts do; however, https://github.com/astral-sh/ruff/blob/main/python/ruff/<strong>main</strong>.py#L17  assumes that less than 3.10 may be used, so I went for the lowest currently supported Python version.</p>
<p>Ref: https://devguide.python.org/versions/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a> reviewed on 2025-01-17 22:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/calumy">@calumy</a> on <code>pyproject.toml</code>:90 on 2025-01-17 22:09</div>
            <div class="timeline-body"><p>Updated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/calumy">@calumy</a> on 2025-01-17 22:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>scripts/pyproject.toml</code>:36 on 2025-01-17 22:26</div>
            <div class="timeline-body"><p>Do we still need this tool.ruff section? Can&#x27;t we just remove it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-17 22:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-17 22:29</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>✅ ecosystem check detected no format changes.</p>
Formatter (preview)
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a> reviewed on 2025-01-17 22:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/calumy">@calumy</a> on <code>scripts/pyproject.toml</code>:36 on 2025-01-17 22:31</div>
            <div class="timeline-body"><p>If it isn&#x27;t added, then the following error is raised as the python version in the root directory is &gt;=3.9 and in the scripts directory is &gt;=3.11.</p>
<pre><code>&gt; uv tool run pre-commit run --all-files ruff
ruff.....................................................................Failed
- hook id: ruff
- exit code: 1

scripts/check_ecosystem.py:286:20: F821 Undefined name `ExceptionGroup`. Consider specifying `requires-python = &quot;&gt;= 3.11&quot;` or `tool.ruff.target-version = &quot;py311&quot;` in your `pyproject.toml` file.
    |
284 |                         ),
285 |                     )
286 |             except ExceptionGroup as e:
    |                    ^^^^^^^^^^^^^^ F821
287 |                 raise e.exceptions[0] from e
    |

Found 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a> reviewed on 2025-01-17 22:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/calumy">@calumy</a> on <code>scripts/pyproject.toml</code>:36 on 2025-01-17 22:33</div>
            <div class="timeline-body"><p>3.9 is required in the root directory for this reason: <a href="https://github.com/astral-sh/ruff/pull/15558">astral-sh/ruff#15558</a>#discussion_r1920816322</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-18 14:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/tests/snapshots/show_settings__display_default_settings.snap</code>:74 on 2025-01-18 14:11</div>
            <div class="timeline-body"><p>I think we have to fix this test to be isolated from our own <code>pyproject.toml</code>. It otherwise becomes very annoying because it requires updating whenever we add or remove a rule from any enabled category.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-18 14:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/generate.py</code>:178 on 2025-01-18 14:12</div>
            <div class="timeline-body"><p>Splitting this over multiple line decreases readability. I suggest disabling E501 and keep it as regular string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-18 14:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>pyproject.toml</code>:61 on 2025-01-18 14:13</div>
            <div class="timeline-body"><p>This should be Py38 then.</p>
<pre><code>target-version = &quot;py38&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-18 14:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>pyproject.toml</code>:69 on 2025-01-18 14:13</div>
            <div class="timeline-body"><pre><code></code></pre>
<p>This is the default</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/tests/snapshots/show_settings__display_default_settings.snap</code>:74 on 2025-01-20 09:18</div>
            <div class="timeline-body"><p>Done in <a href="https://github.com/astral-sh/ruff/pull/15610">astral-sh/ruff#15610</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-20 09:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a> reviewed on 2025-01-20 14:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/calumy">@calumy</a> on <code>crates/ruff/tests/snapshots/show_settings__display_default_settings.snap</code>:74 on 2025-01-20 14:01</div>
            <div class="timeline-body"><p>Thanks. I&#x27;ll rebase and update as required</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2025-01-21 10:06</div>
            <div class="timeline-body"><p>Apologies for the delay; this should now be ready for review.</p>
<p>Note: There may be some interference with #15632, cc @sharkdp, as some line lengths exceed the default 88 characters. Depending on merge order, I can rebase again as required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-21 11:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>pyproject.toml</code>:14 on 2025-01-21 11:01</div>
            <div class="timeline-body"><p>I was about to revert this change, but we use 4 spaces according to our editorconfig.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-01-21 11:02</div>
            <div class="timeline-body"><p>Nice, thank you. I disable E501 globally. We rely on the formatter and the good judgement of everyone writing code to not go overboard with very long lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-21 11:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-21 11:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/calumy">@calumy</a> reviewed on 2025-01-21 12:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/calumy">@calumy</a> on <code>crates/ruff_python_ast/generate.py</code>:177 on 2025-01-21 12:16</div>
            <div class="timeline-body"><p>@MichaReiser, I wonder if the removal of unnecessary <code>&quot;&quot;&quot;</code> from strings is something that could be handled by a future iteration of the formatter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-01-21 12:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/generate.py</code>:177 on 2025-01-21 12:18</div>
            <div class="timeline-body"><p>Changing from triple to single quoted style feels too opinionated for a formatter.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:10:30 UTC
    </footer>
</body>
</html>
