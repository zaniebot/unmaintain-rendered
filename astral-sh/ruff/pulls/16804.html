<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Check subtype relation between callable types - astral-sh/ruff #16804</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Check subtype relation between callable types</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16804">#16804</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-03-17 14:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>Part of #15382</p>
<p>This PR adds support for checking the subtype relationship between the two callable types.</p>
<p>The main source of reference used for implementation is https://typing.python.org/en/latest/spec/callables.html#assignability-rules-for-callables.</p>
<p>The implementation is split into two phases:</p>
<ol>
<li>Check all the positional parameters which includes positional-only, standard (positional or keyword) and variadic kind</li>
<li>Collect all the keywords in a <code>HashMap</code> to do the keyword parameters check via name lookup</li>
</ol>
<p>For (1), there&#x27;s a helper struct which is similar to <code>.zip_longest</code> (from <code>itertools</code>) except that it allows control over one of the iterator as that&#x27;s required when processing a variadic parameter. This is required because positional parameters needs to be checked as per their position between the two callable types. The struct also keeps track of the current iteration element because when the loop is exited (to move on to the phase 2) the current iteration element would be carried over to the phase 2 check.</p>
<p>This struct is internal to the <code>is_subtype_of</code> method as I don&#x27;t think it makes sense to expose it outside. It also allows me to use &quot;self&quot; and &quot;other&quot; suffixed field names as that&#x27;s only relevant in that context.</p>
Test Plan
<p>Add extensive tests in markdown.</p>
<p>Converted all of the code snippets from https://typing.python.org/en/latest/spec/callables.html#assignability-rules-for-callables to use <code>knot_extensions.is_subtype_of</code> and verified the result.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-17 14:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[WIP] [red-knot] Fix fully static check for callable type&quot; to &quot;[WIP] [red-knot] Check subtype relation between callable types&quot; by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-17 14:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-17 14:31</div>
            <div class="timeline-body">

<code>mypy_primer</code> results
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:607 on 2025-03-18 00:05</div>
            <div class="timeline-body"><p>I think we need to expand on this slightly; &quot;behaves in the same way&quot; isn&#x27;t very clear what it&#x27;s referring to.</p>
<p>Also, the first part seems to be phrased backward? If you take a pair of callable types, each with a single standard parameter, that form a subtype relation, you can&#x27;t replace the standard parameter with a keyword-only parameter in the <em>subtype</em> and have it &quot;behave the same way&quot;, you can only do that in the supertype.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:503 on 2025-03-18 00:06</div>
            <div class="timeline-body"><p>Might be good to add some tests with more than 0-1 parameters?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:630 on 2025-03-18 00:06</div>
            <div class="timeline-body"><pre><code>And, the same is true for positional-only parameter except that the names are not required to be the
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:678 on 2025-03-18 00:07</div>
            <div class="timeline-body"><p>Don&#x27;t you mean &quot;omitted in the supertype&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:777 on 2025-03-18 00:07</div>
            <div class="timeline-body"><p>I guess we still similar need tests for keyword-variadic with keyword-only?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-03-18 00:17</div>
            <div class="timeline-body"><p>This is looking really good! I don&#x27;t have any significant advice based on what&#x27;s here already; happy to consider any specific problems you&#x27;re having with completing the PR.</p>
<p>I think that when we add assignability for callable types, it will make most sense to just expand this function to handle gradual types also and rename it <code>is_assignable_to</code>. Then the function can work both for <code>is_subtype_of</code> and <code>is_assignable_to</code>, in the former case it will just never receive a non-fully-static callable type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-18 10:42</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-18 12:23</div>
            <div class="timeline-body"><blockquote>
<p>I think that when we add assignability for callable types, it will make most sense to just expand this function to handle gradual types also and rename it <code>is_assignable_to</code>. Then the function can work both for <code>is_subtype_of</code> and <code>is_assignable_to</code>, in the former case it will just never receive a non-fully-static callable type.</p>
</blockquote>
<p>Yeah, I think that makes sense. For now, I did make the assumption that we&#x27;re only getting fully static types so I avoided the fallback to <code>Unknown</code> if there is no annotated type, mainly to avoid any surprise behavior but that shouldn&#x27;t be too difficult to change to <code>unwrap_or(Type::unknown())</code>. And, if the entire parameter type is using a gradual form (<code>...</code>) then we can directly short-circuit the implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:607 on 2025-03-19 04:53</div>
            <div class="timeline-body"><p>Yeah, thanks for catching that, I&#x27;ve updated this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-19 04:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-19 04:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:503 on 2025-03-19 04:53</div>
            <div class="timeline-body"><p>Added tests with multiple parameters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-19 04:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:678 on 2025-03-19 04:54</div>
            <div class="timeline-body"><p>Yes ðŸ¤¦</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-19 04:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:777 on 2025-03-19 04:55</div>
            <div class="timeline-body"><p>Yeah, I&#x27;ve added them, they were still WIP at that moment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[WIP] [red-knot] Check subtype relation between callable types&quot; to &quot;[red-knot] Check subtype relation between callable types&quot; by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-19 06:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-19 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-19 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-19 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-19 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-19 13:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4912 on 2025-03-19 13:06</div>
            <div class="timeline-body"><p>I think I need to change this up because then there&#x27;s no way to differentiate between keyword-variadic parameter being absent and that the annotated type is absent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4912 on 2025-03-19 13:10</div>
            <div class="timeline-body"><p>Done in <a href="https://github.com/astral-sh/ruff/pull/16804">astral-sh/ruff#16804</a>/commits/12ff6b9243317fed7ac7a947d3bf6951caf5b84b</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-19 13:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:545 on 2025-03-19 15:35</div>
            <div class="timeline-body"><pre><code>The subtype can include any number of positional-only parameters as long as they have the default value:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:663 on 2025-03-19 15:42</div>
            <div class="timeline-body"><p>Do we have any test that the reverse does not work? (Keyword-only in subtype cannot substitute for standard in supertype)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:701 on 2025-03-19 15:43</div>
            <div class="timeline-body"><p>Similar to above -- do we have any test that you cannot substitute a standard parameter in supertype with a positional-only in subtype?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:741 on 2025-03-19 15:47</div>
            <div class="timeline-body"><p>This describes the opposite situation from what is tested below -- below we test standard parameter in subtype and variadic or keyword-variadic in supertype.</p>
<p>But both directions should not work (and we should probably test both?). The only version that should work is substituting a standard parameter in supertype with <em>both</em> a variadic and keyword-variadic parameter in subtype (both with compatible type).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4990 on 2025-03-19 16:23</div>
            <div class="timeline-body"><p>It&#x27;s possible that argument lists will tend to be short enough that it will be cheaper to use a Vec and just iterate through it than to pay the overhead of hashing. But I&#x27;m fine leaving this for a future performance investigation if we see this code as a hot spot. A mapping is semantically the appropriate data structure here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4990 on 2025-03-19 16:26</div>
            <div class="timeline-body"><p>I think we probably should just return <code>false</code> here (with a comment that this case is only reachable with an invalid AST). It&#x27;s important that we not panic on invalid AST. (It would also be worth adding a corpus test with an invalid function definition that triggers this branch, if that&#x27;s possible.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-03-19 16:27</div>
            <div class="timeline-body"><p>This looks really good!! Quite a complex feature, thanks for working through it so thoroughly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-20 11:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:663 on 2025-03-20 11:45</div>
            <div class="timeline-body"><p>Yes, https://github.com/astral-sh/ruff/blob/12ff6b9243317fed7ac7a947d3bf6951caf5b84b/crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md#keyword-only-with-standard</p>
<p>This combination <code>(keyword-only, positional-or-keyword)</code> is handled by the catch-all branch in the first loop.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-20 11:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:701 on 2025-03-20 11:47</div>
            <div class="timeline-body"><p>Yes, https://github.com/astral-sh/ruff/blob/12ff6b9243317fed7ac7a947d3bf6951caf5b84b/crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md#positional-only-with-other-kinds</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4990 on 2025-03-20 11:58</div>
            <div class="timeline-body"><p>Yeah, another option is to use <a href="https://docs.rs/smallmap/latest/smallmap/index.html"><code>smallmap</code></a> crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-20 11:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-20 12:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:4990 on 2025-03-20 12:09</div>
            <div class="timeline-body"><p>I&#x27;m not able to get any syntax to trigger this branch this can only occur if there are any other parameter after a keyword-only or a keyword-variadic parameter. I think a lot of the invalid cases are handled by the catch-all case in the previous loop and the parser will never be able to construct positional-only / standard parameter after a keyword-only / keyword-variadic parameter is encountered. But, I&#x27;ll still update this to return false as we want red-knot to be resilient here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-03-20 12:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md</code>:741 on 2025-03-20 12:11</div>
            <div class="timeline-body"><blockquote>
<p>This describes the opposite situation from what is tested below -- below we test standard parameter in subtype and variadic or keyword-variadic in supertype.</p>
</blockquote>
<p>Thanks, I&#x27;ve fixed the sentence.</p>
<blockquote>
<p>But both directions should not work (and we should probably test both?). The only version that should work is substituting a standard parameter in supertype with <em>both</em> a variadic and keyword-variadic parameter in subtype (both with compatible type).</p>
</blockquote>
<p>Yes, there was a test for the opposite direction but it was limited to standard parameter, I expanded it to consider other kinds as well here: https://github.com/astral-sh/ruff/blob/a519c2e011e0c2468fbcbc392a359c766f05d064/crates/red_knot_python_semantic/resources/mdtest/type_properties/is_subtype_of.md#variadic-with-other-kinds</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-03-20 23:06</div>
            <div class="timeline-body"><p>This is really excellent!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-03-20 23:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/red_knot_python_semantic/src/types.rs</code>:665 on 2025-03-20 23:08</div>
            <div class="timeline-body"><p>Seems like we can get rid of this TODO now? Or at least replace it with something more specific?</p>
<pre><code>                // TODO: Implement subtyping between general callable types and other types (function literals, class literals, `type[]`...)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-21 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-21 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-21 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-24 14:10</div>
            <div class="timeline-body"><p>Very nice work! One minor question: should <code>Callable</code>s be a subtype of <code>object</code>? Should this pass?</p>
<pre><code>from knot_extensions import static_assert, is_subtype_of
from typing import Callable

static_assert(is_subtype_of(Callable[[int], str], object))
</code></pre>
<p>https://playknot.ruff.rs/2fd03ad6-c4d9-45e5-bde5-8f2d1ec55abc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-24 14:56</div>
            <div class="timeline-body"><blockquote>
<p>One minor question: should <code>Callable</code>s be a subtype of <code>object</code>? Should this pass?</p>
</blockquote>
<p>Hmm, good question. I think not because <code>object</code> is not callable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-24 14:59</div>
            <div class="timeline-body"><blockquote>
<p>Hmm, good question. I think not because object is not callable.</p>
</blockquote>
<p>That&#x27;s opposite to the way you should think about it -- all fully static types should be a subtype of <code>object</code>.</p>
<p>Consider the way that all instance types are a subtype of <code>object</code>. For example, the <code>bool</code> type extends the features and properties of <code>object</code> (it is an (indirect) subtype of <code>object</code>); thus <code>bool</code> is a subtype of <code>object</code> even though not all instances of <code>object</code> are instances of <code>bool</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-03-24 15:00</div>
            <div class="timeline-body"><p>Callables (fully static ones) should be a subtype of <code>object</code>. The type <code>object</code> is inhabited by all Python objects, so all (fully static) types are subtypes of <code>object</code>.</p>
<p>It is true that all objects are not callable, but this means that object is not a subtype of Callable.</p>
<p>In my understanding this PR wasn&#x27;t aiming to be comprehensive yet, it was just handling the core calculation of signature subtyping. We have other relations missing as well, eg a FunctionLiteral can be a subtype of a Callable type. Also an Instance type with a <code>__call__</code> method. And a ClassLiteral type (based on its constructor signature.) And arguably SubclassOf as well, though this one is not sound since we won&#x27;t enforce Liskov on constructor signatures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-24 15:15</div>
            <div class="timeline-body"><blockquote>
<p>Callables (fully static ones) should be a subtype of <code>object</code>. The type <code>object</code> is inhabited by all Python objects, so all (fully static) types are subtypes of <code>object</code>.</p>
</blockquote>
<p>Yeah, I think I got it backwards, thanks.</p>
<blockquote>
<p>In my understanding this PR wasn&#x27;t aiming to be comprehensive yet, it was just handling the core calculation of signature subtyping. We have other relations missing as well, eg a FunctionLiteral can be a subtype of a Callable type. Also an Instance type with a <code>__call__</code> method. And a ClassLiteral type (based on its constructor signature.) And arguably SubclassOf as well, though this one is not sound since we won&#x27;t enforce Liskov on constructor signatures.</p>
</blockquote>
<p>Yes, that is correct. I&#x27;ll open an issue to keep track of the remaining relationship, it might be something that a contributor could pick up.</p>
<p>Edit: <a href="https://github.com/astral-sh/ruff/issues/16953">astral-sh/ruff#16953</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:25 UTC
    </footer>
</body>
</html>
