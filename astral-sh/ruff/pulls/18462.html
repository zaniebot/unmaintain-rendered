<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Experiment: Opaque type aliases - astral-sh/ruff #18462</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Experiment: Opaque type aliases</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18462">#18462</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-06-04 14:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff/ty! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title? (Please prefix with `[ty]` for ty pull
  requests.)
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Do not review.</p>
<p>Would currently allows us to move <code>artigraph</code> and <code>home-assistant/core</code> to <code>good.txt</code></p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @sharkdp on 2025-06-04 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-06-04 14:33</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_INSTRUMENTATION_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/ruff/branches/david%2Fopaque-type-aliases">CodSpeed Performance Report</a></h2>
<h3>Merging #18462 will <strong>degrade performances by 46.56%</strong></h3>
<p><sub>Comparing <code>david/opaque-type-aliases</code> (969efae) with <code>main</code> (f1883d7)</sub></p>
<h3>Summary</h3>
<p><code>❌ 2</code> regressions<br />
<code>✅ 32</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/ruff/branches/david%2Fopaque-type-aliases">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>ty_check_file[incremental]</code> | 5.3 ms | 5.7 ms | -5.65% |
| ❌ | <code>ty_micro[many_tuple_assignments]</code> | 180.8 ms | 338.3 ms | -46.56% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-04 14:50</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">async-utils (https://github.com/mikeshardmind/async-utils)
- error[call-non-callable] src/async_utils/corofunc_cache.py:98:30: Object of type `None` is not callable
+ error[call-non-callable] src/async_utils/corofunc_cache.py:98:30: Object of type `CacheTransformer | None` is not callable
- error[call-non-callable] src/async_utils/corofunc_cache.py:177:30: Object of type `None` is not callable
+ error[call-non-callable] src/async_utils/corofunc_cache.py:177:30: Object of type `CacheTransformer | None` is not callable
- error[call-non-callable] src/async_utils/task_cache.py:158:30: Object of type `None` is not callable
+ error[call-non-callable] src/async_utils/task_cache.py:158:30: Object of type `CacheTransformer | None` is not callable
- error[call-non-callable] src/async_utils/task_cache.py:244:30: Object of type `None` is not callable
+ error[call-non-callable] src/async_utils/task_cache.py:244:30: Object of type `CacheTransformer | None` is not callable

mitmproxy (https://github.com/mitmproxy/mitmproxy)
+ error[invalid-return-type] mitmproxy/contentviews/_view_image/image_parser.py:34:12: Return type does not match returned value: expected `ImageMetadata`, found `list[Unknown]`
+ error[invalid-return-type] mitmproxy/contentviews/_view_image/image_parser.py:60:12: Return type does not match returned value: expected `ImageMetadata`, found `list[Unknown]`
+ error[invalid-return-type] mitmproxy/contentviews/_view_image/image_parser.py:94:12: Return type does not match returned value: expected `ImageMetadata`, found `list[Unknown]`
+ error[invalid-return-type] mitmproxy/contentviews/_view_image/image_parser.py:119:12: Return type does not match returned value: expected `ImageMetadata`, found `list[Unknown]`
+ error[invalid-assignment] mitmproxy/net/dns/https_records.py:48:9: Object of type `dict[Unknown, Unknown]` is not assignable to `HTTPSRecordJSON`
- error[invalid-argument-type] test/mitmproxy/contentviews/test__utils.py:23:38: Argument to function `make_metadata` is incorrect: Expected `Message | TCPMessage | UDPMessage | WebSocketMessage | DNSMessage`, found `Response | None`
+ error[invalid-argument-type] test/mitmproxy/contentviews/test__utils.py:23:38: Argument to function `make_metadata` is incorrect: Expected `ContentviewMessage`, found `Response | None`
+ error[invalid-argument-type] test/mitmproxy/net/dns/test_https_records.py:126:13: Argument to bound method `from_json` is incorrect: Expected `HTTPSRecordJSON`, found `dict[Unknown, Unknown]`
- Found 2107 diagnostics
+ Found 2113 diagnostics

openlibrary (https://github.com/internetarchive/openlibrary)
+ error[invalid-return-type] openlibrary/catalog/add_book/match.py:215:16: Return type does not match returned value: expected `ThresholdResult`, found `tuple[Literal[&quot;date&quot;], Literal[&quot;value missing&quot;], Unknown | Literal[-800]]`
+ error[invalid-return-type] openlibrary/catalog/add_book/match.py:225:12: Return type does not match returned value: expected `ThresholdResult`, found `tuple[Literal[&quot;date&quot;], Literal[&quot;mismatch&quot;], Unknown | Literal[-800]]`
+ error[invalid-return-type] openlibrary/catalog/add_book/match.py:234:24: Return type does not match returned value: expected `ThresholdResult`, found `tuple[Literal[&quot;ISBN&quot;], Literal[&quot;match&quot;], Unknown | Literal[85]]`
+ error[invalid-return-type] openlibrary/catalog/add_book/match.py:298:16: Return type does not match returned value: expected `ThresholdResult`, found `tuple[Literal[&quot;authors&quot;], Literal[&quot;keyword match&quot;], Unknown &amp; ~AlwaysFalsy]`
- Found 733 diagnostics
+ Found 737 diagnostics

scikit-learn (https://github.com/scikit-learn/scikit-learn)
- warning[possibly-unbound-attribute] sklearn/preprocessing/_polynomial.py:1059:38: Attribute `tolil` on type `csr_array[float64, tuple[int, int]] | float64 | lil_array[float64]` is possibly unbound
- warning[possibly-unbound-attribute] sklearn/preprocessing/_polynomial.py:1071:38: Attribute `tolil` on type `csr_array[float64, tuple[int, int]] | float64 | lil_array[float64] | Unknown` is possibly unbound
- warning[possibly-unbound-attribute] sklearn/preprocessing/_polynomial.py:1099:42: Attribute `tolil` on type `csr_array[float64, tuple[int, int]] | float64 | lil_array[float64]` is possibly unbound
- warning[possibly-unbound-attribute] sklearn/preprocessing/_polynomial.py:1110:42: Attribute `tolil` on type `csr_array[float64, tuple[int, int]] | float64 | lil_array[float64] | Unknown` is possibly unbound
- warning[possibly-unbound-attribute] sklearn/preprocessing/_polynomial.py:1116:30: Attribute `tocsr` on type `csr_array[float64, tuple[int, int]] | float64 | lil_array[float64] | Unknown` is possibly unbound
- Found 2562 diagnostics
+ Found 2557 diagnostics

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-06-26 12:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:08 UTC
    </footer>
</body>
</html>
