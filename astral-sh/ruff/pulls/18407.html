<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync vendored typeshed stubs - astral-sh/ruff #18407</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Sync vendored typeshed stubs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/18407">#18407</a>
        opened by <a href="https://github.com/github-actions">@github-actions</a>
        on 2025-06-01 00:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/github-actions">@github-actions</a></div>
            <div class="timeline-body"><p>Close and reopen this PR to trigger CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @github-actions[bot] on 2025-06-01 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @github-actions[bot] on 2025-06-01 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @github-actions[bot] on 2025-06-01 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @github-actions[bot] on 2025-06-01 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @github-actions[bot] on 2025-06-01 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @github-actions[bot] on 2025-06-01 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-01 06:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @AlexWaygood on 2025-06-01 06:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-06-01 06:35</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">pytest (https://github.com/pytest-dev/pytest)
+ error[unknown-argument] src/_pytest/assertion/rewrite.py:735:55: Argument `lineno` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] src/_pytest/assertion/rewrite.py:735:70: Argument `col_offset` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] src/_pytest/assertion/rewrite.py:739:21: Argument `lineno` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] src/_pytest/assertion/rewrite.py:740:21: Argument `col_offset` does not match any known parameter of bound method `__init__`
- Found 882 diagnostics
+ Found 886 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ error[unknown-argument] ddtrace/appsec/_iast/_ast/visitor.py:424:21: Argument `lineno` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] ddtrace/appsec/_iast/_ast/visitor.py:425:21: Argument `col_offset` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] ddtrace/appsec/_iast/_ast/visitor.py:439:21: Argument `lineno` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] ddtrace/appsec/_iast/_ast/visitor.py:440:21: Argument `col_offset` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] ddtrace/appsec/_iast/_ast/visitor.py:454:21: Argument `lineno` does not match any known parameter of bound method `__init__`
+ error[unknown-argument] ddtrace/appsec/_iast/_ast/visitor.py:455:21: Argument `col_offset` does not match any known parameter of bound method `__init__`
- Found 6854 diagnostics
+ Found 6860 diagnostics

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-01 14:21</div>
            <div class="timeline-body"><p>The primer hits are from https://github.com/python/typeshed/pull/14103. It's interesting that there was no primer fallout in the typeshed PR there. I think this is because typeshed just runs primer with mypy on Python 3.13, so it didn't see any effect from a change that only effects <code>sys.version_info &lt; (3, 10)</code> branches. But in our primer runs on this repo, we use whatever the project has in their pyproject.toml for the configured Python version, and pytest <a href="https://github.com/pytest-dev/pytest/blob/261e7f15721a02cdc7361c60183b86fa36d0f72f/pyproject.toml#L26">says</a> they support 3.9+ -- so we assumed Python 3.9 when type-checking pytest in the mypy_primer run.</p>
<p>The change to the attribute annotations in that typeshed PR seem definitely correct, since <code>ast.alias</code> objects created by the interpreter won't ever have those attributes, so you cannot guarantee that any arbitrary <code>ast.alias</code> node will have those attributes on Python &lt;3.10. But it's the changes to <code>__init__</code> that are causing the primer hits here. I'm not totally convinced that those changes are useful, since <code>ast.alias.__init__</code> doesn't actually raise an exception if you pass those keywords when you're manually constructing <code>ast.alias</code> nodes on Python &lt;3.10 (it even sets the attributes in the way you'd expect), and the change makes it harder to write code that type-checks on multiple Python versions.</p>
<pre><code class="language-pycon">~/dev % uv run -p3.9 --no-project python
Python 3.9.6 (default, Mar 12 2025, 20:22:46) 
[Clang 17.0.0 (clang-1700.0.13.3)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import ast
&gt;&gt;&gt; ast.alias(&quot;foo&quot;, col_offset=39)
&lt;ast.alias object at 0x10429deb0&gt;
&gt;&gt;&gt; _.col_offset
39
</code></pre>
<p>Cc. @JelleZijlstra -- curious for your thoughts on this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-06-01 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-01 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-01 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2025-06-01 14:36</div>
            <div class="timeline-body"><p>I think it would be confusing if we allowed those attributes to be passed to <code>__init__</code> but not accessed as attributes.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:03 UTC
    </footer>
</body>
</html>
