<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server: Allow `FixAll` action in presence of version-specific syntax errors - astral-sh/ruff #16848</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Server: Allow <code>FixAll</code> action in presence of version-specific syntax errors</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16848">#16848</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2025-03-19 15:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>The single flag <code>has_syntax_error</code> on <code>LinterResult</code> is replaced with two (private) flags: <code>has_valid_syntax</code> and <code>has_no_unsupported_syntax_errors</code>, which record whether there are <code>ParseError</code>s or <code>UnsupportedSyntaxError</code>s, respectively. Only the former is used to prevent a <code>FixAll</code> action.</p>
<p>An attempt has been made to make consistent the usage of the phrases &quot;valid syntax&quot; (which seems to be used to refer only to <em>parser</em> errors) and &quot;syntax error&quot; (which refers to both <em>parser</em> errors and version-specific syntax errors).</p>
<p>Remark for review: <code>crates/ruff/src/diagnostics.rs</code> is actually a small diff, not sure what happened there. If you pull it down locally and <code>git diff --ignore-all-space</code> it looks better.</p>
<p>Closes #16841</p>
<p>Test:</p>
<p>https://github.com/user-attachments/assets/94f6ed6a-afdc-49f0-8a09-8e2123adb07a</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-19 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-19 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ntBre">@ntBre</a> by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-19 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-19 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-03-19 15:16</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> approved on 2025-03-19 15:22</div>
            <div class="timeline-body"><p>Thanks for jumping on this, LGTM! Just need to propagate the changes to the fuzz crate it looks like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-19 16:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/linter.rs</code>:634 on 2025-03-19 16:36</div>
            <div class="timeline-body"><p>I&#x27;m working on adding another type of syntax error now, which drew my attention back to this area. I think we actually want to use <code>has_no_syntax_errors</code> (from the first iteration) here to preserve the behavior of the old code instead of recomputing it (on the last iteration). Maybe we need two variables outside the loop now to capture them both from the first iteration?</p>
<p>I think the new errors (semantic/compile-time syntax errors) will be merged into the <code>has_no_unsupported_syntax_errors</code> variable to avoid blocking these fixes too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-19 18:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/linter.rs</code>:634 on 2025-03-19 18:09</div>
            <div class="timeline-body"><p>Will <code>has_no_syntax_errors</code> always be the same as <code>has_valid_syntax &amp;&amp; has_no_unsupported_syntax_errors</code> and will <code>has_no_unsupported_syntax_errors</code> always be the same as <code>parsed.unsupported_syntax_errors().is_empty()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-19 18:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/linter.rs</code>:634 on 2025-03-19 18:14</div>
            <div class="timeline-body"><p>(In other words - is <a href="https://github.com/astral-sh/ruff/pull/16848">astral-sh/ruff#16848</a>/commits/a7267ddecd3a3e01b479c58d8e4a99033f96b6b5 the correct interpretation of your suggestion here?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2025-03-19 18:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_linter/src/linter.rs</code>:634 on 2025-03-19 18:22</div>
            <div class="timeline-body"><p>Yeah I think that looks right. It&#x27;s unfortunate that we can&#x27;t use the <code>Parsed</code> method now, but I guess we really need to differentiate the two bools later instead of grouping them.</p>
<p>I&#x27;m thinking the semantic syntax errors will get grouped with the unsupported syntax errors, so I might tweak that name later, but this is exactly what I had in mind for now. Those don&#x27;t come from the parser, so they won&#x27;t affect the <code>Parsed</code> interface.</p>
<p>I guess we don&#x27;t have a test for this behavior. I think it would require an intentionally faulty test rule that causes a syntax error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-19 18:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/linter.rs</code>:634 on 2025-03-19 18:31</div>
            <div class="timeline-body"><p>Ok perfect, thanks! After this lands you can of course feel free to switch things up as makes sense for the growing menagerie of syntax errors ðŸ˜„</p>
<blockquote>
<p>I guess we don&#x27;t have a test for this behavior. I think it would require an intentionally faulty test rule that causes a syntax error.</p>
</blockquote>
<p>That sounds like a great idea! We could have rules that introduce parser errors, version-specific errors, compiler errors, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/linter.rs</code>:51 on 2025-03-20 10:03</div>
            <div class="timeline-body"><p>It&#x27;s a bit unfortunate that these methods need to be repeated on both <code>Parsed</code> and <code>LinterResult</code>. We could explore another approach to avoid duplication, not necessarily in this PR, that utilizes <code>bitflags</code> for these two booleans like <code>SyntaxFlags</code> that can then be queried to ask whether there are parse errors or unsupported syntax errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-03-20 10:05</div>
            <div class="timeline-body"><p>Thanks for the quick fix!</p>
<p>I think we should explore an alternate option to avoid the duplication here as a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-03-20 10:07</div>
            <div class="timeline-body"><p>One minor nit: we mainly use the <code>[...]</code> syntax for rule categories so I&#x27;d avoid using &quot;[server]&quot; and instead just use &quot;Server: &quot; in the PR title.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`server`]  Allow `FixAll` action in presence of version-specific syntax errors&quot; to &quot;Server: Allow `FixAll` action in presence of version-specific syntax errors&quot; by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-20 10:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a> reviewed on 2025-03-20 10:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dylwil3">@dylwil3</a> on <code>crates/ruff_linter/src/linter.rs</code>:51 on 2025-03-20 10:08</div>
            <div class="timeline-body"><p>Agreed - the current approach seems like it&#x27;d be easy for the two to fall out of sync</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-20 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-20 10:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:12:27 UTC
    </footer>
</body>
</html>
