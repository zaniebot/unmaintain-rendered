```yaml
number: 5906
title: "Playground: Fix escaped quotes handling"
type: pull_request
state: merged
author: MichaReiser
labels:
  - playground
assignees: []
merged: true
base: main
head: escape-quotes-in-formatter-ir
created_at: 2023-07-20T07:28:54Z
updated_at: 2023-07-20T09:49:28Z
url: https://github.com/astral-sh/ruff/pull/5906
synced_at: 2026-01-12T03:30:22Z
```

# Playground: Fix escaped quotes handling

---

_Pull request opened by @MichaReiser on 2023-07-20 07:28_

<!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

Using quotes inside of strings currently breaks the code highlighting in the playground.

![image](https://github.com/astral-sh/ruff/assets/1203881/0eec17d9-471d-4b4a-a49c-ec48812ed45c)
![image](https://github.com/astral-sh/ruff/assets/1203881/2631e3d9-c152-4b41-903e-d278a0598941)
![image](https://github.com/astral-sh/ruff/assets/1203881/5ddac56a-06cb-4016-8ec8-aa75873b19be)



This PR escapes `"` when printing the formatter IR and adds support for string escape sequences to all grammars in the playground.

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

![image](https://github.com/astral-sh/ruff/assets/1203881/6943a45a-1826-49d5-b401-aab080d69c46)
![image](https://github.com/astral-sh/ruff/assets/1203881/f7b10863-cd93-495f-a1bf-d609f098ce87)
![image](https://github.com/astral-sh/ruff/assets/1203881/a487449b-b6e8-4d18-979f-d386ecfb4346)



---

_Comment by @MichaReiser on 2023-07-20 07:29_

Current dependencies on/for this PR:
* main
  * **PR #5906** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5906" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5906?utm_source=stack-comment).

---

_Label `playground` added by @MichaReiser on 2023-07-20 07:31_

---

_Renamed from "Escape quotes in formatter IR display" to "Playground: Fix escaped quotes handling" by @MichaReiser on 2023-07-20 07:31_

---

_Review requested from @konstin by @MichaReiser on 2023-07-20 07:34_

---

_Comment by @github-actions[bot] on 2023-07-20 07:45_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.49     17.3Â±1.22ms     2.3 MB/sec    1.00     11.6Â±0.61ms     3.5 MB/sec
formatter/numpy/ctypeslib.py               1.61      3.6Â±0.21ms     4.6 MB/sec    1.00      2.3Â±0.14ms     7.4 MB/sec
formatter/numpy/globals.py                 1.58   409.9Â±43.77Âµs     7.2 MB/sec    1.00   259.8Â±17.79Âµs    11.4 MB/sec
formatter/pydantic/types.py                1.64      8.0Â±0.42ms     3.2 MB/sec    1.00      4.9Â±0.19ms     5.2 MB/sec
linter/all-rules/large/dataset.py          1.00     16.7Â±0.49ms     2.4 MB/sec    1.02     17.1Â±0.78ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.27      5.3Â±0.66ms     3.1 MB/sec    1.00      4.2Â±0.18ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.31  752.7Â±112.88Âµs     3.9 MB/sec    1.00   573.4Â±26.08Âµs     5.1 MB/sec
linter/all-rules/pydantic/types.py         1.25      9.6Â±1.09ms     2.7 MB/sec    1.00      7.7Â±0.28ms     3.3 MB/sec
linter/default-rules/large/dataset.py      1.25     10.8Â±1.01ms     3.8 MB/sec    1.00      8.7Â±0.28ms     4.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.25      2.3Â±0.31ms     7.3 MB/sec    1.00  1820.9Â±64.11Âµs     9.1 MB/sec
linter/default-rules/numpy/globals.py      1.30   285.4Â±38.26Âµs    10.3 MB/sec    1.00    218.7Â±9.08Âµs    13.5 MB/sec
linter/default-rules/pydantic/types.py     1.22      4.7Â±0.62ms     5.4 MB/sec    1.00      3.9Â±0.13ms     6.6 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.2Â±0.22ms     3.6 MB/sec    1.03     11.6Â±0.25ms     3.5 MB/sec
formatter/numpy/ctypeslib.py               1.00      2.2Â±0.04ms     7.5 MB/sec    1.04      2.3Â±0.09ms     7.3 MB/sec
formatter/numpy/globals.py                 1.00    251.5Â±9.97Âµs    11.7 MB/sec    1.05   263.5Â±27.76Âµs    11.2 MB/sec
formatter/pydantic/types.py                1.00      4.9Â±0.15ms     5.2 MB/sec    1.05      5.1Â±0.23ms     5.0 MB/sec
linter/all-rules/large/dataset.py          1.00     15.5Â±0.36ms     2.6 MB/sec    1.03     16.0Â±0.35ms     2.5 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.1Â±0.07ms     4.1 MB/sec    1.02      4.2Â±0.20ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.02   502.7Â±21.96Âµs     5.9 MB/sec    1.00   494.4Â±12.37Âµs     6.0 MB/sec
linter/all-rules/pydantic/types.py         1.00      7.0Â±0.13ms     3.6 MB/sec    1.02      7.2Â±0.19ms     3.6 MB/sec
linter/default-rules/large/dataset.py      1.00      8.1Â±0.12ms     5.0 MB/sec    1.01      8.2Â±0.11ms     5.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1702.2Â±32.67Âµs     9.8 MB/sec    1.02  1742.5Â±74.50Âµs     9.6 MB/sec
linter/default-rules/numpy/globals.py      1.01    192.1Â±5.23Âµs    15.4 MB/sec    1.00    190.7Â±3.07Âµs    15.5 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6Â±0.07ms     7.0 MB/sec    1.01      3.7Â±0.08ms     7.0 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review comment by @konstin on `crates/ruff_formatter/src/format_element/document.rs`:273 on 2023-07-20 08:48_

Maybe that's a bit easier to read

```suggestion
                                text: text.replace('"', r#"\""#).into(),
```

---

_@konstin approved on 2023-07-20 08:49_

---

_Merged by @MichaReiser on 2023-07-20 09:25_

---

_Closed by @MichaReiser on 2023-07-20 09:25_

---

_Branch deleted on 2023-07-20 09:25_

---
