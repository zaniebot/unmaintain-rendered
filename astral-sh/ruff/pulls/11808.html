<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Implement `too-many-ancestors` (`PLR0901`) - astral-sh/ruff #11808</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Implement <code>too-many-ancestors</code> (<code>PLR0901</code>)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11808">#11808</a>
        opened by <a href="https://github.com/Peiffap">@Peiffap</a>
        on 2024-06-09 01:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Peiffap">@Peiffap</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>This PR adds <a href="https://pylint.readthedocs.io/en/latest/user_guide/messages/refactor/too-many-ancestors.html"><code>pylint</code> rule <code>R0901</code></a>, which restricts the maximum number of parent classes a class can have (to a default value of 7).</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>This PR was tested using the workflow discussed <a href="https://docs.astral.sh/ruff/contributing/">here</a>.</p>
<p>Running tests with <code>cargo test</code> gives no failures.</p>
<h2>Related Issues</h2>
<p>This is part of the greater effort of #970 (and if merged, should be checkmarked as &quot;done&quot; there).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Peiffap">@Peiffap</a> reviewed on 2024-06-09 01:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Peiffap">@Peiffap</a> on <code>crates/ruff_workspace/src/configuration.rs</code>:1505 on 2024-06-09 01:42</div>
            <div class="timeline-body"><p>I'm assuming this wasn't meant to be a duplicate, but for visibility I'm adding this comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Peiffap">@Peiffap</a> reviewed on 2024-06-09 01:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Peiffap">@Peiffap</a> on <code>crates/ruff_linter/src/rules/pylint/snapshots/ruff_linter__rules__pylint__tests__too_many_ancestors.snap</code>:1 on 2024-06-09 01:44</div>
            <div class="timeline-body"><p>Currently, the error message covers the entirety of the class, including the class body. Would it be desirable/easily feasible to only have it cover the &quot;header&quot; instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-06-09 01:53</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+1 -0 violations, +0 -0 fixes in 1 projects; 49 projects unchanged)</p>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pandas-dev/pandas/blob/81a44faf5c188546cb8e949b233135ac9855df1f/pandas/tests/extension/base/__init__.py#L68'>pandas/tests/extension/base/__init__.py:68:1:</a> PLR0901 Too many ancestors (19 > 7)
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| PLR0901 | 1 | 1 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-06-10 06:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @MichaReiser on 2024-06-20 07:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-20 07:54</div>
            <div class="timeline-body"><p>Thanks for contributing this rule.</p>
<p>I worry that merging the rule as is today will be confusing to users and give them a wrong sense of &quot;safety&quot; where they think the rule would catch all inheritance chains with more than <code>x</code> parent classes. However, that's not the case because Ruff doesn't support multifile analysis, meaning Ruff can only reason about the ancestor chain in a single file.</p>
<p>I think it's more likely that such deep hierarchy chains are split across many files, meaning the rule will miss almost all violations in real projects, such that it has limited value today.</p>
<p>I'll close this PR for now but I think we can add this rule once multifile analysis is supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-06-20 07:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> added by @MichaReiser on 2024-06-20 07:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> removed by @MichaReiser on 2024-06-20 07:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Peiffap">@Peiffap</a> on 2024-06-21 10:03</div>
            <div class="timeline-body"><p>@MichaReiser Thanks for taking the time to look over this!</p>
<p>If I'm allowed to push back a little on this... I don't understand your comment at all :(. This PR (and to my understanding, the <code>pylint</code> rule associated with it) has nothing to do with the <em>depth</em> of the inheritance chain (which would definitely be an interesting rule to implement once multifile analysis is possible!), but about the <em>width</em> (if you can call it that) of the inheritance, i.e. the number of <em>direct</em> parent classes of a given class.
I'm by no means an expert on object-oriented Python, but to my knowledge this is information that is solely contained in a single file, where the class is defined.</p>
<p>Edit: @Pierre-Sassoulas I see you've looked at this PR, so perhaps you can comment on whether my understanding of the <code>pylint</code> rule is correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-21 10:52</div>
            <div class="timeline-body"><p>I'm sorry that I failed to communicate the decision clearly or may even be mistaken.</p>
<p>I re-read the rule documentation and I think there's some confusion because the documentation sometimes uses the term parents and sometimes ancestors:</p>
<ul>
<li><code>parents</code>: The direct parents of a class. This maps to <code>class_def.bases</code></li>
<li><code>ancestors</code>: The transitive inheritance chain of a class. This requires traversing the entire inheritance chain.</li>
</ul>
<p>I took a look at the Pylint implementation, and my understanding is that it asserts that <code>ancestors</code> is less than the configured minimum, whereas this implementation implements <code>parents</code>.</p>
<p>https://github.com/pylint-dev/pylint/blob/087d77adcd8455dbbbf6b43631d93abb2d1c5d67/pylint/checkers/design_analysis.py#L245-L279</p>
<p>We'll need multifile analysis if we want to implement Pylint's behavior (assuming I understand it correctly)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Peiffap">@Peiffap</a> on 2024-06-21 12:41</div>
            <div class="timeline-body"><p>Thanks for giving some more detail! Apologies if I came across as overly defensive.</p>
<p>I agree with you that the documentation is a little confusing and mixes terms, and I wasn't even aware myself that &quot;parent&quot; and &quot;ancestor&quot; refer to different things!
I'm not familiar enough with the ruff codebase to know whether multifile analysis is required to check all ancestors, so I'll take your word for it.
How would you feel about slightly refactoring this PR to implement a new &quot;<code>too-many-parents</code>&quot; rule which clearly explains the difference, and adding a comment to #970 specifying that <code>R0901</code> shouldn't be worked on until multifile analysis is available?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-21 12:47</div>
            <div class="timeline-body"><blockquote>
<p>Apologies if I came across as overly defensive.</p>
</blockquote>
<p>No worries. It was good that you asked for clarification because I honestly wasn't aware of what specific behavior PyLInt implements (I just assumed ancestor without checking).</p>
<blockquote>
<p>I'm not familiar enough with the ruff codebase to know whether multifile analysis is required to check all ancestors, so I'll take your word for it.</p>
</blockquote>
<p>We could check all ancestors already today, but only if all classes are defined in the same file. That's unlikely to be the case for many classes and significantly reduces the added value of the rule.</p>
<blockquote>
<p>How would you feel about slightly refactoring this PR to implement a new &quot;too-many-parents&quot; rule which clearly explains the difference,</p>
</blockquote>
<p>I prefer to wait until Ruff supports multifile-analysis to avoid that we have to deprecate this rule just in a few months because it overlaps with an other rule. I also think that only checking direct parents isn't that useful, at least not in the spirit the rule is defined today (you could argue that inheriting from more than one base is considered bad).</p>
<blockquote>
<p>and adding a comment to https://github.com/astral-sh/ruff/issues/970 specifying that R0901 shouldn't be worked on until multifile analysis is available?</p>
</blockquote>
<p>Yeah, let's do that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Peiffap">@Peiffap</a> on 2024-06-21 13:00</div>
            <div class="timeline-body"><p>That's all reasonable; thanks for getting back to me so swiftly! I'll add the comment as discussed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pierre-Sassoulas">@Pierre-Sassoulas</a> on 2024-06-21 17:04</div>
            <div class="timeline-body"><p>I agree with @MichaReiser about pylint behavior. I reacted on the comment because I wasn't aware that ruff had this single file limitation (same than flake8 ?), so it was interesting to me.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:04:45 UTC
    </footer>
</body>
</html>
