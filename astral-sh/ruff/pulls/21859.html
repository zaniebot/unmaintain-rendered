<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix overload filtering to prefer more &quot;precise&quot; match - astral-sh/ruff #21859</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix overload filtering to prefer more &quot;precise&quot; match</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21859">#21859</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2025-12-09 05:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body">Summary
<p>fixes: <a href="https://github.com/astral-sh/ty/issues/1809">astral-sh/ty#1809</a></p>
<p>I took this chance to add some debug level tracing logs for overload call evaluation similar to Doug&#x27;s implementation in <code>constraints.rs</code>.</p>
Test Plan
<ul>
<li>Add new mdtests</li>
<li>Tested it against <code>sqlalchemy.select</code> in pyx which results in the correct overload being matched</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 05:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 05:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-09 05:51</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-09 05:53</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>scipy-stubs (https://github.com/scipy/scipy-stubs)
+ tests/stats/test_rv_frozen.pyi:35:1: error[type-assertion-failure] Type `int | float` does not match asserted type `Unknown`
+ tests/stats/test_rv_frozen.pyi:40:1: error[type-assertion-failure] Type `int | float` does not match asserted type `Unknown`
- Found 1212 diagnostics
+ Found 1214 diagnostics

pandas-stubs (https://github.com/pandas-dev/pandas-stubs)
- pandas-stubs/_typing.pyi:1217:16: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 5545 diagnostics
+ Found 5544 diagnostics


</code></pre>


<p>No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:1597 on 2025-12-09 09:33</div>
            <div class="timeline-body"><p>The <code>signature</code> is important because we want to know which message is this for but this will be too verbose for functions containing multiple overloads. Maybe, it might be better to add some information about the call site instead like which call expression this is for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2023 on 2025-12-09 09:34</div>
            <div class="timeline-body"><p>This is the diff that fixes the issue. I don&#x27;t really like the change that much, I tried to see if this could be simplified and I have some ideas but might require some more time so I&#x27;ll punt that on for post-beta stuff to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-09 09:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Fix overload filtering&quot; to &quot;[ty] Fix overload filtering to prefer more &quot;precise&quot; match&quot; by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 09:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 09:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 09:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 09:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 09:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 09:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2023 on 2025-12-09 09:47</div>
            <div class="timeline-body"><p>Is there a risk of skipping keyword-variadic parameters here? If so, would it be useful to add a variation of the test case where the <code>def f(*args: Any) -&gt; tuple[Any, ...]: ...</code> overload also takes keyword arguments (and we would make sure that this overload is still selected if keyword arguments are also passed in)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2025-12-09 09:47</div>
            <div class="timeline-body"><p>Thank you!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-09 10:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2023 on 2025-12-09 10:05</div>
            <div class="timeline-body"><p>Yeah, this doesn&#x27;t work well when keyword arguments are involved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2025-12-09 14:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ty_python_semantic/src/types/call/bind.rs</code>:2023 on 2025-12-09 14:57</div>
            <div class="timeline-body"><p>Going to track the follow-up in <a href="https://github.com/astral-sh/ty/issues/1825">astral-sh/ty#1825</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-09 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-09 14:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:21:32 UTC
    </footer>
</body>
</html>
