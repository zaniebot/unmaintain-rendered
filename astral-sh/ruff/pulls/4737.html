<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extract lower-level edit utility from autofix module - astral-sh/ruff #4737</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Extract lower-level edit utility from autofix module</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/4737">#4737</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-05-30 22:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-30 22:13</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>For flake8-type-checking autofixes, I need to have access to a <code>remove_imports</code>-like method that takes a <code>Stmt</code> and returns code as a string (rather than an edit). This PR removes that functionality from the <code>autofix::edits</code> API (formerly, <code>autofix::actions</code>) and instead puts it in a lower-level utility module (<code>autofix::codemods</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-30 22:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/autofix/edits.rs</code>:184 on 2023-05-30 22:13</div>
            <div class="timeline-body"><p>(I moved these private functions to the bottom of the module.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-05-30 22:29</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>✅ ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.01     14.4±0.09ms     2.8 MB/sec    1.00     14.3±0.11ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      3.4±0.01ms     4.9 MB/sec    1.00      3.4±0.01ms     4.9 MB/sec
linter/all-rules/numpy/globals.py          1.00    423.8±0.57µs     7.0 MB/sec    1.00    423.5±1.04µs     7.0 MB/sec
linter/all-rules/pydantic/types.py         1.00      5.9±0.04ms     4.3 MB/sec    1.00      5.9±0.03ms     4.3 MB/sec
linter/default-rules/large/dataset.py      1.02      6.9±0.02ms     5.9 MB/sec    1.00      6.8±0.02ms     6.0 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.01   1503.9±5.94µs    11.1 MB/sec    1.00   1491.8±3.74µs    11.2 MB/sec
linter/default-rules/numpy/globals.py      1.00    170.1±0.30µs    17.3 MB/sec    1.00    170.5±1.94µs    17.3 MB/sec
linter/default-rules/pydantic/types.py     1.01      3.1±0.02ms     8.2 MB/sec    1.00      3.1±0.01ms     8.3 MB/sec
parser/large/dataset.py                    1.00      5.3±0.00ms     7.7 MB/sec    1.00      5.3±0.00ms     7.7 MB/sec
parser/numpy/ctypeslib.py                  1.00   1033.0±0.67µs    16.1 MB/sec    1.00   1033.6±1.17µs    16.1 MB/sec
parser/numpy/globals.py                    1.00    107.2±0.57µs    27.5 MB/sec    1.00    106.9±0.16µs    27.6 MB/sec
parser/pydantic/types.py                   1.00      2.3±0.00ms    11.3 MB/sec    1.00      2.3±0.00ms    11.3 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
linter/all-rules/large/dataset.py          1.00     17.1±0.34ms     2.4 MB/sec    1.01     17.2±0.17ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.17      5.2±1.87ms     3.2 MB/sec    1.00      4.4±0.09ms     3.8 MB/sec
linter/all-rules/numpy/globals.py          1.00    449.7±6.38µs     6.6 MB/sec    1.02    457.5±7.93µs     6.4 MB/sec
linter/all-rules/pydantic/types.py         1.01      7.4±0.40ms     3.4 MB/sec    1.00      7.3±0.11ms     3.5 MB/sec
linter/default-rules/large/dataset.py      1.00      8.5±0.09ms     4.8 MB/sec    1.01      8.7±0.08ms     4.7 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1795.2±15.31µs     9.3 MB/sec    1.02  1837.2±18.04µs     9.1 MB/sec
linter/default-rules/numpy/globals.py      1.00    197.8±2.25µs    14.9 MB/sec    1.01    198.8±3.36µs    14.8 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.9±0.04ms     6.6 MB/sec    1.01      3.9±0.03ms     6.5 MB/sec
parser/large/dataset.py                    1.00      6.7±0.03ms     6.1 MB/sec    1.00      6.7±0.04ms     6.1 MB/sec
parser/numpy/ctypeslib.py                  1.00  1257.1±10.58µs    13.2 MB/sec    1.00  1257.3±10.06µs    13.2 MB/sec
parser/numpy/globals.py                    1.00    130.6±0.86µs    22.6 MB/sec    1.00    130.6±0.98µs    22.6 MB/sec
parser/pydantic/types.py                   1.00      2.8±0.02ms     9.0 MB/sec    1.00      2.8±0.04ms     9.0 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/autofix/codemods.rs</code>:17 on 2023-05-31 06:43</div>
            <div class="timeline-body"><p>Is the reason that this returns a <code>String</code> rather than an <code>Edit</code> that it may remove the entire import section?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/autofix/codemods.rs</code>:1 on 2023-05-31 06:46</div>
            <div class="timeline-body"><p>I would struggle to know whether I'm supposed to put some &quot;mutation&quot; method into the <code>edits</code> or <code>codemod</code> file. What's your reasoning for separating the too? Does it matter what they are? Should we instead split the mutations by what they're mutating. E.g. <code>autofix/import</code> <code>autofix/arguments</code>, <code>autofix/statement</code>? I would find it easier to know where to place my mutation if the mutations are grouped by the node because I ultimately know on which node my mutation operates.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-05-31 06:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-31 16:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/autofix/codemods.rs</code>:17 on 2023-05-31 16:41</div>
            <div class="timeline-body"><p>It's because we may need access to the modified code for some operations, and <code>Edit</code> obscures the actual modified code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-05-31 16:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff/src/autofix/codemods.rs</code>:1 on 2023-05-31 16:42</div>
            <div class="timeline-body"><p>It's because, for flake8-type-checking, we need access to the modified code, in order to build up the actual edit. If this returned an edit, we wouldn't be able to use it to (e.g.) remove imports from a statement, then place the modified statement within a separate block of code -- since we'd only have the <code>Edit</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-05-31 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-31 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-05-31 16:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 03:50:43 UTC
    </footer>
</body>
</html>
