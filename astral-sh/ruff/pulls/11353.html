<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve the `update_schemastore` script - astral-sh/ruff #11353</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve the <code>update_schemastore</code> script</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/11353">#11353</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-05-09 17:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<ul>
<li>Update the script so that it works over https</li>
<li>Use a shallow clone so that it doesn&#x27;t take so long</li>
</ul>
Test Plan
<p>Before these changes, the script failed for me. Now, it works: <a href="https://github.com/SchemaStore/schemastore/pull/3772">SchemaStore/schemastore#3772</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-09 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-05-09 18:13</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>âœ… ecosystem check detected no linter changes.</p>
Linter (preview)
<p>âœ… ecosystem check detected no linter changes.</p>
Formatter (stable)
<p>âœ… ecosystem check detected no format changes.</p>
Formatter (preview)
<p>âœ… ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-09 18:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>scripts/update_schemastore.py</code>:16 on 2024-05-09 18:54</div>
            <div class="timeline-body"><p>You can&#x27;t just change it, it&#x27;ll break for ssh authentication users i.e. Charlie haha</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-09 18:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:16 on 2024-05-09 18:57</div>
            <div class="timeline-body"><p>Oof yeah, right</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-09 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-09 21:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/update_schemastore.py</code>:16 on 2024-05-09 21:15</div>
            <div class="timeline-body"><p>I had the same idea initially :D <a href="https://github.com/astral-sh/ruff/pull/5322">astral-sh/ruff#5322</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-09 21:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/update_schemastore.py</code>:26 on 2024-05-09 21:16</div>
            <div class="timeline-body"><p>Can we still do commits with this? (I&#x27;m not familiar enough with the git internals)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-09 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-09 22:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>scripts/update_schemastore.py</code>:16 on 2024-05-09 22:01</div>
            <div class="timeline-body"><p>A simple <code>--proto ssh|https</code> flag seems sufficient?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 14:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:26 on 2024-05-13 14:08</div>
            <div class="timeline-body"><p>Yup, I checked locally. Making a new commit and creating a PR from that commit both still work fine even with a shallow clone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:16 on 2024-05-13 15:07</div>
            <div class="timeline-body"><p>Added a new CLI flag in <a href="https://github.com/astral-sh/ruff/pull/11353">astral-sh/ruff#11353</a>/commits/6e7b3dbc07e33f8a32b6126c2ff06e6827885db8, how&#x27;s that look?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 15:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 15:08</div>
            <div class="timeline-body"><p>Pyright is unhappy with this branch locally because it&#x27;s unreachable (which is kinda the point). It stops complaining if I use <code>typing.assert_never</code> instead of <code>assert False</code>, but that&#x27;s only available on Python 3.11+. Are we okay with requiring Python 3.11 to run this script? The updates I&#x27;ve already made use pattern-matching, which already means that the script will require Python 3.10, I suppose</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> reviewed on 2024-05-13 15:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 15:27</div>
            <div class="timeline-body"><p>Could <code>typing_extensions</code> be used instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 15:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 15:32</div>
            <div class="timeline-body"><p>it definitely <em>could</em>, but I don&#x27;t really wanna add a third-party dependency for a one-file script that we run as part of the release process -- it would mean you&#x27;d either need to activate a venv and have the requirements installed into it, or run the script using <code>uv run</code>, etc. Doesn&#x27;t seem worth it for something as small as this :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 15:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 15:35</div>
            <div class="timeline-body"><p>If we do care about keeping compatibility with Python 3.10, it would actually be pretty simple to do our own backport that would satisfy pyright, though: https://github.com/python/cpython/blob/main/Tools/cases_generator/_typing_backports.py. I could do that, but it seems like more boilerplate, and I&#x27;m not sure if we care about keeping compatibility with Python 3.10 ðŸ˜†</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-13 16:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 16:18</div>
            <div class="timeline-body"><p>Feel free to require Python 3.11+ for the script</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-13 16:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 16:24</div>
            <div class="timeline-body"><p>Imho our internal scripts should be latest stable only, we have it installed for dev work anyway and it&#x27;s good when we get to practice the new features ourselves</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 16:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_schemastore.py</code>:46 on 2024-05-13 16:50</div>
            <div class="timeline-body"><p>I updated it to use <code>assert_never</code>, but pyright still complains locally. I think this is a false positive; mypy specifically excludes branches that are obviously <em>meant</em> to be unreachable from its reachability checks. I left a comment at <a href="https://github.com/microsoft/pyright/issues/7559">microsoft/pyright#7559</a>#issuecomment-2108198425 about this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-05-13 16:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/pyproject.toml</code>:33 on 2024-05-13 16:52</div>
            <div class="timeline-body"><p>This change is no longer necessary now I&#x27;m using <code>assert_never</code> in the script rather than a raw <code>assert False</code>, but I think it makes sense to ignore this rule in the <code>scripts/</code> directory regardless</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-05-13 16:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-05-13 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-13 17:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:04:01 UTC
    </footer>
</body>
</html>
