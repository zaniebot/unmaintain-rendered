<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Improve literal promotion heuristics - astral-sh/ruff #21439</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Improve literal promotion heuristics</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21439">#21439</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2025-11-13 21:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a></div>
            <div class="timeline-body">Summary
<p>Extends literal promotion to apply to any generic method, as opposed to only generic class constructors. This PR also improves our literal promotion heuristics to only promote literals in non-covariant position in the return type, and avoid promotion if the literal is present in non-covariant position in any argument type.</p>
<p>Resolves <a href="https://github.com/astral-sh/ty/issues/1357">astral-sh/ty#1357</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-13 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-13 21:38</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-14 00:31</div>
            <div class="timeline-body"><p>It looks like this is causing a new stack overflow in the ecosystem?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/assignment/annotations.md</code>:287 on 2025-11-14 00:33</div>
            <div class="timeline-body"><p>Do we have a task open for this TODO? It does seem like inference of generic parameters is a case where we should fully respect the type context.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/assignment/annotations.md</code>:288 on 2025-11-14 00:34</div>
            <div class="timeline-body"><p>We don&#x27;t promote here because <code>Z</code> is covariant, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/literal_promotion.md</code>:100 on 2025-11-14 00:42</div>
            <div class="timeline-body"><p>Looks like you probably meant this, rather than a duplicated line?</p>
<pre><code>reveal_type(Invariant(1))  # revealed: Invariant[int]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2025-11-14 00:55</div>
            <div class="timeline-body"><p>Reviewed the tests so far -- the behavior looks great! Thanks for the thorough and clear test suite.</p>
<p>Will review the code later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-11-14 01:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/resources/mdtest/assignment/annotations.md</code>:288 on 2025-11-14 01:18</div>
            <div class="timeline-body"><p>Yes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 01:29</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>nox (https://github.com/wntrblm/nox)
- nox/_resolver.py:167:13: error[invalid-assignment] Invalid subscript assignment with key of type `Node@lazy_stable_topo_sort` and value of type `Literal[True]` on object of type `dict[Node@lazy_stable_topo_sort, Literal[False]]`
- Found 30 diagnostics
+ Found 29 diagnostics

Expression (https://github.com/cognitedata/Expression)
- tests/test_map.py:142:34: error[invalid-argument-type] Argument to bound method `try_get_value` is incorrect: Expected `list[Literal[1, 2]]`, found `list[int]`
- tests/test_map.py:143:34: error[invalid-argument-type] Argument to bound method `try_get_value` is incorrect: Expected `list[Literal[1, 2]]`, found `list[int]`
- tests/test_map.py:144:34: error[invalid-argument-type] Argument to bound method `try_get_value` is incorrect: Expected `list[Literal[1, 2]]`, found `list[int]`
- Found 198 diagnostics
+ Found 195 diagnostics

psycopg (https://github.com/psycopg/psycopg)
- psycopg/psycopg/_adapters_map.py:147:21: error[invalid-assignment] Invalid subscript assignment with key of type `PyFormat` and value of type `Literal[True]` on object of type `dict[Unknown, Literal[False]]`
- tests/types/test_array.py:314:12: error[non-subscriptable] Cannot subscript object of type `int` with no `__getitem__` method
- Found 635 diagnostics
+ Found 633 diagnostics

xarray (https://github.com/pydata/xarray)
- xarray/computation/rolling.py:112:45: error[invalid-argument-type] Argument to bound method `_mapping_to_list` is incorrect: Expected `Literal[False] | Mapping[Any, Literal[False]]`, found `bool | Mapping[Any, bool]`
- xarray/computation/rolling.py:453:41: error[invalid-argument-type] Argument to bound method `_mapping_to_list` is incorrect: Expected `Literal[1] | Mapping[Any, Literal[1]]`, found `int | Mapping[Any, int]`
- xarray/computation/rolling.py:989:41: error[invalid-argument-type] Argument to bound method `_mapping_to_list` is incorrect: Expected `Literal[1] | Mapping[Any, Literal[1]]`, found `int | Mapping[Any, int]`
- Found 1768 diagnostics
+ Found 1765 diagnostics

meson (https://github.com/mesonbuild/meson)
- mesonbuild/build.py:1295:9: error[invalid-assignment] Object of type `list[Sequence[str | Literal[False]] | Literal[False]]` is not assignable to attribute `install_dir` of type `list[str | Literal[False]]`
+ mesonbuild/build.py:1295:9: error[invalid-assignment] Object of type `list[Sequence[str | bool] | Literal[False]]` is not assignable to attribute `install_dir` of type `list[str | Literal[False]]`

manticore (https://github.com/trailofbits/manticore)
- manticore/core/manticore.py:1078:9: error[invalid-assignment] Object of type `Literal[True]` is not assignable to attribute `value` on type `Unknown | c_bool | ValueProxy[Literal[False]]`
- manticore/core/manticore.py:1156:9: error[invalid-assignment] Object of type `Literal[True]` is not assignable to attribute `value` on type `Unknown | c_bool | ValueProxy[Literal[False]]`
- Found 11087 diagnostics
+ Found 11085 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
- ddtrace/appsec/_exploit_prevention/stack_traces.py:50:44: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[Literal[2]]`, in comparing `int` with `(Unknown &amp; ~AlwaysFalsy) | (EnvVariable[Literal[2]] &amp; ~AlwaysFalsy)`
+ ddtrace/appsec/_exploit_prevention/stack_traces.py:50:44: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `(Unknown &amp; ~AlwaysFalsy) | (EnvVariable[int] &amp; ~AlwaysFalsy)`
- ddtrace/appsec/_exploit_prevention/stack_traces.py:65:8: error[unsupported-operator] Operator `&gt;` is not supported for types `int` and `EnvVariable[Literal[32]]`, in comparing `int` with `Unknown | EnvVariable[Literal[32]]`
+ ddtrace/appsec/_exploit_prevention/stack_traces.py:65:8: error[unsupported-operator] Operator `&gt;` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/appsec/_exploit_prevention/stack_traces.py:65:21: error[unsupported-operator] Operator `&gt;` is not supported for types `EnvVariable[Literal[32]]` and `int`, in comparing `Unknown | EnvVariable[Literal[32]]` with `Literal[0]`
+ ddtrace/appsec/_exploit_prevention/stack_traces.py:65:21: error[unsupported-operator] Operator `&gt;` is not supported for types `EnvVariable[int]` and `int`, in comparing `Unknown | EnvVariable[int]` with `Literal[0]`
- ddtrace/appsec/_exploit_prevention/stack_traces.py:66:25: error[unsupported-operator] Operator `*` is unsupported between objects of type `Unknown | EnvVariable[Literal[32]]` and `Unknown | EnvVariable[float]`
+ ddtrace/appsec/_exploit_prevention/stack_traces.py:66:25: error[unsupported-operator] Operator `*` is unsupported between objects of type `Unknown | EnvVariable[int]` and `Unknown | EnvVariable[float]`
- ddtrace/appsec/_exploit_prevention/stack_traces.py:67:24: error[unsupported-operator] Operator `-` is unsupported between objects of type `Unknown | EnvVariable[Literal[32]]` and `int`
+ ddtrace/appsec/_exploit_prevention/stack_traces.py:67:24: error[unsupported-operator] Operator `-` is unsupported between objects of type `Unknown | EnvVariable[int]` and `int`
- ddtrace/appsec/_iast/_metrics.py:25:23: warning[possibly-missing-attribute] Attribute `upper` may be missing on object of type `Unknown | EnvVariable[Literal[&quot;INFORMATION&quot;]]`
+ ddtrace/appsec/_iast/_metrics.py:25:23: warning[possibly-missing-attribute] Attribute `upper` may be missing on object of type `Unknown | EnvVariable[str]`
- ddtrace/appsec/_iast/sampling/vulnerability_detection.py:40:8: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[Literal[2]]`, in comparing `int` with `Unknown | EnvVariable[Literal[2]]`
+ ddtrace/appsec/_iast/sampling/vulnerability_detection.py:40:8: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/appsec/_iast/sampling/vulnerability_detection.py:88:8: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[Literal[2]]`, in comparing `Unknown | int` with `Unknown | EnvVariable[Literal[2]]`
+ ddtrace/appsec/_iast/sampling/vulnerability_detection.py:88:8: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[int]`, in comparing `Unknown | int` with `Unknown | EnvVariable[int]`
- ddtrace/appsec/_iast/secure_marks/configuration.py:199:51: error[invalid-argument-type] Argument to function `parse_security_controls_config` is incorrect: Expected `str`, found `(Unknown &amp; ~AlwaysFalsy) | (EnvVariable[Literal[&quot;&quot;]] &amp; ~AlwaysFalsy)`
+ ddtrace/appsec/_iast/secure_marks/configuration.py:199:51: error[invalid-argument-type] Argument to function `parse_security_controls_config` is incorrect: Expected `str`, found `(Unknown &amp; ~AlwaysFalsy) | (EnvVariable[str] &amp; ~AlwaysFalsy)`
- ddtrace/appsec/_iast/taint_sinks/_base.py:69:20: error[unsupported-operator] Operator `&lt;` is not supported for types `int` and `EnvVariable[Literal[2]]`, in comparing `int` with `Unknown | EnvVariable[Literal[2]]`
+ ddtrace/appsec/_iast/taint_sinks/_base.py:69:20: error[unsupported-operator] Operator `&lt;` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/appsec/_processor.py:105:49: warning[possibly-missing-attribute] Attribute `encode` may be missing on object of type `Unknown | EnvVariable[Unknown | Literal[&quot;(?i)pass|pw(?:or)?d|secret|(?:api|private|public|access)[_-]?key|token|consumer[_-]?(?:id|key|secret)|sign(?:ed|ature)|bearer|authorization|jsessionid|phpsessid|asp\\.net[_-]sessionid|sid|jwt&quot;]]`
- ddtrace/appsec/_processor.py:106:51: warning[possibly-missing-attribute] Attribute `encode` may be missing on object of type `Unknown | EnvVariable[Unknown | Literal[&quot;(?i)(?:p(?:ass)?w(?:or)?d|pass(?:[_-]?phrase)?|secret(?:[_-]?key)?|(?:(?:api|private|public|access)[_-]?)key(?:[_-]?id)?|(?:(?:auth|access|id|refresh)[_-]?)?token|consumer[_-]?(?:id|key|secret)|sign(?:ed|ature)?|auth(?:entication|orization)?|jsessionid|phpsessid|asp\\.net(?:[_-]|-)sessionid|sid|jwt)(?:\\s*=([^;&amp;]+)|\&quot;\\s*:\\s*(\&quot;[^\&quot;]+\&quot;|\\d+))|bearer\\s+([a-z0-9\\._\\-]+)|token\\s*:\\s*([a-z0-9]{13})|gh[opsu]_([0-9a-zA-Z]{36})|ey[I-L][\\w=-]+\\.(ey[I-L][\\w=-]+(?:\\.[\\w.+\\/=-]+)?)|[\\-]{5}BEGIN[a-z\\s]+PRIVATE\\sKEY[\\-]{5}([^\\-]+)[\\-]{5}END[a-z\\s]+PRIVATE\\sKEY|ssh-rsa\\s*([a-z0-9\\/\\.+]{100,})&quot;]]`
+ ddtrace/appsec/_processor.py:105:49: warning[possibly-missing-attribute] Attribute `encode` may be missing on object of type `Unknown | EnvVariable[Unknown | str]`
+ ddtrace/appsec/_processor.py:106:51: warning[possibly-missing-attribute] Attribute `encode` may be missing on object of type `Unknown | EnvVariable[Unknown | str]`
- ddtrace/appsec/ai_guard/_api_client.py:107:25: error[unsupported-operator] Operator `//` is unsupported between objects of type `Unknown | EnvVariable[Literal[10000]]` and `Literal[1000]`
+ ddtrace/appsec/ai_guard/_api_client.py:107:25: error[unsupported-operator] Operator `//` is unsupported between objects of type `Unknown | EnvVariable[int]` and `Literal[1000]`
- ddtrace/appsec/ai_guard/_api_client.py:116:12: error[unsupported-operator] Operator `&gt;` is not supported for types `int` and `EnvVariable[Literal[16]]`, in comparing `int` with `Unknown | EnvVariable[Literal[16]]`
+ ddtrace/appsec/ai_guard/_api_client.py:116:12: error[unsupported-operator] Operator `&gt;` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/appsec/ai_guard/_api_client.py:120:29: error[unsupported-operator] Unary operator `-` is unsupported for type `Unknown | EnvVariable[Literal[16]]`
+ ddtrace/appsec/ai_guard/_api_client.py:120:29: error[unsupported-operator] Unary operator `-` is unsupported for type `Unknown | EnvVariable[int]`
- ddtrace/appsec/ai_guard/_api_client.py:128:16: error[unsupported-operator] Operator `&gt;` is not supported for types `int` and `EnvVariable[Literal[524288]]`, in comparing `int` with `Unknown | EnvVariable[Literal[524288]]`
+ ddtrace/appsec/ai_guard/_api_client.py:128:16: error[unsupported-operator] Operator `&gt;` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/contrib/internal/django/user.py:50:53: error[invalid-argument-type] Argument expression after ** must be a mapping with `str` key type: Found `Unknown | (EnvVariable[Literal[&quot;&quot;]] &amp; ~AlwaysFalsy) | str`
+ ddtrace/contrib/internal/django/user.py:50:53: error[invalid-argument-type] Argument expression after ** must be a mapping with `str` key type: Found `Unknown | (EnvVariable[str] &amp; ~AlwaysFalsy) | str`
- ddtrace/debugging/_exception/replay.py:332:35: error[unsupported-operator] Operator `&lt;` is not supported for types `int` and `EnvVariable[Literal[8]]`, in comparing `int` with `Unknown | EnvVariable[Literal[8]]`
+ ddtrace/debugging/_exception/replay.py:332:35: error[unsupported-operator] Operator `&lt;` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/debugging/_exception/replay.py:343:33: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[Literal[8]]`, in comparing `int` with `Unknown | EnvVariable[Literal[8]]`
+ ddtrace/debugging/_exception/replay.py:343:33: error[unsupported-operator] Operator `&gt;=` is not supported for types `int` and `EnvVariable[int]`, in comparing `int` with `Unknown | EnvVariable[int]`
- ddtrace/debugging/_probe/remoteconfig.py:302:13: error[unsupported-operator] Operator `+` is unsupported between objects of type `int | float` and `Unknown | EnvVariable[Literal[3600]]`
+ ddtrace/debugging/_probe/remoteconfig.py:302:13: error[unsupported-operator] Operator `+` is unsupported between objects of type `int | float` and `Unknown | EnvVariable[int]`
- ddtrace/internal/core/crashtracking.py:111:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `bool`, found `Unknown | EnvVariable[Literal[True]]`
+ ddtrace/internal/core/crashtracking.py:111:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `bool`, found `Unknown | EnvVariable[bool]`
- ddtrace/internal/core/crashtracking.py:112:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `bool`, found `Unknown | EnvVariable[Literal[True]]`
+ ddtrace/internal/core/crashtracking.py:112:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `bool`, found `Unknown | EnvVariable[bool]`
- ddtrace/internal/gitmetadata.py:52:35: error[invalid-argument-type] Argument to function `parse_tags_str` is incorrect: Expected `str | None`, found `Unknown | EnvVariable[Literal[&quot;&quot;]]`
+ ddtrace/internal/gitmetadata.py:52:35: error[invalid-argument-type] Argument to function `parse_tags_str` is incorrect: Expected `str | None`, found `Unknown | EnvVariable[str]`
- ddtrace/internal/openfeature/writer.py:99:13: error[invalid-assignment] Object of type `Unknown | EnvVariable[Literal[True]]` is not assignable to `bool | None`
+ ddtrace/internal/openfeature/writer.py:99:13: error[invalid-assignment] Object of type `Unknown | EnvVariable[bool]` is not assignable to `bool | None`
- ddtrace/internal/settings/_opentelemetry.py:10:61: error[invalid-argument-type] Argument to function `_get_default_endpoint` is incorrect: Expected `str`, found `Unknown | EnvVariable[Literal[&quot;grpc&quot;]]`
+ ddtrace/internal/settings/_opentelemetry.py:10:61: error[invalid-argument-type] Argument to function `_get_default_endpoint` is incorrect: Expected `str`, found `Unknown | EnvVariable[str]`
- ddtrace/internal/settings/asm.py:199:5: error[invalid-assignment] Object of type `EnvVariable[Literal[1]]` is not assignable to `int`
+ ddtrace/internal/settings/asm.py:199:5: error[invalid-assignment] Object of type `EnvVariable[int]` is not assignable to `int`
- ddtrace/internal/settings/asm.py:322:16: error[invalid-return-type] Return type does not match returned value: expected `bool`, found `Unknown | Literal[False] | (EnvVariable[Literal[False]] &amp; ~AlwaysTruthy) | EnvVariable[Literal[True]]`
+ ddtrace/internal/settings/asm.py:322:16: error[invalid-return-type] Return type does not match returned value: expected `bool`, found `Unknown | Literal[False] | EnvVariable[bool]`
- ddtrace/internal/settings/asm.py:326:16: error[invalid-return-type] Return type does not match returned value: expected `bool`, found `(Unknown &amp; ~AlwaysFalsy &amp; ~AlwaysTruthy) | (EnvVariable[Literal[False]] &amp; ~AlwaysFalsy &amp; ~AlwaysTruthy) | bool`
+ ddtrace/internal/settings/asm.py:326:16: error[invalid-return-type] Return type does not match returned value: expected `bool`, found `(Unknown &amp; ~AlwaysFalsy &amp; ~AlwaysTruthy) | (EnvVariable[bool] &amp; ~AlwaysFalsy &amp; ~AlwaysTruthy) | bool`
- ddtrace/internal/settings/asm.py:335:20: error[invalid-return-type] Return type does not match returned value: expected `str`, found `Unknown | EnvVariable[Literal[&quot;identification&quot;]] | Literal[&quot;disabled&quot;]`
+ ddtrace/internal/settings/asm.py:335:20: error[invalid-return-type] Return type does not match returned value: expected `str`, found `Unknown | EnvVariable[str] | Literal[&quot;disabled&quot;]`
- ddtrace/internal/settings/profiling.py:124:9: error[invalid-argument-type] Argument to bound method `v` is incorrect: Expected `((str, /) -&gt; Literal[False]) | None`, found `def _parse_profiling_enabled(raw: str) -&gt; bool`
- ddtrace/internal/telemetry/writer.py:68:45: error[invalid-argument-type] Argument to bound method `get_host` is incorrect: Expected `str`, found `Unknown | EnvVariable[Literal[&quot;datadoghq.com&quot;]]`
+ ddtrace/internal/telemetry/writer.py:68:45: error[invalid-argument-type] Argument to bound method `get_host` is incorrect: Expected `str`, found `Unknown | EnvVariable[str]`
- ddtrace/internal/telemetry/writer.py:181:13: error[invalid-assignment] Object of type `(Unknown &amp; ~AlwaysFalsy) | (EnvVariable[Literal[False]] &amp; ~AlwaysFalsy) | bool` is not assignable to `bool | None`
+ ddtrace/internal/telemetry/writer.py:181:13: error[invalid-assignment] Object of type `(Unknown &amp; ~AlwaysFalsy) | (EnvVariable[bool] &amp; ~AlwaysFalsy) | bool` is not assignable to `bool | None`
- ddtrace/internal/telemetry/writer.py:350:46: error[invalid-argument-type] Argument to bound method `flush` is incorrect: Expected `int`, found `Unknown | EnvVariable[Unknown | Literal[300]]`
+ ddtrace/internal/telemetry/writer.py:350:46: error[invalid-argument-type] Argument to bound method `flush` is incorrect: Expected `int`, found `Unknown | EnvVariable[Unknown | int]`
- ddtrace/profiling/collector/_lock.py:268:9: error[invalid-parameter-default] Default value of type `Unknown | EnvVariable[Literal[64]]` is not assignable to annotated parameter type `int`
+ ddtrace/profiling/collector/_lock.py:268:9: error[invalid-parameter-default] Default value of type `Unknown | EnvVariable[int]` is not assignable to annotated parameter type `int`
- ddtrace/profiling/profiler.py:129:9: error[invalid-parameter-default] Default value of type `Unknown | EnvVariable[Literal[True]]` is not assignable to annotated parameter type `bool`
+ ddtrace/profiling/profiler.py:129:9: error[invalid-parameter-default] Default value of type `Unknown | EnvVariable[bool]` is not assignable to annotated parameter type `bool`
- ddtrace/profiling/profiler.py:130:9: error[invalid-parameter-default] Default value of type `Unknown | EnvVariable[Literal[True]]` is not assignable to annotated parameter type `bool`
+ ddtrace/profiling/profiler.py:130:9: error[invalid-parameter-default] Default value of type `Unknown | EnvVariable[bool]` is not assignable to annotated parameter type `bool`
- ddtrace/profiling/profiler.py:180:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `int | None`, found `Unknown | EnvVariable[Literal[64]]`
+ ddtrace/profiling/profiler.py:180:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `int | None`, found `Unknown | EnvVariable[int]`
- ddtrace/profiling/profiler.py:181:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `bool | None`, found `Unknown | EnvVariable[Literal[True]]`
+ ddtrace/profiling/profiler.py:181:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `bool | None`, found `Unknown | EnvVariable[bool]`
- ddtrace/profiling/profiler.py:183:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `int | None`, found `Unknown | EnvVariable[Literal[4]]`
+ ddtrace/profiling/profiler.py:183:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `int | None`, found `Unknown | EnvVariable[int]`
- ddtrace/profiling/profiler.py:184:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `int | None`, found `Unknown | EnvVariable[Literal[10000]]`
+ ddtrace/profiling/profiler.py:184:13: error[invalid-argument-type] Argument to function `config` is incorrect: Expected `int | None`, found `Unknown | EnvVariable[int]`
- tests/appsec/ai_guard/api/test_api_client.py:195:20: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | EnvVariable[Literal[16]]` and `Literal[1]`
+ tests/appsec/ai_guard/api/test_api_client.py:195:20: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | EnvVariable[int]` and `Literal[1]`
- tests/appsec/ai_guard/api/test_api_client.py:210:35: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | EnvVariable[Literal[524288]]` and `Literal[1]`
+ tests/appsec/ai_guard/api/test_api_client.py:210:35: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | EnvVariable[int]` and `Literal[1]`
- tests/appsec/iast/test_overhead_control_engine.py:129:48: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | EnvVariable[Literal[2]]` and `Literal[1]`
+ tests/appsec/iast/test_overhead_control_engine.py:129:48: error[unsupported-operator] Operator `+` is unsupported between objects of type `Unknown | EnvVariable[int]` and `Literal[1]`
- tests/debugging/exception/test_replay.py:347:17: error[unsupported-operator] Operator `*` is unsupported between objects of type `Unknown | EnvVariable[Literal[8]]` and `Literal[2]`
+ tests/debugging/exception/test_replay.py:347:17: error[unsupported-operator] Operator `*` is unsupported between objects of type `Unknown | EnvVariable[int]` and `Literal[2]`
- Found 7974 diagnostics
+ Found 7973 diagnostics

ibis (https://github.com/ibis-project/ibis)
- ibis/backends/bigquery/tests/unit/test_compiler.py:273:26: error[invalid-argument-type] Argument is incorrect: Expected `FrozenOrderedDict[str, DataType]`, found `dict[str | Unknown, Literal[&quot;string&quot;]]`
+ ibis/backends/bigquery/tests/unit/test_compiler.py:273:26: error[invalid-argument-type] Argument is incorrect: Expected `FrozenOrderedDict[str, DataType]`, found `dict[str | Unknown, str]`
- ibis/backends/tests/test_udf.py:82:16: error[invalid-return-type] Return type does not match returned value: expected `dict[str, int]`, found `dict[Unknown, Literal[0]]`
- ibis/backends/tests/test_udf.py:110:16: error[invalid-return-type] Return type does not match returned value: expected `dict[str, int]`, found `dict[Unknown, Literal[0]]`
- ibis/backends/tests/test_udf.py:124:16: error[invalid-return-type] Return type does not match returned value: expected `dict[str, int]`, found `dict[Unknown, Literal[0]]`
- Found 4233 diagnostics
+ Found 4230 diagnostics

pandas-stubs (https://github.com/pandas-dev/pandas-stubs)
- tests/scalars/test_scalars.py:160:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/scalars/test_scalars.py:176:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/scalars/test_scalars.py:208:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/scalars/test_scalars.py:225:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/scalars/test_scalars.py:250:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/scalars/test_scalars.py:251:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/test_interval.py:41:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/test_interval.py:42:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/test_interval.py:43:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/test_interval.py:45:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/test_interval.py:101:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- tests/test_interval.py:103:11: error[type-assertion-failure] Argument does not have asserted type `Interval[int]`
- Found 5966 diagnostics
+ Found 5954 diagnostics

zulip (https://github.com/zulip/zulip)
- zerver/tests/test_users.py:256:25: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;email&quot;], Unknown].__getitem__(key: Literal[&quot;email&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;is_owner&quot;]` on object of type `dict[Literal[&quot;email&quot;], Unknown]`
- zerver/tests/test_users.py:258:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;email&quot;], Unknown].__getitem__(key: Literal[&quot;email&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;is_owner&quot;]` on object of type `dict[Literal[&quot;email&quot;], Unknown]`
- zerver/tests/test_users.py:315:25: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;email&quot;], Unknown].__getitem__(key: Literal[&quot;email&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;is_admin&quot;]` on object of type `dict[Literal[&quot;email&quot;], Unknown]`
- zerver/tests/test_users.py:317:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;email&quot;], Unknown].__getitem__(key: Literal[&quot;email&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;is_admin&quot;]` on object of type `dict[Literal[&quot;email&quot;], Unknown]`
- zerver/tests/test_users.py:358:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;email&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:359:27: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;avatar_url&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:360:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;delivery_email&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:384:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;email&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:386:13: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;avatar_url&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:399:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;email&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:401:13: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;avatar_url&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zerver/tests/test_users.py:403:26: error[invalid-argument-type] Method `__getitem__` of type `bound method dict[Literal[&quot;user_id&quot;], Unknown].__getitem__(key: Literal[&quot;user_id&quot;], /) -&gt; Unknown` cannot be called with key of type `Literal[&quot;delivery_email&quot;]` on object of type `dict[Literal[&quot;user_id&quot;], Unknown]`
- zproject/backends.py:176:21: error[invalid-argument-type] Argument to function `pad_method_dict` is incorrect: Expected `dict[str, bool]`, found `dict[str, bool] | dict[str, Literal[True]]`
- Found 3282 diagnostics
+ Found 3269 diagnostics

rotki (https://github.com/rotki/rotki)
- rotkehlchen/chain/ethereum/modules/yearn/decoder.py:404:13: error[invalid-return-type] Return type does not match returned value: expected `dict[ChecksumAddress, str]`, found `dict[ChecksumAddress, Literal[&quot;yearn-v1&quot;, &quot;yearn-v2&quot;]]`
- rotkehlchen/db/dbhandler.py:2576:9: error[no-matching-overload] No overload of bound method `update` matches arguments
- Found 2134 diagnostics
+ Found 2132 diagnostics

core (https://github.com/home-assistant/core)
- homeassistant/components/ukraine_alarm/coordinator.py:57:13: error[invalid-assignment] Invalid subscript assignment with key of type `Unknown` and value of type `Literal[True]` on object of type `dict[Unknown | str, Literal[False]]`
- Found 14474 diagnostics
+ Found 14473 diagnostics


</code></pre>


<p>No memory usage changes detected ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-14 01:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-11-14 01:44</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-argument-type</code> | 0 | 20 | 13 |
| <code>unsupported-operator</code> | 0 | 0 | 19 |
| <code>type-assertion-failure</code> | 0 | 12 | 0 |
| <code>invalid-assignment</code> | 0 | 6 | 4 |
| <code>invalid-return-type</code> | 0 | 6 | 3 |
| <code>invalid-parameter-default</code> | 0 | 0 | 3 |
| <code>possibly-missing-attribute</code> | 0 | 0 | 3 |
| <code>no-matching-overload</code> | 0 | 1 | 0 |
| <code>non-subscriptable</code> | 0 | 1 | 0 |
| <strong>Total</strong> | <strong>0</strong> | <strong>46</strong> | <strong>45</strong> |</p>
<p><strong><a href="https://ibraheem-generic-promotion.ecosystem-663.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://ibraheem-generic-promotion.ecosystem-663.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2025-11-14 02:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/ty_python_semantic/resources/mdtest/assignment/annotations.md</code>:287 on 2025-11-14 02:05</div>
            <div class="timeline-body"><p>This is fixed by <a href="https://github.com/astral-sh/ruff/pull/21442">astral-sh/ruff#21442</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3415 on 2025-11-14 20:51</div>
            <div class="timeline-body"><p>Should we be calling <code>visit_specialization_impl</code> and passing along <code>visitor</code> here? Otherwise I think we can still hit stack overflow if there is a cycle mediated by a union type?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3420 on 2025-11-14 20:51</div>
            <div class="timeline-body"><p>Same here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3424 on 2025-11-14 20:51</div>
            <div class="timeline-body"><p>And here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-11-14 20:53</div>
            <div class="timeline-body"><p>This looks great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-14 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-14 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-11-14 21:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:20:36 UTC
    </footer>
</body>
</html>
