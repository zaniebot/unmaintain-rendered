<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Use the top materialization of classes for narrowing in class-patterns for `match` statements - astral-sh/ruff #21150</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Use the top materialization of classes for narrowing in class-patterns for <code>match</code> statements</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/21150">#21150</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-10-30 19:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><p>Fixes https://github.com/astral-sh/ty/issues/1458</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-10-30 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-10-30 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-10-30 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-10-30 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-10-30 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-30 19:17</div>
            <div class="timeline-body"><!-- generated-comment typing_conformance_diagnostics_diff -->

<h2>Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a></h2>
<p>No changes detected when running ty on typing conformance tests ✅</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-10-30 19:19</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">Expression (https://github.com/cognitedata/Expression)
- expression/core/result.py:85:73: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `_TSource@default_with | _TSourceOut@Result`
- expression/core/result.py:97:65: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TResult@map, _TErrorOut@Result]`
- expression/core/result.py:113:10: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TResult@map2, _TErrorOut@Result]`
- expression/core/result.py:125:70: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TSourceOut@Result, _TResult@map_error]`
- expression/core/result.py:137:86: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TResult@bind, _TErrorOut@Result]`
- expression/core/result.py:177:10: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TSourceOut@Result, _TErrorOut@Result]`
- expression/core/result.py:191:23: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `dict[str, _TSourceOut@Result | _TErrorOut@Result | Literal[&quot;ok&quot;, &quot;error&quot;]]`
- expression/core/result.py:205:23: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TErrorOut@Result, _TSourceOut@Result]`
- expression/core/result.py:269:26: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `str`
- expression/core/try_.py:24:26: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `str`
- expression/effect/async_result.py:32:10: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TResult@bind, _TError@AsyncResultBuilder]`
- expression/effect/async_result.py:79:94: error[invalid-return-type] Function can implicitly return `None`, which is not assignable to return type `Result[_TSource@AsyncResultBuilder, _TError@AsyncResultBuilder]`
- Found 213 diagnostics
+ Found 201 diagnostics

</code></pre>
</details>
No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-10-30 19:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-10-30 19:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-10-30 20:17</div>
            <div class="timeline-body"><p>That's fun in the primer seeing a bunch of Expression Result diagnostics going away, since my issue came from also running into this making my own Result type :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-10-30 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @AlexWaygood on 2025-10-30 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-10-30 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-10-30 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-30 20:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:16:47 UTC
    </footer>
</body>
</html>
