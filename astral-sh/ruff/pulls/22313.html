<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] `cargo insta test --force-update-snapshots` - astral-sh/ruff #22313</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] <code>cargo insta test --force-update-snapshots</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22313">#22313</a>
        opened by <a href="https://github.com/oconnor663">@oconnor663</a>
        on 2025-12-30 23:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-12-30 23:13</div>
            <div class="timeline-body"><p>Snapshot tests recently started reporting this warning:</p>
<blockquote>
<p>Snapshot test passes but the existing value is in a legacy format.
Please run cargo insta test --force-update-snapshots to update to a
newer format.</p>
</blockquote>
<p>This PR is the result of that forced update.</p>
<p>One file (crates/ruff_db/src/diagnostic/render/full.rs) seems to get corrupted, because it contains strings with unprintable characters that trigger some bug in cargo-insta. I've manually reverted that file, but kept everything else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @oconnor663 on 2025-12-30 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @oconnor663 on 2025-12-30 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @oconnor663 on 2025-12-30 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @oconnor663 on 2025-12-30 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @oconnor663 on 2025-12-30 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @oconnor663 on 2025-12-30 23:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @AlexWaygood on 2025-12-30 23:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-30 23:25</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@cases__fmtskip5.py.snap</code>:3 on 2025-12-31 07:38</div>
            <div class="timeline-body"><p>Hmm, why did it remove all the input files. I would very much like to retain this information in some form or another as it is very convenient to navigate to the test file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-12-31 07:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-02 16:12</div>
            <div class="timeline-body"><p>It would be nice to merge a solution to the warnings soon, because the warnings are extremely noisy when running tests for ty locally right now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ntBre">@ntBre</a> on <code>crates/ruff_python_formatter/tests/snapshots/black_compatibility@cases__fmtskip5.py.snap</code>:3 on 2026-01-02 16:29</div>
            <div class="timeline-body"><p>Was this added by <code>insta::glob</code> and not added by <code>datatest</code>? Just a guess</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a> reviewed on 2026-01-02 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2026-01-02 19:34</div>
            <div class="timeline-body"><p>I couldn't figure out a clever way to restore all the <code>input_file</code> lines, so I just had Claude do it :) I can confirm that all the &quot;legacy format&quot; warnings from <code>main</code> are still gone if I run <code>cargo insta test</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2026-01-02 19:38</div>
            <div class="timeline-body"><p>For context, when I looked into why exactly these legacy format warnings were printing, at least some of them were because the old snapshots were only equal to current output after trimming leading newlines. Specifically:</p>
<ul>
<li>https://github.com/mitsuhiko/insta/blob/fd40cf7d5197a8ac30779c376c0d36a9ac420da8/insta/src/snapshot.rs#L664-L665</li>
<li>https://github.com/mitsuhiko/insta/blob/fd40cf7d5197a8ac30779c376c0d36a9ac420da8/insta/src/snapshot.rs#L824-L828</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2026-01-03 16:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @oconnor663 on 2026-01-05 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @oconnor663 on 2026-01-05 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-05 15:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 16:30:52 UTC
    </footer>
</body>
</html>
