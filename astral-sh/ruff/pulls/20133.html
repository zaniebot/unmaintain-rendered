<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Benchmarks for problematic implicit instance attributes cases - astral-sh/ruff #20133</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Benchmarks for problematic implicit instance attributes cases</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20133">#20133</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-08-28 12:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Summary
<p>Add regression benchmarks for the problematic cases in <a href="https://github.com/astral-sh/ty/issues/758">astral-sh/ty#758</a>. I&#x27;d like to merge this before <a href="https://github.com/astral-sh/ruff/pull/20128">astral-sh/ruff#20128</a> to measure the impact (local tests show that this will &quot;solve&quot; both cases).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-28 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-28 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-28 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-08-28 12:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:454 on 2025-08-28 12:40</div>
            <div class="timeline-body"><p>Apparently something changed here, because previously it was able to reproduce this with the attributes at the beginning of the method. Now it only seems to reproduce if they are defined at the end, after all <code>return</code>s.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-08-28 12:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:469 on 2025-08-28 12:40</div>
            <div class="timeline-body"><p>We reduced this so much that it wasn&#x27;t actually showing a problematic runtime anymore. So I added two more clauses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-08-28 12:47</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/david%2Fadd-instance-attribute-benchmarks?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #20133 will <strong>degrade performances by 34.43%</strong>
<p>Comparing <code>david/add-instance-attribute-benchmarks</code> (e407e4e) with <code>main</code> (d9aaacd)</p>
Summary
<p><code>‚ùå 1 (üëÅ 1)</code> regressions<br>
<code>‚úÖ 41</code> untouched benchmarks<br>
<code>üÜï 1</code> new benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| üëÅ | <code>ty_micro[complex_constrained_attributes_2]</code> | 63.1 ms | 96.3 ms | -34.43% |
| üÜï | <code>ty_micro[complex_constrained_attributes_3]</code> | N/A | 260.9 ms | N/A |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-28 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-28 12:48</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>‚úÖ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>‚úÖ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-08-28 12:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-28 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-28 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-28 13:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:18:07 UTC
    </footer>
</body>
</html>
