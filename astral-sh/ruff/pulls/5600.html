<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>format ExprListComp - astral-sh/ruff #5600</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>format ExprListComp</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/5600">#5600</a>
        opened by <a href="https://github.com/davidszotten">@davidszotten</a>
        on 2023-07-07 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a></div>
            <div class="timeline-body"><p>includes <code>Comprehension</code></p>
<p>The jaccard index on django goes from 0.915 to 0.923.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-07-07 19:15</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>‚úÖ ecosystem check detected no changes.</p>
<h3>Benchmark</h3>
<h4>Linux</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.05     10.3¬±0.51ms     3.9 MB/sec    1.00      9.8¬±0.33ms     4.2 MB/sec
formatter/numpy/ctypeslib.py               1.02      2.2¬±0.08ms     7.5 MB/sec    1.00      2.2¬±0.08ms     7.6 MB/sec
formatter/numpy/globals.py                 1.03   258.5¬±16.54¬µs    11.4 MB/sec    1.00   252.1¬±14.26¬µs    11.7 MB/sec
formatter/pydantic/types.py                1.02      4.9¬±0.18ms     5.2 MB/sec    1.00      4.8¬±0.20ms     5.3 MB/sec
linter/all-rules/large/dataset.py          1.03     17.2¬±0.51ms     2.4 MB/sec    1.00     16.7¬±0.42ms     2.4 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.04      4.3¬±0.17ms     3.9 MB/sec    1.00      4.1¬±0.14ms     4.0 MB/sec
linter/all-rules/numpy/globals.py          1.00   537.6¬±28.62¬µs     5.5 MB/sec    1.01   542.4¬±27.58¬µs     5.4 MB/sec
linter/all-rules/pydantic/types.py         1.03      7.7¬±0.30ms     3.3 MB/sec    1.00      7.4¬±0.26ms     3.4 MB/sec
linter/default-rules/large/dataset.py      1.03      8.6¬±0.27ms     4.7 MB/sec    1.00      8.3¬±0.27ms     4.9 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.02  1812.4¬±62.21¬µs     9.2 MB/sec    1.00  1780.8¬±82.95¬µs     9.4 MB/sec
linter/default-rules/numpy/globals.py      1.00   210.0¬±10.98¬µs    14.0 MB/sec    1.02   213.7¬±13.08¬µs    13.8 MB/sec
linter/default-rules/pydantic/types.py     1.02      3.8¬±0.11ms     6.8 MB/sec    1.00      3.7¬±0.10ms     6.9 MB/sec
</code></pre>
<h4>Windows</h4>
<pre><code>group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00     11.5¬±0.27ms     3.5 MB/sec    1.00     11.6¬±0.35ms     3.5 MB/sec
formatter/numpy/ctypeslib.py               1.01      2.6¬±0.10ms     6.4 MB/sec    1.00      2.6¬±0.11ms     6.5 MB/sec
formatter/numpy/globals.py                 1.00   296.6¬±16.65¬µs     9.9 MB/sec    1.00   296.2¬±20.78¬µs    10.0 MB/sec
formatter/pydantic/types.py                1.02      5.8¬±0.25ms     4.4 MB/sec    1.00      5.7¬±0.22ms     4.5 MB/sec
linter/all-rules/large/dataset.py          1.01     19.5¬±0.46ms     2.1 MB/sec    1.00     19.4¬±0.38ms     2.1 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      5.1¬±0.15ms     3.3 MB/sec    1.01      5.2¬±0.20ms     3.2 MB/sec
linter/all-rules/numpy/globals.py          1.01   631.1¬±37.31¬µs     4.7 MB/sec    1.00   624.9¬±26.40¬µs     4.7 MB/sec
linter/all-rules/pydantic/types.py         1.00      8.8¬±0.25ms     2.9 MB/sec    1.01      8.9¬±0.27ms     2.9 MB/sec
linter/default-rules/large/dataset.py      1.03     10.2¬±0.32ms     4.0 MB/sec    1.00      9.9¬±0.26ms     4.1 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00      2.1¬±0.08ms     7.8 MB/sec    1.00      2.1¬±0.07ms     7.8 MB/sec
linter/default-rules/numpy/globals.py      1.00    248.5¬±9.73¬µs    11.9 MB/sec    1.01   250.5¬±10.75¬µs    11.8 MB/sec
linter/default-rules/pydantic/types.py     1.01      4.6¬±0.18ms     5.6 MB/sec    1.00      4.5¬±0.15ms     5.6 MB/sec
</code></pre>
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @konstin on 2023-07-07 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @davidszotten on 2023-07-07 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-10 06:53</div>
            <div class="timeline-body"><p>I'm not entirely sure if I understand the Black difference that you're describing. There are two ways (besides what https://github.com/astral-sh/ruff/pull/5608 introduces but this hopefully isn't needed here) to control the priority</p>
<ul>
<li>Group sequences <code>group(one), group(two)</code>: The Printer expands group <code>two</code> before group <code>one</code> (<code>one</code> has a higher priority)</li>
<li>Group nesting <code>group(one, group(two)): The printer expands *outer* groups before inner groups. In this case, the group </code>one<code>expands before group</code>two`.</li>
</ul>
<p>You may need to use a group sequence here (one group for the value, one group for the body)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1290 on 2023-07-10 06:59</div>
            <div class="timeline-body"><p>Nit: We should assert that this is indeed the <code>in</code> token. Is there a possibility that the expression is parenthesized? If so, you may also need to skip over any <code>)</code> or<code>(</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1337 on 2023-07-10 07:01</div>
            <div class="timeline-body"><p>Nit: We should assert that this is indeed the expected <code>if</code> token and not any other token. You may also need to deal with any <code>(</code> or <code>)</code> in case the expression can be parenthesized.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1352 on 2023-07-10 07:01</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    CommentPlacement::Default(comment)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/expr_list_comp.rs</code>:34 on 2023-07-10 07:02</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                    elt.format(),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/expression/expr_list_comp.rs</code>:33 on 2023-07-10 07:04</div>
            <div class="timeline-body"><p>Question: <code>parenthesized</code> already adds a group. Is this additional group required or should it maybe only wrap the <code>value</code> rather than the value and <code>joined</code>? This way the printer would first try to expand <code>joined</code>, and only fallback to expanding <code>value</code> if the line still exceeds the configured line width.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:30 on 2023-07-10 07:13</div>
            <div class="timeline-body"><p>This is necessary because <code>leading_comments</code> only format trailing whitespace. This is necessary to avoid that the statement formatting and leading comments insert the same whitespace, resulting in doubling the whitespace on every formatting pass.</p>
<pre><code class="language-suggestion">        // TODO: why is this needed?
        if let Some(leading_item_comment) = leading_item_comments.first() {
            if leading_item_comment.line_position().is_own_line() {
                hard_line_break().fmt(f)?;
            }
            leading_comments(leading_item_comments).fmt(f)?;
        }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:51 on 2023-07-10 07:14</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                    target.format(),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:64 on 2023-07-10 07:16</div>
            <div class="timeline-body"><p>The trailing underscore reads a bit strange.</p>
<p>Nit:</p>
<pre><code class="language-suggestion">                for if_case in ifs {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:94 on 2023-07-10 07:18</div>
            <div class="timeline-body"><p>Nit: Can you explain why it is necessary to manually format the leading comments? This should only rarely be necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:78 on 2023-07-10 07:18</div>
            <div class="timeline-body"><p>We can override <code>fmt_dangling_comments</code> here since you're handling it in the <code>fmt_fields</code> function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:87 on 2023-07-10 07:20</div>
            <div class="timeline-body"><p>Can you use <code>traling_comments</code> instead? It inserts an empty line for own line comments or renders it as a line suffix with two spaces.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1281 on 2023-07-10 07:23</div>
            <div class="timeline-body"><p>Nit: I find it helpful to add some examples above every case:</p>
<pre><code>// Comments between the `for` and target
// ```python
//  [a for # trailing for comment
// 	b in c]
// # or 
// [a for
// 	# leading b comment
//		b in c
// ]
// ```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2023-07-10 07:27</div>
            <div class="timeline-body"><p>Nice. Implementing list comprehension was on my TODO list for this week, I guess no more :) Would you mind commenting on https://github.com/astral-sh/ruff/issues/4798 next time before starting to work on a new syntax for better coordination?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @MichaReiser on 2023-07-10 07:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1290 on 2023-07-10 09:17</div>
            <div class="timeline-body"><p>I'd use <code>.expect(&quot;could not find </code>if<code> token in list comprehension&quot;)</code>, i think crashing is more reasonable here than trying to format under false assumptions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/expression/expr_list_comp.rs</code>:33 on 2023-07-10 09:20</div>
            <div class="timeline-body"><p>nit: just <code>format_args!</code> (without <code>self</code>) after importing it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/expression/expr_list_comp.rs</code>:33 on 2023-07-10 09:40</div>
            <div class="timeline-body"><p>i'll check, but it might also be a mistake, <code>parenthesized</code> landed after i'd written this code and i added it in when i spotted it landing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 09:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/expression/expr_list_comp.rs</code>:33 on 2023-07-10 09:43</div>
            <div class="timeline-body"><p>but i should also admit i don't fully grok the rules around expanding and groups yet, and sometimes end up trying a bunch of variations on examples. your explanation in a previous comment above helps a bit though (group sequences and nesting)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 09:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:30 on 2023-07-10 09:46</div>
            <div class="timeline-body"><p>i was surprised because i hadn't had to do this in any of my previous prs (eg <code>for</code>, <code>try/except</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 09:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 09:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:64 on 2023-07-10 09:47</div>
            <div class="timeline-body"><p>yes, was struggling a bit with naming, esp in the places where i have both an if-node and an if-statement</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@statement__list_comp.py.snap</code>:53 on 2023-07-10 10:13</div>
            <div class="timeline-body"><p>black formats this as</p>
<pre><code class="language-python">[
    i
    for i in [
        1,
    ]
]
</code></pre>
<p>which i prefer, but i expect that to be unreasonably hard to implement (breaking the inner group but not the outer group)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-07-10 10:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:30 on 2023-07-10 11:20</div>
            <div class="timeline-body"><p>I think you did this in your first version before you switched to <code>leading_alternate_branch_comments</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-10 11:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_formatter/tests/snapshots/format@statement__list_comp.py.snap</code>:53 on 2023-07-10 11:23</div>
            <div class="timeline-body"><p>Hmm interesting. I think this goes into the one case that my expression formatting refactor doesn't cover yet (and I also don't fully understand yet).</p>
<p>Black sometimes (for example on expression statement level) only expands by parenthesized expressions, but not by operators. But it does sometimes and inserts optional parentheses. I haven't understood the rules around this yet.  It could be related and we may want to wait with addressing it just yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2023-07-10 11:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 12:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1290 on 2023-07-10 12:53</div>
            <div class="timeline-body"><p>oh interesting. i though the brackets would be part of the node. til</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 13:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:51 on 2023-07-10 13:33</div>
            <div class="timeline-body"><p>üëç clippy usually complains about these (but not this one)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 13:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:94 on 2023-07-10 13:39</div>
            <div class="timeline-body"><p>hm, looks like it isn't (anymore?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/other/comprehension.rs</code>:87 on 2023-07-10 15:57</div>
            <div class="timeline-body"><p>actually this wasn't needed at all in the end</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-07-10 16:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1290 on 2023-07-10 16:03</div>
            <div class="timeline-body"><p>it's really inconsistent unfortunately (it's a particularity of our parser), e.g. tuple parentheses but others aren't are so <code>((1,2,3))</code> the range contains the inner parentheses but not the outer while in <code>(1 + 2)</code> they are not part of the range at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/davidszotten">@davidszotten</a> on <code>crates/ruff_python_formatter/src/comments/placement.rs</code>:1290 on 2023-07-10 18:35</div>
            <div class="timeline-body"><p><code>find_only_token_in_range</code> also has this problem. will fix in this pr (and then use that function)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidszotten">@davidszotten</a> reviewed on 2023-07-10 18:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-10 19:45</div>
            <div class="timeline-body"><p>ready i think</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2023-07-11 06:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-07-11 06:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-11 06:51</div>
            <div class="timeline-body"><p>üëç</p>
<p>I‚Äôll have a look at the other comprehensions next</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-11 06:54</div>
            <div class="timeline-body"><blockquote>
<p>+1</p>
<p>I‚Äôll have a look at the other comprehensions next</p>
</blockquote>
<p>Nice. Do you have the permissions to create an issue from https://github.com/astral-sh/ruff/issues/4798 and assign it to you? If not, then I'll create it and assign it to you for you, if you let me know on which comprehension you want to work first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-11 07:41</div>
            <div class="timeline-body"><p>i don't think I have any repo permissions. i guess i can create issues (not sure what you by by creating &quot;from 4798&quot;, do you mean and link from there?) but not assign</p>
<p>from a quick look, set and dict are pretty much like list comps so seem quite straightforward. generator comprehensions are trickier because the brackets are optional in some contexts but mandatory in others</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-11 07:44</div>
            <div class="timeline-body"><blockquote>
<p>i don't think I have any repo permissions. i guess i can create issues (not sure what you by by creating &quot;from 4798&quot;, do you mean and link from there?) but not assign</p>
<p>from a quick look, set and dict are pretty much like list comps so seem quite straightforward. generator comprehensions are trickier because the brackets are optional in some contexts but mandatory in others</p>
</blockquote>
<p>There's a button at the end that allows you to automatically create an issue:</p>
<p><img src="https://github.com/astral-sh/ruff/assets/1203881/f11d3f7e-fcc5-490d-a252-ec1b01410dd4" alt="image" /></p>
<p>I created https://github.com/astral-sh/ruff/issues/5674 now. I can assign it to you if you leave a comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-11 07:46</div>
            <div class="timeline-body"><blockquote>
<p>There's a button at the end that allows you to automatically create an issue:</p>
</blockquote>
<p>the circle with the dot in? i don't have that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-11 07:49</div>
            <div class="timeline-body"><p>while there is still other work to do, maybe we can mark <code>set</code> and <code>list</code> comp as &quot;easy (see list comp)&quot; to encourage newcomers?</p>
<p>you can assign met to generator exp though i'll probably need a pointer on how to approach this bracket issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-11 07:56</div>
            <div class="timeline-body"><blockquote>
<p>the circle with the dot in? i don't have that</p>
</blockquote>
<p>Yes. Hmm, that's unfortunate. I created the issue https://github.com/astral-sh/ruff/issues/5676</p>
<blockquote>
<p>you can assign met to generator exp though i'll probably need a pointer on how to approach this bracket issue</p>
</blockquote>
<p>I'm currently looking into the expression handling. I, incorrectly, assumed that Black only uses the <em>expand the right hand side before operands</em> on the top level. But there seem to be other places where it applies the same logic (generators, with items, ... potentially more).</p>
<p>You can ignore this for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidszotten">@davidszotten</a> on 2023-07-11 08:03</div>
            <div class="timeline-body"><p>brackets:</p>
<p>ok. note that for generator expressions it's not just a question of style, as the brackets are _required in some contexts. see e.g. https://peps.python.org/pep-0289/</p>
<blockquote>
<p>This means that you can write:</p>
<p><code>sum(x**2 for x in range(10))</code>
but you would have to write:</p>
<p><code>reduce(operator.add, (x**2 for x in range(10)))</code>
and also:</p>
<p><code>g = (x**2 for x in range(10))</code></p>
</blockquote>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:58:36 UTC
    </footer>
</body>
</html>
