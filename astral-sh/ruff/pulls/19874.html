<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] typecheck dict methods for `TypedDict` - astral-sh/ruff #19874</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] typecheck dict methods for <code>TypedDict</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19874">#19874</a>
        opened by <a href="https://github.com/PrettyWood">@PrettyWood</a>
        on 2025-08-12 09:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/PrettyWood">@PrettyWood</a></div>
            <div class="timeline-body">Summary
<p>Typecheck <code>get()</code>, <code>setdefault()</code>, <code>pop()</code> for <code>TypedDict</code></p>
<pre><code>from typing import TypedDict
from typing_extensions import NotRequired

class Employee(TypedDict):
    name: str
    department: NotRequired[str]

emp = Employee(name=&quot;Alice&quot;, department=&quot;Engineering&quot;)

emp.get(&quot;name&quot;)
emp.get(&quot;departmen&quot;, &quot;Unknown&quot;)
emp.pop(&quot;department&quot;)
emp.pop(&quot;name&quot;)
</code></pre>
<p><img alt="Screenshot 2025-08-12 at 11 42 12" src="https://github.com/user-attachments/assets/77ce150a-223c-4931-b914-551095d8a3a6"></p>
<p>part of <a href="https://github.com/astral-sh/ty/issues/154">astral-sh/ty#154</a></p>
Test Plan
<p>Updated Markdown tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/PrettyWood">@PrettyWood</a> on 2025-08-12 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/PrettyWood">@PrettyWood</a> on 2025-08-12 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/PrettyWood">@PrettyWood</a> on 2025-08-12 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/PrettyWood">@PrettyWood</a> on 2025-08-12 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/PrettyWood">@PrettyWood</a> on 2025-08-12 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-12 10:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for <a href="https://github.com/carljm">@carljm</a> removed by <a href="https://github.com/carljm">@carljm</a> on 2025-08-19 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-25 12:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 12:53</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-08-29 13:40:04.333301009 +0000
+++ new-output.txt	2025-08-29 13:40:06.963314808 +0000
@@ -849,7 +849,6 @@
 tuples_type_form.py:25:1: error[invalid-assignment] Object of type `tuple[Literal[1]]` is not assignable to `tuple[()]`
 tuples_type_form.py:36:1: error[invalid-assignment] Object of type `tuple[Literal[1], Literal[2], Literal[3], Literal[&quot;&quot;]]` is not assignable to `tuple[int, ...]`
 typeddicts_operations.py:37:5: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `Movie` constructor
-typeddicts_operations.py:60:1: error[type-assertion-failure] Argument does not have asserted type `str | None`
 typeddicts_operations.py:62:1: error[unresolved-attribute] Type `MovieOptional` has no attribute `clear`
 typeddicts_readonly_inheritance.py:65:1: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `RequiredName` constructor
 typeddicts_type_consistency.py:69:21: error[invalid-key] Invalid key access on TypedDict `A3`: Unknown key &quot;y&quot;
@@ -859,5 +858,5 @@
 typeddicts_usage.py:28:1: error[missing-typed-dict-key] Missing required key &#x27;name&#x27; in TypedDict `Movie` constructor
 typeddicts_usage.py:28:18: error[invalid-key] Invalid key access on TypedDict `Movie`: Unknown key &quot;title&quot;
 typeddicts_usage.py:40:24: error[invalid-type-form] The special form `typing.TypedDict` is not allowed in type expressions. Did you mean to use a concrete TypedDict or `collections.abc.Mapping[str, object]` instead?
-Found 860 diagnostics
+Found 859 diagnostics
 WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 12:55</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>openlibrary (https://github.com/internetarchive/openlibrary)
+ openlibrary/plugins/worksearch/code.py:447:34: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Iterable[Unknown]`, found `list[str] | None`
+ openlibrary/plugins/worksearch/code.py:447:61: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Iterable[Unknown]`, found `list[str] | None`
- Found 709 diagnostics
+ Found 711 diagnostics

discord.py (https://github.com/Rapptz/discord.py)
- discord/activity.py:882:38: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- discord/member.py:390:41: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 533 diagnostics
+ Found 531 diagnostics

meson (https://github.com/mesonbuild/meson)
+ mesonbuild/interpreter/interpreter.py:1804:69: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `dict[str, str] | None`, found `dict[OptionKey, str | int | list[str]]`
+ mesonbuild/modules/python.py:169:42: error[invalid-key] Invalid key access on TypedDict `ExtensionModuleKw`: Unknown key &quot;limited_api&quot;
- Found 808 diagnostics
+ Found 810 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
+ src/prefect/runner/storage.py:851:13: error[invalid-return-type] Return type does not match returned value: expected `str`, found `str | (Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
+ src/prefect/runner/storage.py:858:13: error[invalid-return-type] Return type does not match returned value: expected `str`, found `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | str | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
+ src/prefect/runner/storage.py:859:16: warning[possibly-unbound-attribute] Attribute `startswith` on type `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (str &amp; ~AlwaysFalsy) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)` is possibly unbound
+ src/prefect/runner/storage.py:866:13: error[invalid-return-type] Return type does not match returned value: expected `str`, found `str | (Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
+ src/prefect/runner/storage.py:867:20: warning[possibly-unbound-attribute] Attribute `startswith` on type `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (str &amp; ~AlwaysFalsy) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)` is possibly unbound
+ src/prefect/runner/storage.py:872:12: error[invalid-return-type] Return type does not match returned value: expected `str`, found `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (str &amp; ~AlwaysFalsy) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
- Found 3013 diagnostics
+ Found 3019 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ ddtrace/llmobs/_experiment.py:506:28: warning[redundant-cast] Value is already of type `int`
- Found 6602 diagnostics
+ Found 6603 diagnostics

</code></pre>

No memory usage changes detected ✅

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2331 on 2025-08-25 12:56</div>
            <div class="timeline-body"><p>I think that would be more of an opinionated lint rule, rather than a hard error. So I suggest we remove that comment for now:</p>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2388 on 2025-08-25 12:59</div>
            <div class="timeline-body"><p>If the return type is the same (and should stay the same, see my other comment), could we merge these two overloads (with and without default value) into a single overload where the <code>default</code> parameter has a default value?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-25 13:01</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-return-type</code> | 4 | 0 | 0 |
| <code>invalid-argument-type</code> | 3 | 0 | 0 |
| <code>possibly-unbound-attribute</code> | 2 | 0 | 0 |
| <code>unused-ignore-comment</code> | 0 | 2 | 0 |
| <code>invalid-key</code> | 1 | 0 | 0 |
| <code>redundant-cast</code> | 1 | 0 | 0 |
| <strong>Total</strong> | <strong>11</strong> | <strong>2</strong> | <strong>0</strong> |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2339 on 2025-08-25 13:19</div>
            <div class="timeline-body"><p>I&#x27;m wondering if this signature is too strict? Take this example:</p>
<pre><code>from typing import TypedDict, reveal_type

class T(TypedDict, total=False):
    a: str

def _(t: T):
    reveal_type(t.get(&quot;a&quot;, 0))
</code></pre>
<p>mypy, pyright, and pyrefly all agree that this code is fine and that the type of the <code>.get</code> call should be <code>str | Literal[0]</code> (or <code>str | int</code>). Instead, with this synthesized overload here, we get an error and a return type of <code>Unknown</code>:</p>
<pre><code>info[revealed-type]: Revealed type
 --&gt; /home/shark/playground/test.py:9:17
  |
8 | def _(t: T):
9 |     reveal_type(t.get(&quot;a&quot;, 0))
  |                 ^^^^^^^^^^^^^ `Unknown`
  |

error[invalid-argument-type]: Argument is incorrect
 --&gt; /home/shark/playground/test.py:9:28
  |
8 | def _(t: T):
9 |     reveal_type(t.get(&quot;a&quot;, 0))
  |                            ^ Expected `str`, found `Literal[0]`
  |
</code></pre>
<p>I have not checked if this behavior is specified somewhere (we should do that), but if not, it feels safer to go with the behavior or the other type checkers here and return a union of the declared field type and the type of the default argument. This would probably require us to make that overload generic.</p>
<p>A similar comment might also apply to <code>.pop</code> and <code>.setdefault</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:6277 on 2025-08-25 13:26</div>
            <div class="timeline-body"><p>This won&#x27;t capture all <code>.pop</code> calls (imagine e.g. <code>method = person.pop; method(&quot;some_required_key&quot;)</code>, but it&#x27;s still a very nice touch!</p>
<p>It&#x27;s not impossible to make this work for all calls, I think. But it would require a significant rework of our call machinery, and I don&#x27;t think it&#x27;s important enough to do.</p>
<p>Even if we miss some calls to these methods by explicitly matching on <code>Expr::Attribute</code>, it&#x27;s not like we won&#x27;t emit an error. We will only fall back to a worse error message (e.g. no-matching-overload), which seems fine to me if it&#x27;s relatively rare. I think this behavior might be worth documenting in a test, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> requested changes on 2025-08-25 13:28</div>
            <div class="timeline-body"><p>Thank you very much. This looks great.</p>
<p>I looked through a few ecosystem changes here (and found a problem with <code>.get</code> calls with a default argument of a different type, which I commented on inline), but it might be worth going through a few more to see if we&#x27;re missing anything in the implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 11:06</div>
            <div class="timeline-body"><p>I&#x27;m currently looking into making the required changes here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 11:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 11:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-08-29 11:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:7552 on 2025-08-29 11:57</div>
            <div class="timeline-body"><p>@dcreager Would be great if you could take a short look at this new method here.. and the new constructor in <code>generics.rs</code>. Mainly to check my wording in the doc comments / function names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 12:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 12:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> removed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2419 on 2025-08-29 13:06</div>
            <div class="timeline-body"><p>nit: <code>CallableSignature::from_overloads</code> takes in an iterator, so I think you can skip the <code>collect</code> here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2474 on 2025-08-29 13:06</div>
            <div class="timeline-body"><p>and here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2503 on 2025-08-29 13:06</div>
            <div class="timeline-body"><p>and here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/src/types/generics.rs</code>:131 on 2025-08-29 13:10</div>
            <div class="timeline-body"><p>nit: I&#x27;d suggest removing the &quot;(synthetic)&quot; part, since that doesn&#x27;t have to be a limitation on when you can use this constructor.  And I think you could simplify <code>from_type_params</code> and <code>normalized_impl</code> to delegate to this constructor to do the collecting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-08-29 13:10</div>
            <div class="timeline-body"><p>Just a couple of comments re the generics/typevar changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 13:19</div>
            <div class="timeline-body"><p>Ok, after adding some fallback overloads for <code>.get</code>, we&#x27;re now down to a reasonable number of ecosystem changes.</p>
<pre><code>discord.py (https://github.com/Rapptz/discord.py)
- discord/activity.py:882:38: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- discord/member.py:390:41: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 533 diagnostics
+ Found 531 diagnostics
</code></pre>
<p>Correct, they are <code>.pop</code> ing a required key, and silence that with <code># type: ignore</code>.</p>
<pre><code>openlibrary (https://github.com/internetarchive/openlibrary)
+ openlibrary/plugins/worksearch/code.py:447:34: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Iterable[Unknown]`, found `list[str] | None`
+ openlibrary/plugins/worksearch/code.py:447:61: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `Iterable[Unknown]`, found `list[str] | None`
- Found 709 diagnostics
+ Found 711 diagnostics
</code></pre>
<p>True positives. They have a key with value type <code>list[str] | None</code>, and then use <code>.get(&quot;that_key&quot;, [])</code> in an attempt to replace <code>None</code> with <code>[]</code>. But that doesn&#x27;t work. <code>get</code> won&#x27;t replace values of type <code>None</code> with the default. It only replaces missing keys with the default.</p>
<pre><code>meson (https://github.com/mesonbuild/meson)
+ mesonbuild/interpreter/interpreter.py:1804:69: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `dict[str, str] | None`, found `dict[OptionKey, str | int | list[str]]`
+ mesonbuild/modules/python.py:169:42: error[invalid-key] Invalid key access on TypedDict `ExtensionModuleKw`: Unknown key &quot;limited_api&quot;
- Found 808 diagnostics
+ Found 810 diagnostics
</code></pre>
<p>Both look like true positives to me</p>
<pre><code>prefect (https://github.com/PrefectHQ/prefect)
+ src/prefect/runner/storage.py:851:13: error[invalid-return-type] Return type does not match returned value: expected `str`, found `str | (Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
+ src/prefect/runner/storage.py:858:13: error[invalid-return-type] Return type does not match returned value: expected `str`, found `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | str | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
+ src/prefect/runner/storage.py:859:16: warning[possibly-unbound-attribute] Attribute `startswith` on type `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (str &amp; ~AlwaysFalsy) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)` is possibly unbound
+ src/prefect/runner/storage.py:866:13: error[invalid-return-type] Return type does not match returned value: expected `str`, found `str | (Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
+ src/prefect/runner/storage.py:867:20: warning[possibly-unbound-attribute] Attribute `startswith` on type `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (str &amp; ~AlwaysFalsy) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)` is possibly unbound
+ src/prefect/runner/storage.py:872:12: error[invalid-return-type] Return type does not match returned value: expected `str`, found `(Any &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (str &amp; ~AlwaysFalsy) | (Secret[str] &amp; ~AlwaysFalsy &amp; ~Secret[Unknown]) | (@Todo(Type::Intersection.call()) &amp; ~AlwaysFalsy)`
- Found 3013 diagnostics
+ Found 3019 diagnostics
</code></pre>
<p>Seems unrelated to <code>TypedDict</code>, only surfaces because we don&#x27;t infer <code>Unknown</code> anymore. Potentially related to <a href="https://github.com/astral-sh/ty/issues/456">astral-sh/ty#456</a>.</p>
<pre><code>dd-trace-py (https://github.com/DataDog/dd-trace-py)
+ ddtrace/llmobs/_experiment.py:506:28: warning[redundant-cast] Value is already of type `int`
- Found 6602 diagnostics
+ Found 6603 diagnostics
</code></pre>
<p>True positive</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2419 on 2025-08-29 13:23</div>
            <div class="timeline-body"><p>Oops, yes. I missed this in my review. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-08-29 13:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> approved on 2025-08-29 13:30</div>
            <div class="timeline-body"><p>Thanks again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2396 on 2025-08-29 13:33</div>
            <div class="timeline-body"><p>Wouldn&#x27;t <code>Unknown | None</code> be better here, to express the fact that the unknown key might not be present (it might be a subtype of this typeddict, but it also might not?)?</p>
<pre><code>                            Some(UnionType::from_elements(db, [Type::unknown(), Type::none(db)])),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-29 13:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-08-29 13:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types/class.rs</code>:2396 on 2025-08-29 13:39</div>
            <div class="timeline-body"><p>Yes, that makes sense — changed. Let&#x27;s see if that leads to new diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/typed_dict.md</code>:487 on 2025-08-29 13:42</div>
            <div class="timeline-body"><p>I feel like ideally we&#x27;d still infer <code>str</code> here (despite the fact that the operation is illegal, it seems pretty clear that the result of this operation will always be a <code>str</code>), but I can see that that might be difficult to do <em>consistently</em> with the synthesized-overload approach. And consistently inferring <code>Unknown</code> here seems better than sometimes inferring <code>Unknown</code>, sometimes <code>str</code> (depending on exactly how the method is invoked on the typeddict object).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2025-08-29 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-08-29 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/resources/mdtest/typed_dict.md</code>:487 on 2025-08-29 14:24</div>
            <div class="timeline-body"><blockquote>
<p>I feel like ideally we&#x27;d still infer <code>str</code> here (despite the fact that the operation is illegal, it seems pretty clear that the result of this operation will always be a <code>str</code>)</p>
</blockquote>
<p>Yes, interesting point. I agree that this would probably be the better return type, but as you said, it&#x27;s not possible to achieve that with synthesized overloads, unless we manage to synthesize overloads that trigger specific <code>CallError</code>s when selected, or similar. Until then, <code>Unknown</code> is not ideal, but it&#x27;s also not wrong. And if you&#x27;re going to <code># type: ignore</code> your illegal <code>.pop</code> operation, you might as well throw in a <code>cast</code> or a redeclaration :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-29 14:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:17:39 UTC
    </footer>
</body>
</html>
