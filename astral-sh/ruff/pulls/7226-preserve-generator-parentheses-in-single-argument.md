```yaml
number: 7226
title: Preserve generator parentheses in single argument call expressions
type: pull_request
state: merged
author: MichaReiser
labels:
  - formatter
assignees: []
merged: true
base: main
head: fix-generator-parenthesization
created_at: 2023-09-07T17:12:01Z
updated_at: 2023-09-08T08:53:35Z
url: https://github.com/astral-sh/ruff/pull/7226
synced_at: 2026-01-12T15:55:23Z
```

# Preserve generator parentheses in single argument call expressions

---

_@MichaReiser_

## Summary

This PR fixes an issue discovered in our dogfooding session where Ruff removes the generator parentheses but black preserves them. 

Ruff has special handling for formatting generators when they are they only argument in a call expression. However, the existing implementation always removed the parentheses rather than preserving them. 

This PR changes the logic to only omit the parentheses if they aren't present in the source. 

## Test Plan

Added tests

The similarity index for `transformers` improves from 0.99928 -> 0.99929



---

_Comment by @MichaReiser on 2023-09-07 17:12_

Current dependencies on/for this PR:
* main
  * **PR #7226** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7226" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7226?utm_source=stack-comment).

---

_Label `formatter` added by @MichaReiser on 2023-09-07 17:12_

---

_Review comment by @konstin on `crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap`:389 on 2023-09-07 17:16_

this looks worse to me

---

_Review comment by @konstin on `crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap`:392 on 2023-09-07 17:16_

when it breaks this looks fine, but i kinda prefer no parentheses for consistency

---

_Review comment by @konstin on `crates/ruff_python_formatter/tests/snapshots/format@expression__generator_exp.py.snap`:74 on 2023-09-07 17:17_

i agree with this one

---

_@konstin approved on 2023-09-07 17:17_

---

_@MichaReiser reviewed on 2023-09-07 17:22_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap`:389 on 2023-09-07 17:22_

My reasoning here is that Black (and ruff) preserve parentheses of nested expressions. Not doing so violates that principle and it is not that Ruff introduces the parentheses if the user wrote the generator without. 

So I think this comes down to the question of whether Ruff/Black should normalize all parenthesized expressions. The current philosophy is to preserve them. That's why I'm leaning toward changing it.

CC: @zanieb who discovered this during dogfooding

---

_@MichaReiser reviewed on 2023-09-07 18:09_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap`:389 on 2023-09-07 18:09_

I think I would be leaning towards removing them if there's precedence for e.g. tuples but black preserve tuple parentheses too: 

```python
a = (1, 2)
```

---

_Review comment by @konstin on `crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap`:389 on 2023-09-08 08:26_

i'm fine with merging this! It's a the clear compatibility problem, i just don't like the decision to have double parentheses `((...))` (without or without whitespace in between)

---

_@konstin reviewed on 2023-09-08 08:26_

---

_Review comment by @MichaReiser on `crates/ruff_python_formatter/tests/snapshots/format@expression__call.py.snap`:389 on 2023-09-08 08:31_

I agree, in which case we should change `call((1, 2))` too (or even `call((1))`)

---

_@MichaReiser reviewed on 2023-09-08 08:31_

---

_Merged by @MichaReiser on 2023-09-08 08:53_

---

_Closed by @MichaReiser on 2023-09-08 08:53_

---

_Branch deleted on 2023-09-08 08:53_

---
