<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Understand classes that inherit from subscripted `Protocol[]` as generic - astral-sh/ruff #17832</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Understand classes that inherit from subscripted <code>Protocol[]</code> as generic</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17832">#17832</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-05-04 13:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<ul>
<li>Understand that classes that inherit from <code>Protocol[]</code> are generic in exactly the same way as classes that inherit from <code>Generic[]</code>. This fixes our MRO inference for a large number of stdlib classes.</li>
<li>Add the special case for displaying a specialisation of the <code>tuple</code> class: although <code>tuple</code> is only generic over a single type variable in typeshed, a homogeneous tuple is spelled <code>tuple[int, ...]</code> in type annotations rather than <code>tuple[int]</code>.</li>
<li>Add TODO branches for various things that now lead to false-positive errors as a result of our improved understanding of the MROs for a whole range of stdlib classes. In particular:<ul>
<li>Ensure we continue to not emit false positives on functional <code>NamedTuple</code> syntax, e.g. <code>Person = NamedTuple(&quot;Person&quot;, [(&quot;Name&quot;, int)])</code></li>
<li>Ensure we continue to not emit false positives on classes that inherit from heterogeneous tuples, e.g. <code>tuple[int, str]</code></li>
<li>Ensure we continue to not emit false positives on unpacked tuples in type annotations, e.g. <code>*tuple[int, ...]</code></li>
</ul>
</li>
</ul>
Test Plan
<p>Existing mdtests updated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:49</div>
            <div class="timeline-body"><p>I obviously need to investigate the panic found in mypy_primer, but apart from that I think this is ready for review, so I&#x27;ll take it out of draft.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 13:54</div>
            <div class="timeline-body"><blockquote>
<p>I obviously need to investigate the panic found in mypy_primer</p>
</blockquote>
<p>I haven&#x27;t looked into it yet, but I&#x27;m removing <code>packaging</code> from the project selector for now so that I can see what the primer results are on all other projects...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[ty] Understand classes that inherited from subscripted `Protocol[]` as generic&quot; to &quot;[ty] Understand classes that inherit from subscripted `Protocol[]` as generic&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 14:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-04 15:04</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>async-utils (https://github.com/mikeshardmind/async-utils)
+ error[lint:invalid-argument-type] src/async_utils/bg_loop.py:81:42: Argument to this function is incorrect: Expected `Future[_T] | Future[_T]`, found `Future[_T]`
+ error[lint:invalid-argument-type] src/async_utils/corofunc_cache.py:117:50: Argument to this function is incorrect: Expected `Future[_T] | Future[_T]`, found `Future[R]`
+ error[lint:invalid-argument-type] src/async_utils/corofunc_cache.py:196:50: Argument to this function is incorrect: Expected `Future[_T] | Future[_T]`, found `Future[R]`
+ error[lint:invalid-argument-type] src/async_utils/task_cache.py:176:43: Argument to this function is incorrect: Expected `Future[_T] | Future[_T]`, found `Future[R]`
+ error[lint:invalid-return-type] src/async_utils/task_cache.py:177:24: Return type does not match returned value: Expected `Task[R]`, found `Task[_T]`
+ error[lint:invalid-argument-type] src/async_utils/task_cache.py:262:43: Argument to this function is incorrect: Expected `Future[_T] | Future[_T]`, found `Future[R]`
+ error[lint:invalid-return-type] src/async_utils/task_cache.py:263:24: Return type does not match returned value: Expected `Task[R]`, found `Task[_T]`
- Found 22 diagnostics
+ Found 29 diagnostics

pytest-robotframework (https://github.com/detachhead/pytest-robotframework)
+ error[lint:no-matching-overload] pytest_robotframework/__init__.py:302:22: No overload of bound method `__init__` matches arguments
- error[lint:unresolved-attribute] pytest_robotframework/_internal/pytest/plugin.py:452:21: Unresolved attribute `_stream` on type `_RedirectStream`.
+ error[lint:unresolved-attribute] pytest_robotframework/_internal/pytest/plugin.py:452:21: Unresolved attribute `_stream` on type `_RedirectStream[IO[str]]`.
- error[lint:type-assertion-failure] tests/type_tests.py:41:9: Actual type `(...) -&gt; Unknown` is not the same as asserted type `() -&gt; @Todo(specialized non-generic class)`
+ error[lint:type-assertion-failure] tests/type_tests.py:41:9: Actual type `(...) -&gt; Unknown` is not the same as asserted type `() -&gt; AbstractContextManager[None, bool | None]`
- error[lint:type-assertion-failure] tests/type_tests.py:49:9: Actual type `(...) -&gt; Unknown` is not the same as asserted type `() -&gt; @Todo(specialized non-generic class)`
+ error[lint:type-assertion-failure] tests/type_tests.py:49:9: Actual type `(...) -&gt; Unknown` is not the same as asserted type `() -&gt; _GeneratorContextManager[None]`
- Found 233 diagnostics
+ Found 234 diagnostics

com2ann (https://github.com/ilevkivskyi/com2ann)
+ error[lint:invalid-argument-type] src/com2ann.py:667:23: Argument to this function is incorrect: Expected `str`, found `str | None`
- Found 9 diagnostics
+ Found 10 diagnostics

mypy_primer (https://github.com/hauntsaninja/mypy_primer)
- error[lint:unsupported-operator] mypy_primer/main.py:168:23: Operator `*` is unsupported between objects of type `list` and `int | None`
+ error[lint:unsupported-operator] mypy_primer/main.py:168:23: Operator `*` is unsupported between objects of type `list[Unknown]` and `int | None`
+ error[lint:no-matching-overload] mypy_primer/utils.py:33:12: No overload of bound method `__init__` matches arguments
- Found 15 diagnostics
+ Found 16 diagnostics

parso (https://github.com/davidhalter/parso)
- error[lint:invalid-parameter-default] parso/grammar.py:53:15: Default value of type `None` is not assignable to annotated parameter type `PathLike | str`
+ error[lint:invalid-parameter-default] parso/grammar.py:53:15: Default value of type `None` is not assignable to annotated parameter type `PathLike[Unknown] | str`
- error[lint:invalid-parameter-default] parso/grammar.py:57:15: Default value of type `None` is not assignable to annotated parameter type `PathLike | str`
+ error[lint:invalid-parameter-default] parso/grammar.py:57:15: Default value of type `None` is not assignable to annotated parameter type `PathLike[Unknown] | str`
- error[lint:invalid-argument-type] parso/python/diff.py:884:35: Argument to this function is incorrect: Expected `tuple[int, int]`, found `tuple`
+ error[lint:invalid-argument-type] parso/python/diff.py:884:35: Argument to this function is incorrect: Expected `tuple[int, int]`, found `tuple[Unknown, ...]`
+ error[lint:no-matching-overload] parso/python/errors.py:650:22: No overload of bound method `__init__` matches arguments
- error[lint:invalid-argument-type] parso/python/tokenize.py:230:42: Argument to this function is incorrect: Expected `tuple[str]`, found `set`
+ error[lint:invalid-argument-type] parso/python/tokenize.py:230:42: Argument to this function is incorrect: Expected `tuple[str]`, found `set[Unknown]`
- error[lint:invalid-parameter-default] parso/python/tokenize.py:367:5: Default value of type `None` is not assignable to annotated parameter type `list`
+ error[lint:invalid-parameter-default] parso/python/tokenize.py:367:5: Default value of type `None` is not assignable to annotated parameter type `list[Unknown]`
- Found 82 diagnostics
+ Found 83 diagnostics

paroxython (https://github.com/laowantong/paroxython)
+ error[lint:no-matching-overload] paroxython/map_taxonomy.py:168:47: No overload of function `dirname` matches arguments
+ error[lint:no-matching-overload] paroxython/parse_program.py:79:26: No overload of function `dirname` matches arguments
- Found 15 diagnostics
+ Found 17 diagnostics

beartype (https://github.com/beartype/beartype)
- error[lint:unsupported-operator] beartype/_cave/_cavemap.py:144:18: Operator `in` is not supported for types `type` and `str`, in comparing `type` with `(str &amp; tuple &amp; ~type &amp; ~AlwaysFalsy) | (@Todo(Inference of subscript on special form) &amp; tuple &amp; ~type &amp; ~AlwaysFalsy)`
+ error[lint:unsupported-operator] beartype/_cave/_cavemap.py:144:18: Operator `in` is not supported for types `type` and `str`, in comparing `type` with `(str &amp; tuple[Unknown, ...] &amp; ~type &amp; ~AlwaysFalsy) | (@Todo(Inference of subscript on special form) &amp; tuple[Unknown, ...] &amp; ~type &amp; ~AlwaysFalsy)`
- warning[lint:unused-ignore-comment] beartype/_check/error/_pep/pep484585/errpep484585mapping.py:120:59: Unused blanket `type: ignore` directive
+ error[lint:invalid-type-form] beartype/_data/hint/datahintpep.py:161:26: Variable of type `_SpecialForm` is not allowed in a type expression
+ error[lint:invalid-type-form] beartype/_data/hint/datahintpep.py:175:26: Variable of type `_SpecialForm` is not allowed in a type expression
+ error[lint:no-matching-overload] beartype/_util/error/utilerrwarn.py:65:14: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] beartype/_util/error/utilerrwarn.py:87:39: No overload of function `dirname` matches arguments
+ error[lint:unsupported-operator] beartype/claw/_clawstate.py:214:16: Operator `not in` is not supported for types `str` and `_S`, in comparing `Literal[&quot;.&quot;]` with `Unknown | _S`
+ error[lint:invalid-argument-type] beartype/claw/_importlib/clawimppath.py:142:23: Argument to this function is incorrect: Expected `(str, /) -&gt; PathEntryFinderProtocol`, found `Unknown | None`
- Found 551 diagnostics
+ Found 556 diagnostics

nionutils (https://github.com/nion-software/nionutils)
- error[lint:call-non-callable] nion/utils/Geometry.py:266:19: Object of type `GenericAlias` is not callable
- error[lint:call-non-callable] nion/utils/Geometry.py:267:26: Object of type `GenericAlias` is not callable
- error[lint:call-non-callable] nion/utils/ListModel.py:292:31: Object of type `GenericAlias` is not callable
- error[lint:call-non-callable] nion/utils/ListModel.py:293:24: Object of type `GenericAlias` is not callable
+ error[lint:invalid-argument-type] nion/utils/Stream.py:550:53: Argument to this function is incorrect: Expected `Queue[ValueChange[Unknown]]`, found `Queue[ValueChange[T]]`
- Found 25 diagnostics
+ Found 22 diagnostics

git-revise (https://github.com/mystor/git-revise)
+ warning[lint:possibly-unbound-attribute] gitrevise/merge.py:90:20: Attribute `decode` on type `Unknown | _S` is possibly unbound
- Found 10 diagnostics
+ Found 11 diagnostics

pyinstrument (https://github.com/joerick/pyinstrument)
- error[lint:unsupported-operator] pyinstrument/__main__.py:52:31: Operator `+` is unsupported between objects of type `@Todo(specialized non-generic class) | None` and `@Todo(specialized non-generic class) | None`
+ error[lint:unsupported-operator] pyinstrument/__main__.py:52:31: Operator `+` is unsupported between objects of type `list[str] | None` and `list[str] | None`
- warning[lint:call-possibly-unbound-method] pyinstrument/__main__.py:53:9: Method `__getitem__` of type `@Todo(specialized non-generic class) | None` is possibly unbound
+ warning[lint:call-possibly-unbound-method] pyinstrument/__main__.py:53:9: Method `__getitem__` of type `list[str] | None` is possibly unbound
- warning[lint:call-possibly-unbound-method] pyinstrument/__main__.py:54:9: Method `__getitem__` of type `@Todo(specialized non-generic class) | None` is possibly unbound
+ warning[lint:call-possibly-unbound-method] pyinstrument/__main__.py:54:9: Method `__getitem__` of type `list[str] | None` is possibly unbound
+ error[lint:unsupported-operator] pyinstrument/__main__.py:342:20: Operator `+` is unsupported between objects of type `list[Unknown]` and `Unknown | list[str]`
- error[lint:not-iterable] pyinstrument/__main__.py:487:32: Object of type `@Todo(specialized non-generic class) | None` may not be iterable
+ error[lint:not-iterable] pyinstrument/__main__.py:487:32: Object of type `list[str] | None` may not be iterable
+ error[lint:no-matching-overload] pyinstrument/__main__.py:612:5: No overload of bound method `sort` matches arguments
+ error[lint:unsupported-operator] pyinstrument/magic/magic.py:315:13: Operator `in` is not supported for types `Unknown` and `None`, in comparing `Unknown` with `str | None`
+ error[lint:unsupported-operator] pyinstrument/processors.py:35:32: Operator `in` is not supported for types `str` and `None`, in comparing `Literal[&quot;&lt;frozen importlib._bootstrap&quot;]` with `str | None`
+ error[lint:no-matching-overload] pyinstrument/renderers/console.py:154:27: No overload of function `split` matches arguments
+ error[lint:invalid-argument-type] pyinstrument/session.py:109:13: Argument to this function is incorrect: Expected `list[str]`, found `Unknown | None`
- Found 95 diagnostics
+ Found 101 diagnostics

aioredis (https://github.com/aio-libs/aioredis)
+ error[lint:invalid-assignment] aioredis/client.py:3432:13: Object of type `(Sequence[@Todo(Inference of subscript on special form)] &amp; ~Mapping[Unknown, Unknown]) | (Mapping[AnyKeyT, int | float] &amp; ~Mapping[Unknown, Unknown])` is not assignable to `Sequence[Unknown] | AbstractSet[AnyKeyT]`
- error[lint:invalid-exception-caught] aioredis/connection.py:283:16: Cannot catch object of type `Unknown | tuple` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
+ error[lint:invalid-exception-caught] aioredis/connection.py:283:16: Cannot catch object of type `Unknown | tuple[Unknown, ...]` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- error[lint:invalid-exception-caught] aioredis/connection.py:511:16: Cannot catch object of type `Unknown | tuple` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
+ error[lint:invalid-exception-caught] aioredis/connection.py:511:16: Cannot catch object of type `Unknown | tuple[Unknown, ...]` in an exception handler (must be a `BaseException` subclass or a tuple of `BaseException` subclasses)
- Found 33 diagnostics
+ Found 34 diagnostics

pyp (https://github.com/hauntsaninja/pyp)
- warning[lint:unused-ignore-comment] pyp.py:597:30: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] pyp.py:598:34: Unused blanket `type: ignore` directive
+ error[lint:unresolved-attribute] pyp.py:669:25: Unresolved attribute `colno` on type `FrameSummary`.
- warning[lint:unused-ignore-comment] pyp.py:668:63: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] pyp.py:670:53: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] pyp.py:672:62: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] pyp.py:673:53: Unused blanket `type: ignore` directive
- Found 17 diagnostics
+ Found 12 diagnostics

pegen (https://github.com/we-like-parsers/pegen)
+ error[lint:unsupported-operator] src/pegen/python_generator.py:279:31: Operator `in` is not supported for types `str` and `None`, in comparing `Literal[&quot;LOCATIONS&quot;]` with `Unknown | str | None`
- Found 55 diagnostics
+ Found 56 diagnostics

bidict (https://github.com/jab/bidict)
+ error[lint:non-subscriptable] bidict/_typing.py:34:39: Cannot subscript object of type `&lt;class &#x27;Iterable[tuple[KT, VT]]&#x27;&gt;` with no `__class_getitem__` method
- Found 14 diagnostics
+ Found 15 diagnostics

more-itertools (https://github.com/more-itertools/more-itertools)
- error[lint:unsupported-operator] more_itertools/more.pyi:162:18: Operator `|` is unsupported between objects of type `&lt;class &#x27;type&#x27;&gt;` and `GenericAlias`
+ error[lint:unsupported-operator] more_itertools/more.pyi:162:18: Operator `|` is unsupported between objects of type `&lt;class &#x27;type&#x27;&gt;` and `&lt;class &#x27;tuple[@Todo(Generic tuple specializations), ...]&#x27;&gt;`
- error[lint:inconsistent-mro] more_itertools/more.pyi:164:1: Cannot create a consistent method resolution order (MRO) for class `_SizedIterable` with bases list `[@Todo(`Protocol[]` subscript), &lt;class &#x27;Sized&#x27;&gt;, &lt;class &#x27;Iterable&#x27;&gt;]`
- error[lint:inconsistent-mro] more_itertools/more.pyi:167:1: Cannot create a consistent method resolution order (MRO) for class `_SizedReversible` with bases list `[@Todo(`Protocol[]` subscript), &lt;class &#x27;Sized&#x27;&gt;, &lt;class &#x27;Reversible&#x27;&gt;]`
+ error[lint:invalid-argument-type] more_itertools/recipes.py:675:29: Argument to this function is incorrect: Expected `Sequence[_T] | AbstractSet[_T]`, found `range`
- Found 52 diagnostics
+ Found 51 diagnostics

python-chess (https://github.com/niklasf/python-chess)
- error[lint:invalid-return-type] chess/engine.py:2964:16: Return type does not match returned value: Expected `InfoDict | list`, found `_T`
+ error[lint:invalid-return-type] chess/engine.py:2964:16: Return type does not match returned value: Expected `InfoDict | list[Unknown]`, found `_T`
- error[lint:invalid-return-type] chess/engine.py:3065:16: Return type does not match returned value: Expected `list`, found `_T`
+ error[lint:invalid-return-type] chess/engine.py:3065:16: Return type does not match returned value: Expected `list[Unknown]`, found `_T`
- warning[lint:unused-ignore-comment] chess/pgn.py:529:37: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] chess/pgn.py:533:77: Unused blanket `type: ignore` directive
- error[lint:call-non-callable] chess/polyglot.py:256:44: Method `__getitem__` of type `Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; @Todo(specialized non-generic class)]` is not callable on object of type `list`
+ error[lint:call-non-callable] chess/polyglot.py:256:44: Method `__getitem__` of type `Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; list[Unknown]]` is not callable on object of type `list[Unknown]`
- error[lint:call-non-callable] chess/polyglot.py:258:42: Method `__getitem__` of type `Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; @Todo(specialized non-generic class)]` is not callable on object of type `list`
+ error[lint:call-non-callable] chess/polyglot.py:258:42: Method `__getitem__` of type `Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; list[Unknown]]` is not callable on object of type `list[Unknown]`
- warning[lint:unused-ignore-comment] chess/svg.py:446:70: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] chess/svg.py:448:33: Unused blanket `type: ignore` directive
- Found 62 diagnostics
+ Found 58 diagnostics

anyio (https://github.com/agronholm/anyio)
- error[lint:unresolved-attribute] src/anyio/_backends/_asyncio.py:854:37: Type `(...) -&gt; @Todo(specialized non-generic class)` has no attribute `__qualname__`
+ error[lint:unresolved-attribute] src/anyio/_backends/_asyncio.py:854:37: Type `(...) -&gt; Awaitable[Any]` has no attribute `__qualname__`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:1220:38: Argument to this function is incorrect: Expected `tuple[str, int, int, int] | tuple[str, int]`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...]`
- warning[lint:unused-ignore-comment] src/anyio/_backends/_asyncio.py:1131:52: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] src/anyio/_backends/_asyncio.py:1132:53: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] src/anyio/_backends/_asyncio.py:1133:53: Unused blanket `type: ignore` directive
+ error[lint:call-non-callable] src/anyio/_backends/_asyncio.py:2223:49: Object of type `GenericAlias` is not callable
+ error[lint:call-non-callable] src/anyio/_backends/_asyncio.py:2223:49: Object of type `GenericAlias` is not callable
- error[lint:call-non-callable] src/anyio/_backends/_asyncio.py:2434:26: Object of type `GenericAlias` is not callable
- error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2469:41: Argument to this function is incorrect: Expected `tuple[Context, (...) -&gt; Unknown, tuple, Future, CancelScope] | None`, found `tuple[Context, (...) -&gt; T_Retval, @Todo(full tuple[...] support), Unknown, CancelScope | None]`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2469:41: Argument to this function is incorrect: Expected `tuple[Context, (...) -&gt; Unknown, tuple[Unknown, ...], Future[Unknown], CancelScope] | None`, found `tuple[Context, (...) -&gt; T_Retval, @Todo(full tuple[...] support), Future[T_Retval], CancelScope | None]`
+ error[lint:no-matching-overload] src/anyio/_backends/_asyncio.py:2590:19: No overload of bound method `create_connection` matches arguments
+ error[lint:no-matching-overload] src/anyio/_backends/_asyncio.py:2590:19: No overload of bound method `create_connection` matches arguments
+ error[lint:no-matching-overload] src/anyio/_backends/_asyncio.py:2590:19: No overload of bound method `create_connection` matches arguments
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2635:13: Argument to this function is incorrect: Expected `tuple[str, int] | str | None`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...] | None`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2635:13: Argument to this function is incorrect: Expected `tuple[str, int] | str | None`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...] | None`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2635:13: Argument to this function is incorrect: Expected `tuple[str, int] | str | None`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...] | None`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2636:13: Argument to this function is incorrect: Expected `tuple[str, int] | str | None`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...] | None`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2636:13: Argument to this function is incorrect: Expected `tuple[str, int] | str | None`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...] | None`
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2636:13: Argument to this function is incorrect: Expected `tuple[str, int] | str | None`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...] | None`
- warning[lint:unused-ignore-comment] src/anyio/_backends/_asyncio.py:2889:44: Unused blanket `type: ignore` directive
+ error[lint:invalid-argument-type] src/anyio/_backends/_asyncio.py:2700:53: Argument to this function is incorrect: Expected `tuple[str, int] | tuple[str, int, int, int]`, found `Unknown | tuple[@Todo(Generic tuple specializations), ...]`
- error[lint:invalid-return-type] src/anyio/_backends/_trio.py:553:32: Function can implicitly return `None`, which is not assignable to return type `tuple[bytes, Unknown]`
+ error[lint:invalid-return-type] src/anyio/_backends/_trio.py:553:32: Function can implicitly return `None`, which is not assignable to return type `tuple[bytes, Unknown | tuple[@Todo(Generic tuple specializations), ...]]`
+ error[lint:invalid-return-type] src/anyio/_core/_contextmanagers.py:72:16: Return type does not match returned value: Expected `_T_co`, found `object`
+ warning[lint:possibly-unbound-attribute] src/anyio/_core/_contextmanagers.py:92:32: Attribute `__exit__` on type `AbstractContextManager[object, bool | None] | None` is possibly unbound
+ warning[lint:possibly-unbound-attribute] src/anyio/_core/_contextmanagers.py:184:38: Attribute `__aexit__` on type `AbstractAsyncContextManager[object, bool | None] | None` is possibly unbound
- error[lint:unsupported-operator] src/anyio/_core/_contextmanagers.py:38:42: Operator `|` is unsupported between objects of type `&lt;class &#x27;bool&#x27;&gt;` and `None`
- error[lint:unsupported-operator] src/anyio/_core/_contextmanagers.py:41:48: Operator `|` is unsupported between objects of type `&lt;class &#x27;bool&#x27;&gt;` and `None`
- error[lint:unsupported-operator] src/anyio/_core/_contextmanagers.py:95:68: Operator `|` is unsupported between objects of type `&lt;class &#x27;bool&#x27;&gt;` and `None`
- error[lint:unsupported-operator] src/anyio/_core/_contextmanagers.py:124:47: Operator `|` is unsupported between objects of type `&lt;class &#x27;bool&#x27;&gt;` and `None`
- error[lint:unsupported-operator] src/anyio/_core/_contextmanagers.py:127:60: Operator `|` is unsupported between objects of type `&lt;class &#x27;bool&#x27;&gt;` and `None`
- error[lint:unsupported-operator] src/anyio/_core/_contextmanagers.py:189:46: Operator `|` is unsupported between objects of type `&lt;class &#x27;bool&#x27;&gt;` and `None`
+ error[lint:no-matching-overload] src/anyio/_core/_sockets.py:271:12: No overload of function `fspath` matches arguments
+ error[lint:no-matching-overload] src/anyio/_core/_sockets.py:535:19: No overload of function `fspath` matches arguments
- error[lint:invalid-assignment] src/anyio/_core/_sockets.py:756:9: Not enough values to unpack: Expected 4
+ error[lint:invalid-argument-type] src/anyio/from_thread.py:236:35: Argument to this function is incorrect: Expected `T_Retval`, found `@Todo(generic `typing.Awaitable` type) | Awaitable[T_Retval] | T_Retval`
- error[lint:call-non-callable] src/anyio/pytest_plugin.py:210:27: Object of type `GenericAlias` is not callable
- Found 123 diagnostics
+ Found 129 diagnostics

attrs (https://github.com/python-attrs/attrs)
+ error[lint:invalid-assignment] src/attr/_make.py:1559:5: Object of type `tuple[Unknown, ...]` is not assignable to `list[Unknown]`
- error[lint:invalid-assignment] src/attr/exceptions.py:20:5: Object of type `list` is not assignable to `tuple[str]`
+ error[lint:invalid-assignment] src/attr/exceptions.py:20:5: Object of type `list[Unknown]` is not assignable to `tuple[str]`
- error[lint:invalid-argument-type] tests/test_converters.py:350:21: Argument to this function is incorrect: Expected `str | int`, found `list`
+ error[lint:invalid-argument-type] tests/test_converters.py:350:21: Argument to this function is incorrect: Expected `str | int`, found `list[Unknown]`
- error[lint:invalid-argument-type] tests/test_next_gen.py:146:29: Argument to this function is incorrect: Expected `list`, found `Literal[1]`
+ error[lint:invalid-argument-type] tests/test_next_gen.py:146:29: Argument to this function is incorrect: Expected `list[Unknown]`, found `Literal[1]`
- error[lint:invalid-argument-type] tests/test_next_gen.py:146:48: Argument to this function is incorrect: Expected `list`, found `Literal[1]`
+ error[lint:invalid-argument-type] tests/test_next_gen.py:146:48: Argument to this function is incorrect: Expected `list[Unknown]`, found `Literal[1]`
- error[lint:invalid-argument-type] tests/test_next_gen.py:148:26: Argument to this function is incorrect: Expected `list`, found `Literal[-1]`
+ error[lint:invalid-argument-type] tests/test_next_gen.py:148:26: Argument to this function is incorrect: Expected `list[Unknown]`, found `Literal[-1]`
- Found 601 diagnostics
+ Found 602 diagnostics

kornia (https://github.com/kornia/kornia)
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:63: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:63: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:69: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:69: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:77: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:77: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:84: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/gaussian_illumination.py:162:84: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:120:61: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:120:61: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:120:67: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:120:67: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:227:67: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:227:67: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:227:73: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/linear_illumination.py:227:73: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/salt_pepper_noise.py:127:56: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/salt_pepper_noise.py:127:56: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/salt_pepper_noise.py:127:64: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple &amp; ~float) | (tuple[int | float, int | float] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
+ error[lint:invalid-argument-type] kornia/augmentation/_2d/intensity/salt_pepper_noise.py:127:64: Argument to this function is incorrect: Expected `tuple[int | float, int | float]`, found `(int &amp; tuple[Unknown, ...] &amp; ~float) | (tuple[int | float, int | float] &amp; tuple[Unknown, ...] &amp; ~float) | tuple[float, float] | tuple[@Todo(map_with_boundness: intersections with negative contributions), @Todo(map_with_boundness: intersections with negative contributions)]`
- error[lint:not-iterable] kornia/augmentation/container/image.py:380:18: Object of type `dict[Unknown, Unknown] | list | None` may not be iterable
+ error[lint:not-iterable] kornia/augmentation/container/image.py:380:18: Object of type `dict[Unknown, Unknown] | list[Unknown] | None` may not be iterable
- error[lint:unsupported-operator] kornia/augmentation/container/image.py:382:10: Operator `in` is not supported for types `str` and `None`, in comparing `Literal[&quot;output_size&quot;]` with `dict[Unknown, Unknown] | list | None`
+ error[lint:unsupported-operator] kornia/augmentation/container/image.py:382:10: Operator `in` is not supported for types `str` and `None`, in comparing `Literal[&quot;output_size&quot;]` with `dict[Unknown, Unknown] | list[Unknown] | None`
- error[lint:call-non-callable] kornia/augmentation/container/image.py:383:17: Method `__getitem__` of type `(bound method dict[Unknown, Unknown].__getitem__(key: Unknown, /) -&gt; Unknown) | (Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; @Todo(specialized non-generic class)])` is not callable on object of type `dict[Unknown, Unknown] | list | None`
+ error[lint:call-non-callable] kornia/augmentation/container/image.py:383:17: Method `__getitem__` of type `(bound method dict[Unknown, Unknown].__getitem__(key: Unknown, /) -&gt; Unknown) | (Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; list[Unknown]])` is not callable on object of type `dict[Unknown, Unknown] | list[Unknown] | None`
- error[lint:call-non-callable] kornia/augmentation/container/image.py:388:32: Method `__getitem__` of type `(bound method dict[Unknown, Unknown].__getitem__(key: Unknown, /) -&gt; Unknown) | (Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; @Todo(specialized non-generic class)])` is not callable on object of type `dict[Unknown, Unknown] | list | None`
+ error[lint:call-non-callable] kornia/augmentation/container/image.py:388:32: Method `__getitem__` of type `(bound method dict[Unknown, Unknown].__getitem__(key: Unknown, /) -&gt; Unknown) | (Overload[(i: SupportsIndex, /) -&gt; _T, (s: slice[Any, Any, Any], /) -&gt; list[Unknown]])` is not callable on object of type `dict[Unknown, Unknown] | list[Unknown] | None`
- error[lint:invalid-return-type] kornia/augmentation/container/ops.py:50:16: Return type does not match returned value: Expected `dict[Unknown, Unknown]`, found `dict[Unknown, Unknown] | list | None`
+ error[lint:invalid-return-type] kornia/augmentation/container/ops.py:50:16: Return type does not match returned value: Expected `dict[Unknown, Unknown]`, found `dict[Unknown, Unknown] | list[Unknown] | None`
- error[lint:invalid-return-type] kornia/augmentation/container/ops.py:58:16: Return type does not match returned value: Expected `list`, found `dict[Unknown, Unknown] | list | None`
+ error[lint:invalid-return-type] kornia/augmentation/container/ops.py:58:16: Return type does not match returned value: Expected `list[Unknown]`, found `dict[Unknown, Unknown] | list[Unknown] | None`
- warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:51:8: Attribute `dim` on type `Unknown | int | float | tuple[int | float, int | float] | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:51:8: Attribute `dim` on type `Unknown | int | float | tuple[int | float, int | float] | list[Unknown]` is possibly unbound
+ error[lint:unsupported-operator] kornia/augmentation/utils/param_validation.py:52:12: Operator `&lt;` is not supported for types `list[Unknown]` and `int`, in comparing `Unknown | int | float | tuple[int | float, int | float] | list[Unknown]` with `Literal[0]`
- warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:59:24: Attribute `repeat` on type `Unknown | int | float | tuple[int | float, int | float] | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:59:24: Attribute `repeat` on type `Unknown | int | float | tuple[int | float, int | float] | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:59:70: Attribute `device` on type `Unknown | int | float | tuple[int | float, int | float] | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:59:70: Attribute `device` on type `Unknown | int | float | tuple[int | float, int | float] | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:59:91: Attribute `dtype` on type `Unknown | int | float | tuple[int | float, int | float] | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/augmentation/utils/param_validation.py:59:91: Attribute `dtype` on type `Unknown | int | float | tuple[int | float, int | float] | list[Unknown]` is possibly unbound
+ error[lint:invalid-argument-type] kornia/contrib/models/tiny_vit.py:307:21: Argument to this function is incorrect: Expected `int | float`, found `Unknown | (int &amp; ~list[Unknown]) | (float &amp; ~list[Unknown]) | (list[int | float] &amp; ~list[Unknown])`
- warning[lint:possibly-unbound-attribute] kornia/core/mixin/image_module.py:193:20: Attribute `detach` on type `Unknown | list | tuple[Unknown]` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/core/mixin/image_module.py:193:20: Attribute `detach` on type `Unknown | list[Unknown] | tuple[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/core/module.py:204:20: Attribute `detach` on type `Unknown | tuple[Unknown]` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/core/module.py:204:20: Attribute `detach` on type `Unknown | list[Unknown] | tuple[Unknown]` is possibly unbound
+ error[lint:invalid-argument-type] kornia/enhance/adjust.py:370:22: Argument to this function is incorrect: Expected `Iterable[object]`, found `bool | (bool &amp; Unknown) | Unknown`
- error[lint:invalid-return-type] kornia/feature/dedode/transformer/dinov2.py:309:20: Return type does not match returned value: Expected `tuple[Unknown | tuple[Unknown]]`, found `tuple`
+ error[lint:invalid-return-type] kornia/feature/dedode/transformer/dinov2.py:309:20: Return type does not match returned value: Expected `tuple[Unknown | tuple[Unknown]]`, found `tuple[Unknown, ...]`
- error[lint:invalid-return-type] kornia/feature/dedode/transformer/dinov2.py:310:16: Return type does not match returned value: Expected `tuple[Unknown | tuple[Unknown]]`, found `tuple`
+ error[lint:invalid-return-type] kornia/feature/dedode/transformer/dinov2.py:310:16: Return type does not match returned value: Expected `tuple[Unknown | tuple[Unknown]]`, found `tuple[Unknown, ...]`
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:38: Attribute `shape` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:54: Attribute `device` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list[Unknown]` is possibly unbound
- warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list` is possibly unbound
+ warning[lint:possibly-unbound-attribute] kornia/utils/draw.py:379:71: Attribute `dtype` on type `Unknown | list[Unknown]` is possibly unbound
- Found 960 diagnostics
+ Found 963 diagnostics

kopf (https://github.com/nolar/kopf)
+ warning[lint:possibly-unbound-attribute] kopf/_cogs/structs/dicts.py:241:25: Attribute `obj` on type `(_T &amp; ~None) | Iterable[_T]` is possibly unbound
+ error[lint:invalid-return-type] kopf/_core/actions/lifecycles.py:40:12: Return type does not match returned value: Expected `Sequence[Handler]`, found `list[_T] | list[Unknown]`
+ error[lint:invalid-argument-type] kopf/_core/actions/lifecycles.py:40:26: Argument to this function is incorrect: Expected `Sequence[_T]`, found `Sequence[Handler] &amp; ~AlwaysFalsy`
+ error[lint:no-matching-overload] kopf/_core/actions/throttlers.py:62:17: No overload of function `next` matches arguments
+ warning[lint:possibly-unbound-attribute] kopf/_core/engines/admission.py:429:20: Attribute `check` on type `Selector | None` is possibly unbound
+ warning[lint:redundant-cast] kopf/_core/engines/posting.py:99:20: Value is already of type `Iterator[Body]`
+ warning[lint:redundant-cast] kopf/_core/engines/posting.py:112:20: Value is already of type `Iterator[Body]`
+ warning[lint:redundant-cast] kopf/_core/engines/posting.py:125:20: Value is already of type `Iterator[Body]`
+ warning[lint:redundant-cast] kopf/_core/engines/posting.py:143:20: Value is already of type `Iterator[Body]`
+ error[lint:call-non-callable] kopf/_core/intents/callbacks.py:260:20: Object of type `_FnT` is not callable
+ error[lint:call-non-callable] kopf/_core/intents/callbacks.py:266:20: Object of type `_FnT` is not callable
+ error[lint:call-non-callable] kopf/_core/intents/callbacks.py:272:24: Object of type `_FnT` is not callable
+ error[lint:call-non-callable] kopf/_core/intents/registries.py:470:16: Object of type `str` is not callable
+ error[lint:unsupported-operator] kopf/_core/reactor/observation.py:221:9: Operator `|` is unsupported between objects of type `Unknown | frozenset[Selector]` and `Unknown | frozenset[Selector]`
+ error[lint:unsupported-operator] kopf/_core/reactor/observation.py:227:9: Operator `|` is unsupported between objects of type `Unknown | frozenset[Selector]` and `Unknown | frozenset[Selector]`
+ error[lint:unsupported-operator] kopf/_core/reactor/processing.py:161:9: Operator `|` is unsupported between objects of type `Unknown | set[Unknown | tuple[@Todo(Generic tuple specializations), ...]]` and `Unknown | set[Unknown | tuple[@Todo(Generic tuple specializations), ...]]`
+ warning[lint:redundant-cast] kopf/_kits/hierarchies.py:40:16: Value is already of type `Iterator[Unknown]`
+ warning[lint:redundant-cast] kopf/_kits/hierarchies.py:77:16: Value is already of type `Iterator[Unknown]`
+ warning[lint:redundant-cast] kopf/_kits/hierarchies.py:119:16: Value is already of type `Iterator[Unknown]`
+ warning[lint:redundant-cast] kopf/_kits/hierarchies.py:171:16: Value is already of type `Iterator[Unknown]`
+ warning[lint:redundant-cast] kopf/_kits/hierarchies.py:224:16: Value is already of type `Iterator[Unknown]`
- warning[lint:redundant-cast] kopf/_kits/runner.py:186:16: Value is already of type `Unknown`
+ error[lint:unresolved-attribute] kopf/cli.py:35:35: Type `_EnumMemberT` has no attribute `name`
- Found 169 diagnostics
+ Found 190 diagnostics

alerta (https://github.com/alerta/alerta)
- error[lint:invalid-parameter-default] alerta/models/alert.py:413:29: Default value of type `None` is not assignable to annotated parameter type `list`
+ error[lint:invalid-parameter-default] alerta/models/alert.py:413:29: Default value of type `None` is not assignable to annotated parameter type `list[Unknown]`
- error[lint:invalid-parameter-default] alerta/models/blackout.py:225:29: Default value of type `None` is not assignable to annotated parameter type `list`
+ error[lint:invalid-parameter-default] alerta/models/blackout.py:225:29: Default value of type `None` is not assignable to annotated parameter type `list[Unknown]`
- error[lint:invalid-parameter-default] alerta/models/heartbeat.py:28:44: Default value of type `None` is not assignable to annotated parameter type `list`
+ error[lint:invalid-parameter-default] alerta/models/heartbeat.py:28:44: Default value of type `None` is not assignable to annotated parameter type `list[Unknown]`
- error[lint:invalid-parameter-default] alerta/models/heartbeat.py:161:29: Default value of type `None` is not assignable to annotated parameter type `list`
+ error[lint:invalid-parameter-default] alerta/models/heartbeat.py:161:29: Default value of type `None` is not assignable to annotated parameter type `list[Unknown]`
- error[lint:invalid-parameter-default] alerta/models/heartbeat.py:170:28: Default value of type `None` is not assignable to annotated parameter type `list`
+ error[lint:invalid-parameter-default] alerta/models/heartbeat.py:170:28: Default value of type `None` is not assignable to annotated parameter type `list[Unknown]`
+ error[lint:call-non-callable] tests/helpers/utils.py:25:24: Method `__getitem__` of type `bound method _Environ[str].__getitem__(key: str) -&gt; str` is not callable on object of type `_Environ[str]`
- error[lint:invalid-argument-type] tests/test_scopes.py:30:17: Argument to this function is incorrect: Expected `list`, found `Unknown | None`
+ error[lint:invalid-argument-type] tests/test_scopes.py:30:17: Argument to this function is incorrect: Expected `list[Unknown]`, found `Unknown | None`
- Found 482 diagnostics
+ Found 483 diagnostics

starlette (https://github.com/encode/starlette)
+ error[lint:unsupported-operator] starlette/datastructures.py:262:21: Operator `+` is unsupported between objects of type `list[tuple[Unknown, Unknown]]` and `list[tuple[Unknown, Unknown]]`
+ error[lint:invalid-argument-type] starlette/middleware/__init__.py:17:26: `ParamSpec` is not a valid argument to subscripted `typing.Protocol`
+ error[lint:invalid-assignment] starlette/routing.py:65:5: Object of type `((Request, /) -&gt; Awaitable[Response] | Response) | partial[Unknown]` is not assignable to `(Request, /) -&gt; Awaitable[Response]`
+ error[lint:no-matching-overload] tests/test_formparsers.py:420:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:448:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:476:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:503:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:530:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:559:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:589:13: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:619:13: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:671:51: No overload of bound method `__init__` matches arguments
+ error[lint:no-matching-overload] tests/test_formparsers.py:710:13: No overload of bound method `__init__` matches arguments
- Found 171 diagnostics
+ Found 184 diagnostics

pybind11 (https://github.com/pybind/pybind11)
+ error[lint:unsupported-operator] pybind11/setup_helpers.py:155:27: Operator `+` is unsupported between objects of type `list[str]` and `list[str]`
+ warning[lint:call-possibly-unbound-method] tests/extra_python_package/test_files.py:311:31: Method `__getitem__` of type `Unknown | _S` is possibly unbound
+ error[lint:no-matching-overload] tests/test_pytypes.py:778:14: No overload of bound method `__init__` matches arguments
- Found 241 diagnostics
+ Found 244 diagnostics

graphql-core (https://github.com/graphql-python/graphql-core)
+ error[lint:invalid-argument-type] src/graphql/execution/collect_fields.py:190:42: Argument to this function is incorrect: Expected `SelectionSetNode`, found `SelectionSetNode | None`
- warning[lint:unused-ignore-comment] src/graphql/execution/execute.py:833:59: Unused blanket `type: ignore` directive
+ error[lint:invalid-argument-type] src/graphql/execution/execute.py:1802:25: Argument to this function is incorrect: Expected `ExecutionContext`, found `(list[GraphQLError] &amp; ~list[Unknown]) | (ExecutionContext &amp; ~list[Unknown])`
+ error[lint:call-non-callable] src/graphql/execution/execute.py:2071:33: Object of type `None` is not callable
+ error[lint:invalid-argument-type] src/graphql/execution/execute.py:2176:56: Argument to this function is incorrect: Expected `ExecutionContext`, found `(list[GraphQLError] &amp; ~list[Unknown]) | (ExecutionContext &amp; ~list[Unknown])`
+ error[lint:invalid-argument-type] src/graphql/execution/execute.py:2249:44: Argument to this function is incorrect: Expected `ExecutionContext`, found `(@Todo(map_with_boundness: intersections with negative contributions) &amp; ~list[Unknown]) | (list[GraphQLError] &amp; ~list[Unknown]) | (ExecutionContext &amp; ~list[Unknown])`
+ error[lint:no-matching-overload] src/graphql/language/visitor.py:223:28: No overload of bound method `__init__` matches arguments
+ error[lint:unresolved-attribute] src/graphql/type/validate.py:119:42: Type `_EnumMemberT` has no attribute `value`
+ error[lint:unresolved-attribute] src/graphql/type/validate.py:122:49: Type `_EnumMemberT` has no attribute `QUERY`
+ error[lint:invalid-argument-type] src/graphql/type/validate.py:127:57: Argument to this function is incorrect: Expected `OperationType`, found `_EnumMemberT`
+ error[lint:unsupported-operator] src/graphql/type/validate.py:408:21: Operator `+` is unsupported between objects of type `list[NamedTypeNode]` and `list[NamedTypeNode]`
+ error[lint:invalid-argument-type] src/graphql/utilities/coerce_input_value.py:150:25: Argument to this function is incorrect: Expected `list[str | int]`, found `@Todo(map_with_boundness: intersections with negative contributions) | list[_T]`
+ error[lint:unresolved-attribute] src/graphql/utilities/extend_schema.py:246:43: Type `_EnumMemberT` has no attribute `value`
- warning[lint:call-possibly-unbound-method] src/graphql/utilities/introspection_from_schema.py:50:15: Method `__getitem__` of type `@Todo(specialized non-generic class) | None` is possibly unbound
+ warning[lint:call-possibly-unbound-method] src/graphql/utilities/introspection_from_schema.py:50:15: Method `__getitem__` of type `list[GraphQLError] | None` is possibly unbound
- error[lint:invalid-argument-type] src/graphql/validation/validate.py:100:68: Argument to this function is incorrect: Expected `(GraphQLError, /) -&gt; None`, found `bound method list.append(object: _T, /) -&gt; None`
- warning[lint:call-possibly-unbound-method] tests/error/test_graphql_error.py:260:16: Method `__getitem__` of type `@Todo(specialized non-generic class) | None` is possibly unbound
+ warning[lint:call-possibly-unbound-method] tests/error/test_graphql_error.py:260:16: Method `__getitem__` of type `list[str | int] | None` is possibly unbound
- warning[lint:call-possibly-unbound-method] tests/error/test_graphql_error.py:261:9: Method `__getitem__` of type `@Todo(specialized non-generic class) | None` is possibly unbound
+ warning[lint:call-possibly-unbound-method] tests/error/test_graphql_error.py:261:9: Method `__getitem__` of type `list[str | int] | None` is possibly unbound
- warning[lint:call-possibly-unbound-method] tests/execution/test_resolve.py:316:17: Method `__getitem__` of type `@Todo(specialized non-generic class) | None` is possibly unbound
+ warning[lint:call-possibly-unbound-method] tests/execution/test_resolve.py:316:17: Method `__getitem__` of type `list[GraphQLError] | None` is possibly unbound
- error[lint:invalid-assignment] tests/execution/test_union_interface.py:137:1: Object of type `list` is not assignable to attribute `progeny` on type `Cat | None`
+ error[lint:invalid-assignment] tests/execution/test_union_interface.py:137:1: Object of type `list[Unknown]` is not assignable to attribute `progeny` on type `Cat | None`
- error[lint:invalid-assignment] tests/execution/test_union_interface.py:141:1: Object of type `list` is not assignable to attribute `progeny` on type `Dog | None`
+ error[lint:invalid-assignment] tests/execution/test_union_interface.py:141:1: Object of type `list[Unknown]` is not assignable to attribute `progeny` on type `Dog | None`
+ error[lint:missing-argument] tests/type/test_definition.py:1288:17: No argument provided for required parameter `name` of function `__new__`
+ error[lint:missing-argument] tests/type/test_definition.py:1288:17: No argument provided for required parameter `name` of bound method `__init__`
- warning[lint:unused-ignore-comment] tests/type/test_directives.py:152:54: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] tests/utilities/test_ast_to_dict.py:28:43: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] tests/utilities/test_ast_to_dict.py:29:39: Unused blanket `type: ignore` directive
+ error[lint:invalid-argument-type] tests/utilities/test_strip_ignored_characters_fuzz.py:94:58: Argument to this function is incorrect: Expected `str`, found `Unknown | _T`
+ error[lint:invalid-argument-type] tests/utilities/test_strip_ignored_characters_fuzz.py:95:58: Argument to this function is incorrect: Expected `str`, found `Unknown | _T`
+ error[lint:invalid-argument-type] tests/utilities/test_strip_ignored_characters_fuzz.py:98:72: Argument to this function is incorrect: Expected `str`, found `Unknown | _T`
+ error[lint:invalid-argument-type] tests/utilities/test_strip_ignored_characters_fuzz.py:99:80: Argument to this function is incorrect: Expected `str`, found `Unknown | _T`
+ error[lint:unsupported-operator] tests/utilities/test_strip_ignored_characters_fuzz.py:101:28: Operator `+` is unsupported between objects of type `LiteralString` and `Unknown | _T`
+ error[lint:invalid-argument-type] tests/utilities/test_strip_ignored_characters_fuzz.py:101:70: Argument to this function is incorrect: Expected `str`, found `Unknown | _T`
+ error[lint:unsupported-operator] tests/utilities/test_strip_ignored_characters_fuzz.py:102:28: Operator `+` is unsupported between objects of type `Unknown | _T` and `LiteralString`
+ error[lint:invalid-argument-type] tests/utilities/test_strip_ignored_characters_fuzz.py:102:70: Argument to this function is incorrect: Expected `str`, found `Unknown | _T`
- Found 406 diagnostics
+ Found 423 diagnostics

strawberry (https://github.com/strawberry-graphql/strawberry)
- warning[lint:unused-ignore-comment] strawberry/codegen/query_codegen.py:688:33: Unused blanket `type: ignore` directive
+ error[lint:invalid-argument-type] strawberry/experimental/pydantic/conversion.py:47:38: Argument to this function is incorrect: Expected `Iterable[Unknown]`, found `(Unknown &amp; ~None) | Unknown | None`
+ error[lint:invalid-argument-type] strawberry/experimental/pydantic/conversion.py:47:38: Argument to this function is incorrect: Expected `Iterable[Unknown]`, found `(Unknown &amp; ~None) | Unknown | None`
+ error[lint:invalid-argument-type] strawberry/experimental/pydantic/conversion.py:47:38: Argument to this function is incorrect: Expected `Iterable[Unknown]`, found `(Unknown &amp; ~None) | Unknown | None`
+ error[lint:unsupported-operator] strawberry/experimental/pydantic/error_type.py:128:26: Operator `+` is unsupported between objects of type `list[Field[Unknown]]` and `list[Field[Unknown]]`
+ error[lint:invalid-argument-type] strawberry/experimental/pydantic/object_type.py:176:13: Argument to this function is incorrect: Expected `set[str]`, found `set[Unknown | _S] | set[Unknown]`
+ error[lint:invalid-argument-type] strawberry/experimental/pydantic/object_type.py:193:17: Argument to this function is incorrect: Expected `set[str]`, found `set[Unknown | _S] | set[Unknown]`
+ error[lint:unsupported-operator] strawberry/experimental/pydantic/object_type.py:207:26: Operator `+` is unsupported between objects of type `list[Field[Unknown]]` and `list[Field[Unknown]]`
- warning[lint:unused-ignore-comment] strawberry/experimental/pydantic/utils.py:39:66: Unused blanket `type: ignore` directive
+ warning[lint:possibly-unbound-attribute] strawberry/extensions/query_depth_limiter.py:175:25: Attribute `value` on type `NameNode | None` is possibly unbound
- warning[lint:unused-ignore-comment] strawberry/federation/schema.py:274:46: Unused blanket `type: ignore` directive
- error[lint:not-iterable] strawberry/http/__init__.py:21:52: Object of type `@Todo(specialized non-generic class) | None` may not be iterable
+ error[lint:not-iterable] strawberry/http/__init__.py:21:52: Object of type `list[GraphQLError] | None` may not be iterable
- warning[lint:unused-ignore-comment] strawberry/printer/printer.py:513:75: Unused blanket `type: ignore` directive
- error[lint:conflicting-declarations] strawberry/relay/types.py:863:21: Conflicting declared types for `edges`: @Todo(specialized non-generic class), @Todo(specialized non-generic class)
+ error[lint:conflicting-declarations] strawberry/relay/types.py:863:21: Conflicting declared types for `edges`: list[Edge[Unknown]], list[Edge[Unknown]]
- error[lint:conflicting-declarations] strawberry/relay/types.py:869:21: Conflicting declared types for `edges`: @Todo(specialized non-generic class), @Todo(specialized non-generic class)
+ error[lint:conflicting-declarations] strawberry/relay/types.py:869:21: Conflicting declared types for `edges`: list[Edge[Unknown]], list[Edge[Unknown]]
+ error[lint:unresolved-attribute] strawberry/schema/schema.py:254:25: Type `type | StrawberryType` has no attribute `__strawberry_definition__`
- error[lint:invalid-return-type] strawberry/schema/schema_converter.py:531:24: Return type does not match returned value: Expected `(Any, GraphQLResolveInfo, Unknown, /) -&gt; @Todo(specialized non-generic class) | str | None`, found `((Any, GraphQLResolveInfo, Unknown, /) -&gt; str) | None`
+ error[lint:invalid-return-type] strawberry/schema/schema_converter.py:531:24: Return type does not match returned value: Expected `(Any, GraphQLResolveInfo, Unknown, /) -&gt; Awaitable[str | None] | str | None`, found `((Any, GraphQLResolveInfo, Unknown, /) -&gt; str) | None`
- error[lint:not-iterable] strawberry/subscriptions/protocols/graphql_transport_ws/handlers.py:405:64: Object of type `@Todo(specialized non-generic class) | None` may not be iterable
+ error[lint:not-iterable] strawberry/subscriptions/protocols/graphql_transport_ws/handlers.py:405:64: Object of type `list[GraphQLError] | None` may not be iterable
- error[lint:not-iterable] strawberry/subscriptions/protocols/graphql_ws/handlers.py:225:42: Object of type `@Todo(specialized non-generic class) | None` may not be iterable
+ error[lint:not-iterable] strawberry/subscriptions/protocols/graphql_ws/handlers.py:225:42: Object of type `list[GraphQLError] | None` may not be iterable
+ error[lint:unresolved-attribute] strawberry/types/enum.py:120:22: Type `_EnumMemberT` has no attribute `value`
+ error[lint:unresolved-attribute] strawberry/types/enum.py:121:21: Type `_EnumMemberT` has no attribute `name`
- warning[lint:unused-ignore-comment] strawberry/types/field.py:85:63: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] strawberry/types/field.py:91:49: Unused blanket `type: ignore` directive
+ warning[lint:possibly-unbound-attribute] strawberry/types/object_type.py:180:28: Attribute `wrapped_func` on type `StrawberryResolver[Unknown] | None` is possibly unbound
+ error[lint:invalid-assignment] strawberry/types/object_type.py:188:17: Object of type `@Todo(Type::Intersection.call()) | ((...) -&gt; Unknown)` is not assignable to attribute `wrapped_func` on type `StrawberryResolver[Unknown] | None`
+ error[lint:invalid-assignment] strawberry/types/object_type.py:191:17: Object of type `MethodType` is not assignable to attribute `wrapped_func` on type `StrawberryResolver[Unknown] | None`
- Found 450 diagnostics
...*[Comment body truncated]*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-04 15:07</div>
            <div class="timeline-body"><p>Okay, so all&#x27;s good here except that we panic on 5 new ecosystem projects and emit a catastrophic number of new false-positive errors on real-world code. And <a href="https://codspeed.io/astral-sh/ruff/branches/alex%2Fgeneric-protocol-mro">some benchmark regressions of up to 2%</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 13:49</div>
            <div class="timeline-body"><p>The five new primer crashes are not new bugs introduced by this PR. I minimized the new <code>packaging</code> panic to this snippet, which the <code>main</code> branch also panics on:</p>
<pre><code>from typing import Union

class GenericClass[T]: ...
class Foo: ...
Bar = GenericClass[Union[&quot;Bar&quot;, Foo]]
</code></pre>
<p>The reason why we have five new primer projects panicking on this branch is that we suddenly understand many more stdlib classes as being generic, because we previously did not understand that classes inheriting from subscripted protocols were generic.</p>
<p>Note that <code>pip</code>, <code>packaging</code> and <code>setuptools</code> are all &quot;the same panic&quot;: <code>pip</code> and <code>setuptools</code> both vendore <code>packaging</code>, and I think we&#x27;re just panicking on the vendored <code>packaging</code> code <a href="https://github.com/pypa/packaging/blob/d0d5ad8687f666bea942d1ab4ee2feb5fa019d04/src/packaging/_parser.py#L44-L47">here</a> when checking any of them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 14:38</div>
            <div class="timeline-body"><p>Here is a minimal repro of one of the new false-positive diagnostics we&#x27;re emitting on <code>parso</code>:</p>
<pre><code>from typing import Any

parser_cache: dict[str, Any] = {}

for path_to_item_map in parser_cache.values():
    reveal_type(path_to_item_map)  # revealed: `_VT_co`, but should be `Any`

    # error: Type `_VT_co` has no attribute `items`
    # revealed: Unknown
    reveal_type(path_to_item_map.items())
</code></pre>
<p>and here&#x27;s an even more minimal repro that doesn&#x27;t depend on the complicated typeshed stubs for <code>dict</code>, and that also reproduces on <code>main</code>:</p>
<pre><code>from typing import Any

class Baz[T]:
    x: T

class Bar[T]:
    def method(self) -&gt; Baz[T]: ...

def test2(b: Bar[Any]):
    reveal_type(b.method().x)  # revealed: T, but should be Any!
</code></pre>
<p>So it does look like most of the new false-positive diagnostics are also pre-existing issues being exposed by this PR rather than new bugs being introduced by this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 18:22</div>
            <div class="timeline-body"><p>Rebasing this PR on top of <a href="https://github.com/astral-sh/ruff/pull/17865">astral-sh/ruff#17865</a> has hugely improved the primer report (thanks so much for the quick fix @dcreager!!). There are still a bunch of new false-positive diagnostics however, many along the lines of this:</p>
<pre><code>+ error[lint:invalid-parameter-default] mypy_primer/model.py:295:36: Default value of type `tuple[()]` is not assignable to annotated parameter type `Sequence[str]`
</code></pre>
<p>or this:</p>
<pre><code>+ error[lint:invalid-return-type] nion/utils/ListModel.py:983:16: Return type does not match returned value: Expected `Sequence[Any]`, found `list[Unknown]`
</code></pre>
<p>These suggest to me that we might have some gaps in our assignability logic for generic instance types? <code>tuple[()]</code> should be considered assignable to <code>Sequence[str]</code>; <code>list[Unknown]</code> should be considered assignable to <code>Sequence[Any]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 18:25</div>
            <div class="timeline-body"><p>And there are also a bunch of new false-positive diagnostics like this on generator functions: possibly we don&#x27;t yet understand that all generator functions implicitly return an instance of <code>types.GeneratorType</code>?</p>
<pre><code>+ error[lint:invalid-return-type] paroxython/label_programs.py:55:54: Function can implicitly return `None`, which is not assignable to return type `Iterator[Unknown]`
+ error[lint:invalid-return-type] paroxython/list_programs.py:99:55: Function can implicitly return `None`, which is not assignable to return type `Iterator[Program]`
+ error[lint:no-matching-overload] paroxython/map_taxonomy.py:168:47: No overload of function `dirname` matches arguments
+ error[lint:no-matching-overload] paroxython/parse_program.py:79:26: No overload of function `dirname` matches arguments
+ error[lint:invalid-return-type] paroxython/parse_program.py:84:6: Function can implicitly return `None`, which is not assignable to return type `Iterator[tuple[Unknown, Span]]`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 18:30</div>
            <div class="timeline-body"><blockquote>
<p>These suggest to me that we might have some gaps in our assignability logic for generic instance types? <code>tuple[()]</code> should be considered assignable to <code>Sequence[str]</code>; <code>list[Unknown]</code> should be considered assignable to <code>Sequence[Any]</code>.</p>
</blockquote>
<p>Here&#x27;s a minimal repro for this that reproduces on <code>main</code>:</p>
<pre><code>from ty_extensions import static_assert, is_assignable_to

class Foo[T]:
    def method(self) -&gt; T: ...

class Bar[T](Foo[T]): ...

def f(x: Foo[int]): ...

f(Bar[int]())  # Argument to this function is incorrect: Expected `Foo[int]`, found `Bar[int]`
static_assert(is_assignable_to(Bar[int], Foo[int]))  # static-assert-error
</code></pre>
<p>https://types.ruff.rs/a1117a09-4fad-4846-b5a3-07e7cb4464e0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-05 18:32</div>
            <div class="timeline-body"><blockquote>
<p>possibly we don&#x27;t yet understand that all generator functions implicitly return an instance of <code>types.GeneratorType</code></p>
</blockquote>
<p>We don&#x27;t. Would be great to have an issue for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 18:34</div>
            <div class="timeline-body"><blockquote>
<p>We don&#x27;t. Would be great to have an issue for this.</p>
</blockquote>
<p>I was going to try to fix the false positives as part of this PR, since we don&#x27;t emit them on <code>main</code>. Possibly just with a quick hack, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-05 18:42</div>
            <div class="timeline-body"><p>I think the proper fix here might not be very hard -- just need to identify functions containing <code>yield</code> (we can do this easily in semantic indexing) and then special-case their return type checks. Still might make more sense to do it in a separate PR and then rebase this on top of it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 18:45</div>
            <div class="timeline-body"><p>Sure, I can do that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 19:03</div>
            <div class="timeline-body"><p>And in fact, I <em>can</em> repro the generator-function thing on <code>main</code>, you just have to be careful not to use type arguments to anything in the return-type signature (because if you do, it gets inferred as <code>@Todo</code> prior to this PR, and everything is assignable to <code>Todo</code>):</p>
<pre><code>import types
import typing

def f() -&gt; types.GeneratorType:  # error: [invalid-return-type]
    yield 42

def g() -&gt; typing.Generator:  # error: [invalid-return-type]
    yield 42

def h() -&gt; typing.Iterator:  # error: [invalid-return-type]
    yield 42

def i() -&gt; typing.Iterable:  # error: [invalid-return-type]
    yield 42
</code></pre>
<p>the reason why this hasn&#x27;t come up before now is that return-type annotations like that are just really rare in real life -- you&#x27;d almost always specify type arguments to any of those classes.</p>
<p>https://types.ruff.rs/a9ee8a58-c99a-481d-9a89-785179820cba</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 21:05</div>
            <div class="timeline-body"><blockquote>
<pre><code>+ error[lint:missing-argument] src/anyio/_core/_signals.py:12:6: No argument provided for required parameter `_ExitT_co` of class `AbstractContextManager`
</code></pre>
</blockquote>
<p>This looks like we don&#x27;t yet understand legacy TypeVars that use the <code>default</code> keyword argument to specify that it&#x27;s okay to omit them when supplying type arguments to a generic class. I.e., this:</p>
<pre><code>from typing import TypeVar, Generic

T = TypeVar(&quot;T&quot;, default=int)

class Foo(Generic[T]):
    x: T
</code></pre>
<p>is equivalent to this with the new syntax:</p>
<pre><code>class Foo[T = int]:
    x: T
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-05 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-05 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-05 21:58</div>
            <div class="timeline-body"><blockquote>
<p>This looks like we don&#x27;t yet understand legacy TypeVars that use the <code>default</code> keyword argument to specify that it&#x27;s okay to omit them when supplying type arguments to a generic class</p>
</blockquote>
<p>We weren&#x27;t handling this for PEP-695 typevars either!  Fixed in <a href="https://github.com/astral-sh/ruff/pull/17872">astral-sh/ruff#17872</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-06 12:17</div>
            <div class="timeline-body"><blockquote>
<pre><code>mypy-protobuf (https://github.com/dropbox/mypy-protobuf)
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:122:45: Type `_T` has no attribute `name`
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:123:45: Type `_T` has no attribute `name`
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:131:40: Type `_T` has no attribute `name`
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:132:45: Type `_T` has no attribute `name`
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:133:39: Type `_T` has no attribute `name`
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:134:31: Type `_T` has no attribute `nested_type`
+ error[lint:unresolved-attribute] mypy_protobuf/main.py:135:28: Type `_T` has no attribute `enum_type`
- Found 82 diagnostics
+ Found 89 diagnostics
</code></pre>
</blockquote>
<p>Here&#x27;s a minimal repro for these diagnostics that also repros on <code>main</code>:</p>
<pre><code>class Bar[T]:
    x: T

class Baz[T](Bar[T]): ...
class Spam[T](Baz[T]): ...

reveal_type(Spam[int]().x) # revealed: `T`, but should be `int`
</code></pre>
<p>https://play.ty.dev/fe18277e-de4b-4d16-92d3-3a7c467b5798</p>
<p>@dcreager this looks very similar to the issue you fixed in <a href="https://github.com/astral-sh/ruff/pull/17865">astral-sh/ruff#17865</a>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-06 17:46</div>
            <div class="timeline-body"><p>There are lots of primer hits like this:</p>
<pre><code>+ error[lint:call-non-callable] scipy/stats/tests/test_multivariate.py:121:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_multivariate.py:171:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_multivariate.py:2971:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_multivariate.py:4369:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:542:17: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:730:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:733:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:736:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:890:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:893:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_qmc.py:896:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_quantile.py:132:17: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_quantile.py:134:17: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_quantile.py:137:17: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_quantile.py:194:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_resampling.py:585:9: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_sampling.py:383:13: Object of type `_WithException[Unknown, Literal[XFailed]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_sampling.py:649:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_sampling.py:659:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_sampling.py:840:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
+ error[lint:call-non-callable] scipy/stats/tests/test_sampling.py:842:13: Object of type `_WithException[Unknown, Literal[Skipped]]` is not callable
</code></pre>
<p>But... I think our behaviour is correct for these! They&#x27;re all to do with the fact that we don&#x27;t think the object <code>pytest.skip</code> is callable on this PR branch, and it&#x27;s obviously very common in tests for <code>pytest.skip()</code> to be called in order to skip a test.</p>
<p>Why don&#x27;t we think <code>pytest.skip()</code> is callable on this branch? Well, <code>skip()</code> is declared <a href="https://github.com/pytest-dev/pytest/blob/89b84cb56295c46e1d8834b599e858bc65c15a5b/src/_pytest/outcomes.py#L125-L130">here</a>, and we can see that it&#x27;s decorated with <code>@_with_exception()</code>. <code>_with_exception</code> is declared <a href="https://github.com/pytest-dev/pytest/blob/89b84cb56295c46e1d8834b599e858bc65c15a5b/src/_pytest/outcomes.py#L92-L98">here</a>, and the TL;DR is that <code>pytest.skip</code> is inferred as being an instance of this protocol:</p>
<pre><code>class _WithException(Protocol[_F, _ET]):
    Exception: _ET
    __call__: _F
</code></pre>
<p>Where <code>_F</code> is</p>
<pre><code>_F = TypeVar(&quot;_F&quot;, bound=Callable[..., object])
</code></pre>
<p>So this actually has nothing to do with generics, or in fact protocols. It has to do with our behaviour (which we&#x27;re consistent about) with how dunders are looked up on instances. Namely, it&#x27;s insufficient for an object to have a <code>__call__</code> instance attribute in order for it to be callable -- the <code>__call__</code> attribute must be accessible on the class object. And according to this protocol definition, that&#x27;s not necessarily the case for instances of <code>_WithException</code>; ergo, <code>pytest.skip</code>, which is annotated as being an instance of <code>_WithException</code>, is not callable.</p>
<p>Justifying the theoretical basis for these diagnostics is one thing; issuing a huge number of diagnostics for users of Python&#x27;s dominant testing library is another. It&#x27;s a bit concerning that we&#x27;ll emit so many diagnostics for users of pytest.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-06 18:26</div>
            <div class="timeline-body"><blockquote>
<p>Here&#x27;s a minimal repro for these diagnostics that also repros on <code>main</code>:</p>
</blockquote>
<p>Fixed in #17892</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/stdlib_typing_aliases.md</code>:89 on 2025-05-06 18:29</div>
            <div class="timeline-body"><p>question: should <code>Generic</code> appear in the MRO at all?  It doesn&#x27;t at runtime:</p>
<pre><code>$ python
Python 3.13.3 (main, Apr  9 2025, 07:44:25) [GCC 14.2.1 20250207] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; from collections import Counter
&gt;&gt;&gt; Counter[int].__mro__
(&lt;class &#x27;collections.Counter&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)
</code></pre>
<p>And we don&#x27;t need it to detect legacy generic classes  for that we look in the <em>base class</em> list, so we could filter it out when constructing the MRO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-05-06 18:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-06 18:30</div>
            <div class="timeline-body"><blockquote>
<pre><code>+ error[lint:invalid-type-form] beartype/_data/hint/datahintpep.py:161:26: Variable of type `_SpecialForm` is not allowed in a type expression
+ error[lint:invalid-type-form] beartype/_data/hint/datahintpep.py:175:26: Variable of type `_SpecialForm` is not allowed in a type expression
</code></pre>
</blockquote>
<p>These are expected: beartype is using <code>typing_extensions.TypeForm</code>, which we don&#x27;t support yet (and isn&#x27;t standardised yet)</p>
<p>Edit: this one also looks like it falls into the bucket of &quot;beartype doing weird stuff&quot;:</p>
<pre><code>+ error[lint:unresolved-attribute] beartype/_data/hint/pep/datapeprepr.py:331:36: Type `_T_co` has no attribute `name`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-05-06 18:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/stdlib_typing_aliases.md</code>:89 on 2025-05-06 18:32</div>
            <div class="timeline-body"><p>Protocols arguably don&#x27;t need to be there either, since we have to use structural checks to determine if a class implements a protocol.  (Though we presumably need them in the MRO of <em>other protocols</em> so that we can synthesize the union of the methods correctly?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/stdlib_typing_aliases.md</code>:89 on 2025-05-06 18:33</div>
            <div class="timeline-body"><blockquote>
<p>It doesn&#x27;t at runtime</p>
</blockquote>
<p>That&#x27;s correct, but the MRO that typeshed gives for <code>Counter</code> is very different to the MRO that <code>Counter</code> actually has at runtime. <a href="https://github.com/python/typeshed/issues/1595">We can debate</a> the pros and cons of that, but we should definitely just be trusting typeshed here and not trying to &quot;fix things up&quot; on our end. And according to typeshed, <code>Counter</code> is a class that has <code>Protocol</code> in its MRO, which means that it must also have <code>Generic</code> in its MRO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-06 18:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-06 18:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/stdlib_typing_aliases.md</code>:89 on 2025-05-06 18:36</div>
            <div class="timeline-body"><blockquote>
<p>(Though we presumably need them in the MRO of <em>other protocols</em> so that we can synthesize the union of the methods correctly?)</p>
</blockquote>
<p>Uhmm, a class is only a protocol class if it has <code>Protocol</code> directly in its bases (it&#x27;s not sufficient for <code>Protocol</code> to be somewhere in its MRO. So I don&#x27;t think that, in itself, is a good reason for having <code>Protocol</code> be included in MROs of classes that inherit from <code>Protocol</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ty_python_semantic/resources/mdtest/annotations/stdlib_typing_aliases.md</code>:89 on 2025-05-06 18:42</div>
            <div class="timeline-body"><p>Ah yes, I thought <code>Generic</code> was being excluded at runtime becuase the interpreter was actively removing it, not because it isn&#x27;t actually listed as a base!</p>
<pre><code>&gt;&gt;&gt; from typing import Protocol, TypeVar
&gt;&gt;&gt; T = TypeVar(&quot;T&quot;)
&gt;&gt;&gt; class Foo(Protocol[T]):
...     pass
...
&gt;&gt;&gt; Foo.__mro__
(&lt;class &#x27;__main__.Foo&#x27;&gt;, &lt;class &#x27;typing.Protocol&#x27;&gt;, &lt;class &#x27;typing.Generic&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-05-06 18:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-07 01:49</div>
            <div class="timeline-body"><p>I think a lot of the new false positives will go away with <a href="https://github.com/astral-sh/ruff/pull/17897">astral-sh/ruff#17897</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-07 10:17</div>
            <div class="timeline-body"><p>@dcreager I&#x27;m not sure <a href="https://github.com/astral-sh/ruff/pull/17897">astral-sh/ruff#17897</a> fixes all the issues... I still see lots of lines like this in the primer report here after rebasing on top of #17897:</p>
<blockquote>
<pre><code>+ error[lint:invalid-return-type] nion/utils/ListModel.py:33:60: Return type does not match returned value: Expected `Sequence[Any]`, found `list[Unknown]`
</code></pre>
</blockquote>
<p>or like this:</p>
<blockquote>
<pre><code>+ error[lint:invalid-return-type] src/pegen/grammar.py:150:16: Return type does not match returned value: Expected `AbstractSet[str]`, found `set[Unknown]`
</code></pre>
</blockquote>
<p>but <code>list[Unknown]</code> should be considered assignable to <code>Sequence[Any]</code>, and <code>set[Unknown]</code> should be considered assignable to <code>AbstractSet[str]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-07 12:47</div>
            <div class="timeline-body"><blockquote>
<p>but <code>list[Unknown]</code> should be considered assignable to <code>Sequence[Any]</code>, and <code>set[Unknown]</code> should be considered assignable to <code>AbstractSet[str]</code></p>
</blockquote>
<p>I think I see the issue for this:</p>
<p>https://github.com/astral-sh/ruff/blob/0d9b6a097574e49f40f31758b1b8af420da458c2/crates/ty_python_semantic/src/types/class.rs#L293-L294</p>
<p>It&#x27;s the &quot;same generic class&quot; part.  I decided to go ahead and merge #17897 first and work on a fix for this as a separate PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-07 13:56</div>
            <div class="timeline-body"><blockquote>
<p><code>list[Unknown]</code> should be considered assignable to <code>Sequence[Any]</code></p>
</blockquote>
<p>Maybe the same issue as in <a href="https://github.com/astral-sh/ruff/issues/17904">astral-sh/ruff#17904</a> ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-07 14:14</div>
            <div class="timeline-body"><blockquote>
<p>Maybe the same issue as in #17904 ?</p>
</blockquote>
<p>Yes I think it is</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-07 22:10</div>
            <div class="timeline-body"><p>Wowzer. I think @dcreager&#x27;s latest generics fix took many thousands of lines off the primer diff from this PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-05-07 22:12</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p> ecosystem check detected no linter changes.</p>
Linter (preview)
<p> ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-07 22:13</div>
            <div class="timeline-body"><blockquote>
<pre><code>pyp (https://github.com/hauntsaninja/pyp)
- warning[lint:unused-ignore-comment] pyp.py:597:30: Unused blanket `type: ignore` directive
- warning[lint:unused-ignore-comment] pyp.py:598:34: Unused blanket `type: ignore` directive
+ error[lint:unresolved-attribute] pyp.py:669:25: Unresolved attribute `colno` on type `FrameSummary`.
</code></pre>
</blockquote>
<p>The new error here is weird. Want to look into it tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-07 22:15</div>
            <div class="timeline-body"><blockquote>
<pre><code>isort (https://github.com/pycqa/isort)
+ error[lint:invalid-return-type] isort/api.py:516:6: Function can implicitly return `None`, which is not assignable to return type `Iterator[Import]`
+ error[lint:invalid-return-type] isort/api.py:585:6: Function can implicitly return `None`, which is not assignable to return type `Iterator[Import]`
+ error[lint:invalid-return-type] isort/api.py:617:6: Function can implicitly return `None`, which is not assignable to return type `Iterator[Import]`
</code></pre>
</blockquote>
<p>Oops. We recognise functions that have <code>yield</code> expressions as being generator functions, but not yet functions that have <code>yield from</code> expressions in them. I can fix this real quick. (Edit: fixed in <a href="https://github.com/astral-sh/ruff/pull/17930">astral-sh/ruff#17930</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-07 22:16</div>
            <div class="timeline-body"><blockquote>
<pre><code>+ error[lint:unsupported-operator] strawberry/experimental/pydantic/error_type.py:128:26: Operator `+` is unsupported between objects of type `list[Field[Unknown]]` and `list[Field[Unknown]]`
</code></pre>
</blockquote>
<p>@dcreager I think the new diagnostics we&#x27;re now seeing on the tomllib benchmarks are similar to this -- any idea what&#x27;s going on? The <code>list</code> class has an <code>__add__</code> method in typeshed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-09 09:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:1 on 2025-05-09 09:16</div>
            <div class="timeline-body"><p>The new tomllib diagnostics are:</p>
<pre><code>error: lint:invalid-argument-type: Argument to this function is incorrect
   --&gt; /Users/alexw/dev/tomllib/tomllib/_parser.py:270:33
    |
268 |     if char == &quot;#&quot;:
269 |         return skip_until(
270 |             src, pos + 1, &quot;\n&quot;, error_on=ILLEGAL_COMMENT_CHARS, error_on_eof=False
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Expected `frozenset[str]`, found `Unknown | frozenset[Unknown | _S]`
271 |         )
272 |     return pos
    |
info: Function defined here
   --&gt; /Users/alexw/dev/tomllib/tomllib/_parser.py:241:5
    |
241 | def skip_until(
    |     ^^^^^^^^^^
242 |     src: str,
243 |     pos: Pos,
244 |     expect: str,
245 |     *,
246 |     error_on: frozenset[str],
    |     ------------------------ Parameter declared here
247 |     error_on_eof: bool,
248 | ) -&gt; Pos:
    |
info: `lint:invalid-argument-type` is enabled by default

error: lint:invalid-argument-type: Argument to this function is incorrect
   --&gt; /Users/alexw/dev/tomllib/tomllib/_parser.py:516:24
    |
514 |     start_pos = pos
515 |     pos = skip_until(
516 |         src, pos, &quot;&#x27;&quot;, error_on=ILLEGAL_LITERAL_STR_CHARS, error_on_eof=True
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Expected `frozenset[str]`, found `Unknown | frozenset[Unknown | _S]`
517 |     )
518 |     return pos + 1, src[start_pos:pos]  # Skip ending apostrophe
    |
info: Function defined here
   --&gt; /Users/alexw/dev/tomllib/tomllib/_parser.py:241:5
    |
241 | def skip_until(
    |     ^^^^^^^^^^
242 |     src: str,
243 |     pos: Pos,
244 |     expect: str,
245 |     *,
246 |     error_on: frozenset[str],
    |     ------------------------ Parameter declared here
247 |     error_on_eof: bool,
248 | ) -&gt; Pos:
    |
info: `lint:invalid-argument-type` is enabled by default

error: lint:invalid-argument-type: Argument to this function is incorrect
   --&gt; /Users/alexw/dev/tomllib/tomllib/_parser.py:532:13
    |
530 |             pos,
531 |             &quot;&#x27;&#x27;&#x27;&quot;,
532 |             error_on=ILLEGAL_MULTILINE_LITERAL_STR_CHARS,
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Expected `frozenset[str]`, found `Unknown | frozenset[Unknown | _S]`
533 |             error_on_eof=True,
534 |         )
    |
info: Function defined here
   --&gt; /Users/alexw/dev/tomllib/tomllib/_parser.py:241:5
    |
241 | def skip_until(
    |     ^^^^^^^^^^
242 |     src: str,
243 |     pos: Pos,
244 |     expect: str,
245 |     *,
246 |     error_on: frozenset[str],
    |     ------------------------ Parameter declared here
247 |     error_on_eof: bool,
248 | ) -&gt; Pos:
    |
info: `lint:invalid-argument-type` is enabled by default

Found 3 diagnostics
</code></pre>
<p>I wouldn&#x27;t expect us to be able to infer <code>frozenset[str]</code> for <a href="https://github.com/python/cpython/blob/f52de8a937e89a4d1cf314f12ee5e7bbaa79e7da/Lib/tomllib/_parser.py#L35">the ILLEGAL_COMMENT_CHARS frozenset</a> just yet (we haven&#x27;t implemented inferring generator expressions as evaluating to generic <code>types.GeneratorType</code> instances yet). But I also wouldn&#x27;t expect us to infer the frozenset as <code>frozenset[Unknown | _S]</code> -- shouldn&#x27;t it just be <code>frozenset[Unknown]</code> if we can&#x27;t infer what the TypeVar should be solved as? Cc. @dcreager</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-09 11:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:1 on 2025-05-09 11:34</div>
            <div class="timeline-body"><p>This is pretty interesting. The bug appears to be specific to legacy generics:</p>
<pre><code>from typing import Any, TypeVar, reveal_type, AbstractSet

_T_co = TypeVar(&quot;_T_co&quot;, covariant=True)
_S = TypeVar(&quot;_S&quot;)

class Foo(AbstractSet[_T_co]):
    def __or__(self, value: AbstractSet[_S], /) -&gt; &quot;Foo[_T_co | _S]&quot;: ...

def f(x: Foo[Any], y: Foo[Any]):
    reveal_type(x | y)  # revealed: `Foo[Any | _S]`

class Bar[T](AbstractSet[T]):
    def __or__[S](self, value: AbstractSet[S], /) -&gt; &quot;Bar[T | S]&quot;: ...

def g(x: Bar[Any], y: Bar[Any]):
    reveal_type(x | y)  # revealed: `Bar[Any]`
</code></pre>
<p>But <code>Foo</code> and <code>Bar</code> should be equivalent classes here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:1 on 2025-05-09 11:45</div>
            <div class="timeline-body"><p>Okay, here is (finally!) a minimal repro for the new <code>tomllib</code> diagnostics, that repros on <code>main</code>:</p>
<pre><code>from __future__ import annotations
from typing import TypeVar, Any, reveal_type

S = TypeVar(&quot;S&quot;)

class Foo[T]:
    def method(self, other: Foo[S]) -&gt; Foo[T | S]: ...  # type: ignore[invalid-return-type]

def f(x: Foo[Any], y: Foo[Any]):
    reveal_type(x.method(y))  # revealed: `Foo[Any | S]`, but should be `Foo[Any]`
</code></pre>
<p>https://play.ty.dev/24de2879-e71b-45d5-a80b-3aa3248d1022</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-05-09 11:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-05-09 15:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:1 on 2025-05-09 15:15</div>
            <div class="timeline-body"><p>Thanks for the minimal repro, I can take a look!  That&#x27;s strange that the PEP-695 equivalent works correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-09 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-09 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-09 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcreager">@dcreager</a> reviewed on 2025-05-12 19:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcreager">@dcreager</a> on <code>crates/ruff_benchmark/benches/ty.rs</code>:1 on 2025-05-12 19:09</div>
            <div class="timeline-body"><p>This should be fixed by <a href="https://github.com/astral-sh/ruff/pull/18052">astral-sh/ruff#18052</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karlicoss">@karlicoss</a> on 2025-05-26 23:28</div>
            <div class="timeline-body"><p>@AlexWaygood as a workaround for <code>&quot;Object of type _WithException[Unknown, Literal[Skipped]] is not callable&quot;</code> when using <code>pytest.skip</code> -- is it worth fixing the type in <code>pytest</code>?</p>
<p>First through was wrapping <code>__call__</code> into a <code>ClassVar</code> here: https://github.com/pytest-dev/pytest/blob/89b84cb56295c46e1d8834b599e858bc65c15a5b/src/_pytest/outcomes.py#L89, but then I remembered <code>ClassVar</code> can&#x27;t be generic -- filed an issue here <a href="https://github.com/astral-sh/ty/issues/518">astral-sh/ty#518</a> . So ClassVar wouldn&#x27;t work.</p>
<p>Next I tried messing with <code>_WithException</code>&#x27;s definition -- and seems like <code>def __call__</code> is treated differently by than <code>__call__</code> as an attribute.</p>
<pre><code>from collections.abc import Callable
from typing import Protocol, reveal_type

class WithCallBad(Protocol):
    __call__: Callable[..., str]


class WithCallGood(Protocol):
    def __call__(self, *args, **kwargs) -&gt; str: ...


def check(c: WithCallBad) -&gt; str:
    reveal_type(c)
    res = c()
    reveal_type(res)
    return res
</code></pre>
<p><code>c: WithCallBad</code> results in <code>Object of type WithCallBad is not callable</code>, whereas <code>c: WithCallGood</code> works as expected and infers <code>res</code> type correctly.</p>
<p>Is that part of <code>Protocol</code>&#x27;s spec? I.e. definiting a dunder as method means it&#x27;s accessible from the class object?</p>
<p>If that works, we could use <code>ParamSpec</code> to type it properly in pytest as <code>def __call__</code>, I gave it a go <a href="https://github.com/pytest-dev/pytest/commit/837097131fd8d8d96b98b6b9ef7112162946867d">here</a>, and for mypy it gives identical results of <code>reveal_type(pytest.skip)</code>.
For <code>ty</code>, seems like <code>ParamSpec</code> isn&#x27;t supported yet: <a href="https://github.com/astral-sh/ty/issues/157">astral-sh/ty#157</a> , but hopefully it will be!</p>
<p>Of course doesn&#x27;t solve the bigger issue discussed <a href="https://discuss.python.org/t/when-should-we-assume-callable-types-are-method-descriptors/92938">here</a>, but I tried <code>ty</code> on 10+ of my repos, and so far only <code>pytest.skip</code> resulted in that sort of issue, so perhaps it will help many people.
If you think it makes sense, happy to follow up with <code>pytest</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-27 11:06</div>
            <div class="timeline-body"><blockquote>
<p>Is that part of <code>Protocol</code>&#x27;s spec? I.e. definiting a dunder as method means it&#x27;s accessible from the class object?</p>
</blockquote>
<p>Attributes are looked up on instances of protocol classes in the same way as they&#x27;re looked up on instances of nominal classes! Any implicit dunder call in Python always looks up the dunder on the class rather than on the instance. If <code>__call__</code> is only annotated as existing on instances, the type checker cannot assume that it will exist on the class object. But a method defined directly in a class namespace is of course accessible from the class object.</p>
<blockquote>
<p>If that works, we could use <code>ParamSpec</code> to type it properly in pytest as <code>def __call__</code>, I gave it a go <a href="https://github.com/pytest-dev/pytest/commit/837097131fd8d8d96b98b6b9ef7112162946867d">here</a>, and for mypy it gives identical results of <code>reveal_type(pytest.skip)</code>.</p>
</blockquote>
<p>Yeah, that looks like a less ambiguous way of annotating <code>pytest.skip</code> to me; I think that would be a worthwhile change to pytest&#x27;s annotations. But I&#x27;m pretty sure that pytest isn&#x27;t the only package that does this kind of thing with callable types, so fixing this one symptom won&#x27;t fix the broader problem.</p>
<p>My only quibble with https://github.com/pytest-dev/pytest/commit/837097131fd8d8d96b98b6b9ef7112162946867d is that I think the <code>_R</code> type variable should be covariant ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karlicoss">@karlicoss</a> on 2025-06-27 16:29</div>
            <div class="timeline-body"><p>Btw the pytest.skip fix is merged, so should be in the next release! <a href="https://github.com/pytest-dev/pytest/pull/13445">pytest-dev/pytest#13445</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:13:59 UTC
    </footer>
</body>
</html>
