```yaml
number: 5344
title: Ignore type aliases for RUF013
type: pull_request
state: merged
author: dhruvmanila
labels: []
assignees: []
merged: true
base: main
head: dhruv/type-aliases-RUF013
created_at: 2023-06-23T17:11:12Z
updated_at: 2023-06-23T23:12:15Z
url: https://github.com/astral-sh/ruff/pull/5344
synced_at: 2026-01-12T15:55:18Z
```

# Ignore type aliases for RUF013

---

_@dhruvmanila_

## Summary

Ignore type aliases for RUF013 to avoid flagging false positives:

```python
from typing import Optional

MaybeInt = Optional[int]


def f(arg: MaybeInt = None):
    pass
```

But, at the expense of having false negatives:

```python
Text = str | bytes


def f(arg: Text = None):
    pass
```

## Test Plan

`cargo test`

fixes: #5295


---

_Comment by @dhruvmanila on 2023-06-23 17:11_

Current dependencies on/for this PR:
* main
  * **PR #5344** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/5344" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.png" alt="Graphite" width="10px" height="10px"/></a>  üëà

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/5344?utm_source=stack-comment).

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/ruff/rules/implicit_optional.rs`:167 on 2023-06-23 17:15_

\cc @charliermarsh I'm a bit torn on this. Is this enough or too much? Should we just go with either builtin or coming from known module which contains types? There are others apart from `typing` or `typing_extensions` such as `collections`, `types`, and even `re`, `io`, `contextlib`, etc. These are covered in the above functions at a granular level.

---

_@dhruvmanila reviewed on 2023-06-23 17:15_

---

_Review requested from @charliermarsh by @dhruvmanila on 2023-06-23 17:24_

---

_Comment by @github-actions[bot] on 2023-06-23 17:29_

## PR Check Results
### Ecosystem
‚ÑπÔ∏è ecosystem check **detected changes**. (+0, -64, 0 error(s))

<details><summary>airflow (+0, -28)</summary>
<p>

```diff
- airflow/api_connexion/endpoints/connection_endpoint.py:118:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/api_connexion/endpoints/dag_endpoint.py:110:44: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/api_connexion/endpoints/pool_endpoint.py:86:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/api_connexion/endpoints/role_and_permission_endpoint.py:113:48: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/api_connexion/endpoints/user_endpoint.py:128:47: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/api_connexion/endpoints/variable_endpoint.py:102:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/kubernetes/pod_launcher_deprecated.py:73:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:177:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:203:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:231:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:263:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:278:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:307:50: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:322:50: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:351:52: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:373:49: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/metrics/otel_logger.py:77:47: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/models/dagbag.py:174:40: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/models/renderedtifields.py:178:30: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/models/variable.py:159:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/models/variable.py:188:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/models/variable.py:210:35: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/providers/amazon/aws/links/emr.py:51:59: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/providers/google/cloud/hooks/pubsub.py:181:33: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/providers/google/cloud/operators/pubsub.py:130:33: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/providers/google/common/utils/id_token_credentials.py:189:43: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/providers/jenkins/operators/jenkins_job_trigger.py:102:21: RUF013 [*] PEP 484 prohibits implicit `Optional`
- airflow/providers/jenkins/operators/jenkins_job_trigger.py:116:58: RUF013 [*] PEP 484 prohibits implicit `Optional`
```

</p>
</details>
<details><summary>bokeh (+0, -3)</summary>
<p>

```diff
- src/bokeh/embed/standalone.py:158:52: RUF013 [*] PEP 484 prohibits implicit `Optional`
- src/bokeh/embed/standalone.py:300:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- src/bokeh/embed/standalone.py:371:62: RUF013 [*] PEP 484 prohibits implicit `Optional`
```

</p>
</details>
<details><summary>disnake (+0, -30)</summary>
<p>

```diff
- disnake/app_commands.py:227:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/app_commands.py:354:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/app_commands.py:850:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/ctx_menus_core.py:177:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/ctx_menus_core.py:233:11: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/ctx_menus_core.py:312:11: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/ctx_menus_core.py:75:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/interaction_bot_base.py:487:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/interaction_bot_base.py:488:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/interaction_bot_base.py:581:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/interaction_bot_base.py:658:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/params.py:1128:11: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/params.py:1129:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/params.py:525:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/params.py:526:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:144:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:191:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:192:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:271:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:272:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:431:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:432:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:519:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:520:22: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:584:15: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:747:11: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/ext/commands/slash_core.py:748:18: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/i18n.py:118:17: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/interactions/base.py:1856:85: RUF013 [*] PEP 484 prohibits implicit `Optional`
- disnake/utils.py:474:65: RUF013 [*] PEP 484 prohibits implicit `Optional`
```

</p>
</details>
<details><summary>zulip (+0, -3)</summary>
<p>

```diff
- zerver/lib/db.py:34:43: RUF013 [*] PEP 484 prohibits implicit `Optional`
- zerver/views/auth.py:800:39: RUF013 [*] PEP 484 prohibits implicit `Optional`
- zerver/views/auth.py:927:42: RUF013 [*] PEP 484 prohibits implicit `Optional`
```

</p>
</details>
Rules changed: 1

| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| RUF013 | 64 | 0 | 64 |

### Benchmark
#### Linux
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      7.1¬±0.39ms     5.7 MB/sec    1.00      7.1¬±0.34ms     5.7 MB/sec
formatter/numpy/ctypeslib.py               1.00  1668.8¬±81.88¬µs    10.0 MB/sec    1.08  1804.7¬±113.87¬µs     9.2 MB/sec
formatter/numpy/globals.py                 1.00   207.0¬±15.41¬µs    14.3 MB/sec    1.10   228.4¬±19.14¬µs    12.9 MB/sec
formatter/pydantic/types.py                1.00      3.8¬±0.29ms     6.7 MB/sec    1.14      4.4¬±0.30ms     5.8 MB/sec
linter/all-rules/large/dataset.py          1.00     14.6¬±0.65ms     2.8 MB/sec    1.01     14.7¬±0.61ms     2.8 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.02      3.7¬±0.13ms     4.5 MB/sec    1.00      3.6¬±0.16ms     4.6 MB/sec
linter/all-rules/numpy/globals.py          1.10   527.5¬±32.69¬µs     5.6 MB/sec    1.00   478.5¬±31.42¬µs     6.2 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.5¬±0.31ms     3.9 MB/sec    1.01      6.6¬±0.28ms     3.9 MB/sec
linter/default-rules/large/dataset.py      1.04      7.4¬±0.35ms     5.5 MB/sec    1.00      7.1¬±0.37ms     5.8 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1521.4¬±68.12¬µs    10.9 MB/sec    1.03  1559.8¬±89.03¬µs    10.7 MB/sec
linter/default-rules/numpy/globals.py      1.09   202.2¬±18.07¬µs    14.6 MB/sec    1.00   184.8¬±15.14¬µs    16.0 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.2¬±0.14ms     7.9 MB/sec    1.01      3.3¬±0.15ms     7.8 MB/sec
```

#### Windows
```
group                                      main                                   pr
-----                                      ----                                   --
formatter/large/dataset.py                 1.00      7.8¬±0.11ms     5.2 MB/sec    1.09      8.4¬±0.06ms     4.8 MB/sec
formatter/numpy/ctypeslib.py               1.00  1787.7¬±20.25¬µs     9.3 MB/sec    1.06  1895.5¬±17.14¬µs     8.8 MB/sec
formatter/numpy/globals.py                 1.00    218.3¬±2.97¬µs    13.5 MB/sec    1.05    228.7¬±6.70¬µs    12.9 MB/sec
formatter/pydantic/types.py                1.00      4.0¬±0.04ms     6.4 MB/sec    1.07      4.3¬±0.05ms     6.0 MB/sec
linter/all-rules/large/dataset.py          1.00     15.1¬±0.14ms     2.7 MB/sec    1.00     15.1¬±0.13ms     2.7 MB/sec
linter/all-rules/numpy/ctypeslib.py        1.00      4.1¬±0.06ms     4.1 MB/sec    1.00      4.1¬±0.05ms     4.1 MB/sec
linter/all-rules/numpy/globals.py          1.00    498.4¬±6.76¬µs     5.9 MB/sec    1.00    499.5¬±6.56¬µs     5.9 MB/sec
linter/all-rules/pydantic/types.py         1.00      6.8¬±0.06ms     3.8 MB/sec    1.00      6.8¬±0.10ms     3.8 MB/sec
linter/default-rules/large/dataset.py      1.00      7.9¬±0.06ms     5.1 MB/sec    1.00      7.9¬±0.06ms     5.2 MB/sec
linter/default-rules/numpy/ctypeslib.py    1.00  1712.1¬±26.20¬µs     9.7 MB/sec    1.00  1711.6¬±14.51¬µs     9.7 MB/sec
linter/default-rules/numpy/globals.py      1.00    199.9¬±6.59¬µs    14.8 MB/sec    1.00    200.3¬±4.46¬µs    14.7 MB/sec
linter/default-rules/pydantic/types.py     1.00      3.6¬±0.05ms     7.1 MB/sec    1.00      3.6¬±0.03ms     7.1 MB/sec
```
<!-- thollander/actions-comment-pull-request "PR Check Results" -->

---

_Review comment by @charliermarsh on `crates/ruff/src/rules/ruff/rules/implicit_optional.rs`:167 on 2023-06-23 18:42_

Hmm, I feel like we _could_ accept anything that's builtin, or from `typing_extensions`, or _any_ standard-library module. Should we just check in `KNOWN_STANDARD_LIBRARY`?

---

_@charliermarsh reviewed on 2023-06-23 18:42_

---

_@dhruvmanila reviewed on 2023-06-23 20:14_

---

_Review comment by @dhruvmanila on `crates/ruff/src/rules/ruff/rules/implicit_optional.rs`:167 on 2023-06-23 20:14_

Yeah, `KNOWN_STANDARD_LIBRARY` makes more sense.

---

_Merged by @charliermarsh on 2023-06-23 22:51_

---

_Closed by @charliermarsh on 2023-06-23 22:51_

---

_Branch deleted on 2023-06-23 22:51_

---
