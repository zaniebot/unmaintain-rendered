<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add autofix for `PYI055` - astral-sh/ruff #7886</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add autofix for <code>PYI055</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7886">#7886</a>
        opened by <a href="https://github.com/diceroll123">@diceroll123</a>
        on 2023-10-10 05:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/diceroll123">@diceroll123</a></div>
            <div class="timeline-body">

Summary


<p>Adds autofix for <code>PYI055</code></p>
<p>Questions:</p>
<ul>
<li>is it intended that only the code within the <code>def func():</code> gets fixed? ü§î I feel like some of the top-level variables would also be affected.</li>
<li>should <code>w: builtins.type[int] | builtins.type[str] | builtins.type[complex]</code> turn into <code>w: builtins.type[int | str | complex]</code>?<ul>
<li>or <code>w: type[int | str | complex]</code>?</li>
</ul>
</li>
</ul>
Test Plan


<p><code>cargo test</code>, and manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-10-10 05:37</div>
            <div class="timeline-body">PR Check Results
Ecosystem
<p>‚ÑπÔ∏è ecosystem check <strong>detected changes</strong>. (+6, -6, 0 error(s))</p>
airflow (+4, -4)
<p>

<pre>
- [*] 16066 fixable with the `--fix` option (6343 hidden fixes can be enabled with the `--unsafe-fixes` option).
+ [*] 16069 fixable with the `--fix` option (6343 hidden fixes can be enabled with the `--unsafe-fixes` option).
- <a href="https://github.com/apache/airflow/blob/1f63199351efe9a240c5ae07ce31b79fb0353d64/airflow/providers/google/cloud/hooks/bigquery.py#L1580">airflow/providers/google/cloud/hooks/bigquery.py:1580:35:</a> PYI055 Multiple `type` members in a union. Combine them into one, e.g., `type[CopyJob | QueryJob | LoadJob | ExtractJob]`.
+ <a href="https://github.com/apache/airflow/blob/1f63199351efe9a240c5ae07ce31b79fb0353d64/airflow/providers/google/cloud/hooks/bigquery.py#L1580">airflow/providers/google/cloud/hooks/bigquery.py:1580:35:</a> PYI055 [*] Multiple `type` members in a union. Combine them into one, e.g., `type[CopyJob | QueryJob | LoadJob | ExtractJob]`.
- <a href="https://github.com/apache/airflow/blob/1f63199351efe9a240c5ae07ce31b79fb0353d64/airflow/providers/google/cloud/hooks/bigquery.py#L1587">airflow/providers/google/cloud/hooks/bigquery.py:1587:14:</a> PYI055 Multiple `type` members in a union. Combine them into one, e.g., `type[CopyJob | QueryJob | LoadJob | ExtractJob]`.
+ <a href="https://github.com/apache/airflow/blob/1f63199351efe9a240c5ae07ce31b79fb0353d64/airflow/providers/google/cloud/hooks/bigquery.py#L1587">airflow/providers/google/cloud/hooks/bigquery.py:1587:14:</a> PYI055 [*] Multiple `type` members in a union. Combine them into one, e.g., `type[CopyJob | QueryJob | LoadJob | ExtractJob]`.
- <a href="https://github.com/apache/airflow/blob/1f63199351efe9a240c5ae07ce31b79fb0353d64/airflow/providers/smtp/hooks/smtp.py#L103">airflow/providers/smtp/hooks/smtp.py:103:15:</a> PYI055 Multiple `type` members in a union. Combine them into one, e.g., `type[smtplib.SMTP_SSL | smtplib.SMTP]`.
+ <a href="https://github.com/apache/airflow/blob/1f63199351efe9a240c5ae07ce31b79fb0353d64/airflow/providers/smtp/hooks/smtp.py#L103">airflow/providers/smtp/hooks/smtp.py:103:15:</a> PYI055 [*] Multiple `type` members in a union. Combine them into one, e.g., `type[smtplib.SMTP_SSL | smtplib.SMTP]`.
</pre>

</p>

bokeh (+2, -2)
<p>

<pre>
- [*] 17800 fixable with the `--fix` option (4727 hidden fixes can be enabled with the `--unsafe-fixes` option).
+ [*] 17801 fixable with the `--fix` option (4727 hidden fixes can be enabled with the `--unsafe-fixes` option).
- <a href="https://github.com/bokeh/bokeh/blob/8fa062ac8938a6c064caa2dd50be7013f04fa2f7/src/bokeh/core/validation/decorators.py#L67">src/bokeh/core/validation/decorators.py:67:13:</a> PYI055 Multiple `type` members in a union. Combine them into one, e.g., `type[Error | Warning]`.
+ <a href="https://github.com/bokeh/bokeh/blob/8fa062ac8938a6c064caa2dd50be7013f04fa2f7/src/bokeh/core/validation/decorators.py#L67">src/bokeh/core/validation/decorators.py:67:13:</a> PYI055 [*] Multiple `type` members in a union. Combine them into one, e.g., `type[Error | Warning]`.
</pre>

</p>

Rules changed: 1

<p>| Rule | Changes | Additions | Removals |
| ---- | ------- | --------- | -------- |
| PYI055 | 8 | 4 | 4 |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/diceroll123">@diceroll123</a> on 2023-10-11 03:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/diceroll123">@diceroll123</a> reviewed on 2023-10-11 03:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/diceroll123">@diceroll123</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/unnecessary_type_union.rs</code>:163 on 2023-10-11 03:51</div>
            <div class="timeline-body"><p>is there a shorthand for any of this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-11 03:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/unnecessary_type_union.rs</code>:163 on 2023-10-11 03:58</div>
            <div class="timeline-body"><p>No, it&#x27;s bad üòû</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/diceroll123">@diceroll123</a> reviewed on 2023-10-11 03:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/diceroll123">@diceroll123</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/unnecessary_type_union.rs</code>:163 on 2023-10-11 03:59</div>
            <div class="timeline-body"><p>That is <em>NOT</em> what I wanted to hear! ü§£ Thanks anyways.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-11 04:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/unnecessary_type_union.rs</code>:163 on 2023-10-11 04:04</div>
            <div class="timeline-body"><p>Hopefully clear that I mean the abstractions are bad, and not your code :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/diceroll123">@diceroll123</a> reviewed on 2023-10-11 04:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/diceroll123">@diceroll123</a> on <code>crates/ruff_linter/src/rules/flake8_pyi/rules/unnecessary_type_union.rs</code>:163 on 2023-10-11 04:04</div>
            <div class="timeline-body"><p>ü§£ of course.</p>
<p>...but why not both?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-11 04:17</div>
            <div class="timeline-body"><p>I think <code>w: builtins.type[int] | builtins.type[str] | builtins.type[complex]</code> should turn into <code>w: builtins.type[int | str | complex]</code>.</p>
<p>Is your first question still relevant? It looks like stuff outside of the <code>def</code> is being flagged in the snapshot.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/diceroll123">@diceroll123</a> on 2023-10-11 04:20</div>
            <div class="timeline-body"><blockquote>
<p>I think <code>w: builtins.type[int] | builtins.type[str] | builtins.type[complex]</code> should turn into <code>w: builtins.type[int | str | complex]</code>.</p>
<p>Is your first question still relevant? It looks like stuff outside of the <code>def</code> is being flagged in the snapshot.</p>
</blockquote>
<p>mmm, that answers my question! I&#x27;ll dig into that. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-11 04:23</div>
            <div class="timeline-body"><p>On second thought, it&#x27;s probably not worth the complexity. But we should ensure that <code>checker.is_builtin(&quot;type&quot;)</code> before adding the autofix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/diceroll123">@diceroll123</a> on 2023-10-11 04:32</div>
            <div class="timeline-body"><blockquote>
<p>On second thought, it&#x27;s probably not worth the complexity. But we should ensure that <code>checker.is_builtin(&quot;type&quot;)</code> before adding the autofix.</p>
</blockquote>
<pre><code>checker
        .semantic()
        .resolve_call_path(subscript.value.as_ref())
        .is_some_and(|call_path| matches!(call_path.as_slice(), [&quot;&quot; | &quot;builtins&quot;, &quot;type&quot;]))
</code></pre>
<p>is this code starting on line 83 not doing that? or is it not explicit enough?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-13 00:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-13 00:46</div>
            <div class="timeline-body"><p>It&#x27;s not quite sufficient, because that would also match <code>builtins.type</code>. I just added a guard to check the builtin explicitly prior to performing the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-13 00:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-13 00:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:58:10 UTC
    </footer>
</body>
</html>
