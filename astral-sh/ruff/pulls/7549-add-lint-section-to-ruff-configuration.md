```yaml
number: 7549
title: "Add `lint` section to Ruff configuration"
type: pull_request
state: merged
author: MichaReiser
labels:
  - configuration
assignees: []
merged: true
base: main
head: lint-options
created_at: 2023-09-20T16:04:50Z
updated_at: 2023-09-27T06:46:29Z
url: https://github.com/astral-sh/ruff/pull/7549
synced_at: 2026-01-12T02:39:10Z
```

# Add `lint` section to Ruff configuration

---

_Pull request opened by @MichaReiser on 2023-09-20 16:04_

## Summary

This PR adds a new `lint` section to the configuration that groups all linter-specific settings. The existing top-level configurations continue to work without any warning because the `lint.*` settings are experimental. 

The configuration merges the top level and `lint.*` settings where the settings in `lint` have higher precedence (override the top-level settings). The reasoning behind this is that the settings in `lint.` are more specific and more specific settings should override less specific settings.

I decided against showing the new `lint.*` options on our website because it would make the page extremely long (it's technically easy to do, just attribute `lint` with `[option_group`]). We may want to explore adding an `alias` field to the `option` attribute and show the alias on the website along with its regular name. 

## Test Plan

* I added new integration tests
* I verified that the generated `options.md` is identical
* Verified the default settings in the playground

![Screenshot from 2023-09-22 13-52-23](https://github.com/astral-sh/ruff/assets/1203881/7b4d9689-aa88-402e-9199-9c43c8d8cc2d)


---

_Comment by @MichaReiser on 2023-09-20 16:04_

Current dependencies on/for this PR:
* main
  * **PR #7566** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7566" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #7591** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7591" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #7593** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7593" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
        * **PR #7549** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7549" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ
          * **PR #7599** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/7599" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7549?utm_source=stack-comment).

---

_Label `configuration` added by @MichaReiser on 2023-09-20 16:07_

---

_Review comment by @MichaReiser on `crates/ruff_workspace/src/options.rs`:41 on 2023-09-20 16:15_

The documentation moves to the new option names, but the old settings are still in the schema (thanks to `serde(flatten)`. Very neat feature for this use case.

---

_@MichaReiser reviewed on 2023-09-20 16:16_

---

_Comment by @codspeed-hq[bot] on 2023-09-21 12:27_

## [CodSpeed Performance Report](https://codspeed.io/astral-sh/ruff/branches/lint-options)

### Merging #7549 will **improve performances by 8.46%**

<sub>Comparing <code>lint-options</code> (8827264) with <code>main</code> (39ddad7)</sub>



### Summary

`âš¡ 7` improvements
`âœ… 18` untouched benchmarks




### Benchmarks breakdown

|     | Benchmark | `main` | `lint-options` | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| âš¡ | `linter/default-rules[pydantic/types.py]` | 38 ms | 37.2 ms | +2.07% |
| âš¡ | `linter/default-rules[numpy/ctypeslib.py]` | 18.5 ms | 18.1 ms | +2.27% |
| âš¡ | `lexer[unicode/pypinyin.py]` | 620.1 Âµs | 592 Âµs | +4.75% |
| âš¡ | `linter/default-rules[large/dataset.py]` | 94.1 ms | 90.6 ms | +3.88% |
| âš¡ | `lexer[numpy/ctypeslib.py]` | 2 ms | 1.9 ms | +2.55% |
| âš¡ | `lexer[large/dataset.py]` | 9.8 ms | 9 ms | +8.46% |
| âš¡ | `lexer[pydantic/types.py]` | 4.1 ms | 4 ms | +3.69% |


---

_Comment by @github-actions[bot] on 2023-09-21 12:33_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_@MichaReiser reviewed on 2023-09-22 11:55_

---

_Review comment by @MichaReiser on `crates/ruff_dev/src/generate_options.rs`:85 on 2023-09-22 11:55_

Add proper sub-headings for options under `lint`. We actually don't need this yet except if we decide to show the `lint.*` options on the website.

---

_@MichaReiser reviewed on 2023-09-22 11:56_

---

_Review comment by @MichaReiser on `crates/ruff_macros/src/config.rs`:51 on 2023-09-22 11:56_

I admit, this is a bit hacky but implementing full parsing for serde attributes felt overkill

---

_@MichaReiser reviewed on 2023-09-22 11:56_

---

_Review comment by @MichaReiser on `crates/ruff_macros/src/config.rs`:160 on 2023-09-22 11:56_

Documentation is only required for top-level settings.

---

_@MichaReiser reviewed on 2023-09-22 11:57_

---

_Review comment by @MichaReiser on `crates/ruff_workspace/src/configuration.rs`:61 on 2023-09-22 11:57_

Please double check that I didn't remove any global option or forgot to move a linter specific option.

---

_Marked ready for review by @MichaReiser on 2023-09-22 11:58_

---

_Review requested from @charliermarsh by @MichaReiser on 2023-09-22 11:58_

---

_Review requested from @konstin by @MichaReiser on 2023-09-22 11:58_

---

_Review comment by @konstin on `crates/ruff_workspace/src/configuration.rs`:71 on 2023-09-22 12:50_

nit: sort these alphabetically again

---

_Review comment by @konstin on `crates/ruff_workspace/src/configuration.rs`:401 on 2023-09-22 12:53_

that's something i'd like a macro for (not a review comment)

---

_@konstin approved on 2023-09-22 12:59_

The options become quite long/nested when used in pyproject.toml (which is the default people) when nesting each linter option under `tool.ruff.lint.<flake8plugin>.<option-name>`.

---

_Comment by @MichaReiser on 2023-09-22 13:33_

> The options become quite long/nested when used in pyproject.toml (which is the default people) when nesting each linter option under `tool.ruff.lint.<flake8plugin>.<option-name>`.

Yeah, I noticed that too. I think we want to reconsider how we configure rules with their settings in the future (rule categorisation). For example, I like clippys lints configuration schema (which avoids the deep nesting) 

```
[tool.ruff.lint]
group.rule = "warn"
group.rule2 = { severity: "allow", option: xx }
```


---

_@charliermarsh reviewed on 2023-09-26 18:11_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/options.rs`:41 on 2023-09-26 18:11_

How does this manifest in the documentation? Trying to reconcile this with the PR summary (and also grok the code). Like what does https://docs.astral.sh/ruff/settings look like now?

---

_@charliermarsh reviewed on 2023-09-26 18:11_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/configuration.rs`:299 on 2023-09-26 18:11_

Nit: `TODO(micha): ` or resolve.

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/configuration.rs`:298 on 2023-09-26 18:11_

You could do this with option chaining, probably, if you want :)

---

_@charliermarsh reviewed on 2023-09-26 18:11_

---

_@charliermarsh reviewed on 2023-09-26 18:12_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/configuration.rs`:302 on 2023-09-26 18:12_

Having the options vs. configuration separation is useful here!

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/options.rs`:41 on 2023-09-26 18:18_

Okay, I'm not sure how, but it looks like the docs are basically unchanged (as suggested in the PR summary):

<img width="1792" alt="Screen Shot 2023-09-26 at 2 17 49 PM" src="https://github.com/astral-sh/ruff/assets/1309177/4715c6b3-6024-4117-9eb6-752eb8e59372">


---

_@charliermarsh reviewed on 2023-09-26 18:18_

---

_@charliermarsh reviewed on 2023-09-26 18:24_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/configuration.rs`:86 on 2023-09-26 18:24_

Hmm. I think `typing_modules` and `logger_objects` should arguably be treated the same. They're both used to mark modules or objects for multi-file analysis. E.g., if a module is in `typing_modules`, we assume it's exporting stuff from the standard library `typing` module. If an object is in `logger_objects`, we assume it's a `logging.Logger`.

I think these can probably both be part of the `lint` section.


---

_@charliermarsh reviewed on 2023-09-26 18:24_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/configuration.rs`:61 on 2023-09-26 18:24_

Confirming that I spent some time looking through.

---

_@charliermarsh approved on 2023-09-26 18:24_

---

_@zanieb approved on 2023-09-26 18:53_

---

_@MichaReiser reviewed on 2023-09-26 20:05_

---

_Review comment by @MichaReiser on `crates/ruff_workspace/src/options.rs`:41 on 2023-09-26 20:05_

They are unchanged because the new lint field isn't attributed with option_group

We could change that but I think it would make it too verbose. The only real alternative IMO is to add alias support 

---

_@charliermarsh reviewed on 2023-09-26 20:37_

---

_Review comment by @charliermarsh on `crates/ruff_workspace/src/options.rs`:41 on 2023-09-26 20:37_

This end-result seems right to me.

---

_Review comment by @MichaReiser on `crates/ruff_workspace/src/configuration.rs`:401 on 2023-09-27 06:21_

Potentially, but then, macros are hard to understand and its not so much trouble to write it.

---

_@MichaReiser reviewed on 2023-09-27 06:21_

---

_@MichaReiser reviewed on 2023-09-27 06:24_

---

_Review comment by @MichaReiser on `crates/ruff_workspace/src/configuration.rs`:298 on 2023-09-27 06:24_

Not sure how, the following doesn't work because `combine` consumes `options.lint_top_level`:

```rust
let lint = options.lint.map_or_else(|| options.lint_top_level, |lint| lint.combine(options.lint_top_level))
```

---

_@MichaReiser reviewed on 2023-09-27 06:24_

---

_Review comment by @MichaReiser on `crates/ruff_workspace/src/configuration.rs`:302 on 2023-09-27 06:24_

It is. It also makes sense in many other places. I'm fairly happy with our `Options` -> `Configuration` -> `Settings` separation

---

_Merged by @MichaReiser on 2023-09-27 06:46_

---

_Closed by @MichaReiser on 2023-09-27 06:46_

---

_Branch deleted on 2023-09-27 06:46_

---

_Comment by @MichaReiser on 2023-09-27 06:46_

### Merge Activity

* **Sep 27, 2:46 AM**: @MichaReiser merged this pull request with [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/7549).


---
