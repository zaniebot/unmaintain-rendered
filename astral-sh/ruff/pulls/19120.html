<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix descriptor lookups for most types that overlap with `None` - astral-sh/ruff #19120</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix descriptor lookups for most types that overlap with <code>None</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/19120">#19120</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-07-03 13:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Helps with https://github.com/astral-sh/ty/issues/737. The problem remains for calling methods on <code>None</code> itself, but no longer applies to <code>object</code>, <code>AlwaysTruthy</code>, <code>AlwaysFalsy</code>, or protocols that are not disjoint from <code>None</code>.</p>
<h2>Test Plan</h2>
<p>mdtests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @AlexWaygood on 2025-07-03 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-07-03 13:26</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<details>
<summary>Changes were detected when running on open source projects</summary>

<pre><code class="language-diff">parso (https://github.com/davidhalter/parso)
-     memo fields = ~54MB
+     memo fields = ~49MB

async-utils (https://github.com/mikeshardmind/async-utils)
- TOTAL MEMORY USAGE: ~45MB
+ TOTAL MEMORY USAGE: ~49MB

beartype (https://github.com/beartype/beartype)
- TOTAL MEMORY USAGE: ~88MB
+ TOTAL MEMORY USAGE: ~97MB

werkzeug (https://github.com/pallets/werkzeug)
- error[non-subscriptable] src/werkzeug/utils.py:91:13: Cannot subscript object of type `property` with no `__getitem__` method
+ error[non-subscriptable] src/werkzeug/utils.py:91:13: Cannot subscript object of type `object` with no `__getitem__` method
- error[non-subscriptable] src/werkzeug/utils.py:118:17: Cannot subscript object of type `property` with no `__getitem__` method
+ error[non-subscriptable] src/werkzeug/utils.py:118:17: Cannot subscript object of type `object` with no `__getitem__` method

discord.py (https://github.com/Rapptz/discord.py)
-     memo fields = ~189MB
+     memo fields = ~207MB

rich (https://github.com/Textualize/rich)
-     memo fields = ~117MB
+     memo fields = ~106MB

isort (https://github.com/pycqa/isort)
-     memo metadata = ~5MB
+     memo metadata = ~6MB

pylox (https://github.com/sco1/pylox)
-     memo fields = ~49MB
+     memo fields = ~54MB

poetry (https://github.com/python-poetry/poetry)
-     memo fields = ~189MB
+     memo fields = ~171MB

jinja (https://github.com/pallets/jinja)
-     memo fields = ~80MB
+     memo fields = ~88MB

pytest (https://github.com/pytest-dev/pytest)
- TOTAL MEMORY USAGE: ~276MB
+ TOTAL MEMORY USAGE: ~251MB

vision (https://github.com/pytorch/vision)
- error[missing-argument] torchvision/datasets/vision.py:81:17: No argument provided for required parameter `self` of function `__repr__`
- error[missing-argument] torchvision/datasets/vision.py:101:17: No argument provided for required parameter `self` of function `__repr__`
- Found 1474 diagnostics
+ Found 1472 diagnostics

psycopg (https://github.com/psycopg/psycopg)
-     memo metadata = ~25MB
+     memo metadata = ~28MB

openlibrary (https://github.com/internetarchive/openlibrary)
-     memo fields = ~171MB
+     memo fields = ~189MB

bokeh (https://github.com/bokeh/bokeh)
- TOTAL MEMORY USAGE: ~251MB
+ TOTAL MEMORY USAGE: ~276MB

prefect (https://github.com/PrefectHQ/prefect)
- error[missing-argument] src/prefect/settings/legacy.py:80:16: No argument provided for required parameter `value` of function `__eq__`
- Found 3753 diagnostics
+ Found 3752 diagnostics

scipy (https://github.com/scipy/scipy)
- TOTAL MEMORY USAGE: ~1399MB
+ TOTAL MEMORY USAGE: ~1271MB

</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @AlexWaygood on 2025-07-03 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-07-03 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-07-03 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @AlexWaygood on 2025-07-03 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-03 13:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3605 on 2025-07-03 13:33</div>
            <div class="timeline-body"><p>this means that we now selected overload 2 rather than overload 1 for types such as <code>object</code> that are not subtypes of <code>None</code>, but are also not disjoint from <code>None</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-07-03 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/descriptor_protocol.md</code>:624 on 2025-07-03 17:12</div>
            <div class="timeline-body"><p>I think we should preserve a TODO here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-07-03 17:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-03 17:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3578 on 2025-07-03 17:45</div>
            <div class="timeline-body"><p>I think you may want to apply the same change to the match case just above, right? It's slightly harder to write a test for, because you might need to call <code>__get__</code> manually? Let me know if you need help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-07-05 18:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3578 on 2025-07-05 18:30</div>
            <div class="timeline-body"><p>thanks, yes, you're correct that we emitted false positive diagnostics for <code>object.__str__.__get__(object(), None)()</code> as well as <code>object().__str__()</code> ðŸ˜†</p>
<p>I added a regression test!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-07-05 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-07-05 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-05 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a> reviewed on 2025-07-07 06:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sharkdp">@sharkdp</a> on <code>crates/ty_python_semantic/src/types.rs</code>:3578 on 2025-07-07 06:38</div>
            <div class="timeline-body"><blockquote>
<p><code>object.__str__.__get__(object(), None)()</code></p>
</blockquote>
<p>Just imagine how happy users will be that this <em>finally</em> works correctly.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:13:56 UTC
    </footer>
</body>
</html>
