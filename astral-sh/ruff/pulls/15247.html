<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Recognize more expressions (`RUF027`) - astral-sh/ruff #15247</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Recognize more expressions (<code>RUF027</code>)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/15247">#15247</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2025-01-04 04:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Resolves #15227.</p>
<h2>Test Plan</h2>
<p><code>cargo nextest run</code> and <code>cargo insta test</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-01-04 04:11</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>ℹ️ ecosystem check <strong>detected linter changes</strong>. (+29 -0 violations, +0 -0 fixes in 9 projects; 46 projects unchanged)</p>
<details><summary><a href="https://github.com/apache/airflow">apache/airflow</a> (+3 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/apache/airflow/blob/013401b4a7c1c9fe7b3dd669d40f546ffd895314/dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py#L327'>dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py:327:13:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/apache/airflow/blob/013401b4a7c1c9fe7b3dd669d40f546ffd895314/providers/src/airflow/providers/apache/spark/hooks/spark_connect.py#L76'>providers/src/airflow/providers/apache/spark/hooks/spark_connect.py:76:30:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/apache/airflow/blob/013401b4a7c1c9fe7b3dd669d40f546ffd895314/scripts/ci/pre_commit/check_min_python_version.py#L38'>scripts/ci/pre_commit/check_min_python_version.py:38:17:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/ibis-project/ibis">ibis-project/ibis</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/ibis-project/ibis/blob/b6e9ef11ea61dd2f8b1002654f495d9f1caa3342/ibis/backends/__init__.py#L919'>ibis/backends/__init__.py:919:33:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/latchbio/latch">latchbio/latch</a> (+4 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/nextflow/config.py#L148'>src/latch_cli/nextflow/config.py:148:35:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/snakemake/config/parser.py#L116'>src/latch_cli/snakemake/config/parser.py:116:20:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/snakemake/config/parser.py#L248'>src/latch_cli/snakemake/config/parser.py:248:13:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/snakemake/serialize_utils.py#L179'>src/latch_cli/snakemake/serialize_utils.py:179:13:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/lnbits/lnbits">lnbits/lnbits</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/lnbits/lnbits/blob/51c9d294cdb40c777b1048bbee267b49cdaf7a34/lnbits/core/helpers.py#L85'>lnbits/core/helpers.py:85:30:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pandas-dev/pandas">pandas-dev/pandas</a> (+1 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pandas-dev/pandas/blob/1be26374dd7ef43bc709c4bc6db2daf7bfd606c8/pandas/core/generic.py#L12613'>pandas/core/generic.py:12613:22:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/rotki/rotki">rotki/rotki</a> (+6 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/rotki/rotki/blob/e11c61e13d09c99ac13b1e69677cf83e6eecb198/rotkehlchen/tests/api/blockchain/test_base.py#L949'>rotkehlchen/tests/api/blockchain/test_base.py:949:33:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/rotki/rotki/blob/e11c61e13d09c99ac13b1e69677cf83e6eecb198/rotkehlchen/tests/exchanges/test_bitfinex.py#L70'>rotkehlchen/tests/exchanges/test_bitfinex.py:70:22:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/rotki/rotki/blob/e11c61e13d09c99ac13b1e69677cf83e6eecb198/rotkehlchen/tests/exchanges/test_bitfinex.py#L80'>rotkehlchen/tests/exchanges/test_bitfinex.py:80:22:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/rotki/rotki/blob/e11c61e13d09c99ac13b1e69677cf83e6eecb198/rotkehlchen/tests/exchanges/test_bitfinex.py#L89'>rotkehlchen/tests/exchanges/test_bitfinex.py:89:22:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/rotki/rotki/blob/e11c61e13d09c99ac13b1e69677cf83e6eecb198/rotkehlchen/tests/utils/checks.py#L15'>rotkehlchen/tests/utils/checks.py:15:33:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/rotki/rotki/blob/e11c61e13d09c99ac13b1e69677cf83e6eecb198/rotkehlchen/tests/utils/checks.py#L16'>rotkehlchen/tests/utils/checks.py:16:33:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/zulip/zulip">zulip/zulip</a> (+4 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview --select ALL</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/zulip/zulip/blob/01cb7867156ecbd6f0b4efc4b7440ea2c2ca80a0/corporate/tests/test_stripe.py#L1650'>corporate/tests/test_stripe.py:1650:46:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/zulip/zulip/blob/01cb7867156ecbd6f0b4efc4b7440ea2c2ca80a0/zerver/lib/event_schema.py#L457'>zerver/lib/event_schema.py:457:30:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/zulip/zulip/blob/01cb7867156ecbd6f0b4efc4b7440ea2c2ca80a0/zerver/management/commands/export_search.py#L129'>zerver/management/commands/export_search.py:129:17:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/zulip/zulip/blob/01cb7867156ecbd6f0b4efc4b7440ea2c2ca80a0/zerver/tests/test_signup.py#L3140'>zerver/tests/test_signup.py:3140:13:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/pytest-dev/pytest">pytest-dev/pytest</a> (+2 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/pytest-dev/pytest/blob/e8c2082d751999fa0ebf1ba335cfec3b022f0a88/testing/test_pathlib.py#L1365'>testing/test_pathlib.py:1365:13:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/pytest-dev/pytest/blob/e8c2082d751999fa0ebf1ba335cfec3b022f0a88/testing/test_terminal.py#L1103'>testing/test_terminal.py:1103:13:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary><a href="https://github.com/astropy/astropy">astropy/astropy</a> (+7 -0 violations, +0 -0 fixes)</summary>
<p>
<pre>ruff check --no-cache --exit-zero --ignore RUF9 --output-format concise --preview</pre>
</p>
<p>

<pre>
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/coordinates/representation/geodetic.py#L18'>astropy/coordinates/representation/geodetic.py:18:21:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/coordinates/transformations/affine.py#L68'>astropy/coordinates/transformations/affine.py:68:17:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/table/table.py#L98'>astropy/table/table.py:98:16:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/uncertainty/core.py#L579'>astropy/uncertainty/core.py:579:17:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/utils/tests/test_decorators.py#L725'>astropy/utils/tests/test_decorators.py:725:18:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/utils/tests/test_decorators.py#L821'>astropy/utils/tests/test_decorators.py:821:17:</a> RUF027 Possible f-string without an `f` prefix
+ <a href='https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/wcs/utils.py#L253'>astropy/wcs/utils.py:253:17:</a> RUF027 Possible f-string without an `f` prefix
</pre>

</p>
</details>
<details><summary>Changes by rule (1 rules affected)</summary>
<p>

<p>| code | total | + violation | - violation | + fix | - fix |
| ---- | ------- | --------- | -------- | ----- | ---- |
| RUF027 | 29 | 29 | 0 | 0 | 0 |</p>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-04 10:21</div>
            <div class="timeline-body"><p>The true-positive-turned-false-negative:</p>
<pre><code class="language-python">raise ValueError(
    &quot;Scale {scale!r} is not in the allowed scales {sorted(self.SCALES)}&quot;
)
</code></pre>
<p>#9849 has a bit more context on why strings whose placeholders' names are the same as that of built-ins are ignored. This interacted poorly with the new logic; in addition, it fails to recognize dunder names:</p>
<pre><code class="language-python">print('{__path__}')  # Currently a false negative
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-04 10:37</div>
            <div class="timeline-body"><p>The new changes introduced a few true positives, most notably:</p>
<p><a href="https://github.com/latchbio/latch/blob/f986b146bce5cd9d915721edaf608d84c53d8648/src/latch_cli/nextflow/config.py#L148">@latchbio/latch</a>:</p>
<pre><code class="language-py">params_path.write_text(dedent(r&quot;&quot;&quot;
        ...

        generated_parameters = {
        __params__
        }

        &quot;&quot;&quot;).replace(&quot;__params__&quot;, reindent(&quot;&quot;.join(params), 1)))
</code></pre>
<p><a href="https://github.com/astropy/astropy/blob/80aa67d2cc7ddb41a63d00d231b2792aafca77fa/astropy/coordinates/representation/geodetic.py#L18">@astropy/astropy</a>:</p>
<pre><code class="language-py">geodetic_base_doc = &quot;&quot;&quot;{__doc__}
    ...
&quot;&quot;&quot;


@format_doc(geodetic_base_doc)
class BaseGeodeticRepresentation(BaseRepresentation): ...
</code></pre>
<p>The former is embedded code, while the latter is dynamically interpolated. These cannot be detected reliably in the first place, so I think the false positives are acceptable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-04 10:44</div>
            <div class="timeline-body"><p>I haven't looked at this PR yet, but note that RUF027 already has too many false positives for us to consider stabilising it. I definitely don't think we should be making changes that introduce new false positives here, honestly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-04 10:52</div>
            <div class="timeline-body"><p>If so, this PR might as well be closed, as this is now considered an error:</p>
<p><a href="https://github.com/apache/airflow/blob/013401b4a7c1c9fe7b3dd669d40f546ffd895314/dev/breeze/src/airflow_breeze/utils/kubernetes_utils.py#L327">@apache/airflow</a>:</p>
<pre><code class="language-python">python_major_minor_version = run_command(
    [
        str(PYTHON_BIN_PATH),
        &quot;-c&quot;,
        &quot;import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')&quot;,
    ],
).stdout.strip()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-04 12:09</div>
            <div class="timeline-body"><p>It does find some new actual violations but we should look into if we can find a way to reduce the false positives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2025-01-20 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @dhruvmanila on 2025-01-20 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-28 07:08</div>
            <div class="timeline-body"><blockquote>
<p>It does find some new actual violations but we should look into if we can find a way to reduce the false positives.</p>
</blockquote>
<p>Closing as this PR hasn't seen any activity in a while. Feel free to open a new PR that takes this feedback into account. Thanks @InSyncWithFoo for your work on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-04-28 07:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:08:51 UTC
    </footer>
</body>
</html>
