<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format `PYI` examples in docs as `.pyi`-file snippets - astral-sh/ruff #13116</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Format <code>PYI</code> examples in docs as <code>.pyi</code>-file snippets</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/13116">#13116</a>
        opened by <a href="https://github.com/calumy">@calumy</a>
        on 2024-08-26 21:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/calumy">@calumy</a> on 2024-08-26 21:57</div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Now that docs are formatted by the Ruff formatter, https://github.com/astral-sh/ruff/pull/13087. It is also possible to format <code>pyi</code>-style examples with the <code>pyi</code>-style format fixing https://github.com/astral-sh/ruff/issues/11568.</p>
<p>One concern I have with this update is that syntax highlighting is currently not implemented in MK docs for PYI examples. Therefore, we need to decide if it is better that the docs are formatted correctly or if syntax highlighting is more important. If the latter is the case, I can investigate this further and draft this PR for now.</p>
<h2>Test Plan</h2>
<ul>
<li>CI to check that docs are formatted correctly</li>
</ul>
<p>CC @AlexWaygood, I would appreciate it if you could review this PR as you opened the issue that prompted this update. I think it would be useful to sense-check the examples that I updated to PYI, as well as let me know and further examples that would benefit from <code>pyi</code> style formatting and I can update as required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @calumy on 2024-08-26 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @calumy on 2024-08-26 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @calumy on 2024-08-26 22:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-08-26 22:20</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>‚úÖ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/chatgpt/gpt_actions_library/gpt_action_salesforce.ipynb:14:1:1: Expected an expression
</code></pre>
</p>
</details>

<h3>Formatter (preview)</h3>
<p>‚ÑπÔ∏è ecosystem check <strong>encountered format errors</strong>. (no format changes; 1 project error)</p>
<details><summary><a href="https://github.com/openai/openai-cookbook">openai/openai-cookbook</a> (error)</summary>
<p>
<pre>ruff format --preview</pre>
</p>
<p>

<pre><code>warning: Detected debug build without --no-cache.
error: Failed to parse examples/chatgpt/gpt_actions_library/gpt_action_salesforce.ipynb:14:1:1: Expected an expression
</code></pre>
</p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/check_docs_formatted.py</code>:161 on 2024-08-27 13:05</div>
            <div class="timeline-body"><p>Could consider using pattern-matching here:</p>
<pre><code class="language-suggestion">        match language:
            case &quot;python&quot;:
                extension = &quot;py&quot;
            case &quot;pyi&quot;:
                extension = &quot;pyi&quot;
            case _:
                # We are only interested in checking the formatting of py or pyi code blocks
                # so we can return early if the language is not one of these.
                return f'{match[&quot;before&quot;]}{match[&quot;code&quot;]}{match[&quot;after&quot;]}'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-08-27 13:12</div>
            <div class="timeline-body"><p>Nice, this looks great!</p>
<blockquote>
<p>One concern I have with this update is that syntax highlighting is currently not implemented in MK docs for PYI examples.</p>
</blockquote>
<p>Hmm, that is a shame (and might indeed be a blocker here, sadly ‚òπÔ∏è). Did you find this out from reading the docs, or by experimenting? I can't immediately find anywhere where this is documented :/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2024-08-27 21:49</div>
            <div class="timeline-body"><blockquote>
<p>Nice, this looks great!</p>
<blockquote>
<p>One concern I have with this update is that syntax highlighting is currently not implemented in MK docs for PYI examples.</p>
</blockquote>
<p>Hmm, that is a shame (and might indeed be a blocker here, sadly ‚òπÔ∏è). Did you find this out from reading the docs, or by experimenting? I can't immediately find anywhere where this is documented :/</p>
</blockquote>
<p>This was found with experimentation. Hopefully, the lack of highlighting of <code>.pyi</code> files should be fixed with <a href="https://github.com/pygments/pygments/pull/2773">this PR</a> and a subsequent release of pygments.</p>
<p>I tested this by installing locally with <code>pip install git+https://github.com/calumy/pygments.git@add-pyi-short-name</code> (sorry, I have not had a chance to use UV yet). Then running <code>mkdocs serve -f mkdocs.public.yml</code> and checking one of the updated pyi docs, e.g. http://127.0.0.1:8000/ruff/rules/unprefixed-type-param/. Which resulted in the following:
<img src="https://github.com/user-attachments/assets/84a59f62-6682-42a6-bbde-a6e62093fd70" alt="image" /></p>
<p>Do you know of any other places where <code>.pyi</code> file syntax highlighting is missing that would be a blocker?</p>
<p>Should I draft until the next release of pygments or would you consider pinning to a commit of pygments in the requirements? If so, which requirements file would be best for this, as there appear to be a couple in the docs directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-27 21:57</div>
            <div class="timeline-body"><blockquote>
<p>Hopefully, the lack of highlighting of <code>.pyi</code> files should be fixed with <a href="https://github.com/pygments/pygments/pull/2773">this PR</a> and a subsequent release of pygments.</p>
</blockquote>
<p>Woah, nice! Thanks so much for figuring out the root cause there and filing a PR to solve it ‚Äî that's awesome üòÉ</p>
<p>(It's late here so I'll get to your other questions tomorrow :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @dhruvmanila on 2024-08-28 05:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2024-08-28 11:54</div>
            <div class="timeline-body"><p>https://github.com/pygments/pygments/pull/2773 has been merged and added to the next release milestone. I am unsure of the schedule of the next release of pygments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-28 11:57</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/pygments/pygments/pull/2773">pygments/pygments#2773</a> has been merged and added to the next release milestone.</p>
</blockquote>
<p>I saw! I'm currently looking into whether it's feasible for us to pin pygments to a commit on their <code>main</code> branch -- if so, we can land this immediately. If not, we'll need to wait. I'll get back to you soon.</p>
<p>If we do need to wait, we should pick up the latest release of pygments in CI as soon as it's released. The depdendency comes from <code>mkdocs-material</code>'s <code>pyproject.toml</code> file here: https://github.com/squidfunk/mkdocs-material/blob/6f3c05b6fa7e42279ea7604aedc4e4333131fe57/requirements.txt#L26. And the dependency is permissive enough that it should allow <code>pygments==2.19.0</code> as soon as it's released.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-28 12:11</div>
            <div class="timeline-body"><p>I think pinning to a <code>main</code> branch commit works -- I pushed the new pins to this branch, so we should be good to go. Thanks again for this -- really great contribution üòÉ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Format `PYI` files in docs correctly" to "Format `PYI` examples in docs as `.pyi`-file snippets" by @AlexWaygood on 2024-08-28 12:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2024-08-28 12:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-08-28 12:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 21:39:02 UTC
    </footer>
</body>
</html>
