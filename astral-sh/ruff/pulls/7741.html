<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix PLE251 rules with f-string escaping - astral-sh/ruff #7741</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix PLE251 rules with f-string escaping</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/7741">#7741</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-10-01 15:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p><strong>Summary</strong> The <code>value</code> of the <code>FStringMiddle</code> for <code>f&quot;&quot;&quot;}}ab&quot;&quot;&quot;</code> is <code>}ab</code>, i.e. the curly brace escaping is decoded. If we iterate over string this gives us false indices causing exploding fixes for PLE251 rules (PLE2510, PLE2512, PLE2513, PLE2514, PLE2515). Instead, we now use the source range.</p>
<p>Handles https://github.com/astral-sh/ruff/issues/7455#issuecomment-1741998106
Handles https://github.com/astral-sh/ruff/issues/7455#issuecomment-1741998256</p>
<p><strong>Test Plan</strong> Minimized fuzzing cases as fixtures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2023-10-01 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-10-01 15:52</div>
            <div class="timeline-body"><h2>PR Check Results</h2>
<h3>Ecosystem</h3>
<p>âœ… ecosystem check detected no changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-01 17:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ruff_linter/src/rules/pylint/rules/invalid_string_characters.rs</code>:185 on 2023-10-01 17:59</div>
            <div class="timeline-body"><p>Nit: this can be <code>locator.slice(range)</code>, right? So perhaps the above should just be changed to <code>Tok::String { .. } | Tok::FStringMiddle { .. } =&gt; ...</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-10-01 17:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_linter/src/rules/pylint/rules/invalid_string_characters.rs</code>:185 on 2023-10-01 18:07</div>
            <div class="timeline-body"><p>Yes, this is correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> reviewed on 2023-10-01 18:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2023-10-01 18:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-10-01 18:08</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-10-02 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-10-02 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-10-02 08:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:00:37 UTC
    </footer>
</body>
</html>
