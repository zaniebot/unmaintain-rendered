<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Sync vendored typeshed stubs - astral-sh/ruff #20031</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Sync vendored typeshed stubs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20031">#20031</a>
        opened by <a href="https://github.com/github-actions">@github-actions</a>
        on 2025-08-21 19:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/github-actions">@github-actions</a></div>
            <div class="timeline-body"><p>Close and reopen this PR to trigger CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:22</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/d4f39b27a4a47aac8b6d4019e1b0b5b3156fabdc/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2025-08-21 21:30:47.762457018 +0000
+++ new-output.txt	2025-08-21 21:30:50.262467550 +0000
@@ -1,5 +1,5 @@
 WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
-fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(bc7d)): execute: too many cycle iterations`
+fatal[panic] Panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/execute.rs:228:25 when checking `/home/runner/work/ruff/ruff/typing/conformance/tests/aliases_typealiastype.py`: `infer_definition_types(Id(bcb1)): execute: too many cycle iterations`
 _directives_deprecated_library.py:15:31: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `int`
 _directives_deprecated_library.py:30:26: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `str`
 _directives_deprecated_library.py:36:41: error[invalid-return-type] Function always implicitly returns `None`, which is not assignable to return type `Self@__add__`
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 19:22</div>
            <div class="timeline-body"><p>The big change in this update is <a href="https://github.com/python/typeshed/pull/14583">python/typeshed#14583</a>, which changes the definition of <code>Generic</code> from <code>Generic: _SpecialForm</code> to <code>Generic: type[_Generic]</code>, making it more accurate with respect to the definition of <code>Generic</code> at runtime but requiring a couple of changes from us in <code>infer.rs</code> and <code>special_form.rs</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-08-21 19:24</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>parso (https://github.com/davidhalter/parso)
- parso/tree.py:1:33: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
- parso/tree.py:136:6: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
+ parso/tree.py:1:33: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.
+ parso/tree.py:136:6: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.
- parso/tree.py:144:6: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
+ parso/tree.py:144:6: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.

comtypes (https://github.com/enthought/comtypes)
- comtypes/test/__init__.py:137:21: warning[deprecated] The function `makeSuite` is deprecated: Deprecated in Python 3.11; removal scheduled for Python 3.13
- comtypes/test/__init__.py:207:24: warning[deprecated] The function `makeSuite` is deprecated: Deprecated in Python 3.11; removal scheduled for Python 3.13
- Found 401 diagnostics
+ Found 399 diagnostics

dulwich (https://github.com/dulwich/dulwich)
- dulwich/porcelain.py:6354:25: warning[deprecated] The function `warn` is deprecated: Deprecated; use warning() instead.
+ dulwich/porcelain.py:6354:25: warning[deprecated] The function `warn` is deprecated: Deprecated since Python 3.3. Use `warning()` instead.

mongo-python-driver (https://github.com/mongodb/mongo-python-driver)
- bson/codec_options.py:63:10: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
- bson/codec_options.py:82:10: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
+ bson/codec_options.py:63:10: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.
+ bson/codec_options.py:82:10: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.

mkosi (https://github.com/systemd/mkosi)
- mkosi/documentation.py:32:29: warning[deprecated] The function `warn` is deprecated: Deprecated; use warning() instead.
+ mkosi/documentation.py:32:29: warning[deprecated] The function `warn` is deprecated: Deprecated since Python 3.3. Use `warning()` instead.

mkdocs (https://github.com/mkdocs/mkdocs)
- mkdocs/tests/__init__.py:4:37: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 181 diagnostics
+ Found 180 diagnostics

vision (https://github.com/pytorch/vision)
- test/datasets_utils.py:1043:9: error[invalid-assignment] Object of type `LiteralString` is not assignable to `tuple[str, ...]`
+ test/datasets_utils.py:1043:9: error[invalid-assignment] Object of type `Literal[&quot;abcdefghijklmnopqrstuvwxyz&quot;]` is not assignable to `tuple[str, ...]`

psycopg (https://github.com/psycopg/psycopg)
+ tests/types/test_uuid.py:62:34: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 641 diagnostics
+ Found 642 diagnostics

static-frame (https://github.com/static-frame/static-frame)
+ static_frame/core/series_mapping.py:21:48: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ static_frame/core/series_mapping.py:26:43: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
+ static_frame/core/series_mapping.py:32:51: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 1779 diagnostics
+ Found 1782 diagnostics

materialize (https://github.com/MaterializeInc/materialize)
- misc/python/materialize/parallel_workload/action.py:80:46: warning[deprecated] The function `getName` is deprecated: Use the name attribute instead
+ misc/python/materialize/parallel_workload/action.py:80:46: warning[deprecated] The function `getName` is deprecated: Deprecated since Python 3.10. Read the `name` attribute instead.
- misc/python/materialize/parallel_workload/action.py:1741:40: warning[deprecated] The function `getName` is deprecated: Use the name attribute instead
+ misc/python/materialize/parallel_workload/action.py:1741:40: warning[deprecated] The function `getName` is deprecated: Deprecated since Python 3.10. Read the `name` attribute instead.
- misc/python/materialize/parallel_workload/executor.py:109:50: warning[deprecated] The function `getName` is deprecated: Use the name attribute instead
+ misc/python/materialize/parallel_workload/executor.py:109:50: warning[deprecated] The function `getName` is deprecated: Deprecated since Python 3.10. Read the `name` attribute instead.
- misc/python/materialize/parallel_workload/worker.py:131:62: warning[deprecated] The function `getName` is deprecated: Use the name attribute instead
+ misc/python/materialize/parallel_workload/worker.py:131:62: warning[deprecated] The function `getName` is deprecated: Deprecated since Python 3.10. Read the `name` attribute instead.
- test/rtr-combined/mzcompose.py:67:54: warning[deprecated] The function `getName` is deprecated: Use the name attribute instead
+ test/rtr-combined/mzcompose.py:67:54: warning[deprecated] The function `getName` is deprecated: Deprecated since Python 3.10. Read the `name` attribute instead.

prefect (https://github.com/PrefectHQ/prefect)
- src/prefect/results.py:142:9: error[invalid-assignment] Object of type `(@Todo(Inference of subscript on special form) &amp; Block) | (UUID &amp; Block) | (Path &amp; Block)` is not assignable to `WritableFileSystem`
- src/prefect/results.py:179:9: error[invalid-assignment] Object of type `(@Todo(Inference of subscript on special form) &amp; Block) | (UUID &amp; Block) | (Path &amp; Block)` is not assignable to `WritableFileSystem`
- Found 2951 diagnostics
+ Found 2949 diagnostics

meson (https://github.com/mesonbuild/meson)
- mesonbuild/build.py:534:10: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
+ mesonbuild/build.py:534:10: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.
- mesonbuild/linkers/linkers.py:126:10: warning[deprecated] The class `abstractproperty` is deprecated: Use &#x27;property&#x27; with &#x27;abstractmethod&#x27; instead
+ mesonbuild/linkers/linkers.py:126:10: warning[deprecated] The class `abstractproperty` is deprecated: Deprecated since Python 3.3. Use `@property` stacked on top of `@abstractmethod` instead.

sympy (https://github.com/sympy/sympy)
- sympy/testing/runtests.py:1176:28: warning[deprecated] The class `Str` is deprecated: Replaced by ast.Constant; removed in Python 3.14
+ sympy/testing/runtests.py:1176:28: warning[deprecated] The class `Str` is deprecated: Removed in Python 3.14. Use `ast.Constant` instead.
- sympy/testing/runtests.py:1195:33: warning[deprecated] The class `Str` is deprecated: Replaced by ast.Constant; removed in Python 3.14
+ sympy/testing/runtests.py:1195:33: warning[deprecated] The class `Str` is deprecated: Removed in Python 3.14. Use `ast.Constant` instead.

</code></pre>

No memory usage changes detected ‚úÖ

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-08-21 19:31</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/ruff/branches/typeshedbot%2Fsync-typeshed?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #20031 will <strong>degrade performances by 5.32%</strong>
<p>Comparing <code>typeshedbot/sync-typeshed</code> (123e5b5) with <code>main</code> (f82025d)</p>
Summary
<p><code>‚ùå 1 (üëÅ 1)</code> regressions<br>
<code>‚úÖ 41</code> untouched benchmarks</p>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| üëÅ | <code>ty_micro[many_string_assignments]</code> | 67.9 ms | 71.7 ms | -5.32% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 19:54</div>
            <div class="timeline-body"><p>it&#x27;s still not totally clear to me why <a href="https://github.com/astral-sh/ruff/pull/20031">astral-sh/ruff#20031</a>/commits/daeb839f59324d11db156b6eb19edc2c580441b2 leads to that much of a slowdown on the <code>many_string_assignments</code> microbenchmark... but it <em>is</em> a microbenchmark rather than realistic code, and I can&#x27;t find any obvious ways of speeding it up (from playing around with it locally)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/special_form.rs</code>:159 on 2025-08-21 20:41</div>
            <div class="timeline-body"><p>I do see that a number of our benchmarks (including tomllib) have a 1% regression from this PR, so it&#x27;s not <em>just</em> the one micro-benchmark (although clearly it&#x27;s much worse there.)</p>
<p>I suspect the reason for the regression is that there are some cases where we fall back to <code>KnownClass::Type</code> instead of to <code>KnownClass::SpecialForm</code> now, and that&#x27;s more expensive?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:4685 on 2025-08-21 20:42</div>
            <div class="timeline-body"><p>We now call <code>SpecialFormType::try_from_file_and_name</code> on literally every single annotated assignment to a Name target -- that&#x27;s a lot of annotated assignments. <code>try_from_file_and_name</code> should usually be just a string compare, but that can add up? Is there any way we could filter out more of the cases here and see if that helps? Like, it now either needs to be a <code>KnownClass::SpecialForm</code> or a <code>SubclassOf</code> type?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2025-08-21 20:43</div>
            <div class="timeline-body"><p>If we can&#x27;t figure out the regression, we can land this, though it does seem unfortunate to eat ~1% based on a typeshed change that doesn&#x27;t really offer much user value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 20:48</div>
            <div class="timeline-body"><blockquote>
<p>If we can&#x27;t figure out the regression, we can land this, though it does seem unfortunate to eat ~1% based on a typeshed change that doesn&#x27;t really offer much user value.</p>
</blockquote>
<p>I think it will offer user value once we properly type check calls to <code>isinstance()</code> and <code>issubclass()</code> (currently we don&#x27;t because they&#x27;re annotated with recursive type aliases). It&#x27;s not uncommon to pass <code>Generic</code> as the second argument to <code>isinstance()</code> or <code>issubclass()</code> -- see <a href="https://github.com/python/typeshed/pull/14583">python/typeshed#14583</a>#issuecomment-3202421558 -- and this change means that we now understand that the symbol <code>Generic</code> is an instance of <code>type</code>, which means we&#x27;ll continue to accept it being passed as the second argument to those functions even after we start properly type-checking them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-21 20:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:4685 on 2025-08-21 20:52</div>
            <div class="timeline-body"><p>I tried something like that locally and it didn&#x27;t seem to help much, but let&#x27;s see what codspeed thinks about <a href="https://github.com/astral-sh/ruff/pull/20031">astral-sh/ruff#20031</a>/commits/59f1c72e4c513bb499560894199277a1f4d75c56</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-08-21 21:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/infer.rs</code>:4685 on 2025-08-21 21:28</div>
            <div class="timeline-body"><p>yeah, it&#x27;s not helping at all, and may even be hurting slightly, so I&#x27;ll revert it since it means more code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-21 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-21 21:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:17:56 UTC
    </footer>
</body>
</html>
