<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Fix `super()` with TypeVar-annotated `self` and `cls` parameter - astral-sh/ruff #22208</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Fix <code>super()</code> with TypeVar-annotated <code>self</code> and <code>cls</code> parameter</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22208">#22208</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-12-26 15:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>This PR fixes <code>super()</code> handling when the first parameter (<code>self</code> or <code>cls</code>) is annotated with a TypeVar, like <code>Self</code>.</p>
<p>Previously, <code>super()</code> would incorrectly resolve TypeVars to their bounds before creating the <code>BoundSuperType</code>. So if you had <code>self: Self</code> where <code>Self</code> is bounded by <code>Parent</code>, we&#x27;d process <code>Parent</code> as a <code>NominalInstance</code> and end up with <code>SuperOwnerKind::Instance(Parent)</code>.</p>
<p>As a result:</p>
<pre><code>class Parent:
    @classmethod
    def create(cls) -&gt; Self:
        return cls()

class Child(Parent):
    @classmethod
    def create(cls) -&gt; Self:
        return super().create()  # Error: Argument type `Self@create` does not satisfy upper bound `Parent`
</code></pre>
<p>We now track two additional variants on <code>SuperOwnerKind</code> for TypeVar owners:</p>
<ul>
<li><code>InstanceTypeVar</code>: for instance methods where self is a TypeVar (e.g., <code>self: Self</code>).</li>
<li><code>ClassTypeVar</code>: for classmethods where <code>cls</code> is a <code>TypeVar</code> wrapped in <code>type[...]</code> (e.g., <code>cls: type[Self]</code>).</li>
</ul>
<p>Closes <a href="https://github.com/astral-sh/ty/issues/2122">astral-sh/ty#2122</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-26 15:09</div>
            <div class="timeline-body">

Diagnostic diff on <a href="https://github.com/python/typing/tree/9f6d8ced7cd1c8d92687a4e9c96d7716452e471e/conformance">typing conformance tests</a>

Changes were detected when running ty on typing conformance tests

<pre><code>--- old-output.txt	2026-01-08 00:47:54.303348418 +0000
+++ new-output.txt	2026-01-08 00:47:54.651349892 +0000
@@ -210,7 +210,7 @@
 constructors_call_init.py:130:9: error[too-many-positional-arguments] Too many positional arguments to bound method `__init__`: expected 1, got 2
 constructors_call_metaclass.py:39:1: error[type-assertion-failure] Type `int | Meta2` does not match asserted type `Class2`
 constructors_call_metaclass.py:39:13: error[missing-argument] No argument provided for required parameter `x` of function `__new__`
-constructors_call_metaclass.py:46:16: error[invalid-super-argument] `T@__call__` is not an instance or subclass of `&lt;class &#x27;Meta3&#x27;&gt;` in `super(&lt;class &#x27;Meta3&#x27;&gt;, T@__call__)` call
+constructors_call_metaclass.py:46:16: error[invalid-super-argument] `type[T@__call__]` is not an instance or subclass of `&lt;class &#x27;Meta3&#x27;&gt;` in `super(&lt;class &#x27;Meta3&#x27;&gt;, type[T@__call__])` call
 constructors_call_metaclass.py:54:1: error[missing-argument] No argument provided for required parameter `x` of function `__new__`
 constructors_call_metaclass.py:68:1: error[missing-argument] No argument provided for required parameter `x` of function `__new__`
 constructors_call_new.py:21:13: error[invalid-argument-type] Argument to function `__new__` is incorrect: Expected `int`, found `float`

</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-26 15:10</div>
            <div class="timeline-body">

<code>mypy_primer</code> results

Changes were detected when running on open source projects

<pre><code>attrs (https://github.com/python-attrs/attrs)
- tests/test_slots.py:985:24: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;B&#x27;&gt;, B&gt;` has no attribute `__getattr__`
+ tests/test_slots.py:985:24: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;B&#x27;&gt;, Self@__getattr__&gt;` has no attribute `__getattr__`

python-chess (https://github.com/niklasf/python-chess)
- chess/__init__.py:3962:16: error[invalid-return-type] Return type does not match returned value: expected `Self@copy`, found `Board`
- chess/variant.py:808:16: error[invalid-return-type] Return type does not match returned value: expected `Self@copy`, found `ThreeCheckBoard`
- chess/variant.py:814:20: error[invalid-return-type] Return type does not match returned value: expected `Self@root`, found `ThreeCheckBoard`
- chess/variant.py:822:16: error[invalid-return-type] Return type does not match returned value: expected `Self@mirror`, found `ThreeCheckBoard`
- chess/variant.py:1061:16: error[invalid-return-type] Return type does not match returned value: expected `Self@copy`, found `CrazyhouseBoard`
- chess/variant.py:1067:20: error[invalid-return-type] Return type does not match returned value: expected `Self@root`, found `CrazyhouseBoard`
- chess/variant.py:1075:16: error[invalid-return-type] Return type does not match returned value: expected `Self@mirror`, found `CrazyhouseBoard`
- Found 12 diagnostics
+ Found 5 diagnostics

beartype (https://github.com/beartype/beartype)
+ beartype/typing/_typingpep544.py:520:31: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;Protocol&#x27;&gt;, type[Self@__class_getitem__]&gt;` has no attribute `__class_getitem__`
- Found 497 diagnostics
+ Found 498 diagnostics

scrapy (https://github.com/scrapy/scrapy)
- scrapy/spiders/crawl.py:219:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_crawler`, found `CrawlSpider`
- scrapy/spiders/sitemap.py:45:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_crawler`, found `SitemapSpider`
- scrapy/utils/testsite.py:18:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SiteTest&#x27;&gt;, SiteTest&gt;` has no attribute `setUp`
+ scrapy/utils/testsite.py:18:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SiteTest&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- scrapy/utils/testsite.py:23:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SiteTest&#x27;&gt;, SiteTest&gt;` has no attribute `tearDown`
+ scrapy/utils/testsite.py:23:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SiteTest&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/test_dupefilters.py:33:9: error[unresolved-attribute] Unresolved attribute `method` on type `FromCrawlerRFPDupeFilter`.
+ tests/test_dupefilters.py:33:9: error[unresolved-attribute] Unresolved attribute `method` on type `Self@from_crawler`.
- tests/test_pipeline_media.py:179:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MockedMediaPipeline&#x27;&gt;, MockedMediaPipeline&gt;` has no attribute `download`
+ tests/test_pipeline_media.py:179:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MockedMediaPipeline&#x27;&gt;, Self@download&gt;` has no attribute `download`
- tests/test_pipeline_media.py:455:17: error[unresolved-attribute] Unresolved attribute `store_uri` on type `Pipeline`.
+ tests/test_pipeline_media.py:455:17: error[unresolved-attribute] Unresolved attribute `store_uri` on type `Self@from_crawler`.
- Found 1784 diagnostics
+ Found 1782 diagnostics

pytest (https://github.com/pytest-dev/pytest)
- src/_pytest/doctest.py:282:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_parent`, found `DoctestItem`
- src/_pytest/main.py:549:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_parent`, found `Dir`
- src/_pytest/nodes.py:627:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_parent`, found `FSCollector`
- src/_pytest/python.py:752:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_parent`, found `Class`
- src/_pytest/python.py:1639:16: error[invalid-return-type] Return type does not match returned value: expected `Self@from_parent`, found `Function`
- src/_pytest/subtests.py:132:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_new`, found `SubtestReport`
- Found 433 diagnostics
+ Found 427 diagnostics

PyGithub (https://github.com/PyGithub/PyGithub)
+ github/GithubRetry.py:90:35: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- Found 298 diagnostics
+ Found 299 diagnostics

schemathesis (https://github.com/schemathesis/schemathesis)
- src/schemathesis/generation/stateful/state_machine.py:200:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;APIStateMachine&#x27;&gt;, APIStateMachine&gt;` has no attribute `_add_result_to_targets`
+ src/schemathesis/generation/stateful/state_machine.py:200:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;APIStateMachine&#x27;&gt;, Self@_add_result_to_targets&gt;` has no attribute `_add_result_to_targets`

Tanjun (https://github.com/FasterSpeeding/Tanjun)
- tanjun/commands/slash.py:1065:16: error[invalid-return-type] Return type does not match returned value: expected `Self@copy`, found `BaseSlashCommand`
- tanjun/commands/slash.py:1233:16: error[invalid-return-type] Return type does not match returned value: expected `Self@copy`, found `SlashCommandGroup`
- Found 136 diagnostics
+ Found 134 diagnostics

zope.interface (https://github.com/zopefoundation/zope.interface)
- src/zope/interface/adapter.py:769:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;AdapterLookupBase&#x27;&gt;, AdapterLookupBase&gt;` has no attribute `changed`
+ src/zope/interface/adapter.py:769:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;AdapterLookupBase&#x27;&gt;, Self@changed&gt;` has no attribute `changed`

discord.py (https://github.com/Rapptz/discord.py)
- discord/ui/modal.py:273:16: error[invalid-return-type] Return type does not match returned value: expected `Self@add_item`, found `Modal`
- Found 552 diagnostics
+ Found 551 diagnostics

xarray (https://github.com/pydata/xarray)
- xarray/core/dataset.py:409:16: error[invalid-return-type] Return type does not match returned value: expected `Self@__eq__`, found `Dataset`
+ xarray/core/datatree.py:550:37: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `Mapping[str, Self@__init__] | None`, found `Mapping[str, DataTree] | None`
- xarray/core/datatree.py:921:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_copy_node`, found `DataTree`
- xarray/core/datatree.py:1938:16: error[invalid-return-type] Return type does not match returned value: expected `Self@__eq__`, found `DataTree`
- xarray/core/treenode.py:729:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_copy_node`, found `NamedNode`
- xarray/core/variable.py:2729:16: error[invalid-return-type] Return type does not match returned value: expected `Self@chunk`, found `Variable`
- Found 1765 diagnostics
+ Found 1761 diagnostics

setuptools (https://github.com/pypa/setuptools)
- setuptools/__init__.py:71:30: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MinimalDistribution&#x27;&gt;, MinimalDistribution&gt;` has no attribute `_split_standard_project_metadata`
+ setuptools/__init__.py:71:30: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MinimalDistribution&#x27;&gt;, Self@_get_project_config_files&gt;` has no attribute `_split_standard_project_metadata`
- setuptools/_vendor/zipp/__init__.py:95:41: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SanitizedNames&#x27;&gt;, SanitizedNames&gt;` has no attribute `namelist`
+ setuptools/_vendor/zipp/__init__.py:95:41: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SanitizedNames&#x27;&gt;, Self@namelist&gt;` has no attribute `namelist`
- setuptools/command/sdist.py:114:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;sdist&#x27;&gt;, sdist&gt;` has no attribute `_add_defaults_optional`
+ setuptools/command/sdist.py:114:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;sdist&#x27;&gt;, Self@_add_defaults_optional&gt;` has no attribute `_add_defaults_optional`
- setuptools/command/sdist.py:158:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;sdist&#x27;&gt;, sdist&gt;` has no attribute `_add_defaults_data_files`
+ setuptools/command/sdist.py:158:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;sdist&#x27;&gt;, Self@_add_defaults_data_files&gt;` has no attribute `_add_defaults_data_files`
- setuptools/config/pyprojecttoml.py:441:16: error[invalid-return-type] Return type does not match returned value: expected `Self@__enter__`, found `_EnsurePackagesDiscovered`
- Found 1274 diagnostics
+ Found 1273 diagnostics

scikit-build-core (https://github.com/scikit-build/scikit-build-core)
+ src/scikit_build_core/build/wheel.py:98:20: error[no-matching-overload] No overload of bound method `__init__` matches arguments
- Found 47 diagnostics
+ Found 48 diagnostics

prefect (https://github.com/PrefectHQ/prefect)
- src/integrations/prefect-aws/prefect_aws/workers/ecs_worker.py:1615:16: error[invalid-return-type] Return type does not match returned value: expected `Self@__aenter__`, found `ECSWorker`
- src/integrations/prefect-dbt/prefect_dbt/core/settings.py:94:28: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/integrations/prefect-dbt/prefect_dbt/core/settings.py:94:28: error[invalid-assignment] Object of type `T@resolve_block_document_references | int | dict[str, Any] | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/integrations/prefect-dbt/prefect_dbt/core/settings.py:99:28: error[invalid-assignment] Object of type `T@resolve_variables | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/integrations/prefect-dbt/prefect_dbt/core/settings.py:99:28: error[invalid-assignment] Object of type `int | T@resolve_variables | float | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/_internal/_logging.py:31:16: error[invalid-return-type] Return type does not match returned value: expected `Self@getChild`, found `SafeLogger`
- src/prefect/blocks/core.py:1641:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `Block`
- src/prefect/cli/deploy/_core.py:86:21: error[invalid-assignment] Object of type `T@resolve_block_document_references | dict[str, Any]` is not assignable to `dict[str, Any]`
+ src/prefect/cli/deploy/_core.py:86:21: error[invalid-assignment] Object of type `T@resolve_block_document_references | int | dict[str, Any] | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/cli/deploy/_core.py:87:21: error[invalid-assignment] Object of type `T@resolve_variables` is not assignable to `dict[str, Any]`
+ src/prefect/cli/deploy/_core.py:87:21: error[invalid-assignment] Object of type `int | T@resolve_variables | float | ... omitted 4 union elements` is not assignable to `dict[str, Any]`
- src/prefect/context.py:217:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_copy`, found `ContextModel`
- src/prefect/context.py:265:20: error[invalid-return-type] Return type does not match returned value: expected `Self@__enter__`, found `SyncClientContext`
- src/prefect/context.py:323:20: error[invalid-return-type] Return type does not match returned value: expected `Self@__aenter__`, found `AsyncClientContext`
- src/prefect/deployments/runner.py:795:70: warning[possibly-missing-attribute] Attribute `__name__` may be missing on object of type `Unknown | ((...) -&gt; Any)`
+ src/prefect/deployments/runner.py:795:70: warning[possibly-missing-attribute] Attribute `__name__` may be missing on object of type `Unknown | (((...) -&gt; Any) &amp; ((*args: object, **kwargs: object) -&gt; object))`
- src/prefect/deployments/steps/core.py:137:38: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any]`
+ src/prefect/deployments/steps/core.py:137:38: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | int | dict[str, Any] | ... omitted 4 union elements`
- src/prefect/events/worker.py:130:16: error[invalid-return-type] Return type does not match returned value: expected `Self@instance`, found `EventsWorker`
- src/prefect/flow_engine.py:812:32: error[invalid-await] `Unknown | R@FlowRunEngine | Coroutine[Any, Any, R@FlowRunEngine]` is not awaitable
- src/prefect/flow_engine.py:1401:24: error[invalid-await] `Unknown | R@AsyncFlowRunEngine | Coroutine[Any, Any, R@AsyncFlowRunEngine]` is not awaitable
- src/prefect/flow_engine.py:1482:43: error[invalid-argument-type] Argument to function `next` is incorrect: Expected `SupportsNext[Unknown]`, found `Unknown | R@run_generator_flow_sync`
- src/prefect/flow_engine.py:1490:21: warning[possibly-missing-attribute] Attribute `throw` may be missing on object of type `Unknown | R@run_generator_flow_sync`
- src/prefect/flow_engine.py:1524:44: warning[possibly-missing-attribute] Attribute `__anext__` may be missing on object of type `Unknown | R@run_generator_flow_async`
- src/prefect/flow_engine.py:1531:25: warning[possibly-missing-attribute] Attribute `throw` may be missing on object of type `Unknown | R@run_generator_flow_async`
- src/prefect/flows.py:286:34: error[unresolved-attribute] Object of type `(**P@Flow) -&gt; R@Flow` has no attribute `__name__`
+ src/prefect/flows.py:286:34: error[unresolved-attribute] Object of type `((**P@Flow) -&gt; R@Flow) &amp; ((*args: object, **kwargs: object) -&gt; object)` has no attribute `__name__`
- src/prefect/flows.py:404:68: error[unresolved-attribute] Object of type `(**P@Flow) -&gt; R@Flow` has no attribute `__name__`
+ src/prefect/flows.py:404:68: error[unresolved-attribute] Object of type `((**P@Flow) -&gt; R@Flow) &amp; ((*args: object, **kwargs: object) -&gt; object)` has no attribute `__name__`
+ src/prefect/flows.py:1750:53: warning[unused-ignore-comment] Unused blanket `type: ignore` directive
- src/prefect/logging/handlers.py:92:16: error[invalid-return-type] Return type does not match returned value: expected `Self@instance`, found `APILogWorker`
- src/prefect/server/events/schemas/automations.py:623:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `Automation`
- src/prefect/server/orchestration/rules.py:353:16: error[invalid-return-type] Return type does not match returned value: expected `Self@safe_copy`, found `FlowOrchestrationContext`
- src/prefect/server/orchestration/rules.py:514:16: error[invalid-return-type] Return type does not match returned value: expected `Self@safe_copy`, found `TaskOrchestrationContext`
- src/prefect/server/schemas/core.py:1162:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `WorkPool`
- src/prefect/server/schemas/responses.py:330:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `FlowRunResponse`
- src/prefect/server/schemas/responses.py:524:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `DeploymentResponse`
- src/prefect/server/schemas/responses.py:553:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `WorkQueueResponse`
- src/prefect/server/schemas/responses.py:598:16: error[invalid-return-type] Return type does not match returned value: expected `Self@model_validate`, found `WorkerResponse`
- src/prefect/utilities/templating.py:320:13: error[invalid-assignment] Invalid subscript assignment with key of type `object` and value of type `T@resolve_block_document_references | dict[str, Any]` on object of type `dict[str, Any]`
+ src/prefect/utilities/templating.py:320:13: error[invalid-assignment] Invalid subscript assignment with key of type `object` and value of type `T@resolve_block_document_references | int | dict[str, Any] | ... omitted 4 union elements` on object of type `dict[str, Any]`
- src/prefect/utilities/templating.py:323:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_block_document_references | dict[str, Any]`, found `list[T@resolve_block_document_references | dict[str, Any] | Unknown]`
+ src/prefect/utilities/templating.py:323:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_block_document_references | dict[str, Any]`, found `list[T@resolve_block_document_references | int | dict[str, Any] | ... omitted 5 union elements]`
- src/prefect/utilities/templating.py:437:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `dict[object, T@resolve_variables | Unknown]`
+ src/prefect/utilities/templating.py:437:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `dict[object, int | T@resolve_variables | float | ... omitted 5 union elements]`
- src/prefect/utilities/templating.py:442:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `list[T@resolve_variables | Unknown]`
+ src/prefect/utilities/templating.py:442:16: error[invalid-return-type] Return type does not match returned value: expected `T@resolve_variables`, found `list[int | T@resolve_variables | float | ... omitted 5 union elements]`
- src/prefect/workers/base.py:232:13: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | dict[str, Any]`
+ src/prefect/workers/base.py:232:13: error[invalid-argument-type] Argument is incorrect: Expected `T@resolve_variables`, found `T@resolve_block_document_references | int | dict[str, Any] | ... omitted 4 union elements`
- src/prefect/workers/base.py:234:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `T@resolve_variables`
+ src/prefect/workers/base.py:234:20: error[invalid-argument-type] Argument expression after ** must be a mapping type: Found `int | T@resolve_variables | float | ... omitted 4 union elements`
- Found 5382 diagnostics
+ Found 5361 diagnostics

dd-trace-py (https://github.com/DataDog/dd-trace-py)
- ddtrace/contrib/internal/gevent/greenlet.py:21:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;TracingMixin&#x27;&gt;, TracingMixin&gt;` has no attribute `run`
+ ddtrace/contrib/internal/gevent/greenlet.py:21:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;TracingMixin&#x27;&gt;, Self@run&gt;` has no attribute `run`
- ddtrace/internal/http.py:37:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;HTTPConnectionMixin&#x27;&gt;, HTTPConnectionMixin&gt;` has no attribute `request`
+ ddtrace/internal/http.py:37:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;HTTPConnectionMixin&#x27;&gt;, Self@request&gt;` has no attribute `request`
- tests/contrib/httplib/test_httplib.py:41:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;HTTPLibBaseMixin&#x27;&gt;, HTTPLibBaseMixin&gt;` has no attribute `setUp`
+ tests/contrib/httplib/test_httplib.py:41:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;HTTPLibBaseMixin&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- tests/contrib/httplib/test_httplib.py:49:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;HTTPLibBaseMixin&#x27;&gt;, HTTPLibBaseMixin&gt;` has no attribute `tearDown`
+ tests/contrib/httplib/test_httplib.py:49:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;HTTPLibBaseMixin&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/contrib/mysql/test_mysql.py:23:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCore&#x27;&gt;, MySQLCore&gt;` has no attribute `tearDown`
+ tests/contrib/mysql/test_mysql.py:23:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCore&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/contrib/mysqldb/test_mysqldb.py:26:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCore&#x27;&gt;, MySQLCore&gt;` has no attribute `setUp`
+ tests/contrib/mysqldb/test_mysqldb.py:26:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCore&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- tests/contrib/mysqldb/test_mysqldb.py:31:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCore&#x27;&gt;, MySQLCore&gt;` has no attribute `tearDown`
+ tests/contrib/mysqldb/test_mysqldb.py:31:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCore&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/contrib/pymysql/test_pymysql.py:36:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyMySQLCore&#x27;&gt;, PyMySQLCore&gt;` has no attribute `setUp`
+ tests/contrib/pymysql/test_pymysql.py:36:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyMySQLCore&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- tests/contrib/pymysql/test_pymysql.py:40:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyMySQLCore&#x27;&gt;, PyMySQLCore&gt;` has no attribute `tearDown`
+ tests/contrib/pymysql/test_pymysql.py:40:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyMySQLCore&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/contrib/pyodbc/test_pyodbc.py:20:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyODBCTest&#x27;&gt;, PyODBCTest&gt;` has no attribute `setUp`
+ tests/contrib/pyodbc/test_pyodbc.py:20:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyODBCTest&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- tests/contrib/pyodbc/test_pyodbc.py:24:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyODBCTest&#x27;&gt;, PyODBCTest&gt;` has no attribute `tearDown`
+ tests/contrib/pyodbc/test_pyodbc.py:24:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PyODBCTest&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/contrib/requests/test_requests.py:40:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;BaseRequestTestCase&#x27;&gt;, BaseRequestTestCase&gt;` has no attribute `setUp`
+ tests/contrib/requests/test_requests.py:40:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;BaseRequestTestCase&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- tests/contrib/requests/test_requests.py:49:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;BaseRequestTestCase&#x27;&gt;, BaseRequestTestCase&gt;` has no attribute `tearDown`
+ tests/contrib/requests/test_requests.py:49:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;BaseRequestTestCase&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`
- tests/contrib/sqlalchemy/mixins.py:54:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SQLAlchemyTestBase&#x27;&gt;, SQLAlchemyTestBase&gt;` has no attribute `setUp`
+ tests/contrib/sqlalchemy/mixins.py:54:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SQLAlchemyTestBase&#x27;&gt;, Self@setUp&gt;` has no attribute `setUp`
- tests/contrib/sqlalchemy/mixins.py:73:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SQLAlchemyTestBase&#x27;&gt;, SQLAlchemyTestBase&gt;` has no attribute `tearDown`
+ tests/contrib/sqlalchemy/mixins.py:73:9: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SQLAlchemyTestBase&#x27;&gt;, Self@tearDown&gt;` has no attribute `tearDown`

altair (https://github.com/vega/altair)
- altair/utils/schemapi.py:1155:28: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SchemaBase&#x27;&gt;, SchemaBase&gt;` has no attribute `__getattr__`
+ altair/utils/schemapi.py:1155:28: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;SchemaBase&#x27;&gt;, Self@__getattr__&gt;` has no attribute `__getattr__`
- altair/vegalite/v6/api.py:4122:19: error[invalid-super-argument] `_TSchemaBase@from_dict` is not an instance or subclass of `&lt;class &#x27;Chart&#x27;&gt;` in `super(&lt;class &#x27;Chart&#x27;&gt;, _TSchemaBase@from_dict)` call
+ altair/vegalite/v6/api.py:4122:19: error[invalid-super-argument] `type[_TSchemaBase@from_dict]` is not an instance or subclass of `&lt;class &#x27;Chart&#x27;&gt;` in `super(&lt;class &#x27;Chart&#x27;&gt;, type[_TSchemaBase@from_dict])` call
- altair/vegalite/v6/schema/channels.py:224:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;FieldChannelMixin&#x27;&gt;, FieldChannelMixin&gt;` has no attribute `to_dict`
+ altair/vegalite/v6/schema/channels.py:224:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;FieldChannelMixin&#x27;&gt;, Self@to_dict&gt;` has no attribute `to_dict`
- altair/vegalite/v6/schema/channels.py:247:16: warning[possibly-missing-attribute] Attribute `to_dict` may be missing on object of type `&lt;super: &lt;class &#x27;ValueChannelMixin&#x27;&gt;, ValueChannelMixin&gt; | &lt;super: &lt;class &#x27;ValueChannelMixin&#x27;&gt;, Unknown&gt;`
+ altair/vegalite/v6/schema/channels.py:247:16: warning[possibly-missing-attribute] Attribute `to_dict` may be missing on object of type `&lt;super: &lt;class &#x27;ValueChannelMixin&#x27;&gt;, Self@to_dict&gt; | &lt;super: &lt;class &#x27;ValueChannelMixin&#x27;&gt;, Unknown&gt;`
- altair/vegalite/v6/schema/channels.py:265:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DatumChannelMixin&#x27;&gt;, DatumChannelMixin&gt;` has no attribute `to_dict`
+ altair/vegalite/v6/schema/channels.py:265:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DatumChannelMixin&#x27;&gt;, Self@to_dict&gt;` has no attribute `to_dict`

bokeh (https://github.com/bokeh/bokeh)
- src/bokeh/server/contexts.py:381:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_RequestProxy&#x27;&gt;, _RequestProxy&gt;` has no attribute `__getattr__`
+ src/bokeh/server/contexts.py:381:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_RequestProxy&#x27;&gt;, Self@__getattr__&gt;` has no attribute `__getattr__`

ibis (https://github.com/ibis-project/ibis)
- ibis/backends/sql/compilers/datafusion.py:540:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DataFusionCompiler&#x27;&gt;, DataFusionCompiler&gt;` has no attribute `visit_GroupConcat`
+ ibis/backends/sql/compilers/datafusion.py:540:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DataFusionCompiler&#x27;&gt;, Self@visit_GroupConcat&gt;` has no attribute `visit_GroupConcat`
- ibis/backends/sql/compilers/impala.py:273:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ImpalaCompiler&#x27;&gt;, ImpalaCompiler&gt;` has no attribute `visit_DateAdd`
- ibis/backends/sql/compilers/impala.py:284:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ImpalaCompiler&#x27;&gt;, ImpalaCompiler&gt;` has no attribute `visit_TimestampAdd`
+ ibis/backends/sql/compilers/impala.py:273:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ImpalaCompiler&#x27;&gt;, Self@visit_DateAdd&gt;` has no attribute `visit_DateAdd`
+ ibis/backends/sql/compilers/impala.py:284:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ImpalaCompiler&#x27;&gt;, Self@visit_TimestampAdd&gt;` has no attribute `visit_TimestampAdd`
- ibis/backends/sql/compilers/mysql.py:254:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCompiler&#x27;&gt;, MySQLCompiler&gt;` has no attribute `visit_Equals`
+ ibis/backends/sql/compilers/mysql.py:254:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MySQLCompiler&#x27;&gt;, Self@visit_Equals&gt;` has no attribute `visit_Equals`
- ibis/backends/sql/compilers/oracle.py:112:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;OracleCompiler&#x27;&gt;, OracleCompiler&gt;` has no attribute `visit_Equals`
+ ibis/backends/sql/compilers/oracle.py:112:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;OracleCompiler&#x27;&gt;, Self@visit_Equals&gt;` has no attribute `visit_Equals`
- ibis/backends/sql/compilers/postgres.py:525:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PostgresCompiler&#x27;&gt;, PostgresCompiler&gt;` has no attribute `visit_JSONGetItem`
+ ibis/backends/sql/compilers/postgres.py:525:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;PostgresCompiler&#x27;&gt;, Self@visit_JSONGetItem&gt;` has no attribute `visit_JSONGetItem`
- ibis/common/typing.py:243:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DefaultTypeVars&#x27;&gt;, &lt;class &#x27;DefaultTypeVars&#x27;&gt;&gt;` has no attribute `__class_getitem__`
+ ibis/common/typing.py:243:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DefaultTypeVars&#x27;&gt;, type[Self@__class_getitem__]&gt;` has no attribute `__class_getitem__`

sympy (https://github.com/sympy/sympy)
- sympy/diffgeom/diffgeom.py:2250:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_deprecated_container&#x27;&gt;, _deprecated_container&gt;` has no attribute `__iter__`
+ sympy/diffgeom/diffgeom.py:2250:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_deprecated_container&#x27;&gt;, Self@__iter__&gt;` has no attribute `__iter__`
- sympy/diffgeom/diffgeom.py:2254:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_deprecated_container&#x27;&gt;, _deprecated_container&gt;` has no attribute `__getitem__`
+ sympy/diffgeom/diffgeom.py:2254:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_deprecated_container&#x27;&gt;, Self@__getitem__&gt;` has no attribute `__getitem__`
- sympy/diffgeom/diffgeom.py:2258:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_deprecated_container&#x27;&gt;, _deprecated_container&gt;` has no attribute `__contains__`
+ sympy/diffgeom/diffgeom.py:2258:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_deprecated_container&#x27;&gt;, Self@__contains__&gt;` has no attribute `__contains__`
- sympy/functions/elementary/miscellaneous.py:639:22: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MinMaxBase&#x27;&gt;, MinMaxBase&gt;` has no attribute `fdiff`
+ sympy/functions/elementary/miscellaneous.py:639:22: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MinMaxBase&#x27;&gt;, Self@_eval_derivative&gt;` has no attribute `fdiff`
- sympy/matrices/expressions/matexpr.py:232:20: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MatrixExpr&#x27;&gt;, MatrixExpr&gt;` has no attribute `_eval_derivative`
+ sympy/matrices/expressions/matexpr.py:232:20: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MatrixExpr&#x27;&gt;, Self@_eval_derivative&gt;` has no attribute `_eval_derivative`

static-frame (https://github.com/static-frame/static-frame)
- static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Bus[Any] | TypeBlocks | Batch | ... omitted 6 union elements, object_]`
+ static_frame/core/bus.py:671:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemLocReduces[Bus[Any], object_]`, found `InterGetItemLocReduces[Bus[Any] | Bottom[Index[Any]] | Bottom[Series[Any, Any]] | ... omitted 6 union elements, object_]`
- static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any] | Bottom[Index[Any]] | TypeBlocks | ... omitted 6 union elements, TVDtype@Series]`
+ static_frame/core/series.py:772:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Series[Any, Any], TVDtype@Series]`, found `InterGetItemILocReduces[Series[Any, Any] | TypeBlocks | Batch | ... omitted 6 union elements, TVDtype@Series]`
- static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Bottom[Series[Any, Any]] | Bottom[Index[Any]] | TypeBlocks | ... omitted 7 union elements, TVDtype@SeriesHE]`
+ static_frame/core/series.py:4072:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[SeriesHE[Any, Any], TVDtype@SeriesHE]`, found `InterGetItemILocReduces[Bottom[Series[Any, Any]] | TypeBlocks | Batch | ... omitted 7 union elements, TVDtype@SeriesHE]`
- static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Yarn[Any] | Bottom[Index[Any]] | TypeBlocks | ... omitted 6 union elements, object_]`
+ static_frame/core/yarn.py:418:16: error[invalid-return-type] Return type does not match returned value: expected `InterGetItemILocReduces[Yarn[Any], object_]`, found `InterGetItemILocReduces[Yarn[Any] | TypeBlocks | Batch | ... omitted 6 union elements, object_]`

scikit-learn (https://github.com/scikit-learn/scikit-learn)
- sklearn/base.py:482:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;BaseEstimator&#x27;&gt;, BaseEstimator&gt;` has no attribute `__setstate__`
+ sklearn/base.py:482:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;BaseEstimator&#x27;&gt;, Self@__setstate__&gt;` has no attribute `__setstate__`
- sklearn/base.py:545:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ClassifierMixin&#x27;&gt;, ClassifierMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:545:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ClassifierMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:615:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;RegressorMixin&#x27;&gt;, RegressorMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:615:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;RegressorMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:688:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ClusterMixin&#x27;&gt;, ClusterMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:688:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;ClusterMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:858:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;TransformerMixin&#x27;&gt;, TransformerMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:858:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;TransformerMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:1039:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DensityMixin&#x27;&gt;, DensityMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:1039:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;DensityMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:1086:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;OutlierMixin&#x27;&gt;, OutlierMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:1086:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;OutlierMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:1178:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MultiOutputMixin&#x27;&gt;, MultiOutputMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:1178:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;MultiOutputMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/base.py:1187:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_UnstableArchMixin&#x27;&gt;, _UnstableArchMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/base.py:1187:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_UnstableArchMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`
- sklearn/ensemble/_hist_gradient_boosting/predictor.py:134:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;TreePredictor&#x27;&gt;, TreePredictor&gt;` has no attribute `__setstate__`
+ sklearn/ensemble/_hist_gradient_boosting/predictor.py:134:13: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;TreePredictor&#x27;&gt;, Self@__setstate__&gt;` has no attribute `__setstate__`
- sklearn/externals/_arff.py:521:21: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_DataListMixin&#x27;&gt;, _DataListMixin&gt;` has no attribute `decode_rows`
+ sklearn/externals/_arff.py:521:21: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_DataListMixin&#x27;&gt;, Self@decode_rows&gt;` has no attribute `decode_rows`
- sklearn/model_selection/_split.py:91:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_UnsupportedGroupCVMixin&#x27;&gt;, _UnsupportedGroupCVMixin&gt;` has no attribute `split`
+ sklearn/model_selection/_split.py:91:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_UnsupportedGroupCVMixin&#x27;&gt;, Self@split&gt;` has no attribute `split`
- sklearn/neighbors/_base.py:1395:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;RadiusNeighborsMixin&#x27;&gt;, RadiusNeighborsMixin&gt;` has no attribute `__sklearn_tags__`
+ sklearn/neighbors/_base.py:1395:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;RadiusNeighborsMixin&#x27;&gt;, Self@__sklearn_tags__&gt;` has no attribute `__sklearn_tags__`

pandas (https://github.com/pandas-dev/pandas)
- pandas/core/arrays/_mixins.py:246:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_concat_same_type`, found `NDArrayBackedExtensionArray`
- pandas/core/arrays/arrow/array.py:1371:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_pad_or_backfill`, found `ArrowExtensionArray`
- pandas/core/arrays/arrow/array.py:1386:20: error[invalid-return-type] Return type does not match returned value: expected `Self@fillna`, found `ArrowExtensionArray`
- pandas/core/arrays/arrow/array.py:1414:16: error[invalid-return-type] Return type does not match returned value: expected `Self@fillna`, found `ArrowExtensionArray`
- pandas/core/arrays/boolean.py:330:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_simple_new`, found `BooleanArray`
- pandas/core/arrays/categorical.py:385:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_simple_new`, found `Categorical`
- pandas/core/arrays/categorical.py:2567:16: error[invalid-return-type] Return type does not match returned value: expected `Self@unique`, found `Categorical`
- pandas/core/arrays/datetimelike.py:1588:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_quantile`, found `DatetimeLikeArrayMixin`
- pandas/core/arrays/datetimelike.py:2539:16: error[invalid-return-type] Return type does not match returned value: expected `Self@copy`, found `TimelikeOps`
- pandas/core/arrays/datetimelike.py:2598:16: error[invalid-return-type] Return type does not match returned value: expected `Self@take`, found `TimelikeOps`
- pandas/core/arrays/datetimes.py:335:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_simple_new`, found `DatetimeArray`
- pandas/core/arrays/numpy_.py:389:16: error[invalid-return-type] Return type does not match returned value: expected `Self@take`, found `NumpyExtensionArray`
- pandas/core/arrays/string_.py:601:16: error[invalid-return-type] Return type does not match returned value: expected `Self@view`, found `BaseStringArray`
- pandas/core/arrays/timedeltas.py:243:16: error[invalid-return-type] Return type does not match returned value: expected `Self@_simple_new`, found `TimedeltaArray`
- pandas/core/indexes/base.py:2906:16: error[invalid-return-type] Return type does not match returned value: expected `Self@drop_duplicates`, found `Index`
- pandas/core/indexes/datetimelike.py:928:16: error[invalid-return-type] Return type does not match returned value: expected `tuple[Self@_wrap_join_result, ndarray[tuple[Any, ...], dtype[signedinteger[_64Bit]]] | None, ndarray[tuple[Any, ...], dtype[signedinteger[_64Bit]]] | None]`, found `tuple[DatetimeTimedeltaMixin | Unknown, ndarray[tuple[Any, ...], dtype[signedinteger[_64Bit]]] | None, ndarray[tuple[Any, ...], dtype[signedinteger[_64Bit]]] | None]`
- pandas/core/indexes/datetimelike.py:1036:16: error[invalid-return-type] Return type does not match returned value: expected `Self@delete`, found `DatetimeTimedeltaMixin`
- pandas/core/indexes/range.py:815:20: error[invalid-return-type] Return type does not match returned value: expected `Self@sort_values | tuple[Self@sort_values, ndarray[tuple[Any, ...], dtype[Any]] | RangeIndex]`, found `RangeIndex | tuple[RangeIndex, ndarray[tuple[Any, ...], dtype[Any]]]`
- pandas/core/series.py:5542:16: error[invalid-return-type] Return type does not match returned value: expected `Self@rename_axis | None`, found `Series | None`
- Found 3785 diagnostics
+ Found 3766 diagnostics

rotki (https://github.com/rotki/rotki)
- rotkehlchen/db/filtering.py:1038:16: error[invalid-return-type] Return type does not match returned value: expected `Self@make`, found `HistoryEventWithTxRefFilterQuery`
- rotkehlchen/db/filtering.py:1147:16: error[invalid-return-type] Return type does not match returned value: expected `Self@make`, found `HistoryEventWithCounterpartyFilterQuery`
- rotkehlchen/db/filtering.py:1228:16: error[invalid-return-type] Return type does not match returned value: expected `Self@make`, found `SolanaEventFilterQuery`
- rotkehlchen/db/filtering.py:1343:16: error[invalid-return-type] Return type does not match returned value: expected `Self@make`, found `EvmEventFilterQuery`
- rotkehlchen/db/filtering.py:1440:16: error[invalid-return-type] Return type does not match returned value: expected `Self@make`, found `EthStakingEventFilterQuery`
- Found 2089 diagnostics
+ Found 2084 diagnostics

materialize (https://github.com/MaterializeInc/materialize)
- misc/python/materialize/mz_version.py:66:16: error[invalid-return-type] Return type does not match returned value: expected `T@parse`, found `TypedVersionBase`
- Found 311 diagnostics
+ Found 310 diagnostics

scipy (https://github.com/scipy/scipy)
- scipy/sparse/_matrix.py:146:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;spmatrix&#x27;&gt;, spmatrix&gt;` has no attribute `todense`
+ scipy/sparse/_matrix.py:146:16: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;spmatrix&#x27;&gt;, Self@todense&gt;` has no attribute `todense`
- scipy/sparse/tests/test_base.py:5709:21: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_NonCanonicalMixin&#x27;&gt;, _NonCanonicalMixin&gt;` has no attribute `spcreator`
+ scipy/sparse/tests/test_base.py:5709:21: error[unresolved-attribute] Object of type `&lt;super: &lt;class &#x27;_NonCanonicalMixin&#x27;&gt;, Self@spcreator&gt;` has no attribute `spcreator`


</code></pre>


<p>No memory usage changes detected </p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ecosystem-analyzer</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/dcreager">@dcreager</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-26 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astral-sh-bot[bot]">@astral-sh-bot[bot]</a> on 2025-12-26 15:16</div>
            <div class="timeline-body">

<code>ecosystem-analyzer</code> results
<p>| Lint rule | Added | Removed | Changed |
|-----------|------:|--------:|--------:|
| <code>invalid-return-type</code> | 1 | 64 | 1 |
| <code>unresolved-attribute</code> | 1 | 0 | 58 |
| <code>invalid-await</code> | 0 | 0 | 6 |
| <code>invalid-argument-type</code> | 3 | 1 | 0 |
| <code>unused-ignore-comment</code> | 2 | 2 | 0 |
| <code>invalid-super-argument</code> | 0 | 0 | 1 |
| <code>possibly-missing-attribute</code> | 0 | 0 | 1 |
| <strong>Total</strong> | <strong>7</strong> | <strong>67</strong> | <strong>67</strong> |</p>
<p><strong><a href="https://196e9d3d.ty-ecosystem-ext.pages.dev/diff">Full report with detailed diff</a></strong> (<a href="https://196e9d3d.ty-ecosystem-ext.pages.dev/timing">timing results</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/super.md_-_Super_-_Basic_Usage_-_Implicit_Super_Objec_(f9e5e48e3a4a4c12).snap</code>:178 on 2026-01-06 18:07</div>
            <div class="timeline-body"><p>We are losing some useful context in a lot of these diagnostics, that might help a user understand why the typevar isn&#x27;t valid. Is it possible to restore this extra diagnostic context, while keeping the fix?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:254 on 2026-01-06 18:36</div>
            <div class="timeline-body"><p>This code appears three different times -- extract a helper method? (Or do it up front once when constructing the bound super instance)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:251 on 2026-01-06 19:03</div>
            <div class="timeline-body"><p>I feel like the logic here is a bit &quot;loose&quot; in a way that could bite us in the future (and is causing at least one undesirable behavior change in the tests). If I&#x27;m understanding right, the <code>NominalInstance</code> branch here should only ever occur if we have <code>SuperOwnerKind::InstanceTypeVar</code>, and the fallback branch should only ever occur if we have <code>SuperOwnerKind::ClassTypeVar</code>. If we had, for example, a <code>SuperOwnerKind::InstanceTypeVar</code> with a <code>SubclassOf</code> or <code>ClassLiteral</code> type in the upper bound, it would be wrong to treat that as if it were an instance-type upper bound class.</p>
<p>It feels to me like maybe we should be eagerly checking the upper bound when we create a typevar super, erroring if it doesn&#x27;t look valid (this would be the <code>None</code> case below returning an empty MRO -- it seems a bit questionable to silently fall back when faced with a typevar upper bound that makes no sense for <code>super</code> -- this is causing the behavior change in <code>method10</code> in the tests), and maybe even just storing the extracted class then, so we don&#x27;t have to re-extract it in multiple different places and deal with all the possibilities that we already checked up-front?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:283 on 2026-01-06 19:06</div>
            <div class="timeline-body"><p>The name and docstring here seem misleading, given that I see this method used more generally (e.g. in <code>walk_bound_super_type</code> below)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:530 on 2026-01-06 19:13</div>
            <div class="timeline-body"><p>I think the root cause of the lost diagnostic context mentioned in the snapshots is that now <code>typevar_context</code> is always <code>None</code>, whereas before we used to use <code>delegate_with_error_mapped</code> with a <code>Some</code> error context (in the old <code>Type::TypeVar</code> branch code that&#x27;s removed in this PR.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:384 on 2026-01-06 19:13</div>
            <div class="timeline-body"><p>Here and below is where we used to get typevar contextual information added to our diagnostics, and now we don&#x27;t anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:332 on 2026-01-06 19:14</div>
            <div class="timeline-body"><p>In the current code in this PR, we never pass in a non-None <code>error_context</code> here. Maybe this will change if we fix the lost error context; if it doesn&#x27;t, we should simplify this method (we probably only need <code>delegate_to</code> in that case, not <code>delegate_with_error_mapped</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:242 on 2026-01-06 19:28</div>
            <div class="timeline-body"><p>I don&#x27;t think this behavior change is desirable, but it may not be important, so we could potentially leave it as a TODO.</p>
<p>I think the preferable behavior here would be to create the union of bound-super instances, like before, where each element in the union acts as one of the constrained types -- but the binding_type for each element of the union still uses the original constrained typevar.</p>
<p>I think doing more checking of the bounds/constraints of a typevar up-front, and storing the extracted class type to use, as suggested in other comments, would make it pretty easy to handle this case, too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:265 on 2026-01-06 19:29</div>
            <div class="timeline-body"><p>I think this behavior change is also not desirable. <code>S</code> could be a callable type which is not a subclass of <code>Foo</code>, so this could fail at runtime. Erroring is better here.</p>
<p>The root cause here is our permissive handling of un-recognized bounds, which is mentioned in other comments. Early validation of bounds/constraints could help restore this error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> requested changes on 2026-01-06 19:32</div>
            <div class="timeline-body"><p>Nice fix! I think there are currently a few undesired behavior changes coming along with it, and some effectively-unused code left behind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2026-01-06 19:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/super.md_-_Super_-_Basic_Usage_-_Implicit_Super_Objec_(f9e5e48e3a4a4c12).snap</code>:161 on 2026-01-06 19:46</div>
            <div class="timeline-body"><p>I&#x27;ll co-sign @carljm&#x27;s comment below that it seems sad to lose these subidagnostics -- especially the last one, which gives you a hint on how to fix this common error!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 19:46</div>
            <div class="timeline-body"><p>Thank you! Will investigate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2026-01-06 20:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/resources/mdtest/snapshots/super.md_-_Super_-_Basic_Usage_-_Implicit_Super_Objec_(f9e5e48e3a4a4c12).snap</code>:5 on 2026-01-06 20:29</div>
            <div class="timeline-body"><p>can you update your installation of <code>cargo insta</code> and run <code>cargo insta test --force-update-snapshots</code>? The latest version of <code>cargo insta</code> causes loads of annoying warnings to be printed when running tests locally if the snapshot has the &quot;old format&quot; (the old format does not have this newline between the two dashed lines)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:225 on 2026-01-06 20:32</div>
            <div class="timeline-body"><pre><code>            None =&gt; ClassType::object(db),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2026-01-06 20:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:33</div>
            <div class="timeline-body"><p>@AlexWaygood -- sorry still working through the feedback, I will re-request!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:55</div>
            <div class="timeline-body"><p>Okay, I think this is closer?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-06 20:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:362 on 2026-01-06 20:57</div>
            <div class="timeline-body"><p>This was already present, just moved up...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/type_ordering.rs</code>:200 on 2026-01-06 22:14</div>
            <div class="timeline-body"><p>Missed this the first time through -- this doesn&#x27;t look quite right. We should distinguish <code>InstanceTypeVar</code> from <code>ClassTypeVar</code> here, not conflate them. That is, we should extend the existing pattern above for the pre-existing enum variants, without introducing any union matches.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:433 on 2026-01-06 22:26</div>
            <div class="timeline-body"><p>I don&#x27;t think the fallback <code>_ =&gt; bound.to_class_type(db),</code> is correct here. We&#x27;ve &quot;unwrapped&quot; the subclass-of type; the typevar within it should have a <code>NominalInstance</code> bound. Tests all pass with this change:</p>
<pre><code>                            if let Type::NominalInstance(instance) = bound {
                                SuperOwnerKind::ClassTypeVar(bound_typevar, instance.class(db))
                            } else {
                                return Err(BoundSuperError::AbstractOwnerType {
                                    owner_type,
                                    pivot_class: pivot_class_type,
                                    typevar_context: Some(typevar),
                                });
                            }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:447 on 2026-01-06 22:27</div>
            <div class="timeline-body"><p>nit</p>
<pre><code>                            SuperOwnerKind::ClassTypeVar(bound_typevar, ClassType::object(db))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:532 on 2026-01-06 22:28</div>
            <div class="timeline-body"><pre><code>                        SuperOwnerKind::InstanceTypeVar(bound_typevar, ClassType::object(db))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:544 on 2026-01-06 22:33</div>
            <div class="timeline-body"><p>Here again, I don&#x27;t think this match arm is right. It&#x27;s at least not needed to pass any current test. I think if we did support a class-literal type (or subclass-of type) as upper bound here, the correct thing to do might be to create a <code>ClassTypeVar</code> then, not an <code>InstanceTypeVar</code>? But I think we can leave consideration of that case to a separate PR, if it ever comes up in practice.</p>
<pre><code>                        if let Type::NominalInstance(instance) = bound {
                            SuperOwnerKind::InstanceTypeVar(bound_typevar, instance.class(db))
                        } else {
                            return Err(BoundSuperError::AbstractOwnerType {
                                owner_type,
                                pivot_class: pivot_class_type,
                                typevar_context: Some(typevar),
                            });
                        }

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2026-01-06 22:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-06 22:44</div>
            <div class="timeline-body"><p>There are some newly-added diagnostics in the ecosystem report here that I think would be worth understanding...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 23:06</div>
            <div class="timeline-body"><p>I will persevere</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 23:24</div>
            <div class="timeline-body"><p>(Gonna push your fixes first, then review the diagnostics...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-07 00:47</div>
            <div class="timeline-body"><p>For the ecosystem changes...</p>
<ol>
<li><p>The PyGithub change is a now-unused type ignore, so that seems fine.</p>
</li>
<li><p>The new xarray diagnostic appears to be valid? Here&#x27;s Claude&#x27;s analysis (I also added a test to demonstrate it):</p>
</li>
</ol>
<pre><code>  The Type Contract:
  - TreeNode.__init__ has signature: def __init__(self, children: Mapping[str, Self] | None = None)
  - DataTree.__init__ has signature: def __init__(self, children: Mapping[str, DataTree] | None = None)

  The Problem:
  When DataTree.__init__ calls super().__init__(children=children):
  1. The parent TreeNode.__init__ expects Mapping[str, Self]
  2. Self represents &quot;the exact type of the instance being constructed&quot;
  3. DataTree.__init__ passes Mapping[str, DataTree] (a concrete type)

  Why This Matters:
  If someone subclasses DataTree:
  class MyDataTree(DataTree):
      pass

  mt = MyDataTree(children={&quot;child&quot;: some_data_tree})

  In this case:
  - Self in TreeNode.__init__ would be MyDataTree
  - TreeNode expects Mapping[str, MyDataTree]
  - But DataTree.__init__ only accepts/passes Mapping[str, DataTree]
  - This is a type mismatch because Mapping is invariant in its value type

  The Fix (in xarray):
  xarray should change DataTree.__init__ to use Self instead of the concrete DataTree:
  def __init__(self, children: Mapping[str, Self] | None = None):
</code></pre>
<ol>
<li>The beartype diagnostic was a false positive; I pushed a test case and a fix...</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/carljm">@carljm</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-07 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-07 01:54</div>
            <div class="timeline-body"><p>The one part of the Claude analysis on xarray that looks wrong is that <code>Mapping</code> is covariant in its value type, not invariant. But I don&#x27;t think this actually invalidates any of the rest of the analysis -- passing a <code>Mapping[str, DataTree]</code> when a <code>Mapping[str, MyDataTree]</code> is expected is also invalid under covariance! So I think the analysis is right, that&#x27;s a true positive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:280 on 2026-01-07 02:00</div>
            <div class="timeline-body"><p>Ideally I&#x27;d love to see some analysis of how other type checkers handle these two cases, and whether they can ever work at runtime, to know whether this is a TODO for further improvement, or the correct behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:691 on 2026-01-07 02:02</div>
            <div class="timeline-body"><p>It seems like xarray actually used <code>Mapping</code>, but your test below uses <code>dict</code>. That&#x27;s a significant difference since <code>Mapping</code> is covariant in its value type, but <code>dict</code> is invariant. I don&#x27;t think that changes the behavior in this test, but using <code>Mapping</code> would make the test &quot;stronger&quot; since it would show that invariance is not actually the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:430 on 2026-01-07 02:27</div>
            <div class="timeline-body"><p>This is not really the right error kind here -- we&#x27;ll throw this now for typevars with various upper bounds that are not necessarily abstract/structural at all (as in the <code>type[]</code> examples you added in the tests), they are just &quot;types we can&#x27;t extract a class from&quot;.</p>
<p>I&#x27;m actually wondering if the right thing here is not to error, but to fall back to the behavior from before this PR (where we just delegate to the bound). I think in most(?) cases that we don&#x27;t handle as <code>ClassTypeVar</code>, that will just end up throwing an error later -- but it will be a more accurate error than this one. And if it doesn&#x27;t throw an error, that means we&#x27;ve got a typevar whose upper bound is actually a valid subclass of the pivot type -- treating such a case as the upper bound at least won&#x27;t be any worse than our behavior today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> reviewed on 2026-01-07 02:31</div>
            <div class="timeline-body"><p>Ok sorry I keep finding new things to comment on here, not trying to be annoying... I think this is looking pretty good, just the errors we are throwing on the typevar cases we aren&#x27;t handling don&#x27;t look right, and I&#x27;m not clear whether they should necessarily be errors or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 02:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:280 on 2026-01-07 02:44</div>
            <div class="timeline-body"><p>I hate to just dump Claude here but after making the change you suggested two comments below...</p>
<pre><code>  method11 (self: S where S: type[Foo[int]]):
  -  No error
  - Revealed: &lt;super: &lt;class &#x27;Foo&#x27;&gt;, &lt;class &#x27;Foo[int]&#x27;&gt;&gt;
  - Comment in test: &quot;Delegates to the bound to resolve the super type&quot;

  method12 (cls: type[S] where S: type[Foo[int]]):
  -  Error: &quot;type[S@method12] is a type variable with an abstract/structural type&quot;
  - Revealed: Unknown

  Comparison with Other Type Checkers

  | Case                        | Pyright                              | Mypy                           | Pyrefly               | ty (updated)           |
  |-----------------------------|--------------------------------------|--------------------------------|-----------------------|------------------------|
  | method11 error on signature |  &quot;self must be supertype of class&quot; |  &quot;erased type not supertype&quot; |                     |                      |
  | method11 error on super()   |                                    |                              |                     |                      |
  | method11 revealed type      | object                               | super                          | super[object, Foo[T]] | &lt;super: Foo, Foo[int]&gt; |
  | method12 error on signature |  &quot;cls must be supertype of class&quot;  |  &quot;erased type not supertype&quot; |                     |                      |
  | method12 error on super()   |                                    |                              |                     |                      |
  | method12 revealed type      | type[object]                         | super                          | super[object, Foo]    | Unknown                |

  Analysis

  1. method11 is now handled well by ty: It extracts Foo[int] from type[Foo[int]] and builds a valid super object. This is reasonable - if someone writes self: S where S: type[Foo[int]], ty interprets the bound to mean &quot;self is a class of type Foo[int]&quot;.
  2. method12 still errors: This is because cls: type[S] where S: type[Foo[int]] means cls would be type[type[Foo[int]]] - a metaclass. The bound type[Foo[int]] is &quot;abstract/structural&quot; from ty&#x27;s perspective when wrapped in another type[].
  3. Runtime consideration: Both patterns can technically work at runtime since Python&#x27;s super() just uses whatever value is passed. But semantically:
    - method11 is weird (why annotate self as a class?) but ty handles it
    - method12 is very weird (cls would be a metaclass of a metaclass)

  Recommendation for Carl&#x27;s Question

  method11: ty&#x27;s updated behavior is correct and arguably better than pyright/mypy. It provides a useful type by extracting the class from the bound, rather than falling back to object.

  method12: ty&#x27;s error is reasonable because type[type[Foo[int]]] is an unusual/abstract type that doesn&#x27;t have a clear nominal class to use for super(). However:
  - Pyright/mypy error on the signature instead (which is also valid)
  - The error could potentially be improved to mention that type[type[X]] is the issue

  This behavior seems correct - method12 represents a genuinely problematic pattern that should be flagged. The question is just whether the error message could be more precise about why it&#x27;s problematic (the double type[] wrapping creates a metaclass-of-metaclass situation).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 03:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:280 on 2026-01-07 03:02</div>
            <div class="timeline-body"><p>Sorry, updated analysis:</p>
<pre><code>  Current ty behavior:

  | Case                                            | Error on super() | Revealed Type                              |
  |-------------------------------------------------|------------------|--------------------------------------------|
  | method11 (self: S where S: type[Foo[int]])      |  No error      | &lt;super: &lt;class &#x27;Foo&#x27;&gt;, &lt;class &#x27;Foo[int]&#x27;&gt;&gt; |
  | method12 (cls: type[S] where S: type[Foo[int]]) |  No error      | &lt;super: &lt;class &#x27;Foo&#x27;&gt;, Unknown&gt;            |

  Updated comparison:

  | Case                        | Pyright      | Mypy  | ty (updated)           |
  |-----------------------------|--------------|-------|------------------------|
  | method11 error on signature |            |     |                      |
  | method11 error on super()   |            |     |                      |
  | method11 revealed type      | object       | super | &lt;super: Foo, Foo[int]&gt; |
  | method12 error on signature |            |     |                      |
  | method12 error on super()   |            |     |  (was )            |
  | method12 revealed type      | type[object] | super | &lt;super: Foo, Unknown&gt;  |

  Analysis:

  The change now follows Carl&#x27;s suggestion: instead of throwing AbstractOwnerType immediately, we delegate to the bound. For method12:
  - type[S] where S: type[Foo[int]] means we need type[type[Foo[int]]]
  - We can&#x27;t construct that, so we fall back to type[Unknown]
  - type[Unknown] is a valid dynamic type, so super() succeeds with Unknown as the owner

  This is consistent with Carl&#x27;s rationale: &quot;if it doesn&#x27;t throw an error, that means we&#x27;ve got a typevar whose upper bound is actually a valid subclass of the pivot type -- treating such a case as the upper bound at least won&#x27;t be any worse than our behavior today.&quot;

  The behavior matches what pyright/mypy do (no error on super() itself), though they error on the signature which ty doesn&#x27;t currently check.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 03:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:430 on 2026-01-07 03:02</div>
            <div class="timeline-body"><p>I&#x27;m not certain that I got this right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 03:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:280 on 2026-01-07 03:03</div>
            <div class="timeline-body"><p>Should we be validating the signature in these cases? (Is that tracked elsewhere?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 03:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:280 on 2026-01-07 03:07</div>
            <div class="timeline-body"><p>I see a few TODOs that suggest we <em>do</em> want to do this (validate that the <code>self/cls</code> annotation is a supertype of the enclosing class), but that seems like a separate concern from this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/resources/mdtest/class/super.md</code>:280 on 2026-01-08 00:30</div>
            <div class="timeline-body"><p>Yeah, we should validate the <code>self</code> / <code>cls</code> annotation, and yeah that&#x27;s separate from this PR.</p>
<p>Thanks for the analysis! I&#x27;m happy with this behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/carljm">@carljm</a> on <code>crates/ty_python_semantic/src/types/bound_super.rs</code>:240 on 2026-01-08 00:33</div>
            <div class="timeline-body"><p>I suspect this maybe shouldn&#x27;t be a no-op, but I think it&#x27;s fine to just leave a TODO and wait for a real repro to arrive.</p>
<pre><code>                // TODO: we might need to normalize the nested class here?
                Some(self)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a> approved on 2026-01-08 00:35</div>
            <div class="timeline-body"><p>Looks good to me! Thanks for persevering :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-08 00:46</div>
            <div class="timeline-body"><p>Thank you for the great reviews! Sorry for all the back-and-forth.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-08 00:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-08 00:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-08 00:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:22:14 UTC
    </footer>
</body>
</html>
