<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display fixes by default (#7352) - astral-sh/ruff #12595</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Display fixes by default (#7352)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/12595">#12595</a>
        opened by <a href="https://github.com/chriskrycho">@chriskrycho</a>
        on 2024-07-31 15:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Use the existing <code>printer::Flags::SHOW_FIX_DIFF</code> to enable printing fixable diffs in <code>check</code> mode automatically. Enable it whenever the output format is <code>Full</code>, but keep a distinct flag for it (a) because output format and whether to print diffs are really separate concerns, (b) because it makes it easy to make changes to what sets the flag to true if/as that is needful, and (c) because it minimally perturbs the rest of the code.</p>
<p>Fixes #7352.</p>
<h2>Details</h2>
<p>This changes the result of running <code>ruff check</code> by adding the diff for possible fixes, and adds calls to action for those messages.</p>
<p>Note that this currently displays <em>only</em> safe fixes to users. There are a number of design questions around when and how to display them; see #12598.</p>
<details><summary>a file with three unused imports</summary>

<p>Input:</p>
<pre><code class="language-python">import b
import a
import c
</code></pre>
<p>Output:</p>
<pre><code>/Users/chris/Desktop/lol.py:1:8: F401 [*] `b` imported but unused
  |
1 | import b
  |        ^ F401
2 | import a
3 | import c
  |
  = help: Remove unused import: `b`

Suggested fix:
1   |-import b
2 1 | import a
3 2 | import c
4 3 |

    Run `ruff check --fix` to apply this fix.

/Users/chris/Desktop/lol.py:2:8: F401 [*] `a` imported but unused
  |
1 | import b
2 | import a
  |        ^ F401
3 | import c
  |
  = help: Remove unused import: `a`

Suggested fix:
1 1 | import b
2   |-import a
3 2 | import c
4 3 |

    Run `ruff check --fix` to apply this fix.

/Users/chris/Desktop/lol.py:3:8: F401 [*] `c` imported but unused
  |
1 | import b
2 | import a
3 | import c
  |        ^ F401
  |
  = help: Remove unused import: `c`

Suggested fix:
1 1 | import b
2 2 | import a
3   |-import c
4 3 |

    Run `ruff check --fix` to apply this fix.

Found 3 errors.
[*] 3 fixable with the `--fix` option.
</code></pre>
</details>

<details><summary>The test file <code>crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi</code></summary>

<p>New output:</p>
<pre><code>crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:2:40: F401 [*] `collections.abc.Set` imported but unused
  |
1 | def f():
2 |     from collections.abc import Set as AbstractSet  # Ok
  |                                        ^^^^^^^^^^^ F401
3 | 
4 | def f():
  |
  = help: Remove unused import: `collections.abc.Set`

Suggested fix:
1 1 | def f():
2   |-    from collections.abc import Set as AbstractSet  # Ok
  2 |+    pass  # Ok
3 3 | 
4 4 | def f():
5 5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:4:5: F811 Redefinition of unused `f` from line 1
  |
2 |     from collections.abc import Set as AbstractSet  # Ok
3 | 
4 | def f():
  |     ^ F811
5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  |
  = help: Remove definition: `f`

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:5:33: F401 [*] `collections.abc.Container` imported but unused
  |
4 | def f():
5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  |                                 ^^^^^^^^^ F401
6 | 
7 | def f():
  |
  = help: Remove unused import

Suggested fix:
2 2 |     from collections.abc import Set as AbstractSet  # Ok
3 3 | 
4 4 | def f():
5   |-    from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  5 |+    pass  # Ok
6 6 | 
7 7 | def f():
8 8 |     from collections.abc import Set  # PYI025

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:5:44: F401 [*] `collections.abc.Sized` imported but unused
  |
4 | def f():
5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  |                                            ^^^^^ F401
6 | 
7 | def f():
  |
  = help: Remove unused import

Suggested fix:
2 2 |     from collections.abc import Set as AbstractSet  # Ok
3 3 | 
4 4 | def f():
5   |-    from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  5 |+    pass  # Ok
6 6 | 
7 7 | def f():
8 8 |     from collections.abc import Set  # PYI025

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:5:58: F401 [*] `collections.abc.Set` imported but unused
  |
4 | def f():
5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  |                                                          ^^^^^^^^^^^ F401
6 | 
7 | def f():
  |
  = help: Remove unused import

Suggested fix:
2 2 |     from collections.abc import Set as AbstractSet  # Ok
3 3 | 
4 4 | def f():
5   |-    from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  5 |+    pass  # Ok
6 6 | 
7 7 | def f():
8 8 |     from collections.abc import Set  # PYI025

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:5:71: F401 [*] `collections.abc.ValuesView` imported but unused
  |
4 | def f():
5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  |                                                                       ^^^^^^^^^^ F401
6 | 
7 | def f():
  |
  = help: Remove unused import

Suggested fix:
2 2 |     from collections.abc import Set as AbstractSet  # Ok
3 3 | 
4 4 | def f():
5   |-    from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
  5 |+    pass  # Ok
6 6 | 
7 7 | def f():
8 8 |     from collections.abc import Set  # PYI025

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:7:5: F811 Redefinition of unused `f` from line 4
  |
5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
6 | 
7 | def f():
  |     ^ F811
8 |     from collections.abc import Set  # PYI025
  |
  = help: Remove definition: `f`

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:8:33: F401 [*] `collections.abc.Set` imported but unused
   |
 7 | def f():
 8 |     from collections.abc import Set  # PYI025
   |                                 ^^^ F401
 9 | 
10 | def f():
   |
   = help: Remove unused import: `collections.abc.Set`

Suggested fix:
5 5 |     from collections.abc import Container, Sized, Set as AbstractSet, ValuesView  # Ok
6 6 | 
7 7 | def f():
8   |-    from collections.abc import Set  # PYI025
  8 |+    pass  # PYI025
9 9 | 
10 10 | def f():
11 11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:10:5: F811 Redefinition of unused `f` from line 7
   |
 8 |     from collections.abc import Set  # PYI025
 9 | 
10 | def f():
   |     ^ F811
11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   |
   = help: Remove definition: `f`

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:11:33: F401 [*] `collections.abc.Container` imported but unused
   |
10 | def f():
11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   |                                 ^^^^^^^^^ F401
12 | 
13 | def f():
   |
   = help: Remove unused import

Suggested fix:
8  8  |     from collections.abc import Set  # PYI025
9  9  | 
10 10 | def f():
11    |-    from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   11 |+    pass  # PYI025
12 12 | 
13 13 | def f():
14 14 |     &quot;&quot;&quot;Test: local symbol renaming.&quot;&quot;&quot;

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:11:44: F401 [*] `collections.abc.Sized` imported but unused
   |
10 | def f():
11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   |                                            ^^^^^ F401
12 | 
13 | def f():
   |
   = help: Remove unused import

Suggested fix:
8  8  |     from collections.abc import Set  # PYI025
9  9  | 
10 10 | def f():
11    |-    from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   11 |+    pass  # PYI025
12 12 | 
13 13 | def f():
14 14 |     &quot;&quot;&quot;Test: local symbol renaming.&quot;&quot;&quot;

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:11:51: F401 [*] `collections.abc.Set` imported but unused
   |
10 | def f():
11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   |                                                   ^^^ F401
12 | 
13 | def f():
   |
   = help: Remove unused import

Suggested fix:
8  8  |     from collections.abc import Set  # PYI025
9  9  | 
10 10 | def f():
11    |-    from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   11 |+    pass  # PYI025
12 12 | 
13 13 | def f():
14 14 |     &quot;&quot;&quot;Test: local symbol renaming.&quot;&quot;&quot;

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:11:56: F401 [*] `collections.abc.ValuesView` imported but unused
   |
10 | def f():
11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   |                                                        ^^^^^^^^^^ F401
12 | 
13 | def f():
   |
   = help: Remove unused import

Suggested fix:
8  8  |     from collections.abc import Set  # PYI025
9  9  | 
10 10 | def f():
11    |-    from collections.abc import Container, Sized, Set, ValuesView  # PYI025
   11 |+    pass  # PYI025
12 12 | 
13 13 | def f():
14 14 |     &quot;&quot;&quot;Test: local symbol renaming.&quot;&quot;&quot;

    Run `ruff check --fix` to apply this fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:13:5: F811 Redefinition of unused `f` from line 10
   |
11 |     from collections.abc import Container, Sized, Set, ValuesView  # PYI025
12 | 
13 | def f():
   |     ^ F811
14 |     &quot;&quot;&quot;Test: local symbol renaming.&quot;&quot;&quot;
15 |     if True:
   |
   = help: Remove definition: `f`

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:20:5: F841 Local variable `x` is assigned to but never used
   |
18 |         Set = 1
19 | 
20 |     x: Set = set()
   |     ^ F841
21 | 
22 |     x: Set
   |
   = help: Remove assignment to unused variable `x`

Suggested fix:
17 17 |     else:
18 18 |         Set = 1
19 19 | 
20    |-    x: Set = set()
21 20 | 
22 21 |     x: Set
23 22 | 

    Run `ruff check --fix --unsafe-fixes` to apply this unsafe fix.

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:27:15: F821 Undefined name `Set`
   |
26 |     def f():
27 |         print(Set)
   |               ^^^ F821
28 | 
29 |         def Set():
   |

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:27:15: F823 Local variable `Set` referenced before assignment
   |
26 |     def f():
27 |         print(Set)
   |               ^^^ F823
28 | 
29 |         def Set():
   |

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:33:1: E402 Module level import not at top of file
   |
31 |         print(Set)
32 | 
33 | from collections.abc import Set
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ E402
34 | 
35 | def f():
   |

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:35:5: F811 Redefinition of unused `f` from line 13
   |
33 | from collections.abc import Set
34 | 
35 | def f():
   |     ^ F811
36 |     &quot;&quot;&quot;Test: global symbol renaming.&quot;&quot;&quot;
37 |     global Set
   |
   = help: Remove definition: `f`

crates/ruff_linter/resources/test/fixtures/flake8_pyi/PYI025_1.pyi:42:5: F811 Redefinition of unused `f` from line 35
   |
40 |     print(Set)
41 | 
42 | def f():
   |     ^ F811
43 |     &quot;&quot;&quot;Test: nonlocal symbol renaming.&quot;&quot;&quot;
44 |     from collections.abc import Set
   |
   = help: Remove definition: `f`

Found 20 errors.
[*] 10 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
</details>

<h2>Test Plan</h2>
<p>This does not introduce <em>new</em> tests, but does update the existing tests to account for the new default output. Of particular interest among the many snapshots, see the updated snapshot for <code>PYI025_1.pyi</code>]<a href="https://github.com/astral-sh/ruff/blob/b824fd328a997e06038aaa8627e06303031f270e/crates/ruff_linter/src/rules/flake8_pyi/snapshots/ruff_linter__rules__flake8_pyi__tests__PYI025_PYI025_1.pyi.snap">snap</a>, which does some truncation of diffs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-07-31 15:41</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @chriskrycho on 2024-07-31 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1558 on 2024-07-31 17:15</div>
            <div class="timeline-body"><p>I would remove the newline (so each violation is a singe block) and drop &quot;Suggested fix&quot; (I think the &quot;help&quot; is a sufficient introduction).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1584 on 2024-07-31 17:16</div>
            <div class="timeline-body"><p>It looks like we need to do something special for violations without help messages? We want a dedicated test case for that and a test case for violations without source context.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1587 on 2024-07-31 17:18</div>
            <div class="timeline-body"><p>Looking at this more holistically, I wonder if this message is necessary since we have a call to action at the end:</p>
<blockquote>
<p>[*] 1 fixable with the <code>--fix</code> option (1 hidden fix can be enabled with the <code>--unsafe-fixes</code> option).</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2024-07-31 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1587 on 2024-07-31 17:18</div>
            <div class="timeline-body"><p>I saw that as well, but my intuition was that it is helpful to have both the details and the summary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1584 on 2024-07-31 17:19</div>
            <div class="timeline-body"><p>Ah, I missed that one. I’ll see about adding a test for those. What’s a scenario where you would end up without source context?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:20</div>
            <div class="timeline-body"><p>Given the message below this (&quot;1 hidden fix...&quot;), I wonder if we should be hiding unsafe fixes unless the opt-in is provided. I think this would solve the &quot;how do we display applicability&quot; problem, to an extent?</p>
<p>If so, I think we could figure out what to do with &quot;display-only&quot; fixes later and just <em>never</em> show them to start (to limit the scope of this pull request)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:21</div>
            <div class="timeline-body"><p>This would require a bit of futzing to retain the existing coverage in our test suite, maybe just using <code>--unsafe-fixes</code> by default in some places?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 17:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:22</div>
            <div class="timeline-body"><p>Hmm, yeah—I can definitely back out those parts of the change if that’s preferable!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 17:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1558 on 2024-07-31 17:23</div>
            <div class="timeline-body"><p>Done in 1f07f5f539f3.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1584 on 2024-07-31 17:24</div>
            <div class="timeline-body"><p>Well, for example, there's no source context for this test rule right? I think if the violation is attached to an empty range we elide the source context. This behavior was recently modified in https://github.com/astral-sh/ruff/pull/12304</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:29</div>
            <div class="timeline-body"><p>It feels like the current design (prior to this pull request) <em>hides</em> unsafe fixes and allowing <em>opt-in</em> to their display, at which point we don't need to indicate that they're unsafe? It seems easiest to follow that pattern for now and consider if and how we want to display unsafe fixes by default separately, i.e., I think more discussion in an issue would be prudent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 17:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:36</div>
            <div class="timeline-body"><p>In terms of handling applicability, we could do that in a couple of ways:</p>
<ul>
<li>The <code>Diff</code> itself could take a configuration level and its <code>Display</code> implementation could use that to decide what to print.</li>
<li>The caller could decide whether to print based on message applicability at a higher level, keeping it out of the <code>Diff</code>.</li>
</ul>
<p>The latter is a slightly smaller scope and IMO better isolation of concerns; it keeps it properly in the <code>TextEmitter</code>, whereas the <code>Diff</code> can be concerned entirely with the presentation of a given diff.</p>
<p>If we go that way, we still have the choice whether to keep the applicability message in the diff. I think I am still mildly inclined toward showing that CTA, because of the differences when you <em>do</em> include <code>--unsafe-fixes</code>; it seems like it would still be nice to know which changes are which.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 17:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:45</div>
            <div class="timeline-body"><p>It seems reasonable to decide whether or not the <code>Diff</code> should be displayed outside its display implementation (the latter option).</p>
<p>Regarding the CTA, I have a preference for splitting it out of this pull request so we can merge this sooner and have focused discussion on each objective, like:</p>
<ol>
<li>Display available fixes by default</li>
<li>Disambiguate safe and unsafe fixes when displayed (i.e., via a CTA or other label)</li>
<li>Display unsafe fixes by default (needs discussion)</li>
<li>Determine how to make display-only fixes user-facing</li>
</ol>
<p>What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 17:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1593 on 2024-07-31 17:56</div>
            <div class="timeline-body"><p>That makes good sense to me. I will split out issues (Edit: https://github.com/astral-sh/ruff/issues/12598) for further discussion on those points and update this to simply display fixes only for the <code>Applicability::Safe</code> level, in a slightly clunky way that is amenable to cleaning up by way of broader refactors once some of those other design questions are fleshed out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-07-31 18:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff/tests/integration_test.rs</code>:1584 on 2024-07-31 18:10</div>
            <div class="timeline-body"><p>I'm going to open a new issue tracking what to do in each of those cases, with the existing baseline implementation here as a useful starting point.</p>
<ul>
<li>For missing help: https://github.com/astral-sh/ruff/issues/12599</li>
<li>For missing source: https://github.com/astral-sh/ruff/issues/12600</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2024-07-31 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff/src/lib.rs</code>:290 on 2024-07-31 20:03</div>
            <div class="timeline-body"><p>Should this be gated behind preview mode to get some user feedback before enabling it for everyone?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_linter/src/message/diff.rs</code>:47 on 2024-07-31 20:05</div>
            <div class="timeline-body"><p>Does this mean that we won't see unsafe fixes in snapshot tests anymore?</p>
<p>I would find this concerning because it means we loose all test coverage for unsafe fixes (of which there are plenty)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-07-31 20:06</div>
            <div class="timeline-body"><p>I'm concerned about the fact that this change removes all test coverage for unsafe fixes. I don't think we should land this before recovering the test coverage.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/message/diff.rs</code>:47 on 2024-07-31 21:33</div>
            <div class="timeline-body"><p>Yes, we need to address this before merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-31 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff/src/lib.rs</code>:290 on 2024-07-31 21:33</div>
            <div class="timeline-body"><p>I don't think it's strictly necessary, but we may want to do so if it's going to change significantly (i.e. by being split into follow-ups)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-07-31 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chriskrycho">@chriskrycho</a> reviewed on 2024-08-01 14:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/chriskrycho">@chriskrycho</a> on <code>crates/ruff_linter/src/message/diff.rs</code>:47 on 2024-08-01 14:02</div>
            <div class="timeline-body"><p>Yeah, we realized this late in our time working on it yesterday. It may warrant going ahead and doing the bit I highlighted in #12597, etc. I think this was a case where trying to keep the change minimal actually makes it harder to land—this particularly bit of coupling wasn’t obvious to me until the very end when we changed from including all the CTAs to including <em>none</em> of them, and turning off.</p>
<p>I think it probably needs the aforementioned refactor (where the <code>TextEmitter</code> handles what to print or not) plus setting the relevant flags based on both <code>--unsafe-fixes</code> <em>and</em> whether it is testing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @chriskrycho on 2024-09-04 21:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:05:36 UTC
    </footer>
</body>
</html>
