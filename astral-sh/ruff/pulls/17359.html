<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ty] Show related information in diagnostic - astral-sh/ruff #17359</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ty] Show related information in diagnostic</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/17359">#17359</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-04-11 17:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Uses the <code>relatedInformation</code> field in diagnostics to render additional data.</p>
<p>For now, this only renders subdiagnostics and annotations with location information. I played with showing other annotations as well, but the rendering in VS code looked awful (I mainly played with the overload diagnostic). I think this is an improvement over the status quo and we can iterate on it as we go.</p>
<p>Closes https://github.com/astral-sh/ty/issues/170</p>
<h2>Test Plan</h2>
<p>https://github.com/user-attachments/assets/475e2826-44cd-4c2e-ad0a-c8ce3ba98408</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @MichaReiser on 2025-04-11 17:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-04-11 17:06</div>
            <div class="timeline-body"><!-- generated-comment mypy_primer -->

<h2><code>mypy_primer</code> results</h2>
<p>No ecosystem changes detected âœ…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2025-05-17 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2025-05-17 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2025-05-17 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2025-05-17 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2025-05-17 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-05-17 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Show related information in diagnostic" to "[ty] Show related information in diagnostic" by @AlexWaygood on 2025-05-17 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-17 22:17</div>
            <div class="timeline-body"><p>This looks great to me, but I'll probably leave review to @BurntSushi</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @carljm removed by @carljm on 2025-05-17 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review request for @AlexWaygood removed by @AlexWaygood on 2025-05-17 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @AlexWaygood on 2025-05-17 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @AlexWaygood on 2025-05-17 22:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:431 on 2025-05-18 14:46</div>
            <div class="timeline-body"><p>This looks the same as <code>Diagnostic::concise_message</code>. I think @BurntSushi might have better recommendation but we could use a trait to avoid the duplication.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-05-18 14:49</div>
            <div class="timeline-body"><blockquote>
<p>For now, this only renders subdiagnostics and annotations with location information. I played with showing other annotations as well, but the rendering in VS code looked awful (I mainly played with the overload diagnostic).</p>
</blockquote>
<p>I think specifically for overloads this seems like a reasonable amount of information to display using related information because a user can hover over the function variable to look at the possible overloads. For example, here the first group is the ty diagnostics while the last group is the hover content:</p>
<p><img width="937" alt="Screenshot 2025-05-18 at 10 33 49" src="https://github.com/user-attachments/assets/16f7b2e5-8264-47f7-9adf-5bb5f614ee6b" /></p>
<p>How this plays out with other diagnostics, that's something that we can play around in follow-ups but this is a good start as you've mentioned.</p>
<hr />
<p>I know Neovim doesn't support related information but I'm not sure about editors other than VS Code like Zed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ruff_db/src/diagnostic/mod.rs</code>:431 on 2025-05-19 16:38</div>
            <div class="timeline-body"><p>I would actually prefer the duplication over a trait. :-)</p>
<p>If the duplication gets obnoxious, another path we could follow is split the common parts of <code>Diagnostic</code> and <code>SubDiagnostic</code> out into a new internal helper type, and implement what we need there. But I don't think that's quite worth doing yet.</p>
<p>My bias is that I tend to be pretty trait-averse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-05-19 16:39</div>
            <div class="timeline-body"><p>This looks like a great start to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-05-19 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-19 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-19 16:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:11:31 UTC
    </footer>
</body>
</html>
