```yaml
number: 6937
title: Avoid lexer infinite loop on invalid input
type: pull_request
state: merged
author: dhruvmanila
labels:
  - parser
assignees: []
merged: true
base: main
head: dhruv/lexer-infinite-loop
created_at: 2023-08-28T10:43:04Z
updated_at: 2023-08-28T11:51:39Z
url: https://github.com/astral-sh/ruff/pull/6937
synced_at: 2026-01-12T15:55:22Z
```

# Avoid lexer infinite loop on invalid input

---

_@dhruvmanila_

## Summary

This PR fixes a bug which sends the lexer into infinite loop for an invalid input.
The code in question is `[1` where the nesting is never finished. This means
that the lexer will keep emitting the `Err` token forever.

## Test Plan

Add a test case which collects all the tokens from the lexer. This just makes
sure that it doesn't go into infinite loop.


---

_Comment by @dhruvmanila on 2023-08-28 10:43_

Current dependencies on/for this PR:
* main
  * **PR #6937** <a href="https://app.graphite.dev/github/pr/astral-sh/ruff/6937" target="_blank"><img src="https://static.graphite.dev/graphite-32x32.svg" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/ruff/6937?utm_source=stack-comment).

---

_Review requested from @MichaReiser by @dhruvmanila on 2023-08-28 10:48_

---

_Comment by @github-actions[bot] on 2023-08-28 11:03_

## PR Check Results
### Ecosystem
âœ… ecosystem check detected no changes.



---

_Label `parser` added by @MichaReiser on 2023-08-28 11:38_

---

_@MichaReiser approved on 2023-08-28 11:38_

---

_Merged by @dhruvmanila on 2023-08-28 11:51_

---

_Closed by @dhruvmanila on 2023-08-28 11:51_

---

_Branch deleted on 2023-08-28 11:51_

---
