<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve API exposed on `ExprStringLiteral` nodes - astral-sh/ruff #16192</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve API exposed on <code>ExprStringLiteral</code> nodes</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/16192">#16192</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-02-16 18:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-16 18:19</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR makes the following changes:</p>
<ul>
<li>It adjusts various callsites to use the new <code>ast::StringLiteral::contents_range()</code> method that was introduced in https://github.com/astral-sh/ruff/pull/16183. This is less verbose and more type-safe than using the <code>ast::str::raw_contents()</code> helper function.</li>
<li>It adds a new <code>ast::ExprStringLiteral::as_unconcatenated_literal()</code> helper method, and adjusts various callsites to use it. This addresses @MichaReiser's review comment at https://github.com/astral-sh/ruff/pull/16183#discussion_r1957334365. There is no functional change here, but it helps readability to make it clearer that we're differentiating between implicitly concatenated strings and unconcatenated strings at various points.</li>
<li>It renames the <code>StringLiteralValue::flags()</code> method to <code>StringLiteralFlags::first_literal_flags()</code>. If you're dealing with an implicitly concatenated string <code>string_node</code>, <code>string_node.value.flags().closer_len()</code> could give an incorrect result; this renaming makes it clearer that the <code>StringLiteralFlags</code> instance returned by the method is only guaranteed to give accurate information for the first <code>StringLiteral</code> contained in the <code>ExprStringLiteral</code> node.</li>
<li>It deletes the unused <code>BytesLiteralValue::flags()</code> method. This seems prone to misuse in the same way as <code>StringLiteralValue::flags()</code>: if it's an implicitly concatenated bytestring, the <code>BytesLiteralFlags</code> instance returned by the method would only give accurate information for the first <code>BytesLiteral</code> in the bytestring.</li>
</ul>
<h2>Test Plan</h2>
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @AlexWaygood on 2025-02-16 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @AlexWaygood on 2025-02-16 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @AlexWaygood on 2025-02-16 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @AlexWaygood on 2025-02-16 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dhruvmanila by @AlexWaygood on 2025-02-16 18:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-02-16 18:34</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Formatter (stable)</h3>
<p>✅ ecosystem check detected no format changes.</p>
<h3>Formatter (preview)</h3>
<p>✅ ecosystem check detected no format changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1293 on 2025-02-17 07:43</div>
            <div class="timeline-body"><p>Nit: I wonder if it should be <code>as_only_literal</code> to align with <code>first_literal</code> but I'm fine with either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-02-17 07:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1293 on 2025-02-17 07:55</div>
            <div class="timeline-body"><p>I think I'd prefer to use <code>as_single_literal</code> / <code>as_only_literal</code> instead as reading <code>unconcatenated</code> and matching against <code>Single</code> confused me at the first glance</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a> approved on 2025-02-17 07:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-02-17 07:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1293 on 2025-02-17 07:58</div>
            <div class="timeline-body"><p>I <em>weakly</em> prefer the current name as I think it makes it clearer that the method is used to differentiate between strings that are implicitly concatenated and ones that aren't</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @AlexWaygood on 2025-02-17 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-02-17 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-17 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-02-17 08:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_python_ast/src/nodes.rs</code>:1293 on 2025-02-17 08:00</div>
            <div class="timeline-body"><p>Oh shoot, I didn't see Dhruv's message until after I merged — sorry. I'll rename it as a followup, since you both dislike the current name!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 19:57:53 UTC
    </footer>
</body>
</html>
