<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator preferred quote style - astral-sh/ruff #20434</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Generator preferred quote style</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/20434">#20434</a>
        opened by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a>
        on 2025-09-16 10:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> on 2025-09-16 10:13</div>
            <div class="timeline-body"><p>Closes #20432</p>
<h2>Summary</h2>
<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ShaharNaveh on 2025-09-16 11:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2025-09-16 11:12</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @MichaReiser on 2025-09-18 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:1606 on 2025-09-18 07:54</div>
            <div class="timeline-body"><p>The documentation now needs updating</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:2085 on 2025-09-18 08:01</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    fn preferred_quote() {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:71 on 2025-09-18 08:03</div>
            <div class="timeline-body"><p>The comment here is inaccurate. Setting <code>quote</code> doesn't force the generator to use the given quote everywhere. For example, setting <code>Quote::Single</code> for <code>f'test{f&quot;nested&quot;}'</code> doesn't change the quotes of the inner f-string. I also recommend adding a test showcasing this behavior</p>
<p>That's why I'd call this field <code>preferred_quote</code>. We should also extend the documentation to explain in more detail what it does (When <code>None</code>, the generator preserves the quote style when possible. When <code>Some</code>, the generator prefers the set quote style, disregarding the quote style used in the source)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:110 on 2025-09-18 08:03</div>
            <div class="timeline-body"><p>Same as on the field documentation</p>
<pre><code class="language-suggestion">    pub fn with_preferred_quote(mut self, quote: Quote) -&gt; Self {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:1413 on 2025-09-18 08:05</div>
            <div class="timeline-body"><p>I think it's clearer if we move the <code>self.quote</code> override to <code>self.p_str_repr</code> instead of &quot;patching&quot; the flags here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-18 08:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Generator quote style" to "Generator preferred quote style" by @ShaharNaveh on 2025-09-18 08:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:71 on 2025-09-18 08:35</div>
            <div class="timeline-body"><p>that's a better name for sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> reviewed on 2025-09-18 08:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2025-09-18 08:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:195 on 2025-09-18 08:45</div>
            <div class="timeline-body"><p>Instead of patching the flags here, can we do something like this:</p>
<pre><code class="language-rust">let quote_style = self.preferred_quote.unwrap_or(flags.quote_style());
let escape = UnicodeEscape::with_preferred_quote(s, quote_style);
</code></pre>
<p>Do we need to add the same handling to:</p>
<ul>
<li><code>unparse_interpolated_string_literal_element</code></li>
<li><code>p_bytes_repr</code></li>
<li><code>unparse_interpolated_string</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> reviewed on 2025-09-18 09:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:195 on 2025-09-18 09:06</div>
            <div class="timeline-body"><p>That's a nice cleanup. will look into the other methods</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> reviewed on 2025-09-18 09:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ShaharNaveh">@ShaharNaveh</a> on <code>crates/ruff_python_codegen/src/generator.rs</code>:113 on 2025-09-18 09:07</div>
            <div class="timeline-body"><p>@MichaReiser I've changed the signature to be able to take <code>Option&lt;Quote&gt;</code>, I think it makes more sense as it gives the ability to unset the preferred quote style &amp; better aligns with the method's doc (IMO)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @MichaReiser by @ShaharNaveh on 2025-09-18 10:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> approved on 2025-09-18 10:57</div>
            <div class="timeline-body"><p>Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2025-09-18 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-09-18 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-10-03 21:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 17:34:59 UTC
    </footer>
</body>
</html>
