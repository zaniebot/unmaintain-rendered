<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reformat mdtests without pyi mode (don't merge, I want to know if this is a deal breaker or not) - astral-sh/ruff #22566</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reformat mdtests without pyi mode (don't merge, I want to know if this is a deal breaker or not)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/pull/22566">#22566</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2026-01-14 09:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>We plan on implementing blackendocs for ruff and we then want to migrate ty to use it instead of blackendocs. One question that has come up is whether a <code>--pyi</code> mode that forces all code to be formatted as stub files is a must have or not. I'd prefer to exclude it from an initial version unless this is an absolute deal breaker.</p>
<p>There's also a design question here: Should the language on the fenced code block take precedence over the <code>--pyi</code> mode?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @MichaReiser on 2026-01-14 09:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ty</span> added by @MichaReiser on 2026-01-14 09:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-14 09:54</div>
            <div class="timeline-body"><p>Doesn't look like the end of the world to me. Yes, it adds quiet a bit of whitespace (about 40 lines per testfile). But it isn't that the files become completely unreadable or twice as long.</p>
<p>I wouldn't consider it a blocker for adopting ruffendocs but @AlexWaygood might feel differently (we would support <code>pyi</code> as language which I think would help with some of the most affected files, as long as they don't test any non-pyi behavior)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-14 10:25</div>
            <div class="timeline-body"><p>Definitely not the end of the world, but to me it still feels like a regression in readability/formatting that I'd rather not have :P</p>
<p>I also think the feature more broadly is a reasonable one -- to me it makes sense that you might want your documentation examples formatted more concisely than your production code! You just want to get the semantic meaning of the code across to the reader as quickly as possible in that scenario.</p>
<p>Anyway, I'm curious what others on the ty think too :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-14 10:49</div>
            <div class="timeline-body"><blockquote>
<p>Definitely not the end of the world, but to me it still feels like a regression in readability/formatting that I'd rather not have :P</p>
</blockquote>
<p>I actually find that some tests improve when more space is added between class definitions. But now we're in opinionated formatter territory.</p>
<p>The main crux that I see is that <code>ruff format</code> doesn't support a <code>--pyi</code> option. So the request here is really such an option to ruff formatter's which, to this point, no one has requested.</p>
<p>We also use the normal Python formatting when formatting code blocks in docstrings, and this has never been raised as an issue. That's why I don't feel a strong need to add this option, even if it might be nice for our mdtests.</p>
<p>I opened https://github.com/astral-sh/ruff/issues/22568</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @carljm by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @AlexWaygood by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @sharkdp by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @dcreager by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "micha/mdtest no pyi mode" to "Reformat mdtests without pyi mode" by @MichaReiser on 2026-01-14 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Reformat mdtests without pyi mode" to "Reformat mdtests without pyi mode (don't merge, I want to know if this is a deal breaker or not)" by @MichaReiser on 2026-01-14 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">do-not-merge</span> added by @MichaReiser on 2026-01-14 10:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-14 11:36:02 UTC
    </footer>
</body>
</html>
