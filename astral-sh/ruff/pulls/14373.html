<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`ruff`] Add rule forbidding `map(int, package.__version__.split('.'))` (`RUF048`) - astral-sh/ruff #14373</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>ruff</code>] Add rule forbidding <code>map(int, package.__version__.split(&#x27;.&#x27;))</code> (<code>RUF048</code>)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/ruff/pull/14373">#14373</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2024-11-16 00:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body">Summary
<p>Resolves #12961.</p>
Test Plan
<p><code>cargo nextest run</code> and <code>cargo insta test</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2024-11-16 01:06</div>
            <div class="timeline-body">

<code>ruff-ecosystem</code> results
Linter (stable)
<p>✅ ecosystem check detected no linter changes.</p>
Linter (preview)
<p>✅ ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:53 on 2024-11-16 15:43</div>
            <div class="timeline-body"><p>Do we need to check whether the <code>map()</code> call is nested inside a <code>tuple</code> or a <code>list</code> call? I feel like both of these would be victim to the same latent bug:</p>
<pre><code>from foo import __version__
from collections import deque

x = deque(map(int, __version__.split(&#x27;.&#x27;)))

for element in map(int, __version__.split(&#x27;.&#x27;)):
    print(element)
</code></pre>
<p>If we just flag all <code>map(int, __version__.split(&#x27;.&#x27;))</code> calls, regardless of whether they&#x27;re nested inside <code>list()</code> or <code>tuple()</code> calls, the rule is more general and we catch more bugs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:16 on 2024-11-16 15:43</div>
            <div class="timeline-body"><pre><code>/// import matplotlib  # `__version__ == &quot;3.9.1.post-1&quot;` in our environment
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:36 on 2024-11-16 15:45</div>
            <div class="timeline-body"><p>If users follow this link, there&#x27;s a warning up at the top of the page telling them that the PEP is a historical document rather than living documentation that&#x27;s meant to be kept up-to-date. Let&#x27;s link to the up-to-date docs instead, which are at https://packaging.python.org/en/latest/specifications/version-specifiers/#version-specifiers</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:118 on 2024-11-16 15:47</div>
            <div class="timeline-body"><pre><code>    if attr != &quot;split&quot; {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:127 on 2024-11-16 15:48</div>
            <div class="timeline-body"><pre><code>        return id == &quot;__version__&quot;;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:92 on 2024-11-16 15:54</div>
            <div class="timeline-body"><p>It&#x27;s generally good to avoid <code>.unwrap()</code> calls where possible. Even in cases like this where you can see that they&#x27;re safe, it&#x27;s a sign that you&#x27;re fighting the type system rather than using it to your advantage. Here you can do this to achieve the same thing without any <code>.unwrap()</code>s.</p>
<pre><code>    if !semantic.match_builtin_expr(func, &quot;map&quot;) {
        return None;
    };

    if let [first, second] = positionals {
        Some((first, second))
    } else {
        None
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>crates/ruff_linter/src/rules/ruff/rules/tuple_map_int_version_parsing.rs</code>:107 on 2024-11-16 15:54</div>
            <div class="timeline-body"><p>Here as well, you can easily avoid the <code>.unwrap()</code>:</p>
<pre><code>    let [argument] = arguments else {
        return false;
    };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2024-11-16 15:55</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>I wonder if the rule should also flag <code>[int(x) for x in __version__]</code> and <code>(int(x) for x in __version__)</code>? But that could always be done as a followup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-11-17 00:50</div>
            <div class="timeline-body"><p>@AlexWaygood Thanks! All fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-18 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-11-18 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-11-18 07:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> approved on 2024-11-18 13:40</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[`ruff`] `tuple(map(int, package.__version__.split(&#x27;.&#x27;)))` (`RUF048`)&quot; to &quot;[`ruff`] Add rule forbidding `map(int, package.__version__.split(&#x27;.&#x27;))` (`RUF048`)&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-18 13:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-18 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-11-18 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-20 03:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:08:32 UTC
    </footer>
</body>
</html>
