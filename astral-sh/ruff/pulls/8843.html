<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`pylint`] Add missing return doc rule (`W9011`) - astral-sh/ruff #8843</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[<code>pylint</code>] Add missing return doc rule (<code>W9011</code>)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/pull/8843">#8843</a>
        opened by <a href="https://github.com/johannes-graner">@johannes-graner</a>
        on 2023-11-26 19:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/johannes-graner">@johannes-graner</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to Ruff! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This PR is part of #970, it adds the <code>W9011</code> error rule.</p>
<p>The rule checks that a return documentation is part of the docstring for functions that return something.
Exactly how the docstring is checked depends on the setting <code>pylint.convention</code>, which can take the same values as <code>pydocstyle.convention</code> (Google, NumPy, or Pep257). The Pep257 option checks for reST style docstrings.</p>
<h2>Test Plan</h2>
<p>The example from <a href="https://pylint.pycqa.org/en/latest/user_guide/messages/warning/missing-return-doc.html">pylint documentation</a> is used, and extended to cover more cases.</p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/github-actions[bot]">@github-actions[bot]</a> on 2023-11-26 19:52</div>
            <div class="timeline-body"><!-- generated-comment ecosystem -->

<h2><code>ruff-ecosystem</code> results</h2>
<h3>Linter (stable)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
<h3>Linter (preview)</h3>
<p>âœ… ecosystem check detected no linter changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-27 15:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/ruff_linter/src/codes.rs</code>:288 on 2023-11-27 15:45</div>
            <div class="timeline-body"><p>We add new rules in preview first</p>
<pre><code class="language-suggestion">        (Pylint, &quot;W9011&quot;) =&gt; (RuleGroup::Preview, rules::pylint::rules::MissingReturnDoc),
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-27 15:46</div>
            <div class="timeline-body"><p>Thanks for contributing!</p>
<p>~Should we avoid raising this for code with a return of <code>None</code>? There are a lot of cases in the ecosystem checks where a return would be meaningless.~ It looks like you implemented this, actually. Could you take a look at the ecosystem checks and see if they are false positives or correct? This rule is introducing <em>a lot</em> of violations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/johannes-graner">@johannes-graner</a> reviewed on 2023-11-27 17:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johannes-graner">@johannes-graner</a> on <code>crates/ruff_linter/src/codes.rs</code>:288 on 2023-11-27 17:56</div>
            <div class="timeline-body"><p>That makes a lot of sense, I missed it when reading <code>CONTRIBUTING.md</code>. Thanks for catching!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johannes-graner">@johannes-graner</a> on 2023-11-27 18:07</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for contributing!</p>
<p>~Should we avoid raising this for code with a return of <code>None</code>? There are a lot of cases in the ecosystem checks where a return would be meaningless.~ It looks like you implemented this, actually. Could you take a look at the ecosystem checks and see if they are false positives or correct? This rule is introducing <em>a lot</em> of violations.</p>
</blockquote>
<p>I looked through the ecosystem checks and most violations are true positives. Since this rule only checks for docstrings following reST, some violations are for <a href="https://github.com/DisnakeDev/disnake/blob/594c12ad5230522a12008445217e71726cc60611/disnake/abc.py#L1803">following other documentation styles</a>.</p>
<p>The only case I would consider potentially problematic is that <a href="https://github.com/apache/airflow/blob/4495de73bc8ede5717e631942477384655a4ce0d/airflow/api/auth/backend/kerberos_auth.py#L105">private functions are not ignored</a>. I'm not quite sure what the best behavior would be in that case, on one hand it makes sense to document private functions too, but on the other hand, private functions are internal affairs where a bit more leeway can be given.</p>
<p>Do you have an opinion on what would be preferable in this case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-27 18:14</div>
            <div class="timeline-body"><p>Unless pylint handles private functions differently, I think we can treat them the same for now. I could imagine a setting to enable or disable documentation rules for private functions in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-27 18:32</div>
            <div class="timeline-body"><p>Given the number of projects that opt-in to PLW without using reST docstrings, I'm a little worried about adding this rule. Perhaps there's a way we can shrink the scope to only effect projects using that docstring style? Maybe there's a pattern in https://github.com/astral-sh/ruff/blob/017e82911595bab746172b7976f993b715be4d79/crates/ruff_linter/src/checkers/ast/analyze/definitions.rs that we should follow?</p>
<p>@charliermarsh may have more concrete advice or opinions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johannes-graner">@johannes-graner</a> on 2023-11-27 18:54</div>
            <div class="timeline-body"><p>Turns out the pylint rule ignores private functions, so let's ignore them here as well.</p>
<p>Regarding this only applying to reST docstrings:
An easier solution might be to include support for Google and Numpy styles as well. Pylint does support those docstring styles, but the examples are only with reST docstrings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johannes-graner">@johannes-graner</a> on 2023-11-30 18:41</div>
            <div class="timeline-body"><p>@zanieb I don't think the CI triggered on my last push (there were some issues with GitHub around that time). Can you or someone else trigger the workflow manually, or should I push an empty commit to trigger the workflow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-30 18:43</div>
            <div class="timeline-body"><p>@johannes-graner - I went ahead and merged in main + re-pushed :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2023-11-30 18:54</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/ruff/branches/johannes-graner:pylint-w9011-missing-return-doc">CodSpeed Performance Report</a></h2>
<h3>Merging #8843 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>johannes-graner:pylint-w9011-missing-return-doc</code> (537aeaa) with <code>main</code> (073eddb)</sub></p>
<h3>Summary</h3>
<p><code>âœ… 30</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mr-Pepe">@Mr-Pepe</a> on 2023-12-04 02:11</div>
            <div class="timeline-body"><blockquote>
<p>Perhaps there's a way we can shrink the scope to only effect projects using that docstring style?</p>
</blockquote>
<p>The pydocstyle checks have a <code>convention</code> setting. Could/should that setting be promoted to a general Ruff setting so other docstring-related checks can account for it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johannes-graner">@johannes-graner</a> on 2023-12-06 19:19</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Perhaps there's a way we can shrink the scope to only effect projects using that docstring style?</p>
</blockquote>
<p>The pydocstyle checks have a <code>convention</code> setting. Could/should that setting be promoted to a general Ruff setting so other docstring-related checks can account for it?</p>
</blockquote>
<p>That sounds reasonable. However, I think that is out of scope for this PR (and should probably be handled by someone with more contributing experience than me).</p>
<p>Would it be reasonable to simply re-use the pydocstyle convention setting with an additional way to specify it in <code>[tool.ruff.lint.pylint]</code>? If I understand the code correctly, one could still specify different conventions in pydocstyle and pylint (although I don't see why anyone would do that!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johannes-graner">@johannes-graner</a> on 2023-12-06 20:26</div>
            <div class="timeline-body"><p>Implemented an option <code>pylint.convention</code> that allows setting the docstring convention. If unset, the rule doesn't check anything, which might be a more sane default than checking all conventions.</p>
<p>Should eliminate any ecosystem violations since they would have to opt-in to the rule by setting the convention. This also brings the behavior slightly closer to that of pylint, which requires an explicit flag to check docstrings.</p>
<p>I still think the convention should be a general setting, but since that would involve deprecation of the current pydocstyle convention setting, it's out of scope here and probably should have it's own issue with discussion first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mr-Pepe">@Mr-Pepe</a> on 2023-12-07 07:02</div>
            <div class="timeline-body"><p>I opened https://github.com/astral-sh/ruff/issues/9043 to discuss the convention setting. Depending on whether there's quick feedback, the settings should probably be updated before this PR gets merged. Otherwise, the settings introduced here would get deprecated straight away.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-12 18:44</div>
            <div class="timeline-body"><p>Sorry for the delay here. It looks like a global setting would be reasonable. @Mr-Pepe are you interested in working on that? We'd probably want to do it separately / before this pull request is merged.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-03-12 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mr-Pepe">@Mr-Pepe</a> on 2024-03-13 05:44</div>
            <div class="timeline-body"><p>I'm not using Python that much anymore, so I can't really justify the effort, sorry ðŸ˜”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-28 15:24</div>
            <div class="timeline-body"><p>Thanks for creating this PR and sorry for the long time it has taken us to move this forward.</p>
<p>We are holding off from adding any new Pylint extension rules until #1774 . The reason for is that using pylint extension rules in pylint requires explicit opt-in. This would be different when using Ruff where the rule would automatically be enabled when you use the <code>PYL</code> selector (or <code>ALL</code> for what it matters). The alternative is to mirror Pylint's approach, where we create a new group for each extension, but we would rather not do that because it doesn't reflect what rule groups are intended for.</p>
<p>That means we can't accept the rule right now, even though I think the rule itself would be useful. Our goal is to have a better place for this kind of rules once #1774.</p>
<p>I'm sorry for giving that feedback so late, and I plan to go through open issues (especially the pylint one) to flag rules ahead of time. Thank you again or taking the time to contribute to Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-03-28 15:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:01:34 UTC
    </footer>
</body>
</html>
