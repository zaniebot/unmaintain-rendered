<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update `docs/README.md`'s table of contents automatically - astral-sh/ty #563</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Update <code>docs/README.md</code>'s table of contents automatically</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/pull/563">#563</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2025-06-02 09:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Resolves #505.</p>
<p>A new script, <code>update_docs_toc.py</code>, is added; it generates a list of links to level-2 headers and writes that back to <code>docs/README.md</code>. It is run in CI via <code>autogenerate_files.sh</code>.</p>
<h2>Test Plan</h2>
<p>None.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ty] Update `docs/README.md`'s TOC" to "Update `docs/README.md`'s TOC" by @InSyncWithFoo on 2025-06-02 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:22 on 2025-06-02 09:45</div>
            <div class="timeline-body"><p>I think this would make it clearer to contributors that this section of the document should not be manually edited:</p>
<pre><code class="language-suggestion">_TOC_START_MARKER = &quot;&lt;!-- Generated table of contents start --&gt;\n\n&quot;
_TOC_END_MARKER = &quot;\n\n&lt;!-- Generated table of contents end --&gt;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:3 on 2025-06-02 09:48</div>
            <div class="timeline-body"><p>instead of pinning dependencies here, maybe we could use a script lockfile, similar to <a href="https://github.com/astral-sh/ruff/blob/main/crates/ty_python_semantic/mdtest.py.lock">what we do for mdtest.py in the Ruff repo</a> (more dogfooding!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:31 on 2025-06-02 09:50</div>
            <div class="timeline-body"><p>nit: I wouldn't really prefix any variable names in this file with underscores. It's a script, not a library; I don't think making a distinction between public and private names in this module is meaningful, and the underscores just add visual noise IMO</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2025-06-02 09:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:6 on 2025-06-02 09:52</div>
            <div class="timeline-body"><pre><code class="language-suggestion">&quot;&quot;&quot;Update `docs/README.md`'s table of contents.

This script generates a list of links to level-2 headers and writes that back
to `docs/README.md`. It is run in CI via `autogenerate_files.sh`.
&quot;&quot;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:6 on 2025-06-02 09:55</div>
            <div class="timeline-body"><p>It would also be great if you could add a short docstring to each function in this file. It doesn't have to be more than a sentence or two. We won't be looking at this code much, so it'll help refresh our memory about how it works when we come back to it at a later date if it's well commented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:59 on 2025-06-02 09:57</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    try:
        start_marker_index = original.index(_TOC_START_MARKER)
        end_marker_index = original.index(_TOC_END_MARKER)
    except ValueError as e:
        raise RuntimeError(f&quot;No table of contents found in {_DOCS_README}&quot;) from e
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on <code>scripts/update_docs_toc.py</code>:62 on 2025-06-02 09:57</div>
            <div class="timeline-body"><p>Can you add a comment explaining why you are ignoring the type-checker and linter errors here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a> reviewed on 2025-06-02 09:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Update `docs/README.md`'s TOC" to "Update `docs/README.md`'s table of contents automatically" by @InSyncWithFoo on 2025-06-02 19:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-02 21:43</div>
            <div class="timeline-body"><p>This is exactly the kind of investment I wanted to avoid; as mentioned in https://github.com/astral-sh/ty/pull/464#issuecomment-2895485130</p>
<p>I don't really mind that you did it now, but... we really shouldn't be spending time on things that will be obviated by moving to mkdocs in the near future.</p>
<p>What this indicates to me, is that we shouldn't have accepted the ToC in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-03 09:43</div>
            <div class="timeline-body"><p>@InSyncWithFoo, thanks for the PR -- I really appreciate it! If we were planning to stick with having GitHub-hosted docs in the long term, I think we'd definitely want a solution like this.</p>
<p>I was already wondering whether it was worth adding this much code (which will be a maintenance burden itself!) just to keep a pretty short TOC up to date, however. Having a partially generated file in the codebase also has the disadvantage that it could confuse contributors, who have already been confused by our fully generated documentation files (which are conceptually much simpler).</p>
<p>Given @zanieb is also sceptical, I think we'll decline this in favour of manually updating the TOC for now. It won't be too long until we switch to mkdocs, which will mean we won't need a solution like this. And it will anyway never be possible to autogenerate all documentation to guarantee that it's kept up to date -- another recent example is https://github.com/astral-sh/ty/issues/564.</p>
<p>Thanks again for the PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-03 09:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:54 UTC
    </footer>
</body>
</html>
