<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support for Pydantic `default_factory` option inside `Annotated` - astral-sh/ty #2130</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support for Pydantic <code>default_factory</code> option inside <code>Annotated</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2130">#2130</a>
        opened by <a href="https://github.com/gusutabopb">@gusutabopb</a>
        on 2025-12-20 15:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gusutabopb">@gusutabopb</a></div>
            <div class="timeline-body">Summary
<p>Related to <a href="https://github.com/pydantic/pydantic/issues/6713">pydantic/pydantic#6713</a></p>
<p>Currently ty doesn&#x27;t detect that a field is optional in a Pydantic model constructor when using the <code>Annotated[&lt;type&gt;, &lt;annotations&gt;]</code> syntax, which is currently recommended way to add <code>Field</code> constraints.</p>
<p>Are there plans to support this? If not is there some other (not Pydantic-specific) annotation that could be used to tell ty the given parameter is not mandatory?</p>
Sample code
<pre><code>from typing import Annotated

from pydantic import BaseModel, Field


class Model(BaseModel):
    name: str
    options: Annotated[list[str], Field(default_factory=list)]

m = Model(name=&quot;John&quot;)
</code></pre>
Error
<pre><code>error[missing-argument]: No argument provided for required parameter `options`
  --&gt; main.py:10:5
   |
 8 |     options: Annotated[list[str], Field(default_factory=list)]
 9 |
10 | m = Model(name=&quot;John&quot;)
   |     ^^^^^^^^^^^^^^^^^^
   |
info: rule `missing-argument` is enabled by default

Found 1 diagnostic
</code></pre>
Workaround
<p>The code below works fine.</p>
<pre><code>from pydantic import BaseModel, Field


class Model(BaseModel):
    name: str
    options: list[str] = Field(default_factory=list)


m = Model(name=&quot;John&quot;)
</code></pre>
<p>PS: I couldn&#x27;t past a playground link because I wasn&#x27;t able to add third-party packages (i.e. Pydantic)</p>
Version
<p>ty 0.0.4 (c1e6188b1 2025-12-18)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">library</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-20 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-12-20 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Support for Pydantic `default_factory` option inside `Annotated&quot; to &quot;Support for Pydantic `default_factory` option inside `Annotated`&quot; by <a href="https://github.com/gusutabopb">@gusutabopb</a> on 2025-12-20 19:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:40 UTC
    </footer>
</body>
</html>
