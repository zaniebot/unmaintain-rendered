<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support for Pydantic `default_factory` option inside `Annotated` - astral-sh/ty #2130</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support for Pydantic `default_factory` option inside `Annotated`</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2130">#2130</a>
        opened by <a href="https://github.com/gusutabopb">@gusutabopb</a>
        on 2025-12-20 15:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gusutabopb">@gusutabopb</a> on 2025-12-20 15:12</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Related to https://github.com/pydantic/pydantic/issues/6713</p>
<p>Currently ty doesn't detect that a field is optional in a Pydantic model constructor when using the <code>Annotated[&lt;type&gt;, &lt;annotations&gt;]</code> syntax, which is currently recommended way to add <code>Field</code> constraints.</p>
<p>Are there plans to support this? If not is there some other (not Pydantic-specific) annotation that could be used to tell ty the given parameter is not mandatory?</p>
<h3>Sample code</h3>
<pre><code class="language-python">from typing import Annotated

from pydantic import BaseModel, Field


class Model(BaseModel):
    name: str
    options: Annotated[list[str], Field(default_factory=list)]

m = Model(name=&quot;John&quot;)
</code></pre>
<h3>Error</h3>
<pre><code>error[missing-argument]: No argument provided for required parameter `options`
  --&gt; main.py:10:5
   |
 8 |     options: Annotated[list[str], Field(default_factory=list)]
 9 |
10 | m = Model(name=&quot;John&quot;)
   |     ^^^^^^^^^^^^^^^^^^
   |
info: rule `missing-argument` is enabled by default

Found 1 diagnostic
</code></pre>
<h3>Workaround</h3>
<p>The code below works fine.</p>
<pre><code class="language-python">from pydantic import BaseModel, Field


class Model(BaseModel):
    name: str
    options: list[str] = Field(default_factory=list)


m = Model(name=&quot;John&quot;)
</code></pre>
<p>PS: I couldn't past a playground link because I wasn't able to add third-party packages (i.e. Pydantic)</p>
<h3>Version</h3>
<p>ty 0.0.4 (c1e6188b1 2025-12-18)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">library</span> added by @AlexWaygood on 2025-12-20 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-20 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Support for Pydantic `default_factory` option inside `Annotated" to "Support for Pydantic `default_factory` option inside `Annotated`" by @gusutabopb on 2025-12-20 19:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:53:03 UTC
    </footer>
</body>
</html>
