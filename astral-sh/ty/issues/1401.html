<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ty accepts invalid override and abstract class instantiation (false negative) - astral-sh/ty #1401</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ty accepts invalid override and abstract class instantiation (false negative)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1401">#1401</a>
        opened by <a href="https://github.com/benedekaibas">@benedekaibas</a>
        on 2025-10-20 03:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/benedekaibas">@benedekaibas</a></div>
            <div class="timeline-body">Summary
<p>Ty currently allows a subclass that violates standard type-checking rules.
In this example, the subclass both narrows the parameter type of an overridden method (which breaks the Liskov substitution principle) and instantiates an abstract base class without providing implementations for all of its required abstract methods.</p>
<p>Other type checkers like <code>mypy</code>, <code>zuban</code>, and <code>pyrefly</code> correctly detect these problems, but <code>Ty</code> reports no issues.</p>
<ul>
<li>Code to reproduce:</li>
</ul>
<pre><code>from typing import ClassVar, Final
from typing import AbstractSet
from abc import ABC, abstractmethod

class MySet(ABC):
    SIZE: ClassVar[Final[int]] = 10
    @abstractmethod
    def __contains__(self, item: object) -&gt; bool:
        ...

class Sub(MySet, AbstractSet[int]):
    def __contains__(self, item: int) -&gt; bool:
        return item &lt; self.SIZE

if __name__ == &quot;__main__&quot;:
    s = Sub()          # Should be an error (abstract class)
    print(3 in s)
</code></pre>
<p>Expected output:</p>
<pre><code>ERROR Class member `Sub.__contains__` overrides parent class `AbstractSet` in an inconsistent manner
ERROR Class member `Sub.__contains__` overrides parent class `MySet` in an inconsistent manner
</code></pre>
<p>Ty currently outputs:</p>
<pre><code>All checks passed!
</code></pre>
<p>I have run the newest version of <code>ty</code> on this code. Even though I know <code>ty</code> is in preview and not ready for production use, I think this bug should be corrected to make <code>ty</code> more reliable.</p>
Version
<p>ty 0.0.1-alpha.23</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-20 07:28</div>
            <div class="timeline-body"><p>Thank you for reporting this, we currently don&#x27;t support Liskov checks yet, but will hopefully add this soon. See #166</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-20 07:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:47 UTC
    </footer>
</body>
</html>
