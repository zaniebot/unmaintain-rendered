<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty does not see `to_json` generated by `@dataclass_json` - astral-sh/ty #2239</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty does not see <code>to_json</code> generated by <code>@dataclass_json</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2239">#2239</a>
        opened by <a href="https://github.com/vi">@vi</a>
        on 2025-12-27 19:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vi">@vi</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>For example, for this code:</p>
<pre><code class="language-python">from dataclasses import dataclass
from dataclasses_json import dataclass_json

@dataclass_json
@dataclass
class Qqq:
    a : str
    b : int

x = Qqq(&quot;a&quot;,4)
print(x.to_json())
</code></pre>
<details><summary>pyproject.toml</summary>

<pre><code class="language-toml">[project]
version=&quot;0.0.0&quot;
name=&quot;qqq&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
  &quot;dataclasses-json~=0.6.7&quot;,
]
</code></pre>
</details>

<p>Ty should the following error:</p>
<pre><code>Object of type `Qqq` has no attribute `to_json` ty[unresolved-attribute](https://ty.dev/rules#unresolved-attribute)</code></pre>
<p>Is it a deficiency in Ty or in dataclass_json?</p>
<p>Is there a better way working around than <code># ty:ignore[unresolved-attribute]</code>?, e.g. can I somehow hint that <code>Qqq</code> class has <code>to_json</code> method (without manually implementing it), so that Ty would typecheck it properly?</p>
<p>For example, the following seems to work:</p>
<pre><code class="language-python">@dataclass_json
@dataclass
class Qqq:
    a : str
    b : int

    def to_json(self) -&gt; str: raise Exception(&quot;This method should be overridden by @dataclass_json&quot;)
</code></pre>
<p>Is it a good idea? Can it fall apart in future due to changes in <code>dataclass_json</code>, Python or Ty?</p>
<h3>Version</h3>
<p>ty 0.0.2, from VSCode extension</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @vi on 2025-12-27 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wizzerinus">@Wizzerinus</a> on 2025-12-27 19:31</div>
            <div class="timeline-body"><p>Seems like a problem with dataclass_json, since this overload should be picked:</p>
<pre><code class="language-py">@overload
def dataclass_json(_cls: Type[T], *, letter_case: Optional[LetterCase] = ...,
                   undefined: Optional[Union[str, Undefined]] = ...) -&gt; Type[T]: ...
</code></pre>
<p>and it says that the input class and the return value are exactly the same type, without saying anything about to_json being created.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-27 19:36</div>
            <div class="timeline-body"><p>Yes, <code>dataclass_json</code> provides no information that should tell a type checker about the <code>to_json</code> method. All other type checkers I tried (pyright, pyrefly, mypy) emit the same diagnostic we do here.</p>
<p>I think your solution to define <code>to_json</code> yourself and let <code>dataclass_json</code> override it is a pretty good option; I'm not thinking of any less-onerous workaround.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-12-27 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vi">@vi</a> on 2025-12-27 19:37</div>
            <div class="timeline-body"><p>Can <code>dataclass_json</code> communicate to Ty that a method is going to be created?</p>
<p>What shall be pursued - making <code>dataclasses_json</code> play well with type checkers or finding a better, less verbose workaround?</p>
<p>Shall Ty in general support such injected methods (provided injection libraries cooperate)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wizzerinus">@Wizzerinus</a> on 2025-12-27 19:39</div>
            <div class="timeline-body"><p>This can be possible with an intersection type I believe. Something of the kind</p>
<pre><code class="language-py">class ToJSONable(Protocol):
  def to_json(self) -&gt; str: ...

@overload
def dataclass_json(_cls: Type[T], *, letter_case: Optional[LetterCase] = ...,
                   undefined: Optional[Union[str, Undefined]] = ...) -&gt; Intersection[Type[ToJSONable], Type[T]]: ...
</code></pre>
<p>(disclaimer: I have not tried this exactly, here be dragons.)</p>
<p>Intersection types however are currently not Python's first-class citizens, so probably not worth doing this right now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-29 20:22</div>
            <div class="timeline-body"><p>There is currently nothing in the Python static type system that allows for a class decorator to add arbitrary extra methods to a class (apart from the fixed set of methods added by a <code>dataclass_transform</code> decorator).</p>
<p>Intersection types do provide a potential path forward, and are already supported by ty -- but we will need to fix #903 before the version given by @Wizzerinus will work. And of course other type checkers do not support user-spellable intersection types, so until an intersection PEP is accepted, this would be a ty-specific solution.</p>
<p>The way to &quot;inject methods&quot; that works in the current type system would be via mixin inheritance, not via a class decorator.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:35 UTC
    </footer>
</body>
</html>
