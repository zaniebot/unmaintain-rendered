<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should `top_materialization` use `default_specialization` for type vars? - astral-sh/ty #1164</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should <code>top_materialization</code> use <code>default_specialization</code> for type vars?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1164">#1164</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-09-10 14:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-10 14:58</div>
            <div class="timeline-body"><p>@AlexWaygood:</p>
<blockquote>
<p>I wondered if <code>class.top_materialization()</code> would work here, but it looks like under the hood that uses <code>default_specialization()</code>, so it suffers from the same issue as our current logic on <code>main</code>. (It probably <em>shouldn't</em> use <code>default_specialization()</code>?)</p>
</blockquote>
<p>@dcreager</p>
<blockquote>
<p>I think you're right — it should translate typevars into the bound/constraints in covariant position, and to <code>Never</code> (the implicit lower bound of every typevar) in contravariant position. (With the caveat that we can't really express the constraints of a constrained typevar as a single type — we'd need a &quot;one-of&quot; connective instead of union, and an &quot;instance of this type but not any subtypes&quot;.)</p>
</blockquote>
<p><em>Originally posted by @AlexWaygood in https://github.com/astral-sh/ruff/pull/20325#discussion_r2336862128</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type properties</span> added by @sharkdp on 2025-09-10 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-06 23:19</div>
            <div class="timeline-body"><p>This came up in https://github.com/astral-sh/ty/issues/2356, so I'm bumping the priority</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Pre-stable 1" by @AlexWaygood on 2026-01-06 23:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-07 00:13</div>
            <div class="timeline-body"><p>I think this belongs in stable, and it seems not-very-hard, so I'd have no problem doing it soon -- but in general I don't think one bug report necessarily warrants bumping priority into pre-stable 1. Most of the issues there are things we've gotten many, many bug reports about. (Or else they are e.g. fatals.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Pre-stable 1" by @carljm on 2026-01-07 00:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-07 00:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:40:33 UTC
    </footer>
</body>
</html>
