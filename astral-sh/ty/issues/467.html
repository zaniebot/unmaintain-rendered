<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type checker doesn't recognize SQLAlchemy 2.0 features (Mapped, mapped_column) despite correct installation - astral-sh/ty #467</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Type checker doesn't recognize SQLAlchemy 2.0 features (Mapped, mapped_column) despite correct installation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/467">#467</a>
        opened by <a href="https://github.com/y3bishop3y">@y3bishop3y</a>
        on 2025-05-20 20:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/y3bishop3y">@y3bishop3y</a> on 2025-05-20 20:49</div>
            <div class="timeline-body"><h1>Description</h1>
<p>When using ty with SQLAlchemy 2.0, it fails to recognize the <code>Mapped</code> and <code>mapped_column</code> types, which are core features of SQLAlchemy 2.0's ORM.</p>
<p>Error Message:</p>
<pre><code>error[unresolved-import]: Module `sqlalchemy.orm` has no member `mapped_column`
  --&gt; backend/db/models/packet.py:35:45
   |
33 | from sqlalchemy import (BigInteger, Boolean, DateTime, Float, ForeignKey,
34 |                         Integer, SmallInteger, String, func, select)
35 | from sqlalchemy.orm import Mapped, Session, mapped_column
   |                                             ^^^^^^^^^^^^^
36 |
37 | from backend.db.utils.query_utils import (FilterCondition, FilterOperator,
   |
info: rule `unresolved-import` is enabled by default
</code></pre>
<h3>Environment Details</h3>
<p>Ty version: [your version here]
SQLAlchemy version: 2.0.41
Dependency management: Poetry
Python version: [your version here]</p>
<h3>Verification Steps</h3>
<p>I've verified that these types do exist in my environment:</p>
<pre><code class="language-bash">$ echo &quot;from sqlalchemy.orm import Mapped, mapped_column; print(Mapped, mapped_column)&quot; &gt; test_sqlalchemy.py
$ python test_sqlalchemy.py
&lt;class 'sqlalchemy.orm.base.Mapped'&gt; &lt;function mapped_column at 0x10389ee80&gt;
</code></pre>
<h3>Additional Information</h3>
<p>There are no type stubs available for SQLAlchemy 2.0:</p>
<pre><code>$ poetry add --dev &quot;types-sqlalchemy&gt;=2.0.0&quot;
Could not find a matching version of package types-sqlalchemy
</code></pre>
<p>SQLAlchemy 2.0 includes its own type annotations, which should be detected by Ty</p>
<h3>Current Workaround</h3>
<p>Currently using type ignore comments:</p>
<pre><code class="language-python">from sqlalchemy.orm import Mapped, Session, mapped_column  # type: ignore[attr-defined]
</code></pre>
<p>Any guidance on how to properly configure ty to recognize SQLAlchemy 2.0 types would be appreciated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-20 21:08</div>
            <div class="timeline-body"><p>What is likely happening here is that ty is finding a Python environment different from the poetry environment, and the Python environment ty is finding has an older version of SQLAlchemy installed in it.</p>
<p>I've confirmed that if I create a poetry project with a dependency on SQLAlchemy 2, and then run ty in such a way that it can discover the poetry environment, it has no trouble finding e.g. <code>sqlalchemy.orm.mapped_column</code>. Ways that I've tested that work:</p>
<ul>
<li>Add ty as a poetry dev dependency and then run it as <code>poetry run ty check</code> -- this ensures that poetry sets <code>VIRTUAL_ENV</code> to point to the Poetry env, and ty uses <code>VIRTUAL_ENV</code> to find your Python environment.</li>
<li>Manually use <code>$(poetry env activate)</code> to activate Poetry's venv, which has the same effect, and then run ty.</li>
<li>Manually point ty to the Poetry env using ty's <code>--python</code> flag (this is inconvenient since Poetry hides its envs in a distant cache location with a long and obscure path, but it works.)</li>
</ul>
<p>The full documentation for ty's Python environment discovery is at https://github.com/astral-sh/ty/blob/main/docs/README.md#python-environment</p>
<p>Closing this for now since it doesn't seem to be a ty issue, but feel free to reopen if you have more detailed information that suggests it might be!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @carljm on 2025-05-20 21:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-05-20 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @carljm on 2025-05-20 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-05-20 21:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:05 UTC
    </footer>
</body>
</html>
