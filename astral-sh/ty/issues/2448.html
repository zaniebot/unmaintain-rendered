<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emit diagnostics for generic class parameterized with a single-element tuple of types if the generic class accepts only a single type argument - astral-sh/ty #2448</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Emit diagnostics for generic class parameterized with a single-element tuple of types if the generic class accepts only a single type argument</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2448">#2448</a>
        opened by <a href="https://github.com/hyperkai">@hyperkai</a>
        on 2026-01-11 17:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hyperkai">@hyperkai</a></div>
            <div class="timeline-body">Summary
<p>*Memo:</p>
<ul>
<li>ty check</li>
<li>ty 0.0.7</li>
<li>Python 3.14.0</li>
</ul>
<p>A generic type argument accepts a tuple as shown below:</p>
<pre><code>       # â†“â†“â†“â†“â†“â†“
v1: list[(int,)]
v1 = [0, 1, 2]       # No error
v1 = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;] # Error

       # â†“â†“â†“â†“â†“â†“
v2: list[(str,)]
v2 = [0, 1, 2]       # Error
v2 = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;] # No error
</code></pre>
<pre><code>        # â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“
v1: tuple[(int, ...)]
v1 = (0, 1, 2)       # No error
v1 = (&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;) # Error

        # â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“
v2: tuple[(str, ...)]
v2 = (0, 1, 2)       # Error
v2 = (&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;) # No error
</code></pre>
Version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-11 17:36</div>
            <div class="timeline-body"><p><code>tuple[(int, ...)]</code> and <code>tuple[(str, ...)]</code> seem fine to me, since they have almost exactly the same AST as <code>tuple[int, ...]</code> and <code>tuple[str, ...]</code> (respectively). I agree we should emit diagnostics for <code>list[(int,)]</code> and <code>list[(str,)]</code>, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;A generic type argument accepts a tuple&quot; to &quot;Emit diagnostics for generic class parameterized with a single-element tuple of types if the generic class accepts only a single type argument&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-11 17:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2026-01-12 05:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2026-01-12 06:13</div>
            <div class="timeline-body"><blockquote>
<p>I agree we should emit diagnostics for <code>list[(int,)]</code> and <code>list[(str,)]</code>, though.</p>
</blockquote>
<p>I don&#x27;t think we should emit a diagnostic here as this is a valid specialization because a tuple of types gets matched against individual type parameters in the generic class in the same way as <code>list[int, str]</code> (which is a tuple in the AST) or <code>list[(int, str)]</code> does. None of the other type checkers emit a diagnostic either.</p>
<p>@hyperkai Can you clarify what issue are you facing? Are you expecting that ty should raise an error where you&#x27;ve mentioned &quot;No error&quot; as a comment? Or is it something else?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> removed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2026-01-12 06:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2026-01-12 06:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-12 12:43</div>
            <div class="timeline-body"><p>The same issue was reported to mypy and the maintainers there made a similar argument to @dhruvmanila that <code>list[(int,)]</code> should be considered valid: <a href="https://github.com/python/mypy/issues/20563">python/mypy#20563</a>. It does at the very least seem &quot;highly distasteful&quot; to me, but I can see the consistency argument for allowing it ðŸ˜†</p>
<p>Pyrefly also got the same bug report, but the pyrefly maintainers haven&#x27;t made a decision yet: <a href="https://github.com/facebook/pyrefly/issues/2063">facebook/pyrefly#2063</a>. Pyright, too -- <a href="https://github.com/microsoft/pyright/issues/11224">microsoft/pyright#11224</a> -- though the rationale given there for closing that issue doesn&#x27;t seem to me to be accurate (<code>list[(int,)]</code> is not &quot;the same&quot; as <code>list[int]</code> -- they have very different ASTs, even if type checkers can reasonably choose to treat them differently.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 13:14</div>
            <div class="timeline-body"><blockquote>
<p>though the rationale given there for closing that issue doesn&#x27;t seem to me to be accurate (list[(int,)] is not &quot;the same&quot; as list[int]</p>
</blockquote>
<p>I believe the intended argument is that <code>list[(int,)]</code> and <code>list[int,]</code> parse to the same AST:</p>
<pre><code>&gt;&gt;&gt; ast.dump(ast.parse(&#x27;list[(int,)]&#x27;))
&quot;Module(body=[Expr(value=Subscript(value=Name(id=&#x27;list&#x27;, ctx=Load()), slice=Tuple(elts=[Name(id=&#x27;int&#x27;, ctx=Load())], ctx=Load()), ctx=Load()))])&quot;
&gt;&gt;&gt; ast.dump(ast.parse(&#x27;list[int,]&#x27;))
&quot;Module(body=[Expr(value=Subscript(value=Name(id=&#x27;list&#x27;, ctx=Load()), slice=Tuple(elts=[Name(id=&#x27;int&#x27;, ctx=Load())], ctx=Load()), ctx=Load()))])&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-12 13:16</div>
            <div class="timeline-body"><blockquote>
<p>I believe the intended argument is that <code>list[(int,)]</code> and <code>list[int,]</code> parse to the same AST:</p>
</blockquote>
<p>I understand that, but the relevant question is not whether we should treat <code>list[(int,)]</code> the same as <code>list[int,]</code>. I agree we should treat those two the same, and I said as much in <a href="https://github.com/astral-sh/ty/issues/2448">astral-sh/ty#2448</a>#issuecomment-3735144048. The relevant question is whether we should treat <code>list[(int,)]</code> or <code>list[int,]</code> the same as <code>list[int]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-12 23:55</div>
            <div class="timeline-body"><p><code>list[int,]</code> and <code>list[int]</code> are different in the AST, sure, but I don&#x27;t think they should be treated differently in the type system. The &quot;fiction&quot; of type arguments is that you provide a comma-separated &quot;list&quot; (using the general meaning here, not the Python container type meaning) of N type arguments (very similar to function arguments) when specializing a generic type with N type parameters. For all N != 1, that syntactically means you provide a tuple. <code>list[int,]</code> is just generalizing that to the case of N == 1 also, instead of taking advantage of the &quot;special case&quot; of providing a non-tuple for N == 1. Visually, it just looks like a trailing comma, which in most cases where a &quot;list of things&quot; is expected (e.g. function arguments) is fine, and not semantically meaningful.</p>
<p>Note that at runtime both result in exactly the same <code>GenericAlias</code> object -- runtime treats the non-tuple N == 1 case as a special case, and normalizes <code>__args__</code> to a length-1 tuple:</p>
<pre><code>&gt;&gt;&gt; list[int].__args__
(&lt;class &#x27;int&#x27;&gt;,)
&gt;&gt;&gt; list[(int,)].__args__
(&lt;class &#x27;int&#x27;&gt;,)
</code></pre>
<p>I don&#x27;t think there&#x27;s any particular <em>reason</em> to use <code>list[(int,)]</code>, but I think there&#x27;s no harm in allowing it, and it is more consistent to allow it than not. (This reminds me of the case of <code>Union[()]</code>, which raises an error at runtime, which I think was a bad choice -- there&#x27;s no harm in interpreting it as <code>Never</code>, and it would be more consistent to do so.)</p>
<p>Not closed to more discussion here if someone feels this is important, but I think our current behavior here is consistent and fine, and also shared by all other type checkers. And either way this is unimportant and not something we should spend more time on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2026-01-12 23:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:05 UTC
    </footer>
</body>
</html>
