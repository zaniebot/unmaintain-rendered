<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>remove inferred bivariance - astral-sh/ty #1728</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>remove inferred bivariance</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1728">#1728</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-12-02 19:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>We infer bivariance when it is sound to do so; that is, when a type variable is unused in the body of a class:</p>
<pre><code class="language-py">class C[T]:
    pass
</code></pre>
<p>Since this type variable is unused, any specialization of <code>C</code> is equivalent to any other specialization -- it does not matter how you specialize <code>C</code>. In other words, <code>C</code> is bivariant in <code>T</code>.</p>
<p>So our behavior here is correct. But it is confusing, and not useful. We repeatedly run into issues in our test suite where we accidentally make a class bivariant in a typevar and then tests pass for the wrong reason, or fail unexpectedly, since bivariance is not intuitive (covariance is the intuitive expectation).</p>
<p>We should at least emit a diagnostic when we infer a typevar as bivariant (since it indicates the typevar is useless and could just be removed). And we should probably also go ahead and just infer the typevar as covariant in that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-02 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by @carljm on 2025-12-02 19:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:08 UTC
    </footer>
</body>
</html>
