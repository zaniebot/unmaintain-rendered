<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code blocks opening and closing backticks don't match - astral-sh/ty #2291</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Code blocks opening and closing backticks don't match</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2291">#2291</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-12-31 08:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-31 08:22</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hover <code>EncoderDecoderCache</code> in https://play.ty.dev/625b8706-3dac-457b-8909-51c78e5d2667 and note how the code block has many opening backticks but only 3 closing backticks</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Pre-stable 1" by @MichaReiser on 2025-12-31 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2025-12-31 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-31 08:28</div>
            <div class="timeline-body"><p>@Gankra, here's an example where our markdown parsing seems to break down</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @MichaReiser on 2025-12-31 08:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2025-12-31 08:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2026-01-04 18:58</div>
            <div class="timeline-body"><p>Ah this is &quot;cute&quot; -- I believe we don't actually try to parse markdown code fences, because leaving them verbatim is the desire... but that also means we don't disable any of our parsing and so we immediately see the PS1 prompts and make our own code fence inside the code fence and mess up the real code fence!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2026-01-04 19:00</div>
            <div class="timeline-body"><p>We end up generating:</p>
<pre><code>   ```python
   `````````python
   &gt;&gt;&gt; blahblah
   ```
   `````````</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2026-01-04 19:09</div>
            <div class="timeline-body"><p>This is possibly the first serious instance of &quot;of course you're parsing reST-markdown soup, just handle both at once!&quot; (a quick skim doesn't reveal any reference to markdown codefences being valid reST/sphinx syntax, but I'm not sure that means much).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Gankra on 2026-01-05 12:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:51:35 UTC
    </footer>
</body>
</html>
