<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failure to select specialization for union of non-final generic classes - astral-sh/ty #1772</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failure to select specialization for union of non-final generic classes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1772">#1772</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-12-05 13:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><p>We currently fail to select a useful specialization for the call to <code>extract_t</code> here:</p>
<pre><code>class P[T]:
    x: T

class Q[T]:
    x: T

def extract_t[T](x: P[T] | Q[T]) -&gt; T:
    raise NotImplementedError

reveal_type(extract_t(P[int]()))  # revealed: Unknown
</code></pre>
<p>https://play.ty.dev/f21605e1-a6d1-4b08-9f8c-c608fe0cbc22</p>
<p>Note that there is some ambiguity here, because of multiple inheritance. But we should still be able to solve for <code>T</code>. Note that it works fine if the classes are <code>final</code>: https://play.ty.dev/a3821fe3-ace6-402d-b257-b74f1fd74238</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-05 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-05 16:06</div>
            <div class="timeline-body"><p>This is similar to the case in <a href="https://github.com/astral-sh/ty/issues/1703">astral-sh/ty#1703</a>, except in that case there are two different typevars in branches of the union, rather than the same typevar. It seems likely (but not certain) that both issues might have the same fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-12-05 16:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-05 16:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Failure to select specialization for union on non-final generic classes&quot; to &quot;Failure to select specialization for union of non-final generic classes&quot; by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-08 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-09 15:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:17 UTC
    </footer>
</body>
</html>
