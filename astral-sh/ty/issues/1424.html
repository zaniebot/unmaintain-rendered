<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cli output is missing a newline - astral-sh/ty #1424</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>cli output is missing a newline</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1424">#1424</a>
        opened by <a href="https://github.com/zilto">@zilto</a>
        on 2025-10-23 17:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zilto">@zilto</a> on 2025-10-23 17:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When running <code>ty check</code> inside a <code>pre-commit</code> or <code>prek</code> hook, the progress bar is caught by the logs. This problem is worsed when running ty via pre-commit inside a GitHub actions because the progress bar refresh adds log lines. It's also missing a new line after the <code>9/9 files</code> (end of progress bar).</p>
<p>The command output renders correctly in a terminal but not inside pre commits</p>
<p>For example</p>
<pre><code>ty-check.................................................................Failed
- hook id: ty-check
- exit code: 1
  Uninstalled 2 packages in 19ms
Installed 4 packages in 6ms
  WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
Checking ------------------------------------------------------------ 9/9 files path/to/file:17:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `list[Foo | ((...) -&gt; Any)] | None`, found `tuple[FunctionType, ...]`
  Found 1 diagnostic
error: Recipe `type-check` failed on line 20 with exit code 1
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.19</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @AlexWaygood on 2025-10-23 17:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-23 17:20</div>
            <div class="timeline-body"><p>We should probably not show a progress when running ty inside pre-commit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-23 17:28</div>
            <div class="timeline-body"><p>I don't think this is an issue specific to pre-commit. I think OP here is right that something's funny with how we're rendering diagnostics currently. See for example the way the primary diagnostic appears on the same line as the progress bar in https://github.com/astral-sh/ty/issues/1425#issue-3545768233 -- you have to scroll a long way to the right before you see the first line of the diagnostic.</p>
<p>https://github.com/user-attachments/assets/4a0a8bca-9085-465c-8a84-fbdfda37ccca</p>
<p>I've noticed this myself when copying and pasting diagnostics into GitHub issues recently. Not sure what's up here, as things look fine when I execute ty directly from the terminal, but what is rendered as a newline on the terminal doesn't seem to be rendered as a newline when you copy-and-paste it elsewhere</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-23 17:38</div>
            <div class="timeline-body"><p>I'm not sure if those are related. I also can't reproduce this</p>
<pre><code>Checking ------------------------------------------------------------ 1/1 files                                                                                                                                                                                                                                                                                                                                                  warning[undefined-reveal]: `reveal_type` used without importing it
 --&gt; main.py:5:1
  |
3 |         self.x = (other.x, 1)
4 |
5 | reveal_type(C().x)  # revealed: Unknown | tuple[Divergent, Literal[1]]
  | ^^^^^^^^^^^
  |
info: This is allowed for debugging convenience but will fail at runtime
info: rule `undefined-reveal` is enabled by default

info[revealed-type]: Revealed type
 --&gt; main.py:5:13
  |
3 |         self.x = (other.x, 1)
4 |
5 | reveal_type(C().x)  # revealed: Unknown | tuple[Divergent, Literal[1]]
  |             ^^^^^ `Unknown | tuple[Divergent, Literal[1]]`
  |

Found 2 diagnostics
</code></pre>
<p>copies just fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-23 17:40</div>
            <div class="timeline-body"><blockquote>
<p>I also can't reproduce this</p>
</blockquote>
<p>what do you mean? The example you copied and pasted <em>does</em> reproduce this üòÜ</p>
<p>https://github.com/user-attachments/assets/5969194d-8980-454b-acb6-6d3ffdb35f5c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-23 17:44</div>
            <div class="timeline-body"><p><img width="1255" height="899" alt="Image" src="https://github.com/user-attachments/assets/21426f30-1bf3-4410-af7e-3403a9975d04" /></p>
<p>Uhm, this could be a github issue?</p>
<p>but it's possible that we need to render a newline somewhere</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-23 17:46</div>
            <div class="timeline-body"><p>it <em>might</em> be a different issue, but I think it may well be related to the pre-commit issue that the OP is reported, because the newline is missing in the same place that OP reported it being missing here (between the progress bar and the first line of the diagnostic). This is the relevant line from the pre-commit output that OP pasted:</p>
<blockquote>
<pre><code>Checking ------------------------------------------------------------ 9/9 files path/to/file:17:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `list[Foo | ((...) -&gt; Any)] | None`, found `tuple[FunctionType, ...]`
</code></pre>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zilto">@zilto</a> on 2025-10-23 19:32</div>
            <div class="timeline-body"><p>I have no idea about the internals of <code>ty</code> and how the CLI works. My humble guess is:</p>
<ol>
<li>progress bar is drawn once</li>
<li>progress bar updates redraw the same line until completion</li>
<li>diagnostic is printed</li>
</ol>
<p>step 2 should probably add a <code>newline</code> after the last update showing <code>..... n/n files</code>.</p>
<p>Also, if that helps, I'm on Ubuntu and using <code>zsh</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-23 19:43</div>
            <div class="timeline-body"><blockquote>
<p>Uhm, this could be a github issue?</p>
</blockquote>
<p>Copying and pasting diagnostics from the terminal into https://www.soscisurvey.de/tools/view-chars.php also reports that there is no newline in between the progress bar and the first line of the diagnostic, FWIW</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zilto">@zilto</a> on 2025-10-23 19:48</div>
            <div class="timeline-body"><p>Another hint that there are 2 mechanisms writing to the terminal output is that redirecting the results to <code>logs.txt</code> shows the progress bar in the terminal but not the logs</p>
<pre><code class="language-shell">‚ùØ ty check --output-format concise . &gt; logs.txt
# output following directly the command on the next line
WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
Checking ------------------------------------------------------------ 9/9 files     
</code></pre>
<pre><code class="language-txt"># logs.txt
path/to/file.py:17:9: error[invalid-argument-type] Argument to bound method `__init__` is incorrect: Expected `list[foo | ((...) -&gt; Any)] | None`, found `tuple[FunctionType, ...]`
Found 1 diagnostic
</code></pre>
<p>I'm guessing the progress bar is &quot;printed&quot; and the diagnostic is &quot;output&quot;. In the context of pre-commit, they're both redirected to the same place and the lack of newline between the two causes the issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 08:13</div>
            <div class="timeline-body"><p>https://github.com/console-rs/indicatif/issues/695</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zilto">@zilto</a> on 2025-10-24 13:19</div>
            <div class="timeline-body"><p>@MichaReiser Thanks for sharing. I commented there too.</p>
<p>Currently, the progress bar has 2 issues:</p>
<ul>
<li>each redraw adds a line to GitHub Actions logs</li>
<li>the last line of the progress bar doesn't use <code>newline</code> before returning diagnostics</li>
</ul>
<p>In the meantime, would it be possible to add a flag to disable the progress bar? <code>--no-progress</code> is seen in <code>uv</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 13:31</div>
            <div class="timeline-body"><p>A <code>--no-progress</code> option is certainly somewhing we can do but is probably worth tracking separately</p>
<p>Edit, see https://github.com/astral-sh/ruff/pull/21063</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-10-24 15:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:38 UTC
    </footer>
</body>
</html>
