<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build failure with maturin 1.8.7: &quot;unsupported Zip archive: Unsupported compression level&quot; - astral-sh/ty #656</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Build failure with maturin 1.8.7: &quot;unsupported Zip archive: Unsupported compression level&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/656">#656</a>
        opened by <a href="https://github.com/gyscos">@gyscos</a>
        on 2025-06-14 14:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gyscos">@gyscos</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>On a fresh checkout (0.0.1-alpha.10, commit 15bae14c22e2bb3673b379fa6367c19c9aa00235), with maturin 1.8.7 installed, running <code>maturin buid</code> in this repo results in this error message:</p>
<pre><code>...
   Compiling ty_project v0.0.0 (/home/gyscos/fetched/ty/ruff/crates/ty_project)
   Compiling ty_server v0.0.0 (/home/gyscos/fetched/ty/ruff/crates/ty_server)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 25.39s
ðŸ’¥ maturin failed
  Caused by: unsupported Zip archive: Unsupported compression level
</code></pre>
<p>With maturin 1.8.6, the same command works fine.</p>
<p>This is running on an up-to-date archlinux system with the official maturin package.</p>
<p>Might be related to https://github.com/PyO3/maturin/pull/2625.</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gyscos">@gyscos</a> on 2025-06-15 02:03</div>
            <div class="timeline-body"><p>Looks like it's probably entirely on maturin's fault: https://github.com/PyO3/maturin/pull/2644</p>
<p>I'll close this ticket as I don't think there's much that can be done here.</p>
<p>Using the git version of maturin indeed solves the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @gyscos on 2025-06-15 02:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-15 02:24</div>
            <div class="timeline-body"><p>(Sorry if unhelpful but is there a specific reason you need a wheel? I'd suggest just running <code>cargo build</code> instead.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gyscos">@gyscos</a> on 2025-06-15 11:06</div>
            <div class="timeline-body"><p>I don't think I need a wheel. This is happening during the packaging for <a href="https://aur.archlinux.org/packages/ty">the archlinux AUR package</a>.</p>
<p>Do you have recommended build instructions for this? The current PKGBUILD might not be optimal.</p>
<p><a href="https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=ty#n30">The current build function</a> runs:</p>
<pre><code>  maturin build --locked --release --all-features --target &quot;$(rustc -vV | sed -n 's/host: //p')&quot; --strip
</code></pre>
<p>(Mostly taking <a href="https://gitlab.archlinux.org/archlinux/packaging/packages/ruff/-/blob/main/PKGBUILD?ref_type=heads#L36">the ruff archlinux package</a> as inspiration.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:09 UTC
    </footer>
</body>
</html>
