<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider more precise return type for dynamic overload calls, if all overload returns share some component - astral-sh/ty #2308</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider more precise return type for dynamic overload calls, if all overload returns share some component</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2308">#2308</a>
        opened by <a href="https://github.com/Drizzelkun">@Drizzelkun</a>
        on 2026-01-02 20:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Drizzelkun">@Drizzelkun</a></div>
            <div class="timeline-body">Question
<p>When calling <code>plt.subplots</code> (possibly any overloaded function) with dynamic kwargs ty is unable to infer the type of <code>fig</code> even though all overloaded function calls return a 2-item tuple where the first item is always Figure. So no matter what kwargs could possibly provide, the first unpacked item must always be Figure.</p>
<p>I assume this is already tracked somewhere so I&#x27;m hesitant to create a bug report but I couldn&#x27;t find a specific matching issue.</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/98448e31-527c-47e2-80b1-4587c68a40f4"></p>
Version
<p>ty 0.0.8 (aa7559db8 2025-12-29</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/Drizzelkun">@Drizzelkun</a> on 2026-01-02 20:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-04 21:20</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>This behavior is actually mandated by the typing spec currently, and it is the same behavior as mypy and pyright. (I reproduced it using this standalone snippet: https://play.ty.dev/c01994b8-d5c7-4589-b470-eead268bddeb)</p>
<p>It is true that in some cases a more precise type could safely be inferred without causing false positives, if all overloads return a common outer type, by pushing down the <code>Unknown</code> to the point where they differ (and inferring e.g. <code>tuple[int, Unknown]</code> instead of <code>Unknown</code> in my example.) This seems doable, but probably not an immediate priority for us, given that our current behavior is mandated by spec and shared by all type checkers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/carljm">@carljm</a> on 2026-01-04 21:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">overloads</span> added by <a href="https://github.com/carljm">@carljm</a> on 2026-01-04 21:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Unknown inlayHint for theoretically narrowed type in overloaded function known?&quot; to &quot;Consider more precise return type for dynamic overload calls, if all overload returns share some component&quot; by <a href="https://github.com/carljm">@carljm</a> on 2026-01-04 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Drizzelkun">@Drizzelkun</a> on 2026-01-05 17:04</div>
            <div class="timeline-body"><p>Thanks for the answer.</p>
<p>Where can I find the spec to read? It might help me in the future to clear up confusions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-05 17:07</div>
            <div class="timeline-body"><p>It&#x27;s here: https://typing.python.org/en/latest/spec/. The overload evaluation algorithm is here: https://typing.python.org/en/latest/spec/overload.html#overload-call-evaluation. The conformance test suite is here: https://github.com/python/typing/tree/main/conformance</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:53 UTC
    </footer>
</body>
</html>
