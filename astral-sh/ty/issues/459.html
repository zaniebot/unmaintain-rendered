<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily property test run failed on Tue May 20 2025 - astral-sh/ty #459</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Daily property test run failed on Tue May 20 2025</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/459">#459</a>
        opened by <a href="https://github.com/github-actions">@github-actions</a>
        on 2025-05-20 12:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/github-actions">@github-actions</a> on 2025-05-20 12:05</div>
            <div class="timeline-body"><p>Run listed here: https://github.com/astral-sh/ty/actions/runs/15136976142</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @github-actions[bot] on 2025-05-20 12:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type properties</span> added by @github-actions[bot] on 2025-05-20 12:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2025-05-20 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-20 15:47</div>
            <div class="timeline-body"><p>Minimal repro:</p>
<pre><code class="language-py">from ty_extensions import static_assert, is_equivalent_to, TypeOf

static_assert(is_equivalent_to(TypeOf[int.bit_length], TypeOf[int.bit_length]))
</code></pre>
<p>The assertion now fails on <code>main</code></p>
<p>The definition for <code>int.bit_length()</code> is about as simple as it gets:</p>
<p>https://github.com/astral-sh/ruff/blob/60b486abce4e756fbd26a586a03d551ba44b9ea8/crates/ty_vendored/vendor/typeshed/stdlib/builtins.pyi#L253</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-20 15:52</div>
            <div class="timeline-body"><p>(Confirmed that this passed before https://github.com/astral-sh/ruff/commit/97058e80930969d63bc2cdc6fcff8f84a2d7de4e but fails on that commit)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-20 15:55</div>
            <div class="timeline-body"><p>This also fails, which I think confirms that we do not consider the type equivalent to itself anymore:</p>
<pre><code class="language-py">type X = TypeOf[int.bit_length]

static_assert(is_equivalent_to(X, X))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-20 16:00</div>
            <div class="timeline-body"><p>Even simpler:</p>
<pre><code class="language-py">from ty_extensions import is_equivalent_to, TypeOf

def f(): ...

reveal_type(is_equivalent_to(TypeOf[f], TypeOf[f]))  # revealed: Literal[False] ??
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-05-20 16:17</div>
            <div class="timeline-body"><p>@carljm, @AlexWaygood and I just discussed this at the PyCon sprint. The issue is that as of https://github.com/astral-sh/ruff/pull/18155, we take the parameter/return type annotations into account when comparing function literals for subtyping/equivalence. If an annotation is not given, we fall back on <code>Unknown</code>, which is gradual. But I did not also update <code>is_fully_static</code> to take this into account. So the subtyping/equivalence checks would return <code>False</code> when encountering the unannotated parameter/return in.</p>
<p>For now we are going to fix the glitch by updating <code>is_fully_static</code> to be consistent with the other methods. A longer term fix is to have separate representations for function literals and specialized functions, similar to the distinction we already make between <code>ClassLiteral</code> and <code>ClassType</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-05-20 18:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:04 UTC
    </footer>
</body>
</html>
