<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrectly inferred Pandas indexing return type - astral-sh/ty #851</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrectly inferred Pandas indexing return type</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/851">#851</a>
        opened by <a href="https://github.com/kormalev">@kormalev</a>
        on 2025-07-18 11:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kormalev">@kormalev</a> on 2025-07-18 11:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>ty incorrectly thinks Pandas boolean indexing returns Series.</p>
<p>Reproducible example:</p>
<pre><code class="language-python">import pandas as pd


def filter_data(data: pd.DataFrame) -&gt; pd.DataFrame:
    return data[(data[&quot;a&quot;] == 1)]


data = pd.DataFrame(
    {
        &quot;a&quot;: [1, 2, 3, 4],
        &quot;b&quot;: [4, 3, 2, 1],
    }
)

print(filter_data(data))
</code></pre>
<pre><code class="language-text">&gt; ty version
ty 0.0.1-alpha.14 (3ececb07e 2025-07-08)
&gt; ty check pandas-demo.py
WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
error[invalid-return-type]: Return type does not match returned value
 --&gt; pandas-demo.py:4:40
  |
4 | def filter_data(data: pd.DataFrame) -&gt; pd.DataFrame:
  |                                        ------------ Expected `DataFrame` because of return type
5 |     return data[data[&quot;a&quot;] == 1]
  |            ^^^^^^^^^^^^^^^^^^^^ expected `DataFrame`, found `Series[Any]`
  |
info: rule `invalid-return-type` is enabled by default

Found 1 diagnostic
</code></pre>
<p>Pandas version is 2.3.0</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-07-18 23:29</div>
            <div class="timeline-body"><p>I think this is because <code>Scalar</code> is a type alias defined using <code>TypeAlias</code>, which we don't support yet (#544), which means we match the wrong overload of <code>__getitem__</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-07-18 23:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-12 01:57</div>
            <div class="timeline-body"><p>Confirmed this will be fixed by https://github.com/astral-sh/ruff/pull/21394</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:18 UTC
    </footer>
</body>
</html>
