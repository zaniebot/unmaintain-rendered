<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: better diagnostics when instance does not satisfy `abc.collections.&lt;Class&gt;` - astral-sh/ty #2390</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: better diagnostics when instance does not satisfy `abc.collections.&lt;Class&gt;`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2390">#2390</a>
        opened by <a href="https://github.com/NickCrews">@NickCrews</a>
        on 2026-01-08 03:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NickCrews">@NickCrews</a> on 2026-01-08 03:53</div>
            <div class="timeline-body"><p>I am working in the ibis project, trying to fix up its typing so that <a href="https://github.com/ibis-project/ibis/blob/e5921c9a851afc8fd3980f6a0bbfd73720b4d5d6/ibis/expr/schema.py#L25">it's <code>Schema</code> class</a> typechecks against a <code>collections.abc.Mapping[str, ibis.DataType]</code>. It currently does not.</p>
<p>You can reproduce this with <code>uv pip install ibis-framework</code> and then</p>
<pre><code class="language-python">from collections.abc import Mapping

import ibis

s: Mapping[str, ibis.DataType] = ibis.schema({&quot;a&quot;: &quot;int64&quot;, &quot;b&quot;: &quot;string&quot;})
</code></pre>
<p>This gives the type error <code>Object of type `Schema` is not assignable to `Mapping[str, DataType]`: Incompatible value of type `Schema`ty[invalid-assignment](https://ty.dev/rules#invalid-assignment)</code></p>
<p>It would be great if this error message instead told me why it isn't assignable. What required methods does it not implement? Is it that the methods have the wrong signatures? Or gave some more actionable advice, like I need to make ibis.Schema inherit from collections.abc.Mapping or call <code>collections.abc.Mapping.register(ibis.Schema)</code></p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-08 13:27</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2026-01-08 13:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:51:35 UTC
    </footer>
</body>
</html>
