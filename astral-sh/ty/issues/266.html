<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`possibly-unresolved-reference` with conditional assignment and guarded usage - astral-sh/ty #266</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>possibly-unresolved-reference</code> with conditional assignment and guarded usage</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/266">#266</a>
        opened by <a href="https://github.com/my1e5">@my1e5</a>
        on 2025-05-08 10:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/my1e5">@my1e5</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I’m seeing a <code>possibly-unresolved-reference</code> warning for a common pattern I use with <code>tqdm</code> progress bars. The warning may be completely valid, but I wanted to mention it since mypy doesn’t flag it.</p>
<p>https://play.ty.dev/ec8d3619-1214-4d3c-aba4-f7578d1502a7</p>
<pre><code class="language-py"># /// script
# requires-python = &quot;&gt;=3.13&quot;
# dependencies = [
#     &quot;tqdm&quot;,
# ]
# ///

import time

from tqdm import tqdm


def run(n: int, *, show_progress: bool = True) -&gt; None:
    &quot;&quot;&quot;Run a loop with an optional progress bar.&quot;&quot;&quot;

    def callback() -&gt; None:
        time.sleep(0.1)
        if show_progress:
            pbar.update()

    if show_progress:
        pbar = tqdm(total=n)

    for _ in range(n):
        callback()

    if show_progress:
        pbar.close()


if __name__ == &quot;__main__&quot;:
    run(10, show_progress=True)
</code></pre>
<h3>ty</h3>
<pre><code>$ uvx ty check foo.py
warning: lint:possibly-unresolved-reference: Name `pbar` used when possibly not defined
  --&gt; foo.py:19:13
   |
17 |         time.sleep(0.1)
18 |         if show_progress:
19 |             pbar.update()
   |             ^^^^
20 |
21 |     if show_progress:
   |
info: `lint:possibly-unresolved-reference` is enabled by default

warning: lint:possibly-unresolved-reference: Name `pbar` used when possibly not defined
  --&gt; foo.py:28:9
   |
27 |     if show_progress:
28 |         pbar.close()
   |         ^^^^
   |
info: `lint:possibly-unresolved-reference` is enabled by default

Found 2 diagnostics
</code></pre>
<h3>mypy</h3>
<pre><code>$ uvx --with types-tqdm mypy --strict foo.py
Installed 6 packages in 1.42s
Success: no issues found in 1 source file
</code></pre>
<h3>Version</h3>
<p>ty 0.0.0-alpha.7 (905a3e1e5 2025-05-07)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-08 10:07</div>
            <div class="timeline-body"><p>Mypy does actually emit an error on the exact same line if you pass <code>--enable-error-code=possibly-undefined</code> to mypy: https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;enable-error-code=possibly-undefined&amp;gist=2c55a51cc7c25926197894f7d9a21d14 (mypy's version of this check is not enabled by default).</p>
<p>And pyright, like ty, displays the error by default on the same line: https://pyright-play.net/?pythonVersion=3.12&amp;strict=true&amp;enableExperimentalFeatures=true&amp;code=MQAg9BIM4MYE4EsAOAXAUKOBTAjgVwWygFokBPFACwHsA7EAXhACIA%2BBgZgDoBGD5jCAAmWJFlojaMBFiiMQAbUEgVLFDiEBbZgBpBAXUEQwaNAk1JqcFCBTmspgGZxqm2xrfnL191tNoRRxA4PFoACloALhAEWhQdEAAqBKgaAHcAfSQXAHMiKGiAI2pqABt5ABUQrABKEGJWEAA5OixItFUWZmYAJVCQAEMQUpKkEDSEKkH6alQEOgHy7Oo82TlCgbguboEO1UCQGEXSjZgAazC6hubW9s7Ou00sLihSrFEwgAZeGr37mKCqWomWWqygBT%2B-1USA2WzwSCEAxQWEupk6CEB6SyuXydyhMM28nUWjCKGoKEWDFov0hjisIAyMXocAGtByKOpeP%2BR1KJwG51RkIx0CxoNxkM6BK2MBGUBRNLMQQyGVoAyeysYTGYys0A1iyuYXOCoTCPE%2BKVFOLWDCqeFqaCAA</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @my1e5 on 2025-05-08 10:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:19:47 UTC
    </footer>
</body>
</html>
