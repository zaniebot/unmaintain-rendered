<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>allow TypedDict instance literals - astral-sh/ty #820</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>allow TypedDict instance literals</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/820">#820</a>
        opened by <a href="https://github.com/sslivkoff">@sslivkoff</a>
        on 2025-07-13 03:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sslivkoff">@sslivkoff</a></div>
            <div class="timeline-body"><p>would like ty to allow literal instantiation of TypedDict&#x27;s, as in:</p>
<pre><code>class Config(typing.TypedDict):
    version: str
    tracked_tables: list[TrackedTable]


def get_default_config() -&gt; absorb.Config:
    # doesn&#x27;t work
    return {
        &#x27;version&#x27;: &#x27;0.1.0&#x27;,
        &#x27;tracked_tables&#x27;: [],
    }
</code></pre>
<p>it gives this error:</p>
<pre><code>error[invalid-return-type]: Return type does not match returned value
  --&gt; absorb/ops/config.py:12:29
   |
12 |   def get_default_config() -&gt; Config:
   |                               ------------- Expected `Config` because of return type
13 |       return {
   |  ____________^
14 | |         &#x27;version&#x27;: &#x27;0.1.0&#x27;,
15 | |         &#x27;tracked_tables&#x27;: [],
16 | |     }
   | |_____^ expected `Config`, found `dict[Unknown, Unknown]`
   |
info: rule `invalid-return-type` is enabled by default
</code></pre>
<p>instead I had to convert many parts of my codebase to using this style to pass ty&#x27;s checks:</p>
<pre><code>def get_default_config() -&gt; Config:
    return Config(
        version=absorb.__version__,
        tracked_tables=[],
    )
</code></pre>
<p>this is undesirable because:</p>
<ol>
<li>one of the advantages of TypedDict&#x27;s is being able to use them with normal simple dict syntax</li>
<li>mypy (which I usually use) supports this style of TypedDict instance literals</li>
<li>the two syntaxes are nearly functionally equivalent</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sslivkoff">@sslivkoff</a> on 2025-07-13 03:08</div>
            <div class="timeline-body"><p>two areas where this syntax commonly shows up is 1) in the return values of functions as show above and 2) when trying to assign TypedDict&#x27;s to a variable</p>
<p>this snippet:</p>
<pre><code>class TrackedTable(typing.TypedDict):
    source_name: str
    table_name: str
    table_class: str
    parameters: dict[str, typing.Any]


table_data: TrackedTable = {
    &#x27;source_name&#x27;: source,
    &#x27;table_name&#x27;: table,
    &#x27;table_class&#x27;: &#x27;absorb.datasets.&#x27; + source + &#x27;.&#x27; + camel_table,
    &#x27;parameters&#x27;: {},
}
</code></pre>
<p>gives this ty error:</p>
<pre><code>error[invalid-assignment]: Object of type `dict[Unknown, Unknown]` is not assignable to `TrackedTable`
  --&gt; absorb/ops/coverage.py:41:13
   |
39 |             # TODO: read this information from a metadata.json
40 |             camel_table = absorb.ops.names._snake_to_camel(table)
41 |             table_data: absorb.TrackedTable = {
   |             ^^^^^^^^^^
42 |                 &#x27;source_name&#x27;: source,
43 |                 &#x27;table_name&#x27;: table,
   |
info: rule `invalid-assignment` is enabled by default
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typing semantics</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-14 06:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-14 06:47</div>
            <div class="timeline-body"><p>Thank you for reporting this. At the moment, we do not support <code>TypedDict</code>s at all. This is being tracked in <a href="https://github.com/astral-sh/ty/issues/154">astral-sh/ty#154</a>. There&#x27;s currently no detailed description in that ticket, but
assignments of dict literals to <code>TypedDict</code>s is certainly a core feature that will be implemented as part of this ticket.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-14 06:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-15 11:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:03 UTC
    </footer>
</body>
</html>
