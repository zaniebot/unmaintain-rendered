<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty thinks `Generator[None, None, A]` and `Generator[None, None, B]` are equivalent types on Python &lt;3.13 - astral-sh/ty #2426</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty thinks <code>Generator[None, None, A]</code> and <code>Generator[None, None, B]</code> are equivalent types on Python &lt;3.13</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2426">#2426</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2026-01-09 21:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><pre><code>from ty_extensions import is_equivalent_to, is_subtype_of, static_assert
from typing import Generator

class A: ...
class B: ...

static_assert(not is_equivalent_to(Generator[None, None, A], Generator[None, None, B]))
static_assert(not is_subtype_of(Generator[None, None, A], Generator[None, None, B]))
static_assert(not is_subtype_of(Generator[None, None, B], Generator[None, None, A]))
</code></pre>
<p>https://play.ty.dev/0cd14b68-645f-461b-896a-31f78cc10b6c</p>
<p>The assertions here should pass. They do pass on Python 3.13+, but fail on Python 3.12 or older.</p>
<p>The reason is that <code>Generator</code> is a protocol, and its third type parameter (<code>ReturnT_co</code>) is unused in its interface (as defined in typeshed) in Python earlier than 3.13.</p>
<p>As far as the definition given in typeshed, I think ty&#x27;s conclusion here is correct. But generators are rather special, specifically in that their &quot;return&quot; value also gets wrapped into the <code>StopIteration</code> exception that ends their iteration (even on 3.12 and earlier), but this is not visible in their type system interface. Thus their <code>ReturnT_co</code> always matters (quite a lot -- this is the key mechanism by which async/await works), but typeshed&#x27;s definition doesn&#x27;t make that explicit.</p>
<p>I think we will probably need to special-case this type somehow to understand that its <code>ReturnT_co</code> always matters, even on older Python versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;ty thinks `Generator[None, None, A]` and `Generator[None, None, B]` are equivalent types&quot; to &quot;ty thinks `Generator[None, None, A]` and `Generator[None, None, B]` are equivalent types on Python &lt;3.13&quot; by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 21:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">Protocols</span> added by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 21:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">async</span> added by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 21:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Pre-stable 1&quot; by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 21:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:02 UTC
    </footer>
</body>
</html>
