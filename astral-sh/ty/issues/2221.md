```yaml
number: 2221
title: Improve error messages when narrowing fails
type: issue
state: open
author: mtshiba
labels:
  - diagnostics
  - narrowing
assignees: []
created_at: 2025-12-25T16:48:53Z
updated_at: 2026-01-09T03:32:58Z
url: https://github.com/astral-sh/ty/issues/2221
synced_at: 2026-01-10T01:56:41Z
```

# Improve error messages when narrowing fails

---

_Issue opened by @mtshiba on 2025-12-25 16:48_

When strictly maintaining soundness, narrowing tends to produce results that are quite different from user intuition.
Users may not realize that this is due to the specifications of ty (or Python type system), and may consider it an incompleteness or a bug (e.g. https://github.com/astral-sh/ty/issues/2215).
Therefore, if the cause of the error is thought to be a narrowing failure, it may be better to provide a hint as to why narrowing could not be applied.
Also, in some cases, alternatives can be suggested that make narrowing applicable (such as using `is` instead of `==`, typing explicitly, or marking the class as non-inheritable with `typing.final`).

---

_Label `diagnostics` added by @mtshiba on 2025-12-25 16:48_

---

_Label `narrowing` added by @mtshiba on 2025-12-25 16:48_

---

_Comment by @carljm on 2025-12-26 18:04_

See https://github.com/astral-sh/ty/issues/1578#issuecomment-3542936632 for one concrete idea, that I think could also apply to the case in #2215.

This issue as described seems very broad -- I think we should focus on cases where ty introduces an `object` type due the possibility of subclassing. Current cases of this that come to mind include `hasattr` narrowing and top materializations when `isinstance` narrowing with a generic type.

---

_Added to milestone `Stable` by @carljm on 2026-01-09 03:32_

---
