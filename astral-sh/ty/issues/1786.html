<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rename does not consider all `def/class` statements when rebinding a name - astral-sh/ty #1786</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rename does not consider all `def/class` statements when rebinding a name</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1786">#1786</a>
        opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a>
        on 2025-12-05 19:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-12-05 19:51</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I saw #1784 so decided to mess around with renaming a bit, and was able to find this edge case where I think the wrong set of things is being renamed:</p>
<pre><code class="language-py">A = &quot;&quot;
class A: ...
def A(): ...
print(A)
</code></pre>
<p>This is a bit of an odd case since it's a top level name rebinding, where the current behavior of ty is inconsistent:</p>
<ul>
<li>Cursor on the <code>A = &quot;&quot;</code> or <code>print(A)</code> renames only those two:</li>
</ul>
<p><img width="232" height="142" alt="Image" src="https://github.com/user-attachments/assets/28e9d295-8e6c-4181-909e-87174cb9ffca" /></p>
<p><img width="271" height="136" alt="Image" src="https://github.com/user-attachments/assets/e857b078-c978-45f7-9257-b46929060caf" /></p>
<ul>
<li>Cursor on the <code>class A</code> renames the <code>class A</code>, <code>A = &quot;&quot;</code>, and <code>print(A)</code>, but not the <code>def A</code>:</li>
</ul>
<p><img width="276" height="146" alt="Image" src="https://github.com/user-attachments/assets/76cacc41-02b8-4192-969b-307018f978fe" /></p>
<ul>
<li>Cursor on the <code>def A</code> renames the <code>def A</code>, <code>A = &quot;&quot;</code>, and <code>print(A)</code>, but not the <code>class A</code>:</li>
</ul>
<p><img width="261" height="143" alt="Image" src="https://github.com/user-attachments/assets/53b61564-2180-49cb-a617-0ba6c3d6fd34" /></p>
<p>Ideally ty would not rename a different set of items depending on where you rename from.</p>
<p>(On the playground I couldn't figure out how to enable renaming, but you can still see the same inconsistent set of symbols are considered equivalent by placing the cursor on the different <code>A</code>s and seeing which others are highlighted.)</p>
<h3>Version</h3>
<p>ty VSCode 2025.63.13380910 / playground ef45c97da</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-12-05 19:55</div>
            <div class="timeline-body"><p>(Also just to be clear this is a very minor edge case and I don't think it should block stabilizing renaming)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-12-05 20:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:50 UTC
    </footer>
</body>
</html>
