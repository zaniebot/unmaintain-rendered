<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Returning self as dict value does validate against return type - astral-sh/ty #1436</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Returning self as dict value does validate against return type</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1436">#1436</a>
        opened by <a href="https://github.com/gjcarneiro">@gjcarneiro</a>
        on 2025-10-24 15:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gjcarneiro">@gjcarneiro</a></div>
            <div class="timeline-body">Summary
<p>https://play.ty.dev/fcecf4ca-df7b-4dd5-8922-97219ceb68cf</p>
<pre><code>
from __future__ import annotations

class Account:

    def get_account(self) -&gt; dict[str, Account]:
        return dict(loan=self)
</code></pre>
<pre><code>$ mypy /tmp/xxx.py 
Success: no issues found in 1 source file
$ ty check /tmp/xxx.py 
Checking ------------------------------------------------------------ 1/1 files                                                                                                                                                                                          
/tmp/xxx.py:6:16: error[invalid-return-type] 
Return type does not match returned value: expected `dict[str, Account]`, found `dict[str, Self@get_account]`
Found 1 diagnostic
</code></pre>
Version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bidirectional inference</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-24 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-10-24 20:15</div>
            <div class="timeline-body"><p>I believe we need to special case the <code>dict</code> constructor for this to work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-10-24 20:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:50 UTC
    </footer>
</body>
</html>
