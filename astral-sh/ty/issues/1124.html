<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>support `typing.Self` used as attribute (or dataclass field) type - astral-sh/ty #1124</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>support `typing.Self` used as attribute (or dataclass field) type</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1124">#1124</a>
        opened by <a href="https://github.com/JoanPuig">@JoanPuig</a>
        on 2025-09-03 20:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/JoanPuig">@JoanPuig</a> on 2025-09-03 20:12</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The following code:</p>
<pre><code class="language-py">from dataclasses import dataclass
from typing import Optional, Self


@dataclass(frozen=True)
class MyClass:
    field: Optional[Self] = None


MyClass(MyClass())
</code></pre>
<p>reports the following, which I believe should not be an error:</p>
<pre><code>error[invalid-argument-type]: Argument is incorrect
  --&gt; src\main.py:10:9
   |
10 | MyClass(MyClass())
   |         ^^^^^^^^^ Expected `typing.Self | None`, found `MyClass`
   |
info: rule `invalid-argument-type` is enabled by default

Found 1 diagnostic
</code></pre>
<h3>Version</h3>
<p>0.0.1-alpha.20 (f41f00af1 2025-09-03)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-09-03 20:21</div>
            <div class="timeline-body"><p>There's also this dataclass-less version, which is a bit different in that it doesn't involve a synthesized <code>__init__</code> method, and which we also wrongly error on:</p>
<pre><code class="language-py">from typing import Optional, Self


class MyClass:
    field: Optional[Self] = None


def _(c: MyClass):
    c.field = c
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typing semantics</span> added by @carljm on 2025-09-03 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Typing.Self" to "support `typing.Self` used as attribute (or dataclass field) type" by @carljm on 2025-09-03 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-09-03 20:21</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "GA" by @carljm on 2025-10-10 23:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wizzerinus">@Wizzerinus</a> on 2025-12-26 09:21</div>
            <div class="timeline-body"><p>Another interesting example which does not involve any assignments. I believe it is a special case of this issue, since the diagnostic only occurs if the Self type is used in a field.</p>
<pre><code class="language-py">from typing import Generic, TypeVar, Self


class Fruit:
    consumer: &quot;Consumer[Self] | None&quot; = None


T = TypeVar(&quot;T&quot;, bound=Fruit)


class Consumer(Generic[T]): ...
</code></pre>
<p>Ty output:</p>
<pre><code>error[invalid-type-arguments]: Type `&lt;special-form 'typing.Self'&gt;` is not assignable to upper bound `Fruit` of type variable `T@Consumer`
 --&gt; self_bound.py:5:25
  |
4 | class Fruit:
5 |     consumer: &quot;Consumer[Self] | None&quot; = None
  |                         ^^^^
  |
 ::: self_bound.py:8:1
  |
8 | T = TypeVar(&quot;T&quot;, bound=Fruit)
  | - Type variable defined here
  |
info: rule `invalid-type-arguments` is enabled by default
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Stable" by @carljm on 2025-12-27 00:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Pre-stable 1" by @carljm on 2025-12-27 00:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2026-01-09 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2026-01-09 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2026-01-09 23:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:47:12 UTC
    </footer>
</body>
</html>
