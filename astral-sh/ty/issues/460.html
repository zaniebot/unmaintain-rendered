<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context manager contextlib.nullcontext causes diagnostic - astral-sh/ty #460</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Context manager contextlib.nullcontext causes diagnostic</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/460">#460</a>
        opened by <a href="https://github.com/behrenhoff">@behrenhoff</a>
        on 2025-05-20 12:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/behrenhoff">@behrenhoff</a></div>
            <div class="timeline-body">Summary
<p>Consider the following simple code:</p>
<pre><code>from contextlib import nullcontext


def foo() -&gt; None:
    with nullcontext():
        print(&quot;ok&quot;)
</code></pre>
<p>Then:</p>
<pre><code>$ ty --version
ty 0.0.1-alpha.5

$ ty check ty-test.py                    
WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
error[no-matching-overload]: No overload of bound method `__init__` matches arguments
 --&gt; ty-test.py:5:10
  |
4 | def foo() -&gt; None:
5 |     with nullcontext():
  |          ^^^^^^^^^^^^^
6 |         print(&quot;ok&quot;)
  |
info: First overload defined here
   --&gt; stdlib/contextlib.pyi:188:13
    |
186 |         enter_result: _T
187 |         @overload
188 |         def __init__(self: nullcontext[None], enter_result: None = None) -&gt; None: ...
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
189 |         @overload
190 |         def __init__(self: nullcontext[_T], enter_result: _T) -&gt; None: ...  # pyright: ignore[reportInvalidTypeVarUse]  #11780
    |
info: Possible overloads for bound method `__init__`:
info:   (self: nullcontext[None], enter_result: None = None) -&gt; None
info:   (self: nullcontext[_T], enter_result: _T) -&gt; None
info: rule `no-matching-overload` is enabled by default

Found 1 diagnostic
</code></pre>
<p>I am not exactly sure what is wrong here but the code above should not produce a diagnostic. It seems it has to do with <code>contextlib.nullcontext</code> as the disagnostic does not appear when using <code>pytest.raises</code> instead.</p>
Version
<p>0.0.1-alpha.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-20 12:44</div>
            <div class="timeline-body"><p>I think this has been fixed by <a href="https://github.com/astral-sh/ruff/pull/18155">astral-sh/ruff#18155</a> (and <a href="https://github.com/astral-sh/ruff/pull/18204">astral-sh/ruff#18204</a>), we just haven&#x27;t release a new version yet. I can not reproduce this on <code>main</code> (you can try it on <a href="https://play.ty.dev/9a4f6dd4-af0d-4a60-9704-8939fb550b25">our playground</a>, which runs the latest version on <code>main</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-20 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-20 12:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:35 UTC
    </footer>
</body>
</html>
