<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truncate type display for long unions in some situations - astral-sh/ty #1307</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Truncate type display for long unions in some situations</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1307">#1307</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-10-04 17:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>One of the diagnostics in the ecosystem report for https://github.com/astral-sh/ruff/pull/20368 is:</p>
<pre><code>[error] invalid-argument-type - :1121:30 - Argument is incorrect: Expected `str`, found `Unknown | str | ((sd: @Todo | SpectralDistribution | MultiSpectralDistributions, cmfs: MultiSpectralDistributions | None = None, illuminant: SpectralDistribution | None = None, k: @Todo | None = None, method: str = str, **kwargs: Any) -&gt; @Todo) | ((XYZ: @Todo, method: str = str, **kwargs: Any) -&gt; SpectralDistribution) | ((sd: SpectralDistribution, lef: SpectralDistribution | None = None) -&gt; int | float) | ((XYZ: @Todo) -&gt; @Todo) | ((Y: @Todo) -&gt; @Todo) | ((LV: @Todo, method: str = str, **kwargs: Any) -&gt; @Todo) | partial[Unknown] | ((wavelength: @Todo, cmfs: MultiSpectralDistributions | None = None) -&gt; @Todo) | ((xyY: @Todo) -&gt; @Todo) | ((xy: @Todo) -&gt; @Todo) | ((Lab: @Todo) -&gt; @Todo) | ((Luv: @Todo, illuminant: @Todo = Any) -&gt; @Todo) | ((uv: @Todo) -&gt; @Todo) | ((UVW: @Todo) -&gt; @Todo) | ((Lab_99: @Todo, illuminant: @Todo = Any, k_E: int | float = int, k_CH: int | float = int, method: str = str) -&gt; @Todo) | ((Lab_hdr: @Todo, illuminant: @Todo = Any, Y_s: @Todo = float, Y_abs: @Todo = int, method: str = str) -&gt; @Todo) | ((ICaCb: @Todo) -&gt; @Todo) | ((ICtCp: @Todo, illuminant: @Todo = Any, chromatic_adaptation_transform: @Todo | str | None = str, method: str = str, L_p: int | float = int) -&gt; @Todo) | ((IgPgTg: @Todo) -&gt; @Todo) | ((IPT: @Todo) -&gt; @Todo) | ((XYZ_D65: @Todo, constants: Structure = Structure) -&gt; @Todo) | ((Jzazbz: @Todo, constants: Structure = Structure) -&gt; @Todo) | ((IPT_hdr: @Todo, Y_s: @Todo = float, Y_abs: @Todo = int, method: str = str) -&gt; @Todo) | ((Ljg: @Todo, optimisation_kwargs: dict[Unknown, Unknown] | None = None) -&gt; @Todo) | ((ProLab: @Todo, illuminant: @Todo = Any) -&gt; @Todo) | ((Iab: @Todo) -&gt; @Todo) | ((Yrg: @Todo) -&gt; @Todo) | ((uvV: @Todo) -&gt; @Todo) | ((uvL: @Todo, illuminant: @Todo = Any) -&gt; @Todo) | ((RGB: @Todo) -&gt; @Todo) | ((HSV: @Todo) -&gt; @Todo) | ((HSL: @Todo) -&gt; @Todo) | ((HCL: @Todo, gamma: int | float = int, Y_0: int | float = int) -&gt; @Todo) | ((HYS: @Todo) -&gt; @Todo) | ((CMY: @Todo) -&gt; @Todo) | ((CMYK: @Todo) -&gt; @Todo) | ((Lrgb: @Todo) -&gt; @Todo) | ((YCbCr: @Todo, K: @Todo = Any, in_bits: int = int, in_legal: bool = bool, in_int: bool = bool, out_bits: int = int, out_legal: bool = bool, out_int: bool = bool, clamp_int: bool = bool, **kwargs: Any) -&gt; @Todo) | ((YcCbcCrc: @Todo, in_bits: int = int, in_legal: bool = bool, in_int: bool = bool, is_12_bits_system: bool = bool, **kwargs: Any) -&gt; @Todo) | ((YCoCg: @Todo) -&gt; @Todo) | ((value: @Todo, function: @Todo | str = str, **kwargs: Any) -&gt; @Todo) | ((HEX: @Todo) -&gt; @Todo) | ((keyword: str) -&gt; @Todo) | ((xyY: @Todo, hue_decimals: int = int, value_decimals: int = int, chroma_decimals: int = int) -&gt; str | @Todo) | ((munsell_colour: @Todo) -&gt; @Todo) | (Overload[(sd_test: SpectralDistribution, additional_data: bool = bool, method: str = EllipsisType) -&gt; ColourRendering_Specification_CRI, (sd_test: SpectralDistribution, *, additional_data: bool, method: str = EllipsisType) -&gt; int | float, (sd_test: SpectralDistribution, additional_data: bool, method: str = EllipsisType) -&gt; int | float]) | (Overload[(sd_test: SpectralDistribution, *, additional_data: bool, method: str = EllipsisType) -&gt; int | float, (sd_test: SpectralDistribution, additional_data: bool = bool, method: str = EllipsisType) -&gt; ColourRendering_Specification_CQS, (sd_test: SpectralDistribution, additional_data: bool, method: str = EllipsisType) -&gt; int | float]) | ((CCT_D_uv: @Todo) -&gt; @Todo) | ((mired: @Todo) -&gt; @Todo) | ((specification: CAM_Specification_CIECAM02) -&gt; @Todo) | ((JMh: @Todo) -&gt; CAM_Specification_CIECAM02) | ((specification: CAM_Specification_CAM16) -&gt; @Todo) | ((JMh: @Todo) -&gt; CAM_Specification_CAM16) | ((specification: CAM_Specification_CIECAM16) -&gt; @Todo) | ((JMh: @Todo) -&gt; CAM_Specification_CIECAM16) | ((specification: CAM_Specification_Hellwig2022) -&gt; @Todo) | ((JMh: @Todo) -&gt; CAM_Specification_Hellwig2022) | ((specification: CAM_Specification_sCAM) -&gt; @Todo) | ((JMh: @Todo) -&gt; CAM_Specification_sCAM) | ((JMh: @Todo) -&gt; @Todo) | ((Jpapbp: @Todo) -&gt; @Todo)`
</code></pre>
<p>That's a ridiculously long display for a type, and it's needlessly long. The user has all the information they need after they're presented with the first union element that's not assignable to <code>str</code>. We should instead display something like:</p>
<pre><code>[error] invalid-argument-type - :1121:30 - Argument is incorrect: Expected `str`, found `Unknown | str | ((sd: @Todo | SpectralDistribution | MultiSpectralDistributions, cmfs: MultiSpectralDistributions | None = None, illuminant: SpectralDistribution | None = None, k: @Todo | None = None, method: str = str, **kwargs: Any) -&gt; @Todo) | (...30 union elements omitted)`
</code></pre>
<p>(I didn't actually count how many elements there are in that very long union, but you get the picture.)</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @AlexWaygood on 2025-10-04 17:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-10-08 10:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamjstewart">@adamjstewart</a> on 2026-01-12 12:08</div>
            <div class="timeline-body"><p>Would it be possible to add a <code>ty check --output-format=verbose</code> option to optionally see the full string? I have a case where the type I'm trying to use is near the end of the union type but I can't see it in the error message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-12 12:11</div>
            <div class="timeline-body"><p>You can use <code>reveal_type</code> to see the full type -- does that work for you?</p>
<p>I'm not necessarily opposed to adding <code>--output-format=verbose</code>, but it's good to avoid too much complexity in our configuration where possible</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamjstewart">@adamjstewart</a> on 2026-01-12 13:11</div>
            <div class="timeline-body"><p><code>reveal_type</code> works for the actual type, not the expected type. Although I guess I could throw the expected type hint class in...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 13:16</div>
            <div class="timeline-body"><blockquote>
<p>I'm not necessarily opposed to adding --output-format=verbose, but it's good to avoid too much complexity in our configuration where possible</p>
</blockquote>
<p>I'd prefer to use <code>-v</code> instead. We've other diagnostics that output more verbose information when running <code>ty check -v</code>. It avoids introducing a new concept.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-12 13:17</div>
            <div class="timeline-body"><p>That works for me</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:45 UTC
    </footer>
</body>
</html>
