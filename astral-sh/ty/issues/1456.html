<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplify intersections with typevars whose upper bound is covered by a union of negative elements - astral-sh/ty #1456</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Simplify intersections with typevars whose upper bound is covered by a union of negative elements</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1456">#1456</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-10-30 14:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><p>There appear to be lots of other cases where you can have a TypeVar bound to a union (or type equivalent to a union) where we also exhibit similar issues with reachability and narrowing:</p>
<pre><code class="language-py">from typing import assert_never, Literal

def f[T: bool](x: T) -&gt; T:
    match x:
        case True:
            return x
        case False:
            return x
        case _:
            reveal_type(x) # T@f &amp; ~Literal[True] &amp; ~Literal[False]
            assert_never(x)  # false-positive error

def g[T: Literal[&quot;foo&quot;, &quot;bar&quot;]](x: T) -&gt; T:
    match x:
        case &quot;foo&quot;:
            return x
        case &quot;bar&quot;:
            return x
        case _:
            reveal_type(x)  # T@g &amp; ~Literal[&quot;foo&quot;] &amp; ~Literal[&quot;bar&quot;]
            assert_never(x)  # false-positive error

def h[T: int | str](x: T) -&gt; T:
    if isinstance(x, int):
        return x
    elif isinstance(x, str):
        return x
    else:
        reveal_type(x)  # T@h &amp; ~int &amp; ~str
        assert_never(x)  # false-positive error
</code></pre>
<p><em>Originally posted by @AlexWaygood in https://github.com/astral-sh/ruff/pull/21130#pullrequestreview-3399762902</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Simplify intersections with Typevars whose upper bound is covered by a union of negative elements" to "Simplify intersections with typevars whose upper bound is covered by a union of negative elements" by @sharkdp on 2025-10-30 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">set-theoretic types</span> added by @sharkdp on 2025-10-30 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "GA" by @sharkdp on 2025-10-30 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by @AlexWaygood on 2025-10-30 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by @AlexWaygood on 2025-10-30 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">control flow</span> added by @AlexWaygood on 2025-10-30 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-10-31 20:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:53 UTC
    </footer>
</body>
</html>
