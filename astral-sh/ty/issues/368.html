<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>file.write for files opened in binary mode - astral-sh/ty #368</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>file.write for files opened in binary mode</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/368">#368</a>
        opened by <a href="https://github.com/heiner">@heiner</a>
        on 2025-05-13 19:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/heiner">@heiner</a> on 2025-05-13 19:25</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Given this input <code>test.py</code>:</p>
<pre><code>f = open(&quot;myfile&quot;, &quot;ab+&quot;)
f.write(b&quot;mybytes&quot;)
</code></pre>
<p>Running <code>ty</code> results in</p>
<pre><code>$ uvx ty check test.py
WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
error[invalid-argument-type]: Argument to bound method `write` is incorrect
 --&gt; /Users/heiner/src/test.py:2:9
  |
1 | f = open(&quot;myfile&quot;, &quot;ab+&quot;)
2 | f.write(b&quot;mybytes&quot;)
  |         ^^^^^^^^^^ Expected `str`, found `Literal[b&quot;mybytes&quot;]`
  |
info: Function defined here
   --&gt; stdlib/_io.pyi:125:9
    |
123 |     def __next__(self) -&gt; str: ...  # type: ignore[override]
124 |     def detach(self) -&gt; BinaryIO: ...
125 |     def write(self, s: str, /) -&gt; int: ...
    |         ^^^^^       ------ Parameter declared here
126 |     def writelines(self, lines: Iterable[str], /) -&gt; None: ...  # type: ignore[override]
127 |     def readline(self, size: int = -1, /) -&gt; str: ...  # type: ignore[override]
    |
info: rule `invalid-argument-type` is enabled by default

Found 1 diagnostic
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.1 (12f466e46 2025-05-13)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @carljm on 2025-05-13 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-13 19:31</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>Root cause here is lack of support for <code>typing.TypeAlias</code>, because <code>_typeshed.OpenTextMode</code> is defined as a <code>TypeAlias</code>, which causes us to pick the wrong overload for <code>open</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-06 15:52</div>
            <div class="timeline-body"><p>Thanks for the report! I'm closing this in favour of https://github.com/astral-sh/ty/issues/544, since the fix for this issue is #544</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-10-06 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-12 01:52</div>
            <div class="timeline-body"><p>Confirmed that this will be fixed by https://github.com/astral-sh/ruff/pull/21394</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:01 UTC
    </footer>
</body>
</html>
