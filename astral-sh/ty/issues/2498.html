<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Some hover blocks are not always valid Python source - astral-sh/ty #2498</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Some hover blocks are not always valid Python source</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2498">#2498</a>
        opened by <a href="https://github.com/rchl">@rchl</a>
        on 2026-01-14 19:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rchl">@rchl</a></div>
            <div class="timeline-body">Summary
<p>Code snippet displayed in the hover popups is not always a valid python source code. Some editors have more lenient syntax highlighting that makes it not really an issue, other have more strict highlighting that will introduce red error highlighting to indicate that the code is not valid. For example in ST we get something like this in some cases:</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/08f69ac5-f2da-4fe9-a3d5-ddcbb75070d3"></p>
<p>Perhaps <code>ty</code> can tell whether the snippet is a valid code or not and based on that return either a python code block or plain text code block?</p>
Version
<p>0.0.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-14 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2026-01-15 05:15</div>
            <div class="timeline-body"><p>I think we use the <code>xml</code> language tag for such code blocks, I see the following hover content in Neovim:</p>
<pre><code>```xml
&lt;module &#x27;collections.abc&#x27;&gt;
```
</code></pre>
<p>Is it that your editor&#x27;s syntax highlighting doesn&#x27;t support XML tags correctly? Can you try opening a XML file with the above content and see how does your editor highlight that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 07:51</div>
            <div class="timeline-body"><p>The issue is that an attribute without a name isn&#x27;t valid in XML. So the editor&#x27;s highlighting is correct. It&#x27;s also not valid in any other XML like dialect that I&#x27;m aware of (HTML, JSX).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 07:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 07:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rchl">@rchl</a> on 2026-01-15 07:57</div>
            <div class="timeline-body"><p>Right, I&#x27;ve assumed the part about using python code block. But yeah, still not a valid source for chosen code block language.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 08:00</div>
            <div class="timeline-body"><p>It&#x27;s unfortunate that an LSP can&#x27;t ship a custom syntax (at least to my knowledge)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-15 16:37</div>
            <div class="timeline-body"><p>We can also change our display for these types. I don&#x27;t think a lot of deep thought went into these displays, we just sort of copied a style the runtime repr sometimes uses. I&#x27;m not sure the extra punctuation is all that helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 16:44</div>
            <div class="timeline-body"><p>the issue is that <code>&lt;module collections.abc&gt;</code> would be valid XML but <code>&lt;module &#x27;collections.abc&#x27;&gt;</code> is not? I very weakly prefer it with the quotes, but yeah, if that breaks syntax highlighting then we can definitely remove them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 16:54</div>
            <div class="timeline-body"><p><code>&lt;module collections.abc&gt;</code> is also not valid xml, the attribute msut be followed by an <code>=</code> and it also requires a closing tag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 16:56</div>
            <div class="timeline-body"><p>I&#x27;d have to take a closer look at what pylance does but it seems to use a simple code block for modules</p>
<p>https://github.com/user-attachments/assets/9ee8eb51-9441-4b6a-bcae-c861fea816b5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-16 15:50</div>
            <div class="timeline-body"><p>@Gankra, you&#x27;ll find this interesting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-16 15:58</div>
            <div class="timeline-body"><p>When I mentioned &quot;extra punctuation&quot; I didn&#x27;t just mean quotes -- I think we could reconsider the angle brackets entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-16 16:15</div>
            <div class="timeline-body"><blockquote>
<p>When I mentioned &quot;extra punctuation&quot; I didn&#x27;t just mean quotes -- I think we could reconsider the angle brackets entirely.</p>
</blockquote>
<p>Sure. What would we replace them with, though? Very early on, we displayed <code>&lt;class &#x27;int&#x27;&gt;</code> as <code>Literal[int]</code>, and I think that was much more confusing for users than what we have now. Part of the reason why we went for <code>&lt;class &#x27;int&#x27;&gt;</code>, <code>&lt;module &#x27;typing&#x27;&gt;</code>, etc., was that it matched the runtime repr, as you say, but also I think because we didn&#x27;t have other great ideas.</p>
<p>We could go with something like <code>ModuleLiteral[typing]</code> and <code>ClassLiteral[int]</code>, I guess? Pyright appears to use regular parentheses, but (subjectively) that doesn&#x27;t feel particularly &quot;Pythonic&quot; to me -- it&#x27;s different to almost all our other displays right now, and different to what you&#x27;d usually see in Python types.</p>
<p>Other ways of solving this that were touched on above could be to:</p>
<ul>
<li><p>Just use a code fence without a language tag for the LSP tooltip (though we do get nice highlighting currently from editors that <em>don&#x27;t</em> care about the invalid XML syntax, and it&#x27;s a <em>bit</em> of a shame to lose that)</p>
</li>
<li><p>Use an entirely different display in the LSP tooltip to the one we use in diagnostics. This appears to be what pyright does, for example:</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/dddca3b7-70c0-4669-9906-d3947f2898a1"></p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-16 16:31</div>
            <div class="timeline-body"><blockquote>
<p>Use an entirely different display in the LSP tooltip to the one we use in diagnostics. This appears to be what pyright does, for example:</p>
</blockquote>
<p>I&#x27;m not 100% certain about this, but my impression was that Pyright opts out of syntax highlighting if it uses <code>(module) sys</code>. We could also just do that if we generate any type of syntax that isn&#x27;t valid Python.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-16 16:33</div>
            <div class="timeline-body"><p>Yeah. But my point there was that as <em>well</em> as opting out of syntax highlighting there, <code>(module) sys</code> is also totally different to what pyright shows in the <code>reveal_type</code> diagnostic (<code>Module(&quot;sys&quot;)</code>)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:08 UTC
    </footer>
</body>
</html>
