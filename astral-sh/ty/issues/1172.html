<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagerly turning a bound method into a callable leads to wrong signature - astral-sh/ty #1172</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Eagerly turning a bound method into a callable leads to wrong signature</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1172">#1172</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-09-11 17:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body"><p>This is very similar to #1169, but since we've talked about this example a few times over the last days, here is our current handling of it:</p>
<pre><code class="language-py">from typing import Self, Callable

class Base:
    def method(self, other: Self) -&gt; bool:
        return True

class Derived(Base):
    pass

# This call succeeds, as it should (with a method-scoped `Self` typevar)
Derived().method(Base())

# However, this reveals `Derived.method(other: Derived) -&gt; bool`,
# which seems to contradict the successful call right above
reveal_type(Derived().method)

# Similarly, this assignment should not lead to an error, but currently does:
callable: Callable[[Base], bool] = Derived().method
</code></pre>
<p>https://play.ty.dev/8410eba7-30ab-44f8-8b1c-15fa00937b27</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @sharkdp on 2025-09-11 17:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">calls</span> added by @sharkdp on 2025-09-11 17:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">attribute access</span> added by @sharkdp on 2025-09-11 17:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @sharkdp by @sharkdp on 2025-09-11 17:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-11 17:53</div>
            <div class="timeline-body"><p>The solution to this and #1169 will be the same: to not bind <code>self</code> eagerly when turning a bound method object into a <code>Callable</code> type. Instead, we're planning to do the binding of <code>self</code> lazily, keeping track of the bound instance type on <code>CallableSignature</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-12 07:55</div>
            <div class="timeline-body"><p>And here is another related problem:</p>
<pre><code class="language-py">from __future__ import annotations
from typing import Callable

class A: ...
class B: ...

class C[T]:
    x: T

    def only_for_int(self: C[int], x: A) -&gt; B:
        return B()

callable1: Callable[[A], B] = C[int]().only_for_int

callable2: Callable[[A], B] = C[str]().only_for_int  # this should be an error, but currently is not
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @sharkdp by @sharkdp on 2025-09-30 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-09 02:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:37 UTC
    </footer>
</body>
</html>
