<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`types.ModuleType` attributes in the global namespace can have a different type rendered in the autocomplete tooltip to the one ty infers - astral-sh/ty #2445</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>types.ModuleType</code> attributes in the global namespace can have a different type rendered in the autocomplete tooltip to the one ty infers</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2445">#2445</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2026-01-11 13:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-11 13:41</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>For example, here the inferred type is <code>str</code>, but the type the autocompletion tooltip renders for the attribute is <code>str | None</code>:</p>
<p><img width="1208" height="300" alt="Image" src="https://github.com/user-attachments/assets/77946354-9824-4776-8053-0ef602cd40b4" /></p>
<hr />
<p>What's going on here is: in general, ty knows that the <code>__file__</code> attribute for a module will be of type <code>str | None</code>. But for <em>this</em> module, ty infers a more precise type (<code>str</code>), because, well: we know this module has a file; we're checking it right now.</p>
<p>This special-casing is done <a href="https://github.com/astral-sh/ruff/blob/2c68057c4b0a666ffd73324013fad2ce3c2fa547/crates/ty_python_semantic/src/place.rs#L1640-L1708">here</a>; it looks like we might need to make our autocompletion machinery aware of that special-casing somehow?</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @AlexWaygood on 2026-01-11 13:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2026-01-11 13:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2026-01-11 13:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by @AlexWaygood on 2026-01-11 13:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2026-01-12 00:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:26:57 UTC
    </footer>
</body>
</html>
