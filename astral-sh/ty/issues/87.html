<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go to definition - astral-sh/ty #87</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Go to definition</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/87">#87</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-03-14 10:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Implement go to definition in the LSP</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-14 10:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-19 17:27</div>
            <div class="timeline-body"><p>The LSP specification supports three different operations:</p>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_definition">Go to definition</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_declaration">Go to declaration</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_typeDefinition">Go to type definition</a></li>
</ul>
<p>See <a href="https://www.reddit.com/r/neovim/comments/11u3sx3/lsp_differences_between_definition_declaration/">reddit</a> and the <a href="https://sorbet.org/docs/go-to-def">sorbet documentation</a></p>
<p>@AlexWaygood mentioned that pyright (and mypy?) support navigating to the typing stub or the definition in the python source. I don&#x27;t think we can support the second yet because our module resolver doesn&#x27;t support resolving both.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-19 17:32</div>
            <div class="timeline-body"><blockquote>
<p>(and mypy?)</p>
</blockquote>
<p>mypy doesn&#x27;t have an LSP integration; it&#x27;s just a CLI tool. There are plugins that integrate it into VSCode but it doesn&#x27;t have any features like &quot;go to definition&quot; in the same way that pyright does or the way that we aim to.</p>
<blockquote>
<p>I don&#x27;t think we can support the second yet because our module resolver doesn&#x27;t support resolving both.</p>
</blockquote>
<p>Agreed. It would be a lovely feature to have eventually, especially since pyright already implements it, but it definitely isn&#x27;t essential for an alpha or beta release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-20 16:18</div>
            <div class="timeline-body"><p><a href="https://sorbet.org/docs/go-to-def#jumping-to-the-definition-took-me-to-a-webpage-instead-of-a-ruby-file">Sorbet</a> has a custom command to support &quot;jump to definition&quot; for their equivalent of vendored typeshed stubs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-20 16:19</div>
            <div class="timeline-body"><p>Jumping to a definition in a stub feels more like &quot;go to declaration&quot; rather than &quot;go to definition&quot; to me: stubs contain declarations rather than definitions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-20 17:50</div>
            <div class="timeline-body"><blockquote>
<p>Jumping to a definition in a stub feels more like &quot;go to declaration&quot; rather than &quot;go to definition&quot; to me: stubs contain declarations rather than definitions</p>
</blockquote>
<p>Yeah, the distinction between go to definition and go to declaration is certainly very vague in Python. However, I&#x27;d expect <em>Go to definition</em> for <code>os.name</code> to jump to the typing stub simply because there&#x27;s no other place we can jump to. I would be annoyed if Red Knot simply does <em>nothing</em> (Go to definition is the default if you Cmd/Ctrl click a name).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-20 17:55</div>
            <div class="timeline-body"><p>In the long term I&#x27;d like &quot;go to definition&quot; to jump to https://github.com/python/cpython/blob/ce79274e9f093bd06d2285c9af48dbcbc92173de/Lib/os.py#L53 for whatever Python interpreter is in use for <code>os.name</code>, but for &quot;go to declaration&quot; to jump to the typing stub. That&#x27;s what pyright does, and it makes sense to me. I realise we can&#x27;t support that for red-knot right away, but I think that should be our long-term goal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-20 17:57</div>
            <div class="timeline-body"><p>However, I&#x27;m okay with it if you want to implement jumping to the stub definition as &quot;go to definition&quot; rather than &quot;go to declaration&quot; initially! I can see that it would indeed be annoying if red-knot did nothing at all when you CTRL-clicked a name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-20 17:59</div>
            <div class="timeline-body"><blockquote>
<p>However, I&#x27;m okay with it if you want to implement jumping to the stub definition as &quot;go to definition&quot; rather than &quot;go to declaration&quot; initially! I can see that it would indeed be annoying if red-knot did nothing at all when you CTRL-clicked a name.</p>
</blockquote>
<p>I think it&#x27;s less a &quot;want to&quot; but more a: Not doing it because it is a serious scope increase ;)</p>
<p>I also realised that <code>os</code> isn&#x27;t a good example. The point is, go to definition should jump to the typing stub if no source file is available (because it&#x27;s a native module or, for now, because we don&#x27;t support resolving both stubs and source files at the same time)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-20 18:00</div>
            <div class="timeline-body"><blockquote>
<p>I also realised that <code>os</code> isn&#x27;t a good example. The point is, go to definition should jump to the typing stub if no source file is available (because it&#x27;s a native module or, for now, because we don&#x27;t support resolving both stubs and source files at the same time)</p>
</blockquote>
<p>Yeah, and that&#x27;s also what pyright does. The <code>sys</code> module <em>is</em> a good example, as it&#x27;s all written in C. CTRL-clicking on <code>sys</code>-module APIs in pyright jumps to the stub, because there&#x27;s no runtime source available.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-20 18:04</div>
            <div class="timeline-body"><p>I talked with @carljm and I might start with <em>go to type definition</em>, because, it turns out, that&#x27;s easier with the infrastructure we have today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-07 15:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[red-knot] Go to definition&quot; to &quot;Go to definition&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-07 15:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-31 19:23</div>
            <div class="timeline-body"><p>An initial version of go to definition and go to declaration is now implemented, see <a href="https://github.com/astral-sh/ruff/pull/19371">astral-sh/ruff#19371</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-31 19:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:04 UTC
    </footer>
</body>
</html>
