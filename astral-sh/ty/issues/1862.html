<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive for `possibly-unresolved-reference` using walrus operator - astral-sh/ty #1862</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive for `possibly-unresolved-reference` using walrus operator</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1862">#1862</a>
        opened by <a href="https://github.com/xoudini">@xoudini</a>
        on 2025-12-12 12:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/xoudini">@xoudini</a> on 2025-12-12 12:21</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Here's a minimal reproducible example of ty incorrectly reporting a possibly unresolved reference:</p>
<pre><code class="language-python">def foo(x: int | None) -&gt; int | None:
    return x


def bar(x: int | None, y: bool) -&gt; int:
    if y and (_x := foo(x)) is not None:
        return _x
    return 0
</code></pre>
<p>The error itself:</p>
<pre><code class="language-console">error[possibly-unresolved-reference]: Name `_x` used when possibly not defined
 --&gt; tymre.py:7:16
  |
5 | def bar(x: int | None, y: bool) -&gt; int:
6 |     if y and (_x := foo(x)) is not None:
7 |         return _x
  |                ^^
8 |     return 0
  |
info: rule `possibly-unresolved-reference` was selected in the configuration file
</code></pre>
<p>Without the <code>y</code> check (or swapping the order of the conditions) the check passes.</p>
<p>In this case <code>mypy 1.18.2</code> correctly type checks with <code>possibly-undefined</code> enabled.</p>
<h3>Version</h3>
<p>0.0.1-alpha.33 (35e23aa48 2025-12-09)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xoudini">@xoudini</a> on 2025-12-12 12:24</div>
            <div class="timeline-body"><p>Sorry, just noticed https://github.com/astral-sh/ty/issues/139 and https://github.com/astral-sh/ty/issues/626 after modifying my search terms in the issues, self-closing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @xoudini on 2025-12-12 12:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:55:22 UTC
    </footer>
</body>
</html>
