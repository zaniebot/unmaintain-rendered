<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instantiating a `list` or `set` loses literal generic type information - astral-sh/ty #1815</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Instantiating a `list` or `set` loses literal generic type information</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1815">#1815</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2025-12-09 00:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Avasam">@Avasam</a> on 2025-12-09 00:22</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Feel free to rename or mark as duplicate if there's a pre-existing issue that better describes the root cause. The closest related I found was maybe https://github.com/astral-sh/ty/issues/1648 / https://github.com/astral-sh/ty/issues/1576</p>
<p>Passing a list of literals to <code>list</code> or <code>set</code> loses type information with ty. Whereas both mypy and pyright keep the literal generic types:</p>
<ul>
<li>https://mypy-play.net/?gist=698f5d996f794a1a02536cebb8fe47a1</li>
<li>https://play.ty.dev/7f70524b-6288-4669-8627-62926ed7bad5</li>
<li><a href="https://pyright-play.net/?code=GYJw9gtgBALgngBwJYDsDmUkQWEMoAySMApiAIYA2ANFCCQG4lUD68CJAsAFAAmJwKCwAUADwBcUSkgDOMANpFSFSvIBE5NbTUAjLVDUBjNQF0TASnE8oNuo2aU2iEmPPXb9Jq3Yvpc127ctnZejj7CMiQwATxAA">pyright playground</a>
<img width="501" height="272" alt="Image" src="https://github.com/user-attachments/assets/65b7c5ed-9c08-44ce-bf0c-99e19b3113c0" /></li>
</ul>
<h3>Version</h3>
<p>ty 0.0.1-alpha.32</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Instantiating a `list` or `set` looses literal generic type information" to "Instantiating a `list` or `set` loses literal generic type information" by @Avasam on 2025-12-09 00:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-09 00:29</div>
            <div class="timeline-body"><p>@ibraheemdev I think we had previously discussed in https://discord.com/channels/1039017663004942429/1279201882337705994/1437881888789364838 that we should not promote in this case, because the argument <code>x</code> in <code>list(x)</code> is already an invariant type (<code>list</code>), so we should assume that if it is specialized to a literal type, that must originate from an explicit annotation (as it does in this case), or else we'd have promoted on the construction of that type.</p>
<p>Did we just not fully implement that plan yet? Do we have another issue tracking that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bidirectional inference</span> added by @carljm on 2025-12-09 00:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by @carljm on 2025-12-09 00:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ibraheemdev by @carljm on 2025-12-09 00:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-09 00:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-12-10 20:17</div>
            <div class="timeline-body"><p><code>list</code> takes an <code>Iterable[T]</code> argument, so I believe this is just https://github.com/astral-sh/ty/issues/1576, and should be fixed by https://github.com/astral-sh/ruff/pull/21747.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2025-12-10 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-10 20:54</div>
            <div class="timeline-body"><p>It doesn't look like https://github.com/astral-sh/ruff/pull/21747 changes the behavior of the OP example here, so there must be something additional going on. We can revisit after landing that one, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @carljm on 2025-12-10 20:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-12-10 21:19</div>
            <div class="timeline-body"><p>Ah right, the issue here is unrelated. We consider the variance of the type parameter in the <em>argument</em> type, not parameter type, for literal promotion. There seems to be something else going on here:</p>
<pre><code class="language-py">from typing import Iterable, Literal
from collections.abc import MutableSequence

class X[T](MutableSequence[T]):
    def __init__(self, iterable: Iterable[T], /) -&gt; None: ...

class Y[T]:
    def __init__(self, iterable: Iterable[T], /) -&gt; None: ...

def _(x: list[Literal[1]]):
    reveal_type(X(x))  # revealed: X[int]
    reveal_type(Y(x))  # revealed: Y[Literal[1]]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-12-20 01:57</div>
            <div class="timeline-body"><p>It looks like we actually do consider the variance in the parameter type instead of the argument type, and this was just hidden by the tests using a bivariant type.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:53:03 UTC
    </footer>
</body>
</html>
