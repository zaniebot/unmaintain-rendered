<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walking up the tree - astral-sh/ty #1653</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Walking up the tree</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1653">#1653</a>
        opened by <a href="https://github.com/alexei">@alexei</a>
        on 2025-11-27 09:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alexei">@alexei</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p><code>ty check</code> walks up the tree, which is problematic to monorepos with nested packages each with its own dependencies e.g:</p>
<pre><code>large_package/
    pyproject.toml
    medium_packages/
        a/
            pyproject.toml
        b/
            pyproject.toml
            small_packages/
                b.foo/
                    pyproject.toml
                b.bar/
                    pyproject.toml
                b.baz/
                    pyproject.toml
        c/
            pyproject.toml
            small_packages/
                c.moo/
                    pyproject.toml
                c.goo/
                    pyproject.toml
</code></pre>
<p>In fact, it's unclear to me why it does it in the first place. If current and parent directories are Python packages, why would <code>ty</code> assume it can tread on them equally? It doesn't look like it cares that current directory is a standalone package with its own virtual env etc.</p>
<hr />
<p>The <a href="https://docs.astral.sh/ty/reference/cli/#ty-check--project"><code>ty check --project</code> documentation</a> says that:</p>
<blockquote>
<p>All <code>pyproject.toml</code> files will be discovered by walking up the directory tree from the given project directory, as will the project's virtual environment (<code>.venv</code>) unless the <code>venv-path</code> option is set.</p>
</blockquote>
<p>It's not clear what <code>venv-path</code> does, as it's not documented anywhere.</p>
<hr />
<p><strong>So how do I turn off the walking up the tree?</strong> What I found to work so far is to specify paths explicitly in each config i.e. each <code>pyproject.toml</code> with:</p>
<pre><code class="language-toml">[tool.ty.src]
include = [
    &quot;src/&quot;,
    &quot;tests/&quot;,
]
</code></pre>
<p>I don't like it that I have to repeat this same config everywhere, though I admin it's sometimes necessary. However I can get past my being annoyed if that's the standard, recommended approach ðŸ˜„ Not configuring anything seems to give good results, so changing that makes me feel like I'm missing out on something.</p>
<p>This is slightly related to https://github.com/astral-sh/ty/issues/819 in that it's about monorepos. However the author there appears to take a hybrid approach where, while packages don't share dependencies, some of the dev ones run at the top level. Here I'm talking about fully isolated packages.</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.28 (8c342496a 2025-11-25)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @alexei on 2025-11-27 09:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-27 10:38</div>
            <div class="timeline-body"><p>ty searches for the closest configuration with a <code>tool.ty</code> section starting from the current working directory and uses it as your project root. There are some open discussions about whether we should consider any <code>pyproject.toml</code> a potential &quot;root&quot;, but this leads to a worse experience when you have a workspace with multiple members who share a single virtual env.</p>
<p>For now, the solution is to add a <code>tool.ty</code> section to each member you want treated as a dedicated root. But, if you do that, you'll have to repeat your ty configuration for every member because ty doesn't yet support <a href="https://github.com/astral-sh/ty/issues/175">hierarchical configurations</a>.</p>
<p>We're aware that the experience for this use case isn't great yet and your feedback helps us understand the different project layouts users use.</p>
<p>Related discussion https://github.com/astral-sh/ty/issues/819</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexei">@alexei</a> on 2025-11-27 11:56</div>
            <div class="timeline-body"><p>Hey @MichaReiser I appreciate your response! I just checked and can confirm (via <code>uv run ty check -vv</code>) that <strong>even an empty</strong> <code>[tool.ty]</code> section in <code>pyproject.toml</code> prevents <code>ty</code> from checking out the parent directory. I guess then this is ideal for packages that have a standard &quot;src&quot; layout and the defaults are fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-01 10:18</div>
            <div class="timeline-body"><p>I'll close this as the main discussion for how to better support mono repositories happens in https://github.com/astral-sh/ty/issues/819</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-12-01 10:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:04 UTC
    </footer>
</body>
</html>
