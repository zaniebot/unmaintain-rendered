<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>improve diagnostics for possibly-unbound call-dunder with union - astral-sh/ty #940</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>improve diagnostics for possibly-unbound call-dunder with union</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/940">#940</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-08-05 14:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><p>When we have an implicit dunder call with a union type, where some types in the union implement the dunder and others do not, we currently report an error that the dunder methods are possibly unbound: https://play.ty.dev/e412c8da-cc72-47b5-af98-9db45800ff73</p>
<pre><code class="language-py">class Context:
    def __enter__(self): ...
    def __exit__(self, *args): ...

class NotContext:
    pass

def _(x: Context | NotContext):
    # error: [invalid-context-manager] &quot;Object of type `Context | NotContext` cannot be used with `with` because the methods `__enter__` and `__exit__` are possibly unbound&quot;
    with x:
        pass
</code></pre>
<p>This is not very useful in identifying which element of the union type is the problem. It would be better if we would instead surface the underlying error directly (that <code>NotContext</code> does not implement <code>__enter__</code> or <code>__exit__</code>), and add a note that <code>NotContext</code> appears in the union type <code>Context | NotContext</code>.</p>
<p>This issue applies at least to sync and async context managers; I think it likely applies to some other implicit dunder calls as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @carljm on 2025-08-05 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @carljm on 2025-08-05 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Y3K">@Y3K</a> on 2025-08-31 16:08</div>
            <div class="timeline-body"><p>Hi, I'll try to fix this one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 02:14</div>
            <div class="timeline-body"><p>This is the method-call variant of https://github.com/astral-sh/ty/issues/1656</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @carljm on 2026-01-09 02:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">calls</span> added by @carljm on 2026-01-09 02:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-09 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-09 13:53</div>
            <div class="timeline-body"><blockquote>
<p>This is the method-call variant of <a href="https://github.com/astral-sh/ty/issues/1656">#1656</a></p>
</blockquote>
<p>Sort-of? I think it might be more precise to say that both this issue and #1656 would probably require us to partially implement https://github.com/astral-sh/ty/issues/190?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:24 UTC
    </footer>
</body>
</html>
