<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trigger completion for from-imports - astral-sh/ty #703</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Trigger completion for from-imports</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/703">#703</a>
        opened by <a href="https://github.com/twoertwein">@twoertwein</a>
        on 2025-06-25 16:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/twoertwein">@twoertwein</a> on 2025-06-25 16:14</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The completion is already working very well :)</p>
<p>I noticed that while https://play.ty.dev triggers autocompletion even after the first letter of a from-import (for example <code>from pathlib import P&lt;courser&gt;</code>). The autocompletion in neovim is only triggered after the trigger character specified by ty (only &quot;.&quot; https://github.com/astral-sh/ruff/blob/8b22992988226833da6804e79fef4706fb657ead/playground/ty/src/Editor/Editor.tsx#L182). Manually requesting the completion at <code>from pathlib import P&lt;courser&gt;</code> works :)</p>
<p>It would be great to extend the autotrigger options (or provide a neovim example config that closely mirrors the behavior of play.ty.dev)</p>
<h3>Version</h3>
<p>0.0.1 alpha 12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-06-25 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @AlexWaygood on 2025-06-25 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-26 03:58</div>
            <div class="timeline-body"><p>Can you provide us with your Neovim auto-completion setup? Like, are you using a plugin for that or the builtin completion engine? I'm seeing the completion menu popup for the example that you've provided:</p>
<p>https://github.com/user-attachments/assets/43a03b9e-6e05-49dd-b0a1-c42186d8211c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/twoertwein">@twoertwein</a> on 2025-06-26 12:21</div>
            <div class="timeline-body"><p>I'm using the builtin completion, minimal example:</p>
<p>init.lua</p>
<pre><code class="language-lua">vim.lsp.enable { &quot;ty&quot; }

vim.cmd[[set completeopt+=menuone,noselect,popup]]
</code></pre>
<p>lsp/ty.lua</p>
<pre><code class="language-lua">return {
  cmd = { &quot;ty&quot;, &quot;server&quot; },
  filetypes = { &quot;python&quot; },
  root_markers = { &quot;ty.toml&quot;, &quot;pyproject.toml&quot;, &quot;.git&quot; },
  on_attach = function(client, bufnr)
    -- show type annotations
    vim.lsp.inlay_hint.enable(true, {  bufnr })
    -- automatically trigger completions
    vim.lsp.completion.enable(true, client.id, bufnr, {
      autotrigger = true,
      convert = function(item)
        return { abbr = item.label:gsub(&quot;%b()&quot;, &quot;&quot;) }
      end,
    })
  end,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-27 06:20</div>
            <div class="timeline-body"><p>Thank you for providing the details!</p>
<p>I think this might be a limitation on Neovim side because as per the docs of <a href="https://neovim.io/doc/user/lsp.html#lsp-completion"><code>vim.lsp.completions</code></a>, it only uses the trigger characters defined by the server and does not use any pre-existing trigger characters. Most clients usually define the set of alphabets <code>[a-zA-Z]</code> as the default trigger characters and then extend that with the one defined by the server. As per the <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#completionOptions">LSP spec</a>, the <code>triggerCharacters</code> field is mainly use to <em>extend</em> the characters defined by the client and not re-define them.</p>
<p>Can you try opening an issue with Neovim and check-in if they're open to having a default set of trigger characters?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @BurntSushi by @AlexWaygood on 2025-06-27 07:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/twoertwein">@twoertwein</a> on 2025-06-27 15:05</div>
            <div class="timeline-body"><p>Thank you for linking the docs! Neovim actually has an <a href="https://neovim.io/doc/user/lsp.html#lsp-attach">example</a> to trigger LSP on every keypress :) (luckily ty is fast)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @twoertwein on 2025-06-27 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2025-06-30 03:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-30 03:05</div>
            <div class="timeline-body"><blockquote>
<p>Thank you for linking the docs! Neovim actually has an <a href="https://neovim.io/doc/user/lsp.html#lsp-attach">example</a> to trigger LSP on every keypress :) (luckily ty is fast)</p>
</blockquote>
<p>That's great! I guess then you can define the <code>[a-zA-Z]</code> trigger character similar to the example in the docs:</p>
<pre><code class="language-lua">-- Start with the characters provided by the server
local chars = client.server_capabilities.completionProvider.triggerCharacters

-- Extend it with the uppercase and lowercase alphabets
for i = 65, 90 do  -- A - Z
	table.insert(chars, string.char(i))
end
for i = 97, 122 do  -- a - z
	table.insert(chars, string.char(i))
end

client.server_capabilities.completionProvider.triggerCharacters = chars
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by @AlexWaygood on 2025-10-03 12:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:14 UTC
    </footer>
</body>
</html>
