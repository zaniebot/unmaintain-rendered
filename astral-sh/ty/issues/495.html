<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reduce size of `TypeInference` - astral-sh/ty #495</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reduce size of <code>TypeInference</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/495">#495</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-05-23 13:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>ty creates a lot of <code>TypeInference</code> instances and it is a very large struct. It creates an instance for every:</p>
<ul>
<li>scope</li>
<li>definition</li>
<li>standalone expression</li>
</ul>
<p>We should explore if:</p>
<ul>
<li>if we can reduce the size of <code>TypeInference</code> itself (e.g. use of <code>ThinVec</code>?)</li>
<li>if we can reduce the size of <code>TypeInference</code> for standalone expressions, or <code>definition</code> or do they use all fields?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">memory</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-23 13:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-23 13:03</div>
            <div class="timeline-body"><p>CC: @ibraheemdev this might be less effort than the AST improvements. In case you&#x27;re looking for something smaller on the side</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/monoid">@monoid</a> on 2025-05-28 12:21</div>
            <div class="timeline-body"><p>Do you mean ruff&#x27;s <code>TypeInference</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-28 12:22</div>
            <div class="timeline-body"><blockquote>
<p>Do you mean ruff&#x27;s <code>TypeInference</code>?</p>
</blockquote>
<p>Can you say more. I don&#x27;t understand the question</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/monoid">@monoid</a> on 2025-05-28 12:25</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Do you mean ruff&#x27;s <code>TypeInference</code>?</p>
</blockquote>
<p>Can you say more. I don&#x27;t understand the question</p>
</blockquote>
<p>There is a <code>TypeInference</code> in the ruff sources: https://github.com/astral-sh/ruff/blob/a3ee6bb3b5f4f375e606d3bc12094549bb46a98b/crates/ty_python_semantic/src/types/infer.rs#L395</p>
<p>and I cannot grep another <code>TypeInference</code> in ty sources.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-28 12:29</div>
            <div class="timeline-body"><p>Yes, that&#x27;s the type</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-28 14:44</div>
            <div class="timeline-body"><p>@monoid All of ty&#x27;s source code is in the ruff repository, in the ty crates. This is to simplify code sharing between ruff and ty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-06-11 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-22 09:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:38 UTC
    </footer>
</body>
</html>
