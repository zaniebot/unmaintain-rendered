<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive in invalid-argument-type - astral-sh/ty #403</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive in invalid-argument-type</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/403">#403</a>
        opened by <a href="https://github.com/dleifeld">@dleifeld</a>
        on 2025-05-15 08:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dleifeld">@dleifeld</a> on 2025-05-15 08:40</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Given this code</p>
<pre><code class="language-Python">from pydantic import BaseModel


class User(BaseModel):
    id: int
    name: str | None = None


def print_user(user: User) -&gt; None:
    print(f&quot;User ID: {user.id}&quot;)

    # According to mypy and Pylance this is correct
    # Only ty complains with this
    if user.name:
        print_name(user.name)
    if user.name is not None:
        print_name(user.name)

    # This is not correct
    print_name(user.name)


def print_name(name: str) -&gt; None:
    print(f&quot;Name: {name}&quot;)
</code></pre>
<p>I get the very helpful output three times:</p>
<pre><code>error[invalid-argument-type]: Argument to function `print_name` is incorrect
  --&gt; test.py:14:20
   |
12 |     # According to mypy and Pylance this is correct
13 |     if user.name:
14 |         print_name(user.name)
   |                    ^^^^^^^^^ Expected `str`, found `str | None`
15 |     if user.name is not None:
16 |         print_name(user.name)
   |
info: Function defined here
  --&gt; test.py:22:5
   |
22 | def print_name(name: str) -&gt; None:
   |     ^^^^^^^^^^ --------- Parameter declared here
23 |     print(f&quot;Name: {name}&quot;)
   |
info: rule `invalid-argument-type` is enabled by default
</code></pre>
<p>I would expect it only once.
Given that this is still is alpha, I am impressed by the speed and quality of the errors.</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-15 08:46</div>
            <div class="timeline-body"><p>Thanks for the clear report. This is another instance of https://github.com/astral-sh/ty/issues/164</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-15 08:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:02 UTC
    </footer>
</body>
</html>
