<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty treats cls of __init_subclass__ as self. - astral-sh/ty #1106</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty treats cls of <strong>init_subclass</strong> as self.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1106">#1106</a>
        opened by <a href="https://github.com/danielknell">@danielknell</a>
        on 2025-08-29 23:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danielknell">@danielknell</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>ty appears to treat the <code>cls</code> argument of <code>__init_subclass__</code> as <code>self</code>, and any changes appear to be interpreted as being applied to the instance rather than the class.</p>
<pre><code class="language-python">import typing

class Foo:
    def say(self, v) -&gt; None:
        pass

    def __init_subclass__(cls, *args, **kwargs) -&gt; None:
        cls.say = lambda self, v: print(v)

        super().__init_subclass__(*args, **kwargs)

class Bar(Foo):
    pass

bar = Bar()

bar.say(&quot;hello world!&quot;)

typing.reveal_type(bar.say)
</code></pre>
<p>yields the following output from ty:</p>
<pre><code>No argument provided for required parameter `v` of function `say` (missing-argument) [Ln 17, Col 1]
Revealed type: `(bound method Bar.say(v) -&gt; None) | (def say(self, v) -&gt; None)` (revealed-type) [Ln 19, Col 20]
</code></pre>
<p>and the following output from python:</p>
<pre><code>hello world!
Runtime type is 'method'
</code></pre>
<p>python properly binds the function and passes <code>self</code>, yet ty interpretes it as the function having been assigned to the instance.</p>
<p>adding a <code>@classmethod</code> decorator to <code>__init_subclass__</code> causes ty to interpret things correctly, but <code>__init_subclass__</code> is implicitly a classmethod and is not normally decorated.</p>
<p>Playground for the above:</p>
<p>https://play.ty.dev/9fd17afa-7a28-437b-a459-149c95b85c96</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.19</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielknell">@danielknell</a> on 2025-08-30 13:55</div>
            <div class="timeline-body"><pre><code class="language-python">class Foo:
    def __init_subclass__(cls, *args, **kwargs) -&gt; None:
        cls.say = lambda self, v: print(v)

        super().__init_subclass__(*args, **kwargs)

class Bar(Foo):
    pass

typing.reveal_type(Bar.say)
</code></pre>
<p>also results in</p>
<pre><code>Attribute `say` can only be accessed on instances, not on the class object `&lt;class 'Bar'&gt;` itself.
</code></pre>
<p>which seems to imply ty is not handling <code>__init_subclass__</code> correctly and treats it as an instance method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">runtime semantics</span> added by @sharkdp on 2025-09-01 07:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @sharkdp by @sharkdp on 2025-09-01 07:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-01 07:46</div>
            <div class="timeline-body"><p>Thank you for reporting this.</p>
<p>https://github.com/astral-sh/ruff/pull/20190 should fix this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-09-01 08:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:34 UTC
    </footer>
</body>
</html>
