<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ty cannot resolve my custom package - astral-sh/ty #1662</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ty cannot resolve my custom package</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1662">#1662</a>
        opened by <a href="https://github.com/hermeschen1116">@hermeschen1116</a>
        on 2025-11-28 08:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hermeschen1116">@hermeschen1116</a></div>
            <div class="timeline-body">Question
<p>Iâ€™m using both uv and ty together. When I install my own custom packages using uv, ty doesnâ€™t recognise them, whereas other third-party packages work perfectly with ty. As the docs mention, I use uv to manage my environment, so I donâ€™t need to configure anything in my pyproject.toml. Is there anything else I should be aware of?</p>
Version
<p>0.0.0-alpha.28</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 08:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 08:43</div>
            <div class="timeline-body"><p>Are you using setuptools for your build backend, by any chance? (If you haven&#x27;t specified a build backend, then uv will use setuptools by default for your project.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 08:50</div>
            <div class="timeline-body"><p>@AlexWaygood No, my build backend is nuitka. I use it in all my python project.</p>
<pre><code>[build-system]
requires = [&quot;Nuitka[build-wheel]&quot;, &quot;toml&quot;, &quot;tqdm&quot;]
build-backend = &quot;nuitka.distutils.Build&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 14:37</div>
            <div class="timeline-body"><p>@AlexWaygood
I hope you donâ€™t mind me asking again. Iâ€™m not really familiar with how Ty or any LSP gets third-party package details, but could it be that itâ€™s because the package is built as a binary wheel? Also, it looks like Pyright is having trouble resolving my package too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 14:46</div>
            <div class="timeline-body"><p>Yeah, I&#x27;m not familiar with nuitka, I was planning on looking into it :-)</p>
<p>it would be great if you could show me what files are installed into your <code>site-packages</code> directory for your custom package. Is it only C extensions? Or does it also have some Python files? If it&#x27;s only C extensions, then this issue is probably a duplicate of <a href="https://github.com/astral-sh/ty/issues/487">astral-sh/ty#487</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 14:54</div>
            <div class="timeline-body"><blockquote>
<p>Yeah, I&#x27;m not familiar with nuitka, I was planning on looking into it :-)</p>
<p>it would be great if you could show me what files are installed into your <code>site-packages</code> directory for your custom package. Is it only C extensions? Or does it also have some Python files? If it&#x27;s only C extensions, then this issue is probably a duplicate of <a href="https://github.com/astral-sh/ty/issues/487">#487</a></p>
</blockquote>
<p>Yeah, you&#x27;re right. There&#x27;s no .py file is including in both wheel file (nuitka compiles the code into a .so file) and in site-packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 14:56</div>
            <div class="timeline-body"><p>Great, thanks for the confirmation!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 15:00</div>
            <div class="timeline-body"><p>@AlexWaygood BTW, just let you know because I wrote .pyi file for some function in my package and it&#x27;s include in wheel file and installed in site-packages. I&#x27;m not sure if Ty use .pyi files. Even the functions are specified in .pyi but Ty still cannot resolve them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 15:04</div>
            <div class="timeline-body"><p>we do inspect <code>.pyi</code> files, yes. I assumed you didn&#x27;t have any because you said you only had C extensions in <code>site-packages</code> ðŸ˜„</p>
<p>Can you please list out all the files for your package that are included in <code>site-packages</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-28 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 15:05</div>
            <div class="timeline-body"><blockquote>
<p>we do inspect <code>.pyi</code> files, yes. I assumed you didn&#x27;t have any because you said you only had C extensions in <code>site-packages</code> ðŸ˜„</p>
<p>Can you please list out all the files for your package that are included in <code>site-packages</code>?</p>
</blockquote>
<p>Sure. utils is my custom package.</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/f7847e36-1fa0-45a8-bfe7-f331a725c9ff"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-28 16:37</div>
            <div class="timeline-body"><p>Can you show us how you import the module and what ty&#x27;s diagnostic shows (ideally, run ty with <code>-v</code> so that it logs all search paths)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 17:45</div>
            <div class="timeline-body"><p>@MichaReiser
<img alt="Image" src="https://github.com/user-attachments/assets/33fc31f7-e3b0-455f-b9a8-e91ceed37b1f"></p>
<p>And what ty shows by diagnosis the same file.</p>
<pre><code>INFO Defaulting to python-platform `darwin`
INFO Python version: Python 3.12, platform: darwin
INFO Indexed 1 file(s) in 0.003s
error[unresolved-import]: Cannot resolve imported module `utils.Connection`
  --&gt; src/tlpr/internal/service/Detect.py:11:6
   |
 9 | import msgspec.json
10 | from structlog.typing import FilteringBoundLogger
11 | from utils.Connection import create_client
   |      ^^^^^^^^^^^^^^^^
12 | from utils.concurrent import execute_async, gather
13 | from utils.typing.URL import HttpURL
   |
info: Searched in the following paths during module resolution:
info:   1. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/src (first-party code)
info:   2. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition (first-party code)
info:   3. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   4. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/.venv/lib/python3.12/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

error[unresolved-import]: Cannot resolve imported module `utils.concurrent`
  --&gt; src/tlpr/internal/service/Detect.py:12:6
   |
10 | from structlog.typing import FilteringBoundLogger
11 | from utils.Connection import create_client
12 | from utils.concurrent import execute_async, gather
   |      ^^^^^^^^^^^^^^^^
13 | from utils.typing.URL import HttpURL
14 | from yolo_utils.server.internal.Typing import OBB
   |
info: Searched in the following paths during module resolution:
info:   1. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/src (first-party code)
info:   2. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition (first-party code)
info:   3. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   4. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/.venv/lib/python3.12/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

error[unresolved-import]: Cannot resolve imported module `utils.typing.URL`
  --&gt; src/tlpr/internal/service/Detect.py:13:6
   |
11 | from utils.Connection import create_client
12 | from utils.concurrent import execute_async, gather
13 | from utils.typing.URL import HttpURL
   |      ^^^^^^^^^^^^^^^^
14 | from yolo_utils.server.internal.Typing import OBB
   |
info: Searched in the following paths during module resolution:
info:   1. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/src (first-party code)
info:   2. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition (first-party code)
info:   3. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   4. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/.venv/lib/python3.12/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

error[unresolved-import]: Cannot resolve imported module `yolo_utils.server.internal.Typing`
  --&gt; src/tlpr/internal/service/Detect.py:14:6
   |
12 | from utils.concurrent import execute_async, gather
13 | from utils.typing.URL import HttpURL
14 | from yolo_utils.server.internal.Typing import OBB
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | from tlpr import BASE_LOGGER
   |
info: Searched in the following paths during module resolution:
info:   1. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/src (first-party code)
info:   2. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition (first-party code)
info:   3. vendored://stdlib (stdlib typeshed stubs vendored by ty)
info:   4. /Users/hermeschen/Repo/work/taiwan-license-plate-recognition/.venv/lib/python3.12/site-packages (site-packages)
info: make sure your Python environment is properly configured: https://docs.astral.sh/ty/modules/#python-environment
info: rule `unresolved-import` is enabled by default

Found 4 diagnostics
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-11-28 17:53</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>we do inspect <code>.pyi</code> files, yes. I assumed you didn&#x27;t have any because you said you only had C extensions in <code>site-packages</code> ðŸ˜„
Can you please list out all the files for your package that are included in <code>site-packages</code>?</p>
</blockquote>
<p>Sure. utils is my custom package.</p>
<img alt="Image" src="https://private-user-images.githubusercontent.com/108386417/520207559-f7847e36-1fa0-45a8-bfe7-f331a725c9ff.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQzNTI2MjQsIm5iZiI6MTc2NDM1MjMyNCwicGF0aCI6Ii8xMDgzODY0MTcvNTIwMjA3NTU5LWY3ODQ3ZTM2LTFmYTAtNDVhOC1iZmU3LWYzMzFhNzI1YzlmZi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMTI4JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTEyOFQxNzUyMDRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1iMGMyOWExOTA4NWIyNWM4MWE5NDU1MzRiMmUzZTE5NTNmMDI3ZDc5MDQ2MjYzYzRjMzAzYzAzY2JhMTQ3NWQ3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.YquGJFTtiJeoCZ34f98zQwIZLfI7S6PziBobhACBh0U">

</blockquote>
<p><img alt="Image" src="https://github.com/user-attachments/assets/6c393734-45ec-4914-b9d3-8d597efc8336"></p>
<p>I found extra .pyi for my package outside the dir I showed in the previous image, and it looks like below.</p>
<pre><code># This file was generated by Nuitka

# Stubs included by default
from __future__ import annotations
from __future__ import annotations
import importlib.resources

PROJECT_ROOT = PACKAGE_ROOT.parent.parent

__name__ = ...



# Modules used internally, to allow implicit dependencies to be seen:
import os
import __future__
import importlib
import importlib.resources
import concurrent
import concurrent.futures
import typing
import aiologic
import aiologic.lowlevel
import culsans
import culsans._queues
import structlog
import structlog.typing
import utils.concurrent.gather
import contextlib
import pathlib
import httpx
import httpx_retries
import asgi_lifespan
import pytest
import functools
import inspect
import multiprocessing
import time
import anyio
import enum
import anyio.abc
import anyio.from_thread
import anyio.to_thread
import concurrent.futures.thread
import io
import cv2
import cv2.typing
import numpy
import numpy.typing
import collections
import collections.abc
import logging
import colorama
import orjson
import structlog.contextvars
import structlog.dev
import structlog.processors
import abc
import concurrent.futures.Future
import concurrent.futures.ThreadPoolExecutor
import concurrent.futures.as_completed
import itertools
import granian
import granian._imports
import torch
import torch.utils
import torch.utils.data
import utils.concurrent.RaiseBehavior
import utils.concurrent.as_async
import utils.concurrent.as_sync
import utils.concurrent.execute_async
import gc
import fastapi
import sys
import granian.constants
import granian.log
import msgspec
import msgspec.toml
import copy
import urllib
import urllib.parse
import attrs
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-02 00:42</div>
            <div class="timeline-body"><blockquote>
<p>I found extra .pyi for my package</p>
</blockquote>
<p>Yes, I think this is the problem. ty is finding <code>utils.pyi</code> and prioritizing it over <code>utils/concurrent/__init__.pyi</code>, and <code>utils.pyi</code> has no submodule <code>concurrent</code>. (Note the fact that it contains <code>import concurrent</code> is not the same as having an actual submodule named <code>concurrent</code>, and is not sufficient for <code>from utils.concurrent import ...</code> to work -- though it should be sufficient for <code>from utils import concurrent</code> to work.)</p>
<p>ty&#x27;s behavior here is consistent with the behavior at runtime (assuming these were all <code>.py</code> instead of <code>.pyi</code> files), so I don&#x27;t think this is a bug in ty. If you want the pyi files under <code>utils/</code> directory to be used, remove the outer <code>utils.pyi</code>.</p>
<p>There is one more wrinkle here, which ty is also accurately modeling from runtime. That is that a package <code>foo/__init__.py</code> does take priority over <code>foo.py</code>, but a <em>namespace</em> package <code>foo/</code> (with no <code>foo/__init__.py</code>) is lower priority than <code>foo.py</code>. So another solution to your problem could be to add <code>utils/__init__.pyi</code> file; then the outer <code>utils.pyi</code> would be ignored in favor of the <code>utils/</code> package. But I&#x27;m not sure why you&#x27;d want to keep the unused <code>utils.pyi</code> in that case.</p>
<p>Thanks for the report! I will close it since currently I don&#x27;t see a bug in ty here. If you believe there&#x27;s a bug, please comment! It would be helpful if you can provide a complete reproducible example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-12-02 00:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-02 01:19</div>
            <div class="timeline-body"><p>I see. I think the outer utils.pyi is generated by nuitka. I found there&#x27;s some content about it.
Thank you for the help.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:08 UTC
    </footer>
</body>
</html>
