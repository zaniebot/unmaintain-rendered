<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>support `type[...]` types in implicit type aliases - astral-sh/ty #1534</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>support <code>type[...]</code> types in implicit type aliases</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1534">#1534</a>
        opened by <a href="https://github.com/loicdiridollou">@loicdiridollou</a>
        on 2025-11-12 22:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/loicdiridollou">@loicdiridollou</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>With the last release we have seen some breaking behavior in <code>ty</code> (1a26)
Playground is https://play.ty.dev/fae7deba-76eb-45bf-87a3-02871d95e3c3</p>
<p>The error we are getting is:
<code>error[invalid-type-form]: Variable of type UnionType is not allowed in a type expression</code>
which we did not get with version 1a25.</p>
<p>Not sure what caused this change but curious to know how it appeared under the hood.
For reference the code from the playground is below:</p>
<pre><code class="language-python">from collections.abc import (
    Hashable,
    Mapping,
)
from typing import TypeAlias

# dtypes
NpDtypeNoStr: TypeAlias = type[str] | type[complex | bool | object]
NpDtype: TypeAlias = str | NpDtypeNoStr | type[str]
Dtype: TypeAlias = NpDtypeNoStr | NpDtype
# DtypeArg specifies all allowable dtypes in a functions its dtype argument
DtypeArg: TypeAlias = Dtype | Mapping[Hashable, Dtype]
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1a26</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @carljm on 2025-11-12 22:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-12 23:00</div>
            <div class="timeline-body"><p>Thanks for the report! Sorry, this is indeed a bug in our handling of type aliases.</p>
<p>@sharkdp it looks like we aren't handling <code>type[...]</code> (<code>SubclassOf</code>) types in unions in type aliases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Issue with UnionType not allowed in type expression" to "support `type[...]` types in implicit type aliases" by @carljm on 2025-11-12 23:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Beta" by @carljm on 2025-11-13 06:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-13 07:21</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/sharkdp">@sharkdp</a> it looks like we aren't handling <code>type[...]</code> (<code>SubclassOf</code>) types in unions in type aliases.</p>
</blockquote>
<p>Correct. It's next on my list here: https://github.com/astral-sh/ty/issues/221#issuecomment-3482599572</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-11-13 07:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:57 UTC
    </footer>
</body>
</html>
