<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Completions should be more discriminating with symbols in stub files - astral-sh/ty #1756</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Completions should be more discriminating with symbols in stub files</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1756">#1756</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-12-04 15:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This came up <a href="https://github.com/astral-sh/ruff/pull/21779/files/d314aa859dcf9a6ffb006a594d7ca0431dd4fab2#r2586899735">here</a>.</p>
<p>@carljm said:</p>
<blockquote>
<p>I think this is the right call for Python files, but I'm not sure about stubs / typeshed. I think in the case of stubs we maybe shouldn't auto-complete non-re-exported names at all? But not totally sure, and it's not a question that has to be answered in this PR.</p>
</blockquote>
<p>And @AlexWaygood said:</p>
<blockquote>
<p>You should assume that most names in a stub also exist at runtime.</p>
<p>Private names in a stub (starting with a single underscore) are often things that do not in fact exist at runtime. But you can't impose a blanket rule that private names in stubs should never be considered unexported, because there are things like <code>os._exit</code> that are very much public API. The underscore there is to warn users that it's a very dangerous API to use.</p>
<p>You can however have very high confidence that private names in stubs that define type aliases, protocols, type variables or typed dicts will not in fact exist at runtime. You can also have high confidence that most imported items will not exist at runtime: anything imported that is not included in <code>__all__</code>, does not refer to a submodule of the current package, and does not use the redundant alias convention. Lastly, anything decorated with <code>@type_check_only</code> in a stub file will not exist at runtime.</p>
</blockquote>
<p>And also:</p>
<blockquote>
<p>I do think Carl is correct here that we should not offer <code>ZQZQ</code> as an attribute completion here at all if it's <code>foo.pyi</code> instead of <code>foo.py</code>. In the type checker, if <code>foo</code> is defined as a <code>pyi</code> file then I don't think we consider <code>foo</code> to have a <code>ZQZQ</code> attribute at all, because it's been defined in the <code>foo</code> module using an import that wasn't an explicit re-export. Stubs often import many things in modules even though they don't exist in those modules at runtime; it's often necessary to do so in order to annotate the public interfaces of those modules.</p>
</blockquote>
<p>We should revise our completions to make sure we respect conventions with respect to stub files specifically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @BurntSushi on 2025-12-04 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by @BurntSushi on 2025-12-04 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">stubs</span> added by @AlexWaygood on 2025-12-04 15:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:10 UTC
    </footer>
</body>
</html>
