<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>how should `assert_type` handle the float/complex special case? - astral-sh/ty #197</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>how should <code>assert_type</code> handle the float/complex special case?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/197">#197</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-02-14 22:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body">Description
<p>We follow the typing spec and other type checkers in implementing the special case that a <code>float</code> annotation means <code>int | float</code>, and a <code>complex</code> annotation means <code>int | float | complex</code>.</p>
<p>We don&#x27;t currently follow other type checkers in trying to &quot;hide&quot; this special case by revealing just <code>float</code> or <code>complex</code> when the actual type we have is <code>int | float</code> or <code>int | float | complex</code>. Doing this leads to very strange-looking behaviors, like this from pyright:</p>
<pre><code>def _(x: float):
    reveal_type(x)  # float
    if isinstance(x, float):
        reveal_type(x)  # float
    reveal_type(x)  # float | int ??
</code></pre>
<p>But this leads us to fail this type assertion:</p>
<pre><code>assert_type(3.14, float)
</code></pre>
<p>Because we interpret <code>float</code> there as a type expression, meaning we take it to be <code>int | float</code>, but we actually infer just <code>float</code> for the literal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-02-15 00:33</div>
            <div class="timeline-body"><p>I think <code>float</code> should be interpreted as <code>int | float</code> no matter the context. That helps with consistency.</p>
<p>Instead, <code>knot_extensions</code> should export <code>BareFloat</code> and <code>BareComplex</code> as public APIs for such use cases (credits go to @sharkdp):</p>
<pre><code>type BareFloat = TypeOf[1.0]
type BareComplex = TypeOf[1j]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[red-knot] how should `assert_type` handle the float/complex special case?&quot; to &quot;how should `assert_type` handle the float/complex special case?&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-07 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typing semantics</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-11 07:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-23 09:48</div>
            <div class="timeline-body"><p>I think we still haven&#x27;t decided if <code>ty_extensions</code> should be user-facing, but for now, <code>ty_extensions.JustFloat</code> and <code>ty_extensions.JustComplex</code> are available:</p>
<pre><code>from ty_extensions import JustFloat

def only_float_allowed(f: JustFloat): ...

only_float_allowed(1.0)
only_float_allowed(1)  # invalid_argument-type
</code></pre>
<p>https://play.ty.dev/e83982c2-6ab6-409a-8608-97f7f0baa14a</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-23 09:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:16 UTC
    </footer>
</body>
</html>
