<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitwise operations between `bool` and `Literal[True]` are inferred as `int` instead of `bool` - astral-sh/ty #649</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bitwise operations between <code>bool</code> and <code>Literal[True]</code> are inferred as <code>int</code> instead of <code>bool</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/649">#649</a>
        opened by <a href="https://github.com/pt1243">@pt1243</a>
        on 2025-06-13 14:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pt1243">@pt1243</a> on 2025-06-13 14:15</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Apologies if this is a duplicate - I quickly skimmed the issue tracker but did not see any reports of this exact case.</p>
<p>When using a bitwise operator (<code>&amp;</code>, <code>|</code>, or <code>^</code>) on a <code>Literal[True]</code> (or <code>Literal[False]</code>) and a <code>bool</code>, ty incorrectly reports the result as being of type <code>int</code>:</p>
<pre><code class="language-python">from random import random

def f() -&gt; bool:
    return random() &gt; 0.5

a = True &amp; f()
reveal_type(a)  # revealed type is int, should be bool
</code></pre>
<p><a href="https://play.ty.dev/3b2e2206-8d8a-4703-ac69-2df11fa1d48c">Playground link here.</a></p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.9 (2feba5eb2 2025-06-11)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-06-13 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">runtime semantics</span> added by @AlexWaygood on 2025-06-13 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-13 14:21</div>
            <div class="timeline-body"><p>This seemed similar enough to #517 that I hoped it would be fixed by https://github.com/astral-sh/ruff/pull/18329, but that doesn't seem to be the case. So, no, not a duplicate -- thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alpaylan">@alpaylan</a> on 2025-06-13 14:51</div>
            <div class="timeline-body"><p>I'm thinking of checking this out as a <code>good first issue</code>, does that make sense?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alpaylan">@alpaylan</a> on 2025-06-13 15:21</div>
            <div class="timeline-body"><p>The issue is at https://github.com/astral-sh/ruff/blob/793ff9bdbc2ad4909f45594726ee0d2ff166130c/crates/ty_python_semantic/src/types/infer.rs#L6708</p>
<pre><code class="language-rust">  (Type::BooleanLiteral(bool_value), right, op) =&gt; self.infer_binary_expression_type(
      node,
      emitted_division_by_zero_diagnostic,
      Type::IntLiteral(i64::from(bool_value)),
      right,
      op,
  ),
</code></pre>
<p>When pattern matching, the types are <code>infer_binary_expression_type: left_ty = Literal[True], right_ty = bool, op = BitAnd</code></p>
<p>At L6708, the boolean literal <code>Literal[True]</code> is converted to integer literal <code>Literal[1]</code>, which results in the bug mentioned.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-06-13 18:26</div>
            <div class="timeline-body"><p>@alpaylan Thanks for the root-causing and the fix! I reviewed your PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @alpaylan by @carljm on 2025-06-13 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-17 17:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:39:56 UTC
    </footer>
</body>
</html>
