<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[panic] internal error: entered unreachable code: Two equal, normalized intersections should share the same Salsa ID - astral-sh/ty #2451</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[panic] internal error: entered unreachable code: Two equal, normalized intersections should share the same Salsa ID</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2451">#2451</a>
        opened by <a href="https://github.com/yilei">@yilei</a>
        on 2026-01-11 21:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/yilei">@yilei</a> on 2026-01-11 21:00</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Given following Python code:</p>
<pre><code class="language-python">from typing import Any, TypedDict, cast


class A(TypedDict):
    x: str


class B(TypedDict):
    y: str


T = int | A | B


def test(a: Any, items: list[T]) -&gt; None:
    combined = a or items
    v = combined[0]
    if isinstance(v, dict):
        cast(T, v)
</code></pre>
<p><code>ty check</code> panicked:</p>
<pre><code>‚ùØ ty check /tmp/t.py
error[panic]: Panicked at crates/ty_python_semantic/src/types/type_ordering.rs:270:13 when checking `/tmp/t.py`: `internal error: entered unreachable code: Two equal, normalized intersections should share the same Salsa ID`
info: This indicates a bug in ty.
info: If you could open an issue at https://github.com/astral-sh/ty/issues/new?title=%5Bpanic%5D, we'd be very appreciative!
info: Platform: linux x86_64
info: Version: 0.0.11+1 (22e97ecdd 2026-01-09)
info: Args: [&quot;ty&quot;, &quot;check&quot;, &quot;/tmp/t.py&quot;]
info: Backtrace:
   0: &lt;unknown&gt;
   1: &lt;unknown&gt;
   2: &lt;unknown&gt;
   3: &lt;unknown&gt;
   4: &lt;unknown&gt;
   5: &lt;unknown&gt;
   6: &lt;unknown&gt;
   7: &lt;unknown&gt;
   8: &lt;unknown&gt;
   9: &lt;unknown&gt;
  10: &lt;unknown&gt;
  11: &lt;unknown&gt;
  12: &lt;unknown&gt;
  13: &lt;unknown&gt;
  14: &lt;unknown&gt;
  15: &lt;unknown&gt;
  16: &lt;unknown&gt;
  17: &lt;unknown&gt;
  18: &lt;unknown&gt;
  19: &lt;unknown&gt;
  20: &lt;unknown&gt;
  21: &lt;unknown&gt;
  22: &lt;unknown&gt;
  23: &lt;unknown&gt;
  24: &lt;unknown&gt;
  25: &lt;unknown&gt;
  26: &lt;unknown&gt;
  27: &lt;unknown&gt;
  28: &lt;unknown&gt;
  29: &lt;unknown&gt;
  30: &lt;unknown&gt;
  31: &lt;unknown&gt;
  32: &lt;unknown&gt;
  33: &lt;unknown&gt;
  34: &lt;unknown&gt;
  35: &lt;unknown&gt;
  36: &lt;unknown&gt;
  37: &lt;unknown&gt;
  38: &lt;unknown&gt;

info: query stacktrace:
   0: infer_expression_types_impl(Id(1805))
             at crates/ty_python_semantic/src/types/infer.rs:196
   1: infer_scope_types(Id(1003))
             at crates/ty_python_semantic/src/types/infer.rs:69
   2: check_file_impl(Id(c00))
             at crates/ty_project/src/lib.rs:554
</code></pre>
<h3>Version</h3>
<p>ty 0.0.11+1 (22e97ecdd 2026-01-09)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2026-01-11 21:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by @AlexWaygood on 2026-01-11 21:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Pre-stable 1" by @AlexWaygood on 2026-01-11 21:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2026-01-12 00:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:26:57 UTC
    </footer>
</body>
</html>
