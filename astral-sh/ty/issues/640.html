<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--python` doesn't use provided python - astral-sh/ty #640</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>--python</code> doesn&#x27;t use provided python</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/640">#640</a>
        opened by <a href="https://github.com/remiconnesson">@remiconnesson</a>
        on 2025-06-12 07:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/remiconnesson">@remiconnesson</a></div>
            <div class="timeline-body">Summary
<p><code>uvx ty check . --python=&quot;/home/remi/work/acme/app/.venv/bin/python&quot;</code></p>
<p>gives error <code>[unresolved-import]: Cannot resolve imported module acme.Acme</code></p>
<p>where <code>acme</code> is an editable installed package</p>
<p>whereas running <code>/home/remi/work/acme/app/.venv/bin/python</code> does work (as shown below)</p>
<pre><code>&gt;&gt;&gt; from acme import Acme
</code></pre>
<p>So it looks like <code>ty</code> is not picking up the .venv from the <code>--python</code> argument</p>
<hr>
<p>I also tried initially using <code>uvx ty check</code> having the <code>.venv</code> activated but it seems to me more significative that explicitly setting the python still doesn&#x27;t work</p>
<p>My system is WSL2 ubuntu</p>
Version
<p>ty 0.0.1-alpha.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-12 07:39</div>
            <div class="timeline-body"><p>Thanks for the report. Can you try running <code>uvx ty check . --python=&quot;/home/remi/work/acme/app/.venv/bin/python&quot;</code> with <code>-vv</code> and share the logs here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-12 07:40</div>
            <div class="timeline-body"><p>Is ty able to resolve imports that refer to non-editable installs in that Python installation? And does the editably installed package use setuptools as its build backend? (Setuptools is the default build backend if no backend has been specified in your pyproject.toml.)</p>
<p>If the answer to both of those is &quot;yes&quot; then this is probably another instance of #585 / #475. It&#x27;s a priority for us to improve our diagnostics here to make it clearer what the issue is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-12 07:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-12 07:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/remiconnesson">@remiconnesson</a> on 2025-06-12 08:22</div>
            <div class="timeline-body"><p>@AlexWaygood</p>
<blockquote>
<p>Is ty able to resolve imports that refer to non-editable installs in that Python installation?</p>
</blockquote>
<p>No it isn&#x27;t actually <code>error[unresolved-import]: Cannot resolve imported module ``numpy`` </code></p>
<blockquote>
<p>And does the editably installed package use setuptools as its build backend? (Setuptools is the default build backend if no backend has been specified in your pyproject.toml.)</p>
</blockquote>
<p>Yes I think so (using setup.py which imports setuptools)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/remiconnesson">@remiconnesson</a> on 2025-06-12 08:27</div>
            <div class="timeline-body"><p>@MichaReiser</p>
<blockquote>
<p>Thanks for the report. Can you try running uvx ty check . --python=&quot;/home/remi/work/project/app/.venv/bin/python&quot; with -vv and share the logs here?</p>
</blockquote>
<p>A weird thing, not sure if that&#x27;s the issue, It seems it&#x27;s using src but it shouldn&#x27;t, (monorepo), <code>src</code> and <code>app</code> are neighbors in my case</p>
<pre><code>➜  alerting git:(user/alerting/queries) ✗ uvx ty check . --python=/home/user/work/project/app/.venv/bin/python -vv
2025-06-12 10:23:30.127431482 WARN  ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
2025-06-12 10:23:30.128089456 DEBUG Version: 0.0.1-alpha.9
2025-06-12 10:23:30.128119473 DEBUG Architecture: x86_64, OS: linux, case-sensitive: case-sensitive
2025-06-12 10:23:30.128233015 DEBUG Searching for a project in &#x27;/home/user/work/project/app/org/alerting&#x27;
2025-06-12 10:23:30.128366416 DEBUG Project without `tool.ty` section: &#x27;/home/user/work/project&#x27;
2025-06-12 10:23:30.128400209 DEBUG Searching for a user-level configuration at `/home/user/.config/ty/ty.toml`
2025-06-12 10:23:30.128432289 INFO  Defaulting to python-platform `linux`
2025-06-12 10:23:30.128458298 DEBUG Including `./src` in `src.root` because a `./src` directory exists
2025-06-12 10:23:30.128507220 DEBUG Adding first-party search path &#x27;/home/user/work/project&#x27;
2025-06-12 10:23:30.128534070 DEBUG Adding first-party search path &#x27;/home/user/work/project/src&#x27;
2025-06-12 10:23:30.128540963 DEBUG Using vendored stdlib
2025-06-12 10:23:30.129026513 DEBUG Resolving `--python` argument: /home/user/work/project/app/.venv/bin/python
2025-06-12 10:23:30.129086235 DEBUG Attempting to parse virtual environment metadata at &#x27;/home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/pyvenv.cfg&#x27;
2025-06-12 10:23:30.129112264 DEBUG Searching for site-packages directory in sys.prefix /home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu
2025-06-12 10:23:30.129156347 DEBUG Resolved site-packages directories for this environment are: SitePackagesPaths({&quot;/home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/lib/python3.12/site-packages&quot;})
2025-06-12 10:23:30.129176555 DEBUG Adding site-packages search path &#x27;/home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/lib/python3.12/site-packages&#x27;
2025-06-12 10:23:30.129211881 INFO  Python version: Python 3.13, platform: linux
2025-06-12 10:23:30.129303082 DEBUG Setting included paths: 1
2025-06-12 10:23:30.129334421 DEBUG Reloading files for project `project`
2025-06-12 10:23:30.129416294 DEBUG Starting main loop
2025-06-12 10:23:30.129456189 DEBUG Waiting for next main loop message.
2025-06-12 10:23:30.129524597 DEBUG Checking project &#x27;project&#x27;
2025-06-12 10:23:30.133619416 INFO   Indexed 13 file(s)
2025-06-12 10:23:30.134071504 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/__init__.py&#x27;
2025-06-12 10:23:30.134084037 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/stats.py&#x27;
2025-06-12 10:23:30.134088406 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/run_data/queries.py&#x27;
2025-06-12 10:23:30.134070973 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/run_data/service.py&#x27;
2025-06-12 10:23:30.134133189 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/__init__.py&#x27;
2025-06-12 10:23:30.134102392 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/generator.py&#x27;
2025-06-12 10:23:30.134987842 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/anomaly_detection/__init__.py&#x27;
2025-06-12 10:23:30.135000857 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/exceptions.py&#x27;
2025-06-12 10:23:30.135036183 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/run_data/__init__.py&#x27;
2025-06-12 10:23:30.135524779 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/run_data/dto.py&#x27;
2025-06-12 10:23:30.135715577 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/repository.py&#x27;
2025-06-12 10:23:30.136774743 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/generator_history/run_data/mapper.py&#x27;
2025-06-12 10:23:30.136844424 DEBUG Resolving dynamic module resolution paths
2025-06-12 10:23:30.137459176 DEBUG Module `sqlalchemy.orm` not found in search paths
2025-06-12 10:23:30.137598067 DEBUG Module `org.exceptions` not found in search paths
2025-06-12 10:23:30.137708183 DEBUG Checking file &#x27;/home/user/work/project/app/org/alerting/anomaly_detection/core.py&#x27;
2025-06-12 10:23:30.137855249 DEBUG Module `org.alerting.generator_history.generator` not found in search paths
2025-06-12 10:23:30.139983851 DEBUG Module `sqlalchemy` not found in search paths
2025-06-12 10:23:30.140052580 DEBUG Module `org.tracking.models` not found in search paths
2025-06-12 10:23:30.151783237 DEBUG Module `org.alerting.stats` not found in search paths
2025-06-12 10:23:30.152840891 DEBUG Module `numpy` not found in search paths
2025-06-12 10:23:30.152974671 DEBUG Module `pandas` not found in search paths
2025-06-12 10:23:30.155960851 DEBUG Module `org.alerting` not found in search paths
2025-06-12 10:23:30.156015794 DEBUG Module `org.alerting.generator_history` not found in search paths
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-12 08:32</div>
            <div class="timeline-body"><p>Is <code>/home/user/work/project/app/.venv/bin/python</code> a symlink to <code>/home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python</code>? It looks like we might be resolving symlinks too soon/eagerly if so (which is causing us to add the uv-managed system installation&#x27;s <code>site-packages</code> directory as a search path instead of the virtual environment&#x27;s <code>site-packages</code> directory)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/remiconnesson">@remiconnesson</a> on 2025-06-12 08:36</div>
            <div class="timeline-body"><blockquote>
<p>Is /home/user/work/project/app/.venv/bin/python a symlink to /home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python?</p>
</blockquote>
<p>Yes it is, I just checked</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-12 08:37</div>
            <div class="timeline-body"><p>Great, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-12 08:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-20 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-21 19:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:50 UTC
    </footer>
</body>
</html>
