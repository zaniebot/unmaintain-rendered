<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hang checking calls to function with hundreds of overloads (started in 0.0.1-alpha.22) - astral-sh/ty #1337</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>hang checking calls to function with hundreds of overloads (started in 0.0.1-alpha.22)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1337">#1337</a>
        opened by <a href="https://github.com/galah92">@galah92</a>
        on 2025-10-12 09:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/galah92">@galah92</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Looks like something related to the search path.
Attached run logs on the same codebase with <code>alpha.21</code> and <code>alpha.22</code>.</p>
<p><a href="https://github.com/user-attachments/files/22870529/0.0.1-alpha.21.log">0.0.1-alpha.21.log</a>
<a href="https://github.com/user-attachments/files/22870528/0.0.1-alpha.22.log">0.0.1-alpha.22.log</a></p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">hang</span> added by @AlexWaygood on 2025-10-12 09:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-12 16:20</div>
            <div class="timeline-body"><p>The 0.22 log only contains a single message saying that all checks passed.</p>
<p>Would you mind running ty with <code>ty check -v</code> or even <code>ty check -vv</code>? Is the project available open source (we could then try to run ty ourselves).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2025-10-12 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-13 05:33</div>
            <div class="timeline-body"><p>My bad, attached the updated log:</p>
<ul>
<li><code>uvx ty@0.0.1-alpha.21 check -vv 2&gt; 0.0.1-alpha.21.log</code>: <a href="https://github.com/user-attachments/files/22877221/0.0.1-alpha.21.log">0.0.1-alpha.21.log</a></li>
<li><code>uvx ty@0.0.1-alpha.22 check -vv 2&gt; 0.0.1-alpha.22.log</code>: <a href="https://github.com/user-attachments/files/22877220/0.0.1-alpha.22.log">0.0.1-alpha.22.log</a></li>
</ul>
<p>You'll notice 0.22 has many <code>types_aiobotocore_* not found in search paths</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-13 06:44</div>
            <div class="timeline-body"><p>I can see that the performance significantely recreased between 21 and 22 (from ~100ms to 4s).</p>
<p>The <a href="https://www.diffchecker.com/YYNjpbZV/">logs</a> otherwise look mostly the same, including the many failed module resolutions.</p>
<p>It's a bit hard to tell from the logs which file took long to type check. We should probably add some timing information to our logs to make it easier to track those down.</p>
<p>For the failed imports: Is <code>/Users/galah92/Downloads/VayyarHomeCloud/python</code> your virtual environment? Are the dependencies that fail to resolve installed into that environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-13 06:47</div>
            <div class="timeline-body"><blockquote>
<p>For the failed imports: Is <code>/Users/galah92/Downloads/VayyarHomeCloud/python</code> your virtual environment? Are the dependencies that fail to resolve installed into that environment?</p>
</blockquote>
<p>Yes, that's the root of my repo. I cannot share the code unfortunately. All dependencies were resolved correctly, <code>alpha.21</code> seem to find them all.
Is there anything else I can provide that will help to debug this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-13 07:07</div>
            <div class="timeline-body"><blockquote>
<p>Yes, that's the root of my repo. I cannot share the code unfortunately. All dependencies were resolved correctly, alpha.21 seem to find them all.</p>
</blockquote>
<p>I'm not sure about that. I see about the same amount of unresolved import errors for both versions (at least from the logs you shared).</p>
<blockquote>
<p>Is there anything else I can provide that will help to debug this?</p>
</blockquote>
<p>I put up https://github.com/astral-sh/ruff/pull/20836 which should help debug this in the future. What you could try now is to run the following command (assuming unix):</p>
<pre><code>TY_MAX_PARALLELISM=1 ty check -vv
</code></pre>
<p>This reduces concurrency to 1 thread. The timing events in the logs should then tell us which file takes long to type check (unless there are multiple once). Once you konw the file, you can try to binary-search your way to find the problematic code:</p>
<ul>
<li>Try to comment out half of the imports.<ul>
<li>Is it still slow? Try to comment out the other half of the imports... and so on</li>
<li>Is it now fast? Revert, now comment out the other half of the imports...</li>
</ul>
</li>
<li>After the imports, apply the same mechanics to the body of the file. Comment out half of the file's body. Is it still slow? Comment out the half of the remaining uncommented code...</li>
</ul>
<p>Hopefully, this narrows the code down to a single Class, method, or a few lines. You could then try to obfuscate the code before sharing or try to describe the problematic code (like what is it doing? Is it a large dictionary or type dict, is it a very large union? ...)</p>
<p>I'm sorry that there isn't an easier way.</p>
<p>We're also aware of some cases where ty is hanging (e.g. does your code look similar to https://github.com/astral-sh/ty/issues/1111) that we hope to address as part of the next release. You could also consider waiting and reporting back with the new release (should be released sometimes this week)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-17 09:09</div>
            <div class="timeline-body"><p>We released a new ty version. Do you want to give it a try? It should now also log files that take long when using <code>-vv</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-17 17:15</div>
            <div class="timeline-body"><p>Just did, there's still slowness since <code>alpha.22</code> that's present in <code>alpha.23</code>.</p>
<p><a href="https://github.com/user-attachments/files/22976518/0.0.1-alpha.21.log">0.0.1-alpha.21.log</a>
<a href="https://github.com/user-attachments/files/22976517/0.0.1-alpha.22.log">0.0.1-alpha.22.log</a>
<a href="https://github.com/user-attachments/files/22976516/0.0.1-alpha.23.log">0.0.1-alpha.23.log</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-17 17:19</div>
            <div class="timeline-body"><p>Thanks for testing again. It seems that ty spends the majority of the within those files</p>
<pre><code>2025-10-17 20:14:19.974382 INFO Checking file `/Users/galah92/Downloads/VayyarHomeCloud/python/care/core/fastapi_s3.py` took more than 100ms (2.789960458s)
2025-10-17 20:14:19.974846 INFO Checking file `/Users/galah92/Downloads/VayyarHomeCloud/python/care/conftest.py` took more than 100ms (2.860847125s)
</code></pre>
<p>Can you maybe tell me more about those files. Do they use specific third party libraries? Are there other langauge features that you make use of that you aren't using in any of the other files? Do they use very large literal types (e.g. dictionaries or lists)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-17 17:26</div>
            <div class="timeline-body"><p>Sure.</p>
<p>See <a href="https://github.com/user-attachments/files/22976965/fastapi_s3.py">fastapi_s3.py</a></p>
<p>As for <code>conftest.py</code>, these are the imports:</p>
<pre><code class="language-python">import base64
import os
import random
import secrets
import uuid
from collections.abc import AsyncGenerator, AsyncIterator, Generator
from dataclasses import dataclass
from datetime import UTC, datetime, timedelta
from random import choice
from string import ascii_lowercase

import aioboto3
import pytest
import pytest_asyncio
from argon2 import PasswordHasher
from firebase_admin import auth  # type: ignore
from pytest_asyncio import is_async_test
from types_aiobotocore_s3.client import S3Client
</code></pre>
<p>There's nothing special there, it's mostly pytest fixtures for our specific business logic.</p>
<p>I believe the common thing between the two is the usage of <code>types_aiobotocore_s3</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-21 08:47</div>
            <div class="timeline-body"><p>Thanks for the additional information. I tried to reproduce the hang with the <code>fastapi_s3.py</code> but I'm unable to reproduce the hang</p>
<pre><code>2025-10-21 10:45:09.232145 DEBUG Version: 0.0.1-alpha.23 (5c51b8480 2025-10-16)
2025-10-21 10:45:09.23385 DEBUG Architecture: aarch64, OS: macos, case-sensitive: case-insensitive
2025-10-21 10:45:09.234047 DEBUG Searching for a project in '/Users/micha/astral/test/1337'
2025-10-21 10:45:09.234871 DEBUG Found project at '/Users/micha/astral/test/1337'
2025-10-21 10:45:09.234886 DEBUG Searching for a user-level configuration at `/Users/micha/.config/ty/ty.toml`
2025-10-21 10:45:09.238958 DEBUG Discovering virtual environment in `/Users/micha/astral/test/1337`
2025-10-21 10:45:09.238982 DEBUG Attempting to parse virtual environment metadata at '/Users/micha/astral/test/1337/.venv/pyvenv.cfg'
2025-10-21 10:45:09.239336 DEBUG Searching for site-packages directory in sys.prefix /Users/micha/astral/test/1337/.venv
2025-10-21 10:45:09.23993 DEBUG Resolved site-packages directories for this virtual environment are: SitePackagesPaths({&quot;/Users/micha/astral/test/1337/.venv/lib/python3.14/site-packages&quot;})
2025-10-21 10:45:09.239989 DEBUG Searching for real stdlib directory in sys.prefix /Users/micha/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none
2025-10-21 10:45:09.239995 DEBUG Resolved real stdlib path for this virtual environment is: /Users/micha/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14
2025-10-21 10:45:09.240001 DEBUG Including `.` in `environment.root`
2025-10-21 10:45:09.240016 DEBUG Adding first-party search path `/Users/micha/astral/test/1337`
2025-10-21 10:45:09.240029 DEBUG Using vendored stdlib
2025-10-21 10:45:09.24093 DEBUG Adding site-packages search path `/Users/micha/astral/test/1337/.venv/lib/python3.14/site-packages`
2025-10-21 10:45:09.240936 INFO Python version: Python 3.14, platform: linux
2025-10-21 10:45:09.240968 DEBUG Adding new file root '/Users/micha/astral/test/1337/.venv/lib/python3.14/site-packages' of kind LibrarySearchPath
2025-10-21 10:45:09.243478 DEBUG Adding new file root '/Users/micha/astral/test/1337' of kind Project
2025-10-21 10:45:09.243997 DEBUG Starting main loop
2025-10-21 10:45:09.244005 DEBUG Waiting for next main loop message.
2025-10-21 10:45:09.244052 DEBUG Checking all files in project 'ty1337'
2025-10-21 10:45:09.248506 INFO Indexed 1 file(s) in 0.004s
2025-10-21 10:45:09.249358 DEBUG Checking file '/Users/micha/astral/test/1337/main.py'
2025-10-21 10:45:09.267588 DEBUG Resolving dynamic module resolution paths
2025-10-21 10:45:09.28292 DEBUG Checking all files took 0.034s
All checks passed!
2025-10-21 10:45:09.282993 DEBUG Exiting main loop
</code></pre>
<p>This is my <code>pyproject.toml</code></p>
<pre><code class="language-toml">[project]
name = &quot;ty1337&quot;
version = &quot;0.0.1&quot;
dependencies = [
    &quot;aioboto3&gt;=15.4.0&quot;,
    &quot;fastapi&gt;=0.119.1&quot;,
    &quot;types-aiobotocore[s3]&gt;=2.25.0&quot;,
]

[tool.ty]

</code></pre>
<p>And running ty</p>
<pre><code class="language-bash">uvx ty@latest check -vv --python-platform linux --python-version 3.12
2025-10-21 10:46:48.424481 DEBUG Version: 0.0.1-alpha.23 (5c51b8480 2025-10-16)
2025-10-21 10:46:48.426117 DEBUG Architecture: aarch64, OS: macos, case-sensitive: case-insensitive
2025-10-21 10:46:48.42632 DEBUG Searching for a project in '/Users/micha/astral/test/1337'
2025-10-21 10:46:48.427035 DEBUG Found project at '/Users/micha/astral/test/1337'
2025-10-21 10:46:48.427051 DEBUG Searching for a user-level configuration at `/Users/micha/.config/ty/ty.toml`
2025-10-21 10:46:48.431019 DEBUG Discovering virtual environment in `/Users/micha/astral/test/1337`
2025-10-21 10:46:48.431043 DEBUG Attempting to parse virtual environment metadata at '/Users/micha/astral/test/1337/.venv/pyvenv.cfg'
2025-10-21 10:46:48.43128 DEBUG Searching for site-packages directory in sys.prefix /Users/micha/astral/test/1337/.venv
2025-10-21 10:46:48.431837 DEBUG Resolved site-packages directories for this virtual environment are: SitePackagesPaths({&quot;/Users/micha/astral/test/1337/.venv/lib/python3.14/site-packages&quot;})
2025-10-21 10:46:48.431889 DEBUG Searching for real stdlib directory in sys.prefix /Users/micha/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none
2025-10-21 10:46:48.431895 DEBUG Resolved real stdlib path for this virtual environment is: /Users/micha/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14
2025-10-21 10:46:48.431901 DEBUG Including `.` in `environment.root`
2025-10-21 10:46:48.431916 DEBUG Adding first-party search path `/Users/micha/astral/test/1337`
2025-10-21 10:46:48.43193 DEBUG Using vendored stdlib
2025-10-21 10:46:48.432806 DEBUG Adding site-packages search path `/Users/micha/astral/test/1337/.venv/lib/python3.14/site-packages`
2025-10-21 10:46:48.432814 INFO Python version: Python 3.12, platform: linux
2025-10-21 10:46:48.432859 DEBUG Adding new file root '/Users/micha/astral/test/1337/.venv/lib/python3.14/site-packages' of kind LibrarySearchPath
2025-10-21 10:46:48.435221 DEBUG Adding new file root '/Users/micha/astral/test/1337' of kind Project
2025-10-21 10:46:48.435556 DEBUG Starting main loop
2025-10-21 10:46:48.435564 DEBUG Waiting for next main loop message.
2025-10-21 10:46:48.435606 DEBUG Checking all files in project 'ty1337'
2025-10-21 10:46:48.438795 INFO Indexed 1 file(s) in 0.003s
2025-10-21 10:46:48.439258 DEBUG Checking file '/Users/micha/astral/test/1337/main.py'
2025-10-21 10:46:48.449025 DEBUG Resolving dynamic module resolution paths
2025-10-21 10:46:48.462412 DEBUG Checking all files took 0.024s
All checks passed!
2025-10-21 10:46:48.462485 DEBUG Exiting main loop
</code></pre>
<p>What are the dependencies that you've installed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-21 08:57</div>
            <div class="timeline-body"><pre><code class="language-toml">[project]
name = &quot;care&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;fastapi[all]&gt;=0.116.1&quot;,
    &quot;scalar-fastapi&gt;=1.0.3&quot;,
    &quot;jinja2-fragments&gt;=1.9.0&quot;,
    &quot;httpx&gt;=0.28.0&quot;,
    &quot;httpx-auth&gt;=0.23.1&quot;,
    &quot;argon2-cffi&gt;=25.1.0&quot;,
    &quot;google-cloud-bigquery&gt;=3.33.0&quot;,
    &quot;google-cloud-bigquery-storage&gt;=2.31.0&quot;,
    &quot;google-cloud-pubsub&gt;=2.29.0&quot;,
    &quot;pandas&gt;=2.3.2&quot;,
    &quot;scikit-learn&gt;=1.6.1&quot;,
    &quot;pyyaml&gt;=6.0.2&quot;,
    &quot;firebase-admin&gt;=6.5.0&quot;,
    &quot;asyncpg&gt;=0.30.0&quot;,
    &quot;db-dtypes&gt;=1.2.0&quot;,
    &quot;aioboto3==15.2.0&quot;,
    &quot;protobuf&gt;=6.31.1&quot;,
    &quot;bcrypt&gt;=5.0.0&quot;,
    &quot;grpcio-tools&gt;=1.70.0&quot;,
    &quot;pyjwt&gt;=2.10.1&quot;,
    &quot;cryptography&gt;=46.0.2&quot;,
    &quot;twilio&gt;=9.8.4&quot;,
]

[dependency-groups]
dev = [
    &quot;ruff&gt;=0.13.1&quot;,
    &quot;ty==0.0.1a21&quot;,
    &quot;mypy&gt;=1.15.0&quot;,
    &quot;types-protobuf&gt;=6.30.2.20250516&quot;,
    &quot;pytest&gt;=8.3.4&quot;,
    &quot;pytest-watcher&gt;=0.4.3&quot;,
    &quot;pytest-mock&gt;=3.14.0&quot;,
    &quot;pytest-env&gt;=1.1.5&quot;,
    &quot;pytest-asyncio&gt;=0.24.0&quot;,
    &quot;types-aioboto3&gt;=15.2.0&quot;,
    &quot;types-aiobotocore-s3&gt;=2.24.3&quot;,
    &quot;types-pyyaml&gt;=6.0.12.20240808&quot;,
    &quot;asyncpg-stubs&gt;=0.30.0&quot;,
    &quot;protobuf-protoc-bin&gt;=31.1&quot;,
    &quot;pandas-stubs&gt;=2.3.2.250827&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-21 09:06</div>
            <div class="timeline-body"><p>Thanks, that's helpful. I can reproduce with</p>
<pre><code class="language-py">from collections.abc import  AsyncIterator

import aioboto3
from types_aiobotocore_s3.client import S3Client

async def create_storage_client(
    endpoint_url: str,
    access_key_id: str,
    secret_access_key: str,
    region_name: str,
) -&gt; AsyncIterator[S3Client]:
    session = aioboto3.Session()
    async with session.client(
        &quot;s3&quot;,
        endpoint_url=endpoint_url,
        aws_access_key_id=access_key_id,
        aws_secret_access_key=secret_access_key,
        region_name=region_name,
    ) as client:
        yield client

</code></pre>
<p>and</p>
<pre><code class="language-toml">[project]
name = &quot;ty1337&quot;
version = &quot;0.0.1&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;aioboto3==15.2.0&quot;,
    &quot;types-aioboto3&gt;=15.2.0&quot;,
    &quot;types-aiobotocore-s3&gt;=2.24.3&quot;,
]

[tool.ty]

</code></pre>
<p>Installing <code>types-aiobotocore[full]</code> does help with the many unresolved import warnings but it isn't the cause for ty being slow</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @MichaReiser on 2025-10-21 09:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-21 09:11</div>
            <div class="timeline-body"><p>Great! If there are other ways for me to help please let me know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-21 09:15</div>
            <div class="timeline-body"><p>An even simpler repro:</p>
<pre><code class="language-py">from collections.abc import  AsyncIterator

import aioboto3
from types_aiobotocore_s3.client import S3Client

def create_storage_client(
    endpoint_url: str,
    access_key_id: str,
    secret_access_key: str,
    region_name: str,
) -&gt; AsyncIterator[S3Client]:
    session = aioboto3.Session()
    client = session.client(
        &quot;s3&quot;,
        endpoint_url=endpoint_url,
        aws_access_key_id=access_key_id,
        aws_secret_access_key=secret_access_key,
        region_name=region_name,
    )
        
</code></pre>
<p>And the culprint is <code>session.py</code> which has a ton of <code>client</code> overloads: https://gist.github.com/MichaReiser/6f3149be6dcea72608a4bb81f11dbed6</p>
<p>They all have the same signature except for the first literal.</p>
<p>I think this is somewhat a known issue with the stubs</p>
<blockquote>
<pre><code class="language-bash"># Lite version does not provide session.client/resource overloads
# it is more RAM-friendly, but requires explicit type annotations
python -m pip install 'types-aiobotocore-lite[s3]'
</code></pre>
<p>https://pypi.org/project/types-aiobotocore-s3/#generate-locally-(recommended)</p>
</blockquote>
<p>CC: @dhruvmanila (I don't think this is urgent)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">overloads</span> added by @AlexWaygood on 2025-10-21 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-21 09:34</div>
            <div class="timeline-body"><p>Note: I'm not sure if it's overload-related, but it certainly looks very suspicious. But it might also be a combination of overloads and &quot;something else&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-10-22 08:17</div>
            <div class="timeline-body"><p>Wow, there are like ~400 overloads for the <code>client</code> function.</p>
<p>The example code that I've used for debugging is the one that Micha posted in the latest comment on this issue (https://github.com/astral-sh/ty/issues/1337#issuecomment-3425567191).</p>
<p>I added a tracing message similar to https://github.com/astral-sh/ruff/pull/20836 to see if there's any callable which takes a long time to type check (&gt;= 100ms) and there isn't any.</p>
<p>So, I went back to see the commits related to the overload work between 0.0.1-alpha.21 and 0.0.1-alpha.22 and there are two commits, both of which doesn't result in the hang but the commit that does is somewhere between them:</p>
<ol>
<li>https://github.com/astral-sh/ruff/commit/35ed55ec8c9e952609e2065467b01c58693f865a - the hang doesn't exists here</li>
<li>https://github.com/astral-sh/ruff/commit/4e94b22815c7979003d07a4931c9174285617c90 - the hang already exists before this commit, I tried running the code on the parent commit (https://github.com/astral-sh/ruff/commit/0639da255263219e8cf0289301661b748681db7c)</li>
</ol>
<p>So, I did a git bisect between (1) and parent commit of (2) and found out that https://github.com/astral-sh/ruff/pull/20517 is the first commit when the example code started regressing (sorry @sharkdp!). This doesn't necessarily mean that it's that specific feature that resulted in the performance regression, it could very well be that ty is doing more work due to that commit which could be unnecessary. I'll need to look deeper but this is what I've so far.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-22 12:23</div>
            <div class="timeline-body"><blockquote>
<p>So, I did a git bisect between (1) and parent commit of (2) and found out that <a href="https://github.com/astral-sh/ruff/pull/20517">astral-sh/ruff#20517</a> is the first commit when the example code started regressing (sorry <a href="https://github.com/sharkdp">@sharkdp</a>!). This doesn't necessarily mean that it's that specific feature that resulted in the performance regression, it could very well be that ty is doing more work due to that commit which could be unnecessary</p>
</blockquote>
<p>Yes, there certainly is more work to do now, because https://github.com/astral-sh/ruff/pull/20517 makes all of those overloads generic. I am fairly confident that 20517 itself is not the root cause here, and that something else needs to be optimized. We could potentially try to <a href="https://github.com/astral-sh/ruff/blob/2c9433796ac7e73667fd6bede25ee79238dc6805/crates/ty_python_semantic/src/types/signatures.rs#L1289-L1300">make these checks</a> more aggressive, such that they won't recognize the specific overloads in question here as being generic (if that is indeed the case). But that won't help in similar cases where the methods are actually generic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-10-26 08:22</div>
            <div class="timeline-body"><p><code>ty@0.0.1-alpha.24</code> Cut these times in half</p>
<p>With <code>alpha.23</code>:</p>
<pre><code>2025-10-26 10:20:02.491294 INFO Checking file `care/core/fastapi_s3.py` took more than 100ms (2.722958458s)
2025-10-26 10:20:02.49173 INFO Checking file `care/conftest.py` took more than 100ms (2.698604625s)
</code></pre>
<p>With <code>alpha.24</code>:</p>
<pre><code>2025-10-26 10:20:16.438164 INFO Checking file `care/core/fastapi_s3.py` took more than 100ms (1.195371708s)
2025-10-26 10:20:16.438582 INFO Checking file `care/conftest.py` took more than 100ms (1.301141083s)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "0.0.1-alpha.22 is hanging" to "hang checking calls to function with hundreds of overloads (started in 0.0.1-alpha.22)" by @carljm on 2025-10-29 20:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-11-02 09:31</div>
            <div class="timeline-body"><p><code>alpha.25</code> has similar performance to <code>alpha.24</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @carljm on 2025-11-03 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/galah92">@galah92</a> on 2025-11-04 04:44</div>
            <div class="timeline-body"><p>I'm also bumped into a similar performance gap with the following:
Create a new project, add <code>transformers</code>, and change main to just</p>
<pre><code class="language-python">from transformers import AutoTokenizer
</code></pre>
<p>That's it.</p>
<blockquote>
<p>2025-11-04 06:43:09.953352 INFO Checking file <code>/Users/galah92/Downloads/bla/repro.py</code> took more than 100ms (1.354159292s)</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-14 08:22</div>
            <div class="timeline-body"><p>@carljm FYI, I moved this into stable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @MichaReiser on 2025-11-14 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-08 23:54</div>
            <div class="timeline-body"><blockquote>
<p>I'm also bumped into a similar performance gap with the following: Create a new project, add <code>transformers</code>, and change main to just</p>
<p>from transformers import AutoTokenizer</p>
</blockquote>
<p>I'm not able to repro this; that checks instantly for me. Maybe something has changed in ty or in transformers?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-08 23:55</div>
            <div class="timeline-body"><p>I'm going to close this as duplicate of #2400, since that appears to be the same issue and has a simple repro with a lot less discussion to wade through. But once that is fixed we should double-check the original repro here as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2026-01-08 23:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:47 UTC
    </footer>
</body>
</html>
