<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No completion possible since version ty 0.0.1-alpha.20 - astral-sh/ty #1127</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>No completion possible since version ty 0.0.1-alpha.20</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1127">#1127</a>
        opened by <a href="https://github.com/JaRoSchm">@JaRoSchm</a>
        on 2025-09-04 08:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JaRoSchm">@JaRoSchm</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi, I updated ty to 0.0.1-alpha.20 this morning and since then completion in neovim doesn't work for me anymore. When starting neovim with <code>RUST_BACKTRACE=1</code> and start to type <code>ran&lt;TAB&gt;</code> I get the following logs:</p>
<pre><code class="language-log">[START][2025-09-04 10:21:17] LSP logging initiated
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:17.961338095  INFO Version: 0.0.1-alpha.20\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ruff&quot;  &quot;stderr&quot;        &quot;2025-09-04 10:21:17.972934090  INFO No workspace options found for file:///home/jschmidt/Devel/Repositories, using default options\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:17.978580733  INFO Defaulting to python-platform `linux`\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:17.979515547  INFO Python version: Python 3.13, platform: linux\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:17.980217744  WARN Your LSP client doesn't support file watching: You may see stale results when files change outside the editor\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:17.980263299  WARN Received notification workspace/didChangeConfiguration which does not have a handler.\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ruff&quot;  &quot;stderr&quot;        &quot;2025-09-04 10:21:18.000419202  INFO Registering workspace: /home/jschmidt/Devel/Repositories\n&quot;
[ERROR][2025-09-04 10:21:17] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ruff&quot;  &quot;stderr&quot;        &quot;2025-09-04 10:21:18.000532675  WARN LSP client does not support dynamic capability registration - automatic configuration reloading will not be available.\n&quot;
[ERROR][2025-09-04 10:21:18] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:18.049832392  INFO Indexed 8851 file(s) in 0.025s\n&quot;
[ERROR][2025-09-04 10:21:25] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:25.007540482  INFO Error looking up `types.ModuleType` in typeshed: expected to find a class definition on Python 3.13, but found a symbol of type `Never` instead. Falling back to `Unknown` for the symbol instead.\n&quot;
[ERROR][2025-09-04 10:21:25] ...p/_transport.lua:36     &quot;rpc&quot;   &quot;ty&quot;    &quot;stderr&quot;        &quot;2025-09-04 10:21:25.295952661 ERROR An error occurred with request ID 12: request handler panicked at /home/conda/feedstock_root/build_artifacts/bld/rattler-build_ty_1756912065/build_env/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/maybe_changed_after.rs:268:21:\ndependency graph cycle when validating ClassLiteral &lt; 'db &gt;::decorators_(Id(9817)), set cycle_fn/cycle_initial to fixpoint iterate.\nQuery stack:\n[\n    Type &lt; 'db &gt;::member_lookup_with_policy_(Id(6012)),\n    Type &lt; 'db &gt;::class_member_with_policy_(Id(e002)),\n]query stacktrace:\n   0: DatabaseKeyIndex(IngredientIndex(99), Id(e002))\n   1: DatabaseKeyIndex(IngredientIndex(103), Id(6012))\n\n\nBacktrace:    0: &lt;unknown&gt;\n   1: &lt;unknown&gt;\n   2: &lt;unknown&gt;\n   3: &lt;unknown&gt;\n   4: &lt;unknown&gt;\n   5: &lt;unknown&gt;\n   6: &lt;unknown&gt;\n   7: &lt;unknown&gt;\n   8: &lt;unknown&gt;\n   9: &lt;unknown&gt;\n  10: &lt;unknown&gt;\n  11: &lt;unknown&gt;\n  12: &lt;unknown&gt;\n  13: &lt;unknown&gt;\n  14: &lt;unknown&gt;\n  15: &lt;unknown&gt;\n  16: &lt;unknown&gt;\n  17: &lt;unknown&gt;\n  18: &lt;unknown&gt;\n  19: &lt;unknown&gt;\n  20: &lt;unknown&gt;\n  21: &lt;unknown&gt;\n  22: &lt;unknown&gt;\n  23: &lt;unknown&gt;\n  24: &lt;unknown&gt;\n  25: &lt;unknown&gt;\n  26: &lt;unknown&gt;\n  27: &lt;unknown&gt;\n  28: &lt;unknown&gt;\n  29: &lt;unknown&gt;\n  30: &lt;unknown&gt;\n  31: &lt;unknown&gt;\n  32: &lt;unknown&gt;\n  33: &lt;unknown&gt;\n  34: &lt;unknown&gt;\n  35: &lt;unknown&gt;\n  36: &lt;unknown&gt;\n  37: &lt;unknown&gt;\n  38: &lt;unknown&gt;\n  39: &lt;unknown&gt;\n  40: &lt;unknown&gt;\n  41: &lt;unknown&gt;\n  42: &lt;unknown&gt;\n  43: &lt;unknown&gt;\n  44: &lt;unknown&gt;\n  45: &lt;unknown&gt;\n  46: &lt;unknown&gt;\n  47: &lt;unknown&gt;\n  48: &lt;unknown&gt;\n  49: &lt;unknown&gt;\n  50: &lt;unknown&gt;\n  51: &lt;unknown&gt;\n  52: &lt;unknown&gt;\n  53: &lt;unknown&gt;\n  54: &lt;unknown&gt;\n  55: &lt;unknown&gt;\n  56: &lt;unknown&gt;\n  57: &lt;unknown&gt;\n  58: &lt;unknown&gt;\n  59: &lt;unknown&gt;\n  60: &lt;unknown&gt;\n  61: &lt;unknown&gt;\n  62: &lt;unknown&gt;\n  63: &lt;unknown&gt;\n  64: &lt;unknown&gt;\n  65: &lt;unknown&gt;\n  66: &lt;unknown&gt;\n  67: &lt;unknown&gt;\n  68: &lt;unknown&gt;\n  69: &lt;unknown&gt;\n  70: start_thread\n             at ./nptl/pthread_create.c:448:8\n  71: __GI___clone3\n             at ./misc/../sysdeps/unix/sysv/linux/x86_64/clone3.S:78:0\n\n\n&quot;
</code></pre>
<p>I am on Linux and ty is installed from conda-forge if this is relevant.</p>
<p>Thanks,
Jan</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.20</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JaRoSchm">@JaRoSchm</a> on 2025-09-04 08:35</div>
            <div class="timeline-body"><p>This seems to be related to the workspace I am in. If I do the same in <code>$HOME/temp</code>, everything works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by @AlexWaygood on 2025-09-04 08:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-09-04 08:48</div>
            <div class="timeline-body"><p>Unrelated to this issue, you can direct the logs to a specific file to only get the messages (currently, they're being captured by Neovim which doesn't pretty print them):</p>
<pre><code class="language-lua">vim.lsp.config[&quot;ty&quot;] = {
  init_options = {
    logFile = '/path/to/ty.log'
  }
}
</code></pre>
<p>Pretty printing the logs:</p>
<pre><code>2025-09-04 10:21:25.007540482  INFO Error looking up `types.ModuleType` in typeshed: expected to find a class definition on Python 3.13, but found a symbol of type `Never` instead. Falling back to `Unknown` for the symbol instead.
2025-09-04 10:21:25.295952661 ERROR An error occurred with request ID 12: request handler panicked at /home/conda/feedstock_root/build_artifacts/bld/rattler-build_ty_1756912065/build_env/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/a3ffa22/src/function/maybe_changed_after.rs:268:21:
dependency graph cycle when validating ClassLiteral &lt; 'db &gt;::decorators_(Id(9817)), set cycle_fn/cycle_initial to fixpoint iterate.
Query stack:
[
    Type &lt; 'db &gt;::member_lookup_with_policy_(Id(6012)),
    Type &lt; 'db &gt;::class_member_with_policy_(Id(e002)),
]
query stacktrace:
   0: DatabaseKeyIndex(IngredientIndex(99), Id(e002))
   1: DatabaseKeyIndex(IngredientIndex(103), Id(6012))


Backtrace:    0: &lt;unknown&gt;
   1: &lt;unknown&gt;
   2: &lt;unknown&gt;
   3: &lt;unknown&gt;
   4: &lt;unknown&gt;
   5: &lt;unknown&gt;
   6: &lt;unknown&gt;
   7: &lt;unknown&gt;
   8: &lt;unknown&gt;
   9: &lt;unknown&gt;
  10: &lt;unknown&gt;
  11: &lt;unknown&gt;
  12: &lt;unknown&gt;
  13: &lt;unknown&gt;
  14: &lt;unknown&gt;
  15: &lt;unknown&gt;
  16: &lt;unknown&gt;
  17: &lt;unknown&gt;
  18: &lt;unknown&gt;
  19: &lt;unknown&gt;
  20: &lt;unknown&gt;
  21: &lt;unknown&gt;
  22: &lt;unknown&gt;
  23: &lt;unknown&gt;
  24: &lt;unknown&gt;
  25: &lt;unknown&gt;
  26: &lt;unknown&gt;
  27: &lt;unknown&gt;
  28: &lt;unknown&gt;
  29: &lt;unknown&gt;
  30: &lt;unknown&gt;
  31: &lt;unknown&gt;
  32: &lt;unknown&gt;
  33: &lt;unknown&gt;
  34: &lt;unknown&gt;
  35: &lt;unknown&gt;
  36: &lt;unknown&gt;
  37: &lt;unknown&gt;
  38: &lt;unknown&gt;
  39: &lt;unknown&gt;
  40: &lt;unknown&gt;
  41: &lt;unknown&gt;
  42: &lt;unknown&gt;
  43: &lt;unknown&gt;
  44: &lt;unknown&gt;
  45: &lt;unknown&gt;
  46: &lt;unknown&gt;
  47: &lt;unknown&gt;
  48: &lt;unknown&gt;
  49: &lt;unknown&gt;
  50: &lt;unknown&gt;
  51: &lt;unknown&gt;
  52: &lt;unknown&gt;
  53: &lt;unknown&gt;
  54: &lt;unknown&gt;
  55: &lt;unknown&gt;
  56: &lt;unknown&gt;
  57: &lt;unknown&gt;
  58: &lt;unknown&gt;
  59: &lt;unknown&gt;
  60: &lt;unknown&gt;
  61: &lt;unknown&gt;
  62: &lt;unknown&gt;
  63: &lt;unknown&gt;
  64: &lt;unknown&gt;
  65: &lt;unknown&gt;
  66: &lt;unknown&gt;
  67: &lt;unknown&gt;
  68: &lt;unknown&gt;
  69: &lt;unknown&gt;
  70: start_thread
             at ./nptl/pthread_create.c:448:8
  71: __GI___clone3
             at ./misc/../sysdeps/unix/sysv/linux/x86_64/clone3.S:78:0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-09-04 08:49</div>
            <div class="timeline-body"><p>Would you be able to share the code snippet on which this is being triggered?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JaRoSchm">@JaRoSchm</a> on 2025-09-04 08:56</div>
            <div class="timeline-body"><p>Thanks for the help!</p>
<p>The file contains only <code>ran</code> and then I tap <code>&lt;TAB&gt;</code> to trigger the completion. Sadly I am not able to share the whole workspace.</p>
<p>I will try to find a minimal environment which is able to reproduce this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JaRoSchm">@JaRoSchm</a> on 2025-09-04 10:47</div>
            <div class="timeline-body"><p>Actually, I am not able to reliably reproduce this. I tried a new environment with a comparable setup, but I was not able to observe this there. Even in my usual setup, this problem doesn't always appear, even if I follow the exact same steps. If I type around and open/close the editor often enough, however, this will happen at some point. So somehow this feels like there is a race condition somewhere. I am grateful for further tips for debugging this.</p>
<p>Here is a video (with 3 minutes already cut off at the beginning), where I just type around a bit and try to trigger this error. It happens the second time I open <code>test.py</code> (see the red errors in the statusline).</p>
<p>https://github.com/user-attachments/assets/5880476f-ceb2-4802-807d-6a1b1e026f26</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JaRoSchm">@JaRoSchm</a> on 2025-09-05 15:36</div>
            <div class="timeline-body"><p>After using ty for two days, I don't really observe this problem under real-work circumstances. I am not sure what went wrong there yesterday.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @JaRoSchm on 2025-09-05 15:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:35 UTC
    </footer>
</body>
</html>
