<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change range for `unresolved-attribute` error to attribute - astral-sh/ty #169</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Change range for `unresolved-attribute` error to attribute</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/169">#169</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-03-18 10:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-18 10:13</div>
            <div class="timeline-body"><p>The <code>unresolved-attribute</code> diagnostic currently highlights the entire attribute expression. I find this very noisy and the error, most of the time is with the attribute and not with the object. We could also use a secondary range to highlight the object's definition.</p>
<p>We should revisit the range of our unresolved-attribute diagnostics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @MichaReiser on 2025-03-18 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @MichaReiser on 2025-03-18 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> removed by @MichaReiser on 2025-03-18 12:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-03-18 12:48</div>
            <div class="timeline-body"><p>I personally prefer it how it is because:</p>
<ul>
<li><p>It is the attribute expression as a whole that leads to a (possible) exception being raised at runtime, and that involves the left-hand side of the <code>.</code> operator just as much as the right-hand side</p>
</li>
<li><p>The current behaviour makes it consistent with how we treat other operators such as <code>+</code> and <code>-</code>, where we highlight the whole expression (both the left-hand and right-hand sides of the operator)</p>
</li>
<li><p>The current behaviour is consistent with how CPython itself highlights the range in its exception tracebacks:</p>
<pre><code class="language-pytb">&gt;&gt;&gt; x.foo.bar
Traceback (most recent call last):
  File &quot;&lt;python-input-7&gt;&quot;, line 1, in &lt;module&gt;
    x.foo.bar
    ^^^^^
AttributeError: 'object' object has no attribute 'foo'
</code></pre>
</li>
</ul>
<p>That said, I generally prefer not to use a language server at all in my editor when I'm writing Python (I generally use a lightweight text editor and run my type checker via the command line), and the highlighted range is perhaps most important for users of IDEs. So I'm happy to weigh other people's opinions more strongly here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-21 09:55</div>
            <div class="timeline-body"><p>Here an example where I think the current highlighting is very problematic:</p>
<p><img width="788" alt="Image" src="https://github.com/user-attachments/assets/b22a255f-8484-4eb6-bcbd-5a4edabee579" /></p>
<p>(<a href="https://playknot.ruff.rs/1b231df0-81d7-4de5-9781-2d2712fb7df8">Playground</a>)</p>
<p>Only the last attribute access is invalid but red knot highlights the entire attribute access. We should at least change it so that it only highlights <code>flags.is_</code> and not the entire <code>out.flags.is_</code> expression</p>
<p>It becomes unnecessarily noisy when the object expression becomes more complicated:</p>
<pre><code class="language-python">returns_output().flags.set(key, Flags.EXPLICIT_NEST, recursive=False)
^^^^^^^^^^^^^^^^^^^^^^^^^^

def returns_output() -&gt; Output:
    pass

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-03-23 08:57</div>
            <div class="timeline-body"><p>One edge case would be a class with an invalid <code>__getattr__</code> method (e.g. invalid signature). In this case, it might be better to highlight the accessed instance, rather than the attribute.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @MichaReiser on 2025-05-07 15:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Change range for `unresolved-attribute` error to attribute" to "Change range for `unresolved-attribute` error to attribute" by @MichaReiser on 2025-05-07 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">attribute access</span> added by @AlexWaygood on 2025-05-11 08:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-11-13 16:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:10:54 UTC
    </footer>
</body>
</html>
