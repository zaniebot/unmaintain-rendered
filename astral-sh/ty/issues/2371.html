<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`Unknown` is not a valid pivot for transitive constraints in a constraint set - astral-sh/ty #2371</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>Unknown</code> is not a valid pivot for transitive constraints in a constraint set</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2371">#2371</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2026-01-06 21:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dcreager">@dcreager</a> on 2026-01-06 21:11</div>
            <div class="timeline-body"><p>As part of building up constraint sets, we produce a &quot;sequent map&quot; (aka a Horn clause database) describing how all of the individual constraints in the constraint set, and any derived constraints, relate to each other. Part of this is building up transitive relationships. For instance, if we know that <code>S ≤ int</code> and <code>int ≤ T</code>, we can infer that <code>S ≤ T</code>.</p>
<p>In https://github.com/astral-sh/ruff/pull/22411, we started seeing some false positive diagnostics, whose root cause seems to be sequents of the form <code>S ≤ Any ∧ Any ≤ T → S ≤ T</code>. That is, exactly the same as above, but with <code>Any</code> as the &quot;pivot&quot; instead of <code>int</code>. But that's not valid, since there's no guarantee that the two <code>Any</code>s will materialize to the same type. In other words, we should be performing a <em>subtyping</em> check during sequent map constructing, not an <em>assignability</em> check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dcreager by @dcreager on 2026-01-06 21:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by @AlexWaygood on 2026-01-06 21:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-06 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dcreager on 2026-01-08 14:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:42:04 UTC
    </footer>
</body>
</html>
