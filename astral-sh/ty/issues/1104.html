<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider vendoring third-party typeshed stubs, too - astral-sh/ty #1104</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider vendoring third-party typeshed stubs, too</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1104">#1104</a>
        opened by <a href="https://github.com/aidandj">@aidandj</a>
        on 2025-08-28 16:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/aidandj">@aidandj</a> on 2025-08-28 16:22</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Given this small code block:</p>
<pre><code>import grpc

try:
    something = 1
except grpc.RpcError as e:
    e.code()
</code></pre>
<p>I'm getting this error: <code>warning[unresolved-attribute]: Type </code>RpcError<code>has no attribute</code>code``</p>
<p>This type exists <a href="https://github.com/python/typeshed/blob/c0fed911d64e483e89dc2190aad057f93fc431d3/stubs/grpcio/grpc/__init__.pyi#L325">in typeshed</a> and pyright seems to pick it up and does not complain. But <code>ty</code> does.</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.19 (e9cb838b3 2025-08-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-28 16:41</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<blockquote>
<p>This type exists <a href="https://github.com/python/typeshed/blob/c0fed911d64e483e89dc2190aad057f93fc431d3/stubs/grpcio/grpc/__init__.pyi#L325">in typeshed</a> and pyright seems to pick it up and does not complain. But <code>ty</code> does.</p>
</blockquote>
<p>The difference here is that pyright vendors all of typeshed's third-party stubs. Ty instead currently follows mypy's model of only vendoring typeshed's stdlib stubs. That means that we're using the runtime source code for the <code>grpcio</code> library rather than typeshed's stubs for <code>grpcio</code>. The good news, however, is that typeshed publishes its <code>grpcio</code> stubs to PyPI -- installing <code>types-grpcio</code> into your Python environment before running ty should get rid of the <code>AttributeError</code>. If you're invoking ty using uv and you have it listed as a dev-dependency, it might be as simple as listing <code>types-grpcio</code> as a dev-dependency too -- or you could run <code>uv run --with=types-grpcio ty check</code> rather than <code>uv run ty check</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-28 16:59</div>
            <div class="timeline-body"><p>Ideally I feel like we'd emit a better diagnostic here, but I'm not totally sure how. It would be fairly easy to have an up-to-date list of third-party modules for which typeshed stubs exist, and suggest to the user that they install them whenever we emit an <code>unresolved-import</code> diagnostic for one of them. (We would update the list every time we sync our vendored copy of typeshed's stubs.) But this situation doesn't result in an <code>unresolved-import</code> diagnostic (<code>grpcio</code> is not a C extension), it results in an <code>unresolved-attribute</code> diagnostic. Installing typeshed's stubs for a dependency <em>might</em> help with an <code>unresolved-attribute</code> diagnostic, but in some cases it also might hurt -- you can't say for sure like you can with an <code>unresolved-import</code> diagnostic.</p>
<p>We also haven't ruled out vendoring all of typeshed's third-party stubs, like pyright does. It would obviously have the benefit that it's what users of pyright will probably expect. It has the disadvantage that it would increase our binary size and possibly make it harder to reproduce type-checking results across machines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @AlexWaygood on 2025-08-28 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-28 17:01</div>
            <div class="timeline-body"><blockquote>
<p>and possibly make it harder to reproduce type-checking results across machines.</p>
</blockquote>
<p>Why would it have that effect?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @carljm on 2025-08-28 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidandj">@aidandj</a> on 2025-08-28 17:04</div>
            <div class="timeline-body"><p>Thanks for the clarification. I actually tried running it using the <code>--typeshed</code> argument, and got the same error. I now read the documentation closer and see that it does clarify that the typeshed argument only applies to stdlib.</p>
<p>Although I probably agree that installing individual 3rd party stubs is the &quot;correct&quot; approach, I foresee a very large number of duplicate issues as people make a switch from pyright to ty. I like the idea of keeping a list of 3rd party stubs as things get vendored. That would let you report an error similar to one that typescript sometimes throws, &quot;have you tried installing <code>types-&lt;package-x&gt;</code>&quot;</p>
<p>If typeshed is already being vendored, then it isn't really an added complication to maintain that list, once code is written once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-28 17:06</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>and possibly make it harder to reproduce type-checking results across machiness</p>
</blockquote>
<p>Why would it have that effect?</p>
</blockquote>
<p>Different versions of ty might have different versions of the grpcio stubs vendored with them, but it might not be immediately obvious to users that two different developers are implicitly using two different versions of the grpcio stubs because one of them hasn't upgraded to the latest version of ty.</p>
<p>Forcing users to explicitly list a stubs package as a dev-dependency means that the user knows exactly what version of the stubs they're using, it means that the stubs package is explicitly listed with its version if a user does something like <code>uv pip list</code>, and it means that a team of people all people working on the project can easily ensure they'll all be using exactly the same version of those stubs (it'll be pinned in their <code>uv.lock</code> file if they're using uv!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-28 17:10</div>
            <div class="timeline-body"><p>Ah, ok, I wondered if you were thinking of differing ty versions. I'm not sure how much to weight that as a concern -- it's inherently the case (just because of behavior changes in ty itself!) that if you have different developers using different ty versions, they're likely to get differing results.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-28 17:12</div>
            <div class="timeline-body"><p>Yeah -- FWIW, the last time we had this discussion as a team I argued that LSP users would probably be expecting to have all of typeshed's third-party stubs vendored, like pyright, and that the benefits of doing so probably outweighed the costs given that we wanted ty to work great as an LSP as well as a CLI tool. I think @MichaReiser was the strongest voice arguing against doing that for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidandj">@aidandj</a> on 2025-08-28 17:13</div>
            <div class="timeline-body"><p>FWIW, users should also be locking the <code>ty</code> version if they want to maintain consistency between runs. This can be an issue when just using an LSP, unless the LSP can use the locally installed version. So if one were to lock the <code>ty</code> version that would provide the same version locking as locking individual stub packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-28 17:16</div>
            <div class="timeline-body"><p>And vendoring the third-party stubs doesn't prevent a user from installing a different version of those stubs if they want to. The installed third-party stubs would take precedence over any vendored third-party stubs, as per the <a href="https://typing.python.org/en/latest/spec/distributing.html#import-resolution-ordering">spec</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Typeshed type not used for grpc.RpcError" to "Consider vendoring third-party typeshed stubs, too" by @carljm on 2025-08-28 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> removed by @AlexWaygood on 2025-08-28 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-15 08:45</div>
            <div class="timeline-body"><blockquote>
<p>I think @MichaReiser was the strongest voice arguing against doing that for now.</p>
</blockquote>
<p>The concern I raised was that I'm not sure if bundling all stubs with ty is the right solution if we're mainly concerned about LSP only users where we could bundle the stubs as part of the VS Code extension instead (or download them on demand or something else)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidandj">@aidandj</a> on 2025-09-15 13:17</div>
            <div class="timeline-body"><p>I think having differing output when running ty check, and LSP output is confusing behavior. Someone is going to see no errors in Vscode, push code, and have CI fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-15 13:40</div>
            <div class="timeline-body"><p>Another option that we discussed is to show a code suggestion to install the missing typing stubs (where an option could also be to just download all and don't install them into a venv for users that don't use a venv).</p>
<p>I'd prefer this because I would prefer to pin my stubs over accidentially use a stub that comes from ty (unless there's some opt-out option but that seems the wrong way round to me)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-02 13:45</div>
            <div class="timeline-body"><p>We could make it easy to add associated type stub packages when adding a dependency in uv ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidandj">@aidandj</a> on 2025-10-02 14:00</div>
            <div class="timeline-body"><p>If you are maintaining a list of available types, isn't that most of the way to vendoring them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-02 14:32</div>
            <div class="timeline-body"><blockquote>
<p>If you are maintaining a list of available types, isn't that most of the way to vendoring them?</p>
</blockquote>
<p>It's different in that they are versioned with your project rather than that you get whatever version ty ships (which might not match your package version)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidandj">@aidandj</a> on 2025-10-02 15:40</div>
            <div class="timeline-body"><p>But you can always override with an installed stub</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-02 15:48</div>
            <div class="timeline-body"><p>Sure, but it's the implicit nature I'm worried about. There should at least be a config option to disable this behavior (which we might even want to disable by default).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidandj">@aidandj</a> on 2025-10-02 16:12</div>
            <div class="timeline-body"><blockquote>
<p>There should at least be a config option to disable this behavior (which we might even want to disable by default).</p>
</blockquote>
<p>This would get my vote. As long as I could configure it in pyproject.toml. would make a big difference for moving pyright projects to ty</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-11-14 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-14 17:44</div>
            <div class="timeline-body"><p>Marking this for stable release as I think we need a decision here one way or the other by stable (as part of considering the full picture of https://github.com/astral-sh/ty/issues/1537); still marked <code>needs-decision</code>, marking this issue for stable release doesn't mean we are definitely going to do it</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:27 UTC
    </footer>
</body>
</html>
