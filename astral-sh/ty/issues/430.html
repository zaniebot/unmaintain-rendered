<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pyvenv.cfg generated by `pants export` makes ty to fail - astral-sh/ty #430</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pyvenv.cfg generated by `pants export` makes ty to fail</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/430">#430</a>
        opened by <a href="https://github.com/achimnol">@achimnol</a>
        on 2025-05-16 19:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/achimnol">@achimnol</a> on 2025-05-16 19:35</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using <a href="https://www.pantsbuild.org/">Pantsbuild</a>, I use <code>pants export</code> to auto-create virtualenvs for a dependency set.
The virtualenv created by it contains <code>pyvenv.cfg</code> like:</p>
<pre><code class="language-dosini">home = /home/joongi/.pyenv/versions/3.13.3/bin
include-system-site-packages = false
version = 3.13.3
prompt = 'python-default/3.13.3'
executable = /home/joongi/.pyenv/versions/3.13.3/bin/python3.13
command = /home/joongi/.pyenv/versions/3.13.3/bin/python3.13 -m venv --without-pip --prompt=&quot;python-default/3.13.3&quot; /home/joongi/bai-edge/dist/export/python/virtualenvs/python-default/3.13.3
</code></pre>
<p>After activating this virtualenv, <code>uvx ty check</code> currently fails with:</p>
<pre><code>ty failed
  Cause: Invalid search path settings
  Cause: Failed to discover the site-packages directory: Failed to parse the pyvenv.cfg file at /home/joongi/bai-edge/dist/export/python/virtualenvs/python-default/3.13.3/pyvenv.cfg because line 6 has too many '=' characters
</code></pre>
<p>If I apply the following patch to <code>pyvenv.cfg</code>, replacing <code>=</code> with a space in the <code>command</code>'s arguments:</p>
<pre><code class="language-diff">@@ -3,4 +3,4 @@
 version = 3.13.3
 prompt = 'python-default/3.13.3'
 executable = /home/joongi/.pyenv/versions/3.13.3/bin/python3.13
-command = /home/joongi/.pyenv/versions/3.13.3/bin/python3.13 -m venv --without-pip --prompt=&quot;python-default/3.13.3&quot; /home/joongi/bai-edge/dist/export/python/virtualenvs/python-default/3.13.3
+command = /home/joongi/.pyenv/versions/3.13.3/bin/python3.13 -m venv --without-pip --prompt &quot;python-default/3.13.3&quot; /home/joongi/bai-edge/dist/export/python/virtualenvs/python-default/3.13.3
</code></pre>
<p><code>uvx ty check</code> runs fine.</p>
<p>Since Python works without any issue with this virtualenv, <code>ty</code>'s <code>pyvenv.cfg</code> parsing should allow this case as well.</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by @AlexWaygood on 2025-05-16 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-05-16 20:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-16 20:16</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-16 20:45</div>
            <div class="timeline-body"><p>Thanks for the report! I guess we might just want to get rid of this check altogether? https://github.com/astral-sh/ruff/blob/3d55a16c916d1b89d9d4226d57dcaa11338b04a1/crates/ty_python_semantic/src/site_packages.rs#L135-L142</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-05-16 20:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-17 06:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:03 UTC
    </footer>
</body>
</html>
