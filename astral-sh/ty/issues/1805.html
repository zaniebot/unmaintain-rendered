<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No error reported from the server when changing ty configuration from a valid setting to an invalid setting - astral-sh/ty #1805</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>No error reported from the server when changing ty configuration from a valid setting to an invalid setting</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1805">#1805</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-08 12:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-08 12:45</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>If you change ty's configuration from a valid setting to an invalid setting while the server is running, no diagnostic or error message is reported by the server to tell you that your configuration settings are now invalid. In the following video I've opened the <code>./python/py-fuzzer</code> directory in VSCode as its own workspace, and I'm trying to change the <code>environment.python</code> setting so that ty will pick up the installed dependencies in my virtual environment. I accidentally configure it to <code>python = &quot;./venv&quot;</code> instead of <code>python = &quot;./.venv&quot;</code>, but ty doesn't report a diagnostic informing me that this configuration is invalid; it just silently continues to not resolve any of my dependencies. A fresh run of ty from the command line with this broken configuration, meanwhile, immediately reports the error:</p>
<p>https://github.com/user-attachments/assets/2960fda2-32d1-4795-9c4b-5ca672b018c4</p>
<p>If I quit and reopen VSCode, then this message appears:</p>
<p><img width="1220" height="404" alt="Image" src="https://github.com/user-attachments/assets/62dfc591-1939-44a8-a0fb-5529ebcba838" /></p>
<p>But there's nothing to indicate that I need to do that if I edit the configuration while the server is running</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @AlexWaygood on 2025-12-08 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-12-08 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-08 12:51</div>
            <div class="timeline-body"><p>(I'm not totally sure why I needed to set <code>python = &quot;./.venv&quot;</code> in the first place -- shouldn't that be automatically picked up? Maybe VSCode has selected a different Python environment for this project, overriding our default virtual environment discovery -- but I'm not sure which one it's selected, or how to change that?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-08 13:01</div>
            <div class="timeline-body"><p>Related to https://github.com/astral-sh/ty/issues/542. This only applies to <code>ProgramSetting</code>, see</p>
<p>https://github.com/astral-sh/ruff/blob/a364195335eb920ff429c43832c4ee464051ea9a/crates/ty_project/src/db/changes.rs#L284-L292</p>
<p>where we handle the error case by converting it into an option diagnostic</p>
<p>but we don't do the same for <code>ProgramSettings</code> because the returned error is an <code>anyhow::Erorr</code></p>
<p>https://github.com/astral-sh/ruff/blob/a364195335eb920ff429c43832c4ee464051ea9a/crates/ty_project/src/db/changes.rs#L264-L272</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @MichaReiser on 2025-12-08 13:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-08 13:23</div>
            <div class="timeline-body"><p>Hmm, I tried a naive fix of including the error in <code>ChangeResult</code>, but the fact that we render &quot;pretty errors&quot; for some of the site package errors now works against us, because it results in an unreadable error message in VS Code</p>
<p><img width="1657" height="619" alt="Image" src="https://github.com/user-attachments/assets/05f6564a-21ac-46ec-8669-0be47fc57a19" /></p>
<p>I guess the solution here is really to change <code>to_program_settings</code> to return a type that can be converted to a <code>Diagnostic</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:51 UTC
    </footer>
</body>
</html>
