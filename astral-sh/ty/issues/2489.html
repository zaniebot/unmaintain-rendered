<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty should infer the type of the `cls` parameter of `__new__` - astral-sh/ty #2489</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty should infer the type of the <code>cls</code> parameter of <code>__new__</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2489">#2489</a>
        opened by <a href="https://github.com/arjenzorgdoc">@arjenzorgdoc</a>
        on 2026-01-14 10:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/arjenzorgdoc">@arjenzorgdoc</a></div>
            <div class="timeline-body"><p>The <code>cls</code> parameter of <code>__new__</code> should be inferred as <code>type[Self]</code>. ty says it's <code>Unknown</code></p>
<pre><code class="language-python">from typing import reveal_type

class C:
    def __new__(cls):
        reveal_type(cls)
        return super().__new__(cls)
</code></pre>
<ul>
<li><a href="https://pyright-play.net/?pythonVersion=3.14&amp;strict=true&amp;code=GYJw9gtgBALgngBwJYDsDmUkQWEMogCmAboQIYA2A%2BvAoQFCMDGFZAzm1AMIBc9UAqABNCwKFSopCAdwkAKFmwCUfQWoIly1WoQUVl-dQKIwAriBRQ2puiDlKAdBKmyqeg0A">pyright</a>: <code>Type of &quot;cls&quot; is &quot;type[Self@C]&quot;</code></li>
<li><a href="https://play.ty.dev/e5971a97-8ed2-45f4-8a08-98b6105a3754">ty</a>: <code>Revealed type: Unknown (revealed-type) [Ln 6, Col 21]</code></li>
<li><a href="https://mypy-play.net/?mypy=latest&amp;python=3.14&amp;gist=9fc1160fed504745c96441caa2465334&amp;flags=check-untyped-defs">mypy</a>: <code>main.py:5: note: Revealed type is &quot;type[__main__.C]&quot;</code></li>
</ul>
<details>
<summary>My actual use case is code like this:</summary>

<pre><code class="language-python">from typing import Self


class C:
    def __new__(cls: type[Self], x: object) -&gt; Self:
        if type(x) is cls:
            return x
        return super().__new__(cls)
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2026-01-14 10:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Pre-stable 1" by @AlexWaygood on 2026-01-14 10:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-14 10:37</div>
            <div class="timeline-body"><p>Thanks! Hmm, I thought we'd fixed this a while back :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-14 21:05</div>
            <div class="timeline-body"><p>It looks like this currently works for <code>@classmethod</code>, but not for <code>__new__</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-14 21:09</div>
            <div class="timeline-body"><p>Ah right, <code>__new__</code> is actuallly a staticmethod rather than a classmethod (but, like a classmethod, it always receives an object of <code>type[Self]</code> as its first argument)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2026-01-15 20:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-15 21:01:36 UTC
    </footer>
</body>
</html>
