<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error: `Index X is out of bound for tuple` after a if-guard that guarantees in-bounds - astral-sh/ty #1186</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error: <code>Index X is out of bound for tuple</code> after a if-guard that guarantees in-bounds</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1186">#1186</a>
        opened by <a href="https://github.com/jeertmans">@jeertmans</a>
        on 2025-09-15 08:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jeertmans">@jeertmans</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi!</p>
<p>Apparently, ty is unable to infer the length of tuple inside an <code>if</code>-guarded check that exactly checks the length:</p>
<pre><code class="language-python">def f(tup: tuple[int, int] | tuple[int, int, int]) -&gt; int:
    if len(tup) == 3:
        return tup[0] + tup[1] + tup[2]
    return tup[0] + tup[1]
</code></pre>
<p>Using <code>ty check</code> on this file raises:</p>
<pre><code>error[index-out-of-bounds]: Index 2 is out of bounds for tuple `tuple[int, int]` with length 2
 --&gt; issue.py:3:34
  |
1 | def f(tup: tuple[int, int] | tuple[int, int, int]) -&gt; int:
2 |     if len(tup) == 3:
3 |         return tup[0] + tup[1] + tup[2]
  |                                  ^^^
4 |     return tup[0] + tup[1]
  |
info: rule `index-out-of-bounds` is enabled by default
</code></pre>
<p>I think ty should be able to infer the correct type of <code>tup</code> inside the <code>if</code> statement.</p>
<p>I searched the issue tracker for a similar bug report, but couldn't find any, so I hope this is not a duplicate :-)</p>
<p>Thanks in advance!</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.20</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-15 08:20</div>
            <div class="timeline-body"><blockquote>
<p>I searched the issue tracker for a similar bug report, but couldn't find any, so I hope this is not a duplicate :-)</p>
</blockquote>
<p>I think https://github.com/astral-sh/ty/issues/560 asks for the same thing. But no worries, finding the right tickets with GitHub's search is challenging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-09-15 08:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeertmans">@jeertmans</a> on 2025-09-15 08:26</div>
            <div class="timeline-body"><p>Thanks for pointing, and sorry for the duplicate!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:38 UTC
    </footer>
</body>
</html>
