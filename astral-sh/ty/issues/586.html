<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>generic dataclass instantiation fails without explicitly specifying generic type - astral-sh/ty #586</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>generic dataclass instantiation fails without explicitly specifying generic type</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/586">#586</a>
        opened by <a href="https://github.com/aschulte201">@aschulte201</a>
        on 2025-06-05 13:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aschulte201">@aschulte201</a></div>
            <div class="timeline-body">Summary
<p>First of all, thank you for your great work with ty. I really like using your tools ðŸ˜ƒ</p>
Description
<p>I encountered an issue when instantiating a generic dataclass without explicitly specifying the type parameter. ty then reports an error like:</p>
<blockquote>
<p>Expected T, found Attr</p>
</blockquote>
<p>This occurs even though the provided argument for the dataclass attribute (which was typed with the generic) is an instance of the typevars upper bound.</p>
Minimal example
<pre><code>from dataclasses import dataclass

class Attr: ...

@dataclass
class Payload[T: Attr]:
    attr: T

if __name__ == &quot;__main__&quot;:
    a = Payload(attr=Attr())
    b: Payload[Attr] = Payload(attr=Attr())
    c: Payload[Attr] = Payload[Attr](attr=Attr())
</code></pre>
<p><code>a</code> an <code>b</code> both produce the error: <code>Expected &#x27;T&#x27;, found &#x27;Attr&#x27;</code>.  <code>c</code> outputs no error.</p>
Expected behaviour
<p>I would expect that <code>a</code> and <code>b</code> should also be valid, as <code>Attr</code> satisfies the constraint <code>T: Attr</code>, and this pattern works in mypy without issues.</p>
Setup Details
<p>I was unable to reproduce the issue on the playground, but below are the details of my local setup:</p>
<ul>
<li>Minimal <code>pyproject.toml</code> without settings other than <code>project</code></li>
<li>Python 3.12.10</li>
<li>ty 0.0.1-alpha.8 (c1337c962 2025-06-02)</li>
<li>mypy 1.16.0</li>
</ul>
Version
<p>ty 0.0.1-alpha.8 (c1337c962 2025-06-02)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">dataclasses</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-05 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-05 16:21</div>
            <div class="timeline-body"><p>Thanks for the report! This was fixed recently in https://github.com/astral-sh/ruff/commit/e8ea40012afda872ef9bdf496a8b888ba80b533b, which is why you can&#x27;t reproduce it in the playground. A release should be out with it shortly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-05 16:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:45 UTC
    </footer>
</body>
</html>
