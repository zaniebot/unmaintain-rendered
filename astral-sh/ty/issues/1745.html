<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>emacs egot rename/auto import - astral-sh/ty #1745</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>emacs egot rename/auto import</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1745">#1745</a>
        opened by <a href="https://github.com/danielpopescu">@danielpopescu</a>
        on 2025-12-03 16:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danielpopescu">@danielpopescu</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hello... excited about this new type checker/LSP server. Testing with emacs+eglot, already looks pretty good (very snappy!). I did noticed that the rename variable is not working with latest version... Here's my config:</p>
<pre><code>  (setq-default eglot-workspace-configuration
                `(
                :ty (
                     :diagnosticMode &quot;workspace&quot;
                     :experimental (:rename t
                                    :autoImport t)
                     :inlayHints (:variableTypes t
                                  :callArgumentNames t)
                     )
                    )
                )
</code></pre>
<p>Is this a known issue?</p>
<p>Thanks</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-03 16:51</div>
            <div class="timeline-body"><p>Can you share a specific example of what you tried to rename. There are some known limitations with the rename feature</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2025-12-03 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-12-03 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpopescu">@danielpopescu</a> on 2025-12-03 17:03</div>
            <div class="timeline-body"><p>Really, just rename anything (variable, parameter, etc). For instance, in this function:</p>
<pre><code class="language-py">def list_split[T](lst: list[T], k: int) -&gt; list[list[T]]:
    assert k &gt; 0
    num = len(lst) // k
    return [
        lst[(i * num) : ((i + 1) * num if i &lt; k - 1 else len(lst))] for i in range(k)
    ]
</code></pre>
<p>attempts to rename lst or num, fail with: eglot--error: [eglot] Unsupported or ignored LSP capability ‘:renameProvider’</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-03 17:34</div>
            <div class="timeline-body"><p>I don't know emacs but could you try removing the <code>:ty</code> prefix from the settings?</p>
<p>If eglot has a way to log the client/server communication, could you enable it and share the initial messages between client/server?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpopescu">@danielpopescu</a> on 2025-12-03 18:40</div>
            <div class="timeline-body"><p>I cannot remove ty, as that is how the LSP config is defined for eglot: https://elpa.gnu.org/devel/doc/eglot.html#Project_002dspecific-configuration</p>
<p>Here's the beginning of the log:</p>
<pre><code>[jsonrpc] D[13:35:33.125] Running language server: /Users/xyz/.venv/bin/ty server
[jsonrpc] e[13:35:33.125] --&gt; initialize[1] {&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;initialize&quot;,&quot;params&quot;:{&quot;processId&quot;:14322,&quot;clientInfo&quot;:{&quot;name&quot;:&quot;Eglot&quot;,&quot;version&quot;:&quot;1.19.0.20251130.135230&quot;},&quot;rootPath&quot;:&quot;/Users/xyz/tmp/&quot;,&quot;rootUri&quot;:&quot;file:///Users/xyz/tmp&quot;,&quot;initializationOptions&quot;:{},&quot;capabilities&quot;:{&quot;workspace&quot;:{&quot;applyEdit&quot;:true,&quot;executeCommand&quot;:{&quot;dynamicRegistration&quot;:false},&quot;workspaceEdit&quot;:{&quot;documentChanges&quot;:true},&quot;didChangeWatchedFiles&quot;:{&quot;dynamicRegistration&quot;:true},&quot;symbol&quot;:{&quot;dynamicRegistration&quot;:false},&quot;semanticTokens&quot;:{&quot;refreshSupport&quot;:true},&quot;configuration&quot;:true,&quot;workspaceFolders&quot;:true},&quot;textDocument&quot;:{&quot;synchronization&quot;:{&quot;dynamicRegistration&quot;:false,&quot;willSave&quot;:true,&quot;willSaveWaitUntil&quot;:true,&quot;didSave&quot;:true},&quot;completion&quot;:{&quot;dynamicRegistration&quot;:false,&quot;completionItem&quot;:{&quot;snippetSupport&quot;:true,&quot;deprecatedSupport&quot;:true,&quot;resolveSupport&quot;:{&quot;properties&quot;:[&quot;documentation&quot;,&quot;details&quot;,&quot;additionalTextEdits&quot;]},&quot;tagSupport&quot;:{&quot;valueSet&quot;:[1]},&quot;insertReplaceSupport&quot;:true},&quot;contextSupport&quot;:true},&quot;hover&quot;:{&quot;dynamicRegistration&quot;:false,&quot;contentFormat&quot;:[&quot;markdown&quot;,&quot;plaintext&quot;]},&quot;signatureHelp&quot;:{&quot;dynamicRegistration&quot;:false,&quot;signatureInformation&quot;:{&quot;parameterInformation&quot;:{&quot;labelOffsetSupport&quot;:true},&quot;documentationFormat&quot;:[&quot;markdown&quot;,&quot;plaintext&quot;],&quot;activeParameterSupport&quot;:true}},&quot;references&quot;:{&quot;dynamicRegistration&quot;:false},&quot;definition&quot;:{&quot;dynamicRegistration&quot;:false,&quot;linkSupport&quot;:true},&quot;declaration&quot;:{&quot;dynamicRegistration&quot;:false,&quot;linkSupport&quot;:true},&quot;implementation&quot;:{&quot;dynamicRegistration&quot;:false,&quot;linkSupport&quot;:true},&quot;typeDefinition&quot;:{&quot;dynamicRegistration&quot;:false,&quot;linkSupport&quot;:true},&quot;documentSymbol&quot;:{&quot;dynamicRegistration&quot;:false,&quot;hierarchicalDocumentSymbolSupport&quot;:true,&quot;symbolKind&quot;:{&quot;valueSet&quot;:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]}},&quot;documentHighlight&quot;:{&quot;dynamicRegistration&quot;:false},&quot;codeAction&quot;:{&quot;dynamicRegistration&quot;:false,&quot;resolveSupport&quot;:{&quot;properties&quot;:[&quot;edit&quot;,&quot;command&quot;]},&quot;dataSupport&quot;:true,&quot;codeActionLiteralSupport&quot;:{&quot;codeActionKind&quot;:{&quot;valueSet&quot;:[&quot;quickfix&quot;,&quot;refactor&quot;,&quot;refactor.extract&quot;,&quot;refactor.inline&quot;,&quot;refactor.rewrite&quot;,&quot;source&quot;,&quot;source.organizeImports&quot;]}},&quot;isPreferredSupport&quot;:true},&quot;formatting&quot;:{&quot;dynamicRegistration&quot;:false},&quot;rangeFormatting&quot;:{&quot;dynamicRegistration&quot;:false},&quot;rename&quot;:{&quot;dynamicRegistration&quot;:false},&quot;semanticTokens&quot;:{&quot;dynamicRegistration&quot;:false,&quot;requests&quot;:{&quot;quote&quot;:{&quot;full&quot;:{&quot;delta&quot;:true}}},&quot;overlappingTokenSupport&quot;:true,&quot;multilineTokenSupport&quot;:true,&quot;tokenTypes&quot;:[&quot;namespace&quot;,&quot;type&quot;,&quot;class&quot;,&quot;enum&quot;,&quot;interface&quot;,&quot;struct&quot;,&quot;typeParameter&quot;,&quot;parameter&quot;,&quot;variable&quot;,&quot;property&quot;,&quot;enumMember&quot;,&quot;event&quot;,&quot;function&quot;,&quot;method&quot;,&quot;macro&quot;,&quot;keyword&quot;,&quot;modifier&quot;,&quot;comment&quot;,&quot;string&quot;,&quot;number&quot;,&quot;regexp&quot;,&quot;operator&quot;,&quot;decorator&quot;],&quot;tokenModifiers&quot;:[&quot;declaration&quot;,&quot;definition&quot;,&quot;readonly&quot;,&quot;static&quot;,&quot;deprecated&quot;,&quot;abstract&quot;,&quot;async&quot;,&quot;modification&quot;,&quot;documentation&quot;,&quot;defaultLibrary&quot;],&quot;formats&quot;:[&quot;relative&quot;]},&quot;inlayHint&quot;:{&quot;dynamicRegistration&quot;:false},&quot;callHierarchy&quot;:{&quot;dynamicRegistration&quot;:false},&quot;typeHierarchy&quot;:{&quot;dynamicRegistration&quot;:false},&quot;publishDiagnostics&quot;:{&quot;relatedInformation&quot;:false,&quot;versionSupport&quot;:true,&quot;codeDescriptionSupport&quot;:false,&quot;tagSupport&quot;:{&quot;valueSet&quot;:[1,2]}}},&quot;window&quot;:{&quot;showDocument&quot;:{&quot;support&quot;:true},&quot;showMessage&quot;:{&quot;messageActionItem&quot;:{&quot;additionalPropertiesSupport&quot;:true}},&quot;workDoneProgress&quot;:true},&quot;general&quot;:{&quot;positionEncodings&quot;:[&quot;utf-32&quot;,&quot;utf-8&quot;,&quot;utf-16&quot;]},&quot;experimental&quot;:{}},&quot;workspaceFolders&quot;:[{&quot;uri&quot;:&quot;file:///Users/xyz/tmp&quot;,&quot;name&quot;:&quot;~/tmp/&quot;}]}}
[stderr]  2025-12-03 13:35:33.130330000  INFO Version: 0.0.1-alpha.29 (0c3cae494 2025-11-28)
[jsonrpc] e[13:35:33.133] &lt;-- initialize[1] {&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;result&quot;:{&quot;capabilities&quot;:{&quot;codeActionProvider&quot;:{&quot;codeActionKinds&quot;:[&quot;quickfix&quot;]},&quot;completionProvider&quot;:{&quot;triggerCharacters&quot;:[&quot;.&quot;]},&quot;declarationProvider&quot;:true,&quot;definitionProvider&quot;:true,&quot;diagnosticProvider&quot;:{&quot;identifier&quot;:&quot;ty&quot;,&quot;interFileDependencies&quot;:true,&quot;workDoneProgress&quot;:true,&quot;workspaceDiagnostics&quot;:true},&quot;documentHighlightProvider&quot;:true,&quot;documentSymbolProvider&quot;:true,&quot;executeCommandProvider&quot;:{&quot;commands&quot;:[&quot;ty.printDebugInformation&quot;],&quot;workDoneProgress&quot;:false},&quot;hoverProvider&quot;:true,&quot;inlayHintProvider&quot;:{},&quot;notebookDocumentSync&quot;:{&quot;notebookSelector&quot;:[{&quot;cells&quot;:[{&quot;language&quot;:&quot;python&quot;}]}],&quot;save&quot;:false},&quot;positionEncoding&quot;:&quot;utf-8&quot;,&quot;referencesProvider&quot;:true,&quot;selectionRangeProvider&quot;:true,&quot;semanticTokensProvider&quot;:{&quot;full&quot;:true,&quot;legend&quot;:{&quot;tokenModifiers&quot;:[&quot;definition&quot;,&quot;readonly&quot;,&quot;async&quot;],&quot;tokenTypes&quot;:[&quot;namespace&quot;,&quot;class&quot;,&quot;parameter&quot;,&quot;selfParameter&quot;,&quot;clsParameter&quot;,&quot;variable&quot;,&quot;property&quot;,&quot;function&quot;,&quot;method&quot;,&quot;keyword&quot;,&quot;string&quot;,&quot;number&quot;,&quot;decorator&quot;,&quot;builtinConstant&quot;,&quot;typeParameter&quot;]},&quot;range&quot;:true},&quot;signatureHelpProvider&quot;:{&quot;retriggerCharacters&quot;:[&quot;)&quot;],&quot;triggerCharacters&quot;:[&quot;(&quot;,&quot;,&quot;]},&quot;textDocumentSync&quot;:{&quot;change&quot;:2,&quot;openClose&quot;:true},&quot;typeDefinitionProvider&quot;:true,&quot;workspaceSymbolProvider&quot;:true},&quot;serverInfo&quot;:{&quot;name&quot;:&quot;ty&quot;,&quot;version&quot;:&quot;0.0.1-alpha.29 (0c3cae494 2025-11-28)&quot;}}}
[jsonrpc] e[13:35:33.133] --&gt; initialized {&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;initialized&quot;,&quot;params&quot;:{}}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-04 07:39</div>
            <div class="timeline-body"><p>Thanks, that's useful. The interesting bit from the logs is:</p>
<pre><code>&quot;rename&quot;:{&quot;dynamicRegistration&quot;:false},
</code></pre>
<p>Eglot doesn't support dynamically registering the rename capability, but ty doesn't know whether you've enabled renaming when using workspace configuration during startup.</p>
<p>Can you try to pass the <code>experimental.rename</code> setting as part of the <code>initializationOptions</code> options?</p>
<p>@dhruvmanila What do you think of changing the server capabilities to always register the rename provider if the client doesn't support dynamic registration and then checking the option in <code>can_rename</code> (we could even promote users to enable the experimental option).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-04 08:15</div>
            <div class="timeline-body"><blockquote>
<p>What do you think of changing the server capabilities to always register the rename provider if the client doesn't support dynamic registration and then checking the option in <code>can_rename</code> (we could even promote users to enable the experimental option).</p>
</blockquote>
<p>This already happens:</p>
<p>https://github.com/astral-sh/ruff/blob/4c86300091de5b9eafecbdd364299ebb43752b95/crates/ty_server/src/capabilities.rs#L366-L376</p>
<p>Or, do you mean something else?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-04 08:21</div>
            <div class="timeline-body"><p>Oh, are these workspace configuration?</p>
<blockquote>
<p>Can you try to pass the <code>experimental.rename</code> setting as part of the <code>initializationOptions</code> options?</p>
</blockquote>
<p>I think this should work but I think it should be fine to do what you've suggested which is to always advertise support for rename capability and return early during the <code>prepareRename</code> request similar to how it is if language services are disabled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-04 08:21</div>
            <div class="timeline-body"><p>We only announce rename support if it is enabled in initialize options. I suggest to always announce the rename capability for clients not supporting dynamic registration and bail out in can_rename if the setting's turned off</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-12-04 08:25</div>
            <div class="timeline-body"><p>That seems reasonable, I'd prefer that the check be in <code>prepareRename</code> request handler instead of the <code>can_rename</code> function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @dhruvmanila on 2025-12-04 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpopescu">@danielpopescu</a> on 2025-12-04 12:49</div>
            <div class="timeline-body"><p>Just a quick update... I did augment initializationOptions with the experimental options:</p>
<p>(add-to-list 'eglot-server-programs
'((python-ts-mode) . (&quot;/Users/dpo/.venv/bin/ty&quot; &quot;server&quot; :initializationOptions (
:experimental (:rename t
:autoImport t)
))))</p>
<p>and rename works!</p>
<p>Nonetheless, this is confusing  as which options can be in the workspace configuration cand which ones need to be in  initializationOptions?</p>
<p>For reference, I use clangd, rust_analyzer, haskell language server, pyright, etc.... and entire configuration is done via workspace definition... this is the first LSP that I needed to touch initializationOptions...</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-04 12:56</div>
            <div class="timeline-body"><p>Yes I agree and this is what I and Dhruv were discussing. <a href="https://github.com/astral-sh/ruff/pull/21789">#21789</a> changes the behavior so that you can use <code>initialize_options</code> or workspace options.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpopescu">@danielpopescu</a> on 2025-12-04 13:01</div>
            <div class="timeline-body"><p>Excellent. Just to be sure, this will apply not only to rename but also to any other existing or future options... one can set it up via workspace definition and initialize_options?</p>
<p>Thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-04 13:20</div>
            <div class="timeline-body"><p>Yes, as far as I know this already works for the other experimental settings</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpopescu">@danielpopescu</a> on 2025-12-04 13:33</div>
            <div class="timeline-body"><p>Ok. Thanks. Just fyi, I did type polars. and polars was not auto imported in my file... this was even after I added to initialize_options. Maybe auto import is not working, or not using it right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-04 13:40</div>
            <div class="timeline-body"><p>@danielpopescu I don't think auto-import supports completion module names (outside of <code>import</code> statements) yet. See https://github.com/astral-sh/ty/issues/1530. I believe it's easy to add, just hasn't been done yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-12-04 13:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:10 UTC
    </footer>
</body>
</html>
