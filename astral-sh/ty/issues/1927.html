<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emit diagnostic on unsound call to abstract `@classmethod` or `@staticmethod` with trivial body, when accessed on the class object itself - astral-sh/ty #1927</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Emit diagnostic on unsound call to abstract `@classmethod` or `@staticmethod` with trivial body, when accessed on the class object itself</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1927">#1927</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-16 13:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-16 13:31</div>
            <div class="timeline-body"><p>Both <a href="https://pyright-play.net/?pyrightVersion=1.1.405&amp;pythonVersion=3.13&amp;reportUnreachable=true&amp;code=GYJw9gtgBAhgRgYygSwgBzCALrOBnLEGBLCAUywAswATAKDoQBsY88oAxALjqj6gACzVnnJVavfgPgEiJMdXr8oNMsCgLaACmZ4AlFAC0APhQA7LFygA6WwxBkAbmRhMA%2BlgCeaMlo7XNGi09PTogA">pyright</a> and <a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeS4ATrgLYAEq2AxnRDcbpQC4PZxeVUTLjRhcAFrkwAddLKZRUcOHQBiiWXS10AAgqVxREqZu07G-QcKOSZ6bXUwwwdG1IAUCuAEo6AWgA%2BVnQuRDpCCNlZShgANxhUKAB9LlJiGHdVQjdMd29vWRAAGhAAVy5oOBJyRBAAYjoAVQqoCFS6MFL0YQhcdDgorGcOzhpULiT0UppsGEp3fDCIEN9AuksNe20YrlLKezBpEAA5adnKMOB8AF8jwpKyGLAoUkIuWigKBoAFUieX9YYHAEOhMPqQADme3GvXQhFkDQAyjAYHRxFwuMQ4IgAPQ4x7OF6ETgQnEwdA4zC4JhwHFg9CQ6EVPo4kaUBixVDQRiwUHgiBQwTM%2By4YjCqqyMjGdB%2BeKUOCwugAXjoRwAzIQAIwAJju6BA1xKQgq8VU0BgFDQWDwRDIBqAA">pyrefly</a> detect the unsoundness here, though <a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=cf7dbf1c58f50ff7fb4528abfceed39d">mypy</a> does not. We should also detect this as unsound and reject it:</p>
<pre><code class="language-py">from abc import abstractmethod

class F:
    @classmethod
    @abstractmethod
    def method(cls) -&gt; int: ...

# pyright: Method &quot;method&quot; cannot be called because it is abstract and unimplemented  (reportAbstractUsage)
reveal_type(F.method())
</code></pre>
<p>Pyright and pyrefly do however allow the classmethod to be called via <code>type[F]</code>. You could argue that this is unsound, since you do not know whether or not you're dealing with a concrete subclass of <code>F</code> or not. But <code>type[]</code> types are generally unsound, and mypy's lint attempting to enforce similar soundness checks for <code>type[]</code> types has proved <a href="https://github.com/python/mypy/issues/4717">very unpopular</a>. So I think we should also allow this:</p>
<pre><code class="language-py">from abc import abstractmethod

class F:
    @classmethod
    @abstractmethod
    def method(cls) -&gt; int: ...

def _(x: type[F]):
    reveal_type(x.method())
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @AlexWaygood on 2025-12-16 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typing semantics</span> added by @AlexWaygood on 2025-12-16 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-12-16 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-16 20:23</div>
            <div class="timeline-body"><p>Note that instance methods don't need to be caught by this check, because if we implement https://github.com/astral-sh/ty/issues/1877 then it's basically impossible to call an abstract instance method.</p>
<p>This check should probably also include abstract staticmethods with trivial bodies, though, thinking about it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-16 20:25</div>
            <div class="timeline-body"><p>But isn't this kind of thing a valid use case for abstract types and methods?</p>
<pre><code class="language-py"># A is a type with abstract methods

def f(a: A):
    a.some_abstract_method()
</code></pre>
<p>where the whole point is that you want callers to pass you concrete subtypes of <code>A</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-16 20:30</div>
            <div class="timeline-body"><p>Yes, I just said that we shouldn't include instance methods in this check, only classmethods and maybe staticmethods. And above that, I also said that we should only emit the lint for abstract classmethods/staticmethods with trivial bodies accessed on the class object itself, not when accessed on <code>type[]</code> types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Emit diagnostic on unsound call to abstract `@classmethod` with trivial body" to "Emit diagnostic on unsound call to abstract `@classmethod` or `@staticmethod` with trivial body, when accessed on the class object itself" by @AlexWaygood on 2025-12-16 20:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:54:35 UTC
    </footer>
</body>
</html>
