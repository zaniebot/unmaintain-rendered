<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parsed Docstring Dreams - astral-sh/ty #1608</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Parsed Docstring Dreams</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1608">#1608</a>
        opened by <a href="https://github.com/Gankra">@Gankra</a>
        on 2025-11-21 13:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-21 13:34</div>
            <div class="timeline-body"><p>I don't want to file a bunch of granular issues about this right now so here's some pie-in-the-sky ideas about docstrings. All of this would require treating them like sub-ASTs (like string annotations):</p>
<h1>LSP Features</h1>
<ul>
<li>If there are `singleticks` around an item, try to resolve the name and make it hoverable/goto-able</li>
<li>If there are `singleticks` around an item, make it a link to the item in renderings of the docstring (hovers)</li>
<li>Do semantic tokens (syntax highlighting) of doctests (and literal blocks?)</li>
<li>Make names and types hoverable/clickable in <code>:param str myparam:</code> and <code>:rtype: str</code> (any of the various formats)</li>
<li>Make items in doctests (and literal blocks?) hoverable/goto-able</li>
</ul>
<h1>Typechecker Features</h1>
<ul>
<li>Have a diagnostic if a `singletick` name doesn't resolve</li>
<li>Have a diagnostic if we parse a <code>:param myparam:</code> but <code>myparam</code> isn't a parameter (any of the various formats)</li>
<li>Have a diagnostic if we parse a <code>:param int myparam:</code> but <code>myparam</code> isn't an <code>int</code>  (any of the various formats)</li>
<li>Have a diagnostic if we parse an <code>:rtype: int</code> but the return type isn't <code>int</code> (any of the various formats)</li>
<li>Typecheck doctests (and literal blocks?)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @Gankra on 2025-11-21 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-21 13:42</div>
            <div class="timeline-body"><p>If we shipped this stuff it would simultaneously be extremely cool and aggressively annoying. But maybe JUST MAYBE the annoyingness would encourage people to cleanup their docstrings so that the various checks don't break.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-11-21 13:46</div>
            <div class="timeline-body"><p>Some notes from @AlexWaygood</p>
<p>For the docs.python.org documentation, there's a bunch of symbols that are implicitly imported before any doctested code block is run in CI: https://github.com/python/cpython/blob/a8733cbc7328dbeeed50e82ef13abb197d511c46/Doc/library/typing.rst?plain=1#L5-L9</p>
<p>We do run some of the <code>typing.py</code> docstring codeblocks in CI, the config for that is here: https://github.com/python/cpython/blob/a8733cbc7328dbeeed50e82ef13abb197d511c46/Lib/test/test_typing.py#L11019-L11022</p>
<p>I think any REPL code block (that has the <code>&gt;&gt;&gt;</code> chevrons) will, I think, automatically be run in CPython's CI due to that config in <code>test_typing.py</code>. So all of those should not be missing any imports. (But some REPL codeblocks explicitly test that exceptions are raised -- having those type-checked would be pretty annoying!)</p>
<p>For the docs.python.org documentation, only codeblocks explicitly introduced with <code>.. doctest::</code> and <code>.. testcode::</code> are tested in CI (e.g. https://github.com/python/cpython/blob/a8733cbc7328dbeeed50e82ef13abb197d511c46/Doc/library/typing.rst?plain=1#L1480-L1488 or https://github.com/python/cpython/blob/a8733cbc7328dbeeed50e82ef13abb197d511c46/Doc/library/typing.rst?plain=1#L217-L231). <code>.. doctest::</code> codeblocks are REPL snippets; <code>.. testcode::</code> codeblocks are to be run as scripts.</p>
<p>For projects that autogenerate their online documentation from their docstrings and use Sphinx for their online documentation, they may use similar Sphinx directives in their docstrings to denote that a codeblock in that docstring should be tested in CI.</p>
<p>But the stdlib doctest module pays no heed to such things; it's only if you run doctests via Sphinx that these directives have any effect.</p>
<p>The docs are here if you want to play around with how the stdlib doctest module looks for and executes <code>&gt;&gt;&gt;</code> REPL snippets: https://docs.python.org/3/library/doctest.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Viicos">@Viicos</a> on 2025-11-21 16:36</div>
            <div class="timeline-body"><p>I think this relates to this issue: https://github.com/astral-sh/ruff/issues/19250. A while ago I started looking into how docutils parses reST, and I'd like to try and write an error tolerant parser that can be configured to some extent (e.g. to allow custom directives). This is far from trivial as it needs to map to <a href="https://docutils.sourceforge.io/docs/ref/doctree.html">the docutils document tree</a>, which is somewhat orthogonal to the reST syntax.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @carljm on 2026-01-09 03:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:48:55 UTC
    </footer>
</body>
</html>
