<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect possibly-unbound-attribute after checking for None and then sys.exit - astral-sh/ty #1110</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect possibly-unbound-attribute after checking for None and then sys.exit</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1110">#1110</a>
        opened by <a href="https://github.com/drichardson">@drichardson</a>
        on 2025-09-01 00:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/drichardson">@drichardson</a> on 2025-09-01 00:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The code below tests for <code>is None</code> and then calls <code>sys.exit</code> which has a <code>NoReturn</code> return type. However, <code>ty</code> doesn't appear to honor this and instead warns about later uses with <code>possibly-unbound-attribute</code> (even though it is guaranteed to be not <code>None</code>). Strangely, if I <code>raise ValueError</code> instead of <code>sys.exit</code> <code>ty</code> does <em>not</em> report the warning.</p>
<p>Playground Link: https://play.ty.dev/b95ffd2d-734b-4aef-a32b-04741bb2f742</p>
<pre><code class="language-python">import random
import sys
from dataclasses import dataclass

@dataclass
class Foo:
    i: int

def foo_or_none() -&gt; Foo | None:
    return random.choice([Foo(1), Foo(2), None])

def main():
    f = foo_or_none()

    if f is None:
        print(&quot;it was none&quot;)
        sys.exit()
        # raise ValueError(&quot;it was none&quot;)

    # BUG: possibly-unbound-attribute on f.i is incorrect because sys.exit is NoReturn.
    print(f&quot;Foo is: {f.i}&quot;)

main()
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.19 (e9cb838b3 2025-08-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-09-01 06:47</div>
            <div class="timeline-body"><p>Thank you for reporting this.</p>
<p>Please see https://github.com/astral-sh/ty/issues/1022, https://github.com/astral-sh/ty/issues/685 and https://github.com/astral-sh/ty/issues/690.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-09-01 06:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:27 UTC
    </footer>
</body>
</html>
