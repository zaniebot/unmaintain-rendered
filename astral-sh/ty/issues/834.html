<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`nonlocal` variable and `unresolved-reference` - astral-sh/ty #834</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>nonlocal</code> variable and <code>unresolved-reference</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/834">#834</a>
        opened by <a href="https://github.com/lswainemoore">@lswainemoore</a>
        on 2025-07-16 20:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lswainemoore">@lswainemoore</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Running <code>ty</code> locally, I have issues with <code>nonlocal</code> variables. This code:</p>
<pre><code>ty_test.py:

class UhOh:
    @staticmethod
    def should_work():
        foo = 1

        def bar():
            nonlocal foo
            foo += 1

        bar()
        bar()

        print(foo)

UhOh.should_work()
</code></pre>
<p>produces:</p>
<pre><code>$ uvx ty check ty_test.py
WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
error[unresolved-reference]: Name `foo` used when not defined
  --&gt; ty_test.py:8:13
   |
 6 |         def bar():
 7 |             nonlocal foo
 8 |             foo += 1
   |             ^^^
 9 |
10 |         bar()
   |
info: rule `unresolved-reference` is enabled by default

Found 1 diagnostic
</code></pre>
<p>with:</p>
<pre><code>$ uvx ty --version
ty 0.0.1-alpha.14 (3ececb07e 2025-07-08)
</code></pre>
<p>and no <code>ty</code> customization in my <code>pyproject.toml</code></p>
<p>Oddly, this works fine on the playground: https://play.ty.dev/ed6ae20c-6715-4767-a744-393399f74103</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.14 (3ececb07e 2025-07-08)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-07-16 20:45</div>
            <div class="timeline-body"><p>Thanks for the report! This works on the playground because the playground is automatically deployed from latest main branch and this was fixed since the last ty release. We should make another release soon!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-07-16 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lswainemoore">@lswainemoore</a> on 2025-07-16 20:47</div>
            <div class="timeline-body"><p>Oops ok great! Will stay tuned, thanks.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:18 UTC
    </footer>
</body>
</html>
