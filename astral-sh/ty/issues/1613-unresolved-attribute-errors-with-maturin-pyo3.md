```yaml
number: 1613
title: unresolved-attribute errors with maturin / pyo3
type: issue
state: closed
author: mstarodub
labels:
  - question
assignees: []
created_at: 2025-11-23T17:02:11Z
updated_at: 2025-11-24T21:35:19Z
url: https://github.com/astral-sh/ty/issues/1613
synced_at: 2026-01-12T15:54:25Z
```

# unresolved-attribute errors with maturin / pyo3

---

_@mstarodub_

maturin generates a wildcard import `__init__.py` for the rust package:
https://github.com/PyO3/maturin/blob/72d210b06b1e5bd7cc0b24a0f77b9d07e36727ba/src/templates/__init__.py.j2

and it seems ty is unable to provide completion for functions exported by the `#[pymodule]` as a result.

This seems to be a fairly common setup.


---

_Comment by @Gankra on 2025-11-23 17:07_

Are you able to provide a project/sample that has the issue?

---

_Comment by @mstarodub on 2025-11-23 17:21_

`maturin new` creates such a project stucture.

pyproject.toml:
```toml
[build-system]
requires = ["maturin>=1.10,<2.0"]
build-backend = "maturin"

[project]
name = "testpkg"
requires-python = ">=3.8"
classifiers = [
    "Programming Language :: Rust",
    "Programming Language :: Python :: Implementation :: CPython",
    "Programming Language :: Python :: Implementation :: PyPy",
]
dynamic = ["version"]
```

Cargo.toml:
```toml
[package]
name = "testpkg"
version = "0.1.0"
edition = "2024"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
[lib]
name = "testpkg"
crate-type = ["cdylib"]

[dependencies]
pyo3 = "0.27.0"
```

src/lib.rs:
```rust
use pyo3::prelude::*;

/// A Python module implemented in Rust.
#[pymodule]
mod testpkg {
    use pyo3::prelude::*;

    /// Formats the sum of two numbers as string.
    #[pyfunction]
    fn sum_as_string(a: usize, b: usize) -> PyResult<String> {
        Ok((a + b).to_string())
    }
}
```

here's a real world example: https://github.com/mstarodub/pyo3-trio

---

_Comment by @Gankra on 2025-11-23 17:53_

Ah ok so I tested this out and the generated project contains (when installed with `maturin develop`):

`.venv/lib/python3.14/site-packages/myturin/__init__.py`:

```
from .myturin import *

__doc__ = myturin.__doc__
if hasattr(myturin, "__all__"):
    __all__ = myturin.__all__
```

But notably `myturin.py` does not exist, only `.venv/lib/python3.14/site-packages/myturin/myturin.cpython-314-darwin.so` does. I am guessing the cpython interpreter deals with reading metadata out of the .so, but `ty` only analyzes actual py(i) files.

So your project needs stubs (pyi files), which is presumably why https://github.com/Jij-Inc/pyo3-stub-gen exists?

cc @konstin 

---

_Comment by @MichaReiser on 2025-11-24 08:17_

ty issue related to stubs gen https://github.com/astral-sh/ty/issues/1597

---

_Label `question` added by @MichaReiser on 2025-11-24 08:17_

---

_Comment by @konstin on 2025-11-24 08:44_

It's possible to read some information from the `.so` and generate stubs internally, iirc pycharm does that, but currently there's no default stubs.

---

_Comment by @carljm on 2025-11-24 17:14_

Also related to https://github.com/astral-sh/ty/issues/487

---

_Comment by @carljm on 2025-11-24 17:18_

In fact I think this is really the same issue as #487, so I will close it as duplicate. The solution to #487 could go beyond just "better diagnostics", but better (and/or suppressed) diagnostics are clearly the first step here.

Thanks for the report!

---

_Closed by @carljm on 2025-11-24 17:18_

---

_Comment by @AlexWaygood on 2025-11-24 17:22_

@davidhewitt, I have a very vague memory of having a conversation with you at RustNation UK nearly two years ago about plans you might have had for PyO3 to bundle its own autogenerated stubs to help type checkers out here...? but that's as far as my memory goes ðŸ˜†

---

_Comment by @davidhewitt on 2025-11-24 21:18_

Yep we're working on it! https://pyo3.rs/v0.27.1/type-stub.html

Also of note is that `maturin` creates that root `__init__.py` which just re-exports from the native library because (as far as I know) there is not yet a way to ship a native library plus a tree of `.pyi` files for it without having a wrapper `__init__.py`. I forget the fine details of why that doesn't work, though.

---

_Comment by @AlexWaygood on 2025-11-24 21:20_

> Yep we're working on it! [pyo3.rs/v0.27.1/type-stub.html](https://pyo3.rs/v0.27.1/type-stub.html)

Ah nice! We could consider linking to this from our docs

> Also of note is that `maturin` creates that root `__init__.py` which just re-exports from the native library because (as far as I know) there is not yet a way to ship a native library plus a tree of `.pyi` files for it without having a wrapper `__init__.py`. I forget the fine details of why that doesn't work, though.

yup, I think that's https://github.com/python/typing/issues/1333

---

_Comment by @davidhewitt on 2025-11-24 21:35_

Yep that looks like it! One day, hopefully ðŸ¤ž

---
