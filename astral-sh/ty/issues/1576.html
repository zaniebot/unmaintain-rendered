<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`Iterable[list[int]]` as type context is not handled well - astral-sh/ty #1576</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`Iterable[list[int]]` as type context is not handled well</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1576">#1576</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-11-17 11:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-17 11:41</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In this snippet:</p>
<pre><code class="language-py">from typing import reveal_type, Iterable

x: Iterable[list[int]] = [[42], [56]]
reveal_type(x)
</code></pre>
<p>we currently reveal <code>list[Unknown | list[Unknown | int]]</code>. For comparison, mypy and pyrefly reveal <code>Iterable[list[int]]</code> and pyright reveals <code>list[list[int]]</code>. Either seems better than our current answer (though I like pyright's best!).</p>
<ul>
<li><a href="https://play.ty.dev/7d2d3484-8e47-4d9a-97b9-7ec367822d3d">ty</a></li>
<li><a href="https://pyright-play.net/?pyrightVersion=1.1.405&amp;strict=true&amp;code=GYJw9gtgBALgngBwJYDsDmUkQWEMogCmAboQIYA2A%2BvAoQDRQCSMhIZARhYQFA8AeALmat2XQgG0KSAM4wJqGAF0lUALxQJEgCwAmJYwkBWAGwq%2BRUpRqJCACn4BKHkA">pyright</a></li>
<li><a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=53444c9cc1db48bbf406917f0d536900">mypy</a></li>
<li><a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeS4ATrgLYAEALqcROgOZ0Q3G6UN2UYANxiooAfSbEYAGjoBJBjEqpssADrpN%2BRAqUq1MANpQIcBkdYMAutboBeOkaMAWAEzW5RgKwA2W5qCImKSzDAAFPgAlJogMiAArgzQcCTkiCAAxHQAqsmmTHRgCegAxsm46HCampgwYEW8NKgM4ugJNNjKkbpWUXQAtAB8dOaUiJp0UwIwDAmU6EXqIAByHV3jdMD4AL7LsfFkgmBQpIQMtFAU2QAKpMenoxg4BHSllZBs8y0QlYSa2QAyjAYHQABYMBjEOCIAD0sKO9VOhF4bFhMHQsMwuFKcFh73Qn2%2BFUxjUodFQQlQ0FUsDeHwgXxUJLouGIJNSmjIDDBlQGIkocF%2Bi0cywAzIQAIxufboEA7eKocoQEQAMWgMAoaCweCIZHlQA">pyrefly</a></li>
</ul>
<p>cc. @ibraheemdev</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bidirectional inference</span> added by @AlexWaygood on 2025-11-17 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-11-17 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-11-17 16:03</div>
            <div class="timeline-body"><p>In general, we currently only consider type context if the types are equivalent. We probably need to extend this to a subclass check (and infer the correct type arguments).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-17 23:15</div>
            <div class="timeline-body"><p>@ibraheemdev does this example fall into the category of &quot;needs new constraint solver&quot;?</p>
<p>https://play.ty.dev/68b3e41b-7eee-4658-ae20-3a2b0f59fb7d</p>
<pre><code class="language-py">from collections.abc import Mapping
from typing import Literal

def process(data_types: Mapping[str, Literal[&quot;BOOL&quot;, &quot;INT&quot;, &quot;FLOAT&quot;]], /) -&gt; None:
    ...

process({&quot;foo&quot;:&quot;BOOL&quot;})
</code></pre>
<p>(We handle it fine if it is <code>Mapping[str, str]</code>, but not with the union of literals)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2025-12-17 23:52</div>
            <div class="timeline-body"><p>@carljm that one should also be fixed by https://github.com/astral-sh/ruff/pull/21930.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2025-12-30 22:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zsol">@zsol</a> on 2026-01-05 14:57</div>
            <div class="timeline-body"><p>I expected <a href="https://play.ty.dev/a5cc514f-32e2-418e-b865-2df3d635c005">this code</a> to no longer error after this issue was closed, but that doesn't seem to be the case. Do you want me to open a new issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2026-01-05 21:30</div>
            <div class="timeline-body"><p>@zsol that example requires bidirectional inference for comprehensions, which is tracked by https://github.com/astral-sh/ty/issues/1602.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:51:35 UTC
    </footer>
</body>
</html>
