<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OOM when trying to process Tauon's codebase - astral-sh/ty #1091</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>OOM when trying to process Tauon's codebase</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1091">#1091</a>
        opened by <a href="https://github.com/C0rn3j">@C0rn3j</a>
        on 2025-08-23 20:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/C0rn3j">@C0rn3j</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>https://github.com/Taiko2k/Tauon</p>
<p><code>ty check src/tauon</code> eats RAM endlessly, I killed it after 10GB consumed.</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.19 (e9cb838b3 2025-08-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">memory</span> added by @AlexWaygood on 2025-08-23 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">memory</span> removed by @sharkdp on 2025-08-25 08:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @sharkdp on 2025-08-25 08:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-25 08:45</div>
            <div class="timeline-body"><p>Thank you for reporting this.</p>
<p>The problem seems to come from <a href="https://github.com/Taiko2k/Tauon/blob/master/src/tauon/t_modules/t_main.py">a single file</a> specifically (which is 50k lines large).</p>
<p>Interestingly, this seems to be a performance problem during semantic index building, with a lot of time spent in <code>ReachabilityConstraintsBuilder::add_and_constraint</code>:</p>
<p><img width="962" height="177" alt="Image" src="https://github.com/user-attachments/assets/14648473-35b6-488d-921a-7b683d7153f1" /></p>
<p><img width="1918" height="1152" alt="Image" src="https://github.com/user-attachments/assets/4552fd7a-34b6-4597-af86-01ff30bcb1c1" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/C0rn3j">@C0rn3j</a> on 2025-08-25 09:38</div>
            <div class="timeline-body"><p>https://github.com/microsoft/pyright/discussions/10838</p>
<p>I presume this is due to the rather massive 9Kloc main function, which Pyright also chugs on, but Pyright has a complexity calculation and refuses to work to prevent the OOM on such functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @sharkdp by @sharkdp on 2025-08-26 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-08-27 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-27 18:46</div>
            <div class="timeline-body"><p>With the changes in https://github.com/astral-sh/ruff/pull/20098, I can now type-check the project in 9s on my laptop, where almost all of the time is still spent on <code>t_main.py</code>. So while definitely not great, we can now run to completion, and peak memory usage is around 2 GB. I am certain that we could do better here, but I don't think it's an immediate priority at the moment, given that it's rather unusual to have more than a thousand <code>if</code> statements in a single function. Feel free to reopen/comment if you think that this should be looked at more.</p>
<p>Splitting that function into several parts would almost certainly lead to much better type check times.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/C0rn3j">@C0rn3j</a> on 2025-08-28 06:43</div>
            <div class="timeline-body"><p>That is positively awesome, thanks a lot for this find&amp;fix!</p>
<p>There's <a href="https://github.com/Taiko2k/Tauon/pull/1801">this branch</a> where I split the functions up a bit, which I'll be trying to get in to master, but it is awesome to know it can work as-is too, albeit not in the most resource-friendly fashion.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:33 UTC
    </footer>
</body>
</html>
