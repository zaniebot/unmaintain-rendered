<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider warning when an annotation should be narrower - astral-sh/ty #2472</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider warning when an annotation should be narrower</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2472">#2472</a>
        opened by <a href="https://github.com/jack-mcivor">@jack-mcivor</a>
        on 2026-01-12 19:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jack-mcivor">@jack-mcivor</a></div>
            <div class="timeline-body"><p>I think this could catch real issues in code - for example, this currently does not error (ty v0.0.11), but is a runtime error:</p>
<pre><code class="language-python">from typing import Sequence

def foo() -&gt; Sequence[int]:  # &lt;- the annotation here can be narrower - should be `tuple[Literal[5], Literal[6]]`
    return (5, 6)
foo()[2]  # bad - no ty error!
</code></pre>
<p>This variable annotation should also be made narrower. The difference here is that ty seems to ignore the annotation, so there is an error</p>
<pre><code class="language-python">a: Sequence[int] = (5, 6)  # &lt;- the annotation here can be narrower (and afaict unused by ty anyway)
a[2]  # good - &quot;error[index-out-of-bounds]: Index 2 is out of bounds for tuple `tuple[Literal[5], Literal[6]]` with length 2&quot;
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 19:17:00 UTC
    </footer>
</body>
</html>
