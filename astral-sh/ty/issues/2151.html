<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`=` in f-string interpolation causes false positives and negatives for `invalid-assignment` - astral-sh/ty #2151</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>=</code> in f-string interpolation causes false positives and negatives for <code>invalid-assignment</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2151">#2151</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-12-22 00:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-12-22 00:25</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The <code>=</code> part of f-string interpolations is ignored, causing false positives and false negatives for <code>invalid-assignment</code>. <a href="https://play.ty.dev/8aab7fa7-d811-481d-8084-16b956a9cbc0">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;invalid-assignment.py &lt;&lt;'# EOF'
from typing import Literal
fp: Literal[&quot;1=1&quot;] = f&quot;{1=}&quot;  # false positive
fn: Literal[&quot;2&quot;] = f&quot;{2=}&quot;  # false negative
# EOF

$ ty check --output-format concise invalid-assignment.py
invalid-assignment.py:2:22: error[invalid-assignment] Object of type `Literal[&quot;1&quot;]` is not assignable to `Literal[&quot;1=1&quot;]`
Found 1 diagnostic
</code></pre>
<h3>Version</h3>
<p>ty 0.0.5 (d37b7dbd9 2025-12-20)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-12-22 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-22 17:44</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>(Note to whoever looks at fixing this: we don't need to -- probably shouldn't bother -- implementing the full semantics of <code>=</code>. That wouldn't be very useful, since in almost all non-trivial cases we'd just get <code>str</code> back as the type of something's <code>repr()</code> anyway. We can instead just fall back to <code>str</code> as the type of the full f-string if any interpolation uses <code>=</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-12-23 00:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-12-23 01:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:41:47 UTC
    </footer>
</body>
</html>
