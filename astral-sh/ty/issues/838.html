<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support legacy namespace packages - astral-sh/ty #838</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support legacy namespace packages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/838">#838</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-07-17 10:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Add support for legacy namespace packages of the form <code>__import__(&quot;pkgutil&quot;).extend_path(__path__, __name__)</code> as is used by airflow.</p>
<p>See <a href="https://github.com/astral-sh/ruff/pull/20016">astral-sh/ruff#20016</a>#issuecomment-3211969330 for some discussions around how to implement this</p>
<p>Airflow&#x27;s project structure roughly is:</p>
<pre><code>airflow-core/src/airlfow
  - py.typed (empty except for licence)
  - __init__.py
providers/
  - cncf/kubernetes
    | - pyproject.toml
    | - src/airflow/
      | - __init__.py
      | - providers/
        | - __init__.py
        | - cncf  
          | - __init__.py
          | - kubernetes/
            | - __init__.py
            | - kubernetes_helper_functions.py
  - ... more providers
</code></pre>
<p>Each provider is linked into the virtual environment by usinbg an editable install. ty correctly picks them up.</p>
<pre><code>2025-07-17 12:13:06.067791000 DEBUG request{id=2 method=&quot;textDocument/semanticTokens/full&quot;}: Adding editable installation to module resolution path /Users/micha/astral/ecosystem/apache:airflow/providers/cncf/kubernetes/src
</code></pre>
<p>However, ty can&#x27;t resolve the <code>airflow.providers.cncf.kubernetes.kubernetes_helper_functions</code> import:</p>
<pre><code>2025-07-17 12:34:06.608986 TRACE Search path &#x27;/Users/micha/astral/ecosystem/apache:airflow&#x27; contains no stub package named `airflow-stubs.providers.cncf.kubernetes.kubernetes_helper_functions`.
2025-07-17 12:34:06.609018 TRACE Search path &#x27;/Users/micha/astral/ecosystem/apache:airflow&#x27; contains no package named `airflow.providers.cncf.kubernetes.kubernetes_helper_functions`.
2025-07-17 12:34:06.609036 TRACE Search path &#x27;vendored://stdlib&#x27; contains no package named `airflow.providers.cncf.kubernetes.kubernetes_helper_functions`.
2025-07-17 12:34:06.609092 TRACE Search path &#x27;/Users/micha/astral/ecosystem/apache:airflow/.venv/lib/python3.12/site-packages&#x27; contains no stub package named `airflow-stubs.providers.cncf.kubernetes.kubernetes_helper_functions`.
2025-07-17 12:34:06.609127 TRACE Search path &#x27;/Users/micha/astral/ecosystem/apache:airflow/.venv/lib/python3.12/site-packages&#x27; contains no package named `airflow.providers.cncf.kubernetes.kubernetes_helper_functions`.
2025-07-17 12:34:06.609161 TRACE Search path &#x27;/Users/micha/astral/ecosystem/apache:airflow/airflow-core/src&#x27; contains no stub package named `airflow-stubs.providers.cncf.kubernetes.kubernetes_helper_functions`.
2025-07-17 12:34:06.609213 TRACE Package in `/Users/micha/astral/ecosystem/apache:airflow/airflow-core/src doesn&#x27;t contain module: `airflow.providers.cncf.kubernetes.kubernetes_helper_functions`
2025-07-17 12:34:06.609226 DEBUG Module `airflow.providers.cncf.kubernetes.kubernetes_helper_functions` not found in search paths
</code></pre>
<p>The problem is that ty stops searching for <code>kubernetes_helper_functions</code> after it successfully resolved <code>airflow</code> to a regular package in <code>airflow-core</code>. This does seem correct to me. However, it&#x27;s not clear how airflow would configure ty to get import resolution working because the resolution will always stop after the first import.</p>
<p>airflow&#x27;s setup works for downstream users because the provider packages get merged into the <code>airflow</code> package during installation. The layout of the package in venv is:</p>
<pre><code>airlfow
  - py.typed (empty except for licence)
  - __init__.py
    providers/
    | - cncf  
      | - __init__.py
      | - kubernetes/
        | - __init__.py
        | - kubernetes_helper_functions.py
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 10:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 11:45</div>
            <div class="timeline-body"><p>mypy supports this project layout by adding all providers to MYPY_PATH. I don&#x27;t fully understand why this helps.</p>
<pre><code>mypy_path = [
    &quot;$MYPY_CONFIG_FILE_DIR/airflow-core/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/airflow-core/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/task-sdk/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/task-sdk/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/airflow-ctl/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/airflow-ctl/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/dev&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/devel-common/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/helm-tests/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/kubernetes-tests/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/docker-tests/tests&quot;,
#     # Automatically generated mypy paths
    &quot;$MYPY_CONFIG_FILE_DIR/providers/airbyte/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/airbyte/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/alibaba/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/alibaba/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/amazon/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/amazon/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/beam/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/beam/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/cassandra/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/cassandra/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/drill/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/drill/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/druid/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/druid/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/flink/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/flink/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/hdfs/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/hdfs/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/hive/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/hive/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/iceberg/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/iceberg/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/impala/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/impala/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/kafka/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/kafka/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/kylin/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/kylin/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/livy/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/livy/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/pig/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/pig/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/pinot/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/pinot/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/spark/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/spark/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/tinkerpop/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apache/tinkerpop/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apprise/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/apprise/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/arangodb/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/arangodb/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/asana/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/asana/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/atlassian/jira/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/atlassian/jira/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/celery/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/celery/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/cloudant/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/cloudant/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/cncf/kubernetes/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/cncf/kubernetes/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/cohere/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/cohere/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/compat/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/compat/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/io/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/io/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/messaging/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/messaging/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/sql/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/common/sql/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/databricks/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/databricks/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/datadog/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/datadog/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/dbt/cloud/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/dbt/cloud/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/dingding/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/dingding/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/discord/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/discord/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/docker/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/docker/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/edge3/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/edge3/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/elasticsearch/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/elasticsearch/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/exasol/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/exasol/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/fab/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/fab/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/facebook/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/facebook/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/ftp/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/ftp/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/git/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/git/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/github/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/github/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/google/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/google/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/grpc/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/grpc/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/hashicorp/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/hashicorp/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/http/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/http/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/imap/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/imap/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/influxdb/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/influxdb/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/jdbc/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/jdbc/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/jenkins/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/jenkins/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/keycloak/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/keycloak/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/azure/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/azure/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/mssql/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/mssql/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/psrp/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/psrp/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/winrm/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/microsoft/winrm/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/mongo/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/mongo/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/mysql/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/mysql/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/neo4j/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/neo4j/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/odbc/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/odbc/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/openai/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/openai/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/openfaas/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/openfaas/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/openlineage/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/openlineage/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/opensearch/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/opensearch/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/opsgenie/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/opsgenie/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/oracle/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/oracle/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/pagerduty/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/pagerduty/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/papermill/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/papermill/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/pgvector/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/pgvector/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/pinecone/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/pinecone/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/postgres/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/postgres/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/presto/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/presto/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/qdrant/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/qdrant/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/redis/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/redis/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/salesforce/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/salesforce/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/samba/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/samba/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/segment/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/segment/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/sendgrid/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/sendgrid/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/sftp/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/sftp/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/singularity/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/singularity/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/slack/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/slack/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/smtp/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/smtp/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/snowflake/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/snowflake/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/sqlite/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/sqlite/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/ssh/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/ssh/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/standard/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/standard/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/tableau/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/tableau/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/telegram/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/telegram/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/teradata/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/teradata/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/trino/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/trino/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/vertica/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/vertica/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/weaviate/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/weaviate/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/yandex/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/yandex/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/ydb/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/ydb/tests&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/zendesk/src&quot;,
    &quot;$MYPY_CONFIG_FILE_DIR/providers/zendesk/tests&quot;,
#     # End of automatically generated mypy paths
]
</code></pre>
<p>pyright seems to run into the same limitation as ty</p>
<pre><code>pache:airflow on ÓÇ† main [!] is üì¶ v3.1.0 via üêç v3.13.1 (apache-airflow) took 9s 
‚ùØ uvx pyright@latest /Users/micha/astral/ecosystem/apache:airflow/providers/cncf/kubernetes/tests/unit/cncf/kubernetes/test_kubernetes_helper_functions.py
Installed 3 packages in 67ms
/Users/micha/astral/ecosystem/apache:airflow/providers/cncf/kubernetes/tests/unit/cncf/kubernetes/test_kubernetes_helper_functions.py
  /Users/micha/astral/ecosystem/apache:airflow/providers/cncf/kubernetes/tests/unit/cncf/kubernetes/test_kubernetes_helper_functions.py:22:8 - error: Import &quot;pytest&quot; could not be resolved (reportMissingImports)
  /Users/micha/astral/ecosystem/apache:airflow/providers/cncf/kubernetes/tests/unit/cncf/kubernetes/test_kubernetes_helper_functions.py:24:6 - error: Import &quot;airflow.providers.cncf.kubernetes.kubernetes_helper_functions&quot; could not be resolved (reportMissingImports)
2 errors, 0 warnings, 0 informations 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 12:01</div>
            <div class="timeline-body"><p>One option here could be to treat search paths added to <code>environment.root</code> as namespace packages by default. What I mean by that is that we would try to search all paths listed in <code>environment.root</code> even if there was a partial match in another <code>environment.root</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-17 13:14</div>
            <div class="timeline-body"><blockquote>
<p>mypy supports this project layout by adding all providers to MYPY_PATH.</p>
</blockquote>
<p>The analogous setting for us is <code>extra_paths</code>, right? Does it all work if we set those to the same values they&#x27;re currently using for <code>mypy_path</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 13:18</div>
            <div class="timeline-body"><blockquote>
<p>The analogous setting for us is extra_paths, right? Does it all work if we set those to the same values they&#x27;re currently using for mypy_path</p>
</blockquote>
<p>Yes, but that won&#x27;t help here because ty will try at most one airflow search path for <code>airflow</code> the airflow module (the airflow module contains an <code>__init__.py</code>). ty then skips any other search path because it did find a package for <code>airflow</code>, but it didn&#x27;t contain the requested provider. Unless this behavior is incorrect?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-17 13:22</div>
            <div class="timeline-body"><blockquote>
<p>Unless this behavior is incorrect?</p>
</blockquote>
<p>No idea! üòÉ can check when I&#x27;m reunited with my laptop on Monday</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 13:26</div>
            <div class="timeline-body"><blockquote>
<p>No idea! üòÉ can check when I&#x27;m reunited with my laptop on Monday</p>
</blockquote>
<p>Running python and importing those modules agrees with ty. The provider isn&#x27;t importable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 14:23</div>
            <div class="timeline-body"><p>I think claude explained the problem better than I :)</p>
<p>When you have:</p>
<ul>
<li><code>airflow-core/src/airflow/</code> (with <code>__init__.py</code>)</li>
<li>An import like <code>airflow.providers.cncf.kubernetes.kubernetes_helper_functions</code></li>
<li>Provider packages in a different location added to mypy_path</li>
</ul>
<p>The question becomes: Should a type checker continue searching other paths when it finds <code>airflow</code> in the first location but can&#x27;t find the full dotted path there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 14:50</div>
            <div class="timeline-body"><p>@zanieb is this a known issue on the uv side or are could uv do something here so that the dev venv is closer to when installing airflow and some providers as third party dependencies?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-07-18 19:12</div>
            <div class="timeline-body"><p>As far as I can tell from this thread, ty and pyright are correct and the airflow setup is just broken? I don&#x27;t understand how this could work at runtime (and per your earlier comment, it doesn&#x27;t?)</p>
<p>The runtime behavior is that if we are looking for any import under <code>airflow.*</code> and we find a <code>sys.path</code> entry with <code>airflow/__init__.py</code>, we stop there, and no other <code>sys.path</code> entry will be considered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-19 14:00</div>
            <div class="timeline-body"><p>Yes, I do think that ty and pyright model the runtime semantics correctly.</p>
<p>However, that&#x27;s not much help for projects using a layout like airfow today because they couldn&#x27;t use ty and it&#x27;s currently unclear to me how they could be using ty without getting unresolved import errors and I also don&#x27;t see how they could easily re-organize their project (unless moving everything under <code>airflow-core</code> and maybe skipping providers during publishing?).</p>
<p>That might be reason enough for us to consider an option for project&#x27;s like airflow where the packages are <em>merged</em> during installation time but are in separate trees during development.</p>
<p>One option that I considered is adding a configuration option to <code>environment</code> for packages that should be resolved like namespace packages even when they&#x27;re clearly not. Airflow could then add <code>airflow</code> and <code>airflow.providers</code> to that list.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;airflow: Unable to resolve imports from optional provider packages.&quot; to &quot;Support legacy namespace packages&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-20 11:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;GA&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-20 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-20 11:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-10-17 03:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:05 UTC
    </footer>
</body>
</html>
