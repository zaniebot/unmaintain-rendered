<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server panic on a `src/package/__init__.py` file containing just `fr` - astral-sh/ty #1277</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Server panic on a <code>src/package/__init__.py</code> file containing just <code>fr</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1277">#1277</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-09-29 13:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body">Summary
<p>I just hit this panic in the playground, which appears to be server-specific (and also specific to it being an <code>__init__.py</code> file):</p>
<p>https://github.com/user-attachments/assets/f8c925ca-8421-4c0c-804c-36b440e91a77</p>
<p>Right-clicking on the webpage and selecting &quot;Inspect&quot;, I see two stacktraces: initially this one:</p>
<pre><code>panicked at crates/ty_python_semantic/src/module_resolver/list.rs:78:18:
System search path should have a registered root

Stack:

Bp/l.wbg.__wbg_new_8a6f238a6ece86ea@https://play.ty.dev/assets/index-IVeoMaQp.js:64:25613
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[10069]:0x7b45f6
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[3133]:0x61aca6
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[5324]:0x70d654
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[8097]:0x796599
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[6798]:0x74e0a2
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[921]:0x3ada21
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[524]:0x2ccb9a
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[512]:0x2c3f37
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[521]:0x2caf9f
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[2274]:0x584e67
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[8024]:0x77f66b
completions@https://play.ty.dev/assets/index-IVeoMaQp.js:64:21219
provideCompletionItems@https://play.ty.dev/assets/Editor-DvbeuRwl.js:1:3621
h/&lt;@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:660:28999
h@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:660:28760
trigger@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:726:8465
_doTriggerQuickSuggest/&lt;@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:726:7331
cancelAndSet/this._token&lt;@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:122:15238


[index-IVeoMaQp.js:64:24316](https://play.ty.dev/assets/index-IVeoMaQp.js)
    __wbg_error_7534b8e9a36f1ab4 index-IVeoMaQp.js:64
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:8079041
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:6401190
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:7394900
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:7955865
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:7659682
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:3856929
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:2935706
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:2899767
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:2928543
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:5787239
    &lt;anonymous&gt; ty_wasm_bg-CmMjrFpL.wasm:7861867
    completions index-IVeoMaQp.js:64
    provideCompletionItems Editor-DvbeuRwl.js:1
    h suggest.ts:302
    h suggest.ts:288
    trigger suggestModel.ts:495
    _doTriggerQuickSuggest suggestModel.ts:432
    _token async.ts:443
</code></pre>
<p>and then this one (repeated several times):</p>
<pre><code>panicked at /home/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/29ab321/src/function/fetch.rs:275:21:
dependency graph cycle when querying list_modules(Id(c400)), set cycle_fn/cycle_initial to fixpoint iterate.
Query stack:
[
    list_modules(Id(c400)),
    list_modules_in(Id(c801)),
    check_file_impl(Id(2801)),
    infer_scope_types(Id(1002g1)),
    suppressions(Id(2801)),
    ClassLiteral &lt; &#x27;db &gt;::try_mro_(Id(8c4f)),
    infer_definition_types(Id(65b3)),
    infer_expression_types_impl(Id(2c68)),
    infer_expression_types_impl(Id(2c38)),
    Type &lt; &#x27;db &gt;::member_lookup_with_policy_(Id(30a8)),
    infer_expression_types_impl(Id(2c37)),
    infer_definition_types(Id(1488)),
    infer_definition_types(Id(150b)),
    infer_expression_types_impl(Id(2c30)),
    all_narrowing_constraints_for_expression(Id(2ec2)),
    imported_modules(Id(ca4)),
    infer_definition_types(Id(ac59)),
    file_to_module(Id(c8f)),
    source_text(Id(c8f)),
]

Stack:

Bp/l.wbg.__wbg_new_8a6f238a6ece86ea@https://play.ty.dev/assets/index-IVeoMaQp.js:64:25613
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[10069]:0x7b45f6
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[3133]:0x61aca6
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[5324]:0x70d654
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[8097]:0x796599
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[6160]:0x73a6bc
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[2274]:0x584a3a
@https://play.ty.dev/assets/ty_wasm_bg-CmMjrFpL.wasm:wasm-function[8024]:0x77f66b
completions@https://play.ty.dev/assets/index-IVeoMaQp.js:64:21219
provideCompletionItems@https://play.ty.dev/assets/Editor-DvbeuRwl.js:1:3621
h/&lt;@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:660:28999
h@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:660:28760
trigger@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:726:8465
_doTriggerQuickSuggest/&lt;@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:726:7331
cancelAndSet/this._token&lt;@https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/editor/editor.main.js:122:15238
</code></pre>
Version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-29 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-29 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-29 13:36</div>
            <div class="timeline-body"><p>cc. @BurntSushi -- this looks like it may be autocompletions-related?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-30 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanielKongsgaard">@DanielKongsgaard</a> on 2025-10-01 21:39</div>
            <div class="timeline-body"><p>I get a similar panic on autocomplete in the beginning of imports. With the beginning I mean that I get it on <code>import pac|</code>, but not on <code>import package.sub|</code> (where <code>|</code> is the cursor). With <code>ty.experimental.autoImport = true</code> I also consistently get the panic in code. Here is my stack trace, though it seems less useful:</p>
<pre><code>2025-10-01 23:30:33.541873000 ERROR An error occurred with request ID 7: request handler panicked at crates/ty_python_semantic/src/module_resolver/list.rs:78:18:
System search path should have a registered rootquery stacktrace:
   0: DatabaseKeyIndex(IngredientIndex(81), Id(20803))
   1: DatabaseKeyIndex(IngredientIndex(79), Id(20400))


Backtrace:    0: __mh_execute_header
   1: __mh_execute_header
   2: __mh_execute_header
   3: __mh_execute_header
   4: __mh_execute_header
   5: __mh_execute_header
   6: __mh_execute_header
   7: __mh_execute_header
   8: __mh_execute_header
   9: __mh_execute_header
  10: __mh_execute_header
  11: __mh_execute_header
  12: __mh_execute_header
  13: __mh_execute_header
  14: __mh_execute_header
  15: __mh_execute_header
  16: __mh_execute_header
  17: __mh_execute_header
  18: __mh_execute_header
  19: __mh_execute_header
  20: __mh_execute_header
  21: __mh_execute_header
  22: __mh_execute_header
  23: __mh_execute_header
  24: __mh_execute_header
  25: __mh_execute_header
  26: __mh_execute_header
  27: __mh_execute_header
  28: __mh_execute_header
  29: __pthread_deallocate
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-10-02 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-10-02 17:55</div>
            <div class="timeline-body"><p>Thanks for the report! This turned out to be a bug in the <code>FileRoots</code> matching when the root is <code>/</code>. I&#x27;m surprised we hadn&#x27;t hit this before or otherwise observed deleterious effects because of it. I put up <a href="https://github.com/astral-sh/ruff/pull/20684">astral-sh/ruff#20684</a> which should fix this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-10-03 12:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:38 UTC
    </footer>
</body>
</html>
