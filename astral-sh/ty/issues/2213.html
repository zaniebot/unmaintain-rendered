<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stricter handling of instance variables - astral-sh/ty #2213</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Stricter handling of instance variables</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2213">#2213</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2025-12-24 23:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-12-24 23:15</div>
            <div class="timeline-body"><h3>Question</h3>
<pre><code class="language-python">class X:
    def __init__(self, foo: int) -&gt; None:
        self.foo = foo

    def whatever(self) -&gt; None:
        self.foo + 1

def main(mfoo: int | None) -&gt; None:
    x = X(5)
    x.foo = mfoo
    w.whatever()
</code></pre>
<p>https://play.ty.dev/32c2417c-5f39-4170-9f72-81efca658ce3</p>
<p>I would like a way to run ty such that it complains about the above program.</p>
<p>All of mypy, pyright, pyrefly complain about this.</p>
<p>(In general, I think many users would consider this to be a fully typed program. If ty is going to have novel interpretations of gradual typing (yay! innovation!), it becomes really important to have documented configurations that users can set which ensures that they don't get bitten, and I don't see one for this)</p>
<p>This has to be a duplicate, but I couldn't find one â€” sorry about that!</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @hauntsaninja on 2025-12-24 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-12-24 23:16</div>
            <div class="timeline-body"><p>The type inlays in the LSP don't even show the Unknown, making this extra pernicious</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-12-24 23:18</div>
            <div class="timeline-body"><p>I guess this is maybe a duplicate of this comment? https://github.com/astral-sh/ty/issues/1240#issuecomment-3322174806</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-25 17:14</div>
            <div class="timeline-body"><p>I assume this is about the widening of <code>foo</code>. There has been some discussion about a strict-mode setting in https://github.com/astral-sh/ty/issues/527, which this relates to .</p>
<p>I'm sure Carl or Alex will give you a more detailed answer once they're back from their PTO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-12-25 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-26 17:58</div>
            <div class="timeline-body"><p>Thanks -- I agree that we should emit a diagnostic on this program. There's two ways that might happen: one is discussed in #1515, which is that we'd have a special case to consider an implicit instance attribute &quot;annotated&quot; if it is directly assigned from an annotated <code>__init__</code> argument. That's sufficient for this example, but it's fairly narrow, and would be easy to construct slightly more complex examples where it would no longer apply -- and then that unexpected &quot;cliff&quot; would also become a foot-gun. The other is #1240, where we plan to add an option to turn off the gradual-guarantee unioning with <code>Unknown</code> entirely; and I think that should probably be the default, at least for CLI use.</p>
<p>I don't think the gradual guarantee is novel (it's the standard definition of gradual typing in the academic literature), but it is novel for Python type checkers. I think it was an interesting and worthwhile experiment, but my interpretation of the results of that experiment at this point is that it doesn't work well for users who want to write typed Python -- it requires too many verbose/redundant annotations in order to get a fully typed program.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-12-26 17:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:51:35 UTC
    </footer>
</body>
</html>
