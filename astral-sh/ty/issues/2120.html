<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Split the `ty_python_semantic` into more crates - astral-sh/ty #2120</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Split the `ty_python_semantic` into more crates</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2120">#2120</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-12-19 20:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-19 20:47</div>
            <div class="timeline-body"><p>The <code>ty_python_semantic</code> crates has become pretty big and slow to compile. Splitting the type inference logic is tricky but we could try:</p>
<ul>
<li>Extract the module resolver into <code>ty_module_resolver</code>:<ul>
<li>Create a new <code>Db</code> in the resolver crate with a <code>search_paths</code> method (to remove the dependency on <code>Program</code>)</li>
<li>Create a new <code>TestDb</code> for the module resolver</li>
<li>Create a <code>SearchPathBuilder</code> to replace <code>Program::from_settings</code>.</li>
<li>I'm sure there are some more wrinkles to it</li>
</ul>
</li>
<li>Extract <code>ty_python_infer</code> for the type inference logic. This seems much trickier. Not sure if it's worth it</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @MichaReiser on 2025-12-19 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-12-21 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-24 13:11</div>
            <div class="timeline-body"><p>Other parts of ty_python_semantic that could make sense to split out are:</p>
<ul>
<li><code>list.rs</code></li>
<li><code>rank.rs</code></li>
<li>(Maybe slightly trickier) <code>site_packages.rs</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-12-24 21:12</div>
            <div class="timeline-body"><p>This is a slightly different idea, but when building ty, if we only want the type checker, maybe we can remove <code>ty_server</code> from the dependencies (dependencies can be toggled using feature flags).
I often rebuild ty after making changes to <code>ty_python_semantic</code> just to observe the change in behavior, and in this case, the language server is not necessary. Even when running ty on CI, there may be times when we do not need the language server's functionality.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-25 07:29</div>
            <div class="timeline-body"><p><img width="2485" height="1576" alt="Image" src="https://github.com/user-attachments/assets/b1917de2-fec8-408a-b13b-9c2eae826c69" /></p>
<p>Looking at the timing report, I'm not sure if splitting out <code>ty_server</code> gives us that much. The dominant time really is <code>ty_python_semantic</code>. I created https://github.com/astral-sh/ty/issues/2199 to analysis why compiling <code>ty_python_semantic</code> takes that long</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:53:03 UTC
    </footer>
</body>
</html>
