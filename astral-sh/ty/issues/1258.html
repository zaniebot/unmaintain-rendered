<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`isinstance` type narrowing should work even when the `isinstance` result is assigned to a variable - astral-sh/ty #1258</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>isinstance</code> type narrowing should work even when the <code>isinstance</code> result is assigned to a variable</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1258">#1258</a>
        opened by <a href="https://github.com/benglewis">@benglewis</a>
        on 2025-09-25 16:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/benglewis">@benglewis</a></div>
            <div class="timeline-body">Summary
<p>Currently the following code does not work to type narrow, but I believe that it should:</p>
<pre><code>def fun(a: str | Path):
  a_is_path = isinstance(a, Path)
  if a_is_path:
     print(a.is_dir())
</code></pre>
<p>(Obviously this isn&#x27;t a good use case to assign a variable, but imagine that there are multiple places where you do that check in multiple very different logic blocks, it would be nice to be able to assign to a variable instead)</p>
Version
<p>ty 0.0.1-alpha.21 (ef52a19 2025-09-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-25 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-25 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/erictraut">@erictraut</a> on 2025-09-25 17:29</div>
            <div class="timeline-body"><p>This feature is typically called <a href="https://microsoft.github.io/pyright/#/type-concepts-advanced?id=aliased-conditional-expression">aliased conditional expressions</a>. I think pyright is currently the only major Python type checker that implements it. I borrowed the concept and the terminology from the TypeScript compiler. It&#x27;s a tricky feature to implement correctly because the type checker needs to prove that the alias variable is not reassigned along any code path and that none of the subexpressions used in the conditional expressions have potentially been changed along any code path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericludvigs">@ericludvigs</a> on 2025-10-06 11:24</div>
            <div class="timeline-body"><p>Seconding wish for this feature, ran into false positive error while adapting <a href="https://github.com/sagasv5-xw/map2map/blob/67a56215cb4c252c769dd84dc0fa5e0abce1c648/map2map/data/fields.py#L93C1-L96C54">this code</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Z post-stable&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-11-15 01:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-11-15 02:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:37 UTC
    </footer>
</body>
</html>
