<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attribute `str | None` not narrowed to `str` after truthiness check - astral-sh/ty #280</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Attribute `str | None` not narrowed to `str` after truthiness check</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/280">#280</a>
        opened by <a href="https://github.com/blueraft">@blueraft</a>
        on 2025-05-08 17:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/blueraft">@blueraft</a> on 2025-05-08 17:29</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Sorry if this is a duplicate!</p>
<p>When an attribute <code>obj.attr</code> of type <code>str | None</code> is used in an if <code>obj.attr</code>: condition, its type is not narrowed to <code>str</code> within the if block (I assume this is true for any type).</p>
<pre><code class="language-py">from typing import reveal_type
from dataclasses import dataclass

@dataclass
class Fruit:
    name: str | None

def some_fn(fruit: Fruit):
    if fruit.name:
        c = fruit.name
        reveal_type(c) # ty: str | None

</code></pre>
<p>https://play.ty.dev/0852e944-7f56-485d-835b-490ff67aeb4e</p>
<p>mypy and pyright both infer this as <code>str</code>.</p>
<p>https://pyright-play.net/?code=GYJw9gtgBALgngBwJYDsDmUkQWEMogCmAboQIYA2A%2BvAoQFCiRQAmZMZAxhWQM6%2BFembLnxsO3Pr3r0AAuK49%2B9SfygAxEAFckMAFz0oRqCjIRCeqLxggoAHygA5MCgb0WhYFciEqwFAAUoDr6Gtq6AJQGxphewboAdKbm0THGnFAAvFDxMElmDGnGRKSUNIiEAZwRQA</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-08 17:50</div>
            <div class="timeline-body"><p>I think this is https://github.com/astral-sh/ty/issues/164</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by @MichaReiser on 2025-05-08 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2025-05-08 17:54</div>
            <div class="timeline-body"><p>Oh yes, I'll close this thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @blueraft on 2025-05-08 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-08 17:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:10:59 UTC
    </footer>
</body>
</html>
