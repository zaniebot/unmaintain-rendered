<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect only `ty:ignore` and ignore `type:ignore` - astral-sh/ty #1422</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Respect only <code>ty:ignore</code> and ignore <code>type:ignore</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1422">#1422</a>
        opened by <a href="https://github.com/nth10sd">@nth10sd</a>
        on 2025-10-23 16:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nth10sd">@nth10sd</a></div>
            <div class="timeline-body">Question
<p>To suppress single-line errors, <code>ty</code> seems to respect both <code># ty: ignore</code> and <code># type: ignore</code>. Can <code>ty</code> be set to only recognize <code># ty: ignore</code>?</p>
<p>This is because <code>mypy</code> <a href="https://github.com/python/mypy/issues/12358">cannot support</a> <code># mypy: ignore</code>, and ideally would like to have both separated.</p>
Version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/nth10sd">@nth10sd</a> on 2025-10-23 16:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-23 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-23 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 15:48</div>
            <div class="timeline-body"><p>I thought we discussed this before but I can&#x27;t find the issue anymore.</p>
<p>An option like this does make sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 15:53</div>
            <div class="timeline-body"><p>Okay, it has come up in <a href="https://github.com/astral-sh/ty/issues/278">astral-sh/ty#278</a> and this will also be relevant for <a href="https://github.com/astral-sh/ty/issues/606">astral-sh/ty#606</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-14 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Respect only ty:ignore and ignore type:ignore&quot; to &quot;Respect only `ty:ignore` and ignore `type:ignore`&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-14 08:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cmp0xff">@cmp0xff</a> on 2025-12-08 11:17</div>
            <div class="timeline-body"><p>Hi, this feature is very helpful for projects where both <code>mypy</code> and <code>ty</code> are used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-19 17:58</div>
            <div class="timeline-body"><p>My current thinking on this is:</p>
<ul>
<li>Add a new <code>analysis.type-ignore</code> that controls whether ty respects <code>type: ignore</code> comments (true) or ignores them (false).</li>
<li>Add a new <code>unused-type-ignore-comment</code> comment rule that&#x27;s off by default</li>
</ul>
<p>Here a few examples of how this would work in combination:</p>
<ul>
<li><code>type-ignore=true</code>: errors can be suppressed with <code>type: ignore</code> and <code>ty: ignore</code><ul>
<li><code>unused-type-ignore-comment=&quot;warn&quot;</code>: ty removes both unused <code>ty: ignore</code> and <code>type: ignore</code> comments.</li>
<li><code>unused-type-ignore-comment=&quot;ignore&quot;</code>: ty removes unused <code>ty: ignore</code> comments but leaves unused <code>type: ignore</code> comments untouched.</li>
</ul>
</li>
<li><code>type-ignore: false</code>: errors can only be suppressed with <code>ty: ignore</code>.<ul>
<li><code>unused-type-ignore-comment=&quot;warn&quot;</code>: ty removes all <code>type: ignore</code> comments. This allows users to deny <code>type: ignore</code> comments in their code base</li>
<li><code>unused-type-ignore-comment=&quot;ignore&quot;</code>: ty leaves <code>type: ignore</code> comments unchanged. Useful when using ty alongside another type checker</li>
</ul>
</li>
</ul>
<p>The one case this combination doesn&#x27;t support are projects that want to exclusively use <code>type: ignore</code> and forbid using <code>ty: ignore</code>. We could support that by replacing the <code>type-ignore</code> option with <code>ignore-style=&quot;ty&quot; | &quot;type&quot; | &quot;both&quot;</code>, assuming we never want to support any other style (<code>noqa</code>?)</p>
<p>A third option is to make the <code>ignore-styles</code> option a list that can be set to <code>[&quot;type&quot;, &quot;ty&quot;]</code> to allow both, or just <code>&quot;type&quot;</code> or <code>&quot;ty&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-19 18:37</div>
            <div class="timeline-body"><p>The <code>analysis.type-ignore</code> setting makes sense to me, although I think the name is too ambiguous; maybe <code>analysis.respect-type-ignore-comments</code>?</p>
<p>I&#x27;m confused about the <code>unused-type-ignore-comment</code> rule. Is this intended to be a new rule, separate from our existing <code>unused-ignore-comment</code>? If so, then a) I don&#x27;t think we need this new rule at all, and b) if we did add it, I don&#x27;t think this rule should ever have any impact on the handling of <code># ty: ignore</code> comments.</p>
<p>I don&#x27;t think that &quot;deny all <code>type: ignore</code> comments in your code base&quot; is a use case that has ever been requested or that we need to support in ty. It&#x27;s not necessary for migrating to ty or using ty alongside another type checker. At best it&#x27;s a trivial ruff lint rule.</p>
<p>I think that if <code>analysis.respect-type-ignore-comments: true</code>, then the behavior should be as it is today, where <code>unused-ignore-comment</code> fires on both unused <code>ty: ignore</code> and unused <code>type: ignore</code> comments. If <code>analysis.respect-type-ignore-comments: false</code>, then ty should never consider <code>type: ignore</code> comments at all -- it should be as if they were any other normal comment, with no special meaning. I think that option is sufficient to meet the actual user needs that have been expressed so far, and we should avoid adding more complexity to meet hypothetical use cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-19 19:13</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m confused about the unused-type-ignore-comment rule. Is this intended to be a new rule, separate from our existing unused-ignore-comment? If so, then a) I don&#x27;t think we need this new rule at all, and b) if we did add it, I don&#x27;t think this rule should ever have any impact on the handling of # ty: ignore comments.</p>
</blockquote>
<p>Yes it would be a new rule. No, it doesn&#x27;t change how we handle <code>ty: ignore</code>. Not sure what I wrote that gave that impression. You&#x27;d have to enable <code>unused-ignore-comment</code> for the <code>ty: ignore</code> comments to be removed but i omitted this above because I assumed that was clear, sorry if that caused the confusion.</p>
<p>The issue I see with only having a single <code>respect-type-ignore-comment</code> is the case where you want to use <code>type: ignore</code> to suppress errors common to multiple type checkers but you want to remove unused <code>ty: ignore</code> comment (but leave <code>type: ignore</code> alone because you might use it to suppress both a mypy and pyright error)</p>
<p>Also, you suggested separate rules in <a href="https://github.com/astral-sh/ty/issues/278">astral-sh/ty#278</a>#issuecomment-2863650989 ðŸ˜…</p>
<p>But I&#x27;m open to give it a try. Splitting out a new rule is easy</p>
<p>Note for myself: Pyright&#x27;s setting name is <code>enableTypeIgnoreComments</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-20 03:03</div>
            <div class="timeline-body"><blockquote>
<p>No, it doesn&#x27;t change how we handle <code>ty: ignore</code>. Not sure what I wrote that gave that impression.</p>
</blockquote>
<p>The part that gave me this impression was</p>
<blockquote>
<p>unused-type-ignore-comment=&quot;warn&quot;: ty removes both unused ty: ignore and type: ignore comments.</p>
</blockquote>
<p>contrasted with</p>
<blockquote>
<p>unused-type-ignore-comment=&quot;warn&quot;: ty removes all type: ignore comments.</p>
</blockquote>
<p>But I think I misunderstood this. I think there&#x27;s an implicit assumption that <code>unused-ignore-comment</code> rule is also enabled, and I think unused <code>ty: ignore</code> would be removed in both cases, that&#x27;s just not mentioned in the second case. With that understanding, the proposal definitely makes more sense to me.</p>
<blockquote>
<p>Also, you suggested separate rules in <a href="https://github.com/astral-sh/ty/issues/278#issuecomment-2863650989">#278 (comment)</a> ðŸ˜…</p>
</blockquote>
<p>Haha, so I did! And I even said &quot;and/or&quot; there.</p>
<p>The problem with <em>just</em> doing separate rules is that it doesn&#x27;t give you any way to say &quot;I don&#x27;t even want <code>type: ignore</code> to suppress ty diagnostics, that&#x27;s just for mypy&quot;. Given that we can&#x27;t parse rule codes with <code>type: ignore</code> comments, I think it&#x27;s important to be able to have ty totally ignore them.</p>
<p>So if we are just doing one, it should be the config option.</p>
<blockquote>
<p>The issue I see with only having a single <code>respect-type-ignore-comment</code> is the case where you want to use <code>type: ignore</code> to suppress errors common to multiple type checkers but you want to remove unused <code>ty: ignore</code> comment (but leave <code>type: ignore</code> alone because you might use it to suppress both a mypy and pyright error)</p>
</blockquote>
<p>Yes, that&#x27;s a more convincing use case. The alternative for this would be to just turn off <code>respect-type-ignore-comment</code> and then use <code># type: ignore # ty: ignore</code> on lines where you want to ignore an issue both type checkers agree on, but that could be kind of irritating if there are a lot of shared issues. (Though I still think that personally I would prefer this double-ignore-comment strategy, since it allows ensuring that <em>all</em> ignores use a rule code.)</p>
<p>Ok, I&#x27;m convinced! I think it makes sense to do both.</p>
<p>But I&#x27;m still not convinced by</p>
<blockquote>
<p><code>type-ignore: false</code>: errors can only be suppressed with <code>ty: ignore</code>.</p>
<pre><code>* `unused-type-ignore-comment=&quot;warn&quot;`: ty removes all `type: ignore` comments. This allows users to deny `type: ignore` comments in their code base</code></pre>
</blockquote>
<p>If I&#x27;ve said <code>respect-type-ignore-comments: false</code>, I would expect that to mean ty doesn&#x27;t do anything at all with <code># type: ignore</code> comments -- they might as well be &quot;# foobar&quot; comments. So I think <code>unused-type-ignore-comment</code> rule should just be a no-op in this case. If ty is not respecting <code># type: ignore</code> comments, then it can&#x27;t decide whether they are unused or not, and it should never remove them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-20 10:02</div>
            <div class="timeline-body"><p>Let&#x27;s start with the option, and split the rule based on user feedback.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-20 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-20 18:35</div>
            <div class="timeline-body"><p>I started to work on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-23 07:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:49 UTC
    </footer>
</body>
</html>
