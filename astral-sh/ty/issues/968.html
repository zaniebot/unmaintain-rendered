<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Low CPU saturation - astral-sh/ty #968</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Low CPU saturation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/968">#968</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-08-11 09:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>I noticed that running ty on a large project overall shows low CPU saturation (specifically the longer checking runs)</p>
<p>https://github.com/user-attachments/assets/3efc9db9-51e6-4a80-af0f-16465b98d1ef</p>
<p>I did record a CPU profile and one thing that stands out is that we spend a lot of time in salsa&#x27;s <code>intern_id</code> for <code>CallableType</code></p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/8a13c057-f8e9-44a9-baaf-8a2d7b7afb62"></p>
<p>(<a href="https://share.firefox.dev/3J7UomG">full profile</a>)</p>
<p>and</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/aa4c00c7-fa27-4a40-8ece-0c2590044acd"></p>
<p>All call sites come from <code>ReachabilityConstraints::evaluate</code>.</p>
<p>Ideally, we&#x27;d reduce the cost of interning in salsa. If that doesn&#x27;t work, we may want to take a look if we can reduce the number of callable types that we construct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-11 09:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-11 19:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:14 UTC
    </footer>
</body>
</html>
