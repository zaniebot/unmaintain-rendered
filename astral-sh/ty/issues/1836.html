<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconsider imports as type declarations - astral-sh/ty #1836</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reconsider imports as type declarations</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1836">#1836</a>
        opened by <a href="https://github.com/zsol">@zsol</a>
        on 2025-12-10 10:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zsol">@zsol</a></div>
            <div class="timeline-body">Summary
<p>When a <code>with</code> statement binds to a name that has already been declared, an <code>invalid-assignment</code> error is raised (as expected?), but future references to the name are associated with the declared type, not the type that the context manager yields.</p>
<p>A simple repro: https://play.ty.dev/6a08fc89-50e6-4de9-bd6d-b9f9e52412dd</p>
Version
<p>0.0.1-alpha.27</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-10 17:51</div>
            <div class="timeline-body"><p>Hmm, I think our choice to privilege already-declared types over invalid assignments matches all existing type checkers (<a href="https://pyright-play.net/?code=B4LgBAzgLgTgsAKGGAvGAjImBTAbtgQwBsB9KATwAdsAKYASiA">pyright</a>, <a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=49aea6c60cb5a0f4616c8905e3d1cbcd">mypy</a>, <a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeSI%2BiABHAC4BOAOuvtQLzUCMLDMAbjFRQA%2BnVLEYACnwBKFiAA0IAK51ocEuUQgAxNQCq6qBHHUwK9AGN1udHBYtMMMOdwMAtqjoj0Kj9gwDDI0EOh0stQAtAB8tIyILNTJ1Hx0Kgzo5kwgAHL%2BgQw0wPgAvjkKymR8YFCkhHS4HlAU%2BgAKpDV1tBg4BNRWdpAA5hneEHaELPoAyjAw1AAWdHTEcIgA9BvVLnWE7sMbMOgbmLhWcBuD6CNjtiduDNSo-KjQqNiwA0MQowzjdmouGI900LDIdEWdiiggYcAmWU4OQAzIQuAAmCroEClZSoGwQQQAMWgMAoaCweCIZBxQA">pyrefly</a>), including in the case of a context manager specifically (<a href="https://pyright-play.net/?code=B4LgBAzgLgTmC8YBEAzA9mpBYAULgxgDYCGEEYAwlKLmHWACYCmKYA%2Bm0wHZRMwcAKCE0IoAlGAC0APjABLHiFr0VMJlACuMLmACMyus1YcmwOVEHDRAGjAAqYjADmEW3bsBrAO6OXEmWAARhiESjgqqupaOgAqMBpMuLhe5gAWlNQCEqRgNOH0agBuTMSEbFAAngAOTALAYkA">pyright</a>, <a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=734a49f521469f8c8f39472ffa26aed3">mypy</a>, <a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeSI%2BiABHAC4BO1AvNQDri64dvq8DGUVHDjUAwnSq9qM6phhhqAfSUx0dGAxUAKODChgAlNQC0APmoR1iabLsMYdAK4N01AIy2Z8xSpj4IOh09AwAaagAqVAYAczhwiIiAawB3aLjjc2o8XCgbNztZB2dXagAVBicYXl4UwIALcUltY2FqKQKZBwA3GFQoJTpSYhhtfENeEFCQJzpoOBJyRBAAYmoAVTmoQNJqMCd0fjncdDgarAU93AYAW1Qg9Ccb7E0xmis6TIt6Bnz7RxcbjAHAAck8Xr9qMB8ABfHjoKYgMgOMBQUiEOi4G5QChrAAKpBRaNoGBwBGo-BOkBiLnuEBOhF4awAyjAYNR6nQ6MQ4IgAPR85EKNGEa4xPlqPmYXD8OB8ynoam047oPlXJiobqoaCobCwClUiA0hh0k7UXDEFULXhkOj1E4mXoMOD0tysDgAZkI7gATPCQDDpqgjhBegAxaAwChoLB4IhkANAA">pyrefly</a>).</p>
<p>What we probably do differently, that caused us to behave differently in your example, is specifically that we consider an import to &quot;declare&quot; a type; I think other type checkers don&#x27;t do that. So if anything, that might be the thing we want to re-evaluate.</p>
<p>I think this is a questionable decision on our part -- an import is not really a declaration. I think we did it to solve some issues with re-exports, but we could check what the impact would be of reversing that decision.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Name shadowing due to context manager assignment misbehaves&quot; to &quot;Reconsider imports as type declarations?&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-12-10 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-12-10 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Reconsider imports as type declarations?&quot; to &quot;Reconsider imports as type declarations&quot; by <a href="https://github.com/carljm">@carljm</a> on 2026-01-04 20:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:21 UTC
    </footer>
</body>
</html>
