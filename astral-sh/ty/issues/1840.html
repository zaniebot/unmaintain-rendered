<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return value of generic data descriptors not infered correctly - astral-sh/ty #1840</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Return value of generic data descriptors not infered correctly</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1840">#1840</a>
        opened by <a href="https://github.com/mflova">@mflova</a>
        on 2025-12-10 12:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mflova">@mflova</a> on 2025-12-10 12:28</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Ther eturn value of <code>__get__</code> method is not infered properly for the following case. Mypy and pyright label them correct. I could not find this issue reported, but maybe is related to the incoming improvements for type variable inference for generic classes.</p>
<p>Here is a quick example:</p>
<pre><code class="language-py">from collections.abc import Callable
from typing import Any, Generic, TypeVar

from typing_extensions import reveal_type

Value_co = TypeVar(&quot;Value_co&quot;, covariant=True)


class classproperty(Generic[Value_co]):  # noqa: N801
    def __init__(self, method: Callable[[Any], Value_co]) -&gt; None:
        ...

    def __get__(self, instance: Any | None, owner: type[Any]) -&gt; Value_co:
        ...


class MyClass:
    @classproperty
    def my_class_property(cls) -&gt; str:
        return &quot;Hello, World!&quot;

reveal_type(MyClass.my_class_property)  # Expected: str, got: Unknown
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.33 (35e23aa48 2025-12-09)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-10 13:20</div>
            <div class="timeline-body"><p>Thank you for reporting this.</p>
<p>We do not support <code>Callable</code> in the generics solver yet, but will be doing so soon (https://github.com/astral-sh/ruff/pull/21551).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by @sharkdp on 2025-12-10 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-10 16:47</div>
            <div class="timeline-body"><p>I checked and this example is not fixed by https://github.com/astral-sh/ruff/pull/21551, so there is something else to explore here once that lands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-10 16:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:52 UTC
    </footer>
</body>
</html>
