```yaml
number: 2412
title: Site-packages not found in system environment
type: issue
state: closed
author: sillydan1
labels:
  - imports
assignees: []
created_at: 2026-01-09T10:44:18Z
updated_at: 2026-01-09T19:37:58Z
url: https://github.com/astral-sh/ty/issues/2412
synced_at: 2026-01-10T01:56:41Z
```

# Site-packages not found in system environment

---

_Issue opened by @sillydan1 on 2026-01-09 10:44_

### Summary

# Site-packages not found in system environment




I'm using `ty` on Ubuntu, where I want to use the system installation of python (`/usr/bin/python3`), but I get an
error whenever I am explicitly using it.



This error propogates all the way through to vscode - the server seems to function afterwards, but the error on
startup is a bit annoying.



Relevant Issues:
- [https://github.com/astral-sh/ty/issues/1323](https://github.com/astral-sh/ty/issues/1323) looks like might be a downstream symptom of this.




## Reproduction Steps




In a clean ubuntu docker `docker run --rm -it ubuntu`:



```bash
# Install ty
apt update ; apt install curl python3
curl -LsSf https://astral.sh/uv/install.sh | sh
source $HOME/.local/bin/env

# Create a test file
echo "" > test.py

# Run ty using the system python3 install
uvx ty check test.py --python /usr/bin/python3

```



This results in the following error:



```txt
ty failed
  Cause: Failed to discover the site-packages directory
  Cause: Invalid `--python` argument `/usr`: Could not find a `site-packages` directory for this Python installation/executable

```



**interestingly** this error only occurs if `--python` is provided - I haven't been able to decern which interpreter is being used if not provided (`-vvv` does not reveal this information - **perhaps it should?**).



Please note that this is **NOT** an issue in some other distros. I've tested using the following container  mages and the same reproduction steps:
- `alpine:latest` (using `apk` instead of `apt` of course)
- `archlinux:latest`  (using `pacman` instead of `apt` of course)



It seems that this is a uniquely debian (and debian-derivative) issue. Those distros are also weird about their python3 installation methods, so that makes sense.



It looks like [site_packages.rs](https://github.com/astral-sh/ruff/blob/ba5dd5837cd7a1446c076f9032e13308d6317319/crates/ty_python_semantic/src/site_packages.rs#L1155) is only looking at `sys.prefix / lib` for `site-packages`, whereas on debian-derivative platforms it's located in `sys.prefix / local / lib` instead.



I would suggest a patch where `local` is optionally traversed during the site packages search. I might give it a try myself, but my rust is very... rusty... So I'm not confident that I'll be able to get it done properly.


### Version

0.0.10

---

_Label `imports` added by @AlexWaygood on 2026-01-09 10:54_

---

_Comment by @MichaReiser on 2026-01-09 10:56_

This sounds very similar to https://github.com/astral-sh/ty/issues/1323

You could give https://github.com/astral-sh/ruff/pull/22466 a try. Unfortunately, this requires building ty from source. 

---

_Comment by @sillydan1 on 2026-01-09 12:43_

> This sounds very similar to [#1323](https://github.com/astral-sh/ty/issues/1323)
> 
> You could give [astral-sh/ruff#22466](https://github.com/astral-sh/ruff/pull/22466) a try. Unfortunately, this requires building ty from source.

That does seem to fix the issue yes. I'll do a follow on that PR and keep an eye out üòÑ Feel free to close this issue if you want üëç 

---

_Comment by @carljm on 2026-01-09 19:37_

Yes, I think this is a duplicate of #1323. I believe the real issue here is `site-packages` vs `dist-packages`, and the discussion of `local/` is a red herring. For a system install in `/usr/local`, `sys.prefix` is `/usr/local`, not `/usr`; the layout within the prefix is not modified. I think this is confirmed by the fact that https://github.com/astral-sh/ruff/pull/22466 fixes the problem, since that PR only adds `dist-packages/` support, it doesn't do anything involving `local/` directories.

Thanks for the report, and for trying out the PR!

---

_Closed by @carljm on 2026-01-09 19:37_

---
