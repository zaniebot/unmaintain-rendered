<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve error messages when narrowing fails - astral-sh/ty #2221</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve error messages when narrowing fails</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2221">#2221</a>
        opened by <a href="https://github.com/mtshiba">@mtshiba</a>
        on 2025-12-25 16:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mtshiba">@mtshiba</a></div>
            <div class="timeline-body"><p>When strictly maintaining soundness, narrowing tends to produce results that are quite different from user intuition.
Users may not realize that this is due to the specifications of ty (or Python type system), and may consider it an incompleteness or a bug (e.g. <a href="https://github.com/astral-sh/ty/issues/2215">astral-sh/ty#2215</a>).
Therefore, if the cause of the error is thought to be a narrowing failure, it may be better to provide a hint as to why narrowing could not be applied.
Also, in some cases, alternatives can be suggested that make narrowing applicable (such as using <code>is</code> instead of <code>==</code>, typing explicitly, or marking the class as non-inheritable with <code>typing.final</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-12-25 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-12-25 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-26 18:04</div>
            <div class="timeline-body"><p>See <a href="https://github.com/astral-sh/ty/issues/1578">astral-sh/ty#1578</a>#issuecomment-3542936632 for one concrete idea, that I think could also apply to the case in #2215.</p>
<p>This issue as described seems very broad -- I think we should focus on cases where ty introduces an <code>object</code> type due the possibility of subclassing. Current cases of this that come to mind include <code>hasattr</code> narrowing and top materializations when <code>isinstance</code> narrowing with a generic type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 03:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:46 UTC
    </footer>
</body>
</html>
