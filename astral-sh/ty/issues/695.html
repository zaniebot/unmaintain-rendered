<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>match case with wrong attribute type incorrectly matches - astral-sh/ty #695</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>match case with wrong attribute type incorrectly matches</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/695">#695</a>
        opened by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a>
        on 2025-06-24 13:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JelleZijlstra">@JelleZijlstra</a></div>
            <div class="timeline-body">Summary
<p>Example:</p>
<pre><code>from typing import assert_never

class X:
    a: int

def f(x: X) -&gt; int:
    match x:
        case X(a=str() as a):
            return a
        case _:
            assert_never(x)
</code></pre>
<p>ty accepts this program without errors; mypy and pyright notice that the first case can never match, and therefore error on the <code>assert_never()</code> call. (Pyright additionally emits a diagnostic saying that the case can never match; this is nice but not essential.)</p>
<p>There seem to be some Todo types involves so you may already know about this, but I didn&#x27;t find any similar issues in the tracker.</p>
Version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-24 13:12</div>
            <div class="timeline-body"><p>Thank you for reporting this. I don&#x27;t think we have an issue that tracks this already.</p>
<blockquote>
<p>There seem to be some Todo types</p>
</blockquote>
<p>Yes, this seems to be the TODO here:</p>
<p>https://github.com/astral-sh/ruff/blob/fd2cc37f9055196ef8bd8b573d450fbfa1bd6390/crates/ty_python_semantic/src/types/infer.rs#L3067</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-24 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-06-24 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-07-24 21:56</div>
            <div class="timeline-body"><p>It looks like this was fixed by @sharkdp &#x27;s recent fixes to match patterns: https://play.ty.dev/ae08c5da-3e02-4f93-a8f0-afeca6a3f347</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-07-24 21:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-25 07:13</div>
            <div class="timeline-body"><p>That <code>@Todo</code> type can still be observed, though. I opened a new ticket to track pattern matching features that we don&#x27;t implement yet: <a href="https://github.com/astral-sh/ty/issues/887">astral-sh/ty#887</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:55 UTC
    </footer>
</body>
</html>
