<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document public parts of ty_extensions API - astral-sh/ty #223</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Document public parts of ty_extensions API</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/223">#223</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-01-08 14:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-01-08 14:09</div>
            <div class="timeline-body"><p>Quoting some comments that were spread over multiple threads in <a href="https://github.com/astral-sh/ruff/pull/15103">this PR</a>:</p>
<p>@MichaReiser</p>
<blockquote>
<p>What are your thoughts on whether we should gate this behind a feature or make it testing only?</p>
</blockquote>
<p>@sharkdp</p>
<blockquote>
<p>Seeing that mypy and pyre have similar public APIs, I could imagine (part of) this becoming a public API for red knot that isn't feature-gated? The <code>Intersection</code>/<code>Not</code> constructors and <code>static_assert</code> are potentially interesting for users which don't care too much about compatibility with other type checkers (cf https://github.com/python/typing/issues/213). Some less-interesting parts like <code>is_singleton</code> could also be moved to <code>knot_extensions.internal</code> maybe?</p>
</blockquote>
<blockquote>
<p>Do we need to decide this right away? If not, can this stay public for now, or should we approach it very carefully and hide everything (by default)?</p>
</blockquote>
<p>@MichaReiser</p>
<blockquote>
<p>I'm generally leaning toward keeping the API intentionally limited and only expose features that we want to support long term (and consider part of the public API) because users will using them and it's very easy that we forget to revisit this decision before the release (unless we note it down somewhere?)</p>
</blockquote>
<p>@carljm</p>
<blockquote>
<p>For what it's worth, there's nothing in the API added in this PR that I have reservations about supporting long-term as public API, in principle. Of course it's always possible that we realize we made mistakes in details of how we defined or named the API, and we want to change these things in future and potentially have to take backward-compatibility into account with those changes. But this is inevitable.</p>
</blockquote>
<p>And another comment by @carljm regarding how this could be implemented technically:</p>
<blockquote>
<p>I think whatever feature gating we do should probably not happen at the Rust implementation level (that is, trying to turn off or on certain Rust code paths in type inference), but rather at the Python level; that is, in the type stub for the knot_extensions module. This could mean only conditionally including the type stub for knot_extensions at all, or having some conditional definitions of things in the type stub. If you can't import the known-function and known-instance types that make up the type API, then it doesn't matter whether the code paths exist for those; you won't be able to enter those code paths anyway.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-14 18:28</div>
            <div class="timeline-body"><p>I wonder if one way of doing this would just be to issue a diagnostic whenever we see an import from <code>knot_extensions</code> in code that we're checking (which warns you that it's (a) experimental and (b) doesn't exist at runtime), but have that diagnostic switched off by default in the context of our test suite?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-01-14 21:09</div>
            <div class="timeline-body"><p>I like that! I guess the only downside I can think of right now is that we might want to deprecate that lint rule eventually <em>if</em> we ever want to &quot;stabilize&quot; <code>knot_extensions</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-14 21:35</div>
            <div class="timeline-body"><p>Would this be a regular lint that you can disable? If so, what category would it belong to long term?</p>
<p>I think it should not be a regular rule. We don't want it to show up in configurations etc. While I designed for this possibility, not everything is there yet to actually support this distinction.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-01-14 21:36</div>
            <div class="timeline-body"><p>I'm not sure we need to do anything at all about this issue; I don't think it's a priority to spend time on it right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Hide parts of the `knot_extensions` API?" to "Hide parts of the `knot_extensions` API?" by @MichaReiser on 2025-05-07 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @AlexWaygood on 2025-05-11 10:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Hide parts of the `knot_extensions` API?" to "Hide parts of the `ty_extensions` API?" by @MichaReiser on 2025-08-15 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-11-13 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 09:36</div>
            <div class="timeline-body"><p>I wonder if we should close this. To me, they very much feel like public API at this point, given that we sometimes even suggest them in issue responses (e.g. <code>Intersection)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-09 10:26</div>
            <div class="timeline-body"><p>Several of them really are just intended for internal mdtest use, though; we <em>should</em> probably move them to a private submodule</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-09 20:09</div>
            <div class="timeline-body"><p>I'm curious specifically which ones you'd move. Even the stuff we mostly use in mdtests (<code>assert_subtype_of</code> etc) I can see interested users finding a use for. Even so I guess it wouldn't hurt to mark them as private -- motivated users could use them anyway.</p>
<p>I guess the highest-value ones to move are ones we might change significantly. E.g. the constraint-set ones changed several times already, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-09 20:16</div>
            <div class="timeline-body"><p>yeah... I think it's just a big backwards-compatibility burden to say that they're all totally frozen now in terms of their APIs? Things like <code>Intersection</code> and <code>Not</code> are obviously useful and are obviously not going to have their APIs changed, but I don't really want to tie our hands for something like <code>ty_extensions.reveal_protocol_interface</code>. I'd like to be able to continue to freely change the output/expected parameters of that in the future -- it would just be nice to make it clear that there are no backwards-compatibility guarantees for the more internal things like that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 21:30</div>
            <div class="timeline-body"><p>To me that sounds more like we should establish which API we consider to be public. For now, I wouldn't consider any API in ty_extensions to fall under our versioning policy.</p>
<p>So I think what this issue now really is about is documenting which parts are official and versioned rather than necessary hiding any of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Hide parts of the `ty_extensions` API?" to "Document public parts of ty_extensions API" by @carljm on 2026-01-09 22:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @carljm on 2026-01-09 22:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:47:12 UTC
    </footer>
</body>
</html>
