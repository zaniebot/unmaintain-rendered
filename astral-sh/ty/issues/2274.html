<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>os.environ.get() accepts `default` as keyword argument, but ty reports no-matching-overload - astral-sh/ty #2274</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>os.environ.get() accepts `default` as keyword argument, but ty reports no-matching-overload</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2274">#2274</a>
        opened by <a href="https://github.com/adamtheturtle">@adamtheturtle</a>
        on 2025-12-30 10:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2025-12-30 10:54</div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code class="language-python">import os

os.environ.get(&quot;FOO&quot;, default=&quot;BAR&quot;)
</code></pre>
<p>This code works but <code>ty</code> errors.
<code>mypy</code> and <code>pyright</code> pass.</p>
<h3>Version</h3>
<p>ty 0.0.8 (aa7559db8 2025-12-29)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2025-12-30 10:56</div>
            <div class="timeline-body"><p>Perhaps related: https://github.com/python/cpython/issues/124675#issuecomment-2560672965 - <code>dict</code> is not strictly a <code>Mapping</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-30 11:10</div>
            <div class="timeline-body"><p>I suspect this is https://github.com/astral-sh/ty/issues/1714, given that <code>Mapping</code> is a <code>Protocol</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-30 13:28</div>
            <div class="timeline-body"><blockquote>
<p>I suspect this is <a href="https://github.com/astral-sh/ty/issues/1714">#1714</a>, given that <code>Mapping</code> is a <code>Protocol</code>.</p>
</blockquote>
<p>No, I don't think #1714 is related here. <code>Mapping</code> is not a protocol, and ty doesn't think it is either:</p>
<pre><code class="language-py">from typing import Mapping, is_protocol, reveal_type

reveal_type(is_protocol(Mapping))  # Literal[False]
</code></pre>
<p><code>Mapping</code> is an ABC, rather than a protocol. And even if it were a protocol, #1714 only concerns types that <em>implicitly</em> subtype protocols -- <code>os._Environ</code> <a href="https://github.com/astral-sh/ruff/blob/0edd97dd41bd0529f439a38d41831fa68866d201/crates/ty_vendored/vendor/typeshed/stdlib/os/__init__.pyi#L723"><em>explicitly</em> inherits</a> from <code>MutableMapping[AnyStr, AnyStr]</code> in typeshed, and <code>MutableMapping</code> in turn <a href="https://github.com/astral-sh/ruff/blob/0edd97dd41bd0529f439a38d41831fa68866d201/crates/ty_vendored/vendor/typeshed/stdlib/typing.pyi#L1285">explicitly inherits</a> from <code>Mapping</code>.</p>
<p>I'm not sure exactly what the issue is here, but I suspect it's some strangeness to do with constrained TypeVars.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">generics</span> added by @AlexWaygood on 2025-12-30 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-12-30 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on 2025-12-30 17:00</div>
            <div class="timeline-body"><p>I think this is just typeshed being incorrect. Mypy also fails (https://mypy-play.net/?mypy=master&amp;python=3.12&amp;gist=49d939f7441874364a23bb2e937d4032) if you run it towards the master branch that has the latest typeshed stubs.</p>
<p>https://github.com/python/typeshed/pull/15085 changed the default parameter of<code>Mapping.get</code> to be positional-only and did not make any changes to <code>os._Environ</code> to accept default as a keyword.</p>
<p>Edit: opened up a typeshed issue for it: https://github.com/python/typeshed/issues/15193</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-30 22:15</div>
            <div class="timeline-body"><p>Will leave this open so we remember to validate the fix when an updated typeshed arrives, but it seems like the fix is only in typeshed. Thanks @RasmusNygren!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-30 22:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-01 01:30</div>
            <div class="timeline-body"><p>I confirmed that this was fixed by https://github.com/astral-sh/ruff/pull/22321.</p>
<p>Thanks again for the report @adamtheturtle, and thanks for the typeshed fix @RasmusNygren!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2026-01-01 01:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2026-01-02 07:36</div>
            <div class="timeline-body"><p>Thanks folks for digging and fixing!</p>
<p>I hit this because I (built and) use <a href="https://github.com/adamtheturtle/mypy-strict-kwargs">mypy-strict-kwargs</a> - a <code>mypy</code> plugin to enforce using keyword arguments where possible. That's one use of the mypy plugin system that I don't think is ever going to be possible with public plans for ty (which I understand to be &quot;no plugins, but support the ecosystem so that plugins aren't necessary&quot;).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:51:35 UTC
    </footer>
</body>
</html>
