<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive &quot;invalid base for `typing.NewType`&quot; with `float` - astral-sh/ty #1818</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive &quot;invalid base for <code>typing.NewType</code>&quot; with <code>float</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1818">#1818</a>
        opened by <a href="https://github.com/LeeeeT">@LeeeeT</a>
        on 2025-12-09 02:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LeeeeT">@LeeeeT</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code class="language-python">from typing import NewType

MyFloat = NewType('MyFloat', float)
</code></pre>
<pre><code>error[invalid-newtype]: invalid base for `typing.NewType`
 --&gt; file.py:3:30
  |
1 | from typing import NewType
2 |
3 | MyFloat = NewType('MyFloat', float)
  |                              ^^^^^ type `int | float`
  |
info: The base of a `NewType` must be a class type or another `NewType`.
info: rule `invalid-newtype` is enabled by default
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.32 (84a188116 2025-12-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2025-12-09 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @oconnor663 by @carljm on 2025-12-09 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Beta" by @carljm on 2025-12-09 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-09 02:29</div>
            <div class="timeline-body"><p>@oconnor663 can you look into this? I think <code>NewType</code> will need special handling for <code>float</code> and <code>complex</code>. This should work:</p>
<pre><code class="language-py">from typing import NewType

MyFloat = NewType('MyFloat', float)

def f(x: MyFloat):
    ...

f(MyFloat(1))
f(MyFloat(1.0))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-09 07:27</div>
            <div class="timeline-body"><p>Do we need the same special casing in other places like base classes etc too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-09 08:10</div>
            <div class="timeline-body"><blockquote>
<p>Do we need the same special casing in other places like base classes etc too?</p>
</blockquote>
<p>I don't think so â€” class bases are parsed as value expressions. The reason why we infer a union here is because the second argument to NewType is parsed as a type expression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-09 08:13</div>
            <div class="timeline-body"><p>ah right, I always forget this distinction.</p>
<p>We have this crime in <code>ty_ide</code>. I hope there's a better way to handle <code>float</code> in <code>NewType</code> inference</p>
<p>https://github.com/astral-sh/ruff/blob/646ad154c37fbec184805b9b36626b7e8782a16c/crates/ty_python_semantic/src/types/ide_support.rs#L154-L178</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @oconnor663 on 2025-12-12 00:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:14 UTC
    </footer>
</body>
</html>
