<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot resolve imported module `conftest` in `tests` - astral-sh/ty #414</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot resolve imported module <code>conftest</code> in <code>tests</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/414">#414</a>
        opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a>
        on 2025-05-15 22:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-05-15 22:06</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm maybe not sure how to best class this error, but when using pytest its obviously quite common to import from conftest.py in a test file, in the root or any subdirectory directory of the <em>tests</em> directory.</p>
<p>in a test file like <code>tests/test_foo.py</code></p>
<pre><code class="language-py">from conftest import ... # error[unresolved-import]: Cannot resolve imported module `conftest`
</code></pre>
<p>we see this error.</p>
<p>I am aware that this code (and practice) is not ideal. But i imagine many users may have this issue when type checking tests directory.</p>
<p>Also, perhaps this is not a bug, but I think something useful to think about</p>
<h3>Version</h3>
<p>0.0.0-alpha.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Cannot resolve imported module `conftest`" to "Cannot resolve imported module `conftest` in `tests`" by @MatthewMckee4 on 2025-05-15 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2025-05-15 22:59</div>
            <div class="timeline-body"><p>Does the error go away if you add <code>__init__.py</code> file to your <code>tests/</code> directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by @AlexWaygood on 2025-05-16 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-16 02:17</div>
            <div class="timeline-body"><p>Where is the <code>conftest.py</code> file that you are trying to import from? Can you show a full example with all the relevant files to reproduce the issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @AlexWaygood on 2025-05-16 02:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewMckee4">@MatthewMckee4</a> on 2025-05-16 11:54</div>
            <div class="timeline-body"><p>I am aware that this isn't the best practice, and also maybe not very common</p>
<pre><code class="language-bash">mkdir /tmp/repro
cd /tmp/repro 
mkdir tests
echo &quot;import pytest

class Helper:
    def __call__(self) -&gt; int:
        return 1

@pytest.fixture
def helper() -&gt; Helper:
    return Helper()
&quot; &gt; tests/conftest.py
echo &quot;from conftest import Helper

def test_ex(helper: Helper):
    assert helper() &gt; 0
&quot; &gt; tests/test_ex.py
uv venv
uv pip install pytest ty
pytest
uv run ty check tests
</code></pre>
<p>Adding this makes ty and pytest both fail</p>
<pre><code class="language-bash">touch tests/__init__.py
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kuyugama">@kuyugama</a> on 2025-05-16 12:07</div>
            <div class="timeline-body"><p>Pytest adds directory with tests to sys.path. So all contents of the &quot;tests&quot;(in your case) can be imported without mentioning it. I don't know if <code>ty</code> aware of such case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-16 12:10</div>
            <div class="timeline-body"><p>I suspect that if you check your tests separately, from the <code>tests/</code> directory (or using <code>--project tests/</code>), this will work fine. (Well, except that then ty won't be able to find your non-test code!)</p>
<p>I'm not sure if we want to add a special case for pytest, but if we implement #179 I think it would just be a matter of adding <code>tests/</code> to <code>src.root</code> in your config.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-16 12:12</div>
            <div class="timeline-body"><p>Oh, <code>--extra-search-path tests/</code> is probably another option that can work here right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-16 13:38</div>
            <div class="timeline-body"><p>Possibly we could consider having the <code>src.root</code> setting default to <code>[&quot;.&quot;, &quot;src/&quot;, &quot;tests/&quot;]</code> instead of just <code>[&quot;.&quot;, &quot;src/&quot;]</code>? The &quot;src/&quot; directory is &quot;just&quot; a convention, after all; it's not something mandated by the language that all Python source code needs to be in an <code>src/</code> directory. (It's pretty different to e.g. Rust in that way.) It seems plausible that there are nearly as many people using pytest and putting all their tests in <code>tests/</code> as there are people using the <code>src/</code> layout?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @AlexWaygood on 2025-05-18 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @AlexWaygood on 2025-05-19 16:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-05-22 03:21</div>
            <div class="timeline-body"><p>I think we could add <code>tests/</code> to the default roots if it exists and if <code>tests/__init__.py</code> doesn't exist.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-26 08:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:39:38 UTC
    </footer>
</body>
</html>
