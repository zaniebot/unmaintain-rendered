<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>support TypedDict (and Required, NotRequired, ReadOnly) - astral-sh/ty #154</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>support TypedDict (and Required, NotRequired, ReadOnly)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/154">#154</a>
        opened by <a href="https://github.com/carljm">@carljm</a>
        on 2025-03-26 18:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/carljm">@carljm</a></div>
            <div class="timeline-body"><ul>
<li>[x] Introduce a new <code>Type</code> variant, basic support for class-based <code>TypedDict</code> syntax<ul>
<li>[x] Parse a <code>TypedDict</code> specification from the class body</li>
<li>[x] Implement / test assignability to <code>Mapping[str, object]</code></li>
<li>[x] Make sure that <code>TypedDict</code>-based objects do not behave like instances of that class. For example, attribute access should not work.</li>
<li>[x] Implement fallback to <code>_typeshed._type_checker_internals.TypedDictFallback</code></li>
</ul>
</li>
<li>[x] Type inference for key accesses (<code>movie[&#x27;directory&#x27;] -&gt; str</code>)</li>
<li>[x] Validation of writes to keys (synthesized <code>__setitem__</code> method with <code>key: Literal[&quot;key1&quot;], value: ValueType1</code>?)</li>
<li>[x] Validation of constructor calls (<code>Movie(name=&quot;Blade Runner&quot;, year=1982)</code>)</li>
<li>[x] Validation of <code>{â€¦}</code> literals to <code>TypedDict</code> types</li>
<li>[x] <a href="https://typing.python.org/en/latest/spec/typeddict.html#totality">Totality</a><ul>
<li>[x] <code>Required</code> and <code>NotRequired</code></li>
</ul>
</li>
<li>[x] Implement / write tests for generic <code>TypedDict</code>s</li>
<li>[x] Implement / write tests for recursive <code>TypedDict</code>s</li>
<li>[x] Support type inference for <code>instance.get(&quot;known_key&quot;)</code>?</li>
<li>[x] <a href="https://peps.python.org/pep-0705/">PEP 705 support</a> (<code>ReadOnly</code>)</li>
<li>[x] #1387</li>
<li>[x] Implement disjointness for <code>TypedDict</code>.</li>
<li>[ ] Support <code>TypedDict</code>s in all contexts (<code>return</code> position, function call arguments, etc) =&gt; #168</li>
<li>[ ] <a href="https://peps.python.org/pep-0728/">PEP 728 support</a> (&quot;openness&quot;, <code>extra_items</code>)</li>
<li>[ ] Functional syntax (<code>Movie = TypedDict(&#x27;Movie&#x27;, {&#x27;name&#x27;: str, &#x27;year&#x27;: int})</code>)</li>
<li>[ ] Support for <code>Unpack</code></li>
<li>[ ] Overriding of fields in inheritance</li>
<li>[ ] Correctness, validation<ul>
<li>[ ] Implement checks based on <a href="https://typing.python.org/en/latest/spec/typeddict.html#supported-and-unsupported-operations">supported and unsupported operations</a></li>
<li>[ ] <code>TypedDict</code> type objects cannot be used in <code>isinstance</code> checks</li>
<li>[ ] Only item definitions in the class body (no methods, for example)</li>
<li>[ ] Specifying a metaclass is not allowed</li>
<li>[ ] Can only subclass <code>TypedDict</code>, <code>TypedDict</code>- based types and <code>Generic</code></li>
<li>[ ] Implement / write tests for subclassing of <code>TypedDict</code>-based classes including multiple inheritance</li>
</ul>
</li>
<li>[ ] Performance<ul>
<li>[ ] Try out the optimization proposed in <a href="https://github.com/astral-sh/ruff/pull/19763">astral-sh/ruff#19763</a>#discussion_r2256719857</li>
<li>[ ] Add a micro-benchmark for large <code>TypedDict</code>s</li>
</ul>
</li>
<li>[x] Implement <code>.normalize()</code> for <code>TypeDictType</code>.</li>
<li>[x] Investigate Pydantic-specific performance problems introduced in <a href="https://github.com/astral-sh/ruff/pull/21467">#21467</a>.</li>
<li>[ ] Add <code>TypedDict</code> to property tests.</li>
<li>[x] Submit a correction to the upstream assignability rules =&gt; <a href="https://github.com/python/typing/pull/2119">python/typing#2119</a></li>
<li>[ ] LSP support (competitions, go to definitions, rename, hover, ...)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[red-knot] support TypedDict (and Required, NotRequired, ReadOnly)&quot; to &quot;support TypedDict (and Required, NotRequired, ReadOnly)&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-07 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typing semantics</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-11 07:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2025-05-20 18:44</div>
            <div class="timeline-body"><p>And <code>total=False</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;GA&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-06-11 00:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-06-11 00:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2025-06-14 01:03</div>
            <div class="timeline-body"><p>TypedDict has a few interesting properties that may affect core concepts in the type system, so I&#x27;ll be interested to see how you handle them.</p>
<p>The spec says that a TypedDict must be an instance of <code>dict</code> itself, not a subclass. I think that means these test cases should pass:</p>
<pre><code>from typing import Mapping, TypedDict, assert_type

class TD(TypedDict):
    a: int

class SubDict[KT, VT](dict[KT, VT]):
    pass

def f(x: TD | dict[int, str]):
    if isinstance(x, SubDict):
        assert_type(x, SubDict[int, str])
    else:
        assert_type(x, TD | dict[int, str])

def g(x: TD | Mapping[int, str]):
    if isinstance(x, dict):
        assert_type(x, TD | dict[int, str])
    else:
        assert_type(x, Mapping[int, str])
</code></pre>
<p>(Neither mypy nor pyright currently pass all of this, mostly because they put Any/Unknown in type parameters. I&#x27;m not sure there&#x27;s a good reason for that.)</p>
<p>However, a TypedDict type is not assignable to <code>dict[T, U]</code> for any values of T and U, not even to <code>dict[Any, Any]</code> (spec: https://typing.python.org/en/latest/spec/typeddict.html#assignability). This will have interesting consequences for the issues in #456: it means that narrowing from <code>isinstance(x, dict)</code> can&#x27;t be implemented by intersecting with some version of <code>forall K, V. dict[K, V]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sslivkoff">@sslivkoff</a> on 2025-07-14 21:26</div>
            <div class="timeline-body"><p>another piece of functionality that would eventually be nice here is the <code>Unpack</code> keyword</p>
<p>refs</p>
<ol>
<li>https://typing.python.org/en/latest/spec/callables.html#unpack-kwargs</li>
<li>https://peps.python.org/pep-0692/</li>
</ol>
<p>it&#x27;s basically a way to use TypedDict&#x27;s to type the <code>**kwargs</code> of a function</p>
<p>this ends up being very useful in practice for balancing python&#x27;s flexibility with strict type checking</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-07-31 11:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-15 14:41</div>
            <div class="timeline-body"><p>Moving this to GA because we feel the current feature-set is adequate for beta (though it would be nice to add a few more things if we have time).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-08-15 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;GA&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-08-15 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-15 14:43</div>
            <div class="timeline-body"><blockquote>
<p>Moving this to GA because we feel the current feature-set is adequate for beta (though it would be nice to add a few more things if we have time).</p>
</blockquote>
<p>(Note that there are many dictionaries that we do not infer as <code>TypedDict</code> instances right now despite them being annotated as such, but that&#x27;s really part of <a href="https://github.com/astral-sh/ty/issues/168">astral-sh/ty#168</a> rather than this issue -- that issue should definitely be a beta priority!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-08-19 21:33</div>
            <div class="timeline-body"><p>https://github.com/python/typing/pull/2072 rewrites the TypedDict spec to be much clearer and more concise, which may be useful to anyone working on further features here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2025-08-25 04:35</div>
            <div class="timeline-body"><p>Specifically a good place to focus on would be the full structure of TypedDict as laid out in the introduction to the proposed spec change (a list of items consisting of key, value type, requiredness, mutability; whether there are extra items; and whether or not the extra items are read-only). The internal representation of TypedDict types likely should follow that structure closely. Then you&#x27;ll also have to write code to recognize the syntactic forms that create these TypedDicts (e.g., keyword args to the TypedDict constructor; the Required/NotRequired/ReadOnly qualifiers; maybe inheritance, though that can wait). Implementing this structure should provide a good basis for implementing other operations on TypedDicts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;GA&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-09-19 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-09-19 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmke8">@tmke8</a> on 2025-10-07 21:46</div>
            <div class="timeline-body"><p>Currently this type-checks on the playground (I don&#x27;t know whether it also type-checks on main):</p>
<pre><code>from typing import TypedDict

class TD(TypedDict):
    a: str

x: TD = 1
</code></pre>
<p>Even if full bidirectional type checking isn&#x27;t implemented yet, wouldn&#x27;t it be possible to at least check whether the right-hand side is a dictionary?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 21:48</div>
            <div class="timeline-body"><blockquote>
<p>Currently this type-checks on the playground (I don&#x27;t know whether it also type-checks on main):</p>
</blockquote>
<p>(The ty playground automatically gets a fresh deploy on each new commit to <code>main</code>, so it&#x27;s usually &lt;10 minutes behind <code>main</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-07 21:53</div>
            <div class="timeline-body"><p>anyway: we&#x27;re working on <code>TypedDict</code> features actively, and we will get an improved <code>TypedDict</code> assignability implementation delivered to you as soon as we can ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Beta&quot; by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-17 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;GA&quot; by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-17 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-17 14:21</div>
            <div class="timeline-body"><p>Moving this ticket to GA, but #1387 into the Beta</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-20 07:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">typeddict</span> added by <a href="https://github.com/carljm">@carljm</a> on 2025-11-06 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/oconnor663">@oconnor663</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-11-14 15:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-11-14 23:35</div>
            <div class="timeline-body"><p>Added a checkbox at the top for &quot;Implement <code>.normalize()</code> for <code>TypeDictType</code>.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-01 21:44</div>
            <div class="timeline-body"><p>I&#x27;m working on the functional syntax piece.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/oconnor663">@oconnor663</a> by <a href="https://github.com/oconnor663">@oconnor663</a> on 2026-01-09 15:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:11 UTC
    </footer>
</body>
</html>
