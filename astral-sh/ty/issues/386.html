<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&quot;Too many iterations&quot; panic from `exported_names` query when analysing a `*` import - astral-sh/ty #386</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>&quot;Too many iterations&quot; panic from `exported_names` query when analysing a `*` import</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/386">#386</a>
        opened by <a href="https://github.com/rushiagr">@rushiagr</a>
        on 2025-05-14 15:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rushiagr">@rushiagr</a> on 2025-05-14 15:37</div>
            <div class="timeline-body"><p>Attaching run of ty with <code>RUST_BACKTRACE=1</code>. Please let me know if you need more info.</p>
<p><a href="https://github.com/user-attachments/files/20210471/ty-issue.txt">ty-issue.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by @AlexWaygood on 2025-05-14 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by @AlexWaygood on 2025-05-14 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-14 15:43</div>
            <div class="timeline-body"><p>Thank you. It looks like we're entering an infinite loop when trying to analyze a <code>*</code> import somewhere. If <code>/Users/rap/src/kite/sandesh-chacha/tickertrix/lib.py</code> has a <code>*</code> import somewhere in it, it would be useful to see the source code of the module it's trying to do a <code>*</code> import from.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushiagr">@rushiagr</a> on 2025-05-14 16:04</div>
            <div class="timeline-body"><p>that file lib.py doesn't do a <code>*</code> import, but it imports newlib and newlib has (in <code>__init__.py</code>), <code>*</code> imports. lib.py's imports and <code>__init__.py</code> file of newlib pasted below:</p>
<pre><code class="language-py"># import gevent.monkey  # noqa
#
# gevent.monkey.patch_all()  # noqa
import datetime
import functools
import gzip
import json
import math
import os
import pickle
import random
import threading
import zlib
from concurrent import futures
from typing import Callable, Dict, List, Union

import boto3
import pytest
import requests
from botocore import config
from dateutil.tz import gettz

import cu.fs
import newlib
from newlib import rushiforreal_access_key_id, rushiforreal_secret_access_key

</code></pre>
<pre><code class="language-py">from .testutils import *  # noqa
from .aa import *  # noqa
from .creds import *  # noqa
from .dt import *  # noqa
from .simpy import *  # noqa
from .files import *  # noqa
from .market import *  # noqa
from .ntfy import *  # noqa
from .exc import *  # noqa
from .pledgeparser import *  # noqa
from .strings import *  # noqa
from .req import *  # noqa
from .otp import *  # noqa
from .ipc import *  # noqa
from .locking import *  # noqa

&quot;&quot;&quot;
isort:skip_file
&quot;&quot;&quot;
</code></pre>
<p>if sources of any or all of the imported files in newlib/<strong>init</strong>.py would help, i'll provide them in a few hours</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[panic] Encountered panic in my 60k loc codebase" to "[panic] "Too many iterations" from `exported_names` query when analysing a `*` import" by @AlexWaygood on 2025-05-14 16:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[panic] "Too many iterations" from `exported_names` query when analysing a `*` import" to ""Too many iterations" panic from `exported_names` query when analysing a `*` import" by @AlexWaygood on 2025-05-14 16:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-14 22:02</div>
            <div class="timeline-body"><p>Thank you! It would be great if you could see if it still reproduces with some of those <code>*</code> imports removed, so that we can identify which one(s) are causing the problem here. And e.g. if it's the <code>from .testutils import *</code> import that's causing the problem, we'll probably need to see the imports inside the  <code>newlib.testutils</code> module, too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rushiagr">@rushiagr</a> on 2025-05-16 01:04</div>
            <div class="timeline-body"><p>Couldn't get much time yesterday. I tried removing one each of the imports, and then everything from the above <code>__init__.py</code> file, which still caused the exception. Then I tried to remove one and count the number of times the error is printed. When I removed 'market' import, the number of times it is printed reduced from 17 to 12. I'll explore this further, but I also observed that sometimes when I do a command like below, it gets stuck and I basically had to kill the 'ty' process from another thread. Is there a bug reported for that already? If not, I can report, but not sure what diagnostics I'll be able to provide.</p>
<pre><code> RUST_BACKTRACE=1 uvx ty check  | grep sandesh  | grep py | wc
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @AlexWaygood on 2025-05-16 02:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-05-19 12:58</div>
            <div class="timeline-body"><p>I'm closing this in favor of https://github.com/astral-sh/ty/issues/444 which has a MRE.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-05-19 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-05-19 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @carljm on 2025-11-12 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-11-12 16:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:02 UTC
    </footer>
</body>
</html>
