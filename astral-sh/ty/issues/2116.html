<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeVar not handled in decorators - astral-sh/ty #2116</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>TypeVar not handled in decorators</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2116">#2116</a>
        opened by <a href="https://github.com/mxmpl">@mxmpl</a>
        on 2025-12-19 16:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mxmpl">@mxmpl</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I found this because the return type of <code>pl.read_csv</code> in <code>polars</code> is inferred as <code>Unknown</code> instead of <code>pl.DataFrame</code>: https://github.com/pola-rs/polars/blob/2a151c10fa76790711c2f75e6d012dd69c627ddd/py-polars/src/polars/io/csv/functions.py#L46-L49.</p>
<p>I reduced it to this example:</p>
<pre><code class="language-py">from collections.abc import Callable
from typing import TypeVar, reveal_type

T = TypeVar(&quot;T&quot;)


def decorator() -&gt; Callable[[Callable[[], T]], Callable[[], T]]:
    def decorate(function: Callable[[], T]) -&gt; Callable[[], T]:
        return function

    return decorate


def foo() -&gt; None: ...


@decorator()
def bar() -&gt; None: ...


reveal_type(foo) # Revealed type: `def foo() -&gt; None` (revealed-type) [Ln 21, Col 13]
reveal_type(bar) # Revealed type: `() -&gt; Unknown` (revealed-type) [Ln 22, Col 13]
</code></pre>
<p>Both mypy and pyright infer the type of the decorated <code>bar</code> as <code>() -&gt; None</code>.</p>
<p>Playground link: https://play.ty.dev/f073ef61-ba7f-4af2-a171-5f0c77caf754</p>
<h3>Version</h3>
<p>ty 0.0.4 (c1e6188b1 2025-12-18)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-20 16:14</div>
            <div class="timeline-body"><p>Thanks! This is already tracked at #1136</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-12-20 16:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:28 UTC
    </footer>
</body>
</html>
