<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Code Extension regularly crashes - astral-sh/ty #2310</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>VS Code Extension regularly crashes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2310">#2310</a>
        opened by <a href="https://github.com/npaolini2634">@npaolini2634</a>
        on 2026-01-02 22:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/npaolini2634">@npaolini2634</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I've been using ty and the vscode extension for a few months now. I pretty regularly get the message in vscode saying &quot;ty has crashed 5 times and will not be restarted&quot;.  Previously, I never looked at the logs, but it happened again just now and I've attached the log. It looks like many files take over 100ms, then a worker gets a stack overflow. Sorry if this is the wrong place to put vscode extension issues.</p>
<p><a href="https://github.com/user-attachments/files/24412542/ty.Language.Server.log">ty Language Server.log</a></p>
<h3>Version</h3>
<p>ty 0.0.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by @AlexWaygood on 2026-01-02 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-03 10:29</div>
            <div class="timeline-body"><blockquote>
<p>Sorry if this is the wrong place to put vscode extension issues.</p>
</blockquote>
<p>No need to be sorry. We'll move issues if they aren't in the right place (but yours is).</p>
<p>This is tricky to narrow down without access to the code. Can you try to run <code>ty</code> on the CLI with <code>TY_MAX_PARALLELISM=1 ty check -vv</code>. It should then run in single-threaded mode and log what files it's currently checking. That should help us to narrow down which (first-party file) contains the code on which ty currently stack overflows.</p>
<p>There's also an existing issue, any chance this is something you use in your code? https://github.com/astral-sh/ty/issues/2039</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2026-01-03 10:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/npaolini2634">@npaolini2634</a> on 2026-01-06 21:14</div>
            <div class="timeline-body"><p>Okay thanks, I've attached the output of <code>TY_MAX_PARALLELISM=1 ty check -vv</code></p>
<p>We do little to no recursion so I don't think recursive callables would be the source. I had a quick look and didn't find anything matching that pattern.</p>
<p>If you wanted to see the contents of one or two files, I could probably share that.</p>
<p><a href="https://github.com/user-attachments/files/24459898/ty.-vv.txt">ty -vv.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/npaolini2634">@npaolini2634</a> on 2026-01-06 21:26</div>
            <div class="timeline-body"><p>Is it helpful to have anymore logs of overflows? Here's another one that's a bit shorter that happened today.</p>
<p><a href="https://github.com/user-attachments/files/24460092/2026-01-06.ty.log">2026-01-06 ty.log</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "VS Code Extension regular crashes" to "VS Code Extension regularly crashes" by @AlexWaygood on 2026-01-06 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Pre-stable 1" by @carljm on 2026-01-07 00:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-07 09:25</div>
            <div class="timeline-body"><p>Thanks. The logs are very useful and allowed me to submit what I think should fix this issue, see https://github.com/astral-sh/ruff/pull/22433</p>
<p>What makes me draw this conclusion is that we only see the stack overflow when using the server, but not when using the CLI. I also assume that you use <code>diagnosticMode: &quot;openFilesOnly&quot;</code> (the default), in which case checking doesn't run on a rayon thread (for which we already set the higher stack size), but on one of the LSPs worker threads.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @MichaReiser on 2026-01-07 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2026-01-07 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @MichaReiser on 2026-01-07 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @MichaReiser on 2026-01-07 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2026-01-07 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/npaolini2634">@npaolini2634</a> on 2026-01-07 17:53</div>
            <div class="timeline-body"><p>Okay I'm happy to try again whenever any new changes are merged in. I do use <code>&quot;ty.diagnosticMode&quot;: &quot;workspace&quot;,</code> however.</p>
<p>The other two settings changes I have are <code>&quot;ty.inlayHints.variableTypes&quot;: false,</code>, and <code>&quot;ty.inlayHints.callArgumentNames&quot;: false,</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-08 08:06</div>
            <div class="timeline-body"><p>Hmm, so maybe that wasn't it. We did a release yesterday. Could you give that a try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/npaolini2634">@npaolini2634</a> on 2026-01-08 18:32</div>
            <div class="timeline-body"><p>Okay I updated to the new version and after about 30 minutes I got a similar error. This one popped up different warning messages in vscode, but it looks like there's still an overflow in there.</p>
<p><a href="https://github.com/user-attachments/files/24501866/2026-01-08.log">2026-01-08.log</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-08 18:41</div>
            <div class="timeline-body"><p>The logs suggest that you're still on 0.0.8. Any chance you have ty installed globally or in your venv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/npaolini2634">@npaolini2634</a> on 2026-01-09 00:45</div>
            <div class="timeline-body"><p>Oops, I'm used to Pylance that uses its own bundled version by default. Will ty only use the bundled version if it doesn't find another version installed?</p>
<p>I've updated my venv to 0.0.10, and haven't had the language server crash yet today. I'll report back if it stays reliable or it fails again in the next few days.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 07:49</div>
            <div class="timeline-body"><blockquote>
<p>Oops, I'm used to Pylance that uses its own bundled version by default. Will ty only use the bundled version if it doesn't find another version installed?</p>
</blockquote>
<p>There's a setting controlling the <a href="https://docs.astral.sh/ty/reference/editor-settings/#importstrategy">extensions behavior</a>. The default is to:</p>
<ul>
<li>The version installed in the selected venv</li>
<li>A system wide installation</li>
<li>The bundled version</li>
</ul>
<p>ty always uses the bundled version when opening an untrusted workspace.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:39 UTC
    </footer>
</body>
</html>
