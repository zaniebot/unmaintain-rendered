<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Completions should be suppressed in all locations that are unambiguously definitions - astral-sh/ty #1287</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Completions should be suppressed in all locations that are unambiguously definitions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1287">#1287</a>
        opened by <a href="https://github.com/pyscripter">@pyscripter</a>
        on 2025-09-30 15:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pyscripter">@pyscripter</a> on 2025-09-30 15:45</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The following is based on my experience with using the ty playground. (^ is the cursor position)</p>
<p>In</p>
<pre><code class="language-python">import numpy as ^
</code></pre>
<p>I get a list of modules on the python path.  Instead I should be getting an empty list as for example with Jedi.</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Completion of from/import statements  after the as keyword" to "Completion of import statements  after the as keyword" by @pyscripter on 2025-09-30 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2025-09-30 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by @AlexWaygood on 2025-09-30 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Completion of import statements  after the as keyword" to "Completions should be suppressed for `import typing as <CURSOR>`" by @AlexWaygood on 2025-11-13 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Completions should be suppressed for `import typing as <CURSOR>`" to "Completions should be suppressed after `import typing as <CURSOR>`" by @AlexWaygood on 2025-11-13 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-11-13 13:37</div>
            <div class="timeline-body"><p>By same principle:</p>
<ul>
<li><code>for x in range(42)</code> creates a definition for the <code>x</code> symbol, so there shouldn't be any completion suggestions at the point <code>for x&lt;CURSOR&gt;</code>. Currently there are.</li>
<li>Typing a parameter name in a function declaration (<code>def f(xx&lt;CURSOR&gt;)</code>) should not trigger any autocomplete suggestions</li>
<li>Typing a type parameter name in a function declaration (<code>def f[T&lt;CURSOR&gt;]</code>) should not trigger any autocomplete suggestions</li>
<li><code>with &lt;EXPR&gt; as b&lt;CURSOR&gt;</code> should not trigger any autocomplete suggestions</li>
<li><code>case &lt;PATTERN&gt; as b&lt;CURSOR&gt;</code> should not trigger any autocomplete suggestions</li>
<li><code>except &lt;EXPRESSION&gt; as b&lt;CURSOR&gt;</code> should not trigger any autocomplete suggestions</li>
</ul>
<details>
<summary>Screenshots</summary>

<p><img width="1138" height="664" alt="Image" src="https://github.com/user-attachments/assets/c58f4260-5688-47b2-aaf5-b15bc0bd9d6c" /></p>
<p><img width="1340" height="842" alt="Image" src="https://github.com/user-attachments/assets/f140ec37-2e4f-4e20-be6e-f297713f6c64" /></p>
<p><img width="1278" height="310" alt="Image" src="https://github.com/user-attachments/assets/4a11be21-8b8f-47cd-9bdc-933cc0ee07dc" /></p>
<p><img width="1574" height="354" alt="Image" src="https://github.com/user-attachments/assets/8d26726d-88f6-4773-95ae-de79c9814cc0" /></p>
<p><img width="1202" height="682" alt="Image" src="https://github.com/user-attachments/assets/a01d5a42-9b2f-46a7-a0ce-7c690dc02a72" /></p>
<p><img width="1552" height="724" alt="Image" src="https://github.com/user-attachments/assets/0d44815b-23cf-4823-8f7a-a81d926ea8e2" /></p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Completions should be suppressed after `import typing as <CURSOR>`" to "Completions should be suppressed in all locations that are unambiguously definitions" by @AlexWaygood on 2025-11-13 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pyscripter">@pyscripter</a> on 2025-11-13 13:43</div>
            <div class="timeline-body"><p>Also</p>
<p>import numpy ^  (offer as as the only option)
for x ^  (offer in as the only option)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @MichaReiser on 2025-11-14 08:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2025-11-14 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-11-14 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pyscripter">@pyscripter</a> on 2025-11-14 21:32</div>
            <div class="timeline-body"><p>Nice but it does not cover all cases discussed here:</p>
<ul>
<li>import numpy ^  (offer as as the only option)</li>
<li>for ^ (offer no definition)</li>
<li>for x ^  (offer in as the only option)</li>
<li>Typing a parameter name in a function declaration (def f(xx<CURSOR>)) should not trigger any autocomplete suggestions</li>
<li>Typing a type parameter name in a function declaration (def f[T<CURSOR>]) should not trigger any autocomplete suggestions</li>
</ul>
<p>Shouldn't</p>
<pre><code class="language-rust">fn is_in_definition_place(db: &amp;dyn Db, file: File, tokens: &amp;[Token], typed: Option&lt;&amp;str&gt;) -&gt; bool {
    fn is_definition_token(token: &amp;Token) -&gt; bool {
        matches!(
            token.kind(),
            TokenKind::Def | TokenKind::Class | TokenKind::Type | TokenKind::As
        )
    }
</code></pre>
<p>include TokenKind::For?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-11-14 21:42</div>
            <div class="timeline-body"><p>I opened https://github.com/astral-sh/ty/issues/1563 to track those.</p>
<p>Context aware keyword suggestions are a separate thing. I opened https://github.com/astral-sh/ty/issues/1568 to track that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pyscripter">@pyscripter</a> on 2025-11-14 21:42</div>
            <div class="timeline-body"><p>But for would fit nicely in the this commit.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:34 UTC
    </footer>
</body>
</html>
