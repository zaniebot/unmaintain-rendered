<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hovering over `Final` reveals `Unknown` - astral-sh/ty #1593</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Hovering over <code>Final</code> reveals <code>Unknown</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1593">#1593</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-11-19 15:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>If you hover over the <code>Final</code> in <code>X: Final</code>, it shows <code>Unknown</code></p>
<pre><code>from typing import Final, reveal_type

X: Final = [&quot;foo&quot;, &quot;bar&quot;]
</code></pre>
<p>Go to definition works.</p>
<p>https://play.ty.dev/64da8236-5cf7-43d4-bc71-6cd7b42773c4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-19 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-19 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-19 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-12-05 14:04</div>
            <div class="timeline-body"><p>I think this is a quirk of how the typechecker records types and the resulting AST.</p>
<p>We handle <code>x: Final[int]</code> fine, but notably if you hover <code>x</code> you will get the type <code>int</code> -- <code>Final</code> is implemented to evaporate! Similarly if you hover the <code>x</code> in <code>x: Final</code> you get <code>Unknown</code> because we have suddenly invented a syntactically valid way in python to declare a variable exists but without assigning a value or giving it an actual type! (i.e. I think <code>x: Unknown</code> is a reasonable/correct inference).</p>
<p>Now in <code>x: Final[int]</code> I believe there are 3 annotation exprs here: <code>Final</code>, <code>int</code>, and <code>Final[int]</code>, which have the following inferred types:</p>
<ul>
<li><code>Final</code>: <code>&lt;special form &#x27;typing.Final&#x27;&gt;</code></li>
<li><code>int</code>: <code>int</code></li>
<li><code>Final[int]</code>: Unknown</li>
</ul>
<p>So when you hover <code>Final</code> we grab the inner expression and happily report <code>&lt;special form &#x27;typing.Final&#x27;&gt;</code>.</p>
<p>However in <code>x: Final</code> there&#x27;s only one expr: <code>Final</code>! And yet it is simultaneously <code>&lt;special form &#x27;typing.Final&#x27;&gt;</code> and <code>Unknown</code> -- with the latter being the &quot;final&quot; type and therefore the one assigned to that expr. So when we hover, all you get is <code>Unknown</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-05 19:27</div>
            <div class="timeline-body"><p>I think it is possible to change this behavior in the type checker without introducing any great inconsistency -- it&#x27;s sort of an arbitrary choice what type we assign to the annotation expression in this case. Given that you can already get the inferred type of <code>x</code> by hovering over <code>x</code>, I think we may as well assign the special-form type to the bare <code>Final</code> in <code>x: Final = 1</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:02 UTC
    </footer>
</body>
</html>
