<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow an attribute declared in a superclass's class body to be overridden by an attribute redeclared in a subclass's `__init__` method - astral-sh/ty #1345</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow an attribute declared in a superclass's class body to be overridden by an attribute redeclared in a subclass's `__init__` method</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1345">#1345</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-10-13 12:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-13 12:48</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Consider the following snippet. ty, mypy, pyright and pyrefly all agree on the type of <code>B1().x</code>, but ty disagrees with the other three on the type of <code>B2().x</code>:</p>
<pre><code class="language-py">class A:
    x: int

class B1(A):
    x: bool

class B2(A):
    def __init__(self) -&gt; None:
        self.x: bool = True


reveal_type(B1().x)  # Ty, mypy, pyright, pyrefly: bool
reveal_type(B2().x)  # Mypy, pyright, pyrefly: bool. Ty: int!
</code></pre>
<ul>
<li><a href="https://play.ty.dev/707e2f40-6672-45ac-8386-ad7956d5b939">Ty</a></li>
<li><a href="https://pyright-play.net/?pyrightVersion=1.1.405&amp;strict=true&amp;code=MYGwhgzhAECCBcBYAUNN0Ae9oEsB2ALiiqJDAEICMAFLAJRKrpbQBGA9uyMcqVNOQBMtBinTQAJgFMAZtAD68-DgKLqEKSBl1oAWgB80AHLs8UxuPEatAOhYcu0ALzQAKgCcArlJ4p3UgDcpMBB5AgBPAAcpaipqOjsdaABiNk5uZH8gkLComKF4xLRU-CJkIA">Pyright</a></li>
<li><a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=f505a4fde6645c22604cfa7ce41a7d9e">Mypy</a></li>
<li><a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeSIAxlKnHAAQCCiAOuvR-fovROgC5s21WgwBCARgAUjAJSt2nbvTy4oQ9CLr0xAJhny2nephhh6AfQt8I-K1LgwoYWfQC0APnoA5XOhgKxsaOzoTKqlD0ALz0ACoATgCuMBps8TAAbjCoUBb8pMQwUpJSsmGu9ADEKrhqaZnZufmFxfpl%2BBXVfPwgADQgifzQcCTkiCDVAKpDULak9GCJmkN%2BcBqm5mC48QC2qHboiTvYMPFSyt2unvRw-PGBnOn8ifHsYCwg3kcn9-TA%2BABfD5sPogMjpMBQUiEfi4HZQCjVAAKpAhUJuGBwBHolD8kAA5i99hA-IQ2NUAMowGD0AAW-H4xDgiAA9CzwWYoYRtviWTB0CzMLhKHAWbj0ASiSsBQttvRUBlUNBUNhYDi8RBCfFiX56LhiNKRmwyPxaX43Fl4nASewYh8AMyECS6YHoEAA-qoShDLIAMWgMAoaCweCIZHdQA">Pyrefly</a></li>
</ul>
<p>I think for compatibility, it would be better if we followed what the other type checkers do here.</p>
<p>I spotted this by looking at the ecosystem report in https://github.com/astral-sh/ruff/pull/20723#issuecomment-3372209543 (all 4 new <code>unresolved-attribute</code> errors on aiohttp in the ecosystem report are caused by this).</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">attribute access</span> added by @AlexWaygood on 2025-10-13 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Ty does not allow an attribute declared in a class body to be overridden by an attribute in an `__init__` method" to "Allow an attribute declared in a class body to be overridden by an attribute in an `__init__` method" by @AlexWaygood on 2025-10-13 12:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow an attribute declared in a class body to be overridden by an attribute in an `__init__` method" to "Allow an attribute declared in a class body to be overridden by an attribute redeclared in an `__init__` method" by @AlexWaygood on 2025-10-13 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow an attribute declared in a class body to be overridden by an attribute redeclared in an `__init__` method" to "Allow an attribute declared in a superclass's class body to be overridden by an attribute redeclared in a subclass's `__init__` method" by @AlexWaygood on 2025-10-13 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-13 13:07</div>
            <div class="timeline-body"><p>… but we should still error on the <code>self.x: bool = True</code> declaration, correct?</p>
<p>I just recently added some tests that are very similar to this scenario, but re-declaration scenarios are not yet considered: https://github.com/astral-sh/ruff/blob/513d2996ec599d3c1990480e0edd3a7328adcd0f/crates/ty_python_semantic/resources/mdtest/attributes.md?plain=1#L821-L919</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-13 13:08</div>
            <div class="timeline-body"><blockquote>
<p>… but we should still error on the <code>self.x: bool = True</code> declaration, correct?</p>
</blockquote>
<p>yes, we also need to implement the Liskov Substitution Principle, correct! (And mutable attributes should be treated as invariant.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-13 13:22</div>
            <div class="timeline-body"><p>(Just noting things down for myself as much as anything else)</p>
<p>It also looks like this is the cause of all 5 new <code>unresolved-attribute</code> errors on <code>boostedblob</code> in https://github.com/astral-sh/ruff/pull/20723#issuecomment-3372209543</p>
<p>And all the new <code>unresolved-attribute</code> errors on <code>homeassistant</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2025-10-17 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Beta" by @AlexWaygood on 2025-10-17 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Beta" by @MichaReiser on 2025-11-28 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @MichaReiser on 2025-11-28 15:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:35 UTC
    </footer>
</body>
</html>
