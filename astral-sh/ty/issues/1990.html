<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>don't emit diagnostics about &quot;shadowing&quot; when assignment target is not a local variable - astral-sh/ty #1990</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>don't emit diagnostics about &quot;shadowing&quot; when assignment target is not a local variable</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1990">#1990</a>
        opened by <a href="https://github.com/SerTetora">@SerTetora</a>
        on 2025-12-17 09:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SerTetora">@SerTetora</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code class="language-python">from configparser import ConfigParser

cfgparser = ConfigParser()
cfgparser.optionxform = str  # &lt;--- Should be allowed, per Python docs
</code></pre>
<p>Ref. https://docs.python.org/3/library/configparser.html#configparser.ConfigParser.optionxform</p>
<h3>ty</h3>
<pre><code>Implicit shadowing of function `optionxform` (invalid-assignment) [Ln 4, Col 1]
</code></pre>
<h3>pyrefly</h3>
<pre><code>ERROR sandbox.py:4:25-28: `type[str]` is not assignable to attribute `optionxform` with type `BoundMethod[ConfigParser, (self: ConfigParser, optionstr: str) -&gt; str]` [[bad-assignment](https://pyrefly.org/en/docs/error-kinds/#bad-assignment)]
  Positional parameter name mismatch: got `object`, want `optionstr`
</code></pre>
<h3>pyright</h3>
<pre><code>Cannot assign to attribute &quot;optionxform&quot; for class &quot;ConfigParser&quot;
  No overloaded function matches type &quot;(optionstr: str) -&gt; str&quot;  (reportAttributeAccessIssue)
</code></pre>
<h3>mypy</h3>
<pre><code>main.py:4: error: Cannot assign to a method  [method-assign]
main.py:4: error: Incompatible types in assignment (expression has type &quot;type[str]&quot;, variable has type &quot;Callable[[str], str]&quot;)  [assignment]
Found 2 errors in 1 file (checked 1 source file)
</code></pre>
<h3>Version</h3>
<p>0.0.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @sharkdp on 2025-12-17 09:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-17 09:12</div>
            <div class="timeline-body"><p>Thank you for reporting this.</p>
<p>Our error message is different from the other type checkers, but it looks like all other type checkers also issue an error. If this should really be allowed, maybe it's a problem with the <a href="https://github.com/python/typeshed/blob/8d96801533918957fb194e101cb321bfe1f836f8/stdlib/configparser.pyi#L324">stubs</a> for this attribute?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SerTetora">@SerTetora</a> on 2025-12-17 09:47</div>
            <div class="timeline-body"><p>Thanks for the feedback!</p>
<blockquote>
<p>If this should really be allowed, maybe it's a problem with the <a href="https://github.com/python/typeshed/blob/8d96801533918957fb194e101cb321bfe1f836f8/stdlib/configparser.pyi#L324">stubs</a> for this attribute?</p>
</blockquote>
<p>What would you recommend to do in this case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-17 10:17</div>
            <div class="timeline-body"><p>I think this would be an appropriate place to use a suppression comment (<code># type: ignore</code> or `# ty: ignore, see https://docs.astral.sh/ty/suppression/).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-17 10:27</div>
            <div class="timeline-body"><p>If we believe that there's a bug in the stubs, then a report should be filed over at <a href="https://github.com/python/typeshed">typeshed</a> (if there isn't already an issue there regarding this)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-17 10:36</div>
            <div class="timeline-body"><p>Looks like this was discussed before:</p>
<ul>
<li>https://github.com/python/typeshed/issues/1857</li>
<li>https://github.com/python/mypy/issues/5062</li>
<li>https://github.com/python/mypy/issues/708</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-12-18 11:36</div>
            <div class="timeline-body"><p>Closing this for now, let me know if anyone thinks there is something we could do in ty to address this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharkdp on 2025-12-18 11:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-18 23:17</div>
            <div class="timeline-body"><p>Our diagnostic is bad here and should be improved; the logic we attempt to use for detecting implicit shadowing of a function or class wrongly fires on assignments like this (because it's based solely on the declared type, not the syntactic context.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @carljm on 2025-12-18 23:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`ConfigParser.optionxform` assignment flagged as “shadowing” (false positive)" to "don't emit diagnostics about "shadowing" when assignment target is not a local variable" by @carljm on 2025-12-18 23:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-18 23:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:21 UTC
    </footer>
</body>
</html>
