<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>not hasattr(...) causes conditional block to resolve self to Never - astral-sh/ty #2455</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>not hasattr(...) causes conditional block to resolve self to Never</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2455">#2455</a>
        opened by <a href="https://github.com/moschi">@moschi</a>
        on 2026-01-12 08:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/moschi">@moschi</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The following code snipped illustrates the issue:</p>
<pre><code class="language-python">class NeverWithHasAttr:
    @property
    def property_a(self) -&gt; str:
        if not hasattr(self, &quot;_property_a&quot;):
            self._property_a = f&quot;{self.this_does_not_exist} does not cause an error, self is Never&quot;
        return self._property_a

    @property
    def property_b(self) -&gt; str:
        if getattr(self, &quot;_property_b&quot;, None) is None:
            self._property_b = f&quot;{self.this_does_not_exist} causes an error&quot;
        return self._property_b

</code></pre>
<p>where <code>self</code> inside the <code>not hasattr(self, &quot;_property_a&quot;):</code> block is Never, thus not causing any misspelled properties to be flagged as errors.</p>
<h3>Version</h3>
<p>ty 0.0.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by @AlexWaygood on 2026-01-12 08:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-13 02:08</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>Given that we don't (currently) distinguish between maybe-bound and definitely-bound attributes, I guess we can't safely do negative narrowing on <code>hasattr</code>, only positive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-13 02:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-13 02:24:35 UTC
    </footer>
</body>
</html>
