<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty infers literals and fails `assert_type`, opposed to other type checkers - astral-sh/ty #1252</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty infers literals and fails <code>assert_type</code>, opposed to other type checkers</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1252">#1252</a>
        opened by <a href="https://github.com/Bobronium">@Bobronium</a>
        on 2025-09-25 12:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Bobronium">@Bobronium</a></div>
            <div class="timeline-body"><h3>Alternative title:</h3>
<h2><code>ty</code> is superior at interpreting type variables and it's causing problems</h2>
<pre><code class="language-py">from typing_extensions import Literal, assert_type, reveal_type


def as_is[T](x: T) -&gt; T:
    return x


reveal_type(as_is(1))  # `Literal[1]` with ty, `int` with other typecheckers
assert_type(as_is(1), Literal[1])  # ok with ty, error with other typecheckers
assert_type(as_is(1), int)  # error with ty: Inferred type of argument is `Literal[1]`

a: Literal[1] = 1
assert_type(a, Literal[1])  # here all typecheckers pass
assert_type(a, int)  # here all typecheckers fail
</code></pre>
<p>Other typecheckers:</p>
<ul>
<li>mypy</li>
<li>pyright</li>
<li>pyrefly</li>
<li>zuban</li>
<li>PyCharm</li>
</ul>
<details>
<summary>Output </summary>

<pre><code class="language-shell">
❯ ty check expression.py  --output-format concise
WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
Checking ------------------------------------------------------------ 1/1 files                                                                                      
expression.py:8:13: info[revealed-type] Revealed type: `Literal[1]`
expression.py:10:1: error[type-assertion-failure] Argument does not have asserted type `int`
expression.py:14:1: error[type-assertion-failure] Argument does not have asserted type `int`
Found 3 diagnostics


❯ mypy expression.py                       
expression.py:8: note: Revealed type is &quot;builtins.int&quot;
expression.py:9: error: Expression is of type &quot;int&quot;, not &quot;Literal[1]&quot;  [assert-type]
expression.py:14: error: Expression is of type &quot;Literal[1]&quot;, not &quot;int&quot;  [assert-type]
Found 2 errors in 1 file (checked 1 source file)

❯ pyright expression.py                     
expression.py
  expression.py:8:13 - information: Type of &quot;as_is(1)&quot; is &quot;int&quot;
  expression.py:9:13 - error: &quot;assert_type&quot; mismatch: expected &quot;Literal[1]&quot; but received &quot;int&quot; (reportAssertTypeFailure)
  expression.py:14:13 - error: &quot;assert_type&quot; mismatch: expected &quot;int&quot; but received &quot;Literal[1]&quot; (reportAssertTypeFailure)
2 errors, 0 warnings, 1 information


❯ pyrefly check expression.py  --output-format min-text
 INFO expression.py:8:12-22: revealed type: int [reveal-type]
ERROR expression.py:9:12-34: assert_type(int, Literal[1]) failed [assert-type]
ERROR expression.py:14:12-20: assert_type(Literal[1], int) failed [assert-type]
 INFO 2 errors


❯ zuban check expression.py --no-pretty     
expression.py:8: note: Revealed type is &quot;builtins.int&quot;
expression.py:9: error: Expression is of type &quot;int&quot;, not &quot;Literal[1]&quot;  [misc]
expression.py:14: error: Expression is of type &quot;Literal[1]&quot;, not &quot;int&quot;  [misc]
Found 2 errors in 1 file (checked 1 source file)
</code></pre>
</details>

<p>I'm not sure what the best course of action here would be.</p>
<p>Arguably, <code>assert_type(Literal[1], int)</code> should pass, but that's not behavior of other typecheckers either.</p>
<h3>Version</h3>
<p>ty 0.0.1-alpha.21 (ef52a1940 2025-09-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ty expects literals in `assert_type`, opposed to other type checkers" to "ty infers literals and fails `assert_type`, opposed to other type checkers" by @Bobronium on 2025-09-25 12:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-09-25 12:34</div>
            <div class="timeline-body"><p>Could you elaborate on exactly what the problems are that our behaviour here is causing you? Bug-for-bug compatibility with other type checkers is not a goal for this project. There are already many areas in which an <code>assert_type()</code> call will pass for one of mypy and pyright but not for the other, and there will be some areas in which similar things are true for ty as well</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @AlexWaygood on 2025-09-26 09:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-10-01 07:10</div>
            <div class="timeline-body"><p>Closing for now. We'll probably get closer to the behaviour of other type checkers here once we've finished our new constraint solver, anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-10-01 07:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:42 UTC
    </footer>
</body>
</html>
