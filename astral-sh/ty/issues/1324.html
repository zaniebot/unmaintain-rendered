<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type of inherited attribute is lost when using dynamically constructed base class - astral-sh/ty #1324</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Type of inherited attribute is lost when using dynamically constructed base class</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1324">#1324</a>
        opened by <a href="https://github.com/vlashada">@vlashada</a>
        on 2025-10-08 09:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vlashada">@vlashada</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When returning a class type (type[A]) from a function and using it as a dynamic base class, ty fails to preserve attribute type information in the subclass. The inherited attribute is recognized as unknown instead of the expected static type.</p>
<pre><code class="language-python">from typing import reveal_type

class A:
    name: str

def make_a() -&gt; type[A]:
    return A

class B(make_a()): # Unsupported class base with type `type[A]` [unsupported-base]
    pass

a = A()
reveal_type(a.name) # Revealed type: `str`
b = B()
reveal_type(b.name) # Revealed type: `unknown`
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.21 (ef52a1940 2025-09-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @sharkdp on 2025-10-08 10:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-08 10:46</div>
            <div class="timeline-body"><p>Thank you for reporting this. Using <code>type[A]</code> as a type for a base class seems wrong to me? <code>type[A]</code> is a type that includes the class <code>A</code> itself, but also all subclasses of <code>A</code>. So we can't really know what a base class of type <code>type[A]</code> means. Or is this specified somewhere to be a supported typing pattern?</p>
<p>What you would really want to have is to return a type that <em>only</em> includes the class <code>A</code> itself. This can't be spelled out using normal Python syntax/types, though. In <code>ty</code> in particular, you could write it as <code>TypeOf[A]</code> (see <a href="https://play.ty.dev/8ee5ef97-729e-4db2-8392-02c257afc1db">this playground</a>), but you probably don't want to rely on <code>ty_extensions</code> in a real code base.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-08 10:56</div>
            <div class="timeline-body"><p>For reference, both mypy and pyrefly refuse your code as well (&quot;Unsupported dynamic base class&quot;, &quot;Invalid expression form for base class: <code>make_a()</code>&quot;). pyright seems to accept this code and treat it as if <code>A</code> would be the base class. However, if I recall correctly, pyright does treat <code>type[A]</code> as being synonymous with &quot;the type that only includes the class <code>A</code> itself&quot; in other cases as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vlashada">@vlashada</a> on 2025-10-08 16:44</div>
            <div class="timeline-body"><p>The type of <code>b.name</code> is still unknown when using <code>ty_extensions.TypeOf</code> as in your playground example?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-10-08 16:52</div>
            <div class="timeline-body"><blockquote>
<p>The type of <code>b.name</code> is still unknown when using <code>ty_extensions.TypeOf</code> as in your playground example?</p>
</blockquote>
<p>No, the type of <code>b.name</code> is revealed as <code>str</code> in the playground example. Are you maybe looking at the comment in the code sample (which is out of date) instead of the actual diagnostic emitted by ty (in the lower pane)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @vlashada on 2025-11-24 04:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:46 UTC
    </footer>
</body>
</html>
