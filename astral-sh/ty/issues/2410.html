<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server: Mono-repo support - astral-sh/ty #2410</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Server: Mono-repo support</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2410">#2410</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-05-25 11:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>It&#x27;s not uncommon to have a single repository that contains both the frontend and backend (Python) code. As a user, I want to be able to have the ty configuration in the backend folder. See</p>
<p>https://github.com/astral-sh/ty-vscode/issues/40
<a href="https://github.com/astral-sh/ty-vscode/issues/17">astral-sh/ty-vscode#17</a></p>
<p>We could</p>
<ul>
<li>Scan for configurations in sub-directories if the root folder has no explicit <code>ty</code> configuration</li>
<li>Add an option</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-05-27 12:05</div>
            <div class="timeline-body"><p>Add an option would be great. Currently we&#x27;re using the following setting with mypy:</p>
<pre><code>		&quot;mypy-type-checker.args&quot;: [
			&quot;--config-file=${workspaceFolder}/client/pyproject.toml&quot;
		],
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Beta&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-28 12:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-07-03 02:17</div>
            <div class="timeline-body"><p><code>ty</code> itself now has <code>--project</code> and <code>--config-file</code> parameters. If we add <code>ty.project</code> and <code>ty.configFile</code> to the ty-vscode settings, this should be largely solved. We can create different vscode workspace for different project in the monorepo, or use <a href="https://code.visualstudio.com/docs/editing/workspaces/multi-root-workspaces">multi-root workspace</a>, then put the corresponding <code>project</code> and <code>configFile</code> in the workspace settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-07-03 05:25</div>
            <div class="timeline-body"><p>Thanks for the suggestions! Micha is planning to look into the entire spectrum (multiple workspaces, multiple ty projects in a single workspace, multi-root workspaces, mono-repository support) this month. It&#x27;s a bit more complicated than it looks and we need to spend some time thinking through the design first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-07-03 06:15</div>
            <div class="timeline-body"><p>Totally get it. Since full monorepo support is complicated, maybe we can add the <code>ty.configFile</code> or even <code>ty.args</code> setting first, so we can start to test it in our monorepo. We know ty isn&#x27;t production ready yet, but ty is so awesome that we can&#x27;t help but try it out. ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluecoconut">@bluecoconut</a> on 2025-07-04 02:57</div>
            <div class="timeline-body"><p>I&#x27;m not sure if this is related, but I just found out about <code>projects</code> via this extension: https://github.com/microsoft/vscode-python-environments which seems like a great way to manage which interpreter is selected per file and related to the greater issue of python mono-repos in vscode.</p>
<p>By right-clicking on the folder in the Explorer fold, I was able to add the folder as a &quot;project&quot;. After this, <code>ruff</code> handled this very well, but <code>ty</code> didn&#x27;t, which I suspect is known so I&#x27;m anecdotally reporting that experience here.</p>
<p>For now, I have a single <code>ty.toml</code> at the top of my project and I have to manually switch it to the project directory I&#x27;m working in.</p>
<p>I&#x27;m very excited for this feature to get supported!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Beta&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-08-15 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/faroukcharkas">@faroukcharkas</a> on 2025-09-29 17:57</div>
            <div class="timeline-body"><p>I was running into persistent <code>ty(unresolved-import)</code> linting errors in my IDE (Cursor / VSCode) when running in a monorepo, even though running <code>uv ty check</code> in the CLI did not show those errors.</p>
<p>My project structure looked like this:</p>
<pre><code>server/
  src/
    modules/
      module_a/
  app.py   # Error said it couldn’t find module_a
client/
README.md
</code></pre>
What I had before
<p>My VSCode <code>settings.json</code>:</p>
<pre><code>{
  &quot;ty.importStrategy&quot;: &quot;fromEnvironment&quot;,
  &quot;ty.interpreter&quot;: [&quot;${workspaceFolder}/server/.venv/bin/python&quot;],
  &quot;ty.diagnosticMode&quot;: &quot;workspace&quot;,
  &quot;ty.path&quot;: [&quot;${workspaceFolder}/server/.venv/ty&quot;]
}
</code></pre>
<p>My <code>pyproject.toml</code>:</p>
<pre><code>[tool.ty.environment]
root = [&quot;.&quot;]
python = &quot;./.venv&quot;
</code></pre>
<p>With this setup:</p>
<ul>
<li><strong>CLI (<code>uv ty check</code>) worked fine.</strong></li>
<li><strong>IDE still showed unresolved imports.</strong></li>
</ul>
What fixed it
<p>I added a <code>ty.toml</code> at the <strong>project root</strong> (same level as <code>server/</code> and <code>client/</code>) with:</p>
<pre><code>[environment]
root = [&quot;./server&quot;]
</code></pre>
<p>After that, the IDE immediately resolved imports correctly. This was super frustrating to debug, so hopefully this helps others who hit the same issue.</p>
<p>(Used AI to clean up my thought process)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akvadrako">@akvadrako</a> on 2025-12-07 09:27</div>
            <div class="timeline-body"><p>Wouldn&#x27;t it make sense for ty to look for the closest pyproject.yaml file and use that? Then it would work without configuration. So for example:</p>
<pre><code>/pyproject.yaml
/client/
/client/pyproject.yaml # ← this root would be used
/client/src/file.py    # ← for this source
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-07 10:30</div>
            <div class="timeline-body"><p>ty already uses the closest pyproject.toml to where you run ty from. What&#x27;s currently not supported is that ty uses the closest pyproject.toml closest to the checked file. Changing this isn&#x27;t trivial, depending on what settings you want to override but is something we want to explore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/raylu">@raylu</a> on 2025-12-12 20:02</div>
            <div class="timeline-body"><p>is there any workaround for this right now? it doesn&#x27;t seem like there&#x27;s an easy way to set the cwd of ty</p>
<p>but even doing it the hard way doesn&#x27;t seem to work
I tried setting <code>ty.path</code> to <code>${workspaceFolder}/scripts/ty-vsc</code> which is</p>
<pre><code>#!/usr/bin/env sh
cd subdir
exec venv/bin/ty &quot;$@&quot;
</code></pre>
<p>effectively hardcoding our <code>python.defaultInterpreterPath</code>
but it still seems to be ignoring <code>subdir/pyproject.toml</code> (I have <code>invalid-argument-type = &#x27;ignore&#x27;</code> but it complains about <code>invalid-argument-type</code>), even though the <code>PWD</code> is set to subdir correctly (at least according to <code>ps eww</code>)
<code>ty server</code> also doesn&#x27;t take <code>--config-file</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-12-13 11:35</div>
            <div class="timeline-body"><blockquote>
<p>is there any workaround for this right now? it doesn&#x27;t seem like there&#x27;s an easy way to set the cwd of ty</p>
</blockquote>
<p>What we are doing now is creating a multi-root workspace and putting the target sub-project dir as the first one, then the root dir as the second one. ty-vscode currently will always pick the first workspace. The downside is that you need to create a separate workspace file for each Python sub-project. It&#x27;s acceptable for us now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-12-13 13:06</div>
            <div class="timeline-body"><p>The latest release (on dec 12th) came with some improvements to how we resolve imports in monorepos. Whether this improves your usecase depends on which specific issues you had.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astrojuanlu">@astrojuanlu</a> on 2025-12-17 10:13</div>
            <div class="timeline-body"><p>Came here to report the same thing. My use case is: a single workspace with different folders.</p>
<p>Even though my folders have a Python interpreter configured (a different one for each, coming from a <code>.venv</code>), I see this in the ty extension logs:</p>
<pre><code>2025-12-17 11:04:46.990 [info] Python extension loaded
2025-12-17 11:04:47.090 [error] Python interpreter missing:
[Option 1] Select Python interpreter using the ms-python.python.
[Option 2] Set an interpreter using &quot;ty.interpreter&quot; setting.
Please use Python 3.8 or greater.
</code></pre>
<p>You can seemingly configure <code>ty.interpreter</code> at the Workspace level, but not at the Folder level. If I set it to <code>${workspaceFolder}/.venv/bin/python</code>, I see a popup with this content:</p>
<pre><code>Multiple workspaces are not yet supported, using the first workspace: ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AnirudhKonduru">@AnirudhKonduru</a> on 2025-12-17 19:44</div>
            <div class="timeline-body"><p>It&#x27;ll would also to be nice to support <a href="https://peps.python.org/pep-0723/">PEP-723</a> scripts, and use the same interpreter and environment that <code>uv run</code> would execute the script with, disregarding the project&#x27;s interpreter and environment if it exists.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-18 08:58</div>
            <div class="timeline-body"><p>@AnirudhKonduru see <a href="https://github.com/astral-sh/ty/issues/691">astral-sh/ty#691</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Pre-stable 1&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Mono-repo support&quot; to &quot;Server: Mono-repo support&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 09:22</div>
            <div class="timeline-body"><p>See <a href="https://github.com/astral-sh/ty/issues/1554">astral-sh/ty#1554</a> for more discussions on design and a prototype of one approach.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 10:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:01 UTC
    </footer>
</body>
</html>
