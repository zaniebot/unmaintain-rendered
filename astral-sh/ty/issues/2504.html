<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty seems to not understand that the decorator creates a dataclass and says can't find __init__ - astral-sh/ty #2504</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty seems to not understand that the decorator creates a dataclass and says can't find <strong>init</strong></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2504">#2504</a>
        opened by <a href="https://github.com/pumetu">@pumetu</a>
        on 2026-01-15 02:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pumetu">@pumetu</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have the following code snippet where it accepts a class and returns a dataclass, however, when I use the function as a decorator <code>ty</code> says there's an error as it tries to look for the <code>__init__</code> function. If i add the <code>@dataclasses.dataclass</code> decorator the error is gone. I'm not sure if this is a bug or is it the expected behavior.</p>
<pre><code class="language-python">def pytree_dataclass(cls, meta_fields: tuple = ()):
    cls = dataclass(cls)
    all_fields = tuple(f.name for f in fields(cls) if f.init)
    data_fields = tuple(f for f in all_fields if f not in meta_fields)
    return jax.tree_util.register_dataclass(cls, data_fields=data_fields, meta_fields=meta_fields)

@partial(pytree_dataclass, meta_fields=(&quot;shape&quot;, &quot;dtype&quot;, &quot;initializer&quot;))
@dataclass(frozen=True)
class Spec:
    shape: tuple[int, ...]
    dtype: jnp.dtype
    initializer: Callable | None = None

@pytree_dataclass
class Linear(Module):
    weight: jax.Array | Spec
    bias: jax.Array | Spec | None

    @classmethod
    def spec(cls, in_features: int, out_features: int, dtype: jnp.dtype, bias: bool = False):
        _init = jax.nn.initializers.he_normal()
        return cls(
            weight=Spec(shape=(in_features, out_features), dtype=dtype, initializer=_init),
            bias=Spec(shape(1, out_features), dtype=dtype, initializer=_init) if bias else None,
        )
</code></pre>
<p>The error message</p>
<pre><code>Diagnostics:
1. ty: Argument `weight` does not match any known parameter of bound method `__init__` [unknown-argument]
</code></pre>
<h3>Version</h3>
<p>ty 0.0.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-15 06:24</div>
            <div class="timeline-body"><p>Thanks for the report! This is expected behavior. Neither ty (nor any other Python type checker) can look through several layers of (un-annotated) decorator code here and figure out that <code>pytree_dataclass</code> turns the given class into a dataclass.</p>
<p>But there is a type system feature that allows you to declare this to the type system: https://typing.python.org/en/latest/spec/dataclasses.html#the-dataclass-transform-decorator  You can apply this to <code>pytree_dataclass</code> and get the behavior you are looking for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2026-01-15 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pumetu">@pumetu</a> on 2026-01-15 08:57</div>
            <div class="timeline-body"><p>Thank you so much for the reply and the pointer to the docs @carljm!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-15 09:48:46 UTC
    </footer>
</body>
</html>
