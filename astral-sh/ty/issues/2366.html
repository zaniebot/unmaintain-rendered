<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add option to limit auto-import completions to direct dependencies - astral-sh/ty #2366</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add option to limit auto-import completions to direct dependencies</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2366">#2366</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2026-01-06 14:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This idea was offered here: https://github.com/astral-sh/ty/issues/2254#issuecomment-3703049537</p>
<p>It strikes me as a decent option to have. I don't know what's conventional in the Python ecosystem, but &quot;I only want to import things from dependencies I've directly added and not from transitive dependencies that I don't directly depend on&quot; seems reasonable.</p>
<p>This could be viewed as both a UX improvement (you're offered fewer completions that you don't care about) and as a perf improvement (we don't need to consider exported items from non-direct dependencies).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @BurntSushi on 2026-01-06 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @BurntSushi on 2026-01-06 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by @BurntSushi on 2026-01-06 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-06 14:49</div>
            <div class="timeline-body"><p>Would this require us to parse <code>pyproject.toml</code> / requirements.txt files (I don't mind it, just curious)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-06 14:52</div>
            <div class="timeline-body"><p>An alternative is to at least consider whether a symbol is from a direct dependency when ranking the completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-06 14:53</div>
            <div class="timeline-body"><blockquote>
<p>Would this require us to parse <code>pyproject.toml</code> / requirements.txt files (I don't mind it, just curious)</p>
</blockquote>
<p>I believe so, yes. Unless there's something in a virtual environment that I'm unaware of that distinguishes between direct vs non-direct dependencies.</p>
<blockquote>
<p>An alternative is to at least consider whether a symbol is from a direct dependency when ranking the completions.</p>
</blockquote>
<p>This would get the UX improvement but not the perf improvement. The perf improvement might be the best way to tackle something like #2254 without asking users to disable auto-import entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @Gankra on 2026-01-06 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-06 16:57</div>
            <div class="timeline-body"><p>Speaking with @zanieb, they suggested (and I agree) that enabling this option by default when there is a <code>pyproject.toml</code> might be desirable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2026-01-06 17:04</div>
            <div class="timeline-body"><p>This would have a bad interaction with metapackages, right? (packages which only exist to depend on a cluster of packages so you can depend on them all with one dependency).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-06 17:06</div>
            <div class="timeline-body"><p>Yeah. I think that's at least part of the reason why this should be configurable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-06 17:14</div>
            <div class="timeline-body"><blockquote>
<p>Unless there's something in a virtual environment that I'm unaware of that distinguishes between direct vs non-direct dependencies.</p>
</blockquote>
<p>nope!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-06 17:15</div>
            <div class="timeline-body"><blockquote>
<p>This would have a bad interaction with metapackages, right? (packages which only exist to depend on a cluster of packages so you can depend on them all with one dependency).</p>
</blockquote>
<p>Are those common? I don't think those are particularly idiomatic in the Python ecosystem. (But to be clear, I'm not objecting to having a mechanism to opt out of this behaviour, that seems fine. Though I agree that it should probably be the default to exclude non-direct dependencies; that seems good!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/toppk">@toppk</a> on 2026-01-11 06:17</div>
            <div class="timeline-body"><p>Sorry to add more suggestions here (especially since I've only started to test ty, and havent' actually switch my LSP to it just yet), but I'm wondering if this direct dependency will ignore python default packages, for example typing.  Also, if the user has an existing from randompackage import Foo, would auto-import of Bar look inside randompackage even if it was not a direct dependency?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-12 13:12</div>
            <div class="timeline-body"><blockquote>
<p>but I'm wondering if this direct dependency will ignore python default packages, for example typing.</p>
</blockquote>
<p>No. Since the stdlib is an implicit but direct dependency. It's always available.</p>
<blockquote>
<p>Also, if the user has an existing from randompackage import Foo, would auto-import of Bar look inside randompackage even if it was not a direct dependency?</p>
</blockquote>
<p>That's a good question. I think I would assume not, but I'd be curious as to why <code>randompackage</code> isn't a direct dependency yet is being imported from directly.</p>
<p>Keep in mind that I think we'd only have this behavior when a <code>pyproject.toml</code> is present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-12 13:14</div>
            <div class="timeline-body"><blockquote>
<p>That's a good question. I think I would assume not, but I'd be curious as to why <code>randompackage</code> isn't a direct dependency yet is being imported from directly.</p>
</blockquote>
<p>Right, that's a bit of an antipattern</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:42 UTC
    </footer>
</body>
</html>
