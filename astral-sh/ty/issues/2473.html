<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missing inference for overloaded decorator function with optional params - astral-sh/ty #2473</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Missing inference for overloaded decorator function with optional params</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2473">#2473</a>
        opened by <a href="https://github.com/keatingw">@keatingw</a>
        on 2026-01-13 01:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/keatingw">@keatingw</a></div>
            <div class="timeline-body">Summary
<p>When using an overloaded decorator that can be used both bare (<code>@deco</code>) and with arguments (<code>@deco()</code>), <code>ty</code> correctly infers the type for the bare usage but fails for the parenthesized call.</p>
<p>I&#x27;ve seen this with libraries like <code>tenacity</code> making use of heavily-parameterized decorators but can replicate with the below example. This cuts across a few pieces with <code>ParamSpec</code>, <code>overload</code> and the decoration/nesting of <code>Callable</code> so I&#x27;m not 100% sure on the cause.</p>
<pre><code>from typing import Callable, TypeVar, ParamSpec, overload, reveal_type

P = ParamSpec(&quot;P&quot;)
R = TypeVar(&quot;R&quot;)

@overload
def deco(fn: Callable[P, R]) -&gt; Callable[P, R]: ...

@overload
def deco(*, arg: int = 0) -&gt; Callable[[Callable[P, R]], Callable[P, R]]: ...

def deco(
    fn: Callable[P, R] | None = None,
    *,
    arg: int = 0
) -&gt; Callable[P, R] | Callable[[Callable[P, R]], Callable[P, R]]:
    def decorator(fn: Callable[P, R]) -&gt; Callable[P, R]:
        def wrapper(*args: P.args, **kwargs: P.kwargs) -&gt; R:
            print(&quot;decorated with args&quot;)
            return fn(*args, **kwargs)
        return wrapper

    if fn is not None:
        def wrapper(*args: P.args, **kwargs: P.kwargs) -&gt; R:
            print(&quot;decorated&quot;)
            return fn(*args, **kwargs)
        return wrapper
    return decorator

@deco
def func1(x: int)-&gt;int:
    return x

@deco()
def func2(x: int)-&gt;int:
    return x

reveal_type(func1)  # Revealed type: `(x: int) -&gt; int`
reveal_type(func2)  # Revealed type: `(...) -&gt; Unknown`
</code></pre>
<p><a href="https://play.ty.dev/9cf502eb-ae92-45f9-b271-6792cae4876d">Playground link</a></p>
<p>mypy and <a href="https://pyright-play.net/?code=GYJw9gtgBALgngBwJYDsDmUkQWEMoDCAhgDYlEBGJApgDRQAqi1AakSPQArtEQDKCagGN6YAG7UQJMEQAm9ENQmkA%2BvEEAoDZygBeKNxC8BwgBQAiTuYCUGgEp7GzNiAt2bWgALjJ0uRtlqYChAoTBTYBQALkJScipqAG1OejsAXWsoAFoAPliyShpk1LSYgDoKrx8pGVkAoJDhcIAqenY0GNR8fQAGTNz8%2BKLE4gKE4qh0tPpRoaSUybTSqAqyrUDg0PCNKF2oSJjZwvmSqAAfKAA5MBRqR2vb2h291ufd9s6UbqgejX68o7jBbpc6DY6JEZxcHApYzKFAkqlN6NTZNIwwXARaJghGLf44oowqLIvYoqAAdyMCEErma7QAzjFOGUGfRms0ANbkhlMspchn4uzE0kivYIEBdCxbdHUWQUpAwAAWUAZHlFosUMAAriAUPsUKY6SA0PS2Zzucb6bZ1VBNTq9ZSiNTJFpSUhgpFMPSoCgwPgHtRheqNhSqTTDTyDCzLWb%2BZbeXGTYKgzbduLJeZpUQYLK1andnbdfqIzGoOzE1aSXtCw6wy7STXGmF0bgvFt6h6tSghABGUwAD0%2BMGsuS6Kdt1G1Rf7baaplsIeAXaEACYB0ORzkx8jGzONIplCQ1MwIsue7YD9RVOpqKfuyvrEA">Pyright</a> both correctly infer the same <code>(x: int) -&gt; int</code> for both cases</p>
<p>Thanks so much for your great work on <code>ty</code>!</p>
Version
<p>Playground (3ae4db3cc)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Inference issue for overloaded decorator function with optional params&quot; to &quot;Missing inference for overloaded decorator function with optional params&quot; by <a href="https://github.com/keatingw">@keatingw</a> on 2026-01-13 01:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-13 01:28</div>
            <div class="timeline-body"><p>Thanks for the report! This is <a href="https://github.com/astral-sh/ty/issues/1136">astral-sh/ty#1136</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2026-01-13 01:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:06 UTC
    </footer>
</body>
</html>
