<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUG: `Literal` type decays to `Unknown | str` within a listcomp - astral-sh/ty #1796</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>BUG: <code>Literal</code> type decays to <code>Unknown | str</code> within a listcomp</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1796">#1796</a>
        opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a>
        on 2025-12-07 17:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-12-07 17:15</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I made an attempt at finding an existing report for this but I think I miss the vocabulary to describe this problem in a searchable way; so apologies if this is a duplicate.</p>
<p>In short, here's an MRE</p>
<pre><code class="language-py"># t.py
from typing import Literal

Fruit = Literal[&quot;banana&quot;, &quot;kiwi&quot;]

def eat_fruit(frt: Fruit) -&gt; int:
    print(f&quot;Hum... {frt}&quot;)
    return 1

def process(frt: Fruit, other: Fruit):
    a, b = [eat_fruit(f) for f in [frt, other]]
</code></pre>
<p>I believe this code is perfectly type-consistent, however <code>ty check</code> does emit a diagnostic for it</p>
<pre><code>‚ùØ ty check t.py
error[invalid-argument-type]: Argument to function `eat_fruit` is incorrect
  --&gt; t.py:10:23
   |
 9 | def process(frt: Fruit, other: Fruit):
10 |     a, b = [eat_fruit(f) for f in [frt, other]]
   |                       ^ Expected `Literal[&quot;banana&quot;, &quot;kiwi&quot;]`, found `Unknown | str`
   |
info: Element `str` of this union is not assignable to `Literal[&quot;banana&quot;, &quot;kiwi&quot;]`
info: Function defined here
 --&gt; t.py:5:5
  |
3 | Fruit = Literal[&quot;banana&quot;, &quot;kiwi&quot;]
4 |
5 | def eat_fruit(frt: Fruit) -&gt; int:
  |     ^^^^^^^^^ ---------- Parameter declared here
6 |     print(f&quot;Hum... {frt}&quot;)
7 |     return 1
  |
info: rule `invalid-argument-type` is enabled by default

Found 1 diagnostic
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.32 (84a188116 2025-12-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "BUG: `Literal` type decays to `Unknown | str` within a listcomp" to "BUG: `Literal` type decays to `Unknown | str`" by @neutrinoceros on 2025-12-07 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "BUG: `Literal` type decays to `Unknown | str`" to "BUG: `Literal` type decays to `Unknown | str` within a listcomp" by @neutrinoceros on 2025-12-07 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-07 18:25</div>
            <div class="timeline-body"><p>Thank you! I believe this is https://github.com/astral-sh/ty/issues/1602. We don't currently propagate type context (provided here by the parameter annotations <code>frt: Fruit</code> and <code>other: Fruit</code>) from outer scopes into inner scopes. (An inner scope is created implicitly by the list comprehension.) In order to infer the <code>[frt, other]</code> list inside the list comprehension as <code>list[Fruit]</code> rather than <code>list[str | Unknown]</code>, that's what we need to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-12-07 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-12-07 19:12</div>
            <div class="timeline-body"><p>Excellent. Will follow the discussion there. Thanks a lot !</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:41:23 UTC
    </footer>
</body>
</html>
