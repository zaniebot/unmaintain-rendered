<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support pointing to a system-installation Python executable with `--python` on Windows - astral-sh/ty #556</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support pointing to a system-installation Python executable with <code>--python</code> on Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/556">#556</a>
        opened by <a href="https://github.com/Andrej730">@Andrej730</a>
        on 2025-05-31 07:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Andrej730">@Andrej730</a> on 2025-05-31 07:39</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><em>Creating a separate issue based on https://github.com/astral-sh/ty/issues/272#issuecomment-2923071089</em></p>
<p>I think there is an expectation from user pov that by default when you do <code>ty check xxx.py</code>, if there's no virtual environment around, that it would use system python environment. It serves well for type checking simple scripts or for other cases when there is not venv used.</p>
<p>E.g. currently <code>python</code> in my system is Python 3.11, but running <code>ty check xxx.py</code> is using Python 3.13 (<code>Python version: Python 3.13, platform: win32</code> from <code>-vv</code>) and it doesn't detect the system installed dependencies.</p>
<p>What would be current way to accomplish this?</p>
<p>Currently it's focused only on venvs (https://github.com/astral-sh/ty/blob/main/docs/README.md#python-environment). There is an option to provide path to executable as <code>--python</code>, but it's only for for venvs too.</p>
<p>What I've tried (don't mind <code>UV_PYTHON_INSTALL_DIR</code>, I do use <code>uv</code> for system python's dependency management, but it behaves the same as usual system python, also tried with usual system Python from python.org).</p>
<pre><code class="language-sh">ty check test.py -vv --python L:\Software\uv\UV_PYTHON_INSTALL_DIR\cpython-3.11.12-windows-x86_64-none\python.exe
ty check test.py -vv --python L:\Software\Python311\python.exe
# That probably would be too advanced
ty check test.py -vv --python &quot;C:\Users\Andrej\.local\bin\python.exe&quot;
</code></pre>
<p>Trying things out I've also noticed there could be an expectation that something like this would work:</p>
<pre><code class="language-sh">uv tool run --python 3.11 ty check test.py -vv
</code></pre>
<p>The only alternative I've found is to create a &quot;system venv&quot; and point to it, which does work for my odd setup with <code>uv</code> managed system python that has system venv either way, but it's probably not a good general solution.</p>
<pre><code>ty check test.py --python L:\Software\uv\systemvenv\.venv\Scripts\python.exe
ty check test.py --python L:\Software\uv\systemvenv\.venv
</code></pre>
<h3>Version</h3>
<p>ty 0.0.1-alpha.7 (afb20f6fe 2025-05-26)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by @carljm on 2025-05-31 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-31 15:11</div>
            <div class="timeline-body"><p>You can use <code>--python</code> with a system path, e.g.:</p>
<pre><code>‚ùØ uvx ty check --python /usr/local -vv example.py
2025-05-31 10:07:32.697717 WARN ty is pre-release software and not ready for production use. Expect to encounter bugs, missing features, and fatal errors.
2025-05-31 10:07:32.704935 DEBUG Version: 0.0.1-alpha.7 (afb20f6fe 2025-05-26)
2025-05-31 10:07:32.705019 DEBUG Architecture: aarch64, OS: macos, case-sensitive: case-insensitive
2025-05-31 10:07:32.705041 DEBUG Searching for a project in '/Users/zb/workspace/uv'
2025-05-31 10:07:32.705236 DEBUG Resolving requires-python constraint: `&gt;=3.8`
2025-05-31 10:07:32.705248 DEBUG Resolved requires-python constraint to: 3.8
2025-05-31 10:07:32.705273 DEBUG Project without `tool.ty` section: '/Users/zb/workspace/uv'
2025-05-31 10:07:32.705286 DEBUG Searching for a user-level configuration at `/Users/zb/.config/ty/ty.toml`
2025-05-31 10:07:32.705305 INFO Defaulting to python-platform `darwin`
2025-05-31 10:07:32.705316 DEBUG Defaulting `src.root` to `.`
2025-05-31 10:07:32.705327 INFO Python version: Python 3.8, platform: darwin
2025-05-31 10:07:32.705336 DEBUG Adding first-party search path '/Users/zb/workspace/uv'
2025-05-31 10:07:32.705361 DEBUG Using vendored stdlib
2025-05-31 10:07:32.705725 DEBUG Resolving `--python` argument: /usr/local
2025-05-31 10:07:32.705752 DEBUG Attempting to parse virtual environment metadata at '/usr/local/pyvenv.cfg'
2025-05-31 10:07:32.705761 DEBUG Searching for site-packages directory in `sys.prefix` path `/usr/local`
2025-05-31 10:07:32.705871 DEBUG Resolved site-packages directories for this environment are: [&quot;/usr/local/lib/python3.14/site-packages&quot;]
2025-05-31 10:07:32.705881 DEBUG Adding site-packages search path '/usr/local/lib/python3.14/site-packages'
...
</code></pre>
<p>We don't infer the Python version from there yet, but we could in the future (as in https://github.com/astral-sh/ruff/pull/18057).</p>
<p>I think we could tweak the logic for <code>--python &lt;executable&gt;</code> to work in more cases, too.</p>
<p>The general idea is that robust system Python environment detection is quite complicated, and we'll leverage uv for that functionality eventually. It's intentionally minimal right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Andrej730">@Andrej730</a> on 2025-05-31 15:47</div>
            <div class="timeline-body"><p>Oh, I see using a directory path (not an executable path) works.</p>
<pre><code class="language-sh">ty check test.py -vv --python L:\Software\uv\UV_PYTHON_INSTALL_DIR\cpython-3.11.12-windows-x86_64-none
ty check test.py -vv --python L:\Software\Python311
</code></pre>
<p>I'll use a shortcut for now that adds <code>--python xxx\yyy</code> to <code>ty check</code> call to solve the problem with the system dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-31 17:59</div>
            <div class="timeline-body"><p>Ah, using <code>--python</code> to point to an executable should work as well, but I think our support for that right now might be buggy on Windows, looking at it! On Unix, the Python executable for a system or virtual environment is located at <code>&lt;sys.prefix&gt;/bin/python</code>. But on Windows, the Python executable is at a different location for a system environment than it is for a virtual environment. For a virtual environment, the executable on Windows will be located at <code>&lt;sys.prefix&gt;\Scripts\python.exe</code>, but for a system environment, the executable will be located at <code>&lt;sys.prefix&gt;\python.exe</code>.</p>
<p>If I'm correct here, I think the logic here needs to be updated for Windows: https://github.com/astral-sh/ruff/blob/aa1fad61e0f9fe0c7faac876f2ef55cd3817fc6c/crates/ty_python_semantic/src/module_resolver/resolver.rs#L260-L278</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @AlexWaygood on 2025-05-31 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ty to recognize system python and it's packages" to "Support pointing to a Python executable with `--python` on Windows" by @AlexWaygood on 2025-05-31 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Support pointing to a Python executable with `--python` on Windows" to "Support pointing to a system-installation Python executable with `--python` on Windows" by @AlexWaygood on 2025-05-31 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-05-31 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2025-06-01 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-06-05 07:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Andrej730">@Andrej730</a> on 2025-06-17 17:56</div>
            <div class="timeline-body"><p>Thank you, can confirm as fixed.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:39:48 UTC
    </footer>
</body>
</html>
