<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type checker fails to recognize a module as a valid implementation of a Protocol - astral-sh/ty #931</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Type checker fails to recognize a module as a valid implementation of a Protocol</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/931">#931</a>
        opened by <a href="https://github.com/wvlab">@wvlab</a>
        on 2025-08-03 15:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/wvlab">@wvlab</a></div>
            <div class="timeline-body">Summary
<p>The <code>ty</code> type checker appears to incorrectly flag a type error when a module is used to satisfy a <code>typing.Protocol</code>. According to Python&#x27;s official typing documentation, <a href="https://typing.python.org/en/latest/spec/protocol.html#modules-as-implementations-of-protocols">modules can serve as implementations for protocols</a>, a feature that is correctly handled by other type checkers like Mypy and Pyright.</p>
<p>When running mypy, pyright or pyrefly on the project, type checkers pass without any errors, correctly identifying that the <code>bar</code> module is a valid implementation of the <code>Proto</code> protocol.</p>
Code to Reproduce
<p>Here is a minimal set of code that demonstrates the issue.</p>
<ol>
<li><p>The Protocol Definition (<code>behavior.py</code>):
A simple protocol that requires a <code>foo</code> function.</p>
<pre><code>from typing import Protocol

class Proto(Protocol):
    def foo(self, x: int) -&gt; str: ...
</code></pre>
</li>
<li><p>The Module Implementation (<code>bar.py</code>):
A module with a function that structurally conforms to the protocol.</p>
<pre><code>def foo(x: int) -&gt; str:
    return f&quot;6{x}9&quot;
</code></pre>
</li>
<li><p>The Type Check (<code>main.py</code>):
The <code>bar</code> module is assigned to a variable annotated with the <code>Proto</code> type.</p>
<pre><code>import behavior
import bar

behavior.consume(bar)
_: behavior.Proto = bar
</code></pre>
</li>
</ol>
Full Reproducible Example
<p>You can reproduce it in <a href="https://play.ty.dev/4dfa5c69-831d-41ee-a1e2-22e079b75fc5">playground</a></p>
<p>I have also uploaded the complete, self-contained project to a public GitHub repository. You can clone it and run the type checkers to see the issue firsthand: <a href="https://github.com/wvlab/example-python-module-protocols">wvlab/example-python-module-protocols</a></p>
<p>To reproduce:</p>
<pre><code>git clone https://github.com/wvlab/example-python-module-protocols.git mre &amp;&amp; cd mre
uv sync --frozen
source .venv/bin/activate
./run_type_checkers.sh
</code></pre>
<code>ty</code> Output
<pre><code>&gt; ty check
error[invalid-argument-type]: Argument to function `consume` is incorrect
  --&gt; src/example_module_protocols/main.py:9:28
   |
 8 | def main() -&gt; None:
 9 |     print(behavior.consume(bar))
   |                            ^^^ Expected `Proto`, found `&lt;module &#x27;example_module_protocols.implementations.bar&#x27;&gt;`
10 |     _: behavior.Proto = bar
11 |     return
   |
info: Function defined here
  --&gt; src/example_module_protocols/behavior.py:9:5
   |
 7 |     def foo(self, x: int) -&gt; str: ...
 8 |
 9 | def consume(proto: Proto) -&gt; str:
   |     ^^^^^^^ ------------ Parameter declared here
10 |     return proto.foo(5)
   |
info: rule `invalid-argument-type` is enabled by default

error[invalid-assignment]: Object of type `&lt;module &#x27;example_module_protocols.implementations.bar&#x27;&gt;` is not assignable to `Proto`
  --&gt; src/example_module_protocols/main.py:10:5
   |
 8 | def main() -&gt; None:
 9 |     print(behavior.consume(bar))
10 |     _: behavior.Proto = bar
   |     ^
11 |     return
   |
info: rule `invalid-assignment` is enabled by default
</code></pre>
Version
<p>ty 0.0.1-alpha.16 (e48b66fd7 2025-07-31)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">Protocols</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-08-04 06:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/AlexWaygood">@AlexWaygood</a> by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-08-04 12:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-08-15 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Beta&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-08-15 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;GA&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-08-15 15:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:12 UTC
    </footer>
</body>
</html>
