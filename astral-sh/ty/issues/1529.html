<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>error[unresolved-import] in modules with special names - astral-sh/ty #1529</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>error[unresolved-import] in modules with special names</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1529">#1529</a>
        opened by <a href="https://github.com/FaneTheEternal">@FaneTheEternal</a>
        on 2025-11-12 08:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/FaneTheEternal">@FaneTheEternal</a></div>
            <div class="timeline-body">Summary
<p>Sample structure</p>
<pre><code>project/
├── mod1/
│   ├── __init__.py
│   ├── consts.py
│   └── def.py
└── main.py
</code></pre>
<p>In <code>mod1/def.py</code></p>
<pre><code>from . import consts
</code></pre>
<p>On <code>uvx ty check</code></p>
<pre><code>error[unresolved-import]: Cannot resolve imported module `.`
 --&gt; mod1\def.py:1:1
  |
1 | from . import consts
  | ^^^^^^^^^^^^^^^^^^^^
  |
info: rule `unresolved-import` is enabled by default
</code></pre>
<p>If rename <code>def.py</code> to <code>define.py</code> the error will disappear</p>
Version
<p>ty 0.0.1-alpha.26 (b225fd8b4 2025-11-10)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">imports</span> added by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-11-12 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-12 10:47</div>
            <div class="timeline-body"><p>I think this is because we enforce that each segment passed to <code>ModuleName::new</code> is a valid module name and <code>def</code> isn&#x27;t a valid module name.</p>
<p>However, <code>def</code> being a valid module name is only important when trying to import it, not when trying to import another module from <code>def.py</code>.</p>
<p>I remember having seen a similar issue where relative imports fail if any folder between the python file and the first search root contains an invalid name. E.g. if you have <code>web/backend-core/module.py</code> and the src root is <code>/</code>, any relative import within <code>web/backend-core</code> fails because <code>backend-core</code> isn&#x27;t a valid module name</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FaneTheEternal">@FaneTheEternal</a> on 2025-11-12 11:09</div>
            <div class="timeline-body"><p>It seems that this is purely a syntactic limitation.
<code>main.py</code></p>
<pre><code>import ast

try:
    eval(&quot;from mod1 import def&quot;, globals())
except SyntaxError as e:
    pass
assert &quot;def&quot; not in globals()

import_def = ast.Module(
    body=[
        ast.ImportFrom(
            module=&quot;mod1&quot;,
            names=[
                ast.alias(
                    name=&quot;def&quot;,
                    lineno=0,
                    col_offset=0,
                ),
            ],
            level=0,
            lineno=0,
            col_offset=0,
        )
    ],
    type_ignores=[],
)
eval(compile(import_def, &quot;&lt;ast&gt;&quot;, mode=&quot;exec&quot;), globals())
assert &quot;def&quot; in globals()
</code></pre>
<p>P.s. In our django project, we import the modules of the same name from each application using <code>importlib.import_module</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-12 11:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-11-12 15:05</div>
            <div class="timeline-body"><blockquote>
<p>However, <code>def</code> being a valid module name is only important when trying to import it, not when trying to import another module from <code>def.py</code>.</p>
</blockquote>
<p>This isn&#x27;t (currently) true for our implementation of relative imports, where the first step is &quot;resolve my own module name&quot; so then we can resolve the relative import relative to it.</p>
<p>That&#x27;s the same reason it would fail if there&#x27;s an invalid module name in the path from search root to current file.</p>
<p>Maybe we need a less-strict version of &quot;resolve my own module name&quot; to use in this case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-14 08:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-14 09:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:57 UTC
    </footer>
</body>
</html>
