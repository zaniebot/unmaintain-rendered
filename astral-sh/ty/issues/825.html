<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(游꾸) use markup for diagnostics in lsp to codify backtics - astral-sh/ty #825</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>(游꾸) use markup for diagnostics in lsp to codify backtics</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/825">#825</a>
        opened by <a href="https://github.com/KotlinIsland">@KotlinIsland</a>
        on 2025-07-15 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2025-07-15 09:24</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>i think it would be cool to render backtics from messages as code blocks inside the ide, but i can't do it due to the dynamic nature of messages:</p>
<pre><code class="language-py">reveal_type(&quot;`&quot;)  # Revealed type: `Literal[&quot;`&quot;]`
</code></pre>
<p>lsp 3.18 supports markup in diagnostics: https://microsoft.github.io/language-server-protocol/specifications/lsp/3.18/specification/#diagnostic</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-15 09:28</div>
            <div class="timeline-body"><p>What API are we speaking about here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2025-07-15 10:16</div>
            <div class="timeline-body"><p>lsp API, can't imagine there would be a need for the CLI API for use with ide integration</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-15 11:08</div>
            <div class="timeline-body"><p>We currently use the same interface for the LSP and CLI and I was asking because we also need to think about if we want this behavior in a JSON output format or not.</p>
<p>this issue is also not specific to reveal type, it exists everywhere where we render a type in a diagnostic.</p>
<p>Escaping the backtick doesn't sound unreasonable but it might be confusing in the CLI or other output formats. That's why it spend some time investing what other tools to in these situations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "(游꾸) provide an option for escaped backtics in messages" to "(游꾸) provide an option for escaped backticks in messages" by @AlexWaygood on 2025-07-15 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-07-16 01:52</div>
            <div class="timeline-body"><p>I don't think escaping backticks is the way to go here, since it may just not work. For example:</p>
<pre><code class="language-markdown">`Literal[&quot;\`&quot;]`
</code></pre>
<blockquote>
<p><code>Literal[&quot;\</code>&quot;]`</p>
</blockquote>
<p>That is, <code>&lt;code&gt;Literal[&amp;quot;\&lt;/code&gt;&amp;quot;]`</code> in HTML (<a href="https://spec.commonmark.org/dingus/?text=%60Literal%5B%22%5C%60%22%5D%60">same for CommonMark</a>).</p>
<hr />
<p>A better approach is to find the shortest sequence of backticks that the message itself does not contain:</p>
<pre><code class="language-markdown">``Literal[&quot;`&quot;]``
```Literal[&quot;``&quot;]```
</code></pre>
<blockquote>
<p><code>Literal[&quot;`&quot;]</code> <br />
<code>Literal[&quot;``&quot;]</code></p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2025-07-16 02:00</div>
            <div class="timeline-body"><blockquote>
<p>We currently use the same interface for the LSP and CLI</p>
</blockquote>
<p>i suppose it wouldn't affect anything if the effect was globally applied, as i would imagine this would be an argument sent when initializing the server</p>
<blockquote>
<p>this issue is also not specific to reveal type, it exists everywhere where we render a type in a diagnostic.</p>
</blockquote>
<p>i understand, this would be desired behaviour. rendering all messages with code blocks would be a good feature</p>
<blockquote>
<p>Escaping the backtick doesn't sound unreasonable but it might be confusing in the CLI or other output formats. That's why it spend some time investing what other tools to in these situations.</p>
</blockquote>
<p>maybe i didn't explain properly sorry. i was imagining that this feature would be off by default, only being enabled when a client (PyCharm or w/e) opts into the behavior</p>
<blockquote>
<p>Escaping the backtick doesn't sound unreasonable but it might be confusing in the CLI or other output formats. That's why it spend some time investing what other tools to in these situations.</p>
</blockquote>
<p>if we wanted to make it even easier for the client, then the message could forgoe backtics entirely and use html escaping and <code>&lt;code&gt;</code> tags instead, then the parsing of the message would be simpler for the client</p>
<p>i.e.</p>
<pre><code class="language-py">reveal_type(&quot;&lt;code&gt;&quot;)
</code></pre>
<p>would report <code>Revealed type is &lt;code&gt;Literal[&amp;quot;&amp;lt;code&amp;gt;&amp;quot;]&lt;/code&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2025-07-16 02:04</div>
            <div class="timeline-body"><blockquote>
<p>since it may just not work</p>
</blockquote>
<p>there would need to be custom parsing involved for escaped backtics to work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2025-09-21 23:50</div>
            <div class="timeline-body"><p>actaully, lsp 3.18 supports markup in diagnostics: https://microsoft.github.io/language-server-protocol/specifications/lsp/3.18/specification/#diagnostic</p>
<p>so this issue should be changed to use markup for diagnostic messages in lsp</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "(游꾸) provide an option for escaped backticks in messages" to "(游꾸) use markup for diagnostics in lsp to codify backtics" by @KotlinIsland on 2025-09-21 23:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @dhruvmanila on 2025-09-22 04:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-22 08:14</div>
            <div class="timeline-body"><p>3.17 is the most recent lsp specification and whether we can use markup also depends on how many editors support it. We may need to implement a fallback for editors that don't support it yet.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:17 UTC
    </footer>
</body>
</html>
