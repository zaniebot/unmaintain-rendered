<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properly model control flow through `finally` suites - astral-sh/ty #233</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Properly model control flow through <code>finally</code> suites</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/233">#233</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-10-31 12:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><p><code>finally</code> suites in <code>try</code>/<code>except</code> blocks have very complex control flow, which we don't yet model, and need to.</p>
<p>I've already written extensively about the complexities of <code>finally</code> blocks, so I won't try to summarise them again here. Instead, I'll point to:</p>
<ul>
<li>This TODO comment here: https://github.com/astral-sh/ruff/blob/76e4277696e8b34b771d554f8f0d07054d413289/crates/red_knot_python_semantic/src/semantic_index/builder.rs#L929-L939</li>
<li>The various <code>finally</code>-related TODO comments in our exception-handler control-flow test suite, from this point onwards: https://github.com/astral-sh/ruff/blob/main/crates/red_knot_python_semantic/resources/mdtest/exception/control_flow.md#exception-handlers-with-finally-branches-but-no-except-branches</li>
<li>The full writeup of exception-handler control flow I put together here: https://astral-sh.notion.site/Exception-handler-control-flow-11348797e1ca80bb8ce1e9aedbbe439d</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-10-31 12:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[red-knot] Properly model control flow through `finally` suites" to "Properly model control flow through `finally` suites" by @MichaReiser on 2025-05-07 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">control flow</span> added by @AlexWaygood on 2025-05-10 21:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">runtime semantics</span> added by @AlexWaygood on 2025-05-11 07:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @AlexWaygood by @MichaReiser on 2025-08-15 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Z post-stable" by @carljm on 2025-11-13 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Z post-stable" by @carljm on 2025-11-18 16:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:19:45 UTC
    </footer>
</body>
</html>
