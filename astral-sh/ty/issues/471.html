<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persistent caching - astral-sh/ty #471</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Persistent caching</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/471">#471</a>
        opened by <a href="https://github.com/serjflint">@serjflint</a>
        on 2025-05-21 13:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/serjflint">@serjflint</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hello! Thank you for your great work and I am very excited about ty.</p>
<p>We have a large codebases and we have a declarative dependency graph. We run mypy for each node and store its .mypy_cache for later use in leaf nodes. Will it be possible to use file cache in <code>ty</code> between runs for even more performance?</p>
<h3>Version</h3>
<p>0.0.1a3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @serjflint on 2025-05-21 13:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-21 14:02</div>
            <div class="timeline-body"><p>We definitely hope to add a persistent cache at some point. Figuring out the details might be tricky, though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelle-openai">@jelle-openai</a> on 2025-05-21 16:37</div>
            <div class="timeline-body"><p>For what it's worth, I don't know how large &quot;large&quot; is for you, but on our codebase of several millions of lines, ty finishes quite quickly, so there's little point in a cache. Mypy's caching mechanism is tricky and the source of a lot of bugs, so if I were you I'd avoid building caching until there's a lot more signal that it would help users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-21 16:41</div>
            <div class="timeline-body"><p>My main motivation for a persistent cache is to reduce peak memory usage (we don't need to parse all files or source texts) and having faster start up times in editors. But agree, it's less pressing than for mypy because ty can check even very large code bases in seconds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/serjflint">@serjflint</a> on 2025-05-21 17:49</div>
            <div class="timeline-body"><blockquote>
<p>For what it's worth, I don't know how large &quot;large&quot; is for you, but on our codebase of several millions of lines, ty finishes quite quickly, so there's little point in a cache. Mypy's caching mechanism is tricky and the source of a lot of bugs, so if I were you I'd avoid building caching until there's a lot more signal that it would help users.</p>
</blockquote>
<p>Our codebase is tens of millions LoC. The main profit actually is that our CI jobs don't need costly access to the whole codebase at once. Checking only the affected part is much cheaper.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-21 17:59</div>
            <div class="timeline-body"><p>That might difficult to implement because ty still needs to check if the files are unchanged.</p>
<p>However, you can run ty on a subproject and it will only read files that are reachable from the entry points</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/serjflint">@serjflint</a> on 2025-05-21 18:45</div>
            <div class="timeline-body"><blockquote>
<p>That might difficult to implement because ty still needs to check if the files are unchanged.</p>
<p>However, you can run ty on a subproject and it will only read files that are reachable from the entry points</p>
</blockquote>
<p>That check would defeat the purpose of preparing the caches. If ty would believe me that the files are unchanged that would.be helpful.</p>
<p>Running tools on the subproject is the default mode we had before switching to the optimized one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Prepared file cache for large codebases" to "Persistent caching" by @MichaReiser on 2025-07-23 09:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @MichaReiser on 2025-07-23 09:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">feature</span> added by @MichaReiser on 2025-07-23 09:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ibraheemdev by @MichaReiser on 2025-08-15 12:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Z post-stable" by @carljm on 2025-11-14 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Z post-stable" by @carljm on 2025-11-18 16:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:19:57 UTC
    </footer>
</body>
</html>
