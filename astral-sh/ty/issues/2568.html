<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should overloaded function to `ParamSpec` work with argument type expansion? - astral-sh/ty #2568</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should overloaded function to <code>ParamSpec</code> work with argument type expansion?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2568">#2568</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2026-01-20 04:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>In https://github.com/astral-sh/ruff/pull/21946, there's a test case which ty passes but other type checkers raise an error:</p>
<pre><code class="language-py">from typing import Callable, overload

@overload
def int_int(x: int) -&gt; int: ...
@overload
def int_int(x: str) -&gt; int: ...

def with_parameters[**P](f: Callable[P, int], *args: P.args, **kwargs: P.kwargs) -&gt; Callable[P, str]:
    def nested(*args: P.args, **kwargs: P.kwargs) -&gt; str:
        return str(f(*args, **kwargs))
    return nested

def foo(int_or_str: int | str):
    # Argument type expansion leads to matching both overloads.
    # TODO: Should this be an error instead?
    # revealed: Overload[(x: int) -&gt; str, (x: str) -&gt; str]
    reveal_type(with_parameters(int_int, int_or_str))
</code></pre>
<p>Other type checkers emit a diagnostic here:</p>
<ul>
<li><a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=e5ec5b750be3b566e0f70c55dbe1ed80">mypy</a></li>
<li><a href="https://pyright-play.net/?pyrightVersion=1.1.405&amp;pythonVersion=3.13&amp;reportUnreachable=true&amp;code=GYJw9gtgBALgngBwJYDsDmUkQWEMoDCAhgDYlEBGJApgDRRgBu1IJYRAJgFBcACTLNpy4dqwTChgB9VDAAUADwBcEmAEooAWgB8qlQDpDfAa3bdR42TMmKVAZxggNOvVEP6eFqAHckMABZSCEQgRBDUMCx2ANoAVLEACgC6csAqxGSUNNEJ9LJJ9LEhaHYqCfrFdoWxANbelWX6dZXOuhnkVNQ59A4gSUpcUENQXijUDtQcckUgJY2V1c2zpVDlSyWtUL0Dw7tQIBEAriAoW46p0wtQ8et2amqDwwcwx6djE9wiYlDAYGByVlwUm2qigAB8zk4dk9qMxSFJ4AhqHJfAEgiEwhEogDJNYYHlcUDevcuEA">pyright</a></li>
<li><a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeS4ATrgLYAEALqcROgOZ0Q3G6UN0BhVFCipssADR1cANxiUouVJgA66NQAFZ8xcrWYYYTugYB9VgwAU%2BRMYYBKOgFoAfHduFPm7QqWqshnbmJta2cAyUjq7udJ6EavqBAO4QDAAWpsSolKg0MAzycADaAFQlAAoAupZgtkIiYrBF5VIWlVIl2WxwtuWEXXAdJQDWSQO9hKMDUW71ouIwzVLhlJWIanSbdAZG6PAFmJadlN0TA0NTJz10fZfdM3Qr6%2Bhbr3SU%2BQCulC8rNUfnOhlO5wez2DZbD4Mb4vPbhGD%2BRJGMC4XCWCymXimJ52OgAH0eEXsz1eHzkwlMTGIMEsKXSmWyuXyhXRJmCDFabKxKzBahAEhAnwY0DgJHIiBAAGI6ABVYVQVKkOhgT7oADGwtw6DgCQCyN4NFQZnQnxo2HkoTsDyeEM2UJhypUIAAcqbzZRbMB8ABfJ18gVkD5gKCkQgMWhQCjS8qkIMhx4YHAEOhqrWQNjfI0QLXxdDSgDKMBgdDSDAYxB6AHpK4HDCHCLw2JWYOhK5hcGq4JXU%2Bh05nNa3lbw6KgZKhoI1iz2%2BzkB9JiAPRWoyOktU45JQ4NmXgBeOhOgDMhAAjAAmP3oEDegWoDUQOQAMWgMAoaCweCIZCvQA">pyrefly</a></li>
</ul>
<p>I'm not exactly sure why do other type checkers emit a diagnostic here, maybe there's an unsoundness argument to this behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dhruvmanila on 2026-01-20 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">calls</span> added by @dhruvmanila on 2026-01-20 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">overloads</span> added by @dhruvmanila on 2026-01-20 04:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 04:35:48 UTC
    </footer>
</body>
</html>
