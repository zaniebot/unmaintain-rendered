<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unbinding behavior of `except` statement not modeled by ty - astral-sh/ty #762</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unbinding behavior of `except` statement not modeled by ty</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/762">#762</a>
        opened by <a href="https://github.com/UnboundVariable">@UnboundVariable</a>
        on 2025-07-03 23:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/UnboundVariable">@UnboundVariable</a> on 2025-07-03 23:38</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When an <code>except</code> clause in a <code>try</code> statement has an <code>as</code> target, the runtime unbinds the target variable at the bottom of the <code>except</code> block. This is documented <a href="https://docs.python.org/3/reference/compound_stmts.html#except-clause">here</a>.</p>
<p>Ty doesn't appear to model this behavior currently, so it doesn't report <code>x</code> as being possibly unbound in the code sample below.</p>
<pre><code class="language-python">def f():
    try:
        x = 0
        print(1 / 0)
    except ZeroDivisionError as x:
        pass

    print(x) # x is unbound here resulting in a runtime error
</code></pre>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-07-04 01:17</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>We do model this behavior. It doesn't show up in your example because we disable the &quot;possibly unbound&quot; diagnostic by default (we've found too many cases where it leads to false positives in working code that relies on invariants not seen by the type checker). If we explicitly enable that diagnostic in the config, the error shows up in your example: https://play.ty.dev/ec6a8f29-9709-455d-ac1f-88f085f8e53a</p>
<p>Or if we modify your example slightly to use a different variable, so that it is definitely-unbound rather than possibly-unbound, we see that reported as well: https://play.ty.dev/587d7adc-40fc-4ca3-9577-3c6201773b4c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-07-04 01:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 02:11:15 UTC
    </footer>
</body>
</html>
