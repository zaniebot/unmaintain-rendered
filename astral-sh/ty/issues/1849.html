<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve scope based completions in eager enclosed scopes - astral-sh/ty #1849</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve scope based completions in eager enclosed scopes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1849">#1849</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2025-12-11 02:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>Specifically, <a href="https://github.com/astral-sh/ruff/pull/21872#issuecomment-3639670356">from @carljm</a>:</p>
<blockquote>
<p>For eager enclosed scopes (scopes that are executed immediately at the point of definition, like class bodies or comprehensions) we do better in type inference, because in that case we do know precisely where in the enclosing scope the nested scope executed. (If you wanted, I think you could use those same &quot;eager nested scope snapshots&quot; from the semantic index for more precision here as well, but I think that could be a separate follow-up change.)</p>
</blockquote>
<p>Ref <a href="https://github.com/astral-sh/ruff/pull/21872">astral-sh/ruff#21872</a></p>
<p>Ref <a href="https://github.com/astral-sh/ty/issues/1294">astral-sh/ty#1294</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-11 02:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-11 02:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-11 13:27</div>
            <div class="timeline-body"><p>Actually, I wonder if this is already happening? e.g., See:</p>
<p>https://github.com/astral-sh/ruff/blob/8647844572e405c241a96dbc37e51cfa6b6b69a9/crates/ty_python_semantic/src/types/list_members.rs#L325</p>
<p>And:</p>
<p>https://github.com/astral-sh/ruff/blob/8647844572e405c241a96dbc37e51cfa6b6b69a9/crates/ty_python_semantic/src/types/list_members.rs#L417-L426</p>
<p>And:</p>
<p>https://github.com/astral-sh/ruff/blob/8647844572e405c241a96dbc37e51cfa6b6b69a9/crates/ty_python_semantic/src/types/list_members.rs#L465-L474</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-11 17:42</div>
            <div class="timeline-body"><p>@BurntSushi none of those links look like they are using the eager-nested-scope live-defs snapshots. They are all using end-of-scope, which is probably right for looking up members of a class or module, but generally not right for walking enclosed scopes looking for definitions of a name.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:22 UTC
    </footer>
</body>
</html>
