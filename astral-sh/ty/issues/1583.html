<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`unsupported-operator`: Improve diagnostic if both sides have the same type - astral-sh/ty #1583</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>unsupported-operator</code>: Improve diagnostic if both sides have the same type</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1583">#1583</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-11-18 13:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><pre><code class="language-py">list[1] - list[2]
</code></pre>
<pre><code>Operator `-` is unsupported between objects of type `&lt;class 'list[Unknown]'&gt;` and `&lt;class 'list[Unknown]'&gt;` (unsupported-operator) [Ln 1, Col 1]
</code></pre>
<p>Repeating the type here is not only verbose, but I also wondered if there's something I'm missing and that the types are indeed different in</p>
<pre><code>error[unsupported-operator]: Operator `-` is unsupported between objects of type `_R@ignore_variance` and `_R@ignore_variance`
  --&gt; homeassistant/util/variance.py:41:43
   |
39 |         value = func(*args, **kwargs)
40 |
41 |         if last_value is not None and abs(value - last_value) &lt; ignored_variance:
   |                                           ^^^^^^^^^^^^^^^^^^
42 |             return last_value
   |
info: rule `unsupported-operator` is enabled by default
</code></pre>
<p>I'm not sure if this even allows us to optimize the operator lookup code to only lookup the dunder methods once rather than trying to do it on both types (but maybe we already do this?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-11-18 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by @MichaReiser on 2025-11-18 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`unsupported-operator`: Improve diagnostic if the both sides have the same type" to "`unsupported-operator`: Improve diagnostic if both sides have the same type" by @sharkdp on 2025-11-18 14:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-11-18 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Hugo-Polloli">@Hugo-Polloli</a> on 2025-12-19 22:10</div>
            <div class="timeline-body"><p>Started looking into it, but looks like it's already fixed by https://github.com/astral-sh/ruff/pull/21947 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-19 22:12</div>
            <div class="timeline-body"><p>Yes, thank you, this is now fixed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-12-19 22:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:00 UTC
    </footer>
</body>
</html>
