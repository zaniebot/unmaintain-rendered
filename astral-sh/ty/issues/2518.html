<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect Type Inference for dict.get() with Non-Matching Default Value - astral-sh/ty #2518</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect Type Inference for dict.get() with Non-Matching Default Value</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2518">#2518</a>
        opened by <a href="https://github.com/shuangluoxss">@shuangluoxss</a>
        on 2026-01-15 14:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shuangluoxss">@shuangluoxss</a></div>
            <div class="timeline-body">Summary
Description
<p>When using dict.get(key, default) and <code>default</code> have different type with the dict value, the type checker incorrectly infers the return type</p>
Minimal Reproduction
<pre><code>res_dict = {k: [0] for k in [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;]}
res = res_dict.get(&quot;a&quot;, 1)
res.append(3)
</code></pre>
<p>playground link: https://play.ty.dev/2a34c232-5be9-4321-ae0b-cce8683258be</p>
Expected Behavior
<p><code>res</code> should be inferred as <code>list[int] | int</code> and <code>res.append</code> should raise type error, like <code>basedpyright</code> did</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/2c479ee5-047f-4b82-a688-5c16f6e1fee6"></p>
Actual Behavior
<p><code>res</code> was inferred as <code>list[Unknown | list[int]] | Unknown</code> and do not give any error</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/53cc328c-7515-4157-86fe-39459a397404"></p>
Version
<p>ty 0.0.12 (4b74e4ded 2026-01-14)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 14:46</div>
            <div class="timeline-body"><p>Thanks for the report. If you explicitly annotate <code>res_dict</code> with <code>: dict[int, list[int]]</code>, <a href="https://play.ty.dev/b204a4f1-ac5d-413d-9509-56d42e9f6355">we emit the error that you expect</a>.</p>
<p>We intend to soon change our behaviour here so that we will emit the expected error without an annotation too. You can follow <a href="https://github.com/astral-sh/ty/issues/1240">astral-sh/ty#1240</a> for updates on that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-15 14:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:09 UTC
    </footer>
</body>
</html>
