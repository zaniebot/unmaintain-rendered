<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ty reports unknown-argument for Hugging Face tool choice dataclasses - astral-sh/ty #2139</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ty reports unknown-argument for Hugging Face tool choice dataclasses</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2139">#2139</a>
        opened by <a href="https://github.com/dsfaccini">@dsfaccini</a>
        on 2025-12-21 04:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dsfaccini">@dsfaccini</a> on 2025-12-21 04:34</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Ty reports <code>unknown-argument</code> for valid fields on Hugging Face chat tool choice dataclasses.</p>
<p>NOTE: I can't reproduce this in the playground when trying to write the example without the hugging face dependency https://play.ty.dev/0bb1b12d-1ea7-449b-b6cf-18c20f21027f</p>
<p>Nonetheless I do get the error when I use the hugging face package, so this may be something to bring up with the hugging face team</p>
<p><img width="1548" height="482" alt="Image" src="https://github.com/user-attachments/assets/1fe7d9b2-de68-445a-953c-a9312facabda" /></p>
<h3>Repro (self-contained)</h3>
<p><code>ty_repro_hf.py</code>:</p>
<pre><code class="language-python"># /// script
# dependencies = [
#     &quot;huggingface_hub&gt;=0.26&quot;,
# ]
# ///

from typing import Literal
from huggingface_hub import ChatCompletionInputFunctionName, ChatCompletionInputToolChoiceClass


def build_tool_choice(name: str) -&gt; ChatCompletionInputToolChoiceClass:
    return ChatCompletionInputToolChoiceClass(
        function=ChatCompletionInputFunctionName(name=name)
    )


def main() -&gt; Literal[&quot;ok&quot;]:
    build_tool_choice(&quot;foo&quot;)
    return &quot;ok&quot;


if __name__ == &quot;__main__&quot;:
    print(main())
</code></pre>
<p>Run:</p>
<pre><code class="language-bash">uvx ty check ty_repro_hf.py
</code></pre>
<h3>Actual result</h3>
<pre><code>error[unknown-argument]: Argument `function` does not match any known parameter
  --&gt; ty_repro_hf.py:13:9
...
error[unknown-argument]: Argument `name` does not match any known parameter
  --&gt; ty_repro_hf.py:13:50
...
</code></pre>
<h3>Expected result</h3>
<p>No diagnostics: the generated HF dataclasses expose <code>function</code> and <code>name</code> (see <code>huggingface_hub/inference/_generated/types/chat_completion.py</code> in the installed package).</p>
<h3>Notes</h3>
<p>Looks like ty isn't recognizing the dataclass fields on these generated classes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">dataclasses</span> added by @sharkdp on 2025-12-21 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">library</span> added by @sharkdp on 2025-12-21 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-21 13:37</div>
            <div class="timeline-body"><p>I think Pyright has the same behavior here, at least:</p>
<pre><code>/Users/crmarsh/workspace/ruff/ty_repro_hf.py
  /Users/crmarsh/workspace/ruff/ty_repro_hf.py:13:9 - error: No parameter named &quot;function&quot; (reportCallIssue)
  /Users/crmarsh/workspace/ruff/ty_repro_hf.py:13:50 - error: No parameter named &quot;name&quot; (reportCallIssue)
2 errors, 0 warnings, 0 informations
</code></pre>
<p>AFAICT they have a custom dataclass transform that isn't marked with <code>@dataclass_transform</code>: https://github.com/huggingface/huggingface_hub/blob/b3a8754d6fd16ee888cc155b359464b4451afac7/src/huggingface_hub/inference/_generated/types/base.py#L32</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-12-21 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-21 14:12</div>
            <div class="timeline-body"><p>Fixed upstream in https://github.com/huggingface/huggingface_hub/pull/3639.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dsfaccini">@dsfaccini</a> on 2025-12-21 14:29</div>
            <div class="timeline-body"><p>awesome, appreciated!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wauplin">@Wauplin</a> on 2026-01-06 11:13</div>
            <div class="timeline-body"><p>Hey there! Maintainer of the <code>huggingface_hub</code> library here ðŸ‘‹. I've just released <code>huggingface_hub</code> v1.2.4 with @charliermarsh 's fix :hugs:</p>
<p>https://github.com/huggingface/huggingface_hub/releases/tag/v1.2.4</p>
<p>And confirmed locally that the repro example now works:</p>
<p><img width="566" height="40" alt="Image" src="https://github.com/user-attachments/assets/d4d76f78-7b3a-43f4-a9b3-480b343cc46d" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-06 11:29</div>
            <div class="timeline-body"><p>Thanks so much @Wauplin!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2026-01-06 11:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:51:35 UTC
    </footer>
</body>
</html>
