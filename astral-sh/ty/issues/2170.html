<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthesize a precise signature for `NamedTuple` `_replace` methods - astral-sh/ty #2170</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Synthesize a precise signature for `NamedTuple` `_replace` methods</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2170">#2170</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-12-22 19:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-22 19:31</div>
            <div class="timeline-body"><p>The <code>._replace()</code> call here fails at runtime, because this particular <code>NamedTuple</code> only supports an <code>x</code> keyword argument being passed to its <code>_replace</code> method:</p>
<pre><code class="language-py">from typing import NamedTuple

class X(NamedTuple):
    x: int

x = X(42)
x._replace(y=5)
</code></pre>
<p>Mypy <a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=8f9140c6be68df5eb09199a6d5f9d122">catches this error</a>, though pyright and pyrefly don't at the time of writing.</p>
<p>Note that despite the leading underscore, the <code>_replace</code> method of namedtuple classes <a href="https://docs.python.org/3/library/collections.html#collections.somenamedtuple._replace"><em>is</em> public</a>. The leading underscore is there so that the generated method doesn't clash with any fields a user might want to have on their <code>NamedTuple</code> class.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">namedtuples</span> added by @AlexWaygood on 2025-12-22 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-22 19:34</div>
            <div class="timeline-body"><p>Mypy also appears to synthesize a precise type for the <code>_fields</code> attribute (<a href="https://docs.python.org/3/library/collections.html#collections.somenamedtuple._fields">also public</a>). Or at least, more precise than what we infer right now:</p>
<pre><code class="language-py">from typing import NamedTuple

class X(NamedTuple):
    x: int
    y: str

reveal_type(X._fields)  # mypy: `tuple[str, str]`; ty/pyright/pyrefly: `tuple[str, ...]`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-12-23 00:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2025-12-23 00:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-12-23 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-23 01:44</div>
            <div class="timeline-body"><p>Opened https://github.com/astral-sh/ty/issues/2176 for <code>_fields</code> since the PR that will close this issue only handles <code>_replace</code> (and I think it's fine to separate them.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-12-23 21:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:53:03 UTC
    </footer>
</body>
</html>
