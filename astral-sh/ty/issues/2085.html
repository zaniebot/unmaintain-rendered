<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>panic:  execute: too many cycle iterations - astral-sh/ty #2085</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>panic:  execute: too many cycle iterations</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2085">#2085</a>
        opened by <a href="https://github.com/ncollins-vs">@ncollins-vs</a>
        on 2025-12-18 19:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ncollins-vs">@ncollins-vs</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I get a fatal error checking this code:</p>
<pre><code class="language-python">class Test:
    def __init__(self, points: list[tuple[float, float] | None]) -&gt; None:
        self.left = points
        self.right = points
    def method(self) -&gt; None:
        self.left, self.right = self.right, self.left
        if self.right:
            self.right = [
                ((-point[0], point[1]) if point else point) for point in self.right
            ]
</code></pre>
<p>Error:</p>
<pre><code>error[panic]: Panicked at /Users/runner/.cargo/git/checkouts/salsa-e6f3bb7c2a062968/55e5e7d/src/function/execute.rs:321:21 when checking `&lt;filename&gt;`: `infer_definition_types(Id(1407)): execute: too many cycle iterations`
info: This indicates a bug in ty.
info: If you could open an issue at https://github.com/astral-sh/ty/issues/new?title=%5Bpanic%5D, we'd be very appreciative!
info: Platform: macos aarch64
info: Version: 0.0.3 (fadfe0966 2025-12-17)
info: Args: [&quot;ty&quot;, &quot;check&quot;, &quot;&lt;filename&gt;&quot;]
info: run with `RUST_BACKTRACE=1` environment variable to show the full backtrace information
info: query stacktrace:
   0: infer_expression_types_impl(Id(1803))
             at crates/ty_python_semantic/src/types/infer.rs:196
   1: static_expression_truthiness(Id(1803))
             at crates/ty_python_semantic/src/types/infer.rs:394
   2: infer_expression_types_impl(Id(1804))
             at crates/ty_python_semantic/src/types/infer.rs:196
   3: infer_expression_types_impl(Id(1806))
             at crates/ty_python_semantic/src/types/infer.rs:196
   4: infer_expression_type_impl(Id(1806))
             at crates/ty_python_semantic/src/types/infer.rs:273
   5: ClassLiteral &lt; 'db &gt;::implicit_attribute_inner_(Id(6c08))
             at crates/ty_python_semantic/src/types/class.rs:1524
             cycle heads: infer_unpack_types(Id(1c00)) -&gt; iteration = 200
   6: Type &lt; 'db &gt;::member_lookup_with_policy_(Id(500e))
             at crates/ty_python_semantic/src/types.rs:881
   7: infer_expression_types_impl(Id(1802))
             at crates/ty_python_semantic/src/types/infer.rs:196
   8: infer_unpack_types(Id(1c00))
             at crates/ty_python_semantic/src/types/infer.rs:425
   9: ClassLiteral &lt; 'db &gt;::implicit_attribute_inner_(Id(6c07))
             at crates/ty_python_semantic/src/types/class.rs:1524
  10: infer_scope_types(Id(1002))
             at crates/ty_python_semantic/src/types/infer.rs:69
  11: check_file_impl(Id(c00))
             at crates/ty_project/src/lib.rs:534


Found 1 diagnostic
WARN A fatal error occurred while checking some files. Not all project files were analyzed. See the diagnostics list above for details.
</code></pre>
<p>Oddly, the error doesn't happen for <code>left</code>, and it goes away if I use <code>if point else None</code></p>
<p>https://play.ty.dev/5f817b19-ad82-4a44-9ec6-9d40e72b37f0</p>
<h3>Version</h3>
<p>ty 0.0.3 (fadfe0966 2025-12-17)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by @carljm on 2025-12-18 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-18 19:55</div>
            <div class="timeline-body"><p>Thanks for the report! Will take a look</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2025-12-18 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-12-18 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @mtshiba by @mtshiba on 2025-12-19 07:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-12-19 07:51</div>
            <div class="timeline-body"><p>This appears to be the same kind of bug I found while working on astral-sh/ruff#17371 (https://github.com/astral-sh/ruff/pull/17371/commits/1d1afaa517836c1974ce4d780dcee47a7c258387).
I opened a separate PR astral-sh/ruff#22070.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @carljm on 2025-12-23 00:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:21:26 UTC
    </footer>
</body>
</html>
