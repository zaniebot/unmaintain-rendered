<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bound `self` should not be considered when checking assignability of bound methods - astral-sh/ty #1301</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bound <code>self</code> should not be considered when checking assignability of bound methods</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1301">#1301</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2025-10-03 13:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dcreager">@dcreager</a> on 2025-10-03 13:51</div>
            <div class="timeline-body"><p>This seems related to #1169 and #1172, but slightly different and more general. It does not require overloads, nor having other parameters or a return value that use <code>typing.Self</code>.</p>
<p>We are currently not performing assignability/subtyping checks on bound methods correctly [<a href="https://play.ty.dev/11d587b4-4f0c-450a-a180-52b2c35edc91">playground</a>]:</p>
<pre><code class="language-py"># These succeed, as they should, since return types are in covariant position.
static_assert(is_subtype_of(Callable[[], int], Callable[[], object]))
static_assert(is_subtype_of(Callable[[], Iterator[int]], Callable[[], Iterator[object]]))

class I:
    def method1(self) -&gt; int: ...
    def method2(self) -&gt; Iterator[int]: ...

class O:
    def method1(self) -&gt; object: ...
    def method2(self) -&gt; Iterator[object]: ...

# These fail
reveal_type(I().method1)
reveal_type(O().method1)
static_assert(is_subtype_of(TypeOf[I().method1], TypeOf[O().method1]))
static_assert(is_subtype_of(TypeOf[I().method2], TypeOf[O().method2]))
</code></pre>
<p>Some printf-debugging shows that we are checking the <code>self</code> parameter when doing the assignability check. In this case, since parameters are in a contravariant position, we are deciding that <code>Self: int</code> is not a ~subtype~ supertype of <code>Self: object</code>, and therefore causing the overall subtyping check to fail.</p>
<p>In a bound method, the bound <code>self</code> parameter has been curried away, and so shouldn't be considered at all when determining subtyping of the bound method.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dcreager by @dcreager on 2025-10-03 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2025-10-03 15:15</div>
            <div class="timeline-body"><p>@AlexWaygood convinced me synchronously that this is wrong! The bound methods of two different classes really are different sets of objects, and are correctly not subtypes of each other. It was a different issue that I was encountering on #20677.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dcreager on 2025-10-03 15:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:40:44 UTC
    </footer>
</body>
</html>
