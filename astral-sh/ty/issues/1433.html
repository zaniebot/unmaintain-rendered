<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid cycle recovery based on iteration count - astral-sh/ty #1433</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid cycle recovery based on iteration count</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/1433">#1433</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2025-10-24 10:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>We currently rely on the iteration count for cycle recovery. There are two issues with it:</p>
<ol>
<li>Recovery functions aren&#x27;t guaranteed to be called for every iteration count if they participate in an outer cycle. The recovery function can be skipped for two reasons: a) Because <em>this</em> query did converge in this iteration, but there might be another cycle that didn&#x27;t converge, enforcing another iteration and b) if the cycle head only conditionally participates in the outer cycle head (e.g. only every other iteration). That&#x27;s why we want to avoid testing when the iteration count is <strong>equal</strong>. At least, test if the iteration count is larger than.</li>
<li>The number of iterations can vary based from which query the cycle is entered. However, the execution order of queries is non-deterministic in a multithreaded context, risking that our error recovery becomes non-deterministic too.</li>
</ol>
<p>That&#x27;s why we should prefer cycle recovery functions that recover based on the values rather than the exact iteration count</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;GA&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-24 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-11-26 16:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:50 UTC
    </footer>
</body>
</html>
