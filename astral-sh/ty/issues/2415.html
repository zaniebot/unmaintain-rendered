<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flaky(?) `import from` completions in the playground when there are statements below - astral-sh/ty #2415</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Flaky(?) <code>import from</code> completions in the playground when there are statements below</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2415">#2415</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2026-01-09 13:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-09 13:48</div>
            <div class="timeline-body"><p>Consider the following video. <code>dataclasses</code> is never suggested as an import at the <code>from datacl&lt;CURSOR&gt;</code> location, and at the location <code>from dataclasses import data&lt;CURSOR&gt;</code>, the <code>dataclass</code> completion suggestion keeps flickering(?) on and off, so fast that I can never actually accept it.</p>
<p>https://github.com/user-attachments/assets/7532bf77-cadc-4a51-b3f4-134648e0f1c1</p>
<p>I don't remember coming across this before -- possibly a recent regression? No idea if this is a general issue or another playground-specific issue, I'm afraid :-)</p>
<p>Cc. @BurntSushi / @MichaReiser</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2026-01-09 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2026-01-09 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by @AlexWaygood on 2026-01-09 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> removed by @MichaReiser on 2026-01-09 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> added by @MichaReiser on 2026-01-09 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-09 14:06</div>
            <div class="timeline-body"><p>Confirming that this doesn't happen in VS Code:</p>
<p>https://github.com/user-attachments/assets/dc15fa9e-93ff-4dc2-94a6-54c4cf970f09</p>
<p>But also seems to be working okay for me in the playground:</p>
<p>https://github.com/user-attachments/assets/16e3e489-1507-41da-9a8f-d888b7184ca1</p>
<p>I guess that's the flaky part?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-09 14:07</div>
            <div class="timeline-body"><p>Also works okay for me in Chrome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 14:11</div>
            <div class="timeline-body"><p>I can't reproduce this either. Very possible that there's an issue where we end up re-rendering or updating the editor, which then results in closing/refreshing the completion dropdown</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 14:12</div>
            <div class="timeline-body"><p>Or it's some Browser extension that interacts badly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-09 14:18</div>
            <div class="timeline-body"><p>This is strange -- it's very persistent for me. I tried clearing my cache for <code>play.ty.dev</code> and it still reproduces:</p>
<p><img width="1286" height="558" alt="Image" src="https://github.com/user-attachments/assets/8c1b4d73-394f-4959-9a49-49e6c3d14a0d" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-09 14:22</div>
            <div class="timeline-body"><p>Some other things to try:</p>
<ol>
<li>What happens if, after <code>from data</code>, you close the completions and then re-request them with <code>Ctrl + Space</code>?</li>
<li>Try a different web browser?</li>
<li>Try running in an incognito/private window?</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-09 14:34</div>
            <div class="timeline-body"><ul>
<li>It reproduces for me in Firefox when I'm logged into my personal Google account</li>
<li>It reproduces for me in a private/incognito Firefox window</li>
<li>It reproduces for me in Google Chrome when I'm logged into my personal Google account</li>
<li>It reproduces for me in Google Chrome when I'm logged into my Astral Google account</li>
<li>It reproduces for me in a Google Chrome private/incognito window</li>
</ul>
<p><code>Ctrl + Space</code> opens up a popup where I can change my keyboard settings from the British layout to the American layout but doesn't seem to re-request completions ðŸ˜„ Hitting <code>Esc</code> then typing <code>c</code> at <code>from data&lt;CURSOR&gt;</code> does seem to trigger the expected <code>dataclasses</code> completion suggestion, however</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-09 14:54</div>
            <div class="timeline-body"><blockquote>
<p>Hitting <code>Esc</code> then typing <code>c</code> at <code>from data&lt;CURSOR&gt;</code> does seem to trigger the expected <code>dataclasses</code> completion suggestion, however</p>
</blockquote>
<p>This almost seems like you aren't seeing the <code>isIncomplete</code> fix I merged in https://github.com/astral-sh/ruff/pull/22442</p>
<p>But that ignores the flaky part.</p>
<p>And I'm baffled that this is reproducing for you across a bunch of different environments. Hmmmmmm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 15:02</div>
            <div class="timeline-body"><p>Must be a user problem ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanielKongsgaard">@DanielKongsgaard</a> on 2026-01-09 15:08</div>
            <div class="timeline-body"><p>I can reproduce this (sometimes). Here is a video with both:</p>
<p>https://github.com/user-attachments/assets/44a119a3-a105-4434-b37c-83bbefbf1fae</p>
<p>https://github.com/user-attachments/assets/1adf140b-6f28-4999-91c9-333e509a0484</p>
<p>At first I thought it might have something to do with the presence of <code>ty.json</code>, but now I seems able to reproduce it without the <code>ty.json</code> too...</p>
<p>Also, I am a bit confused by the behavior of the <code>import</code> completion, which seems to be worse in the first case without the <code>dataclasses</code> problem, but better in the case where <code>dataclasses</code> doesn't complete nicely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RasmusNygren">@RasmusNygren</a> on 2026-01-09 20:18</div>
            <div class="timeline-body"><p>This is consistently broken for me in the playground as well since the <code>incomplete = True</code> change. Without that change it works for me.</p>
<p>I can not reproduce this in an editor outside of the playground.</p>
<p>Looking at your video @BurntSushi. For me it looks sane as well when <code>from d&lt;CURSOR&gt;</code> is typed, it's only when I type <code>from da&lt;CURSOR&gt;</code> that I get the weird behaviour</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-09 21:28</div>
            <div class="timeline-body"><p>I can't observe the flickering but can now reproduce that dataclass isn't always suggested</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:42:07 UTC
    </footer>
</body>
</html>
