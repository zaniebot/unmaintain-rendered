```yaml
number: 940
title: improve diagnostics for possibly-unbound call-dunder with union
type: issue
state: open
author: carljm
labels:
  - diagnostics
  - calls
assignees: []
created_at: 2025-08-05T14:35:44Z
updated_at: 2026-01-09T13:53:39Z
url: https://github.com/astral-sh/ty/issues/940
synced_at: 2026-01-10T01:56:40Z
```

# improve diagnostics for possibly-unbound call-dunder with union

---

_Issue opened by @carljm on 2025-08-05 14:35_

When we have an implicit dunder call with a union type, where some types in the union implement the dunder and others do not, we currently report an error that the dunder methods are possibly unbound: https://play.ty.dev/e412c8da-cc72-47b5-af98-9db45800ff73

```py
class Context:
    def __enter__(self): ...
    def __exit__(self, *args): ...

class NotContext:
    pass

def _(x: Context | NotContext):
    # error: [invalid-context-manager] "Object of type `Context | NotContext` cannot be used with `with` because the methods `__enter__` and `__exit__` are possibly unbound"
    with x:
        pass
```

This is not very useful in identifying which element of the union type is the problem. It would be better if we would instead surface the underlying error directly (that `NotContext` does not implement `__enter__` or `__exit__`), and add a note that `NotContext` appears in the union type `Context | NotContext`.

This issue applies at least to sync and async context managers; I think it likely applies to some other implicit dunder calls as well.

---

_Label `diagnostics` added by @carljm on 2025-08-05 14:35_

---

_Label `help wanted` added by @carljm on 2025-08-05 14:36_

---

_Comment by @Y3K on 2025-08-31 16:08_

Hi, I'll try to fix this one.

---

_Comment by @carljm on 2026-01-09 02:14_

This is the method-call variant of https://github.com/astral-sh/ty/issues/1656

---

_Label `help wanted` removed by @carljm on 2026-01-09 02:14_

---

_Label `calls` added by @carljm on 2026-01-09 02:14_

---

_Added to milestone `Stable` by @carljm on 2026-01-09 02:15_

---

_Comment by @AlexWaygood on 2026-01-09 13:53_

> This is the method-call variant of [#1656](https://github.com/astral-sh/ty/issues/1656)

Sort-of? I think it might be more precise to say that both this issue and #1656 would probably require us to partially implement https://github.com/astral-sh/ty/issues/190?

---
