<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generic constraints inferred incorrectly in ty vs pyright - astral-sh/ty #2405</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Generic constraints inferred incorrectly in ty vs pyright</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2405">#2405</a>
        opened by <a href="https://github.com/kszlim">@kszlim</a>
        on 2026-01-08 22:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kszlim">@kszlim</a></div>
            <div class="timeline-body">Summary
<p>Using a LLM, I was able to create a MRE which works with pyright, but not ty:</p>
<pre><code>from typing import TypeVar, Iterable, reveal_type

class A:
    pass

class B:
    pass

T = TypeVar(&quot;T&quot;, A, B)

def process(items: Iterable[T]) -&gt; T:
    for item in items:
        return item
    raise ValueError()


# WORKS: Explicit type annotation
def works() -&gt; B:
    items: list[B] = []
    items.append(B())
    result = process(items)
    reveal_type(result)   # B âœ“
    return result


# BUG: Without annotation, ty resolves TypeVar to first constraint (A)
def fails() -&gt; B:
    items = []
    items.append(B())
    items.append(B())
    reveal_type(items)    # list[Unknown] - same in both ty and pyright
    result = process(items)
    reveal_type(result)   # ty: A (wrong), pyright: Unknown (correct)
    return result         # ty error: A not assignable to B
</code></pre>
Version
<p>0.0.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-08 23:43</div>
            <div class="timeline-body"><p>Thanks! I think this is a duplicate of #1100</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2026-01-08 23:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kszlim">@kszlim</a> on 2026-01-09 21:15</div>
            <div class="timeline-body"><p>For my own tracking <a href="https://github.com/astral-sh/ty/issues/623">astral-sh/ty#623</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:27:01 UTC
    </footer>
</body>
</html>
