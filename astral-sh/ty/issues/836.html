<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panic `attempt to subtract with overflow` in `ruff_annotate_snippets/src/renderer/margin.rs` - astral-sh/ty #836</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Panic <code>attempt to subtract with overflow</code> in <code>ruff_annotate_snippets/src/renderer/margin.rs</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/836">#836</a>
        opened by <a href="https://github.com/qarmin">@qarmin</a>
        on 2025-07-17 10:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qarmin">@qarmin</a></div>
            <div class="timeline-body"><p>Quite similar to <a href="https://github.com/astral-sh/ty/issues/670">astral-sh/ty#670</a></p>
<p>File content(at the bottom should be attached raw, not formatted file - github removes some non-printable characters, so copying from here may not work):</p>
<pre><code> Â                                    &#x27;betting_env.datastructure.team_lineup.Tamheet.get_latest&#x27;: ( &#x27;dataStrcuture/team_lineup.htm#teamsheet.getlatest&#x27;,
</code></pre>
<p>command</p>
<pre><code>timeout -v 300 ty check TEST___FILE.py
</code></pre>
<p>cause this</p>
<pre><code>thread &#x27;main&#x27; panicked at crates/ruff_annotate_snippets/src/renderer/margin.rs:74:16:
attempt to subtract with overflow
stack backtrace:
   0: __rustc::rust_begin_unwind
             at /rustc/3014e79f9c8d5510ea7b3a3b70d171d0948b1e96/library/std/src/panicking.rs:697:5
   1: core::panicking::panic_fmt
             at /rustc/3014e79f9c8d5510ea7b3a3b70d171d0948b1e96/library/core/src/panicking.rs:75:14
   2: core::panicking::panic_const::panic_const_sub_overflow
             at /rustc/3014e79f9c8d5510ea7b3a3b70d171d0948b1e96/library/core/src/panicking.rs:175:17
   3: ruff_annotate_snippets::renderer::margin::Margin::compute
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/margin.rs:74:16
   4: ruff_annotate_snippets::renderer::margin::Margin::new
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/margin.rs:53:11
   5: ruff_annotate_snippets::renderer::display_list::format_body
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/display_list.rs:1645:18
   6: ruff_annotate_snippets::renderer::display_list::format_snippet
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/display_list.rs:1121:20
   7: ruff_annotate_snippets::renderer::display_list::format_message
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/display_list.rs:1029:19
   8: ruff_annotate_snippets::renderer::display_list::DisplayList::new
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/display_list.rs:127:20
   9: ruff_annotate_snippets::renderer::Renderer::render
             at ./ruff-main/crates/ruff_annotate_snippets/src/renderer/mod.rs:167:9
  10: &lt;ruff_db::diagnostic::render::DisplayDiagnostics as core::fmt::Display&gt;::fmt
             at ./ruff-main/crates/ruff_db/src/diagnostic/render.rs:175:52
  11: &lt;ruff_db::diagnostic::render::DisplayDiagnostic as core::fmt::Display&gt;::fmt
             at ./ruff-main/crates/ruff_db/src/diagnostic/render.rs:70:94
  12: core::fmt::rt::Argument::fmt
             at /rustc/3014e79f9c8d5510ea7b3a3b70d171d0948b1e96/library/core/src/fmt/rt.rs:173:76
  13: core::fmt::write
             at /rustc/3014e79f9c8d5510ea7b3a3b70d171d0948b1e96/library/core/src/fmt/mod.rs:1469:25
  14: &lt;&amp;mut W as core::fmt::Write::write_fmt::SpecWriteFmt&gt;::spec_write_fmt
             at /home/runner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/fmt/mod.rs:233:21
  15: core::fmt::Write::write_fmt
             at /home/runner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/fmt/mod.rs:238:14
  16: ty::MainLoop::main_loop
             at ./ruff-main/crates/ty/src/lib.rs:326:37
  17: ty::MainLoop::run
             at ./ruff-main/crates/ty/src/lib.rs:249:27
  18: ty::run_check
             at ./ruff-main/crates/ty/src/lib.rs:151:19
  19: ty::run
             at ./ruff-main/crates/ty/src/lib.rs:45:39
  20: ty::main
             at ./ruff-main/crates/ty/src/main.rs:6:5
  21: core::ops::function::FnOnce::call_once
             at /home/runner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ops/function.rs:253:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.

##### Automatic Fuzzer note, output status &quot;Some(101)&quot;, output signal &quot;None&quot;
</code></pre>
<p><a href="https://github.com/user-attachments/files/21292888/b.py.zip">b.py.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">diagnostics</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 10:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-17 10:07</div>
            <div class="timeline-body"><p>CC: @BurntSushi</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fatal</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-17 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-07-17 12:10</div>
            <div class="timeline-body"><p>Oof. Acknowledged. I&#x27;ll put this on my goals for next week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-07-17 12:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qarmin">@qarmin</a> on 2025-09-23 06:24</div>
            <div class="timeline-body"><p>It is fixed in latest ty version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/qarmin">@qarmin</a> on 2025-09-23 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qarmin">@qarmin</a> on 2025-09-23 06:26</div>
            <div class="timeline-body"><p>Well, I checked wrong file - this still happens</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/qarmin">@qarmin</a> on 2025-09-23 06:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fuzzer</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-05 13:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:25:05 UTC
    </footer>
</body>
</html>
