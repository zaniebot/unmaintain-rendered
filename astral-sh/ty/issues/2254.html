<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autocomplete is extremely slow in Remote SSH - astral-sh/ty #2254</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Autocomplete is extremely slow in Remote SSH</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2254">#2254</a>
        opened by <a href="https://github.com/SunSeaLucky">@SunSeaLucky</a>
        on 2025-12-29 07:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SunSeaLucky">@SunSeaLucky</a></div>
            <div class="timeline-body">Summary
<p>Hello,</p>
<p>When I use ty as language server (I install ty extension in VSCode) in remote server using Remote SSH:</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/bbee80fb-9ac5-4306-a0dc-7ba879e56331"></p>
<p>It always comsumes about <strong>10s</strong> or more to autocomplete. <strong>I&#x27;m sure this promble is not presented when I use pylance (or pyright) as  my language server.</strong></p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/1bc97413-4c02-4755-be68-eb9a32e07c7e"></p>
<p>However, it works well when I just develop all things in local. So I suspect there is something wrong in using remote. By the way, other functions works well in remote except the autocomplete function.</p>
<p>My environment:</p>
<p>Local:</p>
<ul>
<li>MacOS 15.3.2</li>
<li>VSCode version: November 2025 (version 1.107)</li>
</ul>
<p>Remote:</p>
<ul>
<li>VSCode extension id: astral-sh.ty (with ty==0.0.6)</li>
<li>Linux di-20251207003629-f9fr6 5.4.210-4-velinux1-amd64 #velinux1 SMP Debian 5.4.210-4-velinux1 Tue Mar 21 14:11:05 UTC  x86_64 x86_64 x86_64 GNU/Linux</li>
</ul>
Version
<p>ty extension, which says ty==0.0.6 in document. Sorry if any information is not provided.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by <a href="https://github.com/mtshiba">@mtshiba</a> on 2025-12-29 07:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-29 08:48</div>
            <div class="timeline-body"><p>Thanks for the report.</p>
<p>@BurntSushi plans to look into performance improvements for completions because we&#x27;re aware they&#x27;re slow.</p>
<p>One thing I noticed is that we return more than 100k completions on linux (I used <code>homeassistant</code> and typed <code>prin</code>. Serializing and deserializing that many completions takes a considerable amount of time:</p>
<pre><code>2025-12-29 09:46:41.632150982 DEBUG ty:worker:3 request{id=91 method=&quot;textDocument/completion&quot;}: ty_server::server::api::requests::completion: Completions request returned 175288 suggestions in 427.103268ms
2025-12-29 09:46:42.626659237 DEBUG ty:worker:2 request{id=99 method=&quot;textDocument/inlayHint&quot;}: ty_server::server::api::requests::inlay_hints: Inlay hint request returned 23 hints in 485.738Âµs
2025-12-29 09:46:43.828518907 DEBUG ty:worker:1 request{id=100 method=&quot;textDocument/completion&quot;}:map_stub_definition: ty_module_resolver::resolve: Module `ty_extensions` not found while looking in parent dirs (stubs not allowed)
2025-12-29 09:46:43.828544997 DEBUG ty:worker:1 request{id=100 method=&quot;textDocument/completion&quot;}:map_stub_definition: ty_module_resolver::resolve: Module `ty_extensions` not found while looking in parent dirs (stubs not allowed)
2025-12-29 09:46:43.828560977 DEBUG ty:worker:1 request{id=100 method=&quot;textDocument/completion&quot;}:map_stub_definition: ty_module_resolver::resolve: Module `ty_extensions` not found while looking in parent dirs (stubs not allowed)
2025-12-29 09:46:43.828567647 DEBUG ty:worker:1 request{id=100 method=&quot;textDocument/completion&quot;}:map_stub_definition: ty_module_resolver::resolve: Module `ty_extensions` not found while looking in parent dirs (stubs not allowed)
2025-12-29 09:46:44.047829775 DEBUG ty:worker:1 request{id=100 method=&quot;textDocument/completion&quot;}: ty_server::server::api::requests::completion: Completions request returned 96972 suggestions in 219.855285ms
</code></pre>
<p>It&#x27;s also interesting that there are two completion requests.</p>
<p>I think I&#x27;m going to land a quick fix to truncate completions after 1k entries. It seems rarely useful to get that many</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-29 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">completions</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-12-29 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-12-29 11:38</div>
            <div class="timeline-body"><blockquote>
<p><strong>I&#x27;m sure this promble is not presented when I use pylance (or pyright) as my language server.</strong></p>
</blockquote>
<p>I guess that won&#x27;t happen in there because auto-import completion is off by default in there.
You can set <code>ty.completions.autoImport</code> to false to reduce lags it comes with.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SunSeaLucky">@SunSeaLucky</a> on 2025-12-29 11:51</div>
            <div class="timeline-body"><p>@T-256 Yes you&#x27;re right! I set <code>ty.completions.autoImport</code> to false and it works! Pyright/Pylance does actually not index things that are not imported so they&#x27;re fast.</p>
<p>@MichaReiser So it seems not to be a critical problem and should change the autocomplete item default to <code>false</code>? Anyway, <strong>the limits of 1000 seems the best solution</strong>, as nobody needs a very long list at any time!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-29 12:42</div>
            <div class="timeline-body"><blockquote>
<p>So it seems not to be a critical problem and should change the autocomplete item default to false?</p>
</blockquote>
<p>I don&#x27;t think we should change the default. Completions should be fast enough in most cases and we&#x27;ll make it even faster in the new year :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-12-29 12:42</div>
            <div class="timeline-body"><blockquote>
<p>So it seems not to be a critical problem and should change the autocomplete item default to <code>false</code>?</p>
</blockquote>
<p>See <a href="https://github.com/astral-sh/ruff/pull/21851">astral-sh/ruff#21851</a>#discussion_r2602764513 for the reason that is enabled by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-12-30 01:12</div>
            <div class="timeline-body"><p>I noticed that ty currently returns many more auto-import candidates than pyright. For example, in Neovim, when I type <code>Any</code>:</p>
<p>pyright returns:</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/8c43db84-cfc5-4451-a81b-a47a03564357"></p>
<p>ty returns:</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/0c941466-8530-4bd0-bf28-334c95e79a32"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-30 07:47</div>
            <div class="timeline-body"><p>What pylance mode are you using? Note that Pylance, by default, doesn&#x27;t suggest auto imports for third-party dependencies, whereas ty does.</p>
<p>See https://github.com/microsoft/pylance-release/blob/main/README.md#settings-and-customization</p>
<p>Regardless of that setting. We do plan to further improve completions (you can search for all the open issues with the <code>completions</code> label) and making our fuzzy search stricter or introduce more aggressive pruning are certainly things we should look into.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SunSeaLucky">@SunSeaLucky</a> on 2025-12-30 07:52</div>
            <div class="timeline-body"><p>Hey, thanks so much for such clarifications. Love you guys&#x27; works so much and ty is extremly awesome!!!</p>
<p>I believe ty will absolutely replace pyright and any other python language server in future!!! ðŸ”¥</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-12-30 08:05</div>
            <div class="timeline-body"><blockquote>
<p>What pylance mode are you using? Note that Pylance, by default, doesn&#x27;t suggest auto imports for third-party dependencies, whereas ty does.</p>
</blockquote>
<p>The above result is from pyright 1.1.407 in neovim v0.11.5 without any further configuration, just <code>vim.lsp.enable(&#x27;pyright&#x27;)</code>. I believe this is the corresponding config: https://github.com/neovim/nvim-lspconfig/blob/master/lsp/pyright.lua</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SunSeaLucky">@SunSeaLucky</a> on 2025-12-30 08:09</div>
            <div class="timeline-body"><blockquote>
<p>The above result is from pyright 1.1.407 in neovim v0.11.5 without any further configuration, just vim.lsp.enable(&#x27;pyright&#x27;). I believe this is the corresponding config: https://github.com/neovim/nvim-lspconfig/blob/master/lsp/pyright.lua</p>
</blockquote>
<p>Disable the <code>completions.autoImport</code> configuration item will be fine if you want to use <code>ty</code> like <code>pyright</code>. I believe that all things have been clearly clarifed above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2025-12-30 08:17</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>The above result is from pyright 1.1.407 in neovim v0.11.5 without any further configuration, just vim.lsp.enable(&#x27;pyright&#x27;). I believe this is the corresponding config: https://github.com/neovim/nvim-lspconfig/blob/master/lsp/pyright.lua</p>
</blockquote>
<p>Disable the <code>completions.autoImport</code> configuration item will be fine if you want to use <code>ty</code> like <code>pyright</code>. I believe that all things have been clearly clarifed above.</p>
</blockquote>
<p>Thanks! After upgrading ty to 0.0.8, the experience seems already better. I&#x27;ll keep testing and disable auto import if necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Pre-stable 1&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-31 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/toppk">@toppk</a> on 2025-12-31 23:33</div>
            <div class="timeline-body"><blockquote>
<p>Disable the <code>completions.autoImport</code> configuration item will be fine if you want to use <code>ty</code> like <code>pyright</code>. I believe that all things have been clearly clarifed above.</p>
</blockquote>
<p>auto import seems cool.  would be nice to be able to tune it so it&#x27;s first party only or even adding third party only if they are direct non-dev project dependencies, not the extra hundred packages those dependencies pull in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-06 14:56</div>
            <div class="timeline-body"><p>I haven&#x27;t investigated this specific issue yet, but the remote use case could be challenging. I assume this means that:</p>
<ul>
<li>You&#x27;re running VS Code on your local machine.</li>
<li>You&#x27;re running ty on your local machine.</li>
<li>The code you&#x27;re working on, including its virtual environment, is on a remote machine.</li>
</ul>
<p>Are my assumptions correct here?</p>
<p>(I also work on a remote workstation. But ty runs on the remote workstation and I edit code using neovim in an ssh/tmux session. So that means my editing, LSP and code all live in the same place.)</p>
<p>In order for auto-import to work (which is enabled by default), it has to eagerly visit every module in your environment to discover the set of available exported items. Even putting aside the CPU work required to do this, this could take considerable I/O time if the environment is large. Assuming network I/O is the bottleneck here, we are somewhat limited in what we can feasibly do. One idea mentioned above by @toppk would be to add option to limit auto-import to direct dependencies: <a href="https://github.com/astral-sh/ty/issues/2366">astral-sh/ty#2366</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-06 15:02</div>
            <div class="timeline-body"><blockquote>
<p>Are my assumptions correct here?</p>
</blockquote>
<p>I think they use VS Code&#x27;s Remote SSH feature, see https://code.visualstudio.com/docs/remote/ssh If you&#x27;ve access to an SSH machine, it&#x27;s &quot;as easy&quot; as installing the extension and opening a connection to that host.</p>
<p>VS Code runs locally, the language server runs on the remote (and some other VS Code helpers too)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-06 15:12</div>
            <div class="timeline-body"><p>Oh interesting, OK. Then your change to limit completions to 1,000 might have been the long pole in the tent here. I&#x27;ll investigate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2026-01-06 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Autocomplete is extremly slow in Remote SSH&quot; to &quot;Autocomplete is extremely slow in Remote SSH&quot; by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-06 15:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:49 UTC
    </footer>
</body>
</html>
