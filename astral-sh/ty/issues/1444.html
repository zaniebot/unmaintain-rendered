<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`_MISSING_TYPE` is not callable for `@&lt;field&gt;.default` in `attrs` class - astral-sh/ty #1444</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>_MISSING_TYPE</code> is not callable for <code>@&lt;field&gt;.default</code> in <code>attrs</code> class</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/1444">#1444</a>
        opened by <a href="https://github.com/my1e5">@my1e5</a>
        on 2025-10-27 11:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/my1e5">@my1e5</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p><code>attrs</code> allows you to define a default factory by decorating a function. Since ty <code>0.0.1a24</code> this gives an error: <code>error[call-non-callable]: Object of type _MISSING_TYPE is not callable</code>.</p>
<h2>MRE</h2>
<pre><code class="language-py">from attrs import define, field


@define
class Foo:
    x: int = 1
    y: int = field()

    @y.default
    def _default_y(self) -&gt; int:
        return self.x + 1
</code></pre>
<h2>ty <code>0.0.1a24</code></h2>
<pre><code>$ uvx --with attrs==25.4.0 --with ty==0.0.1a24 ty check dev/attrs_ty.py
Checking ------------------------------------------------------------ 1/1 files
error[call-non-callable]: Object of type `_MISSING_TYPE` is not callable
  --&gt; dev\attrs_ty.py:9:5
   |
 7 |     y: int = field()
 8 |
 9 |     @y.default
   |     ^^^^^^^^^^
10 |     def _default_y(self) -&gt; int:
11 |         return self.x + 1
   |
info: Union variant `_MISSING_TYPE` is incompatible with this call site
info: Attempted to call union type `Unknown | _MISSING_TYPE`
info: rule `call-non-callable` is enabled by default

Found 1 diagnostic
</code></pre>
<h2>ty <code>0.0.1a23</code></h2>
<pre><code>$ uvx --with attrs==25.4.0 --with ty==0.0.1a23 ty check dev/attrs_ty.py
Checking ------------------------------------------------------------ 1/1 files
All checks passed!
</code></pre>
<p>On a similar theme but possibly not related:</p>
<ul>
<li>https://github.com/astral-sh/ty/issues/267</li>
</ul>
<h3>Version</h3>
<p>ty 0.0.1-alpha.24 (1fee7da8b 2025-10-23)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`_MISSING_TYPE` is not callable for `@<field>.default in `attrs` class" to "`_MISSING_TYPE` is not callable for `@<field>.default` in `attrs` class" by @my1e5 on 2025-10-27 11:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">library</span> added by @AlexWaygood on 2025-10-27 11:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-10-27 12:56</div>
            <div class="timeline-body"><p>Thank you for reporting this. This is due to the typeshed annotation of <code>Field.default</code> here:</p>
<p>https://github.com/python/typeshed/blob/16f766b754405004471af20eeb9a5cf8dea05b44/stdlib/dataclasses.pyi#L206</p>
<p>It's unclear to me how this should work without dedicated attrs support (mypy seems to support this <a href="https://github.com/python/mypy/blob/master/mypy/plugins/attrs.py#L575-L602">via a plugin</a>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-10-29 20:09</div>
            <div class="timeline-body"><p>It seems to me like stdlib <code>dataclasses.Field</code> here should not be involved at all? Because this is using <code>attrs.field</code> function, which is annotated to return <code>Any</code> in the cases where no default is given upfront: https://github.com/python-attrs/attrs/blob/main/src/attrs/<strong>init</strong>.pyi#L86</p>
<p>So it seems like we are making a wrong assumption that all dataclass-transform fields are always of type <code>dataclasses.Field</code>, which is not necessarily true.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-10-29 20:45</div>
            <div class="timeline-body"><p>But (after discussion with @sharkdp), type annotations for field-specifier functions are annotated (unfortunately) as returning <code>Any</code> or their default type, not as the actual field object they return. So type checkers have no way to understand the characteristics of the actual returned field object. And other type checkers (without a dedicated plugin) generally don't even try to model that there <em>is</em> a field object/type at all (e.g. <code>dataclasses.Field</code>), they just model the field always as its value type (e.g. <code>int</code>). So pyright also fails on the OP example here, with <code>error: Cannot access attribute &quot;default&quot; for class &quot;int&quot;</code>. If mypy succeeds on this, it's only due to a plugin.</p>
<p>So I think this is something that we would have to support via dedicated built-in <code>attrs</code> support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-09 03:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:20:52 UTC
    </footer>
</body>
</html>
