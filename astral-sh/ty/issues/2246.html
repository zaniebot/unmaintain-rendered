<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ty Seems Like Cannot Reveal Type From Pydantic Validation - astral-sh/ty #2246</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ty Seems Like Cannot Reveal Type From Pydantic Validation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ty/issues/2246">#2246</a>
        opened by <a href="https://github.com/scelikcapa">@scelikcapa</a>
        on 2025-12-28 09:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/scelikcapa">@scelikcapa</a></div>
            <div class="timeline-body">Summary
<p>I have validated the request response with a Pydantic model. And explicitly give a return type to my request method. But ty still adds &quot;Unknown&quot; type to the return type</p>
<p>I have added 3 screenshots.</p>
<ul>
<li>One of them is the model</li>
<li>The second one is the request method</li>
<li>The third one is the place where I use the request method. And you can see &quot;Unknown&quot; type here. <strong>So I have to type check again with isinstance() unnecessarily</strong></li>
</ul>
<p>1- MODEL
<img alt="Image" src="https://github.com/user-attachments/assets/cc5001ca-ee34-483e-a43b-5cae66b18ae7"></p>
<p>2- CLIENT REQUEST METHOD
<img alt="Image" src="https://github.com/user-attachments/assets/9f9b14e7-7060-4ee2-8718-e5b8ba31c1fd"></p>
<p>3- WRONG TYPE
<img alt="Image" src="https://github.com/user-attachments/assets/4d0549f6-3d56-4764-899c-b6798c3e0b82"></p>
Version
<p>v2025.76.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Ty Seems Like Cannot Reveal Type From Pdantic Validation&quot; to &quot;Ty Seems Like Cannot Reveal Type From Pydantic Validation&quot; by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-28 10:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AshishT112203">@AshishT112203</a> on 2025-12-28 23:35</div>
            <div class="timeline-body"><p>out of curiosity, what&#x27;s the indicated type when you hover over <code>result</code> after the <code>result = ZohoEstimateGetResponse.model_validate(obj=result)</code> within the <code>get_estimate</code> function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-29 10:31</div>
            <div class="timeline-body"><p>Can you hover over <code>self.zoho_books_client</code> and share what type ty reveals for it? I wonder if it&#x27;s a union with <code>Unknown</code> (or some other type that isn&#x27;t guaranteed to have a <code>get_estimate</code> function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-29 10:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-29 19:48</div>
            <div class="timeline-body"><p>Yes, I suspect that you need something like <code>zoho_books_client: ZohoBooksClient</code> (or whatever the type is actually called) on the class body of whatever class includes the <code>get_quote</code> method, so we know the type of <code>self.zoho_books_client</code> for sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/carljm">@carljm</a> on 2025-12-29 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-30 06:44</div>
            <div class="timeline-body"><blockquote>
<p>out of curiosity, what&#x27;s the indicated type when you hover over result after the result = ZohoEstimateGetResponse.model_validate(obj=result) within the get_estimate function</p>
</blockquote>
<p>hello @AshishT112203
ZohoEstimate|None</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-30 06:49</div>
            <div class="timeline-body"><blockquote>
<p>Can you hover over <code>self.zoho_books_client</code> and share what type ty reveals for it? I wonder if it&#x27;s a union with <code>Unknown</code> (or some other type that isn&#x27;t guaranteed to have a <code>get_estimate</code> function. @MichaReiser @carljm</p>
</blockquote>
<p>yes, it&#x27;s <strong>Unknown|ZohoBooksClien</strong>t. But this is weird because I see it as <strong>ZohoBooksClient</strong> only in <strong>init</strong>()</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/a1d8e371-3cf3-4a30-90eb-85390570e40d"></p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/1183a3e7-235f-4a3c-8127-68fc6c7ef84f"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-30 06:53</div>
            <div class="timeline-body"><p>I have a type annotation, so this is not the same case as another issue, I think @carljm @MichaReiser</p>
<p>But Ty change the type and adds Unknown to my type annotation in <strong>init</strong>() when self.zoho_books_client is used in another function</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2025-12-30 06:56</div>
            <div class="timeline-body"><p>@scelikcapa can you show the actual code of your <code>__init__</code> method? A type annotation on the parameter to <code>__init__</code> is not (currently) enough, there would need to be one on the <code>self.zoho_books_client = ...</code> assignment. Or else a class-level <code>zoho_books_client: ZohoBooksClient</code> annotation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-30 06:58</div>
            <div class="timeline-body"><p>@carljm</p>
<pre><code>class ZohoService:
    def __init__(self, zoho_crm_client: ZohoCrmClient, zoho_books_client: ZohoBooksClient):
        self.zoho_crm_client = zoho_crm_client
        self.zoho_books_client = zoho_books_client


    async def get_quote(self, quote_id: int) -&gt; ZaqQuote:
        logger.info({&quot;event&quot;: &quot;fetching_zoho_quote&quot;, &quot;quote_id&quot;: quote_id})
        zoho_estimate = await self.zoho_books_client.get_estimate(estimate_id=quote_id)
        if not isinstance(zoho_estimate, ZohoEstimate):
            raise ZohoQuoteNotFoundException(quote_id=quote_id)

        if not zoho_estimate.custom_field_hash.aq_project_id:
            raise ZohoQuoteDoNotLinkToAqProjectException(quote_id=quote_id)

        quote = Mapper.ZohoToDomain.estimate_to_zaq_quote(estimate=zoho_estimate)
        return quote
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-30 07:02</div>
            <div class="timeline-body"><p>@carljm yes, when I add to type directly to self.zoho_books_client like below, it solves the issue</p>
<pre><code>class ZohoService:
    def __init__(self, zoho_crm_client: ZohoCrmClient, zoho_books_client: ZohoBooksClient):
        self.zoho_crm_client = zoho_crm_client
        self.zoho_books_client: ZohoBooksClient = zoho_books_client
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scelikcapa">@scelikcapa</a> on 2025-12-30 07:06</div>
            <div class="timeline-body"><p>@carljm It would be better if ty reveals a type from <strong>init</strong>.</p>
<p>But by the way, great language server. Very appreciated.</p>
<p>I remove Pylance. It kills my RAM and computer, which have 16GB. Very happy to find a solution with ty</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:26:48 UTC
    </footer>
</body>
</html>
