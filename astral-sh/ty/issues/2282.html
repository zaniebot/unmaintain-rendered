<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support dynamic type guards with `hasattr` in a loop - astral-sh/ty #2282</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support dynamic type guards with <code>hasattr</code> in a loop</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2282">#2282</a>
        opened by <a href="https://github.com/phistep">@phistep</a>
        on 2025-12-30 23:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/phistep">@phistep</a> on 2025-12-30 23:32</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Would it be possible to support iterating over attribute names and type guarding in the loop body?</p>
<p>This works, but is cumbersome</p>
<pre><code class="language-python">import glfw

if not hasattr(glfw, attr := &quot;window_hint_string&quot;):
    raise RuntimeError(f&quot;GLFW is missing required attribute: {attr}&quot;)
if not hasattr(glfw, attr := &quot;set_window_opacity&quot;):
    raise RuntimeError(f&quot;GLFW is missing required attribute: {attr}&quot;)
if not hasattr(glfw, attr := &quot;set_window_attrib&quot;):
    raise RuntimeError(f&quot;GLFW is missing required attribute: {attr}&quot;)

# no warning
glfw.window_hint_string(glfw.COCOA_FRAME_NAME, title)
</code></pre>
<p><code>glwf</code>is annative  extension module that defines some members conditionally , see https://github.com/FlorianRhiem/pyGLFW/issues/87#issuecomment-3700678303</p>
<p>I would rather want to write it like this</p>
<pre><code class="language-python">for attr in [&quot;window_hint_string&quot;, &quot;set_window_opacity&quot;, &quot;set_window_attrib&quot;):
    if not hasattr(glfw, attr):
        raise RuntimeError(f&quot;GLFW is missing required attribute: {attr}&quot;)

# warning[possibly-missing-attribute]: Member `window_hint_string` may be missing on module `glfw`
glfw.window_hint_string(glfw.COCOA_FRAME_NAME, title)
</code></pre>
<p>Unsure if this is realistic or even possible given that one would have to actually execute the code. But for simple patterns like this, I assume that <code>ty</code> could infer all possible values of <code>attr</code> statically and doe the expansion?</p>
<p>(side note: <code>warning[possibly-missing-attribute]</code> made me find this bug before it happened, thank you! :​­) https://github.com/phistep/VHSh/blob/a7f930bc47f9d4eae2be3ef329c79ef29849a259/src/vhsh/window.py#L57-L59</p>
<h3>Version</h3>
<pre><code>~/Library/Application Support/Zed/languages/ty/ty-0.0.7/ty-aarch64-apple-darwin/ty
</code></pre>
<p>Bundled with Zed <code>0.217.3+stable.105.80433cb239e868271457ac376673a5f75bc4adb1</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-12-30 23:48</div>
            <div class="timeline-body"><p>One less cumbersome way to do this would be with a <a href="https://docs.python.org/3/library/typing.html#typing.runtime_checkable"><code>runtime_checkable</code></a> <a href="https://docs.python.org/3/library/typing.html#typing.Protocol"><code>Protocol</code></a>, since the way it checks at runtime is the same as a bunch of <code>hasattr</code>s. The downside with that is it may not currently work, since #1858 is still open, but should work in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">narrowing</span> added by @mtshiba on 2025-12-31 02:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @carljm on 2026-01-06 01:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2026-01-06 01:59</div>
            <div class="timeline-body"><p>This would be very cool, but also quite difficult, I think. It requires not only knowing that <code>attr</code> is of type <code>Literal[&quot;window_hint_string&quot;, &quot;set_window_opacity&quot;, &quot;set_window_attrib&quot;]</code> (which we already know, if you use a tuple instead of list literal to iterate over), but also knowing that the code inside the loop is executed once for each of those values. This would require significant special-casing of control flow understanding for the particular case of iterating over certain kinds of iterable literals.</p>
<p>Also, no other type checker is able to handle this.</p>
<p>I'll keep the issue open, but it's not likely to be a near-term priority.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:41:58 UTC
    </footer>
</body>
</html>
