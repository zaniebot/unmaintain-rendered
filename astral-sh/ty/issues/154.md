```yaml
number: 154
title: support TypedDict (and Required, NotRequired, ReadOnly)
type: issue
state: open
author: carljm
labels:
  - typing semantics
  - typeddict
assignees: []
created_at: 2025-03-26T18:06:53Z
updated_at: 2026-01-09T15:53:18Z
url: https://github.com/astral-sh/ty/issues/154
synced_at: 2026-01-10T01:56:40Z
```

# support TypedDict (and Required, NotRequired, ReadOnly)

---

_Issue opened by @carljm on 2025-03-26 18:06_

- [x] Introduce a new `Type` variant, basic support for class-based `TypedDict` syntax
  - [x] Parse a `TypedDict` specification from the class body
  - [x] Implement / test assignability to `Mapping[str, object]`
  - [x] Make sure that `TypedDict`-based objects do not behave like instances of that class. For example, attribute access should not work.
  - [x] Implement fallback to `_typeshed._type_checker_internals.TypedDictFallback`
- [x] Type inference for key accesses (`movie['directory'] -> str`)
- [x] Validation of writes to keys (synthesized `__setitem__` method with `key: Literal["key1"], value: ValueType1`?)
- [x] Validation of constructor calls (`Movie(name="Blade Runner", year=1982)`)
- [x] Validation of `{â€¦}` literals to `TypedDict` types
- [x] [Totality](https://typing.python.org/en/latest/spec/typeddict.html#totality)
  - [x] `Required` and `NotRequired`
- [x] Implement / write tests for generic `TypedDict`s
- [x] Implement / write tests for recursive `TypedDict`s
- [x] Support type inference for `instance.get("known_key")`?
- [x] [PEP 705 support](https://peps.python.org/pep-0705/) (`ReadOnly`)
- [x] #1387 
- [x] Implement disjointness for `TypedDict`.
- [ ] Support `TypedDict`s in all contexts (`return` position, function call arguments, etc) => #168 
- [ ] [PEP 728 support](https://peps.python.org/pep-0728/) ("openness", `extra_items`)
- [ ] Functional syntax (`Movie = TypedDict('Movie', {'name': str, 'year': int})`)
- [ ] Support for `Unpack`
- [ ] Overriding of fields in inheritance
- [ ] Correctness, validation
  - [ ] Implement checks based on [supported and unsupported operations](https://typing.python.org/en/latest/spec/typeddict.html#supported-and-unsupported-operations)
  - [ ] `TypedDict` type objects cannot be used in `isinstance` checks
  - [ ] Only item definitions in the class body (no methods, for example)
  - [ ] Specifying a metaclass is not allowed
  - [ ] Can only subclass `TypedDict`, `TypedDict`- based types and `Generic`
  - [ ] Implement / write tests for subclassing of `TypedDict`-based classes including multiple inheritance
- [ ] Performance
  - [ ] Try out the optimization proposed in https://github.com/astral-sh/ruff/pull/19763#discussion_r2256719857
  - [ ] Add a micro-benchmark for large `TypedDict`s
- [x] Implement `.normalize()` for `TypeDictType`.
- [x] Investigate Pydantic-specific performance problems introduced in [#21467](https://github.com/astral-sh/ruff/pull/21467).
- [ ] Add `TypedDict` to property tests.
- [x] Submit a correction to the upstream assignability rules => https://github.com/python/typing/pull/2119
- [ ] LSP support (competitions, go to definitions, rename, hover, ...)

---

_Renamed from "[red-knot] support TypedDict (and Required, NotRequired, ReadOnly)" to "support TypedDict (and Required, NotRequired, ReadOnly)" by @MichaReiser on 2025-05-07 15:25_

---

_Label `typing semantics` added by @AlexWaygood on 2025-05-11 07:55_

---

_Comment by @tylerlaprade on 2025-05-20 18:44_

And `total=False`

---

_Removed from milestone `GA` by @carljm on 2025-06-11 00:46_

---

_Added to milestone `Beta` by @carljm on 2025-06-11 00:46_

---

_Comment by @JelleZijlstra on 2025-06-14 01:03_

TypedDict has a few interesting properties that may affect core concepts in the type system, so I'll be interested to see how you handle them.

The spec says that a TypedDict must be an instance of `dict` itself, not a subclass. I think that means these test cases should pass:

```python
from typing import Mapping, TypedDict, assert_type

class TD(TypedDict):
    a: int

class SubDict[KT, VT](dict[KT, VT]):
    pass

def f(x: TD | dict[int, str]):
    if isinstance(x, SubDict):
        assert_type(x, SubDict[int, str])
    else:
        assert_type(x, TD | dict[int, str])

def g(x: TD | Mapping[int, str]):
    if isinstance(x, dict):
        assert_type(x, TD | dict[int, str])
    else:
        assert_type(x, Mapping[int, str])
```
(Neither mypy nor pyright currently pass all of this, mostly because they put Any/Unknown in type parameters. I'm not sure there's a good reason for that.)

However, a TypedDict type is not assignable to `dict[T, U]` for any values of T and U, not even to `dict[Any, Any]` (spec: https://typing.python.org/en/latest/spec/typeddict.html#assignability). This will have interesting consequences for the issues in #456: it means that narrowing from `isinstance(x, dict)` can't be implemented by intersecting with some version of `forall K, V. dict[K, V]`.



---

_Comment by @sslivkoff on 2025-07-14 21:26_

another piece of functionality that would eventually be nice here is the `Unpack` keyword

refs
1. https://typing.python.org/en/latest/spec/callables.html#unpack-kwargs
2. https://peps.python.org/pep-0692/

it's basically a way to use TypedDict's to type the `**kwargs` of a function

this ends up being very useful in practice for balancing python's flexibility with strict type checking

---

_Assigned to @sharkdp by @sharkdp on 2025-07-31 11:04_

---

_Comment by @carljm on 2025-08-15 14:41_

Moving this to GA because we feel the current feature-set is adequate for beta (though it would be nice to add a few more things if we have time).

---

_Removed from milestone `Beta` by @carljm on 2025-08-15 14:42_

---

_Added to milestone `GA` by @carljm on 2025-08-15 14:42_

---

_Comment by @AlexWaygood on 2025-08-15 14:43_

> Moving this to GA because we feel the current feature-set is adequate for beta (though it would be nice to add a few more things if we have time).

(Note that there are many dictionaries that we do not infer as `TypedDict` instances right now despite them being annotated as such, but that's really part of https://github.com/astral-sh/ty/issues/168 rather than this issue -- that issue should definitely be a beta priority!)

---

_Comment by @carljm on 2025-08-19 21:33_

https://github.com/python/typing/pull/2072 rewrites the TypedDict spec to be much clearer and more concise, which may be useful to anyone working on further features here.

---

_Comment by @JelleZijlstra on 2025-08-25 04:35_

Specifically a good place to focus on would be the full structure of TypedDict as laid out in the introduction to the proposed spec change (a list of items consisting of key, value type, requiredness, mutability; whether there are extra items; and whether or not the extra items are read-only). The internal representation of TypedDict types likely should follow that structure closely. Then you'll also have to write code to recognize the syntactic forms that create these TypedDicts (e.g., keyword args to the TypedDict constructor; the Required/NotRequired/ReadOnly qualifiers; maybe inheritance, though that can wait). Implementing this structure should provide a good basis for implementing other operations on TypedDicts.

---

_Removed from milestone `GA` by @carljm on 2025-09-19 14:45_

---

_Added to milestone `Beta` by @carljm on 2025-09-19 14:45_

---

_Comment by @tmke8 on 2025-10-07 21:46_

Currently this type-checks on the playground (I don't know whether it also type-checks on main):

```python
from typing import TypedDict

class TD(TypedDict):
    a: str

x: TD = 1
```

Even if full bidirectional type checking isn't implemented yet, wouldn't it be possible to at least check whether the right-hand side is a dictionary?

---

_Comment by @AlexWaygood on 2025-10-07 21:48_

> Currently this type-checks on the playground (I don't know whether it also type-checks on main):

(The ty playground automatically gets a fresh deploy on each new commit to `main`, so it's usually <10 minutes behind `main`)

---

_Comment by @AlexWaygood on 2025-10-07 21:53_

anyway: we're working on `TypedDict` features actively, and we will get an improved `TypedDict` assignability implementation delivered to you as soon as we can ðŸ˜„

---

_Removed from milestone `Beta` by @sharkdp on 2025-10-17 14:21_

---

_Added to milestone `GA` by @sharkdp on 2025-10-17 14:21_

---

_Comment by @sharkdp on 2025-10-17 14:21_

Moving this ticket to GA, but #1387 into the Beta

---

_Unassigned @sharkdp by @sharkdp on 2025-10-20 07:07_

---

_Label `typeddict` added by @carljm on 2025-11-06 13:57_

---

_Assigned to @oconnor663 by @oconnor663 on 2025-11-14 15:21_

---

_Comment by @oconnor663 on 2025-11-14 23:35_

Added a checkbox at the top for "Implement `.normalize()` for `TypeDictType`."

---

_Comment by @charliermarsh on 2026-01-01 21:44_

I'm working on the functional syntax piece.

---

_Unassigned @oconnor663 by @oconnor663 on 2026-01-09 15:53_

---
